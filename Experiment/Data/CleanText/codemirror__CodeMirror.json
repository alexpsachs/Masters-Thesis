{
    "marijnh": "It does on Webkit, Opera, and Firefox. Since you didn't even specify which browser you tested with, I'm going to close this until further notice.\n. Well, it does for me. Please describe your test case in more detail. When I visit http://codemirror.net/jstest.html and double-click any of the words in the editor, they are selected.\n. Ugh, I didn't pay attention. Yeah, double-click select is definitely broken in CM2. Adding to my list.\n. This was implemented in 09954783272d371059874a63c0663bbc6f84bf8f\n. Heh, this was a bizarre corner case where the mouse event ended up on the absolutely positioned cursor node, and my code, which tried to ensure it only handled events on the text (not, for example, on the line-number gutter), got confused by that. Should be fixed by 3153be8ffceecf1298b9a6deb6559648b8d1db5a , let me know if you find more problems.\n. Nice. I didn't know about those color aliases. Unfortunately, on Chrome Linux I get a baby-blue that doesn't resemble the color it uses for selection. Still, better than the old situation. Applied.\n. 2068d0bf0ec6a0a3b3a95139e7ae4b1582e4886d should handle this problem (via http://stackoverflow.com/questions/4759988/xhtml-ie6-overflowhidden-problem)\nI'd like CodeMirror to basically work on IE6, so that people stuck in the past aren't entirely left out. That being said, I don't care much about having everything act polished on this browser.\nMysteriously, the slowness does indeed no longer occur in current HEAD, so I'm closing this issue.\n. This was done in a3a607cd69dc4ebca9dab027b1cc8f2e5b48434b\n. This proposal is dead. On the bright side, there's the start of some Orion-CodeMirror compatibility growing at https://github.com/mamacdon/orion-codemirror\n. Thanks for the report. Fixed in ddd807ae83548555e6dc077702180bef95328f2f\n. Fixed by 84c3de855e84f4d37495f87ba94a4a023eba3142\n. This should be fixed, except on Opera. See https://github.com/marijnh/codemirror2/issues#issue/10 for that.\n. Should be fixed in f47c50d5061260597a81acc4137bb5e5457c1241\n. Neither Ymacs nor ACE works on Opera (11.01) OS X. I'm shelving this -- CodeMirror mostly works, but doesn't handle all key events it should handle.\n. (This can probably be done by detecting the cmd keydowns and keeping our own flag.)\n. This was handled by e8db7e25fb2248a75335c14bfa2b1568461d7886\n. See 0b41aa405f79b386ee559dba6a5f8fadc3fbcc36\n. Fixed in c9d8817a296d21ae2fc79d55bef5310c301e4f12\n. The variable actually got a new name, lineWrap. I've committed a fix in 2a2862cd21be9d654076a82fb224d06972f7d674\n(As an aside, if you use addWidget rather than depending on page-coordinates for positioning your widget, you get correct scrolling for free.)\n. Hi Mark,\nThanks for the patches. I am setting the height because, if the gutter has a background color, I want that to be shown the full height of the editor, not just the part that has text. I agree that it's fragile, but I didn't find a nicer way to get this effect. Can you give me a bit of detail on when and how the layout is messed up? Does it happen in the demo pages, or just in your own setup?\nBest,\nMarijn\n. Your solution is fine for the case where you don't constrain the editor's height. However, when, as in the demo pages, the height is fixed and the editor is almost empty, you get a very ugly partial gutter. I'll put a bit more thought into a more elegant solution to this (preferably one that doesn't require complicated and brittle CSS tricks). Suggestions are welcome.\n. By the way, I pulled in your other patch (the fromTextArea bugfix).\n. -      for (var off = forward ? pos + 1 : pos, i = 0, e = st.length; i < st; i+=2)\n-      for (var off = pos + 1, i = 0, e = st.length; i < e; i+=2)\nIt seems that changing < st to < e is perfectly sane, but why did you change the init value of off? I've, for now, pushed a patch that only makes the < e change.\n. You are right. Not sure what I was thinking when I wrote it this way. Pushed another fix.\n. Please see 6756f4a8f296b83e4728107d75a58b08f313e52c , which seems to solve your problem by (predictably) adding yet another wrapping DIV.\nYou might also want to look into the new blockDocumentScroll option if you're not making your editor scrollable -- the first thing I noticed when removing the overflow: auto was that my scroll wheel didn't react properly anymore when inside the editor.\n. Fixed in a7e38846476b8c6eafad30cbf0796850282d119b\n. The idea is that you just register your own key handler on .getInputField(), which is more general than having a specific option for a specific key.\n. Done in a26ec764af02e3db0a3e614d9e237b58ee8d6ac3\n. Added http://codemirror.net/2/demo/complete.html for a start.\n. Done.\n. It says, and is now called onKeyEvent. Documented in 21c81e8938583d882d46542f479eb8618523f6f8\n. Hi Mark,\nI had it like this at one point, but there are two reasons I changed it:\n- If you have something styled blue, it'll become unreadable when the selection causes the background to also be blue.\n- It is very common to have to set large chunks of code to be fully selected. The short-cut at the start of my getHTML makes this very efficient.\nNone of these are showstoppers, but yeah, I did think about this. I'll think about it some more. Feel free to add more comments.\n(Also, for proper pull requests, rebase your fork on my current head, instead of merging.)\nBest,\nMarijn\n. Okay, on closer look, my first objection is bogus (!important takes care of that), and my second one is really no big deal, since I've never noticed de-selecting being slower than selecting something. I pulled in your patch.\n. Done.\n. The API should lend itself pretty well for this. See markText for marking highlighted stuff, and getLine for fetching the content of a line, in order to search for tags in it.\n. Anyway, this isn't going to go into the core editor (though I'd welcome an extended XML mode that does this). Closing.\n. Though I didn't figure out the actual cause, I suspect it had something to do with the browser scrolling the textarea into view, since cac102defb9dad9520e65b26fb8684cad60ea9c4 solves this.\n. Fixed by 1be17730dcae2283a72d21f4230070129f069f4b\n. Fixed by 24ac85195c78c106b2bb9a846d4af0bbab34b4f5\n. I'll need way more context to know what you're talking about here. Which demo page, which browser, what exactly does 'returning to the line' mean?\n. Maybe try reading the manual? http://codemirror.net/2/manual.html#option_enterMode\n. You either didn't finish your line with a semicolon, or opened a new block.\n. The whole trailing space selection display was apparently nixed by the patch that preserved token styles in selection. Restored by 24ac85195c78c106b2bb9a846d4af0bbab34b4f5\n. f2f565068c39d33df102d00b909b3573e4ad25cd should solve this on all browsers except Opera using the second approach outlined. I gave up on Opera.\n. It worked like that (cursor being inline element) at some point, but, if I remember correctly, I got rid of it for two reasons:\n- Slight efficiency gain -- don't need to re-render lines when the cursor is moving\n- Couldn't find a way to create zero-offsetWidth inline elements in IE6\n. This requires DOM walking and munging though, which is notoriously inefficient. Still, we probably don't need to do it all that often, and there could be an option (variableWidthFont: true) so that only people who need it pay the price.\n. So how are you building the HTML? Extra argument to getHTML? (Or just put your code in a github fork.)\n. This won't work if the line has marked or selected styles that influence the width, and since the logic is already there, adding a limit argument to getHTML seems more effective.\n. Wontfix.\n. David has indicated he is no longer interested in CodeMirror. I personally don't care about variable-width fonts. Until someone else volunteers to work on this, it is off-radar.\n. I think I fixed this in 0bb2b8ba09ba5de70d66a683f5ab544ce1cedaa0 , but please check whether this solves your issue (since you didn't describe the buggy outcome in detail).\n. I'll cherry-pick the relevant patches. Next time, do a rebase first. Can you provide me with a license file to put in the haskell mode dir, or do you want to simply put it under the existing CM license?\n. Applied.\n. I think this should work:\nfunction reindentCM(instance) {\n  for (var i = 0, e = instance.lineCount(); i < e; ++i) instance.indentLine(i);\n}\n. (Or, to clarify, I don't think this warrants a separate API function, if it's so easy to do through the existing API.)\n. Handled by 2670b1e1ab3f96b3de37d1c903104f95e3a4c36b\n. Handled by 45c14cc1723be061b3bad1398ff101ce1bc2d51d\n. Partially handled by 3d35c5bc573d1f23569d37b158bc5dfb7990a898\n. This seems to not cause any real problems. Closing.\n. This seems to be mostly related to having to read out the whole blob of text from the textarea on every keypress (repeatedly).\nA work-around would remove parts of huge lines when putting them into the textarea, and somehow still manage to reconstruct the modifications and cursor position from the modified content.\n50986f1c94fe041c3c44a780af9e36463f2718cf and b3d5979c652ebf9d53af4b1e2796799fa1b1e9ad solve some of the main breakage with big lines, https://bugs.webkit.org/show_bug.cgi?id=51168 still causes problems on Webkit.\n. This seems to be mostly solved in the keymap branch. Big lines still need to be completely re-rendered when edited, and cursor measurements are more expensive in them, so they will never be blazingly fast (especially on slower browsers/machines), but on a modern machine with Chrome, I can edit a 100k-character line with reasonable responsiveness now.\n. Hi Chiel,\nAre you working with the current git HEAD? Commit ef83a9126c34f68811a488fe55885deec89dd93f fixed something related to this, and if I now open one of the demo pages, and set (from the script console) the height of the editor, the gutter is indeed off, but calling .refresh() does properly fix this.\nBest,\nMarijn\n. Someone in the google group provided me with a test case for this. db0a7e6fa0ede727555a7255f3af3f16bd443298 should solve it. If it doesn't reopen.\n. Thanks. Fixed.\n(Err, sorry I didn't use your patch. My fingers had already committed and pushed a fix before I realized this was a pull request, not a regular issue.)\n. I develop on Chrome, and for me it's faster than any other browser. Please give an exact version and platform, and describe what you are doing.\n. Nothing comes to mind. It could be something really stupid\u2014this codebase is very new. So yeah, just reduce the complexity of your test one step at a time until you find the relevant difference. (You don't want to know how often I've had to do this for CodeMirror 1.)\n. Thanks! Applied. I had already kept the XHTML issues with CodeMirror 1 in mind when writing this code, but hadn't actually tested in an XHTML doc.\n. Hi Charlie,\nI found two indentation-related bugs (06540e37696e6725b5baeb10cf4fa61f0c33458b and 6dc5d319e5b9d0a4c3d5ddbd239f08f8dfa8bd46) that were in play here, which caused the hangs and the weird indentation. The reaction to the slash key is caused by the fact that that key is considered 'electric' by the xml mode, meaning it might change the indentation of the current line, so the line is reindented when you type a slash. To turn this off, set the electricChars option to false.\nLet me know whether this solved you problems.\nBest,\nMarijn\n. I think getOption(\"mode\") will do what you want.\n. Right, when trying to use a mode that wasn't loaded, it'll fall back to the null mode. Why do you need to detect this? Wouldn't it suffice to just ensure you only use modes that are loaded?\nI am planning to add something that'll list loaded modes. That might help here.\n. Mode names are not extensions. If you want something 'clever' like this, use MIME types. Again, why do you need to find out which mode was picked?\n. Yeah, I can, but I'm trying to figure out your use case. I try to be a bit conservative in adding API functions, to keep things tidy.\n. Because you're not expected to ask for any old random mode. You have control over the modes you load, so you should know whether the mode you're trying to use is present.\n. Firstly, I talked about adding a way to list the loaded modes, and in fact have already added that (see the the current HEAD commit).\nSecondly, if your tone is going to be like this, forget about it\u2014go bother the maintainer of some other project.\n. Hi Brandon,\nLooks mostly good. I added a few inline comments pointing out small problems.\nIf you want to tackle indentation, I'll probably have to slightly extend the current indentation API, to support modes that cycle through indentations, rather than enforce a single one, as Python has multiple valid indentation for many lines.\nBest,\nMarijn\n. > I'm not interested in indentation for my own use-- is it necessary?\nNo, it's optional. If you revise your patch (or simply add another\none), I'll pull the result into my repo, and it'll be part of the next\nrelease (I think I'll bring out an official 2.0 soon).\n. This was superseded by the new Python mode.\n. Hi,\nI'm not aware of a cross-browser way to make something the size of the\nwindow (there might be one though -- I'm no CSS guru. If you find\nsomething, let me know.) What I'd do is have a script set the\n.style.height of the wrapper element (see .getWrapperElement method),\nand register an onresize handler on the window that resets this height\n(using window.innerHeight and such, depending on the browser).\nBest,\nMarijn\n. > position: absolute; height: 100%; top: 0; bottom: 0; left: 0; right: 0;\nThanks! That's good to know -- I'll pass it on to the next person who asks ;)\nCheers,\nMarijn\n. Ah, right. I had noticed last week, but had forgotten about it. Thanks for reminding me. b4b39e9c40db933796284091d019be0de6e8f7c8 should fix it.\n. You can expect 2.0 to be released end of this month, unless someone finds a horrible unfixable problem. I just need to find the time to properly integrate it in the website. I'll leave this bug open as a reminder.\n. It's out. Closing.\n. I can't really explain why this happens (especially since it only happens when all three CSS rules are present), but setting a width for CodeMirror's hidden textarea (22ee5fbd94aa72a29478bb1bac71f0d0d80e53aa) solves it.\n. Yeah, but it'd probably be a few hours work to distil a useful demo case out of the CodeMirror codebase (they typically don't want to wade through a huge system to pinpoint a bug). I don't currently have the time to spare.\n. .setOption(\"mode\", ...) can change the mode at run-time. There is currently no way to not require <?php for PHP mode (though it wouldn't be hard to add).\n. If you want to simply not require the <? at all, pull out the top of php.js into its own mode, pretty much like this (untested, depends on clike mode): https://gist.github.com/888623\nIf you want to support it but not error when it doesn't appear, that's more tricky, you'd have to do some mode-writing yourself for that.\n. Thanks for the detailed report. Fixed in 8e146ced93ab8d74b8f5340e4d89f9eb81e43ed2.\n. Hello Matt,\n\nI setup this handler in an instance of CodeMirror 2 and it's executed only on component creation time, on setValue() and when 'delete' key is pressed. I would expect onChange to be executed on every keystroke that results in editor's content change.\n\nThis would be a bug. However, it is not something that I can\nreproduce. It seems to work fine for me. Please verify that you're\nsetting up your handler correctly and not, for example, calling it\nwhen you're passing it to CodeMirror, instead of passing the function\nvalue.\nBest,\nMarijn\n. In the current version, line 1221 in lib/codemirror.js calls the\nonChange handler.\n. Hi Daniel,\nThanks for the patch. I removed some obsolete pieces of C mode that\nyou left in and fixed indentation. Please try the smalltalk branch in\nmy github repo 1 and see if it works for you.\nBest,\nMarijn\n. Should be fixed by 2199863876653ab5c98e7b049af738b25d6ae8d9\n. I assume you are talking about mixed-mode HTML here. In that case, this should be fixed by 608ae6a7a7a30955a94c722a881188d15fb10706\n. Hi Mateusz,\nGreat! Is Python somehow tied to restructuredtext? Wouldn't it make more sense to simply have the .verbatim option default to 'python'?\nBest,\nMarijn\n. Merged your work so far. Thanks. Let me know when you end up updating it.\n. This doesn't happen with the current beta (11.0), so I hope this is a bug they'll sort out before promoting 12 to beta or stable.\n. Hi,\nVery odd. I don't get anything like this on my own IE9. I'm curious about the cursor placement thing though. Can you create a minimal test-case that shows it happening?\nBest,\nMarijn\n. This is almost certainly fixed by 51b7f7e1bfb0ce1893ad16cd69f3b5c2a4097280 . Reopen if not.\n. Not in core codemirror. But see http://codemirror.net/demo/activeline.html\n. No, unfortunately. See the bottom of http://codemirror.net/internals.html#summary \n. I unfortunately do not have time to test and hack and debug on iOS devices at this point. I'm happy to hear things seem to be close to working, and I'd very much appreciate if someone could contribute a patch that makes them really work.\nThe textarea is already visible, in that it stuffed in an overflow: hidden, zero-width div. Ths div is also already being positioned to prevent the scrolling issue you saw. I'm not sure what mobile safari uses to determine whether something is on screen. For all the big desktop browsers, the inside-zero-width-div thing seems to suffice.\n. I've considered doing something with a textarea like that, but it seems like a real can of worms wrt browser quircks. What exactly was not working in iOS before? I played around on my Android and, barring the scroll-bar absence, it seems to work pretty well.\n. There are multiple issues with keeping a textarea aligned. The biggest one is that it requires the whole document to be present in the textarea, so that clicks are interpreted properly. This gets slow for bigger documents. I simply didn't architect CodeMirror like this, and to change to this model is going to be a lot of work. If someone else does all this work, I'm very interested in the result. But I won't accept a half-hearted patch and then take on the burden of supporting it.\n. Nice! Possibly, the arrow issue is simply caused by those keys firing non-standard key codes in iOS. Could you go to http://mochi.github.com/mochikit/examples/key_events/index.html and see which (if any) key events are fired when you press the arrow keys?\n. https://groups.google.com/forum/?fromgroups=#!topic/CodeMirror/exGdyp4NTOo is relevant here (an implementation of iOS selection behavior)\n. This has landed in 5.0.\n. Did you try calling .refresh() after un-hiding the editor?\n. When display is none, no elements report any kind of valid width, height, or offset numbers, so CodeMirror can't lay itself out. Thus, after the display: none is removed (visibility: hidden, or being scrolled/clipped out of view is okay), you should call refresh to make it re-layout.\nAs for cursor position on a line ending, I don't know of any problem there. Please open a new issue with a more specific description of the problem (including the browser you're using).\n. I'd rather not run a bunch of 3rd party PHP files on my machine just to see a test case. Do you have this hosted somewhere where I can test it out? Or, even better, can you create an html-only file that reproduces the problem?\n. Solved by the new always-measure-cursor-X approach.\n. What it does is move the cursor by (almost) a whole 'page' (the amount of visible vertical space). What exactly do you want to happen?\n. I tried on all three platforms you mentioned, and do not get the behaviour you described. Maybe you missed something subtle in your description? Does it always misbehave, or only under specific circumstances? Are you using the current git version?\n. > When I run the demo page \u201ccomplete.html\u201d on IE 7,I found that\uff0csome code could not be masked by the input div.\nHrm, IE7 is the one version that I don't have installed anymore. Do\nyou know of a way to install it without screwing up my whole Windows\nXP virtual machine?\n. This appears to be http://www.quirksmode.org/bugreports/archives/2006/09/Overflow_Hidden_not_hiding.html . Putting the page into quircks mode seems to solve it, but I'm trying to find a better solution.\n. 6868a050ee6958bb1bf344bddc08b8ce4ec1efdf should solve this, with the caveat that your cursor will be off on old IEs if you give the .CodeMirror element a fat border \n. You aren't passing functions to onChange, onBlur, and onCursorActivity. You're calling allert right away when creating the object. Wrap it in a function, it'll work.\n. > They should pay you more\nNo kidding.\n. I can't reproduce this... I did find a problem with CDATA parsing (it looked for <![[CDATA[ instead of <![CDATA[), but I don't get the error you describe. Can you paste a document that triggers it somewhere?\n. If I copy that HTML file to my local machine, and replace the line that imports the compressed codemirror with a few lines that import the un-compressed version, things work fine. Could it be that your compressed codemirror is out of date or damaged somehow?\n. Finally managed to properly reproduce it (a decently packaged demo would have helped a lot). Fixed in e0e064b7ee3941340f93e32cbbbd07ceca521783\n. This is a known problem. Implementing a goal column would be rather awkward because CodeMirror is not explicitly handling up/down keys (and also supports other line-movement keys when the browser accepts them, such as ctrl-p/n on OSX or emacs-bindings-enabled GTK). I'd love to support this, but I'm not going to work on it on the short term.\n. This is fixed in the keymap branch (which will be in the December release).\n. I think I reproduced the first issue, and fixed it with 9d2f40d68361d2392cc3d92fa40c03af0df0807a . I can't reproduce the second one. Is this also in IE? Are you selecting with mouse or with ctrl-a, or doesn't that matter?\n. Still no luck reproducing the ctrl-a issue (on windows 7, IE9)\n. Hi,\nI had already fixed this (in a cruder way) on my side ( 065dcacda186410d63f15bba26c7c13aafb464b7 ). Also, could you please rebase instead of merging your branch before the next pull request?\nThanks,\nMarijn\n. Try calling .refresh() on the CodeMirror instance after un-hiding it.\n. Yes, this is the way to handle this. CodeMirror can't detect when it is being shown, so it needs an explicit refresh call to figure out its dimensions.\n. Thanks. Looks good -- applied.\n. Good point. The first time onChange fires the instance hasn't finished initializing, hence the undefined argument being passed. I've changed things (commit 2c7b5a938169ebade4e1eb8fbb10653ca6c4e173) so that it doesn't fire onChange during initialization, since that made no sense anyway. This should solve your problem.\n. Some kind of model for choosing whether programmatic changes cause onChange to fire or not will probably have to be added at some point, but it's not something I'm currently working on...\n. Sounds like a different issue, so please do create a new issue. You'll have to be a bit more specific about what you want to achieve.\n. 72e60952d49e564bb26603fd84987ffe6b20dc0d seems to fix this.\n. Works for me. Which browser?\n. > btw if I type []. or {}. in CodeMIrror2 and then Ctrl+Space, no autocomplete for this?\nNope. Special cases could be added, but currently this is just a simple demo.\n. alert.[ctrl-space] will give you the function prototype completions. Not sure if there are any regular arrays in the standard environment.\n. The autocomplete demo already recognizes local (not global) variables defined in the code. This is not a question of CodeMirror supporting something, but simply an issue of writing a mode that supports what you need.\n. Look into writing modes. CodeMirror itself will never contain any kind of autocomplete magic, but it can serve as a platform for these things just fine.\n. There shouldn't be anything special about shift. Are you using onKeyEvent to capture the event? Are you properly stopping it?\n. Binding handlers like this is simply not supported. Use onKeyEvent.\n. Ah, right, now I get what the problem is. Fixed in d9ed70f743bb32e039c3c7434d88077eaacbe45e\n. Thanks for the report. This was broken by a recent refactor. Fixed in a3dbe9e303decfdfefbb712bfe9b68eb035c2ea9\n. Err, I submitted my own patch before seeing this pull request. Sorry! (a3dbe9e303decfdfefbb712bfe9b68eb035c2ea9)\n. You might want to start by looking at the manual and noticing that this already exists, at least for modes that implement it.\n. Fixed by ebb15abb4d0a643e3ddbf9fa32e9d33a3eb3095f\n. Hey, thanks for writing that. Any chance you could, instead of copy-pasting most of the pl/sql mode, adjust that to be parameterizable in a few more ways to also handle regular SQL? (In the same way the C-like mode handles Java and PHP through some flag parameters). I'd prefer that, so that I won't have to fix every bug found in this code in two different places.\n. Timing this out. There's now a well-written mysql mode that further sql-like modes can be based on.\n. Right. CodeMirror can take a lot of shortcuts because it knows lines have the same height. I have no intention of supporting varying heights.\n. Right, folding is now supported (by using the hideLine method, not by setting the height to zero with a style).\n. Thanks for noticing those!\n. I have no idea. The github automerge feature seems to be a bit screwy. I've merged it again, the old-fashioned way.\n. Thanks!\n. See your other bug. Put the script you're talking about on a pastebin somewhere, don't make me go through dodgy websites.\n. Again, see your other bug. 125+k line is causing the slowness.\n. The difference is caused by the first script having the long line 'off screen' when opened, whereas this one has its long line at the top, so it will be added to the dom straight away (and the DOM is the bottleneck -- parsing is clever enough to just give up when a line is too huge).\n. If you can get this script to me in a way that doesn't involve me clicking around chinese-language sites that cause my browser to pop up security warnings, I'll gladly take a look at it.\n. The chinese page was linked from your other issue, I confused them (they sound like they describe the same problem). The script you linked contains a single-line minified jQuery. CodeMirror is known to be slow on huge lines, see https://github.com/marijnh/CodeMirror2/issues/37\n. Thanks, merged.\n. Thanks. Fixed now.\n. I don't have my Mac handy right now, and this isn't happening on Safari 5.0.5 Windows. I've marked this on my to-do list and will try to look into it next month, when I get home.\n. Sorry for taking forever on this! It was caused by a somewhat weird do-what-i-mean approach that Safari takes to programmatically set selections.\n. Question: Wouldn't a unique class (or optionally multiple classes if you also need a non-unique one for styling) do just as well? As I understand it, you'll register a handler that will look at the id of the event target, and do something based on that. Could also look at the class, no?\n. Okay, I'm closing this then. Sorry to be so picky, but it's important to try and keep the lib as small and simple as possible.\n. Hi Ebrahim,\nI'd like to work with you to support this better, but I currently don't have the time to really debug and fix it myself. I suggest you look at the charX and charFromX functions, if you didn't already, and figure out how to make them work for reversed text. If you have any specific questions, feel free to ask, either in this bug or by direct mail.\nBest,\nMarijn\n. Touching pageX is probably the wrong way to go. You don't want to invert the whole coordinate system, you just want to determine the X coordinates of characters in the editor differently. Hence, look at charX and charFromX instead.\n. Merging this into #294\n. Hi Alexey,\nFirst, I appreciate the pull request. But I'm trying to keep this editor as minimal and lightweight as possible, and since all these, except the word-wrapper, can be trivially done on top of the existing API, I think they have no place in the core editor. The word-wrapping is certainly useful -- if you could implement it as a separate file, I'd gladly put that in, for example lib/wordwrap.js. For example, you could assign CodeMirror.wordWrap to be a function taking an instance as the first argument (there is no 'plugin' system yet where you can add methods), and the range to wrap as the next arguments.\n. Which mode? Which tabMode? What happens? What did you expect to happen?\n. Actually, it sounds like you want tabMode: \"indent\".\n@ankit: CodeMirror 1 worked that way, and there was an endless stream of bug reports that 'tab doesn't work'. So I set the default to something that is easy to understand, and allow people to set it to something different if they want to.\n. Thanks for the code. However, it looks somewhat more invasive and inefficient than necessary. I've pushed an alternative at 78ba45078ea061959dcf3236e6d5753bbfce7f2f. Please see if that works for you.\n. Thanks for the patch. Do you have a use case to go with it?\n. No, not a unit test -- an example of a situation where you needed this.\n. Merged, with a revision that removes your comment ('git blame' can track down line authors) and updates the docs.\n. I've implemented a version where it only suppresses the cursor when readOnly is \"nocursor\" in ee6b56d9b0a160c452cb19f06ca5979a4fb232c5\n. This happens when the editor is taken out of the DOM or given a display: none. Patch 830cc331712d9789333072765611c109d374669d should fix thsi.\n. I'm not even going to look at this in this form. You reformatted stuff all over the place for no reason. Also, a single commit would work a lot better. Git isn't that hard to figure out.\n. I guess your IDE did something then. See e190ed562a749c59fc9c935d73c636bdd9d42a93 .\nAlso, I think I'd rather implement something that doesn't use eval to inject code in the CodeMirror scope, so that the distinction between public API and private API doesn't start blurring. I can add some things to the public API if this is necessary for plug-in writers.\n. There is a CoffeeScript mode now.\n. Missing modes are not considered issues to track here -- closing this to keep the issue list uncluttered.\n(To get an unsupported mode in, contribute the code or pay me to implement it.)\n. Solved by e0a142f277ff1232f4035a66c09b3de2e8da8ca9\n. This won't happen. Tabs are tabs, and if you want to convert them to spaces it is trivial to use some external code to do that.\n. Ah, I see what you mean now. This is not practical, unfortunately, until browsers allow reliable control over tab-size through CSS styling. To make cursor movement consistent, the tab size in the display has to match the tab size in the hidden textarea.\n. You're in luck: f9073700c6c4af9f85649d75849a5f7bb223d4b1\n. This was a problem with the highlighter concluding it was 'done' when it found an empty line, because the style of the empty line didn't change. Fixed in 33bfc07f06296da99697ada3a093b5e0138fca6f\n. Thanks! Merged.\n. Thanks! Merged (I squashed your commits together and added support for @\"\" strings).\n. Merged.\n. shift-page(up/down) has a well-defined meaning (select a page). Using your own handler to catch keys has other issues as well. If you use onKeyEvent to capture them before CodeMirror even looks at them, you can override whichever keys you want, and let CM do the right thing for those you don't handle.\n. http://codemirror.net/manual.html#option_onKeyEvent\n. Thanks. I squashed your commits together (and added a link from the index page) and merged them.\n. Fixed those. Let me know if you find more.\n. Why didn't you just define true/false as keywords though? Seems that's what they are, not numbers.\n. There's an 'atom' style class, that's probably more suitable for true/false (I think that's what the JS mode uses for them). How about adding a configuration parameter for things that are considered atoms to the c-like mode? 'null' in Java could also go in there.\n. Want to implement that?\n. Thanks, merged. Do rebase before your next pull req, though.\n. This is more along the lines of what I had in mind: https://github.com/marijnh/CodeMirror2/commit/ec27c15d452ad38cb5178eec531d0e9748900bb3\n. Fixed by 962ed7a63a19bcad7ccc69d79f8cfae7229178e8 . Seems like IE6/7 raises when getting the clientX of a mouse event that moved the mouse outside of the editor. This disables dragging-outside-the-editor-edge for full-browser-window editors on those browsers. Full old-IE support is not a priority for me anymore though -- as long as the basics work, it'll do.\n. This was already supposedly fixed a while back. So, first make sure you're using a recent version. If that doesn't help, please provide me with an example HTML page that shows the problem.\n. I think I fixed this in d08d7439b90b0a7089fe017f1c6a8b3c21475d58\n. I'm actually thinking of deprecating addWidget, as it adds very little and is much more problematic than just putting the widget outside of the editor (like demo/complete.html does). Can you try going that way and letting me know whether you encounter any problems?\nAs for jshint, it has different opinions about what JS code should look like than I do, so CM will probably never come up clean there.\n. On second thought, addWidget wasn't as flaky as I imagined. It won't update the widget position when lines are added/removed, but it will make the widget scroll with the editor content. So I'm not deprecating it, and I think I've fixed this bug in 37cfc8280017c0cd69d22a596120f19e22b7bcff (please verify).\n. I see the problem. However, your solution seems too intimately tied to your application to make much sense as a general API. I'm starting to lean towards deprecating again -- this method is breaking so many abstraction barriers that it'll probably never be solid. Have you tried just keeping your widget external to the editor? How does that work out?\n. Since 3f8f0ddaf160c4c3db16c02ea227164b8ff158f3 (which will be in the release I'm about to make), you can pass a fourth argument to addWidget to exercise some control over positioning. Passing \"fit\" should do pretty much what you described here. Please test!\n. Take a look at 1ba143f4414696988e74ce35b5c0e16559b8190e . I've renamed \"fit\" to \"near\", since that covers the current functionality better, and, hopefully, fixed the issues you saw.\n. Seems IE8's quirks mode leaves space for position:fixed elements. Worked around, along with some other IE8 context-menu issues, in 620f187930c3ef4718fa439cfbab65f178455a68\n. Putting 'var' there will mess up the parsing of the function on the next line, and thus have some effect on what is highlighted as a local variable. I don't think that's much of a bug, as things return to normal after you finish your new line.\n. > but can't the parser be altered in a way that doesn't do this. it seems simply excluding reserved words from being parsed as var declarations would solve this entirely. no?\nIt's not parsing the keyword as a var, it's missing the 'function'\nform because it occurs in a non-syntactic place.\n. Thanks. Slightly adjusted (you were referring to a theme you didn't include, and had an obsolete css file lying around) and merged at /f9073700c6c4af9f85649d75849a5f7bb223d4b1\n. Yes, it's possible (I should probably add a demo page for it). You simply load all the .js files for the modes you need, and then use .setOption(\"mode\", ...) on your editor instance.\n. Or, since you don't seem to be talking about changing modes in a running editor, simply pass \"mode\" options when creating the different editors, as described in the manual.\n. You can call setOption(\"mode\", something) at any time to change the mode of an editor instance, provided the mode you're using is loaded. An instance can only have a single mode at a time (not counting 'mixed' modes like htmlmixed).\n. Thanks! Merged.\n. > Thus, it is currently impossible to use parameters together with MIME types.\nThis is by design -- MIME types are intended to be specializations of regular 'named' modes. I originally did it this way because there were plans to have a common mode format shared with the ACE editor, and the proposed system used MIME types to identify modes. ACE has made no move to support this format, so it's not really a priority anymore for CodeMirror either.\nWhy do you want to use a MIME type here, not just a regular mode name?\n. The first problem seems odd -- if they can supply MIME types, not mode names, they also can't supply MIME types with funny CodeMirror-specific options embedded in them.\nThe second concern is valid though, but I think the solution is to define a new mode name. In case of the Python mode there's already \"python\", but say you wanted to handle multiple versions of C#, you'd use CodeMirror.defineMode instead of CodeMirror.defineMIME to define a C# mode, which just calls through to the \"clike\" mode, but passes a different set of keywords, say, depending on the version. Does that sound sane?\n. Instead of this...\nCodeMirror.defineMIME(\"text/x-csharp\", {\n    name: \"clike\",\n    keywords: words(\"...\"),\n    atoms: words(\"true false null\"),\n    hooks: {...}\n  }\nYou'd have something like:\nCodeMirror.defineMode(\"csharp\", function(config, parserConfig) {\n    return CodeMirror.getMode(config, {\n      name: \"clike\",\n      keywords: parserConfig.version == XXX ? words(\"set for one version\") : word(\"other version\"),\n      atoms: words(\"true false null\"),\n      hooks: {...}\n    });\n  }\n  CodeMirror.defineMIME(\"text/x-csharp\", \"csharp\");\nBut note that this only makes sense when you need to implement actual C#-specific configuration parameters.\n. All right. Closing this then, feel free to make changes like I described to c-like modes when it becomes necessary.\n. Thanks! Merged.\n. I can't think of anything. Try to make your use case more and more like the demo pages until you find out what triggers this. Then, if the problem isn't obvious, send me a minimal testcase.\n. Timing this out. Reopen if you see it again.\n. Thanks, merged.\n. Thanks! Merged, with a few small changes (most notably, wiring up the preview updates to onChange, to not waste too much cycles on unnecessary updates)\n. I expect (though I didn't test) that the demo itself works just fine in old IEs. The document included by default uses canvas, so that obviously won't show in such browsers, but if you replace it by <blink>HEY</blink>, you should see the preview.\n. Added an exception for this in f11e8843f34fca47039b95aa6dd80d7a011a8231\n. You could update historySize to have a different name (historyData or so) and also return the actual history data (in the internal format), and provide a similar setter function. The internal format ({start, added, old} objects) is probably okay for an external interface.\n. Closing this. A history is innately tied to the document that it is based off. Setting/getting histories is too fragile. Simply create multiple editors if you want to have multiple documents open at the same time (and hide/show them to cycle between documents).\n. This is getting clunky. Worked around in d433e702a5f2ebe393e8724eec3c6966fab80109\n. Use the text/x-php mime type as your mode spec, and you should get the behaviour you want. (You don't have to load the XML, JS, and CSS modes if you're doing that.)\n. There are no '4 space hard tabs', tabs are tabs, and browsers render them as 8 spaces wide. I'd like to have a setting to control tab width, but unfortunately browsers do not currently support this. Representing tabs with some other string is easy in the display, but very hard to do in the textarea (I could no longer leave cursor movement and editing entirely up to the browser), so I'm not really willing to go there.\n. Detecting automatic semicolon insertion is currently out of scope for the JS mode (contributions welcome). If you program in a semicolon-omitting style, try setting the enterMode option to \"keep\". You'll have to do a bit more work managing your own indentation, but at least CodeMirror won't constantly wrongly indent for you.\n. That is correct. (And too bad.) Limiting look-ahead to a single line has lots of nice properties (and is okay for 95% of languages), but for markdown, it's decidedly problematic. You could still have a decent Markdown mode, highlighting the header itself as a regular paragraph and giving the underline some styling to make it stand out, but yes, styling the header text itself would be nice.\n. Looks good. Markdown is a bit of a hairball to parse, so there's probably corner cases left to handle, but it seems solid. Do you want me to add it to the distribution? If so, do you want to include your own LICENSE file, or shall I put it under mine?\n. Thanks! Integrated.\n. Could you create a minimal, simple HTML page that shows the problem? I can't reproduce this by adding a long line to the XML mode demo.\n. Fixed by 454df5d964cb9b7116ad24e866e2a2e550b1231f\n. Thanks! Pulled in as 454df5d964cb9b7116ad24e866e2a2e550b1231f\n. Could you be more specific on what 'not repeating reliably at all' means? Holding an up/down arrow seems to work for me. \nCould it be that you're on a slower-than-usual computer? Maybe I'm setting a timeout too short.\n. Very odd, especially since it seems to happen on all browsers for you. Could it be that you have key repeat speed set very low somehow? What happens if you change the '80' in function fastPoll (on line 565 of the current git version) to, say, 200?\nAlso, are you seeing any script errors?\n. Hm. I am out of ideas on what might cause this, and not able to reproduce it (I'm running Ubuntu myself, but never saw the issue). If you happen to figure out which setting/program/hardware causes this, do let me know.\n. This is almost certainly a symptom of the old cursor handling kludge. The kludge is gone in current HEAD.\n. This is a different manifestation of issue #144 (key polling somehow not working well)\n. Fixed by 54a37ba6e65209ec3293619c3dfc62425ff7c1e5\n. The problem appears to be your absolutely positioned body in combination with some webkit scrolling bug (the textarea is still positioned correctly, and is being scrolled out of view by webkit). This is a rather pathological case, and I don't have time to look into this further at the moment.\n. Pulled. And revised somewhat in 69953ceffa6852466e77865d1470014c66a94a41 to be more lightweight.\n. The best way to change the font is to set a font-family/font-size in the .CodeMirror class, that will ensure the whole editor is using the same font. I've updated the manual to be clearer about this.\n. [Just commenting on 69f9fb9de4b7cbb17bf96ccf70ae31f2aa982f21 for now, haven't read the other patch yet.]\nI like the clearAll* methods. I'm not so happy about your approach to error checking. I see how there is a hole in the functionality provided by the current CodeMirror core, but I don't think this solution is general enough -- you just get line numbers, not error messages, so you have to do a bunch of extra magic if you want messages.\nWould an approach where a parser can emit an error by returning a {style: \"error\", message: \"some string\"} object instead of just \"error\" work for you? The messages can then be saved in the lines, and we could have a method to pull them out, with associated line/char information. This way you don't have to re-parse the whole buffer every time an error gets added or deleted.\n. Hey. You may be wondering why this was left unanswered for so long. There are two reasons. First, I'm an unorganized slob. Second, your mode seems to be unfinished, and doesn't handle HTML anymore. Thus, it is not viable to simply merge it into the main repository. If you polish it up further, and move it into a new mode/ subdirectory, I'll gladly take a closer look.\n. Thanks for investigating this deeply. I can't reproduce the issue, though. Does it happen on all browsers? Could you be a bit more specific with the reproduction instructions? (Which < do I type over? How do I select ' results in different tabSize: First tab is replaced by 2 spaces and so seems correct\nWhen you press enter, two spaces are added (one indentUnit) because\nyour enterMode is 'indent'. When you press tab, at any time, a tab\ncharacter will be inserted. These are always 8 spaces wide (or up to\nthe next tab stop), because that's how browsers display tabs.\n. Hi Steve,\nThanks! Do you want to put your own license on it, or can I just put it under my license? Also, any chance you can clean it up a bit more? For example, the multiLineString stuff is useless here if Velocity strings don't span lines, and the keywords don't have to be configurable through a parserConfig since this is a single language (the same goes for PL/SQL mode, which is a bit of a mess in itself). In fact, you can get rid of the whole parserConfig thing and move all that stuff into the parser proper.\nBest,\nMarijn\n. Great! I've cleaned up a few more things (you were using global state in the type and inParams variables in an unsafe way) and merged it in. Please verify that it still works as intended: http://codemirror.net/mode/velocity/\n. You are working from my modified version, right? That one's already pretty clean (just indentation is missing, but that's tricky for templating languages)\n. Triple-quoted strings seem to be working mostly by accident at the moment -- they are interpreted as three single-quoted strings in a row.\n. Right, it does.\n. No. Browsers are hard-coded to display tabs with width 8, and until CSS support for changing this becomes widespread, CodeMirror can't change tab size.\n. This has been supported since 2.2. See http://codemirror.net/doc/manual.html#option_tabSize\n. Looks much better! Coloring start tags red when the end tag is missing won't work in the CodeMirror framework (you can base styles only on what came before the token). Do you want me to pull this into the distribution in this state, or are you still fixing bugs? I noticed it doesn't recognize processing instructions (<?foo ?>), and the un-indenting of lines with closing tags seems like an annoying bug.\n. Integrated ( https://github.com/marijnh/CodeMirror2/commit/9118309a92c0aae3728fb62590438545e4c038d9 ). Next step: Validating arbitrary schemas ;)\n. Thanks! Integrated it and cleaned up the code a bit.\n. Oh, that was not a direct reply to you, that was the commit message of the patch that fixed this problem. If you download the developer snapshot, it shouldn't occur anymore.\n. Thanks for including the solution in the bug report! I've fixed it in a slightly more idiomatic way in df0cc5c834e94392516a0a7f5322a16d706d0caf\n. Thanks! I've squashed the four commits together and added them to the main repository.\n. Such an onLoad event isn't necessary -- when the CodeMirror constructor returns, all nodes have been created.\nInstead of selecting this node by class, can't you just call getScrollerElement and take it's first child?\n. I think what you probably should do is fix the length of the scroller element somehow (either by setting it to 100% or by setting it to some precise width). That will prevent it from resizing to fit its contents.\n. Thanks! Integrated.\n. Thanks! Integrated. Try to rebase your branch to mine first next time, and to put everything in a single commit.\n. Looks good. Two issues -- the indentation() method compensates for tabs, and doesn't simply return the amount of space characters at the start of the line (i.e., for \"\\tfoo\" it'd return 8), so you need a different way to test for the cursor sitting at the start of the line. Secondly, I'd make this a separate option, say unindentOnBackspace, not tie it into the (already hard to understand) tabMode option.\n. The whole editor is built on the assumption that lines are all the same height. You'll have to implement some (super-efficient) mapping from lines to y coordinates in order to be able to show the right part of the document based on scrolling (and to be able to go from mouse position to text position, etc).\n. I'll probably eventually implement this, since it's also needed for line-wrapping. I've been trying to get people to sponsor this effort, since it's a lot of work, without luck so far.\n. Current status: line wrapping is done, but still assumes text has a uniform height. The way to implement non-uniform height is clear, but A) the way the gutter is rendered will have to be completely overhauled to support this, and B) I expect there'll be a bunch of issues with rounding errors when implementing this.\n. This is implemented in the v3 branch now.\n. Did you load the python mode (/mode/python/python.js)?\n. It seems the Python mode was using the wrong method for getting at its configuration. That accidentally worked when running inside the editor, but not in runMode. I've pushed a fix for that. However, the error message I got was different than the one you're showing. If I simply modify demo/runmode.html to load ../mode/python/python.js instead of ../mode/xml/xml.js, and pass 'python' instead of 'application/xml', things work for me.\n. Hi Hans,\nWonderful! Do you want me to put it under my license, or would you\nprefer to provide your own LICENSE file (preferably using a license\ncompatible with the BSD license)?\nBest,\nMarijn\nOn Sun, Sep 4, 2011 at 9:23 PM, hans\nreply@reply.github.com\nwrote:\n\nHello,\nI created a Clojure mode using the existing Scheme mode and the Emacs clojure-mode script. I hope it's useful to others.\nThanks for making such a great tool!\n\u2014 Hans\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/178\n. Merged! (I squashed the commits together, so there's only one left).\n. Wonderful! Integrated.\n. Wonderful! Integrated.\n. Are you sure the bug exists in CodeMirror 2? I couldn't reproduce it.\n. Are you sure the bug exists in CodeMirror 2? I couldn't reproduce it.\n. Ah, I see it now. Merged.\n. Not cleanly (yet). This is related to line wrapping. It's clear how it should be implemented, but I don't have the time to actually implement it.\n. See 3bb871ce5535ebe7cf0108f8e157b818cd48c281 and http://codemirror.net/demo/folding.html . Needs testing.\n. Thank you! Merged.\n. Any chance you can use the already-defined classes from the existing themes, rather than defining new ones? It doesn't matter much which (though of course if the classes match the elements they are applied to to a certain degree, that'll help people understand what goes on). If you don't like the colours in the exiting themes, you can supply a new theme that applies your preferred colors to the classes you chose.\n\nAlso, if you want to keep this under your own license, add a LICENSE file -- otherwise it'll simply fall under mine.\n. I've integrated a simplified version of your code. If you want to restore the autocompletion, please submit another pull request.\n. http://codemirror.net/manual.html#setCursor\n. http://codemirror.net/manual.html#markText\n. Thanks, merged. Next time, try to put unrelated changes in different commits, so I don't have to tease them apart myself.\n. Oh, I somehow failed to notice you updated it (github doesn't seem to send an e-mail for that). Integrated.\n. I also failed to reproduce this. Since FF 3.5 is ancient, and the failure doesn't render the editor entirely unusable, I'm going to leave this as it is for now.\n. This is definitely gone in the current master branch, now that the old cursor handling is gone.\n. Thanks! Integrated.\n. Fixed in bc830247e28e0572767bf1af25c93e261d10bb9a\n. Did you accidentally upgrade to chrome 15? (I didn't change anything that was intended to fix this. Tried to reproduce, but couldn't.)\n. I can reproduce this neither in 2.15 nor in the latest version. Closing.\n. Nice! I'll gladly include this in the distribution. Let me know when you feel it's finished. Also, if you want to include it under your own license, add a LICENSE file to the repository.\n. See 9e069dac23aba66b582d66b020bfab38c42fd0d6 . Such syntax is definitely bogus, so it should be highlighted as an error. With this patch, just the quoted value is colored red, and the parser continues properly after it.\n. Integrated. Though I would have preferred if you'd try to re-use as many of the 'standard' styles defined in the existing themes as possible, to make it easier to apply themes to the mode.\n. CodeMirror doesn't internally track character offsets, it treats the document simply as an array of lines. So you'll have to convert (which may be slow on big documents).\n. Nope. But a tight loop that uses .indexOf to find all newlines before a given position should be relatively fast (unless we're talking really big strings).\n. Hi Marco,\nI think this is best done as a piece of add-on code, not in core CodeMirror. Hook into onKeyEvent, and call the indentLine method when detecting a cmd-[ / ]. There's any number of keybindings that people are used to, and supporting them all in the core would bloat it. (I am hoping to, eventually, move to a system where keybinding sets are first-class things, and the editor comes with a bunch of different ones. This will take time, though.)\nBest,\nMarijn\n. I've integrated this, though I still have my reservations. If you're calling this, you're probably first fetching the content of the editor with getValue, then processing the whole string that returns, and then moving back to {line, ch} coordinates. This is perfectly okay for small documents but will be quite slow for bigger ones.\n. You can just loop over the lines after initializing your editor and indent them through indentLine -- seems that something that's four lines of code to emulate shouldn't be a built-in option.\n. It's only one, in fact:\nfor (var i = 0, e = editor.lineCount(); i < e; ++i) editor.indentLine(i);\n. Ah, sorry, I wanted to tell you -- as I tried out the code I gave you\nI noticed this bug. I pushed a fix to the repository earlier today. If\nyou get the dev snapshot, the problem should be gone.\n. Hi Alexander,\nNo mistakes jump out, but I must say that I don't really have time to go over this very closely.\nBest,\nMarijn\n. > what type is lineHandle?\nThese are opaque objects, you're not supposed to do anything with them\nexcept pass them back to lineInfo, setLineClass, addGutterMarker, or\nremoveGutterMarker.\n. Sorry, used the internal names. I meant setMarker and clearMarker.\nAlso note that the mentioned functions accept both an integer and a\nline handle, so you can't simply specify them to only take line\nhandles.\n. Thanks. Integrated.\n. Missing modes are not considered issues to track here -- closing this to keep the issue list uncluttered.\n(To get an unsupported mode in, contribute the code or pay me to implement it.)\n. I am not seeing this in IE8.0.6001.18702 -- in the full-screen demo, the selected text always corresponds to the mouse position.\n. The reason for the multiple = true is that older browsers always display non-multiple select inputs as a single line, even when size is set to something >1.\nIf you want to provide more details on the 'too few entries' thing, please open a different bug for it.\n. Hi,\nCould you try whether the patch I just added (5af5292b865384d8dd47b6a5b65d6f629130ccd0) helps on Gecko? Polling is quite expensive, so I'd like to go to any length to avoid it (see also 1, if you haven't already). For Opera, it does look like polling is our only option. Would modifying fastPoll to not give up after a single miss but try a few times, at least on Opera, not be a less invasive way to get what we want here?\nBest,\nMarijn\n. Update: It seems recent Opera versions also fire an 'input' event, at least for normal input. (What would it take to enable IME, for testing, on my own machine?) Also, browsers seem to fire specific keycodes when starting an IME (see 1), if the input event thing doesn't work out, maybe we could rely on that and only poll when such a code is fired.\n. (I'll look into this more closely soon. Very busy right now.)\n. Hey,\nThanks for the great explanation and tables. The patch still seems a bit more complex than necessary. How about doing something like this:\n- Make the 2000 in slowPoll a variable (in CodeMirror constructor scope)\n- In onKeyDown, when options.pollForIME is true and the event looks like it might be an IME event (use the keycode when possible, otherwise just assume it is so), set this variable to something smaller (say 200).\n- When an 'input' event is seen or no change has been detected for X (say, 5) seconds, reset the poll delay variable to 2000 to make sure we're not wasting browser resources for no reason.\nThis way, we don't have two separate poll timers running at the same time, which seems needlessly confusing.\n. Actually, 200 is probably way too much for the polling time. Try 50.\n. I've commented on the gist.\n. I hate to resist this patch even further -- I really appreciate the effort you're putting into this -- but the code, as it stands, is extremely unattractive from the perspective of someone who has to maintain it. The (repeated) combinations of platform and browser tests make it very hard to see what's going on, and why. Could you maybe factor them into one or more predicates (or constants, since I guess the ones that don't depend on key codes don't change at run-time), with descriptive names, so that the code is at least a little self-documenting?\n. Thanks! There's a simplified patch (plus comment) at\nhttps://gist.github.com/40f25a78a304d819c5c8 .\n. Integrated in 0fd987a3c9ef290c227e41e680f487053d649e3a .\n. If you have time, could you also take a look at the branch at https://github.com/marijnh/CodeMirror2/tree/keymap ? I am in the process of reorganizing the input handling in a way that will make polling much cheaper (so we could potentially just make the default poll interval smaller), but it involves resetting the textarea on every change, and I'm unsure how that will work with IME.\n. Actually, never mind. I've finally installed a Chinese locale & IME driver myself, and can now test this stuff on my own. (Also, my revision does break IME. Working on a fix.)\n. Hey,\nI can't reproduce the problem you are seeing, unfortunately. Does it\nstill happen in the current version (available at\nhttp://codemirror.net/keymap/)? And does it also occur when you type\nwith IME disabled? Also, which input method, precisely, are you using?\nI installed 'Chinese - Pinyin', but it gives me a different character\nwhen I hold A (sorry, I know very little about Chinese).\nBest,\nMarijn\n. Thanks, I'll install a Japanese locale and try to reproduce again.\n. Still no luck reproducing this on Chrome, and Firefox doesn't seem to\nwork well with ibus, which is the ime daemon I'm using. Which browser\ndid you observe the problem in?\n. Hi Volker,\nI've modified the commit slightly to pass the numbers as separate arguments instead of an object. I can see people using runMode in situations where performance is relevant, so I'd rather not allocate an extra object for every token\u2014especially since passing them separately is hardly less practical.\nSee https://github.com/marijnh/CodeMirror2/commit/640016a1850e9a55d4e9e43f66db352ae27bd23e\nBest,\nMarijn\n. I've improved the error message a bit, but couldn't find a workaround (except for removing the nodes that I use innerHTML on from the document and then putting them back every single time, which is very expensive).\n. This is implemented in the keymap branch, and will land on master after a bit more testing.\n. Thanks, integrated. Next time, try to rebase first so that your tree is a continuation of mine (and then force-push to update your github repository, or push into a new branch).\n. I don't implement language modes unless I need them myself, or someone pays me to. However, it should not be too hard for someone else to implement something like ERB as a CodeMirror mode.\n. The brokenness seems to only occur in Webkit. Removing the draggable=true from the divs makes webkit cycle properly through the elements, but it gets confused again as soon as it causes a scroll event to happen in the editor (which triggers an update to the DOM to make sure the scrolled-to elements are available). This seems to be a browser bug, more than a CodeMirror bug.\nOn the other hand, CodeMirror will never, even in browsers with better search implementations, be fully searchable through the browser, because it doesn't generate DOM nodes for the whole edited document, so the browser doesn't know about all the text that's available.\n. Keeping a textarea with the full text is even more expensive than just rendering the full text to the DOM, not to mention that the synchronizing would be a nightmare.\n. See also issue #232 . Combined with a hack that turns off draggable in Webkit and only turns it on when a mousedown event is seen, this will probably improve the situation.\n. This is now fixed as far as it can be fixed without moving to a completely different architecture. Documents with more than 100 lines will still cause browsers to miss matches in some cases, as the document won't be wholly rendered.\n. I'd rather leave this to the user. It's a pretty easy problem to diagnose, and people might be writing Markdown text, for example, from right to left.\n. Thank you. Integrated.\n. Integrated.\nThe styling for find vs findSequence is intentional--one is a global var, the other a local, which the JS mode treats differently.\nThe underline problem probably has to do with the line in codemirror.css that sets the line-height to 1em, leaving no room for underlines. I am not sure whether this is still necessary, but I seem to remember some browsers made the lines really far apart when I removed it.\n. This is partially implemented in the keymap branch -- you can check it out and look at demo/visibletabs.html. Unfortunately, the chances for showing carriage returns (I assume that's what you mean by newlines) are slim. CodeMirror 'normalizes' the document to be newline-only, and strips out carriage returns.\n. If someone writes a decent RPM-style mode, I'll definitely include it. (I don't, myself, write modes for things I don't use unless someone pays me to.)\nAlso, the demo I mentioned can be viewed at http://codemirror.net/keymap/demo/visibletabs.html\n. Thank you. Merged.\n. Thanks! But you had a bug (you can't take the text property of a string). Fixed and integrated.\n. You'll need more styling than this to get a good-looking effect. I've added a file lib/util/simple-hint.css that contains the needed styles (and renamed the class to CodeMirror-completions to prevent collision).\n. Done in 30294ec2e5c207e484613b240cf08a0b8348bcd7\n. I've changed it to not complete on space, since that wasn't working properly anyway. But I can not reproduce the other issue you describe. It could be an error in your completion-gathering function (recent Chrome versions eat errors thrown inside CodeMirror operations for some reason that has something to do with the use of finally).\n. Thanks. Merged!\n. Thanks, integrated.\n. I've changed this slightly to conform to the general coding and indentation style of the rest of the file. Merged at 2ae0e6ce4160a1ea650605574e671473eded2391 -- let me know if you spot something I broke.\n. Thanks, merged.\n. Thanks! Merged. Might want to rebase your branch before sending a pull req next time, to make it easier for me to pick out the new patches.\n. This seems to happen with every new Opera version. I'm hoping they'll get their act together before they actually release this.\n. I'll leave this open, to remind myself to double-check when Opera does its release.\n. Is there any way to actually track Opera bugs? Last time I reported one (a year and a half ago, I think), I never heard anything back.\n. Thanks. Integrated. I moved the modes under an rpm/ subdir, so that they don't clutter up the mode directory too much.\nAlso, we're trying to get rid of per-mode custom css files to make theming easier, so it's possible that someone will shuffle things around to make the spec mode use standard style words soon (more styles will be added).\n. Is this based on the other Markdown mode? If so, any chance you can make this extend that, rather than adding a full new mode? (For example, by defining a hook, the way the c-like mode does, that individual code configurations can hook into, and using that to add the Github-style things.)\n. Ah, I see what you did now. Very clean. Integrated.\n. Is there a reason you're not just keeping your editor instance around, hiding it and creating a new one for the other document?\nSetting the history is inherently unsafe -- it only works when the document is exactly the way it was when the history was taken. Given that, you might as well keep the whole editor if you want to save its state.\n. Understood. Let me know if you run into problems with the editor-swapping trick.\n. (Making contentEditable the default on Desktop might help here, since we'll be using a real selection then and thus giving the browser the possibility to execut its default selection behavior. Haven't tested yet, though.)\n. This is already fixed in the keymap branch (c85b881eab071de4179a1d331bcf00c4632d9b85), which will soon be merged into master.\n. I pushed a slightly simpler variant, which also handles let, at 7db287b11adffa2749d84b638c6475bfe943a6ec\n. Thanks! Merged.\n. Thank you! Integrated. I went a bit further with commit dbe615530d0d71d2cdb30119c3515619291b6be2 , also moving the rst mode over to this, and moving default.css into codemirror.css, so that there are less extra CSS files lying around.\n. As this doesn't happen in the demos included in the distribution, it must be something in your set-up. I can't debug from a video, so you'll have to try and reduce your page down to the minimal thing that produces the bug, and then send me the html so that I can look at it.\n. Thanks for letting me know! Fixed in 98a70279e74fa6aa771a048a02be818a8a36fdf2\n. What happens is that both the insertion of the newline and the indentation of the new line are counted as separate changes, and the second one overwrote the first in the change object. I've pushed a patch that makes change objects chain together when more than one thing happened in a single operation.\n. I've pushed two patches, 65e835d88b839a15ec6ad710a03e5f6916af0c96 and faa65d74fc23055a33cc9a755bde708b56d9a4b4 , that should help make this behave less weirdly.\n. Nice, but it removes indent support. Any chance you can preserve that?\n. I can't reproduce the outdent problem you're seeing. You could try increasing the timeout delay in the onKeyPress function in codemirror.js -- it is possible that on some platforms that ends up happening before the actual key was interpreted\n. Okay, I've made it 75 in the repository now.\n. Thank you! Integrated as d61699516edd353c8ce4e6d73fba026070e107e5 and f2a654f40e113d8cc57e2769be36b304d97810bd\n. Thanks, merged (and squashed into a single commit). Try to rebase first, next time, so that only relevant commits show up. (Or just reset to the current HEAD to be in sync again.)\n. Good point. Fixed in 7791cfde3ad2ed853bf4b24f73aafbc8ac444b7c\n. If it ends up as a small modification to moveH, I'd welcome such a patch in the core. It it ends up as a lot of code, I'd prefer it as a lib/util/ script that assigns to CodeMirror.commands.\n. That was a bad redirect in my apache config. Fixed now.\n. Actually, this is handled very cleverly in keymap/vim.js 1 , and it turns out it doesn't apply to all keybindings, so this is probably best left out of core.\n. getCursor() returns the 'head' of the selection. getCursor(true)\nreturns the start, and getCursor(false) returns the end. So I guess\ngetCursor(false) is what you want here.\n. Neat! Could you review e127f47af30cc7fb755f9615bcc4544860f597eb for me? I changed it to use countTimes for cursor movement as well, since that makes it much easier and less verbose to define more keys, but maybe you had a reason to not do that.\n. I forgot to answer your questions!\n\nOne question I have: Is there a way to map keybindings based on the character that was typed rather than the key that was pressed?\n\nThis is tricky, because browser events don't really help there -- in keypress handlers, you have the character, but don't (in a lot of browsers) have reliable key-identifying information. In keydown, it's the other way around. An extension could be made where a keymap has a sub-map (under some property) that's keyed on character codes rather than key identifiers, and the keypress handler could check that before it lets keys through to the textarea. It'll be a little shaky, since you risk keys being handled twice by Opera (which still fires onkeypress when onkeydown was stopped), but that might not be an issue.\n\nHaving a block cursor for the Vim mode would be great, too. It looks like the themes just set the border-left style for the cursor, so would all the themes have to be updated with block cursor styling in order for this to work?\n\nI guess that is an issue -- we could make the themes define both a block cursor and a flat cursor, and have keymaps switch the class on the wrapper div if they want to switch cursor style.\n. Very nice. Merged.\n. I like the non-invasive goColumn implementation. Merged.\n. Can you give an example of code that is currently highlighted wrong? (Just trying to figure out what you're fixing here.)\n. Makes sense. Merged.\n. Are you sure you're pressing ctrl-x first? Works for me now.\n. Sorry, it really does work for me.\n. I managed to reproduce this on windows. It seems tied to the way alert is handled when called from an event handler. If you change the alert to something that's not opening modal dialog (console.log, for example), the problem goes away. So I'd say this is a non-issue in production. I've pushed a patch to remove the alert call.\n. Fixed in 8ba4128addf0b94603da7b218386c83f38a985a0\n. Ctrl-Z isn't bound to undo in the emacs bindings. Try Ctrl-/.\nI added code to bind Ctrl-Z and Cmd-Z to undo in the emacs mode, since letting them through to the textarea is causing this confusing behaviour.\n. Did this problem not occur in previous releases?\n. I'm seeing this, or something similar, happen in older versions as well, but for me it looks different -- the cursor is centered around the text rather than hanging only below it. Which browser did you test with? Have you tried messing with the .CodeMirror-cursor style to compensate for this behaviour?\n. This is pretty much how the editor works now. Closing.\n. I doubt it worked. Seems Opera (at least Opera Next) does not support the draggable attribute at all.\n. No. I will not click a link in the hope of finding out what went wrong for you. If you don't describe the problem you're having in detail, and make some effort to isolate it, I will not look into it.\n. The best approach is usually to start with the broken set-up and remove elements one by one until it stops being broken. Your own CSS and scripts are the prime subject, but the HTML surrounding the editor might also be involved. (Also, make sure this is not simply an issue of failing to call refresh() when unhiding -- see the documentation for that method in the manual).\n. Try changing codemirror.js to add a height: 1px to the to textarea near line 25, that might solve the problem. If it works, let me know, and I'll update the distribution to do this.\n. Since these motions are unlikely to be used by anything except the VIM bindings, I'd prefer if you implemented them in vim.js, so that codemirror.js doesn't grow in size.\n. That sounds sane. Please write it in such a way that the option can also be set to a regexp, for more precise cusomization.\n. I meant matching those regexpses against single chars, just like the code does now.\n. Right, those are fine for now. Good call on allowing an array of regexps. There's a thread on the google group right now about double-click-on-word not understanding non-ascii word characters. That'll come up here as well, but don't worry about it for now, I'll see if I can fix it later.\n. 've merged your patch. See 1 for a solution to the shift/selection issue.\n. If the images you're using to replace the spans aren't precisely the same size, you'll get cursor placement problems. If they are exactly the same size, why not use CSS to re-style the spans? (color: transparent; background: ...)\n. Try with 3b89f13a7897b79bdd92f98e5e4b0387016bbfb3 , which adds an onUpdate option that will get called whenever the display DOM is changed. Please let me know whether that solves your issue.\n. Woops. Looks like Chrome defines a global event for IE compatibility. I've fixed both bugs in the repository now.\n. I'll need some more background to be able to debug this. Which browser, for a start? And can you give me an XHTML document that triggers this?\n. Okay, no problem. Do report back if you ever find a reproduceable test case.\n. You appear to have broken delWordRight/delWordLeft. I'd prefer to keep support for \"word\" as a movement unit, and simply make findPosH map that to options.wordChars.\nWhy did you add a position parameter to findPosH? Doesn't the dir already imply this?\n. I think that's starting to make findPosH positively incomprehensible. How about, since this is so specific that probably only VIM users need it (Emacs moves to start-of-unit when moving back, end when forward), we keep it in vim.js? Since I'm starting to feel bad about nit-picking your pull requests all the time, I took a first stab at an implementat in f01ee93f0bd2cf82d3a3ff6f9589da72a9621986 . Please take a look.\n. If you're using the latest git version, see http://codemirror.net/doc/upgrade_v2.2.html , otherwise, lookup tabMode in the manual.html that came in the .zip file.\n. Thanks for the report. Fixed in c75344a8da55ba2cde3d4c790e6dd99b73093df2\n. Your issue sounds like the editor was loaded before the relevant stylesheets were ready. Could that be?\nWe stopped supporting quirksmode a few month back, so I am going to close this issue.\n. Thank you. Looks good. Merged!\n. If you call .find() on the returned handle, can't you just compute the distance between the start and end that's returned?\n. Right, if you want the string. Anyway, I think this is a relatively rare use-case, and something that can be done easily in user code, so I'm closing this.\n. Thanks. Merged.\n. f4e3e81d92c72eedb913e3fe1f9628ae645a1434 add a var\n. Good one. I didn't even notice the different capitalization. Merged.\n. You're creating more and more instances of CodeMirror. Clean up the old one when you add a new one, or simply use setValue to set the content, rather than creating a new one every time.\n. Height auto doesn't mean 100%. I'm unsure what you're trying to do.\n. Please use jsbin.com or similar to provide a demo of the problem.\n. It works better if you move the  that sets the height to before\nthe script that initializes CodeMirror (or initialize after onload).\nThe way you have it now, CodeMirror is created before the style\ninformation is available, so obviously it can't take it into account.\n. Ouch. It seems there is a <em>lot</em> of code in CodeMirror that assumes characters go left-to-right. I'll think about this some more, but it looks like it'll require some serious re-thinking to support RTL text.\n. That problem with Cyrillic text was fixed last week. The demos on the website should already handle that properly.\n. None. There probably won't be unless someone else works on it.\n. - Measuring of character positions could no longer assume that text goes left-to-right\n  - This would complicate the binary search used in <code>coordsChar</code>\n- Partial line selections would no longer be contiguous blocks -- the code that draws them has to be aware of direction inversions in the line, and somehow split it up into smaller blocks when necessary\n- Same goes for marked text ranges\n- I don't have enough experience with rtl text to know for sure, but won't the editor also have to be clever about 'patching up' the inverting marks when pieces of text are cut/removed (so that deleting the end of an rtl section doesn't cause the rest of the document to become rtl)?\n- I'm sure there's more...\n. I had a very interesting conversation with @jviereck about this a few weeks ago. The conclusion was that this is probably not as insanely hard to do as I thought it to be. Here's the takeaway as I remember it:\n- Browser will do the right thing when rendering RTL text. Since we're just presenting lines as chunks of HTML, the display should work out of the box.\n- There's some code in <a href=\"https://github.com/mozilla/pdf.js\">pdf.js</a> that can detect ranges of RTL text in a string.\n- It'd be possible to, when such text is found, store a data structure of the inversion points in the string.\n- This data structure can be used when doing the coordinate-to-character mapping to perform the binary search in a slightly different order (i.e. map the characters in the string to their actual display order).\n- Similarly, when drawing the selection for a partially-selected line, this data can be used by some slightly more complicated logic to draw all the pieces in the right place, rather than assuming that a single rectangle is always sufficient when drawing the selection for a line.\n. TODO: add lots of tests, do manual testing, somehow figure out a sane way to handle the combining characters found in Hebrew text\n. Done since v2.2\n. Check your <code>tabWidth</code> and <code>indentUnit</code> options. This works for me.\n. Are there any errors in the console when this happens? Does it happen in all browsers? Does it still happen with the current development version (or 2.2, which I'm about to release)?\n. I've found the cause of the issue you reported in you last message. I can't figure out what the earlier problem was (or how resetting <code>cachedHeightFor</code> could possible fix it), though.\n. I think 4446f7b0817f344dddf5142799a4bd1438c3a9ae might fix this. Could you try again with the dev snapshot?\n. Great. Closing.\n. Thanks. Applied.\n. Yes, I was only bumping that version number on release. Since that seems to have been way too confusing, I'm moving to a scheme where the release script adds the number, and the file in the git repository doesn't get numbered.\n. Implemented by pull request #625\n. Please try again with the development snapshot, and let me know if the problem persists.\n. This is by design. Changes that happen within a certain timespan of each other at the same place are combined into a single undo event. Otherwise, you'd also have to undo other typing character-by-character.</p>\n<p>As for the second question, read the docs. In particular http://codemirror.net/doc/upgrade_v2.2.html\n. I went some ways towards implementing this, but found out that many browsers do not generate keypress events at all when ctrl or alt are held down. So it appears that there is no reliable way to detect any ctrl/alt + character combinations, making this feature impossible to implement. Closing the issue.\n. Yeah. A system where a quoted character, such as '$', without Ctrl or Alt prefixes can be used as a keymap key would be good. It'll trip people up when they try \"Alt-'$'\", but it's better than nothing.\n. Thanks! Integrated. http://codemirror.net/mode/less/\n. This is done in v3.\n. Not currently. Might be a useful feature, though.\n. Would simply having an option <code>noSmartIndent</code> to turn off 'smart' indentation and use the indentation of the previous line when indenting solve your problem?\n. The solution outlined in http://groups.google.com/group/codemirror/browse_thread/thread/8fac913c193ac698 would help for this. If no one steps up to implement it, I'll probably get around to it myself in a month or so.\n. Thanks for the detailed report! This turned out to be a very dumb coding mistake (initializing a variable outside of a loop, causing the update code to update only the first mark). Seems to be fixed now.\n. Thanks! Integrated.\n. Thanks! Looks good. I adjusted the mime type (<code>text/plain</code> is too general, and already used for a no-op mode), and pushed it to the repository.\n. Should be better now.\n. The demo page was based off the old demo pages. I recently search-replaced out all the '2's, since CM1 isn't really relevant anymore anyway. I've removed the 2s in the MySQL page too now.\n. It will start highlighting again when you move the cursor. I consider that acceptable behaviour.\n. Have you tried the 'search' function in your text editor? I do have other things to do.\n. This is demo code. You're welcome to extend it, of course, but I don't have time to work on random feature requests.\n. Load the JavaScript mode, and use <code>mode: \"application/json\"</code>.\n. Going to close this. A pull request for 100% correct handling of slashes in Ruby would be welcome, but not something I am going to work on.\n. Merged. Please reset your repository to mine before doing further pull reqs, or rebase in advance.\n. This supposedly landed in c1a6d70f3466cbd2d33be97a533591dae1cbdbda . Please take a look -- I don't know enough about vim to even know what text objects are, so I can't vouch for it.\n. There was apparently a problem with that patch, which should be fixed by a pull request I just merged. Try again...\n. In keymaps, \"W\" refers to 'the key labeled with W'. To refer to an actual character, rather than a key, quote it -- \"'W'\" matches 'a capital W being typed', whereas \"'w'\" matches 'a lowercase W being typed'.</p>\n<p>Or maybe I didn't understand the problem at all? I'm not sure. If I missed the point, explain it in more detail.\n. See http://codemirror.net/doc/manual.html#keymaps for more details.</p>\n<p>Can I close this bug?\n. Thanks, I've merged your patch.</p>\n<p>@pickhardt Want to take a look at the remaining issues?\n. Great. I've merged your second patch as well.\n. Thanks! Merged.\n. Thank you! Integrated.\n. Thanks. Integrated.\n. The old code actually looks perfectly fine. It should just have a clause added for copying over the mode prop. Done in 10444abbec7cf119859025a51e166c8d7d43337a\n. Interesting. Where are you injecting this information? Have you considered writing a mode that (minimally) wraps the PHP one? That'd give more control. I expect.\n. This is interesting! I'll have to do a deeper review before I merge it, though, which I won't get to until next week.\n. Merged, with a rather invasive set of revisions made in 21d8d394f332a1ac87f9ecb9ee6f97be11466f7a . Please test!\n. Pushed some things that seem to fix these in 6a00b5c67aefa9e3315d20e3627f1e2fec8fff64\n. Pushed two more patches that (seem to) address the drag-select and theme-change issues.\n. That is mostly by design, and worked the same before this change -- bounds of the selection can not sit in hidden lines. Though it did behave in a kind of surprising way by putting the cursor somewhere in the middle of the line after the hidden block, rather than at the start. I've pushed a patch to fix that.\n. You say 'bounces around' -- does it move more than a single pixel for you?</p>\n<p>This seems hard to work around. I initially set a width on the selection DIVs, which would cause similar behavior to happen when the start of the selection (on the same line as the end) was moved. The source of this appears to be rounding errors, where browsers report offsets in whole pixels but actually sub-pixel render them.</p>\n<p>One workaround would be to overlay the colored selection with another white DIV, with both having a <code>left</code> set to a hard number of pixels, and a <code>right: 0</code> to extend all the way to the right. But this seems too kludgy to be justified for such a small annoyance.\n. Look great. Integrated.\n. Good one. Integrated.\n. I did not manage to reproduce this. Does it still happen with the current master branch? Does it always happen for, or only intermittently?\n. Does this also happen in the demos on http://codemirror.net ? Are you using <code>fromTextArea</code>?\n. Very strange. Can you put a demo on http://jsbin.com that demonstrates the issue?\n. &gt; Check this out - <a href=\"http://cssdeck.com/t/cm2\">Minimal Testcase</a></p>\n<p>That works for me in Chrome 16, in that the content is reset to its\noriginal value, rather than appearing blank, when I press back.</p>\n<p>I do remember seeing something like this before, at which time\nwrapping the textarea in a form and giving it a name solved the issue.\nBut since I can't reproduce in this case (maybe Chrome got their act\ntogether on their textarea-filling heuristics), I can't verify whether\nthat still helps.\n. Also, read http://codemirror.net/doc/upgrade_v2.2.html\n. Thanks! Merged.\n. Thank you. Merged.\n. On my Android phone (also version 2.3.5), I can simply press the \u21b5 key on the touch keyboard to insert a newline. I tried in the mode demo pages.\n. Yes, I'm using the default browser. Anyone else with an Android device reading this? We need more data points.\n. So it appears my phone is in the minority. I just triple-checked, it still seems to handle the enter key as expected. Does anyone feel like digging into this? (Logging which events get fired, and how they get handled?)\n. I'm somewhat sceptical that <code>overflow: auto</code> could break enter. It could (and will) break scrolling, for sure, but it's probably not the cause of the enter key problem.\n. Part of a possible solution given by Douve:</p>\n<blockquote>\n<p>I somehow managed to solve the enter key problem by removing padding: 0; from var input = elt(\"textarea\", null, null, \"position: absolute; padding: 0; width: 1px; height: 1em\"); and removing overflow: hidden; from var inputDiv = elt(\"div\", [input], null, \"overflow: hidden; position: relative; width: 3px; height: 0px;\");\nThen there appears a line under the cursor, to solve that you can set height: 0; in var input.</p>\n<p>Only a new small problem arises: at the second time (and afterwards) of clicking on a line, the cursor dissapears. It shows up again after pressing a key.\nBut it's not a very big problem, atleast it is possible to edit code now!\n. Should be much better in 5.0.\n. I've tried (in 5.0.4 and 5.0.5) to reproduce this. Drag-and-drop inside the editor <em>is</em> broken -- the onDrop event is never fired, for some reason -- but I couldn't get the browser to crash.\n. Nope. As I said, I was unable to reproduce.\n. Thanks for narrowing it down to the <code>setDragImage</code> call. This is a rather obscure and poorly-supported API. I've commented out the call for now. If someone finds a way to make the actual dragged text show up as the drag cursor in a reliable way, I'd love to hear about it.\n. Well, the tragic thing is that it works fine on my machine now. But yes, I guess two reports is enough reason to disable the <code>setDragImage</code> call again for Safari. See attached patch. This will cause an ugly effect where the whole editor appears to be dragged around, but it's still better than a crash.\n. It's a Safari bug, not a Webkit bug, that much is certain. It seems the Safari bug handling isn't done in an open way, so I guess you go to https://bugreport.apple.com , jump through the hoops, and hope for the best.\n. Submit a patch?\n. This cause another problem. If you put the cursor in the middle of a line, and then select text with shift-left, you'll see the right of the selection wobble (by a single pixel) as a result of rounding errors. I think that is a more visible problem than the one solved by this patch, so I'm not merging it as it stands.</p>\n</blockquote>\n<p>Does the problem you were fixing occur in the demos? Or only in a different layout? In the second case, please provide some HTML that demonstrates it, since I still don't see it (in Chrome) in the demo pages.\n. &gt; Other people at my office have also reproduced the problem.</p>\n<p>I see. I can reproduce it now, I just wasn't resizing the window\nquickly enough. This is probably caused by a DOM redraw happening\nbefore CodeMirror's resize has a chance to adjust the selection\ngeometry. It does always seem to go back to a consistent state when\nthe resizing is finished.</p>\n<p>I don't consider this a critical issue. It'd be good to fix it, but\nI'm not lying awake at night in the meantime.</p>\n<blockquote>\n<p>Which demo file shows the single pixel wobble? I'm not seeing it on my Mac (Chrome, Firefox, Safari).</p>\n</blockquote>\n<p>I get it in all demos on Chrome Linux. It's probably font and\ndrawing-engine related.\n. Thanks. Merged.\n. Here's a very crude snippet showing how to do this on top of regular events and the existing API:</p>\n<p><code>var gutter = editor.getWrapperElement().getElementsByClassName(\"CodeMirror-gutter\")[0];\n  var hoverElt, hoverLine;\n  CodeMirror.connect(gutter, \"mouseover\", function(e) {\n    if (e.target.nodeName.toLowerCase() != \"pre\") return;\n    var y = e.target.getBoundingClientRect().top + 4 + document.body.scrollTop;\n    var pos = editor.coordsChar({x: 0, y: y});\n    if (!pos) return;\n    hoverElt = e.target; hoverLine = pos.line;\n    console.log(\"over line \" + pos.line);\n  });\n  CodeMirror.connect(gutter, \"mouseout\", function(e) {\n    if (e.target != hoverElt) return;\n    console.log(\"left line \" + hoverLine);\n    hoverElt = hoverLine = null;\n  });</code>\n. You can use <code>CodeMirror.on</code> instead of <code>CodeMirror.connect</code> in recent versions.. I did not forget a dot, and the project is not going to change to a new numbering scheme. 2.2 &gt; 2.11 in decimal notation, and that's how this project (as well as several others) interprets its version numbers. I might do it differently if I were to start from scratch (date-based versions work better), but moving to a new scheme would only cause confusion.\n. Thanks! Merged.\n. Thanks, merged. Next time, please reset to my branch before working on new features (or rebase afterwards) so that only relevant commits (and no merge commits) show up in the pull request.\n. I've pushed 94dd79ef8142fc92f1afda22c1e3bd65b4f54b47 to fix this. Your patch has two problems -- it still doesn't help with turning line numbers on again, and it messes up the if, adding a clause without adding braces, so that updateDisplay would now be called on every changed option.\n. Thank you. Merged!\n. Yes, reading the offsets from an element will cause the browser to update the layout of its DOM tree (not render it). Apparently, IE8 isn't optimized very well in this regard, and messing with the inside of an absolutely positioned element causes it to do work on the rest of the DOM tree.</p>\n<p>I added a big bunch (~5000 lines) of content above and below the editor in one of my demos, but that didn't cause a noticeable slowdown, which suggests that the kind of content, and its styling, is relevant. Can you provide some kind of HTML page that has the problem?\n. Timing this out on the basis of 'not reproduced, no test case provided'.\n. Thank you! Merged.\n. Thanks, merged. I had to do some merging because it didn't apply cleanly to your other patch, but I think I got it right.\n. Merged, but with the style empty by default, for the reason you mention -- it'll look wonky when characters aren't the same width (which also tends to happen for things like Chinese characters in monospace fonts). Thanks!\n. Thank you. Merged.\n. No. See the other pull reqs.\n. Please stop submitting pull reqs that are insignificant style nits. It's my project, I get to decide on the style.\n. 'new Date' is equivalent to 'new Date()'\n. Nothing missing here. Code follows the standard and works just fine.\n. This is my coding style. It's fine.\n. Thanks! Merged.\n. I didn't write this code myself, but not declaring unused arguments and calling functions with more arguments than they fomally take is perfectly valid in JavaScript. Does that solve your problem?\n. Thanks! Merged.\n. Thanks! Merged.\n. Hi,</p>\n<p>I've added an indentRangeFolder to util/lib/foldcode.js. Unfortunately, your version was a bit too full of unused variables, inefficiencies (it always iterated over all lines below the folded line), and unexplainable idioms (I couldn't figure out why you're setting <code>indentTo</code> to null), so I wrote my own in 2b3fc13d917f4dea76335108fd40e39a0553aef5\n. Thanks! Could you try to use more of the standard token styles, instead of using keyword-X? It'd be nice if this was at least partially usable with other themes, and if it didn't require a css file of its own.\n. Merged, with the caveat that I removed the custom CSS file. (Feel free to also contribute a new theme, but I'm discouraging modes from coming with their own CSS when avoidable.)\n. Thanks! Squashed and merged.\n. Closing this until another report of the same issue comes up.\n. That's odd. Is there any way to see whether error messages are generated? If the key's action goes through, but the display isn't updated, I can only explain that if the script errored out somewhere in the process of handling that key.\n. At some point, for example for the left arrow, <code>CodeMirror.commands.goCharLeft</code> will be called. Then, after that, <code>endOperation</code> <em>should</em> trigger a call to <code>updateSelection</code>, which will redraw the cursor based on its current position. It sounds like the call to <code>goCharLeft</code> goes through, but the selection somehow isn't udpated.\n. Should be much better now that the contentEditable-based mobile code has landed.\n. Thank you! Merged.\n. We've reduced our browser support to only cover standards mode, since there was no end of weird quirks mode bugs. Thus, this has become out of scope.\n. I've closed it. No further action necessary.\n. This is just a small demo, so this kind of user-interface concerns aren't really important. People will (I hope) not copy-paste the whole thing into their applications without thinking about it.\n. I've added the 'var' keyword to both instances of the scroller var. Still standing by my opinion that a demo should be simple and user experience is a secondary concern.\n. I did not write this demo, and I don't see a comment about a workaround in Chrome. I am aware that there's a potential for bad interaction between the built-in F11 command and the one in the demo, but that seems like a non-issue for a demo that just demonstrates a concept.\n. Was a thinking error in the redo code. Thanks for the detailed report!\n. Ah. I expect only one bug per bug report, so when I figured out what the first one was I stopped reading. Second should be fixed now as well.\n. Pure XML mode is unfinished and unmaintained. Did you have a reason for wanting to use it? (I should probably remove it from the distribution.)\n. It doesn't really do much that the other XML mode doesn't, and the other is more actively maintained.</p>\n<p>@deebugger What's you take on this? Are you still using this yourself? Any plans for further work on it?\n. @deebugger I haven't studied the code, but from your list I don't really see what features it has over the regular XML mode. The only thing is the accumulation of errors, which is not documented and probably only used by you. I feel it'd make more sense to maintain a single XML mode.\n. Why not just write an eclipse theme? Copy the styles you don't care about from the default theme, and replace the ones you define here. Putting the css rules into the demo page makes the demo look different, but doesn't really help anybody who actually wants to use these colors.\n. Themes are supposed to be language-independent though, so a name that describes the color scheme, rather than the language it was first written for, is preferable.\n. Closing this until further notice.\n. Thanks. Merged!\n. <code>find</code> is a locally declared function, and thus gets the same style as other local definitions. This is by design.\n. Firstly, please don't touch built-in prototypes. Just add a ulitity function that you call.</p>\n<p>But no, I don't want to put every useful utility into the core. Trimming is sufficiently trivial to do in-line (and it's not something that a typical mode has to do).\n. Hi Pete,</p>\n<p>I appreciate the contribution. However, its not really in a shape to merge into the main repository yet:\n- Modes should not have their own CSS -- and certainly not copy-paste most of <code>lib/codemirror.css</code>\n- The JavaScript mode is probably a bad match for VBScript. For one thing, its indentation model is completely different, which causes auto-indent to do strange things (it expects semicolons at the end of lines, for example)</p>\n<p>Taking what you've learn in writing this, you could easily start over from scratch, and simply leave out indentation support in the first version. A simple, working mode with a few features is better than a complex one with extra features (context-awareness and indentation make up for most of the JS mode's complexity) that don't work.</p>\n<p>Best,\nMarijn\n. I agree that something like this is needed. But the approach taken here might be a bit too crude -- if you press enter and then move the cursor in some other way, you'll still be left with the trailing whitespace.</p>\n<p>Would a feature (also turned on by an option) that automatically reduces whitespace-only lines to empty lines when you move your cursor away from them work for you?\n. I've pushed a solution (<code>autoClearEmptyLines</code>) that does <em>not</em> take the question of whether the whitespace was added by auto indent into account. It simply (when turned on), clears whitespace-only lines when the cursor moves away from them. Somehow tagging lines when they are auto-indented would be possible, but more invasive. I'd suggest people simply don't turn this feature on when they need trailing whitespace in their files (which is very rare, in code).\n. No, but it should be easy to write an onChange handler that goes over the changed lines and strips any trailing whitespace.\n. Does passing the option <code>electricChars: false</code> solve this?\n. Are you quoting the string? What is the exact code you're inputting?\n. If I paste that into http://codemirror.net/mode/coffeescript/ , the whole string is colored red. Are we talking about the same CoffeeScript mode?\n. This works just fine when I test it. You could be messing with the top-level editor variable in a bad way, or maybe you're looking at the wrong texarea. Impossible to say without a self-contained test case.\n. There are two hidden textareas. The thing you called fromTextArea on is hidden and is the one that the content will be saved to. CodeMirror itself also uses a hidden textarea for input handling.\n. Re-indenting a whole file using your preferred style doesn't really make me feel good about a pull request.</p>\n<p>Anyway, I think your approach is too hacky and too invasive. I've pushed an alternative that simply changes the built-in token handler to replace tabs with an appropriate number of spaces (you can pass a <code>{tabSize: X}</code> object as fourth parameter, or change <code>CodeMirror.defaults.tabSize</code>).\n. Awesome! I was reading about this in the SublimeText release docs this week, and thought it was a very clever feature.</p>\n<p>Merged. I've pushed a followup patch that documents and slightly cleans up your patch: 5e73f88c5980caebc3fb7076a7ea177a5a39aa2b\n. I expect that should take care of it. If not, let me know.\n. I think that just doing <code>CodeMirror.commands.replace = CodeMirror.commands.replaceAll = null;</code> should do the trick.\n. I'm about to bring out a new release... so yeah, let's hope the code is ready for production. (I don't have a dedicated testing team at my disposal, so few guarantees can be made.)\n. Thanks! Merged.\n. Thanks! Merged.\n. Thanks! Merged.\n. Hi Almog,</p>\n<p>I only tested my workaround on IE8, but there it seems to make a difference. Could you test?</p>\n<p>Best,\nMarijn\n. codemirror.net/demo/search.html\n. New releases happen around the 20th of each month. (where 'around' is +/- five days)\n. Look in the git history. The compression helper allows you to choose which version you're getting, so there's no 'updating'.\n. Merged. Thanks.\n. Sure it is a mode.\n. They are non-alphabetic by intention. No one is scanning that list looking for a specific phrase -- and even if they were, it's short enough to find what you want in a few second.\n. Thanks. Merged.\n. Is there a use case for this? Why not just use <code>match</code> with a regexp that allow whitespace?</p>\n<p>Even if this would be a good idea, you implementation is quite unacceptable. It makes <code>peek</code> have a side effect, which makes it very confusing.\n. &gt; If I use the current peek function I can look only 1 char ahead and this includes white-space.</p>\n<p>So use match. <code>stream.match(/^\\s*{/, false)</code> will get you what you want. Except if the brace is on the next line. In which case you're out of luck anyway, unless you tackle this properly and keep state in your parser.\n. Did you read what the second argument to match does? I fail to see the problem.\n. Thank you! Merged.\n. How about sending the actual XML file you're testing with, rather than a video? That'd probably help more in reproducing this.\n. Your XML file is a single line. CodeMirror doesn't handle extremely long lines very well. This is a known issue.\n. Ideally, the autoformatting, or at least its auto-line-breaking part, should work on a string rather than a CodeMirror instance. You could take a look and see how easy it is to rewrite it like that (it's not my code).</p>\n<p>For a simpler workaround, you could just run a crude regexp over your file inserting line breaks in some non-controversial places (after certain closing tags, for example), before you insert it into the editor.\n. Are you talking about the browser's search, or the search implemented in CodeMirror (http://codemirror.net/demo/search.html)?\n. Still a 404. And please, provide a test page not a video. Even if I <em>can</em> figure out the problem from a video, I'll still have to build a reproducing page to be able to debug something. So if you want to give me what I need to solve a problem, <code>.html</code> &gt; <code>.mov</code>\n. Ah, i see what you mean now. This is intentional (see the line in search.js where it say <code>if (cm.lineCount() &lt; 2000)</code>). Highlighting all matches in a huge document would be expensive. Feel free to write an exension that tracks user scrolling and lazily highlights the visible matches. I personally don't find it important enough to work on.\n. Thanks. Merged.\n. If by 'next stream' you mean rest of the line, you can do <code>stream.match(/c/, false)</code>. If you mean the next line, then you can't.\n. Looking at the subsequent lines won't be supported. The reason for this is that changes in the document would require all previous lines to be re-parsed in order to update their style.</p>\n<p>It would help if you told me what you're actually trying to accomplish. Tokenizing /**/ comments definitely doesn't require lookahead beyond the current line.\n. Thanks. Clever solution. Merged.\n. I've applied to fixes you propose in bd1105b886159a9e02363e7564297cbc6fef1707 . As for indented lists being colored as code -- I don't see this problem happening. If I write '[four spaces]* foo', it gets colored as a list.\n. The markdown mode is @timjb 's code. Tim, want to take a look at this?\n. Thank you. Merged.\n. Are you aware of the fact that stringWidth is only reliable on multi-character strings when line wrapping is turned off? Seems like it might be a bit error-prone to use in external code.\n. Hm. I don't have time to work out a solution right now, but I'll think about it. Stick to this hack in the meantime.\n. Hi Adam,</p>\n<p>Even the width of a char is not something you can rely on. People can use non-monospace fonts, and many characters (non-western writing, symbols) take up more space, even in a monospace font. Since you control this gutter, can't you just create a hidden similar element and measure how wide a given string makes it?</p>\n<p>Best,\nMarijn\n. I could only reproduce in FF on Windows. The patch above fixed it in that case. Please double-check whether it also works for you now.\n. Mouse and key events are <code>preventDefault()</code>-ed but not <code>stopPropagation()</code>-ed, so you can attach a handler that gets them. The code that fires <code>onCursorActivity</code> has no clear view of where the activity came from, so it can't really provide extra details.</p>\n<p>You should be able to go from a DOM node to a token by going through <code>coordsChar</code> and then <code>getTokenAt</code>.\n. Great. I'll close this. Comment again or open something new if you have more trouble.\n. Does this still happen for you (it might be that the fix for #407 handled it)?\n. Thank you. Merged.\n. Thanks. Merged.\n. Very cool. Merged.\n. Good catch. Merged.\n. Which browser? I'm not seeing this on Chrome 17\n. I've added the rule to the css file instead. I think it is perfectly okay like that -- people can override it if they really want an outline.\n. Thanks. I've cleaned up the patch a bit and committed it as 4f596ae0960b01a24ceeb910471d8edbd3892897\n. Hi Pete,</p>\n<p>Matching a big set of words against the input like this has two problems. You'll still recognize keywords when they are part of a bigger word (for example <code>SometSetOfThings</code> will have <code>Set</code> highlighted). And secondly, it is really inefficient -- you're doing all these look-aheads, then skip a single character, then do all of them again.</p>\n<p>It'd be better to do what the other modes do, and first recognize a 'token' in the stream, for example a whole word, and then run that word against your list of keywords. That way, you only fetch the word from the stream once, and you'll respect word boundaries.</p>\n<p>I'm also somewhat confused on why you're matching the parentheses after some keywords, and why something like <code>On Error Resume Next</code> is treated like a single keyword. But I don't know VBScript, maybe it just is that strange.</p>\n<p>Best,\nMarijn\n. Thanks! I've integrated your code in commit 5f403c0ba54050aac5162901fe7298d9017e05b2 and cleaned it up a little in c8b1512f64aee00ae6ee6a3f68692c702956e169 .\n. Thanks! I've integrated your code in commit 5f403c0ba54050aac5162901fe7298d9017e05b2 and cleaned it up a little in c8b1512f64aee00ae6ee6a3f68692c702956e169 .\n. See http://codemirror.net/doc/upgrade_v2.2.html\n. So, I kind of see your point, but I also think that A) a bunch of people are already relying on the current behaviour, and B) having fast control over a line's indentation is usually a much more useful thing than crudely inserting a tab.</p>\n<p>I'll think on it a bit more. Maybe binding Ctrl/Cmd-[ and ] to indent/dedent also works.</p>\n<p>As for \"virtually every editor\" -- the one I'm familiar with, emacs, doesn't.\n. Bedankt. Merged.\n. I disagree. A raw CSS mode is also good to have, at least until the LESS mode is a lot more mature. It actually did know the difference between colors and ids, it just happened to be (probably due to some historic accident that happened when the theme code was introduced) coloring them in the same way. I've fixed that now.\n. I mean it's new, and new software is always full of bugs. Also, people are used to the behaviour of the exising CSS mode, I doubt they'd appreciate suddenly having a different one for no good reason.\n. Does it select it in CodeMirror itself, or in the DOM? I can see it select a single char in a line on Chrome. This is not something I can do anything about -- I don't want to go capture clicks on the whole document, and even if I would, it'd be very difficult to find out that a part of an editor is being selected, in order to prevent it.\n. Great! One thing I changed was to move the theme file to <code>theme/</code>, and to give it a more neutral name (<code>xq-dark</code>) so that people don't interpret it as applying only to the XQuery mode. In the process, I replaced uses of the 'xquery-function' style with 'def' and of the 'xquery-pi' style with 'meta', since you weren't using those and they more or less apply. I've updated the test suite. See 74a54b546eb8392a58159aa45085957359ce4da0 . If you want to propose a better name for the theme, let me know.\n. I've been trying to get access to a Lion system, but it seems a lot of people haven't upgraded yet. For now, I can't test this. The problem is most likely in <code>posFromMouse</code>, which tries in a hacky way to recognize scrollbar clicks. The hack, I assume, doesn't work on Lion anymore.\n. @njx Did your patches fix this, since you mentioned you tested on Lion?\n. Hi Narciso,</p>\n<p>If you have some time to spare, could you try with the v3 branch?</p>\n<p>It is likely to still have the problem, though. If it does, play around with <code>posFromMouse</code> and the scrollbar-click detection there. It should be possible to add code that, when a scrollbar is present, simply returns null for anything in the rightmost (for v scrollbar) or bottom (for h scrollbar) X pixels of the content area (where X is the experimentally determined width of a Lion scrollbar).\n. This works on v3, largely, with the caveat of #811\n. This is intentional. Duplicate of #423\n. Could you try again with the patch above? I can't reproduce this, but it is probably dependant on your font. I had a similar problem with bold styles, and there setting an explicit line height fixed the problem.\n. Timing this out. Open a new issue if the same or a similar problem comes up again.\n. Browsers (at least my Chrome) don't seem to do paste in a textarea on Shift-insert. As the thread you linked mentions, it is not possible for JavaScript to directly access the clipboard, so CodeMirror is dependent on the browser here.\n. Thank you! Integrated.\n. Thanks, merged. I noticed one bug (which I fixed) -- you were relying on a 'global' variable <code>last</code>, but there is no guarantee that a mode is executed sequentially. If the user edits line 4, parsing will restart from that line, and you'll be reading the <code>last</code> variable from wherever you last parsed. I've updated it to store this in the state instead, which will be properly threaded top-to-bottom.\n. This is request for a new feature that goes well beyond what CodeMirror does. A contribution of an add-on would be welcome, but this should not be cluttering up the bug tracker.\n. If the colors are wrong, you're probably not using the JSON mime type (JavaScript parses differently than JSON)\n. application/json should work for JSON data. Can you show an example of something that's colored incorrectly?\n. Seems to highlight fine for me. What were you expecting? What happened instead? (Bug reporting 101)\n. What kind of coloring do you mean if not highlighting?\n. Well, yes. It's all strings, so it all gets the string style. Feel free to extend the JS mode to color property strings differently.\n. I don't know what you mean. I've never used the formatting code, so I can't really help much there.\n. Thanks! Merged (I squashed the commits together). Very impressive that you managed to just fix this -- the bookmark-maintaining code is a terrible tangle.\n. Good idea. Merged.\n. Good idea. Merged.\n. Thanks! Merged.\n. This is quite likely related to the bug fixed by ae3f9fc881c1907d916c2780d46309b4e04196a2 . In any case, I can't reproduce this in the current code. Can you update and double check?\n. Woops, I didn't even notice. Merged.\n. Argh! The pull requests are coming in faster than I can merge them. Thanks for cleaning up my screwup. Merged.\n. What were those spaces delimiting? I.e. what goes wrong when they are not there?\n. Ah, you are right. Fixed in a less exotic way in dd9bb710a770e4d1d8ad5bc8edefbd56d1f7600d\n. Thanks! Merged.\n. Thanks. Looks great. Integrated.\n. Very nice. Integrated at 5080bf96496f98339003f465d48294ede1b0e171, with a small bugfix in 3b3b61e7160f40ef63a3b068a5de4231c233c06c\n. Unless the information flow is strictly top-to-bottom (your analysis only depends on the lines coming before), this is something you simply should not be doing on the level of the highlighter. Probably the best approach is to hook something into onChange that detects when an update has to happen, and then (with a suitable delay that makes sure you don't do it on every keystroke), call setOption(\"mode\", [your mode]) to cause the whole document to be re-highlighted.\n. I'm not quite clear on what your plan is, but you can already use <code>onDeleteLine</code> <a href=\"http://codemirror.net/doc/manual.html#onDeleteLine\">1</a> to get notified when a line is removed from the document.\n. This would go strongly against the stateless nature of mode parser. Closing as 'unfortunately not going to be supported'.\n. Thanks! I've integrated these but I'd like to hear some explanation on why the mouseup blur/focus trick works (it seems really bizarre that that has anything to do with tab capturing).\n. I couldn't reproduce the second issue you describe. If it still occurs with the patch, please file an issue with a detailed test case.\n. The point of the MIME modes is pretty much that they allow you to specify that you want to highlight a given language without specifying the precise mode and mode parameters you want. I agree that having the result depend on loading order is a pain. I've added a check to xml.js that makes it only register text/html if it isn't already registered. That'll probably solve your issue.\n. It <em>could</em> indeed be a CSS issue (the invisible shim node used to measure word wrapping has to match the actual visible text's style), but I also wouldn't be surprised if it was a real bug. Unfortunately, I can't reproduce it (maybe due to slightly different fonts and editor width) even when I try a bunch of different line lengths.</p>\n<p>One angle for debugging this is to make the measuring element visible (the thing that gets a 'width: 100%' near the top of codemirror.js -- give it a bigger height and remove the visibility: none style), and try to see why it is being wrapped differently than the visible code.\n. So if you're using a serif font, that suggests you're not using the HTML pages from the distribution. Could you provide a minimal HTML page in which the issue occurs? (Throw it jsbin.com or gist.github.com).\n. Thanks for the test case. That made it easy to reproduce. The problem was that the initial line heights were measured with the gutter still empty, and then changed when the gutter was drawn. Please test my patch, and comment here if it doesn't solve the problem for you.\n. See if you like the wording in the commit I referenced better. Your blurb assumes 'the textarea', but CodeMirror can also be initialized without a textarea, which seemed confusing.\n. Thank you. Merged.\n. Duplicate of #314\n. Neat! Thank you. Integrated.\n. I think this was simply a missing backslash in the existing regexp. Could you verify that my fix works for you?\n. Thank you. Merged.\n. Awesome, thanks! Next time, please rebase/reset to my branch first, so that your old commits and merge commits don't show up in the pull request.\n. That <strong>is</strong> the tab insertion that you're seeing. See the release notes for 2.23. You probably want to bind Tab to 'indentMore'.\n. @peterkroon You submitted some patches. Is this still an issue?\n. I failed to reproduce this. If I set fixedGutter to true in one of the mode demos and add a long line, both scrollbars work just fine in IE9 (though indeed the updates on the gutter lag a bit).\n. Timing out for now. Comment if it shows up again and there's a reproduceable case.\n. Argh. Seems one of our incompetent friends at Microsoft implemented array <code>splice</code> in a way that somehow occasionally goes wrong. Thanks for the detailed test case. I could reproduce it, find the problem, and work around it. But I'm never getting that hour-and-a-half back.\n. Thanks for digging up that link -- at least it shows I'm not hallucinating. CodeMirror uses splice in a few other places (mostly to simply remove elements from arrays without adding). Since those haven't, so far, gone wrong, I'm holding off on changing those, in the hope that the bug doesn't occur in such simple cases.\n. Thank you, merged. I've documented and integrated it a bit more thoroughly in ac4af92419c17fcb189c7972bb93152c43d9b2ae\n. Does http://codemirror.net/demo/runmode.html do what you want?\n. The polyfill was made obsolete by another change I made today (856b12100edee34af33606cbc811c0890324debc). As for the failing test, I'm unclear on what it is actually supposed to test. Could you elaborate a bit more?\n. This seems to be about the order in which event handlers are firing (and has nothing to do with the <code>submit</code> method hack). CodeMirror doesn't (and can't) guarantee that your onsubmit handler will see the textarea's content in its updated state, so I don't think this is a bug. It's somewhat inconvenient, I agree, in that you can not treat the wrapped textarea like a regular undecorated one when writing submit handlers, but (unless you can come up with a workaround), not something that I can fix.\n. I'm not very keen on supporting two scrolling models if we can help it. Even if that means a little extra legwork for IE6-8 and less smooth scrolling on FF.</p>\n<p>Wouldn't some of the problems with expanding and sizing the scrollbar div go away if we mostly keep the current set-up (the scrollable div covering the whole editor), but make the visible lines/gutter an absolutely positioned sibling of the scrollable div?\n. It wouldn't have to be behind it. It should probably sit in front of it.\n. I haven't thought about this deeply, but I had something like this in mind</p>\n<p><code>&lt;div overflow: hidden&gt; // clips content. could be the actual outer class=CodeMirror element\n    &lt;div scroller&gt; // transparent, sets the size of whole thing\n    &lt;div position: absolute&gt; // behind scroller, contains code, moved around slightly to make scrolling pixel-precise\n&lt;/div&gt;</code>\n. Great. No hurry on my side. Sorry to be so picky (I'll be the one who has to maintain whatever comes out of this).\n. This is a Webkit bug that CodeMirro can't really work around in a sane way. See http://groups.google.com/group/codemirror/browse_thread/thread/9b42dec8a17a2dc1 and https://bugs.webkit.org/show_bug.cgi?id=49288 . (Feel free to pressure the Webkit people about it!)\n. Thanks. Merged.\n. Squashed together and pushed as bca3ad75086c759ee353feb9ac305b8fcecb1c8f\n. So, my problem with this patch is that 'self-closers' only exist in HTML -- XML is regular, and you're allowed to self-close or nest any tag (*). But in HTML, '<br/>' and such is not even valid syntax, so forcing people to write it is bogus.</p>\n<p>(*) This doesn't hold if you take a schema into account, but CodeMirror currently has zero support for XML schema.\n. HTML5 does not require one to mark self-closing tags with a / either, though.\n. Thanks. Merged.\n. Merged. Please let me know whether you agree on the if vs while thing I commented on.\n. If you're pinning the CPU with other stuff, timeouts will fire more slowly and of course responsiveness will suffer. I don't think CodeMirror is to blame for that, though.\n. That's odd. Might be a problem with excessive layout recomputation happening in FF. Can you produce a demo that depends on as little external things as possible?\n. I narrowed it down to a problem with some jQuery-UI styles being applied to the container around CodeMirror. These seem to trigger some speed problem in the Firefox layout engine. I'm going to declare this not a CodeMirror problem (though it is perfectly possible that there's a way to sidestep this in the CodeMirror code, I don't have time to dig into it any further.)\n. Thanks. Squashed and integrated as 19b7d0de3c5610788c2db970d50f2d537d46ca50\n. Thanks. I think you are right that this was a bug. Merged.\n. Thanks for the super-detailed test case. If only all bug reports came with a demo like this!\n. Many uses of <code>onChange</code> require it to see every change (UI updates, change tracking), so please go easy on the word '<strong>should</strong>' here.</p>\n<p>Solution 3 would work well. It should be relatively easy to set a flag or pass a parameter when making a change triggered by keyboard input. But what about changes triggered by key bindings? They are programmatic, in a way, but you'd probably want to count them as user input, or even the built-in enter handler will cause non-user change events.</p>\n<p>If you can come up with working code for this, I'd be happy to review it.\n. A 'tiered' API like this is definitely a valid design choice, but not the one that CM makes. We have a single API that's used both by low-level plumbing things and by integration code, this has the advantage of minimalism (small library, simple API) and it's working pretty well so far.</p>\n<p>Thus, I still advocate simply tagging onChange calls with a flag that describes their origin. We can easily set a flag around the code that handles a key binding to be able to tag change events it generates.\n. Anyone can feel free to implement this, or pay me to. I'm closing the issue on the basis that I don't find this high enough priority to work on it in my own time, and am trying to keep the issue list reflect actual things I need to look into.\n. CodeMirror modes <em>definitely</em> don't escape content... and neither does CodeMirror itself. So I am pretty sure that the problem exists outside of CodeMirror.\n. Well, there isn't, if you are talking about <code>mode/javascript/javascript.js</code>...\n. Read it a little more closely. That does not escape text. It forwards over a character stream until it finds an unescaped instance of a character.\n. Your conclusion makes no sense, but if you want to believe it, that's fine. I'm just commenting in case someone else stumbles onto this bug.\n. If you post a (minimal) HTML page that demonstrates the problem, we might be able to help.\n. I was unable to reproduce this. In IE7 compatibility mode, I dragging from the editor is disabled, but dropping text dragged from outside it works as expected. If the problem still exists in the current version of CodeMirror (in git), please provide a demo page for the problem.\n. Awesome. Merged.\n. Thanks, merged! Not sure how I let that repetitive code slip by. Again, I don't know anything about vim so I'll just fully trust your judgement on these.\n. Thanks for the continued work! Please stop worrying about IE6. I've just officially dropped support for it (you're right that horizontal scrolling was broken, as was displaying of the selection -- and it probably had been, for months).</p>\n<p>I'm always somewhat wary of any changes that involve programmatic resizing of stuff, but I've already committed that sin so much in the current code that I can't hold it against you. If you work out the known kinks, I'd like to merge this in after the next release (next week), and then encourage people to test it, so that it gets some exposure, and if no fundamental problems are found, can become part of the May release.\n. I'm still seeing some flaky behaviour (all in Chrome 17, didn't try other browsers yet):\n- When I create a long line, the horizontal scrollbar sometimes appears a little above the bottom of the content. Some characters peek out from under it.\n- When removing a long line and then re-creating it, the horizontal scrollbar sometimes doesn't return, and the text peeks out to the right of the vertical scrollbar.</p>\n<p>Furthermore, when I try to merge your changes into my current code, there are a few trivial merges to do, but the result is also somehow broken. See the <code>flicker</code> branch in this repository for the outcome of my merge. It causes obvious issues with inner scrollbars appearing inside the editor when content becomes big enough to require scrolling.\n. Thanks for the update! I've fixed the other bug you found. I'm extremely busy today, so I probably won't get to merging this, but I'll definitely give it a shot before I merge any other stuff, to prevent the branches getting out of sync again.\n. Great. I'd prefer that, in the future, you rebase on top of master and update your actual commits rather than adding merge commit and small fixes (such as the whitespace one, which just makes merging painful). My rebased branch (which, this time, seems to work properly), is at https://github.com/marijnh/CodeMirror2/tree/flicker . I'd appreciate if you did further work off that one (it should contain all your changes, squashed into a single commit).\n- I still sometimes see (on Chrome) when I'm adding lines, the scrollbar being slighly less tall than the editor. If I go to mode/xml/index.html, do ctrl-a, ctrl-c, and then ctrl-v a few times, the alignment of the bottom of the scrollbar with the lower right corner isn't fixed for some reason, it occasionally sits a few (~2 to 10) pixels above it. The next updateDisplay will align it again.\n- I was wondering whether the transparent background hack was really necessary. We're listening for relevant mouse events (wheel, click), and could just let them bubble up to the wrapper element and handle them there, no? Or, if I'm missing something, maybe we can apply the opacity kludge only on IE somehow? (Or do you have something that shows that the opacity is guaranteed not to cause performance issues? I can imagine that, unless browsers are clever about optimizing the alpha=0 case, a huge full-screen editor might cause the browser to do a bunch of useless alpha-blending work.)\n- Listening to mousemove to update the cursor seems like a fragile and slow thing to do. Also, what happens when someone adds a clickable widget to the gutter? Since we're putting something in front of it, it won't get events.\n- The same holds for widgets put into the code, area, in fact. I know several users are depending on these getting mouse events.</p>\n<p>So yeah... this set-up with the scrollable div covering everything was my idea. But it seems it has some downsides. Do you think a slight variation, where the content sits above the scrollable div but is given a width that corresponds to the clientWidth of the scrollable div that sits behind it (so that the scrollbar is visible and clickable) would work? This could be combined with letting mouse events bubble up to the wrapper, so that we can have still wheel events scroll the content.\n. Read up on <code>git rebase</code>. It allows you to munge commits in various useful ways. What I'm looking for is a branch that has all new commits above all commits that are currently in master, and, if it contains more than one new commit, has those commits be per-topic, rather than back-and-forths (like the whitespace fix) which make it hard to figure out what changed.</p>\n<p>Anyway, the problem isn't just overlaid widgets, but also things like clickable text (you can inspect the clicked span to make it behave something like a link), and, something that will probably soon be added, alternative representations for certain characters/spans, which might contain arbitrary HTML.</p>\n<p>I'd rather not go back to your old implementation. It felt like it'd be more problematic than the problem it is trying to solve. I'm not quite sure what the best solution is at this point. You could check how ACE handles the Lion scrollbar strangeness.\n. Yes, my main concern with the old patch was the added complexity. If you can pare it down to  a single model, I'd be fine with it.\n. Thanks, merged.\n. Is there any reason to put the logic for adding 1 to the end line in the range finder functions themselves? Couldn't we just decide that the end returned by the range finders should not include the closing line, and have the fold function add 1 when <code>hideEnd</code> is true?\n. Oh, you're quite right. I hadn't thought about the indentRangeFinder. Checking against it like this is worse than the old approach (someone else might write a range finder that also doesn't have a closer line). I've merged your original patch.\n. Wow, that looks very good! Merged.</p>\n<p>Your comments:\n- The use of the <code>.CodeMirror-something</code> is to make it unlikely that the class names with clash with anything people already have in their page (a <code>selected { background: red }</code> rule might occur, and CM should be embeddable in any random page). The <code>CodeMirror-</code> vs <code>cm-</code> inconsistency is a result of historic unplanned evolution, It doesn't bother me enough to change it (which would be a pain for people who upgrade).\n- At some point, I believed <code>span.foo</code> was faster to match than <code>.foo</code>. I've since learned that it really doesn't matter.\n- <code>.cm-variable.global</code> would use the unprefixed <code>global</code> class, which I'd rather not do. Since the amount of standard styles is small, I don't think inheritance between similarly-named styles is very important. Most of the time, the only styling consists of a color anyway. The numeric suffixes are intentionally vague, so that different modes can overload them to mean widely different things.\n- Modes can be written to assign a style to punctuation characters. Some of them do. I've personally never liked the extra noise of colorful parens. The modes I wrote tend to leave punctuation unstyled for the somewhat dubious reason of reducing the number of DOM elements that have to be produced.\n. Thanks! Integrated.\n. Which gutter image?\n. Look closer. That slight noise in the background is the image.\n. Don't use <code>\"Shift-6\"</code>! You can bind keys to <code>\"'^'\"</code> (the character between single quotes) to match a precise character. (This unfortunately doesn't work for Ctrl/Alt/Cmd- combos, because those don't fire keypress events.)\n. I see <code>catchall</code> combined with character bindings was completely broken. See 9b5939f75a49e9f4b0cd6e380320769dc671a5c5 for a fix. I've also integrated your changes and updated some of the bindings to use character bindings. (Feel free to verify that I didn't break any of them.)\n. Thanks! Merged in e115f36b6900b88169b8b962c448fa3b2c2496d2\n. Thanks. Merged.\n. I'd recommend you to just use the xml mode. The xmlpure one will be either merged into the xml one, or removed altogether.\n. Thank you. Merged.\n. Apply your sizing rules to the <code>CodeMirror-scroll</code> class. The explicit styles set on inner elements should not concern you, they don't leak into the layout outside the editor.\n. <code>100%</code> is tricky, in that it will work differently because there's an intermediate element wrapping <code>CodeMirror-scroll</code>. Setting <code>.CodeMirror , .CodeMirror-scroll { height: 100% }</code> seems to do more or less what you want (gives both the wrapper and the scroll pane a height of 100%).\n. Thanks! Integrated, in squashed form, in 77aa26d94945080e49b3055bdca7f58ab0d52017 . I'm not entirely sure whether the $ change is a good idea -- it seems odd -- but I guess it <strong>is</strong> consistent with what vim does.</p>\n<p>I guess (not really being a vim user), I'll let the other authors of the mode chime in. I think the @-syntax will indeed notify them (though I'm not sure -- I've seen it fail to work a few times).\n. I vaguely remember something about that, yes. Can't find the thread right now. Should definitely be doable.</p>\n<p>Do I understand correctly that it's impossible, in vi, to move the cursor after the last character of a line in when in escape mode?\n. I'm working on a proper implementation of a character-wide cursor right now. Hold tight.\n. See 5a0688f741f617c32d7ee1d4632360f018eb3358 . It's not perfect yet, especially the green styling. Refinement welcome.\n. Two comments:\n- Many projects want to integrate CodeMirror and give their users the <em>option</em> of using VIM bindings. They won't want to include two separate projects. For this reason, I'd really like to see the vim bindings be pushed as far as they can.\n- Maintaining a code editor is a lot of work. If you fork, do make some effort to keep the codebase close enough that we can still exchange patches, or we'll be fixing the same bugs twice.\n. So what would that gain us? I've been very responsive to pull requests. A fork of 'vim.js' that someone does serious work on would be great, and I'll happily merge those changes back into this repository. But removing vim.js from my distro doesn't seem to have any advantages.\n. Aha, I see what you mean now. That's cool. Proper feature parity will probably require quite some invasive changes to the CodeMirror core, though, which is why I first interpreted what you said as an intention to fork CodeMirror. I'm willing to take patches that are small and don't create a mess, but I'm not willing to include big stuff in the core when it's only needed for the vim emulation -- and I kind of expect you'll need some changes like that.\n. I like the idea, but the patch has several problems:\n- It doesn't redraw the selection when the dragged element is dragged out of the editor again\n- It also hides the selection when dragging something from the editor itself, which is confusing\n- It removes the onDragEvent check from the dragover handler</p>\n<p>Were those other three patches supposed to be part of the pull request, or just accidentally added to the branch afterwards?\n. If you submit a new pull request with only the relevant changes, fix the indentation, and use a fresh element, rather than the current cursor (so that you can leave the cursor/selection alone), I'd probably merge this.\n. I am not really interested in maintaining a CDN for CodeMirror, and I doubt github appreciates being used as one (do you know of any projects doing it that way?).</p>\n<p>That being said, if someone else sets something up (preferably with a real high-volume host), that'd be cool.\n. The xmlpure mode is no longer maintained, and you should use xml.js instead. I've just removed it from the repository. If it had a feature that you miss in xml.js, please open a ticket for that, and I'll see if I can add it.\n. Could you try to use existing style names instead of inventing new ones? It helps with keeping themes and modes independant. (I.e. <code>builtin</code> instead of <code>reserved</code>, <code>variable-2</code> instead of <code>thisvar</code> -- it's nice if the names make some sense, but not terribly important.)\n. Thanks, merged. I hadn't noticed that the tiddlywiki mode defined its own set of styles. I'd probably have complained if I'd noticed.\n. It would treat <code>-1</code> and <code>- 1</code> the same (unary operator + number), which worked as well. But I guess treating the minus as part of the number is slightly more correct. I've pushed an alternative implementation.\n. Thanks. Merged.\n. It seems that the paste event generated by middle-clicking doesn't bubble (in Chrome). So the editor was only noticing these clicks when they were made directly on the outer scrollable element, not when clicking any of its child nodes. If found a kludge that works around this problem by reacting to the mousedown event.\n. Does the above fix work for you? It's simpler than the one you proposed, and doesn't require messing around with stream internals.\n. That patch looks good. I've merged it in.\n. The API for this looks like <code>instance.getScrollerElement().style.height = ...</code>. I don't think a method that wraps that would add very much.\n. <code>CodeMirror-selected</code> is no longer a span element. It is now a div that's laid behind the text. The default style works on the demo pages, so if it doesn't work for you the problem is probably on your side.\n. Ah, re-check the docs for setLineClass - it now distinguishes between\nforeground and background styles (because of stacking issues).\nOn May 3, 2012 10:29 AM, \"Chiel Kunkels\" <a href=\"&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#10;&#114;&#101;&#112;&#108;&#121;&#64;&#114;&#101;&#112;&#108;&#121;&#46;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;\">&#10;&#114;&#101;&#112;&#108;&#121;&#64;&#114;&#101;&#112;&#108;&#121;&#46;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a>\nwrote:</p>\n<blockquote>\n<p>Found the error, it's cause I was setting a class on the currently active\nline, the selection showed up on lines that were not active. I'll have to\nfigure out why the active line demo works, but not my code.</p>\n<hr />\n<p>Reply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/523#issuecomment-5483105\n. Very slick! Did it take any extra effort to pull of the layout-changing animation without corrupting the editors?\n. Hey Filip. I've been meaning to move the diff mode over to the default css classes, to make it stylable. Would the following scheme work for you?\n- 'rangeinfo' becomes 'meta'\n- 'plus' and 'minus' become 'tag' and 'string', which is completely arbitrary and non-semantic, but which gives them a green and red coloring in the default theme.\n- we can use 'error plus' and 'error minus' for the trailing whitespace (which will give the actual spans a class of \"cm-error cm-minus\". it'd be easy to style these to your liking with a few lines of css.\n. Thanks! Squashed and merged in 0ff55cad2a06b7e377a18161dd6b075e80c3f6a9 , diff.css removed in 68b5b2a8c71b7ad7789b8084a95f57cb76b9b0f8\n. So yeah, firstly, configure your editor to leave whitespace alone.</p>\n</blockquote>\n<p>But secondly, can't you just use \"text/css\" as your mode config parameter? In the current codebase, a mode name always unambiguously refers to a single implementation of a mode. I'd like to keep it that way.\n. Oh, ergh. <code>defineMode(\"css\", ...)</code>. That's awful. I'll fix the mode to call itself <code>\"less\"</code> instead.\n. See my related patch 92c833475beee575e8cd0000c7fcdb26e627bee4 . I think defining the mime type, if not already claimed, is acceptable. \n. Pushed an equivalent (hadn't seen the pull request yet) as ca27379bec25c26629aba4ef3031f49c1c16f08d\n. Are you pasting with ctrl/cmd-v? Menu? Context menu? Does it happen on all platforms? Can you reproduce in, for example, http://codemirror.net/demo/xml/ ? If not, it is indeed probably a bad interaction with some other code, but I'd still be interested to know which code, and see a way to reproduce it, since CM might still be to blame.\n. I did not manage to reproduce this back when first reported, and since then the editor internals have changed quite a lot. Closing until it comes up again.\n. Which platform? I can't reproduce on Linux.\n. Fixed in 039b3ba4bc3fc4422cbce846548dc51ba85505b3\n. Thanks for catching that. Merged.\n. The v3 branch has an improved folding model, which no longer shows this problem. It won't be fixed in v2.x, because it'd be a huge pain to have both the improved folding model and the old one (for backwards compatibility) in the same release.\n. With this patch, the pasting of such a huge document is still slower than I'd hope, but at least it no longer errors out.\n. Interestingly, the tree update only takes ~100 ms for such a big document. The delay is mostly in filling and reading from the giant textarea. I've added a hack in ebac0e4603a5d85702a7a94dbb0823df2812b842 that at least clears the textarea after a huge input is read, which solves a problem where the whole browser was being slowed down after such a paste.\n. Thanks, merged, with 560e050774f2f0db0bf0470c5ae28cc3c5ad3cb8 added to make sure only a single recomputation is needed per operation (if you had a reason for not doing it like that, let me know).\n. Looks great. I didn't test very much yet, but we find no further issues with this, I'm perfectly okay with integrating it. There <strong>will</strong> be subtle bugs that we miss (there always are whenever I touch anything related to scrolling), so I'd like to only put this in the main branch after the 2.25 release (which I'll do in a week or so). But after you've done the preliminary testing, we can encourage people to test it via the mailing list, and hopefully shake out as many problems as possible before 2.26 gets released.\n. Well, I'd really rather you start testing <em>before</em> I merge. Any time the master branch is broken, that makes the project looks flaky, so I'd like to minimize that.\n. Sure. Please make sure you have some long lines in your tests, and test both with and without line-wrapping. Also, both with and without a gutter.\n. The theory that an updateLinesNoUndo should always be followed by an updateDisplay should be sound. Maybe the glitch you're seeing is the result of some code violating this? In the current (pre your patch) code, there doesn't seem to be any scrolling or updating being done by updateLinesNoUndo. If you added it, you should know why. (Try to preserve the model where display updates are pushed to endOperation as much as possible -- it's more efficient, and easier to think about.)\n. Ah, I see what you mean now. That line appears to have been in there since forever. It is probably a leftover from the original, pre-endOperation implementation. (Which doesn't mean that it doesnt, accidentally, still serve some purpose -- but that purpose, if any, is probably better handled in a different way.)\n. As I understand it, incorrectly estimated line heights are unlikely to produce visible scrolling artifacts -- the scrollbar may change slightly in size as previously hidden lines are rendered, but, except in pathological cases (300-line document ending in a really long wrapped line, for example), the adjustment will be less than a pixel, and won't even show up. Even if it makes the scrollbar 'jump' slightly, it doesn't seem like it'd be very detrimental to user experience.</p>\n<p>But yeah, I see the problem you're facing. I don't have a ready-made solution. I'll think on it a bit more.\n. Sound good. What I came up with yesterday was to delay scrolling until the call to updateDisplay, if possible, by simply setting a flag when the cursor needs to be scrolled into view. updateDisplay could then, if this flag was set, base the visible window on both the current scroll position and the cursor position, and, if necessary, fix the scrolling after the update. Your solution sounds simpler though, so I prefer it.\n. Thanks. Merged (in squashed form) in d3dccccc9bb272f361eaaf6d27ca1eda514919b7 , and tweaked slightly in 1de8161d9f659bdae2c16fda9b9bb35415a6ea1a (made comment color readable, moved css file to theme/ dir).\n. Glad you figured it out. That was an API change in 2.23, which was needed because the selection is now being drawn differently.\n. Hi. This contains all the old patches as well, and doesn't apply cleanly to the current repository at all. Could you rebase to my master branch, re-apply your changes, and resubmit?\n. Which textarea are you talking about? It sounds like you're putting text into the hidden textarea created by CodeMirror. Don't do that.\n. I'd expect the content to never show up at all if it is put into the textarea after the call to <code>fromTextArea</code>.</p>\n<p>If it is in there before that, this has nothing to do with the code not being load, it is probably an issue with the editor not being drawn because you are initializing it in a hidden state. Calling <code>refresh</code> will only help if you do it <em>after</em> you make the editor visible.\n. Please put a demo of the problem on jsbin.com or so. That way, we won't have to guess on what is going wrong, but can see for ourselves.\n. Timing this out due to no testcase being forthcoming. Open a new issue (with testcase) if more attention is needed.\n. See http://codemirror.net/doc/manual.html#refresh . If that doesn't help, <em>submit a test case</em>.\n. 1. Go to jsbin.com\n2. Put the <strong>minimal</strong> code that causes the issue in the editor there\n3. Click the share link at the top and paste the resulting URL here\n. I agree that this would be useful, but CodeMirror can't enforce that characters have a fixed size, and doesn't really use a grid (tabs are wider but would be possible to support, since they are at least a multiple of regular characters, many non-ASCII characters end up wider than a single ASCII char, and non-monospace fonts are supported). Thus, it'd be terribly flaky. You could do a thing where you, on creating the editor, put in a single line with the width you want, use charCoords to get it's horizonal length, and then absolutely position a single-px-width div there to serve as your boundary. It's hacky, but will probably work fine.\n. Thanks! Works like a charm. Merged.\n. The XML mode, when HTML is enabled, handles this.\n. Thanks. Merged.\n. <code>lineWrapping: false</code> shouldn't break lines at all -- long lines should cause a horiziontal scrollbar. Did you maybe set another style that might be interfering with CodeMirror?\n. Okay. If I try this, it wraps nicely on words. Which browser are you using? Which mode? Can you reproduce it in http://codemirror.net/demo/folding.html (which has line-wrapping enabled)?\n. Timing this out. Open a new issue if it is still a problem.\n. Why would I add a method that simply calls a callback? That seems a rather useless kind of added complexity. (The save method is only available for instances created by <code>fromTextArea</code>, and is used to update the textarea. I don't think hooking a callback into that functionality is really useful either.\n. The <code>save</code> method, as described in the manual, update the origin textarea with the current content of the editor.</p>\n<p>The <code>save</code> <strong>command</strong> (<code>CodeMirror.commands.save</code>) is missing by default, but <code>Ctrl-S</code> (and other keys in other keymaps) is bound to it. You can set it to your own save function with code like</p>\n<p><code>CodeMirror.commands.save = function(insance) { /* ... do things with the given instance .. */ };</code>\n. If I follow these steps, I still see the gutter width being consistent when scrolling around. Which browser did you test? The relevant code is probably around the <code>if (normalNode != null)</code> part in <code>updateGutter</code> -- it adds non-breaking spaces to pad the gutter to the minimal required width. The only broken edge case that I can see would occur if you put a marker in every single visible line.</p>\n<p>This is all somewhat flaky and will have to be rewritten soon as part of #305 , but for now I can't spot the problem.\n. Awesome. Merged.\n. Will your changes help here, since they also touch the scrolling-and-updating order?\n. Awesome. I'm away from home right now, but will review and merge this next Wednesday.\n. I've added a few comments. They should be easy to take care of.\n. Merged at last. I'll send a mail to the list to ask people to help test.\n. Thanks. Good suggestions. Implemented in e16163e32c76e69ea8f5cf02539b5f078bf280c7\n. Thank you. Merged.\n. Right. Use <code>lineCount</code> to figure out the end of the document (or just use Infinity, since positions will be clipped to the existing document), and append your text.</p>\n<p><code>editor.replaceRange(\"foo\\n\", {line: Infinity});</code></p>\n<p>One potentially tricky issue is that if you want to ensure your text starts on a new line, you'll have to prepend it with a \\n if and only if the document doesn't end with a newline. That's app-specific, and I'll leave it to you to figure it out.\n. I hate to add redundancy to the API -- it bloats both the library and the docs. Also, why stop at <code>append</code> and <code>prepend</code>, there are a bunch of other jQuery methods that would apply to CodeMirror, so it'd be a bit of a slippery slope.\n. To the last question -- no, though you can simply do <code>myCM.setValue(myTextarea.value)</code> to get the same effect.\n. Hi Michael,</p>\n<p>I suspect this problem is not CodeMirror related, but has something to do with bad escaping in your pipeline (if you try to read <code>\\0</code> as JSON or JavaScript, you'll get the null character you're seeing there). CodeMirror does not do any (un)escaping or parsing on the strings it gets (except for splitting it into lines), so it is unlikely that the problem lies there.\n. I pushed 1ee8888a0fa49627f9c18bce72accb8b6a04be34 instead, since the number parsing in this code was really broken in a few other ways. Could you verify that it solves your problem?\n. Ouch, that was careless of me. Thanks for the fix, merged.\n. Thanks. Merged.\n. Merged, thanks!\n. I guess it's at least a step in the right direction. Unfortunately, I don't have all the requirements and previous issues we saw with drag/drop in my head, so I can't conclusively say that everything works (yes, we need some kind of super-test-suite that automates clicks and such, but we don't have one yet). Merged.\n. That line came from 942d68ff5b555c9c55193b9876d973692d48d9b9 , which was apparently needed for IE6 compatibility. I merged your patch, since IE6 is no longer a target.\n. Thank you. Merged!\n. Thanks! Merged.\n. Thanks for the quick turnaround (again). Merged.\n. Thanks. Merged. When doing further work, please start by resetting/rebasing to my master branch, so that old patches don't show up in your next pull request.\n. CodeMirror does not currently support using different fonts in the same editor. If line heights differ between lines, you'll get positioning issues (even without linewrapping or folding). See also #176\n. Non-monospaced fonts should be fine. If you can reproduce the problem in a single-font setting, I'd be interested to see the test case.\n. Good catch. Merged.\n. Please end expression-statements with semicolons. Always.</p>\n<p>Why are you rewriting things like <code>moveToWord</code> and <code>goLineStartText</code>? Were the actual problems with the old implementations? Looking at a previous patch (fb6fdbda75bb7d83a0859a5a1802c6de3d91fff8), your implementation of word-movement seems less solid than the old one (a lot of thought went into that, if I remember correctly).</p>\n<p>I'm in the unfortunate position that I don't really know how the bindings are supposed to work <em>precisely</em>, and don't have the time to really study them. So it's hard for me to see whether changes make sense or not.\n. Feel free to change <code>moveToWord</code> to return a cursor location, or to factor the position-finding part of it out into a function <code>findNextWord</code> or so. Replacing moderately-well-tested code with a from-scratch implementation is bound to bring back old bugs. (And having multiple implementations of a piece of functionality is asking for trouble.) So yeah, I was getting a big worried that your changes are making the code lose coherence. If you tighten them up and make sure they fit sanely with the rest, I'll happily merge them.\n. Sure, go ahead and do that. Just, be careful, consider how existing code worked, and try to cause as few regressions as possible.\n. This doesn't cleanly apply to the current code anymore. Could you rebase and open a new pull request?\n. Matching a bunch of very complicated, back-tracking regexps, at the start of basically every single token seems unfortunate. Could you move the matching of numbers that start with # under the # clause, and only run the (non-#) regexps when a digit or [+-] is encountered?\n. Thanks, squashed and committed in 714c05750703bc9c88a545e9654d9bb531bad87d . (I try to keep the main repo history linear, so, for next time, pull requests that are rebased rather than containing merge commits are preferred.)\n. This is not part of XML proper. As such, I don't really think it belongs in the XML mode. I would welcome a patch that adds a hook mechanism to the XML mode to make doing things like this easier (see the hook config parameter in the clike mode).\n. Thank you. Merged.\n. Thanks for the detailed report. The above patch should fix it.\n. Thanks. Merged.\n. <code>getCursor</code> should never return undefined. I can't reproduce this problem (I get a valid cursor even when the editor is not focused.) Which browser are you using? And can you produce a test document that will help me reproduce the problem?\n. Neither of the causes you described (being unfocused, clicking on the button during a replace operation) were very helpful in reproducing this\u2014the problem actually occurs when you start a replace below the last match. The linked patch should fix it.\n. Squashed and merged in c1a6d70f3466cbd2d33be97a533591dae1cbdbda , cleaned up in 5d41701b35f657edb829cc3f84dffa0c72613eac . Try not to use things like Array.prototype.foreach in a library that is supposed to work on old browsers.\n. The spec appears to be down today, so I wasn't able to figure out whether anything should be added to the \"directories\" entry, but I guess that's only used by node to find files, and isn't terribly relevant in browser-targeting libraries.</p>\n<p>Merged. I'll do my best to keep it up to date.\n. This is what <code>refresh()</code> is for. CodeMirror needs to measure its dimensions to be able to update, so it can't do that when hidden.</p>\n<p>http://codemirror.net/doc/manual.html#refresh\n. Sorry, that was careless of me. Merged your fix.\n. The 'proper' way to handle this is to call <code>.refresh()</code> after un-hiding it. http://codemirror.net/doc/manual.html#refresh\n. Thanks, merged. To be able to read it, I had to factor the trailing-whitespace deletion into a separate commit. Such cleanups are definitely welcome, but try not to mix them into actual code commits, because it makes it impossible to read the diffs.\n. Argh! I didn't see those. <strong>Don't</strong> mess with prototypes of standard objects somewhere in the depths of a library. It will trip people up. I'll move them to top-level functions.\n. Those are also pretty indirect and wordy implementations. Does the patch at https://github.com/marijnh/CodeMirror2/tree/regexLastIndexOf work for you?\n. Thanks, good catch. Final patch at ec53be214b3796881501c184f38aa320dff43eef\n. @nlwillia Could you take a look at this?\n. Thanks. Merged.\n. Seems sane. Merged.\n. Thanks. Merged.\n. Thanks. Pushed a slight variation as 306c20f8845b3cf07f9bb4026085308bc8835f54\n. Thanks, merged. But please try to base your pull request on a non-merged (but rebased) branch that contains no irrelevant commits next time.\n. I wasn't able to reproduce this (by changing the configuration of mode/plsql/index.html to match the options you list here, and then clearing the document and typing eight lines with 'from' on them in Chrome 20). Can you put up a demo on http://jsbin.com ?\n. This is a duplicate of #474 which, unfortunately, is a Webkit bug, and not something I can fix on the side of CodeMirror. If you know any Webkit devs, feel free to point their attention towards this bug.\n. It is indeed probably possible to work around this by adding dummy characters to the textarea. CodeMirror v1 was full of such tricks, and it got to be a major maintenance burden to make sure they didn't interact with each other in problematic ways, so I'm really trying to have as few of them as possible in v2.</p>\n<p>That being said, it doesn't seem that the Webkit people are taking any action on this, so maybe a kludge is the only option. Will think about it a bit more.\n. Update: there's a webkit patch that will hopefully make it into master soon. https://bugs.webkit.org/show_bug.cgi?id=49288\n. Not me, but someone else surely. Put it on github, if you haven't already, with a name or description that'll make it easy to find when people search for 'codemirror dojo'.\n. Good idea. Merged.\n. Do this:</p>\n<p><code>function clearMarkers(cm) {\n  cm.operation(function() {\n    for (var i = 0, e = cm.lineCount(); i &lt; e; ++i)\n      cm.clearMarker(i);\n  });\n}</code>\n. Of course it keeps track of line markers, but it would still have to loop through the lines in order to find them. I don't want to add every possible convenience method to the core API, because that would make it <em>huge</em>. Did you benchmark and find my solution was too slow for your needs?\n. Thanks. Merged as 230dad2f40022ed197089a19744eeda979955cfa</p>\n<p>For some reason github (sometimes?) doesn't mail me when a pull request is updated. Hence the slow response.\n. I'm partial to the third solution. That seems the most modular -- the decision on what to hint should be, as much as possible, in the hands of the hint-gathering function.\n. Great! Merged.</p>\n<p>To check against a list of keywords, regexps or objects tend to be much faster than arrays. Also, Array.prototype.indexOf is not present in IE7. If you have time, could you submit a fix for that?\n. Great. Merged.</p>\n<p>There is no 'word' style in the standard set of token styles. Wouldn't 'variable' make more sense there?\n. In Pascal and OCaml, any non-keyword word is a variable, so I guess yes. If you really want something to be unstyled, simply return <code>null</code>.\n. Ugh. Most of these were actually done by me. Not sure what I was thinking. Fixed in 333855ee4a5c7edeb4aa1d6faf206d274d95d300\n. You're using <code>Array.prototype.map</code>. CodeMirror still supports ECMAScript 3 browsers.\n. Merged. Is there any specific reason for updating the demo code in the shell demo? It's demo code, it doesn't have to make actual real-world sense. (I try not to have too many pointless commits in the history.)\n. There seems to have been explicit code to do this added as part of the scrollbar overhaul. I assume it was the result of some kind of confusion.</p>\n<p>@njx : If you had a good reason for this that I missed, please discuss here.\n. I've slightly adjusted the mousedown handler to get the best of both worlds (maintain focus only when we were already focused, but don't cause unfocused editor to become focused).\n. Good one. Merged.\n. Thank you. Merged.\n. Great, thanks! Merged (in squashed form) as 2d14145c743b2388493c595814ebb115f649575e\n. <code>onChange</code> should have enough information to reconstruct exactly what happened. It's not in the easiest format for finding out whether a deletion or an insertion happened (or both), but it can be used for this.</p>\n<p>Alternatively, you could override the backspace key using the <code>extraKeys</code> option, and put in some logic that first looks at the selection. But then you wouldn't be catching other kinds of deletion (del key, overwriting, cut, etc)\n. I've rejected such a change before. For the following reasons:\n- For a tabbed editor, simply create multiple CodeMirror instances, and hide/show them as tabs are changed (remember to call <code>.refresh()</code>). This will also give you scroll and cursor preservation for free.\n- A history object is only valid for the <em>precise</em> content that it applied to. If a single character is different, it'll completely mess up the editor. Exposing it like this seems very error-prone.</p>\n<p>So sorry, no cigar. Try following my suggestion above, and let me know if you run into any problems with it.\n. There are two sources of confusion here:\n- You have to set <code>indentUnit</code> and <code>tabSize</code> to the same number to get the behaviour you expected for the second editor\n- You have to bind the <code>\"Tab\"</code> key to something other than <code>\"defaultTab\"</code> (<code>\"indentAuto\"</code>) is probably what you want in <code>extraKeys</code>.\n. <code>indentAuto</code> is a 'command', which are functions stored in <code>CodeMirror.commands</code>. You can call it through CodeMirror.commands.indentAuto(cm)<code>, where</code>cm` is your CodeMirror instance.\n. Describe 'work'. The problem here is likely to be that your expectations of features don't agree to what the manual says.</p>\n<p>When a keymap points at a string, it will interpret it as a property of <code>CodeMirror.commands</code>. Thus, the two invocations you gave are equivalent (and the second works just fine when I try it).\n. What <code>indentAuto</code> does is reset the line's indentation to the 'correct' indentation that the mode reported. You probably want the <code>indentMore</code> command instead.\n. Thanks, merged. (If you submit more patches against existing files, try to get the indentation right -- most files in the project don't use tabs.)\n. The change object will have a <code>next</code> property if multiple changes happened atomically. Enter-and-indent is such a case (first the newline is inserted, then the indentation is adjusted). Thus, make sure to also iterate over the next property. The <code>text</code> array of a change object will never contain newlines -- it is basically the new content between the given <code>start</code> and <code>end</code>, split on newlines, so it will have more than one element when there were newlines. (It is this way because that array is already available internally in the editor, so it's an efficient format to use.)\n. Thank you. Merged. Did you notice that the indentation in less.js is an absolute mess?\n. Oh, I didn't mean the indentation as produced by the mode. I meant the indentation of the file less.js itself.\n. &gt; When I submit the code on GitHub the indentation alters for some reason....</p>\n<p>Seriously, it doesn't.\n. Ah, um, sure, that might be it. For the sake of all of us, try to learn to use git from the command line, so that you're not dependent on the github web interface for creating commits.\n. Is there any (non-dead) platform that uses plain \\r as line separators?</p>\n<p>I agree \\r's should be stripped, but I don't think they should be replaced with a \\n.\n. Thanks. I hadn't thought of that use-case yet.</p>\n<p>Squashed and merged as 03dba110dc8ec6784e34b70c638f0de43fe0b531 .\n. Heh, seems to make things worse. Closing in favor of 5b9249f3ad1ebbe280510c490fbc8efa29b65ce2\n. Yeah. The whole site was down for half an hour last week, I had to emergency-switch to nginx (from apache), but I couldn't get the (fastcgi) git scripts to work properly with that yet, and ran out of patience.</p>\n<p><code>git clone http://marijnhaverbeke.nl/git/codemirror2</code> should still work. At some point, I'll take another stab at restoring the gitweb.pl thing.\n. Fixed now.\n. If you're using <code>innerHTML</code>, of course you'll get the HTML equivalent of the <code>pre</code>'s content. Use <code>innerText</code>/<code>textContent</code> instead. (But be aware that this does not behave in a fully consistent way across browsers. You can probably find helper functions on the web that provide a more or less reliable way to get a node's text content.)\n. You'll want to remove the <code>overflow: auto</code> from <code>.CodeMirror-scroll</code>. That should take care of the double scrollbar. Did you upgrade your <code>codemirror.css</code> along with your <code>codemirror.js</code>?\n. Thank you. Merged as f20d14e22e868eb6f1c92548dbac569dfa58521b .</p>\n<p>(It is customary in git to use the first line of the commit message as a short description of the commit -- for example, it's what github will show in a list of commits. I changed your commit message to be a one-liner in order to be more descriptive.)\n. Argh. Another casualty of my not-quite-successful server upgrade. Thanks.</p>\n<p>But does it work for you? I'm getting empty script files when I try to use anything but HEAD.\n. I think it is, but github seems to be redirecting them to help.github.com . Maybe some anti-spider nonsense on their part?</p>\n<p>Investigating.\n. Okay, I bit the bullet and figured out why the gitweb cgi script wasn't working anymore (nginx configuration is <em>subtle</em>). My local gitweb seems to be up again, so I reverted the compression page to its old state.\n. Looks great. Merged as 7dcf78f29daa58b5a2c88d209ea1a0bdd38dbb8f , cleaned up (coding style, idioms) a little in 4ca3a57967234a0ac32a2b51ace78f0295c90fd8\n. It depends on <code>mode/xml/xml.js</code>. I see the mode demo page doesn't say that. I'll add it.\n. f1b0385c1a4e74f0468f1e71e517017889f7b79a seems to fix this.\n. Wow, thanks. I don't know how you are always catching such bugs so fast, but I know that I'd be releasing a lot more bugs if it weren't for you.\n. Changes <em>involve</em> cursor movement -- they will put the cursor in a new place. Internally, cursor movement by insertion is not distinguished from any other kind of cursor movement. You could listen to both <code>onChange</code> and <code>onCursorActivity</code> and suppress your effect in the second when it was preceded by the first.\n. In the current version. onChange is called before onCursorActivity. It will almost certainly stay that way.\n. Thanks. Merged as 38870f6d32d956bfa2bc4727039b0cbcde814062\n. Thanks. Merged. Next time, please try to submit a pull request with a single (non-merge) commit, rather than a tangle like this (your history was freely mixing your commits with upstream stuff, and ended with a commit that claimed to be rebase, though it really was a branch merge).\n. There are multiple opinions about how git is to be used. But this works for me:\n- never <code>pull</code> from a branch that might not have all commits you have\n- do <code>git fetch ...</code> and then <code>git rebase FETCH_HEAD</code> instead, so that your branch stays a strict extension of the upstream branch\n- that way, when you submit a pull request, your patches will all be on top, and it's easy for me to integrate them\n. &gt; I think git pull --rebase someremote somebranch is equivalent.</p>\n<p>Thanks! I figured there <em>must</em> be a shortcut for this, but studying the man page for git-rebase never brought it to light.\n. Strange. I tried to apply this from your other pull request, but there it just said \"nothing to commit\", so I assume it had been fixed by some other patch. But it hadn't.</p>\n<p>Applied properly this time.\n. The keys in the 'simple' default completion dialog are handled by the browser's implementation of a <code>select</code> input. There's no obvious way to make the keys that happen to be bound in the editor at that time apply to that widget, since it deals with a completely different set of possible actions.</p>\n<p>You can, of course, rather easily implement your own completion-selection widget or modify the default one to handle these keys.\n. These are things that I'd definitely accept a pull request for, but as they are outside of the scope of the core editor, I'm not going to leave a wishlist bug for it open.\n. &gt; So you don't want to even consider the simple feature?</p>\n<p>As I said, I will accept a pull request.\n. There is a project CodeMirror UI, https://github.com/jagthedrummer/codemirror-ui , which provides some of this.</p>\n<p>But code editors tend to be more specialized than WYSIWYGs, so you'll usually still have to do some detailed configuration yourself.\n. You're, for some reason, reading the docs for version 1, but using version 2.</p>\n<p>Fix that. Then read the new manual (http://codemirror.net/doc/manual.html) to figure out that sizing is now done with CSS</p>\n<p><code>.CodeMirror { width: 100%; }\n.CodeMirror-scroll { height: 500px; }</code>\n. You can do <code>instance.getWrapperElement().style.width = ...; instance.getScrollerElement().style.height = ...;</code>, but I assume that if your editors have different size, they also have a different position in the DOM, so it should be easy to target them with more involved CSS selectors.\n. There is no concept of an atomic 'block' of text. You mark a range to be styled differently, but it'll still all be editable. Moving things around can be done trivially by inserting and removing it at different points of the document.\n. Thanks! Merged.\n. Great. Merged.\n. I think you're referring to #598 though, from the super-cryptic description, it's hard to tell anything.\n. Please provide more detailed steps on what you're doing, what you're expecting, and what you're seeing.\n. Yeah, that too. I can't reproduce on Chrome 20, and since I still don't know how much of the line you're selecting, whether you cut and paste with keyboard or menu, whether you leave the text selected when pasting, etcetera, and you don't seem to be interested in telling me, I'm closing this for now.\n. &gt; Today there was a Canary update and it seems to be fixed.</p>\n<p>That's great to hear.</p>\n<p>Don't apologize about reporting bugs. Just realize that when I ask for more information I'm not just trying to annoy you. There was nothing in the original report that indicated that you placed the cursor at the end of the line before pasting, so there simply wasn't enough info for me to figure out how to reproduce.\n. Can not reproduce. Which browser, which document, what exactly are you selecting, and which argument are you passing to <code>replaceSelection</code>?\n. Yep, I can reproduce now. So the problem is that the marker isn't properly cleared, not that the text isn't replaced. You could have at least mentioned that markers were involved...</p>\n<p>Looking into it.\n. Seems to be okay now.\n. Neat. Merged as 96b5193affc9bf1610726cab88f97029de1dbb5d and improved a bit in 404257d4311970f270c6e93a36124744b2347d46\n. Are you in standards or quirks mode? (I.e do you have a valid doctype at the top of your documents? <code>&lt;!doctype html&gt;</code> should do it.)</p>\n<p>If you're already in standards mode, or switching to standards mode doesn't fix the problem, can you spend some more time trying to produce a minimal demo of the problem? It is hard to debug a .mov file.\n. @fazeofwitch So, I can't really explain what IE is doing here, but if you replace your doctype with simply <code>&lt;!doctype html&gt;</code> (as is recommended now), the problem goes away. IE does report that it is in standards mode when given your doctype, but apparently it has several kinds (?) of standards mode.\n. I've updated the project page to mention that transitional doctypes still don't cause IE to behave.\n. If I follow your steps, pressing tab indents every line an extra tab, pressing shift-tab neatly and correctly re-indents the whole document using tabs instead of the default two spaces.</p>\n<p>This is the intended behavior. If you don't like it, it is customizeable by binding different commands or user-defined functions to the relevant keys.\n. Occurs only intermittently for me, so hey, what do you know, it would again have helped if you had described the precise thing you were seeing, rather than saying something is '<em>broken</em>'.</p>\n<p>Regardless, thanks for the report, I was able to track it down and it should now be fixed.\n. It was a bug in the test. Fixed in bd76355eb44671ca23d1c03eb38c68985f7b70f3\n. I've only found out this week that there's is actually a difference between transitional standards mode and <em>real</em> standards mode, even though both are shown as 'Standards mode' in the developer tools. IE will report bogus <code>offsetTop</code> values in transitional standards mode, but behave properly in the mode you get with <code>&lt;!doctype html&gt;</code>.</p>\n<p>I've updated the browser support info on the project page to reflect this.\n. This would be relatively easy to do. We're already replacing tabs with special spans, we could do the same for non-printing characters.</p>\n<p>Do you have a list of characters to which this would apply? I guess the lower ascii values would be good, byte-order marks (if it's even possible to get those into a JS string), zero-width spaces... anything else?\n. They have a 'title' (hover) attribute showing their character code. Would it help if they also received a class like \"char-xxxx\" where xxxx is the character code? I agree 'illegal' is a bogus name for these, I'll update that to something more meaningful in version 4.\n. I've made the set of marked characters, as well as the way they are marked, configurable in attached patch. I don't want to change the default behavior.</p>\n<p>And indeed, I took your quotes around \"illegal\" to mean that the term was inapplicable, but now I see that CodeMirror calls them \"invalid\" (which also doesn't make a lot of sense), not \"illegal\".\n. (Hold on. That patch is broken. Debugging.)\n. That should help.\n. That's the entire point of the <code>specialCharPlaceholder</code> option -- put a function in there that, given a character, returns a DOM node with the title/content/whatever that you want to see there.\n. Yes, the extra regexp is needed to make it cheap to scan tokens for such characters. But you typically <em>won't</em> need to define the char codes in two places, unless you have non-uniform nodes to represent the tokens. Your placeholder function (you're defining it unsyntactically in your snippet) could look something like</p>\n<p><code>specialCharPlaceholder: function(ch) {\n    var node = document.createElement(\"span\");\n    node.innerHTML = \"\u00d7\";\n    node.className = \"special\";\n    node.title = \"Character U+\" + ch.charCodeAt(0).toString(16) + \" \" + (charNames[ch] || \"\");\n    return node;\n  }</code></p>\n<p>And then define your table something like:</p>\n<p><code>var charNames = {\n  \"\\x00\": \"Null\",\n  /* etc */\n};</code>\n. I can reproduce this. It seems to stem from the fact that CodeMirror doesn't have a concept of a 'forward' and 'backward' cursor (i.e. whether to show the cursor before or after the break when it is on a break in a long line). I thought we could get away with not having this complexity, but it seems that <em>does</em> cause problems.</p>\n<p>Will think on it.\n. With that patch, the cursor at least doesn't get stuck anymore. It still behaves oddly, in that it'll end up <em>before</em> the last dash on the part of the line before the wrap, but at least it'll move in the generally correct direction.</p>\n<p>This is probably all I'm going to do about this bug in the near future. A full fix seems like a lot of complexity.\n. The two features don't interfere -- at least, not in a way that's obvious to me at this point.\n. This is a duplicate of #176 \u2014 in some fonts, bold/italic changes the height of the line.</p>\n<p>Adding <code>line-height: 1em</code> to the rule usually fixes it.</p>\n<p>For a more solid solution, donate to the fundraiser at <a href=\"http://pledgie.com/campaigns/17784\">1</a>, which will cause me to fix bug #176 .\n. Great. Merged.\n. Look into the section of the manual on writing a mode <a href=\"http://codemirror.net/doc/manual.html#modeapi\">1</a>, it's actually pretty easy to do basic coloring for a new language.</p>\n<p>I'm going to close this, though. That's not to say it's an invalid issue \u2014 it's just that there's tons of possible languages that we could support, and I don't want them cluttering up our bug tracker.\n. I'm not reopening this. Issues are for things that I actually consider working on. New modes are an endless source of long-lived issues that I don't want cluttering up the list.</p>\n<p>I've set up https://github.com/marijnh/CodeMirror/wiki/Mode-wish-list to track mode wishes.\n. In general, I prefer sub-modes, since new modes for similar languages tend to copy-paste a lot of code, and thus make later maintenance more painful. However, I'm not sure how much trouble it would be to hook a brace-less language into the CSS mode. You'll have to see.\n. The tricky part might be dealing with line breaks -- a CodeMirror mode can't look beyond those when parsing a single token, but it is likely that a tokenizer written for another context expects to be able to.\n. Unless this language is somehow extremely hard to tokenize, you'll probably get better results by rewriting the lexer to match CodeMirror's model than by trying to somehow bridge the two.</p>\n<p>To do something like multi-line comments in CodeMirror, you must keep state, so that the next time .token is called, it still knows that it is inside a comment.\n. Yes, I noticed that yesterday as well. It's a bug in 2.31, fixed in current HEAD (which you can consider stable). I'll do an emergency release to prevent this from spreading too far.\n. Hey Jeff,</p>\n<p>Sounds like a serious bug. The link is indeed a 403. If you can fix that, I'll gladly look into this (will probably not have time this week, but next week).</p>\n<p>Best,\nMarijn\n. Also, try upgrading to 2.32 -- the scrolling model was changed in 2.3, which <em>might</em> have fixed your problem as a side effect.\n. Closing until further notice.\n. Neat. Seems to work very well, both locally and on Travis. Merged as 35e89c5e65f3b324cd3e53c296d8f1ed0f07246d . I may end up replacing it later with some multi-browser set-up if one proves practical, but for now, this is 1000% better than what we used to have.\n. Committed 42dac6a5a0f5af92d5c31ba70b445d2506e003b3 instead, which is more in line with how similar options are handled.\n. Thanks! Merged.\n. Merged the double-semicolon fix. The <code>indentUnit</code> and <code>tabSize</code> options you gave are already the default. There are several files with tabs already in the distribution (<code>demo/visibletabs.html</code>, grep through the mode directory to find others).\n. Hi Matthias,</p>\n<p>This does not have to be integrated in CodeMirror itself. If you just, in your code, do</p>\n<p><code>CodeMirror.commands.delSpaceToPrevTabStop = function(cm) { /* your code here */ };</code></p>\n<p>you can add a command. Or, even simpler, just associate the key with that function directly, without going through a command.</p>\n<p>As I don't want to bloat up core CodeMirror with lots of useful but niche commands, I am not merging this.</p>\n<p>Best,\nMarijn\n. Using for/in to iterate arrays isn't recommended -- it'll go wrong if anyone does <code>Object.prototype.something = ...</code>, and in a library, we have to consider that possibility. Comitted 42be39b1505fb247d8d7882999c6885dcbbe2ea7 instead, which has the same effect.\n. And I have another potential fix at 9b56986d42a4d2abae462a2a0025715333558d59 -- at least, I can no longer reproduce this with the current code.\n. This appears to be working again, by patches 9b56986d42a4d2abae462a2a0025715333558d59 and 37476d5bb3604c7d1771b2716e8173fd7b3460a0\n. This was (before I even saw this pull request) fixed in a slightly different way in response to issue #663. See 9b56986d42a4d2abae462a2a0025715333558d59 .\n. Try this for a version that's actually efficient: http://jsbin.com/ihunin/90/\n. Ah, yeah, pressing del won't update the selection, and thus won't call <code>onCursorActivity</code>. Probably the best solution is to define the same handler for <code>onChange</code> and <code>onCursorActivity</code>.\n. I can't detect any slowness in http://jsbin.com/ihunin/95/edit\n. This is because gutter updates are currently 'global' -- the whole gutter has to be redrawn when it changes in any way. This code causes a <em>lot</em> of gutter updates, and it seems Firefox is no champion with DOM building (I couldn't detect the slowness on Chrome).</p>\n<p>The changes to the gutter implementation that are planned for the near future (this month, I think) will hopefully help a lot here.\n. Merged.\n. Yeah, css is pretty limited for things like this.</p>\n<p>If you can come up with a better solution, or want to create a gray arrow background (to be right-aligned in the span element) to use instead of the arrow character, that'd be very welcome.\n. How about the above patch? It's super-simple, and makes the tab 'icon' clip to the actual size of the tab, making it possible to visually distinguish \"[space][space][tab]\" from just \"[tab]\".\n. See 65651f9bdbc580292c020fd85d2707984642de26\n. Changed the scroll model to no longer explicitly catch wheel events in dae1574e65871428a0349b5beb220b7c6d79d783 . That makes this problem go away.\n. This is a known issue, but I consider it to be acceptable behavior. On the one hand, it's nice if undo really goes back to the old state, but on the other hand, replacing text will remove any markers on it, and delete+undo can be seen as a replace operation.</p>\n<p>On the practical side, doing this properly would reduce the efficiency of the undo history implementation quite a bit, and complicate things significantly, so I'm hesitant to make that change.\n. Could you try to see if you can still reproduce with that patch? (I can't, but I could only reproduce intermittently before, so I'm not sure I really got to the root of it.)\n. This is, unfortunately, just the way it is. The selection is not, in the DOM, an actual ancestor of the selected text, so there's not much you can do with CSS rules. What I've been doing (for example for search term highlighting) is to use transparent colors for marked text backgrounds, so that the selection can shine through.\n. (never mind, was just repeating myself from above after not properly reading the new comment)\n. Yeah, but, as usual, I'm not really interested in problems on cutting-edge browser versions. Let's talk again when they occur in a beta.\n. Thanks. Silly mistake on my part. Merged as f888e0dfa635123737f310169392d1fdad3b092a\n. Looks good. Merged.\n. Thanks. Merged.\n. Thanks! I thought I had caught all of those, but apparently hadn't. Merged.\n. This is a duplicate of #294 . Chances are, I'll have some time to look into this sometime this month.\n. Hi Matthaus,</p>\n<p>You are using version 2.32, right? This is a bug I think I fixed earlier\nthis week. The development snapshot should not exhibit this problem. (Let\nme know if it still does.)</p>\n<p>Best,\nMarijn\nOn Aug 2, 2012 2:26 PM, \"mys3lf\" <a href=\"&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#10;&#114;&#101;&#112;&#108;&#121;&#64;&#114;&#101;&#112;&#108;&#121;&#46;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;\">&#10;&#114;&#101;&#112;&#108;&#121;&#64;&#114;&#101;&#112;&#108;&#121;&#46;&#103;&#105;&#116;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a>\nwrote:</p>\n<blockquote>\n<p>Hey,</p>\n<p>I tried the setSize method and it's doesn't work properly with both a\nvertical and an horizontal scrollbar. When the written text exceeds the\nwidth and the height of the editor it's not possible to scroll to the last\nline. The last line is always hidden behind the vertical scrollbar.\nIf you want to reproduce the error just add editor.setSize(300, 300); in\nline 69 to the complete.html in the demo folder.</p>\n<p>best regards\nMatth\u00e4us Gdaniec</p>\n<hr />\n<p>Reply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/686\n. Closing on the assumption that my fix did help. Comment if the problem still occurs.\n. I actually have been thinking of a way to seriously reduce this footprint by no longer storing the individual token styles, but just recomputing them from stored parser state during rendering. That'd eliminate the <code>styles</code> array in <code>Line</code> objects.</p>\n</blockquote>\n<p>The size of the <code>stateAfter</code> object can be tweaked by modifying individual modes. For sites where memory footprint is an issue, it'd be possible to write a simpler, crappier, state-less or minimal-state mode, which doesn't highlight and indent as precisely, but also doesn't allocate big state structures. That would make it possible to cut down the overhead to a single object and a single string per line (plus tree chunks, of course).\n. I've looked seriously into removing the <code>styles</code> arrays, but, while it would certainly be viable to do so, I don't think it is a very good idea. It would cause a some work\u2014the parsing\u2014to be repeated (a lot), and remove a bunch of nice properties (the <code>getHTML</code> method being dependent mostly on state already in the line object, and being able to detect whether it changed any styles).</p>\n<p>So for now, I'm not going through with this. I kept the work in a branch that I may at one point get back to.\n. I think that's about as far as we can go here. Closing. Add more comments if you see more opportunities.</p>\n<p>(@jankeromnes Also if you could run your benchmark again and compare the memory use in the new situation with the old, and post numbers here, that'd be interesting. Use the master branch, to make sure you're not accidentally testing some other change made in v3.)\n. A lazy runMode variant wouldn't be hard to do, but is out of scope for the library itself. Look over runmode.js -- it's 50-odd lines, and shouldn't be hard to duplicate in a way that suits your use case (you'll have to do some magic with scroll handlers and estimating the height of the scrollable content). But of course, yes, you can also simply use CodeMirror normally (though that'll also eat some memory for a 10mb file).\n. Hah, thanks. I hope you wrote a script to do that. Merged.\n. <code>getHistory</code> and <code>setHistory</code> were added in 2.32. Upgrade, and they should be available.</p>\n<p>The <code>onChange</code> callback can be used to get precise information about changes that occur in the editor. It passes a data structure that not entirely trivial to interpret, but is described in the manual.\n. &gt; I just wondered whether there's a better way or not.</p>\n<p>Unfortunately, not really. I'm not storing the old text in change objects because that old text isn't being used for anything internally, and gathering it would cause some extra work. I would accept a patch that adds an <code>onChangePassOld</code> option which, if true, causes the replaced/deleted text to be added to onChange info objects. If performance is important to you, you could consider writing that.\n. Thanks. I had those in there because of the idea that accessing non-existing properties was a performance hit. At one point, Firefox's (precursor of) strict mode errored when you did this, but I guess by now all implementations have learned to also inline-cache lookup misses. I hadn't expected that those null properties would take up <em>that</em> much space.</p>\n<p>Merged.\n. There is already functionality for this, though it is broken in 2.32. If, in the current development snapshot, you set <code>Tab: false</code> in your keymap or extrakeys, CodeMirror will not interfere with tab key events at all, and tab will allow you to switch focus.\n. Note that mobile browsers are currently not supported, and no testing is being done on them.</p>\n<p>I do have some plans for making <code>CodeMirror-scroll</code> overlow auto again, because it would also solve some scrolling issues on desktop browsers.\n. Yeah. I try to not break it any worse than necessary on mobile browsers, but am explicitly not supporting those, since they have tons of strange quirks that make it very hard to get a <em>really</em> correct experience on them.</p>\n<p>I've added a note about mobile browsers to the project page in 1c8ac0daef20df112fae14e2aaaae8b33f27eb24\n. That patch should solve this problem. (Though I didn't test. Reopen/comment when it is still broken.)\n. Thanks. Fixed in 835776da4bb7048414087c117f2da68adf1625d7 .\n. Indeed. Fixed in dad0bd1d7b994c98f125ccb93a97a74dca8ecc28 . I hope to set up a bunch of headless tests at some point, but I can't find a drop-in package for that, so it'll be a bunch of sysadmin work. Man I hate sysadmin work.\n. Oh, I see, my brain somehow refused to see the part about IE7, and I only tested IE8.</p>\n<p>I could fix one of the IE7 issues, the other three are related, and something that I'm not sure I want to spend much more time on (it's a corner case bug, related to the various problems we saw with the last character on a wrapped line).</p>\n<p>Maybe it's time to introduce the concept of expected failures to the test suite.\n. Done in 264ccbd69ad9794b3761d6f964927bd7b1c76322 and df21300d6b83e8dc1922d5efd526658086614383\n. This is awesome. I had the belief, from a variety of blog posts and experiments, that you can't really beat <code>innerHTML</code>'s speed with direct DOM manipulation. Guess that doesn't hold.</p>\n<p>The 2\u00d7 claim seems exaggerated, but I did see a speedup in the 10%-20% range on most browsers, and a slight (5%) slowdown on Opera. Combined with the reduced worry about XSS, this seems definitely worth it. Merged.</p>\n<p>You had a bug in the handling of lower ascii characters in <code>getElement</code>, as well as a bunch of seriously slow code (accumulating a separate text node for every character), which I've fixed in e236f8a963f2ac72628fba5a9a73033a653c90f5 .\n. Looks good. Merged.\n. Not really an 'issue', but, register a change event handler on your dropdown, and when it fires, call `.setOption(\"mode\", ...)\" on your editor instance with the right mode name, object, or MIME type.\n. Now look at http://jsbin.com/ihunin/109/edit . It'll still exhibit the behavior you describe, but only throw up a single alert so as to be sanely testable.</p>\n<p>Next, paste the content of one of the editors (HTML or JS) into the editor. And edit the first line again. The alert shouldn't appear.</p>\n<p>When detecting whether highlighting is unchanged (in order to stop highlighting), the editor will ignore lines with less than 10 characters and less than three tokens. Also, it'll only stop after three unchanged lines are found. This is to protect against false positives.</p>\n<p>And, as you found, if you want actual control, you can define a <code>compareStates</code> method.</p>\n<p>So, it seems, there is no 'bug'.\n. Thanks. That was indeed completely missing. Merged.\n. Let me guess, you used <code>insertAdjacentHTML</code> because of your \"<code>innerHTML</code> is bad\" rule?</p>\n<p>Correct me if I'm wrong, but is there any way in which <code>insertAdjacentHTML</code> is less XSS-prone than <code>innerHTML</code>? They both take HTML, parse it, and add it to the document.</p>\n<p>Anyway, you also did mess up the indentation in this pull request. I've committed a13c788dd2b714eef0702c468fee24f05e86ebb8 to fix the issue with a simple use of <code>innerHTML</code>.\n. Agreed. You got the point where to do this precisely right. Merged.\n. You completely missed how the disconnect parameter works. It causes the function to return a disconnecter function after registering the handler, not to actually disconnect anything.</p>\n<p>Also, the mousewheel code is gone in the current master branch, so you probably shouldn't waste time on it.\n. This is equivalent to <code>{from: cm.getCursor(true), to: cm.getCursor(false)}</code>. I'm trying to keep API size under control, and have in fact rejected a very similar pull request in the past. So, sorry, I'm going to hold off on this.\n. Ok. So what is the question / issue?\n. That would be possible, but it wouldn't help much. Your onChange handler needs to be able to handle chained change events anyway, since it's also possible for change sets to not be continuous (i.e. contain gaps).</p>\n<blockquote>\n<p>Heh, I basically want to know how to go about writing tests to cover those 3 points.</p>\n</blockquote>\n<p>Basically, set up a program that causes these things to happen, and then check whether the outcome is what you expected. You won't be able to trace individual <code>replaceRange</code> calls, but you <em>can</em> verify that the resulting content is consistent with what you expect.</p>\n<p>There are some tests similar to this in <code>test/test.js</code>.\n. There is no exhaustive list of cases. Anything that uses calls to <code>operation</code> may make several changes in one operation, which will result in one call to <code>onChange</code>.</p>\n<p>The empty change object from indentation is useless, and i've made a change to suppress it (6895f56af9c3dfbac0df5f05377eaf62f0a8815b), but it really shouldn't matter to your algorithm -- if you don't handle change objects in any form, you <em>will</em> run into trouble.\n. Read up on the <code>electricChars</code> option: http://codemirror.net/doc/manual.html#option_electricChars\n. &gt; But still, In the case i mentioned above, there is no 're-indentation' -</p>\n<blockquote>\n<p>So not sure why multiple change objects. But then I might not be able to\nsee some cases where it is helpful.</p>\n<p>Are you sure there isn't? If I paste that into the default javascript mode\ndemo, which has indentUnit set to 2, it'll move the line back by two spaces\nwhen I type the brace. It might also, depending on your settings and the\nkind of whitespace you have in your original document, be replacing tabs\nwith spaces or vice-versa.</p>\n</blockquote>\n<p>In any case, I've verified that when the indentation does not change, no\nonChange event is generated for it.\n. You seem to be explicitly using an old version of CodeMirror (the gist)\nwhich does not have the patch yet that I created in response to your\nearlier problem.</p>\n<p>This is the same problem.</p>\n<p>Please try a little harder to not waste my time.\n. There is no proper way to fire events from JavaScript. You could look into Selenium, which runs a browser and simulates key and mouse actions. See http://seleniumhq.org/\n. Thanks, merged as 436fa0532bd8853b461704c741bb6bfdf913a320</p>\n<p>Please start a new <em>branch</em>, based off my master branch, for your next pull request. This one has all the cruft from previous pull requests still in it, so it's hard to figure out which patches you even mean.\n. When I add a textarea with autofocus set to true to a document, even if another textarea has focus, it <em>does</em> get focused. At least on Chrome. I think CodeMirror should mimic this behavior.\n. I'm leaning towards keeping the current behavior, with the change that <code>fromTextArea</code> adds autofocus if and only if the textarea it's called on is focused, rather than looking at the autofocus attribute.</p>\n<p>I think people setting the <code>autofocus</code> option explicitly really want the editor to be focused.</p>\n<p>Also, we can't implement the precise spec here, since we can't really observe whether the browser 'has already reached the last step of this list of steps' -- we can only use heuristics to approximate that. I think a simple rule (autofocus == focus on init) is better than a complicated, incomplete heuristic.\n. Good catch. Merged.\n. This seems to be some bizarre Chrome thing. Once the scrollbar scrolls a bit, or you get into this position by some other route, the behavior doesn't occur and clicking on the scrollbar causes normal scrolling. I haven't been able to isolate yet what causes it to go into this strange mode. There's no CodeMirror-side events happening when this happens, and the thing under the mouse is <em>really</em> the scrollbar (at least, if I select the element at that position using dev tools, I get the scrollbar div).\n. See that commit for a workaround the solves the problem for me. Does very much look like a browser bug, but I can't reproduce in a non-CodeMirror situation, so I haven't taken the time to actually report it to the Chrome or Webkit projects.\n. Merged. But try not to lump changes to central components into pull requests that advertise themselves as applying only to a certain mode.</p>\n<p>Font choices are a subtle thing. I prefer to leave the exact choice to the site that deploys CodeMirror, and simply use the browser's default monospace font (which, on my Linux setup, looks better than Courier) by default. Thus, I left out your last commit.\n. I agree with Pavel that this seems needlessly obscure, and, ultimately, not very useful.</p>\n<p>I'm in the process of overhauling the gutter system, but I think I'll stick to HTML-insertion as the way to add widgets. It would be useful to hear <em>why</em> you needed this.\n. Cute. Merged.\n. Why would we move that <em>to</em> a <code>for</code>/<code>in</code> loop when a regular <code>for</code> loop works fine?\n. Ah, right, I did change that a while ago.\n. How about moving the attribute check and <code>= true</code> fallback into the <code>catch</code> branch? Your patch creates a situation where, A) the focusedness of the source textarea is ignored when it doesn't have an autofocus attribute, which is not what I wanted, and B) things might be focused out of the blue even though there's no actual focus present (on IE), which also doesn't seem so great.</p>\n<p>Could you provide an example of a situation where the editor loads before any element has had time to become focused?\n. I think that patch should take all considerations into account. Please reopen if you find a problem.\n. Looks good. Merged.\n. Messing with the DOM structure of the editor is <strong>not</strong> supported. The line might not even be visible (rendered) when you do this. If you want to remove a line class, call the <code>setLineClass</code> method again, with a <code>null</code> class.\n. Either keep track of the line handles that setMarker returns, or do\nsomething like this to efficiently clear all markers:</p>\n<p><code>instance.operation(function() {\n  for (var i = 0, e = instance.lineCount(); i &lt; e; ++i)\n    instance.clearMarker(i);\n});</code>\n. Hi Joost,</p>\n<p>I've opted to change the behavior to match the docs instead, since returning an empty string seems a bit too random, especially with <code>next()</code> returning undefined in that situation. Had to fix two lines in the Less mode that depended on this being a string, but the other modes seem okay.</p>\n<p>Best,\nMarijn\n. If I go there, I get a bunch of 404 errors because the linked scripts aren't found.</p>\n<p>If I change them to point at the http://codemirror.net/ (thus, the latest git version of the code), I get an editor that appears to work fine.</p>\n<p>Could you try with the current dev snapshot, and see if it solves your problem? If not, could you at least give <em>some</em> description of what the problem looks like.\n. Merged!\n. I'm working on a new scrolling model (tracked in #730) that I think will fix this. It's a pretty bizarre hack (basically, making the scroller bigger than the wrapper, in order to hide its scrollbars, and then compensating for this with padding and overflow: hidden on the wrapper), but it seems to work on all supported browsers.\n. The v3 branch now contains the solution outlined above. It seems to work.\n. That's not surprising. I haven't debugged at all on Lion, so there's bound to be some issues with A) getting the fake scrollbar div to even display its scrollbar (it's probably getting its width set to zero since scrollbars take up zero space), and B) correctly handling mouse clicks in that scrollbar.</p>\n<p>Will you have time to debug this somewhere this month?</p>\n<p>I tried to install Mountain Lion on my old MacBook Pro (couldn't find 10.7 in the app store), but it claims that the computer isn't compatible with that version (though it meets all the requirements listed at http://support.apple.com/kb/HT5444). So, since I don't currently have much intention to pay large amounts of money for a new Apple laptop, I am not able to test and debug this.\n. With the above patch, scrollbars seem to work for me on Lion (which I managed to install through a somewhat creative process) on v3. In 2.x, I intend to leave things as they are (fake scrollbar disabled, so flickering present, but otherwise all should be fine).\n. [I wrote in private mail to @njx:]</p>\n<p>About the throw-scrolling -- my mac, for some reason, only does very\nlittle of that (when I throw-scroll with the touchpad, it stops after\nsome hundred pixels, probably a property of the touchpad somehow), so\nI wasn't able to reproduce your problem. How did you come up with the\npointer-events solution? I have two problems with that thing -- it is\na very inefficient (* as last element) selector, and it breaks certain\nuses of the editor (mouse events in the content editor no longer had a\nmeaningful target property, which some people are using to find out\nwhich token was clicked). So I feel rather strongly about not using\nthat solution. Do you know what, precisely, causes this? I guess it\nhas something to do with the fact that we're messing with the DOM\nduring scrolling. Maybe the trigger is the removing of the element in\nwhich the scrolling started? That would be consistent with\npointer-events: none fixing it. We could experiment with a hack where\nwe detect (by listening for mousewheel events) the starting target\nnode, and then temporarily refrain from removing it from the DOM.\nThis'd be ugly, for sure, but still less invasive than killing pointer\nevents. Do you have time to try this? (I would, but since I can't\nreproduce the problem, I can't really experiment with it.)\n. Strange. In both Chrome dev tools and Firebug, I seem to be getting accurate results now when I inspect elements with the mouse. Could you put up a simple demo of the thing that is going wrong (on jsbin or so)? Does it happen in all browsers?\n. The touchpad on my mac, even if I tweak its settings, doesn't throw-scroll further than about 100 pixels, so I'm still not able to reproduce this myself.</p>\n<p>The fact that viewportMargin impacts this bug is interesting. It does support the theory that the dom mangling is triggering the problem. In the new wheel handler (which does <em>not</em> manually handle wheel events, by the way, see <a href=\"http://marijnhaverbeke.nl/blog/a-pathological-scrolling-model.html\">this</a> ), there's call to <code>updateDisplay</code> passing it a <code>{top, bottom}</code> viewport object. It sounds like it should be possible to tweak this to be a bit more liberal on Safari, which, if removal of the target node is really the problem, might help. But actually, isn't the <code>target</code> of a wheel event always the scrollable container? It could also just be the messing with its content in general, or the absolute positioning that a viewport update does that causes this issue.\n. Awesome!</p>\n<p>How about this more minimal version, which also conditionalizes the hack on <code>mac &amp;&amp; safari</code>, does that still work for you? dd0eb9ef86861ece15527a0543da210892f701dd\n. Applied a slight variation of that fix. Thanks a ton for helping me out on this!\n. @njx Aha. That explains why the Chrome dev tools people were seeing something similar. I've updated the patch to use <code>webkit</code> rather than <code>safari</code> for its browser test. Could you verify whether that helps (and that this is not in fact a different problem)?\n. Cool. I'll close this. (Also @repenaxa)\n. Would feature-decting the <code>setDragImage</code> function, instead of having an explicit browser check, work here? I suspect that'd be more robust and future-compatible.\n. I'm confused. What error? Do you mean old Opera versions have non-working <code>setDragImage</code> method?</p>\n<p>What would be wrong with using <code>if (e.dataTransfer.setDragImage)</code> instead of <code>if (gecko || chrome)</code>, maybe wrapping it in a <code>try/catch</code> if there are known <code>setDragImage</code> implementations that raise errors?\n. Okay, I've done it like 14bf21c47c0468e1df12b34d242c24141e628ef5 instead then, for the reason mentioned.\n. <code>fixedGutter</code> is, most likely, on its way out. As you noticed, it is flaky (jittery), and in the new gutter and line-height model that version 3 will use, there's no efficient way to implement it. If people care a <strong>lot</strong> about this feature, I could implement it in an inefficient way (requires walking N nodes and repositioning them on every horizontal scroll event, where N is the number of visible lines -- and would still be jittery). But personally, I'm not too fond of the feature.\n. See https://groups.google.com/forum/?fromgroups#!topic/CodeMirror/mSFsEmhn1Cs%5B1-25%5D</p>\n<p>If a fixed gutter is a requirement for Webkit integration, I'm willing to take that seriously. The main problem is that line numbers need to be vertically positioned relative to the line that they are part of, so they are children of that line in the new model. To have a moving gutter, they'd have to be horizontally positioned relative to that gutter. I know of no way to obtain that effect in HTML/CSS, so we'd have to resort to changing their position through a script that reacts to scroll events. This script will, on most browsers, only run <em>after</em> the actual scrolling took place, so you'll get the jitter you noticed -- the numbers first move, then snap into place again.\n. Thanks for the details. The main motivation behind positioning the line numbers inside the lines that they belong to, instead of in a separate gutter element, is performance -- repopulating the whole gutter every time something changed is quite expensive in the current codebase.</p>\n<p>But I guess would be possible to still provide this model in version 3, and turn it on when <code>fixedGutter</code> is active. I'm not making a decision on this right now, but I'll think about it some more.\n. The v3 branch now contains a working implementation of a fixed scrollbar (that even handles varying-height lines). I won't fix this in the v2 series (too invasive to do in a backwards-compatible way).\n. Looks good. Merged as 81c018de24333a287b2e610e63b94d27cb00a926 and 6e56a89142e787e75227027deb1512194d7b646f .\n. Hi Peter,</p>\n<p>This does indeed sound like a browser bug. You didn't mention which platform you are on. I can't reproduce this on Linux, using the same Chrome version.</p>\n<blockquote>\n<p>Ideally, it should end flush with the border in that case too. But that's probably a separate issue</p>\n</blockquote>\n<p>That's a matter of taste. You can set <code>padding-right: .4em</code> on <code>.CodeMirror-lines</code> to get the effect you're looking for.</p>\n<p>Best,\nMarijn\n. So, given the fact that the gutter is, in the drawing order, provably above the selection div, and there are more glitches showing up, I can only blame this on a browser bug. Since I can't reproduce, I'm not going to be able to find a workaround. Closing this. Patches with workarounds (assuming they are not too invasive) would still be welcome.\n. I can confirm this. But I can also confirm it with the below minimal document:</p>\n<p><code>&lt;textarea&gt;&lt;/textarea&gt;\n&lt;input type=button onclick=\"document.body.webkitRequestFullScreen()\" value=\"Fullscreen\"/&gt;</code></p>\n<p>I.e. a plain textarea suffers from the same issue, so this is definitely a Webkit bug, not a CodeMirror bug.</p>\n<p>I'd appreciate if you could try to report the issue to the Webkit developers (or confirm that it's already in their bug tracker). It seems major and obvious enough for somebody to notice, but you never know (the fact that this is in stable Chrome is not a good sign).\n. Thank you. Merged.\n. Thanks! Merged.\n. May I ask why you are wrapping it into a requireJS module when it is already doing its own namespace wrapping?\n. Makes sense. I've made the change.\n. @heruan Try the <code>v4</code> branch (which should be relatively stable at this point). It has built-in support for requirejs (the codemirror files behave as proper amd modules when an amd loader is present).\n. &gt; to let the developer choose RequireJS module names &gt; paths mapping (as it should be).</p>\n<p>Why? The way I understand it, you can put the CM tree anywhere you want, and require it with or without prefix as you see fit, even though the modules internally use relative paths to refer to each other.\n. You can already put the files anywhere, just make sure you point whatever you use to actually include them from <em>your</em> code at the right path.</p>\n<p>If the requireJS optimizer doesn't properly resolve relative paths, that sounds more like a bug in that tool.\n. Use the <code>packages</code> configuration option in requirejs to configure your path to CodeMirror, as in <a href=\"http://codemirror.net/demo/requirejs.html\">this demo</a>. I believe that'll help.\n. That seems to solve it for me.</p>\n<p>(You'll still, on some browsers, get bad vertical cursor placement when viewing a big document in a self-resizing editor. The fix for that is in the v3 branch, but won't make it into the 2.x releases.)\n. I'm going to deprecate the document in favour of a series of blog entries. http://marijnhaverbeke.nl/blog#cm-internals . Writing still in progress.\n. Hi,</p>\n<p>These languages are written right-to-left, contrary to most other languages. Issue #294 is open on this, and in fact I spent the past few days working on it. There's an experimental solution in the v3 branch of the git repository. It's not ready for release yet, but if support for this is important for you, you can help test it.</p>\n<p>Best,\nMarijn\n. Thanks, merged. I've added some logic to the linter (which is run as part of the test suite) to complain when it finds a BOM. See 3d787908adcba42a8565bf9ee45d39505ab5b8f8\n. You'll want to set the <code>indentWithTabs</code> option to <code>true</code>.\n. Ah, then bind <code>Tab</code> to something that doesn't actually insert tabs. For example, add this to your options:</p>\n<p><code>extraKeys: {Tab: \"indentMore\"}</code>\n. That would include all editors that bind the tab key to 'insert tab', I guess? Are you expecting me to add an exception to the core that turns off tab when the language mode happens to be Python? (Not going to happen.)\n. Implemented in bf1f071cedb74abf2691a0f7c4ed8a9600a86194\n. @nlwillia The code suggests it is also accepting htmlmixed. Could you look into this? I think the mode detection you're using is likely to blame -- a mode can also be something like <code>{mode: \"xml\", htmlMode: true}</code>.\n. This has been fixed by recent improvements. See 23c8c3e79ab2ae3e4127150482f94a850a7a8516\n. I haven't found a way to prevent this. Or rather, I have (setting the width instead of the right of the selection divs), but that just pushes the problem to another area -- if you drag a selection from right to left, it's right edge will wobble because of similar rounding inprecisions. See also the discussion in #322.\n. Another possible angle (not sure whether it works, but I used it to solve a similar single-px wobble in another situation) is to move some of our uses of offsetLeft/offsetTop over to <code>getBoundingClientRect</code>. On Chrome, the former return rounded pixels, whereas the latter return fractional values, so that you can use them for more precise positioning.\n. Ah, right, Glenn also mentioned that in the other discussion -- but I never was able to reproduce that.\n. The trick with <code>getBoundingClientRect</code> rather than offsets seems to have done the trick. It allows me to set a <code>width</code> on the selection divs, which wasn't workable before because sub-pixel positioning would cause a (very annoying) 1px wobble when selecting.</p>\n<p>Could you double-check that it also works for you?\n. I've been thinking about this too. Probably, I'll end up moving the bracket-finding code out of the core, and extending its API so that it can also be called by 3rd party code.\n. Note that the above patch is only in the v3 branch, which is not considered stable at this point.</p>\n<p>The reason for this is that it depends on the new event API that isn't (and won't be) in the v2 (current master) branch.</p>\n<p>There'll be a beta for v3 out in a few weeks, and hopefully it'll be stable soon.\n. I've been resisting this. I want the core to remain a single file. As much as possible should be split out of the core and distributed as add-ons. But the code that implements the baseline editor, and thus needs to all be present to run CodeMirror at all, I feel is best kept as a single file.</p>\n<p>That being said, this single file can be organized a lot better than it currently is. I've set my hope on the document / view / editor split that I hope to work on soon, That'd allow codemirror.js to consist of three or four largely isolated sections.\n. A community vote is immaterial. This is my repository. I try to respond to user's problems and suggestions as well as I can manage, but I have zero reason to let the community dictate the direction of the project. Even the comparatively small patches that I've accepted from Adobe recently have caused me <em>tons</em> of work in small regressions and broken assumptions. A big refactor like the one you are proposing would have a much more disruptive effect.</p>\n<p>You are free\u2014encouraged even\u2014to fork in order to try out new things. If you're willing to put in the amount of energy to drive your thing to a well-tested, clean, superior alternative, I'll be forced (probably happily) to integrate your ideas into my distribution.</p>\n<p>But the way it stands, I think CodeMirror's quality can largely be attributed to the fact that I keep a tight control over what goes in and how features look. I haven't been doing this perfectly (I've occasionally let in poorly thought out features, and even came up with some <em>really</em> bad APIs myself), but, looking at projects that take a more community-driven process, I think the central-figure model (assuming that this figure has a clue) works better.</p>\n<p>In short, this is open source, but it is not a democracy.\n. Thanks for understanding. I was bracing for a huge firestorm :)\n. Reopening this. Two things have changed since my original decision: 1) CodeMirror's core is bigger, and 2) JS module loaders have gotten better and more widely used. If I can get the work funded, I want to move CodeMirror version 6 (maybe 7) to a collection of ES6 modules, loaded into the demos with a client-side loader shim, and packaged up into single files for distribution with a static build script (browserify or some equivalent).\n. I am considering splitting a few pieces out into NPM modules, but mostly they'll be files inside the project. (There is something to be said for having each mode and addon be an NPM module, but I fear the awkwardness of managing 100+ modules.)\n. @janl</p>\n<blockquote>\n<p>what are you afraid of in particular?</p>\n</blockquote>\n<p>The inconvenience for users, mostly. (Though the work required to create, update, and track so many modules is also, even with automation, not very attractive.) Right now, if you get the CodeMirror module, you get 90 language modes neatly lined up in a <code>mode</code> directory, and you can load the ones you need, or even defer the decision of which modes to load to run-time, and dynamically load them based on file extensions/mimes. If these are all separate NPM packages, you have to go hunt for them, figure out which ones are of good quality, and run <code>npm install --save</code> a zillion times to declare them as dependencies. The core CodeMirror package will be smaller, but I'm not sure that's really so valuable.\n. Still, what would be the win?\n. Done, 6 years later, via #4200\n. Thanks. Merged.\n. Good idea. I'll set this up as soon as a few known problems are settled.\n. I've put a checkout at http://codemirror.net/3/ . I suspect there'll be <em>tons</em> of bugs in it still, but it appears to be basically usable.\n. Sounds like the editor is being initialized in a hidden state, and then made visible? A call to <code>refresh</code> should solve the problem.\n. That should fix it (though the auto-indentation of the line after the <code>&lt;!--</code> still be somewhat off). The <code>--&gt;&lt;/</code> was being parsed as an operator token by the JS mode, which then only left <code>script&gt;</code> for the code that was looking for <code>&lt;/script&gt;</code>. I've made it harder to confuse now.\n. What would you use a <code>contextMenu</code> event for? (it's not like you'd actually be able to influence the menu)\n. Partially done in 873fe349ce1e0c9b5702c07409bc5a98bc82f1b3 and 3e36c4db6812be6e77108d340ae618e4be3854fb</p>\n<p>I gave up on unifying DOM and other events. Keeping track of DOM event handlers in a way that doesn't leak (or requires manually unregistering every single one) appears to be hard.\n. If you propose an API, I'll be happy to integrate it. Adding events is very easy now.</p>\n<p>But do keep in mind that CodeMirror events are an after-the-fact thing -- their handlers are called when something has already taken place, and usually can't influence that thing. In the case of a context menu, it depends entirely on the API you're using to influence that menu whether an event fired on a right-mouse click will help.\n. There's already <code>editor.setOption(\"onGutterClick\", value)</code>.</p>\n<p>But yes, the <code>on</code> method will be only in v3. It shouldn't be too long until v3 becomes stable, though.\n. There is no event propagation in CodeMirror events (they always fire on a specific object). And there is no way to prevent other handlers from running\u2014this is intentional. CodeMirror events are notifications, they don't provide you with a way to cancel the event from happening or influence it somehow, they just tell you that something happened. In that context, it rarely makes sense to prevent other subcomponent from being notified about the event.\n. Cutting works for me too on FF and Chrome (Linux). Not sure what was going on there.\n. I've been seeing the same thing on FF. Haven't been able to find a proper theory of what causes it.\n. Thank you for all the testing you're doing!\n. Which browser?\n. So far, I'm unable to reproduce on both Chrome 21.0.1180.83 Windows and 21.0.1180.79 Linux.\n. &gt; OK, I'll post a video?</p>\n<blockquote>\n<p>Would that help?</p>\n</blockquote>\n<p>No. I can't debug a video. It's not that I don't believe that you're seeing\nit. It's just that I need to also see it to be able to figure out what\ncauses it.\n. Peter, can you verify that you're still seeing this and that it was not a symptom similar to #801?\n. &gt; I was able to reproduce this issue not so long ago(10-14 days)</p>\n<p>There has been another modest scrollbar overhaul in the meantime. I'll just assume that that magically fixed it until someone sees it again.\n. @rahulchaturvedie Are you testing with the current git code, or the beta2 release?</p>\n<p>@peterkroon Is this still Chrome and the Less mode that you're seeing the problem with? I tried the steps you describe, but nothing out of the ordinary happens.\n. @peterkroon Can you see whether that helps? I could reproduce your first test case, but couldn't see the thing where the scrollbar jumps as you drag it up.\n. How can the cursor be above/on the scrollbar? If you mean above/in the currently visible viewport, I'm still confused, since your steps will put the cursor at the bottom of the document, so dragging the scrollbar up will put the cursor below the viewport.\n. This is a windows-specific behavior yes. I can reproduce now. I don't have much hope of being able to fix this (the precise height of the content isn't known until it has all been scrolled into view at least once, and the scrollbar reset uses the precise scrolltop value at the start of the drag to reset to).\n. No sane fix for this comes to mind, and the issue is very minor, so I'm going to close it as WONTFIX\n. Done. Though I'm not sure how well the github milestone mechanism works, it's worth a shot.\n. See discussion in #762\n. Indeed, that's not updated yet. I'll set up an automatic update-on-push sometime later today.\n. &gt; Alternatively, you can change the z-index of the selection's div to -1</p>\n<p>I had it like that, but it would cause the selection to end up behind the editor's background.</p>\n<p>I found another problem -- in demo/activeline.html, if you add a background to the editor (or use a different theme), the line background also vanishes behind the editor background.</p>\n<p>The tricky thing is that the gutter, the line numbers (which live in the line divs), the selection, the line backgrounds, and the line text, all have to be in the same stacking context, so that they can stack correctly (the selection must sit between the line backgrounds and line text, and the gutter must sit above everything except the line numbers).</p>\n<p>I've pushed 577e707b731e8db8884608ba12be35923cac56bf , which adds a bunch of explicit z-indices, and seems to solve these issues.\n. Closed by a08e2487da2f2cf56099149ca17e399a2a13c7c9\n. Done in 155c24fab1d40fb3aa363ccd25f06636a8a416db\n. Good idea. See http://codemirror.net/3/demo/variableheight.html\n. Should it? If I right-click on the textarea that I'm writing this reply in, it also repositions the cursor (unless I'm clicking on a selection). This corresponds to what CodeMirror does.\n. &gt; actually, that doesn't correspond to what CodeMirror does. If a selection is made, and you Right-click, the selection is lost and the cursor is moved.</p>\n<p>Which browser? On Chrome 21 Linux the selection is preserved when I click it. But mind that I'm clicking <strong>inside</strong> the selection. If I click outside of it, it is indeed cleared (again, following Chrome's textarea behavior).\n. What do you mean by 'callback function'? And which version of CodeMirror are you using?\n. You still didn't tell me how you registered that callback. Also, look into the <a href=\"http://codemirror.net/doc/manual.html#coordsChar\"><code>coordsChar</code> method</a>\n. The order in which event handlers on a single node fire is, as far as I know, not specified. So use <code>coordsChar</code> with the <code>clientX</code> and <code>clientY</code> properties of the event to figure out where the click landed.\n. Can you set labels? I can't find a control that allows anyone to set milestones. I've added v2 / v3 labels as an experiment.\n. Yeah, I'll try to set proper milestones for issues. I encourage tags in the titles so that I don't have to figure out myself what the bugs apply to.</p>\n<p>Hopefully, in six weeks or so, v3 will be the primary version and v2 will just be receiving simple bugfix patches, which should make the process easier again.\n. That padding was needed to prevent an empty gap from showing up at the bottom of the content when there's a vertical scrollbar. I've pushed a somewhat more invasive, but apparently working solution.\n. I've fixed this in a cleaner way (and also caught a second, similar mistake) in 1b07cc3f515baf6ce5d68c995a616d80c4c9e346\n. Is this also useful for code that's not ridiculously repetitive?</p>\n<p>This is cute, but it's not a priority for me.\n. I think this wouldn't even be <em>that</em> hard to do. But unless it gets funded somehow, or someone else submits a good, clean patch, I don't have time to spend on it.\n. Do these two problems (rectangular selection in vim and sublime text style multi selection) really map to the same implementation? It sounds like rectangular selection is a single selection that happens to not be a single range, whereas sublime text selections are actually multiple selections (if you replace them, <em>all</em> are replaced individually).\n. In Emacs' rectangle-manipulation functions, it is possible to paste one rectangle (represented as a set of equal-length lines on the clipboard-equivalent) into a rectangular selection. That wouldn't naturally play well with a Subline Text / ACE style multi-selection. Not sure how it is in vim.</p>\n<p>But, <em>if</em> the vim mode knows it is acting on a rectangle, and it can query the current multi-selection somehow, it would be easy for it to make some API calls that amount to the same effect -- replacing the individual ranges separately. So I guess that yes, having such multi-cursor selections would still be useful.\n. I just meant that you won't be able to simply use <code>.replaceSelection(...)</code> to do the rectangle-pasting. Also, there'd be some trickiness handling native paste events. If you have the text to be pasted and you can find out the selection, it is of course possible to implement arbitrary models of replacement.\n. This is now implemented in the v4 branch (checkout at http://codemirror.net/4/). I'm not a serious user of any multi-selection-enabled editor myself, so feedback and further feature requests are welcome.\n. @remy Well, I did not want to add a binding for Esc to the default set, since that's something people will often bind for their own purposes. <code>keymap/multiselect.js</code> defines Alt-Esc for this purpose.\n. Keybindings are always preventDefaulted when handled. Propagation should not be relevant here.\n. It's not in the standard bindings, as I mentioned. Try at http://codemirror.net/4/demo/multiselect.html\n. Ah, then the OS is catching the key before the browser even gets a chance. Scratch alt-esc then. Anyone got another suggestion for a suitable key combination? Or maybe using a default of Esc isn't bad, people who override it can think about providing an alternative mapping themselves.\n. @remy Agreed. See attached patch.\n. &gt; Ctrl + D is the bookmark shortcut in chrome</p>\n<p>CM key bindings only take effect when the editor is focused. Shadowing the bookmark shortcut does not seem like a problem.\n. @MasseGuillaume Great! Thanks for the status report.\n. (Oh, oops, it seems repeatedly rebasing a branch with issue-tagged commits isn't handled very gracefully by github. That's a lot of noise.)</p>\n<p>Anyway, this is stable, and certain to be part of 4.0 (most likely to be released next month). Closing.\n. &gt; Perhaps also a comment at the very top...</p>\n<blockquote>\n<p>// CodeMirror 2.33</p>\n</blockquote>\n<p>Hm, let's see now.</p>\n<p>```</p>\n<blockquote>\n<p>wget http://codemirror.net/codemirror-2.33.zip\nunzip codemirror-2.33.zip\nhead CodeMirror-2.33/lib/codemirror.zip\n// CodeMirror version 2.33\n//\n// All functions that need access to the editor's state live inside\n// the CodeMirror function. Below that, at the bottom of the file,\n// some utilities are defined.\n[...]\n```</p>\n</blockquote>\n<p>And this has been there (in release zips) for at least the past four versions.</p>\n<p>But regardless, what would be the added benefit of a run-time way to inspect the version?</p>\n<p>A lot of metadata in the library (releaseDate etc) seems pointless, but I guess if someone can make a good case for a CodeMirror.version string, I can do that. It will <em>not</em> be updated in between releases (as in, I won't include a version bump in every single patch), but it could be <code>\"2.33+\"</code> or something, where the + indicates that this is not the actual release, but a dev snapshot after it.\n. Thanks! Merged as a562bed086d59104f3691ef47b6947882083550b\n. It's CoffeeScript, but that still doesn't explain what <code>fadeIn</code> is doing. If you want help with this, try setting up a demo on  http://jsbin.com/ihunin/1/edit with as little dependencies as possible, so that we can debug it.\n. I suspect a well-timed call to <code>.refresh()</code> will solve your problem.</p>\n<p>Remember, the editor won't be able to draw itself when it is hidden. Thus, you have to figure out the point where it first becomes visible, and make sure you refresh it then.\n. http://jsfiddle.net/Q9RqA/1/\n. Thanks. Merged as 0cae19e8cc5f9dccf55194d934c32bb971938bc9 . At some point I should set something up that runs mode tests as an (optional) part of the central test suite.\n. Heh, I see you beat me to that idea (#787)\n. Them being optional is only important if they actually take up a significant amount of time. As long as we only have tests for two modes, and they are super-fast, it is not an issue.\n. Done in pull req #804\n. This was fixed by 021a0d31a92aa4f90b90c8f0\n. In Chrome, in the widget.html demo, I can select the text just fine. Which browser doesn't let you?\n. Can't reproduce on android 2.3. Are you sure you weren't using a cached old stylesheet or something?\n. Strange. It sounds a lot like the z-index bug that old IEs have (where they start a new stacking context in any relative/absolute positioned element)... but it'd be <em>very</em> crummy for the Android browser to introduce that bug at this point.\n. Thanks! Merged in squashed form (to keep commit history succinct) as 2189810311969f270c8e53179f6e8464c1aa63ad</p>\n<p>It does seem that the amount of passing mode tests went <em>down</em> with this. Is that intentional?\n. Hm. It's passing all but one now (in the markdown suite). When I ran it earlier, it passed only about 20. Not sure how to explain that, but I'm happy that they appear to be actually passing.\n. Thanks! Merged.</p>\n<p>I again got the tons of failures thing the first time I ran it, but ctrl-r made it go to 100/100, so that must have been a caching issue.\n. CodeMirror is fully initialized when the constructor function returns.</p>\n<p>Caveat is that, if it is placed in a display: none place, or its style sheets haven't loaded yet, it'll later need a <code>refresh()</code> call to have its display set up correctly. But even before that, all API calls that don't depend on the display should work fine.\n. Seems to work like a charm. Merged.\n. This seems to be the way scrollbars work on Windows (at least in Chrome). If you go to some other scrollable div, you'll see the same behavior. If you drag-scroll and then move the mouse too far away from the scrollbar, it'll reset to the start position. (Interestingly, Linux Chrome doesn't do this.)\n. Awesomely executed! Thanks for working on this. I've merged it.</p>\n<p>One peeve is that the tests do take a lot longer to run now, and I expect most of that time is spent in CodeMirror set-up and teardown. It would be nice if, in the mode tests, the editor instance is cached an reused.\n. Heh, the CodeMirror instance in the mode tests wasn't even used. I've simply dropped it in b306f7cc4051e8e16df7fb8a0db9b094799747ef . If you see a problem with this, let me know.</p>\n<p>That combined with dcc976c5a802885e1cacbea3d188e1005f791394 makes the tests run blazingly fast again.\n. &gt; and have the tests run in a separate thread async</p>\n<p>How? There are no threads except for WebWorkers in the browser, and those don't have access to the DOM.\n. I think a better model is to keep an internal timer, and yield a 50ms pause whenever we've ran for, say, 500ms.\n. I don't see the slowdown. Travis is unreliable in that way -- it runs the tests on machines shared with a lot of other running testsuites.</p>\n<p>I had to add cab941773a50da94ecf524668aefd53b4e7cefe7 to fix a number of breakages on IE. Please do consider that browser supported! (Poor IE.)</p>\n<p>Also, I'd prefer if you didn't deviate too wildly from the coding style of the rest of the CodeMirror core (i.e. the cute left-aligning of commas in var lists). I know it's harmless, but inconsistency in a codebase is distracting.\n. Looks good. Merged.\n. No problem, I could pick out the relevant commit. I've applied it to both master and v3, and followed it up with 1cea0775fe251bff6cb4f8dc5fe88caf3064f1fe to make the mode detection less fragile. (I must admit I didn't re-test with PHP, let me know if I introduced a problem.)\n. Could you try whether the below patch (against current v3 head, 39f27de9daf320f2bb10e9d4c5f1e790517d1f39) helps for you? This is a somewhat subjective thing to test, so please look closely and tell me whether it really makes a difference -- I'd rather not add another kludge unless it really does help</p>\n<p>```\ndiff --git a/lib/codemirror.js b/lib/codemirror.js\nindex 2008d6a..6f10ff5 100644\n--- a/lib/codemirror.js\n+++ b/lib/codemirror.js\n@@ -1092,6 +1092,15 @@ window.CodeMirror = (function() {\n       }\n     });</p>\n<ul>\n<li>var scrollbarReset = new Delayed();</li>\n<li>function growScrollbarV() {</li>\n<li>if (d.scrollbarV.style.display == \"none\") return;</li>\n<li>d.scrollbarV.style.left = 0;</li>\n<li>scrollbarReset.set(150, function() {d.scrollbarV.style.left = \"\";});</li>\n<li>}</li>\n<li>on(d.scroller, \"mousewheel\", growScrollbarV);</li>\n<li>on(d.scrollbarV, \"mousewheel\", growScrollbarV);\n+\n     function reFocus() { if (cm.view.focused) setTimeout(bind(focusInput, cm.display), 0); }\n     on(d.scrollbarH, \"mousedown\", reFocus);\n     on(d.scrollbarV, \"mousedown\", reFocus);\n```\n. Right. The code above was just a proof of concept to see if the approach worked at all. I've pushed a complete (as far as I can see) solution -- see patch above.\n. Also, could you test whether this has any effect on  #728 ?\n. Hm, well, that patch also messed up the scrollbar in IE9. Maybe the cure is worse than the disease in this case. Or maybe I should take another (the fourth) stab at figuring out a reliable way to do our own wheel scrolling. Reopening.\n. I've ripped out the previous hack, and added in another approach to automatic delta measurement. This one seems to work better than the previous one (at least across the browsers that I tested).</li>\n</ul>\n<p>Please let me know whether this one works for you.\n. So, I mananged to install Lion, but Mountain Lion just bluntly refuses to install on my machine. Any chance you can look into this? I guess we'll have to hard-detect the OS X version, and add a :hover style to the scrollbars there somehow (or use onmouseenter to simulate it). Ugly, but probably the only way.\n. Or, if this is just about 1-2 pixels, I'm also happy to just increase the hard-coded 12px a bit on OS X &gt; 10.8\n. Sure, but how? When does the scrollbar become visible, precisely?\n. I agree that reproducing the OS's heuristics sounds like a dangerous road to go down. I also have a bad feeling that Apple will continue to mess with their scrollbars in every single release from now, raising the question of whether it is viable to emulate them at all.\n. These are all already there (in javascript-hints) or not necessary (in codemirror.js, where I expect you're referring to line numbers in an older version).</p>\n<p>There's a linter that errors on missing semicolons now. I expect that if you get the current dev snapshot your problem will go away.\n. Wonderful. Merged.\n. Thanks, merged!\n. Wow, you're on a roll. Thanks for that! Merged. I did add a follow-up patch (fdfba6db20ad626fdd5a71fc6273c503b3b3839f) to get rid of the bold text and the radically different look \u2014 partially because the CSS mode is one of the oldest ones which I wrote myself, and I'm feeling possessive towards it, and partially because I think some users might be annoyed when an existing mode suddenly looks widely different when they upgrade.\n. Sure, but simply dump the CSS into the demo page, rather than distributing a mode-specific CSS file. Mode-specific CSS files are bad. They completely ruin flexible theming.\n. Looking good. Merged.\n. Thanks. Fixed in 39f27de9daf320f2bb10e9d4c5f1e790517d1f39\n. I've committed 23c8c3e79ab2ae3e4127150482f94a850a7a8516 instead, which, rather than adding another hack on a big stack of hacks, makes the process of getting the xml state out of a nested state actually well-defined and extensible.\n. No, there isn't. You could, if you really need this, register an <code>onChange</code> handler that, when the content becomes too long, undoes the current change (or simply marks the content as invalid by styling the editor differently).\n. Well, we have a <code>beforeChange</code> event now, which makes it even easier to implement a solid version of this behavior.\n. I think the http://codemirror.net/doc/manual.html#addWidget method will do what you need.\n. &gt; I have already implemented multiuser concurrent editing with CodeMirror:</p>\n<blockquote>\n<p>you can have a look at the demo http://ot.substance.io/demo/ and read\nthe code on GitHubhttps://github.com/timjb/javascript-operational-transformation/blob/master/lib/codemirror-client.js#L117\n.</p>\n<p>Cool. It's somewhat flaky though. If I delete the line that the other's\ncursor is in, his cursor sticks around ('in mid air') and his screen\ndoesn't show the line being deleted.</p>\n</blockquote>\n<p>Best,\nMarijn\n. Great. Merged!\n. Looks like I didn't test that at all after making a final adjustment to it (the <code>operation</code> call). Sorry!</p>\n<p>Merged.\n. Ergh. I wonder how many more of these are lurking in the code (I must admit I did take a rather crude approach to overhauling the code. It was too huge a change to do cautiously.) I caught a few more in 2c00f1117d92652435a420bbaebd8676d8182fd3 .</p>\n<p>Merged.\n. Thanks for cleaning that up. Merged.\n. Thank you. Merged.\n. Thanks! Merged.\n. Are you sure this works on Firefox? It shouldn't. The actual markers will <em>not</em> be children of the gutter element (they live in the line elements). If you want to style them, assign a class to the marker element itself.\n. Sorry! I misread your code. I've modified demo/marker.html to use a similar approach to color the markers. It works in Chrome for me. Can you reproduce using that demo? If not, can you submit another demo that <em>does</em> show the problem?\n. This is possibly a symptom of the fix for #675 , which is present both in 2.34 and 3.0.</p>\n<p>How many markers are you adding, approximately? Did you wrap the setting of the markers in a call to <a href=\"http://codemirror.net/doc/manual.html#operation\"><code>operation</code></a>? If I do that, I can set 16400 markers in 110 milliseconds (on Chrome, probably less on others) \u2014 if I don't wrap it, it takes 3500 milliseconds. In fact, if you leave out the call to <code>operation</code>, I'd expect this to be terribly slow on 2.33 as well.\n. Could it be that <code>codemirror.css</code> has not been loaded when the editor is initialized? Can you give me a test document? (And let me know which browser it happens on?)</p>\n<p>The <code>offsetParent</code> problem was patched in 3e127904d486931935f42e53f084dc53728ed878 . Maybe that helped too?\n. You can, I think, also call the <code>refresh</code> method on your editor instances after you're sure all resources are loaded.</p>\n<p>Closing this for now, since not initializing properly without its CSS is a known, expected behavior. Comment again if you think some change could/should be made to CodeMirror in this context.\n. This was only ever intended for simple, limited lookahead. Arbitrary lookahead like what you'd need to find all locals in a block won't be possible -- you'd have to do that with an out-of-line background scan, though wiring that up to a mode is also currently not trivial.\n. This was finally implemented in 5.27.0 (via the <code>StringStream.lookahead</code> method). Please use the mailing list for questions. This is not about a bug.</p>\n<p>But yeah, of course there is. Just do what look http://codemirror.net/demo/formatting.html is doing, and do it after initializing the editor.\n. Woops, I guess that's because I only added it to v3. \n. The paths in your demo are bogus. if you set base to codemirror.net/3, you shouldn't be using ../../ in your links.</p>\n<p>Anyway, what you're seeing now is a different issue. The kludge that the xml mode uses to try and preserve indentation in comments doesn't work on tabs. You could look into the <code>indent</code> method in <code>xml.js</code> if you want to fix that. (But if you submit a patch, please do so against the proper branch this time.)\n. I mean whatever you base your origin file on. Your past pull requests had a zillion irrelevant commits in them.\n. Could you explain how this would cause a memory leak?\n. Ah, you mean an infinite loop. Good catch. Merged as b4678badad04305739d9c0ee55413411daec1cc7\n. You're supposed to call <code>.refresh()</code> after a resize.</p>\n<p>But in version 3, this problem no longer occurs (it does use <code>width</code>).\n. Indeed, since no autoformatting extension has been defined for that mode. <code>util/formatting.js</code> defines such extensions for CSS, JavaScript, and XML. You could look at that file, specifically at the extendMode forms (only present in the latest version), and see if you can write something similar for jsp.\n. Yes, that's a Chrome bug. I couldn't find the issue number just now, but I do remember reporting this a long time ago. This is definitely not something CodeMirror can fix, so I'm going to close this, and ask you to pursue it with the Chrome or Webkit teams (whichever is applicable).\n. &gt; Also I noticed that version picker in http://codemirror.net//doc/compress.html</p>\n<blockquote>\n<p>is out of date and fails on all version except HEAD, presumably because URLs it points to have not being updated.</p>\n</blockquote>\n<p>Argh. I could have sworn I fixed that. Guess not. Should be better now.</p>\n<p>I'll look into the scrolling issue later.\n. You tampered with your css file (http://jeditoolkit.com/ambiance/resource/codemirror.css) , that's the reason scrolling is broken.\n. The problem seems to be that mouse events aren't actually going (directly) to the right div, and the <code>resize</code> handle requires that to work.</p>\n<p>Your best bet is to add your own custom drag handle, and call <code>setSize</code> when it is dragged. I've done this in several projects, it's simple and works well.</p>\n<p>I agree that it would be nice if the css way to do this worked, but forcing mouse events to go to the scroller would break other functionality, so, as far as I can see, it's not really viable. Going to close this issue.\n. The reason this isn't an addon is probably that it's rather easy to implement, and since it involves UI elements, providing a general-enough implementation that fits everyone's needs is more involved than just coding one-off implementations per application.</p>\n<p>Given that we're not adding new addons to the main distribution anymore, I consider this out of scope. But if you want to tackle it in a reusable way and publish it on NPM, that'd be wonderful.. Sounds good. Merged.\n. The current approach of returning <code>CodeMirror.Pass</code> works reasonably well, and doesn't add too much complexity.\n. Should be better now.\n. Hi Brandon,</p>\n<p>Could it be that you had a strange feeling of deja-vu when you fixed this? Somehow, your patch 986b40d is in the v3 branch but not in master, and touches the same part of the code in a similar way. I am unsure how to merge the two and whether one overrides the other. Could you take a look?</p>\n<p>Best,\nMarijn\n. I think I pushed all patches to both branches now. (But feel free to verify.)\n. Argh. Should be better now.</p>\n<p>This approach to managing branches is somehow not working. I'll try to work out a better way.\n. Oops. Good call on the <code>g</code>. But why escape <code>&gt;</code> characters?\n. I don't know of any reason to escape <code>&gt;</code>. I've pushed a reduced version of your patch as dc768cc71a10ece34ac6b83b7db1eac4c9b9a9df\n. Great! Thanks for looking into that. Merged.\n. Yeah, I had applied it there on my side, but not pushed to the repository yet.\n. Thanks. Should be better now.\n. Thanks. Was this precisely the same patch as the one in the other pull request? If so, you don't need to provide two, I'll (usually, hopefully) apply relevant patches to both branches when proper.</p>\n<p>In any case, merged.\n. Awesome work! Merged.\n. I've pushed a patch to the repository that should mitigate this problem in the 2.x branch. But as Brandon noted, it's fixed (in a more serious way) in the v3 branch (which will hopefully be a real release soon).\n. Heh. Doesn't the resulting function look a bit... indirect to you?</p>\n<p>I've pushed a simpler alternative.\n. Thanks. Merged.\n. This has been fixed in the repository for a week or so, but was indeed a bug in beta 1.\n. Thanks. Fixed in d0ae5f6925f49881f64fd691c3c3b04435f79913\n. Looks good. Merged. I've followed up with d0ae5f6925f49881f64fd691c3c3b04435f79913 , which moves <code>foldLines</code> to take an options object, rather than a (probably ever expanding) list of boolean arguments. (And documents the <code>showWidgets</code> option.)\n. Define '<em>currently</em>'. I know this was the case a few releases back, but it really doesn't appear to be the case anymore.\n. Oh, good catch. It was actually another EMCA-5-ism that I fixed last time. Should be better now (525f15ce350283d54e2b55564f39b711c8758260).\n. I've never used an editor that does this, and this is definitely not going to be the default behavior.</p>\n<p>Do you mean any line shorter than the current goal column, or just lines that are really empty? What happens when you start typing with the cursor suspended in nothingness like this? Can you define these semantics sanely if you don't assume a fixed-width font?\n. Well, goal column works (and has worked for a long time). Closing this, since the alternative behavior doesn't seem worthwhile to me.\n. I've pushed a somewhat more robust patch, which also handles coordinate-fetching actions other than cursorCoords and fixes a problem with moving through such a widget with the up arrow.</p>\n<p>I've renamed the widget option to <code>above</code>.\n. Great. Merged.\n. So it is something in the context of your page -- possibly a CSS clash or something similar. Could you upload a minimal demo of the problem somewhere?\n. So did you try to isolate it? I'd be interested in the circumstances that cause this (which appears to be a Chrome bug).</p>\n<p>Closing this bug, but feel free to attach extra information if you want.\n. There's no call to <code>.refresh()</code> in that list, which is definitely necessary (<strong>after</strong> making the editor visible).\n. That was fast. I'll look into this and merge next week. Don't worry about\nadding extra tests if you don't feel like it - most modes don't have tests.\nOn Oct 9, 2012 10:56 PM, \"ComFreek\" notifications@github.com wrote:</p>\n<blockquote>\n<p>-</p>\n<p>I've added a TypeScript mode which is based on the JavaScript one.\n   -</p>\n<p>I've also attached a theme which uses the same colors as in Visual\n   Studio 2012.</p>\n<hr />\n<p>You can merge this Pull Request by running:</p>\n<p>git pull https://github.com/ComFreek/CodeMirror2 master</p>\n<p>Or view, comment on, or merge it at:</p>\n<p>https://github.com/marijnh/CodeMirror/pull/879\nCommit Summary\n- Added TypeScript mode</p>\n<p>File Changes\n- <em>A</em> mode/typescript/index.html (93)\n- <em>A</em> mode/typescript/typescript.css (87)\n- <em>A</em> mode/typescript/typescript.js (390)</p>\n<p>Patch Links\n- https://github.com/marijnh/CodeMirror/pull/879.patch\n- https://github.com/marijnh/CodeMirror/pull/879.diff</p>\n<p>\u2014\n  Reply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/879.\n. Since the changes relative to the JavaScript mode are minimal, and the two languages can be expected to stay in sync, I think this would actually better be done as a configuration option to the JavaScript mode. That way, I don't have to maintain two chunks of mostly-identical code in the future.</p>\n</blockquote>\n<p>Do you want to make that change?\n. Thanks, merged in 5ea1eb983e17c1273921a49890a4fd51653ac185 , and improved it a bit in b3c1c795f5618fe14d23f9f845b06d1ae1809546</p>\n<p>Is the copyright header really necessary for the twenty trivial lines that you added? It's already inaccurate, since I've already touched the typescript code since. Git is a better way to track who wrote what than such ugly headers.\n. Done in a2d967330d984017ea161750e519f67970288329</p>\n<p>You can probably do</p>\n<p><code>git fetch origin master # assuming origin is my repository\ngit reset --hard FETCH_HEAD</code>\n. So apparently origin does not point to my repository, but to yours. Anyway, this is not the place for a git tutorial, there's tons of those online.\n. Confirmed. Will try to figure out what causes this.\n. Did you, by any chance, start noticing the problem when enabling the scroll-wheel hack? That adds a mystery 'set scrollTop' entry to the profile I get in Chrome, which takes up quite a lot of time (about as much as the actual display updates).\n. I think the solution to this will be to try incrementally adding and removing lines during a smooth scroll, rather than doing a big redraw now and then.</p>\n<p>Could you try whether setting the <code>viewportMargin</code> option to something small like 10 reduces the problem you are seeing?\n. Again, @njx, could you tell me whether that helped or not?\n. Hrm, strange. I can't reproduce the flicker anymore.</p>\n<p>If, after scrolling down and up once, you make a small edit at the top of the file, does that cause the flicker to happen again if you throw-scroll afterwards? (That would point at the highlighter as the culprit.) Are you sure it's flickering, not stuttering (short freezes), that you're seeing?\n. I guess what you might be seeing is the JavaScript engine optimizing the code that gets exercised by scrolling, and thus becoming smoother after a while.</p>\n<p>Is the effect bad enough to be a problem for you? I spent a few more minutes try to reproduce, but really don't see it anymore.\n. Actually, the JIT theory is not it. What happens is that the first few wheel events are let through in order to measure the pixel scroll values, so that the browsers pixels-per-delta-unit value can be calibrated. That would cause the kind of flicker that you're seeing. Once it has calibrated, it'll handle wheel events itself, and is able to prevent flickering from occurring.</p>\n<p>Seems we're not done with the wheel fiasco just yet. #913 is another problem caused by my current implementation. Maybe I should just give up and add thirty lines of fine grained user-agent/platform-based checks to set the granularity (and accept the fact that it'll break on new versions of browsers).\n. The bad news: I went down the route of basing wheel deltas on browser detection for a bit, but there's really no future there. You find code snippets all over the web that use a few simple rules to normalize deltas... but none of them work. They are wildly incorrect for various browsers, even to the point of scrolling in the wrong direction. So I did a bunch of sampling myself, and got the following table for pixels-scrolled-per-delta-unit</p>\n<p><code>Chrome 23 Linux: -.7\nChrome 22 Win: -.85\nFF 17 Linux: 20\nFF 17 Win: 13.4\nFF 16 OSX: 10\nIE7, IE8, IE9: -0.53\nOpera 11/12 Linux/Win: 27\nOpera 12 OSX: 1\nSafari OSX: -.3333</code></p>\n<p>My Chrome on OS X is strangely broken since I upgraded to Lion (upgrading/reinstalling etc doesn't help), so I can't measure there, but I found several reports that mentioned that it behaves differently from Chrome on other platforms.</p>\n<p>The main problem with hard-coding these is that it completely, fatally breaks the user experience on platforms that weren't explicitly tested (new versions, older versions, obscure browsers) because the numbers are all over the map, and no sensible default can be given. Thus, I'm not really willing to go this route either.</p>\n<p>I'm starting to get <em>really</em> sick of this whole problem, but I guess it's something that can not be ignored.</p>\n<p>The good news: I can reproduce the flicker on Chrome in my Windows XP virtual machine (though not on Linux Chrome or OS X Safari, for some reason). So I can debug it first-hand there.\n. Okay, another attempt. Works for me on Windows Chrome. Might just also do the trick for you.</p>\n<p>One thing to look out for: If your touchpad/OS allows extremely fast scrolling, this might cause oversized viewports to be rendered, which could be slow. I didn't manage to trigger such a problem, but scroll hardware behavior varies hugely among machines and OSs, and you seem to have somewhat more rigorous throw behavior than I have on any of my machines (as witnessed by the fact that you're seeing more flicker), so please do an experiment: at the top of a big document, throw-scroll down as fast as possible, and watch for stuttering or short freezes.\n. Actually, what we're talking about here is issue #810 . Closing this one in favor of that.\n. Changing the DOM order seems to indeed do the trick. But do note that the same problem still exists for selection -- the markers will sit in front of the selection block. For this reason, using opaque markers is still recommended.\n. Thanks for catching that! Merged.\n. Indeed! Merged.\n. &gt; I believe it should be pretty easy to accomplish this with a bit of custom code (which I feel is more appropriate for this)</p>\n<p>I agree, though I would be open to modes adding metadata (an extra property) to make it easier to enable folding on them. I.e. brace languages advertising that the brace folder should be used, and languages requiring a (simple) custom folder building the folding code into the mode.\n. See https://github.com/marijnh/CodeMirror/wiki/Mode-wish-list .\n. Thank you! Merged.\n. Fixed by fbee3d8ac25e5d3c0870ff9af97b27fd3d2748f1\n. I found and fixed a number of inefficiencies. Could you try again with the latest git code and see if it helps?\n. Awesome! I'm going to close this. #881 will track remaining slowness in throw scrolling.\n. That's probably a rounding error issue created by your specific font/fontsize. It will definitely be gone in v3. Is upgrading an option for you?\n. The problem is the bold text having a different line height. Setting line height explicitly should indeed help.\n. Yeah, it seems I was going into the wrong direction there. Could you try again with the current git code?\n. There are regression tests (http://codemirror.net/test/), and if you look through the patch I linked to this issue, you'll see that I added a test for the thing that was failing here.\n. The problem was that clearing a marker still allowed it to come back from the dead through an undo action. That violated an invariant that your code depended on. So I'm simulating the underlying event.</p>\n<p>The broken redo was because my first implementation (which was braindead) tried to fix this by integrating marker changes into the undo history. Thus, when you set a marker, it'd add an undo event, which, as a side effect clears the redo history. That code is gone, so I didn't test against the problem it caused.\n. Setting display: block style on an individual token is <em>very</em> unsupported.</p>\n<p>Interestingly, if you center all text (<code>.CodeMirror pre { text-align: center }</code>) it seems to sort of work.\n. I can't even reproduce this with 2.34. Are you sure you described the reproduction steps correctly?\n. No problem. Glad it worked itself out.\n. This is a known problem, but I guess I'll look into it again and see whether it can be halfway improved.\n. Could you try again, and see whether you run into any cases where you'd expect it to behave differently?\n. You know what would help? If you'd actually describe what you were expecting and what happened.</p>\n<p>I looked at the demo, it does what I expect it to do. There aren't enough lines in the initial content to not fit in a single viewport, since the default margin is 100. Paste a few hundred more lines, and you'll see something happening.\n. This breaks selection of ranges of symbols (say, <code>++</code>) with double-click.\n. Fixed by attached patch.\n. I like the idea, but wouldn't a node script be easier to maintain and more in the spirit of the rest of the system (as well as the year 2012) than a... Makefile? I may just not be a hard-core enough unix nerd, but I always find Makefiles a pain to edit, maintain, and generally understand.\n. I've pushed an alternative in 60ee801ec099ca81aab58a8062117587cc969ef4\n. @gozala Please look at the current documentation for <code>markText</code> <a href=\"http://codemirror.net/3/doc/manual.html#markText\">1</a>, especially the <code>replacedWith</code> option, and see if that is powerful enough to do what you want. You will have to have some text that represents the widget internally -- it's possible to have zero-character-range widgets with <code>setBookmark</code>, but those will not allow the cursor to sit immediately in front of them, because the <code>{line, ch}</code> system used to express positions in a document doesn't allow us to specify two different positions (before an after the widget) at a single character offset.</p>\n<p>Please give feedback and report bugs, since this is a new, unstable feature.\n. Closing until further notice.\n. The xml completion wasn't written by me (but by @vf1) and I'm not maintaining/extending it. Pull requests welcome, though.\n. I ran coincidentally ran across some suspicious code that might have caused this while working on another patch. My change seems to have fixed this for me. Could you double-check whether it also works for you now?\n. This is intentional, and you'll see the same in all modes, not just overlay mode. CodeMirror is conservative about saving parser state, since the memory use for that can get big. So it'll often re-parse the same piece of code a number of times. Unless you are doing really crazy things in your parser code, it shouldn't matter (as it only happens for code visible in the viewport, which typically isn't more than a few dozen lines.)\n. What is the problem that these multiple passes are creating for you? Keeping your own state sounds like a recipe for extra complexity and bugs.\n. Setting padding on <code>.CodeMirror pre</code> is the way to add horizontal padding. Can you describe the funkiness you are seeing in more detail?\n. If I go to http://codemirror.net/3/demo/marker.html (in Chrome 21), and paste a bunch of text into the editor to make it scroll, scroll to the top and then do</p>\n<p><code>editor.setGutterMarker(100, \"breakpoints\", makeMarker());</code></p>\n<p>and scroll down, I do see the marker. Does that also work for you? If so, could you provide a more precise way to reproduce the problem? If not, which precise version and OS are you one?\n. That's strange. I've never seen anything similar. Will keep this in mind if it happens again.\n. Merged, thanks. I've added a496eba881980fb6fae6e3 , which changes the <code>isDirty</code> method to <code>isClean</code> (and inverts its meaning), in order to have a single recognizeable word ('clean') in both related methods.\n. Thanks for isolating that. Was an easy fix.\n. Which editors have you been using? I just tried several (chrome textarea, firefox textarea, chome url bar, firefox url bar, emacs, gedit) and none behaves in this way.\n. Must be some Windows tradition I'm not aware of.</p>\n<p>I doubt though that they always select all the text that's modified by the undo. That sounds like it'd be a pain. Don't they just restore the cursor/selection position that was current when the history event was saved? That sounds like it might be a good approach.\n. &gt; This behavior occurs in Firefox and Chrome for Linux as well.</p>\n<p>You must be using a different Chrome and Firefox then. Or maybe it's some deep GTK setting they are obeying that is set differently on my system.\n. I've added functionality where it reverts to the selection that was present when the undoable changeset was saved. That's as far as I'm willing to go. (Selecting precisely the changed text is problematic, firstly because undo events may affect multiple stretches of text when those were changed in a single operation, and secondly because I'm not currently tracking the precise start and end of the changes, and it'd require an overhaul and a more expensive data model for the changesets to keep that information.)\n. Can you provide a precise scenario in which it doesn't work as expected? I can't get the thing you describe to happen.\n. (Might be that 1cbf1f64001b36dc7115f6a36c0f919f59c434fa accidentally fixed it.)\n. See attached patch. I think that should make it behave as you intend -- when redoing, the selection is reset to the point where it was when the action was initially done.\n. So maybe you can tell me which browser you're using?\n. The switching code should only fire when on Opera (as the code you were referring to should clearly illustrate). So probably it's not firing, but QTWebkit might be having the same bug/behavior as Opera, where it sets the ctrlKey for Cmd, and the metaKey property for Control.</p>\n<p>Could you debug this for me? Should be trivial to look at some key events and see which properties are set when you hold cmd and control.\n. Thanks! Could you verify that the attached patch also works?\n. Can you provide a test case? I can't reproduce this on http://codemirror.net/demo/widget.html , even when setting the widgets to have a higher height.\n. This may be a real bug, but without any further information, there's not much I can do with it. Closing until further notice.\n. I think I found a similar symptom when creating a widget with vertical margins. The above patch should fix that. (Still might be a different bug.)\n. With the above patch, you should be able to do <code>instance.setGutterMarker(line, \"CodeMirror-linenumbers\", domNode)</code> to replace a line number with a given node.\n. Could be related to #728. Which browser(s) are you testing with?\n. I could not reproduce the infinite loop, but that patch did solve the errors for me. Could you verify whether it works for you?\n. Move your script tag out of the <code>&lt;form&gt;</code> tag. If the form isn't finished when it runs, it apparently fails to properly register its submit handlers.</p>\n<p>(At least, that fixes it for me on Chrome 22 Linux. Let me know whether it helps for you.)\n. This is a known issue <a href=\"https://groups.google.com/d/msg/CodeMirror/zjgIFMPBjrw/KpSrYfucdEoJ\">1</a>. It doesn't seem to be solveable without patching Firefox.\n. Not sure what they are supposed to have fixed there, but in Firefox nightly there's still no paste event for middle-click pasting.. I'm still not seeing any paste events generated for middle clicks on uneditable elements in Firefox 59, so no, I guess the functionality we need to make this work still isn't there.. The thing that looks editable in CodeMirror isn't actually editable on the HTML level (it's static content, and focus is put on a hidden textarea), so Firefox doesn't understand that it should allow paste when this element is middle-clicked and doesn't generate the events necessary to access the clipboard.. Minimal example: an empty document with a <code>paste</code> handler registered on the body. In Chrome, if you middle-click on the document the paste handler fires and can move focus to, say, a textarea to intercept the paste. In Firefox, it nothing happens.. See the <a href=\"http://codemirror.net/doc/manual.html#option_inputStyle\"><code>inputStyle</code> option</a>, but that is unfortunately not very solid yet. There are plans to rewrite the library to work with contentEditable from the base up, which would sidestep such issues, but it's not clear yet how and when that will really happen.. Apparently not, github won't let me assign this to you (I guess you can only assign team members?). But don't let that stop you!. This was finally fixed in #5751 (but see also #5754 ). Reproduced. Unfortunately, the input-restoring functionality in browsers is underspecified and unpredictable. It seems the presence of CodeMirror is throwing off Firefox's algorithm in this case. I did some experiments with removing CM's internal textarea on submit and un-hiding the form's textarea, but that did not appear to help.</p>\n<p>I think the only way to get this to work would be to spelunk through the Firefox sources and try to figure out where it goes wrong, and then use that information to either add a workaround to CodeMirror (such a pull request would be welcome) or patch Firefox itself.\n. That's not really a bug, that's an obvious result of these things not being native input controls.</p>\n<p>If you want, you can make your submit handlers call .save() on all CodeMirror instances on the page. But I don't think it would be a good idea for CodeMirror itself to implicitly register <code>beforeunload</code> events that save it -- it might not always be what people want, and it's bound to cause subtle problems in some cases.\n. I spent some time waving my mouse over a document with such a handler installed, but did not get it to crash. That being said, the coordsChar algorithm is a rather intricate implementation of a binary search and I wouldn't be surprised if it contains a potential for an infinite loop somewhere.</p>\n<p>What settings are you using?\nWhat does your document look like?\nAre you using any right-to-left (arabic/hebrew) text?\nAre you using widgets or marked spans?</p>\n<p>A demo page plus an approximatation of how long it usually takes to trigger the behavior would be very useful. Also, is the mouse near a specific kind of place (left of text, right of text, below bottom, on empty line, anything) when the problem occurs?\n. Thanks for the extra info. (<code>tabMode</code> hasn't been a valid option in ages, by the way, it was replaced by the keybinding system.) I still haven't managed to reproduce it.</p>\n<p>If it's relatively quick to reproduce, could you open it in Chrome, activate the dev tools (ctrl-shift-j, or, I believe, cmd-option-j on mac), and then, once it hangs, switch to the 'sources' tab of the dev tools and press the pause symbol button on the right? That should, with some luck (sometimes it fails to interrupt a script), give you a breakpoint. I'd be interested in the stacktrace and the current value of (assuming the hang is somewhere inside of <code>coordsChar</code> -- or <code>coordsCharInner</code> in the current git version) the <code>from</code> and <code>to</code> variables. You can get these values by, if its not already selected, clicking on that function name in the \"Call Stack\" list on the right, and then pressing the \"+\" button on the top right to watch these two variables.\n. Thanks for the detailed diagnostic info! That helped a lot. Could you check whether that patch helps?\n. So, that patch doesn't seem to work at all. Worse, it breaks highlighting of multi-line strings. I've pushed commit 9039744078d9fdf50c42a0144ccc2b64d650edfe instead.\n. Hey. The 'emacsy' mode is a minimal set of emacs-style bindings that is always enabled on Mac (where Ctrl doesn't interfere with other bindings, and default controls also support these bindings). The emacs mode falls through to these in order to not define them all again.</p>\n<p>Merged your patch, and applied 63f1d8ec59077bce7f8b9ab1d84300f9fd0b30ed on top of it to reduce duplication.\n. Thanks, merged!\n. Merged.\n. Good catch. Merged.\n. I know -- I had applied the patch to my local v3 branch but not pushed yet. Should be better now.\n. This is intentional, since many pages <em>want</em> their background to be inherited by their editor. A better fix is to just add this background when you need to set your editor full-screen.\n. So use a different theme. Or make a separate ambiance-light theme. I'm not going to slash the most professional-looking theme in the distribution just because it's not suitable for mobile.\n. I don't think my own test environment is relevant to people reporting bugs. The <em>distribution</em> is the zip files downloadable from codemirror.net.\n. Great, thanks. Merged!\n. Hm, maybe duplicating that whole theme is not such a great idea after all. See commit 97258823702524e1f31c116dd04c6eefe11a20f5 , which changes it to simply be an extra file that you can include to kill the box shadow.\n. Simply use your own wrapper around the constructor if you need to do this. I feel it does not belong in the core.\n. Thanks! Squashed as e4d0c6151b7aa7c730972d280e3ab89eb6d659f0 and merged.</p>\n<p>(My lack of vim experience prevents me from testing these properly. If you're ever bored, a set of automated tests for the vim mode would be a great contribution.)\n. &gt; pulling in a testing framework like QUnit or Junit?</p>\n<p>I prefer not to. What we have is working just fine for our purposes, and I like its simplicity.\n. Awesome! Merged.\n. Something like this will be useful. But I'm thinking more in the direction of making all options that somehow pertain to sets expose and add/remove interface, and simply using <code>defineOption</code> to define extensions like this, with the changer function taking care of adding/removing the necessary options.</p>\n<p>Commands are global. You can't have per-instance commands, so those don't need to be wrapper like this. Keymaps are a prime example of an option that needs an add/remove interface. Start/change would be handled by the <code>defineOption</code> callback. Stop isn't something I've ever needed in a plug-in -- but if you have a compelling use case I'd love to hear it.\n. Disablin a plug-in on an instance would simply be handled by the change handler for the option noticing it being set to false/null/whatever. See http://codemirror.net/3/doc/manual.html#defineOption</p>\n<p>So, if you're extending CodeMirror (it's written without dash, by the way, so the lowercase require/npm name is 'codemirror') is it really such a problem to depend on the CodeMirror object?\n. I've added <code>addKeyMap</code> and <code>removeKeyMap</code> (http://codemirror.net/3/doc/manual.html#addKeyMap) function for add-ons to be able to independently register and unregister keys. See <code>lib/util/closetag.js</code> on the v3 branch (not master!) for an example of how this can be used to write a simple, option-enabled add-on.\n. So, I'm not sure I fixed this, since I couldn't reproduce on my IE8, but I did fix a similar issue in IE7, so hopefully that patch helped. Please check, and comment if it is still broken.\n. @benkeen care to take a look?\n. Apparently @benkeen is aware of the problem. I myself am not going to work on this. Fixes are welcome, but I'm trying to keep the issue list focused on things that concern me.\n. No, it is already inheriting the line height, that was the problem to begin with. ... I think. Since Opera is dumb about zero-width spaces, we insert an inline-block to measure the line height on empty lines. But apparently, the rules for setting the height on an inline block are different from those on a regular span.</p>\n<p>I'll remove the hack again. It worked for me, but I guess your fonts/system settings are slightly different, and you're seeing a different effect.\n. It is happening on all browsers and all platforms in the current code. Looking into it.\n. See commit 6199c06f9e7cbb6d1e76fb958add2c743f87f889 for a fix of the gutter problem (which is unrelated to the original problem mentioned in this issue)\n. I'm not sure whether I mysteriously missed this for the past three months, or whether something in my IE7 regressed somehow. But it's completely unusable as is.</p>\n<p>I may put some more energy into this. If I don't find that energy, IE7 is going <em>off</em> the supported browser list for the 3.0 release.\n. Anything in demo/theme.html basically -- if I click in the middle of a line, the cursor is drawn one character to the left of its actual position. Then when I type more text, I see some characters in the rest of the line shift and move around in strange ways (i.e. one character tends to end up underneath others, quite a distance from its intended location).</p>\n<p>Also, the bottom of the editor incorrectly gets a negative margin, causing the drop-down below it to overlap the editor itself.\n. A restart of my windows VM made most of the symptoms go away. Don't want to know.</p>\n<p>The bug reported above, with typing not working when clicking after an opening brace with <code>higlightBrackets</code> enabled, I could reproduce. It seems the highlighting of the brace triggers some bizarre bug which causes subsequent typing, though the textarea is still focused, to not appear as content. I spent an hour investigating it with no luck. I'm tired of this. IE7 support is going to be 'half works, but not officially supported' in 3.0.\n. I've downgraded IE7 support in v3 to 'best effort' (which, despite quite some efforts, is still quite bad). I'm going to stop wasting my time on this terrible piece of software.\n. Thank you. Merged.\n. Thank you! Merged.\n. Nothing comes to mind. But a simple check for <code>]: X</code> or <code>](X)</code> before/around the link should go a long way towards solving this.\n. Thanks! Merged.\n. Great! Merged.\n. I haven't gotten around to installing IE10 yet and unfortunately this problem doesn't show on IE9.</p>\n<p>I'll check back once I've figured out a way to install 9 and 10 side by side.\n. Try with the new hinting widget (addon/hint/show-hint.js), which exposes the same interface but is implemented in a less scary way. (It is new though, and not as thoroughly tested, so you might run into other issues.) The old simple-hint code is deprecated.\n. This is another symptom of #968 (fix for that one is incoming).\n. Undo differing in v3 is by design -- I overhauled it to be more predictable and correct. The bugs you found were not by design. The above patch should fix them (do double-check, if you have a moment).</p>\n<p>The behavior in v2 is indeed messy, but I'm not going to fix it anymore.\n. (Thanks for finding all these bugs, by the way!)\n. &gt; Ctrl-] a new tab is inserted but it's inserted before the closing bracket and not after it</p>\n<blockquote>\n<p>Feels like a bug to me</p>\n</blockquote>\n<p>Ctrl-] is bound to indentMore. Indentation happens at the start of the line. If you want to insert a tab, use the tab key.\n. Thanks for fixing that. Merged. Though if I do end up dropping IE7 support, it won't stay in the code for long.\n. You are right that the check does not serve much purpose. I've removed it completely in 38e68eddd9b7f3ac8c45eefcafb19c90a5155c94\n. Thanks! Merged.\n. Thanks. Merged. Next time, try to rebase to my branch first, to prevent irrelevant patches from appearing the pull req.\n. Fixed in 656b2714ded9554adecb164359d64562968b4c64\n. Good catch. Merged.\n. Thanks. Merged.\n. Could you write this as an extension instead, and use a different command name from <code>newLineAndIndent</code> for the actual thing that a key is bound to? I don't think it's general enough to have in the core. \n. See 751680e9841cdb8d56270266321a403e2b1e1b64 for an alternate implementation. This attaches the indentation syntax options to the mode, so that it will automatically do the right thing for the right languages (even when embedded in another mode, as with PHP), and makes the functionality a regular command, so that it can be easily bound in a keymap.\n. Thanks! Merged.\n. Could you maybe be a little more specific? What's the problem?\n. Twilight <em>is</em> on v3. I pushed that a few minutes after I pushed it to master.</p>\n<p>Solarized hasn't been ported to v2.x yet. You're welcome to do that.\n. &gt; When will v3 be released,</p>\n<p>Next week, I hope.</p>\n<blockquote>\n<p>will that stop v2?</p>\n</blockquote>\n<p>There'll be a few more bugfix releases for the 2.x branch.\n. Good call. Merged.\n. This appears to be a duplicate of #976\n. I agree that the current vim mode is starting to look messy. I'd like contributors to the old code (@jankeromnes, @xLanny, @misfo, @mightyguava, @chris-morgan, @mattsacks) to take a look, verify that their favorite features still work, maybe help extend this to cover missing features. It's hard for me as a non-vim user to interpret this code, but at a glance it does look clean. If it's viable to switch to this as the one vim mode in the distribution, that'd be fine with me.\n. Keep the 'use strict'! There is no reason not to use that.</p>\n<p>Also, I personally think an 80 chars limit is archaic. It requires a lot of effort being put into code formatting, and the benefits are dubious.\n. I'll merge this in a few days. If anyone wants to do a detailed test drive and/or fix minor bugs they find, now is the time.\n. Please take #1010 and #1011 into account.\n. Merged (in squashed form) as 206afdf589f5c26f0ff3fb39347c20a7b9aff6c8 (and equivalent on the v3 branch).\n. This is the expected behavior. You'll have to also reset your <code>gutters</code> option to get the line numbers to show up on the left again. Clearing <code>lineNumbers</code> will drop the <code>CodeMirror-linenumbers</code> gutter, and setting it to <code>true</code> again will add it back in the default position, which is the right.\n. That patch tries to minimize the effect. You'll still see a brief one-pixel shake on layouts where the rounding of the pixels happens to go the wrong way, and some more noticeable glitches on browsers where we get the initial wheel delta ratio wrong (but only for the first few wheel events).</p>\n<p>@bfrohs: I do not know what middle-click scrolling is. Is it a mac thing? Does it generate any events?\n. I'm unable to get middle-click-and-drag to work on any platform. But I did find the autoscrolling option in Firefox. I'm not seeing any slowness though, when scrolling through the Less mode demo page (and the gutter flicker fix seems to work when scrolling like that).\n. @njx It seems to fix it partially -- the gutter will now often look stable during scrolls, but 'overshoot' at the end and start of a scroll in Webkit on OS X. Seems the deltas on the events really have no stable correspondence to actual scroll distances.</p>\n<p>Such is life. This is, as far as I'm concerned, the lesser of several evils. The various constraints that we're under don't seem to allow a perfect solution.\n. It seems that my patch made the situation worse on several platforms. I've reverted it again -- the unreliability of wheel scrolling information makes this approach unpractical.</p>\n<p>Ideally, we'd find some way to make the browser compute the positions for us using CSS, but I haven't been able to come up with one.\n. To more clearly delineate the issue:\n- We have elements (the gutter numbers and markers) that we want to scroll along with the content vertically but not horizontally.\n- CSS provides no way to base the vertical position of an element on a different parent than the horizontal position.\n- <code>scroll</code> events fire after the actual scrolling was done. Therefore, synchronizing positions in response to a scroll event seems to <em>always</em> result in glitches like the one described in this issue.</p>\n<p>Thus, we seem to be in a bind. ACE solves this problem by stopping wheel events and handling them manually. We went down that road before, I think the problems with that (inconsistent scroll speeds across browsers, obviously non-native feel of scrolling) are also unacceptable.</p>\n<p>Please help come up with possible hacks or workarounds.\n. - Having the gutter lag slightly on vertical scrolling sounds like a non-starter to me. Vertical scrolling is much more common than horizontal, and the effect would look terrible.\n- I don't think polling, with or without <code>requestAnimationFrame</code> would improve the situation -- the scroll event will be pretty much the first thing fired off after a scroll happens, I didn't test this, but it would hugely surprise me if you could get any scripts to run in between, and even if, the effect would probably not be much improved.</p>\n<p>My main issue with handling wheel events is that it causes a major usability problem when we get it right -- I found at least five different situations when I tested it, and if someone ends up using a version/platform combination that we didn't test (because it's old, or because it's new), they might end up with a scrolling that goes really slow, way too fast, or even the wrong way. Add to that that the scrolling just doesn't feel very native when you handle it, because the resolution of the wheel events differs from the actual scrolling, at least on FF.\n. Still happens for me.\n. I think I got it this time. The fix is relatively low-impact &amp; low-risk. Firefox (on which non-native wheel scrolling looks icky) seems to redraw only after the scroll event fired, which prevents this bug from occurring. So the fix is only turned on on non-Opera, non-Firefox browsers, only for horizontal wheel events, and only when a conversion from delta units to pixels is known (either hard coded or measured).</p>\n<p>Please test!\n. Oops, sorry, I pushed that patch before I realized you submitted a pull request. Does it work for you? It's slightly cleaner (I think).\n. Well, that was fun. I can't wait for the next scrollwheel-related bug to pop up!\n. Rebind the <code>Tab</code> key to something like <code>function(cm){cm.replaceSelection(\"    \");}</code>, it's trivially easy -- http://codemirror.net/doc/manual.html#keymaps\n. No. I went down the road of building in N indentation models in CM version 1. It was a mess and still didn't cover everything people wanted. Just use the building blocks provided to do what you want to do.\n. @anodos I do not believe there is a \"bug\" in the above solutions, it is just that they implement something that is not what you want. Since you didn't bother to explain what exactly it is that you want, I can't really comment on how to do it. Maybe binding to the \"indentAuto\" command is what you are trying to do?\n. 1. No, that sentence did not describe exactly what you were trying to do.\n2. I've never used a code editor where this is the default behavior of tab.\n3. But you could easily implement it in CodeMirror, if you'd take a moment to read the docs.\n4. (And no, I'm not going to do it for you. I might have, if your tone didn't ooze entitlement the way it does.)\n. I understand what you wanted (the previous comment made it clear). I'm just challenging the notion that this is an obvious default/built-in behavior. I've had at least ten different whitespace/tab key/indentation set-ups being pushed onto the system as 'the obviously right way', and at this point I've given up providing something that works for everyone, and my response to such things is \"use the API, customize it to your heart's content\"\n. This snippet is in the docs (http://codemirror.net/doc/manual.html#keymaps). Key bindings aren't options in CodeMirror. Are the CodeMirror-using sites you use not under your control, that you can't simply add this once and for all? A bookmarklet might also be a solution.\n. <code>var spacesToInsert = spacesPerTab - (cm.doc.sel.from.ch % spacesPerTab);</code></p>\n<p>(You don't want to randomly reach into undocumented internals like this -- use <code>getCursor</code> instead. This will already break in the upcoming 4.0 release.)\n. The version you are using probably does not have the <code>insertSoftTab</code> command yet. I'll release 4.1 later today, which includes this command.\n. You can use the <code>beforeChange</code> event to inspect and modify changes before they are applied.. I disagree. Feel free to bind <code>Delete</code> to something more smart, but none of the editors I use, nor the default editing controls in browsers, have this default behavior, so the default binding for delete is going to stay what it is.\n. I can reproduce this -- but only in IE. It appears that calling <code>getBoundingClientRect</code> (or accessing <code>offsetTop</code>/<code>offsetLeft</code>) causes a recomputation of the layout (or some other ridiculously expensive operation) every single time it is called. This amounts to about 1.6 milliseconds per character, which does really add up on long lines. Turning on text wrapping does indeed miraculously speed it up, but only by a factor four or so, so the problem is still noticeable.</p>\n<p>This doesn't seem to happen for all nodes. If I use a node in a simple document, IE seems to properly cache the result and the whole thing speeds up by a factor 1000. So now the question is what it is about the CodeMirror DOM nodes that breaks caching.\n. Seems to work in the current version. Please try recent versions first before reporting a bug, <em>especially</em> when the version you're using is a year old.\n. Is that the only one that failed? That's good news.</p>\n<p>iOS is not officially supported, and I can't test it. Can you somehow output what value <code>scrollbarWidth</code> gets on that platform? If it's <code>1</code> or some similarly tiny value, we should just add a line <code>if (scrollbarWidth &lt; 2) return</code> to skip the test for platforms where the scrollbar does not take up width.\n. If you look at the patch, it's pretty clear why that one fails. Your editor (Github's built-in ACE, I presume), normalized the accents in the strings in the other tests, thus breaking it. I've pushed a patch that removes the spurious change.\n. See https://github.com/marijnh/CodeMirror/blob/master/lib/util/continuecomment.js -- a similar thing could be done for markdown mode by overriding enter and backspace. But I'm not going to do it. Pull requests welcome, but I'm closing this issue.\n. No. You're probably doing something dodgy if you need access to individual DOM nodes in the document. If you want to register an event handler, register it on the wrapper, and check the event's <code>target</code>. If you want to do something else, let me know what, and I'll try to give you a proper way to do it.\n. Thanks. Merged.\n. This adds a lot of noise to the HTML, and makes modes less themeable. Things used to work this way in version 1, and I've consciously moved to a simpler model. I'm not going to merge this.</p>\n<p>That being said, it is easy to wrap existing modes to add some style information. For example, here's a hack that, when loaded after the css mode, will patch that mode to attach the extra style information. You could generalize it to work on any mode.</p>\n<p><code>(function() {\n  var oldCSS = CodeMirror.modes.css;\n  CodeMirror.registerMode(\"css\", function(a, b) {\n    var mode = oldCSS(a, b);\n    mode.oldToken = mode.token;\n    mode.token = function(stream, state) {\n       var style = mode.oldToken(stream, state);\n       return style &amp;&amp; (style + \" m-css\");\n    };\n    return mode;\n  });\n)());</code>\n. The mixed mode should probably match against <code>/\\btag\\b/</code> instead of comparing directly.\n. Good catch. Implemented in 36c763bc75e037441dafdfc268bcf4740cdf10f5\n. Thanks. Merged.\n. This sounds like it was filed on the wrong repository. At least, I'm not aware of any user accounts in CodeMirror.\n. Thanks, merged. Good point about <code>\\b</code> matching a dash.\n. Thanks, merged. There's still a problem if multiple extensions try to mess with the same property, but I don't see a way to fix that that doesn't seriously complicate the extension model (which is something I'd prefer not to do). So this will do fine for now.\n. I assume text-decoration was meant there. I've committed be4fe61ef9270437d9dd43371acf0b37eb2275fa instead.\n. Closing in favour of 19939b9252c864df457fc662ca63fbff96322bfa (though if that one doesn't work as expected, I'll fall back to this).\n. Thanks! Merged in 52268db926c04e259b4ecd54ebf635329eb0d916. But then I got a little carried away (52a98ada18414ceb9e1e0793afff30568d2a43f2) and basically rewrote it. I renamed it <code>http</code>, since I like short names, and extended it to parse the first line as separate tokens, properly color the status code without extra styling, and conform more to the coding style of the rest of the codebase. If you find that I broke anything, let me know.\n. Thanks, merged. I'll try to verify that it also ends up in the new vim mode.\n. Since <code>onemore</code> isn't the default in VIM, I think we should still provide the other mode. Though I can imagine how it'd be somewhat awkward.\n. I agree that we should follow vim's defaults. If we're providing a vim mode, it should be as close to vim as practical, and we shouldn't be second-guessing vim.</p>\n<p>Also agree that this doesn't block merging this in. I'll do that later today.\n. <strong>Don't</strong> send me videos, send me a file that reproduces the issue. Even with your code snippet, this does not happen for me.\n. Which browser are you testing on? Sliding downwards in the demo works just fine for me on Chrome.\n. You know what I really hate? Debugging other people's code without getting paid for it. You're calling replaceRange with the same start and end, even after the actual number shrank. Simply log the inputs you're giving to replaceRange to see it. Also, to reproduce, set a value to 100, and click on the left side of the second zero before sliding down.\n. Thank you. Merged.\n. Thank you. Merged as 6582efaaff7327b979e76f2b0766d163b890cb44\n. Merged! Could you prefix your future commit messages with <code>[vim keymap]</code> so that it's clear what their scope is?\n. By the way (couldn't find your e-mail address, so I'm just using this as a communication channel), would it remove cruft from the new vim mode if there was a way to have a keymap simply be a function that, given a key name string, returns either a binding or <code>null</code> to indicate it doesn't bind that key? I notice you're creating several keymaps and populating them with tons of bindings, a lot of whom aren't really doing anything.\n. Ah, I see you're only building one such keymap. I guess that's not too bad. Still a shame that you need the logic in buildVimKeymap to fill in all possible keys, though. But if it doesn't bother you, I'll leave it as it is.\n. Fixed by 55028a026ec29806a639514b88a0ba25efdfbeb9\n. This is unavoidable. A CodeMirror instance is, as far as the browser is concerned, not an editable control, so it won't apply spell checking to it. It would not be hard to write a custom spell checker that works on CodeMirror, and there has been talk about doing this, but no one has actually done it yet.</p>\n<p>Closing this on the grounds of 'that's just the way things are'.\n. Neat. This is one of the use cases I had in mind when adding the addOverlay\nfunctionality. If someone knows of a CDN-hosted way to run typo.js, I'll\nadd a demo to the website. (I don't want to include too much junk in the\nrepository, and the typo.js dictionaries are quite a lot of data.)</p>\n<p>On Tue, Jan 22, 2013 at 6:07 PM, Brandon Frohs notifications@github.comwrote:</p>\n<blockquote>\n<p>Just for reference, it looks like someone has integrated type.js with\nCodeMirror: http://stackoverflow.com/a/12462720/526741. It could do with\nsome improvements, but it's a start.</p>\n<p>\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/1017#issuecomment-12554569.\n. Since version 4, each line is wrapped in a <code>span</code> already. But doing <code>.setAttribute(\"spellcheck\", \"true\")</code> on that span does not seem to do anything (in Chrome or Firefox). Is it supported yet?\n. Okay, yeah, that uses <code>contentEditable</code>, which is not going to happen in CodeMirror.\n. Thanks, merged.\n. Merged. No problem about including multiple patches in a pull req, if they depend on each other.</p>\n</blockquote>\n<p>I really appreciate the fact that you also write tests! That makes is easier for me as a vim-ignoramus to merge patches to vim.js without the fear that they break everything.\n. Looks like a good idea. Merged.\n. I'd be open to that, but as an add-on, not in core. If you decide to tackle that, you'll want to work from the v3 branch, since that has a number of improvements that make such an add-on possible. Use <code>defineOption</code> to define an option <code>placeholder</code> (see <code>lib/util/closetag.js</code> -- in the v3 branch -- for an example), make that option register (and unregister when turned off) <code>change</code>, <code>focus</code>, and <code>blur</code> handlers (<code>cm.on('change', function(cm) {...})</code>) that update the visibility of the placeholder. Make sure you don't call <code>getValue()</code> to check for an empty editor, since it's hugely expensive when the document is big. Use something like <code>cm.lineCount() == 1 &amp;&amp; cm.getLine(0) == \"\"</code> instead.\n. [This is a significant effort that I'll probably only undertake when sponsors step up.]\n. The lazy measuring is implemented in the v4 branch. Lazy drawing is planned, further tracked by #2090\n. Great. Merged.\n. I can reproduce this (though only on Windows -- Linux and OS X don't seem to do it). It's, in some nebulous way, resulting from the focus switching between the completion dropdown and the editor iself.</p>\n<p>I suspect the <code>&lt;select multiple&gt;</code>-based implementation has been pushed as far as it can go, and someone should reimplement <code>simple-hint.js</code> using a plain <code>&lt;div&gt;</code> in combination with <code>addKeyMap</code> (which only exists in v3).\n. This will almost certainly be solved by the new hinting widget (addon/hint/show-hint.js), which doesn't use the dodgy tricks that the old one used.\n. How about you try?\n. Ah, I see what you mean. Is that important? For quoted strings, the string markup will span only the quoted parts. For non-quoted ones, it'll span everything between the parens. Kind of makes sense, no?\n. This doesn't seem like a very robust fix. If I try to reformat some JavaScript code, it is indeed unfortunate that blank lines between statements vanish. But with your patch, they still vanish, and every reformat adds another newline to the end of the formatted region.\n. Okay. Closing this, open a new one when you're ready.\n. See my comment on #1036\n. It could do what <code>lib/util/matchbrackets.js</code> does -- use <code>getTokenAt</code> to get the style of the thing you're matching against, and only count brackets that use the same style.\n. As you noticed, <code>matchbrackets.js</code> is only in v3 because it requires being able to register cursoractivity handlers without stepping on other components that might be doing the same. It also requires <code>defineOption</code>, which is only in v3. It might be an okay compromise to have <code>vim.js</code> defer to <code>matchbrackets</code> on the v3 branch, and copy-paste in the relevant methods on the master branch.\n. This isn't possible with the current built-in selection model. It might be workable for the vim mode to keep its own selection, but that's probably going to get messy.\n. Closing this. We can revisit when/if a serious multi-cursor implementation happens.\n. Thanks. Merged (squashed) as 4dd4d647c18a83be35169aa2135ce0028fa29065 . Why did you always take 3 spaces after a continued <code>*</code>? Wouldn't it make more sense to use the amount found on the previous line?\n. But for non-nested lists, the common case, a single space works just fine. So I'd say it would be a good thing to support that too.\n. See #943\n. You could switch the order of your style inclusions, or modify the themes that include a background to style <code>.cm-s-XXX.CodeMirror</code>, which would be more specific than just <code>.CodeMirror</code> (I'd accept that as a pull req).\n. codemirror.css is irrelevant here. The conflict is between the theme css file and your own <code>&lt;style&gt;</code> tag.</p>\n<p><code>.cm-s-blackboard .CodeMirror</code> (with a space) defines a style for <code>.CodeMirror</code> elements that are a child of <code>.cm-s-blackboard</code>. Lose the space.\n. Merged for now.</p>\n<p>Now that you've pulled in dialog.js, I'd be in favor of also using that to implement some kind of <code>:</code> prompt (whatever that's called in vim) again. I thought that was neat in the old vim mode, though it didn't do very much yet.\n. &gt; it would be quick to add a test/vim.html that runs just vim tests, while test/index.html runs all tests. @marijnh would you be ok with that?</p>\n<p>You can open <code>test/index.html#vim_*</code> to run just the vim tests. That covers this use case, right?\n. I'm getting conflicts merging this. Also, if you're going to submit the same patches in multiple requests (because of interdependence, I guess), please close previous requests that include the patches.</p>\n<p>Could either @siefkenj or @mightyguava clean up this set of patches (including those in #1030) so that they apply cleanly to master, rebase the ones that are just fixes of other patches in the set so that they become a single, focused patch, and submit a new pull request? There's so much communication around this that I'm not sure how to proceed.</p>\n<p>I do try to apply everything that can be easily applied to both master and v3 to both branches. (Most of the non-core code is unchanged, so there's typically little merging to do.)\n. Oh, my bad, I was applying this to a local branch. No wonder I got conflicts. I'm taking another stab at merging it myself.\n. Okay, I managed to rebase this down to two patches (roughly one for #1030, 9fceebda1dcc92f2d0378bbb399d649820b41400 , and one for this pull req, 53bbadcb4bc35be2a1e51f8f6df05f3ef9404b27 ) and apply them. Tests still pass. Merged! (Both in v3 and master)\n. Oh, hey, it's raining patches. I'll merge that one now, but do add new pull requests for further ones. (Also, realize that once you tie a branch to a pull req, anything you do there will show up in the pull request.)\n. Merged. I had to merge a small conflict with #1036, but I think it was obvious how to do it, and the tests still pass.\n. See the discussion in #923 . This is indeed new in v3, and I'm not 100% certain that it makes sense, but it is more consistent than the vague heuristic I used before.\n. It's not a problem to apply a different patch on master and v3. As long as the differences are small, most subsequent patches will probably apply without trouble.\n. There <em>will</em> be conflicts if branches diverge, but as long as there's only a few lines difference, those should be easy to sort out.</p>\n<p>Or just take the plunge and abandon <code>master</code>. I wouldn't mind. 3.0 is looking like it'll be a stable release in a week or so (nothing has come up that would block release candidate 2).\n. Merged! Thanks.\n. You seem to have changed the line endings of every single file you touched. I'm not going to merge it like this. Teach your editor to behave first.\n. Thanks! Merged.\n. You're expected to pass something like <code>{line: 500, ch: 0}</code>. I changed it to also allow plain line numbers. But it was, in the Less mode, not scrolling to the right position because of an issue similar to #1043. Should be fixed now.\n. I've pushed a fix. But I do doubt that a recalculation <em>on a display: none element</em> would take a noticeable amount of time/energy. There's nothing to reflow, and I expect browsers are smart enough to notice that.\n. I would think that, since this is called from an interval, it will only happen when the layout is already computed -- in which case fetching the offsetHeight simply accesses a cached value.</p>\n<p>I guess you profiled and it showed something else? I am not aware of any other straightforward method for checking this which takes into account whether the node is in the document, and whether it and all of its parents have a non-none display style. (Maybe there are other ways in which nodes can be hidden?) But there's a bunch of similar checks throughout the code, and I would be interested in something faster/cleaner if you can come up with something.\n. That's a reasonable solution. Applied.\n. Good point. See 8f8072a86323196631c1966bf11075824e6d714e\n. This doesn't bother me very much, but a pull request would be welcome.\n. Merged!\n. Merged!\n. Merged!\n. I can't reproduce this. If I add these styles to one of the demos and add a long line, I can still scroll to the end of the text just fine. Or were you hoping to see empty space for the padding?\n. Ah, good call, the max width value wasn't being recomputed on refresh. Should be better now.</p>\n<p>As for seeing the padding when scrolling to the right -- DOM elements, when forced to scroll horizontally, allow the content to 'push into' padding, at least for the DOM layout that CodeMirror uses. This is consistent between browsers, and seems benign, so I don't consider it something that calls for another hack to work around.\n. Ctrl-c/ctrl-v work fine for me on 12.11 Linux. Which OS are you on?</p>\n<p>The context menu not working on Opera is a known issue. Opera simply doesn't allow the trick CodeMirror uses to trick other browsers into applying the context menu to a hidden textarea. Setting contenteditable=true is not a viable solution either.\n. I can reproduce this on Mac. The new Opera version is no longer confused about ctrlKey and metaKey properties, but CodeMirror was still expecting it to be. I've pushed a patch to fix this.\n. Merged!\n. That does seem like a lot of extra complexity. Why didn't simply using <code>multiLineIndent</code> instead of <code>indentUnit</code> in the <code>if (ctx.type == \"statement\")</code> have pretty much the same effect? If not, could you describe, in English, what the feature does?\n. That does seem like a lot of extra complexity. Why didn't simply using <code>multiLineIndent</code> instead of <code>indentUnit</code> in the <code>if (ctx.type == \"statement\")</code> have pretty much the same effect? If not, could you describe, in English, what the feature does?\n. Does the attached patch do what you want? Just pass the clike mode a <code>statementIndentUnit</code> config option to set the indentation for continued statements.\n. See the latest attached commit. If you set <code>dontAlignCalls</code> to true, it turns off the behavior where it will align continued parenthesized lists with the start of the list.\n. Please do not use the bug tracker for support requests.\n. Thanks! Merged.</p>\n<p>@jankeromnes For folders, x means listable\n. I can't figure out what you mean. What do you do, precisely? What did you expect to happen? What happened?\n. I can't imagine how an HTML completer would know in advance what tag you want to open. But in any case, it looks like the thing referred to in that thread was never implemented for CodeMirror 2 or higher. If you want something like this, I guess you'll have to implement it yourself.\n. I didn't write the xml hinter, and I'm having a lot of trouble figuring out what you mean from your cryptic communication.\n. &gt; I try to follow http://codemirror.net/demo/xmlcomplete.html demo and find that if I want to use xml-hint.js I need to write all the HTML marks combinations and also write for multi tag levels.</p>\n<p>Now I see what you mean. Yes, at first glance, it does indeed appear that the xml hinter expects this. That's bad. I'd be very happy with a pull request that makes it take a schema-like description of the permitted documents, and uses that instead.\n. Thanks. Merged in both branches.\n. Well, that is a <em>very</em> invasive CSS rule that you specified. I think you'll just have to add the workaround you showed, and live with it. I don't want to include a rule like that in <code>codemirror.css</code>, since rules ending with <code>*</code> are rather expensive, and I don't want all users to incur a performance penalty for such an obscure case.\n. I still feel the blame lies squarely with those frameworks, which are breaking basic defaults in CSS, which is obviously going to cause problems with 3rd party components. But since it seems they are too stubborn to change this, and we can indeed work around this by only setting the style of two classes (I assumed we'd need something horrible like <code>.CodeMirror *</code>), I've pushed the attached patch.</p>\n<p>I believe <code>-webkit-box-sizing</code> hasn't been necessary for ages, so I left that out. But if I'm wrong, please let me know why.\n. Going to let this slide, as CM 2.x is about to become legacy, and Opera 9 has been legacy for a while now. See related bug for #1064 for v3.\n. Seems old opera's have similar quirks to old IEs when it comes to line wrapping. I've disabled two tests that rely on that (testing for odd cursor behavior on particular types of wrapped lines), and fixed one other test.\n. See attached patch. I modified the interface because things that take a single option invariably evolve to take more, so an option object is more future-proof than a boolean parameter. Otherwise, this looks great. Merged.\n. Good idea. Merged. But I rewrote the second patch to be a bit simpler by not including the whole default-filling mechanism. That looked like overkill.\n. Thanks! Merged.\n. Merged!\n. Using an overlay mode to do the highlighting is a great idea. I share your concern about modularity. I think the best way to handle this is to expose an interface for adding and removing wrapper modes on the fly, without trampling the <code>mode</code> option. Some cleverness could be added to avoid re-parsing the whole document above the viewport when adding or removing stateless overlays.</p>\n<p>I have some other things I want to do today, so I'll look into this more closely another time (probably after bringing out v3.0, since it involves slightly risky changes to the core).\n. See the linked commit for an implementation of non-intrusive, stateless overlays. These have the advantage that they really won't cause any superfluous work, whereas setting the mode to something new when scrolled halfway down a huge doc will cause a lot of re-parsing to happen.</p>\n<p>Please update your patch to use this new feature, and I'll merge it.\n. Very cool. Merged.\n. Merged!\n. Merged, with some modifications in the attached patch. (I really don't care at all about long lines, and indentation/whitespace also isn't a big issue.)\n. Merged!\n. Good idea. I wish there was a way not to pollute the git history of a file with a change like this, but I guess there isn't. I'll deal with it. Merged.\n. That being said, there are <em>much more interesting</em> things to worry about than whitespace or other coding style details.\n. I can't reproduce this precisely, though I did spot some flakiness in the way the cursor is updated when the editor (inner) width changes. Could you re-try with the attached patch?\n. That's great to hear. Thanks for the report!\n. But a more lightweight solution would simply be to allow passing of a keymap when opening a dialog, and running key events fired on the focused form input through it. It'd only require some mild refactoring of the key handling code in CM to make it more generally applicable, and exporting them.\n. Sounds good!</p>\n<blockquote>\n<p>Do you have any hints/suggestions on how to do the refactoring and anything to watch out for? Event handling logic is always rather tricky and I'd rather not break CodeMirror completely.</p>\n</blockquote>\n<p>I agree that it's subtle. Be sure you're aware of all the obscure conventions in the keymap system (such as setting a binding to null to suppress further bindings in submaps, and throwing CodeMirror.Pass to pass on handling the key). I don't have the whole system in my head.</p>\n<p>Basically, I think the task would be to clean up the interface of the <code>lookupKey</code> function to the point where it could be documented without sounding ridiculous (probably integrate part of <code>doHandleBinding</code> into it, and return an object with some properties to indicate status rather than the hack with the <code>stop</code> callback function). If you have a sane version of <code>lookupKey</code>, I think it'd be easy to add support for keymaps to dialog.js.</p>\n<blockquote>\n<p>Would you like event handling be added as an option (as a part of the options map?) to dialog.js, or keep it lightweight and create an alternate file that exports the same interface?</p>\n</blockquote>\n<p>I expect the code added to dialog.js would be small, so feel free to just throw it in there.\n. I was thinking more along the lines of the attached patch. Expose a few primitives that can be combined to do key handling, rather than defining a full 'framework' for it and forcing CodeMirror into that.\n. Done in f4fcea92fa4375189bb6f66ccb3359729cca24aa\n. Fixed by cc6548d07e41d0c1d2de30d2b777a2b50e03c961 . I agree that I really don't want personal bindings in the vim mode.\n. @mightyguava Even if the default behavior of ';' (and I have no idea what that might be) is not currently implemented, someone might implement it in the future, and if we've already committed to binding it to something else, that'll be awkward. If we're promising people a vim mode, I really do feel strongly that we should just provide vim bindings. There'll be no discoverability of any non-standard stuff we add, so it'd only be used by you and a few people who happened to read the source of <code>vim.js</code> anyway.</p>\n<p>A separate project <em>on top of</em> <code>vim.js</code> which adds your chosen convenience shortcuts, and for which you maintain documentation, would probably be a better idea than just mixing such improvements into the base vim mode.\n. Workarounds are no problem, and I'm not going to be a pain about this (I couldn't check if I wanted to, not being a vim user ;) -- just keep in mind that if what you're doing is not going to be found by a user accustomed to vanilla vim, it's probably not going to be used, and is thus just ballast.\n. Merged!\n. All non-3.0-specific patches will be merged into v2 when I release 2.37.\n. Does anyone know why the exclamation mark gets drawn to the right of the text? Following http://www.unicode.org/reports/tr9 , I'd expect '!' to be of category 'Other Neutrals', and thus get 'absorbed' into the RTL text beside it by rule N1, and drawn to the left. The disagreement between what my algorithm is computing and what browsers are doing is what's causing the broken behavior.\n. Well, it seems that the boundaries of a line are, by the browser, always treated as left-to-right, so that the exclamation point was sitting between two inconsistent directions (RTL for the text, LTR for the end-of-line), and thus categorized as LTR. Not what I would have expected, but I've updated my algorithm to agree with what browsers are doing here.</p>\n<p>Please check whether it solves the problem for you, and by all means, report any further flakiness you find! As someone who's not familiar with RTL scripts, it is hard for me to test.\n. Ah, that was a different problem. Should also be fixed now.\n. Browser?\n. Great. Now how many characters does your line have? When you paste it into a textarea in Chrome, does it paste correctly?\n. I can't reproduce this in Chrome 23.0.1271.95 on Windows XP (or Linux). Can you also provide me with the string you're trying to paste and the demo you're pasting into? (And maybe next time provide all that information right away instead of making me ask...)\n. Aha, now I can reproduce. It's not CodeMirror that does the cutting-off, it's Webkit (try with any textarea that has <code>wrap=off</code>), but I've found a workaround.\n. Thanks. Merged.\n. &gt; <code>\"text\":\",     \"</code></p>\n<p>That's very unlikely. The <code>text</code> property will always hold an array. I just double-checked the code, and there is no way CodeMirror will return a string there. As the manual states, this is an array of lines. If it has more than one element, the replacement text spans multiple lines. The newline characters will not be in the strings. Use <code>.join(\"\\n\")</code> on it to get the <em>actual</em> replacement text.\n. I can't reproduce this. Where are you entering this? Does it happen in the demo at http://codemirror.net/mode/htmlmixed/ ?\n. As an aside, you might want to have the vim mode use <code>defineOption</code> to add a <code>vimMode</code> option which, when turned on, sets the keymap to vim <em>and does a few other things</em>, such as registering cursoractivity handlers that force the cursor back when it is placed in an invalid position.\n. The above all sounds very good to me, more or less the direction I hoped the mode would go in. (I didn't look at the code yet, and of course, @mightyguava has the last word what happens in this file)\n. &gt; @marijnh do you have any suggestions on a good way to have an abstraction between vim and cm state yet link one to the other?</p>\n<p>What is wrong with just storing it as a property of the CM instance?</p>\n<p>Using <code>markText</code> for the cursor should work. It's not as efficient as the default overlay cursor (requires redraws on the lines themselves), but that's only problematic for very long lines.\n. Closed by 70a267a \n. Thank you. Merged!\n. Now try it the other way round -- first ctrl-v (on a blank line), and then ctrl-a, ctrl-v. If that flips the effect around (now the ctrl-a, ctrl-v is fast), you're seeing a caching effect -- the layout of your long line is cached, so it doesn't have to be recomputed, which is why the second paste is faster.\n. Yes, this is related to #1022. Measuring character positions in a huge line is unfortunately really expensive.\n. &gt; Also got rid of brackets that weren't necessary in the first place (that's what you prefer, right?).</p>\n<p>I really don't care either way.</p>\n<p>Patch looks good. Merged!\n. Thanks! I didn't use my usual script to do this release, since it was somewhat more involved, and of course forgot to update that symlink. Should be fixed now.\n. Hi Ian,</p>\n<p>The original purpose of these collections is not autocompletion, but highlighting local variables differently. For that purpose, I don't want globals to be marked, since they shouldn't be colored as local variables.</p>\n<p>You could extend the mode to keep a list of globals, I'd accept that as a pull req if you do it in such a way that coloring is not affected. But do be aware that you'll only see globals defined <em>before</em> the point where you're calling getTokenAt/getStateAfter, so it's still not a perfect solution.</p>\n<p>Best,\nMarijn\n. Handled in #1090\n. Thanks! Merged.\n. Thanks for the continued improvements. Merged. (Will end up in v2 too.)\n. Thanks, merged!\n. Good point. Could you see whether the above, cheaper patch, also works for you?\n. As for moving the testground -- sounds good. Just make sure that the kludges that unhide failing tests when verbose is on still work.\n. Good catch. I've made the change you suggested. Closing this, awaiting your further pull request.\n. Thanks! Merged, with ec508eb14e134d80d3f91e06804edef4217d0a49 taking care of the unhiding problem I mentioned.\n. I don't think running the testsuite is going to help much in pinpointing a bug -- unless people are running a completely obscure browser, it won't tell them anything we don't already know. I think this is more likely to confuse people (say we have a non-passing test that has nothing to do with the bug) than to help.\n. But why would I need users to run the testsuite? It's a tool for development.\n. This is intentional. Nocursor implies no selection. Just use <code>readOnly: true</code> if you want things to be selectable. You can style the cursor to be invisible if you don't want it to show up (use something like <code>.CodeMirror-cursor { display: none !important }</code>)\n. Indeed. Merged. With a typo fixed in b64f3a152461366cded28a7640e97d48d1dd4a29\n. Oops. Thank you, merged.\n. Great! This is a very useful feature.</p>\n<p>A few remarks:\n- You'll probably want to make sure <code>outerType</code> in the bidi algorithm is \"R\" instead of \"L\" when rtl is enabled (pass it in somehow). (At least, I suspect you'll see something similar like issue #1079, but the other way around -- <em>do</em> confirm whether it really is a problem before doing anything.)\n- Where are you planning to place the scrollbars when the gutter is on the right? Vertical scrollbar between gutter and code? Or all the way to the left? (might work well, though I guess it is unusual)\n- The selection drawing code assumes it must 'extend' the selection all the way to right, where with this setting it should use the left. I guess that shouldn't be too hard to change.\n. - Yes, that's the <code>outerType</code> I meant\n- CodeMirror fakes its scrollbars (see <a href=\"http://marijnhaverbeke.nl/blog/a-pathological-scrolling-model.html\">here</a>), so you'll have to do more work to reposition them. See the <code>updateScrollbars</code> function.\n- The selection drawing lives in <code>updateSelectionRange</code>.</p>\n<p>No idea where the mouse problem could be coming from. Check for errors in your console and add logging to the <code>onMouseDown</code> function.\n. Closing this awaiting further development.\n. Yes, this is something that CodeMirror won't currently handle. It makes an effort to (vertically) scroll the cursor into view when the top-level document is scrolled away from it, but nothing beyond that. On WebKit, there's the <code>scrollIntoViewIfNeeded</code> method, which is pretty much what we want here, but it doesn't exist on other browsers, and emulating it is quite a bit of extra code and extra work, which I'm not sure is worth it.</p>\n<p>You could consider listening to the <code>cursorActivity</code> event on CodeMirror and doing manual scrolling-into-view of the cursor there. Alternatively, you can take a stab at making CodeMirror handle this situation properly, though I'll only take a patch if it's relatively small.\n. I found that implementation of <code>scrollIntoViewIfNeeded</code> as well -- but it's quite a lot of code for a feature that most users will never need.</p>\n<p>The reason pressing Enter did not scroll the cursor into view, but typing regular text did, is precisely this hidden textarea. Whenever it gets input, it'll scroll into view. But CodeMirror handles Enter directly, so there the browser's behavior didn't kick in.\n. I'm not sure that'd work (if it receives the key, it'll insert a newline, which then has to be somehow filtered out again), but it'd also not really solve the whole problem. Other keys, such as cursor movement, would still have the same problem.\n. Thanks, merged!\n. For atomic spans (and collapsed implies atomic), the cursor is prevented from entering the span (and pushed out when the span is set), so your diagnosis that the problem has something to do with the cursor being <em>inside</em> the span seems  wrong.</p>\n<p>The underlying problem here is that you're adding a block element. That won't be supported. Use line widgets if you need to put block elements into the editor. They can't be part of a line. I should probably document that.\n. Using current master, you should be able to do something like this to get the effect you're looking for:</p>\n<p><code>function hrLine(cm, lineNo) {\n  cm.markText({line: lineNo - 1}, {line: lineNo}, {collapsed: true, inclusiveLeft: lineNo == 0, inclusiveRight: true});\n  cm.addLineWidget(lineNo, document.createElement(\"hr\"), {showIfHidden: true});\n}</code>\n. &gt; I'm not sure why markText would not just do that.</p>\n<p>It replaces an <em>inline</em> stretch of text with an <em>inline</em> widget. Mixing inline and block elements in some non-disciplined way would really get messy (both to implement and to predict behavior).</p>\n<p>Setting <code>marker.replacedWith</code> after the fact seems very wrong. I guess the only reason that isn't causing the widgets to show up twice is that it'll be added to the dom twice, and thus only the second time will take effect (moving it from its first, bogus position). Why don't you simply use another property name? (And read it out again later.)\n. &gt; I did considered that but then it won't show up in marker.getOptions().</p>\n<p>Nope, but that's good, since in this case it <em>isn't</em> an option that you're passing to <code>markText</code>. Just write something that wraps <code>getOptions</code> and returns a higher-level kind of marker description.</p>\n<blockquote>\n<p>BTW do I subscribe to \"clear\" events incorrectly or why aren't they called ?</p>\n</blockquote>\n<p><code>CodeMirror.on(myMarker, \"clear\", function() {/*...*/})</code> should do it.\n. There are reasons that existing markers can't be moved (the implementation of the undo history relies on it). Isn't it extremely easy to <code>.find()</code> and re-set the marker? You can query the marker object for its options (they are simply properties on the handle).\n. See #1111 for further discussion.\n. Exporting the TextMarker constructor is a good idea. I'm also open to adding some more events on markers (cursorEnter, cursorLeave) and adding a method to get an options object from an existing marker. Would that suffice?</p>\n<p>(Things like <code>attachOnExit</code> would be <em>way</em> too use-case specific.)\n. See attached patch.\n. Thanks! Merged.\n. Should be fixed in https://github.com/marijnh/CodeMirror/commit/8e4a72f505c8fba8eeb1571d1ba944c9c00120bd\n. This is not unnecessary. The editor repaints its display, and the widgets are part of that. It could be made smarter about leaving the widgets in place in some situations (where the line is visible both before and after the update), but that'd complicate the redraw algorithm quite a bit, and I'm not really interested in adding that complexity.\n. Thank you. Merged.\n. Merged the D mode. Thanks!</p>\n<p>I did not merge the background color change. The default background is intentionally transparent, since this is often useful. For a full-screen app, simply add a rule to your own style sheets to make it white.\n. This is not how the relationship between the origin textarea and CodeMirror works. Keeping them in sync with polling would be <em>way</em> too expensive for big document. CodeMirror will automatically update the origin textarea when its <code>save()</code> method is called or the form around the textarea is submitted. It won't do anything beyond that. If you want to propagate changes from the textarea to the editor, you'll have to take care of that yourself.\n. The thing is that the hidden, internal textarea has been engineered to be cheap to poll -- it never contains a lot of text, and it always has most of the text inside of it selected, so that the value only needs to be extracted when it has no selection (typing will clear the selection).</p>\n<p>An external textarea does not have these properties. Getting and setting the content of a textarea is relatively expensive if the string is long, so it would not be cheap to poll. Furthermore, it'd need <em>completely</em> different polling code, since it behaves nothing like the hidden textarea (which does not contain the whole document).\n. Yes, autoformat will make the formatted range end in a newline when it considers this appropriate. It does not appear to be adding extra newlines when doing multiple passes, so I don't think this is a bug.\n. Ah, now I see the problem. It was indeed also adding them when not necessary. See attached patch for a fix. (Please test.)\n. Linked from this issue, two comments above this one.\n. Thanks. I've applied your change.\n. Oops, I pushed a similar patch before seeing this pull request. See 1dad2c920299db582b29fa0048e4089342a05817\n. Thanks! Merged.\n. Good call. Merged.\n. Oops. Thanks for catching that. Merged.\n. Wonderful. Merged. I'm not sure why 'Fix :map' showed up in this pull req again. It's already in master. At least, some commit by that name is.\n. This is a manifestation of the IE bug mentioned in the comment at https://github.com/marijnh/CodeMirror/blob/55d4f13cbd669cf4aaf5ef9b50044941bcfa1c61/lib/codemirror.js#L1011 . The work-around described there only works when there actually is a character to take the measurement of. When there's a single-char span of rtl or ltr text at the end of a line, and IE reports a nonsense position for that character, the code currently can't recover from that.</p>\n<p>One solution would be to add a bunch of cruft to <code>lineContent</code> to detect this case and add a zero-width to the end of the line, and somehow use that when finding the position. But that sounds like an ugly and invasive kludge. I hope I can come up with something better.\n. Thanks. Merged.\n. Looks good. Merged.\n. Nice! Should I wait with merging until it is no longer preliminar?\n. Great. Merged.\n. Oh, that was bad. Thanks for catching it. Merged.\n. Thanks, good call. Merged.\n. That appears to have been a regression caused by the solution to #1080 -- when the textarea doesn't have wrap=off set, it'll spend four seconds breaking lines when you paste in a big document.\n. I could not reproduce this. Does the problem go away if you disable <code>matchBrackets</code>? Which text, precisely, did you paste in? And does the problem happen on all lines, or only on specific ones?\n. Thanks for the added information. Still no luck reproducing it. Does it also happen for you on http://codemirror.net/mode/javascript ? Which CodeMirror version are you using? And which precise IE9 version?\n. Did you try with the latest CodeMirror development snapshot? If that doesn't help, could you give me a minimal (i.e. all cruft that doesn't help trigger the bug) HTML page that reproduces the problem?\n. Timing out. Respond with more information and a test case if this still comes up.\n. This has been merged (I thought I commented/closed already). Thanks!\n. This file is a node.js module. Adding a global variable from such a module is a bad idea. And manipulating the DOM makes no sense, since there is no DOM in node.js.\n. I wouldn't be opposed to a new file doing something like this for the browser, by the way. Just don't overwrite the current one.\n. Merged. Thanks. And then I reorganized the lib/util directory into addon/* (#1133) and now the new script lives at <code>addon/runmode/runmode-standalone.js</code> (with the other one renamed to <code>runmode.node.js</code>)\n. Thanks for the very neat, complete pull request! Merged.\n. Oops. Good point.\n. Thanks. Merged.\n. This does appear to be an Opera bug. When zoomed in, it somehow renders the text in the <code>CodeMirror-measure</code> div slightly bigger than the text in the visible lines, even though the font-related styles for the two are precisely the same (<code>getComputedStyle</code> confirms this). Seems like a rounding error of some sort. This causes text size measurements to be wrong, which is causing these tests to fail. It also causes the cursor to be drawn in the wrong place, so it's a somewhat problematic bug.</p>\n<p>I didn't manage to get the same effect in a static HTML page, even when trying to closely copy the DOM structure the CodeMirror uses. Not sure what triggers the problem. Turning off all styles on <code>CodeMirror-measure</code> did not make a difference. It might be related to the time at which a piece of DOM is updated/rendered.\n. They are <em>starting</em> to move to another engine. Let's leave this open until the majority of Opera installs are actually Webkit-based.\n. Which Opera version on which platform?\n. Ah, sorry, I hadn't seen this was a reply to an old issue. Which version of Phantom, then? My local version (1.9.2-5) passes all tests. But text measuring on Phantom is notably shaky, and its bugs in that area rarely translate to issues with real browsers, so it probably isn't a relevant piece of data.\n. I upgraded to PhantomJS 1.9.8 (Linux) and the tests still pass for me.</p>\n<p>I don't have an OS X development system set up, so I'm not able to further dig into this.\n. Okay, Presto is dead and this never was very major, so I'm going to close this.\n. Thanks for the helpful test case. I've pushed first a fix that makes <code>refresh</code> behave correctly in this situation, and then another one that adds a <code>changed()</code> method to line handlers, which provides a finer-grained (and cheaper) way to notify the editor when a widget changed.\n. See also the patches for #1147\n. I've integrated your suggestion. <code>document.documentMode</code> seems to be available and initialized even when running code at the top of the <code>&lt;head&gt;</code> tag.</p>\n<p>You'll still not get a very good experience running CodeMirror in IE7 mode, I expect. Might want to consider using release 2.37 instead of 3.0.\n. Thanks. Merged.\n. Merged, with a small modification to make it add the properties to <code>cm.display</code> (where DOM-related stuff goes).\n. Oops. Poor testing on my part. Merged.\n. See my comment on the pull request.\n. Nope -- the idea is to let <code>endOperation</code> handle that. Problem is how to defer the scrolling update to the end of the operation without causing problems in the rather delicate and interdependent order of actions taken by <code>endOperation</code>.\n. I've pushed a patch to the 3.1 branch that fixes this. Fixing it in 3.0x will probably not happen (I'd have to duplicate some stuff from 3.1 -- and 3.1 will be merged into master next week anyway.) So if this is important for you, I'd recommend updating to that branch.\n. Well, yes, <code>/.*/</code> matches everything, including the empty string, so obviously it'll keep on matching on that position, and never move forward. I'd argue this isn't a bug, but I agree that it's convenient if code can assume looping over matches doesn't produce an infinite loop.</p>\n<p>Do you have a suggested solution?\n. That seems like a nice and clean solution. Merged. I've also committed 1960b0d378270098d37aab223ff29237fa0b0372 to address the same situation with string queries.\n. We'll probably want to use the list in <code>mode/meta.js</code> instead of keeping a separate list in the markdown mode. But, I guess, until someone fixes that, I might as well merge this pull request. Done.\n. I might accept something that automatically promotes a certain type of token styles (say <code>block-...</code>) to be applied to the line wrapper DIV instead of the token's SPAN.</p>\n<p>The thing with automatically continuing the style of the end token of a line is probably out. There's simply no elegant way to model it in HTML/CSS without, as you mention, a lot of expensive manual positioning and gratuitous element creation. This would be a tax that would have to be paid for <em>all</em> lines, not just the ones that use the feature, since CodeMirror wouldn't be able to easily tell whether a style has a background. Also, backgrounds for tokens are problematic in general because they'll obscure the selection and cursor.\n. Patch e0b0e32ed97bdd9b4dcb559f0d383bbb197961e4 implements something similar to this. Testing welcome.\n. I'm getting ~10ms for refreshing a small-sized editor with line numbers (as in the demos), which grows to ~30ms when the editor is full screen.</p>\n<p>30 milliseconds isn't noticeable when switching tabs, so I assume you're seeing something else. Can you provide a minimal demo of the problem? And can you verify that you're not letting the editor itself grow very high? (For example, by giving it height: auto and putting tons of content into it.)\n. I spent a while optimizing the drawing performance just before the 3.0 release. I am not aware of any further optimization avenues, but of course there always are -- you just have to spend the time looking for them.</p>\n<p>Line numbers (or any other kind of gutter elements) add quite a bit of complexity to the DOM structure that CodeMirror produces, which explains the difference in speed that you see (it's mostly spent in the browser's layouting algorithm).\n. Thanks, looks good. Merged.</p>\n<p>Next time, put an empty line between the patch title and the rest of the description on the commit message -- it helps git figure out how to summarize the commit (by convention, the first 'paragraph' is the summary).\n. Dropbox is terrible about letting people without dropbox accounts view their sites. I don't have an account, so they won't let me view your link. Please use gist.github.com or similar instead.\n. Ah, it's literal text, not an attempt at creating a markdown link in the github comment. That makes sense.\n. Interestingly, the <em>one</em> piece of code from John Gruber that ended up in the CodeMirror distribution (the regexp the gfm mode used to detect URLs), was such a hack that it sends Chrome's regexp engine into some kind of exponential search. I've simplified the regexp.</p>\n<p>@bfrohs The result is still not great. It now styles the whole of this text, including the brackets, as a link. Could you look into that?\n. F5 never restores the content of textareas. Could you put a demo somewhere? Is this similar to #932 ?\n. Right, you can register an <code>onbeforeunload</code> handler that calls <code>.save()</code> on your editor. CodeMirror isn't going to do this by default (too invasive), but that might be a good workaround.\n. It seems my workaround for a Webkit bug had a bug in it. (Webkit simply stops rendering once a text node is longer than 57444 characters, my code tried to compensate by rendering smaller text nodes, but a recent refactor broke that.)</p>\n<p>See the attached patch.</p>\n<p>@matias-capeletto That's not a bug. Character 5000 is the point at which the highlighting will stop, 50000 is the size of the chunks in which we cut the remainder of the line to work around aforementioned Webkit bug.\n. You'll have to call <code>refresh()</code> on the inner editor after doing something like that. But that would still leave some of the problems. Attached patch makes the situation slightly better, but still not perfect. Typing into the line above the inline editor will still mess it up.</p>\n<p>I'm not going to make any invasive changes to improve this today, as I'm about to release 3.01. But I will look into it later. Probably, for complex widgets like a nested editor, what you want is to use a dummy widget that's just a sized DIV, and then overlay the actual inner editor (which doesn't live inside of the outer editor) over that. I'll also look into providing a convenient wrapper for this as an add-on.\n. I've made two more changes:\n- Regular typing in a line will now no longer cause the widgets for the line to be redrawn on every keystroke. This should reduce the amount of dom disruption that you get.\n- When the widget is redrawn (removed from the dom and added somewhere else), a <code>\"redraw\"</code> event is now fired on it. You can listen on these using <code>CodeMirror.on(widget, \"redraw\", function() {...})</code>. In your case, you'll want to hook up a call to <code>.refresh()</code> on the inner editor to this event.</p>\n<p>Let me know whether this helps.\n. Why is it so important to call setDragImage? Dumping nodes into the document doesn't seem very attractive.\n. Thanks. I've merged this, and then cleaned it up to only leave the fixed position element in the document for a very brief time.\n. Thanks! Merged.\n. This seems to also have happened in other browsers. Attached patch should help.\n. Not for me. Could you write another description that only involves relevant steps, distinguishes between mouse cursor and text cursor, and uses another demo page, since the less theme doesn't color the selection differently when the editor is deselected, and is thus needlessly obscuring the situation.\n. For me, the editor is perfectly well selected after doing this in Opera, in both 12.11 and 12.12.\n. Thanks, merged. I assume the vim keymap patch was in this pull request by accident, since you didn't mention it. If you feel it should be in the repository, please submit it as a separate pull req, and @-cc mightyguava , the author of the vim bindings.\n. Wonderful. Merged.\n. Thanks. Merged.\n. Good point. Fixed by a2dd2665e67838d94b37c5695b197eb7da680479\n. Unfortunately, no, JavaScript regexps live in an ascii world, stupidly enough (all browsers link in libicu or equivalent), and adding precise support for unicode character classes can only be done by including kilobytes of extra junk. So, in CodeMirror, I've decided not to. (At least for highlighting -- I did end up adding some ugly data strings and regexps for right-to-left support and recognition of extending characters, where the repercussions of getting it wrong are more serious).</p>\n<p>So this is a 'wontfix', unfortunately. Things might get better when browser vendors agree on some kind of Unicode API. But until then, I'm closing this issue.\n. And here I was scratching my head figuring out how a superfluous colon would ever parse. Heh. Thanks, merged.</p>\n<p>I've also updated the linter to catch trailing commas in the future.\n. You have to select the commented region in whole to uncomment it.\n. Thanks for catching that. Merged.\n. Thanks for catching that. Was a refactoring mistake in the 3.1 overhaul. Should be better now.\n. Merged. Which then led me to find out that the problem was much, much worse, which led to commit 02088b8ff92f05f0448faa16e65191622a266476 and release 3.02.\n. This is by design. Clicks in widgets go to the widget, not CodeMirror.\n. I can not reproduce this either. I see a perfectly still display when I do this.\n. Closing. See #1188.\n. Good point. I believe it was this way by accident, rather than for any good reason. I've moved the <code>CodeMirror-focused</code> class up to the wrapper.\n. On that exact same Chrome version, both on OS X Lion (I don't have a Mountain Lion-capable device) and on Linux, I can't reproduce the issue. Even when I make window so small that the editor is very narrow, the widget never scrolls along with the content.</p>\n<p>Can you reproduce this on any other browsers/platforms? Do the line numbers also start scrolling along with the content when this happens?\n. Hi Brendan,\n- This does not have to be wrapped in an operation (it doesn't do anything that requires a display update)\n- I'd also expose the <code>visual</code> argument (which determines whether, in right-to-left text, the movement goes by visual or logical direction).\n- Could you give the exposed method a more recognizeable name (<code>moveHorizontallyBy</code> or something) and describe it in the documentation?</p>\n<p>Best,\nMarijn\n. So, looking at this again, I can't help but feel that <code>findPosH</code> is extremely specific, and probably not much use for outside callers. Your example, backspacing over empty lines, doesn't seem like it can be implemented using <code>findPosH</code>. You're probably better off just writing your own logic for such a thing.\n. See f7c3944acd608bc2e6a7ffa673d4658dc08119ed , which exports and documents a cleaned-up horizontal-motion-finder.\n. Ah, yes, there was indeed a big fat bug in that code. Why it only showed up after resizing the window, I don't know. See 83ad399443099bcb0d24b4c0d9335ed1fe8a404d for my slightly simplified version of your fix.\n. Oh, those are very good points. Could you try again with the patch I attached to this issue?\n. Given how I can neither reproduce this, nor does it seem like a very big problem, I'm going to close this.\n. Thanks, merged. And I've restored 'over' -- the intention, which had been somehow messed up by the 3.0-related refactorings, was that the default placement is below (<code>pos.bottom</code>) and 'over' changes it to <code>pos.top</code>.\n. <code>addOverlay</code> and the overlay mode add-on are two different ways to create the same result, though <code>addOverlay</code> doesn't support overlays that require knowledge beyond the current line. You can't use them together, in any case.</p>\n<p>So use the \"mustache\" mode as the mode for your editor, don't call <code>addOverlay</code>.</p>\n<p>Also, questions go on the mailing list. This is a tracker for actual bugs.\n. This is a duplicate of #1129\n. Sounds like the bracket highlighting problem again. It seems to work fine in all other situations. I've not been able to figure out why that problem occurs. I think I'll simply disable the bracket highlighting add-on on IE7.\n. I've pushed a hack that seems to work around the IE7 bug triggered by <code>matchBrackets</code>. Does that solve your problem?\n. Well, that's all the IE I can stand for today, but things should be somewhat better now.\n. Pushed, minus the random refactor.\n. Thanks for the detailed bug report. Are you able to reproduce something like this directly in the Android browser, or only when you wrap the whole thing in an App?\n. Could someone please test whether attached patch (on the v4 branch) helps with the backspace problem?\n. @WorthlessSHU See patch 3c3003c , which seems to fix that problem.\n. Great. Only the Firefox error, or also the Android backspace part?\n. @glinden Ah, I can explain the fact that it only worked a single time, and I think patch 39e7c78 should take care of that problem.\n. @glinden The focused element in CodeMirror is simply a normal textarea, so all your theories about this having something to do with non-editable DOM nodes can be safely put aside. <code>readInput</code> does not do anything with key events, rather it looks at the content of this textarea to determine whether it changed, and applied changes to CodeMirror's representation of the document based on those changes. The idea with the underscore patches was that if the textarea contains a character before the cursor, the backspace key will remove this, allowing CodeMirror to see that something was deleted.</p>\n<p>But yes, if it doesn't work then I will revert it again.</p>\n<p>Any other people with an interest in this bug who want to work on this?\n. Hm, so either the logic for the virtual keyboard is a mess, or it is doing something that we haven't isolated yet. Anyway, I reverted the kludge, since there's no use having it if it doesn't solve the problem properly.\n. Thanks for digging into this and coming up with a more or less definite perspective on the problem.</p>\n<p>I'm going to close this as WONTFIX then.\n. This is intentional. All browsers parse textarea content in the same way -- they consider anything up to <code>&lt;/textarea&gt;</code> to be its content. Since these files are edited manually, escaping the content would be a major pain.\n. The existing htmlmixed mode already parses the content of style blocks as css.</p>\n<p>Does anyone really use handlebars/mustache script tags? (Why? Isn't the point of those templating languages that they are mixed into the actual document, rather than contained in a script tag that the browser won't render?)\n. You'll want to use <code>CodeMirror.innerMode</code> for that. The <code>mode</code> property hack has been abandoned in favor of that -- it works on all modes and is easier to use.\n. Same for <code>compareStates</code>, actually, that isn't a thing anymore in CM 3.\n. I've already removed that reference earlier today, when I noticed it while\nchecking whether the property had really been removed.\n. Merged, and followed up with a few modifications. Please verify that I didn't break anything in my patch (attached).\n. @redmunds A heads-up: I've made the script handling in htmlmixed mode configurable in ed02c832435220f003bedc8803537c2e73834a52 , and removed the hard-coded handling of mustache and handlebars. See the changes to <code>mode/htmlmixed/index.html</code> in that patch for an example of how to re-enable your mustache behavior again.\n. Thanks for catching that. Should be better now.\n. Can you describe how I can reproduce this? If I create an editor and immediately call <code>.focus()</code> on it in IE8 I'm not getting this error.</p>\n<p>try/catch might be a perfectly fine workaround -- with bogus IE errors, it's often the only sane solution.\n. You are not allowed to pass anything but -1 or 1 as the direction argument. Call it twice if you want to apply it twice.</p>\n<p>Incidentally, this is why I feel <code>findPosH</code> isn't much good as a public interface -- it's calling conventions are obscure, and tailored very specifically to its current use cases.\n. Why don't you just call it twice?</p>\n<p>On Thu, Jan 31, 2013 at 3:47 PM, Brandon Frohs notifications@github.comwrote:</p>\n<blockquote>\n<p>Would you be open to having it allow for values other than -1 and 1? Or\ndo you need it to behave exactly as-is for the core?</p>\n<p>\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/1201#issuecomment-12945461.\n. I'm still very puzzled how this interface helps at all when implementing the thing you're talking about. Maybe if you manage to explain that, I can form a more well-based opinion on whether it makes sense. If you're deleting a sequence of newlines, your code will have to check where the newlines end anyway, so the logic in <code>findPosH</code> would not seem to add anything.\n. Does not happen for me. Could it be that you're testing on an old and/or slow computer?\n. @jtmkrueger Could you try with version 4, and see if that helps? It optimizes some performance bottlenecks that existed in 3.x\n. One possible solution is to add an origin argument to <code>replaceRange</code> (<code>replaceSelection</code> already has one), rename the <code>\"delete\"</code> and <code>\"input\"</code> origins to <code>\"+delete\"</code> and <code>\"+input\"</code>, and adopt the convention that any editing action starting with a <code>+</code> can be batched. That'd be very easy to implement.</p>\n</blockquote>\n<p>Will it solve your use case? What if someone drags the slider, waits a second, and then drags it again? Do you want those changes to also be a single event? If so, you'll need a way to force event merging, no matter what the heuristics in <code>addToHistory</code> say (which the above proposal does not allow). Or we could simply add another convention, say a <code>*</code> at the start of an origin name, to mean that such subsequent events should always be merged.\n. Indeed -- generating unique origin strings will allow you to 'isolate' the event joining between different controls. The above patch implements the thing I described. Let me know if you find any problems with it.\n. Hi Jamie,</p>\n<p>The is an undocumented method (in 3.0x) <code>cm.view.doc.iter(start, end,\nfunction(line) {...})</code> which you can use to iterate efficiently over the\nlines. In the current master branch and next release, it is at\n<code>cm.doc.iter</code> (no more view property).</p>\n<p>This is not part of the public API yet, so it may break when you upgrade.\nI'll consider documenting it and making it public in the next release, if\nit works for you.</p>\n<p>Best,\nMarijn</p>\n<p>On Thu, Jan 31, 2013 at 2:03 AM, Jamie Hill notifications@github.comwrote:</p>\n<blockquote>\n<p>A quick benchmark:</p>\n<p>function getLines() {\n  var count = editor.lineCount(), i;\n  for (i = 0; i &lt; count; i++) {\n    editor.getLine(i + 1);\n  }}\nfunction getValue() {\n  editor.getValue();}\n- getValue x 41,994 ops/sec \u00b13.79% (50 runs sampled)\n- getLines x 11,262 ops/sec \u00b13.70% (51 runs sampled)</p>\n<p>Surely getting the lines should be quicker as that's how they're stored?</p>\n<p>I'm not too concerned about the performance of this as that's plenty quick\nenough (unless the values are getting caged along the way) but is there an\neasier way to iterate over the lines?</p>\n<p>\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/1204#issuecomment-12921972.\n. Don't bother, I prefer to handle API changes myself.\n. Line numbers. Start is inclusive, end exclusive.\n. I can't get this bug to occur, either with 2.38 or current master. I'm running IE9.0.8112.16421 and following your steps precisely. Clicking outside of the editor does cause hasSelection to go to false, but clicking the button does <em>not</em> cause the selected text to appear before the new value.\n. Ah, now I can reproduce it. But only with 2.38. Can you try upgrading to 3.02 and see if that also solves it for you?\n. Well, development on 2.x has stopped -- you're going to have to bite the bullet sooner or later. And the upgrade should be quite painless (unless your code is deeply entwined with CM internals)\n. Oh, yeah -- I've been somewhat under the weather this week, and it's definitely showing in the shoddiness of my patches. Thanks for correcting that. Merged.\n. Good point. I've modified your patch to use <code>100</code> instead. It's still a guess, and can go wrong, but I guess at this point we should be mostly safe. Merged.\n. &gt; which will almost always yield empty string.</p>\n</blockquote>\n<p>Source? <code>slice</code> is specified, and all implementations I'm aware of follow this, to simply clip the start and end to the actual size of the string. So negative numbers get treated as 0.\n. Good point. I've added the clipping code.\n. The docs correspond to the state of the current master branch, not the last release, and definitely not the one-but-last release (3.01).\n. Indeed. Seems the line to handle regular binary operators has been completely dropped at some point. Fixed in 128141cb27ed2cc843c018cc44d294907df9e383\n. CodeMirror's selection is a layer placed behind the text. The selected text is not actually a child of any specific selection-related node. Thus, it can not be colored differently from non-selected text.\n. I see. That would have a performance impact though -- currently, when dragging a selection, all that has to be done is to update the layer. When the text has to be styled, there'll also have to be a bunch of changes to the lines' dom structure.</p>\n<p>Though I guess the update usually only concerns one or two lines, and the framework for updating only the lines that need it is already in place. Maybe it's even workable to use some <code>getComputedStyle</code> trick to figure out whether a theme requires such updating, and avoid the extra work when it doesn't.</p>\n<p>I'd be interested in such a pull request, but I'll only merge it if the amount of added complexity is kept small.</p>\n<p>See the <code>regChange</code> function for the interface to the lazy updating interface. And be warned in advance that the <code>insertLineContent</code> function, which you'll have to touch to add the selection styling, is a rather scary mess.\n. Hah, that might indeed be a nicely low-impact way to do this. It shifts the responsibility for actually including the plug-in to the user of the theme, which isn't perfect, but it might be good enough in this case.\n. New addon for this has been merged.\n. Hi Michiel,</p>\n<p>Thanks for the report. I just spent a few minutes jamming the keyboard on that site, but didn't manage to reproduce the problem. For a start, you could try upgrading to 3.02, and hope the problem magically went away. It probably didn't. So then the thing is to somehow get a reliable way to reproduce it. The code that is erroring out is tricky -- it updates the editor's DOM structure to reflect changes, taking care to do as little work as possible. Thus, it depends on the current state of the DOM being what it expects it to be, and the bug could be coming from anywhere.</p>\n<p>(I assume you're not having your own code manipulate the editor's internal nodes, or are loading some 3rd party code that might be doing that.)</p>\n<p>If the issue is usually quick to reproduce, you could try typing your next e-mail first in, for example, http://codemirror.net/mode/markdown in order to see whether the problem occurs in that page as well.</p>\n<p>Best,\nMarijn\n. I've committed a slightly different solution for the null issue (62d7f9b476f732de78ee30c6a651b53f968b2d1d) and reduced your cleanups of match-highlighter to a single patch (1078c8978c501987671dbe0e8a4be2a0c0bd1b85), which I've merged.\n. Thanks. I've merged your code as 724b52ddd62036dd6545b6ae0558e5ff7a80f1bf , and then cleaned it up in 4388df166fa5c7e0535d41292f4bbf97324a8d13 (<code>defineOption</code> is the modern way to define addons -- it's much more convenient than requiring people to register their own event handlers).</p>\n<p>I've also updated match-highlighter.js to use a more modern style.\n. &gt; the docs say getCursor('end') would</p>\n<blockquote>\n<p>return the head (the side of a selection that moves if\nyou press arrow keys) </p>\n</blockquote>\n<p>Um, no, they don't seem to be saying that at all. http://codemirror.net/doc/manual.html#getCursor\n. &gt; So doing getCursor('end') is the same as getCursor('head') and getCursor(), which returns the side of the selection that moves. It hasn't to be the first or last mark (depends on if you select forwards or backwards).</p>\n<p>Wouldn't that be a completely stupid way to design an interface? Listing a list of strings that all do nothing?</p>\n<p>The parenthetical \"(same as not passing anything)\" applies only to the string \"head\".\n. Firstly, I want to strongly discourage the use of the word 'intuitive' in bug reports. Intuitive is in the eye of the beholder. It doesn't really objectively mean anything.</p>\n<p>In this case, CodeMirror appears to be behaving the same as Chrome and Firefox's native text controls. That is the baseline that it aims to conform to. Thus, I do not consider the fact that it doesn't conform to your personal expectations a bug.</p>\n<p>Also, it's quite easy to define new behavior for keys if you want to.\n. I've pushed 88d02fde12b223d6d61f5d456d664b4d66c2077a instead, which doesn't lift up the whole functions and reindent them, but simply changes them to regular variable definitions.\n. Since these were rather invasive changes somewhat likely to have more repercussions in the future, I think I prefer not to merge them, and just tell people to upgrade when they run into them.\n. IE9 appears to freeze the JavaScript execution for as long as the context menu is visible. This means that the trick that kicks in on other browsers, where we hide the textarea again after the menu pops up, doesn't work here. IE also doesn't apply opacity styling to the cursor, so that blocks off another avenue for hiding it.</p>\n<p>If you have any other ideas for working around this, I'd love to hear them.\n. Closing this as not very critical and hard to work around. Still happy to hear about any CSS tricks that minimize or solve the effect.\n. Indeed. I can only reproduce this on Webkit -- Opera and Firefox seem to behave more sanely.</p>\n<p>What happens is that Webkit, for a reason I have yet to figure out, wraps the visible text differently from the text in its hidden 'measurement' node, which it uses to get the position of individual characters (for cursor drawing and click handling).</p>\n<p>This appears to be a rounding bug (in Webkit) -- the text in the measurement div is split into single-character spans, which, for some reason, throws off the computation of whether a word fits on a line -- but only for non-ascii text.\n. That's a somewhat different problem, and much easier to work around. See attached patch (though a full fix would require knowledge of Unicode categories, which JavaScript does not expose)\n. This is probably fixed in recent Webkit/Blink versions. Add another comment if you can still reproduce.\n. Thanks! Merged. One nitpick: a commit message like '    Update the activeline demo to use it' isn't very stand-alone (who knows what 'it' might refer to when viewing the commit in isolation). I've squashed it into the commit before it.\n. Can you provide a demo that I can run on my side? It's hard to debug a page that I don't control.\n. Oh, never mind that, I seem to have managed to rip a working reproduction from your link.\n. The problem is that the Deck css files are overriding a bunch of styles that CodeMirror needs. In this case, the padding on the <code>.CodeMirror-scroll</code> element is overridden by the <code>.deck-container div</code> rule which, for some silly reason, kills the padding on all divs.</p>\n<p>The CodeMirror deck plugin was written for version 2 of CodeMirror, and doesn't seem to work for version 3 (yet).\n. Several problems:\n- You submitted from a v2-based branch against current (v3) master\n- You introduced tabs and whitespace conventions (spaces inside parens) completely at odds with the rest of the file.\n- You're comparing page coordinates with screen coordinates. I.e. you're not compensating for scrolling position. To be fair, my existing code for horizontal alignment has the same problem.\n. See b37017c20f6dc5f6f3b2d1d52aefa31a4ab3e305 for a more thorough implementation.\n. Thanks. Merged as 70809f8de1ca27d22e7703575edc936da85dd96c\n. Makes sense. Merged.\n. Odd. Show me a test case and I'll look into it (the one I constructed to test the code seemed to work).\n. Thanks, merged.\n. Could you tell me a bit more about your use case? From the looks of it, it sounds like in your case highlighting should also always start from the start of the document, no? I.e. it can't be done incrementally but is done on the document as a whole. If that's so, this option doesn't entirely solve the problem, since when the editor is scrolled down, re-highlighting will start in the middle.</p>\n<p>Are you doing a call to <code>getValue</code> from your tokenizer? How exactly does the dependency between the tokenization and whatever analysis you do on the whole text work?\n. Well, if you're saying yourself that you're reusing data from previous passes to continue highlighting in the middle of the document, and that statements are only dependent on previous lines, doesn't that mean you could also follow the regular pattern for modes and simply store the data you need in your mode state?\n. Timing this out. Feel free to add more comments or a new pull request.\n. Thanks! Merged.\n. Thanks. Merged.\n. I'd much rather find out how you managed to get a selection with a negative character offset. The code is written with the assumption that the selection contains valid coordinates. If it doesn't, this isn't the only thing that'll break, and applying a band-aid to fix this infinite loop is papering over a bug, which I think is a bad idea.\n. If you can somehow reproduce the problem, just adding a statement like <code>if (doc.sel.from.ch &lt; 0) debugger;</code> to <code>setSelection</code> would show the culprit in no time. In fact, if this is showing up for you regularly, you might want to add that regardless (or do <code>alert((new Error).stack)</code> instead of <code>debugger</code> so that it works even when you don't have your devtools open).</p>\n<p>My worry is that if we mask this problem by patching <code>measureChar</code>, we won't find the underlying cause and it'll come back to cause different trouble in the future.</p>\n<p>A quick look over the vim mode doesn't show it doing anything obviously dodgy, but it's a lot of code, so I didn't analyze it in detail.\n. Shift-backspace in column 1 doesn't seem to do anything, at least, it doesn't cause an infinite loop for me. Could you elaborate on your reproduction steps?\n. The Vim mode isn't handling shift-backspace, so it ended up in the hidden textarea, and had an effect there that wasn't expected by <code>readInput</code>, which promptly started spitting negative coordinates into other functions, causing the hang. The attached patch fixes this.\n. Thank you! Merged.\n. This will fall apart completely on lines with mixed font sizes or wrapped lines. And, I must say, your lengthy exposition failed to convince me that such a selection connector is a problem. It's what browsers do natively, I see no reason for CodeMirror to do something different.\n. &gt; this problem</p>\n<p>What I'm wondering about is why you consider this a <em>problem</em>. Drawing the selection like this is a widely used convention, and doesn't really get in the way.\n. &gt; the mixed fonts demo is wrong</p>\n<p>Good point. See 72ca55233967e1d92ee54fb792d548b651be54a6\n. I do not have a strong preference for either, visually, but I lean towards the one with the connector, because it maps cleanly to the actual reality of the display model that CodeMirror is using.</p>\n<p>I do not want to merge your patch, because when CodeMirror supports a given feature, but only supports it in a half-hearted, fragile way, that looks shoddy and tends to generate an endless stream of support requests from confused users, which I'm not prepared to deal with.\n. Clever. Though I guess somewhat susceptible to platform/font quirks. Do you think this would be appropriate for the bundled css?\n. @mightyguava Want to review?\n. &gt; No idea right now why the test still fails on IE, basically cm.setCursor(0, 176), followed by cm.moveV(-1,\"line\") leaves the cursor at {line:1, ch:34} (seems to only happen in the testing-setup though).</p>\n<p>Indeed -- I can't reproduce this in my own setup. If you have a somewhat minimal testcase, I'll gladly take a look at it.\n. &gt; skips a few (visual) lines around the gaps left by wrapped lines</p>\n<p>You're right, that is a bug. Opened #1239 , will look into it tomorrow.\n. I've pushed a fix that should fix <code>coordsChar</code>'s reporting of whether the coordinates were actually within the (vertical) range of the line.\n. Adding a parameter to coordsChar that indicates the coordinate system (analogous to the one taken by charCoords) would be a good addition. Just make sure the default stays the same.</p>\n<p>Do you feel the code in <code>moveV</code> should be factored into a more generic method that you could then reuse for this patch, or are you doing something sufficiently specific that you'll need to write your own version anyway?\n. @metatheos See the attached patch. It exports a <code>findPosV</code> that takes a start position and allows you to find out whether the top/bottom of the document was hit (also a <code>findPosH</code>).\n. Look into <code>git rebase</code>. You might have to do some merging, or kill some of your commits that were handled in a different way upstream, but it will allow you to get a clean branch with your own patches at the top, based on my master branch.\n. Wonderful, merged (in squashed form) as 3eae20a249335fd13c7db7feacf7140893c01dd8</p>\n<p>@mightyguava If you see any additional problems with the result, please open issues to track them\n. Good point. As for the 'proper' solution -- I'm not sure that'd be worthwhile. Properly making sure the scroll position of a hidden editor ends up at the place where it would be if it wasn't hidden would require somehow tracking all actions that might influence scroll position, and playing them back when the editor is un-hidden. Seems like that'd be a lot of code for a very obscure use case.</p>\n<p>If you submit your simple patch, I'll gladly merge it.\n. The problem is that if someone calls, for example, <code>scrollTo</code> when in a hidden state, that should, if we want to accurately simulate persistent scroll positions, also be somehow saved, and clear the flag for scrolling to the cursor, etc. I feel this'll take more code than justified.</p>\n<p>Instead of adding a boolean flag to <code>refresh</code>, I think the fact that people can simply call <code>cm.scrollIntoView(cm.getCursor())</code> before refreshing should be sufficient.</p>\n<p>I've merged your patch.\n. Damn, not sure how I missed that. Thanks for fixing it! Merged.\n. Firing <code>change</code> (and <code>cursorActivity</code>) events on documents is easy, and something I actually wanted to do, but forgot.</p>\n<p>As for batching them into operations, that might not make a lot of sense. Operations are an optimization on the view/editor level, and I don't feel that applying them to documents would help much.</p>\n<p>How about moving the batching logic into your own code? You could have your change listeners store changes, and have your own wrapper that, at the end of a batch, fires a different kind of event using the accumulated changes. Does that sound like a solution?\n. Ow, that's ugly. After an enjoyable two hours spent studying IE's bizarre focus-flipping behavior after a (preventDefault-ed) <code>drop</code> event, I found a workaround that seems solid. Attached patch should solve the problem. Please test.\n. Are you sure it's not your cache? I just booted up my virtual machine again, but on IE9 I really can not reproduce the problem anymore (using the exact steps you gave). Before above patch, I could reproduce it reliably.\n. Very odd. If you could try to debug it on your side, that'd be helpful. Basically, the problem that I solved was that IE, after a drag event, cleared the selection inside the hidden textarea. CodeMirror uses the fact that something is selected as a way to detect that no input was typed (in order to not have to constantly fetch the value from the textarea, which is expensive when there's a bunch of text in it). The dash is a placeholder put in when the selection is big, for optimization reasons.</p>\n<p>The test I added solved the problem for me because the drag event would reset the textarea's selection to the start of the textarea. It is almost 100% certain that the problem is occuring in <code>readInput</code> -- since the dash from the textarea ends up replacing the document. The question is, why doesn't my check prevent <code>readInput</code>, on your machine, from going ahead and interpreting the content of the textarea as new input. For a start, I'd be interested what the <code>selectionStart</code> and <code>selectionEnd</code> are right after that test (a code path that should only be executed once when performing your bug reproduction steps).\n. I see. That's useful. Something makes your IE deselect differently than mine. Unfortunately, that's harder to detect, since it puts the textarea in a state similar to what it would be in during regular typing. I'll see if I can find a workaround.\n. Sorry for leaving this sitting for so long. It kind of fell through the cracks of my inbox.</p>\n<p>I've finally installed IE10, and I think the attached patch should help. Please test.\n. Did you try with the current code in the repository? A few weeks ago, code was contributed to solve just this. To a certain point at least -- there's no way to configure which mode to use for unknown script types yet, they will be treated as plain text.\n. That definitely sound reasonable, and a pull request would be very welcome.\n. See #1243\n. I've modified matchbrackets to punt on long lines. I don't think CodeMirror's core should be deciding in cases like this not to apply certain features (for example disabling <code>markText</code> entirely for long lines), since it'd break code that actually does something with the resulting markers.</p>\n<p>See issue #1022 for the cause of performance issues on long lines, and an outline for a (complicated) solution.\n. This isn't quite what I had in mind -- there's probably a lot of different possible scripts that people use in one way or another inside <code>&lt;script&gt;</code> tags, and I don't want to end up with an htmlmixed mode that hard-codes all of them. See the attached patch, which instead adds a way to configure the way script tags are handled, and extends the mode demo to recognize vbscript using this mechanism.\n. The problem with this approach is that changes made by the change handlers won't trigger new change events, which breaks the invariant that all changes are signalled.</p>\n<p>One thing I've been considering is to add another kind of callback/handler for 'filtering' changes -- it'd be called with information about the change, and could return a replacement change if it wants to. Would that address your use case?\n. See attached patch. Let me know whether it works for you.\n. The code on the website is the current git version, which is different from 3.02. Use the matchbrackets.js from the 3.02 release zip for a version that works with that version.\n. You are talking about how <code>signal</code> is being called for <code>\"mousedown\"</code>, but it never is. Doing <code>instance.on(\"mousedown\", ...)</code> will result in the handler never being called. So I'm really not sure what you're doing here.</p>\n<p>You can capture dom events after they bubble out of the editor, but you can't (currently) prevent the editor from handling them (unless you use capture-phase handling, which old IEs don't support).\n. I'd be open to a pull request that adds an <code>onMouseEvent</code> feature similar to <code>onKeyEvent</code>/<code>onDragEvent</code>, which would allow you to intercept mouse (down/click) events before CodeMirror does.\n. The first failures is #1129 , for which I haven't found a satisfactory fix yet. The second one should be solved by the attached patch.\n. <code>-moz-user-select</code> disables selection in <code>input</code>/<code>textarea</code> controls, so yes, it'll break CodeMirror.</p>\n<p>I don't consider this a CodeMirror bug -- any other editing control will probably show the same issue. Just don't do that. Or, if you must, somehow create a DOM structure that allows you to only disable selection for elements that don't contain editors.\n. Great, merged. And see my follow-up patch in which I clean up the code and rename the addon to <code>closebrackets</code> (with an s) to match the option name and (similarly named) <code>matchbrackets</code> addon.</p>\n<p>I also added the feature where it overwrites closing brackets when you type them in front of a matching one, since I find this feature unbearable without that addition.\n. Sorry, forgot to link follow-up patch. It is 085ab5180bdbcb154f903928996e04283aecc338\n. This appears to be a different manifestation of #1252 (for which I'm about to push a patch).\n. &gt; p.s. -- it seems a little odd that 'sawCollapsedSpans' is global to the entire CM namespace. Might it be more efficient if it were per-CM-instance?</p>\n<p>It is used by various functions that don't have access to a codemirror instance (but only, for example, a line).\n. Thanks. Merged.\n. The formatting addon is pretty much abandoned. I'll add a note to the demo to say so. It's too complex to get really right for me to want to maintain it, and no one with the skills to do it properly has stepped up to do so. Pull requests welcome, <em>if</em> they are clean and correct.\n. Oh well, there goes my day. Merged and rewritten (see 5a5d7c570008a8b18cc95b5ad3096bba46f4ade0 ). Next time, don't take advice from tutorials written in 2008 (in web technology terms, that's pretty much the middle ages).\n. Also, I changed the interface (now uses an option), and the supported options, and pretty much everything else. You'll probably find bugs that I introduced. If so, please report.\n. &gt; &gt; Next time, don't take advice from tutorials written in 2008</p>\n<blockquote>\n<p>What do you mean please?</p>\n</blockquote>\n<p>The tooltip code you included was a disaster (way too long and clunky, and wrong in several places).</p>\n<blockquote>\n<p>1) I have a problem to integrate your work on my MapReduce WebBrowser project because my old getContents method doesn't exists.</p>\n</blockquote>\n<p>Wrap your linting function with something that adds the wrapper text.</p>\n<blockquote>\n<p>2) lintWith should perhaps accept array function too</p>\n</blockquote>\n<p>Wrap the linting function with a function that runs a bunch of linters and concatenates the results.</p>\n<blockquote>\n<p>3) Conditionnal lint</p>\n</blockquote>\n<p>Maybe... wrap your linting function?</p>\n<p>Closures are powerful. Use them.</p>\n<blockquote>\n<p>Just add cursor: pointer; for the lint-span* lik ethis:</p>\n</blockquote>\n<p>Feel free to add that to your own styles, but I don't think it is appropriate -- the underlined text is still text, and isn't clickable, so a pointer cursor doesn't seem proper.\n. Ah, right, the fact that an editor is passed to linting functions instead of a string does make that rather difficult. See f92ea27a83e048e63bfa8045c1c9711d09fb4ad0 , after which you should be able to pass <code>function(text) {return CodeMirror.javascriptLint(\"var f=\" + text + \";\");}</code> as a linter function.\n. Pull request merged.\n. Sure. Squashed and merged as 85893eca60510784d8122824c8e1152fe5546118\n. This makes sense, but I think your approach isn't quite the right one. If the emacs mode finds the ranges to delete itself (using the newly exported <code>findPosH</code>, in some cases), it should be much easier to make consecutive kills do the right thing, and we wouldn't have to pollute the code for the deletion commands with extra return logic.</p>\n<p>I will probably rewrite the emacs mode from scratch in the near future. Feel free to keep using your solution until that time. When I do, I'll take care to get the kill ring (more) right than the current code.\n. @dandavison I'd be okay with an addon that updates the built-in 'emacsy' keymap (the bindings used on OS X to provide readline/emacs-style bindings by default), but I don't think this complexity should be in the core -- as far as I understand it (I don't have a Mac in front of me to test right now), OS X's native controls don't provide ctrl-y, and applications like Chrome have to actively add it, so it's not a baseline expectation for people.\n. Ah, I didn't know that. I still don't really think it would be a good idea to implement this in the core, but a good set-up would probably be one addon that implements the emacs kill ring and extends the emacsy commands, and then the emacs keymap which uses this and adds a lot more emacs bindings.\n. Great!</p>\n<p>@mightyguava I'd like you to glance over this again (if you don't have time for these reviews, let me know, I'll stop notifying you.)\n. I don't have a clear grasp of what the selection problem you're having is like, exactly. Just an idea -- would a <code>beforeSelectionChange</code> event, similar to the <code>beforeChange</code> event added this week, which allows you to check and adjust selection changes as they are made, be helpful for you? If not, please explain the nature of the problem or point me to a previous explanation.\n. Should I merge the patches here as they stand, by the way, or is there going to be more adjustment?\n. &gt; If it would be safe to modify sel.from and sel.to in a beforeSelectionChange event, without changing sel.anchor and sel.head, then I agree it could make for a great solution.</p>\n<p>There's an invariant that from/to always correspond to anchor/head (from to the lesser one, to to the greater). This invariant is not going away.\n. I've merged the changes as they stand.</p>\n<p>(I somehow missed the horrible things you were doing in your <code>setSelection</code> replacement before. Such an approach is <strong>not</strong> acceptable. All selection changes are supposed to go through CodeMirror's internal <code>setSelection</code>, and poking at the selection from outside is bound to create all kinds of inconsistencies.)\n. Fixed by 1eb6cc12decc227d8b8ea7767b14153986b816bd\n. Great, but why didn't you <em>use</em> clike.js, which is, after all, a customizeable mode.</p>\n<p>I'd really rather not merge copy-pasted modes -- they add bloat, and if there's a bug in the original, they duplicate it.\n. I second that suggestion. Depending on how much ActionScript differs from TypeScript/JavaScript, you might want to simply extend the JS mode (with configuration parameters), since that has all the subtleties like semicolon insertion and parsing regular expressions already present.\n. The null mode should be predefined by the core library. You can refer to it as <code>\"null\"</code> or <code>\"text/plain\"</code>.\n. Thank for looking into this. I did some poking around and indeed, it seems IE wraps lines differently when spans are present, and I couldn't quite figure out how or why. Your analysis about the space being collapsed seems off. The spaces are still there.\n. I've pushed a simplified patch, which also fixes a problem with your solution (try entering multiple spaces in a row with your patch).</p>\n<p>The <code>load</code> handler in your patch seems unrelated, and is not acceptable -- it'll leak the memory of every CodeMirror instance created by registering handlers on the window that close over them.\n. Don't register click handlers (use mousedown). CM has to stop mousedown events to prevent their side effects in many cases, which will prevent click events from being fired.\n. It <code>preventDefault</code>s the event, but doesn't <code>stopPropagation</code> it, so it will still be visible to outside handlers.\n. There are many other projects using the convention that version tags are prefixed with a 'v' (Raphael, ACE, for example). People are relying on these tags, so I'm going to have to continue using them -- and I'm not really up for doing two tags (one with and one without 'v') for every release.</p>\n<p>So in this case, I'd argue that the problem is with Bower, not CodeMirror.\n. What are you trying to achieve, and which software is making the assumption about git tags?\n. For this repository. A <code>vX.Y</code> tag means version <code>X.Y.0</code>. Switching conventions will surprise people, and I'm going to say that this is something external software should just somehow deal with. It's not like it would be <em>hard</em> to deal with.\n. Merged as 7db06ab9f635946f32977406597d6593e3b708e7 . I cleaned up the patch (seems you somehow amended a patch of mine -- there are changes to mode/meta.js in there, and it's author was me), and removed the <code>remoting-lint.js</code> file which was A) depending on jQuery and B) not generally useful.\n. &gt; If this option can't even be included in the list of options in the</p>\n<blockquote>\n<p>-documentation-, than I'm not going to assume that the forum is going to\nbe\nof any greater help.</p>\n</blockquote>\n<p>Yes, we don't have a large, well-paid team of talented documentation\nwriters working on CodeMirror. If scanning through the 200 lines of lint.js\nto figure out whether it supports your use case or how to make it support\nyour use case is too much for you, and you'd rather spend your time sending\nout negative messages like this, then maybe you should not be using\nopen-source, volunteer-maintained software.\n. Any kind of full background highlighting is unsupported because it will hide the selection. Moving the cursor above the text causes problems with wide cursor (as in the vim mode), so it is also problematic.\n. There's a workaround with <code>filter</code> to get transparency on old IEs.\n. 3.1 fixes a bug where the horizontal width isn't recomputed immediately on refresh. For a benchmark loop like the one you show, that makes a huge difference. In practice, you'd still incur the cost for that recomputation as soon you did anything with the editor, but the editor would sit with a (potentially) incorrect horizontal scroll width until it was touched (updated).\n. I've pushed a patch that optimizes line length measurement (which can omit a lot of the work that regular character-layout measurement does), which helps a lot.\n. @bfrohs Want to take a look at this?\n. How about using the list style only for tokens that are not otherwise styled? That seems to solve this problem without introducing a noisy background style.\n. There's a bunch of standard styles you're not using (<code>string-2</code>, <code>atom</code>, <code>builtin</code>) that might be useful for distinguishing these from each other.\n. Aha, you were clicking the scrollbar <strong>of the completion pop-up</strong>. I thought you were talking about the scrollbar of the editor (which did initially have the same problem). That explains why I couldn't reproduce this.\n. Please see 612b3d2cbfc2f654bec5f7e9af670667e8d53d1f and verify whether it solves your problem.\n. I (once again) can't reproduce the problem anymore in IE8. What I do is open the completion demo, put the cursor somewhere where it's not in a word, press ctrl-space, and scroll the resulting (long) list of completions by clicking the scrollbar of the pop-up.</p>\n<p>Make sure your cache is cleared, etc.</p>\n<p>Your patch caused the editor to be deselected when scrolling the widget, used <code>onmouseleave</code> naively (it will also fire when the mouse is moving between elements inside the widget), and generally added more complexity than needed.\n. &gt; It comes often when the list opens (and the mouse is not inside in the</p>\n<blockquote>\n<p>opened list) and I scroll quicly several times the scrollbar on t e rigth\nof the list , the list closes.</p>\n</blockquote>\n<p>I'm still not managing to reproduce this. You'll have to debug it yourself.\n. Fold range finders currently simply look through the lines in the editor to find out what to fold (potentially using <code>getTokenAt</code> to get some information from the mode). You can do this in a similar way.\n. Thanks. The link will also be helpful for other people finding this issue by searching.\n. See #332 . The trick we use to disable such behavior on other browsers somehow causes Safari to segfault. Bad Safari. If you want to spend time on looking for a workaround, that'd be much appreciated.\n. Still happening, as of b9e9d5c3a676f83f2cc8b2793615d31798d52ed3 , since our hack to enable <code>setDragImage</code> wasn't reliable.\n. Copy-paste in CM mostly works by letting the native default behavior take place on the hidden textarea. In some cases, 'copy' and 'cut' events are needed to make sure the whole selection is actually present in the editor. Opera has only recently started supporting those. Maybe they are still broken in some situations.</p>\n<p>For me to look into this, I'd need a (minimal) test page that reproduces it.\n. A better approach would be to use a simple overlay (see <a href=\"http://codemirror.net/doc/manual.html#addOverlay\"><code>addOverlay</code></a> in the manual, and for example the search code which uses this to highlight matches). That way, only users that actually need this pay for the overhead.\n. Thanks for adding a working example!\n. &gt; Is there a way to do this with the current codebase?</p>\n<p>Yes, set the <a href=\"http://codemirror.net/doc/manual.html#option_flattenSpans\"><code>flattenSpans</code></a> option to false, and modify the overlay to return one token per whitespace character. Something like</p>\n<p><code>token: function(stream) {\n  if (stream.eatWhile(/\\S/)) return null;\n  stream.next();\n  return \"whitespace\";\n}</code>\n. That was trivial to support. See attached patch. Simply add a <code>flattenSpans: false</code> property to your mode object.\n. Thanks. Merged as c12a033fb2e9b29683c84ac535dd865b0de1a5c5\n. I agree. I'll happily merge pull requests that add such a rule to theme files.\n. The crash still occurs for me (with your patch) on Safari 6.0.2\n. The jsbin demo works (in that I can drag the green bar without crashing). But if I apply your patch, hard-reload CodeMirror in safari, and then drag, it still segfaults.\n. Yes, it does crash (so that really rules out a caching problem). Odd. If I change the src to a regular image url, it still crashes. I think the problem might be that the image hasn't been initialized yet. If I put an image on the page and use that, <code>setDragImage</code> works.\n. Apparently, the image has to be in the DOM for my Safari not to crash. Could you verify whether the attached patch works for you?\n. Oh, that's too bad. Are you 100% sure that you are testing with the current code when the crash happens?</p>\n<p>If yes, then indeed, I guess we'll disable the <code>dragImage</code> call on safari again.\n. Okay, I'm going to assume this is fine until I hear otherwise.\n. Undone again in b9e9d5c3a676f83f2cc8b2793615d31798d52ed3 -- crashes were still being reported.\n. Thanks. We try to be clever about handling key events, but I guess sometimes the events just don't have the information needed.\n. Looks good. Merged.\n. Do you think a line like this when creating the textarea will be a sufficient fix?</p>\n<p><code>if (ios) d.input.style.borderWidth = \"1px\";</code>\n. Right, but.... eww. Can you think of a reason why a class works but a direct style doesn't? What if you use <code>style.border = \"1px solid black\"</code> instead of <code>borderWidth</code>? Inserting <code>style</code> tags is something I'd really like to avoid, but if all else fails, I can add a kludge class to <code>codemirror.css</code> (still, I'd prefer a one-liner that uses inline style).\n. A pull request (so that you can test the code) would be great. (Try to keep it as low-impact as possible.)\n. Merged.\n. Look great. Clean-ups are definitely <em>very</em> welcome. Merged as 93348fccff4dff0c81f401fd4341836b609dd549\n. @peterkroon Want to take a look?</p>\n<p>If the Less mode can be folded into the CSS mode in a clean way, I'd be okay with that -- less code means less room for bugs.\n. I also noticed that when I paste the example code, bracket matching is initially broken when I put my cursor after the last bracket (apparently the opening bracket is somehow styled as <code>\"string\"</code> when the bracket matcher asks for it), but then when I edit the first line in any way, the problem goes away. Again, this suggests bad handling of state.\n. Indeed, looks fixed.\n. Ah, right, I see the problem now. It's a rounding thing -- when you move up or down by X pixels, starting from the top of the current line, you'll land in the middle of a line, which will then be round down to the top of that line. This biases the motion towards the start of the document.</p>\n<p>I've added a workaround which should work when text height is mostly uniform. If you have varying text sizes, it might still occasionally show the old behavior, but I think that should be rare enough (in the context of this already rather obscure issue) to not be a problem.\n. Thanks for catching that! Should be fixed now.\n. Thank you! Merged.\n. Wonderful. Merged (in squashed form) as 73e32fea5729a9f461ebfccfa0d3f8a122bb8bb7</p>\n<p>@mightyguava Thanks for the detailed review!\n. Thanks! Merged. I had to reindent most of mirc.js, since it was very inconsistent. Maybe next time use an editor that can help with indentation.\n. Thanks. Looks good, merged.</p>\n<p>(It's not necessary to create a new pull request for a change -- you can simply push your additional commit to the branch that the pull request refers to, and it will be automatically updated.)\n. What is the state of this? Should I merge it as it is and hope the bug @mightyguava refers to gets fixed later, or shall I wait until a fix is available?\n. Great. No hurry \u2014 I was just making sure this doesn't get forgotten in the pull request queue.\n. Great. Still merges cleanly. Tests pass. Merged as 6e19763e97a9fecd697d7f113cf463bb6d180b67\n. Thanks. Merged.\n. I don't find this very convincing. If a mode needs to expose its internals, just do so though configuration parameters the way the clike and sql modes do.\n. Good catch! Merged.\n. Indeed. I believe the code was trying to minimize string re-allocation (in the case-sensitive case), but for lines with any kind of significant length, this was a horrible approach. Merged.\n. Great. Merged.\n. Merged.</p>\n<p>I don't really understand the requirements of the change tracking you have to do. But I don't see why the <code>\"change\"</code> event would be in any way problematic for tracking deletions and motion -- it contains all information about the change, so you can use it to construct a (relative) trail of changes that can be reproduced.\n. Ah, I see the problem now. Yes, you'll probably need to listen for keys to accurately re-play cursor motion.</p>\n<p>As for <code>indexFromPos</code>, it's cost is linear to the amount of lines above that position, with no big constant factor (walking the doc tree, summing string lengths) so calling it a few times in response to a user action is unlikely to be a problem.\n. Thank you. Merged.\n. Thanks. Merged.\n. The <code>option</code> property isn't documented/public, use <code>getOption</code> instead. Also, I think this should be in the keymap section, rather than at the <code>extraKeys</code> option, and the example can probably be simpler (just always insert a tab) in order to be clear.\n. Looks great now. Merged.\n. Odd that these weren't in there. Thanks for the patch. Merged.\n. Soft hyphens are indeed not handled properly yet. Other non-visible characters (the low ascii ranges and such) are handled by showing a red dot. Some unicode combining characters (and surrogate pair continuations) are recognized and such and the cursor is never placed before them.</p>\n<p>I think for soft hyphens, the first treatment (explicitly show that there is a character there) is preferable. Do you agree? Are there other similar characters that you had trouble with?\n. @mightyguava Could you take a look?\n. &gt; after adding some safeguards for invalid values all over the place.</p>\n<p>CodeMirror itself will simply crash when given options of invalid types. It will guard against reasonable things, like passing out-of-range positions to public methods, but I don't think adding kilobytes of code (and run-time overhead) to check for bogus inputs is a good trade-off.\n. @dextius Will you be updating you patch to address @mightyguava 's concerns?</p>\n<p>If not, @mightyguava , is it easy to salvage parts of this, or shall I just close the pull request?\n. Wonderful. I've pushed your patch as f0d055b1d4972d5a8347a3b654cb7842e742eb76\n. Thanks, looks great. One question though -- would it be possible to make the CSS mode extensible and build this on top of that? We're considering doing a similar thing with the LESS mode (and have already consolidated the various SQL modes into a single configurable one). This has the advantage that there's less code to maintain and bugs only have to be fixed once.</p>\n<p>Basically, it'd follow the pattern in clike.js and sql.js where the base mode takes a whole slew of configuration parameters and hooks, and the derived modes use those to highlight specific dialects.\n. Thanks for the quick update and the clean code! (Including tests, even.)</p>\n<p>I've squashed your patches into 1171acb083d681a6d657c67058341c3e9b483ae7 and added eb13244c5afdc86cd3803c6f83619bda5f53d287 , which fixes a problem with the scss tests not being tagged as such (the mode's base name was \"css\", so that's what the test prefix ended up as), stops defining non-mime strings as mime types, and adds a hack to ensure that the string \"css\" still refers to a working CSS mode.\n. Hi Kevin,</p>\n<p>CodeMirror does not do any entity encoding whatsoever. So whatever it is that you're seeing here, it does not have anything to do with CodeMirror.</p>\n<p>Best,\nMarijn\n. Great! Merged. I should probably add an option to make the regular search implementation also incremental. Incremental search is wonderful.\n. Thank you. Merged.\n. Yes. This is a known limitation. Basically, don't style things with a background color. Use some other way to highlight the brackets. I should probably create a FAQ that mentions this, sometime.\n. Merged as ec8438df11c0207dd3fed27817fc934803f88d1f . Though I've left out the test html page, and moved the trailing whitespace deletion that your editor decided to do into a separate patch.\n. Sure. I wrote it this way because <code>this</code> acts almost precisely like a variable (except that you can't assign to it), but it is indeed officially a keyword. If you want to submit a pull request, I'll take a look.\n. Done in #1325\n. Thank you. Merged.\n. I see several problems with this\n- It puts the burden of creating the completion html nodes entirely on the client code. Why not just attach a classname to each completion? (I.e. allow elements in the completions array to be either strings or objects with a <code>text</code> property and some other data attached to them, such as <code>className</code>). You might want to also support a hook that allows the item to draw itself completely, but I think the common case is to just add an icon, so let us make that easy.\n- The 'pick' logic is per completion list, not per item. Doesn't it make a lot more sense to make it per-item? That would also get rid of the logic where a pick handler is allowed to return false to decline the action. If a completion has a pick handler, it really has something to do.\n- Try to keep pointless changes (like renaming <code>background</code> to <code>background-color</code> in <code>show-hint.css</code>) out of pull requests.\n- Also, make sure the tests pass.\n. See the attached patch. It allows completions to be objects with a <code>text</code> property and optional <code>pick</code>, <code>render</code>, and <code>className</code> properties. I'm about to push an update to http://ternjs.net that uses this to display the types of the completions.\n. I'm intentionally leaving the sorting to the completion sources -- they might want to sort in a custom way.\n. Looks good. Merged.\n. Thanks. Merged.\n. Merged as d57f4cdcad4c2056d5a41bdc41de6caf0f24b9e8 , with a fix in 6ad9552d0aa1cfccd12a458af7b3ff40ec7af676\n. This was fixed earlier this week by 6bb8b11860d294782d7c08849dd71b5b9615539a\n. Awesome! Can you include a demo html file?\n. Ah, sorry, github doesn't notify me when a patch is added, only for new comments, so I hadn't seen that you had added the demo. Looks great! Merged, and slight fixed in 92b6fa34b6ea6912eb4295dbee111412769c8569 (you had an accidental global assignment)\n. Can you try again with the current code in git? I just fixed something like that a few hours ago, coincidentally.\n. Indeed. It was a different bug in the same code. Please try again with patch 04d8fc6e48b9214a08d806e0fe8acbe7b119045c\n. Right, because the start of the wrapped line is the <em>same</em> as the end of the top line. So you can put your cursor after the \":\", it's just that that will cause your cursor to be drawn before the \"[\" that follows it, which happens to be on the next line.</p>\n<p>There are some editors that track the last cursor movement that happened, and use that to decide where to draw the cursor in a case like this. Regular textareas in Chrome don't, and show the same behavior as CodeMirror in this situation. If someone can come up with a clean, solid patch that implements this more advanced behavior, I'd welcome that, but I certainly don't consider the current behavior a bug.\n. It seems the Sass mode is missing any kind of 'skip whitespace between tokens' routine.</p>\n<p>@rubymaverick Want to take a look at this?\n. Thanks for noticing that. Merged, and fixed in 31a6201dc906d9e6a7c6a7ba1fcbb138782255cd (you can't count on lines have a <code>stateAfter</code> property -- that's a cache that's managed at the editor's discretion, will often be absent).\n. Pull requests welcome. I wrote the current closebracket add-on as a response to a pull request that defined an even simpler one. I don't currently have time to build it out.\n. Done in 262bf5264501cac42ac3d2fc957c1b80ef13894c\n. See my comment on #1334\n. I believe #1355 fixed this.\n. The word <em>\"should\"</em> is an unwise word to use in the context of feature requests. CodeMirror works the way it works, this is not a bug, and there is little base to claim that it <em>should</em> behave differently.</p>\n<p>But it's a useful feature to have when explicitly scrolling something into view, so I've added an optional parameter to <code>scrollIntoView</code> in the attached patch. Doing this on regular cursor movement and <code>setSelection</code> does not seem like a good idea.\n. Woah... someone named their JS dialect LiveScript? Seeing how JS itself was originally called LiveScript, that seems like a recipe for confusion.</p>\n<p>Oh well. The mode itself looks good. Merged, and cleaned up and integrated in ed2e51993575f0629df3240804416232c4805dbe (you were dumping a whole lot of variables into the global scope).\n. Right, my bad. But now it is <em>always</em> false, at least in my tests, so now the add-on is broken again. Are you using the latest markdown.js?</p>\n<p>@bfrohs Is there a reliable way, by looking at the markdown mode state at a given point, to determine that it is in a list? <code>.list</code> seems to be false for bulleted lists, though the comments in the mode code suggest it should be true. Actually, bulleted lists are currently highlighted as code, not lists.\n. Err, I was trying with the lists in the demo page, which are indented 4 spaces, and thus highlighted as code. My bad, merged!</p>\n<p>@bfrohs False alarm (though maybe a document that <em>uses</em> markdown in various ways, rather than one that demonstrates the syntax as code blocks, would be a better candidate for the demo page?)\n. This is not going to happen, since is extremely problematic: highlighting information produced for line when it was line 10 may be reused when someone presses enter a few times above it, making it line 12. Also, the more we tie modes to their context, the harder they will be to reuse (in multiplexing modes or things like runMode).</p>\n<p>In your use case, one solution would be to put a marker on the current match which cancels the styling done by the overlay (using css precedence or <code>!important</code>).\n. If you look at the code closely, you'll see that your <code>CodeMirror.Pass</code> ends up being returned to the function you assign to <code>commands.autocomplete</code>, which then drops it on the floor. If you add another <code>return</code>, or, even better, leave the <code>showHint</code> implementation alone, and use the code below, it works</p>\n<p><code>CodeMirror.commands.autocomplete = function(cm) {\n  if (!CodeMirror.showHint(cm, CodeMirror.javascriptHint)) return CodeMirror.Pass;\n}</code></p>\n<p>This is an issue with the new approach -- throwing a value is easier to thread through intermediate layer than returning one. But I feel the effect that the <code>catch</code> around key handlers was having on debuggability was horrible enough to justify this.\n. Thanks! Merged, but then I couldn't resist my code-golfing urge and simplified the code in 341af4cf2b8d9488e85ee4d2e92ff59db6be24d4\n. Well, I've just merged this as-is for now. I'd still be happy with a cleaner solution.\n. I guess you're using <code>parseInt</code> as an alternative to <code>Math.floor</code>, but I am not sure how rounding here would have any effect. Could you submit a demo page that has enough going on in the gutter to show the problem?\n. Which platform are you on? On Chrome 26 Linux the gutter is completely stationary when I do this.\n. So, the power cord for my MacBook broke (again) and I was only able to briefly try this out before the battery ran out, but on FF 18 and Chrome 22, I don't see any unstability during horizontal scrolling on OS X either.</p>\n<p>Will look more closely once my new power cable arrives.\n. In a 50k line file I was able to get a slight effect like this, but only in Safari, not in Firefox.</p>\n<p>So it appears this is rare case, and hardly problematic for the actual user experience (it only moved by a pixel and returned to its proper position immediately). I'm not going to merge the patch, since this is a tricky part of the code and I don't want to cause regressions on more important aspects.\n. There's already the possibility of setting the <code>readOnly</code> option to <code>\"nocursor\"</code> which should do what you want.\n. Well, the behavior of desktop browsers for a <code>readonly</code> input is also to not show a cursor. So setting readonly on the textarea happens to solve your specific issue, but doesn't seem to make much sense beyond that.</p>\n<p>I recommend you simply detect mobile browsers yourself and set <code>readOnly</code> to <code>\"nocursor\"</code> on those platforms.\n. Fair enough. I've merged this as is. There may be other similar corner cases that lead to weird scrolling resets, but I haven't run into them yet.\n. Thanks for the minimal reproduction case. Problem was that CodeMirror relied on the asynchronous 'scroll' event to update its understanding of its current scroll position. In sync code like the one you had, it would believe that it was still at the right position when <code>scrollIntoView</code> was called, and not update.\n. Your example should call <code>cm.refresh()</code> after updating the editor size (or use the <code>setSize</code> method. Beyond that, and the fact that you didn't escape the backslashes in the code string, causing it to probably not come out the way you wanted it to come out, I can't find any problems in this demo.</p>\n<p>Feel free to update with a more solid demo. Closing for now, will reopen if needed.\n. This works correctly for me both in 6.0.2 and 6.0.3. (Selecting on the last line, the selection does match the position of the selection rectangle.)\n. I can reproduce this, both on OS X and on Linux. It is caused by the hidden measuring element line-wrapping differently from the visible content. However, I have not been able to come up with an explanation of why it wraps like this in this situation. It's not the effect that the <code>spanAffectsWrapping</code> hack is addressing, but something completely different, probably related to the fact that there are no 'normal' wrapping characters in pieces of your code string, and emergency wrapping works differently from normal wrapping.\n. Could you verify whether it is fixed in the v4 branch?\n. Great. This kind of bugs (there have been a <em>lot</em> of them in the past) are one of the reason character measurement was completely rewritten in v4. This won't be fixed in v3 anymore, but I hope a 4.0 release isn't far off.\n. There is no cursor at all when code is selected, unless you turn on <code>showCursorWhenSelecting</code>. In the 2.35, this was also the case (though there the option didn't exist yet, so I'm not sure how you managed to get the cursor to show up during selection there).\n. Thanks, merged as db6242871c860c62f7c987edd032be2797378caf .</p>\n<p>Is the \"Do not insert closing bracket if a spacechar or closing bracket follows cursor\" behavior based on any convention? It seems arbitrary, but I've never really used auto-bracket-closing, so I don't know what's common behavior.\n. Great, I guess people are used to it then.\n. Duplicate of #1022\n. The character measuring, which is what #1022 was about, is now done piecewise. The drawing is still all-or-nothing.\n. 'Sane', eh? Are you suggesting Emacs is insane?</p>\n<p>Kidding. Please try with patch 047e0f513122e62a42e7341f61b9ae08c030f532 , which makes something very close to this the default the default for ctrl-left/right/del/backspace bindings (except that it respects bi-directional text, handles continuing characters, and all the other magic that is happening in <code>findPosH</code>).\n. Really, ST stops (when moving forward) once at the end of the line and then again at the beginning of the next one? Isn't that a total pain when you're skipping over empty lines?\n. If we have this situation:</p>\n<p><code>foo\n  |bar</code></p>\n<p>The second line is indented, the cursor is after the indentation. If I press ctrl-left there, should the cursor go to the start of the second line, or the end of the first one?\n. So it does take two presses to go past a line break. Why did you say \"It looks like I'm not clear enough in my description\" then?\n. Indeed, fully empty lines should be fine, since there the start and end are the same. Still, do you feel this behavioral difference is a problem? Nowhere am I claiming to be compatible with Sublime Text's precise cursor motion rules.\n. I'm leaning towards the opinion that this is such a corner case that it won't bother even people used to ST all that much, and I'm finding the ST behavior sufficiently silly (if I want to move over a newline, I'll press left, not ctrl-left) that I'd rather not copy it. So yeah, you'll have to fix this in your own code.\n. I've pushed the attached patch instead, which uses <code>removed</code> as the property name, and makes sure that for a sub-view, the value of <code>removed</code> is correct even if the change overlaps with the border of the sub-view.</p>\n<p>I've kept your test in a separate commit (5dad49618755398fc5c5af115961497a17df5d54)\n. I've merged in the theme (c5554d5f42776b629b4a786dba43170baf16874a) and the support for <code>onUpdateLinting</code> (8be65a4e5fa69070d77d215f06aa5f06b19ddc86).</p>\n<p>As for the rest... you have to understand that adding lots of code to CodeMirror has a cost for me. People will find problems in it, and I'll have to fix them, or at least communicate about them. The XQuery hinting code is huge, messy, and doesn't seem to work very well (I wasn't able to get completions at several points in the demo, for example where it says <code>return $provider_user_data</code>, removing part of the variable name and completing it doesn't work.</p>\n<p>I appreciate your intention to contribute to CodeMirror, but I simply don't have the time and energy to review your contributions in detail or rewrite them. So for big things like this, please distribute the code yourself (open a github repo and slap a README on it). I'll gladly add a link to it, but I don't want to maintain it.\n. &gt; I don't know if you have seen my last commit</p>\n<p>I did see it, and the same comment goes for that -- adding a hook to the addon to make this possible is great, but another demo plus a bunch of code is more than I want to deal with.\n. Seems to work much better now!</p>\n<p>I'm thinking about ways to make 3rd party add-ons easy to find. I'll write\nsomething about this to the list soon.</p>\n<p>On Sat, Mar 16, 2013 at 5:36 PM, Angelo notifications@github.com wrote:</p>\n<blockquote>\n<p>Hi Marijn,</p>\n<p>For your information I have created\nCodeMirror-XQueryhttps://github.com/angelozerr/CodeMirror-XQuery (I\nhave fixed the problem that you have found for completion too).\nYou can play with the demo at\nhttp://codemirror-java.opensagres.cloudbees.net/xquery.html</p>\n<p>You will see the status lint in action too. Click on the status lint\nerror,\nand it select the erro rin the editor.</p>\n<p>Regards Angelo</p>\n<p>2013/3/15 Marijn Haverbeke notifications@github.com</p>\n<blockquote>\n<p>I don't know if you have seen my last commit</p>\n<p>I did see it, and the same comment goes for that -- adding a hook to the\naddon to make this possible is great, but another demo plus a bunch of\ncode\nis more than I want to deal with.</p>\n</blockquote>\n<p>\u2014</p>\n<blockquote>\n<p>Reply to this email directly or view it on GitHub&lt;\nhttps://github.com/marijnh/CodeMirror/pull/1359#issuecomment-14960486&gt;\n.</p>\n</blockquote>\n<p>\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1359#issuecomment-15007726\n.\n. Yeah, the tag range finder was a dense mess. I've rewritten it, which I somehow seem to end up doing with all contributed code lately, and it now seems to behave better. I might have introduced new bugs. Please whether it still handles your use cases.\n. Yeah, the tag range finder was a dense mess. I've rewritten it, which I somehow seem to end up doing with all contributed code lately, and it now seems to behave better. I might have introduced new bugs. Please whether it still handles your use cases.\n. This is another symptom of #1362\n. Webkit apparently decides that even in <code>pre-wrap</code> whitespace mode, a block of spaces that is at a wrapping point takes up no space. I'll see about workaround hacks.\n. I've pushed a moderately scary hack which seems to solve this. Please test.\n. Thanks. Merged.\n. JavaScript doesn't do last-match searching of regexps, so this is going to be a hack no matter what. But I did find an obvious bug in the current code, and fixing that seems to have fixed the case you were describing.\n. Looks great. Merged.\n. I've attached a somewhat less hacky solution. Please test.\n. Making it an option would be good. Hard-coding it as two seems too random.\n. Markdown itself has no concept of metadata, I believe. Which dialect are you trying to parse?</p>\n</blockquote>\n<p>Probably you'll have to set some flag in the state, or switch to a different tokenizer function (the <code>f</code> property of the markdown state).\n. See attached patch. You can now do <code>CodeMirror.on(range, \"beforeCursorEnter\", function() { ... })</code> to run a handler when the cursor enters the range.\n. Thanks. Merged.\n. Looks good. Merged!\n. @bfrohs You can probably say more about this than I can...\n. You probably don't want to use the raw \"sql\" mode, but rather a specific dialect (one of the MIME types defined at the bottom of the file). Still this is a bug, I'll push a patch to fix it.\n. The <code>loadmode</code> addon intentionally doesn't directly set the mode because of the difference between a string identifying a mode script and an actual mode specification. The demo is just a simple shim to show this addon, it doesn't provide a sane user interface.\n. Not an option in the editor! Just in the mode itself. See attached patch.\n. The code assumed that <code>innerHTML</code> was fast -- but the results on that jsperf page suggest that a clever loop calling <code>removeChild</code> is actually faster. Do you agree that we might as well remove the non-IE special case (and optimize the loop)?\n. Well, this seems very insignificant. But hey, you took the time to make a pull request, so I took the time to merge it in. 962cabe4a3a30da1536c8a4a06cdd9ac22e5acfb\n. Thank you. Merged.\n. Looks good. Merged.\n. This is another variant of #1362 , but the workaround used there doesn't work here. Attached patch seems to help.\n. Thanks. Merged.\n. On Chrome Linux, every update to the input is preceded by first a compositionstart and then a compositionend event, which causes the start to be reset incorrectly. On Firefox Linux, no composition events appear to be fired at all. Which browser did you test on?\n. Having something like this would be great. But I don't currently have the time to investigate the various quirks these events have on all the different platforms, and your patch, as it is, is bound to break things.\n. I guess it's some kind of in-joke for the Opera team to introduce ridiculous things like that in every new version they release.</p>\n<p>This problem isn't present in Opera 12.11, but indeed, after upgrading to 12.14, it seems to be firing key events with code 34 when shift-' is pressed, which is the key code everybody (including this version of Opera) also uses for the page down key. Result is that CodeMirror's page down handler fires, which, when shift is held, will select a screenful of code.</p>\n<p>I've pushed a hack to handle this.\n. Hold on, I messed up the patch. A better one will be incoming in a few moments.\n. I can reproduce on Chrome Linux as well. The scroller element appears to briefly get a horizontal scrollbar, which takes up space (invisibly below the bottom of the editor) and pushes the content upwards, then vanishes again. I haven't been able yet to actually capture where this happens.\n. It wasn't the scroller, but the wrapper that was scrolling, because the browser thought the cursor (in the hidden textarea) was too close to its bottom. Attached patch fixes it for me.\n. Thanks, merged! Though there is no need to get the token twice (068845377c68a7057083b3a8f5e1771a55ad4463).\n. Thanks! Merged.</p>\n<p>I renamed it to <code>gas</code>, to not take up too many single-letter names (a quick search shows that yes, there exists an S programming language). I've also removed the tabs from the file (I know, indentation isn't consistent across the project, but I'm trying to improve that), and removed some unused variables.</p>\n<p>It also seems JSLint (or Hint) actually led you astray -- your last patch breaks the code, sending it into an infinite loop, because <code>stream.next()</code> return <code>undefined</code> at the end of the line, so comparing it <code>!== null</code> will never match.\n. Thank you. Merged.\n. &gt; The cause appears to be that the underlying text area is one line under the cursor</p>\n<p>It's not, it is right at the top of the cursor.</p>\n<p>Putting it at the top of the editor will cause problems when the top of the editor is scrolled out of view. The browser will scroll back up to it at every change, even when the actual cursor was already visible.\n. Yes, CM definitely needs to support being partially scrolled out of view. Take the simple case of being simply one block element in a bigger page. It should still behave sanely if users try to interact with it when scrolled partway past it.\n. If the cursor is below the on-screen keyboard, isn't that a bad thing that should be somehow handled by auto-scrolling? I'm not enthusiastic about adding an option for this, since it seems the problem is very specific to your use case, and the solution doesn't really make things better.\n. Ah, I see. That is unfortunate. I've pushed patch 72d639dcfedf19de97a26b0778977d28f980b81a , which adds an option for this.\n. Thanks! Merged.\n. Should be fixed in 8197a87bb2c09c8b2e742306101d8f346aa921dd\n. A mousedown like that might be the start of a drag action, so CodeMirror doesn't stop it. This will cause the textarea to be momentarily unfocused, hence the blur event. It will be immediately followed by a focus event as the mouse is released.</p>\n<p>If this is a problem for you, just add some code that delays your handling of blur events for a brief period, and cancels it if a focus event is fired in this period.\n. How often people drag text is irrelevant. In order to make it work, I have to let the mousedown go through, which will unfocus the hidden textarea, which will fire a blur event. Since there is a simple workaround for your problem, I don't want to add extra complexity to CodeMirror to change this.\n. See http://codemirror.net/doc/manual.html#refresh\n. Added to https://github.com/marijnh/CodeMirror/wiki/Mode-wish-list , but see the comment at the top of that page -- it's unlikely that someone is going to write a mode unless they personally need it.\n. What does this accomplish?\n. Your patch has several problems\n- It looks for the option in the <code>config</code> rather than <code>parserConfig</code> object. That will only hold editor-wide options, whereas this is clearly a mode-specific one.\n- It completely breaks the mode when the option is not specified.\n- It removes support for the current model, which I personally find a lot saner.\n. Hi Joseph,</p>\n<p>This looks like it's likely to be related to collapsed/folded spans. Are you doing any kind of folding between the <code>setValue</code> and the point where the error occurs? If no collapsed spans are found (by the <code>collapsedSpanAtEnd</code> call), it seems unlikely that <code>range.to - 1</code> is ever outside of the document \u2014 I double-checked the code that generates the ranges, and it is careful to clip them to the document end. But when the <code>while</code> loop runs, things get more involved, and, though the code still <em>looks</em> correct, I can't really rule out that something might go wrong.</p>\n<p>Also, just to make sure, are you using a subview with a non-zero first line when this happens?</p>\n<p>Best,\nMarijn\n. &gt; What do you mean by a non-zero first line?</p>\n<p>See http://codemirror.net/doc/manual.html#linkedDoc_from , but I guess that's not what you're doing.</p>\n<p>I also spent some time trying to reproduce this, but no luck.\n. Aha, I found it. I was looking in entirely the wrong place before. It so happened that calling <code>scrollIntoView</code> could cause display updates in the middle of an operation, which the code was not prepared for. I've changed it to properly integrate with operations, and delay its effect until the end of the operation.\n. Thanks for spotting that! Merged. That would indeed cause bogus line offsets to be computed in <code>updateDisplayInner</code>.</p>\n<p>Possibly this is also the cause of #1398\n. Blame the jQuery plug-in, I guess. The editor's support for line wrapping is definitely still working. See http://codemirror.net/demo/folding.html , which has line wrapping enabled.\n. The style of the completion pop-up is customizeable with CSS. Override the <code>max-width</code> on <code>.CodeMirror-hint</code> to get a wider widget.\n. Merged in slightly modified form (set <code>tooltips</code> to <code>false</code> instead of <code>disableTooltips</code> to <code>true</code>) as 9ed1a68835adf2667a00b1963bc8c4a277a053d3\n. Your patch still breaks the usual, aligned indentation for function calls. See attached patch for a cleaner approach.\n. Merged. And I've set up the linter to complain about tabs and trailing whitespace, in an attempt to keep the code free of them in the future.\n. Hi Greg, Alex,</p>\n<p>I don't have time to dig through a big 3rd party codebase in order to isolate a bug. If you can come up with a minimal, stand-alone reproduction scenario, I'll gladly take a look.</p>\n<p>Best,\nMarijn\n. Thanks. Merged.\n. The current test is there because setting a mark on a long line is very slow. Scanning through it isn't necessarily slow, but the way <code>matchbrackets</code> does it was causing problems. See attached patches. They largely fix the slowness and make it configurable which line length is skipped.\n. The patch solves a problem where sometimes -- presumably due to rounding errors -- the scrollbar element would be bigger than the scroller in an auto-resizing setup (with the editor height set to <code>auto</code>), causing a bogus scrollbar to appear.</p>\n<blockquote>\n<p>Setting overflow: hidden on scrollerInner fixes the problem, and seems like it ought to be harmless,</p>\n</blockquote>\n<p>This causes a bunch of tests to fail. If you could come up with a way to reproduce this, I'd be interested in looking at it more closely.\n. &gt;  it seems like we should only have it on .CodeMirror-lines. Does that sound right?</p>\n<p>Yes, that's correct (the scrollbars will get height 100%, so they'll stick out if you give them padding)\n. Thanks. Merged!\n. Thanks for fixing these! Merged as 01c0c777a3a5f617d89b0759ad45c35d1ec9f6f8</p>\n<p>Since I'm editing the HTML docs by hand, I am not really interested in having a bunch of verbose cruft like the markup you propose in it. You could parse the type descriptions quite well without adding all these spans -- they already follow a logic. This logic isn't always consistently followed at the moment, but I'd be open to pull requests that fix inconsistencies.\n. I could live with that. Though saying that something is an 'object' is not going to be all that helpful. Maybe prefer a <code>{foo: number, bar: ...}</code> notation for simple objects, and use names for bigger ones (<code>Doc</code>, <code>TextMarker</code>)?\n. The constructor will set a <code>CodeMirror</code> property on the wrapping DOM node it creates which refers to the editor instance.\n. No. In general, serious incompatible changes are only introduced in new major versions, but I'm not going to bind myself to a rigid versioning protocol because the added bureaucracy would take up too much of my time.\n. Thanks for noticing the <code>newlineAndIndent</code> regression.</p>\n<blockquote>\n<p>It used to get pushed to the end of the text, which is generally what we want.</p>\n</blockquote>\n<p>Can you elaborate on that? I think leaving the cursor alone when it is not inside of the changed range is a saner behavior than pushing it to the back. If you're doing something akin to insertion at the cursor, use <code>replaceSelection</code> instead (passing <code>\"end\"</code> as the second argument). If that's not possible, updating the cursor after the fact should be easy.\n. You have a point about the old behavior making a certain degree of sense too. Now consider the situation where range that's replaced isn't empty, for example the cursor is at '|' in</p>\n<p><code>foo|bar</code></p>\n<p>... and we call <code>replaceRange</code> to replace 'bar' with 'abc'. Moving the cursor forward there surprised serveral users, which is why I decided to stop doing it.</p>\n<p>However, when the range is empty, and, for example, we simply insert 'abc' between 'foo' and 'bar', moving the cursor forward suddenly does sound rather obvious.</p>\n<p>Would you be okay with the old behavior when the range is empty (from and to are the same), and the new behavior when it isn't?</p>\n<blockquote>\n<p>(As an aside, it doesn't look like the second argument to replaceSelection() is documented.)</p>\n</blockquote>\n<p>Indeed. Fixed in 28b85eef53741aae9c9acaaee104bd18bf981a9f\n. Okay, 180\u00b0 turn. I've reverted all the recent patches that touched this. Sorry for the bother! I also ran into a case where I needed the old behavior myself. I guess the user who disliked the old behavior will just have to get used to it, since the old behavior is usually the correct one, and making this harder to predict seems like it'll be a usability hazard.</p>\n<p>I am hesitant to add a parameter for this. Feels too obscure and like a typical example of the 'boolean argument' trap.\n. This was fixed yesterday. See 6cf4289de7e5295bd8dc5ee796d0e2bce8f4cbb1\n. That's really simple to do using <code>getScrollInfo</code> and <code>charCoords</code>, isn't it? I don't want to add every possible convenience function to the core API.\n. Thanks. Merged, and simplified in de0d4ebad64dd07695e23421e577e4219980cc40\n. Thanks for the detailed report. Attached patch should help.\n. Yep, that's another similar bug. See attached patch.\n. Patch 516f664 breaks demo/activeline.html by putting the cursor and selection <em>behind</em> everything in the text layer. There's a reason the current stacking is the way it is, and it's rather subtle. A line's background element sits on a lower layer than the selection, and its text sits on a higher layer. That's why giving <code>lineDiv</code> a positioning/z-index is out -- it'll start a new stacking context, making it impossible to create multiple layers from inside it.\n. There's a general feature of being able to style the background of lines, which is widely used and thus not going to be changed. Did you find a good description of the way stacking works in mobile safari? I can also take a look at a possible workaround.\n. The IE7 z-index hack is already problematic (it'll make the text appear on top of the gutter when scrolling horizontally). It's only there to prevent things from breaking entirely.</p>\n<p>If mobile Safari starts a new stacking context for any relatively positioned element it indeed won't be able to correctly display this. But which version of mobile Safari are you using? I've had several people claim that CodeMirror works on iOS, and though I didn't test it myself, I'm not sure about merging invasive patches if the problem they solve isn't clearly defined.\n. Ah, I hadn't understood that turning on touch scrolling changes the way rendering works.</p>\n<p>I'd be open to a patch that adds an option <code>mobileWebkitTouchScrollingHack</code> or so, which makes the necessary tweaks to make things work, breaking fixed gutters and line backgrounds. But <em>don't</em> just start setting z-indices willy-nilly, or do things that might break stuff when the option is not enabled.\n. Ah, I thought that was enabled page-wide.</p>\n<p>Yes, sounds good.\n. This should be superseded by the recently landed mobile work.\n. Hi Andy,</p>\n<p>I've merged this, and then followed up with a few more changes, which\n- Remove void return types. This is just noise.\n- Reinstates the arrow as a way of indicating return types. Not sure why you changed everything to colons.\n- Collapsed some huge types into <code>object</code>. I really don't think we should be making users pick through line-wrapped messes.\n- Makes the defined tern bold in all the <code>dt</code> elements</p>\n<p>In general, when there is a conflict between machine-readibilty and human-readability, the human concern should always win. This is a manual for humans, first of all.</p>\n<p>Best,\nMarijn\n. I'm okay with the idea of writing out complex objects on the lines below.\n. Looks great! Merged.\n. Cute. Merged.\n. Thanks. Merged.\n. @mightyguava Want to review? (Only patch  b621613 is relevant/new)\n. Please see the <code>onSelect</code> and <code>onClose</code> callbacks that show-hint supports since 7b8f79618da67ceae5e1f32f43da86ccce8eb398 . I believe these can be used, maybe with some slight extension, to create a similar functionality.</p>\n<p>As for the html hinting additions, I do not want to merge those. They look fancy, but add no useful information (you already know whether you are completing a tag or an attribute), and make it much harder to reuse the completion function in a different context.\n. Hey Angelo,</p>\n<p>You ideas are, on the whole, very good, but your code tends to be messy, and the English in your commit messages and emails is bad and hard to read (which is not necessarily your fault). I am super busy and I simply don't have the time to comb through all this to pick out the useful parts.</p>\n<p>Best,\nMarijn\n. Attached are some patches that might help. For adding the <code>onSelect</code>/<code>onClose</code> fields to completion sets without polluting the base hint source, you can simply wrap it like this:</p>\n<p><code>function myHinter(editor) {\n  var result = CodeMirror.htmlHint(editor);\n  result.onSelect = .....;\n  result.onClose = ....;\n  return result;\n}</code>\n. Wonderful! Your feedback is definitely useful for refining the interfaces that addons expose.\n. A few criticisms:\n- <code>&lt;br/&gt;</code> is not valid HTML. HTML doesn't have self-closing tags.\n- I think the current presentation of the object type defintions is too implicit. It isn't clear that an object is being defined. I'd at least like to see braces and maybe a an <code>=</code> character after the name of the type.\n- Don't repeat identical types between definitions, expecially if the second one's description simply refers to the first one (as with some of the doc events).\n. &gt; Maybe try using double quotes instead?</p>\n<p>JavaScript treats both quotes the same.</p>\n<p>As for the example -- it works exactly as expected for me (inserts two lines), so whatever is going on here, it's not CodeMirror-related.\n. Wonderful. Merged as cf52a93edfc15519d1cb4f488b473fec49a1f5ee\n. The current tokenize function can be used to precisely know that we're in the middle of a block comment. See attached patch.\n. See attached patch for a solution that addresses the underlying problem.\n. I don't want to put utilities that can easily be implemented on top of existing interfaces in the core unless they are extremely widely used. Also, your implementation looks like it won't work when line heights vary. You might want to use <code>coordsChar</code> instead.\n. Thanks! Merged as 3bc89192dd221818f0c9e819876023d324b4758e\n. This is another symptom that's fixed by fcf6f33052dcaf98def7318a8a6d20365ed88912\n. There is already a module for bracket auto-closing at http://codemirror.net/demo/closebrackets.html</p>\n<p>I'm trying to keep the scope of the main repository within bounds, and that's why I'm not accepting large, opinionated interface components. See https://groups.google.com/forum/?fromgroups=#!searchin/CodeMirror/scope$20repository/codemirror/1SoeLkbghRU/YGl9lWMqb2kJ for context.\n. I am not entirely sure what I was thinking as I wrote that code, but I think the attached patch makes it more or less sane. It won't reuse the default map as the base for the extended map anymore, but does allow mapping keys to the names of keys in the default map. Does this work for you?\n. It has already been merged.\n. I suspect attached patch will help. Please verify.\n. Is there any specific reason you're obsessing over details of the lexical context in the js mode like this? If there's actual bad behavior coming out of it, I'll be happy to look into it, but if not, then it really doesn't bother me. This mode is, in the end, a kludge that tries to simulate a real parser without all the complexity of one.\n. Fair enough. Many of these did point to underlying issues, and it is good to have them fixed, but you know, my time is limited.\n. Is still still broken with the current code? Does it influence indentation or local-variable recognition in a problematic way?\n. Well, I must really have been asleep when I wrote that code. Found another two stupid bugs. Should be better now. A set of tests for the JS mode would be great to have, but I am not currently motivated to work on that (would need to extend the test runner to check indentation).\n. Wonderful. Merged.\n. Might be another symptom of #1240 . Also doesn't occur in IE9.</p>\n<p>I'll try to install 10 sometime soon, and debug this.\n. Thanks! Merged.\n. Thank you. Merged.\n. Great. Merged as 046f2a336303137973c45a6bbe88fe85cb7cfd07\n. Test <code>http://codemirror.net/test/#vim_HML</code> is failing for me on Opera and Firefox. @lynschinzer Want to take a look?\n. Thanks for the patch. Merged. There is unfortunately currently no automated multi-browser run of the tests. I run them on a bunch of browsers manually before each release. For code that doesn't touch too many low-level DOM stuff, testing on one browser usually suffices, but it's easy to occasionally make wrong assumptions as in your test.\n. If you mean block-reindent, you can do that something like this:</p>\n<p><code>javascript\nfunction blockIndent(editor, from, to) {\n  editor.operation(function() {\n    for (var i = from; i &lt; to; ++i)\n      editor.indentLine(i, \"smart\");\n  });\n}</code>\n. The <code>indentLine</code> method will call the mode's <code>indent</code> function. As for your other questions, try the manual: http://codemirror.net/doc/manual.html#modeapi\n. Attached patch solves the second case, which is actually a sane piece of code that occurs in practice.</p>\n<p>It breaks <code>++/regexp/</code>, on the other hand, and doesn't fix the first case. But those are both very pointless pieces of code that are unlikely to appear in real programs. The JS mode isn't a full parser, and I don't think making it more complex in order to address such cases is a worthwhile trade-off.\n. Merged as b7db11ae8e6c4c62cd6589780f . Thanks!\n. Thanks. Merged.\n. Using events here is a good idea. But could you use shorter string (<code>show</code>, <code>close</code>), remove <code>onClose</code> callback support (since it's redundant with the close event), and add an event <code>select</code> to replace the <code>onSelect</code> callback?\n. I've implemented my suggestions in the attached patch. Also made sure to fire the events on the data object, not the editor instance (to make it harder to accidentally leak handlers).\n. I've opened https://bugzilla.mozilla.org/show_bug.cgi?id=861807 for this.\n. A fix for the Firefox bug has been posted in https://bugzilla.mozilla.org/show_bug.cgi?id=876098 . Will take a while before it's reviewed, landed, and pushed out in an actual update, but things are moving in the right direction.\n. Great!\n. CodeMirror tries to work with actual DOM creation, not <code>innerHTML</code>, but an option would be to allow <code>lineNumberFormatter</code> to return a DOM node. Problem is that this breaks the current heuristic for when to recompute the width of the gutter (see the <code>maybeUpdateLineNumberWidth</code> function). If you can come up with a way to support this without adding a bunch of expensive DOM operations to verify width on every update, I'll merge it. Until then, in the interest of keeping the bug tracker's content relevant, I'm closing this feature request.\n. No X-path mode exists, as a brief glance at the list of modes will tell you. I don't know of a language with is close.\n. Don't use the bug tracker for support requests. It's for <em>bugs</em>.</p>\n<p>There are mixed modes, as ryun pointed out. I'm not sure what setting multiple modes would mean.\n. @rubymaverick Want to take a look at this? It indeed seems that the list should either be more exhaustive, or we should tokenize everything that follows a colon as a pseudo-class (as the CSS mode does)\n. The double-colon thing was still broken, but should be better now.\n. Which version of IE, which version of CodeMirror, do the demos work, and can you be more specific than 'does not work'?\n. &gt; When I hit enter after a closing bracket or an opening bracket, the cursor moves down but the brackets don't move.</p>\n<p>That sounds like exactly the expected behavior. If you press enter after a character, of course the character doesn't move.\n. Definitely a good idea. Merged.\n. This isn't supported by CodeMirror at the moment. See #778\n. Thanks! Merged. Cleaned up in commit 1ecf154e62ff931f77894e966995bd19b3db0105 (you had some accidental global assignments, messy indentation, and an untypical mime type).\n. I very much agree on not specifying a set of tags that these modes recognize. That's just wrong-headed.</p>\n<p>As for recognizing standard style properties and special values, I think that is perfectly okay. Having non-standard properties stand out is useful for catching typos, and if you need to use one that isn't standard, it doesn't get in the way to see it highlighted differently.\n. Some modes already take such lists from their config object. See for example the (generic) sql and clike modes. As long as you keep the default behavior close to what it is now, I'd happily merge a pull request that makes the set of properties and keywords for CSS and similar modes configurable.\n. Reopening as a reminder to myself (or @peterkroon, or @rubymaverick) to remove the list of tags from the LESS and SASS modes.\n. There wasn't, but it was trivial to add. See 94007aacbe84046a1fb898aff065c03ee1ce3fc5\n. @steverandy If you want further help on this, try to be somewhat more helpful. What exactly did you try? Did you set the option? How did you test it?\n. If I understand the movie correctly, you are at the bottom of the document. There's no space to scroll beyond that. You could try setting a bigger vertical padding (<code>.CodeMirror-lines { padding-bottom: 1em; }</code> or so).\n. Still works for me. Please see http://jsbin.com/idiwek/1/edit . If that page doesn't work for you, please be more explicit about what you expect to happen versus what happens.\n. Maybe try reading the manual for the function you're using: http://codemirror.net/doc/manual.html#replaceSelection\n. Focus something else.</p>\n<p>This is a bug tracker, though, not a support forum. Please use the mailing list for stuff like this.\n. Sounds like the problem is in your code, not CodeMirror. Might want to look into <code>addon/hint/show-hint.js</code>, which already implements a selection widget.\n. Wonderful. Thanks. Merged as eb7c658ff5e631016ed9fd33ac109b1c84273279\n. You can't call <code>fromTextArea</code> on a thing that's not a textarea.\n. You shouldn't reuse options objects. If you want to set global defaults, assign to the properties of <code>CodeMirror.defaults</code>. CodeMirror assumes it owns its option object. Wrapping one of them in an <code>Object.create</code> or similar would fix your code.\n. &gt; May I suggest that this particular behaviour be addressed in the documentation?</p>\n<p>Done. See attached patch.\n. I found an already open Webkit bug on this at https://bugs.webkit.org/show_bug.cgi?id=90206 , with a comment from someone who is apparently looking into it.</p>\n<p>I did not find a workaround (beyond always attaching a trailing bogus character to the input, which is a bit more invasive than I'd like).\n. How do you define 'user input'? Just typed text, or also calls to the API that are triggered by a key handler? There's already an <code>origin</code> field in change objects, which might be useful, though it's not always accurate. <code>replaceSelection</code> and <code>replaceRange</code> take an optional last argument to set the origin of the change, which might be useful if you're only interested in API calls that originate in your own code.\n. Yes, that's a quarter of a megabyte of text, all on one line. Such long lines aren't currently supported. See issue #1022\n. That is odd, though. The difference between 10 and 20 millisecond really shouldn't be human-observable. And changing the 60 to 10 will only increase the chance that events are missed on slow browsers, since the second 10-ms poll will fall pretty much on the same point as the original 20-ms first poll.\n. Heh, okay. (Also note that the 60ms, which you <em>might</em> notice, is only a fallback that will be used when the machine is too slow to perform the update in the first 20ms window, and not something that should be happening on a typical key press.)\n. Indeed. The manual was wrong. The type information was added recently, and apparently not always very accurately. Fixed in attached patch.\n. This is intentional. People tend to align their closing brackets with the line that opened the bracket. I'd be okay with a pull request that makes this configurable (on the mode level).\n. Firstly, I'd appreciate if you stopped opening issues. You can comment on a closed issue, and the proper avenue for support requests in the mailing list.</p>\n<blockquote>\n<p>But I still want indentation to work as follows</p>\n</blockquote>\n<p>CodeMirror is configurable. You can write code to make it do that. The default behavior is going to stay the way it is.\n. It's all in the manual. You can bind keys to functions with <a href=\"http://codemirror.net/doc/manual.html#option_extraKeys\"><code>extraKeys</code></a>, use the programming API to check whether you are between brackets, and if so, do your thing, otherwise, return <code>CodeMirror.Pass</code> to let the next hander for the enter key have its turn.\n. Fixed by a9654a5f9add00d5ba74dd5a04b0e9d989daf8b3\n. Thanks. Looks good. Merged.\n. Good call. Merged, and did the same for <code>CodeMirror.Doc.prototype</code> in 9069b222ce48e8d5155ef10700f41e2c40cc5668\n. This is well known, and does not have an obvious solution (except simply not using the addon). I accepted the code as a contribution, which might not have been a good idea, since it is written in a very naive way. I am not supporting it, though.</p>\n<p>Updating markers is not something I want to add (since it's messy), but one avenue you might try is to make the plugin smarter -- having it create its markers in 10-line blocks, for example, so that you only have to update small ranges when the edges of the selection change.\n. Fixed in #1523\n. The line number showing up there doesn't bother me, but it would probably be quite simple to make this an option. Want to submit a pull request?\n. This has been implemented (http://codemirror.net/doc/manual.html#option_coverGutterNextToScrollbar)\n. Fixed by 0d8a43a05e331c1cb1881e8f11b970141fde23dd\n. Thanks! Merged as de983c613392d5f886e0142fc0a6c8ab9a81832e\n. Unfortunately, the one piece of Apple hardware I own is a 2006-era macbook, which does not yet have multitouch support, so I can't test/reproduce this.</p>\n<p>It's quite odd that the glitch happens <em>after</em> the selection is finished. If this was some mouse event confusion, I'd expect it to glitch right away. Though maybe CodeMirror is failing to detect that the select drag ended. You could look at the <code>onMouseDown</code> handler and verify that the internal <code>done</code> function is properly called when the mouse gesture ends.</p>\n<p>Just to be sure -- the selection you get does look the same are normal CodeMirror selections, no? It might also be a DOM selection, if the gesture somehow prevents the usual mouse events from firing.\n. Is there a clean way to detect this case? If so, yes, a workaround that cancels the bogus re-selection sounds reasonable.</p>\n<p>Maybe there's also some shuffle with <code>preventDefault</code>-ing the right events that helps here, problem is finding out about it.\n. You may be right -- I guess browsers <em>always</em> fire a move before the mouseup if a drag happened. Does simply removing the <code>doSelect</code> call already help with this problem? We could also add a variable that ensures that <code>done</code>'s body only executes once.\n. Done in the attached patch. If the <code>done</code> handler doesn't fire immediately, though, wouldn't you have a problem with the editor not being focused at the end of the drag, and further mouse activity still messing with the selection?\n. &gt; Can you elaborate a set of steps that you think could cause problems?</p>\n<p>Unfortunately, all I know is that there's probably a reason for the call to <code>focusInput</code> in the <code>done</code> function. But some git arheology traces that back to patch 66499c7a , which suggests it is only important in IE.\n. The regexp for numbers was too broad. Should be fixed now.\n. This won't work when the editor is inside a relative or absolutely positioned element. Messing with the style of the top-level element from an option also seems too dangerous. So again, I'd rather not have an addon for something than an addon that will cause problems and generate support requests.\n. Eww. But yeah, copy-paste should work. Merged, and then cleaned up a little in patch 64113ec97bb73c2a740d42d56021acb01ce05a92 . I assume the SPAN element served no purpose. If it did, please point it out to me.\n. It is not supposed to copy any non-textual formatting.\n. What you are describing definitely does not have anything to do with the original intent of this pull request. Could you open a new issue, and mention which version of IE you are using, as well as what exactly, step by step, you are doing?\n. Makes sense. Though your commit calls it <code>CodeMirror-line</code>, which seems confusing. I've used the class name in your pull request message, <code>CodeMirror-code</code>, instead. See attached patch.\n. Thanks. Merged. Indeed, if we're going to pass three fields from <code>cm</code> to <code>updateScrollbars</code>, we might as well pass the whole editor.</p>\n<p>I also prefer the look of the editor without this, so I made it an option that defaults to off. See attached patch. Set <code>coverGutterNextToScrollbar</code> to true to turn it back on.\n. &gt; But \"yellow\" and \"white\" should be suppressed from var valueKeywords = keySet([.</p>\n<p>What do you mean by that?\n. Care to submit that as a pull request?. (Fixed via #5107). Thanks! Merged as a3402da8e342d6925f5a431b7ccf3ff4bfd2966c . That <code>toggleOverwrite</code> wasn't document was an oversight. Corrected in 1aae9a9453cdbe5e549ec8c11495098ccdf20810.\n. That's pretty invasive and crummy on the part of Bootstrap, but in this case it's easy to work around. See attached patch.\n. Could you give me a minimal html page that helps reproduce the problem? Or alternatively, can you see whether adding a third argument, <code>true</code> to the call to <code>option</code> that defines the new option helps? And, failing that, whether removing the line that that patch adds to <code>guttersChanged</code> makes a difference?\n. Thanks for the reproduction code. See attached patch for a fix.\n. Thanks for catching that. Merged.\n. Thanks! Merged.\n. Yes, you should call <code>.refresh()</code> on your CodeMirror instance after unhiding it. http://codemirror.net/doc/manual.html#refresh\n. Great, thanks for pointing that out. Merged.\n. (And do leave a comment when you add a test patch, since github doesn't notify me when a patch is added.)\n. Thanks, very nice! Merged as 32050bbb0a9aa4d7e4ff995c4ecd06abf5c926b6\n. Looks good. Merged.\n. Thank you. Merged.\n. The script tried to pass extra arguments to uglifyjs, but it appears that uglifyjs is very picky about the order of its arguments. Should be fixed now, and I also added a default set of arguments.\n. Thanks again. Merged as b50aef3\n. Fixed in attached patch. JavaScript has no sane way to detect word characters, and I don't want to add a half-a-megabyte regexp to match all possible Unicode word chars, so I'm adding these per language as they come up in bug reports.\n. See #1382 for an abandoned start of a solution for this. The problem is that browser don't fire coherent events when IME happens, and no one has put in the work to figure out a way to convert the incompatible event soup into something workable.\n. This should be addressed by patch 40b5625 . Please let me know whether it works for you.\n. Looks like some kind of weakness in Webkit's algorithm for determining what needs to be repainted. It appears that adding <code>.CodeMirror-gutters { clear: both; }</code> works around the problem. Could you test whether it also works for you? If so, I'll add it to the default stylesheet.\n. Indeed, that hack only seems to work for fixed-height editors. The underlying problem was that the gutter had height 100%, which apparently caused it to be repainted whenever the editor's insides briefly changed height during a resize (remove old line, add new line). Attached patch should fix this. It's slightly scary, since keeping sizing consistent by explicitly setting heights is always more fragile than letting the CSS engine handle it, but it does solve the problem.\n. Merged.\n. Subtract the <code>top</code> and <code>bottom</code> properties of the object returned by <code>charCoords</code> to get a more accurate line height (the height of <em>that</em> line, as opposed to the height of an unstyled line). Otherwise, this looks good.\n. &gt; Testing DOM related stuff across a bunch of browsers manually is a painful experience</p>\n<p>Believe me, I know! The code looks good now, but the tests also fail on my Linux Chrome. In general, you can't hard code pixel values in the tests, since fonts and such differ between platforms. Either adjust the tests to use a less fragile way to verify the behavior (maybe duplicate some computations in them) or remove them altogether.</p>\n<p>(Here's what I get:)</p>\n<p><code>vim_zz\n  3035 != 3110\nvim_zb\n  2813 != 2882\nvim_zt\n  3255 != 3335\nvim_z.\n  3035 != 3110\nvim_z-\n  2813 != 2882\nvim_zEnter\n  3255 != 3335</code>\n. Almost. I still get this failure:</p>\n<p><code>vim_zt==zEnter\n 3255 != 2812</code>\n. Well, I'm confused about the order in which this and #1527 are supposed to be merged. I get failures when merging only one of them, so they seem to depend on each other. But I get conflicts when I try to merge both. Please condense both down to a single commit, put them on the same branch, make sure the tests pass, and overwrite one of the pull requests with the result, closing the other.\n. Do you really need both modes (<code>dontAlignCalls</code> and <code>dontAlignCalls</code> + <code>nonAlignedCalls</code>)? I find the names sound like both do the same thing, and in fact, I'm not entirely close on what the difference is.\n. So conceptually, what you wanted was to <em>not</em> pass <code>dontAlignCalls</code>, since you do want to align calls. Rather than adding another confusing option, the attached patch fixes <code>statementIndentUnit</code> when <code>dontAlignCalls</code> is false.\n. Thank you. Merged in squashed form as 1bcd6e1 .\n. Thanks for continuing to improve this! Merged.</p>\n<p>One not on git convention -- put a blank line between the patch 'title' and the rest of the description. Otherwise, tools will treat the whole description as title.\n. Thanks! Merged. I rewrote part of it, not because I am sure it was incorrect, but because the extra complexity from handling anchor/head rather than start/end made it hard for me to see whether it was correct. (What worried me was that new spans appeared to be always added at the back of the array, yet the start of the covered range was found by calling <code>find()</code> on the first element.)\n. I guess this is another good reason (besides #1513) to figure out a reliable way to detect composition starting and ending on all browsers that fire enough events to allow that.</p>\n<p>If someone else tackles that part (well-tested, cross-platform, cross-browser, not too fragile detection of these events), I'll happily take care of integrating the CodeMirror functionality (making sure these form a single undo event, showing the underline).\n. (If IME is important, consider setting the <code>inputStyle</code> option <code>\"contenteditable\"</code> in CodeMirror 5.0+. This should help, though it might introduce other issues since the contentEditable backend isn't all that well tested yet.)\n. Patch 40b5625 should help with this. But please test, since IME events seem to vary wildly across platforms.\n. Merged. Stray character removed in attached patch.\n. All clean. Merged.</p>\n<p>Thanks both of you for your continued, meticulous efforts!\n. Looks good. Test pass. Merged as 36fe7d5b4a3ffd\n. Do you have a link to (or copy-paste of) the full list of svg properties that we should recognize?\n. Added.\n. I think, though I'm not entirely sure, that you misunderstand the mechanism. If <code>Shift-</code> is explicitly part of the binding, automatic shift-selection handling is turned off, intentionally. It is only active when a regular binding that binds a <code>go*</code> command is invoked with the shift key added to the regular combination. I guess you want to bind <code>\"Up\"</code> to <code>\"goMoveUpAcrossRegions\"</code>, and do your motion in that command. That'll make it work normally without shift, and selection-growingly with shift.</p>\n<p>Does that make sense?\n. &gt; Binding a \"go\" command to a key enables Shift selection when Shift is pressed. Binding a \"go\" command to a key containing Shift does not enable Shift selection when Shift is pressed. Doesn't that seem inconsistent?</p>\n<p>No, that's the point. If you write a command specifically for shift, you can use <code>setExtending</code> explicitly to get selection-extending behavior. The hack with <code>\"go\"</code> (which I'll agree is crummy) is there solely to be able to use a single binding for both the shift-less and the with-shift version of a motion command. It's an abbreviation mechanism, pretty much.\n. It's not 'all crummy'. It's a hack that works well within the constraints of the rest of the system.\n. Which browser?\n. It does. Could you try with the attached patch?\n. Great!\n. I can't reproduce this -- maybe I just misunderstand the issue. If I copy-paste this into the scss demo and auto-reindent it with shift-tab, the <code>top</code> and <code>bottom</code> lines still get two spaces, which seems correct.\n. Things should be better with the attached patch.</p>\n<p>@dqminh I wasn't able to figure out what that line I removed was supposed to do (since I'm not very familiar with scss), but it caused problems in very common situations so I guess for now the code is better without it.\n. Ah, never mind, I broke some tests, and now understand what the (rather obvious) point of that line was. Looking into it further.\n. &gt; Actually it wasnt obvious to me what the incorrect behavior is. </p>\n<p>That's because I fixed it by now. It used to add two indentation levels.\n. Merged!\n. And merged! 51292d0b8d2c632eeeccbd6ff83a88316a83c038\n. I see the point, but merging this would set a precedent for all kinds of other common shortcuts and clever commands to be included in core, which would end up bloating it. So I'm going to say no. It's easy enough to drop these into a site when you need them.</p>\n<p>Maybe an extra-bindings addon would make a good dumping ground for such things, but since it'd have a fuzzy scope, I'm not too keen on maintaining it. If you want to set up a repository and link it from https://github.com/marijnh/CodeMirror/wiki/CodeMirror-addons , that'd work best.\n. I guess the reason you can't easily do this on top of the public interface is the bidi part? Wouldn't it make more sense to expose some of that, so that a wider variety of bidi-aware functionality can be written external to the core editor?</p>\n<p>Problem is, of course, that the bidi code is rather subtle and not very well encapsulated.\n. &gt; posEq() -- easy to replicate</p>\n<p>Indeed.</p>\n<blockquote>\n<p>Pos() function -- easy to replicate since I can still call new CodeMirror.Pos()</p>\n</blockquote>\n<p>The two are the same function.</p>\n<blockquote>\n<p>lineStart() -- has dependencies on other functions in the bidi code, so this is harder to replicate\ngetOrder() -- also tied into the bidi code</p>\n</blockquote>\n<p>I'm a bit torn on starting to export these. It'd lock me into keeping them around, and blow up the api quite a bit (there's a whole string of functions on this level). What do you need <code>getOrder</code> for? Any chance you could epxress it using the <code>moveH</code> function instead?</p>\n<blockquote>\n<p>CodeMirror.commands.killLine(cm)</p>\n</blockquote>\n<p>It's a command, not a method. Those are not documented, but part of the interface, and can be considered stable.\n. This is by design. See https://groups.google.com/d/msg/codemirror/TQqQW5lSdZQ/-u1RF80lzLYJ\n. This is a good idea. But how about moving the <code>signal</code>  call to <code>makeChangeFromHistory</code> and feeding it a regular change object similar to the one that <code>beforeChange</code> gets?\n. Yes, though -- sorry to waste your time -- I decided that actually that's not what I want either. I've pushed a different change (see attached patch) where <code>beforeChange</code> is also fired on undo events, but without the <code>update</code> method. Since  that was the only part that was problematic to support.</p>\n<p>Does that work for you?\n. Oh joy, another file that I have to bump version numbers in. Is the <code>version</code> field obligatory, or can we get the tool to just look at <code>package.json</code>?\n. Great. Merged. Version field removed in attached patch.\n. Okay, reverted.\n. Looks good. I've pushed a slightly adjusted patch that leaves the addon file in place, so that users don't have to update their paths on the next release. See 3818137291d94bfb168e037309727040d693b756\n. Looks great! Merged as 65c74d5905fe362350a8cf7e70f9e032e2043986\n. This is by design. But if you bind Home/End to <code>\"goLineLeft\"</code>/<code>\"goLineRight\"</code> (instead of the default <code>\"goLineStart\"</code>/<code>\"goLineEnd\"</code>), you get the behavior you want.\n. Indeed, you would have to duplicate that code, but I don't really see an alternative solution, other than adding additional API methods for this very specific problem (which seems undesirable) or duplicating said code in the CodeMirror core. What approach were you thinking of?\n. That's a good point. Attached patch adds a <code>goLineLeftSmart</code> command. Let me know whether it works for you.\n. This is problematic because if the (hidden) scrollbar on the actual scrolling DIV is there, but our fake one isn't, there'll be a margin at the bottom or right of the editor created by the size of the hidden scrollbar, and not filled by the fake one.</p>\n<p>Do you have a way to reliably reproduce the problem?\n. Actually, your original patch <em>was</em> safe, since when overflow is auto, the appearance of the scrollbar itself will, on platforms where scrollbars take up space, make sure the size difference between <code>offsetWidth</code> and <code>scrollWidth</code> will jump over one pixel when the scrollbar appears. On platforms where the scrollbar does not take up space, the problem I was worried about won't occur, so that's also fine. Merged. Thanks for you patience and for the exta info.\n. Indeed, I broke the resize listener two days ago. Should be fixed in 83fdc1e77cc078029504de549b2eef8e1bb83f12\n. Your 'all-spaces' overlay is creating a single token per character, so the behavior you're seeing is what is expected -- tokens aren't joined when you disable <code>flattenSpans</code>.\n. &gt; The issue is that the 'first-two-spaces' overlay is being applied to twice per line and it should only be applied once per line. If you look at the spans, you will see the cm-first-two-spaces style being applied to the first two spans of each line and this is not the expected behavior. Only the first span of each line should have the cm-first-two-spaces style applied.</p>\n<p>The list of tokens will be made single-dimensional, since CodeMirror treats a line as a sequence, not a tree, of styled tokens. When one overlay or mode is creating small tokens, this will cause tokens produced by other overlays or modes to also be split on the start and end of those small tokens. You <em>can</em> override the per-editor <code>flattenSpans</code> option per mode, by setting the <code>flattenSpans</code> property of the mode object. Maybe that helps in your case?\n. Did you see my remark about setting <code>flattenSpans</code> per-mode? I'd imagine that should be a good workaround.\n. Thanks. Merged as 8e6b9f5e15d16f388fa15f88a930013a87f\n. Great. Merged.\n. See attached patch. Please test also on your side!\n. Great! When you go live, don't forget to send me a link for the real-world uses page.\n. Does the attached patch help?\n. You can turn the explode behavior off entirely by setting a <code>autoCloseBrackets: {explode: false}</code> option (optionally with a <code>pairs: \"...\"</code> property in the object to specify custom completion pairs).\n. That was a refactoring screwup, should be better now.</p>\n<p>Did you expect backspace, when inside an 'exploded' pair, to remove all whitespace inside the pair?\n. Please try with patches 69e9473b1eea76b3d9155a40c8a1c69e82c61c1d + 36da87e8bc6cca78cf421225923b108d219a2438 .\n. I could only reproduce the case where the text vanished, and I found the bug that caused that (see attached patch). Could you see if it also takes care of the problem where the widgets get duplicated? And if not, could you give me a short HTML page that demonstrates that problem?\n. That's emacs lisp code. You appear to be either very confused about what CodeMirror is, or trying to make a bad joke.\n. No, no, <strong>no</strong>. CodeMirror modes aren't just random files that happen to work with other editors. They are CodeMirror-specific JavaScript programs that parse a given language. Look over a few of them. They don't look XML-ly.\n. Please see my attached patch instead -- I guess a general way to cheaply find the line at a given y offset would be more generally useful, and less 'random exposed internals'-y.\n. No, it returns the first line -- i.e. the line at offset 0. \"local\" coordinates are not scroll-sensitive.</p>\n<p><code>editor.lineAtHeight(editor.getScrollInfo().top, \"local\")</code> will probably work better.\n. You're right, it seems the top padding wasn't being included in the coordinates that <code>charCoords</code> reported. There was also a rather huge bug in <code>coordsChar</code> when using \"local\" coordinates (which not many people used so far, I guess).</p>\n<p>Does this work for you?\n. Indeed, some code was explicitly compensating for the absence of the top padding from the local coordinates. I fixed that in the attached patch. There might be more fallout from this, if we're unlucky. (Still, the 'consistent' model is preferable to what we used to have.)\n. @mightyguava Please take a look at the attached patch and tell me if you can think of any problems it might cause for the vim mode. It changes <code>nofallthrough</code> to not kill keypress events anymore, and adds a new keymap property <code>disableInput</code> that, when the top-level keymap has it, will prevent regular typing from adding characters to the editor. I've added that property to the vim keymap, and it seems, to work, and has the additional pleasant side effect of no longer blocking ctrl-r when within the keymap.\n. Thanks! Sorry for the poorly thought out patch. I guess that should do it then.\n. Indeed. The &amp;nbsp is supposed to be there to ensure the DIV is given a height, but the fact that the cursor was drawn after it was a bug in the measuring code. Please test whether attached patch fixes it for you.\n. Thanks for spotting that. Merged.\n. Should be better with attached patch.\n. Here's a gem from w2ui.css:</p>\n<p><code>.w2ui-layout * {\n-webkit-box-sizing: border-box;\n-moz-box-sizing: border-box;\n-ms-box-sizing: border-box;\n-o-box-sizing: border-box;\nbox-sizing: border-box;\n}</code></p>\n<p>My recommendation is to file a bug report with them for screwing up the sizing of every element on your page, or to simply stop using a library that thinks this is a sane thing to do. To work around this particular thing, you might be able to use a hack like <code>.CodeMirror * { box-sizing: content-box }</code></p>\n<p>Not a CodeMirror bug. Closing.\n. Merged, and tweaked a bit in attached patch.\n. Looks excellent, as usual. Merged.\n. I've pushed a patch that changes the front page to recommend a standards mode doctype for all browsers, not just IE. It's not just the resize demo that assumes standards mode, there are other parts of CodeMirror that mess up in the various quirks modes.\n. I haven't been keeping track of this, and this remark might not be relevant, but I recently added two events, \"keyHandled\" and \"inputRead\" in order to support 'prefixing' (numerical repeat) of single-keypress inserts in the emacs keymap. They might also be useful here.\n. The origin trick will give you slightly different results, since for example the handler for enter will call <code>replaceSelection</code> with a <code>+input</code> origin parameter, thus preventing the <code>inputRead</code> event from firing (handled keys won't add text to the textarea)</p>\n<p>As for a generic macro/repeat addon, that doesn't sound bad. I haven't thought about this problem as much as you have, so I don't really understand what it involves.\n. &gt; let's just merge?</p>\n<p>Sounds good to me. Merged.\n. Thank you. Merged.\n. Thank you. Merged as eafb2cadf67c9e6da560ab948dfdb2cb84baa2e3\n. Thanks for catching that. Merged.\n. Interesting. But it doesn't appear to work very well yet. The most basic test I could think of\u2014setting gutterRight to true in mode/xml/index.html\u2014causes quite messed up effects (in Chrome).\n. It's still not positioned correctly (a bit to the left of the right edge of the editor) and goes completely haywire when a horizontal scrollbar appears. Also changing the option dynamically doesn't work. Please don't continue throwing <code>if</code> statements at the problem and asking me to try again -- you'll need to take a more rigorous approach if you want to implement this properly.\n. I agree with your analysis, but wouldn't changing the 100 in <code>updateDisplayInner</code> to 400, and only calling <code>startWorker</code> there is <code>different</code> is true, also work, and more obviously maintain the invariant that we can't scroll stuff into view without triggering a worker?\n. That sounds good. See 6e56c7fe4235c131069dd4a1938f0d8eb77ea7c2 . Please verify that the speedup is still there.\n. Line number start at 0 throughout the API.\n. Simply bind home and end to the <code>\"goLineLeft\"</code> and <code>\"goLineRight\"</code> commands. I didn't read your whole screed, but many people, me included, prefer the behavior where it actually goes to the end/start of the line, so that is the default. An option like this might be what you want:</p>\n<p><code>extraKeys: {Home: \"goLineLeft\", End: \"goLineRight\"}</code>\n. &gt; but does it still apply when word wrapping is on?</p>\n<p>Yes, it still applies. Coloring happens per line, so wrapping is irrelevant for its cost. But you can tweak the <code>maxHighlighLength</code> setting, or even set it to <code>Infinity</code> if you want the editor to behave differently.\n. The problem is in the mode itself, not the <code>getTokenAt</code> functionality. Doing unicode-aware character categorization in JavaScript is hugely painful, because the language doesn't have support or bindings for it. Thus, CodeMirror modes tend to just ignore unicode issues. The alternative is to include huge, space-eating and performance-reducing regexps in the modes.</p>\n<p>If it's only a specific language and a specific character set you care about, a pull request that fixes the mode to handle those characters would definitely be accepted.\n. Thanks, merged!\n. Thanks, applied.  d7015f5 appeared to already be in the repository.\n. Wonderful work. Merged. See ea47530e601568e3ea7951071d01f4516c9932c1 for a potential solution to the issue of getting the end of a change. It exports the utility CM uses internally for this purpose. Change objects don't currently share a prototype, so making it a method would be somewhat awkward.\n. Thank you. Merged as 71c101515abffba6a06de9dd31c43c493e9444c5\n. Great. Merged.\n. Thanks! Merged. Please in the future try to follow the repository convention of prefixing commit messages with <code>[sql mode]</code> to save me the effort of updating the patch messages.\n. Slowness on long lines is a known issue (#1022). This reads like a Chrome bugreport though, maybe you should report it there.\n. Would something like http://codemirror.net/doc/manual.html#option_onKeyEvent work for you?\n. Please see patch 10a4a7a8ba69ed8dd3652a61d19c734dc5bc72d6 , which tries to provide a better interface for this. You can now do <code>instance.on(\"mousedown\", function(instance, e) { ... })</code> to have your function called when CodeMirror is about to handle a mousedown event. If you <code>preventDefault()</code> the event, CodeMirror won't handle it, and <code>click</code> and <code>mouseup</code> events will be fired as normal (you'll have to handle them over the DOM, for example by attaching to <code>instance.getWrapperElement()</code>).</p>\n<p>To get the position of the click, the <code>coordsChar</code> method (http://codemirror.net/doc/manual.html#coordsChar) will help.\n. How is this different from http://codemirror.net/addon/selection/active-line.js ? (Demo at http://codemirror.net/demo/activeline.html )\n. Okay! I guess one instance of the feature is enough.\n. Looks great. Merged!\n. Partially merged as 27faa43065df1d8c0b14a5f60aaaeb7d0069433b . I removed the change to htmlmixed, I think this is best done using the <code>scriptType</code> mode config option -- I try to only put stuff in there by default that is going to be widely used.\n. This is intentional (lines with <code>case</code> or <code>default</code> on them will be indented once, others inside a <code>switch</code> body are indented twice). I've added a mode option <code>doubleIndentSwitch</code> in the attached patch that can be used to turn this behaviour off (set to <code>false</code>).\n. Good point! See 3cf3cd46f1bf38920bf64ad64d5b4682a4a3792c for a patch that solves all the issues the linter complained about.\n. Good point. See d3665c39cef8f4d0f68adfc210d9a013e8d73586\n. If your lexer can be used as an iterator, rather than always running over the code in a single shot, and its state can be copied, then you can make a CodeMirror mode out of it. See http://codemirror.net/doc/manual.html#modeapi</p>\n<p>If not, you could re-run your whole lex pass every time something changes, and mark your tokens with <code>markText</code>, but you probably don't want to, since it will be very slow for documents that aren't very small.\n. Thanks. Looks good. Merged.\n. Thanks. Merged as part of 2de0b1c\n. Thanks. Merged as part of 2de0b1c\n. Merged. <code>moveLineLeft</code> and <code>moveLineRight</code> are defined intentionally, for people who prefer that behavior of home/end to rebind those keys to.\n. The docs on the website reflect the current dev version. Each release zip contains a doc/manual.html that describes the exact interface for that release.\n. Thanks. Merged as part of 2de0b1c\n. Thanks. Merged as part of 2de0b1c\n. Thanks. Merged as part of 2de0b1c\n. Thanks. Merged as part of 2de0b1c\n. Thanks. Merged as part of 2de0b1c\n. I'm not sure this is appropriate. Clearing history and setting the document as clean are two different things. Why should they be coupled?</p>\n<p>I guess the old code behaved that way, and there's a backwards-compatibility issue, but in principle I prefer the new behavior.\n. Thanks. I've removed the tab, and pushed as 7fc7a1f\n. See 839e47b and the comment I made on 5e9bcf71dfe0d449cb045aa6c51404620e5a49e5\n. Interesting. One concern I have is that browser don't all render characters at rounded pixel coordinates, you might easily get rounding errors this way. Also, the fact that lines can take additional classes (see <code>addLineClass</code>) complicates things a bit more. And there's combining characters, but I guess you could treat stretches of a regular char + N combining chars as a single measurement unit. Also, you'll have to take right-to-left ordering into account at some point.</p>\n<p>... hold on, the patch is much smaller than I expected. Are you saying the individual calls to <code>getBoundingClientRect</code> are the slow part, not the fact that you're actually forcing a layout with the new stuff in the DOM? I was under the impression, and earlier measurements confirmed this, that the cost was almost entirely in the first layout, after which the dimensions for the spans are cached, and accessing their geometry is cheap. Maybe something changed in recent Chrome builds that invalidates this?</p>\n<p>In any case, there's a rough outline of a different solution in issue #1022 , which is to measure precisely, but don't do it for the whole line at once, only for the visible/edited parts, as needed.\n. One piece of discussion I'd like to continue here is...</p>\n<blockquote>\n<blockquote>\n<p>Are you saying the individual calls to getBoundingClientRect are the slow part, not the fact that you're actually forcing a layout with the new stuff in the DOM?</p>\n</blockquote>\n<p>Caching of getBoundingClientRect actually saves a bit, but not much: without it rendering time goes up to 1200ms. (I'm still talking about rendering of 75k chars in a line) So the most time is still spent in layouting.</p>\n</blockquote>\n<p>Either you misunderstood what I meant, or I don't get your response -- but to formulate my question differently -- doesn't <em>the browser</em> cache the layout information for all elements when it does a layout, thus making further reads (the separate calls to <code>getBoundingClientRect</code>) of the layout information very cheap, as long as no changes are made to the DOM? It used to work that way, which is what motivated the way <code>measureLine</code> currently works. I'll do some benchmarks when I have the time, but I'd still like to know what your take is on that assumption.\n. &gt; a lot of elements in measure array reference the same span element</p>\n<p>Ah, I missed that part. How does this happen, though? Or you do you mean 'span element with the same content' rather than 'the same actual span element'?\n. Ah, I see now, the resulting measured line no longer corresponds to the actual line with this patch -- it's just a random grab bag of 1-character span elements. Thus, the initial layout becomes cheaper. I hadn't read the patch closely enough before. I agree that the other patch is more likely to become solid. Closing this in favor of #1631\n. This sounds okay. It's a bit obscure, interface-wise, but I guess it isn't likely to trip people up. Merged.\n. Interesting. But my comment at https://github.com/marijnh/CodeMirror/pull/1537#issuecomment-18192816 applies here as well. I'm trying to keep the core's size within bounds, and adding all the keybindings that everybody finds useful to the core editor implementation will bloat it really fast.</p>\n<p>So very sorry, but this won't be merged.\n. I agree that this might have more future than the other approach. Have you thought about how to address the fact that <code>coordsChar</code> does a binary search through the whole line, and thus jumps all over, fetching multiple ranges on long lines?\n. I haven't read this in detail yet, but yes, in principle I am open to merging something like it -- <code>coordsChar</code> probably won't get much <em>worse</em> (maybe we'll have to increase the size of the cache a bit, since the maximum size of cached measurements is a lot smaller with this approach).</p>\n<p>I'll spend some more time on this next week, after 3.14 is released -- I try not to merge scary patches shortly before releases.\n. It does not look like this is solid enough to merge, or easy to adjust. If someone (Google? @ibdknox?) wants to pay for two weeks of my time to do the serious engineering needed to land a feature like that, that'd work for me. But as it stands, this looks too destabilizing for me to risk landing it.\n. Something like this now exists in the v4 branch. Closing this.\n. This looks like another manifestation of https://code.google.com/p/chromium/issues/detail?id=246127 , which will probably (hopefully) get fixed before Chrome 29 is released.\n. Thanks! Merged.\n. Please see the attached patch. I think this fits better in a generic 'extra key bindings' module than in a specific addon, so I've started one including so far only this functionality, and will direct future similar feature requests to simply add their bindings to this keymap (which extends the default keymap).\n. Bookmark widgets, because they do not span any characters, always have the cursor drawn to the left of them, because there is no way to distinguish cursor positions before and after them (they have the same character index). I think it should be possible to add an option to the <code>setBookmark</code> method to allow control of this, but such a feature does not currently exist.\n. Ah, you are entirely right, <code>insertLeft</code> should cover this, and the behavior you describe is a bug. I'll look into it.\n. Could you try with attached patch?\n. That last thing should be fixed by the attached patch. Was a simple logic bug in character measurement.\n. See https://groups.google.com/forum/?fromgroups#!searchin/codemirror/how$20to$20manage$20formatting/codemirror/hdEWC83r94c/PcaVazYL9PAJ\n. Attached patch should help. I had been meaning to clean up that module anyway.\n. Thanks. Merged (squashed) as 93c931dacbd2530ed6a1f867e6525a3a0ec06da0\n. There is no guarantee anymore that <code>lastLine() == lineCount() - 1</code>, so unless you actually need <em>the number of lines</em> in the document (as opposed to the number associated with the last line), you should be using <code>lastLine()</code>.\n. I can figure out the commits. I'll let @mightyguava take a look before I merge.\n. I've merged this as 93a850a52b98ddf5a633b793df33edb0b3794ab1 -- I'm not sure the commit message is very descriptive, since I must admit that I only understand half of what's going on in the patch.</p>\n<p>As for a hook for mouse events, that's somewhat tricky, since, unlike key events, handling of mouse events typically involves registering new handlers (for mousemove and mouseup) and waiting for them to fire. Have you tried the mechanism of creating and firing a DOM event from JS, which might work on some modern browsers? (See https://developer.mozilla.org/en-US/docs/Web/API/EventTarget.dispatchEvent?redirectlocale=en-US&amp;redirectslug=DOM%2FEventTarget.dispatchEvent )\n. Fixed by 03449c69ffebdac0648a3f4d347cddd365522572\n. Can this be closed, then?\n. Thanks for fixing that so quickly. Merged.\n. Patch 2677aba253ef5c0a1ed6332e961cef5712f334d3 should fix the infinite loop.</p>\n<p>CodeMirror does not currently contain a system for associating functionality with specific modes -- that's to be taken care of by higher layers. (Though at some point, I might start adding addons in that space.)</p>\n<p>Why did you make the other changes to xml-fold.js? They don't seem necessary to realize this functionality.\n. Please see attached patch and let me know whether it works for you.\n. Works for me. But note that keys that are handled in the keydown stage won't actually fire a keypress event, so for things that are in the default keymap (using a non-quoted key name) won't be noticed by this.\n. What version are you using? These events only exist since 3.14\n. Please see attached patch for an alternative implementation (using an option rather than an extra parameter).\n. I have a need for something like this for the emacs bindings as well. Maybe a variation on dialog.js (a new file) that claims a persistent bit of real-estate below the editor.</p>\n<p>At this point, we're definitely leaving the 'this is only a keymap' approach, but I guess that's pretty much inevitable.\n. There is now a <code>display/panel.js</code> addon, which makes it easier to add such a bar.\n. Can we close this, or is it still an issue?\n. &gt; keymap change isn't really something that happens except at cm instance creation</p>\n<p>Well, that's not really true. <code>setOption</code> on the keyMap option is expected to work, and I can imagine IDEs providing a keybindings dropdown somewhere in the interface allowing people to switch bindings on the fly.</p>\n<p>As for storing things in a CM instance -- a lot of addons have moved to a model where they add a property to the <code>.state</code> object of editor instances, so doing that too is nothing to be ashamed of.\n. Nice. Merged as 70a267a \n. Thanks! Meged as a48327868c691c94841f635442330603a9ca4bf4\n. Maybe use the (work-in-progress) Tern addon: http://codemirror.net/demo/tern.html . Other than that, there's no such functionality.\n. Thanks. Merged as 93fc95b41ec2d144feab927fbd4018d82ce298e6\n. It should be possible to do this on top of Tern using the Tern addon in addon/tern/tern.js , but you'll have to write some code on top of that.\n. I'm sure it would be of great help, but I don't really see a reason why I should be doing your work for you.\n. Looks good. Thank you. Merged.\n. Thanks for spotting those. Merged as ecbbfe2478b30eae134a387deba43d8c451f8f6e\n. \"nocursor\" intentionally makes the editor non-focusable, and your patch breaks that.</p>\n<p>I agree that being able to copy code is nice. But what if you just use the normal <code>readOnly</code> mode and style the cursor as invisible?\n. I'm not really willing to make a backwards-incompatible change here. And since read-only mode is a marginal feature, and the workaround we discussed works, I think the current situation is fine.\n. &gt; Maybe I misunderstood you, but could you please clarify the workaround in case of multiple dynamically created CM instances each of which might be dynamically switched into readonly mode? The styling thing will affect all CM editors.</p>\n<p>Well, yes, that would be slightly awkward. You'd have to wrap your readonly-making code in something that also adds a class to the wrapper node. Still not a hard thing, though.</p>\n<p>Please understand that I'm wary of feature creep, and adding code for scenarios that sound extremely specific has bitten me in the past (I'd be maintaining code that probably no one used, for many releases).\n. Attached patch fixes the underlying bug.\n. &gt; Just wondering when a new release will be pushed to npm?</p>\n<p>Soon (early next week). This month's release is a bit delayed by holidays and such.\n. Thanks for taking care of that. Merged.\n. Get the cursor position in your textarea and set the CodeMirror cursor to the corresponding position?</p>\n<p>Anyway, this is external to CodeMirror, so it's not really a bug that should be tracked here.\n. I can't reproduce this. Please put up a (<em>minimal</em>) demo on jsbin.com or so.\n. Which version of Chrome is this? It looks like https://code.google.com/p/chromium/issues/detail?id=246127 , which I reported but they didn't manage to fix in 28. If 27 (which is the current stable version) is also affected, that would be good to know.</p>\n<p>In any case, feel free to pile on the chromium bug report in an attempt to get them to fix this in 28 at least.\n. Okay, 28, which is a beta if I understand correctly. I'm going to hope that someone in the Chromium team wakes up soon enough to prevent this from making it into the stable release. Even if that fails, I'm pessimistic about being able to fix this on the CodeMirror side.\n. The next Chrome 28 update should fix this (at least, that's what they promised in the Chrome issue discussion). I am not sure when it will come out (and whether it will actually work) yet.\n. Great. I'll leave this open for a few more weeks until the majority of Chrome users have upgraded.\n. You can also call <code>.setSize()</code> (without arguments) on the editor. Note that this is only necessary if your code (or some CSS reflow not caused by a window resize) somehow changed the layout or size of the editor.\n. Submit a self-contained demo that makes it easy for me to reproduce this, and I'll look into it (mention browser version etc)\n. <strong>Only</strong> if they are necessary to cause the problem to happen.\n. You don't appear to be calling <code>refresh()</code> after resizing the editor. If I do so manually from the dev console, things work fine again.\n. Does a call to <code>.refresh()</code> solve it? If so, could it be that you resized/showed the editor without notifying it at some point before the issue appears?\n. Your cursor is being reset to the start of document somehow. This has nothing to do with this issue. It's likely something that your code does, but if you can reproduce it in a plain CodeMirror, feel free to open another issue.. You can tweak your line-height css rule to influence this, I think. Beyond that, this is just how CSS box sizing is supposed to work, and CodeMirror can't do much about that.\n. Should be better with the attached patch. Inserting a widget adjust scroll position, but removing one didn't, so you'd get a 'drift' in the scroll position by simply removing and re-adding the same widget.\n. Should be better with attached patch.\n. This duplicates the whole smarty mode. Wouldn't it be better to use a mode-multiplexing style like what you're doing for JS/CSS on top of the existing smarty mode, so that we don't have to duplicate so much code?\n. &gt; But I can't do the same in the second version for now :-/</p>\n<p>Why not? Is the old code so messy?\n. Actually, the code still seems to duplicate a lot of the things that htmlmixed already handles. It could probably be <em>really</em> small if it were built on top of both htmlmixed and the plain smarty mode.\n. Looks good now! Could you update the pull request?\n. Thank you! Merged. Sorry for the delay -- github doesn't notify me when a pull req gets a new commit, so next time add a comment if you want someone to notice.\n. Same as #1649\n. Same as #1649\n. You opened three identical issues. Please don't do that.</p>\n<p>There is no right-to-left mode. Scripts (Arabic, Hebrew) that are written right-to-left are supported by CodeMirror. But there is no special mode to make everything right-to-left.\n. Thank you. Merged.\n. Well, I've looked through the patch, and can't spot any variables that are reserved words. If YUI doesn't report what identifier it means, and you can't give me the line on which this occurs, there's not much I can make of this.\n. Okay. That was accidentally left there. I already removed that in a subsequent commit. YUICompressor is being a bit dumb if it parses that as an identifier, but then, that's not the first time I've seen it mess up. You might want to look into UglifyJS2 for minification instead (https://github.com/mishoo/UglifyJS2)\n. The same tests fail in Chrome 28/29, due to http://code.google.com/p/chromium/issues/detail?id=246127 . Duplicate of #1642\n. I prefer the way things look when only the 'other' tag is highlighted, so I'm going to keep the addon in the distribution the way it is.\n. Did you benchmark, or are you just making things up? I'm asking because my old code did the same thing, or at least it tried to do the same thing, and I can't see a reason why it should be broken.\n. You could encode the title in a class, listen to the <code>\"renderLine\"</code> event, and add titles from there. It's awkward, but it's the only way that currently works.\n. Well, okay, I guess there aren't many other HTML attributes that will need to be applied like this. See  1a028d0\n. Thanks! Merged.\n. Hey, I just wanted to acknowledge this for now. I've seen it, and on the whole, it looks good. I'd prefer if you factored some of the functions that become much larger with your changes into smaller functions, but my original code was also guilty of huge functions, so it's not an important point, use your judgement.</p>\n<p>The way cursors are drawn and maintained is probably cleaner if you just put them all in a single <code>cursors</code> div, clear it before redrawing the selection, and make that blink as a whole. That'd also make the order of the dom elements (which influences drawing order) clearer.</p>\n<p>I'll give some more though on how the existing API should interact with the presence of multiple selections. Backward compatibility is a must, of course, but it'd be nice if it were easy for addon writers to just do the simple thing and still have their code work in a multi-selection situation.</p>\n<p>I will review the code more closely soon.\n. Great progress. Is there a reason selections aren't kept in sorted order all the time? That'd save some of the copying and re-sorting.</p>\n<p>By the way, github doesn't notify me of new commits pushed to a pull request. So when you think this is ready to merge, or want me to review something, add a comment.\n. I'm on holiday right now, but will definitely spend time on this when I get\nback.\nOn Jul 16, 2013 10:27 PM, \"Daniel Huigens\" notifications@github.com wrote:</p>\n<blockquote>\n<p>@slang800 https://github.com/slang800 Glad you like it!</p>\n<p>\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1656#issuecomment-21070954\n.\n. Selection drawing is still quite problematic. I think the border might be too much, both in terms of visual noise compared to previous versions, and in terms of the trickiness of getting it right. It currently looks off on both FF and Chrome in Linux (didn't try any other browsers). I was able to fix this by adding border-box sizing rules and a few pixels here and there, but selections that continue across a single line without actually touching still look completely wrong, and I expect more headaches to come up. Probably not worth it.\n. Could you write a bit more (possibly as a comment in the code) on how selecting and merging of selections is supposed to work? How does <code>doc.unmergedSelections</code> relate to <code>doc.selections</code>? What does <code>doc.unmergedSel</code> do? What exactly are the various ways in which multiple selections can occur? Why does merging the selections only have to look at adjacent ones? I'm a bit too fuzzy on this to properly review the code at the moment.\n. The implications for the public API are actually not as severe as I expected. On the whole, I think your extensions of the API are quite uncontroversial. One thing I'm not clear about yet is whether we want to preserve 'handles' to selections (allowing querying and updating of a specific selection range through the API), and how the primary selection should be determined. It seems that it is currently always the last one that was made. Was that a conscious choice or a random effect of how the code works?</p>\n</blockquote>\n<p>Tangentially, should <code>doc.sel</code> remain a thing, or would it be cleaner to always have code that accesses a selection be explicit about which one it wants to touch?\n. I find the concept of setting <code>.sel</code>, and the general API of <code>eachSelection</code> quite a bit too magical.</p>\n<p>How about this:\n- The last selection made is the primary selection.\n- The old-style selection methods act on this selection. (with <code>setSelection</code> clearing all other selections)\n- We introduce a <code>Selection</code> class that is used to represent selections. <code>addSelection</code> returns an instance.\n- We add methods <code>get</code>, <code>replace</code>, <code>find</code>, <code>move</code>, <code>extend</code>, and <code>clear</code> to this class.\n- <code>eachSelection</code> passes the selection object to its argument function.</p>\n<p>That requires a bit more changes to existing code to properly conform to the multi-selection API, but gives more control, and is easier to reason about.</p>\n<p>What is <code>postponeEndOperation</code>? I'm really worried about breaking the invariant that an operation wraps a dynamic scope.\n. Operations may nest (inner ones become part of the outer one) and\noperations that don't change anything are very cheap, so I think you should\nbe able to simply wrap the whole thing in an operation. Or am I missing\nsomething?\nOn Aug 14, 2013 3:49 PM, \"Daniel Huigens\" notifications@github.com wrote:</p>\n<blockquote>\n<p>How about this:</p>\n<p>Yes, that's fine too. See 46f44b8https://github.com/marijnh/CodeMirror/commit/46f44b8and\n800ff17 https://github.com/marijnh/CodeMirror/commit/800ff17.</p>\n<p>What is postponeEndOperation?</p>\n<p>Without it, when an addon handles a character and selectively returns\nCodeMirror.Pass to eachSelection, some of the changes to the document are\nmade immediately (by the addon) and some later, inside readInput, which\nis strange visually and breaks undo. postponeEndOperation puts all\nchanges in one operation. I agree it's scary, but I don't see a very clean\nsolution except removing this functionality or making all the changes\nimmediately, e.g. by parsing the onKeyPress event (I'm not sure that's\npossible, though). Perhaps it could be made more robust, though, by testing\nsome edge cases (e.g. the handler throws, or readInput returns false for\nsome reason).</p>\n<p>\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1656#issuecomment-22636392\n.\n. I've pushed a version of your code, merged onto the current master branch, to the <code>multi-sel</code> branch of this repository. Let's work from that now. I did remove your changes to a few addons (active-line, matchbrackets, and matchtags) because the merging was messy and I felt those addons are actually saner if they just act on the main selection.</p>\n</blockquote>\n<p>I'll start reviewing the code in detail and pushing patches when I encounter things I want to do differently. Please, if you do more work on this, work from my merged branch.\n. Rebasing this branch should work.</p>\n<p>I'm having some second thoughts about the API I proposed, as well as about some decisions in your code, so maybe it's best if you just let me run with it for a bit, rather than doing conflicting work.\n. Okay, I'm currently at \" <em>aaaaargh! <code>withSelection</code> is _way</em> too subtle, and doesn't work right, but I can't come up with an interface that actually does work conveniently and correctly_ \".</p>\n<p>Will continue thinking about this, but as it stands I'm not sure how to proceed. A big problem is that you'll often want to somehow first compute a changeset from the set of selections, and then apply that atomically. This makes for <em>much</em> more awkward code, for example for <code>indentSelection</code> or <code>killLine</code> and various addons. But iterating over the selections and making changes will change the selections from underneath you, and cause hard-to-reason-about and unlikely-to-be-correct code.</p>\n<p>Also, the way of adjusting the selection(s) for a change needs to be deeply rethought. The <code>selAfter</code> argument is completely broken with regards to multiple selections in its current form.\n. My implementation (tracked under #778) is now available. It's a full rewrite, since I wanted a fundamentally more robust model. Feedback welcome (I think I got all the features that are present in this code, except for the rounded corners on the selection, but I'm not entirely sure).\n. @bfrohs The logic related to the <code>mediaType(</code> and <code>mediaType</code> contexts seems quite confused. Do you have time to look into this soon, or shall I try?\n. Looks good. Merged.\n. This is probably similar to #932 -- Firefox will mistakenly conclude that a textarea is the same as one it saw pre-reload, and reset its content to the value it had before the reload.\n. How about just making these changes to the Python mode and adding a definition like this at the bottom:</p>\n<p><code>CodeMirror.defineMIME(\"text/x-cython\", {\n  name: \"python\",\n  extra_keywords: \"by cdef cimport cpdef ctypedef enum except\"+\n             \"extern gil include nogil property public\"+\n             \"readonly struct union DEF IF ELIF ELSE\".split(\" \"),\n});</code>\n. Yes, it would. Just like you can't load the java mode by specifying 'java'. You'll need some extra data to properly do magical loading of modes. <code>mode/meta.js</code> might help, but isn't perfectly maintained.\n. <code>modeInfo</code> isn't a thing, at least not in the current version of CodeMirror. <code>CodeMirror.modes</code> is probably the object you're looking for.\n. Ah, you are talking about meta.js, I didn't know. Should be trivial to write some client code that loops over it once and builds up the map you need.\n. Looks good. Merged as 4651de8\n. I'm not really willing to go down this route -- adding random hacks here and there to fix ad-hoc problems as they come up. I tried to do the obvious thing, extending <code>maybeType</code> to also ignore question marks, but it turns out that the parameter lists in class methods aren't even recognized as function definitions in the current Typescript mode.</p>\n<p>If you want to add proper statement rules for the various Typescript constructs like <code>class</code> and <code>interface</code>, so that the mode actually has a strategy for parsing them rather than relying on the fact that parsing them as JavaScript doesn't go completely wrong, that'd be welcome.\n. There's nothing written about that, but basically it keeps a stack of parser combinators (<code>state.cc</code>) that drive the recognition of syntactic constructs. <code>cont(.... combinators)</code> means \"I handled this token, proceed with the given combinators (and then the rest of the stack below me)\", <code>pass(...)</code> is similar, except that it indicates that the current token was not handled, and the next combinator should get a look at it.</p>\n<p>Some combinators just maintain the stack of lexical context (<code>state.lexical</code>). One thing to be aware of is to avoid infinite loops -- a combinator that doesn't consume anything must take care that it doesn't produce a situation where it is asked again and again to look at the same token.\n. The bad news is that we'll probably never fully cover this bug without duplicating the whole of Webkit/Blink's wrapping code. The good news is that I found a kludge that covers this case, and that recent versions of both AppleWebkit (not tested yet) and Chrome (29+) no longer have the bug.\n. Thank you. Merged.\n. That's a feature, not a bug. <code>&amp;</code> starts an entity in XML/HTML, so if you want an actual ampersand, you'll have to use <code>&amp;amp;</code>.\n. Thanks for figuring that out. Merged.\n. This appears to be fixed in Chrome 29, which makes me suspect that it is the same issue as <a href=\"https://code.google.com/p/chromium/issues/detail?id=234668\">1</a>. Chrome 28 and 27 are broken though, and it might be a while before 29 is widely used. Unfortunately, I can't think of a way to work around this.\n. It <em>does</em> behave correctly. Or at least, it behaves consistently. A collapsed range makes the text it spans vanish, but the resulting line is still 'rooted' in the line that the range starts on. Adding ad-hoc rules to address specific use cases is something that never ends well.\n. <code>{line: -1}</code> will get clipped to <code>{line: 0, ch: 0}</code> (whereas <code>{line: 0}</code> becomes <code>{line: 0, ch: &lt;length of line 0&gt;}</code>, so that's where that difference comes from -- negative line numbers don't have a meaning in CodeMirror.\n. Not currently, except for creating a subview (http://codemirror.net/doc/manual.html#linkedDoc)\n. That last problem is solved by the attached patch.\n. I believe this is fixed in cdf55221a8a2fb8059f159feadc3797ba967e515 (hide the whole line, enable inclusiveLeft and inclusiveRight)\n. @Dominator008 Please note, with the patches prompted by #1996 , you now have to set <code>clearWhenEmpty: false</code> when you need to hide an empty line like this.\n. Thanks! Merged.\n. If you can narrow this down to a specific CodeMirror bug, feel free to open an issue. As it stands, it looks like you're asking me to debug your code for you. I won't.\n. I see the problem, but I don't think the fix is very solid. Strings can end in non-word characters. How about using <code>getTokenTypeAt</code> on the cursor position and only inserting two quotes when that doesn't match <code>/string/</code>? Would that work for you?\n. What is the motivation of that use case? And how is it different from <code>var a = ###|</code>?\n. Are you turning <code>sweet</code> into a string in the example? I still feel that the use case is very obscure, and the solution only partial -- in my example <code>###</code> isn't supposed to stand for a word, it's supposed to stand for <code>###</code>, or any other non-word thing. Checking for the cursor being after a word character seems arbitrary and wrong in this case.\n. Hm. I guess there is no real perfect solution. But I guess following Sublime Text is a relatively safe/sane choice. Merged as-is as b05b96e0306d3b33b8a7810884a0d1cfb7b42969\n. Merged as 2e3cce0cd6aea4093ad72daa8e6b537f3cefe635, without <code>user-select</code>.\n. Fixed in 47f1a861d4493dc5b582b0b04d48155311301c1e\n. It seems that some browsers fire a <code>contextmenu</code> event even when <code>mousedown</code> was cancelled. The selection update you see happens in the <code>onContextMenu</code> function. I've pushed a patch that makes it also possible to handle <code>contextmenu</code> DOM events, so that you can cancel that one again. That's not terribly clean, but it seems the only thing we can do (short of horrible hacks like detecing this specific situation and killing the context menu when it occurs).\n. Thanks! Merged.\n. Thanks. Merged as 0ca2c2546475945dca9dacfd93de8cee3a6e5492. I changed the class names in <code>tomorrow-night-eighties.css</code> so that the theme name matches the file name in 23c845ce7cd3f13cf660caa934acd12b7e70b86c\n. Thanks. I've pushed the attached patch instead, which also fixes the case where a range is unfolded by moving the cursor into it.\n. I'm sorry, but no. If CodeMirror pushes any projects over from the flaky mess that is JSMin to a real minifier (UglifyJS or Google Closure), I'd consider that a win. I'm not going to keep workarounds for bugs in other software in the project. (Well, except if that other software is a browser, in which case we tend to not have a choice, unfortunately.)\n. This is too messy. I'd prefer an implementation that simply checks for a <code>codemirrorIgnore</code> property on the event object, and causes <code>signalDOMEvent</code> to return true when that is set to true.\n. Yes... except that your patch inexplicably removes the exports for <code>on</code>/<code>off</code>/<code>signal</code>, and does strange things to do the doc. See attached patch.\n. <code>regChange</code> was indeed needed to force <code>updateDisplay</code> to be called. I've added a <code>forceUpdate</code> flag to the operation record to make it possible to do without that hack. Please try with the two attached patches and see if it helps for your use case.\n. Do you have a test case where this is necessary? (I think scroll positions are generally preserved during resizing, but I might be missing something.)\n. Closing this until an example that shows the need for the <code>updateScrollPos</code> call comes up.\n. Thanks. That doesn't seem too invasive. Merged as d59e2ae4e56b6279bbde82e5618e8013910c27b8. (If you happen to have a line to any of the people who should could fix the actual bug in Blink/Webkit, please encourage them to do so, so that we can eventually drop this hack again.)\n. I've reverted this for now, since it causes the <code>$</code> to occasionally appear in the text. Try pasting a few characters (no newlines) in the middle of a line.\n. Thanks. Definitely an improvement over the old code. Merged as 34f0fa8679e0c098c359ec346a602e7654c5a337\n. Fixed by 5d479e2dc5b4a08d1ebfc3ebd1f177fde8bd5663\n. This looks like a duplicate of #1642 . Is it?\n. It happens because the JS string tokenizer, seeing an end-of-line, will stop, and give control back to the regular tokenizer. The indentation function no longer knows about the unclosed string at the point where the indentation happens. It could be worked around with some more code, but I don't think it's a big enough issue to warrant its own kludgy code.\n. Looks harmless. Merged.\n. I do not think this is a good idea at all. It's compatibility-breaking, and most of those mimes were determined by doing google searches to see what other people are using. The IANA is sufficiently conservative and slow-moving that, as far as I am aware, most people don't bother to even try to get types registered, and MIME types get agreed on mostly in a random, unstructured process. (It'd be nice if it were different, and there was a functioning single repository of types. This is not the world we live in.)</p>\n<p>So I don't want to merge this. The only reason behind it seems to be conforming to a standard, but in this case the standard doesn't help much, so non-conformance is unproblematic.\n. &gt; I don't believe the change is compatibility-breaking</p>\n<p>What I mean is that if someone is using, for example <code>text/apl</code> to specify their mode, their code will fail to select the apl mode after your changes. That breaks existing code.\n. Thank you. Merged.\n. Thanks! Merged as 35f3cbcb617a83daef4ff318b99e097834a8c321\n. Nice. But why did you split <code>inAttribute</code>? Add a property to the closure if you need to identify it. This seems like too much code duplication. Also, you have a <code>console.log</code> still in there.\n. Looks good. Merged.\n. Thank you. Merged.\n. CodeMirror has its own event system. You call <code>.on</code>/<code>.off</code> to register or unregister handlers on editor objects, and <code>CodeMirror.signal(object, \"type\", args...)</code> to fire them. Does that answer your question?\n. This is not a bug report. Try reading the manual if you want to configure the way keys are handled.\n. Not a bug. Inserting a new line inserts a single newline, not two. You might want to look into the closebrackets addon, which does support something like what you are describing.\n. See the discussion at https://github.com/marijnh/CodeMirror/pull/1540 -- I don't use Bower, and I don't know anything about it. I'm happy to have a file there if it helps, but I don't want to have yet another copy of the version number in the repository. Feel free to suggest a better solution.\n. Inded. Thanks.\n. As far as I understand Ruby (which isn't very far) this is not a bug. <code>%{</code> will start a string that ends at the next <code>}</code> and does not allow embedded (<code>#{}</code>) code. So that string ends at the first <code>}</code>, and the quote after that starts a new string. At least, that's the logic the current Ruby mode implements. If I have something mixed up, let me know.\n. Ah, that explains it. Try with the attached patch.\n. &gt; That doesn't seem to fix it.</p>\n<p>It does fix your example. If something else is now broken, please provide a new example.\n. I haven't seen a well explained description of the problem/solution, or a pull request, yet. If one of those appear, I'd definitely be open to integrating it.\n. Thanks for spotting that. Merged.\n. See attached patch -- I think <code>innerMode</code> should not reset to the input when a fixpoint or null is returned, but rather simply stop at the current position, so that a mode that wraps rst could still accurately return the rst mode as the inner mode at a given point.\n. See https://github.com/marijnh/CodeMirror/pull/1540 . Is there any way I can have a bower.json without having to also update the version number?\n. Thanks.\n. Ugh. Thanks for catching that. Merged.\n. Great, thanks! Added as ad333b64e4245dabfc4d25246e49269e663a6839 and integrated with 562af66579ad69425134bdbac03a82db10bf0fe3\n. Thanks! Merged again.\n. Thanks for reporting that. See attached slightly simpler patch, which should also take care of it.\n. Merged, and fixed in attached patch (you trampled on an existing <code>i</code> variable -- also, <code>for/in</code> isn't a very safe or efficient way to iterate over arrays).\n. @ibdknox Are you planning to make these changes? Should I continue watching this pull request? In any case, add a comment if you end up adding patches, to make sure I see them.\n. Thank! Merged as dec8638\n. Thank you. Merged. I intentionally kept your previous patch out of yesterday's release because I was worried something would come, so no harm done.\n. Could you explain what behavior exactly you're implementing here? I'm not familiar with a feature like this, so I'm not quite sure what the code is trying to do.\n. So this is different from just adding a screen height bottom margin in that the space at the bottom only materializes when you scroll into it, and vanishes again when you scroll away from it?\n. Could you try the addon in 097980e6a28531d7b70fc38d2cf50610c3b63ea4 and see if it works for you? (It's enabled in http://codemirror.net/mode/tcl/ )\n. I see the problem, but I think it is too minor to justify adding the complexity needed to gracefully handle it. This situation is rare, the symptom isn't a very big deal (minor scroll instability), and can be worked around with a little external code (save scroll pos, resize, reset scroll pos).\n. This is supported and works. Try setting the <code>mode</code> option.\n. Can you put a demo on jsbin.com or so? There are several files in the distribution doing the same, such as http://codemirror.net/demo/folding.html\n. Nice! Merged as 1984f29\n. You didn't mention what browser you use. If it's Chrome 28, try updating.\n. All right. Merged.\n. Could you please provide a reproduction that does not involve large external projects (node-mirror)?\n. Are you calling <code>editor.refresh()</code> after showing the editor?\n. Yes.\n. The <code>setOption</code> method maybe? In any case, this is no a bug. Support requests don't belong in the bug tracker.\n. @mightyguava Any comment on this?\n. Wonderful.\n. @mightyguava This is in the vim code. Want to take a look?\n. Great. Merged as b86ffff\n. Thanks. Merged.\n. The <code>catch</code> does look a bit suspicious. What kind of errors is it supposed to catch? Could we use a special return value instead, so that it doesn't eat errors coming from real bugs?\n. I know, I just hadn't noticed the <code>catch</code> before. I can merge this, but I'd really like to do something more structural about the unspecified errors.\n. Ah, I hadn't noticed the extra commit. Yes, that's what I had in mind. Merged.\n. This is what tab is bound to by default. Simply rebind it (using the <code>extraKeys</code> option) to get a different behavior.\n. See attached patch. It probably still doesn't behave properly when there's a sequence of bookmarks with differing <code>insertLeft</code> options -- since then it's not always clear that there even is a proper cursor position -- but for your test case things should be better.\n. (I hadn't missed your other report of this bug, by the way, it's just that this is the kind of fiddly nonsense that tends to sit on my queue for a bit before I muster the courage to dive into it.)\n. No worries about the double report. The other was in a closed, different bug, so having a proper issue # is a good thing.\n. Thank you! Merged as 0d45af3\n. Thank you. Merged as 7f82421\n. This appears to be a Chrome-specific thing (though I didn't test in a recent Safari). I've found a kludge that helps.\n. Thanks for fixing that. Merged. (I've also moved the addon to <code>edit/comment</code>, which is a saner location, so if you pull, update your paths.)\n. Looks good. Merged.\n. Thanks, merged.\n. Thanks for figuring out the source of the problem! Merged.\n. Could you point me at the documentation that describes the expected behavior here? (I can't reach the person who actually wrote the Yaml mode, and I've never used Yaml in my life.)\n. Could you try with the attached patch?\n. Right. The YAML mode was contributed by someone else, and doesn't seem prepared to these kind of subtleties. I am personally not motivated to improve or rewrite it, but such a pull request would be very welcome.\n. This sounds like a duplicate of #1642 . Could you verify whether it is, and try upgrading to the latest Chrome 28?\n. Thanks! Merged.\n. Looks good. Merged.\n. Merged. See also attached cleanup patches.\n. Looks good. Merged as 015b2e6399c1da1f0481f372313014e5bba74c38\n. Looks good. Merged as c3f4f321bf8564cb60f (after merging a conflict -- you were working from a six month old tree)\n. @mightyguava The way the <code>moveH</code> and <code>moveV</code> methods deal with atomic (and collapsed) spans is by simply letting <code>setSelection</code>'s call to <code>skipAtomic</code> deal with it. This requires the value for <code>bias</code> to be correct, so that it knows whether to skip forward or backward when hitting an atomic span. <code>setSelection</code> and <code>extendSelection</code> weren't exposing this parameter yet. I've added a commit (attached) that changes this. Could you see whether this makes it possible to fix the vim mode? Basically, you set it to -1 for backward motion, 1 for forward (and leave it undefined when it's unclear how you're moving).\n. @Dominator008 Given the issues caused by #1668, I don't think this is solid enough to merge. Also, it seems that once you remove the vim fix, there's not enough left to warrant a separate addon -- the problem of calling <code>markText</code> can also be solved inline by whatever code that needs it.\n. @mightyguava This behavior is, in a way, intentional -- <code>clearOnEnter</code> is supposed to unfold the range that you're touching on. This is not how vim's folding works, but it is what was intended by whoever made the call to <code>markText</code> that created the range.</p>\n<p>How about non-<code>clearOnEnter</code> ranges? Can those be made to work properly with the current api? How problematic is the fact that folds made with the default folding addon will open up when you act on them?\n. @mightyguava </p>\n<p>Communication on this is made somewhat more difficult by my ignorance of the vim binding internals. What <code>findPosV</code> (and thus <code>moveV</code>) do is use the visual position of characters to determine where to move, thus working properly with collapsed, cross-line regions. Calling <code>findPosV</code> (or <code>findPosH</code>) itself should not cause folded spans to unfold.</p>\n<p>What style of motion, exactly, would you need from <code>findPosV</code>? By-actual-line, as in, skipping all of a wrapped line and moving to the corresponding character in the next/previous line? That'd be somewhat tricky to define for wrapping, partially folded lines, but we could do something like compute a total-horizontal-offset, which includes the width of wrapped line sections above the cursor, and move to the place on the next line that corresponds to this offset (which would be somewhat tricky, still).\n. @mightyguava Could you look at 6d1b5c4 and see whether it helps? Defaulting the bias seems harmless enough, but I'm not sure how to test whether it does what you need.\n. Glad to see it worked itself out!\n. Great. Merged as b2ea0a5560b890780cd8fbd8b11d20f5eb51a490\n. See attached patch, which also does this for the Ambience and Midnight themes.\n. Great. Merged as ba9033cf06bdf\n. That's useful! Merged.\n. Thanks. Merged\n. Next time, don't just add to an old branch, but rebase onto a proper upstream state, before submitting a pull request. That way, I can actually tell which patches are new.</p>\n<p>Merged as 304d306e3ad082acd838605451c984a6f5c447b7\n. Not sure why this was left open and not merged, but the keyword exists in the mode now.\n. Merged as 3b50151 , but without the huge <code>test_*.html</code> files -- everyone checking out the repository will have to download everything in it, so I don't feel that having 1000+ line files in the repository is a good idea unless they actually serve a significant purpose.\n. The theme's a good one. I've merged that. As for the rest...</p>\n<p>a84159a / 0f166bf / 4140220: I consider the demo directory a dumping ground for a random collection of demo pages, I don't want to maintain a full list or give it a prominent presence in the site navigation.</p>\n<p>eeaab75: This is a refactor no one asked for. A minifier will do this just fine, and the code is easier to edit without it. I'm not going to include a 2000 character noise line for mobile detection. If you have a specific browser that we fail to detect, let me know.</p>\n<p>05eed5a: There is no PHP involved in this repository or on my webserver. I'd like to keep it that way.</p>\n<p>e9bd437: The minified code is intentionally not in the repository to keep patch diffs simple.</p>\n<p>7796172: I fail to see how copying a CodeMirror 1 mode (different API) into the repository is going to accomplish anything. Did you even test whatever you are trying to do here?</p>\n<p>a007185: The author of the theme chose this font. Don't randomly change it.</p>\n<p>The moral here is: don't treat the project like something you can randomly make sweeping changes to on a whim, like you'd do with your own code. I maintain it, and there's a good reason for things being the way they are, most of the time.\n. Merging into #1757 -- underlying problem is the same.\n. Well... it seems there as a huge glaring hole in the current handling of right-to-left text -- in that my code assumes that the text is displayed entirely inverted, whereas it'll only be inverted per-line. Currently, the editor code leaves line breaking entirely up to the browser, and doesn't observe where the line breaks end up, but getting this right would involve changing that somehow. Which is going to be messy.</p>\n<p>I am not sure how to go about fixing this. Will think about it a bit more.</p>\n<h1>1756 might simply be a different symptom of this problem.</h1>\n<p>. <em>Applause.</em> Thanks for taking care of this!. Thanks -- merged.\n. Thanks. Merged.\n. I've implemented a simpler version in 69c8610dce41eabad58ba5c20f094554c78785fe . Let me know if that doesn't work for you.\n. I didn't export the functions because I think the option is a perfectly sane interface to this functionality, and I didn't want to further pollute the CodeMirror object.</p>\n<p>Good point about the width/height styles. See attached patch.\n. Good proofreading ;) Merged.\n. Good proofreading ;) Merged.\n. Hm, that looks like it could indeed come up. Merged.\n. Which browser is this?\n. Merged, followed up by attached patch, which cleans it up a bit and renames the option to <code>showDifferences</code>\n. Okay, see attached patch. Merged.\n. What code are you calling it on, witch which mode and which position? It's used in various addons without problems, so it doesn't freeze for all code.\n. Yeah, you still didn't show me the actual text (+ cursor position) where this happens, or tell me which mode you're using. Set up a demo if you want me to look into this.\n. The things people put up with from their linter. Oh well, harmless enough -- merged.</p>\n<p>The empty blocks are intentional, since the file is trying to also serve as a guide to styling CodeMirror.\n. Merged as 5c4892a . Try to be somewhat more sensitive to the style of the surrounding code if you submit further pull requests (comma placement, quote character, no spaces inside parens, etc).\n. The comma in the var list was also leading instead of trailing, I corrected that. Your other pull req contained a few <code>name( arguments )</code> instances.\n. Looks sane. Merged.\n. What if you just use CSS to hide it?\n. I think the arrows are simple and limited enough (only generated for the visible viewport) that, when they are <code>display: none</code>, the overhead is insignificant. So I prefer a css solution over further code complexity.\n. Thank you. Merged.\n. Isn't this another duplicate of #1022 ?\n. See b88e8c3f8077a2481b0f26c3b for a rough, temporary workaround.\n. Thanks for spotting that. Merged.\n. @bfrohs Want to take a look?\n. Thanks for looking into that! Merged.\n. Doesn't happen for me. Tried in various demos on the project page (http://codemirror.net/mode/coffeescript/ , http://codemirror.net/demo/trailingspace.html , http://codemirror.net/mode/javascript/ ).\n. Ah, interesting. There is no binding for Ctrl-Delete on Mac. I tried to reproduce on my old MacBook, but that doesn't have a delete button. Fn-Backspace is supposed to simulate delete, but Ctrl-Fn-Backspace just inserts some weird character, and doesn't seem to actually do what Ctrl-Delete does.</p>\n<p>If you could open the developer console, reproduce this, and then try to find out which loop is causing the hang (or at least give me a stack trace and some local variable values), that would be useful.\n. Closing until further information is provided.\n. Um, that's definitely not something I'm inclined to merge. The <code>empty</code> method doesn't exist in Firefox, and killing the selection is <em>not</em> a documented (or desirable) side effect of creating an editor.</p>\n<p>How does clearing the selection help layout time? If it does in Brackets, why don't you put this somewhere in Brackets code, rather than in CM's constructor?\n. Looks good. Merged with attached cleanup patch.\n. Looks good. Merged, with attached cleanup (deprecated properties are there for backwards compatibility -- don't add them to new code!)\n. Wouldn't it work to set a timeout in the mouseover handler and cancel that again on mousemove?\n. Ugh, not sure how long this has been broken, but the code was calling <code>getBoundingClientRect</code> before actually putting the widget in the DOM, and thus the repositioning code was completely useless. Should be better now.\n. Thanks. Merged.\n. I'm no fan of having top links like that at all. See attached patch, which simply removes them.\n. Are you seeing it stuck in the wrong place, or only briefly flickering at a wrong position and then being fixed again? (I only see the latter when I try to reproduce this.)\n. Despite what you wrote in adobe/brackets#4564, I am still <strong>not</strong> able to reproduce this.\n. Okay, let me elaborate. I see the jumping during resize. This is intentional. If the correct position is recomputed for every resize event, size dragging becomes terribly slow. So it delays a bit and only does the work every 200 ms. I actually believe this change was in response to a problem in Brackets, but I can't find the issue/thread for it right now.\n. Updated Chrome on my MacBook to 29, and really tried to follow your instructions to the letter, but I am still not seeing this happen.\n. I've finally managed to reproduce this using Firefox (still no luck with Chrome). Investigating.\n. Could you test whether the attached patch helps?\n. Wondeful.\n. Try again with attached patch. I had isolated the problem in a test case that used <code>setSize</code>, but the case where the window resize handler triggered the bug was slightly different, and my fix didn't work for that case. It should now.\n. The problem is almost certainly the <code>continue</code> added by my patches causing an infinite loop because the width of the editor doesn't stabilize. I have a semi-formal proof that this can not happen, but since it's happening for you, I guess there's something wrong with my reasoning. Could you apply the below patch, run your tests, and tell me what you see on the console? (It should no longer hang, since I limited the loop to 10 iterations. Might still be slow.).</p>\n<p><code>diff --git a/lib/codemirror.js b/lib/codemirror.js\nindex a14ce53..503d259 100644\n--- a/lib/codemirror.js\n+++ b/lib/codemirror.js\n@@ -409,7 +409,8 @@ window.CodeMirror = (function() {\n   function updateDisplay(cm, changes, viewPort, forced) {\n     var oldFrom = cm.display.showingFrom, oldTo = cm.display.showingTo, updated;\n     var visible = visibleLines(cm.display, cm.doc, viewPort);\n-    for (;;) {\n+    console.log(\"starting updateDisplay loop\");\n+    for (var cut = 0; cut &lt; 10; ++cut) {\n       var oldWidth = cm.display.scroller.clientWidth;\n       if (!updateDisplayInner(cm, changes, visible, forced)) break;\n       updated = true;\n@@ -417,6 +418,7 @@ window.CodeMirror = (function() {\n       updateSelection(cm);\n       updateScrollbars(cm);\n       if (cm.options.lineWrapping &amp;&amp; oldWidth != cm.display.scroller.clientWidth) {\n+        console.log(\"width changed from\", oldWidth, \"to\", cm.display.scroller.clientWidth, \" -- doing a hard re-measure\");\n         forced = true;\n         continue;\n       }</code>\n. Well, there's certainly something unexpected going on there -- there's no way redrawing or remeasuring the code should cause the width to increase on every iteration. And why does it start so small? For me, when wrapping is turned on, I see only two widths -- the one where the vertical scrollbar is there, and the one where it's not. Can you inspect the actual DOM and see if the thing it contains during these tests is an actual sane editor? Can you see what is determining the width of the scroller element and how it could be constantly changing?\n. Still, no matter what the gutter is doing, with the default css, the scroll element's width should be fixed, so its <code>clientWidth</code> would only differ depening on its vertical scrollbar. I think you have some css rule that's causing trouble.\n. I've added a check to prevent problems in (more or less nonsensical) cases like this. Closing.\n. The htmlembedded mode is contributed, and, now that I look at it, not of a terribly high quality. It'd have to do the tricks that the mode multiplexer uses to be robust. Or, even better, it could just be written on top of the addon/mode/multiplex.js\n. The multi-select branch is, for now, in limbo (not about to be merged in its current form), so I'm not accepting patches there.\n. That's the first time I've heard of TOML. I'm not really interested in including super-obscure languages in the distribution (since all code I distribute tends to involve work at some point). Where is this used? Would you be able to just host/distribute it yourself?\n. Okay, I'll just go ahead and assume this is an up-and-coming configuration format. The code looks good. Merged as 2d51b31 . I'll @-mention you when people report bugs in this.\n. Ugh, Chrome 29 finally fixed a bunch of weird bugs in the Webkit code related to wrapping. They got regular hyphens right, but it seems that with an endash (which is what you have in your example), the bug still exists. I've pushed a kludge, and will try to report the bug to the Chrome team. It's very possible that there are more bugs like this lurking. I've fuzz-tested the ascii space and that seems to work fine now, but testing the whole unicode space would take a lot of computing power.\n. Opened https://code.google.com/p/chromium/issues/detail?id=282134 to hopefully get this looked into on the Chrome side.\n. You should probably do this on the level of the hintingfunction -- something like</p>\n<p><code>function combinedHints(cm, options) {\n  var js = CodeMirror.hint.js(cm, options);\n  if (js &amp;&amp; js.list.length) return js;\n  return CodeMirror.hint.anyword(cm, options);\n}</code></p>\n<p>Let me know whether that helps.\n. Does the attached patch fix the problem for you?\n. dialog.js is not just used for search. You can pass in a keymap when opening a dialog, that'd probably be a better way to implement this (on the side of the search addon)\n. Nice. Merged as b8e09e976015c065d7911e472bc1902d7f299940, integrated in 90d036d610e4ba58649ec325967b3b7ef5efd15f\n. <code>.focus()</code> does not put the cursor at 0,0. <code>setValue</code> does, but it does not cause the editor to lose focus. If you're putting in completely new content, the old scroll position doesn't mean anything anymore. If you're just making a minor change, don't use <code>setValue</code>, but make the precise change with <code>replaceRange</code> instead.\n. <code>setValue</code> is precisely how you clear the editor.\n. You can listen to <code>change</code> (or <code>beforeChange</code> if you want to be able to cancel the paste) events, and check the <code>origin</code> of the change object. It'll be <code>\"paste\"</code> when the change was caused by pasting.\n. I've pushed attached patch instead, which should work for all nested modes, and not crash when the cursor isn't in JS code.\n. @peterkroon Want to take a look at this?\n. See attached patch instead (<code>getSelection</code> can be expensive, and we have to make sure remaining highlighting is first cleared).\n. I do not want to add another category to the styling/theming system just for this.</p>\n<p>@santec What was you intention with these lists of function names? Why aren't they being used?</p>\n<p>I'd be in favor of just merging the <code>builtin</code> and <code>function</code> lists, since the distinction between them seems obscure.\n. I went with option 2, since these don't seem to be real keywords. See attached patch.\n. Thanks, merged. Without the trailing whitespace and the console.log call.\n. Very nice! Merged.\n. The design is that this array is never mutated. Unfortunately, the <code>setGuttersForLineNumbers</code> <em>was</em> mutating it, creating the problem you saw. I've fixed this in attached patch.</p>\n<p>Creating a separate pull req for an issue is perfectly fine, by the way.\n. (Ignore this comment. Was on the wrong issue)\n. Appears to be a regression in Safari's wrapping algorithm, where it wraps differently when the line is divided in single-character spans. I don't see much of a way to solve this. If you want to try reporting a Webkit bug, here's a minimal example that shows the problem:</p>\n<p><code>&lt;div style=\"width: 3em; word-wrap: break-word;\"&gt;\n12345678&lt;br&gt;\n&lt;span&gt;1&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;&lt;span&gt;4&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;span&gt;6&lt;/span&gt;&lt;span&gt;7&lt;/span&gt;&lt;span&gt;8&lt;/span&gt;\n&lt;/div&gt;</code>\n. That's great. Thanks for verifying.\n. Great. Merged, without the random unrelated change and trailing whitespace, as 45d3cda933484698bf\n. Which browser (including version) and OS are you using? With Chrome and Firefox on Linux, everything seems to work as intended.</p>\n<p>This is the HTML code I'm using:</p>\n<p>```\n&lt;!doctype html&gt;\n<meta charset=\"utf-8\"/>\n<link rel=\"stylesheet\" href=\"lib/codemirror.css\">\n<script src=\"lib/codemirror.js\"></script>\n<style type=\"text/css\">\n @font-face {\n  font-family: ubuntu;\n  src: url('https://thimble.webmaker.org/friendlycode/css/ubuntumono/ubuntumono-r.woff');\n }\n .CodeMirror { font-family: ubuntu; }\n\n\u0e14\u0e33\u0e14\u0e33\u0e14\u0e33\u0e14\u0e33\u0e14\u0e33\u0e14\u0e33\u0e14\u0e33\u0e14\u0e33\u0e14\u0e33\n\u0e01\u0e33\u0e01\u0e33\u0e01\u0e33\u0e01\u0e33\u0e01\u0e33\u0e01\u0e33\u0e01\u0e33\u0e01\u0e33\u0e01\u0e33\n\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"code\"));\n```\n. Still no luck reproducing it. Here's what I've been doing:\n- I put the HTML test I gave above into a file\n- Open that file in Chrome 29 (in all of OS X, Windows, and Linux)\n- Click the top line of Thai characters somewhere near the middle\n- Cursor appear where I clicked\n- Press enter\n- Line is broken where the cursor was showing\n. Following the original steps also doesn't reproduce it for me. But those steps don't make any sense for me -- there are no style tags in the head of demo/complete.html, and if I add one using dev tools and add those rules to it, the browser doesn't seem to load the font.\nIf you can be bothered to create a test case that reliably reproduces the issue and put it online (maybe jsbin.com), I'll take another look. If not, I'm out of patience.\n. I finally managed to reproduce this on Windows. Still no luck on OS X, but that might be because I'm still on Mountain Lion (hardware too old for Apple to allow me to upgrade further).\nThe problem is that apparently, some platforms, with some fonts, render an dashed empty circle in front of the '\u0e33' character when it is in a span element on its own. That circle is showing up in the hidden element that's used to measure the position of characters, and throwing off the measurements.\nI haven't been able to come up with a quick workaround. I have some vague plans to overhaul the measuring system, which would address this (along with a bunch of wrapping related bugs and some of the slowness of big lines), but implementing that is a big project, and I don't know when I'll have the time and motivation to work on it yet.\nHow much of a showstopper is this for you? You could consider just switching to courier or some other system font when you detect Thai language. That's a silly hack, but I guess it's better than having incorrect cursor placement.\n. CM is already handling combining marks for some languages (for example `COMBINING_ACUTE_ACCENT 769), but those currently have the effect of making the two code points act as a single letter -- you can't put your cursor between the 'e' and the accent in '\u00e9', even when it is written as two code points.\nWould that behavior also be appropriate in this case? From the look of it, it seems that these are more like two separate characters where the second happens to add a something to the first.\n. So, JavaScript's support for this stuff is pretty much zero. I've been adding regexp ranges to detect combining characters in various scripts as I find that users are having trouble with them. Can you give me a range or set of ranges that correspond to combining characters in the Thai script? Do I see correctly that there are also prefix combining characters? (Where a combining code point following a non-combining one still leads to a composite glyph.)\n. @jankeromnes It sounds like that would make sense. See 66a5cd6\n. This is the same issue as #2115\n. Thanks, merged. Descriptive commit messages are a good thing, by the way.\n. Very nice. Merged as 7579444498ba0\n. Thanks, but I've pushed slightly adjusted 9bc5f545b499c2bfc (corrects the link to point at the actual intended method) and ac3391d3bdc1616ec (remove duplication of that code entirely) instead.\n. Thanks for spotting that. Merged.\n. There might be 3rd party code depending on that argument order, and though I agree it's awkward, I don't think it's bad enough to warrant an incompatible change.\n. Thanks, looks good. Merged.\n. Thank you. Merged.\n. Please try with the attached patch, and let me know if that doesn't solve the problem for you.\n. Sorry, but no, I don't think this is worthwhile complexity. Just use the bind method or some equivalent, this is what it's there for.\n. Thanks for catching that! Merged as e470d7f4ad2e3bc60\n. (If IME is important, consider setting the inputStyle option \"contenteditable\" in CodeMirror 5.0+. This should help, though it might introduce other issues since the contentEditable backend isn't all that well tested yet.)\n. Firstly, try not to use the word 'should' when making a feature request. You're asking for something. If you sound like you're commanding, I'm not inclined to listen.\nSecondly, there is no information about parent or child elements in tokens, so I'm not clear on what information you're hoping to receive.\n. Individual modes have state objects that, for some modes, track context information (for example the XML mode knows the current set of open tags). The attached patch passes this state object as 5th parameter to the callback.\n. Thanks for figuring that out. In current Webkit builds the bug that necessitates this hack is fixed. But many people will be stuck with older Safaris for ages to come, so indeed this is good to fix. I've pushed a patch (attached) that also adds the backslash to the util script that was used to generate this regexp.\n. Oh, right, I tested in IE10, not 11. Will install that soon.\n. Ask the original authors whether they want to submit it. It is licensed under an MIT license, but I still don't feel comfortable simply including it without their feedback.\n. Cool. Added in 291ffbdf9d89a1e5d74b57ee583b878b2008b9b8\n. I think you want the refresh() call at the end of the shown handler. Refreshing when hidden is useless, in any case.\n. I figured it was the missing refresh call. Wasn't it? If not, can you put up a full reproduction of the problem on jsbin.com?\n. There should now be a style in codemirror.css that counteracts this.\n. I wasn't able to create a test case where either Chrome or Firefox renders anything differently for different text-rendering settings. Which platform are you on? Can you give me a full test case?\nThat being said, CM does not do anything outside of the DOM. The element used for measuring is simply a sibling of the actually visible elements, and should have (almost) the same styling applied to it. I see no reason why your CSS rules might apply differently to the measuring element.\n. Closing until further information is provided.\n. Looks sane. The only problems is that it'll make the activeline style precisely match the selection color, which makes it impossible to see the actual selection when that feature is turned on. See http://codemirror.net/demo/theme.html?solarized-dark . If you could adjust one of these to be noticeably different, I'll merge this.\n. For me having things work decently in CM has more priority than the Solarized docs. Having active line highlighting and selection at the same time is how CM currently works, so that has to function.\n. Ah, sorry, github doesn't notify me when commits are added to a pull request. Looks good -- merged.\n. Yes, send it. I'll review it.\n. Good point. See attached patch, which fixes this with slightly less code.\n. Good point. See attached patch, which fixes this with slightly less code.\n. @mightyguava Agreed.\nShould be solved by attached patch.\n. Yes, it's possible. See http://codemirror.net/doc/manual.html#keymaps and http://codemirror.net/doc/manual.html#replaceSelection\n. That's the nice thing with CSS -- you can add some rules to your setup, and override/extend existing themes. Font sizes should never go in themes, and removing the shadows should also be very easy to do.\n. The behavior occurred because CM wasn't explicitly handling those key combinations, causing the browser's default behavior to occur, which only worked on text that was still in the hidden textarea.\nAttached patch binds Shift-Backspace and Shift-Delete to the same behavior as Backspace and Delete\n. Does shift-delete have a meaning on OS X?\n. Removed that binding in 3e12cbda3baff7472214f711159d7350a5456344 . I can't find any definite info about the role of shift-del in OS X.\n. Great. Merged.\n. Does the attached patch help?\n. This was already fixed last week in a3538de0decec580bc79fa0f9237973c83c8f5a9\n. Nice. But I'd prefer to leave off the license block \u2014 having multiple licenses, even if they amount to the same, in the repository tends to scare off risk-averse users. The central license for CodeMirror states 'copyright Marijn Haverbeke and others', and I'll add Glen Roberts to the AUTHORS file.\n. Wonderful. Merged as 11f4a8a\n. A recent bugfix (#1795) broke this. Should be better now.\n. Start here: http://marijnhaverbeke.nl/blog/#cm-internals\nIf you have specific areas beyond that that you're interested in... well, I have never done paid blogging before, but I'm open to anything.\n. Normally, I'd be very enthusiastic about such an idea, but right now, I have a terrible lot to do (rewriting Eloquent JavaScript, among other things). Maybe I'll come back to it later.\n. Hi all, I just ran into this again. I've written a few more entries at http://marijnhaverbeke.nl/blog/#cm-internals , but if anyone has a budget and a theme they'd like to see more written about, get in touch.\n. Pinging @bfrohs again. (Contributing to CodeMirror can be quite a commitment ;)\n. Patch 94ccdb5250e554932b8af1c4b026686ca287b90a fixes this.\n. Could you set up a simple demo that shows A) what you're doing, and B) the bad performance.\n. Okay, but that is a big project loaded into another big project, not a small demo. I need to see how you are using getTokenAt. Can you reproduce the issue in a simple static HTML page with a small script that does something equivalent to what you are doing in brackets? Failing that, can you at least point me at the brackets code that is making the calls to getTokenAt?\n. (And some background: The patch you linked to concerns a behavior where, if a token is requested at a point that was never parsed before, CM will try to find a parser state for a line before that. It will scan a certain range, and if it doesn't find a state, will simply use the start state, so that it doesn't have to synchronously parse the whole document. However, for mixed modes, there is no obvious way to determine whether we are in a sub-mode, so it will use a larger range, to increase the chances of seeing the token that started the sub-mode. The computed state will be saved, so that subsequent calls to get nearby tokens will reuse it. The only way I can see this making a large difference is if you're making multiple calls to getTokenAt in a really big document, so that the computed ranges somehow don't overlap, or if you're doing something like setOption(\"mode\", ...) in betwen getTokenAt calls, which would clear all the cached parser state. Or is only the first call slow?)\n. Aha, the problem is the precise flag that Narciso added in 1 . This\ndoes not play well with the caching mechanism.\nI'd suggest that if you're going to traverse the whole document anyway, you\nuse the runmode addon 2 to do your own iteration, which is going to be a\nnumber of orders of magnitude more efficient than getTokenAt.\nhttps://github.com/marijnh/CodeMirror/commit/52558bf921b61ac194b1e71be4ab3c8cda50aa06\n\u200b\n. See also https://github.com/marijnh/CodeMirror/commit/99192a96f44e55eb395ad007330168e24d866c8d\n, which fixes the problem that caused this slowdown, and will probably\nhelp a lot here. But I'd still recommend using runmode instead.\nOn Tue, Oct 1, 2013 at 5:44 PM, Marijn Haverbeke marijnh@gmail.com wrote:\n\nAha, the problem is the precise flag that Narciso added in 1 . This does\nnot play well with the caching mechanism.\nI'd suggest that if you're going to traverse the whole document anyway, you\nuse the runmode addon [2] to do your own iteration, which is going to be a\nnumber of orders of magnitude more efficient than getTokenAt.\n1:\nhttps://github.com/marijnh/CodeMirror/commit/52558bf921b61ac194b1e71be4ab3c8cda50aa06\n[2]: http://codemirror.net/doc/manual.html#addon_runmode\n. Nice! Merged as 03f9264. I've removed the theme though, since it defined too few styles to be generally usable as a CM theme.\n. Indeed. I was puzzles by this as well, but it doesn't seem to be something that CodeMirror can be blamed for.\n. Thanks for spotting that (it used to use that class, and was later changed). Merged.\n. Nice. Added to the real-world uses in cfb624d\n. Thanks! Merged. Try to configure your editor to not use tabs for indentation, next time.\n. What do you mean by \"generates completion too often\"? The fact that the completion popup is now hidden during typing, and only re-shown when the user stops typing for a moment, is intentional.\n. I don't really see the problem. It has to refresh as you type. Why is it bad that it blinks?\n. I think you have @NV to thank for that (see 462ca4c6).\n. I am hesitant about building this addon out to be a full, non-modal dialog until we find some solution to the problem it has of covering up part of the editor. Overlaying is nice and low-impact, but if people want to use the editor while a dialog is open, it'll have to somehow make sure that there is nothing interesting under the dialog. Also, what if multiple dialogs are opened?\n. No, I don't want to merge this. I think it's the wrong solution \u2014 and I'm currently too busy to work on figuring out what the right solution would look like.\n. This is a good idea. Merged as 496c545\n. Good idea. Merged as a52ea9c\n. Thanks. Merged as 6fd2965\n. I lost track of this. Thanks for reminding me. Merged as 9ebe46e2cfefc50f5cf86ba9ceae8b4247a50e42 , documentation added in attached patch.\n. Releases come around the 20th of each month, but you can also simply use a development snapshot.\n. > Drag selection from bottom left to visible top right and drop\n\nWhere exactly are you dragging it? At this point, I have everything selected, so dropping anywhere is a no-op (a selection dropped on itself doesn't cause anything to happen.)\n. No, I'm sorry, that doesn't clarify it at all. Written instructions, that detail every part of the reproduction, would really be more useful.\n. Are you still seeing this? Also in the v4 branch?\n. Thanks. Merged.\n. See my comment on #1174 . Wontfix until JS grows real unicode support.\n. There is some work underway (under the ECMAScript Internationalization initiative) to address this, but it looks like it'll take a while before things are going to start happening.\n. This is a conscious non-goal. Mozilla's strict warnings are an artifact of a time when the Moz devs thought they could decide what good style was, but the JS community moved on without them, and their definition of good style never caught on. I consider them obsolete.\n. Yes, such editors implement an extra flag on selection positions that distinguishes between it being associated with the character to its left or the character to its right. CodeMirror does not currently implement this feature. I will try to keep it in mind the next time I work on the character/cursor positioning code, but it's rather hard to get right, so I can't promise anything.\n. Thanks! Merged.\n. This is a duplicate of #931\n. I think the attached patch will help. The problem was that swapDoc was resetting the editor's state without the foldgutter addon noticing.\n. I've merged the yanking of last line patch. I agree with @mightyguava that disabling the keymap is better done through other means.\n. If I see through this tangle of (partially unrelated, partially reverting) commits, the end result is just a CodeMirror.keyMap.empty = {}. I don't think empty keymaps are useful all that often, and it is extremely trivial to add this from external code, so I'd rather leave that for people to add themselves if they really need it.\nAlso, look into git rebase if you end up submitting more pull requests. Getting a single clean patch makes my life a lot easier.\n. I don't know much about this mode, but your change seems to disable a feature that probably has some reason to be there.\n@rosmanov Want to take a look at this?\n. @rosmanov Right. So what would be a better way to fix the problem @brandonwamboldt noticed?\n. Great. Merged as c3e84e6\n. Nice. Merged.\n. Nice. Merged.\n. Attached patch should help.\n. Thanks. Merged.\n. This doesn't yet exist, and I am not inclined to write and maintain it, but it definitely would be possible to have such a thing.\n. We're not extending the scope of the core library anymore, so if you need this, the way forward is to implement it and distribute it yourself.. (@mightyguava I assume this is talking about the vim keymap.)\n. Thanks! Merged as 1a1646d\n. Looks good. Merged as 30287f9 \n. Did you try anything beyond some trivial editing? Once you're editing the dom representation of the editor, rather than the content as the editor understands it to be, 90% of CodeMirror won't work anymore. This is not a solution.\n. I have no idea what you may be talking about. Care to explain?\n. I see. I have nothing to do with Gherkin and such though, so opening a bug here is not the way to make that happen. You'll have to implement it yourself.\n. Adding 250 lines with no explanation whatsoever isn't really how you do pull requests.\nThis looks like it should be a beforeChange handler in some other codebase, but if you want, you can try to explain to me what it is and why you want it in the CodeMirror core.\n. Try reading the documentation: http://codemirror.net/doc/manual.html#event_change\n. Well, the part where it says that the changed text is split by line--leaving out the newlines and implying them at the boundary between the strings in the array--explains why there are no newlines in the strings and why there are empty strings there. I also expect the change event will have a next pointer pointing to another change.\nI couldn't reproduce your test case, since matchbrackets.js does not autofill anything (it highlights matching brackets).\n. If I observe a change event generated when exploding a pair of brackets by pressing enter between {} in codemirror.net/demo/closebrackets.html , this is the change event I get (some annotation added), which is exactly what I'd expect.\n{\n  \"from\": {\n    \"line\": 2,\n    \"ch\": 3\n  },\n  \"to\": {\n    \"line\": 2,\n    \"ch\": 3\n  },\n  \"text\": [ // First change, caused by cm.replaceSelection(\"\\n\\n\", ...) call\n    \"\",\n    \"\",\n    \"\"\n  ],\n  \"removed\": [\n    \"\"\n  ],\n  \"origin\": \"+input\",\n  \"next\": {\n    \"from\": {\n      \"line\": 3,\n      \"ch\": 0\n    },\n    \"to\": {\n      \"line\": 3,\n      \"ch\": 0\n    },\n    \"text\": [ // second change, indent the empty line\n      \"    \"\n    ],\n    \"removed\": [\n      \"\"\n    ],\n    \"origin\": \"+input\",\n    \"next\": {\n      \"from\": {\n        \"line\": 4,\n        \"ch\": 0\n      },\n      \"to\": {\n        \"line\": 4,\n        \"ch\": 0\n      },\n      \"text\": [ // third change, indent the line with the closing brace\n        \"  \"\n      ],\n      \"removed\": [\n        \"\"\n      ],\n      \"origin\": \"+input\"\n    }\n  }\n}\n. @mightyguava I've merged your patches. Closing this until further notice.\n. Looks good. Merged as 45a15f3\n. Key bindings can't be one size fits all, and that is why CodeMirror allows you to reconfigure key bindings. If you want Tab to indent, bind it to \"indentAuto\" with the extraKeys option, or overwrite it in CodeMirror.keyMap.basic. By default, Shift-Tab is bound to this command.\nThe problem with the CoffeeScript mode's auto-indentation being crude about brackets and braces does look like a real issue though. I'll take a look.\n. Attached patch should improve the way indentation of bracketed blocks is handled by the coffeescript mode.\n. I can't reproduce this problem. The first comment line will be indented two spaces by default, of course, since there is no reason for the mode to know that we're closing the block, but if you put it flush left and then press enter, the next line will end up unindented too. Might be an accidental result of some patches I pushed yesterday.\n. Your example had a comment instead of an empty line at line 3, that makes a difference. Empty lines won't reset the indentation level, which is arguably a good thing, since otherwise adding a blank line in the middle of a function would confuse indentation.\n. Long middle click for me (Ubuntu, both Chrome and FF) does absolutely nothing. Which browser do you use?\n. This really appears to be dependent on something specific in a system. On my Ubuntu 13.10, with Chrome 36, I can not get it to happen -- the reproduction instructions are pretty simple, so I doubt I'm doing something differently from you.\n. Which window manager are you using? I never knew a long middle click does something different from a short one -- at least, on xfce/xmonad/anything else I'm familiar with it doesn't.\n. As for installing a separate linux in order to repro, no, this issue doesn't seem that critical, and as far as I know you're not paying for support, so that's just too much work for too little effect.\n. As for installing a separate linux in order to repro, no, this issue doesn't seem that critical, and as far as I know you're not paying for support, so that's just too much work for too little effect.\n. Let's move further discussion to #2384\n. The attached patch should fix this. It removes some code that was contributed and I obviously didn't look at closely enough.\n. @mightyguava Awaiting your comments.\n. All right. Merged!\n. Thanks for fixing that! Merged as 764bad7\n. I don't think anyone is working on this anymore, no, so if you want to\u2014great!\n. Another thing I noticed is that try isn't handled very well (try re-indenting the example code in mode/erlang/index.html by selecting all and pressing shift-tab.\n. Good idea. Merged.\n. @mightyguava This is indeed vim-specific. The beforeSelectionChange handler ends up producing an undesirable effect in this case.\n. > Is there a workaround for this?\nYes. Call .refresh() after resizing the wrapping container.\n. Adding the cm-strikethrough style is fine (this one won't need to be overridden by themes, so it's a low-maintenance extra style). I'm not concerned about the tests being full sentences -- if anything, this is more likely to catch problems (such as #1893) than the minimalist approach.\nBut yes, support for nested styles inside of such spans is important.\n. (@bfrohs Ping.)\n. Solved by 865bfc8\n. When new addons are added, they are sometimes not documented yet because I'm not sure I want to keep them around. scrollpastend is such a thing -- I'm not sure it'll stick around.\nBut then, I often never get around to actually adding the docs. Thanks for pointing these out. I've added documentation for the other addons you list.\n. Thanks for the fast turnaround! Merged.\n. Not sure about the (comment ...) form. Sure, it'll be treated as comment by the standard macro, but it is also a regular form. (It might be quoted. And I assume you can shadow standard macros in Clojure?) The reader macro would be good to support.\n@hans @raynes @nbeloglazov You've worked on the Clojure mode before. Any of you interested in tackling this?\n. @Gozala I'd prefer some approach that styles them as simply \"comment\" by default, since the concept of fading is not something that's part of the default themes -- but feel free to add enough classes to also enable that use case for people doing custom styling.\n. I'm going to close this. Patches welcome, but it doesn't seem all that critical.\n. Nice. A few comments:\n- Why do you use new RegExp syntax instead of (less backslashy) RegExp literals?\n- Why split single/double/triple operators and delimiters when they are just going to be used in the same way?\n- Could you take care of the linter errors? (See https://travis-ci.org/marijnh/CodeMirror/builds/12854965 )\n. Merged.\nThe lint error you see is a missing semicolon. After fixing that, a few more came to light -- see attached patch.\nI've also simplified the regexps, since matching a single one is both faster and easier to understand than somehow categorizing them by length.\n. The speed hit won't be big. I'm not sure if those separate regexp serve a purpose in the Python mode. They didn't in this one (and in the Clojure mode which I simplified in a similar way last week), and it just seemed like needless complexity.\n. I've added the script tag in a6a3292. Not sure where to document this -- the docs for the Tern addon are somewhat minimal in general at the moment.\n. Merged. See attached patch \u2014 it wasn't just the semicolon. You can, if you have node installed, run bin/lint to run the linter locally.\n. Good idea. Merged as 02f4947\n. Nice. Could this be a generalized PEG mode where the language to fill in within the braces is configurable, or do PEG implementations in different languages also have syntactic differences outside of the braces?\n. I see. In that case, I've renamed the mode pegjs (see acb16d4) to prevent future confusion with other PEG dialects, and merged it. Thanks!\n. Thanks! Merged.\n. You could use the 'builtin' style for those. Don't highlight them the same as keywords.\n. Merged!\n. Agreed. Merged as 32d7db0\n. Note fallout in issue #1910 and followup change in 759b3a0\n. The pre elements are regenerated all the time, so setting their properties isn't going to give good effects. You can set a style on the wrapper element (.CodeMirror), that sticks around and all the code elements will inherit their font size from there.\n. Must be some CSS conflict. See if something is setting the font-size of the pre element (or one of their ancestors) the CodeMirror editor, and override it to use font-size: inherit instead.\n. See http://codemirror.net/doc/manual.html#setOption . Pass it \"lineWrapping\" as first argument.\n. Reverting to the mode's start state in such a situation might be sensible -- it's more likely to be a safe 'ground' state than whatever happened to be current when the length limit was reached. What do you think? I'm wary of the idea of complicating individual modes to handle this edge case.\n. Depending on the mode and the things that are in the line, tokenization can be expensive for a long line. In the case of a long data url in CSS mode, probably not. But turning this on in general will, I expect, make editing long lines even more horribly sluggish than it already is.\nWill think about this a bit more.\n. Would an optional (safely ignored) argument to startState, that can be a string (the next line) to indicate that the state is being created for a line not at the start of the document, work for you?\n. @peterflynn That's an extremely good idea. I'm not 100% sure there won't be a noticeable performance degradation in weird cases, but I've implemented it in attached patch. Please test! \n. With readOnly=true, this is the intended behavior -- you can still focus the editor in order to select things, and focusing involves being part of the tab order. For readOnly=\"nocursor\", it was indeed a bug. The attached patch should fix that.\n. Thanks for bisecting this to a specific commit. That made it easy to figure out the problem. Should be better with attached commit.\n. Looks good. Thanks for fixing that. Merged as 65c750e\n. There are no special characters in the text you pasted -- it probably got cleaned out somewhere along the way (clipboard, browser, github, who knows). Could you upload the raw file that is giving you the problem somewhere, and give me a link?\n. Yes, this is a known issue -- IE will enter some pseudo-standard bogus mode when you give it a doctype like that. This is why <!doctype html> is recommended at http://codemirror.net/#browsersupport\n. This doesn't happen in the demos, so it'd be helpful if you could isolate a minimal HTML file that shows the issue (installing your app and trying to dig through it to figure out the source of the problem isn't really effective use of time for me).\n. @nesl247 What you are seeing is a different bug. That one should be fixed in the v4 branch, and probably won't be fixed in the 3.x series at all (it is one of the motivating reasons why character measurement was overhauled for version 4)\n. But then, to be consistent, the events caused by regular (character input, as opposed to key bindings) typing would also have to be stopped (which I don't see a sane way to implement). I can see your point, but people may be relying on the current behavior, and the result wouldn't be all that elegant either, so I don't think I will merge this.\n. Did you figure it out? This use case was one of the motivations for the addOverlay feature, but I never actually tried to implement it. Would be interesting to see whether it works.\n. Great. Thanks for the update.\n. I don't see the problem. When stream.next() starts returning undefined, you know you're at the end of a line, so if you saw a word right before that, you check that word.\n. You can't do that from a mode. You'd have to write this in another way (track changes, look at where the cursor is, mark invalid words with markText).\n. Indeed, when you type in the middle of an existing attribute it didn't handle it correctly. Try with attached patch (which also adds single-quote support).\n. <tag attr=\"\\\"\" everything-else-here-is-incorrectly-marked-as-a-string=\"and-this-now-isn't!\"\nXML does not use backslashes to escape quotes, so no, it would be silly for the XML mode to do something that XML does not.\n. The problem happens exactly the same without CodeMirror. </textarea> obviously ends the outer textarea. Look into HTML escaping.\n. @bfrohs I'd make this configurable (using the parser configuration), so as to not generate too many separate tokens in situations where people aren't using it. Other than that, yes, it seems like a useful addition to the markdown mode.\n. @bfrohs Any obvious fix that comes to mind?\n. This hasn't been discussed publicly yet, but yes, I do have it in mind. My idea was to put a generic wrapper around all the files (such as in the tern codebase 1) that allow them to be loaded in a commonjs or amd environment, or in the old-school 'claim a single global' way.\n. The v4 branch now exists, and has a module-loader shim around all modules. Should be easy to set up your own loaders to work with it.\n. I'll rebase the v4 branch on top of master (v3) until it is properly released, so yes, it will contain features added to v3. Whether you want to go production with it is your call -- it contains a lot of new code that obviously hasn't seen as much use as the old code.\n. No one has written a code folder for Lua yet (and it works differently from the languages that folders do exists for). I don't consider this a bug, so I'm not leaving this open, but I would be happy to review and merge a pull request that adds it.\n. Indeed. Basically, someone has to write a fold function that understanda Lua-style blocks, and then the lua mode needs to refer to that folder's name. (It might be possible to write one that works both for Lua and Ruby)\n. Thanks. Merged as a8c5cfb\n. Good call. Merged as 36b887d\n. @bfrohs Do you have time to look at this? Maybe the mode needs some fundamental rethinking? (When similar issues keep popping up, it's often a sign of the underlying assumptions not quite holding up)\n. Likewise. Closing this until further notice.\n. I've merged Peter's fix (464dd7b).\nAnd yes, the mode has problems. At some point, I hope to add support for a Less dialect to the CSS mode, so we don't need as much duplicate code.\n. I see where you are coming from, but I disagree. There are a whole lot of places where the editor code accesses mode code, and I don't like the idea of wrapping them all in catch-log-and-forget clauses. It's also unclear why we'd stop at modes, and not do the same thing for plugins, and for client code. Mode errors should be fixed, and once something starts failing silently, fixing is usually forgotten.\n. Closing an issue, in my repos, means 'I'm not taking any more action until further information comes in', not 'discussion closed!'. It helps me use the open issue list as a TODO list. So yeah, further comments are always welcome.\nThat being said, my main problem with the proposed solutions is that they'd involve adding dozens of try/catch blocks to the code, which make the code bigger, uglier, and harder to read, not to mention slower (since these will either sit in the middle of one of the most performance-critical loops -- tokenizing -- or be wrapped around whole functions, in which case the issue of overbroad catching becomes a problem).\n. Merged as 464dd7b\n. That one's also there -- see 8c42f651f15b6b\n. Thanks. Merged as 977c64f \n. What is composer, what would this file look like, and how would it help?\n. I'm sorry, but I'm going to resist this. The amount of files we can have in the root of the project without becoming a complete mess is limited, and we're already pushing on it. I'm only barely okay with catering to the needs of JS-specific package managers. Other language are out of scope. Just do whatever needs to be done manually, in your own build process.\n. No code in the CodeMirror distribution handles file extensions, so you're probably reporting this in the wrong place.\n. Attached patch should help for this particular issue. But I did some testing and there's a lot of other issues. It seems the person who contributed this mode did not spend a lot of time thinking about indentation. I'll leave this open and will hopefully find more time to work on it soon.\n. Thanks, but you introduced a few new mistakes (killing logic without reintroducing equivalent logic is bound to break something). See my follow-up patches 47a3734c3286 and 5b875f598e94ee4 . Please see if the result works for you.\n. toggleOverwrite was already documented, and triggerOnKeyDown is intended only for testing purposes. But indeed, execCommand should be documented. See attached patch.\n. I agree, and there are a bunch of other issues with the way scrolling things into view is currently handled. I am somewhat afraid to touch this (since it tends to have extremely subtle effects), but I am planning to rewrite the forced-scroll handling part for version 4.0 (which will happen somewhere in the next few months).\n. Attached patch (on the v4 branch) fixes this. It won't land in v3, but 4.0 should be out soon. Closing this.\n. Nice. I've made a few changes to openNotification in 598648f13032852b285cec6509e3c7930e15d437 , and merged this.\n. Thanks! Merged.\n. Thanks! Merged.\n. I would prefer if you could base this on the existing htmlmixed mode, so that all that code doesn't have to be duplicated.\n. That works fine in the demos. So it must be something related to XULRunner. Can you provide a minimal, self-contained demo that triggers this?\n. You can run the indentAuto command (bound to shift-tab by default) to reindent using the mode's indentation algorithm. There's also the electricChars feature, which doesn't seem to be used by the SQL mode, but which causes reindentation on } in c-style modes, for example. Try with\nCodeMirror.extendMode(\"sql\", {electricChars: \")\"});\n. The characters <? will switch the mode to PHP. I'm not knowledgeable about the obscure set of rules that the PHP parser uses, but I do believe it will also spot such characters in script tags.\n. Attached patch should fix the coloring of < (was a bug in the htmlmixed mode).\n. Thanks. Merged.\n. Do we need '(' in there? It looks like reindentation only needs to happen when ')' is typed.\n. Great. Merged as 51d6810\n. Yes, you're not allowed to back up beyond the token you are currently parsing. This is by design.\n. undefined is given where? I'm afraid you didn't really explain what you are doing very well.\n. I suspect that it's returning \"\" instead (since slice is called with a second argument lower than its first argument). But yeah, just don't do this.\n. Yes, that's what I meant. The part before the current token was already used for the previous token, it can't also be part of the current token.\n. Thanks. Merged, with attached patch to clean up some style issues (whitespace and quote conventions, don't make things methods when they don't need access to an instance, and don't add 'defensive' tests when they aren't needed).\n. Thanks! Merged as e327d2f . The shrinking effect as you're typing '#' characters in the variableheight demo is downright beautiful.\n. Looks good. Merged as 1013ebb\n. Merged.\n. Indeed. Thanks. Merged as 2c55303\n. Looks good. Merged as 1108748\n. Hah. Coincidentally, I was just in the process of working on ES6 support. I fortunately hadn't done for/of yet. Merged!\n. I think this is the same as #1913 (wrapping of visible text disagreeing with the point where CodeMirror believes the wrapping happens). Or isn't it?\n. Okay, I see. Different bug then.\n. This is almost certainly fixed in the v4 branch (though there are, at the moment, some other problems in that branch). I suspect I won't get around to fixing this in the 3.x series. Very sorry. Wait for a stable 4.0.\n. Just wanted to confirm that I saw this, and agree with the general idea. But I'm sort of worried about the cookie cutter duplicate files that are growing in addon/hint/, and think a solution where the completion-from-word-list functionality is built into show-hint.js, and languages can register their own word list, would be preferable. Also, modes already have lists of keywords and, often, builtins, so it'd be nice if those lists could be reused. Something with defineHelper, but extensible. Whatever I end up doing, it'll probably end up in the v4 branch, since it'll involve backwards-incompatibly dropping some of the old hint addons.\n. This functionality is now present as part of 88d1326b54a7bbf131c15cdc3cdcf50e13192a3f (without an additional plugin)\n. Interesting. Something like this is certainly useful. See also previous work in this direction at https://github.com/mozilla/skywriter/wiki/Common-JavaScript-Syntax-Highlighting-Specification (and the CodeMirror v1 implementation at https://github.com/marijnh/CodeMirror-old/blob/portable/js/portable.js).\nI am curious what you come up with for indentation. That's usually the trickiest part of implementing a language mode.\nThis is not a CodeMirror issue as such, though, so I'll close it. (Others may feel free to add comments.)\n. I believe attached patch will solve this.\n. I expect attached patch will help.\n. Thanks. Merged as bd374ef\n. Looks good. Merged as 4426841 (with a slight change -- a more idiomatic string test)\n. Woops. Forgot to update a call to setSelection. And made a few other mistakes that I never tested because I haven't found a sane way to automatically test the context menu. 64849dd should help.\n. Thanks. Merged as 8e2454a\n. The old copyPos was there only to guard against client code modifying the Pos object it got. Originally, this was done throughout the API, but that got increasingly awkward (when the positions are in nested objects) so it was abandoned and the current policy is that you're just not supposed to modify them.\nThe editor code itself should never modify a Pos object it didn't create / doesn't own. If you can reproduce a situation where it does, let me know, since that'd be a bug.\n. This is an intentional exceptional case (first if in updateDoc) that tries to make it so that if someone pastes or deletes a 'block' (a number of full lines), the line handles (with associated styles, gutter markers) move the way it is -- usually -- intended. I.e. if you have a breakpoint gutter marker at line 10, put the cursor at the start of line 10, and paste a few lines, the breakpoint will move down below the pasted lines.\nThis is usually not noticeable. But it appears you are creating your own line numbers (why?), which will indeed cause the resulting behavior to be inconsistent.\n. I'm not 100% sure whether the original behavior is sane, but it seems to work for most people, so yes, an option is a  suitable workaround. See attached patch.\n. Attached patch (on the v4 branch) fixes this. It won't land in v3, but 4.0 should be out soon. Closing this.\n. Good point. See attached patches (where I first export it on CodeMirror and then change my mind and make it a method on line handles instead)\n. Looks good. Merged as 9aa2240 \n. Works for me when isolated. Here's my test file:\n```\n<!doctype html>\n\n\n\n\n1\n2\n3\n4\n\n  var cm = CodeMirror.fromTextArea(document.body.getElementsByTagName(\"textarea\")[0], {\n    lineNumbers: true\n  });\n  var w = document.createElement(\"div\");\n  w.innerHTML = \"I, widget\"; w.style.background = \"yellow\";\n  cm.addLineWidget(1, w, {above: true, coverGutter: true});\n\n``\n. I'm still not going to be able to fix it without a clean way to reproduce it.\n. Thanks, that helped. Attached patch should fix it.\n. Implemented in a slightly different way aswholeLineUpdateBeforein attached patch.\n. Thanks! Merged as bdd8871\n. Indeed. Thanks for fixing that. Merged.\n. Indeed. Should be better with attached patch.\n. Looks sane. Merged.\n. @ForbesLindesay Want to take a look at this?\n. Fixed by 28a638a (I hope)\n. This is what electricChars does -- it reindents the current lines by automatic indentation when you type one of them. You can turn it off by setting theelectricCharsoption to false.\n. For me it doesn't. Please provide a full example of a file in which a line gets an indentation that you didn't expect.\n. Looks good. Merged as 3e84b9e\n. Added to https://github.com/marijnh/CodeMirror/wiki/Mode-wish-list . But I don't keep issues open for feature requests like this\u2014they'd cause too much clutter in the tracker.\n. Looks good. Merged as 28a638a \n. Thanks. That was an easy fix.\n. Known issue (#1022). I'm trying a possible solution for v4, but it's not looking very hopeful at the moment.\n. The degree to which long lines still work halfway responsively differs hugely between old (mostly IE8/IE9) and new browsers, so do some testing on the browsers you are interested in to get a feel for what still works.\n. Looks good! Merged. If more changes are needed, submit separate pull reqs.\n. Fixed by 268cc74\n. My thinking is that, though the library should work on IE8, I really don't expect many people to be looking at the website in IE. Attached patch makes things slightly better, but still leaves pages that don't includedoc/activebookmark.jsin a messed-up state (most mode demos). I don't want to add another script tag to all of those (that's a lot of pages) just for such a minor/ancient browser.\n. Um, patch meant is ed26d5a\n. This introduces a syntax error in vim.js (missing paren on line 3255), and, once I fixed that, causes two tests to fail on Chrome (vim_ex_substitute_confirm_emptydoc and vim_ex_substitute_confirm_nomatch).\n. Excellent. Merged.\n. Good idea. Done in attached patch.\n. Ah, someone is still using these modes. Interesting. Merged you patch. Note that in the v4 branch, both rpm-related modes are now in mode/rpm/rpm.js, to conform to the file structure of other modes.\n. Makes sense. Merged.\n. Oh, this is actually quite bad. Just playing with it I uncovered several bad side effects of cdf5522 . I'll look into it later.\n. Attached patches should make this better. The first fixes the problem of spans unintentionally sticking around when empty (you now need an explicit option for that), as well as some other dodgy behavior of spans. The second fixes the actual bug.\n. Probably something went wrong with putting the focus in the hidden textarea, but without an example to reproduce it, I can say much more.\n. I couldn't reproduce this with the current code. Try again with 3.20 please.\n. I can reproduce this when I add theheight: autorule. The problem is related to the automatically changing height of the editor causing a bogus scrollbar during line height measurement because the gutter height isn't updated yet. Attached patch seems to solve it. Please test.\n. Did you try with version 4?\n. Heh, see the patch I pushed a few minutes ago in response to a different bug report: 3e710f9\n. Thanks. Merged.\n. Thanks. Merged.\n. The problem appears to be that you are trying to fold a line that doesn't exist (there are 8 lines in the example, so 7 is the last one)\n. Well, the call in your demo is hard-coded in the script tag. If you can show a situation where the folding addons make such a call, I'd be very interested in that, since it would indeed be a bug.\n. Well, you'll just have to fix your code to provide valid line numbers to the addon.\n. Makes sense. Merged as 6907aaf\n. I'd prefercompleteOnSingleClickas an option name, and how about you just check the option in the click handler, so that you don't have to shuffle so much code around?\n. Thanks! Merged as e9d63b1\n. Attached patch probably makes a noticeable difference. The activeline addon was seriously suboptimal, not even usingoperationto batch the changes it made. I'm getting a ~3\u00d7 speedup with the patch, for a benchmark where I just move the cursor over a document withstyleActiveLine` enabled.\nWe could be doing even better, if the update model for lines was more fine-grained than 'redraw' vs 'don't redraw'. I have some half-baked plans to improve that in v4, but that's a rather subtle project, and I can't promise that I'll find time for it any time soon.\n. Great. Closing this (though I'll keep further optimizing class shuffling like this in mind when I'm tinkering with the v4 branch)\n. Oh, right, you really can't assume anything about characters. Please try with the attached patch.\n. There is the defaultTextHeight method to get the height of an unstyled line, and you may access the height property of line handles, though you should put them through getLineHandleVisualStart first to make sure you're not accessing a continued line after a collapsed range (in which case height will be zero).\n. Thanks! Merged as b6efcb9.\nWas 20422a1 supposed to be in there? Does it do something different from the existing test-selection mechanism? (try http://codemirror.net/test#vim_* or http://codemirror.net/test#vim_p )\n. I'd much prefer if you'd extend the existing mechanism rather than invent a whole new one. People are using the existing thing, so just dropping it isn't an attractive option. It seems that with a tiny extension (case insensitivity can be added without breaking anything, and inventing a syntax for matching any substring shouldn't be hard) it can be made to do what your thing does.\n. Also, yes, separate features in separate pull requests please.\n. Fixed by  d986b30.\n@Leonya Sounds like you have a different problem. If it isn't related to failing to call refresh(), build a test case that reproduces it, and submit another issue.\n. Could you describe the actual bug this is trying to fix?\n. @AndreyNikitin The right-hand editor in the merge demo is read-only, so the fact that you can't type into it is entirely by design.\n. I only have IE8, 9, and 11 around right now, but none of them shows this problem.\n. Well, I have IE10 running again (10.0.9200, on a 32-bit Win7), but I can not reproduce the problem in that either.\n. CodeMirror never references JSON, so this is a jsbin bug, and since the jsfiddle problem is different, that's unlikely to have anything to do with the JSON problem. Try to report this to jsbin/jsfiddle instead.\n. Yep, I missed a dependency. Should be better with attached patch.\n. Only if you are including the files manually with script tags and forget to include the overlay mode dependency.\n. No, this won't be part of CodeMirror (though I guess someone could write a wrapper around it that handles this). It'd require css munging and trickery of a type that I don't want to put in the core.\n. See my comment there. It's just not viable to constantly sync the textarea for performance reasons. You could arrange to call .save() at a strategic moment to (maybe) work around this, but it's tricky.\n. Maybe by reading the manual? http://codemirror.net/doc/manual.html#option_lineNumbers\n. This is not going to happen. When you have a large document, updating the textarea on every keypress is extremely expensive, and is going to kill responsiveness. \n. You can wrap a mode in such a way that it only sees the part of lines after the initial indentation. And you can wrap its indent method to add N to its output. Though I guess one problem there is stream.sol() not ever reporting true for the inner mode. Would a workaround for that give you what you need?\n. Could you see if the attached patch works for you? It adds a hideFirstChars method that you pass a number of characters and a function, and runs that function with the stream in a state where the first n characters are 'hidden'.\n. Wonderful.\n. Do you have a benchmark that shows a significant speedup from this?\nSee also http://jsperf.com/fastest-array-loops-in-javascript/101\n. The jsperf shows the non-caching loop to be faster than the caching ones. All modern JS engines do loop invariant code motion. I don't know what \u201cJavaScript time is not accurate\u201d is supposed to mean, but if that's supposed to moot the jsperf timings, then I can't really take it seriously.\nAnd don't get me started on \u201cbest practices\u201d. Optimizations without benchmarks are pointless, and often harmful.\n. The article you link was written in 2008. jsperf's benchmarking approach is quite sophisticated.\nThe jsperf page I linked does not agree with your patch. In all browsers I ran, including IE11, the basic loop (no cached length) comes out as the fastests. On IE8, the benchmark page just crashes, but then, IE8 isn't an important target anymore anyway.\n. If you make an 'optimization', the burden of proof that it is actually helpful lies with you, especially when I have good reasons to believe that it won't help at all.\nYes, the existing loops that cache length will probably be simplified at some point, when I get around to it.\n. This looks sane. IE7 isn't supported anymore by CodeMirror, anyway. Merged.\n. If I paste your second example in the Ruby mode, everything except the x is colored as string, which seems correct. If I type more text after it, that's not considered part of the string.\n. Great. Thanks for the update.\n. The effect occurs because the rest of the document is being highlighted as JavaScript. The content is invalid, so I'm not sure why the highlighter would be expected to sanely parse it. I could add a special case for this situation, but you'll still see the same effect if you have an opening <script> tag without a matching closing tag.\n. My previous diagnosis was actually off -- what happened is that the whole script was parsed as being inside the tag, and then the > at the end of the closing tag was taken to be the end of the opening tag, causing the part of the document after the closing script tag (or after any other tag following the unfinished open tag) to be treated as a script.\nFixing this prompted me to simplify another part of the xml mode. Attached two patches should solve the issue.\n. That is not valid JavaScript. Enable JSON mode if you are working with JSON, it'll solve the problem.\n. > Why is that not valid JavaScript?\nWell, try to run it. \"SyntaxError: Unexpected token\", is what your JS engine will tell you.\nYes, it's likely you'll have something like this in your file during editing. But you can't expect the auto-indenter to work on invalid programs.\n. > if you check what node does\nThat's bizarre. It should be using the same parser as Chrome. Not sure what's going on there. It even treats {a: 1}, which is also a valid block, as an object literal. Probably some magic in the repl -- it doesn't happen if you run a file that contains such code.\n\nWhy not keep the indent level the same if the program is invalid?\n\nIt's seeing this:\n{  // block being opened\n  a: 1, // statement with label a, then the expression 1 followed by comma operator\n    b: 2 // a continued statement, indented relative to the start of the statement\nIf you have x = x + \\n 1, you definitely don't want to align the 1 with the first x, and to CodeMirror's parser, the situation above is equivalent.\n. Scanning ahead is relatively easy to add (see attached patch), though it does incur a dependency on the addon/fold/xml-fold.js script (the new behavior is only added when that file is loaded). As for more global heuristics, that's not the way CodeMirror currently operates (it doesn't build a global representation of the document, tries to only scan locally), and this is out of scope for the current closetag addon (though you could build your own addon to do something like that).\n. Async completion requires your completion function to call the callback when it finishes loading the completions. As described in the manual (http://codemirror.net/doc/manual.html#addon_show-hint).\nAlso, unless you're also prepared to offer hefty sums of incentive money, don't even bother saying \"please reply as soon as possible\". I'm not going to, and you're in no position to ask.\n. Looks good, on the whole. But please use conf.indentUnit (which is what all modes use for such kind of indentation-size decisions) rather than parserConf.hangingIndent\n. Great! Merged as fe9107e\n. If I follow your instructions in Chrome or FF, I don't see anything going wrong (the code gets colored, and the editor keeps working).\n. @RaymondLim That was what I did before (replacing the content of the editor), but I still can't reproduce this.\nThe backtrace in the linked issue makes it pretty clear what went wrong there. Attached patch should fix this.\n(At some point, someone will have to write a new Less mode, the current one is shoddy. Such a mode could probably be done as a specialization of the CSS mode, which already handles SCSS.)\n. Well, that works for me too now. Did my change (attached) fix it?\n. Indeed, electricChars should be moved to be a helper value, so that it's taken from the inner rather than the outer mode. This'd be an incompatible change though, so it'll have to go into v4. I'll look into it when I have time.\n. See attached patch, I've reconsidered the incompatible part (it's unlikely to work worse in any situation). \n. Hi Peter,\nThe amount of bugs coming up in the Less mode, in combination with the general look of the code, and the fact that it's doing something very similar to the SCSS mode, make me feel that it'd be a better idea to invest in integrating the two rather than continuing to pile hacks on top of the existing code.\nI've just created a branch css, which adds a Less dialect to the mode defined in mode/css/css.js. Could you check that out and tell me if you notice any important features that are missing? The styling is different from your mode, since it tries to be similar to what the CSS mode is doing.\n(I know you've put a lot of work into this. Which is appreciated. But I think the direction I chose is going to be easier to maintain.)\nBest,\nMarijn\n. Could you describe the use case?\n. Doesn't visualLine (as used by the active-line addon) serve your purpose better? It returns the first non-hidden line before a given line (or the line itself, if it's not hidden), which is precisely what you need when you are trying to style the line that includes a given position.\n. Ah, right, yes, that's what I meant.\n. I can't make much of that vim terminology. Can you describe the problem in terms of CodeMirror concepts?\n. @Dominator008 How about a visualNextLine function that gives you the line after the visual line that the line handle or number you give it is part of?\n. Mode-specific options are passed as properties in a mode specification in CodeMirror (see for example the way the JavaScript mode can be configured to parse JSON or TypeScript). Accessing the editor from a mode is not supported and probably not the right way to go.\n. indentLine is  implemented on top of the mode, it doesn't make any sense to me why a mode would ever need to call it.\n. Must can not (and must not) change the document. They are only there to color it and provide further metainformation. Your messages suggest you don't really grasp the way they work yet.\n. Indentation is run on the line that's actually being indented. If you need to know something about the previous line, keep state.\n. So when do you want to trigger the reindent?\n. You can't use electricChars in this way, no. What do you mean by \"goes\" to the next line? By pressing enter? By cursor motion? In any case, no this isn't something that currently exists (and sounds like a bit of a bad idea).\n. You can pass a reference to your editor instance as a parameter to your mode, if you really want to. But most of the things that you can do with an editor you really should not do from a mode, so this is rarely a good idea.\nYou can't get the current line number and you won't ever be able to get the current line number because the way modes work, their output can be reused even as lines shift up and down in the editor. You can keep a counter in your mode state counting how many lines it has seen, but this isn't guaranteed to correspond to the actual line number of the parsed text.\nFiguring out the start of the file is easy. Just set a flag in your starting state for the mode, and clear it the first time the token method is ever called on a state.\n. > It is good that one can use the startState to signal SOF, but is it actualy correct?\nIt is, if you do it right. First, read this blog post so that you know what's going on. You can have startState return something like {sof: true}, and then, whenever you read a token, update your state state.sof = false so that you know you're no longer at the start of the document.\n. So clear the start-of-file flag only at the end of the first line, if you need to know when you're on the first line. Or if the conditions are more complex, write your code to clear the flag after reading the appropriate token.\n. I am not convinced testing for odd implementation details is more robust than looking at the agent string. It definitely doesn't qualify as 'feature detection' -- feature detection involves testing for the actual features you need, whereas the hacks for which we are using these variables are the ones where feature detection doesn't work (incompatibilities that are expensive or impossible to test for).\n@peterkroon The opera variable indeed enables the Presto hacks. For Blink-based Opera builds, the fact that Webkit/Chrome is detected is intentional (and causes all tests to pass).\n. Looks sane. Merged.\n. Thanks for noticing that! Merged as 06cfa38\n. Attached patch should help.\n. Thanks. Merged as 5deae0c\n. Do you have any other software that behaves the way you describe? For me, textareas do what CodeMirror does.\nI'd be open to collapsing the selection to the top (for up) or bottom (for down), the way the left/right keys currently work. But collapsing and moving in one shot doesn't seem sensible.\n. I see. Linux textareas behave like CodeMirror currently does. Well, actually, some do, others behave like CodeMirror's left/right keys work (collapse to the relevant end of the selection).\nWould you be happy with that last behavior (select 2-4, press up, cursor is before two, or press down, cursor is after 4)?\n. Implemented in attached patch.\n. Fixed by febe3ac\n. Thanks, merged as febe3ac\n. I'm pretty sure this must have been due to a mistake in your code. The event names are treated as opaque strings. Here's a transcript of a test I just ran:\nvar x = {};\nCodeMirror.on(x, \"foo:bar\", function(a) { console.log(\"fired\", a); })\nCodeMirror.signal(x, \"foo:bar\", \"hi\")\n// output: fired hi\n. Any error messages? It seems to work fine for me (everything is auto-indented). Does this happen for other languages?\n. Ah, never mind, now it did happen for me (?). Debugging.\n. That should help.\n. Wow, you really have a talent for finding corner cases. See attached patch.\n. I've changed the way the mode handles indentation in the attached patch, and rewrote the way mode tests test indentation in the process (so that it is actually useful enough to catch things like this). Let me know whether it works for you.\n. There are no tabs anywhere in sight. Do you mean 4 spaces? That's what I get when I do what you describe -- 4 spaces, which is 2 indentUnits.\n. What works well for me is to enable the \"Disable cache (while DevTools is open)\" option in devtools, and always have it open when testing.\n. You'll have to add a tokenizer function (like tokenLongComment), and switch to that (by setting state.tokenize) when parsing a multi-line string.\n. Thanks! Glad you could make sense of it. Merged as 72f01e8\n. I've never heard of NuGet before, and I don't maintain that package there. You should probably talk to the person listed as 'owner' of the package -- http://www.nuget.org/profiles/tim_morris/\n. I can not find a single reference to countColumn in the mode/ subdirectory, so I'm going to assume you were doing more than loading and running modes...\n. Can you reproduce it in any of the demos on the codemirror.net website? Your code is completely standard, so it doesn't give us much to go on.\n. Yes, this is known -- only html5 doctype works. For other doctypes, IE enters some bizarro semi-standards mode that has a bunch of incompatibilities. See http://codemirror.net/#browsersupport\n. Great. Merged.\n. Thanks. Merged.\n. \"wrap\" classes shouldn't influence the layout of the text, since they won't be present when measuring. Use a \"text\" class instead, that should wok (it'll always be applied to the <pre>).\n. This was done because, if a subsequent change is combined with the current top undo event, it won't be possible to undo back to the given generation.\nBut thinking about it some more, I feel that that's actually not usually a practical problem. So I've added an argument that controls this behavior to changeGeneration, and made the default to not close the event.\n. Okay, I should probably know this, but how does the vim mode prevent readInput polling when not in insert mode, again?\n. Ah, right disableInput. I guess it'd make sense if turning off disableInput cleared the textarea.\nWould it be workable for the vim keymap to listen for paste events (also for when people select paste from a menu), and switches to input mode when one occurs?\n. Is the problem that the keymap from the closebrackets addon should only be active when in insert mode, or is that not it?\n. So no, I don't know of an easy way to fix this. Core CodeMirror doesn't have a concept of modes, and the two addons that are interacting badly here (vim & closebrackets) thus don't have any shared terminology to describe a solution in.\nAny suggestions?\n. This is not the effect I'm seeing -- for me, using .CodeMirror pre { padding-top: 10px; } simply causes the cursor to be taller so that it takes up that extra space.\nOr are you manually setting the padding on an individual DOM node inside the editor? If so, yes, that's not supported.\n. Setting singleCursorHeightPerLine to false might get you the effect you want. When that is true (the default) the text is assumed to be more or less the same height as the surrounding <pre> element.\n. Thanks! Merged as d84acac\n(Github won't notify me when patches are added, so when modifying the branch for a pull req, it's usually a good idea to also add a comment.)\n. Seems that the mode always returns CodeMirror.Pass when in the top context. @santec What is the logic behind that? Would returning 0 make sense?\n. Fair enough. I'll feel free to butcher it, then ;)\n. See attached patch, does that help?\n. I've reconsidered this, and concluded that the old behavior is actually more sensible (given that the mode doesn't do any intelligent indentation, it might as well just leave the existing indentation alone). So attached patch goes back to returning CodeMirror.Pass.\n. @santec Do you want to take a look at this?\n. How about now?\n. Press shift-tab on the last line (SQL mode doesn't designate ')' as an electric char).\n. Thanks. Merged.\n. You're setting an integer option to a string. Don't do that.\nWhat was the original pull request supposed to accomplish?\n. Look at this demo: http://cm/mode/htmlmixed/ . It has a a <style> tag and works fine. I suspect the problem might be in your code, not CodeMirror.\n. (See my direct email)\n. Maybe you are talking about something like addon/scroll/scrollpastend.js?\n. Why not just listen for the event on the wrapper element?\n. Right, scroll events don't have a delta. Try something like this:\nfunction myHandler(e) { console.log(e); }\nCodeMirror.on(editor.getScrollerElement(), \"mousewheel\", myHandler);\nCodeMirror.on(editor.getScrollerElement(), \"DOMMouseScroll\", myHandler);\n. Close over it (move the function into the defineOption  body, remove its cm argument)\n. How about simply defaulting to something, say \"x86\", instead?\nEdit: to clarify, my reasoning is that that way, people who are using the mode in a crude way (for example by simply loading all modes automatically based on mode/meta.js) will still have something that mostly works.\n. That sounds like it might work. Are you willing to do the rewrite?\n. Thanks. Merged as d50ced6\n. No, this is intentional. The assumption is that the mode option has already been set to the correct mode spec (which can be more complex than a plain mode name -- it might be a mime string, or an object containing mode options).\n. Merged as f5b8e1000dc, with 9228a29 added to ensure the old behavior still works as before (_* suffix), and the 'i' flag is actually passed to the RegExp constructor.\n. Same for the vertical scrollbar, which some people want to put on the left.\n. Sure, merged!\n. I think attached patch should help. The mode wasn't exporting an innerMode method, so there was no way for the closetag addon to know that the cursor was inside HTML code.\n. Sorta. See http://codemirror.net/demo/indentwrap.html . It's a bit hackish, but so far it seems to work.\n. Odd, seems text-indent is inherited by child nodes. See attached patch for a workaround.\n. The atom part might be a holdover from back when the default themes did not have a quote style yet. It seems the quote style is not otherwise used by the markdown mode, so I agree that using that would make more sense. Probably for both quote levels.\n@bfrohs What do you think?\n. Your proposed solution sounds good to me.\n. Great! I've merged the patch as 03f2f33\n. variable-2 and variable-3 are standard styles in the CodeMirror themes. list-text-... isn't. So that's a reason for keeping the variable labels. I don't think conflicts should be much of an issue -- if you are writing an overlay, and want to use styles that stand out, you could use your own custom classes, right?\n. You mean JavaScript within a triple-backtick block? Or a different editor? But yes, there'll be overlap in the colors. I do not think this is a serious problem. Is it for you?\n. I am, with either proposed solution, somewhat worried about the class noise we're adding here. Being able to specialize styles for modes is often useful, sure. But then you'd also want to add those classes when the mode is not mixed, just to prevent weird exceptions when styling. Does anyone feel like benchmarking the memory and performance cost of adding a class to every single token?\n. @lukasoppermann Please see patch de66ee9 , which adds an option addModeClass that should make it easy to distinguish between tokens from different modes.\nWhich I hope will remove the need for more extra classes in the output of the Markdown mode.\n. I did not benchmark, but the additional DOM complexity is significant (things that used to be simply text nodes now also get wrapped in a span), so I figured making it optional was a good middle ground.\n. Attached patch should help with the problem you reported initially. The second problem I can not reproduce (I don't get any error highlights when I paste this into http://codemirror.net/mode/css/scss.html\n. You should be able to build this on top of the current API, no?\n. There's no concept of 'bold' in the CodeMirror core. So yeah, this is out of scope.\n. It would help a lot if you showed a minimal example of a script that triggers this error.\n. I've opened https://github.com/codemirror/codemirror.next/issues/29 to track this in the new architecture. I worked on this, but it caused only a ~25% speedup in the measuring code. The problem is that, since we allow all kinds of styling through css classes, the only way to know whether a line is 'pure monospace' is to look at its drawn dimensions, and verify that it has the expected size (and even that isn't 100% reliable -- if one character is 2px wider and another 2px narrower, the total will still add up). Thus, we'd have to do most of the work in advance -- build up a map of the elements that make up the line, in case it isn't monospace and we need detailed measurements, and force a layout by calling getClientRects.\nSo I don't think 25% is worth the extra complexity. Having two code paths for something, that fire in different circumstances, carries a serious risk for the less-used one to start bit-rotting. Giving up on this idea for now.\n. This is how it is supposed to work. Match it against a regexp if you want to check whether a given part is in there. className is a deprecated synonym of type.\n. Very clever. Merged as 462ca4c \n. I want to get rid of 'magic' properties on keymaps as much as possible. disableInput could be made a regular option (and thus queryable with getOption), and we could have addons check for it.\nOr, though I'm not entirely sure this is a good idea, changes labeled with origin \"+input\" could simply be discarded altogether when disableInput is on.\n@mightyguava What do you think about moving this to an option?\n. See patches 337e435328b92 and 58113e8a8945cfd . The first adds a disableInput option and moves the vim code over to it (@mightyguava please verify), the second should replace this pull request.\n. That if is needed for a problem that also occurs in IE11, so your proposed fix isn't a good idea. Do you have a test case that reliably reproduces this?\n. Ah, indeed, when the editor is hidden there won't be any rectangles returned. Could you try with the attached patch?\n. Thanks. Middle-click works for me. Merged and fixed-for-linter in attached patch.\n. See discussion in #1017 . You are using an ancient manual.\n. > The minus-sign work on my system will only work when I use the numpad.\n\nNumpad keycode = 109\nKeyboard keycode = 189\n\nStange. Both these keys are in the keyNames object.\n. Very odd. They do indeed appear to have changed the keycodes for those keys. This seems to provide some context: https://bugzilla.mozilla.org/show_bug.cgi?id=787504 . Still, not sure why they didn't just use the same code as other browsers.\n. If you have a list of these and their corresponding key codes, I'll happily add them.\n. Since we are already normalizing between numpad and non-numpad keys for the digits and enter (and, looking at the code, apparently also for num-equals and num-minus), I think we should continue that way and just map these to existing similar keys. The weird case is num-multiply, because * does not exist as a raw key. Attached patch goes ahead and binds it to \"*\" anyway, so that we have at least some name for it.\n. This adds a scan over all properties for each keymap scanned. How about just giving the function a name and binding all three properties to it?\n. But now this feature only works for extraKeys, not for maps added with addKeyMap or for base keymaps. Also, I like the fact that the maps are simply values that aren't modified or converted before they are used.\nI don't think this feature is worth the hassle.\n. Overriding builtin options is a bad idea, but you could define a different option with a new name that does something like that (by setting the existing option).\nKey presses will happen on a timescale of many milliseconds. Building up two tiny arrays is definitely not going to be noticeable on that scale.\n. Thanks! Merged.\n. If I, in my Emacs configuration, do C-space, move a bit, and then press M-W, move some more, and press C-W, the part between the current point and the old mark I set is deleted -- i.e. it does what CodeMirror currently does, but your patch breaks this.\n. M-W copies, C-W cuts, C-Y pastes -- but note that these use the mode's 'kill ring', not the system clipboard. The only way to paste from the system clipboard is currently through the context menu (since JavaScript can't access that clipboard directly).\n. Ah, that's a good point. In emacs, the 'selection' is typically invisible, so this doesn't bother the user. But in CodeMirror it is not so, and I guess clearing the extending flag on copy isn't a bad idea.\nMerged as 7b8b8b5\n. Does attached patch also solve the problem for you? It seems more in line with the surrounding code.\n. Indeed. I can reproduce this. I have no idea what might be going on, though. I can still type (some keys, for a while) after pressing ctrl-shift-u, but then it stops working entirely. The textarea is still focused at this point. If I un-focus and re-focus it, the problem goes away.\nI couldn't find any information about a default keybinding in FF for ctrl-shift-u.\n. Indeed, that's it. And it appears to work more or less as hoped (except that the underline isn't visible).\n. I don't suppose anyone is pressing ctrl-shift-u without intending to enter a unicode character. So what is there to fix?\n. See the attached patch for an alternative solution to the issue of styling tokens created by the HTML(/XML) mode. This way, it won't clutter up the DOM of people who don't need the extra classes, and it generalizes to other modes.\nIn general, yes, do create different pull requests for different features.\nIs the non-mixed Django mode ever useful, or would it make sense to just include it as an implementation detail in the mixed Django mode (and call that one django)? Every dir/file in the distribution adds a small maintenance overhead for me, and an installation overhead for people using the code, so if the separation isn't necessary, I'd like to just merge those.\n. There's a lot of duplication as it is between the two files. I think a better approach would be to write the mode so that it always has an outer mode, which can be either set to the null (plain text) mode, or htmlmixed, or even something else when templating some other language.\n(The same applies to the smarty mode, I guess.)\n. I think it'd be quite straightforward to build a Django (or Smarty) mode on top of addon/mode/multiplex.js, which already does most of the work required for this kind of mode switching.\n. Sorry, but I am not including any files licensed under a different license than the main one used by CodeMirror (MIT) in the distribution. If you can put this under that license, I'll gladly merge it.\n. Wonderful! Merged as d73e38f\n. Well, is it? As in, did you benchmark?\n. You aren't resetting the lastIndex on your regexp object, so I am pretty sure your code is broken. If you fix it, benchmark it against mine, and show at least a \u2153 speed increase, I'll see about changing the code.\n. Cool, I did not know that. Disregard my comment then. But I'd still like to see a speed comparison.\n. Find attached a patch which optimizes the addon. It's still slower than your code, because it allows the set of word characters to be customized, but a few ms for a completion request seems entirely workable.\n. That's a nice trick. This jsperf suggests it usually helps on Firefox too: http://jsperf.com/indexof-vs-lastindexof/3 . Applied in attached patch.\n. That should fix it.\n. Does the attached patch help? Set close to null (or leave it off) for your multiplexing config object, and it should do what you need.\n. > You see that the cursor is blinking which is incorrect.\nWhy is that incorrect? The editor is still focused (if I type, text appears), so it should have a blinking cursor.\n. Re-focusing the window causes the editor to regain focus, so the cursor should continue blinking.\n. I must admit that I can't figure out what you are getting at. Is there still a problem, or can I close this?\n. No. It has an influence on many, many parts of the core.\n. This is a case of CodeMirror's simplistic grapheme cluster algorithm not handling the language. Unfortunately, JavaScript does not provide the primitives needed to do sane cluster-boundary detection (finding character properties, etc).\n\nHappens with all non-latin complex scripts\n\nNot all. Some, like Arabic, should work.\n. To know how to move the cursor through a text, and which ranges of codepoints to use when measuring character positions, CodeMirror needs to know where clusters start and end.\nThe browser knows this, but doesn't expose this information to JavaScript. Telling me that what I'm doing \"will reach no where\" without actually understanding the problem isn't really the right tone to take here.\n. Attached patch fixes some known problems with handling of extending code points, and appears to help with #2125 (Hindi), but does not fix your example.\nI will need some input from someone who is familiar with this language's Unicode encoding, because the behavior of this string baffles me. Characters \"\u0d28\u0d4d\u0d24\u0d4b\" act as a single unit, as far as cursor movement is concerned, but only the second code point in that string is an extending character. If I read the document at http://www.unicode.org/reports/tr29/ correctly, this should count as three grapheme clusters, not one. What is going on?\n. By 'ask the browser' you mean create a textarea and try to set the cursor in the textarea there? Or is there a more efficient/convenient way to do it on (non-editable) DOM nodes?\nIs there an easy/cheap way to determine whether a string might have stacking?\n. > > Is there an easy/cheap way to determine whether a string might have stacking?\n\nNo, that is not possible. It not only depends on the data but also the font used.\n\nWell, I meant a way to weed out strings that obviously don't need the expensive treatment, and simply have a cursor position between every code point. /[^\\x00-\\x7f]/ would work to spot ascii strings, but maybe we can do better, and enumerate the ranges of the languages in this occurs (by using broad ranges to keep the string size under control, false positives aren't bad).\n. @santhoshtr \n\nYes, create an editable node and keep on trying to place cursor. Of course it is inefficient and hacky.\n\nOn Firefox, it seems that selectionEnd can be set to any value, even one that's not a valid cursor position. Do you have any example of this technique actually being applied?\n. (That is, I'm using a textarea now, because there i can play with selectionEnd without actually breaking the existing selection in the document. Using getSelection().addRange() is just too horribly disruptive\u2014will cause tons of side effects on mobile, and also cause spurious deselects/reselects on desktop.)\n. Nope, I still haven't found a hack that works halfway acceptably.\n. The website always reflects the dev snapshot (master branch of the git repository). There'll be a new release in two weeks. The current master branch can be considered stable, so you could also use that in production.\n. Have you tried registering a beforeSelectionChange 1 handler and writing your own logic to enforce this invariant?\n. Yes, you'll have to keep track of the location of your own widgets (or use findMarksAt or something similar). There is no other way, and the use case sounds too narrow to add built-in support for it to the editor core.\n. Can you reproduce this in the demo pages on the website? If not, can you try to isolate a minimal example page that demonstrates the problem?\n. If by 'original indentation' you mean the indentation it had when it was copied -- that is how CodeMirror (and every other editor I know) behaves by default. If you want to reindent the code on paste, you could install a change event handles, look for an origin property of \"paste\" on the change object, and if it is a paste change, simply reindent the changed range.\n. I'm not aware of any existing code for this (but you should be able to do it in ~10 lines).\nUntested:\njavascript\ncm.on(\"change\", function(cm, change) {\n  if (change.origin != \"paste\" || change.text.length < 2) return;\n  cm.operation(function() {\n    for (var line = change.from.line, end = CodeMirror.changeEnd(change).line; line < end; ++line)\n      cm.indentLine(line, \"smart\");\n  });\n});\n. The keyup handler + global variable part doesn't make much sense to me, but hey, if it works for you that's great.\n. Yes, this is the intentional indentation. Typical JS style is to indent a function value passed as argument one unit, and don't put the final closing paren on its own line.\n. Preventing rightward drift, and making the code look uniform (all indented blocks jump one unit to the right)\n. I can't reproduce it in this test case:\n``` html\n<!doctype html>\n\n\n\n\n\n\n\n  var cm = CodeMirror(document.body, {lineNumbers: true, value: \"1\\n2\\n3\\n4\\n5\\n6\\n7\\n8\"});\n  var w = document.createElement(\"PRE\");\n  w.innerHTML = \"--- widget --- widget --- widget ---\";\n  cm.addLineWidget(4, w, {above: true});\n\n\n```\nCan you create a minimal html document that reproduces the issue?\n. I am still not seeing the problem. Please describe the steps you take, the effect you see, and how it differs from the effect you were expecting.\n. For me, it does not. Which browser are you using? Is it the current CodeMirror code from git that you are testing with?\n. Hopefully today.\n. Yes, this has been the case since 2.0, and is mostly by design -- it requires less DOM nodes to be created for JavaScript code, thus optimizing the language that CodeMirror is most commonly used for a little.\nIs it a problem for you?\n. No data. You are the first who requests this feature, so I figured it wasn't something people used. And I was hoping to avoid updating the tests. Done in attached patch.\n. The attached patch seems to fix this. It unfortunately adds 1.5k to the size of the library, because I needed a huge regexp to recognize all extending characters.\nPlease test!\n. The remaining problem can be considered the same bug as #2115 then.\n. Can you point me at the place where you downloaded the browser? Trying to find a chromium download just leads me to lots of places to download Google Chrome.\n. Strange. I do not get the problem on Chrome 32.0.1664.3 dev, Ubuntu.\n. The attached patch fixes the problem for me. Could you verify whether it also does for you?\n. The browser does the wrapping, and I'd like to keep it that way. But you can do something like http://codemirror.net/demo/indentwrap.html to get an effect close to what you are describing.\n. Interesting that you generated the parser with Jison. People have been asking about that, but I hadn't seen anyone actually do it.\nThat being said, I can see some problems with the result. For one, it is a lot bigger than most modes, though the language does not seem particularly complicated, and indentation (the source of a lot of complexity in modes) isn't implemented. More seriously, it will be impossible for me to maintain this code, since it's an auto-generated blob.\nSo I'm leaning towards leaving this out of my distribution, since this is the first time I hear of Modelica, and thus I expect the general demand for it to be modest. You are encouraged to put it online yourself, and link to it from https://github.com/marijnh/CodeMirror/wiki/CodeMirror-addons\n. Merged as 086e985\n. The mode at http://codemirror.net/mode/css/less.html at seems to behave like you want here, so I recommend you simply move to that.\n. Looks great. Merged as c3c4d48\n. I have no idea what you are trying to say here.\n. That is what cbce0ffe5778a663 fixes for the HTML mode. In plain XML, pre tags have no special meaning, so they are indented like all other tags.\n. That's not what CodeMirror.Pass does. See http://codemirror.net/doc/manual.html#indent (one paragraph down)\n. How can shift-tab indent text that we don't know the correct indentation of?\nI did notice that having the indenter return CodeMirror.Pass rather than 0 in this situation is slightly saner (see attached patch), but I don't think that is what you are talking about here.\n. Tab just adds an indentunit to the existing indentation. If you are trying to simply de-indent the code, use ctrl-[\n. Without knowing a terrible lot about these languages -- but would it make sense to make the F# mode a specialization of the OCaml mode, since these are supposed to follow the same general syntax?\n. There are some modes that parse multiple similar languages already (the CSS mode handles LESS and SCSS, the JavaScript mode handles JSON and TypeScript, etc) though configuration options. Something like comment syntax is very easy to make configurable.\nIt'd save quite a bit of code duplication, which is always nice.\n. Wonderful. Merged, and updated some links in the attached patches.\n. Indeed, token styles do not nest. It is possible to assign multiple styles to a token, but the lines are represented as a flat series of spans, without any further structure. This is unlikely to change.\nWhat I would be very interested in is an adaptor that takes highlightjs specifications, and wraps them to spit out CodeMirror-theme-compatible token styles. That fixes the problem of the nested classes, and makes these language descriptions easy to drop in to any CodeMirror-using project.\n. Right. Though you'd leave off the cm- part in the mode -- this is prepended by the editor. For title, you could use the header style. But yes, in some cases you will have to get creative and/or look at some existing CodeMirror modes to see what they are returning.\n. See also http://codemirror.net/demo/simplemode.html\n. Thanks! Merged as cc23d76. I had already run into this in runmode.node.js, but somehow didn't think to also fix it in the standalone browser script.\n. Attached patch should do it. Note that on ancient browsers that don't have a 'cut' event (some Opera versions), it won't work (and I don't think there is any way to make it work there).\n. Nope, lookahead beyond the current line is still unimplemented.\n. Fixed by #2145\n. Thanks. Merged as 306f6d8\n. The problem wasn't the if, it was that loop and do were both interpreted as creating a new block, whereas only one block should be created.\n. You simply call replaceRange for every change. Wrap your loop in a call to operation if there's multiple changes, so that the display will only be updated once all have been applied. Beware race conditions (the second editor changing before a change from the first one has been applied, causing them to go out of sync)\n. Are you checking for the next property on the change event? See http://codemirror.net/doc/manual.html#event_change (in the v4 branch, this no longer exists, and multiple change events are fired).\n. This isn't the case anymore in recent versions of the library, so of course the current docs don't talk about it.\n. Great. Merged.\n. Merged (8f10e2f), though some of these are not yet properly handled by the rest of the mode.\n. Thanks. Merged.\n. If the editor was not focused at the time focus was called, focusing the textarea will trigger a focus event on it, which will call onFocus. Is there a flaw in my logic?\n. The event may be called asynchronously -- i.e. not immediately. Is this a problem in a practical situation, or just a test?\n. I've changed hasFocus to return the proper value, even before the event fires. I hope that helps.\n. Looks good, though I removed the getElementsByTagName tests again -- they won't work on older IEs, and they fail on the v4 branch, which always wraps lines in a span.\n. @mightyguava Care to review?\n. Great, merged as 087d37c\n. I think this can be considered a Firefox bug -- when the body has a backface-visibility or transform rule applied to it, fixed positioning no longer actually positions the element relative to the viewport, but rather to the top-left corner of the body (also causing the element to scroll!). The problem is not present in other browsers, and completely breaks the things people use fixed positioning for.\nSo please file a bug with Firefox, and find some workaround (moving the styling to an element that's not the body should do it) in the meantime.\n. Thanks. Merged!\n. @rubymaverick Do you want to take a look at this?\n. Well, I took a quick look at the Sass mode, which was contributed (not written by me), and its indentation logic is a bit more bizarre than what I am willing to handle today. I don't have any experience with Sass, so I'm not touching it.\nIn short, that means you'll have to look at it yourself if you want it fixed.\n. @chriscoyier Could you see if attached patch helps?\n. > But, highly nested nature of SCSS and lack of braces in SCSS makes it impossible for even a human to determine the correct point of dedent\nYou're right. I initially thought the Python mode gets this right, but it doesn't either, except when there is a return or pass statement at the end of the block.\n. (Can this be closed now that your pull request was merged?)\n. Just as a point of order, there is no hard-coded text height in the CodeMirror codebase, so 15px is just the thing you had your font sizes set to initially.\nLines cache their pixel height in CodeMirror, and those caches were not cleared aggressively enough by refresh. The attached patch should solve this.\n. You are asking for an additional feature, but talking about how the code \"should be fixed\". It's not broken. Your use case is just outside of it. A clean pull request that adds support for specifying a display text for the completions (of course also adding quotes) would be accepted. But I'm closing this.\n. No, it is not, as you could have seen in several different places. It acts on reindenting, not on the default tab binding, which inserts a tab.\n. I've pushed a simpler patch instead. Find attached.\n. A property called as a method is still, syntactically, a property. I know some people like to have many, many different colors in their code as a kind of visual pattern matching aid, but I'm not keen on that, and I don't really want to add extra noise to the JS mode's output to support this use case.\n(It is, however, very easy to use a local fork of mode/javascript/javascript.js where you add some extra classes to the tokens in question -- when a language mode returns a string like \"def arg\" the resulting token will be have CSS class \"cm-def cm-arg\", and thus be easy to style.)\n. Thanks for noticing that. Merged.\n. Merged, but with the giant inline URL reduced to a saner size by using a properly cropped and compressed png.\n. It is not clear what you are doing. Please provide an HTML page that reproduces the problem.\n. Thank you. Merged.\n. Thanks. Merged as 327b688\n. Thanks. Merged.\n. Sure, that seems harmless. Merged as a0522c1\n. All three (this, #2173, and #2174) were the same bug -- the way resetInput was determining whether there was a selection didn't correspond with the way readInput did the same, so they confused each other and ended up thinking the selection was being deleted whenever the primary selection was empty, but a secondary selection was not.\nAttached patch should help.\n. Wonderful. Merged!\n. Nope, this is not possible with the current XML mode.\n. Attached patch styles the brackets with both cm-tag and cm-bracket. By default, they'll look like before, but you can style them by writing a rule for .cm-tag.cm-bracket.\n. Good idea. Attached patch should help.\n. If vim conformance can realistically be done without thousands of lines of code, I guess it is a good thing. The way I understand it, vim heads tend to consider what original vim does The Way It Should Be, and will be happy if CodeMirror works the same.\n. Merged! (773b84badfc & 712f28ce25eaf)\n. Merged! (773b84badfc & 712f28ce25eaf)\n. Merged.\n. Pushed f9aa052 instead, which passes the current state to the event handler, and doesn't dump trailing whitespace into the file.\n. Thanks. Merged as 0141579\n. The first commit looks good (merged as afe0dfb), but for the second, I'd prefer if you made it configurable through the continueComments option instead of adding a flag to the mode object. I.e. make it understand that if an object with a continueLineComment and/or key property is passed, those should configure the behavior.\n. (Github doesn't notify me when new commits are added to a pull req, so you usually want to follow up with a comment.)\nI've merged your code as c264a212ece , and fixed a problem (the option being global to all editors) in 1850ef46f\n. I have fixed this in the v4 branch in attached patch. The scrolling-things-into-view logic has been rewritten in v4 because it is a horrible mess in v3\u2014which also means that it's hard to fix this in v3, so I intend to leave it broken there. A stable 4.0 should be out soon.\n. Good point. Merged as eab9b5e\n. Thanks. Merged as 1a1e6a7\n. Thanks. Merged.\n. Thanks. Merged as 53b129b\n. Adding the parameter should fix the problem. What further errors are you getting?\n. The null mode doesn't return null when initialized, so I don't think that is the problem. Submit a test case for the startState problem if it can be reproduced.\n. Thanks! Merged as c1d75b7 \n. I am unable to reproduce the problem. What did you do exactly? And did the input problem happen in the editor itself or in the search box?\n. That does not happen for me (IE11, Windows 7).\n. Still, your workaround seems harmless enough. Applied in attached patch.\n. I do want to know how to reproduce this, since it is a result of a bug elsewhere causing the redrawing algorithm to get confused. Just hiding the bug by ignoring it at this point isn't how I want to address it.\n. This part of the code was entirely rewritten in v4, which will land today. Closing this on the assumption that the rewrite won't have the same problem.\n. Submit an HTML document that reproduces this, please.\n. Indeed, v4 handles line height measurement differently (making sure lines 'connect', rather than directly using the reported text box height). The line number problem can be used by also giving those a line-height (or a padding-top) in the CodeMirror-linenumber class.\n. Did you try to reproduce it with plain (Firebase-less) CodeMirror? I can't do much with a report that something goes wrong when external code is involved -- I need a way to reproduce it with just the CodeMirror library.\n. Closing until further information comes in.\n. @prdonahue Definitely try upgrading. The display update mechanism has been rewritten in the meantime.\n. @malmaud Do you want to take a look at this?\n. Thanks! Fixed by 15cb164\n. I think the (hacky, but not too bad) way to do this is to\n- Have the overlay generate styles that are recognizeable and contain the needed information (say color-ffccff, or color color-ffccff for quick access through getElementsByClassName)\n- Listen for the renderLine event, and in your handler, iterate through the tokens, decorating them with the actual styles (beware DOM structure differences between v4, v3, and older versions.)\n. Merged as f289321 \n. This is awesome, and I'd love if you could host it somewhere and add it to this list.\nBut I am currently suffering from some major maintainer anxiety. By which I mean that, no matter how great the contributor, I always end up the go-to point for maintenance and complaining when any of the code I distribute has problems. Thus, I am really trying to avoid taking on new addons that don't do something very central and/or deeply integrated.\n. I've needed this myself in the past as well, so I agree. See attached patch (added to the v4 branch).\n. Isn't this what the insertLeft option to setBookmark does?\n. It's tested in the test suite, and it works when I run a simple manual test myself. Can you submit a minimal test case where it fails?\n. I guess you got it to work, since your plugin does show the cursor on the left of the bookmarks now?\n. It seems like the current marked span widgets could just be a special case of this. That does make it attractive. But I don't have time to work on it before 4.0 (and probably not for a while after that either).\n. You can actually do this with a marked range in combination with a widget bookmark.\n. Modes are run and re-run continuously, as the document is changed. I don't think this maps very well to markers, which are persistent things.\n. Wonderful. Merged. I had to remove an unused open_delimiters variable to make the linter happy. Was that something that was supposed to have a role?\n. Looks good. Merged!\n@mightyguava This looks like a no-brainer, but if I missed something let me know.\n. Great. Merged as 5581979\n. Yes, it is, since it indicates that the editor should drop all caches and do a full redraw. It might be that calling setSize(null, null) (don't touch actual size, but signal that size changed) is somewhat faster.\n. I don't like using .something * rules very much. Is there a specific problem you are addressing with these? Could we fix it with specialized rules?\n. I agree that yes, this'll mess with 3rd party code. But so would your patch, since a widget expecting bootstrap-style border boxes might be present inside a widget in a CodeMirror editor. There is no perfect solution here (except for Bootstrap changing their approach, which seems unlikely). The reason I dislike blanket * rules is that they tend to produce unexpected effects.\nDoes attached patch, and the understanding that 3rd party code will have to fix this for themselves, work for you?\n. This looks harmless enough. Merged.\n. Thanks for spotting that. Merged.\n. I have considered this, also for the purpose of letting people plug in custom scrollbars if they want to, but it'd be a fiddly job that I don't currently have time for. A clean pull request like that would be considered.\n. Don't worry, you can still open a pull request if this feature request issue is closed. If you don't, I'll get to this eventually (before release 5.0).\n. Great. Merged as 0c35969\n. These commits cause failing tests on the v4 branch, into which I merged it just now. See https://travis-ci.org/marijnh/CodeMirror/builds/18346627 . I can't figure out the problem, so far. I fixed an issue in 7a371ab (cursor positions are now shared, you shouldn't mutate them), but that's not what is causing the failures.\n. Thanks, that indeed solved it!\n. Does the attached patch help?\n. I do not see the problem in IE11/Win7  -- when I follow your instructions, selection seems to work fine (the editor scrolls up to the top as I drag, releasing the mouse button outside of the frame doesn't cause problems).\n. Attached patch should help with the problem of the selection going crazy. I have no idea how to fix the other problem (it is flaky, though to a lesser extent) in other browsers too. There is no way to know what the mouse is doing when it is outside of the frame that holds the editor.\n. Well, the main problem would be 'interface creep', in that once this is publicly available, I won't be able to change or remove it anymore. Since it's a tiny function, I think I'd prefer for you to simply duplicate its logic in your own code. Does that sound workable?\n. innerMode can either return null or an object in which mode refers to itself to stop the iteration in CodeMirror.innerMode. Returning an object with mode: undefined caused the error you saw. The attached patch should fix this (and make copyState do the right thing as well).\n. I messed up a refactor. Should be better again with attached patch.\n. I prefer the swapping solution, since it requires less poking around in the internals of the core lib.\n. Attached patch fixes the creation of start states for these modes. Does :math: now work as intended? How is a formula supposed to be terminated?\n. The htmlmixed mode will leave indentation inside script tags to the inner mode. For script types it does not recognize, that's the text/plain mode, which doesn't indent at all. You can configure the mode to recognize different script types (see parserConfig.scriptTypes).\n. It indents fine on the first shift-tab for me. What is your starting document, and where is the cursor, when it works badly?\n. Makes sense. Pushed! Docs would be welcome.\n. I can't say much about your questions, since I've never worked with json-ld. But the code's final form looks good. Merged as 9f366d7\n. Nice demo, but I am not really looking to include it in the distribution -- I know from experience that people will then expect me to look at their improvements, factor it out into an addon, fix bugs, accept feature requests, etc.\n(Also, there is no need to close the <li> tags on all files you touch! HTML5 allows them like that.)\n. Thanks! Merged as e1dcbeb \n. This doesn't happen in the demos. Please provide an html page that I can use to reproduce it.\n. I don't see a problem in Chrome Linux. What browser are you using?\n. Still can't reproduce. Since you failed to mention how you were filling the editor, I wouldn't be surprised if you forgot other essential instructions. I'll need a demo that actually reproduces this on its own (without my interaction) if you want me to look at this.\n. Still seems to work. Are you testing with the current up-to-date sources from the v4 branch?\n. My French isn't good enough to see through a page of ad spam like that. But anyway, I don't doubt that you have the problem, I just can't reproduce it.\n. I can reproduce this in Firefox now. I couldn't before because I was using Chrome, which doesn't show the issue for me. I'll try to debug.\n. Found the problem. The \"resize\" event handler was somewhat confused. Attached patch should help.\n. >  Dojo splitter don't trigger resize event of window, \nYes, unfortunately I don't know of a way to get notified automatically when a DOM node resizes (short of polling, which'd be awful and expensive), so you have to handle such cases manually.\n. See the discussion (near the end) in #1196. I tried something like this, and was told it didn't work.\n. Yes. You can check out commit 3eef2990797b33cd888facf7c286821c6e01d56e and experiment with that, it implements pretty much what you describe (always putting an underscore character at the start of the textarea).\n. (To clarify, I mean the commit I linked is the last one that has the hack in it, the commit after it reverts it.)\n. Is this still happening in recent Android versions?\n. This problem is solved for Chrome in the current mobile code. (Though Firefox Android still has a similar issue - #3102)\n. That was a holdover from an old hack. Shouldn't be needed anymore. Removed in attached patch.\n. Not in Chrome. Which browser are you testing with? (And did you verify that it happens in the demos on the CodeMirror website as well?)\n. Normally, the cursor isn't drawn at all when selecting. I guess you set showCursorWhenSelecting to true. But even with that, I can't reproduce this. Did you add CSS rules that influence the z-index of the cursor?\n. Not sure what I did the first time I tried to reproduce this, but now I do indeed see the problem. Attached patch should fix it.\n. Indeed. I knew I shouldn't have touched that stuff so late at night. My attached patch seems to fix the problem, while still keeping the cursor behind the text (which is needed for the 'fat' cursor in the vim mode).\n. How is this a CodeMirror bug, though?\n. How embarrassing! Should be better now.\n. There's the beginning of such a thing in https://github.com/marijnh/CodeMirror/blob/v4/keymap/multiselect.js . I'd be okay with renaming that one to sublimetext.js, and adding a bunch of st-like bindings to it.\nAnd no, CoffeeScript pull reqs won't be accepted in this repo, you'll have to convert to plain JS.\n. getCursor(\"from\") ensures you get the start of the selected range, getCursor() will give you the head (the side that moves when you press shift-arrowkey). The method shouldn't be very expensive to call.\n. See also the Sublime Text bindings I added today (846e7b6e48a9a2).\n. Looks good. Merged as 91d93fd\n. This is a great start! To fix the bidi algorithm issue, I think the only thing you need to do is to add a second parameter to the bidiOrdering function, which indicates the default direction, and then replace references to outerType with this parameter, and ensure that the call to bidiOrdering in getOrder passes the right value (\"L\" or \"R\") based on the value of the rtlLayout option.\nYou should also add an option declaration (under section OPTION DEFAULTS) that declares a handler for when this option changes -- similar to lineWrapping, most caches should be cleared when this option gets a new value (the order property on the line objects should also be cleared).\n. Also (you're probably aware of this) -- when there is a horizontal scrollbar, this is very broken. And due to issue #1757 , wrapped rtl lines are still very flaky (not just cursor motion, but also selection drawing).\n. There has been work on this happening in the direction branch. Testing appreciated.\n. I don't think this is the right way to go about this. How about, in the sublime text bindings, you simply bind \"Esc\" to a function like this (untested):\njavascript\nfunction selectTopSelection(cm) {\n  var range = cm.listSelections()[0];\n  cm.setSelection(range.anchor, range.head);\n}\n. I am not aware of this problem. The default binding for \"Esc\" works fine for me in Chrome.\n. Merged as 3c429a5\n. Is text wrapping on? If so, this is the same problem that #1757\nAlso, please take another look at http://codemirror.net/doc/reporting.html . This style of bug report does not provide enough information (if I take it literally, and type \"fobar\u0643\u0627\u0626\u0646 \" in http://codemirror.net/demo/bidi.html , no problem is visible).\n. Right, I can reproduce it now. Attached patch should fix it.\n. This causes problems in the vim mode (cursor covers text). See e1727acbd2f7 for an alternative implementation.\n. Thanks! Merged as e6dc18a\n. Nice. Merged as 633f829e205dc9 . I've added 573ad2a4ec9c , which verifies that the header-ish lines are actually headers (not, for example, part of a triple-backtick block in gfm mode), and adds support for underlined headers.\n. Attached patch fixes it in the v4 branch. Will you also need a fix for v3? It is somewhat more awkward to solve there, since the scrolling code is such a tangle, but I can probably come up with something.\n. Great - closing.\n. Please see the thread at  https://groups.google.com/d/topic/codemirror/WOoqlDuIbaY/discussion for background, especially Peter Flynn's message. What CodeMirror does by default corresponds to Sublime Text. There's also a built-in command (delWordAfter) that implements the Emacs approach.\nYou appear to want something else, but the word \"should\" is not something that belongs in this discussion. Different editors do different things. Any chance you can implement this in external code?\n. Oh, interesting. It seems that ST actually behaves differently when it sits in front of a single space, compared to what happens when multiple space characters follow the cursor. The intrigue deepens.\n. I don't think there is a 'behavior common across most editors' here, we should just give up on that concept.\nBut if the goal is to do what Sublime Text does (which isn't unreasonable), attached patch should address the issues raised here. By-group motion will now always stop after newlines, and consider runs of more than a single whitespace character their own \"group\", and stop after them.\nDeletion and movement in CodeMirror use the same algorithm. I really would like to keep it that way (easier to predict, less code).\n. Okay. I'm going to say 'close enough' and close this then.\n. Does the attached patch solve the problem for you?\n. Indeed. That should be cleared up by the attached patch.\n. Good catch. I found the problem -- attached patch should help.\n. Attached patch should help (and fixes a few more flaky things in the ctrl-selection handling).\n. Makes sense. It actually already behaved that was in the v4 branch. Merged.\n. Attached patch should help.\n. Attached patch seems to help. Please test on your side.\n. Indeed, that's an improvement. Merged as b1aa60e\n. Hah, indeed, that was some rather misguided code. Should be better in the attached commit (set it to false, and it'll stay false).\n. Yes, you'd do something like\nvar editor = CodeMirror(document.body, {\n  mode: {name: \"xml\", multilineTagIndentPastTag: false}\n});\n. Then you'd also have to add htmlMode: true to the object.\n. There might be a point to be made for allowing mode specs like {name: \"text/html\", other options...}, and then copying the other options into a clone of the spec associated with text/html, I guess. Want to implement that?\n. Doesn't this conflict with what emacs does by default? If I create a mark, delete and backspace still delete characters next to the cursor, not the whole region.\n. I don't have strong feelings about this, and I guess it would be okay to make the change. I do wonder though why my Emacs 24.3.1 (Linux) does not behave this way.\n. That is indeed it. Thanks for looking into it. Your patch, however, seems to be passing a wrong set of arguments to kill (it expects the editor instance as first argument). Attached patch provides an alternative implementation.\n. Merged as 1976d03\n. Hold on, this already works in the existing code. Just pass a mode spec of {name: \"text/html\", multilineTagIndentPastTag: false} and it should do the right thing.\n. Or are you trying to implement something different?\n. Ah, I see the problem now. I've implemented a slightly different solution in the attached patch.\n. Looks good. Pushed as a5a08d1\n. Looks good. Merged (with some linting fixups) as 3876222\n. Thanks! Merged as 11967c7\n. Thanks! Merged as 9f834a9\n. I'd like the builtin list to be some well-defined set, not just a random collection of things you ran across. But I agree that thousands of words is too much -- to download, and to match. Figure out a subset of packages, and extract all keywords from that.\nAlso, look into git rebase, so that you can create pull requests with only the relevant patches in them.\n. It is now under the same license as the rest of the library. I've removed the link.\n. See my comment in #2272 \n. Doing it in a context-aware way would indeed be quite a bit of extra work. The Python mode doesn't use the variable-2 style yet. Maybe use that instead of keyword (since it's not a real keyword)?\n. Most likely you compressed CodeMirror in a way that emitted non-ascii encoding, and then loaded the file without specifying the right character encoding.\n. Great, I'll assume that this is the same problem then.\n. There is nothing in CodeMirror that recognizes file extensions, so I suggest you take this up in the bug tracker of whichever tool you happen to be using that does the extension -> mode mapping.\n. Seems like a good idea. Merged as b0ce795 \n. JavaScript programmers don't see to be able to handle linked lists very well -- I was getting two confused questions per month about this data structure. Many people seem to program by trial-and-error, never read the docs, and thus didn't even notice the next property.\nHow about a separate event, changePerOp or so, that passes an array of change objects? That'd be a single line to support, and would allow people to use change objects in the obvious way.\n. See attached patch. I ended up calling the event \"changes\".\n. I think attached patch will help. Please test.\n. Okay! Merged as 997ab42\n. Always go through setOption when changing options, don't mutate the options object directly.\nFor the vim keymap, you should use the vimMode option, since it needs to set up a few things beyond just the keymap. .setOption(vimMode, true) should do it.\n. We might also want to weaken that disclaimer (\"loose approximation\"), given the rather mature state of the vim bindings?\n. That sounds better (less likely to cause people to dismiss it without trying).\n. Chrome does the right thing and returns \"SS\" for\u00a0\"\u00df\".toUpperCase(), but indeed, FF doesn't. Merged.\n. @mightyguava Waiting for your review.\n. Thanks! Merged as 6861152\n. Sorry about that! Merged.\n. Does the problem go away if you leave the code intact but only remove the part that sets the properties on the dom nodes?\nIn the v4 branch these aren't put on dom nodes anymore, so the problem might already be fixed. In v3, I don't think I'll get around to fixing it.\n. Is moving to v4 not an option for you? I'll be tagging a release candidate within the next few days.\n. Closing, since v4 will land today.\n. I think I've found the culprit, and fixed it in the attached patch, but please test.\n. Oh, oops. Merged!\n. Thanks! Merged as 74c8d30\n. Thanks! Merged as 74c8d30\n. This has been fixed since 4.0\n. The vim keybindings don't use a normal keymap, and the emacs ones bind most of the keys directly to functions, so those won't show much useful information this way. The Sublime Text binding demo already does a more structured form of this, and uses it as the example text (http://codemirror.net/4/demo/sublime.html).\nAs it is, I don't think this code is very useful, but a properly wrapped addon that provides this service in a well-formatted way, and starts with the active keymap, rather than just displaying the default keymap, might be nice to have. Still, people will want to style the display style to fit their project, so I'm not sure the CodeMirror distribution is the right place for this.\n. I think it'd be best to implement it as a command (http://codemirror.net/4/doc/manual.html#commands), and let people bind their own key.\n. #1990 is resolved, it seems. Does that make it easy to resolve this? (Or has it already been resolved?)\n. Attached patch should help. Please test.\n. The first patch should address the second issue you mention.\nAs for the first, I would really like to avoid having yet another boolean argument to all selection functions. The case you mention (searching) is addressed by the second patch. Are there other cases you are worried about?\n. If it's going to exist internally, it will also have to be exposed externally. When people write new cursor motion commands, they will want the same kind of control that built-in commands have.\nHow about a method forceSelectionHistory (not sure about name) that can be called after changing the selection to ensure it is pushed into the undo history?\n. Good point. I've updated the selection methods to take an options object, rather than a boolean flag, in the attached patch. If you were already using that boolean argument, you'll have to update your code again. See http://codemirror.net/4/doc/manual.html#setSelection for a description of the new behavior.\n. I've bumped the default value of that option. It was sort of overly short for normal edits as well.\n. That was intentional, but I guess there's a good argument to be made for the other behavior, and indeed, most other editors behave like that. Attached patch should take care of it.\n. Right. Making small tweaks to accommodate single use cases always leads to madness. Though with some more thought, such use cases can also help reach a point where we actually model the problem we want to model.\nThe attached patches go back to a simpler model (getting rid of the concept of a pending selection), but adds selection origins (rather than a merge flag), which work similar to change origins. I've added a test for your latest use case.\nIf you could verify that your other tests also still pass, I'd like to mark a release candidate today or tomorrow.\n. Indeed, it that part was accidentally deleted in the change. See attached patch.\n. This worked for origins starting with an asterisk, but not for others. I guess it is sensible to make an exception here. See attached patch.\n. Great! Merged as 2fccf82 \n. Thanks! Merged as 9ea15f5\n. Good call. Merged.\n. There is no way a browser should draw such a thing for anything CodeMirror renders, so the bug is likely to be in Firefox, not in CodeMirror.\n. Could you open a bug on the Firefox bugtracker? They use CodeMirror themselves, so they are likely to take this seriously, even if we don't have a reduced test case.\n. Does this still happen in recent Firefox versions? The bug on bugzilla seems to have been ignored, but that doesn't mean some unrelated patch didn't fix it (there's been a lot happening in the Firefox codebase since this issue was opened).\n. See #1896 .\n. The pages at codemirror.net/1/ are the old version 1 documentation. In 2.x and 3.x, those options no longer exist. Instead, you are expected to include all the files you need in the page where you're using CodeMirror. See the demos on the website (without the /1/ prefix) for examples.\n. I can't reproduce. What does suggesting a scrollbar without actually showing it look like?\n. I can reproduce it. Attached patch should help. Since this occurs only in v4, and #2317 occurs only in v3, I doubt the two are related.\n. The sql-hint addon was contributed, and I can't say I really understand how all of it is supposed to work. But attached patch seems to fix the problem you describe. Please test.\n. Indeed. I should really check contributions more closely -- pig-hint.js was a copy-pasted form of javascript-hint.js, with a lot of nonsensical code in it. Attached patch removes it, and instead changes mode/pig/pig.js to register a list of completeable words. You should now be able to simply include show-hint.js and get simple completion for pig latin files.\nDoes that solve your problem?\n. Thanks. Merged.\n. Attached patch solves the problem for me. Can you verify?\n. Just a heads-up that, I suppose due to further changes in the way OS X does scrollbars, I had to revise my strategy here again. Attached patch moves back to a pointer-events solution, but improves the old approach by temporarily enabling pointer events after scrolling.\n. In the demo. tabbing three times and trying to type in the last placeholder gives:\nUncaught TypeError: Cannot call method 'slice' of undefined linkedmode.js:128\n(anonymous function) linkedmode.js:128\nrunInOp codemirror.js:1445\nwindow.CodeMirror.CodeMirror.operation codemirror.js:3223\nLinkedMode._onBeforeChange linkedmode.js:127\nsignal codemirror.js:5379\nfilterChange codemirror.js:2313\nmakeChange codemirror.js:2328\nreadInput codemirror.js:1510\n. Also, backspacing out the first placeholder, typing something new, and then pressing enter gets me in a state where there are (empty) placeholders leftover at the starts of (what used to be) the first placeholder (span).\n. Could you add some docs on the intended way to use this? Can multiple linkedmodes be active at the same time?\n. Is the cross-document feature something that comes up in practice? It seems tricky, but I guess there are use cases.\nAs for whether this should go into the distribution, I'm not decided yet. If so, it'd have to be combined with an easy-to-use snippet system, so that people can use it in an obvious way. But I'd probably redo the API, its style doesn't really match the conventions of the rest of the system (lots of constructors, somewhat verbose). I also must admit that I didn't go over the whole code yet, only noticed some things by superficially scanning it. Getting something like this working in a robust way is  very tricky, I'd have to find the time to really reason about the whole system before I merge it. This week is definitely too busy for that.\n. (Closing this. Submit a new PR if you want to submit updated code.)\n. delLineLeft exists because there's a default mac binding that has that behavior. I don't think we should be adding unused commands for the sake of symmetry...\n. You could add it to keymap/sublime.js, along with the default binding for the Sublime keymap, and submit a pull request. I still don't want it in the core library.\n. Indeed! Not sure how I missed that. Probably because line widgets were added after the estimateHeight construct. Merged.\n. What are you doing that leads up to the error? Can you submit a script that reliably reproduces it?\n. Still, you're probably in a better position to create a way to reproduce this than I am. A CodeMirror bug is more likely than a Chrome bug here, since this is new (in v4) code.\n. I've set up a page that creates a large document, add 200 marks with a class name to it in random positions, and then clears those marks again. It doesn't trigger this problem.\n. That appears to have been it. I have a way to reproduce this now. Digging.\n. Can you see if attached patch solves the problem for you?\n. Hi Peter, I had a somewhat different implementation in mind, and also needed to adjust the xml-hint addon to work with the changed tokens. See attached patch.\n. Sizing the middle gap can be done with CSS.\nMaybe simply exposing the internal iterateChunks function (which calls a callback for all chunks) would allow you to build what you want?\n. With the attached patch, you can call .rightChunks() on your diffview, and it'll return an array of objects describing the line offsets of the starts and ends of the non-matching chunks between the editor and the original on the right. (Same with .leftChunks())\n. The library used to detect diffs doesn't seem to support ignoring whitespace, and I have no plans to write our own algorithm for that. So this is out of scope for now (but a pull request, if clean, would be welcome).\n. Middle-click copy/paste works with CodeMirror in Webkit/Chrome, but not in Firefox. This is something CodeMirror can't help -- Firefox doesn't expose a way to interact with this clipboard. 'Not screwing with your mouse' is not an option. We need to maintain our own selection, and that necessarily involves handling mouse events.\n. Looks good. Merged as bf8681a\n. The extend of the replaced text is determined by the hinter function, not show-hint itself. Which language are you completing?\n. I see. That completer was contributed by a 3rd party, and will probably have to be rewritten soon, since it seems to have a lot of problems.\n. Nope. Probably, the cursor ends up being drawn in the wrong place. I can't imagine pageup/pagedown to be the culprit, though. A more precise description of the steps taken to reproduce the problem, the CodeMirror version used, and whether it can also be reproduced in the demos on the CodeMirror website, would be helpful.\n. Solved by #2340\n. Looks good. Merged as 0e3d59c\n. Maybe set it up so that people can override the way the output is displayed? I don't think many users are going to bother to explicitly hook into this, so if we don't provide a somewhat-working feature by default, the feature won't be usable for most people.\nI do agree that the vim mode is starting to push the boundaries of what is possible inside a single CodeMirror editor, and that for more serious emulation, we'll have to move to a model where the mode manages multiple editors. But both approaches have their place -- the current as a simple drop-in vim-ish environment for an editor that happens to be using CodeMirror, and the second as a serious 'vim-in-the-browser'. Whenever possible, I'd like to provide more or less functional fallbacks for the single-editor approach.\n. Working with multiple selections is somewhat tricky. Your shift-alt-up/down bindings use getCursor, which causes them to only extend from the primary selection. You'll want to extend from all selections' heads (using listSelections, whose return value is a snapshot, and will stay stable when you call addSelection).\nThe fix to shift-ctrl-d has a problem where you assume that the ranges from the old selection are still valid after duplicating the lines. Mutating the document based on multiple selection requires finding some strategy where your changes don't cause problems when applying further changes. In this case, it seems my original strategy of only duplicating lines once isn't what ST does. It duplicates a line for each cursor on it. For non-empty selections (use the .empty() method on the range, rather than manually comparing its endpoints), you'll have to make sure to reorder the changes in such a way that, applying them back-to-front, they don't interfere. I.e. you need a single array of changes, not a separate one for selections and one for lines.\nDoes that make sense?\n. I've pushed your work on shift-alt-up/down as commit c7f2e70629e94ef , and updated it in 1bf22d0e24f3969d2 -- the head (moveable end) rather than the anchor of the selections should be used, and the whole thing should be wrapped in an operation, so that it counts as a single undo event, and doesn't needlessly update the display between adding selections. I also added spaces before and after binary operators, in order to match the rest of the code.\nFor shift-ctrl-d, I've pushed 3cb266d7c5f instead of your solution. Your still have an ordering problem, in that Sublime will duplicate lines after the selections for earlier cursors in that line are duplicated. So 1[2]3[] (where the square brackets indicate the selections) would become 1223\\n1223, but 1[]2[3] would become 123\\n1233, because the selection sits after the empty cursor, so the line is duplicated before the selection.\nMy solution is to iterate over the selections top-to-bottom, and perform their duplication one by one, re-fetching the updated selections from the editor on each iteration. This is safe (I believe) because duplicating a line or selection for a range won't change the meaning of the selections after it.\n. Indeed, I guess patch b05b96e0 , which introduces the behavior of not autoclosing after a word character, is problematic for languages which add alphabetic string modifiers in front of quotes. @aslushnikov , any ideas on how to solve that?\nI guess we'd need mode-specific configuration options, also for handling heredoc-style.\n. Wonderful. Merged as 11b4e40\n. This is intentional, in a way. As @njx mentions, one could argue that reducing to the last (which codemirror considers the 'primary') range is a preferable behavior, and it is what the default esc binding does. We could override this in the sublime keymap to use the top range, if this is breaking use cases for sublime users.\n. I've made this the default behavior in the Sublime keymap.\n. Why is there a file called CodeMirror that looks like a git subproject in your patch?\nPlease use Pos(cm.firstLine(), 0) for the start of the document. Documents may start at any line number.\n. Merged as 337e9771ab7f. Thanks! Do add a comment whenever you add patches to a pull request, because otherwise I don't get an email, and I won't notice.\n. Nice. But I think that this language is, at the moment, still too obscure to have a mode in CodeMirror's distribution. Feel free to put it in a github repo by itself, and link it from https://github.com/marijnh/CodeMirror/wiki/CodeMirror-addons\n. You are not supposed to define your own token styles + css file. Use the styles in lib/codemirror.css, so that the mode works with all themes. Most of your styles match an existing token style directly. For the others, you'll have to just pick an unused style that sort of sounds like it might apply.\n. I've merged this as af4dedbf880, but I've shamelessly reindented the code to match the rest of the CodeMirror codebase. Some more small cleanups in 4d9be849acb748b. The indentation mechanism in the code wasn't even close to doing proper indentation, so I've simply removed it.\n. Moved to https://github.com/marijnh/CodeMirror/wiki/Mode-wish-list , since we don't use the issue tracker for mode requests.\n. Could you please indent the code consistently (two spaces per block, no tabs) and make sure the linter passes? (Install node, then run bin/lint in the checkout directory)\n. I have merged your patches as 567d5d5c0bd6a811 and 7ec7ec081bb8, and followed up with ec129392e5c6a and 05ed5650ecf to do further cleanup and simplification.\nUndoing selection can be done with ctrl-u (cmd-u on mac).\n. @bfrohs Did we have a policy about non-standard properties in the css mode? (I forgot.)\n. Maybe we should use a less strong style than \"error\" for unrecognized property names? I can see how having them bright red is distracting. But I don't think we should add every non-standard property ever conceived to this mode.\n@shashank-jaiswal-2013 Would you be okay with leaving these out, and changing their highlighting to be different from normal properties, but not red?\n. @shashank-jaiswal-2013 That is not what I was talking about. I don't think it is a productive path to start adding non-standard properties here. If you find the red too obtrusive, you can restyle it by doing something like\n.cm-s-default .cm-property.cm-error { color: #550; }\nor something similar.\n. I've added such a list in the attached patch. If you can think of some place that has a complete list of the various non-standard properties in use, feel free to submit a patch that adds them.\n. See this discussion: https://groups.google.com/d/msg/codemirror/-RnA80suRIY/lMBPnv_r4pUJ\n. The gutter already resizes to fit the number width. If it doesn't you probably set a fixed width in some CSS rule. This patch is definitely not landing (it hard codes the character width, and somehow assumes that only the transition from 999 to 1000 requires handling).\n. This is intentional. You can use shared markers to work around this. Though those currently aren't duplicated when a new document is derived from an existing document that contains shared markers. This could be considered a bug, I guess, and should be fixable. Is it a problem for your use case?\n. There is no need (anymore, in 3.22) to hide a character like that. You can use the clearWhenEmpty option to markText and have markers whose start and end are the same. I guess the fact that you can't pass shared to setBookmarks is also an accident. I'll look into it.\n. Indeed. This is fixed by 7e53bcce8 and f903d6e80280285\n. Attached patch addresses the problem of shared markers not appearing in newly linked docs (as well as that of them persisting in unlinked docs).\n. Thanks for noticing that. Your patch still has a problem when the cursor is at the very end of the last line -- it'll be shifted to after the newly inserted line, and not stay on its line as it should. I've pushed an alternative patch, see attached.\n(Including a test case is usually a good idea when fixing things like this, so that we know that they stay fixed as the code evolves further.)\n. No. The vim mode has incremental search, but this hasn't been factored into a self-contained addon yet. You could write your own addon equivalent to the search one (which is <200 lines), but tailored to your own use case.\n. I can't reproduce this. Please submit a minimal file that illustrates the problem, and tell me which browsers you're testing with.\n. Thanks, that helped show the problem. Attached patch seems to fix this. Please test.\n. Looks good. Merged.\n. Attached patch should help.\n. Attached patch helps for me. Please verify.\n. There is, since 4.0, already the concept of an origin on selection changes. Mouse selection sets it \"*mouse\" (the asterisk is a signal that subsequent mouse selections shouldn't keep creating new selection history events). Exposing that as a second argument to the \"cursorActivity\" handler would be okay as far as I am concerned.\n. Attached patch should solve this.\n. Isn't there a way to change the way the cursor/selection is shown that will allow the vim conceptual selection to match the CodeMirror selection? This just seems a really scary road to go down (and we're already quite a bit down that road with the current beforeSelectionChange stuff).\nDo I understand correctly that the cursor, in non-insert mode, always covers at least one character? We could even do away with the fat cursor style entirely and simply enforce that\u2014that the selection isn't empty. I guess the fact that a fat cursor should be drawn at the head of the selection is an issue.\nThere has been another user requesting the ability to add multiple, selection-like layers. If we implement that, we could use such a layer to display the cursor, and always make it cover the character in the selection that sits next to the selection's head.\nYou probably shouldn't work on this on the master branch anymore, since both beforeSelectionChange and selection/cursor drawing are quite different in the v4 branch (which will become the master branch very soon).\n. By visual change, you mean the thing I outlined before? I don't think I'll get to implementing the custom selection-like layers very soon, but once that's in, hooking into it from the vim mode should be straightforward.\n. Someone will have to design an API for creating those selection-like layers, and implement it. That'd be moderately difficult, I guess.\n. I think having the hack in the displaying code is definitely more palatable than what we're doing now. But that hack would have to be rather deeply integrated with the selection-drawing code, so I guess it'd end up in core.\nMaybe, in the meantime, until a decent API for these kinds of things is built, fire a sync event after redrawing the selection, and have the Vim mode use cursorCoords and some invasive DOM manipulation to reposition the cursor one character back when its head is after its anchor?\nYou'd still have slight issues with scrolling the cursor into view, but these might be acceptable (sometimes a bit too much space is scrolled into view at the bottom when the selection goes to the start of a wrapped line).\n. @esjey That really sounds too hacky, I think. At that point we might as well add a drawSelectionVimStyle option. Which may even be reasonable. But I'd prefer if the Vim mode can be built on general features \u2014 since that helps us force the API to be actually general. I still prefer the custom selection layer approach. If you want to work on that, open an issue, and we'll hash out a design there (this probably won't be too hard -- the drawing code already exists, we just need to add some extra data structures and an API).\n. I noticed. I'll try to outline an approach this Monday.\n. Okay, thinking a bit about this, the feature started to feel rather like a duplication of markText. Wouldn't it be quite easy to draw the cursor using markText? I.e. turn off the normal cursor, whenever the selection changed, update a set of markers to highlight the character at the right side of each selection range.\n. I think a CSS animation would be a great way to make the cursor blink. Browser support is the only reason I haven't changed to one for the main cursor yet (though maybe I should, and use the timeout approach as a fallback).\nAs for potentially confusing client code\u2014the idea is already that you'd have to inspect markers returned by findMarks &co to see if they are the type you are interested in. Various addons create marks, and the plan for IME underlining is to also use a mark. I guess I should document this better, and provide an obvious way to do this identification.\n. Part of the problem was in the HTML parsing instead. See also attached patch. Merged yours as efc576b \n. Thanks for spotting that. I recently improved HTML indentation but introduced a bug. Attached patch addresses it.\n. How are they blocking the page load? And why would you load these addons but not the linters they depend on?\n. I generally do not like to silently ignore problems like this, since it'll cause people a headache when they are debugging a problem like this, but I guess since the other Lint addons already do it, we might as well.\nSee attached patch, which uses an early return to prevent extra nesting and patch noise.\n. The library you are using handles completion on a textarea. CodeMirror replaces the textarea with a different editing control implemented in JavaScript. I don't think the two are ever going to work well together.\n. I can't figure out what you mean. Can you describe it in a bit more detail?\n. The interface to completion functions is rather simple (see http://codemirror.net/doc/manual.html#addon_show-hint), you can wrap a completer and have your function extend its result, or, when using the \"auto\" completer selection (see bottom of show-hint.js) you can register another completion helper (maybe by using http://codemirror.net/doc/manual.html#registerGlobalHelper) that yields your completions.\n. @mightyguava By the way, the v4 branch has explicit dependency declarations (in the module loader shims at the top of the page). You might want to take a look at the current vim.js file, and see if anything is missing (and we should remember to add matchbrackets.js when we merge this work into v4 -- which I'll do sometime after the 4.0 release, since I really don't want to break anything now).\n. The v4 branch (which is set to become the master branch today) exports some more functionality from matchbrackets, so that it can also be used to find the nearest bracket starting from a given point (which I use in the Sublime Text bindings to do select-block). See scanForBracket.\nAs for (\"abc)\") -- I am not sure what vim does there normally, but the matchbrackets addon takes care to only match brackets with the same token type, so that you don't get a match between a quoted and an unquoted bracket.\n. I think it is best if you just rebase your current work onto the v4 branch, and keep working from there. (Or wait until I push out the 4.0 code to master, and rebase from there, of course.)\n. Thanks @mightyguava , you addressed the main issues I had with the changes to matchbrackets. The only way the config can be specified is currently by setting the matchBrackets option to a config object.\nIt might make more sense to make the last argument to scanForBracket (as well as an additional argument to findMatchingBracket) a config object, and put the bracketRegex option inside that. Does that sound sane?\n. Yes, that's exactly it. Thanks!\n. Thanks! Merged as 38afa1e5210bdaf1 . Looked good, on the whole. I added 1696785c3fb6 to fix several things:\n- Whitespace before braces, around operators, etc\n- Calling setSelection multiple times without an operation (re-arranged to only call it once)\n- Modifier key codes are order-sensitive in CodeMirror. Shift- must come before Ctrl-, or the binding isn't recognized.\n- I added a test.\n. Attached patch should help.\n. This could probably be hacked into the prepareCopy function rather easily. I'll leave this open and look at it later.\n. Try with attached patch.\n. Do any of these constitute actual problems, though? It seems sane to me that if you have a selection, cut/copy acts on that selection. And the flash of selection when cutting is something I am aware of, but which didn't seem like an issue (it mirrors the act of actually selecting and cutting the lines).\n. @gozala What do you think of these changes?\n. Great. Merged as fbf533c\n. It inserts the last thing I selected, when I do this (Chrome 34)\n. This is almost certainly a result of the fakedLastChar hack which works around https://bugs.webkit.org/show_bug.cgi?id=90206 . That bug report never got any response, but the problem seems to be solved in recent Chrome and Safari versions, so I think I'll just rip out the hack.\n. Please see if attached patch solves the problem.\n. It seems the bug that that hack address has not been solved after all. The problem reported here is less severe than said bug, so I reverted the patch that ripped out the hack.\nI still haven't been able to reproduce this bug.\n. Can you describe (in detail) a behavior that would still allow \"typing over\" a closing quote, while handling this case in a better way?\n. That's a good approach. Could you take a look at attached patch, and tell me if it works for you?\n. Good point. I don't mind that we don't have a working test that demonstrates the issue -- your explanation makes sense, and the patch seems unlikely to have a negative impact. Merged.\n. I am somewhat confused why you would consider \"\\n\" to be a sane value for the (per-line) padding. What is this intended to accomplish?\n. > I did not expect it to be per-line in some scenarios and block in others. \nIt is always per line.\n. Ah, you are right, I was confused. Will look at this more closely after I've slept.\n. You did not mention which browser you are using. I don't see this in Chrome 4. In any case, it is probably fixed in the v4 branch (4.0 will be released tomorrow, unless some unexpected huge problem is found).\n. Good call. Merged, and followed up by attached patch, which solves the same problem for the markerAdded event.\n. That's still not right - it will always insert the padding once per line, even for block comments...\n. Maybe it would make sense to have different options for block- and line-comment's padding? Would that address the issue you have?\n. Well, another update: padding is applied to every line in a block comment, but only when blockCommentLead is defined.\n. Merged and cleaned up in 70a71e5 -- to prevent onKeyDown from getting too cluttered, I moved this into a separate function. Also, I think it looks neat, so I enabled it for all platforms (at least until someone complains).\n. Take a look at the docs -- http://codemirror.net/doc/manual.html#charCoords . The second argument, more closely described in the section on cursorCoords above, is what you want.\n. Good point. Fixed in b3414d5\n. Well, it uses a node-specific hack. That's why it has \"node\" in the filename...\nIf you're aiming to use this in the browser, you'll have to runmode-standalone.js instead. Though that one also doesn't play nice with the module loader yet -- the problem is that it replaces the regular CodeMirror module (lib/codemirror.js), and we somehow have to convince other files that are trying to require that to not do so.\nWhat are you trying to do? If you need an actual editor, you can simply use runmode.js, and avoid all this nonsense.\n. I don't know of a portable hack to make a module replace another module in module loaders.\nThe StringStream class is also exported from the main CodeMirror library, so you don't need this shim for that.\n. See my comment in #2372\n. Could you try to leave the lines you don't change as they are, rather than messing with their whitespace? It makes the patch easier to read.\n. Read up on specificity and how it affects CSS rule's precedence.\n. @mbonaci Will this be followed up on?\n. Oh, maybe it was solved. I lose track of issues, sometimes.\n. Looks good now. I reindented the code to match the rest of the project (two spaces per block), and merged it as 0d698fc . Thanks!\n. Multiple selections won't help here. But you could use setBookmark to show widgets at the positions of other people's cursors.\n. Thanks. Merged as 0149b52\n. This is intentional. You set pass a gutters option which includes the CodeMirror-linenumbers string if you want to explicitly place it.\n. That's a good point. Your patch is against a rather ancient version of show-hint.js, though, and won't apply properly to the current code. Attached patch adds it. I chose \"complete\" instead of \"completion\", since most origins are currently verbs (paste, insert, moveLine, etc)\n. There is no built-in method for this, and it is considered outside of the scope of the project. The file you found worked, at one point, but hasn't been part of the repository for a while, so it might have gone out of date.\n. Is there an easy way for me to reproduce this on a Windows 7 install? (I don't have a clue about a lot things that are going on the MS ecosystem lately.) Is the app you used to test a vanilla CodeMirror page (like on the website), or did you add you own styling and such? (If so, does the problem still occur without it?) Are you setting a <!doctype html>?\n. Forcing IE11 into IE10-mode doesn't expose any problems with the scrollbars. I don't have a working IE10 anymore (since multiple-IE installations seem to always cause installs to melt down after a few weeks).\nThe real question here is what on earth MS is thinking to force a concept that is officially no longer a thing (document modes, which you aren't supposed to use anymore) on developers.\n. See this blog post: http://marijnhaverbeke.nl/blog/a-pathological-scrolling-model.html\nThe DOM node for the fake scrollbar is simply absolutely positioned inside the wrapper container, with a right style of zero. I've never seen any browser get that wrong before. More likely the problem is its width. If it is counting the scrollbar width towards min-width, then the whole scrollbar element will be 1px wide. But IE9 definitely doesn't do that (and apparently, neither does IE11 in IE10-mode).\n. Okay, but that breaks regular IE9 (and up, probably) again, so it can't go into the main code. I am  wondering what kind of crazy document mode they are running there, that it brings back a bug from IE7.\nIt would be possible, though somewhat awkward, to feature-detect this bug. Want to take a stab at a patch? (You'd have to take into account situations where the editor is still hidden during initialization.)\n. PhantomJS is starting to feel increasingly shaky. I don't really want to add too much code to the core to deal with its bugs. In our own test suite, tests that fail on Phantom and work on real browsers are simply disabled when running on Phantom. I suggest you do the same in your tests.\n. Right, that is a problem. Have you isolated the precise Phantom bug that is causing this? Fixing it upstream in Phantom might be an option. It looks like your workaround is addressing getBoundingClientRect returning null in some cases. That is obviously not correct behavior.\n. Thanks for the reproducing page. Attached patch should address the problem (faulty assumption in overlay.js, which gfm uses).\n. New releases are brought out around the 20th of each month. I'll include this fix in 4.1 and 3.24 this month.\n. The semicolon is not an electricChar in the C-like mode, and won't reindent in that mode's demo page either.\n\\n can not be electric. The behavior of entering a newline depends on the binding for the Enter key. The default keymap binds it to newlineAndIndent, whereas the Emacs keymap is configured to not do anything special for it (thus causing a normal newline to be inserted). This is intentional, since by default emacs does not indent on enter. You can change it by doing\nCodeMirror.keyMap.emacs.Enter = \"newlineAndIndent\";\n. > You are right, my mistake. It is an \"electric char\" in emacs though.\nI know, but I find this often gets in the way when hand-aligning code. Styles differ though (I tend to indent my lines right away, rather than waiting for the terminating semicolon).\nYou can override this with\nCodeMirror.extendMode(\"clike\", {\"electricChars: \"{};\"});\n. I am somewhat wary of letting the amount of modes balloon out of control. Does this mode handle everything the Verilog mode handles? If so, I'd favour replacing it. There are no tests for the old mode, so it'll be a bit of a vague call whether this one has all the features it has, but the fact that this one has tests already speaks volumes ;)\nCan you think of anything that users of the old mode might have trouble with if we simple drop this one in as a replacement?\n. I agree, don't bother to make the keyword list configurable for now (unless it is extremely easy to do so). Can you update this pull request so that the files end up in mode/verilog?\n. Looks great now. Merged as 6b8ddd0\n. I am not able to reproduce this with current CodeMirror and iOS 8's Safari\n. I agree. Which font to load and use is up to the site, not the theme.\n. If you want me to debug this, you'll have to reduce it further than this. For all I know, the hang might be in an event handler that you registered.\nA stack trace would be a good place to start, but if that doesn't point at the issue, you'll have to start reducing the system and try to trigger the problem in a simple CodeMirror-only environment.\n. Since the selection is now shown as a native selection on mobile, I guess this no longer exists.\n. Thanks. Merged as 87036ed\n. I can not test on iOS.\nThat a pretty horrible behavior. Do other browsers on iOS also have the problem? (Or is Safari still the monopoly browser on that platform?) Did you check whether the same problem occurs for the page's vertical scroll position?\nWe should probably wrap getBoundingClientRect and getClientRects and apply this fix for all calls. At least, I assume the problem happens both for regular nodes and for TextRange objects. Could you test this?\nAlso, this will probably be fixed at some point, so it'd be good if we could feature-detect it.\n. You could try dumping the HTML structure for a CodeMirror editor, and see if you can reproduce the issue on static nodes. And then maybe try to simplify the structure to figure out what triggers the problem? I know this is a bit of a painful process, when testing on mobile, but I'd really like to have a clear understanding of the problem before adding a workaround (such workarounds often start causing trouble later on).\n. Timing this out until I get further reports.\n. Please try with attached patch, which tries to take a different approach (fix the bogus layout, instead of trying to fix the measurements in the face of that layout). It fixed the problem for me on Chrome Linux, but do verify that it also helps in the actual Brackets situation.\n. My assumption is that this Webkit bug only triggers for auto-resizing editors, in which case the rendered text covers the whole viewport, and there is no need to force a height.\n. Indeed, the sizer's width is 100%, so when the test there fails we are dealing with a layout bug.\n. Looks exactly like what I had in mind. Thanks! Merged.\n. This is bordering on too trivial to merge, but okay, you probably had your reasons. Merged.\n. This was done in #2468\n. I am not aware of any previously reported issues that sound similar to this, so no, no idea what might be going on.\n. Thanks. Merged as 66b842d064a95f37\n. It would be possible to define a helper (see registerHelper and such) type for this purpose, and have the editor use that in the findWordAt function, falling back to the current code when none is defined. The problem is that, since JS regexps are terrible at Unicode, findWordAt currently uses a bunch of hacks to detect international letters. Those couldn't be encoded in regexps registered as \"wordChars\" regexps for a given mode.\n. In many languages, $ is not an identifier character. In some languages, completely different characters are counted as part of an identifier ('?', ':', whatever). I don't think simply adding $ to the core isWordChar function is a good solution here.\n. Attached patch implements this. The wordChars helper is expected to be a regexp in the form /[...]/, and if it contains \\\\w, that is assumed to imply that it is intended to match whenever the default isWordChar function matches (i.e. also for non-ascii word chars).\nI've made changes to the JavaScript and PHP modes to register this helper. I haven't looked at other modes yet.\n. Indeed. See attached patch.\n. The fact that it doesn't silently do the right thing is quite intentional \u2014 systems that internally compensate for bad behavior tend to make it hard to notice problems. But yes, throwing an error would be a better response than hanging the tab. Note that, with attached patch, the editor will still break when given a broken mode. It just won't hang.\n. This is intended behavior, but you can configure it.\nCodeMirror.keyMap.default[\"Shift-Tab\"] = \"indentLess\";\nCodeMirror.keyMap.default[\"Tab\"] = \"indentMore\";\nShift-tab is bound to auto-indent the line or selection by default.\n. Attached patch should help.\n. This isn't something I consider a priority. You could implement such an addon using the API, but I am not planning to work on it.\n. I agree. I removed it because in normal situations a the call to regChange would force an update anyway, but your case (where the height is auto and zero) broke that assumption. Done in attached patch.\n. See my patch and comment on #2420\n. Could you ...\nA) Follow the indentation style of the rest of the project (two spaces, no tabs)\nB) Put this in mode/haxe/haxe.js, since it is very minor, and I don't want the amount of directories in mode to grow out of control.\nThanks.\n. The problem is that the Scala mode is built on a generic mode for c-like languages. Scala isn't really c-like enough for this to be sufficient. The way to address this would be to write a dedicated Scala mode, I believe.\n. I've pushed 7dbe84e66fd and 8a41f75c3939. I think, indentation-wise, this is about as good as it is going to get without writing a from-scratch Scala mode.\n. I am having trouble figuring out what you are talking about. Can you give a concrete example of what the problem is?\n. This block of styles in codemirror.css gives you all the token styles that you should define in a typical theme. There is no need to go through modes looking for token strings.\n.cm-s-default .cm-keyword {color: #708;}\n.cm-s-default .cm-atom {color: #219;}\n.cm-s-default .cm-number {color: #164;}\n.cm-s-default .cm-def {color: #00f;}\n.cm-s-default .cm-variable {color: black;}\n.cm-s-default .cm-variable-2 {color: #05a;}\n.cm-s-default .cm-variable-3 {color: #085;}\n.cm-s-default .cm-property {color: black;}\n.cm-s-default .cm-operator {color: black;}\n.cm-s-default .cm-comment {color: #a50;}\n.cm-s-default .cm-string {color: #a11;}\n.cm-s-default .cm-string-2 {color: #f50;}\n.cm-s-default .cm-meta {color: #555;}\n.cm-s-default .cm-qualifier {color: #555;}\n.cm-s-default .cm-builtin {color: #30a;}\n.cm-s-default .cm-bracket {color: #997;}\n.cm-s-default .cm-tag {color: #170;}\n.cm-s-default .cm-attribute {color: #00c;}\n.cm-s-default .cm-header {color: blue;}\n.cm-s-default .cm-quote {color: #090;}\n.cm-s-default .cm-hr {color: #999;}\n.cm-s-default .cm-link {color: #00c;}\n. > coffeescript.js : punctuation, error\nI forgot to copy-paste the \"error\" style. It is there in codemirror.css. Punctuation isn't styled by the default theme, but indeed, it would make sense to mention it anyway.\n\ncss.js : meta, interpolation\n\nMeta is there. Not sure where you are finding \"interpolation\".\n\nmarkdown.js : em, strong, emstrong\n\nThere are assumed to be the same for all themes (simply make the font bold/italic), though of course you are free to override them.\n\nxml.js : word, equals\n\nNeither of these are actually returned as token styles by the XML mode.\n\ndiff.js : positive, negative\n\nThese are in the standard styles, but most themes don't bother to redefine them, as they only apply to the diff mode.\n\neiffel.js : ident\n\nAgain, not actually returned by this mode.\n\nerlang.js : special\n\nThat appears to be a mistake in the Erlang mode. It shouldn't be returning a style that the themes don't support. Fixed in attached patch.\n\nplsql.js : plsql-string, plsql-comment\n\nThe plsql mode doesn't exist anymore in the current codebase. (It has become an subdialect of the sql mode).\n\nr.js : arrow, arg-is, dollar, semi\n\nLooks like the people who contributed this mode wanted to do some extra styling. Still, the editor works just fine if you combine this mode with a standard theme, you just won't get specific styling for these elements.\n\nAnd tokens can have various definitions according to languages, so I'll likely have various styles\nfor each parser according to user.\n\nLook into http://codemirror.net/doc/manual.html#option_addModeClass for this.\n. Thanks for noticing that. Merged as e496a0d\n. Since this is not happening in the demos on the website, you'll have to provide some (minimal) HTML file that demonstrates the issue if you want us to debug this.\n. There was a race condition where the (lazily updated) diff hadn't been recomputed yet, so you'd end up with a diff that didn't apply to the current code, which I think is what caused the error. Could you try with attached patch?\n. I couldn't reproduce the error in the demo at all, but looking closer at the stack trace, I think I have reasonable theory of what went wrong -- though I don't know how that could be triggered without actually changing the document, which it seems your demo does not do.\nCould you try again with attached patch?\n. Ugh. Sorry for the repeated patches that miss the point (though they also fixed real issues\u2014just not the one you reported). Attached patch is another attempt. mark could indeed be null. With that patch it shouldn't be possible for that to happen anymore.\n. The next release will be around the 20th of the month. Doing a manual patch for this should be safe (the change does not impact anything else).\n. I can not reproduce this on Chrome 34 and FF 30 Linux. I can scroll down exactly as far as you would expect. Seems your Chrome is handling scrolling absolutely positioned elements into view differently, for some reason.\n. Odd. I tried windows (8) too (IE11, Chrome 33), and didn't see the issue there either. I can kind of imagine what is happening, but it is odd that I can't reproduce the problem.\n. And the both of you are simply loading that demo page, and immediately seeing a scrollbar?\n. > Technically there is no scrollbar\nAh, now I see what you mean. I assumed \"scroll down the editor\" meant there would be a scrollbar.\nYes, I saw that patch, but you already noticed that it causes a problem.\n. Does attached patch solve the problem for you? It's slightly hacky, but as long as you don't set a ridiculously large padding below the document, it should work fine.\n. Superseded by 3be0f06e00f\n. Only a few (or only one?) modes define the properties you are reading here, so it most certainly won't work for any language. It would be preferable to make the mode you are interested in define a \"hintWords\" helper (see for example mode/css/css.js) using its keywords/builtin list.\n. There is such a fallback mechanism in the \"auto\" hinting function, which will be used by showHint when you don't specify a hinting function explicitly. Reusing the words in the mode files is a matter of adding a call to CodeMirror.registerHelper(\"hintWords\", modename, [array of words]) to the mode file. Though it seems there is no easy way to associate different word lists for different subdialects of a configurable mode (such as clike) yet. I'll look into that.\n. The clike mode already had some code to enable trivial completion for these languages, but due to a coding mistake it wasn't enabled for Scala, C#, and Java. Should be better now, with attached patch. I've also enabled autocompletion (Ctrl/Cmd-Space) on http://codemirror.net/mode/clike/ for easy testing.\n. Is the difference between the code snippets simply that you removed the maxHighlightLen check?\nCan you provide a case where it goes wrong, so that I know what kind of problem you are trying to solve?\n. I see what you mean now. The subtle thing is that we don't want to highlight brackets in red when the scan reached the maximum line count and gave up. Attached patch should sort things out. Please test.\n. Given that it's resolved, let's close the issue.\n. Yes, this is a known limitation. The editor assumes it is not rotated. I think in this case, simply calling .refresh() after you've finished rotating it back should fix the problem (it does when I do it from the console).\n. Making initialization while transformed work would require making actual editing work while transformed. This would violate a bunch of assumptions (such as that lines stretch along the y axis), and though it would be cute to be able to edit at 45 degrees, I do not feel that this feature would be worth the added complexity -- which would be quite a lot.\nStill, if you think you have a sane solution to the problem, feel free to propose it.\n. My main concern is performance. Something like doing multiple calls to getBoundingClientRect and messing with the element's style in between is definitely not going to work (it'll force multiple relayouts). Measuring of layout is already a major cost in CodeMirror. Also, there are several places where the fractional results returned by getBoundingClientRect (but not by offset properties) are required for correct operation.\n. Only having this recomputed on refresh() would be perfectly okay -- that's how CodeMirror treats other CSS as well (changing the font size will screw up your editor until you refresh it).\n. Duplicate of #2443\n. Ah, the body text of the issue was so similar to the other bug that I assumed you double-submitted.\n. Still, the underlying issue is exactly the same, so I suggest we do move discussion to the other issue entirely.\n. Thanks. Merged as 72f0086 (without the trailing whitespace)\n. I am not sure why I didn't respond to this sooner (probably forgot to mark an email as unhandled). But with current Chrome and current CodeMirror versions, the script you provide does not cause any visible glitches. Please comment if this issue still exists for you.\n. Should be better now. It might be that there'll be more weird mode quirks like this surfacing now that I inserted the check. I rigged the test suite to report the problem as well, which turned up a similar bug in the haml mode, but not all modes have tests.\n. Thanks for the patch. But dividing by defaultTextHeight will mess up when some lines contain characters or styles that don't have the default height, or when lines are wrapped. Use the lineAtHeight method (cm.lineAtHeight(scrollInfo.top, \"local\")) instead.\n. Thanks! Merged as 90e0c283f7ba , and cleaned up in attached patch (coding style, and making sure it behaves correctly on wrapped lines)\n. Yay. More URL regexp madness. @bfrohs do you have time to take a look?\n. See #2520\n. 9b1fe0c should address this. Though do test it in your system, it looks like it might have some other effects.\n. Wonderful. Merged as 981a01f\n. It's in the list of flags in Chrome 34 linux, but can't be enabled (\"not available on your platform\"). Will it come to Linux? In which version?\nIf this works similarly to the OSX overlay scrollbars, the fix might simply be to remove the mac_geLion part in this line:\nif (mac_geLion && scrollbarWidth(d.measure) === 0) {\n. Well, the condition was there mostly to prevent the hack from causing potential trouble on platforms that don't have overlay scrollbars. Attached patch cleans up the hack a little and enables it for all platforms.\n. (Let me know whether it works for you)\n. Argh, my test (which made me conclude this was fixed) was off. This is indeed still happening. I'll revert the patch that kill the hack. That should indeed not cause any trouble, apart from #2384 (which I haven't been able to reproduce).\n. Reverted in attached patch. Closing this, reopening #2384\n. Indeed, I missed the go mode when adding folding info. Merged.\n. Not yet. It would be cool (and definitely possible) to have an adapter that compiles a PEG syntax down to a CodeMirror mode. But the raw parser output by PEG.js can not, I believe, be used for such a mode, because it isn't incremental (you can't have it parse one token at a time). I don't have much experience with PEG.js, so correct me if I'm wrong.\n. Anyway, this is not an issue. Please use the mailing list for discussion, and this tracker only for bugs.\n. Well, a Google group (https://groups.google.com/d/forum/codemirror) that I hope to move to a real mailing list at some point (now that Google is starting to force everyone to use google accounts to participate).\n. Adding !important to rules rarely improves the quality of a style sheet, in my experience. Looking at the code, cm-error is defined below cm-tag, so I don't see why it wouldn't already override that rule. Did you diagnose why this went wrong, precisely?\n. The code at https://github.com/GoogleChrome/text-app/blob/master/css/theme-dark.css doesn't follow the order of the monokai.css in the CodeMirror distribution. Either someone hand-edited it, or a tool mangled it, but the problem does not exist in CodeMirror itself, so I am not going to accept this patch here.\n. The problem is that highlighted text's token types are off (highlighhing\nclass is included), which causes the matcher to consider it a non-matching\ntoken. It would be better if getTokenTypeAt ignored overlays. I'll see if I\ncan come up with a sane solution.\n. Attached patch should help. Please test.\n. You might want to steal the approach in the clike mode. It doesn't fully parse the code (as the JavaScript mode does), but keeps a list of keywords that cause indentation. It then has some magic in its indent method to handle the various brace styles.\n. It appears to be based on the JavaScript mode to begin with. Maybe we can pull @Dr-Emann , the original author, into the discussion?\n. Indenting after statements that start a new block is actually perfectly sane behavior. The electricChars feature should take care of bumping your opening brace back to where it belongs.\n. I've merged your change as 6c4d105. Please verify that it still does what you want.\n. (Generally, don't put merge commits in pull requests -- rebase on top of the current code instead.)\n. Patches for the 3.x branch are still accepted, and I'll try to merge all fixes that are easy to merge into it (which is probably not be the case for these fixes) before releasing 3.24.\n. Merged into v3.\n. Undo isn't expected to work (the browser doesn't know about CodeMirror's history), and I'm also seeing a problem with Select All.\nBut Cut, Copy, and Delete work fine for me on IE11.\n. Attached patch fixes select-all for me.\nPlease try again in http://codemirror.net/mode/xml . If all this is still broken for you, we'll have to figure out why it isn't broken for me. I test on Windows 7.\n. The real problem was that the way events for cursor activity were fired wasn't accurate, causing the show-hint addon to believe that the replacement you did (inserting \"# \") happened after the completion had started. It then aborted the completion because it looked like you typed a space. Attached patch fixes this. Please test.\n. Indeed, this was the CSS mode (in combination with the recently added requirement that each call to token advance the stream). Attached patch fixes it.\n. I've pushed 357cf2d instead. As the test suite shows, your patch breaks other cases.\n. I wasn't able to create a situation in which those ended up NaN, but it wouldn't surprise me if in some situations browsers will return nonsense in computed styles. Attached patch solves this in a way rather similar to what you proposed.\n. This looks good, on the whole. Some minor points:\n- Please try to rebase your branch so that it only contains the changes you made, no merge commits\n- I prefer not to have braces around single-line bodies.\n- Try to consistently use double quotes for strings, unless there is a reason not to (for example '\"' is fine)\nSince this is a rather subtle implementation, I'd prefer if you added tests. To add mode tests, add a file test.js in the mode's directory, and include it in test/index.html. See mode/javascript/test.js for an example of the format used by most mode tests. You can then go to test/#php_* to run only the tests for the php mode. Try to include some corner cases where this might go wrong, both to verify that it works, and to make sure someone notices when further changes to the mode or to clike.js break something.\n. Looks really good now. Merged as beb975f7e76c734 , and tweaked slightly in ef22935 (the added flexibility and indirection provided by a separate matchFirst function seemed unneeded).\n. This does sound like a refresh problem. I assume the editor is initialized in a hidden state, and then shown. Make sure you call refresh after the editor has become visible.\n. If you make the call to refresh at the actual time when it becomes unhidden, the refresh happens synchronously, and there will not be a visible lag. If you have a timeout or some other asynchronous event do the refresh call, then yes, you'll see something. You could put the editor in a visibility: hidden div with the same dimensions as its target parent, and let it draw itself there first, if you really have to, but I think making the refresh happen at the right time is a preferable solution.\n. It is not so much \"broken\" as \"not implemented\". I mean, the behavior isn't entirely insane, it just doesn't handle multiple cursors. And neither does Emacs. Formalizing a way in which Emacs functionality maps onto multiple cursors is not a priority for me. But, you know, pull requests welcome.\n. Please try to communicate in a way that someone who isn't inside your head can follow.\nAs it is, I can't make heads or tails of your message. The fact that the lint option doesn't change the gutters is intentional. You must configure the gutter yourself (so that you can set its position) if you want a linting gutter.\n. The problem is not with that demo, but with the way the XML mode indented that (it tries to align the continued attribute to the start of the attribute, which isn't a good idea when the attribute is on a huge line). Attached patch should help.\n. Merged as cfebc98\n. I think the attached patch does what you describe. Please test.\n. Addressed by patches from #2538\n. Thank you. Merged as 736ec21\n. Attached patch fixes this for me. Please test.\n. Good point. Attached patch should help.\n. Thanks. Merged as 244a7bf\n. Looks great! Thanks for improving that mode. Merged as 0ffe3e9 \n. Damn, not sure how I missed that. Should be fixed in attached patch.\n. I've pushed a slightly different fix (d3ba3a2) which I find easier to reason about.\n. See d3ba3a2\n. Please try with afcbdb6b4cbbbd057706ff9e0eb4a4cec054c499 . The code that estimated the column of a given mouse position didn't handle mouse positions to the left of the document properly, and returned negative ch, which then messed up the selection data, causing the behavior you saw.\n. Oh, indeed, I should read all my emails before going off and fixing an issue. Oh well, my patch (afcbdb6) is slightly more efficient (no need to clip the line part, also, it might be that clipping the ch part to the line length causes regressions when dragging into empty space).\n. Thanks. Merged as 9fa870fef10b83, fixed a bunch of lint errors in d291fdb836b62\n. Indeed, that was a race condition that was harmless with the old code, but caused trouble since 6c22112b309a4e152c6f5849158c73b8b6e98b1a\nAttached patch should help. Does it work for you?\n. Here's how I reproduced before:\n- Open http://codemirror.net/mode/xml/\n- Select a piece of text\n- Repeatedly right click in that text\nThat caused the whole editor to become selected. After attached patch, that no longer happens. I'm on Chrome 34 (Linux). Are you doing something different?\n. You are right, there was still a window for the problem to happen, I just made it smaller. Attached patch should close it.\n. That sounds sane. Attached patch implements the same thing, but in a way that aligns more with the succinct style of the project.\n. @mightyguava (Original issue title didn't mention it, but this is about the vim bindings)\n. I believe I've found the issue --- I confused a == and != in a recent patch. Attached patch should help.\n. Yes. Again the context menu. Something tells me I should rewrite that, but to be honest, I am afraid to rewrite it :)\n. Oh, wow, the context menu stuff just keeps getting scarier and scarier. Attached patch fixes this one, at least.\n. Looking over textHeight, I don't see anything that can reasonably be expected to scroll the document. I'd like to see a reduced (CodeMirror-only) test case before I do further debugging.\n. Well, sure in your case it might still have worked, but I am not going to accept that change. The call is there for a reason (preventing bogus line heights when the font size changes), so removing it is not an option.\n. It seems the gutters were not being redrawn, though they should, obviously, if the line numbers are shifted. Could you see if attached patch works for you?\n. Can you give a minimal demo that illustrates the performance issue? How many editors are we talking about?\n. I see, that sounds like it should be fast. I'll look into it.\n. Right, I can reproduce the problem, and it is also clear what is causing it. Updating an editor forces two relayouts (after redrawing the text, it needs to get layout info in order to draw the cursor). For a single editor, that's plenty fast. But with this many editors, even though the changes made to individual editors aren't big, the cumulative relayouts take a noticeable amount of time.\nWhat is not clear is how to solve it. We could special-case updates that only change line numbers, and not read any layout info in that case (so that all the updates only lead to a single layout), but that's very narrow and kludgy, and would have to fall back to the slow path if the line number update changes the gutter width (when the amount of digits in the maximum line number changes). So I'm not really comfortable with that solution.\nA nicer solution would be finding some way to batch the update stages so that all editors redraw their text together, then force a single relayout, and then all update their selection. That'd touch a lot of fragile, tricky code, though, and thus take time and effort. You could take a stab at it yourself, or consider paying me to do it as a free-lance assignment.\n. The changes made in the context of #2558 should help here as well. I'm closing this, let's move further discussion to that issue.\n. Certainly! Merged as 1dc82bc\n. Merged as ae386fb3602 and d38aab86f994. When fixing up the coding style in 3984c5a, I noticed that you were never using your tokenLiteral function. You might want to look at that.\n. Thanks, but you missed the two other versions of this file. See attached patch.\n. Attached patch should help. But it does change quite a lot, so given the absence of existing tests for the Python mode, I recommend you test it before you believe it.\n. Try on http://codemirror.net/mode/python/ . If that behaves differently from your Brackets setup, you apparently failed to get the right mode file.\n. Could you give the text you're working with as text, not images, so that I can actually copy it?\n. Attached patches should help.\n. You have to call refresh when un-hiding a CodeMirror editor. See http://codemirror.net/doc/manual.html#refresh\n. Thanks. Attached patch should help. Do test.\n. Emacs behavior (which the transposeChars binding is supposed to implement) is to transpose the start character with the end of the previous line when at the start of a line. Implemented in attached patch.\n. Thanks. Merged as b614431\n. I prefer not to have a build step needed for the code in the CodeMirror distribution. Did you see if the needed file is available on some CDN? Alternatively, if you are going to rely on require, why not just add \"asm.js\" to the addon's own list of dependencies, and raise an error when trying to load it without CommonJS modules?\n. Having the build step in the package.json file is still a build step. Why not just add the dependency to the CommonJS shim in your addon file, and add a note for people that explains that you'll have to browserify the file to get it to work?\n. I actually think it'd be better to just put this in a different repository, not in the main distribution. That way, you can set up your package.json in the obvious way, and people using the main distribution won't be confused by the fact that one of the addons has to be set up in an odd way. Make sure you add a link to https://github.com/marijnh/CodeMirror/wiki/CodeMirror-addons\n. (There are no plans to work on this.)\n. Those patches are still not in master. Could it be something went wrong? I did not, as far as I know, force-push to github in the past hours.\n. Oh, right, there they are, on top of the stuff I just pushed -- I was not expecting that. Sorry for the noise.\n. The <command> HTML tag does not take a closing tag (see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/command). Switch to XML mode if you are not editing HTML.\n. I don't see how a mode test that's expected to fail makes sense, and you don't seem to be using any.\n. Thanks! Merged.\n. It should be possible, but it's not a feature that the current folding addon handles.\n(If you want to implement it, you'd have to make the fold toggles zero-width bookmarks widgets that you place directly in front of the start of the text, and use styling to make them appear to the left of their actual positions)\n. Attached patch should help.\n. Right, it was scrolling the wrong position into view. Attached patch should help.\n. Thanks, merged. I've followed up with attached patch, fixing some minor things and adjusting the field value to what I changed it to in the ujs service.\n. Thanks! Merged as 96d99ed\n. This appears to have been fixed sometime since this bug was filed.\n. Fix merged in #2526\n. The version is in the code itself (check CodeMirror.version), and also added in a header when you compress with http://codemirror.net/doc/compress.html . The license isn't currently in there, and I don't think putting that in every file is a very good idea.\n. > Not so handy if using the source code directly, or compressing or concocting with own-rolled scripts.\nIt is still in the code though, so you can always find out the version of a file you have.\nAs for the header comment, I am not really interested in doing that, keeping those intact throughout a whole program requires a lot of care and patch-amending, and I don't think the are that valuable.\n. Indeed, that was wrong. Merged your fix as c26ba1c\n. Agreed. Merged as 9b1fe0c\n. Attached patch should help. Please test.\n. Wonderful.\n. Would a comment linking to the license and source suffice for this purpose?\n. This is a dependency for a single addon, only used to make the demo work. I don't really want to include more junk in the distribution for its sake, and will just find a CDN that's serving this file instead, if having it in the distribution is such a problem.\n. Seems harmless enough. Merged!\n. Thanks, merged as a0bd442\n. This does not look like a very good idea. Do something with the module loader shim at the top of the file if you really want to fix this.\n. Adding jshint as a dependency in the AMD and CommonJS shims, and simply reading it from window in the fallback case, seems like a reasonable solution. That way, people who care about global namespace pollution can use a module loader.\n. I think we should just call it \"jshint\". Npm will install JSHINT under that name, and RequireJS allows you to configure custom paths for such names.\nAs for shipping 3rd party code with CodeMirror, I prefer to avoid that (it adds headaches with updating to new versions, licenses, etc)\n. Try this in some browser's dev tools:\ndocument.body.innerHTML = \"<p><div></div></p>\";\nconsole.log(document.body.innerHTML);\n// \u2192 \"<p></p><div></div><p></p>\"\nOpening a <div> will close the <p>, so that last </p> doesn't have anything to close. Coloring it red is a feature, not a bug.\n. Indeed it does.\n. Move on to current head, the steam advancement requirement was relaxed again. Several obscure modes were broken in 4.1\n. Current master should be stable, and yes if you need these modes I recommend that you advance to it.\n. Could part of this be caused by a throw-scroll continuing to move the scroll position after it has been reset to the bottom of the document? That is something I'm seeing if I press a key that scrolls the cursor into view during a throw scroll.\nMy Mac doesn't throw-scroll (too old), and my Windows setup is a VM on top of Linux (and thus with throw-scrolling coming from Linux's mouse driver), so that I may not be able to reproduce the circumstances that trigger this.\n. Now that I think about it -- yes, there is definitely a rather obvious error case there, exactly as you describe it. The measurement of wheel deltas happens over 200 ms intervals, which is plenty of time for the user to hit a key that ends up scrolling the document somewhere else.\nCould you see if attached patch helps for you? (I couldn't reproduce it to begin with, so I can't conclusively test.)\n. Thanks for fixing those! The changes look good. Merged.\n. Attached patch should help.\n. Hi Tom,\nSince it is getting clear that jumping to implement every feature that users ask for, while good for the project, is taking a huge chunk of my time, without helping much when it comes to income, I'm going to try a new model. I've set a (small) bounty for this on bountysource.com, and will implement what you describe if it is pledged.\nhttps://www.bountysource.com/issues/2007130-matchhighlighter-don-t-highlight-selected-matches\nBest,\nMarijn\n. Added to https://github.com/marijnh/CodeMirror/wiki/Mode-wish-list . We don't keep open issues for mode requests.\n. Could you see if the attached patch implements the feature the way you want?\n. Thank you! Merged.\n. Added to https://github.com/marijnh/CodeMirror/wiki/Mode-wish-list . We don't keep issues for mode requests, but feel free to contact me about free-lancing an implementation.\n. No, this has always been a feature. If it's giving you a headache, simply don't rely on a default mode by always passing in a mode option.\n. Is this the same problem as #2528 ? Does the patch provided there help?\nIn any case, your fix is not acceptable -- it simply hides a symptom, without actually handling the underlying bug.\n. Commit 01e844f09eb74ad55a98 should help.\n. Yes, since the Ruby mode does not, like the JavaScript mode, have a full, context-aware parser, there does not appear to be a solid way to notice the difference between a division operator and the start of a regexp. It uses the crude heuristic that a slash not followed by whitespace is probably starting a regexp. If you can think of ways to improve this, do suggest them.\n. You should ask the people responsible for the ckeditor project. This is the CodeMirror bug tracker.\n. Attached patch should help.\n. Thanks, merged! Would there be a practical way to automatically extract all of these from the spec?\n. Thanks for noticing that! Merged as a5b79b5\n. Thanks for isolating that. Attached patch solves it for me. Please test!\n. Thank you. Merged!\n. Good idea. Implemented in attached patch. I made it possible to hold ctrl while starting the drag, since creating a new selection inside an existing selection isn't a particularly useful feature.\nDoes it work for you?\n. Attached two patches should greatly improve drag-drop on Firefox.\nAs for middle-click paste, that's unfortunately not something that Firefox make possible (it doesn't fire any events we can capture when this happens, whereas Chrome fires a regular paste event.)\n. Attached patch should improve the situation.\n. See also #2498\nThis is something I'd like to support, and I think it should be doable, but it'd be a delicate thing to implement, and I am currently too busy to implement it for free. If someone wants to create a pull request or pay me to build this, that'd be welcome.\n. Patches b55cc7f5cd0b through e72560be1296459765 try to implement this (along with fixing a few other situations that would force layouts). Please test!\n. Which code are you looking at?\n4.1 and below have a poll function that runs every 500ms, and unregisters the handler if the editor is no longer in the document. You could still cause a serious leak by creating editors in a tight loop, but that seems like an uncommon use case.\nThe current code on the master branch no longer has the per-editor event handler at all, and uses getElementsByClass name to find the editors that are currently part of the document.\nDoes that answer your concern?\n. You don't even need the widget to get this effect. To prevent the cursor from getting \"stuck\" at a collapsed range, the code that pushed it through such ranges takes the default direction to push from the cursor's old position. I.e. if you move to a position ahead of your current position, it'll jump to the end of any collapsed ranges it touches, whereas if you move backwards, it'll jump to the start.\nFor some calls to setCursor and other selection-changing methods, which aren't handling cursor motion, this is inappropriate. But for others, it is necessary. So it is not obvious how to solve this. At some point in the past, bias was an explicit argument to some selection primitives. But people forgot to pass it, and it seemed too much of a burden to place on API users, since it is obscure and usually not interesting.\nWe could support it through the options parameter that selection methods take. In your case, would being able to turn off this behavior (and simply always jump forward, for example) solve your problem?\n. Should work now. See the docs and test case in the attached patch.\n. @MasseGuillaume Can you create a minimal demo of the issue on jsbin.com (or a similar site)?\n. The problem appears to be that you also have to either .refresh() the outer editor, or call .changed() on the range object returned by markText, to inform the outer editor that the size of the widget changed (because cmi.refresh() was called), so that it can update its line height information.\n. @MasseGuillaume Yes, there are several donation methods listed on http://codemirror.net (below the demo editor, on the right).\n. I don't know why this particular problem happens in quirks mode, but CodeMirror only supports full standards mode, so any bugs you'll run into in quirks mode are expected, and won't be fixed.\n. Could you set up an HTML document for me that make it easy to reproduce this problem?\n. Where are you getting Chrome 36? The current beta download appears to be 35.\n. Ah, 36 is only available for Windows and OS X. I'll get my macbook.\n. Ookay, Chromium beta says it is up to date on version 35 (also on OS X), whereas Canary is at 37. 37 on OS X does not seem to have the problem you describe. Could it be they already fixed the bug that triggered it?\n. There appears to be a bug in Chrome where, when CodeMirror's measureForScrollbars is called, the browser itself still believes that is should be showing a horizontal scrollbar (I can observe it taking up space, even though the HTML does not contain anything wider than the viewport width), and only after the next relayout (triggered by the drawing of the selection and scrollbars) does it figure out that it doesn't really need one.\nIt's hard to work around this in a way that doesn't also cause false negatives (not showing a scrollbar when there should be one, which looks just as crummy).\n. Attached patch seems to address this case. Please test.\n. Giving a background like that will break selection anyway, so moving the cursor forward is not a real solution (and will break a wide cursor, as the vim mode shows it).\nSo using backgrounds on marked ranges is simply not supported, unfortunately.\n. Ah, you are using mark-selection.js. That is a decent workaround. What you're doing might actually be a path towards properly supporting background styling. I'll think about it a bit more.\n. Won't this cause a bug when removing a class, as the existing ones on the element will 'stick'?\n. Yes, calling addLineClass is something that you are not allowed to do from a \"renderLine\" handler, for the reasons you discovered.\nAttached patch seems to solve the issue in a less problematic way. Could you test it?\n. This addon makes the editor take up the whole window. Despite the addon's name, switching the browser to full screen is another, orthogonal feature, and I don't see the value in tangling it up with this code.\n. Attached patch should address this.\n. No. CodeMirror is a text editor, not an HTML editor. You can use the markText method 1 to style pieces of the document.\n. You can't focus the editor with this setting, so there is no way to have copy work (browser will only send copy events to focused elements).\nYou can probably get what you want by setting readOnly: true, and hiding the cursor (.CodeMirror-cursor class) with CSS.\n. I don't use bower. I don't think having another thing that tries to do what npm does is very helpful.\nThus, I am entirely dependent on the information users provide me about bower. I was told the version doesn't need to be there, since bower can look at package.json.\nSo you're saying this is not the case?\n. Okay, adding it back isn't much trouble, now that I use a script to keep all the places where the version is mentioned in sync. It was simply a \"version\" property at the top level of the file, right?\n. Done in 49ea6ad\n. Thank you, good catch. Merged.\n. Indeed. Merged!\n. Good point. Done in attached patches. You might be able to backport them to 3.x, or just upgrade to the current code.\n. That's a good point. Patch 31b9f1b moves it.\n. Is this widget display: block? If so, does making it inline-block fix the problem?\n. This is apparently a 4 year old bug in Webkit and Chrome. See http://stackoverflow.com/questions/2316098/prevent-inline-block-from-wrapping-on-white-space-pre and https://bugs.webkit.org/show_bug.cgi?id=35443 . Adding an :after element to your widget (http://jsbin.com/oQuBAmIJ/1/edit) should work around it.\n. Yes, I think tracking your own gaps, if you need them, is the way to go. It is very possible that something changed in the exact pixel values returned by charCoords and similar, since the way characters are measured was overhauled. But what comes out now is what you'll have to live with -- the implementation is very much constrained by browser support, performance, and application demands.\n. Attached patch should help. IE was, somehow, setting the buttons property on the event to zero in this case, even though the buttons were still perfectly pressed.\n. The default autocomplete strategy will use getHelpers to get local mode-specific completion, so your explicit code for this purpose isn't necessary. Just load the relevant completion addons (or just rely on the modes' own \"hintWords\" definition), and use showHint without passing an explicit completer.\n. That does seem sane. Merged for now as c09f54c. If @mightyguava sees a problem when he returns, he can always add another patch.\n. You could do this with the multiplexing mode wrapper (http://codemirror.net/doc/manual.html#addon_multiplex). But yes, it'd require some study of the documentation for how modes work. In any case, this doesn't really belong in the bug tracker.\n. I am not sure how I failed to respond to this. Apologies for that. I think a more lightweight solution is to fix the unfold markers so that they work even if the foldable range is no longer there. Attached patch does this.\n. I initially copied this behavior (showing highlight even when there is a selection) from ACE. But they seem to no longer do that, so I guess it's a good idea for CodeMirror to also make this change. Merged as fac9456\n. Are you getting this issue with a recent version?\nAlso, how are you highlighting those words? It does look a lot like you're using overlays built with charCoords. This is not something CodeMirror itself does, and the bug might be in the 3rd party code that's drawing those.\n. CodeMirror tries to respond to resizes every 100 ms, so your 500 ms delay should put you in a safe range.\n. Thank you. Merged as d091604.\n. Many of the classes should simply not be touched (below the /* STOP */ marker. The others have some comments, and descriptive names. A section in the manual for writing a theme would be useful, I guess.\n. The logic of whether a handler handles a given key event is in our code, not in Firefox. I'm not familiar with the way the vim bindings handle things, but in regular CodeMirror, a key bound to \"W\" won't be fired when the key event's ctrlKey property is true. I do suspect a bug in the vim code here.\n. Aha, it's a CodeMirror core bug after all. Firefox fires keypress for ctrl-w and similar key presses. Attached patch makes CodeMirror ignore such events.\nA similar issue exists for alt/meta, but it is common for OSs to use alt or meta combinations to type special characters, so there it doesn't seem like a good idea to turn off this handler entirely.\nDoes this patch solve the problem for you, @allouis ?\n. Ah, right, attached patch also handles the mac Cmd key case.\n. If the screen shot actually corresponds to the bug you are trying to describe, the < is obviously not in a script, but in regular HTML code... where < does have a special meaning, so the behavior of the mode is perfectly reasonable.\nAm I missing something?\n. This is valid HTML:\n<\n  p> blah </\n  p>\nCodeMirror modes can't look forward across line boundaries, so requiring them to see the tag name when seeing < would be problematic. Just escape your less than signs.\n. Set the white-space style of the container that contains the code to pre-wrap.\n. You appear to have killed the branch that this originated in. It's a good patch though. Where can I pull it from?\n. This is a known bug in 4.1. Upgrading to 4.2 should fix it.\n. Thanks! Please verify that it still does what you want with the simplifying followup patch attached here.\n. Bind \" in the same way that that demo binds =?\n. Thanks. Merged as 68cae68\n. Thank you. Merged.\n. Indeed, I wrote = where I apparently meant to write +=.\n. Thanks! I didn't really understand the issue from the original bug report, but looking at the patch, I see how this is clearly helpful. Merged as 247f705 \n. You can't insert HTML in an editor. You can insert a widget, which is a dom node, but that won't be selectable and editable as text. You can also listen for events on the token nodes, and react to those. But there will never be a feature like you describe -- it just doesn't fit with CodeMirror's model of how a document is shown.\n. Also, unless you are paying for support, don't bump threads. It is annoying.\n. I guess folding is widely used, and it would make sense to promote these styles to the \"core\" css files, and include them in the themes. It's sort of hard to draw the line, though. With N addons that need styling and M themes, we need M\u00d7N styles to be specified, and pulling all of that into the core css file and the themes kind of kills the concept of modular addons.\nNot sure how to handle that. I guess I'll continue allowing stuff to leak into the core css as long as it isn't too big. I'll try to follow up with a patch for this issue soon.\n. Attached patch adds styles for gutter markers to all themes, and changes the folding css and js to use the CodeMirror-guttermarker-subtle class to pick a color for the folding indicator.\nDoes this fix your problem?\n. This seems too specific for inclusion in the main distribution, but I'll keep it in mind if similar use cases come up in the future.\n. Attached patch should help.\n. Added to https://github.com/marijnh/CodeMirror/wiki/Mode-wish-list . We don't keep issues open for mode requests. (You can pay me to implement a mode, if you are in a hurry.)\n. I've pushed this to the v3 branch, but note that there probably won't be any more releases from that branch. As for 4.x, I'm sure you'll run into some issues there, since you appear to be doing things that are rarely tested, but they are likely to be different issues from the 3.x code, so just report back when you know more.\n. This is by design -- when a closing bracket ends up on a line by itself in an 'aligned' piece of bracketed code (where the content is aligned with the opening bracket), the mode puts the closing brace in the same column as the opening bracket.\nJust press shift-tab, or whatever LightTable binds indentAuto to, to reindent a line.\n. The mode currently doesn't do the kind of detailed parsing that would make this easy. I can make the behavior configurable on the mode level, but I guess that might not help much, since it'd be non-trivial to configure this from Light Table?\n. That's odd, but I think fieldsets are supposed to display as regular blocks, so if they cause width: 100% (CodeMirror's default width) to malfunction, that seems like a Firefox bug, not a CodeMirror bug.\nMaybe you could create a reduced testcase and report it at https://bugzilla.mozilla.org?\n. I believe this is what you are looking for: http://codemirror.net/doc/manual.html#option_flattenSpans\n. Figuring out whether a span has a given display style would require first adding it to the DOM, then querying its computedStyle, and that for every span we add. That would require lots of relayouts and be impractically slow.\n. Where would it look for block? In the style name? That seems a little magical.\n. That wasn't sarcasm, and getting angry does not help your case at all. To find out what styles a CSS class produces, you have to use computedStyle. Doing that for every token is hugely expensive.\nI do not understand your workaround. What is a tick class?\n. This is already possible. You can style the CodeMirror-cursor CSS class to influence the way the cursor is displayed, and use the cursorBlinkRate option to control the blinking (set to zero to disable blinking entirely).\n. Your hypothesis that the measure div doesn't reserve space for the gutter can't be correct -- that would result in a lot more incorrect measurements.\nCould you give me a test case that demonstrates this problem?\n. I've pushed a slight variation of the patch you linked. I still couldn't get your demo page to fail, but the last version of your failing test does fail on my system, and your logic makes sense, so I've integrated the change.\n. Thanks. Merged.\n. Thanks for finding the source of that! Merged as 357e9411a001\n. Thank you. Looks good -- merged.\n. Your test doesn't fail, for me on Chrome 36 or Firefox 32. As such, I'm still not really able to understand the problem.\n. I'm on Linux. No hidden scrollbars here.\nI am under the impression that the measure div, sitting in a DOM position very similar to normal line divs, will have the same width, without the need for any further kludges. If that's not the case, it should probably be addressed.\n. Merged via #2611\n. Could you set up a minimal demo HTML page that helps me reproduce this? I can't think of a reason, off-hand, why this would be happening. If you isolate it for me, I'll try to debug.\n. Resolved in #2650\n. Does the attached patch fix this for you?\n. My position on continuelist is that I'm sort of sorry that I accepted it into the distribution -- it's a very special-case tool, and I have no time or interest to support it. Pull requests welcome, but I'm not going to work on this myself.\n. Fixed through  #2868.\n. Attached patch should help. But do verify, if you have a moment.\n. Sorry, push didn't go through due to connectivity prob. Try now.\n. Good point. Attached patch should help.\n. Where did the error that caused the problem originate? I don't think any user code is being called from the block you wrapped in try.\n. A stack trace would be very helpful, yes, since I'd prefer to solve the underlying problem, rather than making it sort of not have too disastrous effects.\n. It appears to be safe to move the update of delayedCallbackDepth to before the meat of endOperation. See attached patch. Does this address your concern?\n. You appear to have deleted the repo that this originated from. Too impatient?\n. Heh. MIME types continue to fail to live up to their promise of associating a single string to a given file type. Merged.\n. That was a bug. Attached patch should help.\n. The fact that the directive you added tells the package manager to ignore everything except the lib/ files tells me that this probably won't be much use to anyone. CodeMirror is a project where each use case will want to require different addons and modes, and package managers that don't track local dependencies (browserify-style) won't be much use. Thus, I am not sure I want to merge this.\n. You are still ignoring directories what contain useful resources (keymap and theme).\nHow would someone use this? What is the mechanism by which an SPM user would include the parts of CodeMirror she needs?\n. Repeating my question:\nHow would someone use this? What is the mechanism by which an SPM user would include the parts of CodeMirror she needs?\n. This code looks rather scary. Could you at least add a test case?\n. Thank you. Merged!\n. You aren't including remotely enough information for me to reproduce this. Try to provide a full file (with unneeded cruft removed) that actually triggers the error.\n. I've tested this before, and tested again just now, and for me RequireJS (2.1.4) normalizes relative paths and returns the exact same object even if the dependency was specified with a different relative path.\nGive me an HTML file that reproduces your problem if you want me to look at this.\n. For home/end, I agree that the old behavior isn't desirable. Attached patch fixes that. For arrow key motion, which doesn't move to a fixed place but incrementally moves through the document, the current behavior is sensible -- it ensures that the cursor can't get 'stuck' on an atomic range, where multiple arrow presses don't move through it. It would probably be possible to add some more complicated heuristics to try and do the right thing in the case you describe, but I think any behavior will be surprising -- moving into a place that doesn't allow a cursor needs to be resolved by moving the cursor out of the atomic range, and that is going to look odd no matter what.\n. I have never seen this bug before. Can you reproduce it on a CodeMirror demo that doesn't include your code? Are you using the closebrackets addon? If so, does turning it off help? (That's the only piece of code in the distribution where I can remotely imagine that it might be having such an effect.)\n. Could you describe in a bit more detail what you mean by the gutter overlaying the editor? It is supposed to be shown in front of it. Is the scrolling you are talking about horizontal? Does the problem still occur with the current code in the git repository? (IE version detection was cleaned up recently)\n. Indeed, this was an optimization in the display update that was kicking in a bit too carelessly. Attached patch should help. Does it fix your problem?\n. Thanks for spotting that. I'm amazed JS engines even accept that. Merged as 5dc4423\n. Sorry for not noticing this. I guess I've kind of trained myself to ignore mails with [vim] in the subject.\nAs it stands, the speedup is indeed not enough to justify this change. Could you try wrapping the editor reset in an operation, and see if that helps?\n. Okay, let's just consider this a failed experiment then. Thanks for giving it a shot.\n. I agree with @sirex that it would make sense to conform to vim's behavior here. Even if there are arguments against that, users will expect vim's behavior from a set of vim bindings.\n. Thanks. Looks good, merged.\n. I'd be happy to merge a solid implementation that also takes care of restoring the old selection when the drag leaves the editor without dropping. (Also, the DOM munging in your code seems unneccesary -- setCursor is going to redraw everything inside of the cursor div anyway.)\n. When the editor is not focused the cursor isn't visible. That's probably what you were running into, but I don't see how messing with the cursor DOM nodes before setting the cursor could help, except maybe accidentally, as multiple dragover events trigger the same cursor position, thus preventing your setCursor call from redrawing the cursor when it was given the same cursor as in the previous event.\nShowing a dummy cursor might be the best solution, that way, you won't even have to touch the real selection.\n. Set up a ~500\u20ac bountysource.com bounty (or allow me to invoice that sum) and I'll take care of it.\n. You can call coordsChar, and look at the place that was clicked. The xRel property on a position returned from coordsChar can tell you whether the click was horizontally after or before the returned position, which you could then use to detect past-end-of-line clicks.\n. I can't reproduce this. Are you using a recent version of CodeMirror? Try with the current code in git. If the problem is still there, give me more precise steps on what you are doing to trigger the bug.\n. This does not happen in the demos on the website (at least in my IE9).\nCan you figure out what it is in your setup that causes it, and submit a test HTML document?\n. I think that if you want a more complex relation between the textarea and the CodeMirror instance, it is easy to just do your own replacement instead of using fromTextArea. I don't want to add extra complexity to this feature.\n. Indeed. The server mysteriously rebooted again, and I still did not get around to setting up an init script. Should be up again.\n. Thanks for tracking that down. Merged.\nAs for the other change, I was also freaked out by the dissonance between the comment and the code, and assumed, since the old version detection was somewhat error-prone, that the comment was more likely to know what it was talking about.\n. Thank you. Merged.\n. I think registering a \"mousedown\" handler which simply does preventDefault() should have this effect.\n. I am not really comfortable integrating this as an option, since its behavior seems pretty random. I already somewhat regret adding \"nocursor\" to the core, since it causes endless confusion.\n. I think in release 5, I'll drop \"nocursor\" entirely. It is not a very good feature.\n. What do you mean precisely by 'freezing'?\n. Thanks. Merged.\n. Hi, I've finally merged this (as c7d8087). Note that when you push new patches to a pull request branch, I am not notified, so I'm unlikely to see them. Better to follow up with another comment.\n. The linter (bin/lint, requires nodejs) spots a bunch of accidental global accesses in your code. Please correct those.\n. Well, yes, but the sublime tests are still not passing. I'd really appreciate if, next time you submit a pull request, even if you're not going to add tests, you at least run the existing tests.\nMerged as 0abae990ec1e9, bug fixed (hopefully in a sane way) in da716e0bda0a00429f\n. Works for me. Which browser, and what is going wrong?\n. Firstly, the test should happen before anything is done, so that we don't needlessly pollute the undo history. Secondly, I don't think checking for a null token type is at all the right way to go about this. Many languages give punctuation like parentheses a token type of null, so this'll completely break closebrackets for those languages. Lastly, I really don't want to enable this for non-single-quote characters. Sad smilies are not a common enough case to outweigh the convenience of having real parentheses closed automatically.\n. I just noticed that there is already code like this at https://github.com/marijnh/CodeMirror/blob/master/addon/edit/closebrackets.js#L59 . If we just also handle string tokens there, it would do what you want, right?\n. Try with attached patch. It might be a little too clever, but it handles all the problematic cases properly, it seems.\n. That might be a useful feature, but you still won't have a way to undo a drag-selection that adds a cursor.\nPull request welcome.\n. Attached commit should fix the regexp escaping problem. I should warn you though that this mode is written really badly, duplicating a whole bunch of stuff from the smarty mode, and generally looking like a mess. The demo doesn't even appear to work anymore (showing half the document in red).\nIf you have a test case for the error that you mention doesn't go away with the re escaping fix, please post it here.\n. Yep. This is #2443\n. see 73aaf3f\n. Indeed, the old code is buggy. Your code looks rather confused though. Does the attached patch also solve the problem for you?\n. You failed to mention which mode you are talking about. A mode can do this, but I guess the one you're using doesn't currently. I don't take feature requests, but if you want to, you can submit a pull request or pay me to add this feature.\n. Are you zoomed in? Could this be the same issue as https://groups.google.com/forum/#!topic/codemirror/vQbSh8BdMrk ?\n. Please test whether attached patch solves your problem.\n. Indeed, the kludge was being applied too eagerly. Attached patch should help.\n. Style patches are like this are very much not welcome for this project. I do not agree with Crockford on what JS should look like. And the bug you introduced is there because blindly changing == to === is not safe.\nI'll add a note to the contributing guide to hopefully prevent such time wastage in the future.\n. Indeed, this is a known limitation. CodeMirror needs to position some elements, such as the gutter markers, based on computed dimensions. If you do something with css that changes these dimensions, you have to call .refresh().\n. > Yeah, but there is no event after an editor is created, isn't it?\n\nCodeMirror instances are created synchronously -- when the constructor\nreturns, they are fully initialized.\n. Thanks! That was actually breaking the hintWords helper, not just causing inconsistency. Merged as bc9c42b\n. Indentation changes count as \"+input\", not \"+delete\", that's just how CodeMirror uses those origins. If you want to do something for which you need to know the nature of the actual changes, don't look at the origins, but analyze the added and deleted text instead.\n\nAs for the \"text\" and \"removed\" being swapped, I am very skeptical that this would be the case -- these objects are generated by the same code that generates other change event objects, and I don't see a way they could get those fields flipped.\n. Doe altgr turn on event.ctrlKey? Or is it counted as metaKey, and is c268cb836228be the actual guilty commit?\n. Ah, of course, I did have to deal with the fact that altKey+ctrlKey=altGrKey, at one point, but I guess I suppressed the memory. Attached patch should fix this. I will go wrong when people actually press alt+ctrl, but since the thing this early return fixes was already an obscure bug, I guess we can live with that.\nCan you let me know whether it works for you? (My keyboard has no AltGr)\n. Yes, I've seen this too. It is a bug in some version of V8. I don't think you can blame CodeMirror for it. I have to attach finally blocks. If a JS engine fails to correctly propagate exceptions through finally blocks, that is that JS engine's problem, no?\n. You've killed the finally clause, which kind of breaks thing that piece of code is supposed to be doing.\n. Put triple-backticks around code blocks to make github format them properly.\nRecent versions of V8 don't have this problem anymore (Chrome 32 shows errors thrown by modes just fine.)\n. I'm not testing against node-webkit, so no, but since it's supposedly using a modern webkit, I don't expect there to be much incompatibilities.\n. Could you tell me what value CodeMirror.lint.javascript holds in your\nenvironment? Is the editor using the javascript mode?\nOn Wed, Jul 2, 2014 at 5:33 AM, WhatFreshHellIsThis \nnotifications@github.com wrote:\n\nHello, I'm using a compressed CodeMirror script and attempting to enable\nJavascript linting functionality and getting the above error (all other\nadd-ons work, just not this one).\nIs it possible that linting won't work if a compressed all-in-one\nCodeMirror script is used?\nThe reason I ask is because I think I'm doing everything correctly with\nthe only significant difference from the demo page being the order of\nscripts loading because the lint demo example page shows the jshint script\nreferenced after codemirror.js and /mode/javascript/javascript.js but\nbefore /addon/lint/lint.js and /addon/lint/javascript-lint.js etc,\nhowever I'm using the single compressed script:\n/* CodeMirror - Minified & Bundled\n   Generated on 1/7/2014 with http://codemirror.net/doc/compress.html\n   Version: HEAD\nCodeMirror Library:\n- codemirror.js\n  Modes:\n- css.js\n- htmlmixed.js\n- javascript.js\n- xml.js\n  Add-ons:\n- brace-fold.js\n- closebrackets.js\n- closetag.js\n- colorize.js\n- comment.js\n- comment-fold.js\n- css-hint.js\n- dialog.js\n- foldcode.js\n- foldgutter.js\n- html-hint.js\n- javascript-hint.js\n- javascript-lint.js\n- json-lint.js\n- lint.js\n- mark-selection.js\n- match-highlighter.js\n- matchbrackets.js\n- matchtags.js\n- search.js\n- searchcursor.js\n- show-hint.js\n- trailingspace.js\n- xml-fold.js\n- xml-hint.js\n  Keymaps:\n- sublime.js\n  */\n  ...etc..\nI've tried loading JSHINT before the CodeMirror script, and after but\nstill get the same error.\nThis is my config:\nmatchBrackets: true,\n                autoCloseBrackets: true,\n                matchTags: true,\n                showTrailingSpace: true,\n                lineNumbers: true,\n                highlightSelectionMatches: true,\n                extraKeys: {\n                    'Ctrl-Q': function(cm) {\n                        cm.foldCode(cm.getCursor());\n                    },\n                    'Ctrl-Space': 'autocomplete'\n                },\n                lint: true,\n                foldGutter: true,\n                gutters: ['CodeMirror-lint-markers','CodeMirror-linenumbers', 'CodeMirror-foldgutter'],\n                mode: 'javascript'\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/marijnh/CodeMirror/issues/2674.\n. Well, that's odd. The error is only raised when cm.getHelper(CodeMirror.Pos(0, 0), \"lint\") returns null. Maybe run that manually on your editor and see what it produces?\n. Might be some kind of race condition, depending on the way that you are\nloading the scripts.\u200b\n. The race condition would be between loading javascript-hint.js and initializing your editor. Since I doubt the initializing happens from the minified scripts, that's probably not it, if you're using a concatenated/minified blob.\n. Indeed, setting options one at a time like this will cause problems for a few options. It is also super inefficient. I'd say that this is a bug in the Angular wrapper, not in CodeMirror.\n. Thanks! Merged as afc1e5c \n. Thanks. Merged as 9826caf\n. Thanks! Integrated as fc3bb8f34b141f3\n. That's quite messy (what about square brackets? escaped parentheses?), but definitely better than what we had, I guess. Merged as 57761d0\n. Could this cause backwards-incompatibility problems for linters that return types that the current implementation normalizes to 'error'?\n. The JSON linter seems to omit the severity field entirely. We should at least default to \"error\" when no severity is given.\n. Looks good now. Merged as f02df0b\n. Thanks! Merged as 6c0cd2b\n. Attached patch should help. In the process of investigating it, I also reproduced the infinite loop problem, and fixed it (well, that is assuming I ran into the same infinite loop, but I expect I did).\n\nYou should be setting viewportMargin to Infinity for height: auto editors though, it'll save you a redraw cycle in cases like this (where it'll first try to draw a limited viewport, and then notice that the editor grew because it resizes to the content)\n. (Also, thanks for testing this code! And please let me know whether this patch makes things work better in the Brackets setup.)\n. Noted. The IME support needs work in general, but I don't currently have time to properly address it.\n. (If IME is important, consider setting the inputStyle option \"contenteditable\" in CodeMirror 5.0+. This should help, though it might introduce other issues since the contentEditable backend isn't all that well tested yet.)\n. Merged, with delVisualLine* renamed to delWrappedLine*, because the term 'visual line' already has another, completely different meaning in the CodeMirror sources (when a piece of code is folded, the line fragments before and after it end up on the same line, and this group of lines is then called a visual line).\n. Would simply having a max amount of allowed indentation be a workable solution here? When crossing this boundary, should the indentation be reset to zero, or to the max indentation?\n. Attached patch implements this, using 150 as the threshold.\n. On my Mac, control+up/down moves me into some kind of window picker (zooms out, shows other active windows for up, just slightly zooms out of the current window for down).\nDoes binding Ctrl-Up and Ctrl-Down to empty functions solve the problem?\n. Indeed, if I turn off the default bindings, I can reproduce this (but only for ctrl-up/down). What happens is that \u201cprivate area\u201d Unicode code points 0xf700 and 0xf701 are being inserted into the textarea (normal textareas have this problem as well). I have no idea what the intention behind this might be, but it is easy to suppress such input, as attached patch does.\nDoes this solve the problem for you?\n. You can't. The DOM CodeMirror uses to render the content is ephemeral. It'll be redrawn all the time.\nYou may have more luck with the markText method. You can't add an atrribute, but you can add a class. But you didn't say what you wanted to do with this attribute, so I can't give you more complete advice.\n. Sounds like markText will work well, possibly in combination with coordsChar and getTokenAt\n. If you mean in the lint addon, you can configure that by passing it options.\nIf you mean in CodeMirror's own codebase linter, no, this project's coding style requires semicolons, and I'm only accepting code that includes them.\n. There is no existing code for this, but the parts of the API you should be looking at is the \"change\" event, probably also the changeEnd function, and the markText method.\n. Thank you. Merged as b61161b \n. I know very little about YAML, and did not write the original mode. I also couldn't make much sense of the spec you linked (I never saw such a convoluted cfg), but the attached patch seems to help. Could you take a look to see whether it looks sane to you?\n. I've tried to improve the regexp. It seems the YAML mode does not handle quotes at all, and in generally is extremely primitive, though.\n. Does simply adding a ? after the * in the regexp not fix this in a more succinct way? Why did you close the PR?\n. I am aware of this problem, but since we can't store extra meta info in the clipboard, I do not know of a sane solution. Do you have a proposal?\n. (Background: I hesitated to add this feature -- splitting pasted content across cursors -- at all, since it is fundamentally kludgy, due to the code's inability to determine what the user is trying to do.)\nAdding a special case for this specific situation does not sound like an improvement to me. I don't agree that it is a common case. Why would pasting multi-line ranges where the range is a single line ending in a newline be more common than two lines ending in a newline, or chunks of random size?\n. Keeping track of our own copying, so that copy-pastes within CodeMirror (on a single page) at least do the right thing is a good idea. Could you take a look at the attached patch, and tell me if it helps for you?\n. Sublime Text does not seem to do the multiple-of-clipboard thing you describe. Is there a precedent for it?\n. I'm only willing to do this for recognized selections that have a known set of ranges (not outside clipboard data), since the potential for false positives becomes a bit too high in the other case.\nThat does cause the problem that people will be surprised when this works from CM itself but not from Sublime Text or another external editor. I'm not sure how often such confusion will come up. I've added the feature for now, but am reserving the right to back it out at a later time.\n. So won't this have breaking consequences for existing users? (I know nothing about Bower)\n. Merged as ee088bc\n. There are no entry panes in CodeMirror. You're probably trying to report a bug in a project built on top of CM.\n. Could you try to isolate the factor that exists in SMC that triggers this? I spent a while trying to reproduce this (Chrome 36, Linux), without success.\n. I still haven't been able to reproduce this. Closing until further information comes in.\n. DFWP seems to completely disable all copy/cut/paste events. So yeah, if you install an extension that intentionally breaks browser functionality, it shouldn't come as a huge surprise that libraries that rely on that functionality break.\nThe hack with the dash existed because updating the hidden textarea's value with a large string used to be very expensive, so CodeMirror only did it when the selection is small or the user is about to copy or cut (in which case the browser needed to find it in the focused element).\nBut modern browsers seem to have much improved that, and since this was a fragile hack that is now, apparently, not that necessary anymore, I've removed it in attached patch.. This code is needed to make the \"select all\" action in the context menu work. If you can show me a way to reproduce this in the demos on the website, or in some (minimal) HTML page you supply.\nHow does the Dojo context menu work? Does it replace the normal context menu?\n. Timing this out due to lack of response.\n. I agree the current behavior can be annoying, but I don't want to include this solution, which is somewhat invasive, as a implicit part of the default indentation code. You can define your own indentation command that first calls indentSelection and then patches up the selections, and bind a key to that.\n. My problem is that always expanding the selection on indent isn't necessary. Yes, I'd accept a patch that does only prevent the case where the indentation ends up directly in front of the selection.\n. The second part of this patch might be harmless, since it concerns styles that should apply to all CM instances. But the first one will make the padding, which many people override, more specific, and is very likely to break existing setups. In general, adding specificity (or, worse, !important declarations) to CSS rules to work around conflicts usually creates more problems than it solves in my experience. I think it's better if you just include your own CSS reset that works around the problem you are having.\n. Thanks! I've pushed a slightly modified version (2fa988d) that doesn't needlessly poke at undocumented properties, and also works when readOnly isn't the precise value true.\n. The problem probably stems from the way you are using getTokenAt. Tokens are defined as spans of text that the mode styles in the same way. If you want to look at more than a token, don't use getTokenAt, but do your own scanning of the code.\n. An autocomplete function can be a lot simpler than a mode. You might want to start from scratch, since 95% of the javascript hinter probably don't apply in your case.\nI'm closing this, since it is not a bug in CodeMirror, but feel free to comment further.\n. Here's a minimal completer that doesn't rely on getTokenAt. I didn't test it, so it might contain a mistake. I also modernized your code to use registerHelper, which is the correct way to store a new helper function in recent CM versions.\n```\n(function () {\n  var keywords = (\"Abs,Max,Min,\").split(\",\");\nvar identifier = /\\w/;\nCodeMirror.registerHelper(\"hint\", \"MYLANGUAGE\", function(cm) {\n    var cur = cm.getCursor(), line = cm.getLine(cur.line);\n    var start = cur.ch, end = cur.ch;\n    while (start && identifier.test(line.charAt(start - 1))) --start;\n    while (end < line.length && identifier.text(line.charAt(end))) ++end;\nvar list = [], word = line.slice(start, end);\nfor (var i = 0; i < keywords.length; i++)\n  if (keywords[i].indexOf(word) == 0 && !arrayContains(list, keywords[i]))\n    list.push(keywords[i]);\n\nreturn {list: list,\n        from: CodeMirror.Pos(cur.line, start),\n        to: CodeMirror.Pos(cur.line, end)};\n\n});\nfunction arrayContains(arr, item) {\n    for (var i = 0; i < array.length; ++i)\n      if (array[i] === elt) return true;\n  }\n})();\n``\n. This is what the\"hide\"` event on markers does: http://codemirror.net/doc/manual.html#event_hide\nNote that undoing might cause the marker to come back, in which case \"unhide\" is fired.\n. This is what addWidget does, by design. It overlays the widget over the code. Look into addLineWidget and addBookmark for other approaches, which actually take up space in the document.\n. Is this still the case with the current master branch? I finally got your messy demo full of needless dependencies to work, but I can't see the problem there if I load the current CodeMirror code.\n. Right, that does reproduce the issue. Does the attached patch help for you?\n. Would you be okay with just checking for .from().ch == 0? The comparison with the result of countColumn is dodgy because the ch property is counted in characters, not column --- it's comparing two different things. I also think it is okay, if the start of the range is not the start of the line, for the indentation to move it forward.\nMaybe also check whether the range's was actually moved, before calling replaceOneSelection, to prevent needless setSelection churn.\n. Thanks. I've merged this and amended it in ff472c4 to fix some issues -- ensuring that the range still exists after the call to indentLine, and using the new .to(), to fix the problem of shifting when to.ch is not zero.\n. That was indeed a bug in the core. Attached patch should fix it and make the workaround unnecessary.\n. Thanks for noticing. This was unintentional, based on an accidentally doubled backslash in a regexp. Attached patch should fix it.\n. Indeed, the mode shouldn't treat property names as if they were normal keywords. Attached patch should help.\n. Ergh. Optional arguments in JavaScript, always a minefield.\nI've pushed an alternative patch, since typeof object doesn't really tell us a lot yet (the options might be set to null or some object).\n. As for the failing test, in which browser is it failing?\n. Okay, that's pretty much what I'm using. Which platform?\n. Linux, Windows, OS X, etc\n. Attached patch seems to help. But since this is tricky to reproduce, please also verify whether it works for you.\n. Mode requests are kept in https://github.com/marijnh/CodeMirror/wiki/Mode-wish-list , not in issues.\n. You did something wrong in creating the pull request's branch, so there's a whole bunch of irrelevant patches showing up. I assume 162c607 is what you meant to propose? I've merged that.\n. Why are you going to the version 3 JavaScript demo? If I try this with the current javascript mode, I do get the correct indentation.\n. Thanks! I've merged this as a46ad91 (I had to do some merging to get this to work with 2f2fcf92a377)\n. What if you just set cursorBlinkRate to zero and define a CSS animation for CodeMirror-cursor?\n. Good point, but that can also be solved outside of the CodeMirror core -- register a \"cursorActivity\" handler that briefly removes the animated css class, and then puts it back.\n. You've noticed wrong. CodeMirror already does what you describe, and has done so since 2.0. The only way to break it is by setting viewportMargin to something big, or making the editor very high and doing the scrolling with an element that's not part of the editor.\n. There were two bugs involved. The undo code passed the wrong positions to the scrolling code, asking it to scroll a bogus region into view that was bigger than the viewport, and the scrolling code didn't deal with such regions properly, and endlessly retried scrolling them into view. Attached patches should fix both problems. Let me know if they work for you.\n. Well, for some reason github isn't attaching 95ec53662a6bf47182f69faa372c6d86d3cab630 to this issue, even though it does refer to it. That's the second patch I was talking about.\n. Patch 7900908 might help here.\n. Do you have a stack trace, or a test case that triggers the error?\n. The code and line number in your last comment suggest you are using an ancient version of CodeMirror. Can you reproduce this issue with the current code?\n. I'm closing this until further activity.\n. Either way is fine.\n. You did not provide an image. And if I open http://codemirror.net/mode/rst in Firefox it seems to work fine, and there is no error message in the console.\n. Are you using the current CodeMirror version? Can you give me a plain HTML file that reproduces the problem?\n. You need to load addon/mode/overlay.js for rst mode to work (see the module loader header in the mode file, or the demo html page).\n. You can use the atomic and inclusiveLeft to make a piece of text at the start of the document unselectable (same with inclusiveRight and the end of the doc). But for text in the middle of the document, no. If a selection can be created around text, it will include that text. You could show unselectable text in the middle of the document, using a widget inserted with setBookmark, but text that's part of the document can be selected.\n. Doesn't OS X make sure mouse cursors are visible on all types of backgrounds? If so, maybe we should simply remove the hair cursor feature again (I believe it was contributed by Adobe)?\n. If you can create a reasonably tiny image url, we can just put it into codemirror.css, and have the dark themes use it.\nAlthough, actually, that might be one of those things that are a pain to do with CSS -- the themes can't force an extra class, and so the style would have to be associated with the themes' classes by including it in every single theme file.\nMaybe, though I am not fond of such hacks, use computedStyle to measure the background color, and add a 'cm-dark-theme' class based on that?\n. Are you talking about the regular 'text' cursor when you say 'i beam'? Is that one also hard to spot on dark backgrounds on Macs? (Wasn't this company supposed to be good at design?)\n. [Pointlessly abusive comment removed]\n. Why on earth would you add a copy of anyword-hint.js to the distribution?\n. I've merged your first patch as bbc53eb\n. I've already merged the patch you intended to submit. I guess that means we're done with this pull request.\n. These were two issues introduced by fixes that tried to address issues introduced by the recent operation overhaul. I was on holiday, and needed some time to figure out the proper solution, hence the delay. Could you see if attached patches solve the problem for you?\n. So, is this still a CodeMirror bug, or is the problem specific to IPython? Does this section of the manual help clear things up: http://codemirror.net/doc/manual.html#keymaps (see the paragraph that starts \"Keys mapped to command names starting with the characters \"go\"\".\n. The resulting logic is still more confused than needed, I think. If a7201ac119645198 fixes this properly for you, I'd prefer to go with that.\n. It has been ages since I actually tested with FF 3.6. I assume the problem is that older Firefox versions don't have a getBoundingClientRect method on text ranges.\nAnyone up for figuring out in which version this feature was introduced? Assume that is the version we should be listing as first supported FF version.\n. This is not about Element.getBoundingClientRect, but about Range.getBoundingClientRect, which MDN claims is supported since 4.0 (https://developer.mozilla.org/en-US/docs/Web/API/Range.getBoundingClientRect).\nI've bumped the supported Firefox version to 4 in 1a58ac5\n. That's quite an odd way to handle comments. Attached patches should implement this.\n. Apologies about the slow response on this one. I somehow dropped a bunch of emails (I use my mail folders as todo list, but apparently something went wrong this time).\n. Attached patch should help.\n. Thank you! Looks good. Merged as 11d1a2355b3da6\n. Added to https://github.com/marijnh/CodeMirror/wiki/Mode-wish-list . We don't keep issues open for all languages people might want.\n. We can, but you'll need to do it yourself. Added to https://github.com/marijnh/CodeMirror/wiki/Mode-wish-list\n. I would prefer for you to fork the merge addon and maintain your version yourself. Converting the diff format into a (much more complicated) one is going to affect performance, and support for moved blocks adds more complexity than I am currently comfortable reviewing and maintaining.\n. Your link is a 404.\n. Thanks, I see what you mean now. CodeMirror isn't able to render such marks properly, so I think they should just be rendered as special chars, the way ACE does in that link. See attached patch. Does that work for you?\n. This is intentional. The .1 tags are development snapshots, and the .0 ones are actual releases.\n. Yes, this exists as http://codemirror.net/demo/rulers.html\n. Should be better with ca8ac08\n. Should be fixed now that the mobile/contenteditable code landed.\n. In which browser does it fail? Both editors look fine in Chrome\n. Does attached patch fix the problem for you?\n. There's a bit too many copy-paste artifacts carried over from the clike mode in there -- you don't need the def function, the configuration (since this is only a single language, you don't need hooks and pretty much all the other things from parserConfig). The indentation is a mess, and doesn't seem to correspond to the Modelica language at all (a single statement below when is indented, whereas it appears to form a block until end when, and the model and equation blocks are not indented at all).\nSo this is a good start, but doesn't look quite ready to merge yet.\n. Wonderful! Merged as bcb3737 \n. Thanks. Merged as f145676\n. I'd need a way to reproduce this without Brackets if you want me to investigate it.\n. Could you maybe actually tell us which 'find' you are talking about? There's a bunch of keys bound to search-like commands in the sublime keymap.\nThe dialog-based searching has not been fully implemented. If you want to work on it, that'd be great.\n. This is a request for help, not a bug. It does not belong here.\n(On a quick glance, I don't see what is wrong with the code you link. You might get something useful from http://enjalot.github.io/Inlet/ )\n. Looks like you failed to load the css mode.\n. Apparently, Webkit (maybe others) return a null rectangle (all fields zero) when measuring the position of a wrapped whitespace character that does not take up any vertical space. That confused the selection drawing code very much, causing it to set a bogus negative width on the selection rectangle. Attached patch should help.\n. See if attached patch helps.\n. Thanks. Merged as 8003f25. I am not too comfortably with the closeOnBlur option, since it will result in a partially covered editor, which is rather problematic to use when the cursor is under the dialog. Opening multiple dialogs, which happens easily when the editor can be refocused with an open dialog, is also bound to give poor results.\nBut hey, as long as we don't mention that option in the docs, I can't be expected to support it.\nDocs for the other options would be appreciated, if you can get around to it.\n. Are you using the current master branch code? Something very much like this was recently fixed (see #2736)\n. I've released 4.5. Unfortunately, npm is erroring out (as usual), so I haven't managed to push it there yet.\n. Thanks! Merged as 76db4c110b6 and 5e0692ffd181a\n. I've pushed the attached patch. Does the problem happen all the time or only occasionally? If it happens all the time, we should make sure to also set badBidiRects a non-null value, so that the test isn't repeated again and again.\n. This does not in fact happen 100% of the time (I wasn't able to reproduce it), so the original fix should handle the problem well.\n. Probably just an oversight. But it is also not entirely clear how to require it. Directly by CDN url? What if users don't want to use a CDN? Or conversely, by plain name (like diff_match_patch), but then the user will need to explicitly configure this name to point at something.\nWhat would you recommend?\n. This sounds like it might be related to the TinyMCE integration, not CodeMirror core.\n. Thanks. Merged as 027e577\n. It looks like it is never (normally) accessed before it is set. Do you have an example of indentation that gets confused by this change?\n. Thanks! Merged as 4337996\n. Are there any errors in the error console when this happens? If not, it might be that IE8 doesn't allow the script to preventDefault the ctrl-f key combination. If so, there is not much we can do (other than picking another key combination or disabling CodeMirror's search entirely on IE8)\n. IE8 does indeed not allow scripts to capture Ctrl-F. IE9 does. If IE8 support is important, I suggest you provide another key binding on that platform (bind something else to \"find\" using extraKeys or by changing CodeMirror.keyMap.default).\nClosing this, since it can't sanely be worked around on CodeMirror's side and concerns only a single legacy browser.\n. Yes, I know. Until browsers start exporting decent unicode category predicates, there's proper solution for this short of including a hundred kilobyte of regexps. Further patches to handle widely used languages are welcome.\n. I'm not disputing that. So find me the Unicode ranges, or create a pull request.\n. Yes, it is. Merged as f09b6c5\nNote that I do not get an email notification when you push to a pull request branch, and thus am unlikely to notice. It is a good idea to add a comment when you want me to look at the code again.\n. Attached patch seems to help.\n. Not going to happen.\n. Firstly, the issue tracker is not the place to ask for help. Use the mailing list or stackoverflow.com for that.\nThere are some utilities for finding matching tags exported from addon/fold/xml-fold.js. You might be able to react to the \"inputRead\" event by seeing if typing happens in a tag, finding the matching tag and then updating that in the same way. But this is complicated by the fact that the \"inputRead\" event fires after the document has been updated, and the tag finding utilities act on the current document.\n. I'm not seeing this. The styling applied for \"#foo[\\t]bar\" is string for #foo, bracket for the square brackets, null for the tab and for bar (CodeMirror doesn't explicitly style whitespace, not sure why bar isn't styled -- I did not write this mode, nor am I fluent in Smalltalk). \n. Aha, I see what you mean now. Fixed by attached patch.\n. Thanks! Merged.\n. I prefer not to include this in the distribution then\u2014since the code seems too confused for me to want to support it.\n. If someone submits a decent mode and is willing to act on my code review, I am willing to support such a mode. Don't expect me to rewrite a shoddy pull request.\n. This is how findMatchingBracket is intended to work. You can pass it a strict argument (3rd arg) of true to suppress this behavior. I believe that flag was added for the vim bindings, but I see that they are not currently passing it. This may be where the bug originates.\n@mightyguava Do you agree? Shall I add the argument?\n. Yes, you'll notice that one of them (the secondary one) is grayed out. This is by design. If you enter an ltr character, it'll appear at the point of the secondary cursor. If you enter an rtl one, it'll appear at the primary cursor.\nIs this a problem for you?\n. Yes, you'll notice that one of them (the secondary one) is grayed out. This is by design. If you enter an ltr character, it'll appear at the point of the secondary cursor. If you enter an rtl one, it'll appear at the primary cursor.\nIs this a problem for you?\n. Interestingly, the CodeMirror behavior is what Chrome Linux used to do, when I was working on bidi support. My current Chrome (39) no longer does it. Still, it seems like a useful feature (if your cursor is at an ltr/rtl 'jump', there will be two different insertion positions, and illustrating those with a faint grey cursor seems both useful and harmless).\n. (See my comment at the brackets issue)\n. Thanks! Merged as c2ee5a6\n. Are you sure you're working with the current code? I can not reproduce any problems with either of those strings in http://codemirror.net/mode/rst/\n. The rst mode seems to have been doing something rather misguided -- it checked whether the syntax conformed to what it expected, and threw an exception when it didn't. That isn't a very good idea for a syntax highlighter. I've removed the exception-throwing mechanism in the attached patch.\nThe mode's code, which I never really closely reviewed, seems rather confused on other points as well, so don't be surprised if it behaves oddly. But now at least it should no longer crash your editor.\n. Due to limitations in JavaScript's regexp API, the searchcursor addon isn't able to properly match all expressions. We could special-case this situation, but I'm not sure if it's worth it.\n. Thanks!. @pickhardt Are you interested in doing further maintenance on this mode?\n. For now, only the problem described in this issue.\n. @joepie91 Well, it seems the CoffeeScript mode doesn't have a maintainer then. Maybe you can try to come up with a patch yourself?\n. I think attached patch fixes this. But the mode is written in a rather complicated way, and I expect there'll be more indentation issues.\n. http://codemirror.net/mode/coffeescript\n. Thanks! Merged.\n. Thanks. Merged.\n. Thank you. Merged.\n. This is a matter of taste. My style, in which I'm definitely not alone, is to indent non case/default lines two units, and case/default lines a single unit. If you want to submit a patch to make this behavior configurable, I'd be okay with that.\n. Indeed, I think your patch works only incidentally. The dedent mechanism was the problem, I believe, but it looks like it was quite confused, so I've simplified it and removed its (unsuccessful attempt) at supporting nested scopes in an alternative patch. I also had to change indent to actually indent off of brace scopes, which it didn't do before for some reason.\n. Thanks for the quick response. Merged!\n. This is a good idea, but slightly incompatible. Most importantly, option objects will now no longer use options from their prototypes.\nStill, probably a good idea. Merged. I'll add a release note about the potential issues to the next release. \n. There was a rather stupid bug in calculateScrollPos. Could you see whether attached patch helps?\n. I am okay with limiting the loop. It's just that that will mask the underlying bug and make it very unlikely that it will ever get fixed. If you have another set of inputs like the ones you showed before, with the patch applied, I would be very interested in them.\n. Found another bug, which I fixed, and added the limiting counter.\n. On the whole, this looks great. I love getting pull requests with tests!\nBut modes aren't supposed to come with their own CSS. Try to abuse the standard styles that exist in the themes and in codemirror.css, instead of making up your own (see other text-ish modes, like RST, for examples).\n. Wonderful, thanks! Merged as 2cf65a0e1759c3\n. The textile documentation identifies +text+ as inserted text, not underlined text, so I think that the current behavior is fine.\n. I can't reproduce this problem. Which browser are you using? Are you hovering over the icons in the gutter or over the text?\n. Right, I managed to reproduce now. I think the problem isn't in lineAtHeight though, but rather in the fact that the lint addon will end up passing the exactly pixel at the border between the lines when moving vertically, which is obviously ambiguous based on rounding errors and such. Attached patch fixes this.\n. The hasChildNodes method does not work the way you are using it (it does not take arguments).\nThe fact that Chrome is apparently letting JS code run when the parentNode property is inconsistent is pretty awful. I've pushed an alternative patch that probably also fixes your use case.\n. Duplicate of #931\n. You never explicitly described the behavior you expect. Should the per-line copy and cut be disabled when the cursor is on a blank line? What if it contains only whitespace?\n. I'm still doubtful about whether this should be changed at all. Calling it a bug is definitely nonsense. Sublime Text behaves the same way, by design.\n. I'm interested in what the Brackets devs consider the preferred behavior here. @peterflynn @redmunds Care to chime in?\n. @peterflynn Could you define more clearly what behavior you'd want to see? When does the clipboard content count as line-based? Should this property influence anything else?\n. Closing this. @peterflynn If you can tell me more about the way 'pasting over' blank lines should work, please open a new issue.\n. @addui So load the modes that the PHP mode depends on, as @muxahuk mentioned.\n. It will, if you use a module loader of some kind. If you're using plain <script> tags, you have to take care of dependencies yourself.\n. You could look at the docs for the the php mode, which list the modes it depends on.\n. The heights are updated on redraw, which happens only after the operation. So when your first console.log runs, updateHeightsInViewport hasn't even been ran yet. To get accurate heights, flushing the display is required, there is no way around that (the heights are computed by the browser's rendering engine). Does that clear things up?\n. This could be fixed with special-case code in the add-on. On the CodeMirror side, there's not much we can do (the textarea that ends up focused does not contain the whole document), and I also don't really consider this to be our problem.\n. Thanks for looking up all those extensions! I've merged this and changed it rather heavily in the attached patch. There are now only two functions, findModeByMIME and findModeByExtension, and they are exported through the CodeMirror object, rather than dumped in the global scope. I've also done some unrelated cleaning up, adding some missing modes, allowing multiple mime types per mode, and adding a few missing extensions.\nAs a test, the demo/loadmode.html demo now also allows choosing a mode by filename or MIME type.\n. The addon/scroll/scrollpastend.js addon implements this. Load it, and set the scrollPastEnd option to true.\n. This is fixed in the current code (which handles mobile browsers in a completely different way)\n. Can this be reproduced outside of Brackets?\nI'm willing to just add a counter to the loop and clip it at 5 iterations, but I would really like to find the underlying bug that is causing the current problem. Even if you can just give me the inputs and outputs of calculateScrollPos during such a waffling situation, that would already help a lot.\n. I think you need the mode option: http://codemirror.net/doc/manual.html#option_mode\n. Can you provide me with a test case that shows this problem? Are other places that call getBoundingClientRect also affected?\n. Initializing the editor happens synchronously. How can the user cancel it?\n. A good start would be providing a way for me to reproduce it (in a minimal, stand-alone HTML page, not somewhere deep inside some bigger system!)\n. Thanks for noticing that. Merged.\n. You have to use CSS for this. Give the .CodeMirror-scroll class a min-height style.\n. Your patch breaks having multiple gutters. But I think the patch I attached should solve your problem.\n. Does measuring the bounding box (using Range.getBoundingClientRect) of a character that's rendered as part of a ligature still work? Does it work on all browsers?\n. Are there ligatures in that page? If so, where?\n. Is that available as a web font somewhere? That seems like the easier way to demo this.\n. Firefox (32 Linux) handles this well -- I can still put my cursor inside of the ligatures. But Chrome 38 Linux seems to consider a ligature a single block as far as measurements are concerned, and thus breaks cursor movement. As such, I don't want to add this CSS rule to the default stylesheet.\n. Thank you! Merged, and followed up by dcab249 to make it more useful.\n. You can always reach CodeMirror instances from the DOM, so if you want to get at the CodeMirror constructor in a website that has a visible editor, you could do this:\ndocument.querySelector(\".CodeMirror\").CodeMirror.constructor\n. The Vim bindings are without a maintainer at the moment, so don't hold your breath waiting for new features.. You could in principle already draw characters any way you want using the specialChars and specialCharPlaceholder options. Is there a CDN-style repository of emoji bitmaps online that allows any site to load images from it?\n. So what, exactly, are you suggesting? I don't have OS X handy to see what that key combo does.\n. It should be relatively easy to write an addon that does that. That being said, I don't consider this a bug, so I'm going to close the issue report.\n. Thanks. Merged.\n. Thanks, merged.\n. Looks good. Merged!\n. Since this is a Ruby script, it's not practical to run it client-side, so you'd have to set up a service and have the lint integration make an HTTP request to it. This is possible, but out of scope for the main CodeMirror distribution.\n. Adding a lint that involves a server-side service to Codio, as a user, is probably never going to work easily. You could do it though---set up your own server, and create a bookmarklet that loads in a script that defines an async lint function which talks to that server. Some programming required.\n. One of the main changes in 4.0 was motivated by exactly this problem. If you want it fixed, upgrade.\n. It looks like you forgot to load addon/mode/overlay.js\n. Right, the rst mode in v3 still has the braindead assertions in it. If you can't upgrade to v4 at all, you can try just pulling the rst.js file from v4, it should still work with v3, and has been improved in the meantime. (v3 is no longer supported, in any case)\n. You can use the \"beforeChange\" event to filter changes: http://codemirror.net/doc/manual.html#event_beforeChange\n. CodeMirror supports some browsers that don't have the trim method yet, so you can't use that.\n. This appears to be fixed by 4bce5342 . Next time, when adding a patch to a pull request, also add a comment, so that the repo owner gets notified that you want something reviewed.\n. This option already exists (revertButtons). Did you not notice that when you were writing your patch, or does your implementation do something different?\n. I think a much better API would be to simply expose a method jumpToDiffAfter, which takes a position that defaults to the cursor position, and jumps to the first change after this position. That way, you can call it after creating the editor, to get the behavior you implemented here, but also bind a key to it (I use alt-down a lot in Meld, which does precisely this)\n. You should add a comment when you add patches -- otherwise, I won't notice them.\nAnyway, your implementation still isn't really what I was looking for. See my attached patch for an alternative.\n. Thanks. Merged. Next time, start from my master branch so that only relevant patches show up in the pull request.\n. Thanks! I had never heard of Tornado, but since the project has a lot of stars on github, I'll just assume people use it, and thus a mode is good to have. Merged as f6c5def\n. Okay, stop.\nThree things: think before you send a pull request, i.e. if you think you might find more things you need to fix, let the changes sit in your side for a day or so before you bother me with them.\nSecond, pull requests can be updated, so don't close them and open a new one, since it is filling my mailbox with pointless threads. If you push to the branch created for the pull request, the new patches will be added to the pull request.\nThird, if possible, combine your changes into bigger commits and give them descriptive names. And rebase your branch onto the current master branch so that old commits don't show up.\n. I've merged this as aebb9e3.\nAgain, try to only include relevant patches in your pull request branch. The old patches that created the mode are already in CodeMirror. Next time you start working on a feature, start from my master branch, not your previous pull request branch.\nAlso, the commit that changes the Travis URL should definitely not end up in my repository, so that doesn't belong in the pull request.\n. Thanks. Merged as cd17bae\n. Attached patch should help.\n. I do my best to keep master stable, but patches that don't look too scary or invasive are landed directly on that branch (there's no enforced testing period), so occasionally we do break something. Thus, if you want to be super safe, stick to releases.\nAlso, the mailing list is a better place for questions. The issue tracker is for tracking bugs.\n. Thanks. Merged as 10d9bf1\n. It's a dark theme. Why is the old color too dark? I'd say, barring obvious usability problems, the color choice is up to the original author of the theme.\n. That makes sense. Merged as 60740b8822b7b\n. The Perl mode doesn't do indentation at all. It had electric chars set, which is inappropriate if it can't help fix the indentation of those characters anyway. I've removed those in the attached patch. But this code was contributed, and is written in a rather non-standard way, so I don't really intend to add indentation to it unless I am paid.\n. Going to close this as 'too bad, but I'm not going to work on adding this feature'\n. The smartymixed mode was contributed, and is a rather awful mess. It is clear how it should be rewritten, but this is not a priority for me. You can either rewrite it yourself (fix the fact that reimplements most of the smarty mode, base the result on something like the tornado mode), or pay me to do it.\n. Attached patches extend the Smarty mode to support a base (background) mode, and kill the Smartymixed mode.\n. Both versions are precisely equivalent, as far as semantics go. But if the inconsistency bothers you, feel free to submit a pull request.\n. Thank you. Merged as 5c06606\n. If I paste your code into http://codemirror.net/mode/javascript in Chrome, I don't see this problem happening. Please provide an HTML file that demonstrates the issue (minimally), and tell me which browsers it occurs on.\n. This is a known and documented situation: if you initialize CodeMirror in a hidden element, or manipulate its parent elements so that its style changes, you have to call refresh after the editor gets its final size, or it won't know its own dimensions.\n. Yes. This is definitely not something that should be in the core, and there exists a perfectly fine addon that implements it. Closing.\n. The way bidirectional text is rendered is controlled by the browser, and the behavior you are seeing occurs because the direction css property of the editor is \"ltr\" (the default) instead of \"rtl\". CodeMirror currently does not support setting the text direction (and will break if you simply do it with CSS). There's work underway to address this by @radek-p in https://github.com/radek-p/CodeMirror/tree/rtl-lines , but that branch has some issues that need to be resolved before this can be merged into the main distribution.\n. (The direction branch of this repository now contains a relatively solid implementation of configurable editor direction. Testing welcome.)\n. The direction branch isn't relevant anymore -- anything in there is probably implemented better in the master branch.. Thanks. Merged as 5c06606\n. Thanks. Merged as 4bd6fea\n. The current Rust mode is based on the Rust syntax from two years ago, and contains a lot of complexity to work around some oddnesses the language had back then. I think those oddnessess are mostly gone now, so it might be possible to write a much simpler Rust mode now.\n. Thanks. Merged as 4bd6fea\n. That is actually a clever workaround for the problem of JavaScript's lack of unicode matching support -- just considering everything above 0xa0 to be identifier characters. It's not perfect, but better than not recognizing them at all. Merged as cc953bf9bd4fc5e. I think I'll be applying the same hack to some other modes.\n. Thanks. Merged as 31a4d5b8fbe42c73\n. Attached commit should solve the tab styling issue. Let me know when this is ready to be merged.\n. Wonderful. Merged as 08183e4\n. @jparmenter If you want to do some more mode hacking, consider replacing the smartymixed mode, which is a kludgy mess, with a cleaner, simpler mode that overlays or multiplexes the smarty and htmlmixed modes (see for example the django or tornado modes as examples.)\n. Makes sense. Merged as e7761e7\n. Thanks. Merged as 9ca51f3 \n. These sound like basic CSS precedence issues. Take a look at your rules, and see if adjusting precedences gets around the issue.\n. You are still not styling the background properly (your background !important rule is for CodeMirror-selected, but you want CodeMirror-selectedtext).\n. Thanks! Merged as 0930f2bfda, and followed up by efbd453ac1f1859bf01.\nI don't get email when you push to a pull request branch -- so always follow up with a comment.\n. I'm experimenting with a completely different approach to handling touch devices, which is looking promising and more correct (proper selection widgets, etc). So feel free to keep this patch as a workaround on your side until something better comes out, but I don't want to merge it into the main codebase.\n. Oh, sorry. What problem exactly does the patch fix?\n(What my solution does is turn off handling of mouse events during a touch event sequence and a second afterwards, so that touch input isn't accidentally interpreted as mouse input.)\n. Wait, browsers actually fire touch events for mouse clicks? That is messed up. Is this documented somewhere?\n. Does it sound like a good solution if I extend my approach (ignoring mouse events during touch) with a check for mouse-like touch events (single-pixel radius, only one finger), and fall back to the existing mouse handler in that case?\n. (Leaving this open for later integration, when my own branch is mature enough to merge.)\n. I'd have to factor out the event-to-coordinates code, yes. If both mouse and touch events are fired, doesn't registering mousup/mousemove events work?\n. (I'd really rather not have another code path doing the same thing that the mouse code is doing.)\n. Doesn't preventDefault-ing mousedown also kill the pan/drag behavior?\n. Could you test my solution in the mobile branch? (Search for isMouseLikeTouchEvent.)\nClosing this pull request, since I'm not prone to merge the approach taken here.\n. You can pass a no-op function (function(){}) as the first argument to CodeMirror to not place it in the DOM. Attached patch also allows you to pass null.\nNote that you will need to call refresh on the editor after you place it into the DOM, so that it can draw itself properly.\n. This feature request has very little to do with the vim mode. You can control the indentation behavior with regular CodeMirror options, and the way tabs show up with CSS rules. I don't think there is currently much interest in providing vim commands for all possible configuration tasks.\n. Okay, closing as out of scope.\n. defineOption has worked great for the core so far, so I think emulating that is a good idea. (Though you should probably avoid the CodeMirror.Init kludge, since it's awkward to use, and just pass another argument that indicates whether the editor is initializing -- I'm going to switch defineOption to that in version 5.0.)\n. (Umm, the console.log statements I will of course remove before merging this.)\n. Thanks. I've merged this as f1870d8e72fb, and done some more keymap-related work in b077d68ae1a731f0685f615 (docs in 94afd1151997). I don't think this concerns the vim keymap, since that implements its own multi-stroke mechanism, but support for nofallthrough was removed (I think it already didn't do anything anymore in the vim and emacs keymaps anyway, which were the only ones that used it).\n. Have you been able to reproduce this? Any idea what the minimal HTML that triggers the problem is?\n. I mean the HTML around the editor, the test page (I don't want to wade through all of Brackets to debug this). I don't think this has come up outside of Brackets yet.\n. (This is now the 6.0 release, since 5.0 was used for releasing the mobile support.)\n. Add an instance.addon object in which addons can store their states. (Rather than abusing instance.state for this.)\n. Thanks! Merged as 5397cbe. I have no idea about extensions for RPM changes.\n. Not unlikely that it is a regression of that same bug, yes (see #598 for previous CodeMirror discussion). We removed the workaround for this from CodeMirror because it caused problems and it looked like this was properly fixed. Can you reproduce this in a textarea? If so, could you try to get the Safari devs to pay attention to this? \n. Seems to be bug https://bugs.webkit.org/show_bug.cgi?id=35443\nAttached patch adds a workaround. Please let me know if it helps for you.\n. Wow, they still didn't fix this. Oh well, attached patch seems to solve the problem.\n. Thanks. Merged as 1e7cdbf\n. Maybe we should integrate this information into mode/meta.js instead? (We could add an alias field containing an optional array of strings.)\n. Thank you. Merged as 0c60c433efb8e37fad, and then followed up with e64cd58f0f and 263af5abd471832bd9. Could you look at that last patch, and tell me whether you can see any problems with it?\n. I expect attached patch will help.\n. That's because the sql mode is a skeleton mode that has to be configured to do anything useful. See the various dialects being defined at the bottom of the file. You can see that it is working, and actually running the sql mode, by adding, for example, a number to that line. But things like keywords and double-quoted strings need to be configured by the dialect.\n. Thanks. Merged as 8173af6\n. CodeMirror's source does not follow jsLint/jsHint style. This is by design.\n. All token objects will end up with the same state. It seems that your use case requires getting information from this state, so it likely won't work with your function. Calling CodeMirror.copyState when storing the state should help there.\nCan you find a way to express this without duplicating most of the code in getTokenAt? Maybe define a utility that both methods use.\nAlso, public methods need documentation.\n. Thanks! Merged as da3e8f283a5d, followed up by 71ef0cfec056\n. As pointed out on the stackoverflow question, the mistake was all yours.\n. That's a good point. Attached patch changes the demo code so that it won't confuse other people like that.\n. I want to keep the example on the landing page small, thus it doesn't load anything beyond the basic necessities. Try reading the manual, or looking at the source for the various demos and mode pages, for more information.\n. You need to load the xml, javascript, css, and htmlmixed modes. Or use a module loader, in which case loading the htmlmixed mode will automatically load its dependencies.\n. You appear to be relying on global variables being created for DOM elements with an id. Whether that works is up to the browser, and has absolutely nothing to do with CodeMirror. The manual does not imply otherwise.\n. Nowhere in the manual does it imply that the myTextArea variable refered to is a textarea's DOM id.\n. This is a duplicate of #1104.\nCalling scrollIntoViewIfNeeded when it is available might be a good idea, but the issue there is that it would require creating the extra node every time, which creates another relayout, and thus would cause a significant performance regression. (This can probably be worked around by reordering things so that the dummy node is created at the same time the selection and cursors are drawn.)\nThe polyfill you link to seems to only look at the node's parent node, and thus won't solve the bug you are reporting here. It would be possible to create a version that walks all the way up the DOM tree, but I'm a bit worried about performance there.\n. There isn't always a cursor, and there are some kludges applied (an extra 30px at the bottom) in the scrolly div to work around idiosyncracies of CodeMirror's DOM structure.\nWould firing a \"scrollCursorIntoView\" event, that client code can then react to, work for you?\n. > That 30px would be wrong for a CM instance that has no horizontal scrollbars, as in our case.\nNo, it isn't. Inspect the .CodeMirror-scroll element in devtools. It has, by design, an invisible 30px sticking out at the bottom.\nGiven attached patch, you can do something like the below to handle scrolling the cursor into view:\neditor.on(\"scrollCursorIntoView\", function(cm, e) {\n  e.preventDefault();\n  /* your code here */\n});\n. (I'm holding off on documenting/finalizing this until I get your feedback. Please let me know whether this works for you.)\n. Great. I'll keep this event in the code then. Documented in fa0294e\n. Thanks for noticing that! Merged as 2521014\n. I think it would be preferable to move the vim mode's key handling down into the keymap layer again, which has at least some concept of priorities and fine-grained handling. Would it work for you to be able to add a function to a keymap that is simply called for each key, and which can return a value indicating whether it chose to handle that key? You'd have to translate from CodeMirror-style key names to Vim-style names, but that's probably not very hard.\n. Attached patch should allow you to give the vim keymap(s) a call method (or just make them functions). This method will be called with the name of a key, and should return null if there is no binding, and a function when there is one. That function will then be called with a CodeMirror instance as argument to actually execute the binding's action.\nYou might also want to take a look at the new functionality for multi-stroke key bindings. Basically, if you return \"...\" from a keymap, the key will be stored, and combined with the next key, so that if you press Ctrl-X and that returns \"...\", and then you press F, the string \"Ctrl-X F\" will be dispatched to the keymap. This might be too primitive for the vim map's use, I'm not sure.\n. By the way, if you need access to the editor state during dispatch, I am also open to passing the editor instance as second argument to the keymap function. It's less clean, but I could live with it.\n. Attached patch causes the editor instance to be passed as second argument to the keymap's call method.\n. It's already on the wish list. If you want it to happen, either work on it yourself, or pay me to do so. I don't keep open issues for new modes.\n. There is currently no way to see whether the inner mode switch happened before or after a given token. I do realize that this makes the addModeClass feature rather useless.\nThere's a possible solution -- having wrapping modes return an empty token when switching inner mode at a point where the next token should be considered highlighted by the new mode, and having the core properly handle this information. But that requires quite a lot of tweaks in quite a lot of modes. I'll try to take a look tomorrow.\n. Attached patch implements the idea I outlined. Please test!\n. Doesn't objective C use C-style #import preprocessor directives? Wouldn't it be better to reuse the preprocessor functionality for C and C++ rather than highlighting #import as keyword? (Or is there another feature in objective C that uses the # sign?)\n. Yes, that should do it. I must say I find the fact that you've never used Objective C before slightly worrying ;). But I've merged this, and made a few changed in the attached followup patch. There's, stupidly enough, no formal syntax definition for this language -- or even just a list of keywords -- available, so we'll just see what problems people run into and fix them on a case-by-case basis.\n. Thanks! Merged as a6cbaff2d0f1cd, and cleaned up a little in 986e319ad6c885a3\n. Distinguishing between tags with pseudo-classes and unrecognized properties without complex lookahead is rather hard. I've tweaked the heuristic a bit, so that the result should be better in your example and generally as long as you use idiomatic whitespace (no space before pseudoclass, space before property value).\n. There are browser extensions there too (but I guess those mostly use double-colon syntax, like ::selection and ::-webkit-scrollbar-..., so we could recognize them by that -- and of course verify that there aren't any widely used single-colon ones).\n. Looks great! Pushed as c47adcc\n. I've noticed this too. There are experiments underway to do something entirely different on mobile, which should also take care of this problem. I'll hopefully be able to merge something into the master branch soon.\n. You could try with the mobile branch. It won't have this problem. It might have some other problems, though, since it's not very mature yet.\n. Since the mobile code has landed on master, I'm closing this.\n. Doesn't the e_stop call three lines above this already take care of this? (That'll call preventDefault on the event)\n. That line also runs when closeOnEnter is enabled. Which it is by default.\n. Okay, that makes sense. I don't think this is a perfect solution (it complicates the callback protocol, for one thing), but it's a tiny, non-invasive change, so I've merged it anyway as 184b5f1\n. @nournia Yes, I noticed this issue as well. Fixing it is going to be awkward and messy, but I guess it has to be done.\n. @jasonzhao3 The direction branch was never properly finished, and I haven't been able to allocate the time needed to finish and land it. Bidi/RTL stuff is always very subtle and debugging it takes me, as a non-RTL-language-speaker, ages. The way people could help is by\n- Providing test cases\n- Rebasing the direction branch onto the current code (lots of conflicts, I expect)\n- Figuring out what some of the more obscure code in the direction branch, which was not written by me, is trying to do (and adding more tests to ensure it continues doing what it should do)\n- Or, alternatively, hire me to do this work\n. TeX is a pretty horrible language to write editor modes for, since commands can define their own syntax, and there's no robust way to see, for example, which pieces of text are verbatim, and ignore commands in them. Just special-casing \\begin{verbatim} isn't much of a solution (the various listing modules will all have a similar problem).\nOne kludge would be to disable math mode when a blank line is encountered. It wouldn't fix your example, but at least it'd prevent screwing up the highlighting of the whole remaining file in this situation. Does that sound like it'd help?\n. I'm not going to include * rules in codemirror.css. Is there anything specific that breaks when you load an invasive framework like that? There are already a few explicit box-sizing rules to fix this, if there's something still broken, we can add more to address specific problems.\n. Are you using a recent version? I just added a * { box-sizing: border-box; } rule to a demo, and couldn't see any strange behaviour.\n. Is the problem JavaFX-specific, or can you also reproduce it in a normal web browser? JavaFX isn't supported, so I'm not going to debug that, but if you can reproduce it in a browser, point me at a demo and I'll gladly take a look.\n. Doing the same thing as xCode is not a goal for CodeMirror. Feel free to submit a pull request that moves some of the things that are currently keywords to be builtins, if the third point is important to you. The second should also be easy to implement. The first is not something the clike mode, on which the objc mode is built, currently can do.\n. There is already an exception in resolveMode that will fall back to the XML mode when an unknown mime that ends in +xml is chosen. So this defineMIME call doesn't seem to add anything. (Also, there are about a zillion dialect XML MIMEs and I have no interest in adding all of them.)\n. What do you want to use this SVG mode for? As I said, the defineMIME call is almost a no-op -- it has no effect on getMode or resolveMode, its only effect is to add another property to CodeMirror.mimeModes.\nTo be able to associate custom helpers (such as hints) with a mode, you could do something like this:\n``` javascript\nCodeMirror.defineMIME(\"image/svg+xml\", {name: \"xml\", modeProps: {helperType: \"svg\"}});\nCodeMirror.registerHelper(\"hintWords\", \"svg\", [\"circle\", \"rect\", \"path\"]);\n```\nThat'll give you those three custom completions for SVG files. Of course, you'll probably want to register \"hint\", and bind a specialized form of CodeMirror.hint.xml to it instead of \"hintWords\".\nBut I don't think this belongs in the core xml mode. Though if you do write a solid SVG schema description for xml-hint, I'll gladly include it in the distribution under addon/hint/svg-hint.js.\n. On Chrome 39, I'm getting 180ms to reindent a 4000-line JavaScript file. That seems reasonable. Which browser are you using, and how long does reindenting take for you?\n. Well, yes, auto-indentation requires some work. It has to parse the code and make lots of little changes (the parseJS function is part of the JavaScript mode). I don't really see a way around that, and I think CodeMirror is doing pretty okay here (emacs is a factor ten slower).\n. Indenting with tab always adds an indentUnit to each line, so there no synchronous parse happens, which is why it's faster in your test. It still needs to make a change for each line, which is also expensive.\n. Closing this. I welcome specific optimization proposals or patches, but the fact that re-indenting makes one change per line is intentional and necessary (it has to preserve markers and such in the text that isn't touched), and necessarily quite a bit of work.\n. Thanks! Merged. Don't worry about small styling changes in obscure modes like this -- the original behavior is unlikely to be very well thought out anyway.\n. This is a known problem. The Rust mode was written back when Rust was quite a different language. I looked into updating it recently, but Rust still does not have a formal grammar, so I gave up on that. It'll have to be rewritten from scratch, I think, since the current approach is used to work around some strangeness in the old syntax that no longer exists.\n. That document is where I started, but the pseudo-formal grammar parts are a joke -- they are full of holes, refer to other productions that are never defined, etc. Then I looked at the parser, but that is, if I remember correctly, over 4000 lines long, so I just gave up. If someone who is familiar with modern Rust wants to take a stab at this, that'd be great.\n. This was fixed by the new Rust mode.\n. Thanks. Merged as c9b932b\n. Thanks. That seems like a sane approach. Merged.\n. If you have specific extensions that are missing, file a pull request. Some languages simply don't have extensions associated with them, other are so obscure that none of the people who helped add extensions had a clue what to associate with them.\n. That's a good point. Supporting matching of full filenames would require us to add another method, something like findModeByFileName, which first scans full-filenames (specified by regexp, I guess), and then calls through to findModeByExtension when it doesn't find anything. Want to submit a pull request?\n. What do you mean by 'cursor and selection heights left unadjusted'? Setting a line height style like that definitely increases the line height. Maybe you are looking for the singleCursorHeightPerLine: false option?\n. Which browser are you working on, and which CodeMirror version? If I set a line height, my cursors and selections are the full height of the line.\n. Why do you expect the Markdown mode to correctly highlight LaTeX syntax?\n. A multiplexing mode that switches to the stex mode between $$ markers would be very easy to set up, and probably solves your problem.\n. Thanks! Merged as 6b7bc72\n. Attached patch seems to help. See also 6ef6ef99a78f5f for the \"coords is undefined\" problem.\n. Argh. Thanks for catching that! Merged as e032650\n. Did you consider simply creating another specialization of the clike mode? Dart's syntax looks pretty C-ish (but I might be missing something). In any case, I'm not too keen on having copy-pasted and slightly modified modes like this.\n. The clike mode hooks provide a relatively easy way to build the things you describe without also duplicating the functionality for tracking braces and categorizing words. Though you should probably put the code in a separate file, not clike.js iteself, since it'll be non-trivial if you end up implementing string interpolation.\n. Thanks! Merged as 4d8c0cb\n. Thanks for fixing that! Merged as b9c4feb\n. Thanks. Not sure how that got there, but it shouldn't be set. Merged as a69661a\n. Thanks. Merged.\n. Are you planning to extend this with string interpolation and such? If so, the code will become non-trivial, and I'd prefer for it to live in mode/dart/dart.js instead. You can look at the PHP mode for an example of a clike-based mode that implements a form of string interpolation.\n. Thanks! Merged as bbffbe6d17de, and tweaked a little in 1d821f88ed8\n. Thank you. Merged. The gfm mode's name in meta.js is already \"Github Flavored Markdown\".\n. Good point. Attached patch fixes this.\n. Thanks. Merged as 3e4c5d2. Next time, try to submit a rebased, rather than merged branch, so that it's easier for me to see which patch you want me to take.\n. This is not something that anyone is working on. Since highlighting modes have less freedom than a full parser (no lookahead, for one thing), I doubt the CodeMirror mode will ever be 'fullly conformant'. If you run into specific corner cases that you'd like improved, submit individual issues. I'm closing this as being out of scope.\n. Oops.\nCould you verify that attached patch helps?\n. Looks good. But shouldn't the inner mode, which is currently hard-coded as JavaScript, be configurable for when people want to use another language?\n. Thank you. Merged as e1a13faef092ae98, and integrated with 1e6f259d35 and 5b471d3b5baded981e\n. Done. The addon will be properly documented when it is stable -- I want at least two serious modes to be written in it before I'm going to freeze the API.\n. Thanks, merged as 114b1e4\n. How about a mode option 'commonMarkthat turns on CommonMark-compatible parsing? (Not that I'm going to work on that -- but I'd welcome a pull request that implements it.)\n. Thank you. Merged as 38dffcb\n. That was indeed bad. I've pushed an alternative patch (88b1d82) which fixes it without doing silly things like setting atokenproperty to a regexp, and also cleans up some unnecessarynextproperties (staying in the same state is implicit).\n. Hi Robert, thanks for the pull request, but from my casual research, wikiLingo does not appear to be very widely used (16 stars on github). I have to be somewhat conservative in the code I accept into my distribution, since I'll have to maintain it. I'm afraid this mode does not make the cut for being widely relevant enough, so please keep hosting it yourself, and possibly add a link to https://github.com/codemirror/CodeMirror/wiki/CodeMirror-addons\n. Then maybe we shouldn't have two modes? If this parses everything that the tiki mode parses, how about we just replace the tiki mode with it? If it doesn't yet, maybe make it so?\n. Thanks for noticing that! Merged.\n. Could you see if attached patch solves it for you? (It was preceded by patch 2de4f1e23fef7, which whipped the mode into a shape I was willing to work on).\n. No need for a new issue. But please define the behaviour you are expecting a bit more precisely. Should opening a phrase only works if theres a non-word char before the code and a word char after? Does the same hold for closing the phrase?\n. I had to make the rule that the characters directly inside a phrase are non-whitespace (as opposed to word) characters, otherwise tests likefooand language attributes started failing. Does the attached patch work for you? \n. I'm talking about the X characters inXblahX, the ones directly on the inside of the phrase. You initially said these should be word character (or rather, you agreed to my proposal that they should be), but I had to make them non-whitespace characters instead to get the test suite to run.\n. So you're saying two minus signs never start/end a deleted phrase?\n. Try with attached patch.\n. Thanks for noticing that! The selection drawing code was using the doc width from the start of the operation, which wasn't up to date anymore in this case. Attached patch should fix it.\n. The reason I didn't do this initially is that due to shadowing, macros, and namespacing, the mode can't really be sure whether a given symbol is actually referring to a build-in keyword or not. Could you set this up to only do the highlighting when the symbol occurs as the first element of a list? That should cut down on the number of false positives.\n. Thanks. Merged your first patch, and I've pushed a slightly different followup patch (8659c5a) because mutating the context objects like this isn't safe (they are shared by copied states, and thus if you change them you might impact another copy of the state in a problematic way).\n. I think not defininginnerModeis an inacceptable solution to theelectricInputissue -- it'll also break folding, autocompletion, etc for inner modes. Can you give me an example of a piece of code that wouldn't indent properly without this kludge?\n. I've merged this as d05a998ef4776148d92 and added support forinnerModein a4ec3433e95 -- please verify whether my solution makes sense (I consider anything inside soy-specific{}` blocks to be the soy mode itself, and defer anything else to the local mode).\n. Thanks. Merged as 944815a\n. This behavior actually corresponds to the way HTML is parsed (neither of these script tags will do what you appear to expect them to do). So it's a feature, not a bug.\n. That's a regression. Should be fixed again with attached patch.\n. Right, that was a rather obscure race condition. Should be fixed now.\n. Could you tell me a bit more about what language this is? Does it implement the format used by a specific (set of) spreadsheet software? \n. Is the word 'formula' a commonly used term for this language? If not, would it be okay to rename this mode to 'spreadsheet'?\n. Thanks. Merged as 63e0effd2e6dcf, and tweaked a bit in eb8f15c26e688.\nYou still had tabs and 4-space indentation all over the place, by the way.\n\nThe idea here was to find a number followed by letters or underscore, which is never acceptable. I don't believe changing this to \\w+ would allow for that.\n\nYou've just matched all digits. If more word characters follow, that means the first of those is not a digit, and thus /\\w+/ does detect the error case you are interested in.\n. Thanks! Merged into the direction branch. Glad to see someone taking an interest in this branch. I have to do a bunch of additional cleaning up before I am even thinking of landing it, but hopefully it'll get into a good state eventually.\n. That is a bug in webpack (browserify handles it fine, and there's really no reason not to). Since almost all files in the distribution follow this pattern, I am not interested in changing to the more awkward, verbose variant to please a buggy tool.\n. This is, for what it's worth, by design. To determine what to select on double-click, CodeMirror divides characters into three groups: letters, whitespace, and punctuation, and will select all adjacent characters of the same group. Alpha is considered a letter, whereas subscript-zero and the arrow are not, and thus fall into the 'punctuation' group, causing them to be grouped with the parentheses.\nIs there a specific behavior you were expecting? (Please be precise.)\n. Fair enough. Closing the issue.\n. This still does not call the inner mode's indent method, and thus leads to rather crappy indentation for template content. The main difficulty appears to be preserving sane indentation computation when two languages (soy and the inner mode) are mixed. One possible solution would be to use the hideFirstChars method on stringstreams when calling localMode.token (if the indentation of the Soy mode is blank -- stream.indentation() >= state.indent), and when calling innerMode.indent, add the Soy mode's own indent. Though then you'd have to change the meaning of state.indent to only be the added indentation for Soy tags, and always add that to innerMode.indent in the mode's own indent method.\nWant to give that a try?\n. Ah, that's scary, but probably works in this case. Merged as abbaa3eb075cb0, and followed up by 175741a277c48 which fixes indentation of else and elseif (by not causing extra indentation for blocks under them). Please review.\n. Oh, you're right. Just the efficient path (incrementally updating the marked pieces) is disabled for the multi-selection case. I guess that's good enough. Sorry for the confusion -- I read your tweet as indicating that the plugin did not work for multiple selections.\n. Thanks for noticing that! Fixed in attached patch.\n. The margin is not unneccesary -- it compensates for the size of the real (hidden) scrollbar, making sure that the bottom of the document aligns with the bottom of the editor when scrolled all the way to the bottom. Most likely you have another CSS rule that's causing the breakage. Just adding the rule you included does not cause anything problematic for me. A full demo would be appreciated.\n. @mtaran-google Could you get back to me on this? I'd really like to make sure the new scrollbar approach does not cause any problems before tagging 4.9.0\n. Thanks for confirming. I've made the relevant rule !important to prevent other people from running into this.\n. Thank you. Merged as 58dbfdc\n. I assume that which ranges are scanned and folded (and how often) is determined by the brackets-code-folding code, so I'm pretty sure that there is nothing that the code in the main CodeMirror distribution can do about this.\n(Feel free to comment again if you have actual evidence pointing at CodeMirror code.)\n. Thanks. Merged.\n. Thank you. Merged.\n. I don't think drag and drop ever worked in IE8. See d49f7e00 for the initial commit that explicitly turns off feature-detection of drag/drop for IE8 and below.\n. It seems to sort of work but is seriously flaky (often fails to drag, or suddenly resets the cursor to some odd place). Since I don't want to allocate the time to debug these issues and/or find workarounds, I'm going to leave the check that disables drag/drop on IE8 intact.\n. Great. Merged.\n. That was a leftover from an earlier approach. The current way to do this is to add a meta property to your states object, and put an object with the properties you want on your mode object in there.\n. The behavior you prefer is the old behavior (in fact still present in the current release). I've changed the behavior last week, to match what Sublime Text and most other editors do. The rationale is that if you're typing, and there happens to be text directly after the cursor, it is annoying when this text is included when asking for completions.\n. The look-ahead hack that detected fat arrows was a bit too liberal. Attached patch should help.\n. Thanks for noticing that! And for submitting a test and fix. Merged as 3b9bb89\n. Thanks. This has come up before, and it's useful to have. Merged as b447f47c41f and followed up with 74b7c2093d4\n. The code that caused this was actually looking very misguided. Attached patch adjusts it, which should also solve the issue.\n. Good point. But I think this is trivial to solve (see attached patch) without backing out the cursor-deletion functionality. Does this work for you?\n. I don't think having the selection and the background be the exact same color is a very good idea. Was that intentional?\n. Thank you. Merged!\n. There does not appear to be any event fired before validation. If you can describe a solution to this problem, I'm listening, but I don't immediately see a clean solution.\n. There is no guarantee that the editor is even focused when validation occurs (it might never have had focus, its content still could have been changed through API calls), so the blur event isn't a robust solution. Neither is periodically saving -- it is extremely likely that a form will be submitted directly after a change.\nThe way fromTextArea currently only update the textarea when explicitly prompted with the save method or on submit is part of the public API, and is going to stay. If you need something else, just hook up a timer to CodeMirror's \"change\" event to implement it yourself.\n. Thanks! Merged as 49320c6\n. I feel CodeMirror is unlikely to be to blame here -- did you reduce a test case that only uses HTML? Did you test current CodeMirror with Chrome 38? Seems those would be obvious steps to take before opening an issue.\n. Thank you. The situation still isn't perfect (it never dedents, so auto-indenting a block of code will mess things up), but it looks better than before. Merged as 2fc14db\n. See my comment at #3007\n. I don't keep open issues for mode requests. I've added regexps to https://github.com/codemirror/CodeMirror/wiki/Mode-wish-list , and am closing this. If you want a mode, you'll have to write it, or you can pay me to write it for you.\n. Yes, this is the case, and no, you can't do anything about it. Keep state in a state object, instead of in a static/global variable. See also http://marijnhaverbeke.nl/blog/codemirror-mode-system.html\n. That was bad. Not sure how I managed to miss it. It has been fixed in the attached patch, and I've released 4.10.0 with the fix.\n. I can not reproduce this. Calling setValue most definitely should not mess with focus, and looking through the code, I see no reason why it would. This is my test page:\n``` html\n<!doctype html>\n\n\nfoo\n\nvar cm = CodeMirror(document.body, {}), i = 0;\nsetInterval(function() {\n  cm.setValue(\"abc\" + (++i));\n}, 500);\n\n``\n. You could check for theoriginfield in the change object (passed to the change handler), and ignore it when it is\"setValue\"`.\n. The CoffeeScript mode was contributed, and isn't something I personally wrote. I'm aware that it is not the most high-quality mode, but fundamentally improving or rewriting it is not something that's covered under Adobe's support contract. If you have very specific, clearly defined issues feel free to note them, and I can take a look to see how easy they are to implement.\n. > I wonder if we should change cm-variable to cm-def, which is the class the JS mode applies for variables (but why?).\nIt only does so for variable definitions. (It also styles local variables as variable-2, which requires more precise parsing than the CoffeeScript mode does.)\n. There were some improvements to the CoffeeScript mode recently. They solved the low-hanging fruit issues, such as property highlighting. Please open specific new issues for other problems you find.\n. Thank you. Merged as 9e56052a7a902229b\n. I do not want to include all of XQLint into the mode file, since it's huge, under another license, and likely to go out of date. Could you rewrite this to load it as a dependency? (And have the demo get it from some CDN, so that we don't have to include it in the distribution.)\n. Since this is a rather specialized use case, and I really don't want to pull in blobs of 3rd party code into my distribution, I think it is best if you create a separate repository for this, and base your own brackets plugin on it.\n. > Tools like jshint or csslint are not used in Codemirror?\nThere is integration code for them under addon/lint, but they are specified as depdendencies of that code, not pasted in wholesale. There is simply no way I'm going to include thousands of lines of duplicated code (which is under a different license, no less).\n. Attached patch will cause the .then line to be indented, but it won't indent the whole function body. This is more or less by design, since I prefer the style of indentation that makes a statement's block end align with its start. If you really want the exact style you showed, I'd be open to a pull request that adds a mode option for that.\n. Thank you. Merged as 5619d83\n. There actually was no mouseup handler at all, since Webkit browsers set a sane which property on mousemove events that allows us to detect button release in a much more reliable way, but I guess other browsers don't. Fixed in attached patch.\n. I've pushed a slightly different patch (0cb74f8) to take care of this. I was under the impression that event targets always were real nodes, but I guess that's not the case.\n. Use the markselection addon to also add a class (CodeMirror-selectedtext by default) to the selected text, and then (also) add the pointer rule to that class.\n. > The cursor constantly switches between pointer and caret while dragging a selection \nWell, obviously styling the selection won't prevent the cursor for showing up differently when outside of the selection. You could try a hack where you set the cursor for the whole editor to pointer while the mouse button is down.\nBut the second point is a good one. Since the actual node under the cursor will be the <pre> for the current line, there's no sane way to use CSS to style the cursor in that case. What ACE appears to be doing is handling a \"mousemove\" event. You could write an addon that registers such a handler and, using getClientRects, figures out if the mouse is inside the selection every time it moves, and sets the editor's cursor style as appropriate.\n. Try with the new selection-pointer addon.\n. Is this an entirely different language from Verilog/SystemVerilog? If not, would it make sense to write this as a configuration of that mode instead?\n. If the language is unstable, maybe it is better to hold off on integrating this in the distribution for now?\nBut even if we put this in the main distribution, I think it would be preferable to add configurability to the Verilog mode. Duplicated code is a maintenance burden and will prevent improvements to one of the modes from helping the other mode. See also the clike, css, and sql modes for examples of modes that handle families of languages.\n. I took a look at this, but as it stands the code really isn't clean enough to be integrated. For a start, its indentation and whitespace are different from the other modes, and rather inconsistent internally. More importantly, the actual code itself seems alarmingly confused. You are initializing variables to an empty object only to directly overwrite them, you are returning objects from which you use only one field (in the hooks), you are needlessly touching the internals of the string stream abstraction (its pos and string fields), and your hooks' logic, instead of simply dispatching on the content of the line, first sets some variables, and then later dispatches on those variables. It is also a really bad idea to mutate the mode's configuration object, I'm not sure what you were trying to accomplish with that, but it's going to touch other instances of the same mime mode, since they share that object.\nSo if you want this merged, tighten up the code style, remove superfluous code and indirection so that someone who is not you has a chance of understanding what is going on, and please also try to make the configuration less invasive -- there's not need to have multiple vx-specific properties on the state even when in another configuration -- your hooks can add those when they need them. Also try making the hook mechanism general, not vx-specific, and try to give the individual hooks more obvious names.\n. I've merged this as aa46ff58b8c and cleaned it up further in c7562e82f022b6.I am not sure how you failed to notice that the mode didn't work at all when you edited text, because its state didn't properly support copying. I have left out the theme and the demo page, since this appears to be an exceedingly obscure language, and I don't want to pull in any extra baggage because of it.\n. Yes, I found a few more problems after tagging 4.10, but wasn't sure whether they'd be major enough to warrant yet another tagged release. I guess they were. I pushed 4.11.0.\n. That is indeed not something you'd expect. Attached patch should help.\n. Thanks for noticing that! Attached patch should take care of it.\n. Thank you! Merged as 5dd07d60b8b\n. You definitely don't want to monkey-patch getMode. Rather, it'd be possible to define a javascriptmixed mode which wraps the javascript mode much like htmlmixed wraps xml, and switches to an inner mode when specific (configurable) types of tagged templates are encountered.\n. I think this looks good as-is, except that I don't think case-insensitivity should be hard-coded into the function. Rather, add an /i to the regexps that need to be case-insensitive.\n. Thank you! Merged as 78e06ac. I've removed the line that downcases extensions by default. I understand the rationale, but I've seen people use uppercase letters in extensions in a significant way, so I don't think this is a decision that should be forced on all users of the library.\n. Hi Chris, with the attached patch, you can bind keys to \"closeTag\" to get the behavior you describe. It was a small change to have the addon also expose a command.\n. CodeMirror stops tokenizing after 10k characters, for performance reasons. Adjust the maxHighlightLength option to change this.\n. The syntax checker is integrated with the highlighter. The basic assumption is that giant lines will be minified content that you probably don't want to hand-edit anyway.\n. Nope, there isn't. There is no sane way to prompt for a number in the core library, so this isn't part of the core. You can write it yourself in a few lines of code, though:\njavascript\nCodeMirror.commands.jumpToLine = function(cm) {\n   var line = Number(prompt(\"Where\", \"\"));\n   if (!isNaN(line)) cm.setCursor(line, 0);\n};\nCodeMirror.keyMap.default[\"Alt-G\"] = \"jumpToLine\";\n(For extra points, use the dialog addon to make the prompt less ugly.)\n. @jenspohle It's probably easier to enable the new addon than to paste in that code.\n. Does not appear to happen on Chrome Linux, so it does seem likely to be related to OS X shenigans. My only OS X device died for good a few weeks ago, so I can't currently test this. I do intend to get another one at some point, but help in debugging this (verifying that we are indeed getting nonsense from the clipboard, and trying out workarounds) would be much appreciated.\n. You could probably work around this by using the clipboard API in the paste event handler. Not sure if it is worth the trouble, though.\n. Are you sure? Does event.clipboardData.getData return the text including the space?\n. I think it's pretty stable, and work in recent browsers. I didn't use it yet because the fallback needed for older browsers works just as well in modern ones, but this might be a good reason to start using it when available.\n. Could you see if attached patch helps?\n. Thank you. Merged as e3d317b\n. You can submit a pull request if you want. I don't add new modes or themes just because someone wants them (I have other things I want to do with my life).\n. You call replaceRange twice, once for each end of the selection (or ofter, when there are multiple selections). Take care to make your changes back-to-front, so that the addition of text does not make subsequent ranges invalid (i.e. if you first add the text in front of the selection, the end might no longer be where it used to be).\nIn any case, this is not a bug, so the issue tracker is the wrong place for it.\n. CodeMirror restores the selection after undo to where it was when the change was made. As such, this is expected behavior when you make changes through the API at a place away from the cursor. If you don't want it to behave in this way, a workaround would be to temporarily change the selection when making such changes.\n. Yes, that whole file is rather strange (and I already did some cleaning up). Thanks for the patch. Merged as 5a7affd\n. Thanks. Merged as bf2e307\n. This is used to automatically remove the tooltip when the relevant node is no longer in the document. I have very little experience with shadow DOM. Does .contains see through shadow DOM boundaries? If so, we could use that instead here.\n. Does the attached patch work? It tries to continue through the element's root property when it hits a shadow root node.\n. Thanks. I adjusted the property name in 34622a2 (not sure where I got root from -- I was looking at the spec which clearly says host).\n. Indeed, I forgot to attach an event handler for window scrolling. Attached patch should fix that.\n. Thanks for reporting that. Should be fixed in attached patch.\n. Use the setValue method on your CodeMirror instance. Also, this is not a bug report, and thus does not belong in the bug tracker. Use http://discuss.codemirror.net for such questions.\n. Thanks for isolating that. It was a confusion between about when the input was being reset -- TextareaInput.poll was messing with prevInput after the operation ended, creating an inconsistent state. Attached patch should help.\n. Nice! But the indentation doesn't seem to work very well yet -- even after the opening brace in the example, I end up at column zero when I press enter.\n. Thank you, looks much better now! Merged as ac72e8d23653c47.\n(When adding patches to a pull request, the repo owner does not get a notification, so it's usually best to follow up with a comment when you want your new patches to be reviewed -- it was pure luck that I reopened this page and noticed the new commit.)\n. Hi. This is cool. But no, I don't want to keep it in the CodeMirror distribution itself. Please add it to the wiki so that others can find it easily.\n. Great! Could you add an index.html that demos the mode, and make sure the linter passes? (it is complaining about a missing semicolon on line 102)\n. Thanks! I've merged your work as e94159ec9b2, except for the theme. I don't keep css files under mode directories, and though I could add it under /theme, it was so unreadable (dark on dark) on my screen that I'm not sure how useful it is to others. So if you care about the theme, maybe tweak it for usability, and resubmit it. If not, thanks for adding a Forth mode!\n. You are changing the meaning of the next method, which pretty much all 90 currently existing modes rely on. That does not sound like a good idea.\nCould you describe the problem in a bit more detail? For one thing, which mode are you using? And is the input in the screenshot (\"/*\\n{\") the input that triggers the issue?\n. Entering that code in http://codemirror.net/mode/javascript/ does not cause an infinite loop. Please verify that your issue has not already been fixed.\n. Attached patch adds a try/catch around the call to focus to prevent the error from crashing things. However, you'll still have to call the editor's refresh method when it becomes visible, because CodeMirror needs to be able to see its own size in order to draw itself correctly (and can not detect becoming visible).\n. I am actually aware of colorforth (I did have a Forth phase a long time ago), but I don't believe that the lack of contrast in this theme are necessary for a colorforth look -- grey text on slightly darker grey background is a bad idea in any context. If you can (significantly) up the contrast, either by darkening the background or brightening the text (or even both), I'll be happy to merge this in.\n. Thanks. Merged as 41a740b19ba. Next time, please try to rebase your pull request branch, rather than leaving in merge commits, so that it is easier for me to pick out the relevant patches.\n. Thanks for tracking that down and fixing it. I've merged your patch. (This kind of bug is making me consider trying to start using a typed JS dialect at some point.)\n. I'm playing around with Flow, which seems more modern and flexible, but it's also rather unfinished and rough at the moment, so I guess I'm not converting any projects over to it on the short term.\n. I agree the current situation isn't great, but I am not sure that this is a very good solution (and share @mihailik's concern). I'll think about it some more when I have time, and am open to other ideas and/or examples of other UIs that solve a similar problem.\n. What do you think of the attached patch? It makes it so that, after 1.7 seconds, if the mouse isn't over the tooltip, it is hidden. If it is, it stays until the mouse leaves.\n. My assumption was that people would middle-click such a link anyway, but I guess on Mac that's more involved, and there's no real reason not to make a new tab the default. Merged as 893a12e\n. A hurdle is that completers do their own context scanning, so each completer would have to be changed to do that for each cursor. This is not a big problem, but somewhat awkward, and potentially breaking for 3rd-party code. Maybe I can add a property that allows completers to opt-in to multi-cursor support. Is there a specific language that you are most interested in?\n. Did you test with patch f97df90d832fa523d26f26131e6646567f5a83d0 (which is part of release 4.12)? That sounds like it would be addressing the same problem.\n. Thanks. Merged as b002600. We're kind of re-solving problems that have already been solved for the show-hint addon, and are probably going to pop up in the lint addon as well at some point. I will try to take some time to factor out the common logic into a tooltip addon at some point.\n. Omitting quotation marks is perfectly okay in HTML, and is intentionally done quite a lot in the files bundled with the CodeMirror codebase. As such, I don't feel it is helpful to start adding them.\n. Thanks for analyzing that. I was happy to use plaintext-only because I assumed we would be able to capture almost all input before it affected the DOM, and disallowing non-text input would be great for preventing funny side effects. But since Mobile Chrome does not let us intercept paste events, I guess that my reasoning does not hold, and we might as well just go for full contenteditable and deal with any complications as they come up.\nDoes the attached patch solve the problem for you?\n. See what happens when you enter /foo/i + i. Attached patch (a7d44a5) fixes that.\n. Wonderful. Merged as 752c785f83f4, and test added in 941916482 (consider including a test in the pull req in the future).\n. @document appears to be a Gecko-specific non-standard feature, for now. I'm not too keen on adding support for it to the CSS mode, especially when it is relatively heavyweight (+29 lines).\nMaybe we can come up with a solution where unknown @-directives are parsed in a simple, defensive way, matching brackets and, if the brackets are braces, treating the stuff between them like top-level directives? That'd be a little simpler, I believe, and involve less special-case code.\n. Thanks. I've merged your alternative patch as 2d544462f25e. I was thinking to simply see whether the rule ended with a semicolon or a braced block to determine whether it supported a block or not, but I just realized that the fact that Less and SCSS also use @ for variables is likely to create ambiguity, so for now let's simply go with a hard-coded list of @ directives.\n. Merged as 6b9511d11d2, test in 3469f317b5eb.\nIf we add another expression language (like the one in @supports and @media) we should generalize it so that we don't end up copy-pasting all the boilerplate stuff.\n. That's a good point. Attached patch should solve it.\n. I can't reproduce this issue (using iOS 8.1.3 as well) -- the line numbers show up fine for me. If you strip down your test case to just an editor, and remove extra CSS, does the problem still occur?\n. I've managed to reproduce this. The line number gutter's width is automatically adjusted to fit the actual numbers' width, but it seems that in some cases on iOS a rounding error made the resulting elements too narrow. Attached patch adds an extra pixel to compensate for this, and for good measure also adds the nowrap rule. The problem is no longer showing up for me now.\n. Thanks. Merged as f3f57a3 (except for the empty alt attribute, which seemed useless).\n. Thanks for fixing that. Merged as e454aa8\n. Thank you! Merged as e3acd68\n. Your bug report is pretty much the inverse of #2064. But on closer look, I think going back to the old behavior is more sane than what we are currently doing. Attached patch reverts the change made because of #2064.\n. This might be relevant: https://hacks.mozilla.org/2015/09/flash-free-clipboard-for-the-web/\n. Thanks. Merged as 011b947\n. Agreed -- valid syntactic elements shouldn't blindly be styled error. Merged as 9d9337f\n. Thanks for reporting that. Could you verify that attached patch solves your issue?\n. Thank you for following up with those. Merged.\n. What appears to be happening is that Chrome tries to scroll the whole block of selected text (in the hidden textarea) into view, whether it is visible or not. That is why this doesn't happen if you only select a few lines.\nI've submitted Chrome issue 459071 with a reduced reproduction case. I tried some workaround (fiddling with the CSS style on the textarea, and setting selectionDirection to \"backward\") but nothing seems to have an effect.\nIf you have leverage to help get this fixed on the Chrome side, that's probably our best bet.\n. Mitigated by #3100. Closing in the hope that the Chrome team will fix the underlying bug and eventually cause this to become a non-issue entirely.\n. The editor core or hint addon does not prescribe any key combination to use for autocompletion. Ctrl-Space is just used in some of the demos because it is widely used for this purpose. You are free to configure another combination for your own site.\n. What kind of situation requires putting three quotes in a row in a language that doesn't do triple-quoting?\n. That makes sense. Merged as 39409d6\n. > Can this be made part of the individual language modes? \nThat should already work. The Python mode has closeBrackets: {triples: \"'\\\"\"}, for example.. What is the effect you're trying to achieve? The default value for triples is the empty string, so setting it to that isn't expected to have any effect.. That had nothing to do with triple-quoting. Patch a5d7882c should fix it.. Looks good. Merged, and modified slightly in attached patch, with the intent to have a stateArg property dedicated to keeping local state, so that we don't end up adding more and more state properties for specific purposes. I've removed the delete use, since on some JS engines that still causes objects to become slow general dictionaries, which we don't want to happen for the state object.\n. Could you maybe add test cases? A big problem with the SQL completion is that I'm never sure what it's supposed to do, and whether a change I make breaks some of its functionality.\nThe idea would be to add an sql-hint-test.js file in addon/hint, which hooks into the simple testing framework defined in test/driver.js, and calls the completion function on some interesting inputs, verifying that it returns the right completions. Then include the new test script in test/index.html, and it will be run as part of the test suite.\n. Great! I've cleaned them up a little (a1cdedd) and merged your work. (I had to move them to test/ to prevent the automatic linter from going bonkers over them -- it is apparently not really suited for test code yet).\n. This is a duplicate of #2234. Check out the mobile branch for a potential solution.\n. I know. I don't think there is a way to actually turn this behavior off in contentEditable, so there's not much I can do about this problem. (Though none of this stuff is properly documented -- it's possible that there is some trick, and I just don't know about it. If so, let me know.)\n. Looks good. Merged as 6a68467\n. I can not reproduce this issue. Does it happen in http://codemirror.net/demo/complete.html ?\n. You still didn't show me your code, but I assume you are starting new completions when the old one is still open. Don't do that. See this demo code for an example of how to do it properly.\n. Okay, you are using an asynchronous hinter. That might have been good to include in the report. You are right that there is a race condition when using asynchronous hinting. I'll take a look.\n. Well, I still can't reproduce this. Please create a minimal test case that shows the issue. Here's my code:\n``` html\n<!doctype html>\n\n\n\n\n\n\n\n\n\n  CodeMirror.registerHelper(\"hint\", \"foo\", function(cm, f, options) {\n    setTimeout(function() {\n      f(CodeMirror.hint.javascript(cm, options));\n    }, 400);\n  });\n  CodeMirror.hint.foo.async = true;</p>\n<p>var cm = CodeMirror(document.body, {mode: \"javascript\", lineNumbers: true});\n  cm.on(\"inputRead\", function() {\n    if (!cm.state.completionActive)\n      cm.showHint({globalScope: {abcd: {}, abef: {}, abcdef: {}}, hint: CodeMirror.hint.foo});\n  });\n\n\n``\n. Thanks, that allowed me to reproduce it. The underlying problem is thatshow-hint` gets confused when there are multiple pending async hint calls, and violates its event order contract when an async hinter finishes while another one is also running. Attached patch should fix this.\n. What would you use them for, though? If you don't know what the completion source is, there doesn't seem to be a lot you can do with the \"select\" and \"pick\" events. For \"shown\" and \"close\", there are already \"startCompletion\" and \"endCompletion\" events that are fired on the editor instance.\n. You don't have to edit the completion code directly -- you can wrap it in another function that attaches the event handlers.\n``` javascript\n// Some other code defined CodeMirror.hint.foo\nvar fooHint = CodeMirror.hint.foo;\nCodeMirror.hint.foo = function(cm, options) {\n   var result = fooHint(cm, options);\n   if (result) CodeMirror.on(result, \"pick\", function() { / ... / });\n   return result;\n});\n```\n. I disagree -- because pick and select actions need to know what kind of thing is being completed, I don't think it makes sense to support them outside of the context of a given completion object.\n. I assume my patch fixes it. If you run into the issue again, please show me the code that triggers the problem.\n. The current behavior is intentionally the way it is. If you want a different behavior, simply bind Tab to something else.\n. I agree there's a case to be made for the behavior you describe, but at this point I can't just change the behavior of a commonly used command out of the blue, since it would cause unexpected behavior for existing users.\n. You are changing the table format in an incompatible, breaking way. That is not acceptable.\n. Fair enough. Merged as 8f13aa615b8f7 and simplified and tested in 1eb72e8ccc17412.\n. This is by design. The collapsed marker starts on the first line, and part of the line it ends on is visible, so it shows the line number for the 1st line.\nDo this instead:\neditor.markText({line: 0, ch: 0}, {line: 2}, {collapsed: true, inclusiveLeft: true, inclusiveRight: true})\nThat will make it impossible for the cursor to end up on the first three lines, and will cause the line numbers for those lines to be hidden.\n. Thanks. Merged.\n. Can you provide a test HTML file that produces the issue? Calling setValue is done everywhere, and does not in general cause problems.\n. Can you create a stand alone demo? The problem could be anywhere in the bucketloads of scripts and styles that that page is including. I am not going to sift through them.\n. So is there still a problem if you ensure that you don't use a theme that hasn't been loaded? And if so, for the last time, can you give me an HTML page that actually allows me to reproduce it? I need to be able to see a bug and poke at it in order to know what's going on.\n. Thanks! I've pushed two patches that should help here -- one to force CodeMirror-gutters to the right box-sizing, and one to fix a problem in the mdn-like theme, whose line numbers ended up 3px too much to the right.\n. No we can't reopen the issue. Use refresh() or autorefresh, as described in the previous discussion.\n. I'm not sure why delaying the focus for a moment fixes the issue, but indeed, it appears to, and the change seems harmless enough (focus timing does occasionally cause weird side effects, but I couldn't find any new problems caused by this). Merged as 35a9618\n. The problem appears to be with Closure, not CodeMirror. Global variables like setTimeout and getComputedStyle can be accessed without the window prefix, and if the Closure Compiler chokes on that, you should report it there.\n. The corresponding Firefox bug was fixed a few months ago.\n. Which notification are you talking about? In recent versions, the resize handler should not do any real work if the size of the editor did not actually change.\n. Good point. Attached patch solves the problem in a slightly different way (making sure the timeout is canceled when the option is reset). Could you verify that this works for you?\n. You jsfiddle links are 404s. Maybe jsfiddle garbage-collects overbig files? You should, in any case, simply link the CodeMirror scripts and stylesheets, rather than including them in the fiddle, to make it easier to see your actual code. Also, make sure you use <!doctype html> to put IE into standards mode.\nI also can't reproduce the simplescrollbars bug you describe. If I paste the content of codemirror.js into http://codemirror.net/demo/simplescrollbars.html , I can still scroll to the end. (Though the scrollbar thumb was way too tiny, which I've fixed in 78cad27f974c2a84f43.)\n. Looks good. Merged.\n. I think it would be clearer to move character testing to predicates, rather than creating mock-regexps (since if you're calling something a regexp that isn't, it is rather likely for a later change in the code to accidentally try to call, for example, its exec method)\n. Thanks for the quick update. Merged as 0cd691f\n. Currently CodeMirror lets the browser's native scrolling behavior take effect, and does not preventDefault wheel events except in rare circumstances. This has the advantage of the scrolling actually feeling native. Thus, such an option doesn't fit very well in the library.\nIf you want to capture wheel events yourself, and force a given scroll distance, that's easy too -- just add your own event handler, which calls preventDefault and makes a call like cm.scrollTo(null, cm.getScrollInfo().top + X * cm.defaultTextHeight()). Determining X based on the event's delta is another story, but if you're only targeting one browser engine (as Brackets is), that shouldn't be hard.\n. Patch e1cda70 implements something better -- the ability to configure closing behavior per-mode, so that modes where backticks shouldn't be closed don't close them.\n. Are you using the editor argument? If so, for what?\n. Right, if you need access to the actual mode's tokenizer, I guess there's no getting around touching the editor instance. That's a valid use case, and I've added a note about that argument to the docs.\n. Thanks! Merged as 4485ae7\n. I've merged your patch as dad7abf . I'd be okay with changing the styles output by the SASS mode to match the CSS dialects more closely, and also with copying the trick of giving units a separate style -- though I'd prefer to use one of the standard styles, rather than unit, which is not covered by any of the themes.\n. These are two separate bugs -- attached patches should fix them. The code that ensured the specialchars regexp was always global didn't kick in when the option was given immediately on initialization. And the hack to replace stretches of spaces with alternating spaces and non-breaking spaces (to work around odd browser behavior in Webkit and IE) was kicking in before the special character filter, which produced the effect you saw.\nAs for \\t not being mentioned as part of specialChars in the docs, that's intentional -- technically, tabs are treated special, and are only in there as an optimization.\n. Yes, this definitely looks okay. Merged as 03f157e\n. \"change\" events (as well as \"cursorActivity\" and a number of other events) are fired at the end of the current operation. That means that if you have a 'naked' call to setRange, which will start its own operation, you'll get your \"change\" handler called before the call to setRange returns. But if you are already in an operation (as in the case of the \"cursorActivity\" event in your example) the events are batched to the end of the operation. This is by design -- it is a way to ensure the editor is in a consistent state when event handlers are called.\n. That's true. You could add a line to this list on the wiki, but that probably won't help much. If you need a mode, you'll have to implement it yourself, or pay me to do that.\n. If you want to work on this, the way to do it would be to make the JavaScript mode extensible, so that you can override the way it parses expressions. And then write an extension that, in case an expression starts with a <, switches to the JSX mode.\n. The link @eranimo posted looks a lot like the approach I would take if I were to implement it. So instead of posting +1's here, you could try debugging and fixing it (though note that it's LGPL code -- you might want to contact the author and ask if it can be moved under an MIT license first).\n. What exactly do you mean by 'appears truncated'? The page is reflown to fit on paper. The fact that this changes the size of the CodeMirror box is expected.\n. I see what you mean. The editor's layout is computed using JavaScript, and I guess Firefox doesn't let JavaScript run after computing a print layout. I'm not sure we can do much about that.\n. Wonderful. Merged as fd9f66c3fb1970. And I've reduced the size of the example code in 03a49e971 (since it counts towards library download size, until I get around to splitting the docs from the library package)\n. Looks great. Merged as 30a118a (and wow, I didn't troff was such an ugly format)\n. Thanks. Merged as 8dbb84f44d3f and tweaked in 33e56fbd728ad0. I figured indentUnit is a more appropriate value to check the modulo of, since that's what indentSelection will actually shift the line by, and what most modes use as the base unit of indentation.\n. They should usually be set to the same value, but indentUnit is the unit of indentation, and tabsize is the width of a tab. Those are not necessarily the same.\n. I've reverted this in 55a47a5, because\n- It breaks when there are multiple cursors, which is something the rest of the sublime bindings take care to handle\n- I couldn't get sublime text to actually show this behavior by default. If I press backspace after leading spaces, even when on a tab-count boundary, it still simply deletes the space before the cursor\nSee #4023\n. Sure, I'd merge a proper implementation.\n. Attached patch should fix this.\n. That may be related to any number of things. I do not have time to debug specific integration issues.\n. You could start by describing what 'breaks horribly' actually means. And then set up a stand-alone demo that shows the issue.\n. Did the targeted language change its name? Again, are you sure this language is mature and stable enough that it makes sense to keep a mode for it in the CodeMirror core library?\n. Fair enough. Merged as 78a35ed\n. This was caused by the right click (which isn't actually on the focused element, but which we can't preventDefault because we need it to open the context menu) briefly removing focus from the textarea. I've added a workaround which, in this case, simply holds off firing the blur event for a few milliseconds, and discards it entirely if the editor was refocused in the meantime.\n. Solved via #3134\n. Thanks! Merged.\n. Sounds like a duplicate of #2900\n. The Java mode is a simple configuration of the the clike mode, which handles basic indentation and highlighting of keywords and literals in C-style languages, but nothing more. To get better Java support, you'd have to write a specialized Java mode, or pay me to do so.\n. This has been done in 3d5d9a4af38fac\n. That's interesting. Do you see the same problem on desktop CodeMirror when you explicitly enable the \"contenteditable\" input style?\nOne possibility is that input.forceCompositionEnd is being called when it shouldn't. Could you try to verify that with a console.log? Another possibility is that the IME software is getting confused by some aspect of CodeMirror's DOM behavior, and is itself prematurely ending the composition because of that.\nI unfortunately know very little about both Chinese writing and Chinese IME. For me to debug this you'd have to walk me through the procedure of enabling it on the mobile platform you are using, and explain what you are doing and what the expected outcome is. (If the problem also manifests itself on the desktop, that would help. I have a Japanese IME installed, but a quick test didn't show any problem using that with contenteditable mode.)\n. I suspect the issue is that Safari/Mobile Safari are very easily confused when a JavaScript program messed with the editable DOM, and will either get confused (as in the auto-capitalizing of the keyboard) or fail to treat the updated content correctly (similar problems exist for spell check and double-space-for-period). In ProseMirror (a rich text editor) I've managed to work around this by letting the native behavior through and only updating the DOM when absolutely necessary. Eventually, I want to move CodeMirror's contenteditable mode to this approach as well, and I suspect it will help for this issue, but that's going to be a bunch of work it might take a while before I get to it.\nAs for the mod at https://github.com/zhusee2/codemirror-composition-mod , that looks like it'll cause more problems than it solves (it resets the DOM during composition, which will often force the composition to end, and it blindly trusts the data in the composition events, which is inaccurate on many platforms).. I've merged this as fc2def32c409 and 866934b3b1b4\nNext time, please start from my version of the code, instead of simply continuing on your own old branch. That makes it easier for me to merge, and makes sure you actually get the code I merged. I've made a bunch of adjustments to code style, and made the linter pass. I'm not going to do that a 3rd time for this code.\n. You need to install node, then run npm install in the CodeMirror directory, and then bin/lint should run.\n. Try reading the manual on key bindings and commands.\n. Firefox, unlike other browsers, seems to include programmatic changes in the user-visible undo history, which is why it enabled the undo menu item in the first place. Choosing that confused CodeMirror's interpretation of what was happening the textarea. Should be better with attached patch.\n. Though, as I said, there is no sane way to capture context-menu undo, I found an insane way, which seems to work (put in a nonsense unicode character which is then overwritten, and when the browser undoes and restores that character, abort the input reading and fire an undo instead).\n. > I hate to do this to you but...\nNo, thank you for reporting that so quickly. I messed up the order of assignments in my previous patch, and this would have been rather critical had it ended up in a release. (And I still haven't found a way to automatically test the context menu -- or the clipboard, for that matter.) Attached patch should help.\n. It seems Chrome does show 'Undo' as being available if you right-click right after typing. It does not, however, seem to do anything except reset the selection when this option is picked. That did sometimes have the effect of causing select-all detection to fire when it shouldn't, which patch 8757ba2 works around. I can't think of any way to actually reliably detect and handle this undo though.\n. You have to pass off the exact function you passed to on (just like with removeEventListener). You can't just unregister all handlers for an event by not passing a second argument.\n. Yes, this is a known issue. I think in the next major release I will add another wrapper element around the editor, to make it easier to size the editor and its content independently. That'd be rather invasive, with regards to the way the editor is styled with CSS, so it must wait until a backwards-incompatible release (6.0).\n. It has to. To prevent the default mouse behavior, CodeMirror must preventDefault mousedown events, which will prevent \"click\" from happening. Listen to mousedown or mouseup instead.\n. We don't want clicking to steal focus from the hidden textarea, and we don't want dragging to create a DOM selection.\n. I don't really take feature requests, so until something happens on this front, I don't want this cluttering up the bug list.\n. I can't reproduce this in http://codemirror.net/demo/closetag.html\n. That looks useful. Merged as 79e162b51c1, and tweaked in e0cf6f8d3854. If you are contributing to a project it is generally a good idea to look at the code style it uses, and conform to that.\n. Please move requests for help over to http://discuss.codemirror.net , and include a jsbin/jsfiddle link that shows what you are currently doing along with a clearer description of what you are trying to do.\n. Thanks! Merged as 8b5e659 \n. Given that I don't have a working Mac anymore either, I'd really like to get a better confirmation of this issue. I am pretty sure that I've had various reports of people successfully using multiple cursors on Mac, and if the metaKey property, which also controls the addNew flag in leftButtonSelect, doesn't end up on mouse events, that would have been rather difficult.\n. @peterflynn The patch also changes the 'create new selection' modifier to alt, doesn't it?\n. (I've been working on procuring a new testing Mac, but these things hold their value so damn long that it isn't easy to find a decent deal on a machine that isn't at the end of its life/support time.)\n. It seems that the first line changed by the patch should simply not be changed, since the modifier variable is not used for dragging behavior at all. I've attached a similar patch that only changes the expression in onDrop. Please test.\n. > The modifier is passed to leftButtonStartDrag, which is the Drag & Drop Handler.\nYes it is, but if you actually look inside that function, you'll see that the modifier parameter is only used to pass to extendSelection in the case when no actual dragging takes place.\n. I'm not sure why we are still talking about this. Do you have reason to believe (after having read my previous reply) that this variable is relevant to the drag issue?\n. A click in the selection that doesn't move a significant distance is treated as a cursor-positioning click. That seems like desirable behavior to me. Do you disagree?\n. With attached patch I think it is less likely to surprise people.\n. Thanks! Merged as f741b59\n. Thanks! Merged as 92d0d3d\n. Good idea. Merged as ba90b71\n. This would be good to have, but somewhat involved to do. All references to window and document would have to be modified to point at the editor instance's window and document. And the addons that build nodes or register window-wide event listeners would also have to be updated.\n. The reason that call is there is that if the user keeps typing and then presses enter in the moment when the new results are being fetched, but the widget hasn't updated yet, they'll get a rather bogus result: the old text is replaced, and the text typed since the last refresh is left at the end. Similarly, if they delete text, the hint picking will overwrite unrelated text.\nConcretely, create a slow (~500ms) async hinting function, and open the completion menu. Now type 'x' and quickly press enter. The result will be [completion]x.\nI think this problem could be reasonably solved by disabling but not hiding the completion popup while waiting for an asynchronous completion. I.e. add a method to the widget object to remove its keymap, and call that instead of close.\n. > Only now you have that if type to fast and press enter, you really will press enter,\nI think this is best handled by remembering the enter press, and if the completions come up with a single result, automatically pick that. I've implemented this in attached patch.\n. No, obviously not, as it doesn't happen in any of the demos. What options are you passing?\n. Okay, I'm closing this then.\n. inputRead intentionally has a different name from input. The two are not supposed to be equivalent. CodeMirror handles backspace through a keybinding, and text input through a completely different path. Only the code that takes typed text from the hidden textarea fires inputRead.\nIn this case, I think show-hint should not finally close the completion when an empty result is returned, so that you can backspace and have the widget automatically reopen. Attached patch implements this.\n. Inserting multiple characters is what multiple selections do. I would say this is simply not an appropriate situation to use multiple selections. You might be able to use a \"beforeChange\" event handler that filters changes in the way you want them to behave, but core CodeMirror is doing exactly what it should here, and isn't going to add support for this.\n. Merged as 12dbe838c and added a test and some changes to make it actually work in 26ec5f3710f028a\n. You are required to start the regexps you pass to match with ^, so adding a \\b at the start is not meaningful. \n(This patch also doesn't really solve the issue -- you'll still go wrong for /(\\bfoo)/ for example.)\n. The required ^ in the regexp is only there because of a limitation in JS' regexp interface (we can't force a match to start at a given position in a string, so we have to call slice on the string and match that, pinning the start of the match to the start of the substring). Thus, you can't make your regexp depend on anything that came before the current stream position, and a \\b at the start of the regexp is meaningless (always matches).\n. The index property on the return value from match and exec already allows us to trivially find the position where a match is located. The reason we need ^ is to prevent the regexp engine from doing a lot of extra work. Until the /y regexp flag from ES6 is widely supported, we'll have to stick with the current kludge.\n. See the closeCharacters option to the showHint method for the first issue. I've never seen the second issue, you'll have to set up a demo if you want me to look at it (though it is possible that it is some browser quirk for a given font/style situation that I can't help, maybe it's a rounding issue that I can work around).\n. A live version would be useful.\n. Could you retry that latest issue with the current git master branch? I believe I fixed it a few days ago.\n. You have not linked to any actual demo, as far as I can see.\n. This does indeed seem to be Safari-only -- I can't get it to happen on any other browser. I'm Mac-less at the moment, since my old MacBook died, but there should be a new one on the way, and I'll test when it arrives.\n. I have a mac now, but the demo is offline. I tried to see the pixel-shifting issue in the completion demo but could not get it to show up.\n. Thanks for putting the demo back up. Unfortunately, if I follow the steps you describe, the pop-up widget stays in place perfectly still, and the DOM view of the developer tools shows it receiving the exact same pixel offset every time.\nI suspect that in some (obscure) circumstances, Safari's font measurements are slightly different for 'after A when A is the last letter on the line' and 'after A with more text following'. It seems unlikely that CodeMirror is going to be able to work around that anyway, since it is dependent on what the browser tells it about text positions.\n. So now we're talking about three different problems in a single issue report. It would help, next time, to open new issues for different problems, so that the discussion can stay somewhat focused.\nAgain, several race conditions were recently fixed in show-hint.js. If the current git code still shows the problem, please open a new issue with a clear description of what happens.\n. Attached patch should fix this. Can you let me know whether it works for you?\n. I see. Can we reword the test so that it isn't sensitive to this platform-specific behavior?\n. Ctrl-X is your browser's cut shortcut, and CodeMirror will do a line-wise cut when nothing is selected. This is  by design, though if it is causing problems for you I can add an option that turns line-wise copy/cut off.\n. This is a recent regression -- a 'smart backspace' that consumes blocks of indentation in one keypress was added, but it contains a bug that makes it not work at the start of line. Attached patch fixes this.\n. I don't think this is big enough to warrant another release, but you can monkey-patch the problem away by including a line like this until the next release/upgrade:\nCodeMirror.keyMap.sublime.Backspace = null\n. Thanks! Merged.\n. Indeed, the bidi code got confused by the fact that a level-2 (number-inside-rtl) span of text ended up at the start of the line. Attached patch should help.\n. There is little to be gained from batching the charCoords API -- unless there are a lot of matches on a single line, there's not much repeated work. It might be possible, in a non-line-wrapping editor, to get a speedup from using line height info, instead of measuring individual characters. I'll give that a shot after Easter. (Tuesday)\n. I actually had some time today. Patch 9f55603 (which depends on 1f3a196190) optimizes the measuring. It makes redraw about 23 times faster in my benchmark (which simply consists of annotating 1000 matches on a scrollbar). Does it have a similar effect in your use case?\n. Thanks! Merged as 5f49b40\n. The option is added to showMatchesOnScrollbar in 4fb97fee8745bfc4a. Does that work for you, or do you want to be able to configure the built-in search addon to pass a given value?\n. This time it worked! But as I said in the other discussion, this is too specialized for the distribution.\n. I think my patch is less invasive, but if it misses something your patch solves, let me know.\n. Ah, you are entirely right. I didn't expect an unrelated patch in the pull request, and completely misinterpreted the code. I've merged your solution instead, as well as your cleanup patch.\n. I believe I already fixed this in 27fe44c3cb75ab (and indeed, I can no longer reproduce this problem).\n. None of this is very helpful for actually figuring out what your problem is. I can assure you that getCursor works just fine. What may have confused you is that CodeMirror numbers lines from 0, but by default displays line numbers starting at 1, so there's a mismatch between the line number displayed and the actual line numbers. This is by design, and documented in the manual.\nI'm closing this. If you have specific questions and want to take the time to actually explain what you are doing, what you expect to happen, and what actually happens (in text, not with context-less screenshots and code snippets), add another comment.\n. You might want to use the markText method. Also, don't use setValue to update small pieces of content, use replaceRange instead, which will leave the rest of the document alone.\n. You could try the searchcursor addon. In general, try skimming through the whole manual at least once, so that you don't have to ask here or on stackoverflow about every little thing.\n. IEMobile is not a platform I've ever tested on. It should be recognized as a mobile platform (to verify this, see if CodeMirror.defaults.inputStyle equals \"contenteditable\"). I am not actively supporting this browser, and have no devices that can run it, so I am unlikely to get around to resolving this myself.\n. Merged as a726389. This pull request is fine -- it only contains the relevant commit. The trick is not to start from some diverging local branch, but to create a branch that is exactly the same as my master branch, and then create your commit(s) on top of that. git rebase can be useful for this.\n. \"keyup\" will not catch all types of cursor activity (for example, clicking the mouse, doing 'select-all' from the menu, etc). Also, short-circuiting when the line did not change is problematic because moving the cursor (for example with the arrow keys) won't change the line's text.\nThe proper solution would be to suppress input reading and key handling during composition events. The contentEditable input backend (for mobile) already does this, but the desktop one does not. Basically, the TextareaInput class (in codemirror.js) would have to listen for compositionstart and compositionend events, and disable input polling in between them. Are you sure a normal keydown event for Enter is fired when composing? If so, we'd have to somehow disable the keymap functionality as well during composition.\n. I've done some IME work in 40b5625, but I wasn't able to reproduce this problem on linux, where no enter key event is fired when you confirm IME input. I'm not quite sure how to reliably handle this -- one option would be to generally ignore Enter presses when composition is active, but that seems very specific and prone to problems (do arrow keys, space, and other ime-related keys have the same problem?)\n. I don't do early feedback on half-finished code, but if you have something that you feel is finished, I'll review it.\n. I've added a few notes. Are you combining this mode with a content (HTML or so) mode using addon/mode/overlay, or aren't you?\n. Wonderful. Merged as f7a00e0. I was just curious whether a simple mode would work with an overlay, but I guess there's no reason why it wouldn't.\n. Using the multiplex addon instead of overlay should help here (the main difference being that the outer mode does not get to see the content inside of the inner mode, but before now, that would not feed the delimiters ({{ and }}) to the inner mode, which would prevent the handlebars mode from highlighting any handlebars code. In patch 9c524fd, I've added an option parseDelimiters that changes this, and I've updated the handlebars demo to use a multiplexing mode.\nAlso note: I've changed the mode name of the handlebars mode to handlebars, since all CodeMirror modes define a mode with the same name as the file/directory they live in, and it'd confuse people (as well as the loadmode addon) if that no longer holds.\n. Yes, and I release once a month, around the 20th (so that'll be early next week this month)\n. Does the attached patch solve the problem for you?\n. This is not going to happen. It would surprise and piss off most of our existing users. As @marcguyer mentioned, just put it in your local CSS.\n. Sounds useful. Implemented in attached patch.\n. That's a good point. Could you see whether patch 0a83a4b solves the issue for you?\n. Oops, I routed all calls around the method that was supposed to handle that and did not notice. Attached patch should fix this.\n. This branch was mostly written by last year's Summer of Code student, but he never really finished it properly or added tests, and I don't want to merge it in the state it is currently in. This is extremely tricky code, so finishing and merging it would take some time and energy. I have been too busy to take this time. If you are part of an organization that can allocate some money for this, that would help, I guess. If not, I guess I'll eventually feel bad enough about this to work on it, but that might take a while.\n. Thanks for noticing that. Merged as 5f44dd5\n. Please make sure the linter also passes (install node, npm install, run bin/lint).\nAnd remove boilerplate code that isn't actually needed. I notice the CFG mode has an indent function that A) seems useless, since the config format doesn't seem to involve indentation, and B) doesn't work (crashes with \"ctx.indented is not a function\"). That looks like you simply copy-pasted the code and didn't think about it very much. Similarly, since you're only defining a single mime type, the def function is a waste of space in that file.\nFinally, please rename the cfg mode to ttcn-cfg, since it is too obscure to take such a short name.\n. Superseded by #3213\n. Sounds good. Merged as 2e16ef6\n. Thanks! Merged as 5c90705\n. @dbarnett At the CodeMirror level, doing instance.setOption(\"mode\", instance.getOption(\"mode\")) should not lose any information (the original value is preserved at the mode option's value). Is that what you were talking about?\n. Looks great! Merged as e22891b\n. Thanks for noticing that! Merged as 4febeb32f79684c3\n. There's quite a lot of tricky aspects involved with doing your own mode-switching like this. Any reason you didn't use a multiplexing mode (as in the multiplex?\n. Could you elaborate on the problem that is being solved by this? In principle, the editor should be able to handle compose events.\n. Turning off autocomplete seems like a very indirect and complication-prone way to address this. So yeah, I'd prefer to test first and only go ahead if the problem persists.\n. Closing this due to lack of response, feel free to comment/reopen if new information is available.\n. If you want serious, correct tokenization, you'll run into many other problems if you try to use the JavaScript mode (or any CodeMirror mode). Have you considered simply pulling in Acorn or so, which has a well-tested, mature tokenizer?\n. The github page is the project page now. I'll update those links. The Esprima page is broken because they blindly upgraded to 1.0. The project is very much alive (see the commit history) and recently saw a lot of improvement (ES6, extensibility, 1.0 release).\n. Good idea. Merged as 82e86ef74a55, fixed in d6318cbbb8a0597395\n. You're passing it the wrong kind of arguments (it expects two separate values). See the manual\n. Thanks for noticing that. Attached patch fixes the docs.\n. No, I try to follow existing conventions on each platform, and consistency between them is not a goal. Having ctrl-up/down behave like plain up/down is common behavior on the PC\n. Thanks! Merged as 7ea815d \n. This is what fromTextArea does: it hides the textarea, so and displays a CodeMirror instance in its place.\n. Thanks! Merged\n. Looks reasonable. Merged as 21e6d2f\n. Thanks for updating the code. Another comment is that for many tokens, you are returning types that are not styled in the existing themes. Adding extra information for your custom styling is okay, but try to combine it with at least one 'standard' token style (for example, return \"builtin timerOps\" rather than just \"timerOps\"), so that other themes can also color the code halfway properly.\n. Thanks! Merged as bdd6c0edc8031, 92ec62d2785a71e37, 46e9a5e08f44687, and fa11b729130b91be77. I made small changes to the ASN.1 mode, renaming the file to asn.1.js and the mode definition to define the string \"asn.1\", so that the mode name matches the file and directory name (which holds for all other modes).\n. The manual was wrong here, and attached patch fixes that. Documents without editors attached to them do not do highlighting, which is needed to get token state, which, in turn, is needed to find the local mode at a given position.\n. At one point CodeMirror's default background was transparent, but that's no longer the case. So I guess we can merge this. Done as f14a29f\n. Wonderful! The bottom of the manual seems like a good place.\n. This doesn't look like it landed in the proper place.\n. Doesn't the dialog disappear when you search, so that it can not cover something you 'searched' only something that you are 'going to search'?\n. Merged as 52ad899. When adding commits to a PR, you should usually also add a comment, since I don't get notified of commits and I don't go through open PRs very often.\n. Thanks. Closed via #3226 \n. Thank you. Merged as a5f2de4\n. Attached patch fixes the problem of not being able to change mode in a different way.\nIn what kind of situation do you want to apply multiple linters?\n. This is not happening in the demos. It is likely to be a CSS conflict or other CSS issue. Can you try and reduce your setup to the minimum HTML/CSS needed to cause this problem?\n. Seems that one, along with the \"shown\" event, was accidentally dropped in the recent refactors. I've attached a patch which restores both, and checks for the necessary preconditions when firing the \"close\" event.\n. No. You can run modes using the addon/runmode/runmode.node.js, but constructing an editor without a DOM would not make any sense.\n. There is nothing in the CSS of the jsbin you linked.\n. That is interesting. This looks like a browser bug -- Chrome interpreting the height: 100% of the CodeMirror instance in a weird way. Even if I make .item have position: relative, the editor ends up too high. I don't have much experience with flexbox, but I don't think it is supposed to violate height calculation expectations like that. Even if I replace the editor instances with simply a div with class CodeMirror, the problem persists (the divs are the height of the outer element, rather than the inner ones).\n. I am now getting even stranger behavior in Firefox. Closing this on the assumption that the browser are buggy and this isn't something CodeMirror itself can help (the issues show up even if CodeMirror is removed from the equation)\n. Merged as a6cf6e3\n. Good catch. Attached patch should help.\n. People have run into this before. It looks very dumb behavior on the part of requirejs, but I don't have enough experience with that library to really comment on what it is thinking. In any case, this isn't something CodeMirror itself can fix.\n. I don't want to do this, though. It requires every user to add a definition, which shouldn't be necessary.\n. I can't say I really understand the issue and the solution here. @oscarotero Would you mind suggesting a formulation for the docs that you feel would be helpful?\n. So the important thing is to use packages, not paths to configure CodeMirror?\n. Thanks. Merged.\n. You can't, and you shouldn't, since highlighting information will be reused if the line moves (through lines being inserted/deleted above it), so you're not highlighting a specific numbered line in the first place.\n. Does the problem occur on the demos on http://codemirror.net? I just tried (Chrome 42, Mountain Lion), and copy/paste from the context menu worked fine.\n. Try to narrow it down -- something in your site is causing it, so remove pieces one by one until it goes away, then figure out what precise line did it. It is likely a CSS conflict, but might be something else.\n. In the JSBin case, it seems to be caused by a mysterious no-op CSS transform they inject:\nbody { transform: translate3d(0,0,0); }\nWhy a zero-translate would have an effect on the position of the textarea I don't know.\n. Actually, some further testing suggests that a 3d transform prevents the trick where CodeMirror puts a textarea under the cursor from working because it makes it appear on the screen asynchronously, possibly due to some interaction with the graphics hardware being needed, which prevents the context menu click from taking effect on that textarea. \nSo yeah, 3d transforms on the body break CodeMirror's textarea hack.\n. Hold on, I misdiagnosed that. It's not about async/sync relayout, it's about a weird position computation for a position: fixed element in a body that has a transform. You can see the effect using this test HTML:\n``` html\n<!doctype html>\n\nFixed at 0,0px\nToggle transform\n\n```\nChrome and Firefox share this behavior so I guess it is somehow standard? Seems somewhat awful regardless.\n. Okay, I'll stop spamming soon. It appears that you can't use position: fixed in its normal way inside of a transformed container. This means that JSBin appears to be breaking fixed positioning, and that you have to be pretty careful with transforms in general.\n. I think attached patch helps here.\n. Firstly, this is not a bug report, so it does not belong here. Go to discuss.codemirror.net for support requests.\nDon't use keyup, you can't rely on it being fired, since many key events will be preventDefault-ed when the editor handles them. You could listen for CodeMirror's \"inputRead\" event instead.\n. The problem appears to be that Chrome only uses ~25 bits for the height of an element. I assume a similar issue exists in Firefox. If I inspect the .display.sizer element after running your example code, I see an element with min-height: 38000008px, yet if I get its clientHeight, it says 33554428 (which is 2^25 - 4). The scrollbar height is based on this reported element height, but it seems that in general the browser refuses to scroll the wrapping div any further (manually adding to its scrollTop has no effect).\nSo you seem to be reaching a limitation in browsers, not in CodeMirror, here. We could work around it by doing a lot more scroll-related work in our own code, but I am not really interested in doing that right now (I'm relying on native scrolling to keep wheel scrolling smooth, and changing that would create all kinds of new issues).\nI'm closing this as 'can't cleanly fix'. If you feel it is very important, try bugging browser vendors to lift their height limitations.\n. So after putting back the cssText (which presumably contains a position: absolute) the element's .style.position is still \"fixed\"? I don't want to sweep the bug under the rug with an opacity: 0, I'd rather figure out what is going wrong and how we can work around it. Is there any way I can reproduce the issue?\n. Interesting. If you can submit a (minimal) test HTML page that allows me to reproduce this, that would be useful.\n. Closing until a test case shows up.\n. These links (the red ones in the navigation area on the left) are supposed to indicate your current position. Them linking to the thing you are currently looking at is intentional and not something that should be fixed.\n. Patch 426822e should solve this (the Tern addon relied on the \"close\" event, which was broken)\n. Some git digging shows that this is a holdover from CodeMirror 1's CSS mode, repeatedly ported forward without rethinking. I've removed it in patch 9d320fd\n. Where are you searching? The output of the test runner, unless you broke a bunch of core functionality, should be short enough to not even need text search.\n. [Comment deleted since it was made in the wrong issue]\n. Sorry, I commented in the wrong issue (that was meant for #3251)\n. Fixed via #3248\n. This is a question. Ask those at http://discuss.codemirror.net, not in the bug tracker.\nThe answer is: no, the matchbrackets addon doesn't do this, it only shows the state of the bracket at the cursor. You'd have to write custom code (possibly using the scanForBracket method defined by matchbrackets) to implement the feature you describe.\n. Looks good enough. Merged as 736140c06f675e and added a test in d47bc479c884\n. I still do not believe this belongs in the distribution. Firstly, Emacs-style \"buffers\" are not something CodeMirror interfaces are based on, so this isn't something that many people would be able to use. Secondly, the actual functionality provided here seems very minimal (JSON-ifying some existing information). So, since people will want to put their own interface on this anyway (showing it in a popover as an HTML list, or as you did, in a buffer, or in some kind of tooltip, or as a separate help page...), we might as well leave them to implement the whole thing in their own system, rather than providing a half-solution that isn't going to fit properly most of the time.\n. Thanks! Merged as c8f0fee\nNext time, try to submit a branch with only the relevant commits in it as your pull request.\n. This has come up before. I think a better approach is to have a window associated with each editor instance, so that you can have editors open in different frames at the same time.\n. So the question is why are you putting the editor in an iframe in the first place? Of course you have multiple CodeMirror instances in a single window.\n. I think I'll make per-editor window configuration part of the next version of the editor, but from the sound of it I don't think I want to merge in your semi-global solution.\n. First, there is no 'wrong' indentation here -- there are a whole bunch of styles for indenting c-style switch, and thus the indentation isn't 'meant to' be anything. I've had people complain about the indentation in the JS mode as well, and had to add an option to disable it.\nBut yeah, having the same default behavior in the clike and javascript mode seems like a good idea. Attached patch adds it. Please test.\n. @cithukyaw How is that in any way related to the issue you are replying to?\n. I wasn't aware that this was allowed (and couldn't find docs on it), but I've just whitelisted parens to be allowed inside interpolation in attached patch.\n. CodeMirror can not detect your system's keymapping, so all it can do is take the default text editing keybindings for your platform, and bind similar functionality to them by capturing browser events. There is not really much we can do about this issue (apart from not binding any keys, which would make the editor rather horrible to use). But the good news is that keybindings are entirely customizeable, so if you control the site, you can change them, and if you don't, you can at least create a bookmarklet that changes them (in this case, something like delete CodeMirror.keyMap.emacsy[\"Alt-F\"]; delete CodeMirror.keyMap.emacsy[\"Alt-D\"]) \n. This is by design. If you put the cursor in the folded code, the assumption is, you probably want to see what's inside.\nThe clearOnEnter option to markText can be used to control this behavior.\n. @mightyguava We could set up the vim mode to force the width of the cursor(s) to be the actual width of the character they are on top of after every selection update. It's more expensive, but should give better results.\n. > And, I\u2019m agree with @Marijn Haverbeke: we can set font-family of .CodeMirror in codemirror.css to a specific monospace font like Source Pro or Courier.\nThat's not what I suggested at all. Browsers are supposed to give pre tags a sensible default fixed-width font. I'd say that what Safari is doing here is a bug in Safari. CodeMirror has no business prescribing a font to use, but should just use the default one and/or let users override it.\n. > how do I go about doing this? Using charCoords() to get the size, compute the width, and then setting it directly on the cursor div?\n@mightyguava Exactly. But on second though this is a bit scary -- it is almost guaranteed to add another dom-layout-round-trip and the payoff doesn't seem great enough to justify that. Alternatively, we could support it in the core, but still, not sure if it's that important.\n. Thanks for noticing that. Fixed in attached patch.\n. Thanks. Are you sure it is worth including a list of a thousand character names (weighting over 10kb), rather than just matching anything that looks like \\[foo] as a character reference?\n. Actually, the same goes for the ridiculously long list of keywords. This would be, if merged, by far the biggest mode file in the distribution. Since a lot of people are going to be downloading the file without ever using it, I don't think that's okay. If you can't cut down the list of keywords/builtins to something more reasonable, this is probably best hosted in a separate repository.\n. Wonderful! Merged as de9a6b9\n. This does not happen in the demos (at least, not on Chrome), so I suspect it is some other local code you have that is doing this, or it only happens on a specific browser and you didn't give away which one you are using.\n. I am aware of this, but have not been able to come up with a solution.\n- We normally rely on the mouseup event to abort a drag-select\n- But when the mouse is released outside of the frame, that event isn't delived\n- So on most browsers, we can use event.which to figure out whether the mouse is being held in a mousemove event.\n- IE always sets which to 1, even if the button was released.\n- It has a buttons property on such events, which could in theory be used to work around this.\n- We did so for a while, but that caused problems as well, since there is a bug that causes this property to be reset to zero for no good reason if the DOM is updated during the drag (#2577).\nMaybe the next IE (Spartan) will finally fix this. Until then, I think this bug is less of a problem than randomly having drag-select abort.\n(Other solutions, if you can find one, are of course very welcome.)\n. CodeMirror maintains focus unless focus is explicitly moved to some other element. This is probably some Angular magic getting in your way. Feel free to reopen if you have more evidence that the problem is directly CodeMirror-related, but until then, I'm marking this closed.\n. Please don't open github issues for support requests. Use http://discuss.codemirror.net/ for that.\n. Did you benchmark? I expect the work of looking up a line handle to be small compared to fetching actual coordinates (but if you're asking for lots of cached coordinates, it might not be). I did a simple benchmark where I couldn't even find a significant improvement from using such an extension.\nAnd doing this isn't free -- it clutters up the API. We wouldn't just have to do it for charCoords, but also cursorCoords, and probably just about every method that takes a position, for the sake of consistency. That means we have more noise in the docs, and an additional optional parameter for these methods and if we ever come up with another parameter we want to add, it'll have to go after that one. I don't think I'm willing to pay that price unless a serious improvement can be demonstrated.\n. Thanks. Merged as e3cc695 \n. See the commit message on patch 2e16ef661fd9a7261d143b23d22df87d3a75237c. @mtaran-google felt this was preferable, and I don't necessarily disagree (other modes, like JavaScript and clike, also highlight alphanumeric operators as keywords).\n.\n. > but then that make every themes that define an operator style useless/inconsistent.\nThat is a huge overstatement. Syntactically, keyword operators are also keywords, and highlighting them as such is hardly going to destroy the use of the highlighting.\nMaking all themes that don't specifically style operators style them as keywords is definitely not acceptable. You could make the Python mode style keyword operators as \"operator keyword\" if you want, so that it is up to the themes to determine which one has precedence.\n. Thank you. Merged.\n. Thank you. Merged as daae9be\n. Are you resizing the whole browser window, or using some in-page resizing functionality?\n. Right -- CodeMirror can not detect such resizes (no meaningful events are fired for them), so in cases like this, where your script forces the editor to resize, you should call the setSize method on the editor (without arguments) to force it to clear its position caches and re-measure the actual positions of things.\n. Read the docs and make sure you are actually passing it the parameters it expects.\n. Merged in slightly changed form as b22783d\n. Why is the call to applyTextInput 'weird-looking'?\nDoes replacing the check for !cm.state.focused with activeElt() != this.textarea help?\n. Does attached patch solve the issue for you?\n. Could you give a more descriptive commit message and add a test to test/sql-hint-test.js that verifies that whatever it is you are fixing here stays fixed in the future?\n. I've merged this as 172a78163d3ad8\nThe tests that use display text test for both the inserted text and the display text, so it was not complicated at all to add a test. See attached patch.\n. CodeMirror edits plain text. It does not format it. If TinyMCE feeds it a single line, it'll display a single line.\n. Fixed in attached patch.\n@baconface Declaring that a bug isn't a bug because the relevant code doesn't conform to your preferred coding style isn't really appropriate here. We try as much as possible to target language syntax, not specific coding styles.\n. Thanks, merged as 7069185\n. Releases are done monthly, so you'll have to wait for 5.4 for this to appear in NPM and such.\n. \ud83d\ude15\nThat option is off by default and not enabled by the JavaScript mode demo that you link to. Modes don't in fact, have any control of the way tabs are used for indentation, they can only prescribe and indentation level.\nCould it be that you are misunderstanding that this option does?\n. You didn't actually describe\n- What you are doing\n- What you expected to happen\n- What happened instead\nCould it be that you're pressing the Tab key, and that inserts a tab? If so, look into keybindings instead, this option has nothing whatsoever to do with the default binding of the Tab key.\n. And that is the intended, documented behavior.\n. You probably simply want to do something like\njavascript\nCodeMirror.keyMap.default.Tab = function(cm) {\n  cm.execCommand(cm.getOption(\"indentWithTabs\") ? \"insertTab\" : \"insertSoftTab\");\n};\nto override the default binding to do what you want.\n. @bfrohs Want to take a look at this? (The report makes is framed in terms of continuelist, but the issue actually also shows in the highlighting -- a list after a HR isn't recognized as such.)\n. Fixed via #3282\n. This is due to the default (browser) style for <input> elements not inheriting the font size of its parent. Simply override it in your own css, like input { font-size: inherit }, and you should be fine.\n. Why would we? Font sizes in dialogs are not what this library is about. There are a hundred other CSS corner cases that we could proactively address, but including them would just bloat up the library and cause unexpected side effects.\n. Fixed via #3274\n. Thanks! Merged.\n. Sure, merged as 64b11dc\n. Yes, they are.\n(Next time, use http://discuss.codemirror.net for questions. This is the bug tracker.)\n. Nice! CommonMark compatibility is definitely something I consider a good thing. I've merged this as 495de32\n. You might not want them, if you're just taking the value of the function. There's a long tradition of simply-complete-the-word style autocompletion, and the Tern addon sticks to that approach.\nIf you want, you can submit a pull request that adds a hook to the Tern addon to make extending completions from client code possible (say, a function that is called on the completion object before returning it).\n. I'm not aware of any of these parsers (I think markdown-it is the most mature one in that family) exposing the primitives needed to build a CodeMirror mode on top of them (incremental parsing and being able to copy the parser state).\n. Thanks! Merged as 6fa7e27\n. Thanks. Merged as 6482803 \n. I can't reproduce this anymore, and there have been big changes to sql-hint in the meantime, so I'm going to assume it was fixed.\n. See https://github.com/codemirror/CodeMirror/wiki/Mode-wish-list\n. Note that, at the moment, there is no way to get the content of the clipboard from JavaScript, and only spotty support for setting its content (outside of the context of copy/paste events), so I'm not sure this is a realistic feature.\n. Thanks. Merged as f0b870d\n. The clike mode's electricInput property was too restrictive, and didn't fire on {}EOL, only {EOL. Attached patch fixes the problem for me (but note that you'll also need patch 5e989bdabd385357949 from early last month).\n. There is no unicode in the CodeMirror source file, the is 'backslash-u-dee-cee-zero-zero' etc. As such, I'm not sure how that could cause Postgres to complain.\n. Indeed, closing this.\n. The YAML mode is known to be a bit of a mess, and I don't have enough experience with YAML (nor could I find a formal grammar) to know what the proper fix is. You can try looking at the code yourself, or try to describe the circumstances in which a colon is a tag separator in a sufficiently formal way for me to figure out a fix.\n. Nice! Merged as 23a03a9b7960 and linked in 00d968d6cbf.\nThe state maintenance could use some cleaning up, for example by unifying everything in a single state machine and dispatching to the tokenizer function that can handle the current state (by storing the function in the state object, rather than a plethora of flags).\nFor mixing this with HTML, you should be able to use the multiplex addon to multiplex between the outer and the Twig mode, by dispatching on {%, {#, #}, and %}. For an example of this, see the source for the Handlebars demo\n. Again, this is out of scope for CodeMirror. You seem to be referring to a specific use for displaying code blocks (though you never mention which one) but this is something built on top of the editor, and functionality like folding away an editor would have to be built into whatever code is inserting those editors.\n. Wonderful! Could you add an index.html demo file for the mode (copy-paste one from another mode and adjust)\n. Thanks! Merged as bb51787\n. Thank you! Merged as 63155b7.\n(You can, by the way, simply push to the branch used for a pull request to change the patches in the request. That way, you don't have to create a new PR, but simply ask for another review on the old one.)\n. You could make part of your document readonly with markText, or you could use the \"beforeChange\" event to try and filter changes that you don't allow, but there is no easy to way to express such filters in terms of 'adding a style to a class', that's much more high-level than the text level that CodeMirror works at.\n. Please take a look at the attached patch instead. It adds a more general way to add options to queries. You'd pass it queryOptions: {completions: {caseInsensitive: true}} to get the effect you want. Does this work for you?\nAs for the double negative, I agree that's bad style, but that ship has sailed (it is part of the Tern API, and I don't consider it a big enough problem to change it now).\n. I am not sure I understand your concern. Yes, queryOptions could override properties that the library itself added, and you could pass something like {type: \"foo\"} and break the library. But why would you?\n. Does it also happen on the demos on http://codemirror.net ? Which browser are you using?\n. Please provide a full demo html file, and tell us which browser you are using. Also make sure the codemirror.css you have corresponds to the version of codemirror.js that you're using.\n. Woah, you basically reimplemented the simple mode addon. What limitation did you run into, precisely? And would it make sense to extend the simple mode addon instead?\n. Have you tried opening an issue for Brackets to load the simple-mode addon by default? It is tiny, and a bunch of modes are using it, so they may be open to that.\n. In any case, I'm not merging this, since it is simply duplicating code that's already in the distribution.\n. This does not happen in a regular CodeMirror instance. You probably have some CSS rules that are forcing the editor lines to have the same width. Try removing your custom CSS piece by piece to find out which rules are causing the problem.\n. No, it does not. The editor's size is fixed. When you say 'line editor', do you mean the line number gutter? If so, yes, obviously that has to get wider, if it must fit wider numbers.\n. I still do not know what the problem is. The screenshot looks fine. Could you take a step back and try to actually explain what is happening, and what you expected to happen?\n. I think attached patch fixes this. Could you also test it?\n. We are currently only applying the input to the actual document when the IME composition finishes. That means that addons, such as the completion addon, won't see updates as you are composing.\nI might at some point change this, but for now, this is how it works.\n. The plan is to update the editor state on each input change. There will be some trickiness about what you can do in these updates without causing the composition to be aborted (placing an inline widget in the composed code, for example, wouldn't work, but overlaying it over the editor should be fine).\nI've opened https://github.com/codemirror/codemirror.next/issues/30 for this. Resetting the mode option with setOption will trigger a full re-parse.\n. Attached patch adds this feature to the demo/requirejs.html demo. The trick was probably that you have to set CodeMirror.modeURL to something that requirejs can work with.\n. The link style is added for the link text, not the url, so I think the image link looks good.\nWhich theme is that? In the default theme, the cm-link style has higher precedence than cm-quote, but it appears that is not the case in this theme.\n. We intentionally don't have token styles for every possible semantic thing, so that writing themes remains workable. This many modes overload token styles to mean different things, but this should not be a problem.\n. I am saying that using cm-string for URLs is not a problem. Themes don't overload modes, modes overload styles -- using string for urls is exactly an example of that.\n. Markdown already adds a bunch of extra styles for semantic disambiguation. Attached patch also styles link targets as url, so that a site can give them a custom style.\n. Please see #2569 and reach some kind of consensus with @laurelnaiad \n. All right. Attached patch removes it along with the line in the release script that was responsible for updating it.\n. Good point. Merged as 61e27f0\n. Thanks. Merged as ee62a07\n. Nope, this is fine the way it is. All the text in a quote gets the quote style added.\n. Aha, I see what you mean now. That was a bug. Attached patches fix it, along with a CSS precedence issue that the fix exposed.\n. Please don't open issues for support requests. Use http://discuss.codemirror.net for that.\nI updated the demo/requirejs.html yesterday to include an example of using the loadmode addon. That'll probably help.\n. Thanks. Merged as a08e3ec\n. Block commenting works fine, and there is no conflict. The command toggleComment will try to line-comment before it tries block commenting. That is what it does. If you want something else, call the methods defined by the addon yourself.\n. Thanks. Apologies about the delay, merged now as 4ab7e90\n. See my comment on #3325\n. I assume you're talking about the way it tokenizes x->y? Attached patch fixes that. Are there other problems that you've noticed?\n. Attached patch further improves the situation. Highlighting namespace names is intentional. I guess you both 'open' and 'define' a namespace with the same syntax, so you could argue whether calling it a definition is appropriate, but it seems sensible and harmless enough to do so.\nI've also added a styleDefs option to the clike mode. You could, for example, say CodeMirror.mimeModes[\"text/x-c++src\"].styleDefs = false to turn it off entirely. (Or define a new MIME with a copy of the old C++ config but with that option added.)\n. You won't be able to actually edit the text if you replace it with another\nDOM node, though. In this case, I think the easiest approach is to use\nzero-height line widgets that you place above the lines. See\nhttp://codemirror.net/doc/manual.html#addLineWidget\nOn Wed, Jun 17, 2015 at 8:35 PM, Vincent Woo notifications@github.com\nwrote:\n\nYup\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3333#issuecomment-112908277\n.\n. Merged as 0bc820bf583, and copied a helper function you missed in 59d78210d6d.\n\n(This is all awful and at some point in the future I'll turn CodeMirror in a bunch of ES6 modules so that you can load parts in Node without duplicating code.)\n. And it does. Did you try with a recent version?\n. Okay, I see what you mean now. I do wonder why your initial description was...\n\nCodeMirror should syntax highlight the \"property: value\" inside the @supports condition as well as \"and\", \"or\" and \"not\" keywords.\n\nYour patch looks good. Shall I apply it or do you want to create a PR?\n. Done via #3338\n. I can't make much of your description of this functionality, but the demo seems to show some kind of incremental search. The patch seems to formulate the functionality in a strange way and doesn't work very well (it gets confused if you backspace or paste). I think it would make more sense to define a new command for starting an incremental search. Also, use the \"input\" event, not key events, to notice when the dialog's content changes.\n. Could you take a look at patch 404e308 and see if it meets your requirements?\n. Great. I've merged your pull request.\n. The second form is simply not currently recognized as a string by the PHP mode. Attached patch fixes that.\n. You can already scroll the outer page without being stuck in the editor. Our wheel event handler only preventDefaults the event in rare circumstances, so I am not sure this patch is addressing a real problem.\n. This is a good point, but your solution doesn't work for inline (markText) widgets, which will end up inside the pre tag. Not sure what to do about that. Does modern CSS allow any kind of negative selectors yet? ('When not inside class X')\n. That's not a great solution either, I think. I modified CodeMirror to give the wrapping span for each line a CodeMirror-line class, and then changed the selectors like this:\ncss\n.CodeMirror-line::selection, .CodeMirror-line > span::selection { background: #d7d4f0; }\n.CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection { background: #d7d4f0; }\nIt works (at least on FF and Chrome). Does it look sane to you?\n. Attached patch should help. Let me know if you run into further problem.\n. I'm leaning towards targeting CommonMark by default, since having a spec to compare what we are doing against (rather than a vague consensus of parsers) provides a much more firm ground. I'd be open to an option that enables parsing such headers, though.\n. If you didn't write this, I'd like an explicit confirmation that the person who wrote/owns it is okay with releasing it under our MIT license.\nAlso, please follow our general code style when submitting code. That means two-space indentation, and getting the linter to pass.\n. Merged via #3346\n. This works for me. Make sure the mode scripts are in the place where loadmode expects them (see the CodeMirror.modeURL setting). You'll see an error in the console if it can't find them.\n. Aha, you didn't mention you were using gfm. It seems the gfm failed to actually define the MIME type that meta.js declared for it. Attached patch fixes this.\n. Wonderful. Merged as 60879eed092 and adjusted to local code style in 4a295392c2\n. @mightyguava Is this on your radar? Anything I can do to help?\n. Looking at the code, it seems you can already set a selectedHint property on your completion object to control this (a zero-based integer index)\n. Good point. See attached patch\n. Does this also happen on the demos on codemirror.net? I tested with Chrome under Debian, which should be close to your setup, but couldn't reproduce this.\n. You are passing strings as line and character offsets. That is not supported. Remove the quotes around the numbers and all is well.\n. Did you include the XML, JavaScript, and CSS modes? These are dependencies of the htmlmixed mode.\n. Well, it works in the demo, so compare your setup with the situation in the demo to figure out what is going wrong.\nClosing, but feel free to add comments or reopen if you've isolated an actual bug.\n. Duplicate of #3122\n. Who exactly determined that these characters are unsupported? It seems to be Gerrit, and if that's so, I think submitting a patch to Gerrit would be more appropriate.\n. I haven't run into this before (there have been similar bugs, but they were fixed). You can try to reduce it to the minimal set of factors that trigger the issue, and submit a demo for me to debug.\n. The browser's built-in spell-check doesn't work with the way CodeMirror renders the content. You can integrate something like typo.js, by writing glue that uses markText to highlight suspected mistakes and hooking into mouse events to show a set of suggestions. Several people have done this but I'm not aware of an open-licensed implementation. This is out of scope for the main project, since the result is always going to be sub-optimal (big download, typo.js is often horribly slow) and I don't want to deal with the resulting support requests.\n. I was able to reproduce this and found the cause (poor placement/sizing of gutter background nodes). I haven't yet found a solution, but you could put this in your css as a workaround:\ncss\n.CodeMirror-gutter-wrapper {\n  height: auto !important;\n}\nI'll continue to look for a solution next week.\n. Attached patch implements a proper fix.\n. I've pushed the themes (f52e64d095db6a8bbb) and the Brainfuck mode (84c8c92968174df). I don't consider the linenumbers-for-runmode or the minimap implementations to be production-ready. Next time, please create one pull request per feature, clean up your patch history, and only submit code that is done. This saves me a lot of time.\n. Merged as 8d79749. Have you considered making variable-2 a little brighter? In JavaScript code, you'll often have a lot of these (http://codemirror.net/demo/theme.html#icecoder) and the current color makes for a rather low-contrast look.\n. That fix introduces a new layout round-trip into the redraw logic, which is definitely not acceptable. See my alternative patch 31d89d6e4 . Test merged as 50aba2033fc\n. About one week from now (I release monthly, around the 20th)\n. Yes, sounds like @mattpass is correct. To display properly, the editor needs access to its own measurements. It can only get those once it's visible, so make sure to call the refresh() method after the first time the editor becomes visible.\n. runmode does not support line numbers by default, intentionally. You can pass your own callback to construct line numbers in your own way, but as a default, it doesn't make much sense (the CSS styles for the line numbers in the actual editor would only work if we'd replicate a lot of the complicated DOM structure that the editor has, and you don't want to do that when highlighting code).\n. Could it be that you are using an old version of CodeMirror with addons from a more recent distribution? CodeMirror.registerGlobalHelper definitely exists in current versions.\n. CodeMirror doesn't provide such functionality. It does provide an API aimed to make it easy for 3rd-party code to do so.\n. The style you circled is on the hidden textarea and will not impact the display of the editor. If you can provide me with an HTML page, a browser in which this happens, and instructions to reproduce it, I'll gladly try to debug it.\n. I actually don't think this is a bad way to resolve it. We did a similar thing in our implementation of contains, which also doesn't automatically see through shadow DOM. I've applied this in 8e6aca8, let me know if you run into further issues.\n. Thank you. Merged as efca209\n. Highlighting ridiculously long lines is a performance hazard, and yes, that can sometimes confuse the tokenizer. You can set the maxHighlightLength to Infinity or to something larger than the default (10000) to work around this, but I don't know of a general solution to this problem. Suggestions welcome, though.\n. Thanks! Looks nice and clean. Merged as bd36c1dbe484 with a few small changes in e5b224af8db\n. Ah, the legacy of C's operator precedence choices. Thanks for catching that! Merged as 127a6e0\n. Indeed. I unfortunately don't review all code in depth, and nonsense like this is probably common in the mode files. Thank you for doing a more serious review. Merged as 8cc9eb8\n. (Actually, looks like you used an automated tool to find these. Nice!)\n. Merged as c2350fd. Not sure how those ended up there and why the tests passed without them, but so it goes.\n. Thank you. Merged as 9a532d3\n. Thanks! Merged as b8c4ea1 \n. NPM will use .gitignore when .npmignore isn't present. Is there any specific thing that wasn't being handled by .gitignore that you are addressing here?\n. bin should definitely be included, since it contains utilities that users might want, and there isn't actually a components directory in the repository. Stripping package.json also seems like a bad idea. But I guess stripping the docs and examples from the release is probably good. Merged as 4c4c0c6\n. Thank you. Merged as baad003\n. Sounds good. Merged as 0026883\n. Thanks. Merged as e585ae8\n. The keymaps in the distribution are meant to be used as base keymaps (the keyMap option). Using them with addKeyMap is probably not what you want.\n. You probably want a select, not a checkbox, for choosing a base keymap. You can do editor.setOption(\"keymap\", \"default\") to go back to the default map.\n. Attached patch causes HTML comments to be parsed as comments (which are, in the default style, not grey)\n. This is one of those cases where not being able to do across-line lookahead makes it impossible to get accurate highlighting. Since CodeMirror does not support such a lookahead, this is not going to be supported.\n. Submit your test case (make sure it is really small, not fairly small -- i.e. don't make me dig through irrelevant code) and I'll try to debug it.\n. I did not get the problem you describe, but your demo did uncover a different wrong behavior for me (not being able to scroll down to the bottom of the document), which attached patch fixes. It is possible that it also fixes the problem you are describing. On my Chrome, I don't end up with a single 'blah' on the last line when I follow your instructions, probably due to a small difference in font rendering (I assume you meant the css at the top of your demo to be a <style> tag).\nCould you pull the latest code and retry?\n. The line wrapping is done by the browser, so the Chrome/FF differences are\nto be expected and not something to worry about (though I agree that\nsometimes browsers do weird things here).\nThe measurement effect you're seeing happens because the \"change\" event is\nfired before the redraw is done (so that changes triggered by change events\ndon't keep causing new redraws), at which point the editor does not have\naccurate information about the new line height yet. You could listen to the\n\"changes\" event or set a timeout in the \"change\" event, to have your code\nrun when the display update is finished.\nOn Thu, Jul 16, 2015 at 6:00 AM, greaber notifications@github.com wrote:\n\nLoad the following page, then insert an 'x' as the first character in the\nbuffer. In Chrome, inserting the 'x' pushes the start of line 1 down a\nline, so I believe the output should be two different numbers with the\nsecond larger than the first; but the output is \"313\\n313\\n\". In Firefox,\ninserting the 'x' doesn't move the start of line 1, so I believe the output\nshould be the same number twice; but the output is \"350.5\\n283\\n\".\n\n\n\n      body {        width: 200px;    }    .CodeMirror {        height: auto;        border: 1px solid red;    }    \n\n\n<textarea id=\"myTextArea\">blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah\nblah\n    (function () {        var myTextArea = document.getElementById('myTextArea')        var cm = CodeMirror.fromTextArea(myTextArea, {            lineWrapping: true        })        console.log(cm.cursorCoords({line: 1, ch: 0}).top)        cm.on('change', function (instance, changeObj) {            console.log(cm.cursorCoords({line: 1, ch: 0}).top)        })    })()    \n\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3387#issuecomment-121821854\n.\n. When a line is updated, CodeMirror starts by guessing its height, so that it has an approximation to work with until it has drawn the line and measured the actual height. Since the wrapping algorithms in the different browsers are different, that estimate may be closer to the real height in some browser than in others.\n\nI've pushed a small documentation tweak to clarify the event timing around the end of an operation.\n. Looks great. Pushed as 0c2264b. I've removed out the example editor on the demo page, since that is already getting too crowded.\n. Thanks! Merged as 01f2a1b \n. Markdown does not historically support these. Use the github-flavored markdown mode instead.\n. We could abort asynchronous lints when a change or a swapDoc happens. Does that sound like it'd solve your problem?\n. No, there isn't. The addon currently simply starts on a debounced change event.\n. Done via #3415\n. Look here: http://codemirror.net/doc/manual.html#addon_searchcursor\n. Thanks. Merged as da42989. But note that the Rust mode in general reflects a very ancient version of Rust (early 2012). The current grammar is much more regular and can probably be expressed with a much simpler mode. I'm still waiting for the team to publish a formal grammar before I rewrite it, since I haven't touched it much since then, but if someone who's familiar with the language wants to write a simple mode for the current language, that'd be very welcome.\n. Could you describe the problem that is occurring a bit more precisely?\n. That makes sense. Merged as 76582ee\n. Though I agree with your premise (it would be nice if you could round-trip through CodeMirror without losing information), I don't think your solution is the right way to go.\nThe reason why this hasn't been much of a problem for people so far is probably that there are very few good reasons for mixing different line ending conventions in a single file. I am not really interested in supporting a system where CodeMirror magically keeps track of each line's ending and restores that.\nInstead, I've implemented a different solution, which is much less likely to cause problems and is fully backwards compatible. Attached patches add a lineSeparator option, which defaults to null to give the current behavior (normalize to \\n). You can set it to a string to have the editor break lines on exactly that string, and leave other characters as part of the line text. That way, your documents won't be damaged, but you also keep the invariant that an editor instance has a single line separator.\nThe intended use would be for those who care about line endings to implement some kind of heuristic that determines the line endings used in a given file, and pass that to the editor in the lineSeparator option.\n. The patch is not going to be reverted. This is how I think being able to preserve mixed line endings should work.\n. If you have \"foo\\nbar\\r\\nbaz\" as your document and your line-ending-determination algorithm decides that it is using \"\\n\" as its main line separator. You create an instance with {doc: \"foo\\nbar\\r\\nbaz\", lineSeparator: \"\\n\"}, and you'll get three visible lines foo, bar\\r, and baz. I.e. the leftover characters that don't match the document's line separator are considered part of the line's content, and show up in the editor.\n. I agree with Vincent that this isn't a good direction to go in. See my comment in #3395\n. You can't depend on the gutter being 1px wide by default. In any case, if the editor wasn't visible, doesn't calling refresh on it after making it visible already take care of this?\n. So are you calling refresh after making the editor visible? If so, can you create a simple HTML page that shows the problem (the line number width not being accurate after refresh)\n. When it's just CSS, I'm also happy to review vim stuff. Looks great. Merged as a84b756\n. The release list is on github -- that html file is part of the repository. I don't really see the value of adding another file just to link to it. What practical problem would it solve?\n. I don't think this problem (having to look at the project page to find the change log) is big enough to warrant a file like that, sorry.\n. Could you link a repository that you think uses github's release feature properly? It looks to me like they just list tags under 'releases' -- I'm not sure what feature you are referring to.\n. Ah, there's an 'add release notes' control if you switch to the 'tags' page from the 'releases' page. I hadn't seen that yet. I'll try to make some time this week to upload notes for all halfway recent releases, and try to automate pushing them out for future releases.\n. Okay, all releases have their notes attached in github's database now\n. I'm not sure why you closed this. I've merged it as 091a0f6 anyway.\n. Thanks. I've pushed a slightly different patch (8bb0736) which avoids the comma trick and uses call instead.\n. I'd prefer a different approach -- allow users to pass an option to the lint addon to disable automatically triggering linting on change, and export (via defineExtension) a method to explicitly trigger linting from user code.\n. It goes into 'capitalize the next letter' mode, which is what mobile keyboards tend to do when at the start of what looks like a sentence. I don't think there is a way for CodeMirror to suppress this, but if you do know of one, tell me.\n. That is indeed odd. I'll see if I can figure out what is happening the next time I have my iPad in my hand.\n. See also this ProseMirror issue for context. There we ended up half-fixing it by letting native edit events go through, and patching up the DOM after the fact. We might also eventually want to do something like that in CodeMirror, but I'm not sure when I'll have time for it. Also, this still won't solve the problem of the keyboard case being stuck when programatically moving the cursor. And the blur/focus hack is too slow to apply it every time it'd be needed.\nIn the end, this is a really stupid bug in Mobile Safari, and because Apple doesn't appear to have an open bug tracker for stuff like this, it's rather hard to figure out whether they are aware of the issue and intend to look into it. If you have an Apple account and some time on your hands, firing more bug reports their way might help: https://developer.apple.com/bug-reporting/ (the precise issue, which can easily be reproduced outside of CodeMirror, is that if you change the DOM selection with JavaScript, as opposed to the user doing it directly, that doesn't cause the keyboard state -- such as default case -- to update). Note that, unless this was fixed in the meantime, Mobile Safari is pretty awful about syncing up the automatic capitalization with programmatic selection updates\u2014it tends to leave that in the state it was at the last user-driven cursor change or user input. So this'll work much better in version 6 than it does now (tapping or typing gives the expected result), but if yours scripts move the cursor somewhere, there might still be flakiness.. The module itself doens't do that. Pass your own DOM-building callback, instead of a DOM node, and build line numbers the way you see fit.\n. Thanks. Merged as d002b03\n. Hi. Thanks for working on this. You seem to be missing some things though (attributes jump out). Might want to go over the whole grammar spec as far as it exists, and make sure no other constructs are missing. variable-3 is a good choice for macros -- most themes give it a distinctive bright color.\nOne thing I was hoping to do when a full grammar is available is to write a detailed enough state machine to distinguish types from values, and highlight them accordingly. But even without that, this is a step up from the old obsolete mode. Could you add attributes and double check the grammar to see if you missed anything else? (And add a comment when you have, so that I can review again.) Thanks!\n. (Be sure to leave a comment when you want me to review this again.)\n. Thank you. Merged as d7dc8c31b99 and followed up with a few tweaks in d56b13a17336\n. It is preferable to pass addon options to the addons themselves, rather than putting them on the editor themselves. The Tern addon already takes an options object, which seems like the ideal place to put this.\n. You can set a different mode option for each editor you create, so yes, it is easy to use different modes on a single page.\n. Why are you typing both brackets first though? That doesn't seem like a sane/common enough case to address specially.\n. Well, that's an interesting editing style, but it is pretty easy to support this. See attached patch.\n. Oops -- this was broken in a recent change to the paste handler. Attached patch fixes it again.\n. Thanks. Merged as ea3277b\n. Setting viewportMargin to infinity with huge documents is simply not supported by CodeMirror. The relative positioning is essential to the way we are displaying line numbers, and thus won't go away.\n. Looks great. Merged as b6f9fd3\n. What do you mean by 'there was a breakpoint set'? Do you have a simple demonstration of the problem?\n. I've merged this as 536bba1 and modified it in 3686816 to:\n- Rename the option to lintOnChange (to avoid double negatives) -- must be false to disable.\n- Make the extension method use its this binding, rather than also expecting the editor to be passed as an argument.\n. You'd first have to define exactly what it is you want to prevent from happening, and then probably register a beforeChange handler that implements this. How to do this, however, is something you'll have to work our yourself.\n. No... there's the manual that explains the API, and you can look at other addons, but no, no one has written down how to do what you are trying to do here.\n. I don't think we should be over-eager adding future spec stuff (since specs tend to change) but for properties that are widely supported (even if they are not standard), I'm okay with adding them. Want to open a pull request?\n. Thank you. Merged as bd62685\n. As I mentioned in the other discussion, I'd want windows to be associated with editors, not global. Also, the tests are failing. So this may be useful to someone, but it's not going into the distribution the way it is.\n. See the compression helper here.\n. You'll usually want to include multiple modules (modes, addon) in your site, so you'll need some kind of build step to reduce the amount of separate script files anyway. Just run UglifyJS locally as part of that build step.\n. That was an HTML page providing a UI for creating a compressed version of the library. It is no longer supported -- you're expected to set up your own build system now. Hah. Obscure. Does attached patch look good?\n. I am not sure if you can really blame this on the closetag addon. The problem is that the opening <ul> isn't reindented, but since the closetag addon did not insert that, I don't think it is responsible for reindenting it.\n. Thanks. Merged as 7523531\n. No.\n. Thanks for doing this boring work! I had plans to do something about all the !important annotations, but hadn't gotten around to it. Very glad you did it. Whitespace inconsistency doesn't bother me much, but since you already went through the work of fixing it, I've merged those patches too.\n. Have you tried setting the option inputStyle: \"contenteditable\"? That should give you much  better results.\n. Okay. But this patch doesn't really look like a viable direction. I'd much rather continue working out problems with the contenteditable input style, which provides the browser with much more information (and thus probably requires less invasive hacks).\n. Don't assign to CodeMirror.defaults. You can override individual properties on that object, but it has to contain the defaults for all defined options, so replacing it with a new object does not work (CodeMirror will continue using the old object)\n. The current match should be scrolled into the viewport. Can you describe what you did that resulted in a match not being visible?\n. I've made some adjustments (attached patches). The scroll issue you are seeing does exists when\n- You use the persistent dialog\n- Your match is on the first line of the editor\nOur current dialog addon doesn't provide a proper way to work around this, but I've pushed a hack that make the dialog transparent when this happens.\n. I have no issue on Debian Chrome/Firefox. Probably your window manager or other external program (IME modules like to use ctrl-space as well) is capturing the key.\nIn any case, this is external to this library, and ctrl-space isn't even a default binding in CodeMirror. Closing this.\n. Thanks. Merged as 6143625 \n. Thanks. Merged as a7d443ec82c and updated in f06c53f (the CSS file intentionally splits user-overridable styles from internal styles, so the fact that a rule was duplicated and that there was an empty rule were not bugs)\n. Thanks! Merged as 7bba3a8c6fbd\n. CodeMirror's history is implemented in a way that only allows strict rollback. You can't undo a change without also undoing everything that happened after it. Thus, what you propose isn't possible with the current history implementation. So I'd suggest you find another solution. I didn't entirely understand your description of the use case, but couldn't you make the change outside of the editor, after getting out the text?\n. > What I am asking for is to give replaceRange another parameter to prevent it from adding to the history,\nI explained why that doesn't work.\nHave you tried simply undoing your changes to cancel them? That will also pop them off the history. (Be sure to call .changeGeneration(true) before making a change to ensure it gets its own history event).\n. Well, I see that you implemented the thing that I assured you was not safe. That's fine, you might never hit a situation where it crashes your editor. I am still not interested in merging it in, though.\n. Thanks. Merged as 3ef42f7 \n. Merged as bc026f1 and updated in 9e375f1\n. Wonderful. Merged as 9f1b3a6\n. Looks like a good idea. Merged as 5d782cb\n. Thanks! Merged as 341a850\n. Attached patch should help somewhat, though, since for performance reasons the editor doesn't highlight huge lines entirely, you might in some situations still see effects (such as when the long line opens a new block).\nTo get rid of this optimization entirely (but risk bad performance with long lines), you can set the maxHighlightLength option to Infinity.\n. That's nice, and I may at one point switch to an automated release-notes generation convention, but opening an issue about it is unasked-for.\n. You did successfully contact me. I am not interested in adopting conventional-changelog at this time.\n. That code is not generated. I am really not interested in adding another clause there and bloating up the file headers even further. You'll have to hack something up, like passing the loadmode addon a wrapped version of require that does the right thing in your setup.\n. Unfortunately, diff_match_patch isn't packaged very well -- it doesn't know that there is such a thing as module loaders, and just assumes that it is okay to dump four variables into global scope.\nI managed to get it working with a small change to merge.js (which tried to access diff_match_patch through an interface object). See this gist for the working requirejs-based code.\n. Doesn't listening to the \"pick\" event solve this? It'll be fired right before the \"close\" event when a completion is chosen.\n. Set a flag when the \"pick\" event happens, and in the \"close\" handler, check for this flag to figure out what kind of close event it is.\n. Yes, pick is guaranteed to be fired before close, and events arrive in the order they are fired in.\n. Keybindings can always be reconfigured, so there's no need for an extra switch.\nAs for the underlying problem, I still don't understand your use case, but if you can provide a minimal demo page that would probably clear it up.\n. Hi. Could you tell me how this improves on the existing CoffeeScript mode? And is your intent to have this become part of the main distribution?\n. I've taken a closer look, but your mode doesn't do any indentation, which seems a regression. Have you considered simply modifying the old mode to fix its shortcomings? I've pushed 89c8c3d, which highlights properties as properties. I noticed that operators like and and is are already highlighted as operators (choose a different theme if you want a different color for them).\n. Closing until further comments.\n. I've activated this room. I don't know much about gitter, but I'll try to drop in now and then.\n. Um, for a bot, you are really bad at submitting pull requests. Let me see if I can pick out the relevant change from this mess.\n. Pushed 37ecdbe instead\n. Thanks. Merged as c890a09 \n. Yes, this is indeed how you'd do that. But since it is only four lines of code, I don't think we need to bundle this \u2014 the API already makes it easy enough to do.\n. This pull request contains 250 commits. I haven't even been able to find the relevant commit in it. Please try again (start from our master branch, and add only your commit to it).\n. The input field takes the raw replacement text. Backslash escapes aren't interpreted, and there's no reason to believe that they would be. I agree that it would be useful to be able to insert newlines, but I don't think doing some ad-hoc backslash interpretation is the answer. A better proposal or a clean pull request would be welcome.\n. I don't think I agree. Why should it only work when replacing a regular expression? You might also want to replace some string with a newline.\n. I think the behavior you are proposing is horrible (inconsistent parsing of input in two different situations) and I am not going to change this.\n. I don't see how you are claiming that this is expected behavior in one case and not in an almost identical one. There is no API to implement this from outside, short of reimplementing the search addon. The patch is not going to be reverted.\n. Thanks. I've merged this as f1ffc95f43a0b2 and fixed it up a little in 644803cd61b008 (style issues, and allowing the user to pass in the configuration using the rules property of the lint option, rather than global).\n. The CSS selectors making the cursor white in dark themes are strictly more specific than the default black cursor style, so I am not sure how they could fail to apply. You'll have to use your browser's def tools to inspect the cursor element (document.querySelector(\".CodeMirror-cursor\")) to figure out what's going on and whether your styles might be interfering in some strange way.\nMake sure you are using css files (for themes and basic codemirror.css) from a single release. Using the current codemirror.css and older theme files might cause this, since the specificity of those rules was recently changed.\n. Try enabling the mark-selection addon\n. I've merged this as bfbb9c716d1b3 and largely rewrote it in eb56e911191.\nThings that were broken:\n- Detecting close tags inside tokens didn't work anymore because you were passing a regexp that started with ^.\n- People could no longer pass non-string mode specs in your object format.\n- The dependency on addon/mode/overlay wasn't declared.\n- The demo html page was still a mess with the text from the htmlmixed demo in it.\n- Attributes other than lang weren't recognized, since you passed the hard-coded string \"lang\" to getAttrValue.\nMy patch changes the format to arrays-of-arrays, removing the need for the huge deepmerge function, and fixes these bugs.\n. Thank you. Merged as 7f51f13\n. You can use coordsChar to find the position at a given set of coordinates\n. Have you looked into using a shadow DOM? I haven't used it seriously, but I believe it allows scoped CSS. https://developer.mozilla.org/en-US/docs/Web/Web_Components/Shadow_DOM\n. Thanks. Merged as 3d18f89\n. That's a very good idea. Merged as 13eadcd\n. Thanks. Merged as b9c5c18 \n. Merged as e79d4ffafb3300 . Though I'm somewhat confused why you went to the effort of adding a test without making sure it actually passed. Fixed that in 5d853959ca8a\n. For one thing, the getMode call didn't actually name the mode correctly.\n. Once per month. 5.7 is coming out early next week.\n. Great!. They are validly encoded UTF-8 characters. Blame your tools or your setup for decoding them incorrectly.\nBut since this happens a lot, our policy is to \\u-escape such characters, which I failed to do in this case. Attached patch fixes this.\n. You can call removeLineClass and pass null as the class.\n. You can't, but you could loop over all lines that might have the class and remove it from them.\n. This looks good. Merged as 94fc3b7\n. We're currently targeting things that are implemented and/or in use, regardless of the spec level. So if you have specific properties that come up in reality that you'd like to add, open a bug or a pull request.\n. Closing as being a question rather than an issue. PRs to add support for specific features would be appreciated.\n. This is simply not supported. You can add vertical padding to .CodeMirror-lines and horizontal to .CodeMirror pre, but I don't think there's a way to get a border around the content. I'm not sure how the simplescroll addon would help here.\n. Not being able to scroll the whitespace sounds like a serious downside. I haven't thought much about this, and I'm wary about recommending anything in general -- because then I'll feel bad if a subsequent release breaks my solution. So I hope you can figure something out, but I'm not going to make it a supported use case.\n. Thanks. Merged as 756ddc5\n. This is exactly the browser's behavior in such a case, which the mode intentionally follows.\n. This does have to do with CodeMirror. Are you pasting using the regular clipboard, or X windows' middle-mouse-button behavior?\n. So jsbeautifier appears to be on codemirror version 3.11, which is two and a half years old. I am not going to debug issues with ancient versions.\n. Uh oh, you've just created an XSS attack vector (interpreting content that was previously raw text as HTML, and making it possible, on sites that allow users to influence the placeholder text somehow, to insert arbitrary HTML into the document).\nSo we can't change the meaning of string data here. In general, the CodeMirror API tends to allow passing in of DOM nodes, not raw HTML, to be passed in. Attached patch implements an alternative solution where placeholder may be a DOM node.\n. Does the attached patch solve the problem?\n. This is a known issue (#1757). We had a Google summer of code student working on this a few years ago, but his work (the direction branch) never made it to production quality and he pretty much stopped responding to email.\nThis is one of those things that are not going to happen unless someone contributes the code or a significant bit of money.\n. Going to close this as a duplicate.\n. Looks very good. Merged as 0cd2432. It'd be great if you could follow up with a PR to clean up the electric indentation test.\n. Is there any hint source that returns objects without list array property? If so, I think we should fix that instead.\n. Thanks! Merged as a2cc9c0a55\n. Sounds like this may be a missing call to refresh after changing the size of the editor's container (maybe there's a CSS animation involved).\n. CommonMark supports both styles interchangeably. I think that would be preferable behavior, and I'd be in favor of making that the default behavior, rather than requiring configuration. If that sounds good to you, could you update the pull request with an implementation?\n. That's a good question. It does conflict with their strikethrough syntax -- https://help.github.com/articles/github-flavored-markdown/#strikethrough\nSo maybe do expose it an option, make it on by default, and have the GFM mode disable it.\n. Thank you. Merged as 5e34e117d44bd7e3\n. With tests. Looks great! Merged as 5cd327f\n. Thanks. Merged as 812d779\n. So, I don't know Haxe, and the Haxe mode (which was contributed) appears to be based on the JavaScript mode, which takes an approach to mode writing that does a more or less full parse. This is nice, because it gives use a lot of information about the code, but it is also very demanding and fragile. I'm going to just go ahead and merge your patches without too much scrutiny, because I can't afford to spend a lot of time debugging and improving this mode. One option would be to create a clike-derived mode for Haxe, which would be a lot easier to maintain, but you'd lose things like solid type and variable-definition highlighting.\nI've merged this as c9fb71c\n. > Not sure what to do about the Travis CI error.\nIt says mode/haxe/haxe.js: Access to global variable state. (405:8), and a casual glance at that line shows that you A) put an unreachable statement directly after a return, and B) are using the state variable, which doesn't exist in that scope.\n. Thanks. Merged as 897586c0ad1bec7, slightly tweaked in a039316.\nNext time you add to a pull request, make sure to also add a comment. I don't get a notification when a new patch is added.\n. Use the addon/search/searchcursor.js addon and do something like this (untested):\njavascript\nfunction replaceAllIn(cm, oldString, newString, start, end) {\n  var cursor = cm.getSearchCursor(oldString, start)\n  while (cursor.findNext() && CodeMirror.cmpPos(cursor.to(), end) <= 0)\n    cursor.replace(newString)\n}\n. I agree this looks good. Merged as 698c8e5\n. This was dropped in 3.0 (a387b8336767aba3), as it was somewhat flaky (it'd also kill pre-existing trailing whitespace -- but only if you moved your cursor through a line) and had very few users.\nYou could re-implement it as an external addon like this:\n``` javascript\nCodeMirror.defineOption(\"autoClearEmptyLines\", false, function(cm, value) {\n  if (value && !cm.state.clearEmptyLines) {\n    cm.state.clearEmptyLines = {prev: cm.getCursor()}\n    cm.on(\"cursorActivity\", maybeClearLines)\n  } else if (!value && cm.state.clearEmptyLines) {\n    cm.off(\"cursorActivity\", maybeClearLines)\n    cm.state.clearEmptyLines = null\n  }\n})\nfunction maybeClearLines(cm) {\n  var cursor = cm.getCursor()\n  var prev = cm.state.clearEmptyLines.prev, prevLine\n  if (cursor.line != prev.line && prev.line <= cm.lastLine() &&\n      (prevLine = cm.getLine(prev.line)) && !/\\S/.test(prevLine))\n    cm.replaceRange(\"\", new CodeMirror.Pos(prev.line, 0),\n                        new CodeMirror.Pos(prev.line, prevLine.length))\n  cm.state.clearEmptyLines.prev = cursor\n}\n``\n. Nope, that's not something CodeMirror does (but there are, for most languages, great JavaScript-based pretty-printing modules available)\n. Thank you! Merged as 1ded3f6\n. There's already an example inbin/source-highlight`. So I've just pointed towards that in the manual.\n. Looks harmless enough. Merged as 45adc4d\n. This is the bug tracker for the main distribution of CodeMirror -- support for branches that aren't in that distribution, or that other people created, isn't something that you're going to find here.\n. Thanks. That is an awfully ugly regexp, but I guess if its based on a specification I can live with that. Merged as 1a56b954e0ab and followed up with 3c41bf145bd26 for cleanness.\n. Just wanted to say that this is still on my radar, but the only OS X device I have around is unusable due to overheating issues (these things seem to be designed to fall apart after a few years), so I'll only be able to debug this after I figure out how to repair it.\n. This is a good idea. Sublime Text does the same thing, so I'm going to assume it is common.\nYour patch mutates data that it shouldn't be mutating though (the ranges and positions you get from CodeMirror should not be changed). So I've added df8afed to fix that.\n. Thanks! Merged as 0c9a2ff\n. List them on our wiki\n. Thanks. Merged as 658ef7809e3 and slightly changed in ece5c232a43\n. Hi Wes. This is too specific for including in the distribution. You'll have to keep it in your local code, or put it somewhere as an external module.\n. Yes, it is, and also easier to implement locally. The list-continuing addon is also borderline too specific.\n. Thanks! I've merged this as d47c918fd7452 and moved things around a little in 9016ae38f5e208158 to make the modes conform to the expectation that mode X is defined in mode/X/X.js, so that it can be dynamically loaded. That means you can no longer load the xu and msgenny modes by simply specifying that string, but have to use their MIME strings or an object like {name: \"mscgen\", language: \"msgenny\"}.\n. This would require a rather invasive change (to the already fragile clipboard-handling code), and your use case doesn't sound very compelling (people tend to want the text they selected on their clipboard, without extra junk), so I'm going to say no.\n. Attached patch allows you to set a supportsSelection property on your hint function (not on options) to indicate that it can safely be called when there is a selection. It also reorganizes the way the automatic hinter works to allow this property (as well as async) to work even for automatic hinting.\n. You are right, I broke some things. Try again with attached patch.\n. Can you reproduce this in any of the demos on the website? Are you resizing the editor without calling its refresh method, by any chance?\n(In any case, the Lua mode is probably not related to this, since there is very little a mode can do to break scrolling.)\n. I don't know. Since I can't reproduce this on, for example, the Lua demo, I'll need an example HTML file (simplified as much as possible) to be able to debug the issue.\n. Just the options don't help. I need a full, self-contained demo page.\n. Thanks. Merged as ed6651b\n. The best way to handle this is to register a mousedown handler on editor.getWrapperElement(), and in there, use the coordsChar method to figure out what text was clicked, and then the findMarksAt method to figure out whether there's a marker you're interested at at that position.\n. Sounds like another IME bug (Android keyboards get a lot of control over the events browsers fire during typing, and tend to do all kinds of weird stuff). I will try to make some time soon to overhaul IME handling to be less reliant on those events, since the information they provide is hard to interpret properly.\n. There are dialogs that use multiple text inputs or put a bunch of text and buttons next to them, so I don't think pinning them to 80% is a good idea. You can override this in your local style sheet if it is helpful for your application.\n. Is this an actual problem for you, or just a non-conformance you noticed?\n. I think you'll just have to live with not being able to turn off highlighting for such blocks, yes.\n. Yes, that was recently completely broken. Fixed in 72ca9ff \n. The markdown doesn't see the start of the line, because that part of the stream is multiplexed to the stex mode. I've pushed a patch that makes the markdown mode more robust in this case, but in general, multiplexing has its dangers -- it'll hide part of the stream from the multiplexed modes, which some modes don't handle well.\n. Our JavaScript mode doesn't support JSX yet, so having it get confused by JSX syntax is expected. So this is a duplicate of #3122\n. Can you reproduce this in http://codemirror.net/mode/javascript/ ? If so, can you paste (not screenshot) the code that triggers it?\n. Can you provide an HTML file that demonstrates the problem? Does the demo also have this issue for you?\n. Yeah, and while you did remember to complain that it's not clear what the demo is supposed to be doing (though it does say so on the linked page -- \"automatically resize to fit its content\"), you didn't actually remember to mention what the problem you're running into is. Your jsfiddle shows a single editor, which appears to work, except that you put it into a fixed-height container, which does look rather wonky.\n. Thank you. Merged as 3d1a056\n. Thanks. Merged as 08df099 \n. I'm going to move CodeMirror to semicolon-less style somewhere in the future. I suggest you adjust your linter to not complain about semicolons (or, if it can't do that, to get a new linter).\n. Does patch 9f149ba also solve this for you? It seems like a simpler solution.\n. Superseded by 9f149ba3e97a\n. Thanks for cleaning this up. Merged as ed2e611 .\n@Leonya CC-ing you since you wrote (/copied) the original mode\n. @mikethedj4 That branch has been merged into master a long time ago.\n. Looks good. Merged as acb7e76\n. Does flexbox actually specify that height: 100% will end up referring to something else than the height of the wrapping position: relative container, or is this just a browser bug that you're running into?\n. This appears to be the same as #4142. I assume you are doing something like what the demo is (was) doing, reacting to every changes with a new call to wrapParagraphsInRange. It is cheaper to suppress this effect for changes generated by the hardwrap addon (see d708748a9c3) but I've also updated the addon (edfe2106348c5c) to not emit any changes when there's nothing to change (it was creating an empty change, endlessly re-triggering the event handler).\n. I can't reproduce that. Could you give me a simple HTML file that triggers the problem?\n. Thanks, now I can reproduce. Attached patch fixes this.\n. There's a CodeMirror.on utility function for this that should have been used instead. Attached patch fixes this.\n. Would you also be okay with the following alternative solution?\n- Detect binary files, and simply refuse to insert them\n- Add an option to set a max file size, and ignore files bigger than this\n. PDFs would turn into a lot of postscript soup (they are textual, but not necessarily readable). Word Docs are binary data, and unless we implement a binary format parser for them in JavaScript, we can't get at any sane textual representation of them.\n. Could it be that you never even tested this? Because this, inside of that function, does not refer to a CodeMirror instance, and the code simply errored out as it is. I've fixed it up in 031afde.\nI've also added a patch that will prevent users from dragging binary files into the editor.\n. (I forgot to mention I renamed the option to allowDropFileTypes for naming consistency with similar options)\n. I'm not really happy with the combinatory explosion of styling approaches we're taking on (classes for line, background, text, and gutter, maybe now also css strings for all of them, line and backgrond styling from mode tokens, but for some reason not gutter or css string styling), but I guess this is a useful feature. I'd eventually like to clean all that up into a more coherent API, but I guess that would be backwards-incompatible.\nDo you want to work on a patch for this? Did you have a specific API in mind to handle removing of such styles? How would they be combined when multiple styles are added to a single line?\n. That's true. contentEditable doesn't support cursor styling, so we can't hide the regular cursor, but maybe it would be a good idea to overlay the block cursor anyway. I'll look into it.\n. We could add logic for drawing the cursor as a one-character selection overlay, but that still wouldn't hide the regular native cursor, and having two cursor blink (out of sync) seems like it would be worse than not having the cursor be wide.. If you're only targeting Webkit and Firefox, it seems you can set caret-color: transparent via CSS to hide the cursor. Does that suffice for you, or do you need IE/Edge compatibility?. I'm not going to be able to get to that this week, but will take a look early next week (I suspect it won't be complicated).. Please take a look at patch ad6635a5. Thanks. Merged as 80ba426\n. Thanks. Merged as 4f7a6fb\n. You are right, it appears to have been removed in the inputStyle overhaul, because I'm not interacting with the context menu in the contentEditable input style. But I could restore it and add a handler just for this kind of hooks in the contentEditable backend. What were you using it for?\n. Attached patch should bring back support for this event.\n. See patch 8f2149c2d586184\n. Thanks. Merged as a24a053 \n. Thanks. I forgot to delete that after disabling it. Merged as 825ca00\n. Thanks, looks great. Merged as 4255f78\n. Not that I know of.\n. Thanks. Merged as 770a771\nWhen you change a pull request branch, it is a good idea to follow up with a comment, because I don't get email otherwise, and won't notice your update until the next time I look over the list of open pull requests (which might be a while).\n. I've looked into this, but didn't find a good solution. The touch events' correspondence with the scrolling is platform-specific and hard to predict. Mobile browsers fire scroll events only in ~350ms intervals, since they do their scrolling on hardware, and don't actually show the up-to-date DOM during scrolling (but rather, a texture that they rendered at the start of such a ~350ms slice).\nI tried to predict scrolling from the scroll events, but typically it ramps up very fast, you'll get an event for a handful of pixels scrolled as the touch gesture is done, and then it accelerates to >1000px already for the next event, and even more (>2000) for the one after that. Rendering thousands of pixels ahead on every scroll event isn't realistic -- it'd cause awful lag.\nYou can try setting your viewportMargin to something bigger than the default (setting it to 500 mostly, but not entirely, solved the problem for me), but that'll cause a bigger DOM to be rendered and startup, as well as redraws, to be slower.\n. Since browsers have decided to prioritize scroll performance over the ability of scripts to interact with scrolling, my impression is that this is a losing battle, and the CodeMirror 6 design just gives up on this\u2014it'll try to quickly render the content of the viewport when it's notified of the scrolling, but does away with all the awful hacks that try to predict scrolling in advance. So you'll see a flash of empty content during quick scrolling, but the library can be simpler and avoids eating battery by rendering stuff that may not bee needed.. Nope, there isn't. The way you describe is probably the cleanest way to do this now.\n. Looks useful. Merged.\n. The line number gutter's width is adapted to make sure line numbers fit. There's an extra pixel added to work around issues where rounding causes offsetWidth to be less than the actual element width.\n. How does this fix anything? ternjs.net doesn't support HTTPS, so it'll just break things in a different way.\n. Yes, I'll put it on my list (though messing around with SSL certs isn't my favorite hobby)\n. Thanks, but I am not really willing to incur this extra complexity for this feature. Also, your implementation, which uses simple string scanning to figure out the property, will break when faced with comments or newlines.\nI suggest you package this (including the list of properties) up as a custom replacement or extension to the css hinter, and distribute it yourself.\n. Thanks. Merged as d8237c8f1d3 and 84d5f64006\n. Could it be that you forgot to include one or more of the modes that the PHP mode depends on? (XML, JavaScript, CSS, HTMLMixed, and clike)\n. In about two weeks (I release around the 20th of each month)\n. What exactly do you mean by 'merged chunks'?\n. These merged chunks are visually there, but there are not really a concept in the merge addon's code. You could write your own logic to overlay the left and right chunks on top of each other, I guess.\n. Thanks. Merged as b629242\n. Thanks for noticing that! Merged as 61e9389\n. Thanks. Merged as d16f4d8\n. You can start with the example (see the page source) here. But your question is too general for us to say anything useful to it, and the bug tracker is not the correct place for support questions. If you run into specific problems, ask questions on the discussion forum.\n. Looks like a good solution. Thanks for figuring out the problem. Merged as 5fafcf8\n. true and false are actually defined as atoms in the Scala mode (and in most other clike modes). false accidentally also appears as a keyword. Would it be okay to remove false from keywords and just have both of them be atoms?\n. Thanks. Merged as 872bb73\n. I assume you don't want every line starting with a '(' or '{' to be deindented. The auto-indentation will need some way to figure out when to indent normally and when to dedent. Or, if you don't like auto-indentation (which you seem to repeatedly refer to as a 'bug'), just turn it off.\n. I can see the issue. I am just not sure what behavior to encode in the mode to fix it. Ace's rules seem very simplistic, and will also de-indent this code:\njavascript\nfoo(bar,\n{baz: 10})\nI'd say that's not an improvement.\n. >  if all the brackets were closed on the second line,\nYou'll usually want to make a decision about indentation before the line was entirely typed.\nI can add a configuration parameter that enables this behavior for all braces and parens that start a line, if you want to. But if I were you I'd just start doing what the rest of the JavaScript community is doing instead.\n. Attached patch adds an allmanIndentation option to the clike mode. Note that to enable it you have to do gymnastics like mode: Object.create(CodeMirror.mimeModes[\"text/x-c\"], {allmanStyle: {value: true}}) (or equivalent pre-ES5 junk) -- get the configuration object for a MIME type, and create a new object that has its properties but also the allmanStyle property set.\n. Merged (with trailing whitespace fix) as de7b15f\n. Merged as 8fbf049\n. I'd like the filenames to match the theme names whenever possible. Would you prefer to add the -dark prefix to the filenames, or to remove it from the css classes?\n. Your commit only modifies hopscotch.css. Should the same be done for the other files?\n. All right. Merged as bc008c070f\n. Merged as 8a012c0ae93654, with the change of binding cm to this in the extension method, so that it actually works.\n. Looks like an improvement. Merged as 8fd466f\n. Thanks! Merged as 0ca9fc8\n. In IE version 11.0.9600, using the current CodeMirror version, I do get all the clipboard-related option in my context menu (and they work).\nCan you see the problem on the demo pages at http://codemirror.net ?\n. Simplify your page step by step and test along the way to figure out which factor causes this, I guess.\n. Add position: relative to the wrapper div, and make sure your stylesheet gets applied after the standard CodeMirror css (which sets a default height of 200px), which isn't happening in the codepen.\n. The problem with this is that it's going to require everybody who installs CodeMirror to download this library, even though 99% of them don't need it. I don't think that's acceptable. CodeMirror 6 is going to be more modular, and big addons like this will become their own NPM modules. Until then (and it might take a while for me to get around to working on this), I'm afraid you're just going to have to live with little inconveniences like having to manually specify sub-dependencies in your own project file.\n. I've pushed a patch that removes the require call for diff_match_patch. I am really not interested in listing it as a dependency. There's some other modules (such as the linters) that depend on external modules, and I do not want to require people to download all of these every time they install CodeMirror (that counts as a cost, even if you don't experience it as such).\nSo again, this isn't a permanent state of affairs -- the merge addon will become its own repository/module eventually, and will also probably move to another diffing implementation because diff_match_patch isn't so great. But for now, you'll have to work with it.\n. There is no work on it yet. Basically, I want to move the core library into a bunch of ES6 modules, and split a lot of stuff out of the repository into smaller npm modules. But I want to do it in one swoop, when releasing version 6, so I'm not sure it'd make much sense to start on it now -- we'd have to keep the code in the main repo as well until the next major version, and duplicating code rarely ends well.\n. Nice project. Did you see simple modes, which has a somewhat similar goal (though it doesn't do inheritance). We have this wiki page for external links, which you can edit directly.\n. Putting a keymap under the map property of another keymap won't do anything. (Your code won't even compile as ES5, but I guess you're using Babel or something similar.)\nMove all of your bindings into map, and then use it directly as the extraKeys option.\n. Woops how shoddy. I've pushed an alternative patch that solves this by checking out whether the property exists in the object itself, rather than checking for an array. That seems more idiomatic and robust.\n. Thanks. Merged as 4096f2d\n. I can not reproduce this problem in the merge view demo. Could you set up an HTML page that makes it easy to get the problem to occur (and include instructions on what to do to make it happen)?\n. You could put it on gist.github.com and link to it.\n. Thanks. That helped. Attached patch seems to fix this.\n. Attached patch does this, but by reading the type option from the options object rather than adding an argument.\n. Thanks. Looks great. Merged as caf1323d81cf\n. This is already how most CodeMirror template language modes work. For example the handlebars mode -- scroll down in the example to see HTML highlighting of the content.\nAs for a specific Mustache mode (if the syntactic differences with Handlebars annoy you), I don't take feature requests for modes -- you can write it yourself (probably by making the Handlebars mode configurable) or pay me to do so.\n. This appears to be due to the browser not loading/initializing the bold version of the font until it absolutely has to, and then doing so asynchronous, so that when CodeMirror measures the size of the parentheses, it is getting measurements for some stand-in font, which it uses to calculate the cursor position. And then,  a few moments later, the browser drops in the actual font (apparently before it even draws) which has different dimensions.\nA workaround would be to include a bit of hidden bold roboto mono text somewhere in the page, to force the font to be initialized before CodeMirror tries to use it. I'm afraid that's all I can suggest -- I am not aware of any events that, if I don't know in advance what font is going to be used, will tell me that the font of an element was loaded.\n. So this is how I understand the instructions:\n- Triple-click any line\n- Press ctrl-c to copy (clipboard now contains that line + the newline at its end)\n- Click to get a single cursor again\n- Ctrl-click to get another cursor (two single cursors now)\n- Press ctrl-v to paste\nWhat happens for me is that the copied line gets pasted into both cursor positions, which seems to match the expected behavior. What am I doing differently?\n. Ooh, nice. I actually tested in Chrome 45, and there it works fine.\n. Modifying javascript.js and copying code from xml.js isn't the right approach here. Rather, you'd want a third mode that wraps the two existing modes, so that we don't entangle these concepts and make the individual modes more complex.\n. Good call. Merged as 4df95b1\n. I've merged your test as 71ac921c4385 and provided my own implementation in 457468315e817. Let me know whether it works for you.\n. But then, shouldn't we also include all other SVG tags (<defs>, <ellipse>, etc)?\n. The CSS mode actually gets by fine without defining a set of tags, and HTML5 is 'open-ended' anyway, in that you can use your own tags, so I think what we should be doing is fixing the stylus mode to no longer rely on this list.\n. Thank you. Merged as c727404 \n. Merged as c491ec2. Try to heed the test runner's warnings next time.\n. Are Mustache and Handlebars really different enough to warrant two separate modes? Couldn't we do something like we do with the clike and css modes, where different similar languages are parsed by passing different configuration parameters to a single mode implementation?\n. I think using the multiplexing addon for wrapping the underlying language is fine. Both the Django and Handlebars modes already allow that. Your mode simply styles everything between {{ and }} as strong. The other modes actually understand things like comments, strings, and keywords inside of the template elements, which seems useful.\nMaybe take the Handlebars mode, make it configurable, and add an easy way to wrap it around another mode, as in your backdrop option?\n. Thanks! Merged as d05dc6e\n. Nice. But nope, that's too obscure for me to want to maintain it. Put it on github and link it from here, maybe.\n. We already are parsing fat arrow expressions as functions (see, for example, the way the variables declared as arguments are highlighted differently). What else were you hoping for?\n. Try http://codemirror.net/mode/javascript/ and see if it behaves better than Brackets.\n. I know that, yes.\n. It's styled as an operator, intentionally, because it is.\n. There is no 'correct' mapping from the grammar to highlighting. CodeMirror is highlighting this token as an operator and I see no reason to change it (keyword highlighting is used for actual keywords, and wouldn't make more sense than operator).\n. Works for me too. Feel free to add more information if you find out under what circumstances it doesn't.\n. I tested Firefox 40 and 41 on Linux, but neither show the problem (the downloaded file is a compressed CodeMirror script). Do you have any strange proxy or caching setup?\n. Thanks for noticing that. It was a holdover from before the clike mode did type highlighting. Fixed by attached patch.\n. Thanks! Merged as de1f27d\n. If you have an empty editor, or you have line wrapping enabled, you can get cm.display.lineDiv.querySelector(\"pre\").clientWidth and divide that by cm.defaultCharWidth(). If there might a horizontal scrollbar, this won't work, as the lineDiv will be wider than the display area, and there's no element that actually has the right width (accounting for gutter width and horizontal padding).\n. Are you, by any chance, using a webfont for the editor's content?\n. That generally doesn't matter, font loading will still be async, meaning that if you didn't somehow wait for the fonts to load before initializing CodeMirror, it will initialize with a fallback font and thus not get the right measurements.\n. Good idea. Merged as 21f1d0a\n. What you are doing there will, by design, replace the already existing hint for sparql. Only a single hint can be directly associated with a given string. If you want to combine multiple hint sources, you'll have to write a wrapper and register that as helper.\n. Which platform is this on? On Firefox and Chrome linux, the minimum height of the native scrollbar handle is rather big, so the handle stops having much to do with the viewport height at a relatively low line count. (In your example, I would say it's about the size of five viewports, in relation to the total scrollbar height). Given the skew from the scrollbar button sizes, the markings appear pretty much where I'd expect them when I scroll the matches into view.\nHave you tried enabling the non-native scrollbar (scroll/simplescrollbars addon), and seeing if that helps? (Those don't have scrollbar buttons, and should thus show less skew).\n. Thanks! Merged as a155d55\n. Nope, still not really what I mean. So searching around the web, I have several websites telling me that Handlebars is a superset of Mustache syntax. So why, precisely, aren't you simply using the existing Handlebars mode and leaving it at that?\n. Patch 88a0257 does this. Give it a try.\n. Closed via #3626\n. I guess this is minor enough to include even before widespread browser support shows up. Merged as 292a12a\n. Thanks! Merged as fec63b9\n. Saving is outside of the scope of CodeMirror (it doesn't have a server component or save to localstorage), but you can use your own timeouts along with markClean and isClean to implement this.\n. The clike mode does not, in this situation, indent to the open paren. It indents one indentunit, which is configurable.\n(It does indent to the paren if there's other elements on the same line as the paren, as in\ndo_foo(bar,\n       baz)\nbut that doesn't seem to be what you are talking about)\n. Attached patch seems to address this. Let me know if you run into more issues.\n. This is broken (see test runner results). But even if it weren't, it is not a good idea. If you press enter inside the editor, the lines below the cursor will shift down, without having their DOM redrawn, and thus the classes will be out of sync. I think you should stick to using CSS tricks.\n. Install node and npm, and then do npm install inside of your CodeMirror checkout to install the dependencies, and npm test to run the tests.\n. The tests still aren't passing. See my comment on #3632\n. Using CodeMirror in a window other than the one in which it was loaded isn't supported -- I'm highly surprised it worked at all (it'll fail completely on older versions of Firefox). Until I get around to having a different window per editor (stored as option, used everywhere instead of the global window), that's just the way things are. I don't think your patch is a full solution, and it definitely is a performance liability.\n. How about a pure-css solution instead, where you style .CodeMirror-hints:hover .CodeMirror-hint to not have a background and style .CodeMirror-hint:hover (with some other stuff to give it precedence) as having a highlighting background? This solution would cause things like accidentally sweeping the mouse over the widget to change the selection. That's not a huge deal, since people don't tend to move their mouse while they are selecting something with the keyboard, but it seems that the CSS approach is more lightweight and less invasive.\n. Yeah, that's what the first part of my response addressed -- you can disable the normal highlighting when the mouse is hovering over the widget using just CSS. But on closer inspection, that is not ideal. If the user tries to use the arrows while the mouse is still on the widget they wouldn't be able to see their selection.\nI tried out your patch, but I think it makes things more confusing. We're expecting a double click to select a completion, and controls that show a hover behavior like this seem to suggest that a single click is enough.\nSo I merged this as 5a6f158eedf and followed up with patch 1de8132, which only enables this behavior when completeOnSingleClick is on, but also makes that the default.\n. The easiest way is to do it with CSS. Something like .cm-strikethrough { text-decoration: none } (declared after the import of codemirror.css)\n. Not good, unless you do it yourself. See the mode wish list\n. This isn't something CodeMirror does. You'll have to look at other factors (probably this is the default content of the Summernote editor)\n. Thanks! Merged as 7530191\n. Merged as e477745\n. Thanks. Merged as a1e780b\n. If you just want to listen to events, don't use replacedWith. Rather, register event handlers on the whole editor (.getWrapperElement()) and look at the target or the coordinates of the events to see if they match your ranges.\n. Looks good. Merged as 2a84b59\n. If you use this token-splitting approach, your regexp groups have to cover the whole token. You have \\s that's not in a group, which is causing this. Move the closing paren before the \\s after it and you should be fine.\n. Thanks. Merged as cedae18\n. Merged as 5bf7669. We're not really using JSDoc, but I agree that if there are going to be comments looking like JSDoc, we might as well make them properly formed.\n. Spread in object literals isn't something that's part of ES6, which is why the JavaScript mode wasn't aware of it. Attached patch fixes this.\n. Yes, it should have been doing that, and attached patch fixes this.\n. I'm getting contenteditable as default for the inputStyle option on the android browser. Could you tell me the userAgent string your stock android browser produces?\n. That one's recognized as a mobile browser by CodeMirror, so barring some really weird thing happening, you should get \"contenteditable\" as default input style.\n. @burdiuz Are you seeing the issue in Chrome or in the 'Android Browser'? As far as I know 'Android Browser' has not been on life support since 2013, and Google is trying to get people to switch to Chrome, so I'm not really seeing the stock browser as an important target anymore.. Mobile platforms tend to input words using composition events. Highlighting tends to involve redrawing, and redrawing during a composition will reset that composition, which would be bad, so CodeMirror has to leave the input field alone until the composition ends (in this case, when the space was typed).\nAs such, I don't think this is something we can really help.\n. It currently does not fire change events, but possibly will in the future (I'm planning to overhaul composition handling when I find time), so I don't want to set down any specific behavior yet.\n. > Can you please add a switch to ignore composition concerns,\nNope. Or at least, I don't know how to disable this behavior in mobile browsers. If you do, let me know.\n(Autocompletion is indeed the main reason I'm considering applying composition changes immediately, so that a meaningful completion list could be shown.)\n. I don't think that will do what we'd want it to do \u2014 it'd become impossible for, for example, Chinese users to type into the editor.\n. Since the surrounding div has pointer-events: none, I'm not sure how such a handler would ever be activated. Also, why add handlers to each individual element, rather than just registering a single handler (outside of the plugin) that notices when the event target is one of these annotations?\n. > Would just setting elt.annotation = ann; be acceptable?\nThat would be a bad idea -- adding JS properties to DOM nodes makes them a bunch more expensive for the browser to represent, and since this is a kind of node that'll be created a lot, it seems wasteful to do this. Would adding id properties to your annotation objects, and having the addon check for those and set an annotation-id attribute on the node, work for you?\n. Great. Merged as 6eef0e0\n. This may not be consistent in terms of symmetry between these cases, but it does seem to be consistent in terms of actual behavior. Since you're setting inclusiveLeft, the position at the start of each line is inside of a collapsed range, and thus not a valid cursor position. This means that, when moving the cursor, selections that land on such a position have to be corrected. To avoid the cursor getting stuck, this correction is biased to keep moving it in the direction of the cursor motion. In this case, that means it'll be moved somewhere before the range, which takes it to the previous line.\nWhy are you including your sentinels in the actual text at all? Wouldn't it make more sense to keep them out of the document, and track them in your own data structure?\n. Could you say more about these sentinels? Why aren't they implicit in the fact that the line starts there?\n. If you have a line ABCD and you wrap BC in a collapsed range then...\n- If inclusiveLeft and inclusiveRight are both on, the collapsed part includes both cursor position 2 and 4 (and obviously 3), so there is no valid cursor position left between A and D.\n- In both are false, the collapsed part's sides are both valid cursor positions, so you have to press the left/right arrow twice to move across the position between A and D. This is what I guess you are trying to avoid with your use of inclusiveLeft/Right here.\n- If only inclusiveLeft is on, then the range covers cursor position 2, but not 4, so if you put the cursor between A and D its line offset is 4.\n- Similarly, if only inclusiveRight is on, the only valid cursor position between A and D has offset 2.\nDoes that help?\n. Looking through the (terribly dense) code for this, I realized that it was actually workable to change the behavior so that, when coming from one side into an atomic range, if there is a valid position that is at the side that we are coming from, but is not equal to our old position, we choose that. I've implemented that in attached patch. This should address your issue, I believe.\n. Hm. That is, again, the correct outcome of the algorithm, but indeed surprising. So I've changed the algorithm again, and now it only uses the 'near' side of an atomic marker when it is on the same line as the origin goal pos. That's somewhat arbitrary, but fixes this specific case.\n. Thanks. Merged as 446d89d\n. The problem wasn't directly related to the simple mode addon, but that addon did invite writing string matching as a single regexp, which then wouldn't match if the string wasn't closed yet. I've updated the Rust, Handlebars, and NSIS modes to also recognize unclosed strings, which should address this.\n. It does, but in a different change event, fired separately.\n. CodeMirror handles doubleclicks itself, so it would be possible to improve behavior there. There's already the possibility for modes to change the characters that count as word characters using wordChars helper (see for example the JavaScript mode), but there's no mechanism yet for doing this kind of contextual group matching. We could allow an additional \"findWordAt\" helper to be associated with a mode, which may either return false to pass to the default behavior, or return a range pointing at the word around the given position. Does that sound like it'd address your problem? Would you be able to submit a patch yourself? (Read the findWordAt method in codemirror.js for inspiration.)\n. I don't think it is usually the case that these more complicated word concepts correspond directly to tokens in the mode. It is for XML entities, but not, for example, for tags.\nYou don't need much parsing logic to go from a line string and a position to a start/end index in cases like this, I think.\n. This seems to sort of work for the textarea inputStyle, but when using contenteditable it creates a mess of latin and Japanese characters when I try to use it with Japanese IME.\nAlso, in general, I'm rather hesistant to include such an accessibility-hostile feature in the core editor. Have you tried adding your own event handlers to somehow force composition to end as soon as it starts? That sounds like it would also be possible, and doesn't require changing the library.\n. The rewrite will, if it works out the way I planned it, have the editor fire change events during composition.\nIn my test with your option, there we no occasional problems with IME, it was just completely broken -- inserting both the composed character and the latin variants next to each other. The code is written with the expectation that compose events are handled, and just disabling those handlers doesn't seem like it will do the right thing.\n. Well, the thing is, that other solution isn't something that is going to happen soon, since I have much other things to do and this isn't very high-priority. So waiting for it is likely to end with frustration.\n. The plan is to just disable line re-rendering for the line that is being composed (since the entered characters will already show up), and force a composition end if something else (say, a script) tries to modify that line. In addition, we have to read the actual characters that are in the composition from the DOM, since the events often contain unhelpful or even plain bogus data, and immediately update the document on each compositionupdate. I expect it's going to a bit hairy to implement, but if you want to take a stab at it, that'd be very helpful.\n. So none of these (including the old TypeScript keywords) seem to be implemented in the parser. This will confuse the highlighting, since in many cases (local variables, template strings, regexps) that depends on the parser actually understanding the current context of the token.\nHave you tried, instead of doing things like kw(\"implements\"), which isn't something the parser is going to know what to do with, to actually use one of the existing syntactic roles (in this case C) that is close to how the keywords work?\n. Guess not. Merged as 026ad081b16c, followed up by 7cde7a70940e8\n. Nope, that was just something I missed when I added ES6 support. Fixed by attached patch.\n. Are you pressing the key labeled Z or the one that Dvorak maps to Z? I'm guessing the former, since that seems to be how keydown event keycodes work.\nThe mapping from key events to bindings is relatively straightforward. Have you checked whether a sensible event is generated in this case? What does CodeMirror.keyName return when called on the event?\n. Yes, but it suggests that Chrome is not firing an event at all for the Z press in Shift-Cmd-Z, which means CodeMirror also can't handle any event. (I expect you'll see the same if you don't focus or even load CodeMirror).\nDoes a key event get fired when you disable Dvorak layout and then press Shift-Cmd-Z? What about Shift-Cmd-slash?\n. This does indeed sound like a Chrome bug (or even an OS X bug -- did you test another browser?). So reporting it elsewhere sounds like a good idea. As for CodeMirror -- I'm closing this, since it sounds like  there really is no way to fix this on my side.\n. Oops. Thanks for catching that. Merged as f14b2f8\n. CodeMirror does not change the content you give it, and by default does not react to the spacebar by inserting a tab, so I think you'll have to look at other components of your system (or your own CodeMirror-related code).\nIf you can isolate this in a page with only CodeMirror in it, feel free to reopen or add a comment.\n. Thanks. Next time, try doing at least a basic sanity test before submitting a PR. Merged as c3b0252\n. What is the reasoning behind this solution? And why not always use collapse when the new selection is empty?\n. Superseded by #3673\n. Thanks, that clarifies the reasoning. Merged as 4bdf644. Mobile Firefox support is also still flaky on a number of other points, so the lack of support for that does not bother me too much.\n. I consider coloring local variables specially a feature, but if you don't like it, I guess you can either change your theme to make variable-2 the same a variable, or submit a pull request to support a new option in the JavaScript mode.\n. cm.getInputField().addEventListener(\"paste\", function() {...}) or equivalent should work, but that will only fire after CodeMirror's own paste handling has happened. There is currently no way to override the built-in paste handling, because that is composed of several hacks and exposing an interface to override them all in a consistent way would be tricky.\n. Thanks! Merged as ca6166e\n. I'd like to get to the bottom of this, but without a test case that reproduces the problem, I really don't know where to look. I double-checked that if the editor starts off invisible, it still does the right thing. You seem to somehow end up with a situation where your editor does have dimensions, but your scrollbar width still comes out as zero. I couldn't find a way to produce such a situation.\n. The way setValue could cause sWidth to become zero is still somewhat mysterious. Can you set up a minimal HTML page that triggers this?\n. I can't reproduce this on Linux. Will try on OS X later.\n. It does indeed happen on OS X where, contrary to other platforms, if you preventDefault a keypress event, no repeat events are fired for that key as it is being held down. We do need to call preventDefault, since we don't want pressing J to type a j character.\n@mightguava Would it be problematic to have cmKeyToVimKey convert events like J (keydown) to j and Shift-J to J to work around this issue?\n. This is a Chrome bug. See also #3231. If you want to spend energy on creating a minimal (without CodeMirror) reproducing page and reporting it to the Chrome people, that'd be awesome (the bug is that height: 100% doesn't use the parent's height, even if that is position: relative, when that parent is in a flex container).\n. Closing since there doesn't seem to be a known workaround that CodeMirror could apply (if you find one, do comment).\n. Thanks. Merged as 170bf9371c2ce\n. Looks good to me. I've merged it as f1519ad5057 , and cleaned it up a little in 291b06eb8. The only externally visible change I made is that I renamed the file to jump-to-line.js to conform to the way other addons files are named.\n. I do releases around the 20th of each month, so in two weeks 5.10 will be coming out.\n. > zero-based character offsets\nFor what it's worth, Emacs uses zero-based column offsets as well, which I feel makes sense (before the first character is position zero, after the first character position 1), and which has actually never caused problems with copy-pasted positions from other tools for me -- gcc, babel, and everything else I routinely use spits out zero-based columns.\nSince zero-based is what CodeMirror uses, I don't think it is a good idea to make this addon so something different.\n\nare you intentionally migrating to no-semicolon rule?\n\nYes. I don't think it makes sense to update existing code yet, though there'll be a big move to ES6 modules and ES6 code in the future, at which point I'll remove all semicolons and start enforcing semicolon-free style.\nThanks for your PR!\n. Thanks. Merged as 25815ce\n. Thanks! Merged as c0e878a...fb113ab\n. Makes sense. Merged as 382f51d\n. Thanks! I've pushed a slightly revised patch 764022a which doesn't assume that there is no whitespace between the { and the /.\n. This is not the only binding in sublime.js that doesn't have a name, and there is already a command toggleComment, defined in addon/comment/comment.js, which does something very similar to this one. Thus, I don't think adding another command with a very similar name is a good idea.\n. Fair enough. I wasn't awake enough last night to read the code it seems. Attached patch names the command toggleCommentIndented.\n. Probably another case of useless data being provided in composition events. Somewhere next year, I'll be taking time (made possible Mozilla's grant) to redo composition handling from the ground up.\n. Spamming me with single-emoji replies does not help. If fact, it only annoys. So cut it out. I said that this is planned, and if you're not a paying customer you are not entitled to pestering me about it.\n. I'm going to be spending time on some IME-related CodeMirror work next month. If you want to pay to prioritize this aspect, get in touch through email\n. Nope. Many uses of the \"change\" event rely on getting every single change (so that they can keep a consistent view on the document) so this would not be a good idea.\n. I don't implement modes on request, but I've added Ada to the mode wishlist\n. What?\n. I see. That doesn't sound like it would be in scope for this repository, though.\n. Your patches are unavailable for some reason (github won't show them). I am not sure if a content-based solution would be able to support our lineNumberFormatter option.\n. It seems to be bugging out for the whole repository and forks right now. I can still pull stuff over the git protocol, I'll have a look in that way.\n. Going through an attribute seems like it could work. But there's still the issue of this being entirely unsupported by some of the older browsers that we support.\n. Sure. Checking for someElement.style.content != null might cover the feature check. Also please do some benchmarks (for example creating / modifying a test page full of nodes filled with content vs plain text nodes) to see if there's a performance impact.\n. You're right, IE has been supporting this way longer than I thought. If you have an IE8 laying around, make sure to test your solution there.\n. I think this is too invasive. The plan is to eventually, in a breaking version, move all line gutter content to a separate container so that they don't muddle up the code's DOM.. > I wonder if just using CSS user-select: none could also address this...\nUnfortunately, no. That'll hide the selection markers, but still copy the text on at least some browsers.. @mightyguava @heppe Anybody who actually knows vim want to review this?\n. Thanks for the review! And for the patch! Merged as ab78fe0\n. Could it be that your mouse is so sensitive that the desktop vibrations caused by hitting the arrow keys cause it to move? There shouldn't actually be any mousemove event firing unless the mouse actually moves, but I guess that could happen.\nI think attached patch solves this.\n. Ugh. Well, this week is not one where I have time to debug other people's code. I've reverted the whole behavior for now. @continuata Do you want to take a look at this?\n. Why do you consider the old behavior more correct? We can't have a selection ending at 6:0 if there's a range with inclusiveLeft enabled starting there, so that end of the selection has to be moved somewhere. The old algorithm, mostly by accident, pushed it back to 5:21, the new algorithm pushes it forward to 7:1. Both seem acceptable.\n. @mightyguava @heppe Want to take a look at this?\n. Thanks! Merged as 237a6b6\n. I really don't see any way in which it would make sense to load a library that only does anything in the browser outside of the browser. Try restructuring your app to not do that. I'm not going to restructure my library to address this use case.\n. Hah. In some gray past the file was under lib/. Thanks for noticing that. Merged as b7f0785\n. Could we just check whether it has an appendChild property instead?\n. Thanks! Merged as 4c66400\n. That's interesting, and I didn't know about position: sticky, which would indeed be a great fit for this.\nA bigger problem is viewport updating. I suspect that if you scroll quickly with async panning enabled, you'll be able to see empty space coming into view because CodeMirror doesn't know where you're scrolling to. A similar issue exists on mobile platforms. I am not aware of a solution (if you know of some API that would help the editor predict what is going to be scrolled into view, or are in a position to promote the introduction of such an API, let me know)\n. I took a look at this. But individual line numbers are rendered inside the line's element, so they can't be direct children of the scrollable element. Sticky positioning (or at least Gecko's implementation) seems to only work when the positioned element is a direct child of the scrolling container. That isn't the case here (in fact, there are several positioned parents between the line number and the scrolling element).\nSo this doesn't seem to be something that's easily fixed with sticky positioning. It'd require a serious overhaul of the way the gutter is rendered, which has its own problems (the line numbers are there because reliably aligning them vertically is a huge pain otherwise).\n. Since the gutter elements vertical position needs to be tied to the line they belong to, putting them into a single layer isn't really something that I know how to express in CSS.\n. We received a grant from the MOSS project a few years back\u2014but maybe that doesn't mean we're disqualified for another. I'll bring it up.. Thanks for taking the time time submit a PR and protecting the next person from getting confused. Merged as 188ae75\n. Thanks. Merged as 0dbe0ef\n. The use of this here is intentional. But attached patch should solve the strict mode issue.\n. Let me know when you think the code is ready for a proper review (I don't want to spend time looking at code that you're going to do more work on anyway.)\n. Thanks. Merged as 463797f\n. Thanks! Looks good. Merged as c7b64ca080df\n. Thanks. But your demo highlights most of the code in the example in red, suggesting the mode doesn't quite work as intended yet. Could you look into that?\nAlso, the demo HTML should conform to the other demos, and the code for the mode should be indented consistently.\n. Thanks! Looks good. Merged as c39008a\n. Indeed! Merged as d9042e7\n. Thanks for noticing that! Merged as 78e3ac3\n. Agreed. Merged as 420cefd\n. @heppe Let me know if I should stop mentioning you on every Vim PR, but here's another one I'd like to have a Vim user review. Thanks!\n. (Err, this is not a PR, sorry about that. I shouldn't be triaging bugs when it's late.)\nWe don't currently have an active maintainer for the Vim mode, but I'll leave this open and hopefully someone will pick it up eventually.\n. Sorry for not replying to this sooner. I somehow didn't get a notification email for it (or it ended up in spam).\n. Thanks! Merged as 3e88446\n. This looks good, but I feel this would work better as a mode not hard-coded to Markdown (though I guess that's where YAML front matters are most commonly used). So I've merged this as a4e987079517e and modified it in d6212b9216e4a to be more general, renaming it to yaml-frontmatter.\n. It fires on every selection change, by design. And cursorActivity is batched by operation, and thus not associated with a specific selection change, so it couldn't pass an origin.\nAttached patch passes beforeSelectionChange events an origin field. I'm not sure how useful this will be, since origins aren't always passed to selection changes, but it might help.\n. Hah. I was just about to push my own patch that fixed those. Merged yours as 6bc4c5a\n. Fixed via #3731\n. (You can push to pull request branches -- no need to create a new one every time you change it.)\n. This seems to just highlight every identifier as a keyword. The token variable would be more appropriate for that, and the language probably does have a concept of a 'keyword' -- a fixed list of words that have special syntactic meaning -- which you could recognize.\n. Okay, that makes sense. Still, I'd use something other than \"keyword\" to style 90% of the text -- CodeMirror themes aren't really designed to look good when everything is a keyword.\n. I'm not notified when a new commit is added to a pull request, so it's a good idea to always follow up with a comment. Now it seems like there's a bunch of irrelevant patches in the history. Could you clean that up and let me know, so I can merge this? (You'll want to do something like git rebase -i --root my-branch --onto master.)\n. Thanks. Merged as be36e3e\n. I guess it would, but the scope of this module is potentially huge, and I don't want to maintain an all-possible-bells-and-whistles search module. If you want this, you'll have to write your own version.\n. Don't tab and shift-tab, the standard way to move between browser controls, work?\n. I think being able to tab out of the dialog is a feature (locking users out of expected browser behavior is generally a bad idea).\nAlso, tabbing out of the dialog seems like a very different action than confirming it, so no, I don't think that should do the same as enter.\nIn general, if you want a different search UI, you can implement your own on top of searchcursor.js and (optionally) dialog.js.\n. Thanks! I've merged this 4955e6e018837 and integrated and generalized it a bit in 07bcf88d86\n. Looks good. Merged as 2a7dc2be2fe...28bc0e0361e\n. Looks good. Merged as f1156f5\n. Good point. Attached patch adds the fitting origin. But note that you can't rely on origins to match what you'd expect -- user code can put anything in there. They are an expression of intent, not a hard guarantee, and if you depend on a specific feature of a change (for example, whether it deletes something), you should inspect the actual change data.\n. This would be overhead and complexity, as well as a non-obvious exception in the editor's behavior, for a use case that concerns precisely only you. So no, I'm not going to do this. Just do your own check, as you describe (and figure out where the infinite loop is coming from -- \"change\" event occur after the change has been applied, so you should definitely see the post-change document when they fire)\n. When you open a document, the cursor defaults to the start, since that's what editors do. setValue is equivalent to dropping the current document and opening a new one. There is no comparing of the old and new document happening.\n. > However, maybe another function could be implemented that updates the content and maintains the cursor position.\nYes, it can, and it'd be relatively simple to do, but I don't think it should be part of the core library.. In order to keep the core's size and interface size reasonable, I prefer to keep utilities that can easily be implemented on top of it, unless they are very commonly used, out of the core. Not really\u2014this isn't something that makes a lot of sense in the first place (if you set a different document there's no obvious way the selection should be 'preserved') so I don't think it belongs in the manual. No, this is too specific for doing in the editor. Debouncing events in your own code is an easy and widely understood technique, just do that.\n. I don't think the single tap case in the touchend handler really corresponds closely enough to a mousedown event to pretend it is the same.\nI could change onMouseDown to first run signalDOMEvent and then check for an active touch event. Would that solve your issue?\n. CodeMirror does not interfere with any of touchend, touchtap, touchmove, or touchdbltap, so you can just register those on the DOM and there's no need to involve CodeMirror.\nAttached patch adds a CodeMirror event for touchstart, and makes sure mousedown is fired even during touch.\n. Merged (without failing tests) as d395fec651fd31\n. Thanks! Merged as f963146\n. HTML allows any tag names, not just the ones in the standard. As such, I don't think highlighting tag names differently is a very accurate or productive approach.\n. Well, I suppose if three people are working on one, the need for this mode is pressing. And it looks like it's going to be less work to write one myself rather than to keep hinting and reviewing and pushing people in the right direction. You can find my version in b3f9487046e37facd64196380ebdd8639ef. Please test it and submit failing test cases. If this helps you in a financial way, a donation to cover the morning spent on this is much appreciated.\n. Thanks! Merged as ef5dcef\n. See my comment here.\n. I pushed some patches that take care of most of these (though getting indentation right across language boundaries is always tricky, and I'm not sure if the result is what you consider the right way to indent these). But...\n\nElements should be allowed as attributes\n\nWhat? I saw something like that in the grammar and assumed it was a typo. I guess we're no longer in XML Kansas anymore here, huh? What does this even do? That's going to be somewhat tricky to support since it does not correspond to the XML mode's expectations of what XML looks like.\n. > The tab character inserts the equivalent of 4 spaces, but adding a newline after a { or elsewhere only indents 2 spaces.\nThis is CodeMirror's default behavior. You can configure it with the indentUnit and tabSize options if you want, but generally you'll want to use shift-tab (auto indent) rather than tab to indent lines.\nI fixed comments only being comments inside of tags, and also added support for tag attributes (which, if you see them as a shorthand for {<tag/>}, aren't as hard to deal with as I initially thought). I've also disabled multilineTagIndentPastTag in the XML submode's configuration.\n. > I wonder if indentation is off because the open and close brackets\nThe brackets are fed to the correct mode, but the way addModeClass works, it depends on innerMode  returning the correcting thing before the token was read. I've updated the mode in 65950ad to address this.\n. Great. Anything left before we can close this?\n. I think parsing the braces in the JSX mode is a sane approach (they aren't really part of the JS, anyway). You could set the JS mode to JSON to get it to parse the top-level as an expression, but that'll have some undesirable effect (such as turning off the comment info), so I think there it would make sense to extend the JS mode to also have a configuration that says 'expect an expression', without it being full-on JSON mode.\n. Pasting that code into http://codemirror.net/mode/jsx/ yields different results than what you screenshotted, and actually looks fine.. JSX is a superset, so probably not.. See my response to the identical issue you filed as #3354\n. Thanks! Merged as 0d73c4b\n. Thanks! On first glance, I thought this was going to be another 'I JSLint-ed your codebase for you!' pull request, but these are actually all useful and welcome cleanups. Merged (squashed) as f923adb\n. Without some information about how you got to the state where it returns that, there is nothing I can say about this.\n. This seems like an issue in another component or an integration issue. Going to close, since I don't have time to debug such things.\n. Attached patch should fix this.\n. Merged as c73ab133ec8e2...7549397. Next time, please submit a pull request with only the relevant patches in it (i.e. rebase your branch on top of the current master branch), so that I don't have to do detective work to figure out what you want to merge.\n. This appears to be fixed by 754939707b\n. No idea. In any case, this isn't an issue with CodeMirror itself.\n. Can you tell me what editor.display.sizer.style.minHeight (where editor is your CodeMirror instance) returns in this situation? Does it change when you add or remove a few lines? There is an issue in Firefox where it would just clip CSS sizes beyond a certain treshold. Maybe Edge has a similar problem.\n. I've confirmed that Edge won't size elements bigger than about 1533917 pixels. It'll show the CSS values correctly (unlike the similar bug in firefox), but if you look at the element's offsetHeight, it is clipped.\nI'd suggest reporting this as a bug in Edge. You can reproduce it with this trivial HTML page:\n``` html\n<!doctype html>\nxyz\n\n  console.log(document.querySelector(\"div\").offsetHeight)\n  // you get 1533917\n\n```\n. Thanks. Merged as 5b4f224\n. Thanks. Looks good. Merged as 5b5976a6b and followed up with d40f5e270\n. Did you see the yaml-frontmatter mode?\n. The existing mode should also support optional frontmatters. Attached patch fixes the bug that prevented this from working properly.\nIn general, don't duplicate modes if you need a slight variation of them, add options or wrappers instead.\nClosing this, but feel free to respond if you still need something that yaml-frontmatter doesn't provide.\n. Looks good. Merged as 4a68108\n. Thanks! Merged as fd6209e\n. Merged as df00bf3 \n. What you are probably seeing is a web font being loaded after the editor has already initialized, changing the size of the content text, and thus invalidating the measurements the editor did. Calling refresh will indeed fix that, as will initializing the editor after the font has finished loading. (Changing the fontSize style, on the other hand, doesn't have anything to do with it.)\n. What you did looks correct. Just make sure you schedule a refresh when (or delay editor initialization until) your web fonts have loaded.\n. Indeed, the feature exists, you just need to bind it differently.\n. The Swift mode does not indent, period. A pull request that adds this would be nice, but as it is, the feature does not exist.\n. I've pushed an alternative patch (db3c12d).\nA mode not advancing a stream is a bug, and I don't want to go down the road of trying to 'sandbox' bugs in modes, so yes, a crash is the appropriate reaction to that.\n. I don't have an environment in which to reproduce this. Could you run a profile when this happens to try and figure which JavaScript code (if any) is causing the delay?\n. Agreed. Merged as 8403db2\n. Could you describe the nature of the problem you are having? Given the way CSS z-indices work, I can't really think of a way in which this could cause a problem that isn't solved by a single line of CSS.\n. What is the parent node of that overlay? And in which browser are you seeing the problem?\nAnd no, definitely don't change codemirror.css\n. Something like .CodeMirror { z-index: 0 } should do it.\n. The regex provided to the specialChars option should match a single character, not a string of them.\n. Thanks. Merged as 8850e26 \n. Thanks. Merged as 17a0538\n. Thanks. Merged as e6b2f4f310f2\n. Thanks. Merged as 75d597c\n. What would multiline gutter markers do, exactly?\n. Nope, that doesn't really fit the current model, where lines (including their gutter content) are rendered separately and independently, and doesn't seem that much of a win.\n. Hi. This does not happen for me on Chrome. Which browser / version are you using?\n. Hm, that's exactly what I'm using. Could you describe your steps in more detail? When I go to the merge demo page, and scroll either of the editors right and then left, the gutter stays in place.\n. The editor was clipping the horizontal scroll position wrong, leading to it believing it was setting its horizontal scroll somewhere the DOM wouldn't allow it to, confusing the gutter alignment code.\n. Hi. Before I look at this, please configure your editor to not change every single newline in files that you touch, and then resubmit this as clean patches, so that I can actually see what changed.\n. Much better (though you still used tabs to indent the css, ignoring the surrounding conventions).\nMy take is that this is too specific and fragile (try with right-to-left text, for example) to put in the core library, but it would make a great addon. I believe the library exposes all the hooks necessary to update the cursor after a selectionChange event, except for an event that fires when overwrite mode is entered or left. Do you want to refactor it into an addon?\n. > No event for overwrite mode switching is a problem, Without a way to hook\n\ninto that, it'll be practically impossible. Is there any way to get around\nthis?\n\nYes, what I meant to say is that you're welcome to add such an event.\n. This is out of scope for CodeMirror, but yes, it's definitely possible (get HTML, create editor with that HTML as content, I guess).\n. CodeMirror doesn't do any kind of rendering/previewing, it just highlights the source text, and I don't think there's an difference in text highlighting needed between these two dialects of Markdown. As such, it sounds like you filed this in the wrong project.\n. The manual reflects the exact current version number... this is intentional.\n. The manual on the website reflects the current dev version, which I give its own patch version bump to distinguish it from published versions. There's a 5.11.0 manual in the zip file for 5.11.0.\n. The mode was, for some reason, keeping state in a variable rather than in its state object, and this kind of corruptions in rare situation are exactly what that causes. Attached patch fixes this.\n. Superseded by attached patch.\n. Thanks. Merged as 6792348c4a\n. So yes, the reason why selection spans the line's whole vertical range is exactly to prevent gaps in block selections. I find your second screenshot to look strictly worse than the first, which is also the reason CodeMirror uses the strategy it currently uses. I know aesthetics are subjective, but you can probably imaging why I'm not putting energy into implementing something that I feel looks awful.\n. Are you using line-wrapping? If not, you might be able to just use a line widget to create the space below the line, which wouldn't cause this issue.\nI guess I could add an option singleSelectionHeightPerLine, but pretty sure that if I just apply the simple patch you propose, these selections will look entirely wrong when you mix font sizes or have bidirectional text, since they assume that the height at the measured point will be valid for the whole line. Stuff will stick out of the selection, for example, and the selection size will depend on the size of the characters at its endpoints.\n. On closer look no, I think you'll just have to continue patching your version of CodeMirror. I'm not volunteering for implement this in a way that solves the problems I outlined, and I also don't want to add unsupported single-use options for specific cases like this.\n. There isn't really a maintainer for the YAML mode anymore, so if you could take a stab at a patch, that would be useful. I agree that it looks like this has something to do with indentation measuring (but I don't know how YAML works, so I don't know what the code should be doing).\n. Please take a look at attached patch, and see whether it solves your problems.\n. Good catch. Attached patch fixes this case.\n. Again, I think this is addressed by 3df470adc8e7be\n. Yes, TypeScript support is a kludge (was contributed) that doesn't really play well with the JS mode's context-sensitive parsing. This is mostly visible in template strings, but will cause a bunch of other issues. I'm not supporting this code, but if you want to submit a patch, I'll gladly look at it.\n. I've pushed an alternative patch, which makes the Python mode handle bracket scopes the way most modes do. It is probably more robust, and should also cover #3798\n. I think patch 3df470a has the effect you're looking for. Please test.\n. The Soy mode was contributed, I haven't really looked closely at it nor have I ever used Soy. You can try to convince the original contributor (@vrana) to address this, or submit a patch yourself.\n. Thanks! Merged as a491854\n. Does attached new patch help?\n. Attached patch should help here.\n. This event is fired on your completion object (the thing returned from your hint function), not on the editor instance.\n. I've gone ahead and simply added the alias, despite not really understanding the implications. If anyone wants to suggest a different approach, do comment. (@heppe)\n. Thank you! Merged as 18d3e0b\n. I think attached patch should cover it. Let me know if you still see bad indentation.\n. Nope, there isn't. In fact, there isn't really a concept of an active difference, it just looks at the cursor when moving to the next one.\n. Is the body editable? If not, the only explanation for this that I can think of is a CSS problem causing the content of the editor to show up in the body. What does getValue() return after you type some stuff like this?\n. Strange. But I'd say that this is a form of focus confusion that's an Edge bug, not something CodeMirror can help. (If you have evidence to the contrary, feel free to add further information.)\n. This is not a good use of a top-level option. I'd prefer if you got the value from an optional second argument passed to jumpToLine.\n. Thanks. Merged as e1a8c83 \n. I've merged this as 0b06a49. I'm not sure why unmap wasn't part of the API before, but it looks non-problematic.\n. Thanks. Merged as ba9d400\n. I'd be leaning towards option 2 -- I assume default vim also allows you to unmap default bindings?\n. So then it sounds like the 'proper' solution would be for the vim bindings to implement vim's delay for potential multi-stroke key sequences?\n. Thank you. Merged as 8be7d32\n. I am not able to reproduce this. Here's concretely how I'm following your instructions:\n- Open the fullscreen demo.\n- Select all content of the editor, press ctrl-x to cut\n- Spam letter keys until there line is long enough to cause a horizontal scrollbar\n- Move to the middle of the the line (or don't, both cause the same outcome)\n- Press ctrl-v to paste\nThe cursor now moves to the end of the pasted content, near the bottom of the document, and the last line is visible, above the horizontal scrollbar. If I add a few extra lines so that pasting doesn't put the cursor on the last line, the problem still does not show itself.\nThis is Firefox 44 Linux. Which OS are you testing on?\n. Ah, sorry for the poor reading. Looks like a bug (or at least strangeness) in Firefox's interpretation of a padding I'm setting. Attached patch seems to work around it. Does it help?\n. The .bower.json file isn't in the repository, and is not something CodeMirror is creating.\n. Thanks. Merged as d487830\n. Looks good. Merged as 9a80b69\n. Because CodeMirror highlighting works in a streaming way, it is not cleanly compatible with single-shot parsers, but if your documents are small, you can still get this working pretty well by wrapping your data structure in a CodeMirror mode that tracks its current line and column, and fetches tokens from the data structure. Re-call setOption(\"mode\", ....) every time the parsed content changes to trigger a new highlighting pass.\nThis is a question, not an issue. In the future, use the discussion forum for those.\n. Merged as 90d025e\n. Transforming a CodeMirror editor is not supported in general. See also #2443\nThe issue with zero transforms breaking the context menu was fixed earlier this month (see #3238)\n. If you apply attached patch and make sure the htmlmixed mode is loaded, the problem should go away.\n. You should probably use markText for this use case. The way overlays (and modes in general) work relies on them being stateless, and oblivious to line numbers.\n. Fixed via #3868\n. @bfrohs I looked into this a little, and am getting very wrong values for the indentation and indentation difference in this example. The indentation-computing code appears confused -- the list handling code adjusts its to include the marker, but then the code that computes the difference assumes that it need only count to the first non-whitespace character. Git blame pins it on you, so would you maybe take a look?\n. Thanks! (And sorry for breaking it.)\n. Patch afed95a should help (& adds a test checking the snippet you showed).\n. The demo at http://codemirror.net does not show a scrollbar when there's only a single line in it, neither could I scroll it with the scroll wheel. What kind of scrolling do you mean?\n. Ah, now I can see it. Attached patch fixes it for me (on Chrome)\n. Thanks! Merged as 68076a8\n. This is more an issue with <fieldset> than with CodeMirror. See this very good stackoverflow answer for details (and a hack to work around it).\n. Seems okay on Chrome Linux as well. So I'd be tempted to blame a particular issue with those Chome versions. If you can find a root cause that CodeMirror can avoid, I'll happily consider patch. But I'm not going to dig into this myself.\n. Thanks! Merged as caed330\n. What if you add some sanity-checking to your mode so that it doesn't output any styling when the tokens in the stream don't match the tokens in its token list?\nImmediately doing a synchronous parse of the whole document isn't a good approach, since it could block the UI for an arbitrary amount of time at critical moments when the user is expecting feedback, making the editor feel unresponsive.\nMaking it so that the editor doesn't highlight at all if it couldn't get a precise state would be possible, but that'd be somewhat invasive, since it'd require a bunch of code to know about this special state that highlighting can happen in.\n. > Basically file contents can repeat on different lines and I can't sanely check that from the grammar\nThat's true, but large stretches of repeated text are rare, and highlighting a few lines wrong (potentially -- it might even be right) and then disabling highlighting as soon as a mismatch is found is still much preferable to the color soup in your screenshot, no?\nGoing to close this. I see the use case, and I'm going to rethink the way this works the next time I do major work on the highlighting system, but right now this isn't something I want to implement.\n. Ugh, accidental type conversion strikes again (null \u2192 0). Attached patch fixes this and adds your test.\n. The ^ and $ regexp syntax isn't support in CodeMirror's search/replace addon (due to JavaScript's crude regexp API), so this use case is simply not covered by the addon.\n. Thanks! Merged as 3f752d0\n. Why?\n. Makes sense. Merged as 3e1e203\n. Thank you. Merged as 8b9066a\n. @Dominator008 Thanks for the vote of confidence ;) Attached patch should help.\n. Looks good. Merged as 9e31c01\n. Hi. We don't take mode feature requests. See the wiki\n. (There's not currently an active maintainer for the vim mode, so issues against it aren't being worked on.)\n. This triggered a rather bad layout trashing, which attached patch addresses. I wasn't able to get it to hang for minutes, but I did get 5 second hang, which was reduced to 400ms by this patch. Could you test this and see if it yields decent performance in your use case?\n. The time seems to be mostly spent in positioning all the individual selection elements. The way CodeMirror handles selection updates involve redrawing the whole thing on every update, which becomes significant work once you have 500 selected ranges, since it involves finding the position of each of those ranges. I did some poking around and this doesn't appear to be a case of an accidental expensive computation (as it was before) -- this is just what tons of selections cost, in CodeMirror's implementation. The code isn't really designed with that many selections in mind (most of it was written before we had multiple selections), and I don't see any low-cost changes that would solve this (updating selections lazily would introduce a bunch of new complexity, and still not help when code above the selections changes, unless we somehow anchor them to the text, which isn't something CSS makes easy).\n. > whould it also be possible to limit selection-drawing to only those that intersect the viewport?\nThat's what my previous patch attached to this issue (0291f72325ebd74cf56) implements. However, if you have a lot of tightly packed selections, as in your test case, it doesn't help enough. The issue is also that holding down a key is going to need to update the display for every event -- you can create and draw 500 selections in under a second, but creating 500 selections and drawing them on every update (500 / 2 * 500 = 125k drawn selection) is a lot more work.\n. I can't interpret any of this, but it sounds a lot like you're working with music software. CodeMirror isn't, so this appears to be filed in the wrong repository.\n. Oops. Thanks for tracking that down. Merged as 24d6057\n. Thanks. Merged as 877b2b1\n. Note that JSON actually needs to be parsed differently, which isn't the case here, right? But still, people might want to show the language name to the user somehow, in which case having a separate entry makes sense. Merged as 8799d1d4fb325\n. Looks like you just copy pasted issue #3802 in a new issue?\n. It works for me now. Did you pull patch 11f3d9694d74d60?\n(Also, there is no attached image.)\n. Would it ever make sense to use Twig with a non-HTML output language? If so, could you adjust your implementation to support a base option to configure the base language, the way the Handlebars mode does?\n. (Is the fact that you're now defaulting to no base mode intentional?)\n. Thanks. Merged as a448b97\n. Looks good. Merged as 72d4770f2f6\n. Sounds like you actually want handleMouseEvents: false (with your own code to preventDefault drag events).\n. That's not JavaScript. You're probably looking for the jsx mode.\n. No it doesn't. If you're going to spam the issue tracker, at least make the effort to submit a failing case.\n. Try pasting your code into http://codemirror.net/mode/javascript/ . I typed in a rough approximation of it (can't copy-paste images) and that seemed to highlight properly.\n. Seems to be a Chrome bug. Here's a tiny (CM-free) reproducing snippet:\n``` html\n<!doctype html>\nfoo\n\nvar div = document.querySelector(\"div\")\n\ndiv.addEventListener(\"mouseover\", function(e) {\n  if (e.ctrlKey || e.metaKey) div.innerHTML = \"<span>foo</span>\"\n})\ndiv.addEventListener(\"mousedown\", function() {\n  console.log(\"mouse down\")\n})\n\n``\n. Many thanks! Merged as afed95a\n. Thanks! Merged as 79193c0\n. Thanks. Merged as 12168b275d6e and followed up by 0514f28ea6776\n. Have you been able to isolate the factor the causes this? The problem doesn't seem to happen on the demos, even when set thereadOnlyoption to\"nocursor\".\n. Not going to merge this without further information. Feel free to add comments.\n. It doesn't really matter, since undefined counts as falsy, but if you want to submit a PR to fix it, go ahead.\n. Good call. Merged as d9b821a\n. It appears that IE is returning incorrect client rectangles for text in very long lines. Have you tried if this is fixed in Edge?\n. I've never seen CodeMirror _animate_ a scrollbar. When I follow your instructions (I initialized the editor's content to a long line, and then flipped the checkbox a few times), everything seems to work -- the scrollbar appears when it should, and is usable. Any further information?\n. @steveohara Would you be able to take a look at this?\n. Simply pasting something into http://codemirror.net/mode/markdown doesn't trigger this. Could you give me more detailed instructions for reproducing the problem?\n. I still can't reproduce. It looks like someone, react-codemirror or your own code, might be registeringundefined` as an event handler, which is a bug in that code, not in CodeMirror, and should be fixed at that point.\n. @devoncarew Do you want to take a look at this?\n. Thanks! Merged as be7612d\n. CodeMirror's history is linear -- i.e. it just implements rolling back and forward to the precise state you had before. Thus, making a change clears the redo history, and there's nothing I can do about that short of rewriting the history (& a bunch of other aspects of the system, because this would involve being able to 'rebase' changes relative to each other and such).\n(This may happen at some point in the far future, but for now, the behavior you want is simply not supported.)\n. Looks good. Merged as 66b0b4d\n. Good call. Merged as feed440 \n. > So I tried rewording defineSimpleMode as defineMode\nYeah, that's not going to help. You have to include simple.js in your bundle to use modes defined on top of that addon.\n(In general, I'd recommend moving to a real bundler, since the compression helper doesn't understand dependencies, and we're getting increasingly complicated dependencies.)\n. The equals style isn't a standard token style, so it might be better to use operator for that. Also, you'll at least have to make the tests pass if you want me to merge something like this.\n. Since you'll often want to specify additional styling anyway, and pixel sizes tend to belong in CSS, I don't think the current state of affairs is very problematic.\n. @MakeNowJust Do you want to take a look at this?\n. Looks like you'll have to somehow distinguish between suffix if and start-of-expression if. I'm not sure how hard that is in in this grammar\n. Since this appears to be a whole new language (and not a very complicated one), you're probably best off writing a new mode for it.\n. I'd review a pull request that adds support for this (it's probably not too hard to build on top of the existing hooks feature of the SQL mode), but I'm not actively working to fully support for all corner cases of all SQL dialects in my own time.\n. If I go to the merge demo and shorten the longest line, I'm not seeing this happen. Could it be that 29555c986dd already addresses it?\n. Nope, it isn't, nothing about that changed, and I just tested.\n. Which browser? I'm not having any luck reproducing it in Chrome Linux.\n. Oh, hold on, no, I can reproduce. Investigating.\n. Attached patch seems to help.\n. Thanks for spotting that. Merged as 934dd97\n. With patch 1de61c6 you can set your mode to {name: \"jsx\", base: {name: \"javascript\", typescript: true}} to get JSX-with-TypeScript\n. @zaggino Done in a7bfe34 . Any ideas for a better MIME type string?\n. Nope, but you could use the information in the change object to create the new content yourself if you really want to.\n. Which browser did this occur in? (No luck getting it to happen on Chrome so far)\n. I've reverted that code in 0814679 . Am now looking for an alternative fix to address the issue it was trying to fix.\n. (Will bring out a new release when I've found an alternative fix.)\n. Looks good. Merged as 3101742\n. We don't keep open issues for mode requests. See the wiki\n. Good call. Done in attached patch.\n. Browsers won't create individual bounding boxes for characters when ligatures are used, which breaks CodeMirror's cursor placement (among other things)\n. I'm not (Chrome Linux) seeing any ligatures in that test case.\n. I guess you mean the spacing between AV. That might be handled by the same CSS control, but doesn't cause the issue I was referring to -- that happens only when you actually get a different rendering for letter combinations.\n. This is somewhat related to #2115 and definitely not easy to fix (especially in a performant way), because ligatures are complex and unpredictable, and querying the browser for the information you need is hard.\n. What do you mean that they seem to work fine now?. JavaScript functions are objects, so you should pass in a function, and give it an async property if appropriate.\n. I have very little interest in adding build steps and other complexity to the themes, especially if the intended effect is to reduce their power. If you want to have a set of color-only themes, maybe set it up as a separate project.\n. Should be better now.\n. Looks good! Merged as 65964cf\n. Good point. Attached patch should fix this.\n. Can you reproduce it in minimal HTML page with just CodeMirror an no other scripts/frameworks included?\n. This seems to be a duplicate of #1104\n. Thanks. Merged as 1cc93d9\n. Thank you. Merged as fa705ea\n. We're moving away from tagging all files with a license blob, so attached patch removes the check.. Thanks! Mode tests are always great to have. Merged as fa705ea05a3...95f6840611f and integrated in c9b28f6268a596.\n. Thanks! Merged as 98f2ce5\n. Thanks, looks good. Merged as c3d2246\n. return a, b will return b (the result of the comma op is the last operand), so I've pushed alternative patch 420bdf1 instead.\n. Thanks for tracking that down. The original ret was a completely unused bogus abstraction, and I guess I got a bit rough with the code when removing them. See ea6382a for a futher cleanup.\n. Thanks. Merged as ab455f2 \n. Multi-line strings are most certainly part of ES3 and 5 (see here for example, the ES3 grammar contains a similar clause). I know some tools are fussy about them, but I consider that a problem with the tools, and have no interest in purging them from CodeMirror.\n. Agreed. Merged as aa0b249\n. Yeah, the code made no sense whatsoever to begin with, and my fix caused a linter error, so I followed up with ea6382a, which tries to fix the most obvious brokenness in that file. I think it also addresses this.\n. Looks good. Merged as 8f095df\n. I can't find anything about this op in the standard. Where is it defined?\n. Makes sense. If you feel like extracting a full list from that standard, that'd be useful. For now, I've simply added bind.\n. Nope, this feature does not exist, and is unlikely to exist in the future. The browser handles the wrapping, and CSS doesn't provide a way to do what you describe.\n. That's nice, but not something that warrants a prominent link on the project frontpage. Add it to the wiki if you want.\n. Nice! What tool did you use to find/make these?\nI've merged this as 4d1e417, with the exception of e6bb0a600fabb, which changed test data in a way that broke the test (since I don't really understand vim jargon enough to understand what the test is testing, I opted to leave it in its misspelled form).\n. The JavaScript mode does a rather detailed parse, and if that gets confused, it'll start getting context-dependent things like recognizing variable definitions, regexp-vs-division, and template strings wrong.\nSince these do not syntactically behave like atoms (which are simply expressions), I don't think this is a good idea. With await, you could simply make it a \u201ckeyword c\u201d, since it syntactically behaves pretty much like delete or yield. With async, you'll have to create a new keyword type, and handle is specially in the statement function (just skip it and start parsing a new statement, something like return cont(statement)).\n. Maybe wrap it in a relatively-positioned zero-width overflow-visible element? In any case, as you said, this isn't something that the library aims to support\n. Thanks. Merged as 3265e11\n. The element with id editor is not a textarea, causing its value property to be undefined, which causes this error. fromTextArea expects a <textarea> node, not any dom node.\n. Great. Could you add an index.html that shows an example of the mode? (You don't need to open a new pull request -- if you push something new to the branch that the PR is based on, it'll update the pull request, even if you force-push to overwrite previous commits. Be sure to leave a comment when you update, so that I notice that something happened.)\n. Merged as 7fa0cdc493e4, made to conform to our code style in 9389a050790\nBy the way, you don't have to add yourself to AUTHORS, that's done automatically on every release.\n. Please don't report the same issue twice. This was handled in #4178\n. Thanks! Looks good now. Merged as adb73ff\n. Argh. Thanks for noticing that. Attached patch should improve things.\n. CodeMirror is released on a time-based schedule, around the 20th of each month, so yes,you'll have to wait a few more days.\n. Thanks! Merged as 6fa5752\n. If I paste that into http://codemirror.net/mode/python/ the highlighting looks fine. Could you describe the problem in more detail?\n. I don't know anything about django views. If this is something you can reproduce with our code, feel free to comment here, but until them, I'm closing this.\n. Thanks! Merged as eb639c1\n. Hello Scott,\nThanks for looking into this. The need to call toTextArea on a textarea-based CodeMirror in order to clean it up was not mentioned in the manual, which was definitely an oversight. I've added patch 66fd40f to fix this.\nAs for actually leaking those DOM nodes, the model CodeMirror uses is that to destroy it, you must remove it from the DOM (which you did), and drop the reference to the editor, so that the GC can collect it. Your measurements sound like you didn't do the latter. I set up some tests where I create a boatload of CodeMirrors, but don't keep references to them, and then remove them from the DOM. The result is a single detached DOM node (measureText).\nI'd prefer to avoid adding a separate cleanup method. Would it be difficult to restructure your code to null references to CodeMirror that are no longer alive?\n. > but it would be lovely to be able to have CodeMirror be able to clean up any dangling references when we \"cancel\" it.\nThing is, it's supposed to already do that, out of the box. If you can reduce your test case to a minimal, no-dependencies form, I'll gladly see if I can debug it.\n. Closing until further information comes in.\n. Agreed. Not sure what this is trying to do, but it looks like an accident of playing around with the github API. Closing.\n. Verified that it's missing. But I could not figure out how that happened -- at no point was it missing from the respository, it hasn't been added to .npmignore, and I don't remember doing anything strange when publishing.\nnpm publish doesn't seem to have a dry-run option, so I'm unsure how to debug this. Any ideas?\n. Okay, npm pack includes the license properly. I probably managed to do something weird when publishing that release (though I still can't figure out what). Published a 5.13.4 with a LICENSE file.\n. Done.\n. It should say 5.13.4 on NPM, that's the version I released. .5 is just an in-between development version.\n. The issue is that there's no language-independent way to determine whether inserting a comment string at a given position is actually going to create a comment. One option would be to insert the characters and then verify whether a comment was created, but that's a bit of a kludge, and pollutes the editor's history with nonsense changes.\n. Attached patch uses a rather sloppy (but probably effective in most languages) heuristic to distinguish multi-line strings from strings that start at the start of the line. Does it help in your case?\n. I've merged the theme changes as d6e8f34 (though to me the new brackground looks colder, rather than warmer).\nThe gutter change for the lint addon isn't a good idea -- it causes the icons to stick out of the gutter, which will look terrible when the next gutter has no padding on the left.\n. I'm not generally a fan of using elaborate pointers. On my (Linux) setup the help pointer is ugly as hell. Since the tooltips come up instantly anyway, there doesn't seem to be much need for an informative pointer.\n. Thanks. Merged as def7063\n. Thanks. Merged as 300f7f8\n. Thank you! Merged as 44e4bd4\n. Thanks! Merged as bef7e37\n. Could you explain this header format (\"Author: ...\", etc)? Isn't the author/date/commit style metadata tracked outside of the commit message? Why would you want to put it in there?\n. This is very Gerrit-specific then. I think it'd make more sense to keep it part of the Gerrit project.\n. Sure, but hardly anyone types commit messages in in that format. I'm going to say no, I don't want to include this in my distribution.\n. The mbox mode was a close call as well. In general, the way we're currently distributing modes is starting to hit its limits -- all the modes blow up the main package's size, and I am less and less interested in maintaining all the code for them (some of it downright awful). I'm looking at ways to push modes into separate packages, with separate maintainers, without making the burden for the user too large. Maybe NPM is widely used enough nowadays to just depend on that.\n. Agreed. 6 will happen somewhere this summer or early autumn.\n. (But note that it's already trivial to package up modes as NPM packages. Just no one seems to be doing it.)\n. The minification helper is going to go when I release 6.0. I feel almost everyone that cares about performance has their own build step nowadays, so I'm going to leave minification to that.\nThere'll probably be a naming convention for mode packages, so that you can search NPM for, say, \"codemirror-mode-\" to easily find such packages. I'll continue maintaining the modes that I wrote or consider very important -- but as packages.\n. Is there an equivalent on non-Mac platforms? If so, could you add it, and if not, could you make this line conditional with if (mac) ...?\n. Thanks. Merged as 90ef4bd\n. Thanks for taking care of that. Merged as 44410cd\n. The documentation makes it clear that positions take numbers, not strings. If you're passing in invalid values, you can't expect the library to work.\n. If you define a multi-stoke binding that starts with a given key, you are thereby overriding all single-stroke bindings for that key. That's by design (and I don't think it could sanely work in any other way.)\n. Ah, I didn't know 'gg' was a multi-stroke binding. Yeah, the Vim bindings do their own handling of keys, and as such won't play nice with other keymaps' multi-stoke bindings. This might be fixable, but I'm not actively maintaining these bindings, so you'd have to look at the code yourself.\n. It would be helpful if you showed the code you're using to define this module. Right now, there's very little I can make of this issue.\n. Ah, I see what you mean now. How is this a problem?\n. That's an issue in the way you're using the library (see here). I'm not going to include names in my define calls to address that.\n. Any suggestions for an alternative set of modifiers to use for block selection on Chrome OS?\nAs for making these configurable, that's not a bad idea, but it's not something I'm going to be working on anytime soon.\n. Sounds good. Does attached patch work for you? (I don't have a ChromeBook to test on)\n. Attached patch should help.\n. Nice. How does it use CodeMirror, though?\n. Merged as a7868e1\n. Thanks. Merged as bf8e72f \n. Don't mess with the overflow properties on CodeMirror-scroll. That's not supported.\n. No one is maintaining the vim mode at the moment, so you're probably on your own when it comes to fixing this.\n. Wouldn't it be much simpler to match different regular expressions (possibly generated from the same data) in the two different cases (state.startDef and state.endDef)?\n. Thanks. Merged as 479cc65\n. Looks great. Merged as 0055101\n. Thanks. Merged as 060445d\n. This is almost certainly a problem with your code. Possible you're letting the mousedown event through, causing focus to move to the outer frame. CodeMirror doesn't spontaneously unfocus itself.\n. Nope.\n. Thanks! Merged as aa98087\n. Merged as 5c9a17c\n. Yes, this would make a lot more sense than the current async hack, now that promises are pretty much a part of the language. A clean patch + doc updates (maybe even tests?) would definitely be welcome.\n. Our code wouldn't have to directly mention Promise, it'd just check for a then method. That way, the decision of whether to use / polyfill them is entirely up to the client code.\n. This appears to be intentional behavior. Attached patch adds an option (trim) to turn it off.\n. I've made the cleanups myself in 3b36e58 so that this can go into today's release. Merged as db62891c78\n. Oh, oops, our messages crossed each other there (and somehow github didn't do its usual auto-updating on the thread). Sorry for the duplicate work!\n. I'll see if I can pull out the new tests and merge them separately.\n. Done in a579a10\n. Thanks. Merged as 9e1ad23ab756707fc and followed up with 87d10fa06bfe6\n. Thanks. Merged as 03d684f\n. Thanks. Merged as ad44ab3f3fc0, and underlying issue fixed in b936ddd1623\n. Merged as 339e623. But I am not really prepared to start doing on-demand releases for every little fix -- thought I've automated a large part of the process, putting out a release requires some work, and minor releases clutter up the release history. So unless some bad bug sneaks into a release, you'll just have to wait for the next monthly one.\n. Thanks. Merged as b751d25\n. Does attached patch help?\n. Closing your own issues if the problem has been resolved is definitely okay!\n. What the hell. This time I am entirely sure that the file was present when I did npm publish, and it's not listed in .npmignore. There don't seem to be any other files missing from the tarball.\nI'd like to get to the bottom of this, rather than continuing to have arbitrary misfiring releases.\n. Yes, I think that's the same bug. And what an awful bug it is. Okay, I'll shoot out a minor release (and hope it doesn't happen again).\n. Released 5.14.2, which seems to have a LICENSE file\n. Nice! Merged as 255d019\n. Argh, sorry, see 20d981f\n. The lint addon doesn't support multiple helpers yet. It could be updated to call getHelpers instead of getHelper, and combine the messages it gets when there is more than one helper returned. Want to implement that?\n. What is your linter for? If it targets a specific language, maybe just wrap the existing linter for the language. If it provides more general linting, maybe register it with registerGlobalHelper.\n. The approach to collaborative editing you're trying to use isn't going to work. You'll have to build something on top of change events, not keys. Also, you'll need some way to deal with concurrent/conflicting changes. This is out of scope for CodeMirror.\n. You can't. Use the origin field if you need to distinguish different types of change events from each other.\n. See the manual\n. This is probably a z-index issue in your CSS. CodeMirror can't help it.\n. Looks good. Merged as 9ac5d20 \n. Thanks for catching that. Merged as bef43ea\n. Fixed in attached patch.\n. I definitely think doing this in vim.js is a better idea -- turning off line wrapping in all prompts is going to make some prompts impossible to read. I've pushed 0458827 as an alternative.\n. I can't reproduce this on Safari 6, which is the latest version that will install on my test Mac. (And since Apple ties Safari versions to OS X versions, and OS X versions to hardware, I really don't have the budget to say up to date.)\nCan anyone who's paid the Apple hardware tax recently test to see whether not being able to override the behavior of Esc is something that Safari 9.1 does?\n. There's a static helper method on the CodeMirror object just for this. I've pushed an alternative patch that fixes all modes that are calling a sub-mode's startState directly.\n. I'm publishing to NPM and that's it. Other people can take up other channels if they want to.\n. What did you input? In your pasted content, there are no tabs, only spaces. Are you talking about the fact that the 'b c' on the second line is slightly more indented than those on the first line? If so, that's because the '\u4e2d' is wider than an 'a' in your font, and CodeMirror tabs are represented as a (column-dependent) set of spaces.\n. Yes, that's a limitation of the way CodeMirror draws spaces. Fixing this would require measuring the content before each tab in advance, which would be prohibitively slow (by causing lots of browser relayouts).\n. There's more information about this bug at https://github.com/ProseMirror/prosemirror/issues/25 . It's a Mobile Safari bug that's hard to work around in an editor set up like CodeMirror, though I might be able to lessen its impact when I rewrite input handling (which will happen sometime this summer).\n. Ah, this was already reported as #3403.\n. This is intentional. Collapsed/replaced markers can not partially overlap, and by having them both be inclusive on the side where they touch, they would start overlapping as soon as anything in inserted between them. So that's not allowed.\n. Oh, if they are not touching this should definitely be valid. I'll look into this later.\n. Found it. See attached patch.\n. And even there, it'll cause problems. This isn't something this library aims to support -- if you really want resize handles, you have to write them yourselves and ensure you call setSize when changing the editor's size.\n. Thanks. Merged as 85ef20aa66a408f and ea22650592d378\n. Could you see if attached patch improves the situation?\n. Nice URL. Merged as f9b042f\n. The way I understand Ctrl-K Ctrl-D, it doesn't require you to keep global state that way -- just deselect the primary selection, and add a new selection after it. Is there something I'm missing?\n. Thank you. Merged as 601cb37\n. There are no CodeMirror instances on that jsfiddle because the includes aren't working (at least, Chrome and Firefox block the scripts). Open the browser console to see the errors below. The lack of highlighting might have also given away that there's a problem.\nBlocked loading mixed active content \"http://codemirror.net/lib/codemirror.css\"[Learn More] TcqAf\nBlocked loading mixed active content \"http://codemirror.net/lib/codemirror.js\"[Learn More] TcqAf\nBlocked loading mixed active content \"http://codemirror.net/addon/edit/matchbrackets.js\"[Learn More] TcqAf\nBlocked loading mixed active content \"http://codemirror.net/addon/edit/continuecomment.js\"[Learn More] TcqAf\nBlocked loading mixed active content \"http://codemirror.net/mode/javascript/javascript.js\"[Learn More] TcqAf\nReferenceError: CodeMirror is not defined\n. There's an (old) branch that might work slightly better. I'm going to try and clean that up and land it this summer. If you want to help sponsor that work, that would be very helpful -- shoot me an email.\n. This is a sensible feature request, but it doesn't really fit with the existing API design -- the grammar is evaluated when defining the mode, not when instantiating it, so there's no clear way to make it possible to refer to options in there.\n. I'm just going to invite you to read the manual instead.\n. CodeMirror will preventDefault most mousedown events, so indeed, the browser's dblclick will not fire reliably. That's a side effect that can't be helped.\n. > According to the CodeMirror documentation, under \"Events\" it shows a \"dblclick\" event, so I assume this means that event is not actually supported (reliably)?\nThe browser events are documented as simply forwarding native browser events, giving client code a chance to register custom handlers with higher priority than CodeMirror's built-in behavior. If the browser doesn't fire these, neither will CodeMirror.\n. > but fail with ![image](http://abcde.png)))xyz)\nYes, the spec requires us to match only balanced parentheses within a URL. Otherwise, the grammar would be way too ambiguous, and you'd often get problems the other way around -- matching too much.\n. This is not the place for such requests, sorry.\n. Thanks! Merged as 90d8250\n. If you want us to look at it, reduce the problem to a minimal HTML file. You're likely to already find the issue yourself if you do that. I'm not going to dig through your application to try and figure out what's going on.\n. I'm not seeing this happen when running editor_html.setValue('<!-- anything -->') in this demo. What else is required to reproduce it?\n. You index doesn't trigger the error for me either. It also doesn't include xml.js, making the xml-fold addon do pretty much nothing. But even if I add that, I'm not getting the problem. Are you sure you're using an up-to-date CodeMirror version?\n. The problem right now is that I can't reproduce this, and thus can't debug it.\n. Thanks! Merged as 5067bae\n. Thanks! See #4022\n. Thanks for looking into that! Merged as 5cf02c9187a8, and updated in 9ad383797c28 to simplify, remove comparison with undefined (which worked, but is a little too obscure), and fix the way the new chunks are inserted into the parent children array (using push only works when the content is inserted into the last child, which is always the case when loading content, but not when, for example, pasting a big chunk in the middle of a file).\n. Woah, I somehow missed the second part of this patch (the spilling of branch chunks) when reviewing, and that turned out to be broken, corrupting documents when gradually grown above ~500 lines. Reverted that part in 0d4374d10ee32b\n. Yeah, the splicing is less large-scale in the second, but it would probably still benefit from being optimized. We'll just have to figure out where the bug is.\n. Fixed by reverting 8dbb84f4\n. I am not seeing this happen with by default in Sublime Text, and I currently have more pressing things to do than redoing people's pull requests. If someone wants to submit a proper implementation that'd be welcome, though.\n. Thanks. Merged as ea28094\n. It was black on my system, but I guess that's not something you can rely on. Attached patch sets explicit colors.\n. This is intended behavior. The user can press shift-tab to realign. You'll get a similar effect if you press enter before a closing brace any a brace-based language.\n. Thanks. Merged as 981217306, slightly updated in 889098f123\nPro tip: Next time, don't complain and whine in issue reports. You didn't pay for this software, and being rude and entitled about it does not put me into a mood where I want to collaborate with you.\n. Re-reading the original issue, it isn't as bad as I remembered it. The subject commanding me to make the feature 'function properly' grated. I get a lot of email, most of which are requests for unpaid assistance, and that can get on one's nerves when there's other things to do. But since you submitted a solid implementation yourself, we're definitely good here.\n. Thanks. Merged as cdabb67\n. That would just cause a different problem when line 1113 tries to run lastCopied && lastCopied.text.join(\"\\n\") == inserted. I've pushed an alternative patch.\n. Okay, that was really bad, and would affect everybody who gradually grows a document. I've published 5.15.2 with the fix.\n. It sure is a joy to be forced into more busywork because github adds their own release mechanism and doesn't automatically play nice with tags. I've submitted the last 4 releases.\n. The current idea is that browsers will fire mouse events if we don't handle the touch events. Does that not work in this case? (Do you maybe have your own touchstart handler that's calling preventDefault?)\n. Looks good. Merged as 320b301\n. Hi James, thanks for writing more CodeMirror modes. I am planning to, in the coming months, start splitting off language modes from the main editor package, because the burden of maintaining all of them is becoming too much. As such, I'd appreciate if you'd set up a package, with a name like codemirror-mode-wordpress or so, and published it to NPM yourself. I don't want to merge this, just to split it out again next month.\n. Thanks, looks good now. Merged as 79bec105b4\n. Are you sure that what you're seeing is the textarea? That definitely shouldn't blink (the CSS changes that cause the cursor blinking are applied to a completely different element), so I can't explain why the box in your videos is blinking along with the cursor.\n. Also, since 48 is not even beta yet, maybe file a report with Firefox about this first, and see if they fix it? If they've made focused textareas un-hideable, that's not something we're going to be able to work around.\n. Thanks for finding the corresponding Firefox issue. Let's see if it gets fixed.\n. I think patch 2543f795ae42d fixes this. Could you verify?\n. I think attached patch will help.\n. I'm not seeing the shift in http://codemirror.net/demo/rulers.html. What triggers it?. > The layout structure of the http://codemirror.net/demo/rulers.html is slightly different from jupyter-notebook.\nRight, that's why codemirror.css has these comments:\ncss\n.CodeMirror-lines {\n  padding: 4px 0; /* Vertical padding around content */\n}\n.CodeMirror pre {\n  padding: 0 4px; /* Horizontal padding of content */\n}\nI.e. the fact that horizontal padding should be set in .CodeMirror pre is an assumption the library makes (not just in the ruler addon), and which you should stick to.. I guess filing an issue with Jupyter is appropriate then.. Thank you. Merged as dabefce\n. This is by design -- until a line is actually rendered, its height is an approximation of its real height. There's no way around this except for rendering all lines right away, which would completely defeat the lazy-rendering optimization.\n. Thanks. Merged as bda854e\n. The closebrackets addon is a simple helper, not a clever intention-guessing machine. For what it's worth, Sublime Text behaves the same way. Doing something more advanced is out of scope for my addon (feel free, of course, to implement a more refined alternative addon yourself)\n. This pull request appears to just add a findMarksOnLine method (which is already well covered by findMarks), and doesn't do anything else. Did you forget a patch? (In any case, use findMarks, no need to add a new method.)\n. ... Oh, on closer look, the patch would have an effect, due to the changed meaning of the call in foldcode.js. I get what it does. Could you do it differently?\n. Thanks, looks good now. Merged as 431dd1b\n. Firstly, dataset isnt supported by all browsers CodeMirror supports.\nBut also, I think it's a better idea to go through the actual mark value (using findMarksAt) to get at any info you associated with the mark, rather than pushing all that into the DOM, which is more expensive and messy.\n. Would it make sense to also distinguish which command the key refers to, and execute the appropriate action? It seems that for some of these commands, we could just execute the command itself, no?\n. Any way we can at least make findPrev search backwards in this situation?\n. Thanks, that's what I was also thinking of. Merged as 5c6025a and adjusted a bit in b7b4269\n. Why are you putting the init logic in an onOpen callback, rather than running it directly after opening the dialog?\n. Merged as 440395d\n. I release around the 20th of each month, so in about two weeks.\n. These require the quoted thing to be tokenized as a string, which generally only happens in programming-type modes.\n. No problem! It is confusing, it's just that the closebrackets addon is such a delicate mess of hacks that I'm not terribly motivated to try and further change its behavior.\n. Merged as ecd6976f2be2, but followed up by 92e9634f25 which removes that rather pointless conversion entirely.\n. You have to include the diff_match_patch library, as mentioned here.\n. You're seeing the behavior of the maxHighlightLength option, which you can change.\n. Works for me. Are you sure you loaded the brace-fold addon?\n. What I did to try this out was nothing more than including the CSS mode in demo/folding.html, and setting the mode of the first editor to \"css\".\n. Thank you. Merged.\n. Thanks. Merged as 14307f60e6b9 and 58b549d2147ba2\n. Yes -- keymaps can be configured, and by default the editor isn't binding Alt-F.\nBrowsers do not provide a way for JavaScript to inspect keyboard layout or user-defined bindings, so our options for handling this are very limited. I'm not sure why your OS/Browser ends up firing a key event with altKey set to true and F's keycode in this case, but once it does, there's no way for JavaScript code to distinguish it from a real Alt-F press.\n. Thank you! Merged as 047afd2\n. Attached patch seems to help.\n. > One other issue is that it doesn't preserve spaces and enters.\nOf course. That's what this addon does -- it takes a block of text and adjusts its newlines so that it's 'filling' the available columns. It doesn't distinguish between newlines it inserted and newlines inserted by the user.\n. Nope, I don't write modes on demand, but the XML mode will probably get you a long way for SVG.\n. No, there isn't -- intentionally, because different modules might be registering event handlers without knowing about the handlers from other modules, and this would be a composability hazard.\n. What do you mean by 'keys explicitly defined in [...] modes'? Keys you added to those modes from external code? I don't think the vim mode is supposed to be used that way.\n. @vincentwoo You can enter replace mode in the vim demo (i, insert) and then press backspace. The keymap tries to bind this to goCharLeft, but it is ignored.\nThis is odd. These seem to have been there for a long time, but they never worked since the rewrite in late 2012.\nSuch bindings, even if we fix them with the proposed patch, wouldn't work with vim's macro recording and multi-stroke keys, though. Also, keymaps with a call method were never supposed to also behave like regular keymaps, so I'm not really happy about making this change.\nI think I'm gong to consider these bindings a bug in the vim mode, and would prefer for them to be fixed there. Unfortunately, the vim mode is without maintainer, and I don't really know how it works.\n. I've merged the patch. So the recommendation for adding key bindings to a vim-enabled editor is to add a separate keymap with the addKeyMap method, and put your bindings in there.\n. Thanks. Merged as 3aba5a8 . Though I'm not sure why you claim it maintains the existing bindings -- it doesn't. It changes the bindings on non-Mac platforms from the Linux to the Windows defaults, and does not leave those bindings on Mac. I guess this is okay (if I understand the ST docs correctly, which are sort of opaque because of the inconsistent and cryptic symbols they use)\n. You once again changed the behavior in a way that breaks the default linux bindings. I'm going to hold off merging/fixing this until someone can point me at defining information about per-platform bindings for ST. Unfortunately, and bafflingly, no such thing seems to exist online (at least in the first page of google results)\n. They are probably also in some JSON file in the ST distribution tarballs.\n. The main library is recognizing windows with /win/i.test(navigator.platform), so I guess you could use that, the existing mac check, and just call everything else 'unix'? That's not super accurate, but close enough for this purpose, I think.\nI do prefer to get a single patch (use amend or rebase), but if you're having trouble I can also do the squashing myself.\n. CodeMirror achieves its performance by only drawing the part of the DOM that's currently visible. If you make it resize with its content, the whole document will end up visible, and that is going to be a lot more expensive. That's not something that can be helped.\n. Do you have vierportMargin set to a large number?. > It should be fairly easy to modify the code to use the viewport height/scroll offsets for computing which part is visible,\nUnfortunately, no. To ensure that things are drawn before they are scrolled into view, CodeMirror uses a very involved scrolling model for its container.. > Could it work if you allowed users to drop that requirement?\nProbably, yes. It'd still require changes to some of the more fragile/scary parts of the library, but it should be possible.. Markdown allows inline HTML, and the CodeMirror mode supports this. So your <h1> probably doesn't mean what you think it does -- it starts an inline HTML tag, and you have to escape the opening < with a backslash to insert the less-than character literally.\n. I've fixed this in a slightly awful way in attached patch. (There are plans to do something more systematic with cursor positions around line breaks, but not sure when the time/funding for that will happen.)\n. @0b10011 Do you want to take a look?\n. A plain width property would, depending on the value we give it, either always make the dialog huge, or make it needlessly small for short hints. I don't like that solution very much either. Doesn't just setting max-width: none in your CSS provide a proper solution?\n. The replaceWith option implies the atomic option, i.e. when you use that the existing content is no longer in the view, and is represented by a single replacement node. CodeMirror does not know what that node represents. It sounds like you're replacing it with equivalent text, but there's no way for the library to know this, so it can only treat it as a single opaque element.\n. There's an allowAtxHeaderWithoutSpace option in the markdown mode to accept these, but it defaults to off, and that's also the behavior I'm seeing on http://codemirror.net/mode/markdown/ . Could it be that you're using an old version or have this explicitly enabled?\n. I'm no longer accepting new languages into the main distribution (and will start splitting off the existing language modes into separate modules in the near future). As such, I ask that you distribute and maintain this yourself, preferably under some easily-findable name like codemirror-mode-panda.\n. Eventually, yes, but for now I guess they are low-impact enough to merge a few more. Merged this as a3d9a31\n. The vim mode's replay functionality seems to work on the level of key presses. It won't replay things done by addons\n. It probably should, but at the moment it seems to replay only bindings that it handled itself.\n. Thanks for taking care of that! Merged as 54d0d82\n. Oh, indeed, I can confirm that.\n. That issue was addressed by 84dc2d0\n. I booted windows 7 and enabled Microsoft Japanese IME, and it's allowing me to type Japanese characters, but never pops up a suggestion list (neither in CodeMirror nor anywhere else). Is there something else I need to enable to get that behavior?\n. Oh, it was pressing space that triggered the menu. Unfortunately, on my system, both in Linux and Windows 7, the resulting widget is perfectly aligned with the bottom of the cursor. This might be related to your CSS -- could you see if it happens on the demo pages on http://codemirror.net on your system? If not, it would be helpful if you could set up a minimal demo page with your CSS in it that allows me to reproduce the issue.\n. On closer look at the screenshot, that is the project page, so I'll see if I can install windows 10 to see if it reproduces there.\n. Okay, on Windows 10 with Chrome 51 I could reproduce this. Attached patch works around the issue.\n. Um, I mean patch 51a1e7d, which I attached to the wrong issue.\n. Could you see if attached patch helps?\n. I messed up my fix (and somehow, it looked like it worked when I tried it). Attached patch should make it actually do what it was supposed to do.\n. Great, I'll close.\n. Theme's don't come with an image style, so removing the tag styling will cause these to show up unstyled for everybody who isn't adding custom styling. That's not a good idea -- please preserve the tag styling.\n. I'm okay with using the link tag, since there'll be additional classes to target for people who want to style these differently.\n. Looks great now! Merged as 34b3a7b\n. Thanks, merged as a0547b7\n. I am not sure what this is trying to do, but it doesn't seem like it's something I can work with.\n. As far as I can see, the underlining in CodeMirror matches the underlining you get when you type into a different control (though there, on Windows 7 with MS Japanese IME, it seems to a squiggly rather than thick underline). What CodeMirror does is underline the whole group that is currently being composed. I am not aware of IME systems using multiple underling styles or only underlining the last few characters in a composition group.\nAlso note that, since in non-contentEditable mode, CodeMirror can't show the native underlining and has to do it itself, and it only has the information provided by the browser's composition events, there's only so much it can do. If specific IME systems have more advanced underlining, we can't detect and mimic that.\n. (I figured out what the different underlines refer to -- they appear to indicate the group that is currently being selected. But browsers don't expose this information directly, so it's hard to act on -- see #4096)\n. This is a case much like #4095 -- CodeMirror is trying to show an interface similar to that the IME module might be showing, but it doesn't have enough information to do a very good job there. Switching to inputMode: \"contentEditable\" does help here, since that allows the user to see the native interface.\nIf having some indicator of where the current selection is is important, it seems that I could periodically read the cursor position from the textarea, and show CodeMirror's cursor at the matching position, during IME. However, this still does not tell the user what group is being worked with -- I had hoped that the current group would be selected, but the only thing that happens is that the cursor is put in front of it, and I don't think there's a workable way to find out how the composed text is split into groups.\n. (Note that the arrow keys do seem to work, you just don't get visual feedback on their effect.)\n. I think attached patch helps. Could you confirm?\n. Thanks for taking care of that! Merged as 84dc2d0\n. Patch 31eb1b2f0b3 should help\n. The page is mainly intended to show the addon though, and I think having an un-editable original makes it easier to understand how this is supposed to be used. I make one-off pages to reproduce bugs anyway, so I'm going to decline this one.\n. I don't have a device that does momentum scrolling, so I am probably not looking at the same input, but with scrollbar-dragging or low-speed wheel scrolling, I'm not able to reproduce the behavior you describe. Are there any errors being raised or other pieces of information that might help me narrow this down?\n. Nope, but maybe I am not understanding you correctly. Are you scrolling up by dragging the right editor's scrollbar?\n. Right. I'm using Chrome Linux as well, but neither my trackpad scrolling nor firing emulated wheel evens from software triggers the bug. When you say \"find the right speed/force\", are you talking about wheel rotation speed?\n. (I spent some more time trying to trigger this, and double-checking the relevant code, but didn't manage to reproduce or come up with any theory that might explain the behavior you're seeing.)\n. Can you provide a minimal demo that reproduces this?\n. I'm not taking mode feature requests (or even accepting new modes as contribution) -- but you could definitely set up your own repository with such a mode.\n. Did you notice the second argument to coordsChar? If you're passing the event's clientX and clientY here, you'll want to pass \"window\".\n. Your code example still isn't passing a second argument of \"window\" to coordsChar.\n. I think attached patch will help.\n. This seems to be pulling the mode/overlay addon in the direction of the mode/multiplex one.\nDo you, at a glance, know any compelling reason why the GFM mode shouldn't be implemented through hooks provided by the Markdown mode, the way the clike and sql dialects work? A lot of its complexity seems to come from overlays just beeing a rather bad fit for such an interwoven set of modes.\n. > Is it possible to extend modes defined in this way, though?\nThe idea is to provide configuration parameters and/or callbacks that allow all aspects of the language that might change between dialects to be customized. What this looks like will differ per language, and you'll probably not be able to (or want to) cover all possible dialects, but yes, the experiences with the clike, css, and sql modes has been that this is a reasonable way to do language variations -- it's definitely easier to extend than the current GFM mode.\n. There is nothing about the completion addon that prescribes (or even defaults to) using ctrl-space for completion. Providing a mobile-accessible way to trigger it is entirely up to user code.\n. The height of lines that aren't in the viewport yet is an estimate, not an accurate value. This is by design, and is needed to make lazy drawing possible.\n. You could set a viewportMargin: Infinity option, which will disable the optimizations gained by lazy drawing, but give you accurate heights.\n. That's definitely a downside. And there are other invasive effects from applying transforms. Since this is easy enough to enable with a custom CSS rule if you really want it, I think I'd prefer not to merge this.\n. Closing until further notice.. Thanks. Merged as 8019d7c\n. editor.getLine(n).length seems to cover this?\n. There no functionality like that exported at the moment. Once we get around to breaking up CodeMirror into modules, I'll make sure these utilities end up exported. If you need this really urgently, I could see if there's a clean way to export them already.\n. If you want the screen position to the right of the line, as opposed to the last character on the line, that's easier done with taking the y from the charCoords at its start, and the x from cm.getScrollerElement.getBoundingClientRect().right. Or do you really want the character?\n. Well, the thing I described will only get you the right side of the line's bounding box, which is quite a bit away from the last character in most situations. What kind of effect are you trying to achieve?\n(As for writing addons, the only available guidance is the code for the addons in the distribution.)\n. Ah, you're not using visual line in the same way that the codebase is. I guess you want to center above the selected part of the line, not the whole line?\nI'd do something like:\n- Get getCursor(\"from\") to know the low selection bound.\n- Get the coordinates of that position.\n- Call coordsChar with the y from those coordinates and an x at the right side of the editor to get the position at the end of the line.\n- Compare getCursor(\"to\") with that position to see if you want to use that one or if the cursor is before it.\n- Get the coordinates at the second position, and average the x of the two coordinates.\n. Yes, that's why you use coordsChar to get the actual end of the line (see the source for goLineRight). That'd give you the position after 'cillum', which is the one you want, if I understand things correctly.\n. \ud83c\udf89\n. Attached patch should help, but depending on how and when you create the panel, it might not trigger a merge view update, and the connectors might only adjust the next time you do anything. Could you test and see if it works for you?\n. I've pushed an alternative patch c5c1e92. The option isn't in the documentation yet, and might change or be dropped in the future, but for now it's there, and you can see how well it works (seems to work reasonably well, but the way the browser shows underlines in unpredictable and not really great, due to CodeMirror's re-rendering of content)\n. Looks like the dialog's DOM is preserved across reopenings. But this is definitely not a CodeMirror issue.\n. Either clean up the editor on close, or make sure you don't recreate it when it's already there.\n. Thanks. Merged as 43749f8\n. The htmlmixed mode intentionally does not include declarations for all the various non-standard script types people use. It is configurable, so the recommended way to get this to work is to just add the ones you need yourself.\n. In that case, if it's going to preserve indentation, block indent would be a no-op. I don't think having no-op commands adds much, and since a piece of Python code does not have a single canonical indentation, I'm not sure what kind of improvement you expect here.\n. You're free to propose one, but I am not aware of a better approach.\n. Duplicate of #3403\n. That was related to an upgrade (?) in the csslint.js script we hotlinked, which created exports and module globals (for some reason), breaking our module loaders. I've disabled that css linting demo for now.\n. Commit 6019b1308d4c51 does something similar. (Apologies for leaving this entirely ignored for so long. The mobile/IME stuff is subtle and scary and I am not often in the mood for working on it.). No.\n. You could start by actually describing what 'this issue' refers to.\n. Do you mean clicking the hint doesn't select it? That appears to work for me.\n. I did have a look at the gif, of course, but a gif is a terrible storyteller, so use words to communicate what your problem is. The select-on-hover behavior was reverted because it caused problems, and clicking to select works fine for me.\n. > I'm curious about how feasible the architecture of CodeMirror is with respect to replacing its \"frontend\" in this way.\nThat's not something CodeMirror is written for, and I consider it out of scope for this library.\n. That's not a JS object, that's a JS block. If you want to type JSON, set your mode to \"application/json\".\n. CodeMirror doesn't do type checking at its API boundaries, as that would incur too much code size and performance impact. So if you violate it's type expectations, you're getting undefined behavior, not custom-crafted error messages.\n. What are you planning to use this for? This is quite a bit of extra complexity, and you didn't even touch the runmode, tern, sublime, vim, and indent-fold addons yet, which all deal with countColumn or tabSize in some way. So I'm not sure I want to incur that complexity for something that's not typically used in code editing.\n. You might even be able to get something to work without modifying the core by using markText-based widgets for the tabs (though that's be somewhat more involved to manage, especially if you expect a large number of tab characters). But yeah, I'm sorry, but I'm going to decline merging this.\n. The current behavior is intentional.\n. Thank you. Merged as 6d1379e\n. Oh, sorry, I saw the bug report first and pushed another patch (6b30757) already.\n. I don't really understand the problem -- if I load your example in Chrome 50, the editor, not the page, gets a horizontal scrollbar. Could you expand a bit, and preferably also reduce the CSS and wrapping element structure in your demo the absolute minimum (right now the CSS is quite huge, too huge for me to read through).\n. Issue #4895 notes that this also happens for vertical (flex-direction: column) layout -- there the height of the editor gets ignored by Firefox and Safari. Does this still happen on the current master branch, and if so, can you submit the actual text that triggers it, rather than a screenshot?\n. The maintainers of this repository have nothing to do with the TinyMCE integration code. I suggest you ask whoever created the integration you're using.\n. This would be an issue in the mode code that you wrote, right? So I don't think you can blame CodeMirror for that.\n. You can open test/index.html#javascript_* in your browser to run only the JavaScript mode's tests.\n. The recommended way to have configurable/changeable modes is to pass their configuration as a mode option when creating the mode, and updating the mode option (or removing/adding in case of an overlay). That will cause the highlighting to be updated. refresh is not meant to do this, as modes are expected to be stable and always return the same result (and a full refresh is going to be overkill for this kind of changes anyway).\n. Thanks. Merged as 524d006\n. Thanks. Merged as 92b64d2\n. Thanks. Merged as e47ab5f \n. I agree, this is too specific to incorporate in the main distribution.\n. Thanks. Merged as e47ab5f92d...26d8c7109aa\n. closeCharacters is currently not derived from the mode, so we can't set this in xml-hint.js, and for now setting it manually is the only option.\n. I think you're running into this Firefox bug. Could you confirm that the problem starts occurring when the height crosses 17895698 pixels?\n. All right. Closing as 'Firefox's problem'\n. You really don't want to use textarea input style on touch screens. It'll break user selections almost entirely.\nThese reports aren't very specific, but we're aware that there are some issues with IME handling (which is how Android virtual keyboards enter text), see the IME tag. If you have a more specific problem that can be reproduced with plain CodeMirror, and isn't already reported, please describe it in a new issue.\n. Would qualifying the styles added by cm-matchhighlight to only be active inside a CodeMirror-focused container address this?\n. Then I am unclear what your definition of there being a cursor is. Could you elaborate? (I don't have any of the named IDEs installed.)\n. Does making the match-highlighting addon not update its highlighting until the first time the selection changes while the editor is focused sound like a better solution?\n. Please try with attached patch\n. Fixed via #4164\n. Good idea. Merged as 5738f9b\n. Tag closing uses the XML mode's state to determine which tag is currently open. You'll have to configure your XML or HTML mode to include the tags that are self-closing in its 'autoSelfClosersoption.\n. What kind of language are you editing, and which mode are you using for that?\n. In normal XML, all tags must be closed. In HTML, there's a list of exceptions thatdontCloseTags` defaults to when the mode is HTML. I don't think this issue has come up before because when people extend XML, they are usually clever enough to not introduce additional strangeness. I guess ColdFusion is an exception.\nYou'll get ugly highlighting in the XML/HTML mode (false-positive unclosed tag errors) already if you don't tell it that this tag doesn't need to be closed. So you should do something like mode: {name: \"xml\", autoSelfClosers: {\"cfset\": true}}, except that, if this is embedded in HTML, you should also include the whole default HTML list (from near the top of mode/xml/xml.js) in the autoSelfClosers object.\n. I don't know anything about brackets. That was an option to CodeMirror to specify the mode.\n. @ForbesLindesay Do you agree? Are you still using the mode and will anything break on your side if I do this rename?\n. Since modes are typically imported by filename, stuff is still likely to break when people try to import mode/jade/jade.js. But yes, I can add an alias in mode/meta.js for those who rely on that.\n. You're calling fromTextarea with null as first argument.\n. Not really, no.\n. Hi. I'm not currently accepting new modes. The recommended way to distribute a new mode is by putting it into a separate repository, and distributing it through npm under a name like codemirror-gap-mode.\n. I'm not tracking these, at the moment, but we could add a list of externally maintained modes on the wiki, and link to that from mode/index.html in the repository/website. Does that sound workable?\n. That'd be useful (but make sure to fall back to for/in when getOwnPropertyNames isn't available)\n. Fixed via #4175\n. What's wrong with it? If you want async to show up as a keyword there, that'd require look-ahead, which I think is more trouble than this small adjustment is worth.\n. I'm not really interested in implementing that. The same behavior exists for get and set.\n. Contributed code rarely bothers to update the docs, unfortunately. Fixed in bd1a7b6\n. Thanks! Merged as 1c884ebabf6 and simplified in 5fea9c5737eaa\n. I've made Python 3 the default version for the Python mode in 4f70169\n. You want ctrl-[. Shift-tab auto-indents the selection.\n. Maybe try the manual\n. You're right. Attached patch should help.\n. Ah, right, that's a subtle TypeScript incompatibility -- it parses the extends clause as a type, rather than an expression. Attached patch should help.\n. No, that line doesn't need fixing. Your code needs to pass in an actual textarea rather than null when calling fromTextArea.\n. I think the current search addon is kind of at the limit of its complexity budget. What I mean is that a good search interface is a rather huge, open-ended problem, and I'm already stretched too thin to really want to take on maintenance of any more complexity for this addon. I think the best way forward would be a fork of the search addon (or a rewrite, given what a mess it already is), maintained as a separate package, by someone else.\n. No. If you want to refactor the addon so that you can reuse part of it in your extending addon, so that there'd be less duplicate code, I might be interested. But that might be more trouble than a full fork.\n. Thanks. Merged as c45674b\n. No, you'd have to write your own code for that. CodeMirror is built to be a plain text editor.\n. Seems to be working. Are you doing anything special when using it?\n. Indeed, when you select a lot of files the thing seems to get much slower and hits nginx's timeout. The compression helper is going to go away soon (almost everyone is using some kind of build step in their project anyway, and I don't feel like keeping the service running), but in the meantime, I've upped the timeout, so that the error you describe should be harder to hit.\n. Nice! Hold on, I'll create a patch that adds a few TypeScript tests, so that you can add your own by following it as an example.\n. Attached patch (e387d21) adds two TypeScript tests. The format for these mode testing functions is that you pass a name and then the body to be highlighted as a series of strings, one per line. Inside the strings the bracket notation is used to denote the highlighting. A plain string means unhighlighted content, [type content] means \"content\" tagged with token type \"type\"\n. You could try wrapping your editor instances inside web components. That should remove the problems caused by agressive, unscoped CSS in reveal.js.\nBut in general, I'm not taking responsibility for issues like this, produced by outside CSS. You'll just have to find the relevant properties and reset them in your own CSS.\n. Thanks for noticing that. Attached patch should help.\n. Leaking is such a dirty word. This was my way of returning multiple values without allocation. In ProseMirror, I've settled on a pattern for these cases where I statically allocate a single object, and then reuse that (assigning to it and then returning) for all returns for a given function. That looks better, and still doesn't allocate. It does require you to immediately destruct the result to make sure it's not overwritten by a subsequent call. Would this pattern be palatable to you, or do you prefer to just allocate something?\n. Sorry, I pushed f0cb87d myself when I read the issue.\n. Indeed, probably a CSS conflict. I couldn't figure out why or how though.\n. That is very strange. Unfortunately, I can't directly test it, not having an Apple machine to run an emulator on, and not having a keyboard for my iPad.\nOne thing that might be happening is that the display update somehow ends up messing with Safari's selection in a problematic way. But I don't really see why that would happen.\n. Could you see if attached patch helps at all here?. Thanks. Merged as e865bde\n. QtWebkit isn't a browser we're supporting. It might be that it doesn't fire paste events at all. You'll have to debug this yourself.\n. My Chrome 52 matches as Webkit 537, so this also applies to recent versions of Chrome (which don't suffer from issue #237), and breaks the fix for #4097 there. I don't think that's acceptable.\n(Also, if someone's userAgent string happens to contain Webkit/ without a number following it for some reason, this'll crash the library on startup.)\n. Don't mix the jshint options with the options to the lint addon. Instead, put them in an options property in the outer options object, and only those will be passed to jshint.\n. Yes, that's to preserve backwards-compatible behavior. Add an options property to work around it.\n. No, I'm not interested in adding extra complexity to addons like lint, because it'd be hard to know where to stop. I prefer for someone to maintain a more powerful lint addon separately, so that the maintenance burden doesn't end up falling on me.\n. I prefer not to use default exports (as they tend to drag one towards a single-export-only style which leads to awkward nonsense).\nWhich is of course the exact kind of awkward nonsense that CodeMirror's export structure is currently based on (everything hangs off a single global). I want to remain 100% compatible at least in the first release that includes this (so that we don't try to refactor and change APIs at the same time), but I think we can have the old interface as a 'bundling' module that just pulls all the various pieces out of other modules and puts them together into the old interface. I guess we'll eventually want to move to a more ES6-y interface. (Though even then we might want to keep the old behavior as a deprecated interface for a while, depending on how breaking we want the next major to be.)\n. That module size sounds good.\nWhich browser are those tests failing on? On master, I have one RTL test failing on Chrome 50, and everything passing on Firefox 46.\n. Scary how big this system really is, when you scroll over all of it like this. I've added a few comments, I hope they make sense. I did succumb to code-reading-fatigue towards the end, but we can always adjust more stuff after merging this (I'll do another pass then).\n. I like squashed commits, for things that fix/modify patches that haven't been landed yet.\n. I would prefer more emphasis on 'theme', and less on dependency order, in the organization. The code is, unfortunately, not written with a clean dependency graph in mind, and I don't think we have the time budget to do much about that right now. So for now I'd prefer for things to be easily findable by thinking about what they are related to, without constraining ourselves too much by what depends on them and what they depend on.\nSo something like util should really only have generic utilities, the line stuff can probably go under model -- i.e. don't let the fact that measurement uses those data structures prevent you from doing that -- and I think a directory input with all the event handling stuff would be a good addition. Does that make sense?\n. Did you address the stuff we discussed last week? (I'm not really re-reading the changeset every day, so I don't keep up with what happens unless you add a comment.) I'll work on landing this on Monday!\n. Landed! (As is)\n. I wrote a little announcement post here\n. Which code triggers this?\n. That doesn't cause any problem on http://codemirror.net/mode/php/ . Could it be that you're using an old version?\n. So did you paste this into http://codemirror.net/mode/php/ ? Because I just did and there is no error.\n. That doesn't help reproduce this, though. What would help is a small, minimal HTML demo that triggers the issue.\n. That still contains a lot of unnecessary complexity, and isn't something I can easily run locally to debug.\n. Could you show the code you pasted that triggers the problem?. Thanks for looking into this. I've pushed an alternative patch 607d0e8 \n. Doing editor.lineSeparator = ... is not the way to set the editor's line separator. Use setOption.\n. I can not reproduce this with Chrome 52 on Linux. Are you clicking anywhere specific when focusing and unfocusing, or doing something else that might be relevant?\n. Thanks. Merged as 2f814b2\n. You don't even have to use the capture phase -- key events are propagated out of CodeMirror, so you can just handle them with your own code.\n. That's true. And it's also not a goal for it to be valid like that.\n. In this case they do.\n. Have you tried the cursorScrollMargin option?\nIn any case, this is a support request, not an issue, so this isn't the right place for it.\n. We have https://discuss.codemirror.net for that\n. Fixed via #4215\n. Looks great. Merged as e59d75a\n. Why are you only looking at changes[0]? Could it be that the change you're looking for is at another array position in changes?\n. Can you produce a self-contained piece of code that demonstrates the problem?\n. @taslterminal Thanks for spotting that! Patch 4c3d3c79 should help. The autoclosebrackets will only close quotes that get the token type string. So it's not necessary to create a string state, but you do have to make sure that unclosed quotes get a string style (you could make your regexp go to the next quote or the end of the line, which leaves them relatively simple still).\n. I've pushed an alternative patch 45cf0ae\n. Could you look into the test failure?\n. Thanks. Merged as 62dd0f0\n. This appears to be related to the Gerrit integration, which I'm not responsible for.\n. Thanks. Merged as 15dbafc\n. Markers aren't really ordered/layered in CodeMirror's model, and since a DOM element can have only one title, any tie-breaking solution seems acceptable. So I'm going to call this the intended behavior.\n. This is a highlighter, not a validating parser. You can submit a patch that does this if you want (make sure to handle all valid forms of numeric entities), but in the meantime I don't consider this a bug.\n. This sounds more like a Chrome bug than a CodeMirror bug. Were you able to get a stack trace in the dev tools when this happens?\n. Does the problem occur in the full screen demo? Can you describe it a little more precisely than 'spoils UI'?\n. If other components need to be involved to trigger the problem, it's up to you to either reduce this bug to a more primitive situation (or to arrange things in your app to avoid the issue). I'm not willing to debug jQuery dialogs.\n. I'm not accepting new modes in the main distribution anymore. The recommended approach is to create your own repository and npm package to distribute your mode.\n. Indeed, auto loading of modes isn't going to work anymore when modes aren't kept in a centralized place. Though you could of course set up your build script to copy your mode to the right directory.\n. I'm not really interested in going down the path of writing a parallel module loading system now that people tend to be using real module loaders in the browser. So the dynamic mode loader probably doesn't have much of a future, and is likely to be dropped in the next major release.\n. Which browser, and which font? I can't reproduce this on the demo pages in Chrome 52\n. It seems to only happen on Chrome, inside extremely long text nodes (i.e. lines without highlighting, or with a single style throughout). So the ultimately responsible party here is Chrome for returning inaccurate client rects for text in such long text nodes.\nThere was already a ceiling on the size of a token, to work around another Webkit issue where it would just fail to render text nodes longer than 57444 chars. Attached patch lowers that to 5000, which seems to resolve this issue.\n. This is a bug tracker, not a support forum. So I'm closing this, but you can start by looking at setBookmark and its widget option.\n. This is almost certainly a misunderstanding of the way HTML parsers read <textarea> tags, and not something CodeMirror related.\n. Don't use the DOM for this. Add a class with markText when the cursor enters such a link. Directly manipulating DOM nodes owned by CodeMirror isn't supported and will cause all kinds of problems.\n. I don't want to incur more UI complexity in the core library. In fact, I'm thinking about moving stuff like the search functionality out of the distribution entirely, since I'm not really interested in maintaining them. As such, I'm not interested in growing them further, and recommend you set up a fork with your changes.\n. Please open a pull request that is based on the current code. Your patch restores a bug that was fixed since you first submitted this code.\n. No, this does not happen in the demos. It only happens when you explicitly make it happen, as in this demo.\n. What additional information does the event provide?\n. Makes sense. Merged as 3d89b71\n. CodeMirror doesn't format code anymore. I don't remember how the old addon that did worked, and I don't support it anymore.\n. Do you want to implement the behavior you describe?\n. Yes, it sounds valid (when the inserted content exactly matches the text after the cursor -- when not, I think it should just do the dumb thing it does now)\n. Still restores the previously fixed bug.\n. Thanks. Merged as 02d4ab4 \n. Hi Thomas. We're not accepting new modes for the main CodeMirror distribution. The recommended way to distribute a mode is to set up your own package, call it something like codemirror-mode-igor, and publish it to NPM.\n. This isn't the place for support requests. Try the forum for that. \nThat being said, the vim demo is pretty clear:\n\nThe vim keybindings are enabled by including keymap/vim.js and setting the keyMap option to vim.\n. What triggers it? Can you give me a minimal HTML page that reproduces the issue?\n. I'm not seeing anything useful at the URL you linked anymore. If you narrow this down to a specific piece of external CSS, feel free to comment, and I'll investigate further. For now, I'm closing the issue.\n. Is the fact that you appear to be pressing Ctrl after starting the drag intentional? This works fine for me on Firefox and Chrome when Ctrl is pressed when the drag starts.\n. So drop events don't tell us anything about what keys were pressed when they occur. There is a DataTransfer.dropEffect property that probably, on browsers that support it, can be used as a better indication of what to do, but I haven't investigated how it works, how reliable it is, and which browsers support it yet. A patch that makes use of this feature when appropriate (without breaking old browsers) would definitely be welcome.\n. Thanks. Merged as 562e8ef\n. @sawo Does it happen in the demos on codemirror.net? I can't reproduce this.\n. I am not, but if you describe the bug as a backspace character ending up in the document, it does sound like CodeMirror's keypress handler is running.\n. cc @adrianheine Looks like some import might have gotten crossed?\n. Since Selection is also a built-in global in the browser, our linter didn't catch that missing import.\n. Nice! Merged as ac205e6. I released a new version of blint and that accepts the code fine.\n. Oh, I didn't realize you hadn't turned that on yet. Merged as 2182dfd79e92d and made passing in 5bb6a94ea4ed9 (as I mentioned in marijnh/blint#2 , I think it's preferable to put semicolons on such lines).\n. So when I merge this the resulting codemirror.js fails on parsing in Chrome with\n\ncodemirror.js:4674 Uncaught SyntaxError: for-in loop variable declaration may not have an initializer.\nWhich appears to be a bug in Bubl\u00e9 that I myself introduced. I'll look into it.\n. There's already a Bubl\u00e9 patch at https://gitlab.com/Rich-Harris/buble/merge_requests/85/diffs . Until that gets merged and released, I've changed that single let back to var in 6992c53, and merged this.\n. This is a bug tracker. The place for questions is the forum. As for your question, I'm not sure why setValue wouldn't work for an entire file.\n. CodeMirror's default search addon has a persistent search feature which is more like the browser's default search box. What Github decided to bind to Ctrl-F is not something I can control.\n. Pass a localVars option to your JavaScript mode config, and I think you get what you're asking for here.\n(edit: got the option name wrong the first time)\n. Set your mode option to {name: \"javascript\", localVars: true}\n. Yes, it would. CodeMirror modes work start-to-end, so there's no way to look ahead.\n. @pabloferz or @malmaud, want to take a look at this?\n. @pabloferz or @malmaud, want to take a look at this?\n. Thanks. Merged as 581854e\n. Hi @kofifus, we're aiming for a plain, widely understood code style here. Also, your approach (which looks a lot like the thing Crockford has been advocating) will allocate a lot of unneccesary function objects and throw off the compiler's inlining behavior.\n. Merged as 9ad40ee76ff\n(Feel free to merge in uncontroversial stuff yourself, by the way.)\n. Merged as 96cd888!\n. (Also in Chrome 52.)\n. specialChars should match a single character. I'm not sure what you are aiming for, but replacing a whole sentence with a red dot doesn't seem like useful behavior, so specialChars is probably not what you're looking for.\n. You'd use an overlay or a custom mode for that.\n. Nope, sorry, I am not being paid enough to act as a help desk.\n. The default command bound to enter, newlineAndIndent, will reindent the newly created line. If that's not what you want, bind enter to something else.\n. Merged as 850671f (which also changes the other occurrence of the string)\n. Thanks. Merged as 2701827\n. > They are sorted by Range again anyway.\nWhat do you mean by that? The Range constructor just assigns its arguments to head and anchor.\n. Maybe make this only do anything for empty selection ranges? Whenever we do anything with a non-empty one, the difference between head and anchor should be significant. The head is the acting side, and if this is to work on non-empty selections, I think using head is entirely sensible.\n. Sublime Text's transpose doesn't do anything for non-empty selections either. So let's go with that. Do you want to amend your patch?\n. Wonderful. Merged as 6b3b6a6\n. Thanks. Merged as a194325\n. I guess the dark themes should definitely either provide their own unfocused selection color or apply their color regardless of focus, because the default color will look awful. For light ones, I don't care all that much.\n. Nope. You'll have to code that up yourself.\n. Improvements to the way the modes categorize things are welcome (such as making PHP properties actually use the property style). But langauges are different, and as such, there's no single consistent way to tokenize them. The PHP mode uses variable for function names, and I don't think it's necessarily a bad idea to give $-prefixed variables a different style. The JS mode understands the difference between local and global variables, and uses variable-2 for that. This is, I think, okay.\n. Confirmed. But since this style has been obsolete for over 20 years, I don't consider it a big problem. If you do, you can try submitting a patch that improves this.\n. Multiple modes wrapped in an overlay count as a single mode as far as the editor is concerned, so yes, you can't have one of your overlaid modes have a different behavior wrt this option than the rest.\n. markText ranges are never flattened, so I'm not sure what you mean by that.\n. Marked classes are added per token, so yes, if you get different tokens, your dom structure will be different.\n. Yes (if you consumed any characters)\n. Which mode are you using?\n. This appears to be about the kind of line classed added for the changed chunks. So I don't think 'merge marker location' is a very good name. What exactly are you using it for?\n. Thanks. I've merged this as 1502f805a86 and updated it in 9a316b33d724.\n. Does this also happen if you paste in text from elsewhere (say, copied in your native text editor)?\n. I could reproduce the latter problem (pasting from native content) but not the issue with pasting between CodeMirror instances. Attached patch makes it so that pasted content always has its line endings adjusted to the current editor's convention, which seems the preferable behavior. Does it solve your issue?\n. I'm not interested in this. See my comment on the forum\n. Key events aren't fired for scrolling, so I'm not sure how this would help. Doing less heavy computations in your key handlers, or splitting the work up in smaller slices using setTimeout, seems like a more promising approach.\n. An infinite loop is always going to break your page. That's how JavaScript works -- non-web-worker scripts are run on a single thread and block the page.\n. I guess if you don't register an active scroll listener you can still scroll a stuck page. (I'm not sure why, since scroll events only fire after the actual scrolling happens anyway). But CodeMirror needs a scroll listener, so that's just not going to work with CodeMirror. (And your user experience will still be terrible if your script is working for long periods of time, even if scrolling continues to work.)\n. > Anyway, why does CodeMirror need a scroll listener?\nTo keep its viewport in sync with the scroll position, and to keep the gutter in place.\n\nIs there a hack to disable this scroll listener?\n\nNo.\n. Thanks. Merged as 32d02f0\n. I initially tried fixing it like this, but figured it wasn't quite optimal for typing (different) quotes within a string, so I ended up with edd8e6180a520\n. Thanks. Merged as 7484049\n. We're not taking feature requests for modes (and are, in fact, moving to have less modes in the main distribution and more of them maintained externally)\n. Thank you. Merged as 8d737b2\n. Thank you. Merged as 6954ddd\n. Thank you. Merged as 437f384\n. Looks good. Merged as 9903967\n. Thanks. Merged as 358086a\n. Merged as 147389d\n. Merged as 230f7d0\n. Thank you. Merged as 1523a8b\n. This should be fixed by 5012e8772\n. Debugging mobile composition behavior is annoying and time-consuming. I did at one point have things working with google keyboard, but I guess it changed again. There are plans to improve composition handling, but it might be a while until someone finds the time to work on that.\n. Could you see if patches 5012e87723716, da8a35d05e72, and 441641e6cb75e help?\n. Actually, though things are somewhat better now, backspacing across line boundaries still sometimes causes weird problems.\n. Attached patch improves things a little more, but there's still various problems. The fact that Chrome Android doesn't fire a useful key event for backspace anymore is really quite problematic.\n. Yeah, I've seen that happen too. And press-and-holding backspace occasionally does really weird things. And writing multiple spaces in a row will put the cursor in the wrong place. I'll see if I can allocate more time for this before the next release.\n. The zero-width space issue should be solved by patch 692393d. The others will have to wait.. The newlines vanishing issue should be fixed by cfcad600a6b27\nI can't reproduce words disappearing when pressing enter\nBackspace on line boundaries indeed seems to be broken when there is a gutter (opened #4637 for that)\nPlease open separate, single issues for remaining problems. Piling things up in a single issue report like this makes it hard to keep track of problems.. I've pushed an alternative patch that allows this without introducing an extra option -- set tooltips to \"gutter\" to show tooltips only on the gutter.\n. Thanks. Merged as 09594e2\n. This broke due to patch 8a48219a5ec for #3558, a year ago. Let me see if I can find a workaround.\n. The markdown mode doesn't highlight URLs, so I guess you're using the GFM mode. That is currently implemented as an overlay over the Markdown mode, which means it can't influence the tokenizing the Markdown mode produces. This is the cause of a bunch of problems, but it's not something that can be addressed without rewriting the whole GFM mode. Since this is contributed code, I don't really have any plans to do so myself on the short term.\n. I see. But then is there any reason to expect this underscore not to start an emphasis span? The CommonMark spec suggests treating punctuation (/ in this case) the same as whitespace.\n. Does adding a gutter line class (say 'highlighted') and styling gutter elements under that class with a background (say .highlighted .CodeMirror-gutter-elt { background: red }) work?\n. Sure, but is there anything about my suggestion that is at odds with that?\n. In recent versions (not released yet) the styling of gutter backgrounds with addLineClass(line, \"gutter\", \"something\") was broken. Attached patch fixes it, though I'm not sure you were using that code. It was (and is again now) possible to simply add a class with a background color as \"gutter\" line class, and color the gutter like that. Scrolling horizontally works for me. When you add a line widget to that line, the color of the gutter will stretch along the widget, since it is part of this line. Is that the problem you mentioned?\n. This is an optimization -- drawing the highlighting and connectors for a huge document is expensive, so the addon does it lazily, for the current viewport. I can add an option to turn this off, if you want, but I'm not responsible for any slowdown that might cause.\n. Syntax highlighting also happens lazily. It's just well enough integrated with the drawing code that you (usually) don't notice. (In general, there's no DOM created for stuff outside of the viewport.)\n. This'd be a bit of a pain to implement, and it's not terribly problematic (scroll to the top of the chunk to revert it), so I don't agree with your 'should'. A pull request (if clean) would be welcome, though.\n. I guess this would be nice, but this isn't something that is easy to do with CodeMirror.\n. Doesn't the styling on the changed chunks make it rather easy to spot changes? If you want to submit a PR for this, sure, but I don't consider this a big enough problem to work on it myself.\n. Nope, the default behavior isn't going to change. It's easy enough to change these bindings if you want.\n. Thanks. Merged as 0733ad5\n. Merged as 6fde117 \n. Looks good. Merged as 82ab0b4\n. Rollup is great, but I've been holding off on adding jsnext:main fields to my libraries until something more well-defined and widely agreed on comes along.\n. Thanks. Merged as bda9879\n. Looks great. Merged as 658f9a0727\n. @dbarnett Want to take a look at this?\n. Good point. I had searched for such things but apparently messed up the regexp. Attached patch should fix this in a more intelligent way (without screwing up the autocompletion wordlist).\n. Not on my end. If Tern's functionality can be expressed in the vocabulary of that protocol, I'd be neat if someone writes a wrapper, but I'm not going to be the one to do that.\n. Ah, I see, that would also be possible, I guess, but you'd probably want to write a completely new plugin for it.\n. No. I am not accepting new plugins into the main distribution, so it'd have to be done as a separate project.\n. No, it isn't. Insofar as you can talk to an LSP server at all from the browser, it'd be nice if someone worked on this, but the core library is probably not the place to do that --- this is why plugins exist.. That's because bower's approach of installing directly from github is fundamentally unsuited for most modern JS projects. If someone wants to set up a workaround (outside of this repo), that'd be nice. If not, I'll just get rid of bower.json as well.\n. As in doing a major version bump? Despite accepting bower.json, we never committed to supporting Bower, so I don't think this is worth bumping to 6.0.\n. Yes, that's what the release announcement said. This is by design. If your problem is with bower, I suggest you set up some bower-based mirror, or move to a more 2016-proof package manager.\n. I'm not going to go out of my way to support bower. I'm not sure what the usual solution is for using bower with a project that has a build step, but I suggest you look into that and set something up outside of this repository.\n. So it seems a lot of people have a hardcoded link to this repository in their bower files. On the one hand, I sympathize, since having your build break is no fun. On the other hand, this here is a source repository, not a package distribution mechanism, and I don't feel responsible for the fact that Bower confuses the two.\nAs a stopgap solution, you can lock your version to 5.19.0.\nThe real solution is probably for someone to set up a mirror that includes the build artifacts in the repository, and for bower uses to link to that. This can be automated, and shouldn't be hard.\n(Or stop using bower. Long-term, you really want to do that.)\n. > It is really that hard to put back that js file?\nNo, it isn't. But that would mean continuing to keep it in there, which I don't want to do -- a repository is for actual sources, not build artifacts. \n. > We just have to type bower install --save codemirror to get it.\nThat's good to hear. But I assume bower does implement some kind of package ownership. I'm not the one who's published codemirror there, so I doubt I am able to change what it points to.\n. I've set up a kludge to make this problem less severe -- a fork of CodeMirror without the last release tag here, and a change to the Bower registry pointing the name 'codemirror' at that repo (which I apparently was allowed to, even though I didn't initially publish it there).\nThis means that installs that refer to codemirror by name should work again, but will get 5.19.0, and will continue to do so until someone takes responsibility for maintaining a bower-installable mirror. (I will help update the bower repository to point at this, once it exists.)\n. (Going to leave this open for a while in the hope that people will stop creating new issues for the same problem.)\n. What change would you suggest? Nowhere does the manual suggest you clone a git repository to install the library.\n. > Sorry but in the docs you write that you have to use the files in the lib/ folder, but since now you removed the javascript file this no longer apply.\nIt absolutely still applies. You just have to do so in a properly built version of the code. I.e. download the zip from the website, install with npm, or run the build process yourself.\n. > Please remove .gitignore from the properly built version\nDone (from the zip)\n. @minrk That's perfect! I've updated the bower registry. Thank you for taking responsibility on this.. Yes, that repository is gone, since @mrink opened a new one that's actually being maintained. I updated the bower registry to point at that repository. From the output you pasted, it looks like bower is dumb about caching and blindly tries to validate against the outdated link, and crashes when that fails. Maybe bower cache clean helps.. @minrk The components/codemirror repo doesn't seem to be updating (it's missing 5.22). Also, it'd be nice if it could restore the old bower.json file.. @minrk Thanks! Any chance this could be automated?. See #4328 \n. See the release announcement and #4328 \n. Bower is broken with packages that have a build step. See #4328 \n. This is #4328 \n. There was a typo in the README, the correct command to build is npm run build. Attached patch corrects this.\nAs for the bower issues, see #4328 \n. See #4328 \n. That was a mistake in the release script. I've released a 5.20.2 with a correct version number.\n. > http://codemirror.net/codemirror.zip\nThis one's fixed. The file from github is a zip of the repository, so it indeed won't have the built file.\n. Thanks for the patch! Merged as 63bf659\n. CodeMirror operations already have this property -- if you create an operation (in any editor) and then, within that operation, touch any number of other editors, their updates will all be batched together when the outer operation ends.\n. I don't understand the deep call stack problem, could you elaborate?\n. No, operations are created implicitly for any method call that requires them, so you only need one wrapping operation call, and anything you do inside of that, to any number of instances, will be grouped.\n. You're suggesting that we remove the (single) occurrence of this from mode/css/css.js, or is there anything more to it?\n. See #4328\n. Argh, that was a dumb mistake. Thanks for fixing it. Merged as db12d64\n. I don't think adding a lock file to a library is a good idea. In which case would this be useful? The end apps will want to lock down their dependencies. Libraries should leave them flexible in order to make it less likely that multiple versions of a dependency have to be installed.\n. If I paste your example into http://codemirror.net/mode/ruby/ , select all, and press shift-tab, it indents correctly.\n. I've pushed some patches that seem to improve this. Could you do another test with the current master branch?\n. @0b10011 @dwikle @ratchup Want to review this (or at least take a look whether it breaks anything obvious)?\n. > Direct update of parent internal state (stream.pos). (Impact:\n\nmaintainability of StringStream \"class\". Regression test desirable?)\n\nIt is probably possible to avoid this kludge by passing false as second argument to stream.match. I'd prefer that approach.\n. Great. Apart from the fact that you didn't balance your parentheses, it looks good now. Merged (with balanced parens) as d34e947\n. If you disable the change handler, won't the merge addon be completely broken?\n. You want cm.setOption(\"gutters\", cm.getOption(\"gutters\").concat(\"myGutter\"))\n. Patch d7b1370ca45d seems to solve this.\n. Thanks. Merged as 0164f02\n. Apologies. My fix broke the code in a new way. The new patch I attached should solve that.\n. Thanks! Merged as 2eb94e5\n. Indeed, you can add this as optional behavior to continuelist if you want, and submit a pull request, but I'm not taking feature requests, so I'm closing this issue.\n. @malmaud or @pabloferz,  want to take a look at this?\n. Looks like it!\n. Thanks. Merged as c4d9363\n. Thanks for spotting that. Merged.\n. Nope, that wasn't an error. It's computing a position relative to the top of a wrapping rectangle.\n. The runmode addon.\n. > const codeMirror = require('../../../common/codemirror/lib/merge.js');\nThat's not how the merge view works. It extends the existing CodeMirror module, so you'll want to save the result of requiring codemirror.js.\n. The mode doesn't tokenize strings in preprocessor directives, since it's not clear how those are going to be used. I think this minor quirk isn't enough of a reason to start trying to do that.\n. Could you see whether attached patches help?\n. Thanks. Merged as 2466392\n. That's not something CodeMirror supports. Line classes are not stored in its history.\n. Thanks. Merged.\n. Which Chrome version are you using? 54 on Linux doesn't show the problem.\n. Still no luck reproducing this with Chrome 54 Mac (when I scroll right, with the touchpad or with the scrollbar, I can reach exactly a few pixels beyond the end of the longest lines).\n. addWidget should definitely stay in the CodeMirror class, since it directly manipulates the DOM. The others, I think you're right, and I'd accept a PR that moves them and updates the docs.\n. Done in #4372\n. This isn't a problem CodeMirror is going to solve for you. You can get the raw text out, what you do with that is up to you.\n. Does calling getInputField() and setting attributes on the resulting DOM element help?\n. Thank you! Merged as 0e54532\n. Hi. I don't quite understand your question, but it looks like a request for help, rather than a bug report. This isn't the place for that. Maybe try stackoverflow.com\n. Thanks. Merged as 4a1ed9134137 and fixed in 18c1bcb556bd1e (next time, make sure to actually run the tests before submitting a PR)\n. Were you able to make this actually work on any browser? Neither Chrome nor Firefox seems to allow page scripts to handle ctrl-t.\n. Ah, that makes sense. That's not necessarily a problem -- having this work on Mac is better than not having it work at all. I'll try to test on OS X soon.\n. Merged as 333a1f2. CodeMirror doesn't reload the page it's in, so the problem is most likely elsewhere.\n. >  However, when converting to the absolute index, these change positions are clipped to the post-change coordinate system, which can give the wrong result.\nYes, changing to indices uses the current document, which will be the wrong document for the old position. This isn't something CodeMirror can help -- you need the proper document to be able to map from a position to an index.\n. What is strange about these class names? They look like everything is working fine.\n. @pabloferz Could you take a look?\n. Solved via #4383 \n. This is a request for help. Stackoverflow is the right place for that, this issue tracker isn't.\n. Thanks! Merged as e6eebeb\n. CodeMirror never plays any sounds, nor does it do anything for ctrl-cmd-down, so I think this is a default behavior of your platform.\n. Thanks. Merged.\n. When using actual valid code (i.e. with expressions in the if and while conditions, and a valid for form) you'll see much better results.\n. Do npm install, not npm run install.\n. Works for me. Though note that the error has absolutely nothing to do with you visiting demo/lint.html, and I am wondering why you described it that way. That looks like output from npm test.\nWhich node/npm version are you on?\n. npm test runs the test suite, it doesn't start a server you can use from your browser. To view test pages, just open them using the file: protocol.\n. Thank you. Merged as 90819c5 \n. Thank you. Merged as 532ae31\n. Thanks. Merged as beb8382\n. Thanks! Merged as 69669e4.\n\n// IE < 10 will throw when accessed while the page is loading or in an iframe.\n // IE > 9 and Edge will throw when accessed in an iframe if document.body is unavailable.\n\nCould it be that these are actually the same case? It was observed 'during loading' before, but most likely that was just because no body was available.\n. No, that's not how CodeMirror selections work (not is it how native selections work). The direction you drag in to create the original selection determines which side of the selection is the head, and which is the anchor. The anchor is the point where you started dragging. When you then resize the selection, the head moves, and the anchor stays in place.\n. Oh, you're right. That's interesting. But CodeMirror is following the head-anchor model.\n. CommonMark also allows this, so it should be handled in the markdown mode. See attached patch.. Get the package from NPM. We don't distribute minified files, you'll have to do that yourself.. In the future, don't put requests for help on our issue tracker. That's not what it's for.. Look, unless we know what the problem is, we can't give you a solution. And using setOption like that definitely works, if the mode you're enabling is loaded, so double-check that it is, and if that fails, read the manual more carefully.. You need to load addon/mode/simple.js. Thanks. Merged as d0cde7f8470d66. Thanks! I originally got these from pdf.js project, and never looked at them very closely.. Merged. Now that we have a build system, relying on NPM modules would be workable, so a shared module could work.. Thanks. Merged as 0d29663. Thanks! Merged as https://github.com/codemirror/CodeMirror/commit/2bed274eb4287624cdc5c07762a32c4042e3b3dc. If I go to http://codemirror.net with Mobile Safari, the highlighting in the demo works just fine. Where are you testing, and do you get any JavaScript errors?. It seems the wrong browser specific workarounds were being enabled and/or not enabled because Edge's userAgent string is, well, apparently specifically crafted to confuse people, even more so than traditional userAgent strings. Attached patch works around this, and seems to fix the problems with the context menu.. This repository is not a bower distro. You want https://github.com/components/codemirror (though that currently doesn't seem to have a bower.json either).. If I run bower info codemirror, it shows me the /components/ repository. Where are you looking?. Yes. I removed it, since at that point bower-installing codemirror from the git repo stopped working anyway.. This appears to be a bug in the diff_match_patch library. It goes away if I avoid calling the diff_cleanupSemantic, which I mostly did because it sounded like the right thing, so attached patch drops that call.. Probably. That project seems quite dead now, but unfortunately it's still much faster than any alternatives I could find, so switching isn't easy.. Did you enable lineWrapping in the editor, or could it be that you have a CSS style that's overriding CodeMirror's own white-space rule?. You're expected to call .refresh() after un-hiding the editor (unless you can be sure that it was in a fully coherent state before it was hidden, and its size hasn't changed).. Ah, I see what you mean. Yeah, that is awkward.. Indeed, I also can't reproduce #1498 anymore with the current code. A bunch of things changed in the updating code in the meantime, so I assume the timeout really isn't necessary anymore. Removed it in attached patch.. Hi. Yes, definitely make it a default-off option. We don't want to break existing behavior unless there's a really good reason to.. Added some more comments!. Merged as 41804498097a446 and cleaned up in 33d0057f1edb (renamed the option to nonEmpty, made sure updating the editor option works, clarified docs). Yes, see http://codemirror.net/demo/variableheight.html. Thanks. Merged as b0d8dd4. Attached patch adds an optionChange event for this purpose.. You're not 'shift tabbing back', you're pressing shift-tab, which is bound to indentAuto by default. You can change keybindings in your own setup (you want the indentLess command, which is ctrl-[ by default).. Thanks. Merged as 5e342f2. We're not adding new languages. If you need this, your best bet is to write it yourself and publish it as a separate package.. What do you mean by 'integrate'?. Yeah, they're going to have to change their approach. Putting the burden of maintaining modes for every language under the sun on me isn't scaling very well, so I'm moving to a model where I encourage people to maintain language modes separately.. \ud83d\udc4d. Okay, I managed to get Edge running in my IE11 VM. And it does still use logical order. So maybe change the default to visual on all non-IE browsers?. @hason or @jdar -- Want to take a look at this?. Thank you. Merged as 35ec5ee. Hi. Thanks, but we aren't accepting new modes anymore. The recommended way to publish a mode is to create a separate package, say codemirror-mode-nasm, and publish that to NPM.. I am well aware what !important does, and in this case you really don't want to override this, since it'll break your editor. What did you want to do in Jupyter notebook that required changing this?. If you can reduce this problem to a minimal HTML page, I'll look into it. If you're just going to be arrogant, you can go away.. I'm not adding features to the sql-hint module -- it's not my own code, and it's already awfully complicated as it is. If you want to work on this, you'll have to fork the addon.. The way this works for modes already feels like a scary kludge, and I'm somewhat unhappy about adding more of that, but I guess it'd at least be consistent. If you can get this to work in a not-too-terrible way, I'd be open to merging it (I think you should be able to wire this into the way lines are rendered relatively nicely, by treating mark classes a little more like token classes).. This is expected. We can't suppress or rebind the undo/redo items in the context menu, even though they don't work with CodeMirror. Use Ctrl-z/y. Thanks. Merged as c2a11a3. Event handler arrays are not mutated anymore since d7b1370ca45d74 (5.21.0), so I am not sure what is going wrong here. Can you submit a test case that fails?. Can I close this?. Yes, it would be, but that's out of scope for the main project, and it'd have to happen as a separate project maintained by someone else.. The docs are here, and the proper place to ask questions (after you've read the docs) is here.. Attached patch should help.. You have to use {name: \"xml\", htmlMode: true, matchClosing: false}. If you provide a MIME type, the other config params will be forgotten as it is translated to the config registered for that MIME.. Could you see if attached patch helps with this problem?. I'm having trouble testing this. On my desktop machine, pressing enter during a composition simply confirms the composition. On my phone, I don't have any non-latin IME installed, and I can't get anything like this to happen with the regular composition for European languages.\nWithout being able to reproduce this, it's really hard to debug it. Could you give more specific instructions, including platform, browser, and virtual keyboard software used?. I merged your Bubl\u00e9 patch. Not sure when the next release will happen.. You don't appear to be using any inheritance or class expressions, so it should work with 0.15.0 too, no?\nIn any case, I've merged this.. Making input polling synchronous by default like that is a bad idea, since there'll often be a bunch of extra events (input, or another composition) happening directly after a compositionend event, and if we immediately mess with the DOM those events will often get dropped by the browser, and we lose input.\nThe idea is that doHandleBinding in key_event.js already calls input.ensurePolled, which calls forceCompositionEnd which turn forces the composition to end and synchronously polls the content. Is this not working in your case?. Thanks for diagnosing this. That is indeed broken behavior. I've pushed an alternative patch d756ea1. Let's continue discussion in #4441.. Makes sense. Merged.. Nope, but if you can submit a minimal demo of the problem, we might be able to figure it out.. You can show lines with the rulers addon, and might be able to set up the wrapping the way you want using the hardwrap addon.. This looks like an issue in the TypeScript definitions (or maybe a limitation of TypeScript, I'm not sure), in that it assumes no unknown properties are valid in EditorConfiguration, whereas addons can define their own options.\nI don't maintain TypeScript definitions, so I'd suggest you take this up with whoever supplied the definitions you're using (probably https://github.com/DefinitelyTyped/DefinitelyTyped). Please don't give me videos or an unusable snippet of PHP. Put together a minimal HTML demo that helps me reproduce the problem, so that I can actually debug it.. Because when the editor measures the size of the gutter, it's going to get some in-transition values that don't correspond to the actual layout. You'll want to either disable your transition or call CodeMirror's refresh method when it finishes.. It appears to work fine with the current code: http://cm/mode/javascript/typescript.html. > In saying that, I suspect that there is still a bug with CodeMirror as removing one (but not all) of the typescript return types causes unexpected behaviour.\nNo, it isn't.. Did you intentionally reopen?. Looks great. Merged as 73c4e24a. Mind telling us what behavior you're actually referring to? A video isn't much of an explanation -- I see some editing going on, but I have no idea why any of it would be unexpected.. We're planning to move to having less languages in the main distribution, in order to reduce maintenance burden. So no, moving external packages in isn't an option.. Yes, but I've been too busy with other stuff to set something up.. Could you make this mode depend on ../css/css.js and use the enumerated property and value lists from CodeMirror.mimeModes[\"text/css\"] instead of copying them here?. Thanks for working on this! Merged as 71af74da. Yes, I do releases monthly (around the 20th). That's a great idea. Since you've already worked through the DOM structure, and seem to understand aria attributes better than I do, maybe you could submit a pull request making this change?. Are you sure hiding widgets is a good idea? Those might contain information that's useful. Also, you ended up calling setAttribute on a widget object. I've merged the uncontroversial part of your patch as 3dc1a5db. Ah, that makes sense. Merged as 85956bed. If you put anything else, say, a long word, in your item div instead of CodeMirror, you'll see the same effect -- it's caused by your CSS, not by anything CodeMirror does. So wrap it in a fixed-width element, if you want to give it a fixed with.. \u2b50 Great! \u2b50 Will review later this week.. I'm getting test failures in Firefox 52 (core_wrappingAndResizing, core_move_bidi_Say \u0627 \u0628 \u062cabj S, core_move_bidi_Sayyy \u0627 \u0627 \u0628 \u062c) and Chrome 55 (core_rtlMovement) though the tests do pass in Phantom.. This may be a rabbit hole that has no end. I'd be in favor of continuing to selectively disable tests (though introducing a concept of expected failures might also be a good idea, to not obscure them entirely).\nDid you do any measurement of performance? From what I can see, there's still no caching of line-break info. The test suite feels a lot slower with these changes, but I didn't actually measure it either.. I'm still seeing 18 failures in the core tests on Chrome 55 -- a bunch of which (core_moveVstuck, core_measureEndOfLine) don't have anything to do with bidi, so I assume something broke.. > I cannot reproduce the test failures \u2026 unless I checkout master, build, then checkout the branch and run the tests without re-building.\nOdd. I'm definitely seeing them when I rebuild (at f5764e34), & triple-verify that I'm getting the rebuilt codemirror.js. Err, I don't know what I did before (really, I double-checked everything), but when I try now (both 42d2188 and f5764e3) I get only a single failure (core_rtlMovement) on your branch.\nSo, uh, that's good! Sorry for causing confusion. I can't figure out what I was doing before. Going to blame gremlins.\n. As far as I'm concerned, the only thing holding this back from being merged is some kind of definitive proof that the performance of line-wrapping-but-bidi-less editing isn't measurably affected. Maybe set up a simple  program that 'types' out a few thousand characters and profile it in the old and new code.. IE11 fails on core_move_bidi_\u038c\u021d\u01dd\u06aa\u0209\u06e5\u05f4\u06fa\u05c6\u0240\u04a9\u06cf \u04b3, core_move_bidi_\u014c\u04f0\u0442\u0642\u0224\u0601\u01a5\u0605\u0663\u010e\u023a\u0661 \u03da, core_move_bidi_\u067b\u043e\u04a4\u0455\u047d\u03a9\u05be\u0609\u00ef\u03af\u0584\u01f3 \u0675, and core_move_bidi_\u0605\u0601\u0106\u0555\u01bf\u0241\u01de\u03ee\u0620\u0229\u00f3\u0107 \u010f , but since I all the other bidi tests pass, I guess things are largely okay.\nNow going to try IE8... wish me luck.. IE8 showed a whole bunch of ES5 assumptions in the tests, and a few tests failing for incidental reasons that were easy to work around. After fixing those, the move_bidi ones still fail, but the rest pass.\nI wouldn't say this is entirely irrelevant, since sites can still change the default bidi motion option, but yeah, it's no huge issue.\nI'm adding my pedantic code style patches and landing this at the moment.. Finally landed this. I added 3357762162b1a...4627e849852312, and some trivial IE-test patches.\n(Still interested in caching wrapped line extent, and unifying the code that determines the wrapped line in coordsCharInner with getVisualLineAround, if that's possible.). That's a draft, though, not a standard. You could add it to nonStandardPropertyKeywords if you want.. All right, merged as b9d0442. Thanks!. Thanks. Merged as 117ecfca. Merged as 7a094220. Nice. I'm not accepting any more addons like this into the main distribution, but I encourage you to put it on NPM yourself, as a separate package.. Merged!. Mime types ending in +xml are automatically treated as XML, so this isn't necessary.. That's a good point. Attached patch adds svg as a file extension, and makes findModeByMIME handle fallback for +xml and +json MIMEs.. Works for me on Chrome. Which browser are you using?. Mode-specific configuration (in this case, the one from the JavaScript mode) override the (assumedly language-neutral) settings given in the option. Attached patch adds support for an override option that you can enable to prevent this.. We still need that preventDefault for horizontal wheel scrolling, so this isn't that simple.. Thanks.. Merged as d4e2e7a. Should this be possible even when the editor's content is not currently causing a vertical scrollbar? If there's enough scrolling room, this is relatively easy to do -- just scroll the content up by the size of the panel. But that doesn't work when there's no scrollbar or not enough scrollable content below the editor bottom. Would requiring users to enable the scroll/scrollpastend addon to work around this be an acceptable solution?. Attached patch implements this for cases where there's enough scroll room.. Attached patch should make sure closing a stable panel also adjust the scroll position.. This is now fixed in the current master branch.. The exact same problem occurs when you replace the code that creates the editor with\ndocument.getElementById(\"editor\").textContent = new Array(1000).join(\"x\")\nSo I don't think you can hold CodeMirror responsible for this. If you don't want it to happen, wrap the editor in a fixed-size element.. I'm not sure what the behavior is supposed to be in this case, I haven't worked with flexbox enough yet, but I agree that what happens is annoying.. This is probably happening because CodeMirror turns off ligatures in its CSS, because those cause problems with cursor positioning.. > as CodeMirror is using string length in a number of places as a proxy for editable characters\nCan you give examples of such places?. > Well, at a minimum, there's a couple of places in buildToken in line/line-data.js.\nThose appear to be using string length to track offset into a string, which is entirely okay. The line that tracks the column is indeed suspicious, but that'll only cause tab characters to have the wrong with in selected circumstances, so that's a minor issue.\nIf you find a reliable and fast way to query font ligatures from JavaScript, I'm interested. But until then, slightly shaky workarounds are what we have to live with.. The HTML mode is well aware of self-closing elements. Can you show an example of code that indents badly on http://codemirror.net/mode/htmlmixed/ ?. I don't think that's true. If I flip the order in the htmlmixed mode demo, it still works. The problem might be that you're not setting a mode option at all, in which case the editor will default to the first mode that was loaded.. I think you want \n```\nvar myOptions = {\n    mode: \"htmlmixed\",\n    indentUnit: 4,\n    tabSize: 4,\n    indentWithTabs: false,\n    lineNumbers: true,\n    autofocus: true\n};\nvar myCodeMirror = CodeMirror.fromTextArea(code, myOptions);\n```\nI.e. the second argument to fromTextArea is a set of editor options, not a mode spec.. Strange. Which platform and node version are you using?. Could it be that there's already something (a node-static) running on port 3000 on your system? That appears to be hard-coded in the test runner. Other than that, I can't think of anything -- my system is very similar, and cloning a fresh copy, installing, and running the tests works as expected.. lib/codemirror.js is not just a copy of src/codemirror.js, its the result of building the core library bundle. It should be built when you do npm install.. Yes, @schanzer explained it well. If you can reliably reproduce viewportMargin: Infinity causing an infinite loop, please submit another issue with an example (I couldn't get the problem to occur).. > The problem is that when CodeMirror scrolls to the next match, it doesn\u2019t take the editor position in the viewport into account. So the highlighted match is actually below the cut, and I don\u2019t see it.\nCan you reproduce that in http://codemirror.net/demo/search.html ?\n\nI also use Enter for skipping to the next result, but CodeMirror moves my selection to the match on Enter.\n\nThe CodeMirror search UI is not the browser's search UI. But the good news is that it's a separate addon that you can replace with your own implementation, using whichever approach you prefer.. Attached patch should address the scrolling issue.\n\nIs there any reason why keyboard shortcuts don\u2019t follow browser behavior though? \n\nBecause our search module just works completely differently -- it doesn't keep the search field focused, but puts the focus back into the editor when you search, as is often done in editors. As such, Enter already has a meaning, and can't be used for search-next.. As added background, maintaining fiddly UI components like the search module isn't my biggest hobby, and this addon is going to be moved out of the main repository into a separate, not so seriously maintained module soon. If someone wants to write a modern, solid alternative and maintain that, that'd be \ud83d\udc4c. Does attached patch solve the issue for you?. That's interesting. I can't explain how that patch could fix this, though. @renlock, can you confirm?. Is your editor inside a contenteditable=true element, by any chance?. I think this should be a different seach addon, and I'd prefer for it to be implemented as a separate module, so that the maintenance burden doesn't fall on me (the search addon is already a monster of different use cases, and adding more stuff to it would require a serious rethink -- doing this from scratch is probably cleaner). I've merged this as 88b37cf580032 and followed it up with 53612ac34c5c5e4, which makes it a bit simpler.. Hi. Thanks for the PR. But to keep the main distribution maintainable by a small team, we're tightening the criteria for what goes into the main distribution, and are encouraging people to maintain code like this in separate NPM modules. (We will, eventually, also split the current main package into smaller modules.) So it'd be great if you could put this into a separate repository and publish it to NPM. It's not in scope for the main distribution.. I'd go with codemirror-fold-stex, so that other folding modules can share the codemirror-fold- prefix.. I spent a while trying to reproduce this (with Chrome Android), but it never happened for me. Which line did you put the cursor on, and what did you type?. CodeMirror modes can't yet look ahead arbitrarily (across line endings), so since the closing character might be on another line (in a line-wrapped paragraph) the mode is doing the best it can under the given limitations.. Thanks. Merged as 6709974. 5.23 has been released. Because we didn't anticipate anyone loading the files by glob pattern. Just refer directly to lib/codemirror.js, that's much more robust.. > I was thinking we could skip setGutterMark for all folded lines\nThat's doable, but does it help? I can imagine that a lot of the time is lost in the actual fold-finding function, which will still run over (and usually tokenize) the whole folded blob.. This patch should help. Yes, this is the expected behavior. You can listen to the \"changes\" event to get a single event with an array of changes.. Works fine on Chrome Linux. Which browser, version, and platform did you test?. Fixed via #4510 . Thanks! Merged as 15aed69a. (Doing this via an option in the mode config seems entirely sensible to me, so I merged it as-is.). Seems reasonable. Merged.. This is too vague and tied to your code for us to treat it as a CodeMirror bug. If you can narrow it down to a specific thing that CodeMirror does, in a minimal, reduced program, please open a new issue with more details.. Hi. Thanks for contributing. However, we're aiming to move language modes into separate modules in the future, and are no longer accepting new languages in the core distribution. The recommended course of action is to publish and maintain this yourself, as a module called, say, codemirror-dust on NPM.. The elixir mode is a good example. You specify the core module as well as other modes you depend on as dependencies, as you would with any NPM module.\nAs for it being disenchanting that I don't continue to adopt and maintain everybody's code, yeah, if that's what you've come to expect I've probably set the bar a bit too high in the past. I am, however, in no way obligated to keep expanding the amount of (largely unpaid) work I'm doing.. Wonderful!. We can't, since this is the CodeMirror project, and not Brackets.. The mode itself does not do any kind of completion, so you must be doing something in addition to setting the mode to htmlmixed.. Well, your code is popping up autocompletion on every character, so that's what you get. I'm not sure what you consider wrong about the suggestions in your screenshot, but they all appear to be valid tags there. If you want to only complete when the cursor is in a tag name or after a <, you'll have to program your completion logic that way.. It might be linking different versions of whichever unicode library it depends on. Other than that, I have no idea.. You can already return a space-separated string of styles.. @pabloferz Do you want to take a look?. It seems that when you type, you go through 'else', which is indented properly, but once the word elseif is typed, it no longer matches else, so the indentation was off. Attached patch handles elseif properly.. Merged as 524f54a8. Did you enable lineWrapping? If yes, which browser are you using and could it be that your editor is in a container without a fixed width, and you're not giving it a width in your CSS?. Thanks. Merged!. Good idea. Merged as d0e3b2e7\nOh, our comments crossed. Not sure about what github is doing, but naming the license seems to add clarity.. If you use some external library that messes with the element's layout, I guess that might interfere with setting the editor to cover the whole screen. I am not accepting integration problems with other libraries as bugs here though, you'll have to debug it yourself.. That's the continuelist addon seeing that you're leaving an empty blockquote line and helpfully cleaning up the blockquote for you. I'd say this is desired behavior, most of the time, since I don't know of a reason to have an empty line in a Markdown blockquote.. That's a good point. Attached patch disables the behavior for > quotes.. It seems your commit is still the old one (with trailing whitespace and console.log). Could you update the branch?. That'd be a new, non-trivial feature (it'd require some kind of merge algorithm), which I'm not interested in adding to this addon at the moment.. Interesting idea, but out of scope for the current addon, which is already straining under trying to support a lot of different configurations and use cases.. CodeMirror computes the order of bidi text independently from the browser, for the purpose of cursor motion and drawing the selection. Styling pieces of content with non-default unicode-bidi values will unfortunately put this computation out of sync, and produce the issue you describe.\nIt is not clear to me what we could do about that (getting the computed style for each token and somehow taking that into account when computing the bidi ranges would be too expensive and complicated).. It'd be possible to implement something like this, but I don't currently have the time to work on it, and as I mentioned, it'd be complicated (the bidi code is already quite scary).. Install from NPM or the distributed zip file, or do an npm install locally if you really need to use the repository directly.. Nice, but we're not accepting new modes. See my response to #4535 . Hi. We're not accepting new modes into the main distribution. The recommended way to distribute a mode is to put it on NPM as a separate package, along the lines of the Elixir mode.. What kind of graphical indicator are you trying to add? And isn't it possible to just use the same rules (above line in common case, below line at end) when adding your gutter marker?. It would be easy to make the spacers cover the gutter, at which point you can give them a border. Would that help?\nWhat is the fact that the changed chunks get a similar bar on the left as the spacers trying to express? Do you have a mockup or sketch of the style you're trying to create?. Sounds good. There have been several similar questions in the past, also from Google, related to the delay introduced by the merge addon when it reacts to changes. The situation is that computing diffs is too expensive to do synchronously, so unless someone comes up with an incremental implementation of a diff algorithm, it's hard to update the display synchronously, and you're going to see things update with a slight delay.. > That's a separate issue.\nNot really -- it's a symptom of the same issue. Copying a chunk is handled as a regular document change, which results in the interface updating in the way it does for document changes.\nWe could special-case this and just delete any spacers below the chunks, but in a three-way merge UI it seems there can be situations where this isn't appropriate (since the nearby spacer in the middle view might be creating space for a chunk in other view, note the one that the merged chunk came from).\nAdding more complexity just to address this case seems uncalled for, since the symptoms are the same as with other editing actions. So I'm closing this as being a feature request, not a bug report.. Attached patch implements an option to customize the code that's run when a chunk is reverted.. Makes sense! Merged.. Merged as 407c5227...7ad2ce62. Trying to put the last two patches in this on top of 7ad2ce62 produces relatively complicated-looking conflicts. Could you rebase them for me, since you're less likely to screw something up?\nIs cb2ebf1 intended as a relatively pleasant alternative to an infinite loop for when there are bugs in moveVisually, or are there other situations that might trigger it?. Thanks! Merged.. Looks sensible. Merged as f45dc108. Thank you. Merged as f2c63b67\nFor next time, please split different changes/features into different commits, when possible even submit them as different pull requests. And when you get something wrong in your pull request, you can simply update the branch (also completely replacing it with a 'force push'), no need to close and open a new pull request.. Thanks. Fixed in attached patch.\nLumping unrelated changes into pull requests is discouraged, so opening one for a single specific change like this is perfectly okay.. Which browser, which platform, and how are you scrolling? (Using touch pad scroll on Chrome 55 Linux, I couldn't get this to happen.). From NPM, or using the zip file distributed from the website.. What I'm seeing is that when I type a quote before the $ character, one quote is inserted, and when I type another, another quote is inserted. Is that what you mean, or are you seeing something different?\nAutoclosing is intentionally disabled inside strings (so that you can type can't without getting can't').. Ah, right, I can confirm that -- that's an effect of the way the bracket addon was determining whether it was in a string. Attached patch seems to help.. I guess that would be nice, if people are widely using heredoc strings in PHP like that. But it's a completely new non-trivial feature to add to the mode, and I'm not taking feature requests. You could consider trying to do it yourself (maybe look at the way the markdown mode highlights code blocks for inspiration) and submit a pull request.. Thanks. Merged as 78539df. Attached patch should help with this.. Hi. Markdown does not, in itself, have anything to do with TeX. You could try to create a wrapping mode that handles this (see also the discussion here), but I don't consider the fact that the Markdown/GFM modes don't handle this themselves a bug.. This is not an improvement to the GFM mode, this is a separate language that one could write a mode for on top of the GFM mode. Since the CodeMirror maintainers have more than enough on their hands already, we're encouraging people to build and maintain new modes as separate packages, which should scale better than putting everything on the shoulders of the people maintaining the core library.. If I add lines to one of the editors, while all are scrolled down, there isn't any content to scroll into view in the other editors, so they can't scroll down. And even if they could (with the scrollpastend addon, for example), there's nothing there to scroll into view, so I'm not sure why you are expecting this behavior.. Ah, hold on, connect=align is enabled -- now it makes more sense. Attached patch should help. The issue was that when scrolling happens directly after a change, the addon didn't have an up-to-date diff and thus punted on the scroll syncing. It now sets a flag to retry the sync when the update has been handled.. I wasn't able to reproduce this. I could see the scroll to out of sync when adding the newlines, but that was #4556. When scrolling after that, the editors stay in sync.\nCan you reproduce this if you make some changes to demo/merge.html to immediately create the problematic situation on startup? If so, could you give me the updated demo file?. Does attached patch fix this for you? What I was seeing is that the two rightmost editors got a incorrectly large margin at their bottom, making them higher than the left editor, so that the left editor simply couldn't scroll as far down as they could.. You're passing a value of the wrong type to the CodeMirror constructor. This is not a CodeMirror bug -- it might be a react-codemirror bug or a problem in the way you're using the library. On Chrome, I'm seeing the scroll position monotonically increase and never decrease when I do this. Which browsers did you test?. I'm seeing the jumps now, but only in the editor that I'm scrolling -- I was only testing the other one before, going on your description. Still, that doesn't look right, so I'm going to try to figure out why it happens.. That appeared to be caused by an issue in the way scrolling syncing tries to be one-directional (i.e. to prevent feedback cycles between the editors). Attached patch makes the jumps go away for me, could you see if it also solves your issue?. How about we just drop (don't render) annotations where getLineHandle returns undefined? Compressing out-of-bounds annotations into the last line doesn't seem like useful behavior.. Thanks. Merged as 0ed93b4051c26, and followed up  by 4164d2847140cc8 because documents don't necessarily start at line 0, so their last line isn't always lineCount() - 1. I don't think returning nonsense from innerMode is a good idea, since that is also used by other pieces of the system. Attached patch adds a way to tell the comment addon not to look at the inner mode.. Argh. Reverted as 8a52fcee\n@TimvdLippe What exactly were you testing before?. I've released 5.24.2 with the fix, so that it hopefully won't impact too many people.. Hi. We're not taking mode requests. If you need it, you'll have to develop it yourself.. No, but it'd be wonderful if you publish it yourself, as a separate NPM module (say codemirror-mode-freemarker). Thank you!. Sorry, no, I don't want to try and create a UI for something that's easy enough for people to do on their side with just NPM and a few commands. Yes, definitely a typo. Attached patch seems to fix this (though reproducing it wasn't reliable, so, though I did try for a while, it might be that it just randomly didn't happen when testing the fix -- let me know if you can still reproduce it). Thanks. Merged (without the trailing whitespace) as 03cba9f8. There is code specifically handling this, and when I collapse a piece of code in the merge demo, I see the alignment updating. Can you give a more detailed set of instructions to reproduce?. I guess this is the same issue as #4575 -- when the change in height occurs in a piece of unchanged code, the aligning doesn't re-align on that point.. I found two issues in the way chunks are drawn near the end of the document. The drawing should be more consistent now -- take a look.. You do realize that the curMode you're working with is in a different state object than the one that the rest of the mode file uses, I hope?. In general, it sounds like you might need a bit of a better grasp of how this mode works before making a tricky change like this. As the code currently is, it seems too confused to merge.. What the addon does is align every line below a changed chunk. Attached patch sets up the merge addon to listen to changes in line widgets and realign in that case, but that doesn't really solve what you're seeing here. -- I guess you're expecting every line to be aligned with the corresponding line in the other editor. But doing that is quite expensive if done naively, and awkward if done intelligently (which would require tracking all line widgets in the editors, figuring out whether they are in changed chunks or in unchanged chunks, and adding corresponding placeholder spacers to the other editor). Are you sure that is what you need, or is it possible to just manually add a corresponding spacer to the other editor when you insert a line widget?. All right, I'll try to make time to look into this soon.. Please take a look whether attached implementation solves your problem. Right. Attached patch should help with that.. Yes, there was an issue on chunk or end-of-doc boundaries. Try with attached patch.. This repository is not a bower distribution channel. For that, try https://github.com/components/codemirror. You don't need line numbers, you need to keep mode state that indicates whether you are in a sub and which local variables are known. The JavaScript mode does this, for example.\nClosing, as this is a question, and not an issue. Please use the forum for those in the future.. Thanks. Merged as b86bb0a. I can't see this on http://codemirror.net/mode/javascript/. That code is such a mess that I don't really believe you've seriously tried to test it (the call to editor is inside the editor function, so nothing gets run, and you appear to be creating a comment with backslashes, which will give you a syntax error). In any case, this is not a CodeMirror bug, and the place you initially posted it, stackoverflow, is a more appropriate place.. getValue is working fine -- it's returning the empty string, which is the current value of your editor.. fromTextArea takes the content of the textarea as value, and ignores its value option.. That doesn't have anything to do with CodeMirror though, so you'll have to ask somewhere else. The problem appears to go away when I run this outside of jsfiddle, with the current version of CodeMirror. If you can reproduce it as a stand-alone HTML file (preferably without jQuery or superfluous searchCursors), that'd help.. Fixed via #4588 . Thank you. Merged.. lib/codemirror.js works exactly the same as it did in earlier releases. If you're cloning the repository without building it, then stop doing that and use the package from NPM or the zip from the website.. That contains a line so long that CodeMirror decides not to fully highlight it. See the maxHighlightLength option for configuring that behavior.. I tried to reproduce this with the code below, but the dialog seems to work fine inside a web component. Could you get me a minimal reproducing example of your problem?\n```html\n<!DOCTYPE html>\n\n\n\n\n\n\n\n\ndocument.registerElement(\"my-component\", class extends HTMLElement {\n  createdCallback() {\n    this.root = this.createShadowRoot();\n    this.root.innerHTML = `\n      <link rel=stylesheet href=\"codemirror/lib/codemirror.css\">\n      <link rel=stylesheet href=\"codemirror/addon/dialog/dialog.css\">`\n    this.cm = new CodeMirror(this.root, {\n      value: \"one\\ntwo\\nthree four five\\ntwo\\n\",\n      extraKeys: {\"Ctrl-F\": \"search\"}\n    })\n  }\n})\n\n\n``. Ah, right, that should definitely use the.shadowRootproperty, since.rootjust seems to be an accidental convention that happened to be used in any examples I saw so far. Attached patch changes this. Thanks for figuring that out.. Thanks, that looks correct. Merged. The linter and the tests are passing for me (and for the [CI](https://travis-ci.org/codemirror/CodeMirror/builds/202654686)), so I'm not sure what you saw there.. The SASS mode started depending on the CSS mode (to get a full list of property and keyword names), so you have to make suremode/css/css.jsis loaded if you want to use the SASS mode.. You can stay on version 5.23.0 if loading an extra mode is, for whichever reason, a hard thing. We don't have a regexp mode in the main distribution. There seems to be a crude one [here](https://github.com/uccser/cs-field-guide/blob/25d1e084f701087ad9497d29d2a508629ba536a7/interactives/base-files/js/third-party/codemirror-mode-regex.js), but note that that one doesn't use standard token types so you need custom CSS to actually see the highlighting it produces.. Are you seeing this on http://codemirror.net/mode/javascript/ ? If not, try to find out what is different on your setup that might be causing it. Merged as d79935c60. Fixed in 96a1ca9f. Hi. I understand the issue, but this is just not a feature that currently exists, and as such isn't something you can just ask for, under our existing contract.. I'm sorry, but enumerating every use case that is not supported in the docs does seem a little much to ask.. What I mean is that there are an infinite number of things that CodeMirror does not do, and trying to enumerate every specialized thing that it doesn't do in the docs would be a ridiculous exercise. I'm really can't understand why you are pressing for this.. Have you triededitor.addLineClass(line, \"gutter\", \"my-class-with-a-border\")`, by the way? That won't end up in a specific gutter, but might still provide a decent way to put a line in there.\nOr maybe set a .CodeMirror-gutter-wrapper { height: 100% } style, to allow the 100% in your marker style to actually refer to the whole line height?. Thanks. Merged as 4c9e134d. Thanks. Merged as ebfed69e. Thanks. Merged as bd308e71. Attached patches make the R mode handle semicolon-less,  brace-less blocks better. They use a rather rough heuristic, because completely accurately determining end-of-statement would require a pretty much full parse, which would require a much more complicated mode, but I think they should work well in normal code. Take a look.. Great.. We are aware of the problems and sympathetic to addressing them. The current architecture of the editor (which is still hugely influenced by the initial 'fake everything because browsers aren't reliable' approach) makes this very hard though. We are considering some radical changes, and with luck, we'll have an announcement about that soon. Pull request for low-hanging improvements are always very welcome (if properly documented so that we understand how hey actually improve things).. > would you be open to sharing some of the radical changes you're considering?\nWe intend to move to contentEditable more completely. There'll be an announcement sometimes in the coming months when we have the design worked out more clearly.\n\nbut also just a little worried that any massive API changes will wreak havoc on my codebase.\n\nOh yeah, that will definitely happen, and upgrading will take some work.. @QuincyLarson Yes, there'll be work on a more accessible architecture starting in a few months. If you want to contribute financially or be involved in testing, shoot me an email!. My previous fix doesn't work, because it moves the active-line background style to a higher layer where it obscures the selection. Reopening.\n. But that means that, without introducing even more silly layout <div>s, we can't really address this. You could add a local CSS rule to do something similar to the patch I attached, but that'd require writing separate rules for all themes that you use, and would still have the problem of obscuring the selection (which may not be an issue if you only show this when there's a cursor).. Attached patch fixes that test case. Could you see if it solves the issue generally for you?\n(Is the alternative diff implementation you're using open source? I've been intending to move away from the, apparently unmaintained, diff-match-patch, but haven't been able to find anything that comes close in speed.). I think the formulation is fine this way, since a regexp might match newlines, which would break the plugin. I merged this as 608e3f822d24 but followed up with a3891b51ec which makes the option name ignoreWhitespace, and simplifies the code a little.. You failed to load the XML mode, it seems.. The content of an HTML block is parsed, as far as I understand Markdown, as HTML, so the < 2 in there really does look like the start of a tag, and isn't sensible content at that point (the < should be escaped). It isn't trivial to notice right away that this is not a tag (tags may span lines), so I also don't think the XML mode should be expected to ignore it. (It could ignore numeric tags, but then, the code could just as well say 1 < x, or even var html = \"<div>\", so that doesn't get us much.). Oh, that's a lot easier to handle. Does attached patch solve the problem for you?\n. Thanks! Merged as d8d77035. This is not the right place for requests for help. Try the forum.. Thanks. Merged as d45038f1. Merged as d1d6ee2d. Looks good! Merged as 17159fec. Argh, yes, you're right. Reverted that patch as d333c723. Could you address my comment, add a minimal test for handling double-quoted identifiers to test/sql-hint-tests.js, and add this new dialect to mode/meta.js?. Hm, on closer look, no, it makes sense the way it is now -- you're calling resolveMode, not getMode, because you need the original mode spec, not the mode object, to be able to get at its configuration. So the code is fine as it is (though I'd simplify the end of the function to CodeMirror.resolveMode(mode).identifierQuote) || \"`\"). You're right, those tests weren't failing when the expected result had more elements than the produced result. Patch b359a021 fixes this.. Hi, the tests have syntax errors (missing commas) and one of them fails.. I'm not sure what you're doing, but since the test file is syntactically invalid, you can't have been running it (probably you missed an error on the console saying that the file failed to load, and thus the tests were skipped). The linter apparently doesn't check the test scripts, and I guess the phantomjs process also failed to evaluate the broken file and thus didn't define or run the tests.. Thanks, looks great now. Merged as 65c70cf5d18 and c4387d6073b15. Looks good. Merged as 17159fec...5e427c43 . Thanks for spotting that. Merged as 8d552508. I think attached patch will solve this.. I've merged your tests as 00f59d1a50ec and pushed 486507818, which solves the problem in a different way by only making type a keyword when at the start of a statement.. Is per-line direction something you want to do in a separate PR?. Thanks! Merged as 4f091edc...4f08a5c4. Could you elaborate on that? display.scroller.scrollWidth is supposed to reflect the total width of the content, but what is the effect of direction on that? Your jsfiddle creates non-scrolling elements. If I create a scrolling, direction: rtl element with overflowing content, I do see the expected scrollWidth. So our content is overflowing on the wrong side? Is the issue that the scrollable element should have the same direction property as the element that contains the overflowing content?. The way things work is that the scroller divs actual scroll size must match the fake scrollbars, so that touch and wheel scrolling continue to work. As such, we probably really need to do something about the browser's scroll behavior, not just our measurement.\nEven scarier is what happens when you mix ltr and rtl blocks inside a single scrollable container -- the scroll size only takes into account the ones that match the scrollable element's direction. As in this example:\n<div style=\"width: 200px; overflow: auto\">\n  <p style=\"direction: rtl\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</p>\n  <p>ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</p>\n</div>\nMaybe browsers just aren't able to deal with this use case at all, and we should try to use some kind of hack like positioning the rtl content in such a way that its left side is aligned with the left of the ltr content. That'd be an awful kludge which would involve knowing the maximum rtl line width and somehow offsetting all rtl lines by that minus the view width, but given what CSS's default behavior here is, we may  not have a lot of choice.. On second thought, since per-line direction seems to be a relatively obscure use case and clearly hard, I'd also be happy to cut that feature, and search for a solution that works for whole-document RTL content, where at least we can use the known max line length for the offsetting hack, and offset the whole content at once, rather than doing so per line.\nOr we could try to support scrollbars on the left, but the current set of hacks that let us maintain our own custom scrollbars and hide the native ones are already overconstrained and fragile, and I don't look forward to adding another complicating factor there.. Attached patch should help here.. Good point. Attached patch should improve things further.. Yeah, sql-hint is a mess and I regret ever having merged it. Oh well. Do you intend to work on fixing the other failures? I'd prefer not to have our CI red because of this.. > I need to better understand the way the hinter works to find where the problem is.\nIt might, depending on how much effort you want to put into this, be more productive to rewrite the thing than to try and salvage it.\nI've merged 7c87848067517907d3a71cb75369b0eebfbe52b9 (minus the trailing whitespace) as 3c816659. What I'm seeing is (with the gaps styled as yellow):\n\nThe gap that you appear to have labeled 'MISALIGNED GAP' is necessary to make the 'Horse' line in the center and right editors line up. I.e. that part of the right document doesn't have gaps, so the gaps in the middle and left one are needed to make things align.\nOr am I not understanding the issue correctly?. Right, I see what you mean now. Attached patch seems to solve the issue for me. Could you verify that it works for you?. Hi. Nice, but we're not accepting new modes into the distribution. The recommended way to publish a new mode is to put it into a separate repository and distribute it as an NPM module -- see for example the elixir mode. Looks great. The reaching into the history might break at some point if we change the representation, but I don't want to add a public API for this, so it's fine, we'll notice when the test fails. Merged.. Thanks! Merged as c96aae3d. Can you reproduce the issue in the demos on http://codemirror.net ? Do you know the precise text that Nodepad++ puts on the clipboard?. Thanks for providing a data point.. This is a feature. You can turn it off with this option if you want.. Makes sense. Merged as d3e68b6e. \\( was being treated like an opening paren, but \\) ignored. Attached patch should fix that.. Thanks, merged as 438079cb. Attached humongous hack works around this. Android keyboards considered harmful. I installed SwiftKey, and didn't see any issues. Could you be more specific about the problem you're seeing?. Download it from NPM or the website, don't clone the git repository.. Could it be that this was already fixed by 7580a1dc1d7ce1ab? I can reproduce in 5.24.2, but not in master.. CodeMirror doesn't format your code for you. It can auto-indent (shift-tab in the default keymap), but it won't insert newlines.. I have no idea what <!--#include is, so this is probably the wrong place to ask.. Attached patches should help.. Seems like a good idea. Merged as f583ab93. > I'm not sure what caused this. \nNeither are we, and the report doesn't contain enough information to act on.. Hi. You're messing with the indentation and semicolons of lines that aren't affected by your patch. Please don't do that. Also please try to follow the coding style of the surrounding code with regards to spaces after if, not putting else on a new line, etc.\nWhat is isDefault for? And why are you setting inTag, which so far is either a string or null, to true there?. Hey @phuongkt, stop adding empty reviews or I'll have to block you from the project.. If you want, you can define an eltP function which calls elt and then adds this role, and use that for all places that currently explicitly set role to presentation. Doing it by default for all elements created seems a little too magical/unexpected.. Great. Merged as 0b00c0e1. That's not something the editor supports (but you can wrap it in an overflow: hidden element and set scrollbarStyle to null). This is a bug tracker, not a place to ask for help. You can try the forum, but generally, you probably won't have much luck with a vague description like this.. This is a problem of deriving the language from the extension, and then using extensions that are usually associated with another language. I don't think CodeMirror can be expected to automatically handle that. The solution is probably set up your editor to use jsx mode for .js files.. What exactly are the symptoms of the problem? I've added some nested CSS to the folding demo and folding around it seems to work fine -- you can fold both the whole <style> tag, and the braces inside of it.. What is editor bound to when you call editor.getValue()? If it's the instance returned by CodeMirror.fromTextArea, it would definitely work. Are you trying to call those methods on a DOM textarea element?. Great, then what you're doing there is correct, and the problem exists elsewhere.. Hi. Nice work. But we're moving to a distribution model where we don't accept any further new modules into the main distribution, and instead encourage people to put it them on NPM as separate packages. (At some point, the main package will also be split into smaller pieces.) So please create a separate repository and NPM package for this, and mention it on the wiki.. It's in the docs.. Looks like you have some kind of CSS issue, and the editor's internal hidden scrollbars are becoming visible.. This doesn't appear to be happening on http://codemirror.net/demo/closetag.html , so I guess HackMD is running an old or modified version of the code.. No, I'm not going to do this. But you are very much encouraged to fork that addon and distribute an improved version.. Attached patch should help. This is too special-purpose for inclusion in the main distribution, sorry.. In my comment on the previous pull request, I meant that I'm simply not interested in including this in the distribution, not that the code has to change.. Use the mode option. You did, but \"text\" isn't a mode. Use \"text/plain\" or \"null\". Overlays should not have side effects, so you can't use them to do what you're trying to do here. I'm okay with the current behavior, so if you want something else, you'll have to create your own fork of the addon.. No, that's fundamentally not how overlays work. They take text input and output styling without knowing about anything else. That's how they can be cheap and efficient, and it's not changing.. > Not knowing the stage of processing is not what makes overlays fast, obviously, and I don't know why you appear to think there's a direct connection.\nBecause I designed and wrote this code. But thanks for explaining it to me.. No, CodeMirror's key binding system doesn't distinguish between left and right versions of keys. If you want to do anything like that, you'll have to handle the raw dom events.. Which zip, exactly, are you downloading?. Ah, that's the repository, not a built package. Get it from the website or NPM instead.. Nice. Some things jump out though (tested in Chrome):\n\n\nWhen doing editor.setOption(\"direction\", \"rtl\") on the main website (/index.html), selecting with the mouse seems to completely stop working -- so I guess finding the position at coordinates broke.\n\n\nSetting the direction back with editor.setOption(\"direction\", \"rtl\") leaves an empty gap to the left of the code.. A few more:\n\n\nWhen you have a long line in an rtl editor (which also has a vertical scrollbar), the left end of the line ends up below the scrollbar.\nAlso, anything beyond the first screen width, horizontally, doesn't get selection drawn (the selection rectangles stop at the original width) and doesn't properly handle mouse clicks (they are treated as if they are inside the original width). (This kind of stuff is why my first impulse was to forget about putting the scrollbar on the left, but I applaud your effort to do things right.). Yes, the content under the scrollbar happens in Chrome (57).\n\nShould be better now.\n\nGreat!\nAlso, in the editor on index.html (which auto-resizes up to a certain point), when you type a long line the horizontal scrollbar initially doesn't appear, both in Firefox and Chrome. Note that many parts of the scrolling code are written the way they are because they need to handle both the auto-resize-through-CSS and the scrollbar model, and you'll have to test both when you touch it. That stuff could use more automated tests I guess, especially since different browsers behave slightly differently with, for example, how they handle the way a margin on an absolutely positioned element influences the parent container's size.\nThen I got this error a few times when clicking around in an RTL editor:\nError: Broke out of infinite loop in coordsCharInner  codemirror.js:2838:49\nAnd clicking on the rightmost part of the document in RTL mode when there's a horizontal scrollbar (which is scrolled all the way to the right) often (but not always) causes the editor to scroll to the left, in Firefox and Chrome.\nI saw the gutter in the wrong place a few times, directly after setting the direction option, or during scrolling. I can reliably reproduce this by opening mode/javascript/index.html in Chrome and running editor.setOption(\"direction\", \"rtl\") in the console.\n. Merged as aadf2df6. We're not taking mode feature requests, or even new modes, so the way to proceed would be to write such a mode and distribute it separately.. @ is not part of any JavaScript dialect that the JavaScript mode parses (I guess it's supposed to be an annotation here?). Patch fa69bef4 adds decorator support.. Could you submit this as a pull request?. Great, merged #4670. That seems useful and harmless. Merged.. The render method (as well as displayText) goes into the individual items, they are not options. If you want to replace a piece of the document, make sure that from and to are different. In general, spend a bit more time reading the manual before opening an issue.. > If I change the from to be 2 positions ahead of the current cursor,\nfrom should be before to. > cursor.ch -= curWord.length;\nYou're mutating an object owned by the editor. Don't do that.. new CodeMirror.Pos(cursor.line, cursor.ch - 2). No, I'm not accepting new addons into the main distribution. Please distribute this as a separate NPM package.. The regular search dialog intentionally closes on blur, since it covers part of the editor and would interfere with editing if it stayed open. If you want to create a better search dialog, please fork this one and maintain it independently.. I simply don't have the bandwidth to maintain further extensions to the search addon, so yes, you'll have to maintain it yourself.. > Can you also tell me the reason for CodeMirror create another scrollbars and hide the default scrollbars.\nSee http://marijnhaverbeke.nl/blog/a-pathological-scrolling-model.html\n\nfix the calculation of zeroWitdh \n\nWhat is wrong with zeroWidth?. It briefly re-enables pointer events when you scroll, which works for OS X-style scrollbars -- but maybe your overlay scrollbar works differently? Is it constantly visible? How does it prevent interfering with mouse events that want to interact with the content on the right of the viewport?. Do they handle pointer events on the whole bar, or only the handle? What if the user wants to interact with the content under it?. > Need to move mouse far from scrollbar.\nI don't understand. If the content is below the scrollbar, you can't interact with it when you're far away from the scrollbar.. Is there any way for CodeMirror to figure out whether a given scrollbar is faded in or out?. That's going to make it difficult to do the right thing when the user interacts with the pixels covered by the scrollbar element.. > I think the fake scrollbar not really improve the scroll proformance. \nIt isn't about scroll performance, as you can read in that blog post I linked, it's about preventing the user from scrolling content that hasn't been drawn into view. I.e. regular scroll events aren't synchronous, so we need the fake scrollbar to be able to respond to scrolling before the main content is redrawn.. Does attached patch help for you? I found I could enable these scrollbars with a flag, so I could test them on Linux. The hack that was in place for OS X scrollbars almost worked for Chrome's, and with attached tweak it worked for me (I didn't test Chrome OS, since I don't have a device that runs it).. I don't know what CEF is, but I could reproduce this in the plain editor, and attached patch should fix it.. What wrapLineDown does is move the line below the selection above it -- so that it works even if you have multiple lines selected. There doesn't seem to be a way to formulate that in a way that fits your expected behavior here.. Thank you. Merged as 0597eeef. Nope, that's not something the library supports.. We're taking it into account as a desirable feature in the next version, but for now, no. @pabloferz or @malmaud, want to take a look at this?. Fixed via #4684. You are right, I think. I've made the change you suggested in fd052625.. Thanks for fixing that! Merged.. Thank you. Merged as 5aa64cc4. Attached patch should make this mostly CommonMark-compliant.. Your commit's parent commit is from 2013, and it touches a file that hasn't existed in the repository for quite a while (it is automatically built from ES6 sources now, so it probably won't have duplicate variable definitions anymore). As such, this isn't something we can use.. The issue was that adjacent tokens with the same style (in this case, null style) are merged to avoid creating too many DOM nodes. Attached patch adjusts the CSS mode to attach a non-null style to colon characters, to avoid the issue in this case. Does that help?. Argh. I misdiagnosed the problem -- the SCSS mode seems to explicitly be tokenizing :\\s*{ as a single token (line 753 in css.js). I have no idea what : { means in SCSS, and there's no tests covering it, so I'm hesitant to touch that.. There is no state that corresponds to SCSS-just-before-property-block in the CSS mode's state machine.. Thanks, merged as 7ae9e757. @adrianheine Do you have time to take a look at this?. So the proposed patch is apparently not entirely correct. Having the non-fast-path code be this slow is a fairly serious problem, though. Any chance you could allocate some more time for this, @adrianheine ?. This was superseded by #4757. Thanks. Merged as 1e4f5b8db174b0 and generalized a little in 78498753f9. The selection needs to be kept active in case the user drags it, and we can't decide whether they drag or click until the mouse is released. As such, it is not practical to change the selection as soon as the mouse button is pressed down.\nPreventing the default behavior on the mousedown event, in order to avoid deselecting the editor, would prevent native drag events from firing. Attached patch re-focuses the editor shortly after the mousedown. I think that's the best I can do here.. Ah, with the default theme this isn't really visible, but indeed, if you increase the contrast between the focused selection and the unfocused one, it's obviously flickering. Attached patch should prevent that.. I prefer to keep the invariant that the editor only looks focused when it is focused as an input field, so that seeing the focused style means the user can start typing into it. As such, I prefer the workaround in f821ebabd064. Thanks. The manual did mention that you can pass an argument to showHint, but failed to refer to hintOptions. I've pushed a somewhat different patch that mentions both of these, and their relationship in 41e3936e. Great! Merged as 5dfab9c9. Thanks. Merged as 5abad5f. Thanks! Merged as 63999b89. I agree that that looked wrong. Merged as 322a80b7. Would it be possible to make these improvements without writing a completely new interpreter for this style of mode? I really don't want to maintain a second copy of such an interpreter. What precisely does your patch improve, and why did you decide to not use defineSimpleMode?. Merged as 37d59ff4. The tern addon works asynchronously to be able to use a web worker backend -- it's not remote, but the techniques involved are the same.\nThis here, by the way, is the bug tracker, not a discussion forum. Please post things like these here in the future.. That makes sense. Is there a reason not to do the same with the vertical scrolling and setScrollTop?. Ah, let's just merge this as it is then. Done as d8a95221. Attached patch should help.. This is intentional. Call refresh on the editor when you show it.. Thanks, merged as 9ab45baa. Looks good. Merged!. Does attached patch help?. > You also needs to replace the previousWord logics. \nAre you sure? They way I wrote eachWord, it shouldn't ever return a newline character or empty string.. Hi @adrianheine , I think you introduced this. Want to take a look?. Hi Joel, nice work. But in order to reduce the maintenance burden of this project, we're not accepting new addon functionality into the main distribution, so I encourage you to put this into a separate repository and distribute it as its own NPM package. It's not going to be merged into this repository.. Hi. We aren't accepting new modes into the main distribution, to keep the maintenance burden under control. The recommended way to distribute new modes it to put them on NPM as separate packages -- see the elixir mode as an example.. There's no addon, but it is possible to build such a thing with the core API. See this demo.\nAlso, please don't ask questions in the bug tracker. Use the forum for that.. Is this maybe a duplicate of #4713? Does the patch provided there help?. I can't reproduce it anymore. The patch (c98bd2205625c1358e003f0a3d0) was only added an hour ago. Make sure you have it and have rebuilt the library.. Use coordsChar.. Merged as a91b714. Thanks for spotting that. Merged as 41da8714. There's nothing like that in CodeMirror. You might be able to find a solution in JavaScript, since finding the language for a string has nothing to do with editing. It seems https://highlightjs.org/ can detect languages, but I'm not sure whether that part is available as a separate module.. Hi Drew, we're not accepting any new modes into the main distribution, so I suggest you distribute this as a separate NPM package. You could use the elixir mode as an example.. Clearing and restoring the selection like that can have all kinds of side effects (scrolling it into view, resetting IME state, messing with spell checking), so I don't think this is a good idea.. Does attached patch address this? It conservatively restores selections only when they were inside the editor and the redraw changed them. Also makes sure to keep selection direction intact.. Does patch ea8aa6b help with this?. I wasn't able to reproduce this. Does adding update.force = false at the end of the loop body in postUpdateDisplay remove the problem?. Forced updates are used to handle some types of display changes that the regular change-tracking doesn't handle, so they are expected to occur. The update object isn't being recreated, and since nothing is clearing the flag, it seems quite probably that it can prevent that loop from exiting.\nAttached patch makes this change.\n. The code looks correct. One thing that sometimes comes up with bundlers or module loaders is that due to resolution shenigans they'll consider the codemirror module you import directly a different module from the one that an addon module imports, and thus it'll register its functionality with a copy of the main module, and the one you get doesn't see it. One way to test this is to add a console.log to codemirror.js and see if it gets shown multiple times. (Though if modes are working, that's probably not the issue.). The crash happens because when the editor starts up, CodeMirror.scrollbarModel.simple is undefined, which is set in simplescrollbars.js. So there's not a whole lot that can go wrong. Are you sure the console.log in codemirror.js only ran once? (I.e. if it ran multiple times, the module -- and thus also the scrollbarModel object -- is being duplicated).. Hi, you should register the handler this on the completion result, i.e. on the object that's returned from your hint source function. There is an endCompletion event fired on the editor object, but that only happens after completion finishes, and doesn't allow you to intercept the effect of the completion.. It is in the documentation, I assume that's where you got the event name from. The idea is that the place where you'd want to register these is the completion source, so they are local to that, not to the editor.. I'm not seeing this on Chrome 57 on Debian\u2014but it may well be that this is dependent on the events generated by the trackpad driver, in which case it'd be tricky to reproduce on different hardware.. Thanks for spotting that. Merged as 51707934. Thanks. Merged as e29b193. Thanks for noticing that hot mess. Mode tests shouldn't actually be part of the mode's demo page, and they definitely shouldn't be rolling their own test framework. I started porting these to the regular test suite, but they were so entirely trivial that I decided to just drop them instead, in 98f2d9b2.. Mobile Safari doesn't support editable elements inside a scrolling container. The only known workaround is to make your editor resize with its content.. Chrome on iPad is just a different skin around the same browser engine (Apple won't allow different browser engines on their platform, because of Apple reasons). Attached patch should help. It's also likely to produce false-positives for link highlighting if you're relying on brackets that don't look like links not highlighting, but given CodeMirror's limited lookahead, we can't have it both ways.. Can you define 'totally broken' and 'bad things' a bit more precisely? Trying this (I had to replace && with ; because setOption doesn't return anything), I couldn't see any problems during a few minutes of playing around (Chrome, Linux).. Hi. New language modes will have to be distributed as separate modules -- we are not accepting any new ones into the main distribution. See the elixir mode as an example.. Yes, that's the idea, to make it easier to distribute the maintenance burden.. I added a few small comments, and I have one more general reservation -- this doesn't seem to be functionality that Sublime Text actually provides, so I don't think it belongs in the Sublime Text bindings. I guess the modifyWordOrSelection is helpful to have access to, but I don't think that's enough justification to put this here.\nAdditionally, we have a rule of not accepting new functionality into the distribution that could be created as an addon. Is copy-pasting modifyWordOrSelection, along with your new code, into a separate addon and putting it on NPM as, say, codemirror-case-conversion, an option for you?. Great, thanks for understanding.. The usual solution for this used by other modes is to not have indent mess with indentation inside strings or comments. Attached patch fixes this for Go.. Don't use the git repository as an installation source. Use the NPM package or get the .zip file from the website, both of which contain the built library.. Thank you. Merged!. This isn't supported. You can do lookahead by calling stream.eol() after every token, and styling it as an error if it's not supposed to be the last token on the line, but you can't add tokens where there is no text. Alternatively, emit a line- style instead of adding the error class to the last token, and add a CSS rule that adds a marker to such lines using :after.. Thanks! Merged as e47753c. The bug tracker isn't the right place for this, since the linter is working. If you want someone to look at your code and try to spot the problem, you can try the forum or stackoverflow.. Thanks. Merged!. Great. Merged as 2fb70c6d. Looks good. Merged as 4c625b7a. Can you add tests for this feature?. Thanks! Looks good now. Merged as 75add6f4. The ones that are part of the main module can simply be gotten off NPM and required as, for example, require(\"codemirror/mode/javascript/javascript\").. Is the problem that such a character 'counts' as two characters in string offsets? If so, that's intentional -- JavaScript (unfortunately) represents strings as UTF-16, so 'astral plane' characers like this take up two string indices, and short of writing our own string representation, there's not much JavaScript libraries can do about that.. I am not aware of a CodeMirror addn that does this. There exists a Brackets plugin, though. Since Brackets is based on CodeMirror, you might be able to get useful inspiration from that.. JavaScript functions will return undefined if they fall off the bottom of the function body, so there's no need to add an explicit return statement when undefined is an acceptable return value.. Merged as d599d656. See attached patch.. Thanks! I've merge these, except for the changes to pug.js -- there it looks like these functions are all part of a 'family' of function that may use the state argument, and it'd be an easy refactoring mistake to make one of them dependent on state again, which will break if the, technically spurious, argument isn't passed.. Do I understand correctly that the idea here is to do a kind of binary-subdivision-sized linear scan, where steps start large but shrink as the code overshoots its goal?\nWhy did we stop doing a regular binary search (in visual positions) for this again? (I think we talked about this at some point, but I forgot.). >  but that would require having logic similar to moveVisually.\nThe old code just called moveVisually X times to move X characters, which worked. So you'd do the binary search not in string-index space but in visual-position space. Probably the fact that visual order is now dependent on rendering makes this impractical.\nSo yeah, merging this!. Duplicate of #4740. See c3bf7122. What do you mean by keyboard trap?. Ah, that makes sense. I've pushed an alternative patch (3091a34) since yours wouldn't re-enable the textarea when readOnly is set to a different value again.. Thanks. Merged as dda5d722. It should be possible to select parts of the code using a regular (long-press on Android) text selection, even with readOnly=\"nocursor\". Could you elaborate? As it is, I have no idea what you mean.. Solved via #4764 . Makes sense. Merged as 5600b5ed. This is a necessary effect of CodeMirror architecture. See #221. Thank you. Merged!. There's a demo showing how to do this on the website, but this isn't going to be the default behavior.. This sounds like a good idea, but you'd probably have to implement it yourself and submit a PR, since no one is actively maintaining the vim bindings.. Solved via #4775. Formatting is no longer something that CodeMirror does. You'll have to search for a separate library that handles it.. Attached patch should help with that.. Merged as 27de924e. This is a browser issue -- CodeMirror tries to handle copy/cut events and put the appropriate text content on the clipboard. I.e. the HTML that is used to render the code should not be the stuff that ends up on the clipboard. This appears to be working in my Chrome (Linux) -- if I copy a bunch of highlighted text and paste it into a contenteditable element, I get plain text, not colored HTML.\nI don't have XCode set up and I don't really feel like jumping through all the Apple hoops required to install it, so could you verify that when you paste into a contenteditable HTML input, you're also seeing the problem?. Right, both vim and github's textarea only take text, so they won't use the HTML content.. No, it shouldn't, which suggests that the native copy behavior is taking place. But on my Chrome, it isn't.. So what I'm doing is copy a bunch of text with blank lines from a CodeMirror instance, and if I go to vim and do 'i' 'ctrl-shift-v', it is pasted, but doesn't appear to contain zero-width spaces.. > Does anyone know what the motivation for using a zero-width space as opposed to say a non-breaking space is within CodeMirror?\nIt has zero width.\nAs I mentioned before, these are in the DOM, but there should be a clear separation between what's in the DOM and what you get when you copy the text (where CodeMirror's copy handler gives you a nice, clean textual representation of the selected content).\nAre you doing something like setting the editor to readOnly: \"nocursor\" or selecting across it when copying? If so, yes, you will likely get an effect like this, but there's unfortunately no good way to override the copied text for some DOM content, you can only override the entire copy event, and CodeMirror only does that when it is focused.. > Yes, would you mind explaining why that is an issue?\nBecause, as I described, that won't allow the editor to be focused, and thus its clipboard event handlers won't run.\nreadOnly=nocursor has a bunch of issues like this, and will be dropped in the next API-breaking version.\n\nSee example below with readOnly: true.\n\nYour screenshots show that you're getting the DOM selection, not the editor's own selection, so I suspect something went wrong with your test and you're still using nocursor.\nIf you go to the online demos on codemirror.net, you'll see that the problem doesn't occur there.\n\nNot ideal, but I believe this will work in the short term.\n\nUnlikely. This'll cause all kinds of problems\u2014the editor does not support random DOM mutations in the content it rendered.. If you're just rendering code, you might want to look into the runmode addon, and generate simpler DOM that doesn't have any editing-related cruft in it.. Thanks, merged.. Please don't ask the same question here and on the forum, that just fills my mailbox and this bug tracker with duplicate junk.\nRef: https://discuss.codemirror.net/t/payloads-in-text-markings/1270. > Can we change the behavior of atomic to allow placement of the cursor inside the marking, but prevent editing?\nNo, that's what readOnly does.. No, I mean the readOnly option to markText. You can add your own handlers on the marker to make it behave like this. That's not going to be the default behavior, because for a lot of markers it makes no sense.. Clearing and deleting isn't that hard, and that's the way to change markers in CodeMirror.. Thank you. Merged as 782fd40e. Do I understand correctly that this is about unicode string normalization? I.e. two different strings denoting the same text, which should be normalized before comparing them?\n. It appears that most browsers support String.normalize nowadays, so it might be possible to make the search code normalize strings. The difficult thing there is associating offsets into the normalized string (which is what you'd get from searching after normalizing) with offsets in the original string (which you need to point at the match in the editor). There's already something like that happening for case-folding, but that can be done one character at a time, which isn't the case for unicode normalization.\nIf somebody wants to work on this, I'd be very grateful.. (Maybe, though I'm not sure yet, normalizing to NFD form always decomposes code points, never combines them, so that might be safe to do one character at a time.). Attached patch introduces normalization using String.prototype.normalize, but while that does help with things like precomposed characters vs extending characters, it doesn't appear to have any effect on the cases you describe -- it doesn't normalize these characters, and it doesn't appear that JavaScript comes with a built-in way to do that.\nOne option would be to allow code to pass a custom normalization function, and to write language-specific normalizers (or maybe a good one already exists -- I wasn't able to find it). But it wouldn't be a drop-in fix -- you'd have to explicitly set it up. Would that help for you?. The search cursor does not currently support providing a custom normalize function, because of the issue of converting positions in the normalized string to positions in the original string. Can your normalization function work one character at a time, or would it need to see the character's context as well? Do you need normalization for regexp searches or only plain string searches?. Okay, that's not currently possible. If you want to work on making it possible, a patch would be welcome. The main problem to solve is that, if we find the (normalized) search pattern in the (normalized) editor content, we need to be able to find the corresponding position in the original content. To do that, you'd need to know something about what the normalizer did. One approach would be to have it return a data structure or function that represents the changes it makes, and can be used to do this position mapping.. Could you be more specific about what you mean by passing a function as token, and what the use case you need it is like?. Does attached patch work for you?. This is going to have to be done in 3rd-party code, as you are doing, because I don't feel that adding that extra complexity and API surface to the core is worth it. I believe it should be possible to write your own SharedTextMarker-like class for these various elements that abstracts shared versions of them in a relatively clean way.. In which browser does it happen? I'm not seeing it in Chrome. Thanks, merged as 735ed37. Continued selection lines intentionally start from the very left of the editor content view, and even in this case, that seems like the appropriate behavior. Why is this a problem?. > having padding in the hundreds of pixels,\nWhat for? In general, random re-styling through renderLine, such as for example making the padding smaller than the default padding, isn't something that's supported.. Well, you're telling CodeMirror that this space is part of its lines, and it'll draw the selection accordingly. My recommendation would be to either create a narrower editor and just handle clicks on the sides manually, or to generate a single CSS rule that overrides the padding for the whole editor at once. I'm not willing to complicate selection rendering for such an obscure case.. I think you should scan backwards from the cursor position, rather than looking at the current line as a whole, but I don't understand the specific issue here. It does sound more like a client code problem than a CodeMirror problem though, so I'm going to close this issue. If you can reduce it to a simple case that shows the library malfunctioning, feel free to add further information.. Git blame can be useful for things like that. It points at f95803c2997b288ed2d7 which in turn points at #3849. I agree that the code does look very suspicious, and doesn't seem to help with the original issue. The state management in this plugin is a mess, and should at some point be cleaned up, but for now we can just drop that line and see if anyone complains. See attached patch.. > This is causing CodeMirror to never get Garbage Collected.\nWhat leads you to that conclusion? There's nothing in that event handler that's holding onto editor instances.\nOr are you hoping for the library code to be garbage collected? If so, what module loader setup are you using, that would even make this possible?. No, there is no way to unregister this callback. But again, if you look at its source, it isn't holding any references to CodeMirror instances, since it uses getElementsByClassName to access them on-demand.. > Looks like its the callback arrow function keeping the reference of its context.\nWhich callback arrow function? registerGlobalHandlers doesn't have any editor instances in its context, so it can't close over any.. No, that's not how closures work. I'm going to close this, since I see no evidence for an actual leak here, but if you have further (concrete) evidence, feel free to add a comment.. You can close issue if you consider them solved. Closing this one.. Thanks, merged as 227ffed. Most likely your module bundler ends up duplicating the main library (lib/codemirror.js) because it considers the relative paths to it found in the addons to be different from the plain 'codemirror' you use. This can usually be fixed by configuring your bundler differently, but I'm not familiar with the various bundlers. (To diagnose whether this is happening, you can add a console.log to the top level of lib/codemirror.js and see if it is run multiple times). Makes sense, merged. Yes, to be able to cheaply estimate whether a line number requires the number gutter to be wider or narrower than it currently is, the library requires line numbers to be plain text.. I also have no idea why that was being done, so I've merged your patch as ed012e60. When the number of lines in foreign (non-local) clipboard data matches the number of selections, the editor will paste one line per selection. For local data, the editor knows the exact selections that the data was made out of, so it will treat it as a single selection, even though it contains multiple lines. This is by design.. I don't think this behavior is documented anywhere at the moment. If I remember correctly, at some poine someone cared a lot about getting this behavior and I figured it wouldn't hurt.\nUnfortunately, there isn't much room for different commands when it comes to pasting -- the browser only allows us to access the clipboard when a native paste even occurs.\nWould an option to turn this (spreading N line external content pastes over N selections) off help for you?. Attached patch adds the option (pasteLinesPerSelection). Since pasting isn't a command, in the CodeMirror sense, but a regular DOM event, defining different commands doesn't work. You could, however, register a DOM handler for paste that runs before CodeMirror's handling, and sets this new option to the desired value based on the state of a modifier key. Does that work for you?. There is no 'under the cursor' in CodeMirror -- the cursor is defined as being between two characters. And the bracket matching prefers the character before the cursor when matching (but will fall back to the one after it if the one before isn't a bracket). This is entirely intentional and is the behavior shared by, for example, Emacs' bracket matching.. You could add a configuration parameter to matchbrackets that controls this, and call it with the right configuration from the vim bindings.. Oops, I didn't read your last comment properly and merged this (dbb2645c3d7d2). Looks like some vim commands need the character in front of the cursor to be considered.. Attached patch fixes the tests again. It'd be great if you could submit a separate PR with a documentation update for this new option. Thanks! Merged as f1d002ff. Things that are related are listed next to each other. You can use Ctrl-F to find something if you know its name.. Hi. Great job on the new mode. I'm not accepting new modules into this distribution anymore, to keep the maintenance work under control, so hosting and distributing it separately is the way to go now. You might want to consider packaging up the mode as an NPM package so that others can easily install it.. Merged as fdff25dfa76d7, but that text won't help people actually control these options, so I've followed up with f11978387aa and 1c186477f5bcf. See also #4433. Attached patch adds a note to the manual.. Oops, I thought we were already doing this. Thanks for fixing it! Merged as 1cbb7b73. I agree this is strange, but this is how regular vim behaves as well, so for a vim emulation mode it is appropriate.. Done in attached patch. Next time, for simple changes like this, I'd appreciate a pull request instead. Thanks. Merged as ee3a8f72. Are you using the text/x-pgsql mime type? Some dialects (mysql/mariadb) do support line comments starting with a #, but this is turned off for the Postgres dialect, so you shouldn't be seeing this if you enable that mime type?. That's a 404, but when I go to http://codemirror.net/mode/sql/ and run editor.setOption(\"mode\", \"text/x-pgsql\"), I don't see this issue.. Okay, sure, but as I said, I can't reproduce that. Maybe set up a jsbin/jsfiddle that shows the problem?. Doesn't seem to happen on FF 56 Linux. Could you try to figure out why it doesn't occur in the demos but does in some other situations? One possibility would be that it's related to the font.. Firstly, I didn't write the textile mode so I'm not really sure what it's trying to do, but yeah, styling html tags as comments is apparently the expected behavior, so a patch that breaks that seems like it'd be broken.\nThe code appears to be trying to match an HTML expression with a single regexp, which is famously impossible, so I'm not sure how fixable this is without a new approach. I don't know enough about textile, nor do I have the time, to work on this, but if you figure something out I'd be happy with a pull request.. Thanks, merged as 8dd9a875. It might be worthwhile to spend some time learning git concepts (rebase, in particular) in order to be able to submit clean pull requests (having a single patch and no extra stuff makes it easier for me to merge).. Thanks for letting me know! I've released 5.27.2 with a fix.. Oh, apologies, I pushed an identical patch after reading your issue, before I saw this PR -- 9d630718. Is the problem that a bunch of changes together take a long time? If so, have you tried wrapping them in an operation? For me that takes the time from too long to even wait for to 300ms. The issue is that CodeMirror still does redrawing at line granularity, so long lines can get expensive, and by doing the replaceRange calls one at a time, you're triggering a redraw of the whole line for every call, which is very quadratic.. Yes, if that's workable, that would probably help.. Good idea. Is there a reason we can't set up scrollToPos itself to be intelligent about position stickiness, so that we can simply store the same position as from and to here, and let a more primitive operation handle it?. Looks great! Merged.. Merged, and followed up with f1319c8d, which makes sure adjustPos is using the right conversion function.. That sounds reasonable. Merged as 449eab87 . That's interesting. CodeMirror, as a script, doesn't even get direct access to the clipboard, so I'm not sure how this can happen.\nDoes IE11 copy stuff to the clipboard when you drag it?. Only for CodeMirror text, or for any text?. Thanks, merged as 1864e223. Thanks, merged as 03d99e5. Use setOption. But that will only work when the vim bindings have actually been loaded which, if this is a random page that doesn't supply them as a user-facing option, they probably aren't.. Did you npm install first?. Which npm version are you using?. You need at least NPM 4, since we're now using a prepare rather than a prepublish script. (Or, you know, just manually do npm run prepare to build)\n[edit: typoed 'NPM 3' where I meant 'NPM 4']. Are indentUnit and tabSize set to the same value?. The command bound to ctrl-] is defined to add one indentUnit of indentation. If you want that to be a tab, make sure those two options have the same value.. Merged!. Making sure the cursor is visible on focus is intentional. What would you expect it to do instead?. But didn't you say the cursor had been scrolled out of view? How are you focusing the editor?. Does this happen in the demos on the website as well? If I go to http://codemirror.net/mode/javascript/ , put the cursor on the first line of the editor, blur the editor, move that line out of view by scrolling down, and then click in the editor again, I simply get the cursor where I clicked, without any scroll jumping (Chrome Linux).. \"native\" is the default scrollbar style, so the demos use that too. Something seems to have gone wrong with the branch -- it's full of changed (rebased?) versions of existing commits.. Merged as 7997c5d133. That should work (and does work for me, on Chrome).. loadMode doesn't really work with static bundlers -- it dynamically loads files on demand using require or script tags. It may be possible to somehow set this up with Webpack's code splitting features, but I have no idea how, and consider that out of the scope of this project.. Attached patch fixes this by switching the folding-compensation-code from a bidirectional search (which got stuck constantly overshooting its goal when the match started or ended inside a composed character) from a binary one directional search.. Ah, sorry, binary search is really easy to get wrong. Attached patch should help with that (and adds a test with that input).. The output of charCoords for wrapped characters is pretty much undefined, since browsers do wildly different weird things for those. This is why we have cursorCoords, which gives you the coordinates of an actual cursor position, which is easier to define.\nAttached patch makes goLineRight stable (i.e. it stops advancing when the cursor is already at the end of the line). Does that solve the problem for you?. Simply setting sticky to \"after\" is not the solution -- it's set to \"before\" for a reason, namely that in principle, the cursor should stick to the character it just moved across when moving right. When there's no whitespace around the line-wrapping point, it should appear at the end of the current line before moving to the next line.\n@adrianheine Do you think it would be safe to set the stickiness to \"after\" in moveLogically/moveVisually whenever a whitespace character was skipped?. Thanks, merged.. We're not accepting new modes into the main distribution anymore. The recommended way to distribute extra modes is as separate NPM packages, see for example the elixir mode.. Since it works in the demo, I expect you're doing something wrong, or at least unanticipated, but it's been ages since I worked with this code, so I'm not sure what.. The demo in the CodeMirror website? That one doesn't support multiple-file projects, i.e. it will never add a second file, so neither getFile not switchToDoc are of any use. Adding those lines does not break jumping to definition for me. It doesn't make jumping to asd work, since the server never loads a file which defines asd, but that's correct.. Try server.addDoc('asd.js', new CodeMirror.Doc('var asd = 1;')); (and remove the getFile option).\n. I don't expect it'd be a performance issue -- the data structure CodeMirror creates for a document isn't huge, and unless you have many megabytes of code, you shouldn't worry about this.. Thanks!. Seems like a good idea. Merged as c4174e0569e...d9e926358854f. Most likely you have custom fonts loading after the editor has already initialized, causing its layout to change after it's computed the cursor position. The solution is to call .refresh() on the editor instance after everything has finished loading, or to delay initialization of the editor until that point.. Sure, that'd be useful.. A pull request that adds these bindings to keymap/sublime.js would be great. I'd prefer to just do what Sublime Text does, without additional configuration.. If Brackets (which is CodeMirror) already supports this, a good start might be to look at their implementation.. Yeah, the sublime keymap should definitely implement what sublime does.. Thanks! Merged.. Thanks, merged. Eol is supposed to be all \\n, but it's very well possible that that hasn't been enforced everywhere.. Thanks, merged as 3073bdd9. Agreed, merged as 9a223d81. Thanks for working on this. Merged as 0f8d7593. LaTeX is not part of Markdown, so this doesn't really belong in the Markdown mode. You can set something up with a multiplexing mode, see this comment for an example.. There's an endCompletion event that fires when the completion widget closes. Since an editor-wide event handler doesn't know anything about the completion that happened, I don't think having an additional pickCompletion would help.. I don't want to change the current behavior here. If you want control over the place of the line number gutter, just include it explicitly in your gutters option.. The demo sets gutters: [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"]. If you want to toggle line numbers while keeping the gutters in the same order, you have to make sure you also update the gutters option when re-enabling line numbers. The same happens with your patch, if you happen to want them on the right.. Looks good. Could you use messageHTML as a property name instead to make it follow the general capitalization style of the rest of the code?. Thank you. Merged!. I think this is fine as it is. Merged as cb01fa18. This has nothing to do with CodeMirror -- you're not escaping the code when you put it into your HTML, which will cause </textarea> to close the textarea it's supposed to be part of.. Thank you! Merged as b11179d1f6e1a. I've added patch 4292c2ff1bad0, which changes the default token type to \"builtin\", so that regular themes will style these (token types in the markdown mode aren't terribly semantically-meaningful at the moment, because at the moment the widely themed set of types doesn't cover a lot of prose-specific types). So do I read correctly that you'd need platform detection to determine whether to set it to none or to off? I.e. on iOS <5 you'd still need off because none isn't supported? If so, that's awful, and I'd prefer to leave it as it is until they actually remove support for off (if ever, since it looks like that'll break quite a lot of websites). Have you tried running that script in a browser? The browser will also end the <script> tag at the first </script> it sees, regardless of whether that's in a string or comment or whatever, so at least in the case of script tags, the behavior you are reporting is the correct behavior.. > Would it be possible for us to ignore quoted or nested closing tags?\nNot with the the multiplex helper -- that one will eagerly look for the closing match you gave it, and stop using the inner mode as soon as it finds it. You'd have to write the wrapping mode yourself to do something like this.. Attached patch should address this.. prompt is just called as a fallback when you don't have the dialog addon loaded.. You're very welcome!\n(Consider using the forum, not the issue tracker, for this kind of communication, though.). I think change is harmless and a slight improvement, since if you want to override the whole background, you're likely to set a fully-covering background image, which will hide the background-color anyway. I've gone ahead and merged this as 3ec7088b. Can you create a minimal stand-alone demonstration of the issue? I can't debug that page because I have no idea what it's doing.. Attached patch should help with this. Does it solve your issue?. Yes, mode tests are great to have -- I'm often too lazy to add them, when I'm not too worried about regressions, but it's not that I don't like them.. Hi, I'm sorry, but I think this is something users can research outside of our docs, and I don't want to tie our docs to some specific compression page that may stop working in the future, so I'd rather not include this section in the manual.. This seems to only occur (or at least be much easier to reproduce) when the editor's direction is set to RTL. @adrianheine Do you still have plans to look at it?. Thanks. Merged as 0927b971. Thanks, I've merged this -- I agree it's a reasonable way to control damage for now. Thanks, that's useful!. I suspect we'll have to start treating 'broken' whitespace characters differently from other characters, in that we consider the position after them to be on the next line, same as the position before the next character, rather than on the line where they start. How to reliably/efficiently recognize them might be tricky -- but they do tend to produce weird bounding boxes (as per getClientRects), hopefully in a somewhat consistent way across browsers, so that the measuring code can be made to recognize them from those.. Thanks! Merged.. > Btw, do we frown upon adding custom props on stream object?\nYeah, I'd prefer if you didn't do that.\n\nI'd like to either cache some line-specific data\n\nA kludge I've used in the past is to cache stuff using two mode-local variables, one with the cached value and one with the stream object for which the cache is known to be valid. That way, you relatively convenient caching without doing weird things.. Thanks for the patches! Going by the tests, those are some great improvements. I was of the opinion that the Markdown mode would have to be rewritten from scratch at some point, but I guess moving it towards CommonMark compliance one step at a time might also work.\nMerged as 4d448b2976...c81346e2c235961292c. The gfm mode definitely needs to be rewritten, to either be a proper wrapping mode around the Markdown mode, or just a different configuration of the Markdown mode (i.e. moving all its logic into conditionally enabled features in markdown.js). It's currently keeping redundant state, which is very error prone, and is generally a pile of hacks that doesn't work very well.. > Fore sure. But before then, what I'm suggesting is to move fencedCodeBlocks over to base markdown since they belong to CommonMark by default.\nOh, right, that's a very good idea.. > Similar to the native textarea, is it possible to setup CodeMirror to wrap(lineWrapping:true) after an exact number of characters?\nNo. You can measure monospace characters and set the width to a multiple, but line wrapping is done by the browser, so variable-width characters won't wrap on character count.. The problem appears to be the new X<y> syntax, which is parsed as (new X) < y. I haven't been able to find an actual specification of TypeScript's syntax, so it remains guesswork what is actually allowed. Do you have any link to docs describing the syntax you are using here (angle brackets after new)?. That's about type expressions, but I guess https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md#4.14 does describe this. It's interesting that they just went ahead and broke existing syntax (new Date < something does happen in real code, for example), but I guess this can be handled. See attached patch.. Thank you!. Does attached patch help?. Great!. This isn't currently supported, but it would be possible to write a variant of the the default (native) scrollbar style that always reserves a gap for the vertical scrollbar. I don't think this is a common enough requirement to include it in the core library, though.. You could try creating a new subclass of CodeMirror.scrollbarModel.native, and overriding its update method to always return at least the width of the native scrollbar in the right property of the object it returns. To get that width you could read cm.display.nativeBarWidth (but that's not guaranteed to stay).. This doesn't exists as a feature of the library -- you'll have to compute the width you want by taking padding into account (which you can control using CSS). Attached patch should solve this.. Having the same extension associated with multiple languages isn't a good idea -- I see that was already the case for .v, but that should probably be fixed too. The idea of this metadata is being able to map from an extension to a (single) mode.. Thanks! Merged as d02b1198. This is not an issue that I can do anything with. Feel free to provide actual information in additional comments. For now, I'm closing this.. I think this is a duplicate of #4142 ,  though it's interesting to see that it also occurs for vertical flex layout. A solution is to introduce an additional wrapping <div> around the editor, so that it's direct parent isn't display: flex. Firefox and Safari appear to have a bug where they'll ignore the static height of the .CodeMirror div in this situation. (At least, the way I understand the spec, that's not the correct behavior.). I don't have any suggestions (not sure anyone has tried to run the editor in Excel yet), and I'm sorry, but Excel is just not a supported platform, so you're on your own here.. If I set the outer page to RTL and the editor to LTR in Chrome, I'm seeing an extra, badly behaving scroll bar on the left of the editor, overlapping the gutter. That could be fixed by moving the default direction: rtl to the top container (.CodeMirror). Does that sound reasonable?\n(Eventually, we'd like to support scrollbars on the left, but we're not there yet.). Much better! Merged.. The next release (5.29.0) will be out in two weeks (I do regular releases monthly, around the 20th). Which browser did this happen in? I'm not seeing it in Firefox or Chrome. The editor definitely doesn't register any global handlers related to this, so I'm not sure how it can be happening when it's lost focus.. I can see this happen now -- even when the editor isn't focused. My best guess is that Chrome is using some kind of heuristic to find the element that the user might have meant to click on... the mouse target isn't related to CodeMirror there, and the focus isn't on it, so from what I understand of the DOM, there really isn't any reason to deliver the pasted content on the editor, yet it does. No paste event is fired, either.\nThe fact that this only happens up to a certain pixel distance from the editor seems to also point in the direction of a misguided heuristic. But interestingly, I can't reproduce this with a plain textarea, so it might be possible to work around it by changing some DOM structure or CSS value ... I haven't been able to figure out such a workaround yet though.. Interesting. I've never had middle-click paste in CodeMirror work in Firefox, and right now (with Firefox 57) middle-click still does nothing -- whether I click inside or outside the editor. Which Firefox version are you using, and do the steps you outlines above cause actual pasting to happen on your system?. On closer look, this seems to be a behavior that Chrome exhibits for all DOM nodes that aren't input fields or textareas \u2014 when a middle mouse paste happens, that's not over a regular input field, it searches for a nearby valid cursor position, which in this case will be in the text inside of the editor, and fires the paste event on that.\nSo it appears that what we're seeing here is what the Chrome developers intended to happen, probably for usability reasons. I also don't see an easy way to disable it, so I would propose to just leave it as it is. Can you live with that?. Middle-clicking anywhere on this page fires the event handler, though the div only extends to the border.\n```html\n<!doctype html>\nHello\n\n  document.querySelector(\"div\").addEventListener(\n    \"paste\", e => console.log(\"paste event on div\"))\n\n``. I suppose you'd also have to update the other dashes at line 39. In any case, this isn't a bug, so the issue tracker is not the place for it.. Makes sense. Merged as 2add03c7. See [this addon](http://cm/doc/manual.html#addon_panel). Ah, right, that's not currently supported, and the way you kludged it in doesn't really work well (the editor will get confused about its size -- it might show empty space when the dialog is removed again, for example). I suspect that for short-lived dialogs like search having the content shift is rather annoying, so I don't consider this a big priority.. You could use the JavaScript mode from the [google mode bundle](https://github.com/codemirror/google-modes) instead, which does this. Since variable and calls have the same syntactic and semantic structure in JavaScript, I'm not really interested in adding this distinction to the built-in JS mode.. Could you generalize this to a set of properties to be added to the request (or a function that's called on the request object), so that we don't have to keep adding new options for different query parameters?. Patch c42322890d75a7 should fix this, and I've merged your test case as a347f5e3cf84eaeb2a. (This was superseded by c42322890d75a). Thanks. Merged as c49bb5fed2a and followed up with 22861a03a517 (it'd be nice if you could run the tests or address failing continuous integration next time).. Oh, there's another test failing. You seem to have removeprivateas a keyword. Is that intentional?. Alsothis,throws,finally, andnull`. Adjusted the tests in 404d869. Thanks! Merged as c06c273afc78...55aa50667c2 .. Thanks, merged as a3970d6f. Merged as 616116ba . Thanks! Merged as f82a09a2. This is not a question I can understand, and it certainly isn't a bug report, so I'm going to close it. Feel free to open a thread with a clearer formulation of your question on the forum.. > I would like to ask that the cursor control feature be configurable, so that individual installations can turn the feature off if they see fit.\nThough I agree that this is a good idea (and the approach I'm taking in ProseMirror), that's not possible with CodeMirror's architecture, since the selection is entirely managed and drawn by the library, and thus the browser can't be much help here.. No, that definitely wouldn't be possible -- you can't highlight a textarea, so you'd be dealing with the full complexity of contenteditable. Also, a system that does only highlighting would be CodeMirror, it'd be something completely different.. There isn't currently an implementation of emacs-style search, but attached patch binds ctrl-s and ctrl-r to persistent search dialogs, which is a little better at least.. Maybe your mode scripts haven't finished loading when you initialize the editor? That would have this effect.. Try scrollIntoView. Could you test with attached patch?. These all seem to boild down to the fact that many screen positions will correspond to two logical text positions, and if you have text like RRRLLL (where R is rtl and L ltr), selecting from before the first R to after the second will span those two R's, but selecting from that position (which, in the string order, also touches the first L) to in between the L's will get you a region that only covers the Ls.\nSome editors seem to do something clever in the first case, apparently swapping the anchor and head of the selection during selecting in some circumstances, but it isn't clear to me how that would generally work.\nThe second and third seems to work that way in native textareas as well, and are really not avoidable -- a selection is a continuous range in the string index space, not the screen space, so yeah, if you cross bidi boundaries you're not necessarily going to see a coherent selected block on the screen. CodeMirror is definitely not going to change how selections work (and I'm now aware of any tool that does this, and as far as I know this is the expected behavior for RTL users).. Hi, could you provide me with a small file that helps reproduce this, and let me know which browser you're using? I can't get it to show up in http://codemirror.net/demo/bidi.html , which has similar text (HTML tags around Arabic content) on Chrome or Firefox.. I can reproduce this with that file (it seems to require a very specific line). Working on a fix now.. Attached patch should solve the problem -- the issue was a bug in the way mouse coordinates were mapped to document positions.. Indeed, I could reproduce the infinite loops, and I've decided to rewrite the relevant code entirely since it was too scary. See pull request #4968.\nYour second issue seems to be a bug in the selection drawing -- since if you delete such a selection, the tag is not actually deleted. I have to work on other things today, but will try to take a look tomorrow.. The selection issue should be better with patch 15b2903cc3.\nI'm puzzled how you can still be seeing the hang -- I can't reproduce it anymore, and the related code was rewritten entirely. Are you sure you have the code from the pull request (not yet in master) and have rebuilt lib/codemirror.js?. > I am on 5c087ac\nYeah, that's the master branch, which does not have these patches yet. You want to get the patches from #4968.. I've merged the update of the coordinate-to-character code.\nI think the issue with the non-deterministic selections was about whether the original click happened (a few pixels) in the RTL or the LTR text -- i.e. if you clicked the <p> tag, the selection anchor would be in there, which is near the start of the logical line, whereas if you clicked on the first Arabic character, you'd get a position at the end of the logical line. That is indeed confusing, so patch febbe7cb tries to 'fix' ranges created by mouse-drag by adjusting the anchor when it is on such a 'bidi jump' to point in the direction of the current selection head. Does that patch help for you?. Agreed, that is odd behavior. I've further tweaked the mouse-selection behavior in c7007784 and it now seems to do the obvious thing in this case and the corner-cases we discussed before. Take a look!. > Could you tell me what is the process for creating a distributable zip for posting cm updates to npm?\nI'm not sure I get this question right, but all I do when I publish to NPM is letting NPM run the prepare script in package.json (which runs rollup -c).\nAll these changes are on the master branch now, and they'll be released as 5.30.0 tomorrow.\nThe rewrite of the selection drawing and coordinate-to-position mapping might have effects in non-RTL scenarios -- those go through that same code.. Yes, this is a well-known problem with Android. Backspace is handled entirely by the IME subsystem and you don't get a key event for it. CodeMirror has some workarounds that try to detect it, which worked on my phone last time I tried, but they're hacks and I'm not surprised to see they still have problems.. It's in the library, so assuming you're not using an old CodeMirror version, apparently it's not working for you.. I'm not sure how much work the library is doing when initializing that object -- I'd prefer not to do that over and over again for every diff call.\nAlso, if you're going to bundle merge.js, doesn't it make sense to also bundle diff_match_patch?. > an alternative to my pull request might be to call:\n\nvar dmp = require('diff-match-patch')\n\nUnfortunately, diff_match_patch isn't distributed as a CommonJS module, only as a global-declaring file. (In fact, it seems like it has been unmaintained for ages, but I haven't been able to find another implementation that comes close to it in speed.) So yeah, that does complicate bundling.\nMaybe update the pull request to lazily initialize the object, but only once, reusing the previous value when it exists?. Great. Merged as 91817cc. Not for the 'show' part, but to compute it, use CodeMirror.countColumn(string, index, tabSize). string is the line, and since this is a static method, it doesn't have access to settings.\nIt does indeed appear the method wasn't documented. Patch e49a19f5 fixes that.. Thank you. Merged as 35a5139d.. (No one is actively maintaining the vim bindings, so note that it might take a while before this generates a response.). Fixed via #4985. I can't view this because the video site requires Flash, which has happily been purged from my system. Could you try hosting it somewhere else?. We're not using the hidden textarea on mobile, because that would prevent the user from selecting text through the touch interface. Instead, we set the content DOM to be editable using contentEditable. In many cases, backspace will just do the right thing there, but yeah, not always. This idea won't work, though.. Thanks, merged as 883fd008. > Since inline styles are generally pretty hacky things to use, and the rest of CodeMirror successfully avoids them, it would be nice to swap these with styling via classes in the default stylesheet instead.\nThere are inline styles all over CodeMirror. This just appears to be the only place where they are used through innerHTML.\nIn any case, no, if you're having trouble with this policy, I suggest turning off the policy. CodeMirror is written against widely understood and standardized browser functionality, and this idea of selectively forbidding random stuff just won't work well when you're using 3rd party code.. Good idea. Merged as 06ed8a17 . The key term here is distribution. You appear to just have gotten the repository, which isn't that. Get it from the website if you aren't using NPM for whichever reason.. The problem is probably that the textarea input style doesn't reset IME when a mouse event happens. Not sure when I'll be able to get to that.. Does this happen for you in the demos on http://codemirror.net/? If so, which browser are you using? If not, could you try to figure out which local CSS causes this?. > I want to remove scrollbar, so I add style.\nYeah, that's not supported. Don't touch the overflow on CodeMirror-scroll.. What a mess. I'm not sure why I deprecated that anymore. But yeah, undeprecating is probably the right call. Merged as 5ef6dfc3. Hi. We're not accepting new modes into the main distribution anymore, to keep the maintenance burden manageable. The recommended way to distribute a new mode is to put it in on NPM in a separate module -- see the Elixir mode as an example.. We aren't accepting new modes into the main distribution anymore. Please distribute modes as separate NPM packages, as the Elixir mode does.. You can't focus a nocursor editor, so you simply won't be able to send key events to it, and thus using a hotkey to activate search is going to impossible. This is expected behavior.. We aren't accepting new modes into the main distribution anymore. Please distribute modes as separate NPM packages, as the Elixir mode does.. Have you tried using CSS to hide the built-in selection (.CodeMirror-selected { display: none }) and using the markselection addon to style your selection?. > but is it possible to highlight past the end of the line with the markselection addon?\nNot easily. You could add more code to add style non-breaking-space widgets to every line whose end is selected.. > I can't seem to place the widget after the actual line.\nYou don't need to -- if you place it at the end of the line, it can take up space and thus extend the line.. Thanks, merged.. Right, the set of keys to bind is static at the moment, because (due to nested modes) it is not possible for the plugin to see in advance which characters are defined for every mode it will encounter. One solution might be to add a utility function to the addon that allows user code to add new characters to the keymap. Do you want to implement that?. Attached patch should help with this.. In which browser is the CodeMirror instance running?. That's not one of the supported browsers\u2014if you can reproduce this in a major browser, let me know, but if not, you'll have to try to debug it yourself. (It sounds like CodeMirror's copy handler is somehow not running, and webengine's native copy behavior is happening instead.). Yeah, this will leak keymaps. Could you take a look at patch e716c17e, which allows you to pass a set of pairs as an option, and the addon will make sure they are bound, works for you?. Thank you! Merged as 850a92fb. This will break when the editor uses contenteditable input style (which is recommended for situations like this anyway, since it's much more accessible). Does patch bde68f12 work for you?. Great!. Reading the spec, yes, I definitely agree. Reverted in attached patch.. Oh, ugh, TypeScript is very creative. The decorators proposal doesn't allow decorators on parameters, but it appears TypeScript does. See attached patch.. I guess so. See 20f3c354 . I don't have access to iOS 10.3 (9.3 seems to not have the problem). If you can provide me with more information about the errors (possibly with a stack trace) that might help.. > Unable to simultaneously satisfy constraints.\nThat really doesn't sound like a CodeMirror problem (nor does anything else in that log).. > then there is no window.HTMLHint for other scripts to interface with.\nIsn't that a good thing? Many of the linters aren't distributed as CommonJS, so they use globals because they have no choice. But integrating with module loaders is definitely preferred.. > Expose the HTMLHint the object on CodeMirror for plugins to extend.\nCouldn't those plugins simply also require it?\n\nIt seems that for JSHint, CSSLint, and JSONLint that these available on NPM as CommonJS modules and could be updated to use what CodeMirror is doing for HTMLHint if that is the desired path instead of relying on globals.\n\nI agree. Want to submit a pull request?. > Not really, because the CodeMirror bundle would be shipping with core.\nAdd a statement like window.HTMLHint = require(\"htmlhint\") to your bundle.\nClosing this, looking forward to further pull requests.. I can't reproduce it anymore. Do you see an stack trace in your dev tools when it happens?. This has been been fixed as part of #4926, specifically in patch 68b4f44e3c6ea78. I don't think the PR is correct (see comment there), but maybe we can approximate this by requiring at least one number in the hash? (Letter-only hashes exist, of course, but are relatively rare -- 0.1% of seven-character-hashes). If you can find a regular expression that expresses this (without getting ridiculous complex), a pull request would be welcome.. GitHub does allow linking of stand-alone hashes (as in 67379b827d111c97), so I don't think this is correct.. Yeah, I see your point, I've added a test case for that and fixed it the way I described (different search for bidi spans when in wrapped content).\nThe total complexity of this is now at least as bad as the old algorithm (though I added more comments so the line count isn't representative), but I think the new code is a little easier to reason about and hopefully more robust.. I've gone ahead and merged this as 68b4f44e3c6e, but if you have any further concerns definitely let me know.. > Is that a correct behaviour ?\nNo -- the activeTouch behavior should probably not kick in for gutter interaction. I guess we'd need something like the check in gutterEvent at the start of the touchstart handler, but in a way that works with touch events. Do you want to try to implement that?. Oh, docs are always nice, but why the extra check? typeof definitely won't return \"string\" for null or undefined.. Hah, yeah, I should stay away from my laptop after 20:00. Thanks for the fix, merged!. That doesn't exist in the main distribution, but you can write it as an addon. I think this already does something like it, but I'm not sure how reusable it is outside of that project.. The touch-related part of this has been merged as  eb18ac4e7ca0153, and cleaned up in dcbfd6e7053d1ef. GFM does not use hash marks to identify commits, so this breaks highlighting of commit hashes. See patch e5a13e62 instead.. @adrianheine I think the idea behind that test is to not muck with focus when the document isn't active. I added it specifically at some point (aebf68bf574bfc), but I can no longer figure out why (I don't appear to have closed any issues on that day). I agree that there's probably not much that can go wrong with focusing the editor when it receives key/mouse events, so feel free to remove it.. Sorry, no, I'm not interested in connecting tools I don't use and hadn't even heard of before to my repositories.. CodeMirror's search dialog doesn't work like a persistent dialog, so whenever the editor is focused, it is not searching. For what you're trying to do, it's necessary to write your own search dialog.. Thank you. Merged as ed645438!. Merged!. Merged as 697556c. Are these the output of a  fuzzer?\nMost of them weren't too hard to fix, and are fixed in 036beb54. Distinguishing between keyword let/await and regular identifiers by that name isn't something this mode does yet, since it seems the world is moving on from using them as identifiers. It's probably also not too hard, but it seems like it's not worth it.. Sure, that's small enough to integrate. Merged as 282cf366. Looks harmless enough. Merged as 60f39516. Thanks!. That forces the HTML mode to be htmlmixed rather than whatever text/html is bound to, removing flexibility.  I was thinking something more along the lines of ad9732ae. Thanks!. What automatic formatting function?. That's no longer part of CodeMirror since v3, so I suggest you find another library that does it.. Could you provide example code that leads to this crash/hang?. You could write an addon that does this, but it isn't a feature that's currently provided, so I'm not going to keep an issue open on it.. Thanks! Merged as bb0e1c3f. This works for me. Can you submit a code example that reproduces it?. It does produce two selections, but since the primary selection is rendered as a DOM selection, you're only able to see it when the editor is focused. This is somewhat confusing, I agree, and is due to the way the contentEditable input backend was bolted on to a system that was designed without it in mind, but it's by design.. Thanks!. This tends to happen when the layout of your editor changes after it is initialized, for example because a font finishes loading or its css changes. Calling refresh when the layout has stabilized is the recommended solution.. Not that I'm aware of.. We're no longer using IE6, so even if you have event handlers on a DOM element, if the element is removed from the DOM those handlers will get garbage-collected. Since copy/paste handlers are registered only on the editor, removing the editor from the DOM is enough to clean them up.. Nope, I don't think this has come up before. I'd cite it as a website, http://codemirror.net, I guess. Something like\n@online{CodeMirror,\n  author = {Marijn Haverbeke},\n  title = {CodeMirror},\n  year = {2007--2017},\n  url = {http://codemirror.net/}\n}. Thanks, merged as 5fd2133b. Acknowledged. This is surprisingly hard to get right. I started on a solution, but I haven't had time to finish it yet -- will get back to it at some point.. With patch 9f7ce5a47de1181, the drawn selection should correspond to the actual selection in this case .. This error does not come from CodeMirror.. This behavior is a consequence of the way CodeMirror scrolls the selection into view -- it'll make sure the selection head is visible. Is selecting multiple lines in a way where the relevant context is somehow in the same vertical column for all the lines a common thing? And if so doesn't simply shift-clicking solve that problem very easily?. I'm not aware of any. And this is the bug trackers, which isn't really the place for questions like this.. > But that just seems wrong, at least for my use case.\nThat may be so, but it's right for most other use cases, since you're usually interested in a document position, not a character box, so this is a feature, not a bug. You could look at the (currently undocumented but unlikely to go away) xRel property on the position returned to adjust, if you want.. Would just replacing all instance of /** with /* help? We're not using the JSDoc comments to generate docs, and they are too sparse to help a lot with any tooling, so they might as well be disabled entirely.. Thanks. Merged as e85f937. There is no 'bower release'. Bower is mistakenly pointing at this repository as being a downloadable package, which it isn't, and it doesn't seem the Bower community can get its stuff together to the point of fixing that. I've stopped caring. Use NPM.. That's a lot of corner cases in a few lines of code. Attached patches seem to improve the highlighting.. Nope, this is intentional \u2014 the behavior in question is indeed potentially scroll blocking, but we need it, whether browsers complain about it or not.. I've attached some fixes. The remaining cases, I don't care much about (patches welcome, but I'm not writing them).. We are not accepting new language modes into the main distribution. The recommended way to distribute new modes is to create a separate repository and publish them as separate NPM modules with a name like codemirror-mode-icu.. Good question. It's not very well-factored or easy to reuse at the moment, and we're hoping to move to a proper test runner in the near future, so I'd say just copy it and change it to match your tests. Eventually, it'd be nice to have this as a reusable module, I agree.. Where are you even getting these terrible pieces of code? Anyway, I think I just fixed this 5 minutes ago with a patch to another issue full of pathological code (#5016).. See also https://github.com/codemirror/CodeMirror/issues/4052 . To be able to reliably close quotes, where you can't tell the difference between the closing and the opening one, the addon needs help from the mode to see if it's opening or closing a string. But since the markdown mode (rightly) doesn't tokenize quotes as strings, that won't work there.\nI'm also not sure how to resolve this, and I'm very wary of adding more special-case kludges to closebrackets.js, so for now this is just not supported. If you find a solution, let me know.. That sounds like a good idea, yes.. Your screenshot link doesn't work.  But check whether indentUnit and tabSize are the same.. And indentWithTabs is true? Because I definitely can not reproduce this (also, the mode has no control over the characters used for indentation, so this isn't related to the SQL mode).. Can you amend the patch?. You can update a branch that has a pull request, the new commits will appear in the pull request.. Thanks. Merged as 1951460e52e2e. It's defined in addon/fold/foldcode.js \u2014 make sure that file is loaded, and that it is accessing the same instance of CodeMirror that your code is (bundles sometimes get confused and include multiple instances of a library).. You appear to be trying to lode runmode.node.js in the browser. That script is intended only for node.js. Look, this never worked, also not in 5.19. exports is defined by the CommonJS module system, which Node implements. You're loading a file you shouldn't be loading and I can't fix that for you.. Thanks, merged as dcdf0146. Directly messing with the CSS of an editor like that isn't supported. CodeMirror keeps track of the height of each line, and if you change that, the editor will get confused. You can call CM.refresh() to make it update itself, but still, the things you did to DOM nodes that you don't own are likely to be overwritten again when using the editor. So you really shouldn't be doing that.. Are you talking about the mode overlay addon, or about overlays in terms of addOverlay/removeOverlay?\nIn the second case, there's an implementation in this branch, but I'm still waiting for feedback from a customer before I merge that.. In that case, a wrapping mode sounds more appropriate. I.e. don't use the overlay addon, just write a wrapping mode from scratch which calls through to the inner mode's token method, and then only adds its own styling when that is one of the token types you're interested in.. I've merged the baseToken branch in 79d266e6 (see the manual.html change in that patch), which should allow you to do the addOverlay thing.. I'd be interested in that as a pull request, but since Markdown doesn't care, I'm not going to work on it myself. (Also, if you implement this, make sure it leaves lists that use 1. everywhere intact\u2014if people are intentionally not numbering, the addon probably shouldn't get in the way.). Thanks. Merged as e5e2aefd. I took out the call to repeat since we're still targeting older JS runtimes that don't have this method.. The JavaScript mode doesn't support \\u escapes in identifiers. This isn't a feature that seems to be used in real code, so it's considered out of scope.. That's out of scope for the main distribution, but could be written and distributed as a separate module. There's one here, but I'm not sure it still works with the current code.. Thanks, merged as deaa842d. Now that the core library is modular we really shouldn't be duplicating things like this anymore, but no one has gotten around to setting up a build process using the main sources for runmode.node.js yet. Thanks. Merged as 42a26328. Thanks for noticing that. Attached patch should help.. Merged, and followed up with cf799958 to make sure the script that adds all names from the git history to that file on release doesn't re-add the old name.. I can't reproduce this in Firefox 57 Linux. Could you try to debug what's going on? I.e. is there an error in the console? What is cmKey in keymap/vim.js being called with when you press escape? Etc.. CodeMirror (and JavaScript in general) always uses UTF-16 encoding. En- or decoding other formats should be done outside of the editor.. This is unlikely to be related to the mode. Probably, something about the layout of the editor changed (CSS change, font loading, animation) and the editor is still using outdated measurements. Call the refresh() method when the editor needs to re-measure its content, and mouse clicks should be properly interpreted.. I guess you could write a linter function that does this, but there's no such thing in the distribution.. These reference different options -- the boolean one is an editor-wide option, which en- or disables the feature, and the mode metadata field by the same name is indeed expected to be a string.. Please see the manual. Looks good. Merged as 97290a68. Hi. We're no longer accepting new modes into the main distribution. The recommended way to distribute new modes is to maintain them in their own repository and publish them to NPM as separate packages\u2014see for example the Elixir mode.. This isn't a helpful bug report. It fails to explain what goes wrong. Also, WebView isn't a supported platform.. Are you sure that's valid TypeScript? The way I understand it, type parameters in expressions may only appear in new expressions. In any case, they'd be very ambiguous with less-than/greater-than operators in an expression like this\u2014this.a < Type > (foo) is a valid plain-JavaScript expression.. Daniel Rosenwasser pointed me at the relevant part of the spec on Twitter, and patch 49065345 implements the disambiguation.. Sure, that'd be welcome!. That looks like what CodeMirror does when it is missing its stylesheets. Could it be that codemirror.css isn't loaded?. Yes, agreed -- highlighting on invalid code isn't, generally, something we intend to precisely define.. Note that your code example isn't valid TypeScript (no method around the throw statement), but attached patch fixes the issue that can be seen when you correct the snippet.. Attached patch should help. What was happening was that these markers are defined to automatically get cleared when the selection enters them, but since this one spans the whole document, it was immediately cleared because it necessarily covers the selection. That caused two pieces of styling (the collapsing and the class on the top line) to get out of sync.. I suspect the issue is with your event handler -- you're handling the enter event by moving focus to CodeMirror, but without canceling the event, which will then end up in CodeMirror itself.. I don't see this happening on Chrome 62 Linux. Do you see it on the demos on the website?. At a small enough zoom level (50%) I can reproduce this. Our cursor is an element with a 1 pixel border, and it appears that at some point Chrome just rounds that down to zero (not just on empty lines, also in some -- but not all -- other positions).\nSo that's unfortunate, but I don't know how to work around it without making the cursor fatter in all circumstances (which isn't desirable).. This sounds like you're working in some editor that pops up completions by default. The way completion popups are opened isn't prescribed by the library (most of the demos use a key to open it), so this is something you'll have to take up with whoever set up your editor.. Quote-closing in general does not work in contexts that don't tokenize quoted strings, because it is impossible to generally decide whether a quote opens or closes a string. This is intentional\u2014even with a bunch of heuristics (recognizing comment or nested string context, counting quotes, etc) this'd be very error-prone, and I don't want to go there.. > I'm not sure I understand why tokenization is relevant here.\nBecause, if the opening and closing character are the same, it is unclear whether a given insertion should open or close. In a context where the string is tokenized, the token information can be used to figure out whether we are in a position that would open or close a string. In the absence of that, we can't. \nI don't see how what CodeMirror does is any less coherent than the others.. What do those preferences have to do with it? CodeMirror allows enabling/disabling of matching with the autoCloseBrackets option + finer grained control.\nAs I said before, I don't know of a solid way to implement what you're asking for.. That heuristic seems to catch most cases\u2014it seems the code was already doing all of that except for the check for a word char before the cursor. Attached patch adds this, replacing the string token heuristic. This will lead to suboptimal behavior when a string ends in a non-word character and is, for some reason, not closed by the automatically inserted matching quote from the opening quote, but it's much simpler.\nDoes this work for you?. Thank you. Merged as a7907d37. I'm not 100% sure this is the right thing to do \u2014 in Emacs, for example, it works the same way it currently works. If you press a key combination that's registered as a prefix, the next key is interpreted in the context of that prefix, and only in the context of that prefix. The assumption behind that would be that you're intentionally composing keys and that if the thing you type isn't bound, you probably don't want anything to happen.\nIf, on the other hand, you're fat-fingering some bogus combinations, maybe the first key was an accident and you did want something to happen. Both outcomes are bound to annoy someone, but since multi-stoke keys are rare in CodeMirror, and swallowing keys can confuse inexperienced users, I've implemented the behavior you asked for in attached patch. I didn't test on OS X because I'm not near my Macbook, but I expect the effect should work there as well.. There's no encryption, and no ECCN.. I prefer the look of changing text color to outlines or background changes, but I would be open to making the default color darker to contrast better against white backgrounds. Does #0b0 work for you?. I think these were bolded at one point, but then there were issues where some browser/font combinations would screw up monospacing when some text was bold, so that was backed out. I'm not sure if that's gotten better, and I don't have the time to try and find out, so I'm going to be conservative there.\nAttached patch makes the colors darker.. > before the next DOM update occurs\n\nThe update event almost fits the bill, except that scroll is fired after update in some cases (e.g. when hitting enter repeatedly until the editor has to scroll to follow the cursor).\n\nI think update is as good as it gets \u2014 determining whether the cursor has to be scrolled into view is done after the DOM update, because it depends on DOM measurements, so if you want to do something before the DOM updates, you'll have to do it before then.. This doesn't sound like the problem is in the CodeMirror library. Maybe check whether your module loader isn't loading the core library twice (require.js has a tendency to do that when it's included through different paths).. http://codemirror.net/demo/requirejs.html. Thank you!. Don't get the zip from github. Github is not our distribution channel. Get it from the website or NPM.. Thanks for the report. Note that the vim bindings aren't being actively maintained, so it may take a while for this to get attention.. Do I understand correctly that this provides too low contrast in the light variant of the theme? Would simply removing that line be an acceptable solution?. @adrianheine Do you have an opinion on this?. Great. Merged! (As 2c741bd6.). Yeah, that is valuable. Ingvar got me to adopt it in Acorn, but it is so slow. Ideally, I'd want to add import checking to blint, but I'm not sure when I'll get to that.. >  Would you be open to a PR of this nature?\nProbably not. We're going to keep these in legacy format for now, and drop them or move them into their own modules at a future major version. You can run rollup-plugin-commonjs or similar on them on your side if you want to automatically convert them to modules.. > native ES6 imports will work properly in a browser without a build pipeline\nAs an aside, if CodeMirror had even a single NPM dependency, this would fall apart. And the library is likely to start using external modules in the future. Are you aware of any solution to address that?. The linter uses JSHint internally, and allows you to reconfigure that, so sure, that should be possible.. Oh, oops, I just committed something very similar in 85fb7510. . Test merged as 1ba861a0 . This appears to be a Chrome bug \u2014 Firefox behaves properly in this case, but Chrome renders these characters differently based on whether there's a <span> boundary between them. This is unlikely to be something that we can work around inside CodeMirror, so your best bet is to report the issue to the Chrome team (you can reproduce it outside of CodeMirror by adding/removing spans in such text, and noting the difference in text rendering).. Thanks!. Those links do not work. That's a file system permission issue you have in your installation directory, not something Acorn can help.. Don't bother \u2014 I banned them and I guess that means they won't be seeing replies.. Thanks! Merged.. Modes are intentionally not given information about line numbers and the rest of the document. This is used for several optimizations\u2014by knowing exactly what the mode state depends on, without leaking in further information, it can be reused. This isn't going to change\u2014doing line number-dependent things will have to be done outside of modes.. Thanks for your report. I may be a while until someone sets up an IE11 with Korean IME to debug this. If you want to look into it yourself, the problem probably lies somewhere in the composition event handling in src/input/TextareaInput.js -- possibly it is failing to exit composition mode, either because the browser isn't sending the right events, or because of a bug in the CodeMirror code.. If you want to do the footwork of setting up some benchmarks and proving that it makes a significant difference, that would be interesting. I think paint containment might cause some problems for people \u2014 absolutely positioned bookmark widgets sticking out of their containing lines can be useful, but if there's a big performance win, it might be worth making that harder anyway.. I'm not familiar with Gerrit's setup of the merge addon, and I couldn't get this to appear in the merge demo after trying some obvious things. Could you set up a self-contained demo that shows this happening?. Oh, indeed, CodeMirror's merge addon doesn't appear to be loaded on that page, so it's unlikely to be the cause of the problem. I guess Gerrit has its own diffing tool, and the bug is in there. Closing this until further information pointing at our code is found.. This looks like it completely overrides the meaning of the < operator in TypeScript mode\u2014which is probably not good, since as far as I know that operator still exists in that dialect.. I don't think there's much we can do about that\u2014as far as I know, no event is fired before validation, so apart from constantly syncing on every edit (which would be too expensive to be a reasonable default) or trying to handle mousedown and key events to anticipate that the user is going to submit (not possible in a general way), I don't see how fromTextarea can arrange for the content to be in the input field before validation.. > Is there a bit to flip in these modes that's easy to turn on?\nNo, you'd have to adjust their block-comment tokenizers to track comment depth.. What kind of scrolling are you talking about? If this is about wheel scrolling, that's just how browsers act\u2014if the pointer is over a scrollable container that's scrolled to the very end, its next scrollable parent is scrolled.. You can add your own wheel event handler to do that. CodeMirror itself doesn't do it.. That's not a feature that our search dialog supports\u2014you'll have to write your own if you need it.. > Could you help me figure out where exactly can I apply it to normalize the search input and the whole doc itself before start searching?\nI don't understand this question\u2014why do you need to normalize before you start searching?\nIt appears that the normalization is strickly 'expanding' (never shortens the length of a string) after all, so that's good. The code looks good except that you're turning off case- and unicode-normalization when there's Arabic in the string. The linter appears to be complaining about trailing whitespace.. > so the searching can detect all matches\nYou mean for the purpose of highlighting them? That is done in searchOverlay in addon/search/search.js, which currently doesn't really do any normalization beyond case, for which it is relying on the regexp i flag. To support normalization there, we'd have to use a different approach.\nCan we start by landing this change just for the search cursor, and then look into the highlighting issue separately?. > Sorry didn`t get what you mean here\nIn this line (and the one after it)...\ndoFold = function(str) { return isArabic(str)? normalizeArabicChars(str) : str.normalize(\"NFD\").toLowerCase() }\n\n... toLowerCase won't be called for a string like \"XY\u0627\u064a\u0647\", but it should (in addition to normalizeArarabicChars and .normalize). Since normalizeArabicChars looks somewhat expensive, I'd prefer if you kept the check. Maybe something like str = str.normalize(\"NFD\").toLowerCase(); if (isArabic(str)) str = normalizeArabicChars(str); return str?. Is there a standard or document that your normalizations are based on? Whether something works or doesn't work depends on what you expect it to do\u2014and if we're going to implement a normalization, I'd prefer for it to be based on some standard or at least widespread convention.. Does the problem you are trying to solve also occur with diacritics encoded as separate characters (for example \\u0654 \"hamza above\")? If so, we probably need something more general than these replacements\u2014filtering out a whole character categories, such as accents and diacritics. I notice a lot, but not all, of the characters in your code are already decomposed to a base character plus an extending character when you call .normalize(\"NDF\") on them, so that could be part of the solution.\nBut, I guess, not the entire solution. Is there some Unicode concept that covers the rest?. I asked around about whether these characters should be considered equal, and opinions differ (see this and this).\nI'd like to add some kind of generalized stripping of extending characters (so that 'e' matches '\u00e9' and '\u0675' matches '\u0627'), which would address some of the equivalences in this pull request. For things like '\u064a' and '\u0649', which are similar but not technically equivalent, I prefer not to have built-in normalization (since the set of these characters, across the various scripts, is huge, and there doesn't appear to be a standard that defines how to do this generally).\nI am open to having an extension mechanism through which user code can add additional normalizations, which you could use to add the ones not covered by the extending-character-removal. Does that sound reasonable?\n(It might be a while until I get around to implementing all this, unfortunately.). Possibly, if you provide a pull request that adds a definition to the bottom of mode/sql/sql.js. You'll have to do it yourself, though.. I assume you're talking about uncommenting such comments? The comment plugin currently doesn't support this. One option would be to add an extra field, say additionalBlockComments, containing and array of {open, close} objects, and have the comment plugin scan for those as well when uncommenting. I don't, off the top of my head, know of any language with multiple line comment syntaxes, but I guess that might come up in the future as well.. Ah, I see what you mean now. Try with attached patch.. The line I'm seeing is:\ncss\n.cm-s-default .cm-variable-3, .cm-s-default .cm-type {color: #085;}\nWhich looks valid. Why do you think there's a missing comma?. >  If i write \".cm-s-default, .cm-type\" instead the style is applied. Other style i ve test \"keywords comment ...\" works perfectly.\nThen I guess you're using a different theme. Adding a comma there will make the style apply to any cm-type element, whereas it should only be applied to elements with a parent element that has class cm-s-default. This doesn't happen in the demos, so it's probably caused by some CSS you added. Try simplifying your setup until it goes away.. Thank you! Merged as b1bf7b3ad5394. Tests for the CSS mode live in mode/css/test.js. I've added one in 74e7447cf7.. Thanks. I've pushed c7853a98, which seems to fix it in a more direct way, instead. Let me know if that doesn't solve the problem for you.. The setting you're looking for is lineSeparator. When that's set, it will no longer normalize anything that looks like a line separator to \\n. That also means that the \\r character will show up in the actual document (if they aren't part of the defined line separator).. > This really needs an actual API.\nI assume setting the document to be empty first and then updating it was intended to work around the fact that you couldn't set the line separator right away? It is, as @adrianheine pointed out, an argument to the constructor. Attached patch documents it. Does that help?. Want to take a look at the ocaml mode's source and see if you can fix these?. Fixed via #5116. Thanks for taking care of that! The implementation looks fine. Merged as 7cefd7da. Great. I've merged this as 32f63fc3, minus the external theme (most of the demo pages work offline, and might as well continue to do so). Looks like you forgot to adjust some tests.\n@mtaran and @dwelle does the approach taken here look okay to you?. I've done the squashing, and merged this as 40570ddc. Indeed, the example isn't syntactically valid, and if you fix it (add a property name before the string) the problem goes away.. This is expected behavior \u2014 if you turn off the lazy rendering that uses the editor's scrolling viewport, performance for large documents will degrade.. > I don't see any way to effectively configure this behavior. Is there something I'm missing?\nNope, replaceRange (and more generally any kind of change) will move the selection forward when it's in or on the boundaries of the change. You could work around this by resetting the selection after the change (if it changed at all).. You can use markText to style pieces of text. That's all this library supports.. Thank you! For now, this looks fine. Merged (edc74c3e)!. It might be that 'chrome crash' is referring to an infinite loop in the JS code. But I can't reproduce this in Chrome 62, so I'm going to leave it closed until further information comes in.. Ah, I wasn't even aware that that file still existed. Attached patch removes it.. Doesn't ring a bell. I'd say a crash in uglify-js is best reported to that project.. The indentation of the close tag is correct, by the mode's indentation rules. The issue is that the opening tag isn't indented properly. I don't think that's an issue with the addon.. The idea is good, but this should be implemented as an option to the addon, rather than the main editor. See, for example, the way indentTags is implemented in closetag.js.. Much better, though you have some linter issues (trailing whitespace, a misaligned closing brace).\nI notice autoCloseGT also indents lines in some circumstances. I guess the option should also disable that behavior.. Right, but wouldn't it make more sense to have an option to control indentation in general, rather than one that only applies to the slash-key closing?. Great! Merged as d9f05c90. > CodeMirror does not highlight it in any way.\nIf I go to http://codemirror.net/mode/groovy/ and paste that example code, all the annotation names are highlighted as meta tokens. Am I missing something?. This is not enough information for us to do anything with. Can you reproduce the issue outside of WordPress? Which calls cause it?. The LiveScript mode was contributed, and isn't being actively maintained. So if you want to get these addressed, your best chance would be to send a pull request.. It was contributed by @duralog in commit 36ce4b04b8be1e937e. Sorry, but 'doesn't work', without further information, is not a bug report. The editor is working for thousands of other users, so the problem is not obvious.. That was mostly accidental. Attached patch removes the scrollbar. However, due to the way the editor width is tracked, wide line widgets won't currently contribute to the horizontal scrollbar when they are scrolled out of view. I.e. the horizontal scrollbar might disappear or be too narrow when you scroll a wider-than-the-editor line widget out of view, if there's no text line that's at least as long.. This doesn't greatly bother me, but a pull request that fixes it would be welcome.. CodeMirror's visible selection isn't the DOM selection (unless you turn on contentEditable-mode), so that's where the confusion comes from.. Thanks!. The default keymap doesn't come with a lot of extra, non-standard functionality. You can find a command for duplicating a line in the Sublime keymap, named duplicateLine and bound to Shift-Ctrl/Cmd-D by that keymap.. The yaml-linter seems to return errors whose from and to properties are the same, so unless you enable the lint gutter, you won't be able to see them, since there's nothing to underline.. If you mean highlighting of code within the editor, you don't need colorize for that. You just need to load the proper modes. Check CodeMirror.modes to see if your modes are there.. Since I'm seeing neither the xml nor the css mode in that screenshot, it seems like those aren't actually loaded. Look into that.. That isn't supported\u2014indentation is measured in units, not specific strings. indentWithTabs determined whether the first n\u00d7tabSize units are converted to tabs or not.\nYou could write your own commands to implement the behavior you are looking for, but it is unlikely to be supported by the core editor.. Merged as d096403f. Agreed. Done in 865102a0. What is this trying to fix? The fact that text/x-php refers to the full PHP mode, including wrapping HTML, is intentional, and changing that will break things for a lot of users. So it is probably not a good idea.. Thanks. Merged as dccaafe5. That file should have only a single entry per MIME type, so you should add the extension to the \"C\" entry instead.. Thanks. Merged as b045bfa7. Thanks!. Thank you, but we're not accepting additional modules into the main distribution. I recommend that you distribute this separately, for example as codemirror-sparql-hint on NPM.. Thanks. Merged as cacaa545. The handle is the second argument to the function, hence the formulation \"extra argument\". The first is, as with regular key bindings, the editor object.. So I tested this, and I'm getting the proper object passed as second argument to my custom key handler.. Which language mode? (In most languages, those slashes on the second line would also start a comment so I'd say the behavior is reasonable.). Depends on the language.\nFrom what I can see, the comment command will only remove a line comment start if the mode has highlighted it as a comment, so it doesn't look like the issue is there. Going to close this, feel free to add information if you have a concrete issue with something in the distribution.. That string seems to be completely unused. Feel free to submit a pull request that fixes the spelling if it bothers you.. Looks like you forgot to include the codemirror.css file. You could probably add this to mode/mllike relatively easily. We're not keeping issues open for new mode wishes, since the maintainers won't be working on such features.. Thanks. Merged as d2798d22. Mozilla has a trademark on \"Firefox\", so yeah, I think you'd have to come up with another name. Other than that, I'd be willing to merge this.. Thanks. Merged as e9e5f23b. Thanks. The failed CI build seems to have been a Travis fluke, so I've merged this as ce2fb7c8. Merged as ed9f4e39 . It doesn't look like mllike.js defines that mime type. Did you forget to add a file to the commit?. Yes, adding a definition for plain ML sounds like a good idea.. This has been addressed by #5173 . This file is a mess, and I'm going to stop maintaining it at the next major version, but for now, yeah, your fix looks like it at least doesn't make things worse, so I've merged it as 350f71b0. Sounds reasonable. I've merged it as 2786ff0a\u2014let's see if anyone complains.. The mode determines how the code is split into tokens. getTokenAt just queries those. There is no guarantee that token boundaries happen to fall at the point where it is convenient for your completion code. Unless you can change the mode, of course, in which case you can make sure it produces different token types for the braces and their content.. > It takes \"words\" as an argument\nIt is indeed called \"words\", but it can hold any strings, which can occasionally be useful. I think fixing this in the mode is the way to go here.. Yes, it was broken in 5.12 due to a change in the core. Attached patch should help.. Please rebase your branch to only contain the new patches (and look into the test build failure).. Thanks! Merged as 774575d6. > runmode-standalone, runmode.node and neither of them work.\nThey do, but not with bundlers unless you add some configuration\u2014the modes all depend on lib/codemirror.js, and you have to somehow convince your bundler to load the runmode-standalone shim instead of the regular core library for that dependency.\nBut yeah, runmode is what you need, if all else fails you can also load the regular core lib and use runmode/runmode.js with that.. No, this is how the library works\u2014change events are not synchronous, and the editor content may have been affected by further changes. You may want to use the \"changes\" event instead, which gives you an array of changes up to the current state.. Attached patch avoids the adding of the extra quotes in this situation. It still doesn't automatically close a triple-quoted string, as the addon doesn't do the kind of non-local analysis that would make it easy to know that the string was double quoted, but it at least doesn't get in the way. Does that work for you?. Attached patch should fix this.. I see. Does attached patch help?. I don't see two arrows showing up anymore, when I paste the snippet you show. Are you sure you're testing the current code?. That's because type is a contextual keyword in TypeScript, and since it's appearing at the start of a statement here the mode considers it a type definition. If you know the proper way to disambiguate this, let me know.. Ah, never mind, there was already a similar check (to see if the keyword was followed by an identifier) for enum and module, so I've applied to to type as well and that seems to improve this case.. I suspect this is because the autocompletion is hooked up to key bindings, and Android doesn't fire useful key events, making key bindings mostly non-functional. You could try using the \"inputRead\" to trigger the completion\u2014that should work on Android as well.. > Are there plans to support that for the simple mode?\nAdding the electricInput property to your mode's meta object should work.\nAs for the future of simple-mode, I think I made some design mistakes in this approach, which make it easy to run into a wall where the abstraction just doesn't work anymore. I'm still mulling over what a better user-friendly mode definition system would look like, and will probably take some time later this year to try and work on that.. > Maybe it can be removed?\nSure, feel free to remove it.. Looks good. Merged as d8d68a8a. I didn't implement this, so I'm not sure about the rationale for those exceptions. If JSHint has a system for distinguishing warnings and errors, I agree it doesn't make much sense for this addon to second guess it.. > I could remove the error code override entirely. \nI think that's a good idea, and the replacement can also go\u2014if we're using a library to find and describe problems, we may as well leave that part of the job to that library.\nI don't have a problem with breaking compatibility with ancient JSHint versions.. Merged as dac3bdec. I hope I merged it correctly.. Thanks, merged as 81391e6a. Thanks!. I like how you keep making the file smaller. Merged!. Thanks!. Thank you. Merged as 91496a34. What is utop? Are types in the same namespace as variables in OCaml? If so, you could consider assigning them the token style type instead.\nAlso could you please rebase your branch before submitting a pull request, so that it's easy for me to see which patches are actually relevant? You can force-push to this branch to update the PR.. > utop is the REPL for OCaml \nThat doesn't seem to have highlighting at all so, um, I'm not sure we'll want to use that as a reference point.\n\nI am doing the changes right now, I will probably close this branch and reopen it when it looks better, is that ok?\n\nSure!. Thanks! Merged as 945c9673 . This code doesn't appear in the current version of show-hint.js, so you're looking at either an old or a modified version.. This is a known issue. See #2443\u2014it's titled somewhat differently but describes the same problem. It's not likely this will be fixed in the short term.. The built code can be downloaded from the website or from NPM.. It's likely that this only happens for keys that CodeMirror has its own binding for. Can you give some examples of keys where the problem occurs?. I can't reproduce this issue \u2014 key events for these keys arrive at the window level just fine. Are you maybe wrapping your editor in an iframe?. Hi Leo, we're not accepting new modes into the main distribution anymore. The recommended way to distribute new modes is to give them their own repository and NPM package. You can look at the Elixir mode for an example.. Extending Doc isn't really something that is supported. I recommend you use composition, rather than inheritance, if you want to associate additional data with documents.. > You mean defineDocExtension?\nThat might work. But usually, it's better to keep a data structure that has a Doc instance as one of its properties, and pass that around.. As far as I can see, this already exists\u2014you can give {text: \"inserted text\", displayText: \"visible text\"} object. Am I missing something?. If you clone the git repository, you have to first build the library (npm install).. The line property in position objects is specified to be a number, so I consider this problem to be in the calling code, not the library. CodeMirror doesn't do type checks or conversions on all values it gets. This is intentional (too much noise and overhead).. That doesn't seem to match Sublime's own behavior (going by build 3114), which adds a cursor at the end of shorter lines.. > I think this fix is an improvement of the current behavior.\nMaybe, but these are the Sublime Text-style bindings, so Sublime Text is our reference point. For a customization like this, I recommend you override the definition of that command in your local code.. I don't expect a framework like Angular to automatically 'know' how to set and get CodeMirror's value. In any case, this isn't a bug in CodeMirror, so the issue tracker isn't the place for it.. Wouldn't a negative lookahead like (?!\\.) after the decimal dot be a more readable way to address this?. How is [^\\.\\D] different from \\d? Also, doesn't Kotlin allow number like 1.?. > \\D - It's like a!\\d\nI know what \\D does. Which is why I'm wondering why you constructed [^\\.\\D], which says \"anything except a dot or a non-digit character\", which is redundant, because a dot is already a non-digit character, and equivalent to the much shorter \\d.. All right, I've merged ef234137 instead. > Are there any plans to implement a way to translate such text? Is there a reason why that hasn't been done, yet?\nThere are no plans by us to continue expanding the search addon. It's more or less a proof of concept that got out of hand.\n\nIf we wanted to fork and add code to support this ourselves, would a pull request be approved for such a feature?\n\nYes, a pull request that makes the pieces of text in the dialogs configurable would be welcome.. The docs tell you to pass a DOM node, a function, or null. That's a jQuery object, which isn't something that CodeMirror can work with.. I can't see what you are doing from just a profile. Can you set up a demo that reproduces the issue?. Merged as 9c5776d9 . This question doesn't provide enough context for me to know what you are talking about, and it sounds like it might be more suitable to the forum anyway.. Can you provide an example of code that produces this exception? In principle, singalLater is only called for documents that have an editor associated with them.. Ah, I see, yeah, that's clearly a bug and I guess no one really tested line widgets on editor-less documents yet. I've pushed a slightly different patch 291fd84f, since there's no need to constrain to exactly undefined (the link may also be null).. In three weeks. CodeMirror releases are strictly time based unless a major regression or security issue is found. No, this isn't provided. You might be able to create it yourself, by wiring the lint addon up to some existing Python linter.\nIn the future, please use the forum, not the bug tracker, for questions like this.. This is by design. You have to call the refresh method when you show the editor, so that it can display itself.. Merged as f3e6d7ea. That's reasonable! Merged.. Thank you. Merged!. I think the proper way to address this would be to allow indent-fold.js to skip commented lines (only if there are more indented lines after the comment). I don't have time to work on that but a pull request would be welcome.. This appears to be intentional\u2014you escaped the closing quote, so it doesn't close the string, which continues on the next line.. I don't know\u2014I haven't written SQL in years. It seems that standard SQL doesn't support backslash escapes in strings, but most implementations do, which I guess is why the mode supports them. I can't teach you SQL, but if you are using a SQL implementation that doesn't do backslash escapes in strings, let me know, and I can make it so that the mode only does them for some dialects.. Yes, that's what I mentioned. Which dialect are you using?. Thanks. Attached patch disables backslash escapes in strings for mssql. Merged in 07fdccfc. Thanks, merged as 07fdccfc. This is out of scope for the core library (but you could create an overlay mode that does something like that).. As long as no actual type conversion happens (which is the case here\u2014all operands are strings), there's not actually a speed advantage to ===. JSPerf is down again, so I don't have easy access to benchmarks, but I doubt you rigorously measured the difference.\nSince this project prefers == when appropriate, I'm not going to merge this.. This is the issue tracker, so really not the place for asking help. You can post something on the forum, if you want, but without a proper description of what went wrong when you tried to follow the example of the Elixir mode, I'm not sure how anyone can help you.. That doesn't just happen when you save the app, it happens in every situation\u2014Chrome doesn't allow JavaScript to capture ctrl-n, so this isn't something CodeMirror can do.. What do you expect ^ to match? CodeMirror's regexp search is not line-wise (it can match multi-line patterns), so ^ isn't really meaningful, and doesn't stand for 'start of line'.. > Why is it any different for the search cursor?\nBecause the search cursor must be able to match multi-line patterns (which is why the problem occurs for regexps that contain \\s or another element that matches newlines, but not for simpler regexps).. JavaScript provides no way to match regular expressions like that, and emulating it by feeding exec every possible subsequence of lines is exponentially slow, so you definitely also don't want that.. Turns out there's a regexp flag for that (m). Implemented in attached patch.. Since the original author seems to already be distributing this on NPM, I see no reason to put a duplicate copy in the main distribution.. This can already be done with the existing interface (CodeMirror.modes.hasOwnProperty(CodeMirror.resolveMode(spec).name)), and I don't think it warrants an additional exported method.. Class properties aren't part of the language yet, and aren't supported in the JavaScript mode. A pull request that implements the current proposal would be welcome, but I'm not going to implement them before they reach stage 4.. The typed content doesn't actually get added to the editor until a compositionend event, which is why the placeholder addon doesn't notice it until that point. That's not great, and in the next overhaul of the library we'll probably set things up so that each compositionupdate immediately updates the editor, but for now that's tricky to change.\nMaybe we could add event handlers to the placeholder to hide the placeholder when a composition event starts, and when it ends, re-check whether it should be shown depending on the editor content. Would you be able to create a pull request to that effect?. Not really. The input system probably gets confused when reading new text content from the DOM, after a composition event (which is how Android models backspace), but I don't know why that'd be happening.. Hi. CodeMirror doesn't use the shadow DOM, and the library never calls createShadowRoot, so this error must be coming from somewhere else.. Wasn't this already done in https://github.com/codemirror/CodeMirror/commit/2ffbf483ca423420903be48c25fc28a30d601403 ?. This is out of scope for the core library, and would be problematic to implement anyway, as CodeMirror renders only visible lines, so not all IDs would be available at any given time.. But can you reproduce it in a plain CodeMirror, without commtech's code? That would help us debug it (and make sure the problem isn't elsewhere).. Thanks. Merged!. Thanks!. Thanks!. Which version of JSHint are you using?. Thanks! Merged.. In the issue you point at the unescaped regexp string (which indeed is wrong), but this fix doesn't seem to have anything to do with that. Did you link the wrong issue number? If not, why don't we solve this by escaping the string given to the regexp?. Patch aab9d716 adds the escaping. I think it should be possible to also do the boundary checking in the regexp (something like (^|[^...]) in front and (?![^...]) after), and we don't need an extra feature in matchesonscrollbar for that, but I haven't added that part yet.. The positions you pass to markText lie in different lines, so the fact that it highlights multiple lines is expected. You can pass the correct positions, or use addLineClass instead.. We don't support nesting strong within strong text (or emphasis within emphasis), and I'm okay with that, since it's not something people tend to do.. Thanks!. Thanks. Merged as 749409d4 . Check if the element with the class CodeMirror-scroll still has the overflow: scroll style. Other than that, I can't suggest much, except trying to reproduce this in a simplified way.. Could you be a bit more specific about what the problem is?. That's too bad, but it's definitely not a CodeMirror issue -- the editor treats its content as just text, what happens with it after it is edited is outside of the library's scope.. Thanks!. That's true, this is not a feature that currently exists. It'd require somehow extracting the scripts and passing them to JSHint, and then making sure positions are adjusted to point at the right places in the original file. I consider it out of scope for the current code.. I'm afraid not. The simple mode add-on is probably a bit of a dead end, at this point I recommend using the 'plain' mode API if you're building a new mode.. That would only match if there are additional non-word characters on the sides of the token, so you couldn't put an operator directly next to a word. Maybe the proper fix is to drop these boundary checks entirely?. That definition isn't maintained by the maintainers of the library, so this bug tracker isn't the right place to report issues with it.. We're not taking mode requests (or adding more modes to the main distribution in general). You'll have to implement and distribute them yourself if you want such modes.. Does browser-default work on child nodes? If so, you could maybe just set it on some node surrounding the whole editor.\nIn any case, I am not interested in adding workarounds for problems caused by 3rd party code to this library, so you'll have to apply that patch locally.. See http://codemirror.net/mode/clike/. No, it's not, you're just looking in the wrong place. The clike mode defines a \"text/x-java\" MIME type.. Solved via #5292 . There's no way to reconfigure the whitespace character, and you'll run into other problems when the encoding of the library is mangled, so I'd look through my build process carefully to see where the problem is being introduced, and fix it.. We'll take a look if you can reduce this to the minimal code needed to reproduce it. As it is, this is too much irrelevant code.. > And when I try to type something, the new typed characters are reversed, in the direction on the left\nThis is because you're using setValue to give the editor a new value, which will reset the cursor position. Use methods like replaceRange to make targeted changes, if that's what you want.\nI can't reproduce the freezing, but I expect that's also caused by your code.. Making a change from a \"change\" event handler is going to immediately fire that handler again, giving you an infinite loop.. The test failures seem to be unrelated to your patch\u2014I'm not sure what's up with them. I've merged this, will look into the test issue separately. Thanks!. Not really\u2014the scrolling is largely handled by the browser, which will scroll the innermost scrollable element under the cursor. You might be able to build your own solution by setting pointer-events: none on unfocused editors, but then you need some other hack to remove it again on mousedown.. Merged as 53d2e8b3. Nope, neither of these are features that the merge addon has (and they are unlikely to be added).. Nice. I'd keep a single chain of scopes, rather than separate ones for function and block scopes, though. You can add a property that describes the type of the scope.. Merged as 40027e21423 and adjusted in 2e99e1414ac to avoid allocating too many objects. You appear to be including an HTML file as if it is a script. That won't work, and suggests the problem is in your build setup.. I warned you about performance when we discussed the multi-line regexp feature. In this case, the regexp itself is exponential (and, as far as I can see, needlessly so), which you can see if you run it against a substring of your example instead:\n``javascript\n/check_tests([^]*\\n?)*}/gmi.exec(#\nx: {\n  y_z: \"a-b-reviews\"\ncheck_tests: {\n    project: \"youtube.b.x\"`)\n```\nRegexps are a performance liability in their very nature, and that's not something CodeMirror can solve.. Absolutely. No one is currently maintaining the vim bindings, so help there is very welcome.\n(If I remember correctly, there should be a mechanism in the vim bindings that prevents character insertion, even for unbound keys, but it may be that that broke at some point.). Fixed via #5357. Thank you.. Thanks. Modes and addons are still written in ES5 and not compiled. Could you change your lets to vars?. Thanks! Merged.. Password fields don't appear to allow newlines, which I'm afraid would make this a bit of a non-starter\u2014the TextareaInput assumes it can store multi-line strings in its input.\nAlso, having selection control is the main reason we're using contentEditable on mobile. Without that, the editing experience tends to be rather miserable.\nSo I don't think we're interested in having this in the main distribution. If you want to make small changes to TextareaInput to make it easier to define this in 3rd-party code, I'd be open to that.. It should be possible to assign to CodeMirror.inputStyles.password to define a new input style. You can read CodeMirror.inputStyle.textarea to get the TextareaInput class that you want to derive from.. Sure, either update this PR or submit a new one, and I'll merge that. Merged as 74a71c4c. > On paste, codemirror converts any tab characters to the indentation whitespace that is the default when typing in codemirror \nThis is not a feature that CodeMirror has (nor is it something that I think it should be doing by default). You may be able to implement it as an addon.. Yes, it is possible, see the runmode addon.. The htmlmixed mode highlights HTML with JavaScript and CSS embedded in it.. The max line is determined based entirely on line character length, not on visual appearance. This is problematic, but computing the visual length of every line would be too expensive, and it's unlikely to be fixed on the short term.. Thanks!. How are you switching to a plain editor? In principle, removing the editor from the DOM should cause it to be garbage collected. I'm not sure how the setTimeout that's set when editor events occur can continue happening when the editor isn't active anymore.. > I'm switching the ng-show/ng-hide back on\nWhat does that mean in DOM terms?\n\nThe removal of the elements in the dom with the innerHTML call may remove the dom objects but not the event hooks\n\nEvent handlers are garbage collected when the DOM nodes they are registered on are collected.. > Unfortunately, the hooks stay in place even after the dom segment is destroyed.\nHow are you determining that it is in place? Is it actually firing after the editor was removed from the DOM?. > Yes, running the chrome's application rendering profiler I can see the long delay in releasing the main codemirror editor to use when loading new code into the main codemirror doc are due to the merge.js events listed at the opening comment\nSince those events respond to events in the editor, this suggests that your code is somehow still doing something with this editor\u2014the user can't cause events, on an editor that's no longer in the DOM.. > Agreed, that's why I'm guessing now perhaps it might be the shared doc?\nYes, that'd be it. You'll have to unlink the document in the editor that you're dropping.. Nope. I've merged this as e732d0e9fd11 and followed up with d49ef290157380, which was the simplest way to make things consistent again.. That seems sensible. Merged!. The Objective C definition was contributed (see 199c90e51addd89) and I'm not maintaining it (Objective C is not a very good fit for the clike mode). So if you want this improved, you'll have to look into it yourself.. Attached patch should fix this.. Looks good now. Merged as e9c52f3d. Thanks!. You can do this locally (delete CodeMirror.keyMap.emacs[\"Ctrl-V\"]), but I want to keep it in the library itself.. Emacs' recenter-top-bottom command (which is what C-l is bound to) does a bunch more than just centering a line though\u2014it'll cycle between centering, moving to the top, and moving to the bottom of the screen. If you want to implement that and submit a pull request, I'd gladly accept it, but I'm probably not going to work on that myself.. It will make bark\"}\\nfoo italic in the example below, though. And since our mode doesn't look ahead across lines, the current behavior is intentional, and the best it can do.\n[`foo`](bar){blah=\"_bark\"}\nfoo_. The closebrackets addon can do that, if you configure it correctly. Attached patch adds the required mode property.. This library doesn't provide any icons, so I guess the problem is in some other piece of code.. How long is \"a while\"? I am not able to reproduce this so far on Chrome Linux.. Thank you! Merged.. Yes, this method is behaving as it is intended.. > I'm not sure why they didn't include the bundled script in the downloaded repository.\nBecause it's not part of the sources and doesn't need to be version controlled. Get the package from NPM or the zip on the website if you want a distribution. This here is a source repository.. > You're joking, there is no script inside the zip that's why i am asking.\nNot sure if you're trolling or are unable to open a zip file, but for other people passing by here, yes, http://codemirror.net/codemirror.zip does have all the scripts you need.. It's under \"download\". I don't think I can prevent github from providing zips there, but the link explicitly says \"Source code\", which is what it includes.\n\nI do not want to waste my time here and to search where I can find a complete package.\n\nOkay, see you later. If you can solve this in a clean way a patch would be welcome. It is unlikely that i'll work on it, though.. Seems parentheses in types can either indicate a function or just wrap a type expression. Implemented in attached patch.. Solved via #5328 . Thanks!. You can get the edited content out of a merge view with view.editor().getValue(). Beyond that, I'm not sure I can help much with this.. Does bracket-closing work differently in any other software? Sublime Text does the same, and I think it's very reasonable behavior\u2014you can type another ')' to create the final balancing one.. I'd accept such a pull request, but I'm closing this issue since I don't consider this a bug.. Thanks! Would it be possible to, instead of having a new fstr_state property on the state, to encode this information in the closure stored in state.tokenize? Avoiding that extra separate field would be nice.. Modifying a closed-over variable like that isn't safe\u2014CodeMirror will copy and resume states, so this will lead to copies (which hold the same tokenize closure) seeing changes made by previous runs. A better approach would be to update state.tokenize to a new closure that closes over the updated fstr_state value.. Nope, that's not what I meant either. I've merged your patches up to 2c2fefd, and followed up with d0b1500b which, I think, also adds proper support for nesting format strings.\n. > We can iterate over all the lines of the document on every 'change' event and get their line lengths, but this seems to be quite inefficient\nSince change events give you information about which lines changed, you could largely make this incremental.\n\na refresh method on the rulers addon, to allow me to change the rulers after the CM instance has been initialized.\n\nCalling setOption(\"rulers\", ...) already allows you to update the ruler setup dynamically.\nI don't want to add new core features for this, since it seems possible to work around it in 3rd party code.. The language mode does that. As such, it'd be useful to know what language you are using, and check for syntax errors in the code that you load into the editor.. A short glance at the mode list would have told you that there's a shell mode.. Merged as f2a9eeb1. Next time please create a fresh branch, so that only new commits show up in the pull request.. It's possible (see this demo), but it's not very efficient\u2014for huge documents the editor will be slow because it has to keep the whole document in the DOM.\nFor things that are questions, rather than bug reports, please use the forum rather than the bug tracker.. I don't know. If you paste it into http://codemirror.net/mode/shell/ it is highlighted. So you'll have to figure out what you're doing wrong on your side. This bug tracker is not a support channel.. It's a highlighter, not a syntax checker. Some modes may mark some mistakes as errors, most won't.. Merged as 9ec12458. But again, please create a fresh branch next time or rebase, so that only new commits show up.. Maybe try reading the installation instructions first. Hi. We're not accepting new modes into the main distribution. The recommended way to distribute new modes is to put them on NPM as separate packages\u2014you can use the Elixir mode as an example.. The layout of the actual letters is done by the browser, and not something CodeMirror has any control over. I suspect this may be a font or a browser problem.. codemirror.css sets the font-family to monospace, which gives you your system's default monospace font. I don't think you can blame this library if that font happens to have issues.. The text in the editor is indeed displayed to the user\u2014that's what an editor does. That does not, however, constitute an XSS vector.. That still doesn't mean much. The text property is allowed to hold arbitrary strings. There no need to sanitize it.. Thank you!. Thank you! Merged.. Fixed by patch 0e138353. Using an unsecure link would make browsers complain. Attached patch uses unpkg.com to get an https: version of csslint.js. finishInit is an internal hack, not a documented feature. What are you doing with it?. Why not just define a wrapper function that initializes an editor and then calls your callback?. Well, if you're explicitly providing the callback to the function, you might as well just call it directly when initializing the editor. I.e. where you used to have finishInit: ... in your code, you could just do whatever was in there after creating the editor, no?. I really don't care how you do it, I'm just not seeing the value in using this option.. > Case A calls the function too early because the UI has not been fully initialized yet\nThat's not true\u2014CodeMirror initializes synchronously.. Attached patch should fix at least part of this. If you still have trouble, include the actual code as text, not just an image, since I'm not going to copy text from an image to test this.. Thanks!. If you're using a build process, you probably don't get a global variable (but can easily create it yourself by loading the module as normal and then assigning to window.tern). I'm going to close this since it's not really a CodeMirror issue.. The problem seems to be that the vim mode blindly moves the cursor back one index position when exiting insert mode, without making sure it is still on a character boundary. The vim mode isn't being supported anymore, but if you want to fix this, the way to go would be to figure out where that cursor motion is happening and making sure that position isn't in the middle of a surrogate pair.. No, Monaco uses a different style of modes. It may be possible to write a compatibility layer but that (and further language) modes is outside of the scope of the main CodeMirror distribution.. Yeah, this is a combination of JavaScript's tricky grammar and the mode's inability to look ahead across line endings. It could be solved for the case where the arrow is on the next line, but not for the general case, and looking ahead a single line is already pretty expensive (it requires more mode states to be invalidated for every change, since they may depend on anything that they looked ahead to). Is this important enough for you to warrant such a change?. This is not generally the case, and doesn't appear to happen on the demos on the website, so I'm going to need some more information and/or a minimal setup that shows the problem.. Sorry, no, I'm not going to try and get some big chunk of Angular code running. If you can reduce it to plain JavaScript and put it on JSBin or similar, I'll take a look.. I agree that using buttons here when supported is a good idea. In general mouseup is reliable on Firefox, so I'm curious why that isn't firing in your situation. Does attached patch fix the problem?. Calling jQuery will give you a jQuery object, which won't have a CodeMirror property. Possibly adding [0] in there will help.. That won't make things better\u2014you have to make sure your regexp's captured groups always match something (and that together they cover the whole token). The {0,1} will allow the groups to not match at all (producing undefined). You could solve this by putting a trailing | inside of the parentheses, as in (TODO|DOING|WAITING|NEXT|), and dropping the curly braces.. Nice!. I think the fix is a good idea (and should also fix issues where non-breaking spaces will incorrectly appear in the editor content)\u2014the editor read the next line as containing a non-breaking space when the composition finished, and then made a change that was bigger than the actual composition, which moved the cursor to the end of that change.. I guess it's assuming there's always a selected option. Want to submit a patch?. Thanks!. I suppose we could (I assume navigator.platform is pretty reliable). Want to submit a patch?. That looks reasonable. Thanks!. You could write an addon that does this with an overlay or markRange, but the core library isn't going to include support for it.. Sorry for the slow response. We had this feature at one point, but it was removed (06e83fd66eb) because it caused problems (#3698), so I'm not really interested in adding it back again.. That's done to leave space for the panels. Did you want the total height of the editor + panels to become more than the parent height?. Thank you. Merged as d232e5075. You can run editor.execCommand(\"find\") (or \"findNext\" or \"replace\") from your button's click handler, where editor is the CodeMirror instance.. Odd. I see the same without screenreader in FF Linux (but not Chrome). Attached patch adds the attributes.. Attached patch should help with this.. Merged!. @pabloferz or @malmaud, do you want to take a look at this?. The mode is a highlighter, not a serious parser, so corner cases like this which are unlikely to show up in real code don't interest me too much (feel free to submit patches, though).\nRecognizing the s flag is easy enough, that's done in attached patch.. > Any thoughts about that?\nFeel free to submit pull requests fixing the failures that bother you.. The scrollable element is always approximately the height of the total content, so I expect this is a bug in Chrome, somehow triggered by the way CodeMirror updates the DOM during scrolling.. It's hard for us to see what the (+) button is doing. The profile seems to show lots and lots of relayouts. Since nothing is happening on the screen, and CodeMirror is set up to only require a few redraws per update, that probably means the client code is doing something wrong. If you can reduce this to a simple stand-alone script, and wrapping whatever you doing in a call to operation doesn't fix this, I can take a look.. Just wrap the whole thing in this.codemirror.operation(() => { /* your code */ }) to make sure only one redraw happens, after you've made all your changes.. That's true. If you want to fix this with a pull request, I'll take a look. But it isn't something we're going to work on.. That was broken in 9ed217d5b, attached patch should fix it.. This might have a number of problematic effects with drawing order or when people have styled dialogs differently, so I'd prefer if you found another way around this (even with the patch, if some other addon ends up adding another element in there, your CSS selector will break again).. This is a good idea. However, CodeMirror is targeting pre-classList browsers so you'd have to formulate it using the CodeMirror.addClass and CodeMirror.rmClass utilities instead.. Much better, thanks!. Next week. I release monthly around the 20th.. We're planning a modernization of the codebase in the near future, but until then I'd prefer to keep things stable and not add further complexity and indirection, so this isn't something that's welcome right now.. Merged as 73a4fb5e . Thanks! Merged.. Yes, this is an effect of the hack we're using to make the context menu work. We need to let the default behaviour (causing the first focus change) through, and then immediately re-focus the textarea to make the menu take effect on that. I think you'll just have to live with these events.. Does changing the expression to stream.match(/^ +$/, false) also yield the performance improvements that you're looking for?. Thanks!. Nope, this doesn't currently exist.. Registering helpers under MIME types is not generally supported. The clike mode sets helperType to the mime as a way to allow this, but it won't work for other modes.. We're not adding more modes to the main distribution\u2014the way to go would be to implement it yourself and distribute it separately. See the Elixir mode for an example.. I've implemented this in 08a764161c instead (which also cleans up some weird code in the number-matching), and added your test in 875913f52d0d. Yes you can do this, but you'd have to implement it yourself, as I'm not aware of any existing implementations, except for the Tern integration which does some type inference for JavaScript.. Which language is this and which completion source are you using?. So then it looks like the problem is coming from your code, and you'll have to debug it yourself.. Your css (probably the width: auto) is not giving the editor a fixed or maximum width, which will cause it to grow to fit its content. If you change that, the problem will go away.. Don't download the zip from github\u2014that just contains the code in the source repository. Get the library from npm or from the website, as described in the readme file.. Hi. Thanks, but we aren't adding any new modes to the main distribution. The recommended way to distribute new modes is as separate npm packages (see for example the Elixir mode).. This breaks indentation on lines after else or elseif. I don't think there's any reason to touch dedentTokens, just adding the appropriate regexp as electricInput should be enough.. Thanks. Merged as dc573b5a. Yeah, CodeMirror does not in any way interact with URLs, so I don't think this problem has anything to do with the library.. Attached patch makes the problem slightly less annoying (it only deeply indents the first brace, then returns to normal). I think having indentation quirks for invalid code (there's not really such a thing as 'slightly invalid code') is expected and a useful hint that something is wrong, so I don't want to add more complexity to work around this.. If I run this at http://codemirror.net/demo/search.html it seems to work fine. Are you using the current CodeMirror version? If so, can you figure out what's different about your setup?. I meant I ran the code on the console, and it worked fine. Yes, you showed me the code before. I ran that exact code, it did not crash, so I'm asking you to figure out what you're doing differently in your setup. It'll call from() on a cursor that hasn't searched yet if the first search fails, which isn't supported (not sure why you'd create an identical cursor when the first doesn't work). I don't think there's anything CodeMirror can do about this.. > So how can I disable whole codemirror.\nDon't enable it, give the user a textarea instead. Other that that, this is probably a duplicate of #5245. To do that, write a CodeMirror mode and distribute it separately, on npm. We are not adding any new modes to the main distribution.. >  because mode and component didn't use a single instance of codemirror\nThat's an issue with your bundler/module loader, not CodeMirror. The various files require the main library through relative paths, which the loader should unify to load only a single instance unless you have multiple instances of the library in your node_modules. You didn't mention which bundler you're using, but this is a problem that's come up before.\nWe're planning a full rewrite that will completely change how any of this works, but in the meantime, the current approach should be workable enough.. It doesn't on the website, so you'll have to provide additional information on what you are doing.. Done in 9e8a4171. I suspect the problem is that you're registering this as a helper without any name, so it won't match your editor. Either directly set up your lint function in the lint option (with a value like {getAnnotations: myFunction}, or put the name of the mode your editor is using as the second argument to registerHelper.. Sorry, no, origLeft expects a string, and if you pass null instead, the problem is on your side. (Type-checking all input is too slow and bloats up the code.). At some point, I let people convince me that the editor should override tab by default. I think that was a bad call, now, but won't be able to change it until the next major release. You can disable the default tab binding with an option like extraKeys: {Tab: false} (binding a key to false disables handling of it entirely) to get the browser tab behavior back.. onResize was using the last editor size in a way that wasn't reliable. I've made it always recalculate things in attached patch.. I understand the need for the kind of feature you are proposing here, but I don't think this implementation is solid enough to include\u2014both conceptually and in terms of implementation.\nWe're working on a redesign of the library where the code will (always) be a contentEditable piece of DOM, and we'll be able to offload cursor motion and such to the browser, which might make this easier to implement. Until then (and it'll take a while for this to become production-ready), it may not be viable to get isolates in the editor.. > Good news about that redesign, is there a way to monitor its progress?\nNot yet, but there will be an announcement, at which point we'll move development to github, in the coming months.. Could you add tests for this? I think we can avoid the isInBlock kludge by checking for state.tagName || state.context but without tests it's hard to be sure that I actually didn't break what you implemented.. Merged as 11dfc2f26 and followed up with 9ea789b9. Changing the default style to make all gutter elements transparent is not acceptable\u2014it'll mess up people's existing setups.. Your completion function is responsible for only returning relevant results. Look into hintWords instead, which is a way for you to just register a list of words and having the hint addon automatically show them (see the way the python mode uses it, for an example).. > It works in the demo but not on my site.\nYou'll have to figure out the relevant difference, then.\n\nI would like the default (Ctrl+F) to be persistent search instead. Is it possible to configure this?\n\nYes, bind that key combination to the \"findPersistent\" command, using extraKeys with a value like {\"Ctrl-F\": \"findPersistent\"}.. Hi Maxim, we're not accepting new modes into the main distribution anymore. The recommended way to publish your mode is to put it in its own repository and publish it on npm---see for example the elixir mode.. > Is there a way to implement this?\nNot inside CodeMirror, but you might be able to find a code formatting tool that you can run on a string, and then put the formatted string back into the editor.. You could maybe use getTokenAt.. Hi, we're not accepting new modes into the main distribution anymore. The recommended way to publish your mode is to put it in its own repository and publish it on npm---see for example the elixir mode.. It is in CONTRIBUTING.md, which github points you to when you submit a new issue or pull request.. Not easily, but in the \"changes\" events (which always gives you the full set of changes) you can compute them by 'mapping' positions forward to any changes that come after it (see also the changeEnd utility).\n(We're working on a redesign which will make this kind of thing much easier, but for now, it's rather bad.). Right, due to the way Android fires composition events, rather than keydown events, for text input via a virtual keyboard, handlers bound to keys that input text won't be run. In the rewrite we'll try to express such things in terms of text input events rather than specific keys, which should help.. >  is there a way to style the textareas so that they appear with identical font and size as highlighted textarea so that codemirror will appear to just \"color\" the text?\nSure, just make sure the CSS font, font-size, line-height, and margins for the textareas match the style of the editor.. I suspect this is slowdown from the on-demand rendering of the content. There's not much that can be done about that\u2014except further optimizing the drawing routines, maybe.. Interesting. Could it be that your trackpad doesn't separate axes when scrolling? Wheel scroll events that have a horizontal component are handled by the editor, because it needs to keep the gutter in the right place. That might be what you're seeing.. It may be that the editor calling preventDefault on some of the wheel events interferes with smooth scrolling on Chrome but not Firefox\u2014but that's just a wild hypothesis.. No, undefined origins are definitely okay\u2014if you call replaceRange without providing an origin, as the bracket matching addon does, that's what you get. Origins are an optional piece of metadata, and you can't count on them being there for every change.. It doesn't look like that was the intention of the check\u2014positions never have an undefined ch, and further on in the line it uses ch - 1, which will produce a bogus position if ch was zero.\nI guess we should always close when hitting the start of the line, so making that condition (!pos.ch || this.options.closeCharacters.test(line.charAt(pos.ch - 1)) is probably a good idea. Could you adjust the patch?\n. Great. Merged as d1063d2c. I'm not generally a fan of pull requests for tiny aesthetic changes, but all right, since it's your first pr, it's merged!. No, this is out of scope for the core library. Even if all major browsers supported custom elements (they don't), it's not clear at all yet that they are the right way to go in, so this library is going to remain agnostic to them.. I'm not sure what parameters is supposed to do, but, assuming you're using the sql hinter, tables should still work.. I don't remember ever having that feature, but then, I don't keep all that close track of sql-hint.js. You can try digging through the git history to see if it ever existed, and if you find it, try to port it forward.. >  using node version of this code\nThere is no node version of this code, and at the moment CodeMirror can only be loaded in a browser environment (because it doesn't do anything useful outside of that).. > I recently added the feature to display the invisible characters (spaces) in my application,\nSeems like it would be useful to know how you implemented this.. Great. Merged as 70408ced. You can add an options field to the value you give to the lint CodeMirror option, which will be passed through to CSSLint.verify, and can probably be used to configure stuff like this.. lint: {options: {... csslint config stuff goes here}}. Why don't you just go through replaceRange?. I think you want the allowEditingOriginals option.. I can't believe we forgot to document that. Merged!. Closing this, since it appears to be a bunch of already-merged patches with no description. But feel free to actually describe what you're trying to do.. Gutter markers are not shared between linked documents, so you'll have to manually arrange for them to be added to the other documents (at the right lines) to do something like that.. You can access the editors in the merge view with the .leftOriginal(), .rightOriginal(), and .editor() getters.. Not sure how that wasn't caught in the several years since first-class Docs were introduced... but attached patch fixes it!. >  it seems that the module cache (whoever is responsible for it) \nI think that's Webpack in this case, and I think that should be reported as a bug there. I'm not really interested in adding workarounds for bugs in other tools to CodeMirror's manual (hopefully, they'll go away soon enough).. You're going to have to set up a self-contained example (for example on jsbin.com or glitch.com) if you want us to debug this.. Resolved via https://github.com/codemirror/CodeMirror/pull/5501. The idea is that the main clike mode doesn't have language-specific logic. You should implement this as an indent hook instead, if possible. If not, see how you can extend the clike mode to allow extension like that.. It seems like it should be really easy to put this in an indent hook instead. Most clike languages indent multi-line statements by looking at semicolons, so they don't need this logic, and I'd prefer if it didn't run for them at all.. Yes, you can see \"text/x-objectivec\" as example, it has an indent property that defines extra indentation logic.. Looks like you can't, currently, but it would make sense to pass that as fourth parameter to hooks.indent, when it's called.. Thanks! Merged as e338ab23b69dd. I have no idea what that syntax does (never wrote Kotlin), but yeah, looking ahead with a regexp in the indent hook seems like it might work.. CodeMirror tries to render only the visible part of the document. When it's initialized before the layout has reached its final state (because CSS hasn't been loaded or its container is hidden or not in the DOM yet), it might render the wrong lines. You can arrange to call the refresh() method when the page has finished loading, or delay initializing CodeMirror until the layout is stable, to work around this.. The visibleLines function in src/display/update_lines.js computes the area that is to be drawn.. It seems like this will just asynchronously call refresh\u2014if the editor is visible, it'll probably still be visible the first time the timeout fires. What use case does the new option address?. I think you can just call .refresh() on your editor directly then, and avoid the whole autorefresh situation. Or, alternatively, make the autorefresh addon a dependency of the module that initializes the editor, to make sure it's loaded first. This option seems like a confusing kludge, and I don't want to include it in the distribution.. Is the editor, by any chance, directly in a flexbox container? If so, adding another intermediate <div> around it might help with this.. Right, and also the same answer\u2014CodeMirror doesn't do anything useful outside of the browser, and is currently not set up to be loadable in such an environment.. Re-highlighting of the edited line is intentionally synchronous, to avoid color flickering. The work settings only affect background highlighting. For example, when scrolling to the bottom of a big document and then programatically adding a block comment start marker to the start of the document, you should be able to see the effect of these options.. You'd have to write your own key event handlers and attach them to the window. Shortcuts registered in the editor will only be handled when the event occurs when the editor is focused (and this is by design).. CodeMirror doesn't register any window-wide keyboard event handlers. Possibly you're confusing focusing the window with focusing the editor. If you put another input field in the page and focus that, do the keyboard handlers fire?. Can you provide a self-contained demo of the problem? Just adding a scrollIntoView call to the merge demo doesn't seem to trigger the issue.. This sounds like a feature request for a new mode (though it's a bit too cryptic to be sure). We're not adding new modes to the distribution, so if you want a new mode, you'll have to build it yourself.. I don't think loosely-matched highlighting ever worked\u2014in the past, the main search was strict as well, so the accented form wouldn't match at all, which was more consistent but less usable. Ideally, the highlighting would agree with the matching, but no one has gotten around to implementing loose match highlighting.. > If you change the inputStyle to \"textarea\" it works\nThat'll break touch selection, though. Thanks for looking into that! Merged.. I don't know what's happening here, but it seems like the problem is one of the way you're integrating with blockly, not something CodeMirror can help.. We're not taking requests for modes, or even adding new modes to the main distribution in general. You'll have to implement (and distribute) this yourself.. There's an (incomplete) list here. Extending that and adding a link to it from mode/index.html would be welcome.. You can already do this\u2014properties added on the options are present on the marker object. (Yes, this is a shaky hack, and in the next redesign of the API I'd work differently, but for now, it should suit your use case.). Could you remove the big fallback and just use setTimeout on any platform that doesn't have setImmediate? It seems more code than is justified by having a slightly better polyfill on a few old platforms. Also, are you sure that not passing a second argument to setTimeout is supported and behaves as passing 0 on all platforms?. I really do not want that big polyfill in the code for the obsure, rare case where this setImmediate implementation is actually being used. Is there a concrete issue this patch is solving, or did you grep for 0-ms timeouts?. > This setImmediate function will be used in every single signalLater call.\nThat's not the case, though\u2014almost all signalLater calls are used under an operation, in which case the setTimeout doesn't run at all.\nAs such, I'm going to close this as adding more complexity than warranted.. You could write an addon that does that, but the existing Clojure mode doesn't (and I consider it outside of the scope of modes to do this).. This my be due to a different version of rollup or one of its plugins being used to build the live version. I don't consider function name properties to be a significant part of the exported file, so I don't consider this an important enough issue to investigate. But if you can figure out a way to clean it up (without breaking any backwards compatibility) a pull request would definitely be welcome.. Thanks for letting us know. Attached patch restores the underlines.. CodeMirror has no feature of providing multiple views, so this bug report sounds like it belongs with whichever piece of software around CodeMirror you happen to be using.. I wasn't able to find out why it behaved like that, but I agree that isn't very good behavior. Attached patch removes it.. #5812 brings back a behavior similar to this in a more robust and configurable way. I'm not actively maintaining the Kotlin mode, but if you want to submit a pull request to implement this, that would be welcome.. I believe 229 is used for every key, not just backspace, on Android Chrome. That's an interaction with your own CSS. I don't think it is a good idea for the library to start getting into a z-index race with other code, so I prefer not to include that in the default style.. Fixed via #5519 . Thanks!. Not sure if you found it, but the lineSeparator option can be used to customize how the editor treats line breaks.. selectMatches selects matches within the current selection. To select a given match, you can call codemirrorInstance.setSelection(cursor.from(), cursor.to()).. You didn't move the cursor to a match yet, so from and to aren't returning anything.. I think attached patch should help with that.. I haven't touched Pascal in ages, but it does seem like {} are how comments are mostly done now. So the intent of this patch seems useful. However, I don't think it handles closing of comments properly\u2014it'll only close on *}, and doesn't make sure that the opening token matches the closing token. You should probably write a separate token function for { comments (which can be very simple).. Hi. That's a valid concern, however, there's no guarantee that different editors are styled in the same way (which may depend on parent nodes, themes, classes, etc), so blindly sharing this value doesn't seem like a good idea.\nA patch that allows user code to explicitly pass another editor instance to take this cache info from, as an option, would be welcome.. It appears that this is what V8 does when you run something like (new RegExp(\"\\\\b\" + \"0\".repeat(1e6) + \"\\\\b\")).exec(\"foo\"). Do you want CodeMirror to limit the length of regular expressions that it creates to avoid errors caused by browser limitation?. The mode can't look ahead and determine whether the bracket corresponds to a well-formed link, so it has to work this way\u2014assuming something that may start a link actually does so. Full Markdown parsers work very differently from typical programming language parsers, but in a highligher, we do have to work in a single pass.. Note that the vim bindings aren't actively maintained, so if you want something to happen here, your best bet it so try to implement it yourself.. Implemented in #5651. This is a good idea. I'd prefer the phrases to live in CodeMirror.phrases (initialized to null) rather than using a global. Also, could you please not change the quote style of the strings (the rest of the code uses double quotes).. Thanks. Merged as c9892c85b02. Patch be4793137cf8066 simplifies the functionalty (no more separate object or setPhrases method\u2014the option entirely determines the set of phrases) and fixes the issue in merge.js.. Those handlers are intentionally non-passive, so this is the intended behavior. Chrome making a fuss about it in the console isn't something we can control.. You're just adding braces. I doubt babel-loader can't handle code without braces, and if it can't, that would be a bug in babel-loader, and not something that we should be changing CodeMirror's code for.. This is not a useful bug report, though. What effect are you looking for? How did you do it? What went wrong?. Try going through the keymap mechanism (for example with the extraKeys option) instead. See the docs.. Thanks!. We're not adding more language modes to the main distribution. The way to work with a new language is to write the mode as a separate module, and possibly publish that to NPM so that others can benefit from it.. Doing this properly would require doing an accurate enough parse to know what kind of syntactic element is expected at a given position, as the TypeScript mode does. But that requires a lot of additional complexity. Instead, you could use a heuristic, like seeing if the text ahead is a valid character expression, and if not, just treat the quote as part of an identifier name.. Something like stream.match(/^\\'.\\'/) (might need to include a case for backslash escapes or whatever ReasonML does there)). No, we're not accepting new modes here. The recommended way to distribute a mode is as a separate NPM package.. I agree that this looks like it's fixing the issue on the wrong level. Could you say a bit more about how you diagnosed this and why making the mode change asynchronous helps?. Thanks!. Thanks!. Thanks for catching that. You can also have default values on non-variable patterns, though. I've applied patch eaf3a7ec instead. No idea what this was. I banned the account since I can't really think of a valid justification for that kind of noise.. Thanks! More test coverage is always good to have.. I'm not seeing anything strange in Chrome 68 Linux. Could you be more specific about what weirdness means?. >Removes indentation rules for non-core symbols to stay focused on covering more core symbols for indentation.\nI don't quite get this\u2014how does removing those symbols help cover more core symbols?. >  both the Common Lisp mode and the Scheme mode don't seem to do so\nThe CL mode has a heuristic for (see assumeBody) for when to use body-style indentation versus argument-style indentation. Maybe something like that would be appropriate here too? Though I don't know what the Clojure community's conventions look like.\nI guess the number of removed symbols in this PR is small, and any regression it might cause obscure, so I'll go ahead and merge.. > Hi, I followed the format demo, it didn`t work pretty good with es6 grammar, eg:\nThat's because that feature hasn't been part of CodeMirror since 2012 (note the /2/ in the URL). We're no longer providing it, because it was too much work to maintain. Use a separate code formatter if you need this.. Right, there's no such thing in the distribution. Completion of keywords and builtins should still work though\u2014the mode defines a list of completable words.. Nice, thanks!. Thanks!. There is, for reasons I'm not sure I want to really think about, a window.focus() in the mousedown handler, so that is entirely possible. It seems like it would at least make sense to change that to use the editor's own window. Could you see if that helps here?. Not too sure about abstracting === into a function, but sure, the mode seems to be improving so I won't nitpick.. > Is there a way developed to do this I am not aware of, or could it be added?\nThe CSS hinter isn't aware of which values are valid with which properties, but it would be able to extend it to do something like that. The only downside is that it'd require a pretty big additional dataset, possibly even with information about the syntax of composite properties (like border or box-shadow) so that it could hint sensibly inside of those.\nI don't have plans to work on this though, and we don't keep feature request issues open unless such plans exist, so I'm closing the issue.. You could try submitting a pull request to fix this (which I suppose would involve tracking quote depth in the mode state). I don't consider this a big enough problem to work on it myself, so I'm going to close the issue.. Thanks. I added some comments, could you fix those?. I've merged the non-problematic parts as e0fae825 . We're still targeting ECMAScript 3 with this library, so sorry, can't use any halfway modern language features. The issue might be that the annotatescrollbar addon isn't counting the height of the buttons at the top and bottom of the scrollbar, and thus gets the offsets wrong. You can set the scrollButtonHeight option to however many pixels these buttons take up (vertically) to compensate for that. Does this help?\nUnfortunately, this height differs between browsers and can not be feature detected. Also, it tends to change between browser versions and host platforms.. I don't have your setup available \u2014 the only built-in module that uses annotatescrollbar is the search addon. There I can reproduce the odd results you show, but only when scrollButtonHeight doesn't match the actual button height.\n\nWhen I instead set the option directly on the diffView variable, the annotations stopped appearing at all.\n\nThat's odd, and should definitely not be happening (unless you set it to something invalid or weird). Can you debug which value arrives in the annotatescrollbar addon and what kind of vertical offsets it ends up computing?\nOr, alternatively, can you set up a minimal use of annotatescrollbar that shows the issue, so that I can dig into it myself.. The problem appears to be that you're reading the diff chunks wrong (when creating annotations for the code on the left, you want the origFrom and origTo properties of the chunks, not editFrom and editTo). I have no idea what's going on with diff-match-patch there, but the fact that the diffs shown in the editor don't appear to correspond to the diffs shown on the scrollbar makes it kind of hard to figure out how accurate they are. I've set up a simplified demo at http://jsfiddle.net/z3uejph4/ . Given that Chrome gives the scrollbar handle a minimal height so that the handle's height won't correspond to the height of a single screenful, the result there seems entirely reasonable.. Attached patch should help!. Oh, right, the thing that's passed there is actually the mousedown event, and it appears preventDefault doesn't actually prevent the context menu from showing up. Attached patch should fix that.. Thanks! Could you make the indentation match the rest of the file (spaces, not tabs)? And maybe also add () to the set of characters that end a commented atom.. No, I was thinking more in the direction of (foo bar #;baz), but I've never used #; in the wild, so maybe it doesn't work the way I'm assuming it does (which is to comment out the expression after it)?. Thanks! Merged. Looks good!. Added in 50e5183b . I do releases around the 20th of each month, so this just missed the previous release.. I'm sympathetic to increasing the contrast, but I'd like to keep the hue close to what it is now. Could you try to just darken the current color, instead of making it so gray?. Thanks!. You can't, generally\u2014browser's don't allow you to read the clipboard unless the user initiated the paste event.. Doesn't work. Preparing for copy/cut when no actual copy or cut will be performed by the browser is useless, and simulating a keyboard event doesn't trigger this functionality.. Which browser, and can you reproduce it on the website (for example this page has line-wrapping enabled)?. This is likely an issue caused by additional CSS you have loaded. You could try removing CSS files or chunks of CSS files until the problem goes away, and narrow down until you find which rule causes it.. See #5421. That's not related to CodeMirror. I assume it's because you load the content inside a textarea tag, and the closing </textarea> tag in the content ends that textarea. HTML-escape the code to work around that.. Aside from saving a few bytes, does this accomplish anything?. I'm not generally a fan of pull requests that make barely-justifiable cosmetic changes, but I guess this is harmless enough to merge.. I'm not interested in switching to Babel. Please report the issue you ran into on the Bubl\u00e9 bug tracker and link it here\u2014I'll take a look.\n(Also, there's intentionally no package lock in the repository, so please don't add one.). Okay. But thinking about this a bit more, given that none of the modes or addons are loadable as ES modules, I actually don't think this is a very useful thing to provide.\nNo, i'm not interested in adding ESLint. I'm also not interested in getting random changes made to package.json (contributors are listed in the AUTHORS file, I'm really not sure why you'd go ahead and just add yourself to package.json when there's no other contributors listed there)... > As far as the modes/add-ons, would you be interested in my refactoring them as ES6 modules?\nNo. Are you aware of the work around CodeMirror 6? That's going to be TypeScript and modules-from-the-ground up. I don't think it's worthwhile to make big, potentially disruptive changes to the way the existing version is distributed or maintained at this point. Tooling that integrates CommonJS modules into ES-module oriented bundlers works pretty well, in general.. Right, now it just adds minified files... which is also something I didn't ask for (people tend to have their own build pipelines nowadays, and can do minification on that level). Sorry to be so resistant here, but opening a pull request that makes a number of unprompted changes is usually not a great idea\u2014we have a way in which we've organized our project, and though that may not be the way you'd do it, we have our reasons.\nSo that just leaves the package.json tweaks and dependency upgrades, I guess. I'd happily merge those if you further reduce this.. Nope, not a fan of source maps in distributed packages either (blows up the package size, users are only rarely interested in source locations). Yes. I'll wait for bubl\u00e9 to release my patch, and then merge this.. Great. Merged as 80eeba03634d . The rollup upgrade does seem to give us a bunch of cyclic dependency warnings, but I'm not immediately sure how to address those. Do I understand correctly that the Rollup warning is an approximation, and will fire even if the actual imports involved are not actually immediately accessed at load time (which I entirely understand\u2014tracking what gets evaluated when is a whole different problem)?. Those appear to all be spurious, but I'm not interested in adding yet another file to the repository for the sake of an external tool I don't use. Feel free to open specific issues or pull requests when you've identified a real problem, of course.. We're doing it that way in CodeMirror 6. I guess adding an option to turn that on in the current code would also be harmless. Done in fc60137b. Is this a problem outside of your in-house product? If you control the configuration, you should be able to use configureMouse to do this. Since rectangle-selection is a somewhat obscure feature, I'm not sure how much of an issue this is in the wild.. Those are good point, but I'm worried that overriding right click behavior will mess with context menu functionality\u2014I don't have a ChromeOS device around, but I'd assume that a right click brings up a context menu, and I'm not sure how that'd interact with right-click-drag actions.. Good point, I've added this to the manual in attached patch. Is it possible that the editor was initialized in a hidden state, and then shown? It needs to have a proper layout to initialize itself, so if the editor starts out hidden, you should call the refresh method when you unhide it.. I'd assume that the editor variable will hold a CodeMirror instance, which is what you'd call the method on (though maybe wordpress wraps it, I wouldn't know). Alternatively, you could enable the autorefresh addon or delay initialization until the container is visible, so that it initializes visibly.. Thanks!. Great, thanks!. I'm not willing to walk you through implementing this\u2014but if you read the docs and look at some other modes that have the same issue, I'm sure you can figure it out!. > any way I can achieve this feature?\nYes, but it's not easy \u2014 you'll have to analyze the code somehow to figure out what names are in scope.\nSince this is more of a question than an issue, I'm closing it. Please use the forum for questions in the future.. Thanks for the fix! Merged.. Wonderful!. The problem appears to be an unescaped <a>, which causes the mode to continue treating content as HTML until a matching </a> is found.\n@0b10011 Do you know if a blank line is supposed to terminate an inline HTML tag?. Agreed. Do you have time to look into fixing that in the mode?. The operation combining is intentional\u2014it works that way to reduce browser relayouts when working with multiple editors.\nAre you using startOperation and endOperation asynchronously? And if so, why? It'd make sense to make endOperation a no-op when there's no active operation, but depending on what you're doing, that might still not help.. Attached patch fixes the crash. Does that solve the issue for you?. That's a reasonable use case, and the new API in version 6 will handle this properly by default (it treats replacing the selection as a special case, and does what you need here by default). But I'm not sure this needs to be added to the core library. Have you considered using a kludge like this, in your code, instead?\njavascript\nfunction addChange(editor, from, to, text) {\n  let adjust = editor.listSelections().findIndex(({anchor, head}) => {\n    return CodeMirror.cmpPos(anchor, head) == 0 && CodeMirror.cmpPos(anchor, from) == 0\n  })\n  editor.operation(() => {\n    editor.replaceRange(text, from, to)\n    if (adjust > -1) {\n      let range = editor.listSelections()[adjust]\n      if (range && CodeMirror.cmpPos(range.head, CodeMirror.changeEnd({from, to, text})) == 0) {\n        let ranges = editor.listSelections().slice()\n        ranges[adjust] = {anchor: from, head: from}\n        editor.setSelections(ranges)\n      }\n    }\n  })\n}\n. This is not enough information for us to reproduce the problem. Does it occur for you on the demos on the website? If not, can you set up a minimal HTML demo that shows the issue?. Right, but we're not going to test 3rd-party code, so if you want us to look at this, you'll have to figure out what that system is doing to cause the problem (most likely, it fails to call refresh on the editor after changing its size or style).. I'm not able to reproduce the problem, and I don't see anything suspicious that has changed between 5.40.0 and 5.40.2, so I'm not sure how to debug this. Are you entirely certain the problem was introduced between those versions? Which browsers does it happen on?. We aren't going to add any more language modes to the main distribution. Fortunately, it is possible to write language modes as separate modules, so you're not dependent on us. . > What's the proper way to distribute language modes as separate modules? As an npm package?\nYes. You can take the elixir mode as an example.\n\nDoes this mean that you won't accept a PR to add another mode, or that you won't expend any work to create one yourself?\n\nBoth.. Travis automatically re-tests when you change the branch. The problem appears to be that you're using includes, which isn't available on all the targets that we support.. Fixed via #5633 . Thanks!. You seem to mean 'fold' when you say 'indent'. But fold handling isn't part of this mode's code at all, so I'm not really sure what purpose this would serve.. Right, it does declare a fold strategy, but I don't want to complicate the demo just to make testing that one thing easier, so I'm going to reject this pr.. Hi. We've decided to stop expanding the scope of the main distribution, so we're not accepting new additions there. But it would be wonderful if you could put this on npm under a name like codemirror-theme-ubuntu, so that others can easily use it.. Oh, right, I guess when I implemented selectionsMayTouch I missed some considerations. I guess a cursor selection should not be allowed to touch another selection (sublime text itself seems to behave the same).  Attached patch takes care of that.. Much better. Unfortunately, we also target IE8, which doesn't have Array.indexOf. So maybe use words to turn you sets into objects?. Thanks!. Thanks! Great to hear.\nFor those reading along, please channel future praise to the forum instead.. Unfortunately, how wide characters are depends on the font, and computing the actual real length of every line when determining the longest one is too expensive.\nBut I agree this behavior is really bad\u2014once the editor has drawn a line, it should at least notice that it's longer than it's current max width, and adjust that max width. Unfortunately, size handling is ridiculously complicated in the current codebase, I couldn't find a quick fix, and I don't have time to work on this right now, so it might be a while until this is fixed.. That doesn't really help current users, though. And see also https://github.com/codemirror/codemirror.next/issues/39. Attached patch adds a hack that should make this problem less noticeable\u2014the width will still be off until the long line is scrolled into view, but as soon as it's rendered the editor should notice and resize itself.. This isn't a problem I've seen before. Try to figure out which factor in your page is causing this by simplifying the page until the problem goes away.. Looks like some CSS or font loaded after the editor initialized, causing its size to change. If you can arrange for the editor to be initialized after the entire page finishes loading, or do a call to its .refresh() method when that happens, that should take care of this.. Thanks!. Right, that's what the patch tries to address, but using a factor that's not really directly related to the problem (whether we are in a braced block). Is that solid for Kotlin, or will this break some versions of indent-after-operator in other context?. One approach might be to tokenize binary operators different from other operators or other uses of *, so that the indentation rely on a binary operator being a binary operator. But that means the Kotlin mode would have to also add some operator-parsing logic in a hook.. Thanks. Merged as ea298af3!. I assume you initialized the editor in a hidden or unstyled state. In that case, you have to call .refresh() on it when it becomes visible and/or styled.. I consider that the expected behavior for optional arguments\u2014you have to pass all arguments before other arguments that you pass. Some libraries do some type inspection magic, but that's not how, for example, ES6 optional arguments work. So I think the current shape of the docs is fine. Removing the question mark implies that the argument isn't optional, which would be misleading.. Not seeing this in FF 63. There's nothing about font weight in the monokai theme, which makes this doubly weird.. Probably not in the current modes, but we're planning to rethink the highlighter system in version 6, and will probably increase the amount of information added to tokens in the process.. This works in the demos. Do you maybe a style sheet active that is setting a min-height: 300px on the editor?. Thanks!. You have parentheses after self.yaml_validator, which will cause it to be called one, one load. You want to pass the function value, so remove those parentheses.. Attached patch should help a lot with this (by batching the updates to avoid all those relayouts). This is more or less how CodeMirror 6 will work, but for 5 it's unlikely that visibility tracking will be added.. The merge addon has an option to collapse unchanged regions. Other than that, you'd have to build it yourself.. No, you'll have to call on on an editor instance, not the constructor, to listen to events. Also, events that don't exist in the library, like instanceCreated, obviously won't do anything.. You need to add the CodeMirror-lint-markers gutter, as seen in the demo.. The bug tracker isn't intended for support questions like this. You can add replies to your forum thread if you want (preferably without starting a new thread for every question), maybe someone is willing to help you there, but please stop opening issues.. You can hide both scrollbars with the scrollbarStyle: \"null\" option. Selectively hiding only the vertical one isn't something the library supports.. Thanks for fixing that! Merged.. Thanks!. This isn't really supported\u2014the cursor is always placed relative to some character in the document, and won't take padding into account. You could replace the text with a widget to get a different effect, but then the user won't be able to move the cursor through that text one character at a time anymore.. This appears to be just a matter of its error-checking being relatively simple and limited. Feel free to send a pull request if you want to fix this, but I'm going to close this issue, since it's more a matter of scope (modes are primary highlighters, not error checkers) than a bug.. I've removed the link.. Attached patch should help with this. > I wonder what is the active mode?\nThe language mode that's active at the cursor position. This'll usually be the mode selected through the mode option, but if that's a nesting node (for example the HTML mode will use the JavaScript mode to process the content of <script> tags), it may be one of its inner modes.\nSee for example the property being set on the JavaScript mode.. You misunderstood. You're adding fields to the mode options, whereas the fields should be on the mode object, which is created by the mode's implementation, not the editor configuration. If you can't change the mode, you'll have to use the closeBrackets option to configure this.\n\nWhy closed?\n\nBecause this is a bug tracker, not a support forum.. > Can you let me know how the DOM becomes readOnly if there is no such flag/attribute.\nThe DOM was read-only from the start\u2014all editing behavior in CodeMirror 5 is 'fake', implemented in JavaScript.. This is being designed in from the start in CodeMirror 6, but I probably won't be adding it to the current version. A clean pull request that does so would be considered, though.. I'd prefer a mechanism that allows any arbitrary attribute, at which point we can also use that to implement title and css under the covers, rather than adding more and more arguments to functions.\nIf you npm install the dependencies, you can run npm build to rebuild the library, and open test/index.html in a browser to run the tests.. You have a number of lint failures. Also, could you add support for the old title property on marks by creating a field in an attributes object when it is present?. > I will but you can mark new release with BREAKING CHANGES notice\nThat's what I'm trying to avoid, obviously. Does the patch break anything else? . This'll also need an update to the docs, and some new tests. And then there's the question of how attributes that conflict with attributes that the editor itself sets (such as class) are handled. Do we disallow those? Or try to merge the values somehow?. You can edit doc/manual.html to update the docs (and you'll want to mention contracts like not allowing style/class).. The lint failures are still there (click the Details link in the travis check if you aren't running the tests locally).. Oh, sorry, no, those do fail on some browsers, but if you run npm test you'll get the same thing that runs on the continuous integration server, and shouldn't be seeing those.. > Hm..I still have no idea\nYou pasted the exact error messages below that\u2014you have to fix those lint errors to get the tests to pass.\nAlso, there still aren't any tests for this new feature.. Merged as ce1f0cd6f13d4 and corrected in 01758b195653844.. Thanks!. Are the !mportant annotations necessary here?. Oh, hm, yes, the rule for the default matching brackets is oddly specific for some reason, so to override it you have to either be more specific or add !important. So sure, let's just leave those there, since I'm not sure what would break if I fixed that.. This was due to the change sticking around in the hidden textarea when it was canceled in the actual editor. Attached patch should fix it.. This is unlikely to be fixed in version 5, but mobile support is a big part of the work on version 6, which is a work in progress (that won't be useable for a while).. Late 2019, probably, but we're not promising anything there yet.. Write a tweet, and I'll gladly retweet it from the codemirror account. Thanks, I've retweeted that.\nI think for most sites running webassembly as part of the highlighter is still going to be overkill, but supporting this style of highlighter as alternative is definitely a good thing. In CodeMirror 6, the mode 'driver' will be outside of the core, so it'll be a lot easier to have different styles of modes. (We're already planning both a backwards-compat shim that can run slightly modified CodeMirror 5 modes, and a new system, which is still being designed, that is going to run a more grammar-like style of highlighter.). Maybe unpkg.com , since both those are published as npm packages. Since there's only ever a single hint dialog open, this can be a method. Does attached patch work for you?. > Updated links to unpkg links.\nThanks. I've merged that as 5740f791\n\nUpdated the linter demo page, the html code had some syntax errors.\n\nHTML5 allows missing quotes around single-word attributes and such, there's no need to 'fix' those.\n\nI created a separate js file for the htmlmixed mode linter,\n\nI'm not accepting new addons into the main distribution\u2014the recommended way to distribute new functionality is to create separate repositories and npm packages for them.. Yes, there is\u2014start with the docs for the show-hint plugin, or look at css-hint.js for a relatively simple example.. Thanks!. Please stop opening new issues for questions. Start a thread on the forum if you want, but this is a bug tracker.\nAnyway, I pointed you at the css-hint file for an example, which is simpler. But yeah, reading code is going to require figuring out why the 'random functions' are there, that's an effort you'll have to make.. Attached patch fixes this. The original code was rather confused. CodeMirror releases happen monthly, around the 20th. I'm not sure how closely Jupyter follows them.. That appears to be using ACE, so it's not much of a CodeMirror use example.. This is a side effect of the hack we need to make the context menu work (the hidden textarea has to be visible and under the cursor when you click, on on IE11 setting opacity doesn't hide the cursor), and not likely to get fixed in version 5. Version 6 will not need this hack anymore.. Oh, that's bad. I'll see about installing a windows VM to test this soon.. Patches adb4ad3f7fc4 and a21ea6f496f0 should resolve this.. That's out of scope for this project, but it'd be neat if someone else worked on something like it.. Ah, yes, I missed this mode when introducing the type token type. Thanks for fixing that!. Sorry, no, we're not changing our tooling to please other people's build process.. @pabloferz Do you have time to take a look at this?. This is just a limitation of the scope of the dialog addon. At a certain level of complexity, it's probably easier to write your own dialog than to try and force the existing addon to do what you want.\nBy the way, your code does weird things like setting the same value in all inputs and trying to select more than one of them, which illustrates further complications to the interface that would be needed to support this.\nI'm not interested in adding that complexity, so I recommend you fork the addon.. Our current approach is that the caller of markText is responsible for making sure that the given start and end point fall on code point boundaries. This usually happens naturally, since you'll be using meaningful endpoints that you got from somewhere like selection positions or word boundaries, but if you blindly add 1 to a position that does cause problems.. Yeah, UTF-16 is a really terrible thing, but unfortunately something we have to work with in JS.. > Is it possible to catch the shortcut\nNope, unfortunately, browsers do not allow scripts to capture these keys at all, so there's little a JavaScript library can do about this.. I see \u2014 in that case, you could submit a pull request. The vim mode doesn't have an active maintainer anymore, so it's unlikely anyone else will pick this up.. MIME types are used to find modes, and text/plain should not be mapped to the jinja2 mode, so this is not a good idea. You could find or make up another mime type that actually identifies the mode, but you can't use text/plain.. Definitely!. Either is fine, doesn't really matter.. Thanks!. Thanks, but could you maybe find a place where all postges keywords are enumerated and add them all at the same time, rather than one by one in separate pull requests?. Guess not. Merged anyway!. Attached patch should help.. The vue mode doesn't treat the content of {{ }} as JavaScript\u2014it seems to simply treat it as flat text until }} is found. As such, it won't show you JavaScript completions in there, and you don't get meaningful highlighting. The core team isn't maintaining the vue mode, so if you want to fix this your best bet would be to try your hand at a pull request.. We don't have anyone following the standard closely, so yeah, it's possible that things are forgotten. This is the first time I hear of the fr unit. You 'units like fr' \u2014 are there others that we should add?. Only on macOS, right? Could you make it so that these are only added there?. Looks great now! Merged as 4330d068. This looks like your editor doesn't have its final layout when it is initialized, either because style sheets (or fonts) are still loading, or because the element isn't part of the DOM and/or hidden at that time. Call refresh when the editor is visible and its layout stable to make it re-measure its size and fix this.. Thanks!. We're not adding modes to the main distribution at all anymore, and don't take requests for new modes. The best way to get a new mode is to implement it yourself and distribute it as a separate package on npm (see for example the elixir mode). Thanks for the PR! I ended up fixing it in a simpler way in be9d254e. Oh, good point. How about patch 64f7d4ce?. Doing this in a more clever way would be desirable, and we'll probably think about how to do that in version 6, but for this version, we're not going to overhaul existing addons anymore, so unless you write a solution as a separate package, this won't happen with the current codebase.. Ahh, right, that was caused by the parser treating class and interface declarations the same, and getting confused when there was neither a body nor a semicolon after a method. Attached patch should help.. You didn't provide much context, but it appears the string you're providing to the editor as content contains actual \\ and n characters, not newlines. If you give the editor newlines, it'll create line breaks for them.. We're not taking feature requests for new modes, or generally adding more modes to the main distribution. But you can implement and distribute modes as separate packages if you need them.. The yaml linter file doesn't appear to properly declare js-yaml as a dependency, and instead gets it from window.jsyaml. As such, to use it, you'll have to make sure that property is present and holds the library (something with a loadAll property).\n(yaml-hint.js was contributed and is pretty much unmaintained at this point). Could you make it so that these can be modified at run time (which is what the callback passed to option for spellcheck is for), and add them to the manual?. Thanks!. You're expected to pick a dialect (via a mime type string). But I agree it's not very useful for the mode to not recognize any keywords when you don't\u2014attached patch fixes that.. Instead of \"sql\", you set the mode option to something like \"text/x-pgsql\".. This isn't going to happen (at least not in the core library) in CodeMirror 5. In version 6, we are taking some inspiration from TextMate syntax bundles (which ST's system is based on), but it's unclear whether we'll directly support them (these use a regexp format different from, and more powerful than, JS's regexps, so they aren't trivial to run in the browser). I don't know where you're putting that code, but it doesn't look great. The recommended approach would be to bind a new command to Enter (using for example extraKeys), have that check for editor.state.completionActive, and return CodeMirror.Pass when it's false.. You'll have to figure it out from the manual. > and return CodeMirror.Pass when it's false.\nSo you'll need a ! in front of the condition there.. What is this commentRange method and where is it coming from? It doesn't appear in this repository.. That code was dropped in version 3.0 and is no longer part of the project (so autoformatting isn't a feature of this library anymore, and if you need it you'll have to look for other packages that support it).. Thanks!. Works for me, when I run it with the current version of CodeMirror. Might be some of the other logic in there\u2014that's definitely a lot more complicated than the code you showed above.. In version 6, themes will be their own semantically versioned packages. I didn't look too closely at that patch, assuming it just fixed some contrast issues, but yeah, it looks rather invasive. Will take better care next time.. Could you try to reduce the breaking test case to the minimal code needed to trigger it?. If I paste this into https://codemirror.net/mode/javascript/ it seems to highlight fine. > The code is slightly modified in order to support special highlighting for the p5's functions and variables (which is the main cause of trouble)\nI am not going to support you modified version of the code, sorry.. Thanks for looking into this, but it seems very scary\u2014just turning off the applying of the actual change event in applyTextInput definitely cause things to get confused. Would it be possible just let it apply its input, and then making sure that the DOM change caused by the key press is somehow handled so that it doesn't cause the same change twice?. It may just work already, but we have to make sure that the DOM update happens before the editor tries to read from the DOM and update the document twice for the same change.. Did you test whether this breaks middle-click paste on Chrome? There dispatchEvent will also be present, so if it works as-is on Chrome, it looks like the fallback code isn't going to be used anywhere.. Unfortunately, this works neither in Chrome nor on Firefox for me (using Linux). I'm testing with Firefox 64.0.2. I can't see the page you put up (there's no link), but retrying the patch, I can see Firefox work now. Chrome (71.0.3578.98) still doesn't do anything when I middle click on an editor.. Same problem. Though I did notice that middle-click paste on Chrome works when the editor is unfocused, but not when it has focus.. Not a silly question at all, it seems! It doesn't, and in fact old versions also no longer work, so I guess something in Chrome changed that broke the existing kludge. Interesting that no one seems to have complained about it yet.\nGiven that, I guess it'd be a good idea to drop the focus kludge code entirely, since it won't be firing or working anywhere.. Maybe. I'm using Debian 9.6. Are you able to test with Google's Chrome packages?. I guess it's more likely to be a strange local issue, at this point. I'm spinning up another Debian machine to see if it's better there.. Hm, nope, same problem in Chrome 69 there.. (And by 'same issue' I mean that it doesn't work at all before your patch, and only works when unfocused with the patch, so the patch still is an improvement.). Yes, I think that's reasonable. Thanks for figuring out this workaround for Firefox!. We don't provide a pre-minified version, but you can install terser or uglify-js and run it over the code, and you should be good to go.. (The vim bindings are not being actively maintained, so feature requests are unlikely to get acted on.). Attached patch somewhat fixes this\u2014the line numbers will still overlap when a visible line ends up being less high than a line number, but at least the height calculations will make sense. Does that help?. 'Adding a title' can mean a lot of things. If you want text above the editors, you could try putting that text above the merge, with a similar width to the merge panes. Putting extra nodes inside of the panes isn't supported.. Yes, it would make sense to fix that. You'll want to use CodeMirror.innerMode to get at the current mode.. If you mean we should include the build artifact (dist/codemirror.js) in the repository, no, that's not going to happen.. That's odd, that buttons would be set to zero. But in general, refresh is an expensive, somewhat invasive operation, and calling on every focus event is not a good idea, so the easiest way forward would probably be to find a way to do what you're trying to do that doesn't involve calling refesh on focus.. Thanks, that's that I meant. Merged!. (You have some linter errors due to using undefined variables.). Thanks!. Markers can't be changed during their lifetime\u2014that hack might work, but it's not something the library expects, so it's likely to break in subtle ways. The only way to do this would be to remove the mark, make the changes, and recreate it in the proper new position.\nMore generally, if you don't want inclusive behavior, maybe the mark shouldn't have those options enabled?. > Maybe it would be good to separate the \"no cursoring before or after\" meaning into a separate option called preventCursorLeft/preventCursorRight (which has no effect on non-atomic ranges)?\nProbably! If you want to implement this (in a backwards-compatible way, so that if these options aren't present the old behavior persists), a pull request would be welcome.. Your diagnosis was pretty accurate\u2014attached patch switches to a timestamp, rather than a boolean flag, so that if no input is found after a paste event, the \"paste\" origin doesn't get attached to the next input event.. Yes, there is!. Which browser and platform are you using? On Firefox Linux, access keys work with alt+shift, and pressing alt-shift-x while the editor is focused in your demo does focus the select field. If there's some other command bound to a key combination that's also used as access key, then yes, the editor will preventDefault that event when handling the key combination.. macOS does some really strange character insertion on some key combinations. See also https://github.com/codemirror/CodeMirror/issues/2689. You have to make a call to .setSize() (without arguments) on the editor instance to make it query its new size and update itself. Unfortunately, the DOM does not allow a script to notice when a given element is resized or restyled (short of expensive polling), so CodeMirror relies on you telling it when to update itself in that case.. Nice, another 'feature' that doesn't get mentioned at all in the \"spec\". Seems to work with & too.. The default theme intentionally doesn't color those. You can use the inspector to figure out the class of a given token.. Some of the errors in the travis run seem spurious (I can't see why they'd occur, and they don't occur for me locally), but the core_atomicMarker test is definitely failing for me (both in Firefox and Chrome).\nAlso, I prefer to avoid negatives in option names (because you get a double negative when you set them to false), and this applies not just to cursors but to any selection endpoints, so I'd prefer to rename these to selectLeft and selectRight, and inverse their meaning (making sure they now default to the inverse of the corresponding inclusive option).\nFinally, you failed to update the anchor name in the docs for preventCursorRight.. npm test is indeed how you run the tests, and they are passing on the master branch for me.. The Kotlin mode isn't actively maintained at the moment, I believe, but you could try submitting a pull request.. > When calling refresh it would reset the view but I believe it shouldn't be required (to call the function).\nIt is, though. The editor can't notice when it becomes visible, and it needs its size to draw itself properly.. Thanks!. Merged!. Thanks!\n. Questions such as this one are better put on the forum, not the bug tracker.\nThe markText method, especially its readOnly option, might be of interest.. Works for me in both Firefox and Chrome (also on Linux). Could it be that your system is capturing that key combo before it gets to the browser?. Oops! Thanks for noticing that. Merged.. Hi. Thanks for the pull request, but we're not accepting additional new modes into the main distribution. The recommended way to maintain and distribute new modes is as a separate npm package. You can see the Elixir mode for an example.. Wonderful!. This is the same issue as #5056. > So what's the use of textAfter argument?\nIt will, as you guessed, give access to the text after the line break when you press enter inside a line, which is useful when you want to align closing brackets with the indentation of the line that started them or something like that.\nShift-tab reindents the selected lines. Modes can declare an electricInput regexp that, when typed text matches it, will cause the current line to be reindented.. This was intentionally left in in commit 3675309 , in order to make jumping to angle brackets work in the vim bindings.\n@yoongu Apparently, supporting this has the side effect of treating < and > as mismatched brackets when scanning for other kinds of brackets. In languages where they don't act as brackets, and will thus appear on their own, that is a problem. Can you think of a workaround? Maybe only including those in the string passed to findMatchingBracket when actually matching an angle bracket makes sense?. > Is there a good reason why unmatched brackets of one type need to interfere at all with matching brackets of another?\nfindMatchingBracket was written for bracket-matching, which highlights mismatches as well as matches.. That looks reasonable\u2014if the vim tests continue to pass with that change I'd be happy to merge it.. Done in #5798. I'm not actively maintaining the Swift mode, so the quickest way to get this fixed would be a pull request.. Looks like this isn't a finished standard yet. A pull request that adds it to the list of non-standard property keywords in the mode would be welcome, though.. They look fine on the website (d, clike). That screenshot is also showing highlighting. Are you sure the problem isn't in your setup?. Set the mode to text/x-d, not just d, which is (for some reason) a generic unconfigured version of the mode that doesn't know about keywords and such.. Use getLine to get the line's content and run you regexp directly on the result? The point of search cursors is that they abstract the multi-line seaching logic. If you don't need that, you probably don't need an abstraction at all.. Thank you!. Going by the screenshot, I'm going to assume you're trying to define a custom SQL dialect. If so, yes, that screenshot pretty much shows what you should do\u2014define a MIME type with name: \"sql\" and your language description in the other properties. To access the values used in other SQL dialect, which you might want to use as a base, you can use CodeMirror.resolveMode(\"text/x-....\"), which'll give you the configuration object for the MIME you passed.. Yes, that's a known limitation\u2014you have to call .refresh() on the editor when it's added to the DOM (if it's not initialized there). This is unlikely to change in version 5 (there is, at least in a bunch of the supported browsers, no way for the editor to notice it has been added to the DOM, short of polling, which is unattractive). We don't accept new modes into the distribution anymore. The recommended way to distribute this would be to create a separate repository and publish it to npm, like the Elixir mode mode does.. Wonderful, thanks for releasing it!. The patch seems innocent enough, so I've merged it, but I don't think matching characters where the code can't see the difference between opening and closing character is going to work\u2014being able to do that is an assumption here.. Hm, right, since the other fonts are also monospace I guess this fits the spirit of that line. Merged!. On Linux, sort_lines is bound to F9/Ctrl-F9 by default. This may be a platform-dependent binding. What platform are you on?. Looking at the default keymaps, yes, this is macOS-specific. Could you change your pull request to move the F9 bindings to pcSublime and put the F5 ones in macSublime?. Thanks!. Unfortunately, the scope of the main distribution has crept outward far enough, and we're no longer accepting contributions of new modules like this, which could also be distributed as separate packages. So that's what I recommend\u2014put it into its own repository and publish it on npm as something like codemirror-keymap-jetbrains. I don't think so. There are a number of modes on npm, though.. See my comment at #5805. Could you check editor.display.barWidth and see if it corresponds to the actual width of the scrollbars?\nThe vertical sizing is basically magic at this point, due to all the tricky constraints and limitations produced by our scrolling model and CSS's (lack of) capabilities, so debugging it is unfortunately not very easy.. What kind of autocomplete do you want? HTML, CSS, JavaScript? Have you loaded show-hint.js and the module that provides completions for the language you want?. You still didn't tell me what modules you've loaded, and your screenshot shows an editor with only JavaScript, which isn't what the htmlmixed mode provides.. Could it be that addon/hint/show-hint.css isn't loaded?. Well, then I'm out of ideas. If I load these files into mode/htmlmixed/index.html and add an extraKeys option like you have, autocompletion works fine for me, in each of the languages.. The clike mode doesn't currently have a concept of property tokens (which many other modes do recognize), which is why you're seeing any non-keyword identifier styled as a variable.\nDepending on how complicated this needs to be, you might be able to add a hook to the Kotlin mode (see the Ceylon mode, also declared in clike.js as an example) that parses identifiers after a \".\" token, and possibly other tokens, differently.. > Someone is going to fix this issue someday?\nMaybe\u2014the intersection of Kotlin mode users and those who notice property name highlighting is probably pretty small, and us project maintainers have decided not to pour more effort into all the various contributed modes because it's becoming overwhelming.. > Is there a way to group multiple history entries such that they will be undone together, or should I try to get them to merge, despite their separate origins?\nWrapping the calls that make the changes in a call to .operation should have this effect.. CodeMirror draws lines whole, which means that when they are extremely long, as in your test file (which doesn't have a single line break), there'll be a lot of DOM content created, and the browser will have to do a lot of work to lay it out. This is unlikely to get fixed in version 5.x. That'll definitely increase the serverity of the problem by creating more DOM nodes, yes.. Thanks for looking into this. We're targeting older runtimes that don't have an includes method\u2014could you use indexOf instead?\nAlso, I think closeBefore would be a clearer name for the option.. Wonderful!. Thanks!. Nice, thanks. Merged as 2c123a4a\n. Thanks!. No new modes are going to be added to the main distribution. If you want a LOLCODE mode, you're going to have to write it yourself (and distribute it separately).. /g does work in IE. (And if it didn't, the new RegExp(.., 'g') also wouldn't work.)\n. You can register regular DOM event handlers on the wrapper or hidden input. Key events will propagate through, so you'll be able to observe them.\n. I'm not quite sure what problem you are describing. Doing .join(\"\\n\") on the array in the change event will give you the precise text that was inserted. If auto-indent happens, it will be included in a change event (possibly a second one, depending on how it was triggered).\n. Doing it on the window doesn't sound like a good idea (you'll also get key events that don't originate from the editor). CodeMirror.on also does DOM handler registration (in an IE-portable way), by the way.\n. You want CodeMirror.on(cm.getWrapperElement(), \"keydown\", function(e) {...}) -- i.e. the static function on the CodeMirror object takes three arguments, with the first being the object to listen on. cm.on is a shorthand for this that has cm bound as the first argument.\n. Why remove this?\n. I don't see how this won't often leave the cache size at a too-low value.\n. It would be great if you could put unrelated fixes / changes in different pull requests, so that we only have the actual selection stuff to discuss here.\n. This appears to correspond to display.cursorDiv.childNodes at all times. Do we need it?\n. This is a nit, but I'd prefer if you'd follow my style of only adding braces when necessary (or in an else chain when one of the branches needs braces)\n. Let's put this class on the wrapper of the cursors instead. Easier to update.\n. Well, here slightly scary code became full-on terrifying. See my other comment about the borders on the selection. Looking at this, I'm very suspicious that there are a bunch of bugs hiding in it. This is exactly what bug-hiding code looks like. We should somehow simplify it. I just don't know how yet ;)\n. I'm about to relent on this -- it's a bug-masking change, and I prefer for bugs to be noticeable... but yes, infinite loops are also bad. Very bad, for the user. In any case the change definitely doesn't belong in this pull request.\n. (Also, I think you should clip the length of the cache array itself as well when you change this.)\n. IE7 isn't really supported anymore, so feel free to kill the try kludge.\n. Why is movingUp an exceptional situation?\n. A comment with the intention of this block would be good. I guess it's a heuristic for whether the paste should be divided over the selections or repeated, but I can't figure out the exact idea.\n. Maybe have the most recent selection be the primary one, and always scroll that into view?\n. This looks a little odd -- in that you added a conditional reset, but left the other one (below) intact. I don't see how this will prevent the reset from taking place.\n. This is causing the algorithm to always indent all the way back to the left when pressing . That makes it rather unpractical.\n. Use CodeMirror.Pos for this.\n. See http://codemirror.net/doc/manual.html#getLineNumber . Don't duplicate that here.\n. How about using getRange (http://codemirror.net/doc/manual.html#getRange) with third argument false on the whole range and iterating over that, instead of doing all this for each line?\n. Why do you pop the keyframes context here? Won't we need to return to it when the block ends?\n. Do I see correctly that this is the only actual change, and the rest is just formatting/branch shuffling?\n. What functionality exactly is meant here? The matchbrackets addon exposes a method findMatchingBracket -- maybe simply depend on that?\n. I don't think quote matching really belongs in matchbrackets.js . It is a different problem (doesn't concern itself with nesting). I'm not even sure what a language-independent quote matcher would look like (escaping rules differ). Maybe it could look for string tokens and find the matching start/end quotes on a series of subsequent string tokens?\n. What was the rationale behind this change? It seems like it'd prevent the parser from recognizing strings as atomic expressions.\n. Why did you use a keydown handler, rather than the addKeyMap method?\n. I don't think this should be global. To store a per-editor property, addons usually just add it to the .state object in the editor instance.\n. In the Linux bindings for ST3, ctrl-k is bound to delete the word before the cursor (as it is in CM's default bindings). Maybe this is different on Mac? If so, could you research how the bindings differ, in general, between mac and non-mac platforms?\n. What is the intention behind these scrollIntoView calls?\n. Oh, you're changing mapK, not map! Ignore the previous comment.\n. These two (insertLineBefore and insertLineAfter) are similar enough that you should probably define a helper function that performs the logic, and call that (with an argument to distinguish between the two cases) from the command functions.\nMake sure you wrap the actions in a call to cm.command when making more than one change. This prevents multiple (expensive) display updates, and ensures that the effect will be a single undo event.\nAlso, you can probably simply gather the selections in an array and call setSelections once to add them.\n. (In principle, I agree, but in my own tests, I've been stuffing multiple related tests into a single case in order to save on setup/teardown -- creating a new CodeMirror instance is cheap, but not trivially so. The 400+ vim tests are currently taking up the majority of the time it takes to run the test suite, and, in practice, a slower test suite means it is run less. Maybe we should look into optimizing the vim tests by reusing an editor and resetting it?)\n. I doubt you wanted to unregister the same handler twice. Is this simply accidentally duplicated or is it trying to do something else?\n. Ah, I see now, you forgot the event names -- \"keyup\" and \"mousedown\"\n. Try to make this consume stretches of non-{ chars in a single call, so that not every character becomes its own token.\n. There ids probably don't belong here.\n. Why are these prefixed with .CodeMirror-focused? It makes the active line look wrong when the editor isn't focused.\n. Why not use an object literal with all these as properties and save a lot of repetition?\n. Actually, since most are simply the same word with end prefixed, I'd even use a loop over an array for those --- openClose[w] = \"end\" + w.\n. Matching a single RE that |-s them all together is likely a lot faster (though i'm not sure this is slow to a serious degree)\n. Are you sure you want the editor to reindent the line on every letter? That might be very annoying when trying to align something in a custom way.\n. (Also, somewhat expensive when typing quickly.)\n. Could you take the module loader shim from the current (version 4) code in another mode, and use it here as well? All modules in the distribution are now wrapped in commonjs and amd-compatible wrappers.\n. You should check for the amount of selections before changing anything. Right now, if there are multiple selections and some of them contain text, the first if will clear them, which isn't what you intended, I assume.\n. Also, the console.log shouldn't be there. And I prefer spaces after if and before {.\n. What if the custom completion handler (completion.hint) doesn't work with a selection? Maybe you should simply kill the selection (if there was one) at the start of this method.\n. \\s should definitely be in there. Why did you remove it?\n. But what if someone presses shift-end or similar, and changes the selection here? That would mess things up. Maybe, in the case where there is a selection, require its head to be the same one we started with.\n. Try to configure your editor to not kill trailing newlines (or if you did this manually, don't do it).\n. A possible solution to the electricChars issue would be to allow that property to contain a regexp, in which case the reindentation will only happen when the line (up to the newly typed text) matches the regexp. Does that sound like it'd work for you?\n. I've attached a patch (81b81d8) that allows you to do something like\nelectricInput: /\\bend(if|for|...)$/\nAnd it'll reindent when someone finishes typing one of those words. (I don't know enough about the syntax of the language to give the whole regexp you'd need, but I guess that's not hard to figure out.)\n. What is cm-rainbow?\n. Neither CodeMirror-searching, nor CodeMirror-searching-current, nor searching-current are used anywhere in CodeMirror, so they probably don't belong here.\n. I'd prefer an && rather than a nested if here.\n. Is 'dollarslashy' really the technical term for this? If so, the variable name is fine. If not, try to make it less silly.\n. You seem to have removed the logic that prevents triple-quoting in the case of a regexp. Is there a reason for that?\n. I assume this should have a !tripleQuoted && in front of the condition, since $/$$ is not a triple quote.\n. You have this.delay where it should be this.wordsOnly.\n. This remains empty forever, given the current code, right? What is it for?\n. This'll give you a one-character string equal to ch, which is probably not what you want.\n. Yes, \"comment\" would be more appropriate here.\n. Why is this stored in tokens if it is only ever called once (immediately after being stored) anyway? At least, it seems that, since it starts by replacing tokens[0] with tokenString, it won't stick around.\n. What is this file for?\n. I'm not a fan of !important rules. Don't the two classes already give this enough specificity to take precedence in all actual situations?\n. I doubt these plus signs are supposed to be here. I've removed them in my merge.\n. This state looks like it mostly works, but does so by accident. Is the rest of the line after a command always the continuation of the command? What if a line comment starts immediately after a command word? You can include a rule without regex (always matches) that has next: \"start\" to also go back to start when nothing else matches, but then you might as well make your directive rule immediately consume the text after it (using groups and an array of token styles).\nCan directives span multiple lines?\n. You probably want to add \"(\" and \")\\b\" here so that addiction and such (words that start with a directive keyword) don't match.\n. (If you really want a console.log in production code, write console[\"log\"] to prevent the linter from complaining.)\n. Use two spaces, not tabs, for indentation.\n. string isn't a keyword. Also, you could just use strings to identify states, rather than named integers, it's more idiomatic.\n. This appears to never be true in the case of \",\" and \";\", and always true in the case of \".\". Probably not what you intended?\n. I think you can just use /\\w+/ here to get the exact same effect (the regexp above will consumed all numbers, and in JS _ is part of \\w)\n. You're including the paren or dot in the keyword token. You should probably pass false as second argument to match so that you don't consume the match..\n. stream.peek() is still in the peek variable, no?\n. (indentation)\n. Are there multiline strings in this language? If not, you don't need to keep string context in the state -- you can just immediately parse the whole token.\n. Mutating stream.string is really unlikely to work well. Why do you need it?\n. If you iterate backwards over the ranges (they are sorted), you won't have to do listSelections every time to access the current selection, and you protect yourself from weird corner cases, like if you have two cursors one char apart and deleting the character after the first removes the second, which I believe would result in an out-of-bounds array access and thus a null reference in the current code.\n. Again, prefer iterating backwards.\n. There are various points where you are assigning to properties of thisMode, which is, unless I'm really confused, referring to the parserConfig object passed to the mode. This object is shared by all instances of the mode (it is the value passed to defineMIME), and thus you probably shouldn't be changing it.\n. The 5 properties above could simply be variables. That'd also remove the need to pass the thisMode around, I believe.\n. How about making this a function, rather than putting it in the hooks object, though no dynamic dispatch is needed?\n. Why indirect through codeRegion, rather than simply doing this right away in the if statements above?\n. I'd call this hooks, since it could also be used by other dialects, and there's nothing vx-specific about it.\n. Please put spaces around binary operators, everywhere.\n. You should be able to use CodeMirror.countColumn(cm.getLine(cursor.line), cursor.ch, tabSize) to get the column at which the cursor is. That's probably cleaner.\n. Doesn't it look better when you also style comment-delimiting braces with the \"comment\" style?\n. Similarly, I'd also apply some token style to these (and the corresponding closing braces). Maybe \"bracket\" is appropriate, or \"tag\".\n. You'll probably want to use something like /(?:else|this)\\b/, so that the start of 'elsee' does not match 'else'.\n. Since all Handlebars comments are multiline, maybe 'dash_comment' or so is a better name.\n. I think it makes more sense to put this on the parserConfig object -- that's where mode-specific options go.\n. Why not check this in onMouseDown? That'd also save the extra condition above (when deciding between a drag and a select).\n. Definitely don't make random style changes to projects you didn't write.\n. This has nothing to do with the pull request as a whole. Split such things into different pull requests so that discussion and review can stay focused.\nIn this case, I am not really interested in including this file, as none of the editors I use recognize it, and I don't want to accumulate tooling cruft that I have no relation to in my projects.\n. Again, different pull request. No matter how trivial, it does not belong to this feature.\n. I'd prefer this as a separate command that passes around its own state. It is conceivable to want both incremental and non-incremental search on the same instance, so having it as an editor-global flag is undesirable.\n. So do I understand correctly that with this change you're no longer updating the search on every change to the query field, but only on enter presses?\n. Why are you complicating the test here, though?\n. I would think we want to keep the automatic linting in the demo.\n. No, I don't think you are right. true !== false is true. With the !== false condition you only turn of the change event handler when lintOnChange is explicitly set to false, which is what we want.\n. > Am I missing anything?\nYes, you are. The precedence of ! is higher than that of !==, so you're comparing (!a.lintOnChange) to false.\n. No, it is state.options.lintOnChange !== false. See 38c3e9c for the correct patch.\n. I don't think i is the correct value here -- the two array lengths aren't necessarily the same, see the if (ref.file == name) condition above.\n. Isn't Mustache compatible with Handlebars? Would it make sense to use the more advanced Handlebars mode as a dependency instead?\n. You want to put the \"use strict\" in the main body \u2014 here it'll only affect the module header.\n. This appears to be a copy-pasted version of the HTML mixed mode demo. That doesn't really show what this mode can do, does it?\n. So the examples of single-file vue apps I found online seem to use <script> tags to delimit parts of the document. Since the htmlmixed mode already allows you to customize the way the content of different types of script tags get parsed, I'm not convinced that this mode adds a lot.\n. Reviewing this now. Just a general point: I really have better things to do than review randomly inserted unneeded braces in already existing perfectly fine code. Don't muddle up your patches with that stuff.\n. Looks like you're trying to express something non-trivial here. You might want to use electricInput instead, which allows a regexp (which is matched starting from the start of the line) to reduce false positives.\n. Why is this only done when somethingSelected is false? Isn't that the situation in which it should not be done.\n. Ah, somethingSelected: false is how you indicate that completing with selected text is allowed? That doesn't seem like the obvious choice.\n. How about moving the styles into an object, say styles, and using a for/in loop to do the overriding? That's less noisy and easier to extend in the future (it does make the patch bigger, requiring you to rename all references to these, but that should be safe and improve clarity -- I've found myself wondering what, say, code refers to in a given context).\nAlso, since these aren't direct CSS classes (they will be prefixed with cm-), we tend to call them styles or token types, not classes. It'd be good if the option name reflected that.\n. Why did you remove the mode-preserving logic here?\n. You should probably also check that stream.sol() (start-of-line) at the start of the function, so that you only respond to > characters at the start of the line. Or am I missing something?\n. stream.skipToEnd() is faster\n. Modes that wrap other modes need to implement an innerMode method, to make things like completion and folding aware of the actual mode. (See, for example, htmlmixed.)\n. This seems to ignore nested tags within a single JSX expression.\n. What about the less-than operator?\n. The XML mode already tracks nesting (including understanding HTML close-tag-less tags, but I'm not sure JSX even allows that), and you can use that to determine when you're at the end of a tag. \n. if (bar<tagname) is still not a JSX tag. You'll need the same check that the JS mode needs for determining whether a regexp can start at a given position, which is why I initially suggested a hook exposed by the JS mode.\n. Start each JS fragment with its own clean XML mode state, and exit it when after the end of a tag, that state's context property is null (meaning there are no remaining unclosed tags).\n. This'll disable all highlighting for the parameters. That seems undesirable. Also, I believe Scala allows default values for parameters, so the actual syntax for a parameter list may contain arbitrary subexpressions, which I assume your regexp won't cover. Would it make more sense to delay the context manipulation until reaching the =>?\n. This file was retroactively wrapped in a module scope, hence the flat indentation. Please preserve it, so that indentation is at least coherent.\n. The DOM for a read-only editor is (supposed to be) structurally the same as that for an editable one. What is the reasoning behind this conditional?\n. > but then, how to conveniently request tokening of the rest of the current line?\nYou don't need to, I think. You just change your hook to run on the \"=\" character instead, and when it sees a \">\" ahead, it changes the current context to not try and align its body.\n. Does patch dbb2a5c help?\n. A stream only encapsulates a single line, so you can't have tokens that span lines. Instead, you have to use your state to remember the fact that you're in a multi-line comment, and return a \"comment\" token for each line that's part of a the comment.\n. Doesn't stream.match(/\\s*;/, false) make more sense here? It's simpler, and wouldn't require mucking with stream internals.\n. What is \\b?\n. This seems unnecessary.\n. Bad indentation here (and in the if statements below). (Figure out how to auto-indent in your editor, so that you don't have to think about such things.)\n. Could be if (stream.match(/^(\\d*\\.\\d+(e[\\+\\-]?\\d+)?|\\d+\\.\\d*|\\.\\d+)/)) { ... }.\n. Bad indentation again\n. Since you're never updating the scopes property, you might just remove it (along with the indent method, which doesn't work in the current code.)\n. There's some strange whitespace and text here.\n. There isn't (your code also won't be able to) -- if you need logic that goes across lines, you have to track state and continue reasoning in a later call to token.\n. Ah, sorry, not sure why I didn't recognize that. So again, it's easier here to just call match with a single regexp.\n. The project uses two spaces for indentation. And you can directly put the call to sol() in the condition, no need for a variable.\n. You can just add this to the condition of the existing if with &&. No need to add another wrapping if\n. (two spaces)\n. As far as I can see, this will only work if you iterate over the selections in inverse order -- right now, your deletes will, if multiple cursors are on the same line, misalign later deletes, which are still under the impression that the cursor is in the old place.\n. Is a method like public(...) {} allowed in TS? (Similar to how you can do get(...) {} even though get is also the prefix for getters).\n. Is the || true temporary? The cruft npm adds when a script fails is pretty awful, but I think in this case we'd want to preserver the return value.\n. Two files whose case-insensitive names are the same seems like a bad idea -- some fool will want to check this out on a FAT filesystem at some point. Maybe rename codemirror.js to index.js?\n. These seem like they should be imported from an options (I'd rename default_options to options, since it also holds the definition of defineOption) module, and only attached to CodeMirror in codemirror.js/index.js  (along with defineOption)\n. Since this is rather random, fiddly DOM code, maybe move it to event/index.js and the other event code to event/mouse.js event/key.js etc?\n. And that (awkward double imports, or alternatively adding default: Pos in this one) is why I don't like default exports very much.\n. I'd put all the scary DOM reading stuff that follows close to the display drawing code, rather than here (yeah, I know, it was here in the original file as well)\n. (Having a display/ dir with all the display-related code is probably a good idea)\n. Seems like a good candidate for history.js\n. This one and the functions below might be more appropriate in mark_text.js\n. How about display/scrollbars.js for this one?\n. Maybe a display/gutters.js for this one and the one below? That leaves only themeChanged in this file, which you could smuggle into some other relatively generic file to drop this module entirely.\n. Why is this a function instead of the top-level code it used to be?\n. I think display/selection.js sufficiently suggests that this is about the way the selection is displayed (i.e. maybe leave off _draw in the filename)\n. I'd be tempted to move the chunk prototypes to Doc.js and the update logic to changes.js, and drop this module (since it mostly contains stuff that I wouldn't expect here, based on the filename)\n. Why not directly export the prototype object?\n. We can unwrap the anon function here, since the module system will isolate this (and if we move to let it won't leak any bindings anyway)\n. I'd prefer to the line/token-rendering to live under display/ somewhere.\n. Since the rest of the stuff related to views is in display/view_tracking.js, I'd expect this there as well\n. This one's name doesn't say much about its content. Maybe move it into a bigger utility module, or call it mode_state.js\n. Fair enough, but note that LineView is also used for lazy display updating (see regChange and the way the line update code works)\n. Why do you clip to 1, and not 0?\n. (I'm happy to get rid of the per-file header thing. If that's in the way at any point, feel free to just drop it. I should probably have mentioned that earlier.)\n. Let's just get rid of it. The more this becomes a group project the less comfortable I am with plastering my name all over it.\n. Why the escaped slashes?\n. Ah, right. The situation is no better in Emacs' js-mode, unfortunately.\n. Does it still work when you only wrap the first access to document.activeElement in a try? Non-trivial code wrapped in error-swallowing try/catch scares me, since when someone introduces a bug there, we probably won't notice.\n. The loop is to 'break out' of shadow DOMs (which old IE's don't support, hence it was missing from the other implementation)\n. This looks like it will often append undefined/null to a string.. I prefer that you make styleActiveLine optionally take an options object as value, instead of a boolean, and read a nonEmpty option from there when it is given. That's how other addons tend to do it.. You don't need to store anything in the state. You can just read the options when you need them using getOption. Why did you remove the copyObj? This'll remove the constructor property from instances.. Err, duh, you made it a regular class, so that's not an issue at all. Ignore this comment.. You're not calling your namespace function, so the code is never executed.. You've got a missing comma here. Doesn't this mean you're giving findFirst permission to measure the position of character -1, which isn't something that actually has meaning?. Ah, makes sense. So this is just a somewhat kludgy way to make sure begin can end up being 0? Any chance we can express the search predicate in such a way that the two -1's and the final +1 disappear?\n(I'm deeply suspicious of code that's littered with +/- 1's, since it breeds off-by-one errors -- which I think you mentioned you had a lot of.). This reads as 'get the position for which the previous character is on a different wrapped line', which I find easier to parse than the old formulation.. Thanks. I'd say that (despite its name) this function is finding a position.. Why are you assigning to the same property twice here? This effectively disables the previous statement, which doesn't look like it is right.. You shouldn't use a mode-global variable to keep state -- modes can be restarted and resumed at different points at any time, and thus state should go into the state object.. Could whatever you're trying to do here be expressed by matching a regexp on the stream at this point? Munging the whole line without regard for where in the line we currently are doesn't seem like a good idea.. (Also please put spaces around operators.). Isn't this always true?. I think it'd be cleaner to put these three constant-over-the-whole-string fields in an object and store that in the state, so that there's less fields to reset later on (and less properties to copy when the state is copied). It's easier to do editor.getMode() to get the mode (and then check mode.name == \"sql\"). Missing comma here. Another one here, and the test fails (no results). I wouldn't put 'wild' properties on the array -- since global direction changes are probably rare, you could clean out the order properties on all lines when they happen.. Clearing the order on a line direction change would also be trivial. Since we might be generating lots of order arrays, using a cheap representation (plain array) seems a good idea. (Such estimates of how expensive something is are always debatable, in a JIT world, of course.). So now lineStart appears to be completely ignored, yet you somehow still left this function in. Why?. Ah, I see, I expanded the diff, but apparently not far enough, sorry. Since string stream objects are being created by the thousands during editing, adding an extra field is a non-trivial cost. Could you take a rough look at the pug mode to see if just changing the behavior of hideFirstChars would cause any damage there? I'd prefer to simply do that, and not introduce a new method.. > Another solution is adding this to the soy mode\nIf things can be fixed without touching the StringSteam API, I'd much prefer that.. This will match the empty string when the next character isn't whitespace. Maybe + instead of * is more appropriate? Also, the parentheses appear to not be needed, so please leave them off. Same remarks apply to two similar rules above.. Please follow the indentation of the rest of the code -- two spaces per level.. Style punctuation as keyword is unusual. Why did you make that change?. Why did you remove this rule?. Ah, that makes sense.. I get that a case can be made for seeing these as keywords, but visually, in terms of the code matching the general coloring patterns that themes are designed for, I don't think using the keyword style is a good idea here. Meta is kind of faded, which is probably also not great -- how about just styling them as punctuation?. The theme css is the only place where they are listed. Maybe bracket would be a good choice for these.. The line you propose appears to be exactly the same as the line in the patch. I'm not sure what to make of that -- could you elaborate?. Ahh, that makes a lot more sense. Fixed in 21ea9a2a. We're still targeting ES3 runtimes, so I'm afraid you'll have to do the trimming manually.. Again, ES3, so you'll need to write a map helper function.. I agree -- exception control flow, especially in JavaScript, is quite a lot harder to deal with and easier to mess up, so a regular return seems sensible.. This would be a breaking change, please leave the argument list the same or at least provide backwards-compatibility code that detects and handles the old signature.. Mutating a random object that isn't owned by this code isn't a good idea. Doesn't the code that checks for the existance of a fat cursor in the dom already handle this?. I'd prefer if this remained one if with an && in it -- nesting ifs like this seems overly verbose. Could you make this so that, instead of mutating this object, you check for null when actually running findMatchingBracket, and only if the user did not provide an option for fatCursor, you default it based on the presence of the class name.\nAlso, we still support old browsers that don't have classList, so a regexp check on className is preferred.. Additionally, please call the option afterCursor instead of fatCursor, since it may also be useful in cases that don't involve a fat cursor.. The repository most certainly does not use crlf line endings. It may be that git adds those when you check out on windows, but this should not be in the editor config.. I think the reason that .gitattributes is there at all is that people kept committing CRLF files and I had to clean them up. Would your proposed change cause git to clean them up on commit?. I think you can just style .CodeMirror pre, before the other rule, and don't need an additional class. Would that work? I'd prefer not to have another always-present class on the main container.. The unicode.org link isn't loading right now, so I'm not sure what you mean, but I guess you're saying that, in the presence of wrapped lines with level 2 spans in them, the visual ordering may not correspond to the ordering in order? Experiments seem to conform that. That's bad!\nI'll see if I can work around this by doing the clipping to a single wrapped line before finding the appropriate bidi part (discarding those outside of the line's range). I guess that makes applying a binary search a lot harder, but I suppose falling back to a full search in the wrapped case (and discarding all spans that aren't in the line) should be okay.. Is this space in the returned string intentional?. Also, .normalize(\"NFD\") already separates this character into \\u064a and \\u0654, which seems similar to what you're doing, and might already cover this?. Does changing this from a simple inline regexp to this complicated definition add anything?. It's harmless, I guess, but it seemed a bit of a pointless change.. Maybe this test should also check for the character before the cursor now, rather than the one at the end of the token?. I meant the test right before your change, where it only uses the token text when it ends in a word character.. That's a good point. But then we'd want to handle the case where no matches are found _and_ the cursor is directly after a non-word character specially, by also trying to complete with the empty string, so that you can still complete (usual, word completions) with the cursor after a non-word token.. You appear to have dropped most of the original client keywords here. Is that intentional?. Why treat brackets and punctuation as operators?. Please don't create a new token type for this\u2014as you apparently noticed,\"bracket\"is already used, so you should use that.. This doesn't need to be part of the pull request\u2014there's no need to have a demo page for every dialect.. You duplicated the class name.. This will only work for one line, right? Whereas all order caches should be cleared. Or am I missing something?. Will this still work when there are multiple tokens in the range? It seems like it'd create atag for each token separately, which I believe won't get the result we want.. Atomic currently restricts cursor motion, but not measuring of characters inside of the span --- and I think it should stay that way.. The addons should be ES5, so you can't use template literals here.. It seems like this class won't ever match \u2014 theCodeMirror-hint-activeelement is a child of theCodeMirror-hintselement, so wouldn't a selector like.darcula .CodeMirror-hint-active` be what you want here? (Same in the idea theme.). > Shouldn't this be item.displayText?\nNo, this is used to get the actual completion text, not the label.. I think it'd make sense to use a \\b marker after/around these words, so that things like letter-at or default-for (just making things up) don't match. This command doesn't exist, so documenting it seems like a bad idea.. \"This method return value, returned by your function.\" isn't a grammatically correct sentence. . Maybe check whether prevToken is \".\" instead? This regexp would go wrong on a line like import foo.*; return x * (which I'm not even sure is valid Kotlin, but you get the point.). You can put all of these in a single if with ||, and you don't need to assign to match here since you aren't going to read from it. Could you make those changes?. It's not a big deal here, but I also noticed it in a previous patch, so for next time\u2014you don't have to put single characters in square brackets in regular expressions. I.e. [=] is equivalent to =.. You don't need the loop here\u2014CodeMirror.innerMode is a helper that'll go down to the innermost mode for you. Then you can check whether it's markdown.. ",
    "NV": "It doesn't in all tested browsers (Safari 5.0.3, Opera 11 and Firefox 4 beta 10 pre on Mac OS X 10.6).\n. I'm talking about CodeMirror 2. This is why I created an issue here. Text selection in CodeMirror 0.92 works well for me.\n. Yes, I meant HTML mixed-mode. Thank you!\n. ",
    "graphnode": "Still doesn't work correctly, sometimes it does select the word, other times it selects the first line or jumps to the beginning of the first line. (Edit: It seems this happens when double clicking between the characters. Weird.)\nI debugged the code and it seems it sometimes fires the double click event (and works correctly) and sometimes it doesn't. I think the event is going to the wrong element.\n. With IE 6.0.2900.2180 the slow down is (amazingly) negligible, but then you have stuff like this:\n\nI vote to not support IE 6, I believe the users (government? old enterprises?) of this browser are not the public target for this editor.\n. ",
    "mishoo": "I thought of a similar optimization for Ymacs but never did it as it seemed too tricky.  (not just adding a quote, let's say we could catch that event, but pasting some code that contains, say, unbalanced quotes or comment markers; not to say it could break indentation for the following lines).\nOn the other hand, it might be a pretty good compromise in general.\n. ",
    "B4nan": "exception:\nuncaught exception: [Exception... \"Component returned failure code: 0x80004003 (NS_ERROR_INVALID_POINTER) [nsIDOMHTMLDivElement.removeChild]\" nsresult: \"0x80004003 (NS_ERROR_INVALID_POINTER)\" location: \"JS frame :: http://localhost/RoyalDesignCMS/web/cms/js/codemirror/codemirror.js :: anonymous :: line 1519\" data: no]\nin last revision\n. ",
    "claviska": "Thanks, I should have posted the bug report here.  Commenting now to follow it :)\n. I see...the textarea moves to the cursor location on click.  I was under the impression that it was static and didn't move.  I think that Mobile Safari is centering on the textarea before it is replaced, which might be worked around by manipulating the focus to occur after the textarea is moved.\nIf I get the time I'll play around with it some more.  In the meantime, maybe a few more folks will jump in with some ideas.  It's definitely not far off.\n. I unfortunately didn't save any of my changes.  But to clarify, I didn't intend for \"functional\" to mean production-ready.  The adjustments I made were very simple\u2014if I recall correctly they were making the hidden text area visible and changing it's position just a bit.  Once the text area was visible, CodeMirror worked to a reasonable degree in iOS, but it was still buggy at times (see my comment above).\n. I think you'd have have manually change the element to a DIV or something...probably not the best idea to do that.  I think the more informative error message will be sufficient.  Thanks :)\n. Sorry, I'm using an XHTML Transitional doctype...maybe that's what caused it.  I'll try it out and let you know.\n. I can confirm that the issue is resolved using the simplified doctype: <!doctype html>\nOut of curiosity, I've tested on a few others:\ntext\nHTML 4.01 Transitional - FAIL\nHTML 4.01 Strict - SUCCESS\nHTML 5 - SUCCESS\nXHTML 1.0 Transitional - FAIL\nXHTML 1.0 Strict - SUCCESS\nXHTML 1.1 - SUCCESS\nIt seems that IE has two different standards modes, one for transitional doctypes and one for strict.  I'm going to update my app to use the new HTML doctype.\nIt may be worth mentioning in the docs that users will experience erratic behavior using IE with a transitional doctype, even though it's technically rendering in standards mode.\nThanks for the help :)\n. @bfrohs That syntax only works if composer.json exists in the repo.\n. Just came across this myself. Here's a reduced fiddle: http://jsfiddle.net/9zj32q4t/\nThe same behavior occurs in Chrome, Firefox, and Safari.. I'm not sure exactly what is causing this, but I discovered that setting min-width: 0 on the fieldset prevents this behavior: http://jsfiddle.net/9zj32q4t/1/. I second this. It's disenchanting to see a solid PR tossed out without a reasonable example of how it's expected to be contributed to the community. \ud83d\ude2d\nI appreciate the idea of moving to independent modes/themes, but I really think an example repo would provide a degree of consistency and help users integrate independent modes and themes easier.\nCurious, will CodeMirror's core modes/themes be moved to independent repos at some point? That would provide more than enough of an example.\nThanks for the Dust contribution, @calmdev. And thanks for all your incredible work through the years, @marijnh. \ud83d\udc4d . ",
    "mzero": "Since div.CodeMirror-gutter and div.CodeMirror-lines have exactly the same top/bottom padding, (and zero margin), and have the same number of <pre> elements, which should be styled identically, they will be the same height. In theory, the code is trying to set div.CodeMirror > div to exactly that height.\nI have div.CodeMirror with no explicit height (I want it to be as big as the text needs). When the code to set the height for div.CodeMirror-gutter is in, then that div's total height is taller than div.CodeMirror. This make sense, since they have been set to the same pixel height, but the div.CodeMirror-gutter has vertical padding (to match div.CodeMirror-lines). When I inspect the DOM as rendered in the browser (Safari) this is all as expected.\nThe trouble is that the div that contains div.CodeMirror now sprouts a scroll bar! The layout engine gives this surrounding div the same height as div.CodeMirror (since div.CodeMirror-gutter is positioned absolute, and therefore doesn't contribute to size), BUT, it notices that div.CodeMirror-gutter is bigger than it, and so puts in the scroll bar.\nI did just check, and leaving in the size setting, I could set overflow: hidden on that surrounding div, and it does work. Though there are nits when adding a line at the very end - which is true also for overflow: auto in that case.\nBoth of these nits lead to perhaps the root of the issue: Why would div.CodeMirror ever be taller than div.CodeMirror-lines? This is the case you are after solving (as you want the div.CodeMirror-gutter's background to fill the height of div.CodeMirror, but we've already established that, absent the explicit height setting, it should be the same as div.CodeMirror-lines.) If it is ever bigger, then the background set on div.CodeMirror shows through at the bottom of both div.CodeMirror-gutter and div.CodeMirror-lines. This only bothers you for the first, as it has an explicit background, and the later has transparent. In my case, the both have explicit background colors - and div.CodeMirror has none. The surrounding div has a background I generally don't want shown. (It is yellow stripy bars to show modified state - and I show it by giving it a little padding when the content has been edited).\nIn the end - I think it is best to let the layout engine set div.CodeMirror-gutter and div.CodeMirror-lines to the same height due to having the same sized content. Then, so long as div.CodeMirror has no padding, it will just work. Similarly, I'm wondering why even bother to set the height on div.CodeMirror - it should naturally be the same size as it's only flowed content, div.CodeMirror-lines.\nHope all of this helps!\n. Indeed, I realized that case as I was on my way to work. So, I can think of two things to do here:\n1) Continue to set the height of div.CodeMirror-gutter, and leave the gutter background on it, but remove all padding from it. Then, place the line numbers themselves inside a div, say div.CodeMirror-numbers, and set the vertical padding on that to match div.CodeMirror-lines. Since the chain of divs from div.CodeMirror to div.CodeMirror-gutter has no vertical padding or margins, setting these to the same size should cause the gutter background to fill correctly, AND not cause the content size to be bigger (due to the padding, which is no on the inner div.CodeMirror-lines).\n2) Alternatively, when setting the height of the gutter, subtract out the calculated height of the padding that is on the gutter. This may be tricky to do.\nIn either event, perhaps there should be an option to disable all height fiddling. Though, I admit, that feels like a cop-out. It would best if we found a way that worked for both the fixed editor, and dynamically growing editor case to work.\n. here's another small fix - as my parser for Haskell styles the parenthesis etc...\n. The change to off was made because the code didn't work in the looking backward case. This make sense because, in either case, the character we found is at pos. What this code is searching for is the style of the found bracket, to ensure that it finds the matching bracket of the same style. If in the reverse case off is set to pos, then this for loop finds the style of the character before the closing bracket, not of the closing bracket itself.\nAssuming in some parser the brackets are styled with the same class, put a closing bracket right after something styled with a different class. You'll see that if you click next to the opening bracket, they match hi-light, but if you click next to the closer they don't.\n. Perfect! Thanks!\n. Not sure why it is showing all the commits and patches from you... the only one that matters is 078f0ba - mark\n. Oy - pull requests don't seem to work nicely when there is past history. Perhaps I should erase this repo and and repull? Unclear....\nIn anyevent, I don't know why this pull request contains any changes to codemirror.js -- it shouldn't - the files compare identically between repos on my machine.\nLet me know if a different work flow would work better for you in the future.\n. existing CM license is just fine\nI'll rebase next time (after learning git -- I use hg presently to access github repos!)\n. ",
    "chiel": "Btw, you can get the gutter to be 100% high pretty easily. What I did before you pushed the fix just now, was set the styles of the gutter div to:\n{ height: auto; min-height: 100%; }\nI guess if codemirror is not overwriting that, you could just set it in the css.\n. Hi Marijn,\nI made a point to pull in the latest version of CodeMirror2 before \"whining\" about it here, so yep, I do have that fix.\nIf .refresh() is supposed to work as I thought, then the only thing I can think of, is the fact that I changed the style of the .CodeMirror class by using height: 100%;, since it's inside of a wrapper, that resizes with the rest of the layout.\nThis shouldn't really cause any issues as far as I know, but hey, it might be contributing? In what way do you assess the height of the codemirror instance? I made a little hack for this, for now, but it's hardly ideal. Basically every time the window (which means also the editor-wrapper) I set the height of the gutter to \"\", and the min-height to 100%. That way it's always at least 100% of the codemirror instance, yet it'll still stretch past this.\nBest,\nChiel\n. Awesome, this does the trick perfectly! Thanks a lot for being so fast with all this. CodeMirror is a delight to work with. At the moment it seems to be really slow in Chrome, though. But I'll make another ticket about that if it remains an issue.\nCheers!\n. Hmm... must be something on my end then, I'll try figure this one out. Consider this report faulty, for now. Sorry. :)\n. Trying to find the bug, but I must admit it is hard. Your demos work just fine in my chrome, so it MUST be something on my end.... now to find out what exactly.\nIs there anything CodeMirror is especially prone to, or so, that can get me started on figuring this one out?\nThanks in advance.\n. Yeah, it's tied in to some mootools stuff I'm doing, so I'll just have to change some stuff around to make a suitable test. Thanks for the great library, though! :)\n. I reopened this as issue #48, with the cause highlighted.\n. Awesome, thanks a lot!\n. If it's something in Chromium, I bet they'd be interested. But setting up a test for a bug like this likely takes some time (ensure it's not something in codemirror etc). And even then, it's such a corner-case, for which there is simply not enough time to spare at the moment, I guess.\n. Awesome! Sorry for not looking hard enough.\nChiel\n. Yep, I realise the issue is on my side, I was mainly looking for some clues on where to start with fixing it, since I could not easily find said div in the source of the demo page. I shall dig a little more in the source.\nKeep up the great work!\n. Found the error, it's cause I was setting a class on the currently active line, the selection showed up on lines that were not active. I'll have to figure out why the active line demo works, but not my code.\n. Oh! Thanks a lot for that tip, that cleared it right up!\nOnce again, thanks for this library, keep up the great work. \n. Result is here, should you be interested in seeing how I use your library: https://tinker.io/\n. Thanks! There's some extra css at play here, but other than that I just call a refresh on the editors when the animation is done (and after handle-resizes etc are done).\n. Ah excellent, thanks a bunch.\n. ",
    "benoitc": "I've tested on  firefox and chrome with same issue :\nCode is following:\n<script>\n    var myCodeMirror =\n    CodeMirror.fromTextArea(document.getElementById(\"text\"), {\n        lineNumbers: true\n    });\n</script>\nFull code http://friendpaste.com/IPOddWE0fhil4NkAX6U6I \nI've just a textarea on the page. return to the line means when I hit the return to create a new line it automatically indent from 2 chars next line: http://bayimg.com/HadKOAADP\n. It's still odd that the default js mode indent from 2 spaces when you go on the line. This isn't usual at all.\n. ok.\n. ",
    "ghost": "Sorry, I think I wasn't clear... what I mean is determine the x of the cursor based on the x of the current span + the width of the inner text, rather than the width of the line's entire text. That way the spacing of the spans is removed from the equation, because the span's x already takes it into account. The current method is to put text into the hidden div and calculate its width overall, which becomes inaccurate if the spans aren't spaced as expected.\n. Well, in that case then the better solution is to continue calculating x as-is, but reproduce the span structure within the hidden div. I've tested this out in charX and it works fine. The cost of doing it is so infinitesimal I can't imagine an option would really be worth it. Besides, it's not only variable width fonts that affect this issue but also margins, bolding etc. Basically any styling is off-limits unless a high fidelity copy of the line content is made before placing the cursor.\n. In my test I just grabbed the lines[line].styles property and looped over its elements to create dummy spans until the text content length exceeded cursor position, then trimmed off any excess characters. I haven't had a chance to fully absorb the new design yet so I'm not sure if getHTML would be more efficient.\n. Ok cool. I'm glad there's hope because without full styling and font support I'll have to stick with CM1 :/ Thanks for considering this.\n. Well past caring...\nOn 17/03/2011, at 11:51 PM, marijnh wrote:\nWontfix.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/30#comment_884860\n. It's not just variable-width fonts, it's any width-related CSS formatting like bolding even. It's a pretty fundamental flaw, and fixing it would probably help resolve the lack of line wrapping as well.\nOn 18/03/2011, at 1:17 AM, marijnh wrote:\nDavid has indicated he is no longer interested in CodeMirror. I personally don't care about variable-width fonts. Until someone else volunteers to work on this, it is off-radar.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/30#comment_885179\n. Hello, thanks for the reply. I found one way for this:\nposition: absolute; height: 100%; top: 0; bottom: 0; left: 0; right: 0;\nThis should be added into .CodeMirror class.\n. No problems ;) Good luck with developing.\n. ok, thanks\n. Mozilla thunderbird extension on gecko 8.0\nI'm so sorry, but i can't repeat this error\n. And nevertheless problem found at line: 1352 in codemirror.js\nI create small test case and sent it to you.\nCheck your mail\n. oh, thank you. \ni have the next problem, i have set the height to auto but when the content loads the height is not set to auto.\n<style type=\"text/css\">\n.CodeMirror {\n    width: 583px;\n    padding: 0 10px 0 32px;\n    line-height: 21px;\n}\n.CodeMirror-scroll {\n    height: auto;\n    overflow-y: hidden;\n    overflow-x: auto;\n    min-height: 180px;\n}\n</style>\n. The rest of the content is not visible. I see only a small part of content.\n. http://jsbin.com/eluvil/5\n. ok. thank you.\n. Seems like conversation died down a bit, so sorry to bump a dead issue, but I thought I'd throw my two cents in since I just arrived on the project.\n\nVintage has a ViEval that takes the \"parsed\" command and does the right thing with it. So for operations it can start a selection, move according to the motion/count, and then act on that text according to the operator. Something like this is important to get in soon or the keymaps are going to balloon out of control.\n\nIn my last pull request I set out a general framework for this. It's still a little verbose but it's much better than the old \"add each motion to every operator keymap\". I think @chris-morgan's idea for a more complete vim clone (which is a very good idea indeed) is feasible without separating from CodeMirror, and because some changes might need to be made to the core of CodeMirror, we would be better served keeping the two together.\n. Alright, will get on the semicolon thing, just a style preference of mine.\nThe issue with using moveToWord and goLineStartText is that Vim motions, used in conjunction with operators (d, y, and c), operate on a selection and need to return a cursor position so that operators know what range to act on. I agree the old implementations are probably better, but they don't return a cursor position. I suppose I could have used goLineStartText, then grab the cursor location and return that, but it feels sloppy. Then again, maybe that's just superstition, what do you think?\nAs for word based movement, same issue as above, although looking at it, it would be better to change moveToWord to return a cursor location. As for the word movement working like it should, w worked like W, and e worked like E. I fixed that in this patch. If you care the difference between W and w is that they move to the start of the next WORD and word respectively, you can verify this here.\nI'm not married to the changes though, if you think something else would be better let me know and I'll get right on making it.\n. Hmm, do I have your blessing to change moveToWord substantially? As it stands, it won't move line to line, and it doesn't support repeated motion. I think it should be fixed but it does entail \"replacing moderately tested code with from-scratch\" code, at least a little bit. \n. Alright, could you look that over, let me know if anything more needs to be changed.\n. Is the demo still available anywhere?\n. That is awesome! Thanks @jankeromnes \n. A few bugs I ran into in a few minutes of testing  :\n- [cyd]iw operates on one less character than a word\n- [cyd]iW appears to operate on nothing at all\n- The tag text object doesn't work, I'm not sure if it was working in the old implementation or not\n- If % happens when the cursor is not on a paired character, it should search forward to the next paired character and work as usual\n- Searching (/ and ?) doesn't work\n- : (ex mode) doesn't work, it only worked for line numbers in the old implementation but does nothing now\nMost of those aren't major with the exception of the word/WORD text objects (matt is right, text objects are one of the first things vim users look for) and none of them should be hard to fix. I'll hop on them in a few days if no one beats me to it.\n. Hmm, is there a reason that visual mode is implemented in vim.js as opposed to vim2.js?\n. Ahh, I see. Well it's got the green light to merge from me in that case.\n. sorry, yes.\n'r ' replaces the character with Space, 'r' replaces the character with the word 'Down', etc. 'r' should replace the current character with a newline, which it does, but should also end replace mode.\nFor example:\nhello world\ncursor is on the space between 'hello' and 'world', typing 'ri' should leave the buffer as\nhello\nworld\nand insert mode should be active. Instead, we get\nhello\niorld\n. ah, sorry for the confusion. yes, so r<Enter>i does result in helloEnterworld in the vim keybindings demo on the codemirror site.\nIn the application I am using that uses codemirror the same keystrokes lead to \\n being inserted instead of Enter but the i is then inserted in place of the next character. Perhaps fixing the entering of special characters as words will help both those cases...\n. Alright, I'll try converting the HAML doc to HTML and using that. My guess is that the issue is related to purecss grids, but that's just a guess.\n. I know this is a rather old thread - but I've written a spell-checker mode that integrates with node, and I'm running into a slight issue:\nI'm using markdown as the base mode, and then I overlay the spell-check mode over it using CodeMirror.overlayMode.\nThe issue I have, is that I would like to keep both tokens on the highlighted word, example:\n- **bold** receives the bold token from the markdown mode.\n- mispelled receives the misspelled token from the spell-check mode.\n- But **mispelled** will receive the token from the spell-check mode, and overwrite the bold token from the markdown mode. \nI would like to keep both token classes on the word.\nIs there a particular option for this when overlaying a mode, or have I implemented it somewhere incorrectly?\nOr is this intended functionality? (If so, any pointers for a workaround would be helpful)\nEDIT:\nA little embarrassing, but I just discovered that cm.addOverlay is different to CodeMirror.overlayMode. My problem is solved \ud83d\ude04 \nPS: @marijnh \n\n\"This use case was one of the motivations for the addOverlay feature, but I never actually tried to implement it. Would be interesting to see whether it works.\"\n\nWorks a charm! \ud83d\udc4d \n. The whole \"[tab character]\" was meant to denote \"\\t\".\nSo \"#foo\\tbar\" is shown highlighted whole, though only #foo part should be.\nMarijn Haverbeke wrote:\n\nI'm not seeing this. The styling applied for |\"#foo[\\t]bar\"| is \n|string| for |#foo|, |bracket| for the square brackets, null for the \ntab and for |bar| (CodeMirror doesn't explicitly style whitespace, not \nsure why |bar| isn't styled -- I did not write this mode, nor am I \nfluent in Smalltalk).\n\u2014\nReply to this email directly or view it on GitHub \nhttps://github.com/marijnh/CodeMirror/issues/2796#issuecomment-54803927.\n\"\n. This error is still happening for me\n. Shouldn't they be automatically loaded with the PHP mode? therefore isn't this a bug? therefore isn't this worth reporting and shouldn't be closed yet?\n. Even I wanted to load the module I wouldn't know which one it was because he simply stated that he forgot to load a module that it depends on but never said which one.\n. Not only the problem @tablatronix describes but in my case the blue cursor also \"walks\" down in a stairway pattern. @marijnh Do you already have a patch ready as you mentioned you were working on?\niPad Air2 / iOS 8.1.1 in Safari\n. The problem I mentioned above was in v4.7. So I first tried upgrading to v4.8: didn't solve it PLUS the linenumbers where not displayed correctly anymore in Chrome and FF. It did in IE11.\nThen I tried the mobile branch. The linenumbers were displayed correctly in all mentioned browsers AND cursor problem was fixed. Thanks!!\n. I can also confirm that it's working fine now. Thanks.\n. Do any browsers even support CSS4 yet?\n. You can add these by going to the file modes/css.js and find this variable propertyKeywords_ and add the properties themselves. You can look through that file and add values if there are new CSS4 values as well. \n. No that is true, I can try to reproduce this on a fiddle or bin let me get everything together. And I'll comment back\n\nSo I've tried duplicating this and I can't find the issue, I've changed back to the original CodeMirror and it's doing the same thing. I wonder if maybe I over wrote anything that CodeMirror uses, are there any Global Scope issues with CodeMirror that is known? Also I don't know if this may be it but I have declared all possible languages that a user will use and added the JS files as so:\n<script src=\"assets/javascript/codemirror.js\"></script>\n<script src=\"assets/javascript/cm-modes/clike.js\"></script>\n<script src=\"assets/javascript/cm-modes/css.js\"></script>\n<script src=\"assets/javascript/cm-modes/htmlembedded.js\"></script>\n<script src=\"assets/javascript/cm-modes/javascript.js\"></script>\n<script src=\"assets/javascript/cm-modes/php.js\"></script>\n<script src=\"assets/javascript/cm-modes/sql.js\"></script>\n<script src=\"assets/javascript/cm-modes/vbscript.js\"></script>\n<script src=\"assets/javascript/cm-modes/xml.js\"></script>\nYup that is the issue, any possible fixes for this? My users will be using any of these as a possibility. Thanks that they will use:\nJavascript\nCSS\nHTML\nVBScript\nXML\nSQL\nPHP\nASP.NET\nI originally tried adding these files only when needed, and if this issue persists, what should be the possible way so these files aren't conflicting with each other?\nI reconfigured the order of js files, and it stopped doing the glitch, I believe there should be a case scenario to watch out for this!!! Either a note or implementation to ensure this doesn't happen inside the JS code itself....\nNew order of execution for JS files-\n<script src=\"assets/javascript/codemirror.js\"></script>\n<script src=\"assets/javascript/cm-modes/xml.js\"></script> <!--XML needs to be first for some reason-->\n<script src=\"assets/javascript/cm-modes/clike.js\"></script>\n<script src=\"assets/javascript/cm-modes/javascript.js\"></script>\n<script src=\"assets/javascript/cm-modes/css.js\"></script>\n<script src=\"assets/javascript/cm-modes/php.js\"></script>\n<script src=\"assets/javascript/cm-modes/sql.js\"></script>\n<script src=\"assets/javascript/cm-modes/vbscript.js\"></script>\n<script src=\"assets/javascript/cm-modes/htmlmixed.js\"></script>\nAfter looking at XML and HTMLMIXED.JS I see there may be a conflict with the htmlMode and hasOwnProperty if anyone can look at that and see if that is the issue please let me know. I'm going to take a look as well and see if I can ensure it doesn't happen with this myself.\n. Yes it was the order sorry I haven't really posted Issues on GitHub before. Also I've read the petite documentation, and neither of those require work for me I'm not using a subset language I'm using pure javascript for everything. And I have 6 or more languages I have to include so they are ready to go for the user. \nBut like I said there should be an error handling process within the code to test if something that is required be loaded and if not give a log in the console or something. Just seems to me that it makes more since to handle the error before hand. \n. Ok I will try, thanks for trying yourself I'll get it all sorted for you and post it in a new comment.\n. My goal is that after every few seconds codemirror will save the file. Sort of like how Google Docs does it for say. \n. Hmm ok I'll look into that!\nFor reference, I'm using Ionic2 (built upon Angular2) which is a framework for deploying to iOS, Android and Windows Phones, etc.\nEverything seemed to work well except the gutters so I assumed that support hadn't been built in yet. \nThankyou :D\n. Check out www.grammarly.com\n. @kofifus It's not just a chrome app, they have other options. Unfortunately, though they don't have an exposed public API. I have asked about it, but they neither confirmed or denied if they'd make it available in the future, I also asked about a native Linux app, which may or may not be in the works.\n. Ok thanks . Well I try to use Code Mirror with Electron... Perhaps this causes compatibility problems because I only have problems with that function everything else works fine. Also, I'm happy to make a pull request that makes the markdown mode style image titles differently too. I thought I might keep that as a separate PR, since I'm not sure if that's something you want. \nA quick example would be like this:\n\nLet me know and I'll submit another PR :smile: \n. @chocholand if you want to remove the scrollbar, you should pass scrollbarStyle: 'null' as an option when you instantiate your editor. See the manual for details on how to do that.\nIf you try to remove it manually, you'll end up messing with some of CodeMirror's internals.. Hah! I hadn't thought of that. That definitely looks like it works well, but is it possible to highlight past the end of the line with the markselection addon?\ne.g., when highlighting just the text, if one highlights past the line an extra distance is highlighted to indicate that the selection is past the end of the line. (Like line 4 in the 2nd screenshot in my original post). Because, if that's not possible, then the user won't be able to distinguish between highlighting just to the end of the line, or highlighting to the start of the next line.\n. Hmm, I'm not sure that's exactly possible. I've tried to give that a shot both with cm.addWidget and cm.markText. It looks like both those APIs clip the widget to the end of the line - so I can't seem to place the widget after the actual line. \nIt may be possible with markText but since the marker wraps with the text if the user had lineWrapping: true and the line exceeded the max length then the widget would wrap too.\nUnless, of course, I misunderstood how one would go about adding such widgets.. Ah, sorry about that -- I must have had something wrong in my tests (I think I was using line.text.length - 1 or something).\nI got it all working now \ud83d\udc4d using addWidget. \nSorry for the trouble, and thanks again \ud83d\ude04 . Thanks for the fix. As answer to your question, no fuzzer is used. I found the examples manually.. This is the behaviour I'm going for: https://webmshare.com/play/q5gmb\nSo I think the dedent keywords need separating out to differentiate between the indentation of the next scope and that of the line being typed.\nI hacked together the .webm by using 'then' for the if/elseif indentation and then treating 'else' as a special case. Maybe there's a nicer way? \n```diff\n--- lua_old.js  2018-05-25 08:16:59.411017519 +0100\n+++ lua_new.js  2018-05-25 08:24:47.534394133 +0100\n@@ -63,9 +63,10 @@\n                          \"true\",\"function\", \"end\", \"if\", \"then\", \"else\", \"do\",\n                          \"while\", \"repeat\", \"until\", \"for\", \"in\", \"local\" ]);\n\nvar indentTokens = wordRE([\"function\", \"if\",\"repeat\",\"do\", \"\\(\", \"{\"]);\nvar dedentTokens = wordRE([\"end\", \"until\", \"\\)\", \"}\"]);\nvar dedentPartial = prefixRE([\"end\", \"until\", \"\\)\", \"}\", \"else\", \"elseif\"]);\nvar indentTokens = wordRE([\"function\", \"then\",\"repeat\",\"do\", \"\\(\", \"{\"]);\nvar dedentKeywords = [\"end\", \"until\", \"\\)\", \"}\", \"else\", \"elseif\"];\nvar dedentTokens = wordRE(dedentKeywords);\nvar dedentPartial = prefixRE(dedentKeywords);\n\nfunction readBracket(stream) {\n     var level = 0;\n@@ -138,7 +139,7 @@\n       }\n       if ((style != \"comment\") && (style != \"string\")){\n         if (indentTokens.test(word)) ++state.indentDepth;\n-        else if (dedentTokens.test(word)) --state.indentDepth;\n+        else if (dedentTokens.test(word) && word !== \"else\") --state.indentDepth;\n       }\n       return style;\n     },\n@@ -148,6 +149,7 @@\n       return state.basecol + indentUnit * (state.indentDepth - (closing ? 1 : 0));\n     },\n\nelectricInput: new RegExp(\"\\b\" + dedentKeywords.join(\"|\") + \"\\b\", \"g\"),\n     lineComment: \"--\",\n     blockCommentStart: \"--[[\",\n     blockCommentEnd: \"]]\"\n```\n\n. ",
    "michaelficarra": "How is this possibly a wontfix?\n. I guess I don't care about variable-width fonts in a code editor either. Just thought it should be supported.\n. @marijnh: I still think it would be useful to be able to get this option. It may be possible to figure it out, but it could be a lot more convenient.\n@defunkt: Listing a use case is a must for feature additions like this. He wouldn't have told you to fuck off if you would have just provided reasons why this feature should exist instead of being so stubborn. You may have thought it was implicit, but reasons why it is superior to the provided methods (given they are valid) would surely be enough to convince the maintainer to comply.\n. Maybe the chromium devs would be interested in this issue, no?\n. Well, for when you have a moment to spare: http://code.google.com/p/chromium/issues/entry\n. ",
    "jurisv": "Thank's for clarification!\nWorks like a charm!\n. Any direction, where to dig, to add such a functionality for not requiring <?php would be nice..\n. Using latest snapshot..\n. Always Welcome :)\nTested - confirm fixed status!\n. codemirror.js - same problem ( line 1167, 1511)\n. ups... accidentally closed ..\n. ",
    "axtro": "No problem ;)\nOn Thu, Mar 10, 2011 at 10:19 AM, marijnh\nreply@reply.github.com\nwrote:\n\nThanks. Fixed.\n(Err, sorry I didn't use your patch. My fingers had already committed and pushed a fix before I realized this was a pull request, not a regular issue.)\nhttps://github.com/marijnh/CodeMirror2/pull/39#issuecomment-855234\n\n\nHenning Kiel\nAxtro Web Applications\nC/ Doctor Sumsi, 2 - 46005 Valencia (Espa\u00f1a)\nwww.axtro.es | www.3sellers.com\nTel 96 334 78 14\nFax 96 392 45 90\n. Wow, thanks for the quick fix :)\nOn Wed, Mar 23, 2011 at 11:54 AM, marijnh\nreply@reply.github.com\nwrote:\n\nAh, right. I had noticed last week, but had forgotten about it. Thanks for reminding me. b4b39e9c40db933796284091d019be0de6e8f7c8 should fix it.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/46#comment_907035\n\n\nHenning Kiel\nAxtro Web Applications\nC/ Doctor Sumsi, 2 - 46005 Valencia (Espa\u00f1a)\nwww.axtro.es | www.3sellers.com\nTel 96 334 78 14\nFax 96 392 45 90\n. Yes, seems like a bug with that build. 12.0.733.0 (81064) fixes it\n. ",
    "defunkt": "Unfortunately not.\n```\n\n\neditor.getOption(\"mode\")\n\"rb\"\n```\n\n\nThat's the mode I set, but not the mode in use as shown by the warning I see:\nNo mode rb found, falling back to plain text.\n. Why not load all the modes and let CodeMirror figure out which mode to use?\nThat's how it works right now if you load all modes and pass an extension, with a few special cases.\nThe only problem is there's no way to figure out which mode CodeMirror picked.\n. You're already calling console.warn in the exact case I'm asking about. Why not set a flag or variable?\n. I guess I'm a bit confused.\nWhen you ask CodeMirror to use a mode, and it cannot find that mode, it falls back to the plain text mode.\nHowever there is absolutely no way in JavaScript to know if CodeMirror found the mode you asked for.\n. So not only does CodeMirror let me give it a String mode name with no way to verify I was correct, it also stores a dictionary of modes internally as well as the current mode internally but refuses to surface this data to plugin developers.\n. All I want is for the mode variable you use internally to be available to plugins so I can use your sweet library on my project. And you're telling me I'm doing it wrong (even though your library does it this way) and to fuck off?\nOkay, I will (and I've closed this issue), but I still vote that CodeMirror2 should let you know whether the mode you want is available or not :) Especially when writing plugins.\n. ",
    "pingswept": "Oh, also, I hereby grant copyright over this code to you for eternity. (Most of it is derived from code you wrote anyway.)\n. Hi Marijn,\nI'm not interested in indentation for my own use-- is it necessary? (I don't\nmind someone else implementing it, but I find it more annoying than useful\nfor myself.)\nHow does one proceed from here? Shall I make some revisions, commit them to\nmy branch, and then send another pull request that contains both commits?\nCheers,\nBrandon\nOn Mon, Mar 21, 2011 at 10:36 AM, marijnh \nreply@reply.github.comwrote:\n\nHi Brandon,\nLooks mostly good. I added a few inline comments pointing out small\nproblems.\nIf you want to tackle indentation, I'll probably have to slightly extend\nthe current indentation API, to support modes that cycle through\nindentations, rather than enforce a single one, as Python has multiple valid\nindentation for many lines.\nBest,\nMarijn\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/44#issuecomment-898539\n. Excellent. I'll try to fix the other problems you mentioned and send another\npull request when it's done. Thanks for the code review.\n\nBrandon\nOn Mon, Mar 21, 2011 at 2:49 PM, marijnh \nreply@reply.github.comwrote:\n\n\nI'm not interested in indentation for my own use-- is it necessary?\n\nNo, it's optional. If you revise your patch (or simply add another\none), I'll pull the result into my repo, and it'll be part of the next\nrelease (I think I'll bring out an official 2.0 soon).\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/44#issuecomment-899703\n. \n",
    "kurteknikk": "Nice thanks, i really look forward to it, especially the find & replace feature. I was going to try and roll my own but i saw that you were already busy with it :)\n. ",
    "edmellum": "I'm having this problem too and can't even see any mention of onChange in the source. I'm probably doing something wrong, but seeing the actual code that's handling this would probably help. Could you point me in the right direction?\n. Ah, I was actually browsing the old CodeMirror repo, not the CodeMirror2 one, so now I can see everything clearly. \nSo what I figured out is that the onChange function I supplied is called once right away before the editor is properly initialized for some reason and therefore does not receive the editor in its argument. A simple if check fixed it, but I've never experienced something like it with a Javascript library before.\n. ",
    "mattpap": "I was a little too fast with reporting this issue, because onChange works with my webapp when the editor is attached to the top-level element (document > div), but fails (as described previously) when the editor is attached to an ExtJS window. I embed multiple editors in a single window, so I thought that they might interfere with each other, but this is not the case. For now I'm not sure which part of my webapp make the editor fail, but when I will find out, I will post my findings here.\n. It seems that recent commit (65f257ba6385638164986aa1a8a445ab22652793) fixed this issue for me, so I'm closing it as not valid anymore.\n. Works for me. Thanks.\n. Thanks. RST is a standalone markup language, but it happens that in the Python community we adopted this language for documentation, docstrings and even research papers/conference proceedings. Originally I made this mode work this way, that Python was the default mode for verbatim. However, there are many cases in which RST contains no or almost no Python source code (e.g. documentation for Sphinx, where verbatim blocks contain RST itself). I think that the best solution for now is to add more MIME types, lets say text/x-docstring or text/x-rst-python, and this way pre-configure RST mode for this specific case (I mean Python (doctests) in RST). In Sphinx (documentation generator based on RST) you can specify per verbatim block or per document what highlight mode should be used, so I'm going to exploit this in future improvements to RST mode.\n. Thanks. Expect more pull requests in future.\n. ",
    "BrendanAnnable": "So it turns out this is just an IE9 problem, as I'm getting the same issue in normal text input fields. Not sure what the cause is though, again works fine in other browsers...\n. ",
    "Alexxz": "It is so sad 8(\n. ",
    "leeoniya": "the only kind of useful line-wrapping for code is tab-aligned line-wrapping anyways. lack of regular wrapping doesn't seem that big a deal to me. maybe just for HTML tags containing huge amounts of text.\n. but can't the parser be altered in a way that doesn't do this. it seems simply excluding reserved words from being parsed as var declarations would solve this entirely. no?\n. hmmm. it seems like strange behavior for a code editor to color-flicker properly highlighted code during typing. it is understandable for languages like php that support heredoc and multi-line strings where an opening quote will re-highlight everything after it. or even if there was custom coloring for function blocks, if/else blocks or sub-parsers. since var declarations cannot have blocks per se, i don't feel it is appropriate for them to affect code afterwards. there should be some sort of escape condition for this stuff, it will probably also improve performance by terminating the re-highlight early on.\n. this seems like a subset of an auto-trim-trailing feature, does something like that exist?\n. maybe it'd be more useful to integrate a more general trim trailing feature maybe with an optional condition-checking-callback that would take a context + return true/false to trim or not? from what i've encountered, usually when blank lines are trimmed, so is the rest of the doc.\n. @marijnh what took so long? :D /sarcasm\n. > Does anyone really use handlebars/mustache script tags?\ni believe it's actually fairly common.\n. nice, thx!\n. perl and php also; perhaps others.\n. > so the behavior of the mode is perfectly reasonable.\ni'm not sure i agree with this. valid opening tags should probably start with <[A-Za-z!], not <.. it may be worth highlighting as an error those entities which should be escaped in html eg: &lt;\n. you can try porting https://github.com/emmetio/codemirror to the current CM, shouldn't be too much work.\n. or switch cm over to border-box :)\n. +1 for a javascriptmixed and also for re-opening this issue.\nembedding html and other template languages in js is getting pretty common as libraries move away from pure vdom-building to faster strategies that diff only dynamic parts of templates. would be cool to get html highlighting in Codemirror for libs like t7 [1] and also enable JSX [2].\n[1] https://github.com/trueadm/t7\n[2] https://github.com/codemirror/CodeMirror/issues/3122\n. thanks; I learned something today\n. as mentioned in https://github.com/codemirror/CodeMirror/issues/3026, the a javascriptmixed mode may help here.\n. ran into this today when scrolling horizontally on a pretty fast mobile phone in Opera and Chrome (both Blink, i think):\nhttp://leeoniya.github.io/domvm/demos/playground/#infinite-scroll\ni'm gonna try position:fixed/left:0 and/or css transforms\nwith css transforms it may be worth adjusting an inserted styleaheet rule rather than poking style on each gutter element.\nalso https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#Improving_scrolling_performance_with_passive_listeners. using translateX() instead of left definitely helps.. already noticed :) and pitched in \u20ac100.\nhttps://news.ycombinator.com/item?id=17859663. http://codemirror.net/mode/jsx/index.html\nsome self closed tags /> show up red (errors?)\n. @marijnh can you kindly provide an example of how to pass through a parserConfig to a specific existing mode at runtime? there is only a single mention of this variable in the manual which relates to authoring new modes. do i need to make a javascript2 overlay mode like [1] to get this working?\n[1] https://github.com/codemirror/CodeMirror/issues/3292#issuecomment-180016581\n. got it, thanks for your help.\n. @adrianheine \nthere actually seem to be a bunch of other themes that do this [1]. i think they're all wrong and probably a result of copy/paste/modify. additionally, all the div. prefixes should be dropped imo.\n[1] https://github.com/codemirror/CodeMirror/search?utf8=%E2%9C%93&q=CodeMirror-focused\n. FWIW, even for light ones i dont understand why a defocused editor's selection would need to look different. Another thing i found in dracula (maybe others), is that string and string-2 share the same color [1], even though literal regexps in js mode get classed as string-2. Perhaps this is by design of the theme, i dunno. I split them up locally, among other tweaks.\n[1] https://github.com/codemirror/CodeMirror/blob/master/theme/dracula.css#L23\n. see https://github.com/codemirror/CodeMirror/issues/839 & https://github.com/codemirror/CodeMirror/issues/2143\n. yes, but only when the editor's eol is set to \\r\\n or \\r\n. appears to be resolved \ud83d\udc4d \n. i've added a commit that adds support for methods and functions in es6 objects and classes.\none point i'm not sure about is using the temporary flag cx.isGetterSetter on the context to discern getters and setters (which are not really functions) from callable methods. it seems a bit dirty to do this, but i don't see an obvious way to do this another way.\nit may not be worth treating getters/setters as properties and they can just be treated the same as the rest.\nthere is possibly a bug in the first commit where new Foo() is treated as a function. which is not entirely wrong since it invokes the constructor. but new Foo is treated as cm-variable. This difference is not great. Again, some temporary cx flag can be used to remember the new so that Foo would never be marked as a function.\n. https://github.com/codemirror/CodeMirror/issues?q=is%3Aissue+is%3Aclosed\n. https://github.com/codemirror/CodeMirror/issues?q=is%3Aissue+is%3Aclosed\n. @marijnh you should probably keep one of these issues open so it acts as a PSA until things settle.\n. https://github.com/codemirror/CodeMirror/issues/4512. https://github.com/codemirror/CodeMirror/issues/4512. this is interesting: https://github.com/NeekSandhu/codemirror-textmate. ",
    "jasongrout": "@claviska: you said \"with very little modification to codemirror.js I was able to get a functional version on my iPad and iPhone. \".  Can you post a fork with your changes? I've played a little with codemirror on the ipad today.\n. Thanks!\n. More context - 5.18.0 release today had the note \"The mode formerly known as Jade was renamed to Pug.\"\n. @gnestor - can you reproduce the behavior in the standard CodeMirror examples, i.e., https://codemirror.net/mode/python/index.html? Also, CodeMirror is now at 5.22.1 - does upgrading Jupyter to 5.22.1 also show the issue?. ",
    "schanzer": "I took a primitive stab at things, and made my experiment available here: www.litech.org/~schanzer/iOS\nI haven't bothered with scrolling yet, only mucked about with selection and inserting the cursor. \n. Selection in iOS is great, but hard to fake - a contextual menu appears at the cursor location, and dots appear at the upper-left and bottom-right corner of your selection. Moving these dots extends or shrinks the selected area. You can't select anything outside of the inputDiv, which is a problem unless the inputDiv were to grow and move with the selection boundaries. I spent some time trying to make that happen, and then gave up and tried the alternate approach. \nCan I ask what's the quirkiness that makes the other approach so bad? Assuming one restricts font-family and font-weight to be constant (line-height is already restricted), this seems work perfectly on all non-IE browsers. I'd rather have a simple core, with all the faked-cursor and selection code enabled only for IE. \n. Understood -- for the record, I don't consider my tinkering around to be anywhere close to a patch. I spent a little time mocking something up that seemed to work, and wondered if you'd already gone down that road and deemed it foolish. I'll continue to play, and if anything legit comes back I'll be sure to submit a patch.\n. Relax, my friend. There's a lot of low-hanging performance fruit to be picked, but I'm working on making all the corner cases work correctly before I start optimizing. Native selection behavior is very difficult to emulate - if you can do it in less than 200 LOC, that would be wonderful! \n. @mys3lf - do you have a public URL of this image replacement? I'd love to see an example in action.\n. No, this is unrelated.\n. I haven't been able to test this with my plugin -- I'm just saying this behavior happens on native CM, and is not related to the plugin code. I would investigate, but I don't have a wireless keyboard to test with.\n. http://www.litech.org/~schanzer/CodeMirror/demo/iOS.html\n(some issues on iOS 5, but iOS6 works quite well)\n. Of course not. My plugin isn't doing any magic. It's a bunch of smoke and mirrors, but the goal is to use CodeMirror pretty much unmodified, so any bugs you see without the plugin will also appear with it. :)\n. FYI - I do not see this on chrome stable/osx.\n. You're absolutely right -- larger selections have a visible jump. I suspect the smaller one I was using was simply too fast for me to see, or fast enough to fall between browser repaints.\n. Arg - this was not the right way to offer my changes. Closing this bogus request -- sorry for the noise! :P\n. +1 vote for something like beforeSelectionChange - that definitely has uses on my end as well.\n. FYI - if CM is ever going to function properly on Android or iOS devices with scaling enabled, this is a problem that's going to have to be solved. My time has been completely eaten since I began working on the iOS plugin, but a large chunk of that code came from having to work around this exact issue.\n. I'm seeing this same issue in OSX on Chrome 47, with some other (possibly-related factors): https://discuss.codemirror.net/t/inserting-a-boomark-immediately-before-a-textmarker/590\n. Right, thus the title.\n. This problem can be resolved by saving the scroller element's scrollTop position before the call to focus, and then restoring it afterwards.\n. Works like a charm! Thanks! (Not sure what your policy is on having users close issues, so I'll leave this open for now.)\n. I know you've got a huge amount of work going on, so I hope this doesn't come across as pestering. I wonder, however, if upping my monthly contribution might serve to upvote this bug? As a consumer of this library, it's only reasonable that I pay for your time. :)\n. It appears to fix things on my IE11 VM - let me do some more testing when I can get my hands on a real machine and post back in 24 hours. Thanks for looking into this!\n. No dice. :(\nI've put up a test instance using the stock Scheme mode in a pull from https://github.com/codemirror/CodeMirror/commit/fafb7dc17d45d24ef5e84d3f61696ae9a4ea28fd. To reproduce (confirmed on IE11.0.9600.18376 and 11.494.10586.0):\n- Open the URL: http://www.bootstrapworld.org/preview/testing/codemirror2/mode/scheme/\n- Locate the line beginning with (define BACKGROUND (bitmap/url \"..., and select the contents of the quoted string (the URL)\n- Open a new tab and go to any URL. Then copy the URL from the address bar\n- Return to the first tab, and paste the clipboard URL on top of the selected URL. Then hit the space bar.\nSometimes the pasted URL disappears, and sometimes it disappears and the old URL comes back. I've posted a video of the behavior below. Toggling inputStyle turns this behavior on and off.\n\n. Confirmed fixed! Thanks so much. Not sure what the right etiquette is for closing, so I'll leave this open until you want to shut it down.\n. Thanks for merging my PR!. This doesn't hide the widget. All it does it remove the container from the accessibility tree. Role attributes are not recursive, so the actual widget dom remains part of the tree.. Set viewportMargin to Infinity.. You want to have your cake and eat it too. If you're using the browser's native search functionality, you are limited to searching only what is rendered. If you want to search EVERYTHING, you need to render everything, and pay the speed cost.\nIf you want to avoid this, you need to give up on using the browser's native search. Check out the search addon. @mjanusauskas this won't be done soon - proper a11y support isn't easy (otherwise everyone would do it!), and the github tutorial doesn't come close to covering what CM will need. I've been doing significant work on a related project (and contributed small fixes back into CM) to do this right -- and I can assure you that contentEditable is just the beginning of what's needed.. @marijnh , would you be open to sharing some of the radical changes you're considering? I've made significant headway on a project aimed at improving the screen-reader accessibility of programming in general, which is built entirely around CodeMirror. I'm both curious about what you're thinking, but also just a little worried that any massive API changes will wreak havoc on my codebase.. Not a bug - codemirror now uses node to create the codemirror.js file. Do you have npm on your machine? See https://github.com/codemirror/codemirror\n(Though in all honesty, the Quickstart section of the README should probably also be at the top of the manual). Good call. Done.. @viridium , TextMarkers are used for all sorts of things, and it would be semantically incorrect in many of those contexts to have a marker select the text it contains. As @marijnh says, they are flexible enough to allow you to do exactly what you desire. Changing the default to be your particular preference makes sense for you, but not for everyone else. Is an extra line of code such a high price to pay for the API not being tailored to your particular preference?. Perhaps I'd like to replace a hex value in a CSS file with some kind of widget, presenting the user with a color picker onDblclick(). . TextMarkers are designed to be maximally general, and their default behavior should support that. Changing the default effectively changes the semantics of the feature. Yes, \"you can always override the default to do what you want\"...but then again, so can you. :)\nAnd if you don't buy the \"keep the default behavior general\" argument, consider this: Changing the default behavior the way you suggest would break large amounts of existing code. Do you really want to break other people's codebases just to save one line of event-handle code in your own?. This is not a bug. See the README.. My reading of the API is this: if nothing is selected, then hitting the delete key should not modify the document in any way. Removing white space modifies the document, therefore something has to be considered selected.. ",
    "sosensible": "OK people, has anyone besides me jumped in and tried an iPad (iOS) with a Bluetooth keyboard? The only thing that did not seem to be working was the left/right/up/down arrows. I tried a number of ways to grab the values without success. Any ideas? I am using this keyboard but since the arrows work in web text boxes it doesn't seem to be a keyboard issue. It seems to be the way safari works on iOS. http://www.logitech.com/en-us/1111/8214?section=overview&tabs=1,3,2,4,5&hub=1\nFor me it seems most of the rest is up and running. It is in fact the best text code editor I have used on the device to date.\n. There are no key events firing. This is strange because the editor works. I was expecting only the arrow keys to not work.\n. ",
    "zyavrik": "Marijnh, Copy and Paste works on standard 2.35 CodeMirror (just double-tap inside editor)! Only selection doesn't work! It's only required to repair select function. The schanzer's version is very large, has really a lot of issues, superfluous function of additional keyboard and works very-very-very slow (can't use it). We only need to repair selection on the CodeMirror to bring iOS support!\n. I have added alert(e.KeyCode) to onKeyDown event - and it doesn't work at all on arrow keys. All other keys work fine. Why??? How to fix this issue?\nRelated question: http://stackoverflow.com/questions/14861034/arrow-keys-dont-work-on-javascript-on-uiwebview\n. schanzer, why do you think so? Did you fix this issue on your version of CodeMirror for iOS?\n. schanzer, where may I try your version for iOS? Obsolete link http://www.litech.org/~schanzer/iOS/ doesn't work.\n. Another issue like this. Run mobile Safari, open CodeEditor, type anything, press Up key or Shift+Up key, press any char key again. You will see it before the first entered char (Up) or all entered chars will be replaced by it (Shift+Up).\n. Arrow keys don't work on it too:(\n. I think we should simplify CodeMirror script until issue goes off to find what cause it.\n. Does anybody plan to fix this issue? I'll be glad - but don't know javascript enough for that:(\n. ",
    "bcomnes": ":+1: for better mobile support!\n. ",
    "peterjenkins": "+1. Trying to find a decent code editor that will work on iOS. Ace doesn't support either.\n. ",
    "frozeman": "i tried it but after everything was loaded.\ni used it in a slide effect, so i would slide in and then call refresh.\ncould work.\nanother solution is not there or?\njust giving it 100% or so? or copy the height of the textarea? (hm is alos not possible if its in a div with display none or?)\n. another question.\nis there a fix in sight for the cursor position when on a line ending?\nit quite annoying :-)\n. ok i send you a testcase as html\nthanks\n. thanks, but the problem was already solved, as i tied the newest head. the font... thing was it obviously :-)\n. ",
    "DocKaos": "I pasted in 187 lines. \nUsing Chrome 10.0.648.204 on Windows 7\nFrom Line 187 if I hit page up, the cursor disappears. (It actually moved to line 1, which is way off the screen) If I hit left, I am scrolled back to line 1.\nFrom Line 1 if I hit page down, the curosr disappears. If I hit right, I am scrolled down to line 187.\nSame in FireFox 4.0 on Windows 7\nSame in FireFox 4.0 on Mac OS \n. ",
    "liberydn": "If I replace '_position' with 'position'  in CodeMirror.css file ,it works fine.\n. I use the tool called iecollection,it contains all versions of IE.You can download it from http://finalbuilds.edskes.net/iecollection.htm .\n. ",
    "scharmetant": "Geee, that was fast! -- and correct\nThey should pay you more\n. ",
    "GamingG": "Open this page and note the page source and locations of ]]> in it.  Then, click the link on that page to view that page's source in CodeMirror.  Scroll to the bottom of the page and, at some point, you will encounter a JavaScript error that will cause lines to disappear.\nhttp://www.gamingg.net/gfmdev/codemirrorex/cdataerror.html\nThis error only occurs when the page that runs CodeMirror is parsed as XHTML (for example, using the application/xhtml+xml content type).  If the document is parsed as HTML, this does not occur.  In my experience, this is usually the result of using deprecated methods of accessing the DOM.  I may attempt to find the exact cause of this error myself if you are unable to determine why this is happening.\n. http://www.gamingg.net/gfmdev/codemirrorex/cdataerror.php\nSave the source of that file as cdataerror.xhtml.  Change line 7 to point to your own copy of codemirror-compressed.js.  The error should occur.  If you save it with the .html extension, the error will not occur, since the document will be processed as HTML instead of XHTML.\n. ",
    "westc": "Yes, this error occurs for me on IE.  I am selecting all of the characters by using CTRL+A.\n. I have determined that this was an issue with the IE9 beta.  After implementing your fix, I still saw issues with the caret position while using the beta, but I don't see the issue now that I have upgraded to the RTM.  Thanks for the help.\n. ",
    "rulemotion": "If I change the tab initialization to something like this:\njavascript\n$(\"#tabs\").tabs({\n   show: function(event, ui) { editor.refresh(); }\n});\nit works. I could probably make that a bit more specific to the tab with the editor. But is this the best way to solve this?\n. Thanks for the quick response.\n. ",
    "jmonegro": "Thank you.\n. This might be an odd request and definitely not your responsibility, so it's OK if you don't want or don't have the time to work with me on this one, but is there a way I could prevent the onChange event from firing when using the setValue method?\nIn other words, I'd like onChange to fire every time, except when I use setValue...\n. I did not want to create a new issue so I'll just piggy-back on this one:\nHow could I go about making onKeyEvent work with keyup?\n. ",
    "est": "Hi, I added prototype walking on my master branch :)\n. Sorry it's my own code that didn't work out well.\nI am lost in a dead loop while walking prototype chain like you commented in my Github Pull Request.\nbtw if I type []. or {}. in CodeMIrror2 and then Ctrl+Space, no autocomplete for this?\n. So in what cases are array and function autocomplete invoked?\n. Cool. This is getting a little off-topic, but any plans to make CodeMirror support variable scope search and autocomplete user defined variables?\nYou know I am extremely interested in developing a self-hosted javascript editor :)\n. Hmm, perhaps I mean auto-suggest not auto-complete: in the line 1 there is a var a = window;, then in the next line I type something like a. and Ctrl+Space, a box shows the methods and properties of a aka window. Is it possible with CodeMirror2?\nbtw I updated my Master branch and Pull Request, this time with prototype walking :)\n. ",
    "vmihailenco": "I have created demo page: http://loutontheweb.co.cc/files/cm.html\n1. Put cursor in textarea\n2. Press Ctrl + L - working properly\n3. Press Ctrl + Shift + L - broken selection (handler is the same as at step 2)\nI am using jQuery event, all code is included at http://loutontheweb.co.cc/files/cm.html\n. FIrefox 4 (Ubuntu).\n. OK, but:\n1. events are working pretty fine, actually setSelection() is broken just in case when SHIFT is pressed. And I don't understand how they can correlate.\n2. transforming your event to jQuery Event as you suggest in docs is extremely slow is not a real option (may be I am doing it wrong?). And again I don't see any points in this except thay you understand that it's very slow.\n3. I rewrited my demo as you suggest using onKeyEvent and got the same behaviour. What am I doing wrong? Link: http://loutontheweb.co.cc/files/cm.html (hard refresh page),\n. ",
    "RapotOR": "don't worry :) thanks for your work!\n. ",
    "GBH": "Can you please clarify how to trigger auto-indent? Thanks.\n. Fair enough. Can you show what those four lines might be? I played with indentLine function but it seems to indent regardless of the line context. My javascript-fu is weak. Thanks.\n. Thank you very much. I'll try it out today.\n. Yey. Seems to working. However for some reason first-level tags are not highlighted ('cm-null' class) but second level ones are fine ('cm-tag' class). When you start editing they will highlight properly.\nThis is what I'm talking about:\n<ul>\n   <li> One </li>\n   <li> Two </li>\n</ul>\nSo the <ul> will be of cm-null class but <li> is properly highlighted with cm-tag class.\n. Thanks!\n. Thanks! That helped.\n. ",
    "gblazex": "Google: \"Codemirror manual\" -> I'm lucky -> Programming API -> indentLine(line)\nI hope you get that every time you're lazy to find something (in a page that is given btw), you rob the repo owner's time and the project development time. If you followed all the instruction and didn't find anything, that would be a whole other case...\n. Excellent, sir :)\n. Note: For one thing the var is definetely useless (and confusing) there because a variable named pos is already defined as an argument. There's actually a bunch of out of scope and already defined errors according to jshint.\n. @marijnh - Yes, I understand that you have your own coding discipline, there's nothing wrong with that. But dismissing tools like JSHint altogether isn't the right approach.\nI think if you look into this case for example, there is no reason why you would want to have var before pos when it's already defined. It will be ignored by the interpreter, but can lead to confusion to someone reading the code.\nAnother problem is that it's incosistent with other parts of the code. E.g (line 488):\nfunction replaceRange(code, from, to) {\n      from = clipPos(from);\nSame situation, no var before the already defined variable from.\n. ",
    "jurek7": "But at this moment there is no possibility to hide(set height:0) few lines in editor, i wanted to add possibility like in popular editors to hide for example function body:\nline number - line content\n1 - function test(){ ... //hidden body\n9 - code after body function\n. Great. Thanks for info.\n. ",
    "jankeromnes": "This looks like code-folding to me: http://codemirror.net/demo/folding.html\n. I think it could be a good idea to have a generic mode for HTML templates (like Mustache, Twig, Liquid, etc). There's already a simple example here http://codemirror.net/demo/mustache.html\n. The wiring is great, I had tried to do something like this but failed to correctly use the timeOuts. Thanks for the code, I'll be able to reuse this in my project!\n. @Daniel-Hug http://codemirror.net/demo/folding.html as you can see code folding was already implemented, and https://github.com/marijnh/CodeMirror/issues/182 was closed a year ago. Enjoy!\n. A little word of warning though, I ran into some minor problems:\n- In the theme demo, you can see that find in function find(start, history) is seen as cm-def, as opposed to findSequence just above which is seen as cm-variable (not the same color in monokai).\n- Additionally, underlining the matching brackets doesn't seem to work on my chrome 15 (neither does the eclipse-mode matching brackets code), and I can't find out why.\n. Thanks for integrating!\nThe global var being treated differently makes sense.\nThe 1em line-height also makes sense, because removing it on chrome 15 places the lines way too far apart. Removing it doesn't fix the matching bracket though: eclipse theme is supposed to place a 1px border around brackets, and monokai theme is supposed to underline them. Neither of them does this even without the 1em line-height.\nI may look into this and open an issue if necessary.\n. Cool, looking forward to it!\n. I have two different behaviors on Chrome 15:\n- Holding Ctrl down and pressing X then S shows only the alert.\n- Ctrl-X + Ctrl-S (releasing Ctrl between the two) triggers only the chrome Save File dialog.\n@peterkroon which browser are you using?\n. Wow thanks @samuela !\n. Block selection would be awesome! @paulirish is going to be excited about this.\n. We're currently trying to do this with @espadrine in our project thefiletree.com, as a replacement for the custom Operational Transformations we developped before (see our old CodeMirror extension here). We just started, but if you want I'll keep you updated!\n. @espadrine did it! He should pull request a CodeMirror demo page to ShareJS soon. :D\n. @zz85 actually we ended up not using ShareJS but @timjb's Operational Transformation library. It has a nice public demo and we use it extensively in our project.\nThe instant collaboration is neat and makes cool things possible like collaborative live previews for html, markdown and even sequence diagrams, all thanks to CodeMirror and a little OT magic!\n. I've tried your scenario on Chrome 19.0.1062.0 canary, on page http://codemirror.net/mode/groovy/index.html, and actually got different results:\ncodemirror.js:2583 Uncaught TypeError: Cannot call method 'chunkSize' of undefined\nUndo isn't happening. Here is the line:\nvar child = chunk.children[i], sz = child.chunkSize();\n. Yes, that solves it. Thanks!\n. It works well for .INI files:\n```\n; last modified 1 April 2001 by John Doe\n[owner]\nname=John Doe\norganization=Acme Widgets Inc.\n[database]\nserver=192.0.2.62   \nport=143\n```\nbut also for .gitconfig files:\n[user]\n    name = Jan Keromnes\n    email = janx@linux.com\n[core]\n    editor = vim\n. I also added a commit fixing the mime types defined by the LESS mode.\n- The index page talked about defining text/less.\n- The mode file defined text/css.\n- I chose to define both text/x-less and text/css (if it was not already defined, like the XML does for text/html)\n. Thanks for merging! I'll think about a visual mode to make this even better :)\n. Thanks for this! Just to confirm that the mention worked, and that the $ behavior is correct. It seems odd because in escape mode, the cursor should be on the next character instead of before it. I think I remember an effort to change cursor appearance according to mode (just before next char for insert mode and on next char for normal and future visual mode), @marijnh do you know anything about it?\n. The cursor can be styled differently by changing the CodeMirror-cursor CSS rule, not sure if it's the best way but it's probably easy. And yes, in vi it's impossible to be past last char in escape mode, except for the edge case of empty lines.\n. I think this patch is still useful. It makes the LESS mode handle text/x-less mime types, which I use for LESS files, and also text/css if there's no CSS mode around to handle it. It's a discrete fallback mechanism that can be useful for people working only on LESS code.\n. We have test files for all the modes, so it's pretty easy to spot occasional errors :) https://thefiletree.com/test/\n. Oh, I forgot to add links to the mode, thanks for integrating!\n. I guess word is sort of used for unstyled text in (at leat) OCaml, Shell and Pascal modes. Should we replace word with variable in these modes?\n. Actually a lot of modes return word as a style:\n- clike\n- ecl\n- go\n- groovy\n- ocaml\n- pascal\n- shell\n- verilog\n- xml\n- xquery\nShould we open an issue for this or just rename everything to variable or null?\n. Ok nice! I'll stop using \"word\" then.\n. Thanks for the heads up, I replaced the call to map with a simple iteration.\n. Yes sorry about that, the demo code actually works and I refer to it occasionally (especially to generate https credentials). I understand that is not the point of it, and I won't change demo code again.\n. For what it's worth, I think supporting SCSS (the most popular syntax for SASS as it seems) is pretty easy, as CodeMirror's CSS mode already does a good job highlighting it (see for yourself).\nIt should just be a matter of not highlighting subrules as errors, maybe by loosening up the CSS parser a little. Writing a whole new mode for this is not necessary.\n. @bfrohs Great idea, looking forward to the cleanup.\n. Memo to self: remember to check previous issues before filing\n. Oh, so there is a fixedGutter option. Problem solved, thanks :)\nIt flickers a bit though.\n. Yes eliminating the styles array in the Line object could definitely save up some memory. It also turns out that commenting out lines 2439 and 2440 in the Line constructor doesn't create the null pointers for every object, and this divides the Line object footprint by two in the above example (Chrome 64bits).\n. To control a CodeMirror property from a <select> element, you can simply copy the theme demo.\n. Oh no, github didn't notify me about this. Thanks for fixing it!\n. Sorry about that, it was a misunderstanding.\n. Great news!\n. Thanks Marijn! v3 is looking great.\n. Sweet, thanks for that.\n. Great idea! Also, additional events (e.g. contextmenu) could be exposed as a side shot.\n. I was looking for a good way to listen to context menu events in CodeMirror for integration with WebKit. Its current editor listens for contextmenu events, and forwards line number and gutter / not gutter info so that the WebInspector can create its own context menus to expose features.\n. I think this feature has a lot of hype around it. It was brought by Sublime Text, and it is now implemented by ACE and people seem to love it. I don't use it yet, so I'm not sure about usefulness, but it is cute and I wouldn't mind this being in CodeMirror. Furthermore, I know a lot of people are making (irrational?) decisions about editors based on these kind of innovative features (multiple carrets and selection, block selection...), so if enough people are interested, maybe it's worth a crowd-funding effort? If there was a campaign for that I'd back it.\n. As @siefkenj hints in issue #1032, there can be no Ctrl-V selection in vim mode unless there is block selection support in CodeMirror. I guess there can be no block selection without multi selection / multi cursor. To try it out, click on Edit in any file on github.com and use the Alt key.\nAnyone up for crowd-funding the effort to implement this? I use Ctrl-V very often in Vim, and block selection with Alt-Click could do really nice in the default keymap.\n. In Ace, block selections are composed of multiple single-range selections, with as many new cursors, and I guess Sublime's block selections work similarly.\nIn Vim, block selections appear to be single selections with a single cursor but multiple ranges. However, if you block select, then hit S (substitute: delete the selection and go to insert mode), you're going to be inserting text in the first line of the block selection, but as soon as you leave insert mode, all your inserted text is replicated on subsequent lines of the block selection. So I'll argue that Vim's implementation will also work with multiple selections and multiple cursors.\nEDIT: Maybe I'm not making much sense, but my point is: I think block selection can and should be implemented with multiple single-range selections. No need for single selections that span multiple ranges, since replacing a block selection will always replace each range individually.\n. The only difference between several single-range selections vs a single multi-range selection is that in the first case there are several cursors, implying that any operation is applied to all ranges. The multi-cursor aspect helps operating on all ranges (every selection's cursor inserts / deletes / replaces the same way), and this implementation has the nice effect of giving all at once multiple cloned cursors, multiple selections, and block selection (when those multiple selections happen to form a block).\n. Vim is also able to paste rectangles anywhere (before inserting the new text, it deletes currently selected text if any, but the pasted section does not care about the shape of the selection it replaces). The behavior I see is, paste the first line of the clipboard as if it was pasted normally, and then paste all the other lines of the clipboard relatively to the first pasted line. For multi-selections that happen to be rectangular, it happens as follows in Vim:\n```\ncopy this:\nA B\nC D\npaste into this (with cursor on or just after \"j\"):\ne f g h\ni j k l\nm n o p\nresult:\ne f g h\ni j A B k l\nm n C D o p\nedge case when you paste off limits:\ne f g h\ni j k l\nm n o p A B\n        C D\n(new lines and white spaces are spanned as necessary)\n```\nI don't see why having a \"multi-cusor-sublime-ace model\" would cause trouble implementing rectangular pasting. The Emacs behavior you described sounds to me like:\n1. delete previously selected text\n2. insert all ranges in the clipboard relatively to the pasting position\nDoes Emacs fit the pasted rectangular text into selected rectangle if their dimensions are different? Maybe that would be a little more tricky.\n. @timjb does this awesome demo also work on codemirror v3?\n. The demo is still available at https://thefiletree.com (create any file and open it in several different browsers), and the code can be found at https://github.com/Operational-Transformation/ot.js\n. I was able to reproduce in Firefox, but not in Chrome or Opera.\n. This exhaustive listing of files brings a significant maintenance cost with it. Maybe it would be a good idea to be more generic, at least for modes, as in this build script?\n. +1 as I do this a lot\n. I did some tests in Linux (Kubuntu). I found the results somewhat surprising:\nNever select restored text upon Undo:\n- CodeMirror\n- Vim\n- Chrome url bar\nOnly select restored text if it was selected before Undo:\n- Kate\n- Firefox url bar\n- textarea in Firefox\nAlways select restored text upon Undo:\n- Eclipse\n- Opera url bar\n- textarea in Chrome\n- textarea in Opera\n- Chrome devtools (except when editing HTML)\n. Hey @heavymark, what you're seeing is a Chrome devtools experiment I am currently working on. The goal is to try using CodeMirror as a code editor for the devtools, and it's made to look very similar to the current default editor. It does have the same looks, but you can still spot some differences when looking at the line number margin or at the selection color. It's still an early experiment, as several features are missing (proper warning/error widgets, devtools context menus, etc).\nHowever, the flashing black theme is obviously not intended, can you please double-check that it always happens when running with \"Use CodeMirror editor\" active, and that it never happens with it disabled? If so, please do file a reproducible bug, as here is not the correct place to discuss Inspector experiments. Cheers!\n. The map was actually there before, I just moved things around to make it more bearable. You are welcome to propose subsequent refactorings, or even a new implementation of the vim keymap altogether, as long as current supported functionalities are preserved.\nI personally do not have time to reimplement so many features. Up until now there have been a lot of important contributions from many different people to this keymap, and even if the current implementation is far from perfect (look at how clean the emacs keymap looks in comparison!) it has a lot of coverage, and a visual mode is not far away. Your attempt to make things better is of course very welcome, and I hope you'll succeed!\n. The code does look cleaner, and I like the orthogonality between motions and operators (even if code duplication was kind of avoided in current implementation). However, it's 1016 lines versus 897 lines and it doesn't yet reach full feature parity.\nI gave it a quick try:\nMissing features (not exhaustive):\n- Arrow navigation in default mode\n- Repetition for Y, D\n- Nothing happens on : (would be nice to have :%s// some day) or caw\nStill missing in both implementations:\n- Nothing happening on * or /\n- No repetition on inserts\nWhat do you mean exactly by \"support for marks\"? The previous implementation has a map of marks.\nAlso, no need for a setCursor() method that doesn't reset the selection, just use setSelection(old, new).\nI also don't like side-by-side implementations, and maybe a branch is a bit overkill since your repo already holds the concurrent implementation. Personally I don't mind the new implementation, since it has some obvious benefits, but I'd like to see it come closer to feature parity before merging it. Also, a visual mode would help get my vote.\n. The new implementation is 54K (21K minified) versus 31K (14K minified), but I guess the additional minified 7K are a good tradeoff for the improvements and new features.\nThanks a lot for the visual mode, it's still not perfect (there is an off-by-1 error when you try to x text, and D should remove entire lines in visual mode instead of acting like in normal mode) but it's a feature I was really looking forward to.\nI didn't find any other problems, so if @marijnh, @mattsacks, @xLanny, @misfo and @chris-morgan don't have further objections, I think we could go for the new implementation. Thanks for all the good work!\nEDIT: Does the new implementation respect the behavior described in #997 ?\n. @wesalvaro Haha sorry about that, I selfishly implemented the visual mode behavior before there was a visual mode, because it was the one I was using the most. I think this was fixed a while ago, and both behaviors should be correct in the new implementation anyway. Funny how small details sometimes get more unnerving than bigger problems.\n. I didn't know about onemore, but I actually prefer not being able to move beyond the last character in normal mode. I feel it makes more sense, since the fat cursor can only highlight existing characters. Whenever I use the current vim implementation in CodeMirror, I have trailing-space alarms going off in my brain and this is somewhat annoying. If a majority of people prefer the onemore behaviour I don't mind it being the default, but I'd really like to have the arguably \"normal\" behaviour.\n. I'm curious, what motivated this change?\n. Nice catch, they were the only executable files with compress and run.js, I wonder if there is a way to git blame for file permission changes. Also, the folders all seem executable, but maybe that's normal?\n. Agreed, I have been wanting to remove all trailing spaces for a long time, but since Git's collaboration model is line-based and not character-based, fixing them would give one the credit for basically the whole project. A shame.\n. This is seriously awesome.\n. Hi @francisreyes, what specific apple keystrokes are you having problems with?\n. Invoking @peteguhl who I believe was the original author of the VBScript mode, and there also is a VB.NET mode that has a few tests in its index page (sadly they don't use the powerful unit test system that was introduced after its creation).\nJust out of curiosity, is it technically possible to write a unified VB mode that handles all VB dialects? (e.g. VBScript, VB6, VBA, VB.NET)\n. @ComFreek thanks for pointing that out! If you address this in a commit that you push to your repository, I can add it to my pull request (by rebasing it on top of my commit and pushing to master).\nEdit: The commit will of course still belong to you.\n. @ComFreek Perfect, thanks! I've added your commit to my pull request.\nI think mode index pages should not define the mode parameter. As you said, the last loaded mode will be used, and that seems to be the standard way to do it. I would be up for fixing all mode index pages that unnecessarily define a mode mime type, if @marijnh thinks it's a good idea.\n. I agree google searches are the correct approach to find out what the consensus is around a mime type, and that is the approach I followed.\nI proposed those changes because all of the addressed mime types either correspond to new usages (no previous occurence of a mime type, so CodeMirror becomes the \"consensus\") or there existed a viable standard alternative. I don't believe the change is compatibility-breaking, and I would like to mitigate non-conformance in CodeMirror because several new mime types originate from here.\n. I see that aforementioned regexp ranges already include the Combining Diacritical Marks (0300\u2013036F, which by the way includes 0x31B and 0x340) plus a few others. Would it make sense to also match the following ranges?\n- Combining Diacritical Marks Supplement (1DC0\u20131DFF)\n- Combining Diacritical Marks for Symbols (20D0\u201320FF)\n- Combining Half Marks (FE20\u2013FE2F)\nSource: https://en.wikipedia.org/wiki/Combining_character#Unicode_ranges\n. ",
    "artdent": "I don't see this commit in master anymore. Did a subsequent push accidentally orphan it?\n. Thanks!\n. ",
    "derjanb": "Forgot to mention:\nI'm using CodeMirror Release 28-03-2011: Version 2.0.\nAnd thanks for this great editor! :)\n. Ok, I got it. :) The link above points to the userscript page and not the source. Sorry.\nThis is the link to the userscripts source: http://userscripts.org/scripts/source/60231.user.js\nI've pasted this to pastebin too (http://pastebin.com/AGxbFMdg) but it seems that the encoding got broken while copying. So maybe you want use the first link.\nThanks again. :)\n. Ok, I'll add this to tampermonkeys known issues. I thought the two issues might have a different root cause, because the script from the other issue is editable for about 1 second whilst this script blocks any user input immediately when the editor is opened. Thanks for your time and keep up the great work! :)\n. What chinese pages do you mean? The editor content was the javascript source that can be downloaded from the given link. In this case \"Google Reader Filter\" that works at the reader.google.com. But no problem, you can get the source now from pastebin.com too: http://pastebin.com/ixZnpDsV\nThanks for your time...\n. Oh, I forgot to mention that is behavior happens at CodeMirror 3.11 (and at least 2.36 too).\n. ",
    "vrana": "CodeMirror should not handle Ctrl+Tab which is a browser shortcut.\n. I don't get it. You agree that the current behavior is annoying but you wouldn't accept a patch fixing it? Would you accept a patch expanding the selection just in the case when the start of the selection is in the whitespace in front of the line? With this selection (. denotes whitespace, | denotes start of the selection):\n...|...text\nOr even this:\n|......text\nThe current behavior after indenting is this:\n........|text\nI want to change it to this:\n|........text\n. I've changed the code to check for ch being zero (both on the from and to lines because otherwise the selection shifts). It's fine for my use-case. I'm not sure how do you want to check whether the selection actually moved.\n. Thanks.\n. {template .a}\n  {if $a}\n    text\n    {/if} // This wouldn't unindent correctly.\n{/template}\n. Thanks for the merge. I'll send you another pull request as this still doesn't work e.g. for {else}.\n. I've tried it and now it works more or less how I wish.\n. Thanks. Strings should be indented, it's:\n{msg desc=\"Long\n    description\"}\nnot:\n{msg desc=\"Long\ndescription\"}\nI've sent you pull request #2987.\n. I think that it should be possible. I don't plan on doing it though.\n. Any feedback?. It's explained in the commit message 1c4593345e70b279f64c4532133e3354d6899256.\n. ",
    "nicknotfound": "This appears to be a difference in what Chrome and Safari return when calling textarea.selectionStart\nI tracked this down to CodeMirror's prepareInput function, which calls the setSelRange function to set the selection range.  When I add log output and test in Safari and Chrome, I see two different ranges being set.  It's the value of sel.from.ch that is different between Safari and Chrome.\nI'm still trying to track down the real source of this bug, which appears to be caused by the insertion point being kept at the beginning of the selection when it should be at the end of the selection.  I'll comment here again if/when I can find out more.\n. I'm still working on finding the difference between Chrome and Safari that is causing this bug.  In case anyone is interested, visit a simple CodeMirror page (like the Auto-Resize Demo) and run the following two lines in a Safari web inspector console.\njavascript\nvar t = document.getElementsByTagName('textarea')[1];\ndocument.body.appendChild(t);\nt.style.position = 'static';\nt.style.width='100%';\nThis code makes CodeMirror's internal textarea visible at the bottom of the page so you can see what's going on behind the scenes with cursor position and text selection.\n. Thanks so much for fixing this!  Much appreciated!\n. It appears this issue has cropped up in Chrome now (though Safari is still fine).\nI did a quick test, and this can be fixed by changing line 2451 of codemirror.js to detect /AppleWebKit/ in navigator.userAgent instead of detecting /Apple Computer/ in navigator.vendor.\nIt'd also of course make sense to rename the safari variable to webkit.  I verified that this variable is not currently being used for anything but fixing the original bug reported in this issue.\n. Thanks for taking a look at this.  I know browser-specific issues are always a pain, so I completely understand where you're coming from.  The good news is that the browser's find command isn't entirely broken, because the search matches are still visually highlighted.  (The brokenness is in that the browser scrolls all the way to the bottom of the page rather than to the first match.)\nAnyway, I just wanted to follow up and say thanks.  If I come up with any creative ways to solve this, I'll post here again, but this is admittedly a low-priority issue, especially since it is browser-specific.\n. Excellent, thanks!  I tested it out a bit and it works great!\n. ",
    "driven": "hi, your script to look at the textarea is very useful...\nOk, I can confirm this also happens in a WebView embedded in another app, \nI checked this because it is a variant on safari and does have slightly different Webkit features by default. (I have had other bits that work in it and chrome but not safari)\nAlso this particular comment box (that I'm typing in [on safari] behalves properly and subtracts a char for left and/or right shift/arrow, so it's not part of Safari's default behavior to 'add-to' for shift/right arrow. \ncheers  John\n. ",
    "uboness": "Well.. I'm currently binding event handler directly on the marker element which I lookup by the provided id. It's very easy to generate unique ids as I add the markers, but also it enables me to assign whatever unique handlers for every marker I add. Since I used it from within GWT, searching by id supported out-of-the-box, but I guess you can do the same with classes. In a way classes may be even better as you can share behavior between the same marker \"types\". You can always emulate and \"id\" by assigning a unique class for each marker.\n. ",
    "kostantinos1995": "Sorry, false alert!\n. ",
    "alexey-k": "Hi Marijn,\nOK, I'll move the word wrapper to a separate file and share my results. You\nmean adding a wordWrap method to the CodeMirror object (the one which also\nhas the CodeMirror.fromTextArea method), not to the API, right?\nThe amount of additional code isn't so great, actually, I just use a\nformatting model different from the one used by you - that's why the code\nlooks significantly longer although it's really not ;-) I'm also afraid that\nVisual Studio reformatted the entire codemirror.js file, that's why it\nlooked like there were many changes although I only added several functions\nto the API and several more functions to the internals. When it comes to a\n\"real\" environment, I'll probably find a tool to remove all indents and\ncomments from JavaScript files to make the code files as small as possible -\njust keep it exceedingly indented during development.\nAs for the auto-formatting feature, I'd like to note that this can be a\nreally useful functionality. It was actually requested by a Russian-speaking\nCodeMirror user who contacted me directly via e-mail some time ago. Let me\ntry to convice you that it can be useful and does not increase the traffic\nsignificantly :-)\nWhile the indentation part of the formatting feature is trivial indeed (it\njust uses your indentLine API method), the lines breaking feature is not so\nobvious - specifically for HTML and JavaScript markup. All changes which\nconcern auto-formatting are mainly implemented in corresponding mode files\n(which will only be loaded if you want to work with this specific mode), so\nthe size of codemirror.js is only incresed by 10 lines (if unneeded line\nbreaks and comments are removed). Now, consider the following use case: when\nyou need to work with a piece of markup copied from a web browser, with a\npage source or with a JavaScript file, with line breaks and indentation\nremoved, it is really hard to read the code. A perfect example is Google\nChrome which gave me 50+ Kb of source code in a single line when I copied a\nsmall attributes table from w3schools and pasted it to a WYSIWYG HTML\neditor.\nThe methods I added to the htmlmixed, javascript, css and xml modes allow\nconverting the ugly markup to a human-readable form. Also, when dealing with\nHTML, different rules are applied to different pieces of code (depending on\ntheir automatically detected xml, js or css mode) and therefore the markup's\n\"meaning\" remains unchanged (e.g. string constants or for loop headers in\nJavaScript are not broken even if they contain the ;, { or } chars). So, the\nfeature is not as simple as it seems ;-)\nOn Mon, May 16, 2011 at 9:09 PM, marijnh \nreply@reply.github.comwrote:\n\nHi Alexey,\nFirst, I appreciate the pull request. But I'm trying to keep this editor as\nminimal and lightweight as possible, and since all these, except the\nword-wrapper, can be trivially done on top of the existing API, I think they\nhave no place in the core editor. The word-wrapping is certainly useful --\nif you could implement it as a separate file, I'd gladly put that in, for\nexample lib/wordwrap.js. For example, you could assign CodeMirror.wordWrap\nto be a function taking an instance as the first argument (there is no\n'plugin' system yet where you can add methods), and the range to wrap as the\nnext arguments.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/94#issuecomment-1177679\n\n\nBest regards,\nAlexey\n. If you're interested in word wrapping a text range, the latest news are here:\nhttp://groups.google.com/group/codemirror/browse_thread/thread/6f3308fc16eaa83e/2cac2c44b40594e7?lnk=gst&q=wrap#2cac2c44b40594e7\nHowever, the code was created for CM 2.0 and it currently contains a compatibility issue (I haven't updated it to get the correct editor width from the new Scroller element yet). As for other features, I gave up trying to configure Github on my Windows PC (as mentioned in the post above). I can send you the whole code (wrapping, auto-formatting, etc.) if you want to use it (and if you're probably willing to create a properly arranged Github pull request from that). Note, however, that it includes a few changes/additions to codemirror.js, which are necessary to make the whole thing work.\n. Not really. I've posted a newer version of the wrapping code in the thread mentioned above a while ago. Also, I've asked one of CodeMirror users to share my code here when he has time for that. The point is that I gave up configuring GitHub client on my machine, so I was never able make a pull request with my additional files, which extend codemirror.js and some modes I work with (CSS, XML, HTML, JavaScript). Currently, I just send my code to any person which is interested in it via e-mail.\n. Looks like you no longer need to - I've forwarded the code to Marijn\nyesterday via e-mail. Feel free to ask me if you'll have any questions on\nthe code. It would probably be better to use the CodeMirror group in Google\nGroups for that.\n\nBest,\nAlexey\n. I used multiple commits to sync the current version of the code with the latest version of CodeMirror from your branch. After that, I copy-pasted the three pieces of new code (as you see, there are only 26 additions and 4 deletions, some of which are comments and false positives). I would have rolled back to a previous version or simply re-created my repository anew if I knew the number of commit actions affects smth...\nAs for the reformatting, I'm not sure what problem is - I just copy-pasted your code with minimal changes and never applied any auto-formatting to it.\n. ",
    "microweber": "Hi, any news on that?\n. ",
    "ababushkin": "Has there been any progress in making this part of the core? This feature is really useful.\n. Wow. OK. Thank you for sending the code.\nIf it works without any hiccups I'm more then happy to send through a pull request on your behalf (in addition to this one, I understand Marjin had concerns over the size of this pull request).\n. I agree, this would be an awesome feature.\n. ",
    "rduenasf": "Oh sorry about the poor report! here are the details:\n- mode: css\n- tabMode. \"classic\"\n- indentUnit: 4\n- expected: the mentioned line should be 4 spaces away from the left border. It should look like this:\nfoo {\n    |\n}\n- behavior: the mentioned line is 8 spaces away from the left border. Even if I delete the content of the line and retab it, it looks like this:\nfoo {\n        |\n}\nNote: maybe it has something to do with the tabMode, anyway I think that shouldn't be the normal behavior because is a bit misleading. Also, if I do this, it works as expected:\nfoo {\n<enter>\n<enter>\n}\nIt automatically gets the right indentation on the blank line (in the above example, treat every line as something you type)\n. Nice! :D\n. ",
    "ankit": "@rduenasf \nenterMode - Behavior when Enter is pressed. \"indent\" is the default. It uses the mode's indentation rules to give the new line the correct indentation.\ntabMode - Behavior when Tab is pressed. \"classic\" is the default. When nothing is selected, insert a tab. Otherwise, behave like the \"shift\" mode. \nSo, setting \"tabMode\" to shift will solve your problem.\n@marijnh\nI too think that it'll be more intuitive if the tabMode default setting behaved similar to the enterMode i.e. use the mode's indentation rules instead of inserting a tab.\n. Use case: CodeMirror inside a modal popup with fixed position\n. Use case: CodeMirror inside a modal popup with fixed position\n. No, do you want me to write one? I am assuming you mean a unit test\n. Oh, ok. I am using the keyup handler for live syntax checking and saving the user input into a data store. \nUsing it in stylebot :)\nhttps://github.com/ankit/stylebot/blob/769a3740d8024a74cde05ebf8a3b58123463aa2d/stylebot/js/widget.advanced.js#L28\n. ",
    "nlwillia": "Ah yes, definitely some display:none going on.  Thanks!\n. I am no longer able to reproduce the problem.  I'll close the issue.\n. It's the regular mouse-driven selection behavior that's broken in this demo.  That does involve a \"drag-like\" gesture, but it works fine in IE8 with the other demos.\n. If I use the keyboard to shift-select content on the active line, the selection highlight on top of the line highlight is clear.  But if I click and drag to select, there is no highlight, and the cursor doesn't move.\nThe workaround is to just not use the active line style, so this is not a show-stopper, but there's definitely something odd going on in IE8.  Selection in (IE9 emulation of) IE7 doesn't work very well either (with or without active line highlighting), but that's a shrinking platform that may not be worth going to great lengths to continue supporting.\n. Based on this recent thread http://groups.google.com/group/codemirror/browse_thread/thread/e38e053bbeadce10 I'm assuming that this isn't something I can fix with a keymap, unless it's something in the default keymap that's obscuring the browser-default behavior.\n. Hi Marijnh, I did some debugging and I think I've found the reason why Shift-Insert isn't working.\nIn the handleKeyBinding function, there's a call to lookupKey(\"Shift-\" + name, ...) when a Shift-modified key is pressed, but if that doesn't yield a handler match, then it falls through to a second lookupKey(name, ...) call.  The second call is Shift-less, so any binding on the base key name will apply.  In the case of Shift-Insert, no binding is found, but there is a default binding on \"Insert\" to toggleOverwrite which causes the key to be handled.\nIf you remove the default toggleOverwrite binding, then Shift-Insert works as expected.\nI've tried binding Shift-Insert to null in extraKeys, but unfortunately, it doesn't seem to be possible to unbind a key that's bound by default.\nThere's probably a good reason for the Shift fallthrough, but I'd suggest that there should be a specific match for key combinations associated with platform default behaviors.\n. Will do\n. I've submitted a pull request.\nI'm not sure if I was able to replicate the exact problem described, but there were definitely some problems with void tags that I think should be fixed now.  The xml parser recently changed to pop its context when it detected a void tag in html mode.  This is the main thing that was throwing closetag for a loop.  Fortunately, the current tagName is still available from another location, and I've changed it to look at that.  I also added an option to specify void tag names so that closetag doesn't insert an end tag where the xml parser doesn't think there should be one.  It would probably be better to identify this scenario from the token state (reusing the xml parser's configuration), but I don't see a way to distinguish it.\n. Sorry, I'll try to figure out how to do that for future commits.  (I'm \nreading the O'Reilly book on git, but haven't had a lot of practical \nexposure to it yet.)\nOn 6/25/2012 12:34 PM, Marijn Haverbeke wrote:\n\nThanks, merged. But please try to base your pull request on a non-merged (but rebased) branch that contains no irrelevant commits next time.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/594#issuecomment-6552371\n. Thanks Marijn.  With this change, the scrollbar doesn't cause the editor to fire focus or blur which is how it was working in 2.25 and earlier.\n\n@njx - The advantage of having the scrollbar not fire focus for my use case is that marks (search result highlights) I've added to the content that I plan to remove on focus remain visible while the user is scrolling.  It's not until they click in the editor to type something that the focus event fires, which is my hook to clean things up.  FWIW, a native text area control does focus the editor when the scrollbar is clicked, and I can see how there might be use cases where someone would want to know the scrollbar had been clicked.  With a configuration option, it wouldn't have to be either/or, but it may be too esoteric to be worth going down that road.\n. ",
    "johtso": "A CoffeeScript mode would be brilliant!\n. ",
    "intool": "Yes please. \n[ Can we write our own extensions for CM2? e.g for Jade & Stylus - to highlight syntax errors...]\n. ",
    "ecoleman": "You can already use jinja2 to highlight twig tags to a degree.\nMay jinja2 should be changed to work similar to the mustache demo linked above.\n. ",
    "tony1223": "I mean it's still a tab in \"value\", but use spaces in \"view\".\nWhat actually I want is a \"tab size\"  feature\nThat make sense for almost all modern editor ,\nlike in Notepad++ it has a \"tab size\" to adjust the tab view.\nhttp://screencast.com/t/3xKezQxpzlBB\nIt's just a feature request , i could handle it well by myself,\nI am fine if you think that's still a trivial one. ;)\nBut I think it's still a common usage for editors and worth to post a feature request for me.\n. ok ,got it. Thanks anyway. ;)\n. ",
    "matthew-dean": "Why is this impractical?  Can't the tab be marked up with a span in which we can change the letter spacing?\nOr, better yet, why not auto-convert tabs to a set number of spaces, and just treat them differently when navigating, deleting, etc?\nThis is a must-have for any text editor, for sure.\n. Argh, not having tab space support is so frustrating.\n. This is easily reproducible by trying the same with the Less demo: http://codemirror.net/mode/less/index.html\nSimply pressing \"enter\" after an indented line doesn't produce the same indentation on the next line. Typing curly braces doesn't match the indentation of the line with the opening brace. Yes, I indented .blah intentionally. Most editors will either match indentation of the closing brace with the line of the opening brace, or will match the indentation of the preceding line. I've never seen an editor display CodeMirror's behavior (seemingly random indentation), so maybe I don't understand it. I tried different configuration settings, but couldn't seem to force CodeMirror into standard indentation behavior.\n. ",
    "ekhaled": "Safari does not have FileReader, and chrome works like you found out. Chrome used to work before I made that change anyway.\nOpera has only partial support for FileReader, and to be honest I haven't tested it there at all\n. It's a minor fix, but I think you get the gist of my changes.\nI quite like the way when you have \"return true;\" both keywords are not\ncoloured the same.\nOn Jun 14, 2011 5:21 PM, \"marijnh\" \nreply@reply.github.com\nwrote:\n\nWhy didn't you just define true/false as keywords though? Seems that's\nwhat they are, not numbers.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/117#issuecomment-1367164\n. +1 for the config parameter idea\n. I will have a look, TBH I haven't dug too far into the highlighting code, and don't really understand it too well.\nSo can't really promise anything.\nOn a project right now (using CM), so will look at it when I have bit more time or run into the hiliter code again, whichever comes first :-)\n. \n",
    "malko": "Right for shift but not for Ctr or Alt.\nHow to bind event for thoose particular action when the codemirror\nwrapper is focused... it seems that codemirror have them binded and\nthat they're not bubled up to the DOM so i can't for example implement\na Ctrl+pageUp/Down to switch tabs inside the multiple tab editor i'm\nworking on.\nPerhaps i'm looking it in a wrong way and in such case please point me\nin the right directeion to handle thoose events.\nThank for your reply.\nOn Fri, Jun 10, 2011 at 7:54 AM, marijnh\nreply@reply.github.com\nwrote:\n\nshift-page(up/down) has a well-defined meaning (select a page). Using your own handler to catch keys has other issues as well. If you use onKeyEvent to capture them before CodeMirror even looks at them, you can override whichever keys you want, and let CM do the right thing for those you don't handle.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/114#comment_1339957\n. Arf shame on me :)\nSorry for bothering you I've missed this one.\n\nkeep up the good work, and managing so well your comunity.\nbest regards,\nmalko, happy code mirror user\nOn Fri, Jun 10, 2011 at 4:27 PM, marijnh\nreply@reply.github.com\nwrote:\n\nhttp://codemirror.net/manual.html#option_onKeyEvent\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/114#comment_1342656\n. As a related note, it would be really nice to have a shift mode that can also insert real tab when not at the begining of the line.\n\nthe idea: if something is selected on the line or the cursor is before any printable chars then behave like shift mode by adding/removing one unitIndent at the begining of the line. If nothing is selected and we've any printable chars on the line before the cursor then insert a real tab.\nDo you think that's possible ?\n. ",
    "timdown": "Have you looked at using setCapture() and releaseCapture() in old IE? I solved a similar issue on my own editor project using these methods. See http://msdn.microsoft.com/en-us/library/ie/ms537630(v=vs.85).aspx, for example.\n. Doing this would also allow you add support for double-click-drag and triple-click-drag to select multiple whole words and lines respectively.\n. ",
    "segray": "Here http://segrey.netfast.org/posFromMouse . Just scroll down window and try to put caret.\n. ",
    "oskansavli": "I dont think adding widget outside of the editor would cause any problems because currently i use addWidget with no problems by setting scroll parameter to false.\n. The main problem is fixed, but because of using the vcoords to scroll, editor doesn't scroll to show all the content of the widget.\nmy solution for this issue was:\naddWidget: function(pos, node, scroll) {\n  pos = localCoords(clipPos(pos), true);\n  node.style.visibility = \"hidden\";\n  code.appendChild(node);\n  var ntop = showingFrom * lineHeight() + pos.yBot,\n  nh = node.offsetHeight,\n  nw = node.offsetWidth;\n  if (ntop + paddingTop() > Math.max(code.offsetHeight, wrapper.offsetHeight) - nh) {\n    ntop = ntop - lineHeight() - nh;\n  }\n  node.style.top = (ntop + paddingTop()) + \"px\";\n  node.style.left = Math.min(pos.x + paddingLeft(), Math.max(code.offsetWidth, lineSpace.offsetWidth) - nw - 7) + \"px\"; //7 is needed but i dont know why\n  node.style.visibility = \"\";\n  if (scroll)\n    scrollIntoView(pos.x, ntop, pos.x + nw, ntop + nh);\n}\nThis one scrolls to widget like the old code and also sets widget coordinates to not to overflow current code element. \ni.e. if addWidget is called for the last line in editor, it is added to top of the current line instead of adding to bottom and causing scroller to move.\ni added this control because its really annoying when editor scrolls down for widget and scrolls back when widget is removed.\n. I haven't tried external widget but similar problems would occur when it is added close to browser window edges.\nI also think its better when widget does not overflow from the editor (as external does) and scrolls with the content.\n. There are 2 differences and a bug:\nbug:\nwidget is added to wrong position when horizontal scrollbar is shown and scrollLeft is not zero.\nthis can be fixed by using Math.max(code.clientWidth, lineSpace.clientWidth) instead of code.clientWidth when calculating hspace\ndiff1:\nWidget used to be added below current line but it is added over the line in new code.\nI think this is because of using pos.y instead of pos.yBot when setting top.\nIt would be better using pos.yBot on fit mode.\ndiff2:\nOn the code I pasted 4 messages above, it behaved different for preventing vertical and horizontal overflows such as:\nhorizontal: fits widget to rightmost edge of editor content to prevent expanding. (this is same with yours)\nvertical: to keep curent line visible, adds widget above current line instead of fitting to bottom.\ni mean i prefer  pos.y - node.offsetHeight over vspace - node.offsetHeight when calculating top.\n. All issues seems fixed on this commit.\n. ",
    "codezomb": "I'm not sure that I understand completely. Are you saying that using multiple setOption calls would allow a single editor to be able to handle multiple modes? I'm not using multiple editors, so I need the editor to be able to handle multiple modes. \n. I was able to get this working, thank you very much!\n. ",
    "ajg": "\nWhy do you want to use a MIME type here, not just a regular mode name?\n\nMainly for two reasons:\nFirst, external content providers supply a MIME type but not a mode name (since they don't know about CodeMirror). If I were to use a mode name directly, I'd have to maintain a manual mapping between MIMEs and modes, which seems wrongheaded when CodeMirror already handles that very elegantly.\nSecond, more importantly, in some cases that is the only way to handle certain content. For example, say I wanted to load a C++ file. The clike mode does not name a version for that, only a MIME type (viz. text/x-c++src).\nOr am I missing something...?\n. > The first problem seems odd -- if they can supply MIME types, not mode names, they also can't supply MIME types with funny CodeMirror-specific options embedded in them.\nThat's true, though in my case the parameter I'm interested in (the version) is semantic, so it's supplied independently of the editor.\n\nDoes that sound sane?\n\nI'm not sure I've fully understood. Is your suggestion to give all specializations names instead of MIME types? If so, then yes, it does sound sane to me, as that way there will be a one-to-one correspondence. (For example, you could have clike-c++, clike-csharp, clike-java, and so on. Or just c++, csharp, java, etc., which is more intuitive.)\nI assume that then, MIME types can be associated with named specializations. E.g. text/x-c++src => clike-c++.\n. Yeah, I think that makes sense; the mode can be addressed by its name or MIME type.\n. ",
    "maever": "It seems to be a setting we have enabled, as http://codemirror.net/demo/theme.html does not show this error.\nCould you think of any setting that would cause this, anywhere you purpose I look ?\n. ",
    "fbuchinger": "nice demo, but how are the chances to make this work in ie 7/8? \n. Thanks for reporting this @MattQlik! Since your description doesn't mention the root cause of the issue (text selection gets cleared on right click), I decided to add this more formal description of the bug:\nHow to reproduce:\n\nOpen codemirror.net on IE Edge\nIn the \"This is CodeMirror\" Demo, try to select some text (either by pressing Ctrl + A or by using the mouse)\nRight click on the selection\n\nExpected behaviour:\nSelection is kept and browser context menu for text selections is shown (including copy/paste/cut options)\nActual behaviour:\nSelection is cleared, general browser context menu is shown (no copy/paste/cut options). ",
    "dbertram": "+1 for this addition/modification to the API\nUse case: We use CodeMirror on webputty.net to allow you to edit multiple versions of CSS stylesheets. Currently we store and restore your cursor position when you switch between versions of your stylesheets (and use clearHistory() during the switch), but it'd be great if we could also store and restore your undo history when switching.\n. We definitely could have gone that route, but in our case the UI isn't changing at all other than the content of the editor, so I just figured given the get/setValue and get/setCursor functions, it would be faster to swap the content rather than an entire instance of the editor (and avoid any potential UI flashes during the transition). Of course, I didn't actually test that so that may have been a faulty assumption. I'll play around with keeping two instances of the editor and switching between them in case the performance is comparable. Thanks for the suggestion!\nAlso, just to add a little more detail about our particular use case:\nOur application allows you to edit the \"preview\" version of a stylesheet. Whenever you \"publish\" this version, a copy of that stylesheet is made and stored as the \"published\" version of your spreadsheet. Our UI allows you to quickly switch back and forth between the preview and published versions, however the published version is read-only. So, by storing/restoring the history (as well as your cursor position) when switching between versions, you can make changes to the preview version, switch to view the published version for comparison, then switch back and resume editing with your undo/redo history intact.\nI agree that being able to get/set the History is potentially dangerous, so I'd completely understand if you reject this patch. I just thought I'd pass it along in case someone else found themselves in the (admittedly very niche) use case that we're in.\n. ",
    "xgretsch": "Works like a charm. Thanks for the spectacularly quick response.\n. ",
    "danawoodman": "I'd also love to see this implemented. Would be great for editing blog posts, etc...\n. ",
    "timjb": "I believe that Markdown headers (using equal signs or dashes on the next line) are impossible to detect using the current parser, because you can't look ahead to the next line.\n. Working on it.\n. I've updated to mode to highlight nested lists correctly (not as codeblocks). There are still some cornercases (e.g. when nesting lists in blockquotes), but I think that the main goal is to make Markdown editing more comfortable, not to parse it correctly.\nI'd like you to merge my changes and put under your license.\n. Good idea. Unfortunately, with your patch applied, CodeMirror exits html mode too early if the HTML element has some attributes. Try for example inserting a class attribute in your Markdown example. The Markdown mode will resume after the attributes = sign.\n. Great!\n. @velsa You're right, the tabs weren't handled properly. I solved this in pull request 413. But if you try to start a code block with four space or one tab indentation after a list item (even with a blank line in between) that text will be highlighted as a continuation of the list item. According to John Gruber's Markdown documentation, this is the correct behaviour.\n. I have already implemented multiuser concurrent editing with CodeMirror: you can have a look at the demo and read the code on GitHub.\n. Thanks. I've found and fixed the problem: there was a version mismatch between the client and the server library. Unfortunately, I have changed the protocol between those versions. Therefore, you couldn't delete anything.\n. @jankeromnes I've made the necessary changes (mostly using the new event API) and the demo works now on v3. It  handle also handle different text sizes and resizes the cursors of other users.\n. ",
    "iccube": "Eventually we got the problem (our side issue, sorry) :\nCodeMirror-scroll was missing from the css. Now it's working nicely\n.CodeMirror-scroll {\n    overflow: auto;\n    height: 100%;\n    /* This is needed to prevent an IE[67] bug where the scrolled content\nis visible outside of the scrolling box. */\n    position: relative;\n}\n. ",
    "yuvipanda": "Credit @surenm\n. ",
    "tjcrowder": "@marijnh: If I'm at the bottom of the demo area and press and hold the Up arrow, it'll usually go up one line, then nothing until I release the key and then it goes up again. On rare occasions it'll sputter along, but usually not at all. I can be holding the key quite a long time. The computer is pretty quick, processor is an Intel i3 Core 530 (dual-core, each hyperthreaded) at ~3GHz.\nOdd thing, btw: It doesn't happen if I'm recording with screenr.\n. @marijnh: As I said, this doesn't happen in normal text areas, so it's not just my normal key repeat. I usually have key repeat set fairly quick, actually, as I'm impatient. :-)\nChanging the 80 to 200 didn't make any difference. (Don't worry, I did check to make sure the browser had picked up the change.) Also, not knowing remotely what it controls, for fits and giggles I tried 20 and 2000 as well, no difference.\nNo script errors.\nApologies for this, wasn't expecting such a fast a response from your end(!), but I'll have to leave any further debugging until tomorrow. But I will keep trying things as directed, to help get to the bottom of it.\n. Can confirm that the behavior does not replicate for me on my notebook using Chrome 12 and Windows 7. So it's something about my Ubuntu 10.04 desktop, which reliably replicates it both in browsers running on the native OS and in a Windows 7 VM.\n. I can confirm that this is now sorted. Thanks!!\n. ",
    "dansteingart": "Just a bump, I'm seeing this behavior for CodeMirror 2.13 in Chrome 13.0.782.218 on Mac OS 10.7.1.  It's noticeably slower than the key repeat rate for the rest of the system/text boxes.\n. ",
    "jpillora": "Thanks Marijn :)\n. ",
    "ellisonbg": "```\n<!DOCTYPE HTML>\n\n\nCode Mirror Scroll Bug\n<link rel=\"stylesheet\" href=\"static/codemirror2/lib/codemirror.css\">\n<link rel=\"stylesheet\" href=\"static/codemirror2/theme/default.css\">\n\n<style type=\"text/css\">\nbody {\n    position: absolute;\n    left: 0px;\n    right: 0px;\n    top: 0px;\n    bottom: 0px;\n    overflow: hidden;\n}\n    div#outer_vbox {\n        height: 100%;\n    }\n    div#container {\n        overflow: scroll;\n        border: 1px solid black;\n        padding: 10px;\n        margin: 10px;\n    }\n    .CodeMirror {\n      border: 1px solid black;\n      padding: 10px;\n      margin: 10px;\n    }\n    .CodeMirror-scroll {\n      height: auto;\n      overflow-y: hidden;\n      overflow-x: auto;\n    }\n    .vbox {\n        display: -webkit-box;\n        -webkit-box-orient: vertical;\n        -webkit-box-align: stretch;\n\n        display: -moz-box;\n        -moz-box-orient: vertical;\n        -moz-box-align: stretch;\n\n        display: box;\n        box-orient: vertical;\n        box-align: stretch;\n    }\n    .box-flex {\n        -webkit-box-flex: 1;\n        -moz-box-flex: 1;\n        box-flex: 1;\n    }\n</style>\n\n\n\n\n Without the vbox, the bug goes away \n <div id=\"container\" class=\"box-flex\"></div> \n With the vbox, the bug is present \n\n\n\n// <script src=\"static/jquery/js/jquery-1.6.2.min.js\" type=\"text/javascript\" charset=\"utf-8\">\n\n\n\n    $(document).ready(function () {\n\n        var add_cell = function () {\n            var code_mirror = CodeMirror($('div#container').get(0),\n                {value: 'a=10'}\n            );\n        };\n\n        $('div#container').append(\n            $('<div style=\"border: 1px solid black\">Click to add CodeMirror editor</div>').click(\n                function () {add_cell();})\n        );\n\n    });\n\n\n\n```\n. Thanks for looking into this.  It looks like there are some deeper bugs in the way browsers and handling the flexible box model in situations like this.  I have refactored my code and am able to avoid the issue completely.  This can be closed.\n. Here is an examples that shows the problem:\n\n```\nHTML\n\n\nCode Mirror Debuggingt\n\n\n\n        body {\n            position: absolute;\n            left: 0px;\n            right: 0px;\n            top: 0px;\n            bottom: 0px;\n            overflow: hidden;\n        }\n        div#container {\n            overflow: scroll;\n            border: 1px solid black;\n            padding: 10px;\n            margin: 10px;\n            width: 600px;\n            height: 400px;\n        }\n        div.cell {\n            width: 100%;\n            border: 1px solid black;\n        }\n        .CodeMirror {\n          border: 1px solid black;\n          padding: 10px;\n          margin: 10px;\n        }\n        .CodeMirror-scroll {\n          height: auto;\n          overflow-y: hidden;\n          overflow-x: auto;\n        }\n    \n\n\nCreate Cell #1\n\n\n\n\n\n    $(document).ready(function () {\n\n        cells = {};\n\n        var create_cell1 = function () {\n            var toinsert = $('<div/>').addClass('cell')\n            var code_mirror = CodeMirror(toinsert.get(0), {\n                indentUnit : 4,\n                mode: 'python'\n            });\n            $('div#container').append(toinsert);\n            code_mirror.setValue('Text');\n            code_mirror.refresh();\n            code_mirror.focus();\n            code_mirror.setValue('');\n            return code_mirror;\n        };\n\n        $('div#create_cell1').click(function () {\n            cells.cell1 = create_cell1();\n        });\n\n    });\n\n\n\n```\n. @marijnh: can you clarify what is meant by \"making sure the text area is updated when SetValue is called.\"  Do I also need to set the value of some internal textarea that CodeMirror is using when I call setValue?  Thanks!\n. Fantastic, I will update the see if the problem is gone.  Thanks so much!!!\n\nBrian\n\nOn Tue, Sep 6, 2011 at 11:07 AM, marijnh\nreply@reply.github.com\nwrote:\n\n> Oh, that was not a direct reply to you, that was the commit message of the patch that fixed this problem. If you download the developer snapshot, it shouldn't occur anymore.\n> \n> ## \n> \n> Reply to this email directly or view it on GitHub:\n> https://github.com/marijnh/CodeMirror2/issues/168#issuecomment-2020316\n\n## \n\nBrian E. Granger\nCal Poly State University, San Luis Obispo\nbgranger@calpoly.edu and ellisonbg@gmail.com\n.",
    "chriscalo": "I was experiencing a similar issue when using CSS Grid. For anyone arriving at this later, here's what fixed it for me in case it saves others some time.\nI had the following HTML structure. Details omitted for brevity.\nhtml\n<div class=\"grid\">\n  <div class=\"grid-item\">\n    <div class=\"container\" style=\"height: 100%; width: 100%;\">\n      <!-- CodeMirror instance here -->\n    </div>\n  </div>\n</div>\nNot exactly sure what was the issue, but the fix was pretty simple. I just added position: absolute to the parent element of the CodeMirror instance (<div class=\"container\"/>):\nhtml\n<div class=\"grid\">\n  <div class=\"grid-item\">\n    <div class=\"container\" style=\"position: absolute; height: 100%; width: 100%;\">\n      <!-- CodeMirror instance here -->\n    </div>\n  </div>\n</div>\n. I believe it does. I think I saw the name runMode and thought it was something completely different. I'll give that a shot. Thanks!\n. That makes sense. Tell me where I'm not thinking about this correctly. There are two levels of concerns:\n1. Defining low-level interactions. This is where you define the behavioral details of an editor instance. You watch for and transform user input to add behaviors like key bindings and code completion. This is looking under the hood to modify how the car operates.\n2. Integrating the editor into a UI. This is where you drop the editor into a UI and define how it works in a larger context. Here you're interested only in when the user makes changes because all of the low-level interactions have been handled in code elsewhere. This is driving the car.\nI'm proposing that you don't want to mix these concerns. You don't want to mix the code that defines low-level interactions with the code that integrates the editor into a UI. The problem I see is that there's only a single means (onChange) of dealing with both concerns. So, I'm advocating for an abstraction of the low-level transformations (key bindings, etc.) that only communicates user changes after all the low-level transformations have completed.\nMake sense? Or am I missing something?\n. In case this is useful for anyone else, my favorite solution: \njs\nextraKeys: {\n  Tab: (cm) => cm.execCommand(\"indentMore\"),\n  \"Shift-Tab\": (cm) => cm.execCommand(\"indentLess\"),\n},\nIt couldn't be simpler, and it has the following behavior, which I think is \ud83d\udc4c:\n\nIf text on one or more lines is selected, all lines get indented (or outdented) with either tabs or spaces according to the indentWithTabs boolean option, and the selection range is maintained as expected\nIf there's no selection, no matter where the cursor is\u2014even in the middle of a word\u2014that line gets indented (or outdented) (because who actually needs to insert tabs anywhere in code except for leading indentation?)\nIf the cursor is somewhere in the leading whitespace of a line, one more level of indentation is added and the cursor is moved to the end of the new leading whitespace, before any non-whitespace content starts\n\nNow the only thing left to figure out is how to delete 2 spaces at a time instead of just one\u2026. ",
    "ondrisina": "I found the solution in prevision discussion. Need to refresh on show event.\n. ",
    "deebugger": "Hi Marijn,\nThanks for reviewing this.\nMy original code (and indeed the code I'm using) also adds a 'description' field to the errorLines[i] array, so you're actually preaching to the choir :-) I intentionally made errorLines an array of structs, instead of just an array of number, so that you put description, type (I'm using type for different images in the gutter like error, warning and info) and anything else you may think of.\nAn alternate approach would be to have the user provide two callbacks:\n- checkStateError - which is required to check the state (kinda like something the user might do in your solution of onHighlightComplete) - already in the code\n- createErrorStruct - which will take an state which has an error, and fill it with stuff like description etc.\nAnother solution, which would be even better, is to provide a single callback which will employ both. Something like \"getErrorFromState\" which will check the state for error, return null if no error was found, otherwise return a struct with all the good stuff (minus the line, which can be auto-filled in codemirror.js).\n-Dror\n. hi Marijn,\nAbout the coloring of start tags, I guess it's ok to leave it like that (I know about the framework limitation, just thought I might go around it somehow). It actually makes perfect sense NOT to color the start tags - we should assume that the start tag is always the correct, and the end-tag is always wrong, and get away with it :-)\nAbout the instructions - I'm afraid I completely dropped any reference to them, so thanks for reminding me. This is a serious bug and I'll commit the fix over the weekend.\nUn-indenting lines is another bug, which I'll fix now.\nSo don't pull yet, I'll close these bugs and we'll take it up from there..\nCheers,\n-Dror\n. ok I added processing instructions to the mix.\nI'll work during the weekend on the un-indent thing, but it looks like a bigger issue than I thought: when I'm at the same line, the context is from the tag from the previous line, so I have no idea I'm standing in the correct context for not doing indent operation.\nYou can pull what I have now, and mark the un-indent thing as a bug to be fixed later on (it's more of an annoyance than actually a bug anyway), or wait a couple more days for it to be fixed.\nI think everything else is in order there (unless I skipped another XML specification section). The QA at my work are also checking it, so it's covered by more people than just myself :-)\n-Dror\n. ok, noted - thanks!\n. I use it on my company's web application (we just uploaded the latest version), and everyone's very happy about it (the last editor we had was flash-based..). I also know it's being used here: edit.php.net (log in anonymously and open an XML file. Also look at the 'about' dialog).\nAs for saying that it doesn't do much that the other XML does - that's not entirely true, as the original XML doesn't support most of the stuff that xmlpure does (unless you integrated them).\nWhy? Do you want to remove it from the main?\nThanks,\n-Dror\n. @zziuni - can you provide an example of XML that you used with xmlpure, where you had the bug? Also, didn't it happen in other browsers?\n. xmlpure mode supports the XML spec more rigidly than the XML/HTML mode, which is why I created it in the first place. The way I see it, XML and HTML have little in common. If you feel it's not in use, you can remove it, or otherwise merge it into the original mode.\n. Whoa! That's some serious bug! Apparently IE below v.9 (which is working) doesn't have the 'trim' function, which seems like an important function to implement if you're working with strings.. anyway - I'll fix it from work on Sunday, and smack some of our QA guys on the head for this miss.\nThanks for noticing!\n. Pull request sent.\n. Actually Marijn, since this is a wide issue relating to IE 8 and below, maybe you should put that trim() function in the main file, so that all modes will be able to use trim() without failing.\n. ",
    "afezer": "Yes, it happens on all browser. I tried on last stable versions of chrome, ie, firefox. But i have just realized that it doesn't happen if you select from left to right. It seems like a hard producing bug :) , but my friends and i had this issue for several times. \nIt happens on all modes but you can use xml demo (http://codemirror.net/mode/xml/index.html) to reproduce it. First select a character, for example select any <. While it is selected press < key on the keyboard. Then select anything you want  from right to left, for example indentation. When you press < key on the keyboard it doesn't replace, it should be < but it become <indentation. This issue happens for all characters, you can try with whatever you want. I give this example because we had this issue while using xml mode.\n. ",
    "AhmedMhana": "Nothing change ..... :(\nhtml tags is still appear as above\n. ",
    "steveohara": "Hi Marijn\nI've done as you suggested and tidied it up and confirmed that it works fine with multiline strings.\nThanks\nSteve\n. Hi Param,\nLooks perfect, many thanks.\nSteve\n\nFrom: marijnh [reply@reply.github.com]\nSent: 15 August 2011 08:56\nTo: Steve O'Hara\nSubject: Re: [CodeMirror2] Added Velocity Template Mode (#161)\nGreat! I've cleaned up a few more things (you were using global state in the type and inParams variables in an unsafe way) and merged it in. Please verify that it still works as intended: http://codemirror.net/mode/velocity/\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/161#issuecomment-1805413\n. Hi Marijn,\nDon't need our own license, just happy to contribute to the cause so your license will be fine.\nI'll have a go at a tidy up - to be honest, I was groping around in the dark a bit getting it working and after quite a few false starts managed to get it this far.\nI'll work on it for a bit more and send you a pull when it's ready.\nThanks\nSteve\n-----Original Message-----\nFrom: marijnh [mailto:reply@reply.github.com] \nSent: 13 August 2011 21:07\nTo: Steve O'Hara\nSubject: Re: [CodeMirror2] Added Velocity Template Mode (#161)\nHi Steve,\nThanks! Do you want to put your own license on it, or can I just put it under my license? Also, any chance you can clean it up a bit more? For example, the multiLineString stuff is useless here if Velocity strings don't span lines, and the keywords don't have to be configurable through a parserConfig since this is a single language (the same goes for PL/SQL mode, which is a bit of a mess in itself). In fact, you can get rid of the whole parserConfig thing and move all that stuff into the parser proper.\nBest,\nMarijn\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/161#issuecomment-1798824\n. Hi Marijn, I\u2019ll take a look, might take me a couple of days to get to it\n. ",
    "eustas": "I think #191 resolves this issue\n. Sample1 - closing bracket is colored red:\na = [\n\"Sample\"\n.....] # replace 5 dots with spaces\nSample2 - closing bracket is not colored red:\na = [\n\"Sample\"\n....) # replace 4 dots with spaces\n. Works for me on 4.0.2\n. The purpose of this patch is to add optional HTML5 restrictions (without introducing schema =). \n. Finished second part of patch. Appended to this pull-request.\n. ",
    "DrDub": "tab-size seems to be much more widespread by now. (See the chart at the bottom of\nhttps://developer.mozilla.org/en-US/docs/CSS/tab-size )\nTime to re-open this issue?\n. ",
    "webbird": "Ah. I missed the fact that I had to do\neditor = CodeMirror.fromTextArea(\n          document.getElementById(\"code\"),\n          {\n              mode: \"javascript\",\n              theme: \"neat\"\n          }\n      );\nSeems it doesn't work with just the name any more. Nice to know. ;)\n. ",
    "satchit": "I should have read the manual first. Didn't know about the getScrollerElement. Thanks for pointing that out. But even using getScollerElement, I'm finding that setting the width directly on the node doesn't seem to work. The width appears to be getting overridden by the one calculated in the CodeMirror code. Not sure if there's some kind of race condition going on. Even if I set the class, I need to use \"!important\" so that the width I set takes precedence. \n. ",
    "atownley": "I did wonder about the name...\nI'll do some more testing with the indentation method.  Even though I didn't realize this was the case, it might still work as expected.  Won't get to this today, but I'll do some more with it and get back to you.  It'd be nice to have this merged into the main repo as it's pretty key functionality for me.\nThanks for the feedback.\n. ",
    "cweagans": "Do you think it's worth doing that? I mean, there's plenty of other javascript editors out there - maybe something closer to a WYSIWYG editor would be appropriate for a Taskpaper mode.\n. @marijnh Could you please email me at cweagans at gmail dot com? I may be interested in sponsoring this effort if you have time.\n. ",
    "pmario": "Hope so. I could single step it :) See the testcase html from first post.\nI'm new to CodeMirror and didn't dig too deep into the code. But it seems to be thrown out at line 32\nif (!!conf.mode.version && parseInt(conf.mode.version, 10) === 3) {    // <---- line 32\n    commonkeywords = commonkeywords.concat(py3.keywords);\n    commontypes = commontypes.concat(py3.types);\n    var stringPrefixes = new RegExp(\"^(([rb]|(br))?('{3}|\\\"{3}|['\\\"]))\", \"i\");\n} else {\n    ... snip\nMay be my config/options object is wrong but I didn't find any docu about the mode object, that worked. .runMode with CSS, js, xml works well.\nAlso had a look at [1] the editor example page. But a call with this object doesn't work either.\nthx for your help!\n-m\nPS: CodeMirror is really great work!\n[1] https://github.com/marijnh/CodeMirror2/blob/master/mode/python/index.html#L106\n. Just made a short test and it seems to work for me now too. I'll close the issue and go on testing :)\nthx\n. I choose to have different styles, because of a future mixed mode. \neg: something like this:\nTiddlyWiki ''style'' //content// outside of a code block. \n/*{{{*/\n.myStyle {\n}\n/*}}}*/\nIn TW syntax /*{{{*/ is a start of CSS code block. So the \"outside\" is TW rendered and inside it should be CSS rendered. At the moment the tiddlywiki.js only styles /*{{{*/ and /*}}}*/ and doesn't deal with the code in between.\nimo there should be a difference between TW syntax and other \"standard\" syntax modes. May be if I integrate the mixed mode, it turns out, that I'm totally wrong. Or there's a lot of feedback, to change it. I'll change it :)\n-m\n. uups. \nPlain text mode seems to have a problem. Need to check this.\n. The b2642fd     commit, should handle all modes now, that return whitespace + unstyled text eg: text/plain. If no color is assigned to cm-tab-space-mixed class it doesn't matter anyway.\n@marijnh\n. thx for the fix.\n\nRe-indenting a whole file using your preferred style doesn't really make me feel good about a pull request.\n\nSorry about this. I did use the code to test itself. Just forgot to replace the tabs.\n. thx for the fix.\n\nRe-indenting a whole file using your preferred style doesn't really make me feel good about a pull request.\n\nSorry about this. I did use the code to test itself. Just forgot to replace the tabs.\n. hi, \nwith FF and chrome I get a 404 page if I click the link. it's converted into: http://codemirror.net//v3/\n. ",
    "hans": "That'd be fine \u2014 you can put it under your own open-source license.\nThanks,\nHans\n. ",
    "ks-ifware": "Yes CodeMirror 2 is the place I originally discovered it.  It can be easily reproduced in http://codemirror.net/mode/lua/index.html - simply paste in the following code, and hit TAB on the line inside the Chips() function:\nfunction Fish()\n   --[[\n   end\n   --]]\nend\nfunction Chips()\n   This_line_gets_poorly_indented()\nend\nThe line will get an indentation level of 0, due to the \\\"end\\\" inside the multi-line comment.  The same happens if a similar multi-line string is defined inside Fish().\n. Sorry, I should add, it's only a \"little bit\" broken.  Basically this commit of mine ( https://github.com/marijnh/CodeMirror2/commit/3fc35eb1d9d29f9e6dc2c8c01c6d61267b1c1b84 ) was using the old (CodeMirror 2.02) styles, and so it didn't actually fix the bug.\n. ",
    "hades200082": "I've not seen any other editors that do this online and it would be a huge selling point for codemirror.  Something to shout about :)\n. ",
    "adamjimenez": "@hades200082 ace already supports this\n. As discussed, could the be reopened?\n. sweet!\n. I'm using it for single character. Is there another way to get at this?\nReason I need it is to add a print margin via the api. Or would you accept that feature in the core?\n. Thanks\n. ok, I'll try that.\n. sorry. this must already have been fixed.\nIn 2.32 the line is: \"for (var i in l) f(l[i]);\"\n. ",
    "Daniel-Hug": "I also would love to see this feature implimented! :+1: \n. ",
    "0b10011": "@Daniel-Hug @jankeromnes And an even better folding demo in v3: http://codemirror.net/3/demo/folding.html (start/end tags are collapsed onto the same line).\n. Word selecting workaround: Shift + Ctrl + (Left Arrow|Right Arrow).\nAlso, I may pick this issue up at some point, but can't right now (assume I haven't unless I post a fix).\n. I've found a solution that works (may not be the best way to do it). Regrettably, it's in a custom mode I'm working on that isn't fully compatible with the Markdown plugin. I'll try to get the fix in later, but here's the solution in case someone else wants to take it up:\n- Create a new state quote to track whether the block is quote.\n- Set state.quote to true when > is found\n- Set state.quote to false in return.token() when stream.sol() is true\n- In getType, instead of returning a custom class for each combination, return multiple values (e.g. return_value += (return_value ? ' ' : '') + em;) and add state.quote as one of the checks.\n. Closed by 1f6bcbcb258bee58eb3a95cc2399c56b69007e69 and e757c9dc35d33c981f4038bab5e42a74e801856e.\n. Note about styles: I set the width of the overlay to .5em which is perfect if using a monospace font. Otherwise, it may cover more than one character (or not cover the next character completely).\n. _*Browser:_* Firefox 11 on Ubuntu 11.10\nI was able to reproduce this on several different demo pages, should have mentioned. Any demo that changes something immediately after load (e.g., activeline.html) fixes the issue. As a baseline, I've gone with complete.html to do my testing against (for anyone looking to reproduce).\nDefault font on my system is \"serif\" (Ubuntu default) size 16.\nI have a couple other things I have to take care of first this morning, but I'll try to get more info by this afternoon (and possibly fix, if possible).\nSome Notes - Unless otherwise specified, complete.html is being used\n- Editor is scrollable at load, but after change, it resizes\n- height is 178px at load, 202px after change\n. Issue is present in both Firefox 10 and Chrome on Windows 7. Making the editor's width smaller increases the likelihood of this issue showing up. Keep in mind all of this is with using fromTextArea().\n. Oh, no, I was just saying what my browser's default font is (in case it turned out to be relevant). But the actual font being used is/was the one declared in complete.html in the /demo/ directory.\n. Here's the complete.html file stripped down to the bare minimum that still produces the bug on my machine: https://gist.github.com/2149039\n. Perfect! I was thinking that might be an issue, glad you got it figured out.\n. I'm currently doing a rewrite of CSS and Less that should make it easier to extend both. No promises on when/if this will be finished (doing it as a fun side project), but if you were interested in going off of this, let me know, and I'll try to work on it more :)\n. @marijnh Maybe reopen this and put it under a \"New Modes\" milestone so interested parties can add modes requested by others? \n. @jankeromnes Yeah, it'll just be a highlighting mode hopefully, similar to what I did with GitHub Flavored Markdown. I did just clean up CSS quite a bit, but I'm hoping to clean it up even more (parsing closer to the spec, for example), and add options to make extending easier (e.g. nested rules).\n. Oh, good to know. I was using the development snapshot, but I was trying \"Tab\": function(){return false;} instead of just \"Tab\": false.\n. Interesting. I'll do some testing and update this pull request.\n. @marijnh This appears to be chrome-specific behavior. Firefox focuses the input. To test, throw the following data URI into to location bar of a browser:\ndata:text/html,<!DOCTYPE html><form><input autofocus><script>el = document.createElement(\"textarea\");el.setAttribute(\"autofocus\", \"\");document.body.appendChild(el);</script></form>\nAlso, after checking the spec again, I believe Firefox's behavior is correct, per steps 7:\n\n7. If the user agent has already reached the last step of this list of steps in response to an element being inserted into a Document whose top-level browsing context's active document is the same as target's top-level browsing context's active document, abort these steps.\n\nAs far as I can tell, this means the autofocus attribute should only be taken into account once, regardless of how many additional elements are added, or when they're added. I'll see if I can get a response back from #whatwg on this.\n. @marijnh, it turns out Chrome's behavior is incorrect and the steps should be aborted at Step 7 of the spec (source):\n18:15   bfrohs  If an document contains <input autofocus> and a textarea is added later via JavaScript with the autofocus attribute, which element should be focused? Chrome focuses the textarea while Firefox focuses the input.\n18:16   bfrohs  To test: data:text/html,<!DOCTYPE html><form><input autofocus><script>el = document.createElement(\"textarea\");el.setAttribute(\"autofocus\", \"\");document.body.appendChild(el);</script></form>\n18:16   Hixie   bfrohs: see the spec :-)\n18:16   Hixie   ( http://www.whatwg.org/specs/web-a...ontrol:-the-autofocus-attribute )\n18:16   bfrohs  Hixie: Yes, I'm there.\n18:17   bfrohs  My thoughts are it should be the input, as #7 aborts the steps. Am I correct?\n18:18   Hixie   yes\n. > How about moving the attribute check and = true fallback into the catch branch?\nIf the = true is moved into the catch, focusing will fail on IE when the page hasn't fully loaded.\n\nthe focusedness of the source textarea is ignored when it doesn't have an autofocus attribute, which is not what I wanted\n\nGood point, looks like that feature got lost along the way, or never existed. Anyway, I believe the best approach would be to treat these as two different focus cases. I've updated the pull request accordingly (note: I used push --force to submit a clean patch).\n\nthings might be focused out of the blue even though there's no actual focus present (on IE), which also doesn't seem so great.\n\nIE would only be focused if the autofocus attribute was present, unless I'm missing something?\n. @marijnh, seems to still work in Chrome, but this is broken in Firefox with CodeMirror's current master:\n<!doctype html>\n<meta charset=\"utf-8\">\n<title>CodeMirror</title>\n<link rel=\"stylesheet\" href=\"../../lib/codemirror.css\">\n<script src=\"../../lib/codemirror.js\"></script>\n<style type=\"text/css\">.CodeMirror {border:1px solid black;}</style>\n<form><textarea id=\"code\" name=\"code\" autofocus>Test</textarea></form>\n<script>var editor = CodeMirror.fromTextArea(document.getElementById(\"code\"));</script>\nLess files being loaded and parsed tends to cause the issue to occur more often.\n. @mattpass @harleydo I agree that the workaround kills all security measures in place. I personally like Firefox's implementation, that alerts you when a website implements fullscreen mode, tells you the domain of the website, and asks if you want to stay in full screen or exit (along with an option to remember the preference). Not sure how Firefox deals with typing text in though, after approving full screen mode (I don't trust the MDN article, it's way out of date).\nAs for why certain keys work, it's most likely due to navigation. space scrolls the page, backspace goes back one spot in the browser history, etc.\n. Right-click > Select All on all lines is disabled in Firefox 14.0.1 on linux. However, this only applies if you do this after clicking into the editor the first time. Repeating the steps on the same line, or a different line, will make it so Select All is available.\nIs the context menu simply launching before the textarea gets focus?\n. Right-click > Select All works when either:\n1. The content was edited immediately prior to Right-clicking (Left-clicking anywhere disables Select All again)\n2. Right-click is used twice in a row (i.e. a Left-click is not registered)\n. @peterkroon I couldn't reproduce this in Firefox or Chrome on Linux. I believe I remember @marijnh mentioning there was some UI difference with either Windows or Mac (can't remember which) that reset the scrollbar position after the mouse went outside of the viewport. Can you reproduce this with a vanilla textarea?\n. @peterkroon \"vanilla\" as in \"plain\" -- A regular textarea without any scripts changing it (see \"vanilla software\")\n. @peterkroon - Are you able to attach the v3 milestone to this? (Instead of [v3] prepended to the title.)\nThis was just added for #758, so you haven't been missing anything, it's just new ;)\n. @marijnh @mattpass See issue #773.\n. @peterkroon - Looks like we can't set milestone. I've opened #771\n. @marijnh Oh, wonderful, another different between browsers ;) Firefox keeps the selection where it is, Chrome moves it. To test. I guess leave as-is, unless a wider range of editors keep cursor position.\nIt would be great if there was an option to change this though.\nApplications that keep cursor position\n\nFirefox\nGedit\n\nApplications that change cursor position\n\nChrome\nNetBeans IDE\n. > Should it? If I right-click on the textarea that I'm writing this reply in, it also repositions the cursor (unless I'm clicking on a selection). This corresponds to what CodeMirror does.\n\n@marijnh - actually, that doesn't correspond to what CodeMirror does. If a selection is made, and you Right-click, the selection is lost and the cursor is moved.\n. > Which browser? On Chrome 21 Linux the selection is preserved when I click it. But mind that I'm clicking inside the selection. If I click outside of it, it is indeed cleared (again, following Chrome's textarea behavior).\n@marijnh - oh, sorry, read your comment wrong. Thought you had said \"unless there is a selection\". I need to drink some caffeine.\n. @marijnh - nope, can't set labels either. And wow... it appears general users can't set tags/milestones. I guess we're stuck with using [v3] to let you know about issues. It may still be helpful for you to assign them to milestones though.\n. I found a solution, but don't have time to fully test it (still getting familiar with v3 code). But, here's the solution:\n.CodeMirror-fullscreen {height:100%;}\n.CodeMirror-sizer {padding-bottom:0;}\n. Introduced by 472d099befcca4381b3a449db9010fe3fbaafa0f.\n. And Markdown mode (Firefox 15, linux)\n. Last line I can see is 149 (fully visible), on Firefox 15 (linux). All tests passed for me as well.\n. @peterkroon with Chrome 21.0.1180.57 (linux), I see half of line 150, like you.\n. I see the same behavior, even if I scroll using the scrollbar, or move the cursor via PgUp, PgDn, or the arrow keys.\n. Which library are you using? (That isn't vanilla JavaScript.)\nWhich browser are you using?\nDoes this example converted to vanilla JavaScript work for you (copy and paste into your location bar):\n<!doctype html>\n<meta charset=\"utf-8\">\n<link rel=\"stylesheet\" href=\"http://www.codemirror.net/lib/codemirror.css\">\n<script src=\"http://www.codemirror.net/lib/codemirror.js\"></script>\n<script src=\"javascript.js\"></script>\n<link rel=\"stylesheet\" href=\"http://www.codemirror.net/doc/docs.css\">\n<style type=\"text/css\">.CodeMirror {border: 1px solid black;}</style>\n<div><textarea id=\"code\" name=\"code\"></textarea></div>\n<script>\n    var editor = CodeMirror(function(elt) {\n        document.getElementById(\"code\").parentNode.replaceChild(elt, document.getElementById(\"code\"));\n    }, {mode: \"javascript\"});\n    editor.setValue('var test = \"blah\";');\n</script>\n. @nodesocket It would be much easier to debug this with a working code example (instead of just a video). Any way you could add this?\n. @marijnh I've made a lot of progress toward this (actually have a working version, but still want to make some improvements to it). You mentioned you wanted these tests to be optional. I didn't notice anything in the code where this could be flagged. Does this still need to be written? If so, I can take care of that, and then let you decide the defaults.\n. Oh, oops, sorry for not checking other browsers. Firefox 15 on linux.\n. Testcase:\n```\n<!doctype html>\n\n\n\n\n\n\n(function( window, undefined ) {\njQuery = function( selector, context ) {\n    // The jQuery object is actually just the init constructor 'enhanced'\n    return new jQuery.fn.init( selector, context, rootjQuery );\n};\n\n\n\n  var editor = CodeMirror.fromTextArea(document.getElementById('code'), {\n    mode: 'shell',\n    lineNumbers: true,\n    matchBrackets: true\n  });\n\n``\n. @marijnh Was this immediately after 4b4ac17? I fixed the tests for sTex and Markdown in 557dbe2. Just double checked the tests (on codemirror.net) in Chrome and Firefox and sTex is still passing all of its tests, and Markdown is passing far _more_ than before. Am I missing something? The only other Mode with tests I could find was XQuery, which was using a different test harness (see #796), so it shouldn't have been affected by these changes.\n. No longer needed due to #804 (which seems to have a couple small bugs, but I'll work on those and have a fix soon).\n. Broke something along the way (for TravisCI), and don't have time to finish up tonight. Will close for now, and work on fixes tomorrow.\n. That was entertaining. Node.js and PhantomJS now installed and running on my computer, and this patch passes. Currently, it's running tests for both Markdown and stex modes. If you want to change it to only do the core, simply changeindex.htmltoindex.com#core_*inphantom_driver.js` :)\n. Hah, I knew the mode tests felt slower for some reason. Thanks for catching that!\n. > > and have the tests run in a separate thread async\n\nHow? There are no threads except for WebWorkers in the browser, and those don't have access to the DOM.\n\nWhile the core tests require the DOM, I think we can get away with WebWorkers for mode tests, since those only rely on parsing, and not updating the DOM. And, for the core tests (which is really what's freezing up the browser), we can increase the setTimeOut again.\n. @marijnh I was thinking something like that as well, testing it now.\n. @marijnh are you seeing a slowdown on your machine like Travis CI did? Or is it just bogged down?\n. > I don't see the slowdown.\nKay, good.\n\nI had to add cab9417 to fix a number of breakages on IE. Please do consider that browser supported! (Poor IE.)\n\nOh, right. IE, how I love it. Will try to get better about testing my pull requests against IE :) (And about knowing what works and what doesn't in IE... it's been years since I dealt with JavaScript on a regular basis and I've forgotten quite a bit.)\n\nAlso, I'd prefer if you didn't deviate too wildly from the coding style of the rest of the CodeMirror core \n\nOh, sorry about the left-aligning comma. I just stuck with the style of the mode tests. But, after using it, I have to admit it's amazing--cleans up commits quite a bit when you're adding/removing variables. But yes, I'll try to stick more closely to the style of the core :)\n. @dagsta You were committing to the v3 branch locally, but trying to push to the master branch here. Could you change the branch you're pushing to to v3, or if it works on master, cherry-pick the commit to the master branch locally and push that as a pull request instead?\n. I haven't tested in IE yet, but will do later today.\n. Looks good in IE 7-9.\n. Oh, yeah, I wasn't sure if you would go for the new look or not. Would you be fine with setting font-style:italic; and/or maybe a slightly lighter (or darker) color for .cm-s-default span.cm-property.cm-error and .cm-s-default span.cm-attribute.cm-error? Anything to differentiate it from recognized @media types and properties, other than 100% .error (red text), since it may not necessarily be an error (esp. in the future, with CSS 4 properties), but it's still helpful to know when you've typed it correctly (e.g. is it whitespace or white-space). I tried to reserve strict errors (which only have .error, no other classes) for parse errors, such as misplaced brackets or guaranteed bad values.\n. I had used .cm-default in the external CSS file so it wouldn't affect any other themes, but I'll keep that in mind for future modes.\n. Also present in Firefox 15 on linux. Selecting the line with Triple-click also throws another error (related to options again):\n```\nTypeError: cm.options is undefined\nif (cm.options.readOnly != \"nocursor\") cm.display.input.focus();\ncodemirror.js (line 1053)\n```\n. Ha, beat me to it @azawawi.\n. Note: This is only in Chrome. In Firefox, you receive:\n```\nTypeError: e is undefined\nfunction e_target(e) {return e.target || e.srcElement;}\ncodemirror.js (line 3445)\n``\n. I have a fix for this, will submit as a pull request in a few. But first, I'm going to try to fix the bug in Firefox as well, and submit it in the same pull request.\n. SettingreadOnlytotrue` should display the cursor already. Have you tried that?\n. Look through the Mode-Changing Demo. Also, questions are more appropriate for the CodeMirror Google group.\n. @marijnh nope, they're for two separate issues. 986b40d8cd8729d6f5203922041fae2d32ff5b60 was to allow em/strong inside of link text, whereas this pull request only touches the space between the brackets in links. To merge, the final code should look something like this (lines 187-196 on v3):\n``` javascript\n    if (ch === '!' && stream.match(/[.] ?(?:(|[)/, false)) {\n      stream.match(/[.]/);\n      state.inline = state.f = linkHref;\n      return image;\n    }\nif (ch === '[' && stream.match(/.*\\](\\(| ?\\[)/, false)) {\n  state.linkText = true;\n  return getType(state);\n}\n\n``\n. Also, 986b40d8cd8729d6f5203922041fae2d32ff5b60 was only applied to v3 (in case you wanted to merge it into master until v3 is merged). That looks like the only other one that got missed though (they were committed with a bunch of other fixes for the refactor, so no surprise they got missed).\n. Would you like me to force push a new commit with this fix, to avoid the confusion/merge conflict?\n. Still don't see 984e15502fb54aebdf6c272910a7543ed1efe0e7 on master--forget to push to GitHub?\n. It may be worth addingpre-releaseandreleasebranches to avoid situations like this. Then, any fixes that should be applied tomasterand the release are committed topre-releaseand merged into bothreleaseandmaster(and any topic branches that rely on them [e.g.v3]). If the fix _only_ applies to the release (e.g. v2), it should be committed toreleaseonly. If it only applies to themaster, it should only be committed tomaster`.\nSo, these highlighting fixes would be committed to pre-release and merged into release, master, and v3 (or, simply merge master into v3 from time to time). In short, any new topic branches would be able to merge master without consequence (and merge back into it easily, typically without conflict).\nHow long you would be willing to support a release would be completely up to you. But, if you were supporting more than one release at a time (other than master), you would have to also keep a pre-release branch for each of them (e.g. pre-v2 and pre-v3). For example, if v3 was released already, and you were still supporting v2, and a bug appeared that was only present in v3, you would need to branch from the parent of v3 and master and merge from that. You wouldn't want to delete the pre-v3 branch after applying the fix though, because if a change came along for the patch you applied to pre-v3, you'd want to be able to change it once (in pre-v3) and merge it into the appropriate branches (v3, master, and any future releases such as v4).\nHere's a more in-depth (and probably easier to understand) explanation by Junio C Hamano. Also of interest would be his article on topic branches.\nSadly, it doesn't make solving the issue now any easier... I have a feeling the master branch will have to be trashed, or a lot of work will have to go into solving merge conflicts. If there's any way I can help, just let me know!\n. Reproduced on Chrome 21 on linux. Firefox 15 on linux also slows down considerably in updating the editor with long links (but doesn't lock up). Affects both v2 and v3. I'll look into later tonight.\n. @jbt Could you test out my patch to make sure it's fixed for you as well?\n. Hey Marijn, this should be applied to v3 as well :)\n. Nope, this patch required additional changes to get it working in v3.\n. Is this v2 or v3? Do you have a www.codemirror.net demo we can use to test?\n. Thanks! That was enough to narrow it down. (It's fixed in v3, if you can use that.)\nMarijn, it only affects v2. You can see the problem in action here: http://codemirror.net/demo/activeline.html (resize the browser to get the line to wrap).\n. Ha, much better. I was running on fumes when I fixed that up ;)\n. Does a call to refresh() fix it?\n. Hmm, I thought for sure the horizontal offset was reset to 0 after passing through a blank line, so when it returned to a line of great enough length, it would remain at 0, instead of going back to the proper location (that's why I +1'ed this). Maybe I came across a bug that's since been fixed, or I was just crazy. Either way, I revoke my +1, the current functionality is what I expect.\n. What exact configuration? Can you duplicate it on any of the demos at http://codemirror.net/3/\n. It would be helpful if you also added tests to the mode, to prevent regressions later on when others work on the mode. See test.js in Markdown or CSS mode for help. (These tests could always be added later and don't have to be part of this pull request.)\n. They're named test.js in each of the mode directories. Here's the links: Markdown (GitHub Flavored Markdown), CSS, and sTeX.\nOh, and to actually run the tests, include the [modeName].js and test.js files in /test/index.html.\n. Did you press Ctrl+Space to activate auto-completion? (Have to press it each time to get a menu to pull up in that demo.)\n. I think Markdown mode is what you're looking for. It has highlighting for formatting that's common in plain text email messages.\n\na) Indentation for threading (> >> >>>, etc)\n\nI'll see about building this in, at least as an option.\n\nb) Folding / hiding of signature\n\nI believe it should be pretty easy to accomplish this with a bit of custom code (which I feel is more appropriate for this, but if @marijnh thinks differently, I could build this into Markdown mode by default). See the code folding demo.\n\nc) Folding / hiding of duplicated threaded text in a long thread\n\nThis would also require custom code (see the code folding demo), on a project-specific basis.\n. Can you reproduce in the latest v2 or v3?\n. Of interest: in Firefox on Linux (wasn't able to test on other systems), this only happens the first time you scroll to the bottom.\n. Works for me.\n. This behavior occurs in Firefox and Chrome for Linux as well (see jankeromnes's answer for more detail).\nPersonally, I think restoring the cursor/selection position from before the history event is the most user-friendly, but that may just be me.\n. > You must be using a different Chrome and Firefox then. Or maybe it's some deep GTK setting they are obeying that is set differently on my system.\nFirefox 16.02 and Chrome 22 on Ubuntu 12.04, if that helps you narrow it down.\n. This typo is in v3 as well. (I didn't add another pull request just in case you already merged this and just haven't pushed it yet.)\n. @jmendeth if I remember correctly, this is more of an issue with how the overlay mode works, and not how Markdown parses the file. Definitely open to suggestions though.\n. I'm playing around with the idea of \"Extend\" which will be similar to \"Overlay\", but the child mode will be aware of (and depends on) the parent mode. But, like I said, I'm just playing around with the idea, so it may not actually become anything. (Need \"Extend\" to cleanly use CSS mode for LESS.)\n. Updated issue with minimized test case (should be able to be plugged in as a mode test).\nNote: I can probably work on this sometime this week, but would be more than happy for someone else to take it up.\n. This also occurs with middle-click scrolling (both with autoscrolling turned on and off, although it appears to be more noticeable with it turned on).\n. @marijnh: Windows/Linux (and possibly mac, with a mouse that has a scrollwheel/middle button). There are two middle-click scrolling methods.\nThe first is achieved by pushing the middle button (usually the scrollwheel) until it clicks (just like any other button) and then drag the mouse in a direction (in this case, to the left and right).\nThe second is achieved by first turning autoscrolling on in your browser (Chrome doesn't support it on Linux AFAIK, due to middle-click being used for pasting the current selection, but you can test it on Firefox on Linux). Once it's turned on, middle-clicking anywhere on the page (except on a link, which opens a new tab) will display a new cursor, with arrows in the directions that can be scrolled. You can then drag the mouse in any direction to scroll that way.\nI believe it is handled the same way as throw scrolling (or very similar, anyway), but I'm not sure. It's a common way of scrolling for ThinkPad owners (who use the Trackpoint to move the cursor).\nAs a side note, there seems to have been a regression in performance for middle-click scrolling in Firefox on Linux since I last posted in this issue. It's quite noticeable, especially with the first method of scrolling (it only affects horizontal scrolling).\n. It looks like autoscrolling gets fixed after scrolling back and forth a couple times. The middle-click-and-drag method gets really choppy though (to the point that it appears the editor is frozen). I wouldn't worry about it too much, as it only affects horizontal scrolling (esp. on wider documents) for the not-so-common scrolling method of middle-click-and-drag. You may want to test this newest version with throw-scrolling though, in case throw-scrolling is affected the same way.\n. This is fixed for me in the most recent version (middle-click scrolling).\n. No regressions for me with middle-click scrolling :+1: \n. Oh, shoot, sorry!\n. Just for reference, it looks like someone has integrated typo.js with CodeMirror: http://stackoverflow.com/a/12462720/526741. It could do with some improvements, but it's a start.\n. Verified on Firefox and Chrome (Linux for both).\nIt looks like the selection position is stored correctly (pressing up one more time selects only up to the next line); It's just being drawn incorrectly. Additionally, selection appears to be pretty buggy in general with RTL text.\n. I'm still able to reproduce the original issue (but now it only occurs when selection should be after the !).\nSteps to reproduce\n\nOpen http://codemirror.net/mode/javascript/\nPlace selection at the end of line 8 by clicking\nPress Enter\nPaste `\u0645\u0631\u062d\u0628\u0647\u0627 \u0645\u0647\u0627!\nPress the down arrow\nHold shift and press the up arrow\n\nExpected results\nSelection should be at the end of line 9.\nActual results\nSelection extends to the beginning of the text on line 1.\nNotes\n\nTested on Firefox 17 and Chrome 23 on Linux.\n. Verified fixed :+1:\n. ### A few [possible] gotchas with the provided code\n\nQuirks mode returns 5 (but this probably isn't an issue since quirks mode isn't supported):\n\nVariant of type Floating-point that receives one of the following values.\n5 - Internet Explorer 5 mode (also known as \"quirks mode\").\n\ndocument.documentMode can return 0 instead of the actual documentMode:\n\nWhen the current document has not yet been determined, documentMode returns a value of zero (0). This usually happens when a document is loading. When a return value of zero is received, try to determine the document compatibility mode at a later time.\n\nWill document.documentMode return when not in compatibility mode (normal browsing)? Probably, but worth checking.\n\nThis property is available in all compatibility modes.\n. > We'll probably want to use the list in mode/meta.js instead of keeping a separate list in the markdown mode.\n\nGood call. I'll see if I can work this into my schedule in the next week or two.\n. Just some notes in regards to my personal testing:\n- Adding a background to a <span> will cover text that extends too high/low (eg, the bottom of the letter g), unless a large enough line-height is specified (1.3 should cover most characters/fonts).\n- A <span> can be added to the end of each line with display:inline-block;width:100%; and the final character's class to achieve the wanted affect, without a negative impact to performance (not noticeable, anyway). However, to disable scrolling (scrollbar doesn't appear, but scrolling can happen), overflow:hidden; must be set on each <pre>. \n  - The issue with this is the height of inline-block elements doesn't match the height of inline elements. One approach would be to add n number of spaces, to extend the background to the end of the line, but when lineWrapping is not turned on, this would result in an outrageous number of spaces being added (length of longest line * # of lines, assuming monospace font).\nAnother solution would be to manually set the `height` of each `<span>` (for nested block-level highlighting, with different font sizes). This is calculated when measuring already, so maybe piggyback off of that? That is, set the height of every `<span>` to the height of the tallest `<span>` on that line.\n\n\nAs mentioned by Marijn, the cursor and selection is hidden by a background behind text, so this would have to be worked around as well.\n\nWill look into this more later to see if I can come up with anything. (And if I get hit by a truck, someone can start out from where I left off.)\n. Yeah, definitely. Probably get to it this weekend.\n. F5 does restore the content of <textarea> in Firefox. It does not if Ctrl is pressed as well.\n. It's a similar issue, but I think it can be worked around by adding an event to save the <textarea>'s contents when F5 is pressed (and let the browser worry about whether it restores it after refresh).\n. Verified on Firefox 18:\nTypeError: cm.lineInfo is not a function @ http://codemirror.net/demo/marker.html:46\nTypeError: cm.getLine is not a function @ http://codemirror.net/addon/fold/foldcode.js:109\n. > I'd also expose the visual argument (which determines whether, in right-to-left text, the movement goes by visual or logical direction).\nYeah, absolutely. Would you like this added to moveH and deleteH as well? (It's also in moveV, set to false, but this may be required for the vertical movement?)\n\nCould you give the exposed method a more recognizeable name (moveHorizontallyBy or something)...\n\nI'd like to stay away from anything with the word move in it, as it doesn't actually move the cursor--it only gets the character at the corresponding location. I went with findH because it most closely matched moveH, deleteH, and moveV, and didn't stray too far from findPosH (the mirrored function). I could go with findCharByH, if you're still wanting it changed?\n\n... and describe it in the documentation?\n\nYeah, I can do that. Would you like moveH, deleteH, and moveV documented as well? Same pull request, or another?\n. Beautiful!\n. Is the entire editor (line numbers, scrollbar, borders, etc) jumping on the page? Or is the content just scrolling a bit?\n. Jumps to the right, and then comes back after a second? (Curious if it's the same issue someone just reported to me when using v2.)\n. Would you be open to having it allow for values other than -1 and 1? Or do you need it to behave exactly as-is for the core?\n. > Why don't you just call it twice?\nI could, but it would involve adding another wrapper function to handle calling it multiple times. (It isn't always 1 or 2 times. I often use it to delete 3+ characters at a time.) It just seems like this could be better handled by rewriting findPosH to be able to handle more than 1 character. I'm more than up for rewriting it and submitting it as a pull request--I just want to make sure you would actually be up for merging it, before I spend the time on it. (I understand it would have to be a rather clean patch, with little to no extra execution time for -1/1.)\nAlso, it's rather confusing having deleteH/moveH accept values other than -1/1 without throwing an error, and there's no documentation in the code stating only -1/1 is accepted.\n. Yeah, sure, I'll come up with a demo for you to look at.\n. I noticed choppy character insertion when holding down keys a few days ago as well, although I don't believe it's necessarily something you just introduced. It doesn't really happen on Chrome, only slightly on Opera, but it's pretty noticeable on Firefox (all latest stable releases on Linux). My guess was it's just due to the scripting engines for each browser and my processor (i3), so I was going to test on my laptop at home to see if it was still noticeable on a faster computer (i7, but haven't had a chance yet).\nAnyway, Firefox on Linux with an i3 processor shows the issue pretty well. I haven't noticed any issues with arrow keys though.\n. FWIW, I no longer have this issue on the demo linked in the original report. (Using the same machine I was previously experiencing the issue with.)\n. As a workaround, you could set a flag to true whenever the slider changes the value of the editor, and reset it to false any time the editor is changed externally (ie. not by the slider). Then, whenever the slider is moved and the flag is set to true, call cm.undo(); and reset the flag to false before updating the value in the editor. It's really hacky, but it should get you by until a real fix is pushed through.\n. Hold off on merging any of these. Seems the iPad I was using this morning was a bit out of date. Testing on a newer one now.\n. @marijnh These issues are fixed for iOS 6, but not for, IIRC, iOS 5. Want me to alter this pull request to fix the issues for iOS5 (and not break iOS6)? Or just let it die, since the issue is fixed in iOS6?\n. > One thing I've been considering is to add another kind of callback/handler for 'filtering' changes -- it'd be called with information about the change, and could return a replacement change if it wants to. Would that address your use case?\nYes, I believe that would work perfectly. I'm just looking to do a bit of cleaning up every time text is pasted (such as replacing em dashes with ---, en dashes with --, etc), which would be (un|re)done with the paste, so it would appear as a single change to the end user.\n. Exactly what I needed, thanks!\n. This snuck into our code; thought it was from CM. Apologies!\n. :+1: for beforeSelectionChange -- Would be useful in my project.\n. In measureLineInner(), getRect(pre) === getRect(display.lineDiv) in Firefox and Chrome, but they are not equal in IE. This seems to be one of the spots where things go wrong. I'll continue debugging to see if I can come up with anything else.\n. IE treats x<span> </span>x differently than x x when wrapping. <span> </span> turns into an empty text node that doesn't break the line. Replacing the space with - seems to fix the issue (but may not be the same width).\n. Changing the SPAN that contains only a space to white-space:normal; also fixes the issue, but I haven't been able to figure out how to do this in codemirror.js yet.\n. Okay, I solved the issue. I'll have a PR for it in a little bit.\nAlso, I hate IE.\n. After a bit of testing, my solution didn't work.\n- <wbr> doesn't work in IE8+\n- 'ZERO WIDTH SPACE' (U+200B) is assigned .cm-invalidchar class, which changes the width measurement\n- I also ran into an issue with the space being collapsed when the space was at the end of the line (don't remember which solution caused it).\nSorry for the spam on this issue, just trying to avoid you or anyone else having to do work I've already done.\n. Okay, I really found a fix this time. However, IE (at least the virtual machine provided by www.modern.ie) loads the page first (with the measurement) then adds the scrollbar, which causes the measurements to be different than the actual positions. Looking for a way around this, but should be rather straightforward.\n. @marijnh need a pull request? Or is the referenced commit good enough?\nAlso, there may be a better way to refresh the editor for IE after load, but that was the best I could find (see https://github.com/bfrohs/CodeMirror/commit/eec34400146d82ef5ca4a52fce2719f6032fa9fa#L1R77).\n. In case there was any doubt, this issue also affects IE10, so no ie_lt10 flag is necessary... yet.\n. > I've pushed a simplified patch, which also fixes a problem with your solution (try entering multiple spaces in a row with your patch).\nGood catch. However, your patch missed an edge case with a space being at the end of the line (it will be collapsed).\n\nThe load handler in your patch seems unrelated, and is not acceptable -- it'll leak the memory of every CodeMirror instance created by registering handlers on the window that close over them.\n\nIt is for when CodeMirror first loads, and IE doesn't yet have a scrollbar. It may only be a VM thing though. To reproduce:\n1. Change .CodeMirror-measure styles to make issue more visible:\n.CodeMirror-measure {\n     position: absolute;\n     width: 100%;\n     background:rgba(255, 255, 0, .5);\n     z-index:100;\n   }\n2. Change Active Line demo to contain the following text:\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas vestibulum, lacus vitae placerat pulvinar, massa nisl viverra lorem, eget gravida dui ipsum sit amet enim. Nam mi erat, rhoncus ac tincidunt sed, auctor non mauris. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Curabitur commodo venenatis nulla, ac condimentum risus pretium vitae. Aenean tincidunt felis vitae nulla consequat adipiscing. Maecenas id tellus non ipsum suscipit pulvinar. Quisque accumsan velit elit. Suspendisse malesuada felis id massa volutpat nec fermentum sem varius. Nulla et urna eget eros porttitor faucibus nec vitae arcu. Maecenas sollicitudin faucibus nisi, a pellentesque libero hendrerit non.\n3. Make the IE window tall enough to contain the title and entire editor, but not the entire page. (Adding a bunch of <br> elements to the bottom may help.\n4. Load Active Line demo.\n\nIf you don't see the issue, try resizing the browser window horizontally a few times (smaller) and reload the page. If you can't reproduce, we can just go with it being a bug in the VM I'm using.\n. @marijnh Yup, will do.\n. Okay, I remember why this was done now. It is a little bit like highlighting the body of every for loop as @peterflynn suggests, but the difference is Markdown has significant whitespace, unlike JavaScript (which you can use the match bracket feature to see what's included in the block). So:\n1. List item.\n    IS part of the list.\n...is different than:\n1. List item.\n   Is NOT part of the list.\nThe only way, with default CodeMirror styles, was to mark the entire list item as a string. The same applies to blockquotes (1 new line keeps the blockquote active, 2 new lines ends it). It isn't ideal, but it's the best way to prevent errors with list items (although we run into CSS issues when one style [string] overrides another [comment]).\nI believe the only way around this would be to add another class with background:rgba(...); to add a partially transparent background that wouldn't completely hide the selection, but would differentiate continued lists from non-continued lists (and probably comments as well). Would you be alright with something like this @marijnh? I know you have a policy of no mode-specific styles, so perhaps another style in the core styles for something like this? Preferably more than one, for cases where they can be nested (e.g. list in a list, or blockquote in a list). Something like this:\n.cm-s-default .cm-highlight {background: rgba(255, 0, 0, .3);}\n.cm-s-default .cm-highlight-2 {background: rgba(0, 255, 0, .3);}\n.cm-s-default .cm-highlight-3 {background: rgba(0, 0, 255, .3);}\n. I could do that. There would still be the issue of 1. List item [containing a link](www.codemirror.net) where there wouldn't be a style difference between \"List item\" and \"(www.codemirror.net)\" (since string is used for both).\n. Kay, I'll look into what's not being used and have a PR for you sometime between now and Monday.\n. @peterflynn Could you take a look at my patch in #1286 to make sure it solves your issues and doesn't introduce any bad behavior?\n. I've been meaning to rewrite Less mode to extend the CSS mode, but I haven't gotten around to it yet. (I think I have it partially done on my box at home.) I'll push this ahead of some other projects I'm working on though, but it still might be a while (I love to procrastinate).\nSo, if this isn't an easy fix, let me know, and I'll make it my top priority (but still working on at home, so it won't be immediate).\n. @marijnh agreed, that threw me for a loop when I first rewrote Markdown mode. I just never got around to rewriting the demo. I'll see if I can get to this in the next week or so.\n. @mattpass That's brilliant. Would be nice if the opening tag was included in the breadcrumb though (click on img tag for example).\n. It should be noted this behaves correctly in Firefox currently (but not Chrome).\n. It should be noted this behaves correctly in Firefox currently (but not Chrome).\n. I'll look into it.\n@velsa, do you have some code I can look at, just in case it's an issue with extending or if there's a better way to extend for your particular issue?\n. Oh, no, my apologies @velsa, turned out to be a crazy week for me. So, this shall be my weekend project :) If you don't hear from me by Monday, feel free to nudge--I've probably just forgotten to respond or send a pull request.\n. @velsa It looks like you're using outdated code. The particular issue you're talking about was fixed in 66fee2cc00a81db9eff5cddf816475fa25090311. Simply update to the latest code and you should be all set.\n. @velsa As for the text of the headers not being highlighted, that's a separate issue that wasn't possible to fix at the time of the mode being rewritten. I believe it is now possible to look ahead up to ~3 lines to style lines, but I'm not positive.\n. @lynschinzer Marijn doesn't do a normal merge for pull requests, so it's usually better to do any changes on a separate branch (rebased to use the latest code), submit the pull request, and merge the changes from this repo (rather than your personal branch). Then, force delete your branch that you submitted as a pull request. Not ideal, but it will help you keep your repo (and future pull requests) clean.\n. What exactly is it actually inserting?\n. Maybe try using double quotes instead? I have this working on my local repo, but I haven't updated it in a while, so it may be a regression.\n. @steverandy What browser and operating system?\n. Not sure if this is latest, but it's a good start: http://www.w3.org/TR/SVG/styling.html\n. Verified on Firefox 21 on Ubuntu 13.04.\n. @marijnh It looks like it's because it's expecting to see screen after @media (screen isn't required in CSS, but is in the mode). I should be able to get a fix for it submitted later tonight with some tests.\n. Indentation handling overall for CSS mode is extremely buggy. When I rewrote it last year, my focus was on fixing the highlighting---I didn't think about indentation much while I was doing it. I took a stab at it last week, and have a pretty good idea of how to fix it (rather than applying a hack to get it to work with this specific case). I'm hopefully going to add some tests for indentation so it can stay fixed (@marijnh - do any other modes do this? Point me in the right direction to get started?). \n. @peterflynn I should be able to throw in a quick fix for it while I work on a better implementation. I'll try to get to it asap this weekend. However, my air conditioning just broke and it's a lovely 85+ F in my apartment at the moment, so it may get delayed until later in the weekend.\n. @chriscoyier @peterflynn Could you two take a look at my patch and let me know if there's any big things I missed? (I didn't spend much time working on making invalid code indent correctly as that would require bigger changes that will be easier to do when rewriting indentation for the mode.)\n. @chriscoyier nope, it hasn't been merged anywhere AFAIK. I'm still seeing the issue on codemirror.net as well. Cache issue? Or wrong test? Some examples that are broken currently but fixed with that patch are below:\n@media screen and (max-width: 300px) {\n@media (max-width: 300px) {\n. Strange. Seems to highlight incorrectly on CodePen though (@media (max-width: 300px) {), so perhaps there's an addon interfering with indentation? (Minified source made it pretty difficult to debug.) In any case, my patch should at least fix the highlighting for those cases.\n. @peterflynn Good catch, I'll get it fixed up tonight.\n. @peterflynn Regression fixed and test added. Let me know if you notice anything else, thanks!\n. Hey @ParisK, just wanted to let you know that on GitHub, you can reference issues by typing # followed by either the issue number (e.g. #1678) or you can select it from a dropdown list by beginning to type the issue's title without spaces (e.g. type #clickingcodemirror and click the corresponding issue).\nAnd just so it gets pulled into this discussion: #1678.\n. Just to throw it out there (Marijn is on vacation, I believe, so it might be a bit before he can merge anyway), if you weren't aware, mode highlighting can be automatically tested with unit tests. For an example, check out Markdown tests and harness, or CSS tests and harness. These are great during development and help avoid regressions in the future :)\n(Marijn doesn't require them for modes that don't already have tests, but it's definitely a plus if they're included.)\n. Closing until I can fix the issue brought up in https://github.com/marijnh/CodeMirror/issues/1657#issuecomment-21455763 (which should be tonight).\n. url() regression fixed and rebased onto first commit (014cb84).\nAlso, while fixing that, I noticed a couple strange pieces of code that I fixed in a follow-up commit (0e30ab1). The first problem was a second variable was created to access the same thing as context. The second may just be personal preference, but I don't see any reason to use state.stack.length when n already has that value (and is several characters shorter). In any case, feel free to accept or throw out the second commit.\n. Just for reference, this line should have fixed this issue (per #1287).\n. @mattpass Yes, it should definitely be in 3.14 -- should have been in since 3.11 at least, possibly 3.1.\n. Isn't full screen mode already available here: http://codemirror.net/demo/fullscreen.html\nAnd if you want to avoid issues with relatively/absolutely positioned parents, why not use position:fixed; on .CodeMirror?\n. @marijnh Yeah, I'll take a look this weekend.\n. I can reproduce this on Ubuntu 13.04, Firefox 23. I only have the outline resize when resizing windows (so size/page doesn't update until I let go of the edge). To reproduce, I just dragged the bottom edge of the window up a few pixels at a time until the cursor appears on the wrong line. When I do this, Line 6 wraps for a split second, the following lines move down, and the cursor remains in the same spot (previous line). Then, Line 6 unwraps, the following lines move back up, and the cursor updates to where it was when Line 6 was wrapped. Calling editor.refresh() or typing updates the cursor position to where it should be. The character appears in the original position, so it's only the visual cursor div that's in the wrong place--the internal \"cursor\" remains in the correct position.\nSo, seems to me this is a race condition with the visual placement of the cursor div and the visual updating of the editor. Something like:\n1. Window resized\n2. Editor resizes (and wraps line 6) assuming scrollbar\n3. Cursor's visual position is calculated and saved\n4. Editor resizes (and unwraps line 6) due to no scrollbar\n5. Cursor div is moved to position from step 3\nThere should be a step between 4 and 5 that recalculates the scrollbar position before it's displayed, or a step 6 in which the cursor div is moved to the new position again (with the second saved position).\nOriginal position\n\nShows for split second (after resizing)\n\nFinal position\n\n. > I actually was able to reproduced it still in my example\nAs was I.\n. Works for me!\n. @marijnh Pull request submitted. And I don't mind the extra work at all, keeps things exciting :)\n. Gah, sorry about that. I was working on a new machine that I don't have configured yet and thought I'd be able to fix them manually before I sent it off to you. Looks like I missed a few. Will do for next time!\n. @jparmenter Yup, I got swamped with work (as usual) and forgot about it (also as usual). Just let me know if you have any questions! You can also reach me at bfrohs@gmail.com.\n. @brandonwamboldt Absolutely! Thanks for takin' this on. Just a couple changes needed (new tests are provided at bottom that test everything listed below):\n- Other formatting should not be discarded when between ~~ (eg, ~~**foo**~~ ~~foo~~)\n- Strikethrough should still work inside of other formatting (eg, **~~foo~~ bar** ~~foo~~ bar)\n- Tests should be minimal test cases (instead of sentences) - May just be a personal preference of mine\n- Strikethrough should span multiple lines (but not multiple paragraphs)\n~~foo\n  bar~~\n~~foo\nbar~~\nAs I said above, replacing the tests you have with the ones below should take care of everything above.\nThe best way I've found to implement stacked styles in CodeMirror (eg, ~~**foo**~~) is to have a flag on state for the particular formatting and then add it to styles[] in getType() (in markdown.js). For having it span multiple lines, simply turn off the flag in blankLine(). It's been awhile since I've touched this mode though, so it's possible you may have to take a different approach since it's the extended mode (rather than markdown.js itself). If you have any questions, just let me know!\n``` javascript\n  MT(\"strikethrough\",\n     \"[strikethrough ~~foo~~]\");\nMT(\"strikethroughWithStartingSpace\",\n     \"~~ foo~~\");\nMT(\"strikethroughWithEndingSpace\",\n     \"~~foo ~~\");\nMT(\"strikethroughOneLetter\",\n     \"[strikethrough ~~a~~]\");\nMT(\"strikethroughEm\",\n     \"[em&strikethrough ~~foo~~]\");\nMT(\"strikethroughEm\",\n     \"[em&strikethrough ~~foo~~]\");\nMT(\"strikethroughStrong\",\n     \"[em&strikethrough ~~foo~~]\");\nMT(\"strikethroughStrong\",\n     \"[em&strikethrough ~~foo~~]\");\nMT(\"strikethroughWrapped\",\n     \"[strikethrough ~~foo]\",\n     \"[strikethrough foo~~]\");\nMT(\"strikethroughParagraph\",\n     \"[strikethrough ~~foo]\",\n     \"\",\n     \"foo[strikethrough ~~]\");\n``\n. Also, defer to @marijnh on what he would like the strikethrough style to be named (if he wants it in the core at all).\n. @brandonwamboldt Did you need help with this? I'm open for any questions you might have :)\n. This actually couldn't be caught with unit tests; at least not mode unit tests. Markdown mode highlights lists perfectly, regardless of whether the have punctuation (the little bit of regex used is written carefully to avoid _inclusion_ lists, except in rare cases where only a small number of characters are allowed). The problem was thecontinuelistaddon assumedstate.listwas eithertrueorfalse, butnullis also allowed (and should be continued). Anyway, PR submitted that fixes this issue!\n. Are you asking to be able to style#in headers,*in em/strong,` in links, etc differently than the text they're affecting?\n. If it was done, it would be more like:\nhtml\n<span class=\"cm-em cm-indicator\">*</span><span class=\"cm-em\">text</span><span class=\"cm-em cm-indicator\">*</span>\nThat is, cm-indicator (maybe different name?) would be added to the current list of styles, rather than replace them.\n@marijnh How do you feel about this? Any objections?\n. Sounds good, I'll try to get to this in the next week or so.\n. Not yet, but I should have something by this weekend. I've actually already done something like this in my own fork, so it should go rather quickly once I'm able to work on it.\n. I have a good portion of this finished. Once I work out a few issues with GFM mode, I'll submit a PR. (Will hopefully get to tomorrow evening.)\n. @lukasoppermann Sorry about the delay, there just never seems to be enough time in the day. Anyway, I've finished and submitted #1986 with the changes. I took the liberty of deciding exactly what should be highlighted, but if you have a different view for what should be highlighted, let me know---may have just overlooked.\nThe basic idea I went with was if the characters don't add any additional information (eg, * doesn't because text is italicized), then I attached formatting. However, I left characters that do add information (eg, -, *, + for lists) as they were, since hiding them makes it harder to understand what was happening, rather than helping.\nTo test, simply set the highlightFormatting mode option to true:\njavascript\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n  mode: {\n    name: \"markdown\",\n    highlightFormatting: true\n  },\n  lineNumbers: true,\n  theme: \"default\",\n  extraKeys: {\"Enter\": \"newlineAndIndentContinueMarkdownList\"}\n});\nYou may also want to adjust the styles for .cm-formatting:\ncss\n.cm-s-default .cm-formatting {opacity:.5;}\n. Okay, I'll get that taken care of. I'll apply cm-formatting and cm-formatting-TYPE where TYPE is the type of formatting character (eg, cm-formatting-em). This will help to differentiate nested formatting. Sounds good?\n. No, traveling and plans for the Thanksgiving holiday gave me almost no time to work on this. But, I haven't forgotten about it, and should be getting to it this week.\n. @lukasoppermann I've pushed a new commit to #1986 that I believe makes all of the necessary changes. It isn't merged yet, but you can get the changes in a couple of ways in the meantime:\n1. Copy the raw file contents and paste them into your own files for markdown mode and gfm mode\n2. Check out the pull request locally\n. @lukasoppermann @davedawson @cben #1986 has been merged, so you can pull down the master branch to see the latest changes. If there's any bugs with the implementation, let me know (either in a new issue or here). If you want additional features, it would probably be better to put it in a new issue (easier to track when it's finished).\n. Oh, no, I don't think I did. Different for each list type, right? Could you open a new issue for that and ping me? Also, if you could close this issue, that would be awesome. Thanks!\n. I think I'm missing something, the following works fine as a list on the demo page:\n* foo\n* bar\n@lukasoppermann, could you provide a code example that isn't doing what you're expecting?\n. No, it shouldn't. While it is wrapped, that doesn't make it a new block. Instead, that would be converted to <p><strong> dfsasadfds </strong> * sdafdsf</p>. Even if you put two spaces at the end of line 20, it would only add <br>, not make it a list. To make it a list item, a blank line between them would be required.\nYou can confirm the behavior with dingus, the parser written by John Gruber (creator of Markdown).\n. Oo, good point, missed that one. I do believe you're right. On the go right now, but I should be able to verify and fix tonight. Will let you know!\n. Just wanted to update to let you know I haven't forgotten about this issue. Had something come up and couldn't get to it Friday. Have it planned for tonight.\n. @marijnh Yeah, I can take a look in the next few days (hopefully sooner). The problem came from me completely forgetting that indentation tracking was necessary in the mode (no idea why, silly me) and then a hack was applied that naively uses the state array to track indentation, which actually works quite well for most cases. But it falls apart in edge cases. I've been meaning to rewrite how indentation is handled (and have a pretty good idea of how to do it well), but haven't had time yet.\nAnyway, I'll get a fix in for this, then see about rewriting the indentation code. Will open a PR and ping @chriscoyier when I've got it written.\n. @chriscoyier Just submitted PR, could you take a look to make sure it's working as intended?\n. @chriscoyier Just wanted to update to say I've seen this. I was hoping to be able to get to it this weekend, but ran out of time (seems to be an ever-recurring problem, ha). Anyway, this issue is next on my list. Will try to get to in the next day or two. (And I have an interview with deviantART next week that, if I get the position, should give me a bit more time each week to work on a more permanent solution for the indentation issues---crossing my fingers!)\n. @marijnh What about if, upon an error, CodeMirror attempts to load the current data into the original textarea, deletes itself, and shows the textarea again? Then, no data will be lost if in the middle of a large edit.\nAnd you could add a \"reporter\" hook of some sort that sends the error to a callback (which could, for example, log it to a server)? And, if no reporter hook is present (default), it simply rethrows the error? I'm sure this is no small task, but would be extremely helpful to avoid losing data and for tracking errors (to fix them even if a visitor to your website triggers the error and doesn't tell you about it).\n. composer.json is PHP's package.json. (If only there was a cross-language standard, eh?) Packages are downloaded from https://packagist.org/ by default, but GitHub repos work as well. Here's the basic usage docs. I don't think you would have to register the package on Packagist; it isn't PHP afterall. But it may be useful for downloading the latest version quickly.\n. @tablatronix Why wouldn't you just use:\njson\n{\n    \"repositories\": [\n        {\n            \"type\": \"vcs\",\n            \"url\": \"git@github.com:codemirror/CodeMirror.git\"\n        }\n    ],\n    \"require\": {\n        \"codemirror/CodeMirror\": \"4.12.*\"\n    }\n}\n. What browser/OS? Which mode were you using? What steps are necessary to reproduce?\nCan you reproduce using one of the demos? If not, could you create an HTML document that reproduces the error?\n. @marijnh I'm good with it as-is, or after changes @cben / I mentioned. (I didn't try it out, but it looks right, and tests pass, so I'm going to assume it's working as intended.)\n. Found an issue with trailing # in headers not respecting the option and fixed, but other than that, this should be all set. (Feel free to change name of option/class if you can think of something better.)\n. Hold off on merging this, going to change it up a bit per comments in the issue.\n. @marijnh I updated the commit to include changes requested in #1919. Let me know if you need any changes before you'll merge.\n. Well, they already have cm-formatting-list. (I took your advice and added the formatting class for all markdown formatting spans.) However, there is no difference for unordered vs ordered lists. So, should * ul have:\nvariable-1 formatting formatting-list formatting-list-ul\nAnd 1. ol have:\nvariable-1 formatting formatting-list formatting-list-ol\n(I believe the only other similar markdown span is task lists, which already have different base classes that can be used to differentiate them, but if you notice any others, let me know.)\n. @davedawson Italics is cm-formatting-em (for <em>), bold is cm-formatting-strong (for <strong>), and all headers have their respective level (eg, cm-formatting-header cm-formatting-header1).\nI will add cm-formatting-(o|u)l as soon as I get a chance (at least by this weekend).\n@lukasoppermann I used your code on the demo page and it worked fine. Try inspecting the list item to see what classes are actually applied. It could be that your CSS for .cm-formatting-list is being overridden.\n. Hmm, yeah, that looks like a bug. Reported as #2040. Will look into it more, and fix, if necessary.\n. @marijnh It may be useful to send an ETag header from your server so clients always request headers to check for a newer version of files, even if they have a cached version. Then, they would only be sent the full file contents if it has changed. This means the cached file could be used indefinitely, until changed. Right now, the browser chooses how long to use the cache file (and there's no way to override it after it's cached). In an .htaccess file, you could do start sending ETag headers with one line of code:\nFileETag MTime Size\nAlternatively, you could send an Expires header to prevent browsers from arbitrarily choosing how long to store the cached file. However, leaving it as-is or only sending Expires could result in page errors if, for example, codemirror.js was cached before a particular mode's script, it the files were changed, and the user accessed the mode (loading the new version of codemirror.js, but the older, cached version of the mode's script).\n. See on() and events.\n. Which browser/OS are you using? Is it reproducible in one of the demos?\n. Yes, I do believe atom was from the original implementation (I tried to stick to the same names whenever possible, just rewrote to fix for tests that were written.) So setting it to quote would be fine. However, it's still useful to differentiate between quote levels, as seen here:\n```\nfoo\n\nfoo\nbar\n\nfoo\nbar\n\nfoo\n\nbar\nbaz\n```\n\n\nBut quote quote-# could be used instead, which would arguably be more useful and clean things up a bit (and maybe would only be added when highlightFormatting was turned on?). As for the link being applied to the link's text, that's bothered me for awhile (I think it was from the old implementation as well).\nI have the next few days off, so if you're both good with these changes, I'll get them taken care of.\n. @lukasoppermann I've made the requested change for blockquotes in this branch. Could you take a look and make sure this works for you? I'll go ahead and do something similar for lists if it does work for you.\nYou can copy and paste the raw markdown/markdown.js and markdown/test.js into your own files to see how they work, if you don't want to deal with pulling down the branch.\nLet me know how it works for you, thanks!\n. I will be adjusting list styles a bit, and maybe link too, but it won't help much when mixing modes. Do you need to know the different modes for all mixed modes (eg, html, css, and JavaScript) our just for markdown? If it's just markdown, I could build that in for the mode, but maybe it's better to do it for mixed modes overall? Maybe adding cm-mode-MODENAME?\n. It may be unicode input?\n. Reason it was written without the hyphen was due to <h1>, <h2>, etc. quote-3, on the other hand, is still a \"quote\", but the 3rd nesting level. That is, header2 is a different element from header1, not just a new nesting level.\nBut, that's just why I originally chose to go without the hyphen. I'm fine with it either way.\n. @marijnh You have previously said that you would not add them. However, you made an exception in #1672 for zoom (but not for user-select). I'm guessing this was due to the zoom hack for IE7 to get inline-block working, but not sure.\n. @marijnh Yeah, that's fine with me. I just went with what was already available, trying to change as little as possible. Or maybe have it be error for unrecognized properties and warning (or something else) for recognized, but not recommended properties.\n. Not today (busy hating Heartbleed right now), but I should be able to get to it by the weekend.\n. @lukasoppermann So very sorry about the delay on this! It completely slipped my mind. Just submitted a PR that fixes the issue. Check it out and let me know if you have any issues!\n. @lukasoppermann You're absolutely right. I noticed that too and thought there were tests forcing that behavior... but I just misread the tests. Don't see it taking too long to fix, so I'll look into it tonight or tomorrow night. If you don't hear anything by Friday, feel free to ping me as a reminder :)\n. @marijnh In terms of avoiding code duplication in GFM mode (em/strong logic), this is probably the cleanest route. But there may be some conflicts with tokens we don't want to stack (lists?). If you think there's a cleaner way to do this, just point me in the direction and I'll see what I can do.\n. Nice catch. I should be able to look into this later today.\n. Working on now. Looks like 1adf6180d0f0297ac314f87ff89d2de84cdc938a is what broke this. A test was included though, so I'll see if I can workaround the issue.\n. The original issue came up due to ea7397c17662607248a83f2769cfaea1100d2d8b. I knew that code was going to come back to bite me. PR submitted!\n. I'm testing out these changes right now and looking into the issues mentioned.\n. @marijnh inline-block elements (which .cm-tab is) don't inherit text-decoration by default, so it's getting discarded. Would you mind if .cm-tab { text-decoration: inherit; } was added to codemirror.css? Or would you prefer a more specific .cm-strikethrough .cm-tab { ... }?\n. @jparmenter You can test tabs with \\t in MT(). Eg:\njavascript\nMT(\"strikethroughTabs\",\n   \"~~foo\\tbar~~\");\n(But a test wouldn't have caught this particular issue, because the issue was with how CSS is inherited, not with the class not being applied. See my previous comment.)\n. > The following test fails though I can't find the problem with my code.\n\nMT(\"strikethroughWrapped\",\n    \"[strikethrough ~~foo]\",\n    \"[strikethrough  bar~~]\");\n\nThis test isn't failing for me. May have been fixed with the typo fix. Can you test it out again?\n. @jparmenter I've made comments where changes should/could be made. Let me know if you have any questions. (Good job btw!)\n. Ohhh, I didn't notice the leading space. I thought you were talking about the strikethroughWrapped test that was already in there. This particular issue is due to leading whitespace being intentionally skipped. You could try changing return null; to return getType(state); and see if it breaks anything. Or maybe do a non-consuming match on whitespace instead and keep return null;. But if both of those break previous tests, I wouldn't worry about it too much. Since the whitespace would be collapsed, it isn't a huge deal (we don't do strikethrough on the newline anyway).\n. > @bfrohs Could you maybe take a look at this?\nYeah, I'll try to take a look tonight.\n. > Git blame pins it on you, so would you maybe take a look?\nOh fun. Yeah, I'll take a look at this tonight!\n. It looks like this was broken in 662d71f91e2246cb190ed7dcd2d7bfad2cda076b, in order to fix #2962. However, since there weren't any tests for this particular case, it went without being noticed.\nI'm going to have to refamiliarize myself with the CommonMark spec in order to properly fix this. I can't dive into it tonight, but I'll try to get to it this week.\n. Alright, I think I've got a pretty good grasp of the CommonMark list indentation rules. I'm going to take the night to think about the right way to implement the change and try to get a PR in the next day or two.\n. Yeah, I should be able to get to this in the next 24-48 hours.\n. Sorry about the delay! I've looked into this and added a PR that fixes the issue. Had to adjust the overlay.js code to make it possible for gfm to communicate effectively with markdown (to freeze markdown's state while parsing links).\n. > This seems to be pulling the mode/overlay addon in the direction of the mode/multiplex one.\nYeah, I think you're right. I was thinking the multiplex addon relied more on the base mode being aware of the overlay mode.\n\nDo you, at a glance, know any compelling reason why the GFM mode shouldn't be implemented through hooks provided by the Markdown mode, the way the clike and sql dialects work?\n\nHmm, that might be an option. It would require a general token hook to work with URLs, SHAs, etc.\nIs it possible to extend modes defined in this way, though? That is, if gfm mode was defined using hooks instead, would someone else be able to come along and extend gfm mode, adding their own hooks? Or would they have to manually copy and paste the hooks into their own mode? If there's no way to extend, I think that would be a reason not to.\n\nA lot of its complexity seems to come from overlays just beeing a rather bad fit for such an interwoven set of modes.\n\nYeah, I agree. I can't remember what made me choose the overlay addon 4 years ago, but with how it functions currently, it just isn't a good fit. Hooks may be the way to go. I'll look into it and get back to you. Thanks for the direction!\n. I think so.\nImplementations seem to be torn on this (uncheck \"Normalize\" to see actual generated HTML), but the majority, including Gruber's markdown and commonmark.js, contain the <a> in a paragraph, which results in the browser closing the <a> before the </p>.\nGruber's markdown says \"block-level HTML elements \u2014 e.g. <div>, <table>, <pre>, <p>, etc. \u2014 must be separated from surrounding content by blank lines\". <a> is by default display: inline and historically could not wrap around display: block elements properly, but now it can be set to display: block. So, with <a> on it's own line separated by blank lines, one could infer that it is a block level element. But, I'd say it should just rely on the default, which is display: inline.\nThe CommonMark spec implies that it naively parses the HTML. That is, it will recognize open tags (and attributes), close tags, comments (<!--...-->), processing instructions (<?...?>), declarations (<!...>), and CDATA sections (<![CDATA[...]]>), and won't escape them (even non-existent tags, so long as they're valid syntax). But it says nothing about doing anything more, and the examples show opening tags without closing tags being enclosed in a paragraph. Although it doesn't have multiline examples (that I could find), I'd say that's evidence of what they intended.\nSo, I'd say inline HTML should be terminated by a blank line.. I was hoping to get to it, but didn't end up having a chance to. I'll still try to get to it when I have time, but I'm not sure when that will be, so someone else is free to pick this up. Next time I'm able to dive into the code, if no one has taken care of this yet, I will!. This line should not have a trailing comma. It's causing the [build]](https://travis-ci.org/#!/marijnh/CodeMirror/builds/2726045) to fail. There may be more issues--don't have time to look now though. It would be awesome if you could get these small issues out of the way before Marijn takes a look at it. (Each time you push a commit to the branch/pull request, another build will be tested, which takes about 30 seconds.)\n. text-overflow is part of CSS UI: http://dev.w3.org/csswg/css-ui/#text-overflow\n. text-size-adjust is part of CSS Mobile Text Size Adjustment: http://dev.w3.org/csswg/css-size-adjust/#text-size-adjust\n. It has pretty good prefixed supprt, but it's non-standard and no browsers support the non-prefixed version, so I'd personally prefer to keep this out (also see Marijn's comment on a similar issue).\n. Non-standard, and AFAIK, only supported by IE. IE8+ uses -ms-zoom, so the non-prefixed version is only supported by IE7-.\n. Could do < 6 ? match[0].length : 6; instead for one less unnecessary check. (But this isn't a huge deal by any means.)\n. Looks like you may have just taken the size provided as the max size and gone down from there. If that's the case, and you would prefer UA defaults:\n.cm-header1 { font-size: 2em; }\n.cm-header2 { font-size: 1.5em; }\n.cm-header3 { font-size: 1.17em; }\n.cm-header4 { font-size: 1em; }\n.cm-header5 { font-size: .83em; }\n.cm-header6 { font-size: .75em; }\n(Doesn't matter to me either way, just figured I'd provide if you wanted.)\n. strkethrough should be strikethrough. This solves all three issues mentioned.\n. You should be able to just do state.strikethrough = true; since it will always be ~. The reason the character is checked for state.em is due to _ and * both being valid (and the same one is required to close it).\n. Only need to check if state.strikethrough is true, so you can omit the === ch.\n. A cleaner approach may be to move stream.eat(ch) to this line:\njavascript\n      if (ch === '~' && stream.eat(ch)) {\n        if (state.strikethrough) {// Remove strikethrough\n          if (modeCfg.highlightFormatting) state.formatting = \"strikethrough\";\n          var t = getType(state);\n          state.strikethrough = false;\n          return t;\n        } else if (stream.match(/^[^\\s]/, false)) {// Add strikethrough\n          state.strikethrough = ch;\n          if (modeCfg.highlightFormatting) state.formatting = \"strikethrough\";\n          return getType(state);\n        }\n      }\n. Could you move this to the previous line to match the rest of the file?\n. I think you mean stream.backUp(2);. foo ~~bar~~ doesn't currently highlight as strikethrough. (Could you add a test, too?)\n. markdown\nfoo ~~bar~~~ hello\n...should come through as:\n\nfoo ~~bar~~~ hello\n\nCurrently, it's coming through as:\n\nfoo ~~bar~~~ hello\n. \n",
    "michelemostarda": "For the class I will have a look ASAP (couple of days will provide a feedback).\nFor the license it's ok the default one.\nThanks for your work!\n. I had a look to the logic, unfortunately I used the token classes also to model the AST used for the auto completion, so\nchanging that would impact on the entire code base. \nFor what concerns colors I have no preferences (I even don't like the ones I randomly choose), so feel free to suggest/change to better ones.\nMic\n. ",
    "niekkouwenberg": "I can't reproduce this problem on Firefox 3.5.19, nor on later versions (like Firefox 6.0.2).\nFor which mode (code language) does this problem occur, does it always occur, and have you tested this with a standard installation of the latest code mirror version?\n. Although fixed for HTML Mixed mode, in PHP mode, it still highlights the /script> part incorrectly.\n. ",
    "dyoo": "\nFor which mode (code language) does this problem occur, does it always occur, and have you tested this with a standard installation of the latest code mirror version?\n\nI ran across the highlighting bug in 2.13, using Firefox 3.5, across\ndifferent language modules (Haskell and JavaScript, for example).\nI've also tried this on the language examples on the main page, like\nhttp://codemirror.net/mode/haskell/index.html, with identical results.\nI can verify that I see this buggy behavior in Firefox 3.6.22, but I\ndon't observe it in Firefox 6.0.2.\n. Gah; meant to say \"comma\", not \"colon\".\n. On Wed, Jan 30, 2013 at 7:52 AM, Marijn Haverbeke\nnotifications@github.comwrote:\n\nCan you describe how I can reproduce this? If I create an editor and\nimmediately call .focus() on it in IE8 I'm not getting this error.\n\nHmmm... I'm not sure why my context is different.  I'm doing the same in\nWeScheme, but haven't been able to disentangle a nice test case to expose\nthe error yet.\ntry/catch might be a perfectly fine workaround -- with bogus IE errors,\n\nit's often the only sane solution.\nOk.\n. \n",
    "TimNZ": "Other observations:\n- Doesn't happen in IE7 mode\n- IE8 mode - scrollbar appears/disappears as above - but is alway grayed out/disabled\n- IE9 mode - shifting scrollbar size\n. Closed by mistake.\n. ",
    "soliton4": "seems to work fine in the development version i downloaded yesterday. does this mean there is someone working on that ;-)\nor is it just coincidence\n. no i did not. my chrome version is 14.0.835.202 m\nyou should be able to reproduce it with this version. it used to ocur on the codemirror.net website on the demo pages. since yesterday it did not ocur anymore so i downloaded the last developer version and now my programm runs fine in chrome 14.\nthe version i used before was 2.1.15\nlet me know if i can be of any help\n. i can not reproduce it anymore either. but be asured it was there. i also reported the bug to the chromium team. maybe they fixed it.\nand you were right assuming a chrome update happened. not to 15 but to the next step version as described above. the bug definetly appeard with 2.1.15 and chrome: 14.0.835.163 m\nsorry for any trouble.\nthx \nmatthias\n. thanks for the info, but i am almost certain with early 2.x versions it was\nworking correctly.\ni am not to sure about how you handle copy and paste, am i right to assume\nthe marked content is in the textarea and marked, so that when you press\nctrl+c it is copying correctly?\nthe copy seems to work fine.\npaste works the other way arround?\nwhen i copy a line from notepad++ i get the bug.\nmaybe you could do a workarround on webkit: i just tested what happens when\nyou indeed insert a line with a extra . codemirror makes 2  so you could change the behaviour in webkit.\nand unfortunately i dont know any webkit developers\nmatthias\nOn Mon, Jun 25, 2012 at 8:32 PM, Marijn Haverbeke <\nreply@reply.github.com\n\nwrote:\nThis is a duplicate of #747 which, unfortunately, is a Webkit bug, and not\nsomething I can fix on the side of CodeMirror. If you know any Webkit devs,\nfeel free to point their attention towards this bug.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/598#issuecomment-6555759\n. cool ;-)\ni am using codemirror with dojo and made a widget that makes it easy to use\ncm in dojo environment.\nwould you by any chance interested in that code?\n\nOn Wed, Jun 27, 2012 at 11:34 AM, Marijn Haverbeke <\nreply@reply.github.com\n\nwrote:\nUpdate: there's a webkit patch that will hopefully make it into master\nsoon. https://bugs.webkit.org/show_bug.cgi?id=49288\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/598#issuecomment-6598878\n. i think happens when you create the widgets while the codemirror node is not yet part of the dom\n. nope\nam i supposed to?\n. thx ;)\n. i made a script that generates my own amd loadable sourcecode. so im fine. \nits more a suggestion for makeing CodeMirror more flexible and fit for the future.\n. @marijnh cool!\nso how does this work? i mean the branch stuff. will it allways include the latest features / fixes of v3? can i go productive with it?\ni must admit i am zero familiar with the git hub branch implementation. i am thankful for pointers.\n. this file crashed\nhttps://github.com/soliton4/nodeMirror/blob/master/src/modules/directory/style.less\nit happened when i added line 41\n.dgrid-row {\n    .javascript, .json {\n...\n\nif that does not help you i will go deeper and reproduce that error for you \n. sorry the file grew and now it passes.\nbut i can reproduce the bug using this file:\nhttps://github.com/soliton4/nodeMirror/blob/master/src/test/test2.less\n. its generaly a good idea to keep a fallback in the mode code for when a string isnt fitting any condition.\nnever assume a string is not empty or not undefined.\n. closing this issue makes it look like you are not open for arguments since you already got an opinion.\nif thats not the case pls continue reading\ni totally see your point. could you at least compromise. why not create an alert for mode errors. this will keep ppl anoyed enough to report a bug but at least the software is still useable.\nif nothing changes i have to make some try catch myself to keep nodeMirror from becoming useless and the bugs may not get reported after all.\n. @marijnh do you have a max line length recommendation?\n. hold on i am getting to this.\nabout runMode: i have no experience with it.\ni can not simply cut out one line and treat it like valid javascript. i would need the exact state of the line. but you mentioned something like that.\ni need the left bar included as well and it would be cool if also search results were visible.\nand there is some nasty behaviour that i also see with open dialogs. the cursor can be hidden under the dlg / floating code lines.\nany thoughts on that?\ni am still willing to do the implementation but i need some serious starters here.\n. it does not depend on the feature demo.\ni can reproduce it with the npm or github version of nodeMirror\nor just check the latest codemirror version in your app of choice\n. ups i was wrong. with the actual version it does not happen. could it be my feature code after all?\n. ups wrong again? i am not able to reproduce it anyhow now.\nvery strange\n. nvrmind ;(\n. @mebersole could you pls provide a more precise description and try to reproduce it on the cm hp?\n@marijnh \nhttps://github.com/soliton4/CodeMirror/tree/e81052f8c8499dcf2d51851777082859108b046b\nthis is the version im using.\nim still stuck with the floating codelines. can we have a hangout or chat about it one day? would be more productive i think.\n. @mebersole cm hp\ncodemirror homepage\njavascript conference?\n. there is a mailing list?\n. i cant think of a way to fix it that will be compatible to the current behaviour.\nwould it be a problem to deliver jshint and the other hint modules within codemirror.\nthat would be the easiest solution.\n. so we are on the same page - good ;)\nthere is still the question what module path we should assume the user is using for jshint. or can we make it configurable?\nif we make the module path configurable, why not just add a lint configuation option.\n. ps: alternatively we could just ship jshint with codemirror. that would solve all problems. what do you think?\n. k i will make a pr\n. well then this file:\nhttps://github.com/marijnh/CodeMirror/blob/master/mode/javascript/index.html\nhas syntax errors in it. hasnt it?\n. i learned something today ;)\n. i used the codemirror 4.1 version that is offered for download.\nthe thought was that it may be more stable then the master in github.\nso thats not a good idea?\ndo i need to advance completely to the new head?\n. seems to work so far.\nbut im a little bit frightened\n. ",
    "soniciq": "Oh no, that is going to be slow. I suppose I'll have to count up the number of newlines before where I want the selection to start and end and calculate on that. I don't suppose there are and internal optimisations that would help with this?\n. Thanks, I didn't realise that indexOf takes a start position, that helps. So I guess I'll just have to call getValue to return the entire text string, and then loop while the indexOf is less than my desired position. Is getValue relatively quick as a lot of this needs to happen in real time as the user types?\nOne more quick question if you don't mind... does CodeMirror always use \"\\n\" or will IE be spitting out \"\\r\\n\" as that could throw a spanner in the works.\n. Hi Marijn,\nI discovered a nice way of doing this so I will be making a pull request shortly to include a \"coordsFromIndex\" method.\nThe method I'm using is pretty fast as it doesn't do any string matching. The function basically loops through the strings in the lines array until the total of their lengths so far exceeds the index we are interested in, then it can easily calculate a {line, ch} object. The 'line' comes from which line it's got to in the loop and 'ch' is calculated by subtracting the total chars in previous lines from the index we want. The function also takes into account '\\r\\n' in IE although I personally think it would be best to stick to \"\\n\" at all times.\nI have added the method, written some tests for it and updated manual.html with the new method. Pull request on it's way.\nThanks for your pointers on this.\n. Pull request here for reference should anyone come across this ticket: https://github.com/marijnh/CodeMirror2/pull/203\n. I've updated coordsFromIndex so that it clips the returned object rather than returning null to make it consistent with the existing API.\nAlso, I noticed that getValue always returns a string joined on \"\\n\" regardless of IE's \"\\r\\n\" which is good, so coordsFromIndex now also assumes just newlines.\nI've found the ability go convert to and from indexes missing from most javascript editors and it's quite a common requirement, so this small method aims to fix that in quite an efficient way.\n. @marijnh In my use case I'm not calling getValue before getting the {line, ch}... it's complicated but I'm basically managing my own string data (it's actually a fake DOM tree... don't ask), I can then get an index for a given fake DOM node that then needs to be converted to update the editor text editor caret/range.\nThanks for your help on this, and for merging it in.\n. ",
    "basarat": "Updated link to PR : https://github.com/codemirror/CodeMirror/pull/203 (previous link 404ed)\n. The repro is a bit more complicated than just that. So let me investigate further.\n. > The repro is a bit more complicated than just that.\nBasically I have two code mirror instances:\n- One with line count > 100. \n- Other with under 10 lines. \nIn this case updateGutterSpace src calculates the width for the gutter for the second CM to be 0. \njs\n  function updateGutterSpace(cm) {\n    var width = cm.display.gutters.offsetWidth;\n    cm.display.sizer.style.marginLeft = width + \"px\";     // width is 0\n  }\nChanging it to something like the following does fix it: \njs\n  function updateGutterSpace(cm) {\n    setTimeout(function(){\n        var width = cm.display.gutters.offsetWidth;\n        cm.display.sizer.style.marginLeft = width + \"px\";\n    },100);\n  }\nBasically updateGutterSpace is being called without the instance being given time to properly render. Any help would be appreciated :rose: \n. > like the following does fix it:\nHowever delay calculating messes it up for the first tab: \n\nIs there a refresh code path to recalculate gutter widths?\n. > Is there a refresh code path to recalculate gutter widths?\nFound it : https://codemirror.net/doc/manual.html#refresh \nI was calling it on window resize ... but not on focus. Fixed. Thanks for an awesome project! :rose: \nIssue can be close for sure.\n. > This is not the only binding in sublime.js that doesn't have a name, and there is already a command toggleComment, defined in addon/comment/comment.js\nThis PR has toggleCodeComment which is different from toggleComment comment/comment.js. Neverthless I can rename if further if you want, or we can leave this closed :rose:\n\nThis is not the only binding in sublime.js that doesn't have a name,\n\nI searched map[ in https://github.com/basarat/CodeMirror/blob/1231ce03db3cef8d014fad9fc4b64daab96dd9d1/keymap/sublime.js but all instances other than this one point to strings e.g. map[\"Shift-\" + ctrl + \"[\"] = \"fold\"; or  cmds[map[ctrl + \"F3\"] = \"findUnder\"] = function(cm) { findAndGoTo(cm, true); };.  Am I mistaken? :rose:\n. Thanks :rose: :100: \n. > Could it be that your mouse is so sensitive that the desktop vibrations caused by hitting the arrow keys cause it to move?\nNo, because it only happens on first to last or last to first transition. Also the patch looks empty \ud83c\udf39 \nThanks for this project \ud83c\udf39\n. @marijnh I applied the patch locally and its made it worse in that it doesn't work if I use a custom render function:\n\nAnd for the simple one it is still broken. I noticed it also jumps if you cause any form of scroll to happen on the autocomplete (e.g. moving an item before the first item shown using up arrow):\n\nThanks :rose:\n. > I've reverted the whole behavior for now\nThank you :rose:\n\nseems to be caused by the fact your pointer is hovering over the hint pane when it scrolls, which is triggering a mouse-move event (as the window is moving behind the static pointer)\n\nYup :rose:\n. I updated to 5.13.4 and as the reversion commit is there : https://github.com/codemirror/CodeMirror/commit/06e83fd66ebe639038eb64013891a1535ed07f25 I'm fine without this being fixed. Leave it to you guys to close | keep open :rose: \n. Thanks for your review :rose:\n\nWhat if you add some sanity-checking to your mode so that it doesn't output any styling when the tokens in the stream don't match the tokens in its token list?\n\nI explored this option but consider the following file: \n1: aaa\n// ... some 300 lines \n301: aaa\nNow if the editor jumps to 301 (or something similar) I still might think that its valid aaa if line 1 is being passed in. Basically file contents can repeat on different lines and I can't sanely check that from the grammar \n\nMaking it so that the editor doesn't highlight at all if it couldn't get a precise state would be possible, but that'd be somewhat invasive, since it'd require a bunch of code to know about this special state that highlighting can happen in\n\nI understand. Feel free to close. I just wanted this to be known issue and see if there was perhaps a quick win :rose:\n. @marijnh its okay if you never implement this. I did the sanity checks on my side (https://github.com/alm-tools/alm/blob/c5834a2080a942340b3e51161a947cd3f019e139/src/app/codemirror/mode/classifierCache.ts#L38-L51) and it seems to work fine in real world testing :rose: \n. I should have read the docs closer. There is document.beforeChange : https://codemirror.net/doc/manual.html#event_doc_beforeChange \nHowever its not called on parent linked docs. change gets called on the root doc with shared history which makes server side syncing easy for me : code. Nevertheless its an engineering problem for me now :rose: \n. Found a way to get the behavior I want and updated the alm.tools for TypeScript docs : https://github.com/alm-tools/alm/blob/master/docs/contributing/SYNTAX.md#keeping-the-classifiercache-in-sync so no pending concerns from me :rose:\n. ",
    "urmuzov": "Can you, please, one more time look at this\nhttps://github.com/urmuzov/closure-externs/blob/master/codemirror.js#L129\nand this line\nhttps://github.com/urmuzov/closure-externs/blob/master/codemirror.js#L143\nwhat type is lineHandle? \n. Ok, thanks!\n. I can't find any info about addGutterMarker and removeGutterMarker here http://codemirror.net/manual.html This manual is not actual?\n. Ok! Now it looks like:\n/**\n * Clears a marker created with <code>setMarker</code>. <code>line</code> can be either a number or a handle returned\n * by <code>setMarker</code> (since a number may now refer to a different line if something was added or deleted).\n * @param {(number|CodeMirrorLineHandle)} line\n */\nCodeMirrorObj.prototype.clearMarker = function(line){};\nAnd it can take number or lineHandle.\n. ",
    "hennk": "Hi,\nI just extracted the liquid mode we created for our template editor at https://github.com/axtro/codemirror_liquid_mode. It contains a pure liquid mode, and another overlay mode based on htmlmixed.\nIt also includes code to make the formatting module of CodeMirror2 compatible with the htmlmixedliquid mode, and another extension to comment/decomment liquid code.\nYou will see that the parser inserts some autocomplete information into the generated tokens. We use this information in our editor to provide intelligent autocompletion based on the type of the next expected token.\nCheers,\nHenning\n. ",
    "dcneiner": "Sorry to waste your time \u2013\u00a0it was IE8 mode in IE9 that I was testing. I will close the issue as it does work correctly in IE 8. Thank you!\n. ",
    "miketaylr": "Happy to send along a pull request, but is there any valid reason for wanting sel.multiple = true in this case?\n. ",
    "usualoma": "Many thanks!!\nI tried added patch (5af5292b865384d8dd47b6a5b65d6f629130ccd0). This patch reduce the problems a bit. But the Firefox(7.0.1) and the Opera(11.52) fire the \"input\" event after the characters are composed. So, still will not be reflected interactively. (I want to reflect interactively.)\nI think polling is quite expensive, too. But, as far as I know, polling is the only way to detect the update for textarea element while using IME. (We can detect the update for div element that has \"contenteditable=true\" by the \"DOMCharacterDataModified\" event.)\nThe Firefox and the Opera return the key code below for first keystroke.\n- Firefox@Windows : 229\n- Opera@Windows   : 197\n- Firefox@Mac     : The key code of the pressed key\n- Opera@Mac       : The \"keydown\" event is fired each keystroke (work correctly)\n- Firefox@Linux   : Any event is not fired untill composed.\n- Opera@Linux     : Any event is not fired untill composed.\nBased on these results, I created the other commit.\nhttps://github.com/movabletype/CodeMirror2/commit/7841c948c20f4428c90a3fe499eedb3549779eea\nIn this commit, trying to detect by polling only if the conditions are matched.\nThe results of for each commits:\nFirefox @ Windows\n| Seq | Keyboard input | \"keydown\" | \"keypress\" | \"keyup\" | \"input\" | case1 | case2 | case3 | case4 |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| 1 | a | 229 (1) |  |  |  | \u3042 | \u3042 | \u3042 | \u3042 |\n| 2 | i |  |  |  |  | \u3042 | \u3042 | \u3042\u3044 | \u3042\u3044 |\n| 3 | u |  |  |  |  | \u3042 | \u3042 | \u3042\u3044\u3046 | \u3042\u3044\u3046 |\n| 4 | Enter |  |  | 13 | fired | \u3042 | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 |\n| 5 | (a few sec) |  |  |  |  | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 |\n- (1) : keyCode\n- case1: be8e768c797dd6def57d5b573e1ee28597beacee\n- case2: 5af5292b865384d8dd47b6a5b65d6f629130ccd0\n- case3: afbb3f1df95ba1d7a9d1c9867847aa93dd203a15\n- case4: 7841c948c20f4428c90a3fe499eedb3549779eea\nOpera @ Windows\n| Seq | Keyboard input | \"keydown\" | \"keypress\" | \"keyup\" | \"input\" | case1 | case2 | case3 | case4 |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| 1 | a | 197 |  |  |  | \u3042 | \u3042 | \u3042 | \u3042 |\n| 2 | i |  |  |  |  | \u3042 | \u3042 | \u3042\u3044 | \u3042\u3044 |\n| 3 | u |  |  |  |  | \u3042 | \u3042 | \u3042\u3044\u3046 | \u3042\u3044\u3046 |\n| 4 | Enter |  |  |  | fired | \u3042 | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 |\n| 5 | (a few sec) |  |  |  |  | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 |\nFirefox @ Mac\n| Seq | Keyboard input | \"keydown\" | \"keypress\" | \"keyup\" | \"input\" | case1 | case2 | case3 | case4 |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| 1 | a | 65 |  |  |  | \u3042 | \u3042 | \u3042 | \u3042 |\n| 2 | i |  |  |  |  | \u3042 | \u3042 | \u3042\u3044 | \u3042\u3044 |\n| 3 | u |  |  |  |  | \u3042 | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 |\n| 4 | Enter |  |  | 13(2) | fired | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 |\n- (2) : Updated (2011/10/31)\nOpera @ Mac\n| Seq | Keyboard input | \"keydown\" | \"keypress\" | \"keyup\" | \"input\" | case1 | case2 | case3 | case4 |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| 1 | a | 65 |  | 65 |  | \u3042 | \u3042 | \u3042 | \u3042 |\n| 2 | i | 73 |  | 73 |  | \u3042\u3044 | \u3042\u3044 | \u3042\u3044 | \u3042\u3044 |\n| 3 | u | 85 |  | 85 |  | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 |\n| 4 | Enter |  |  |  | fired | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 |\nFirefox @ Linux\n| Seq | Keyboard input | \"keydown\" | \"keypress\" | \"keyup\" | \"input\" | case1 | case2 | case3 | case4 |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| 1 | a |  |  |  |  |  |  |  | \u3042 |\n| 2 | i |  |  |  |  |  |  |  | \u3042\u3044 |\n| 3 | u |  |  |  |  |  |  |  | \u3042\u3044\u3046 |\n| 4 | Enter |  |  |  | fired |  | \u3042\u3044\u3046 |  | \u3042\u3044\u3046 |\n| 5 | (a few sec) |  |  |  |  | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 |\nOpera @ Linux\n| Seq | Keyboard input | \"keydown\" | \"keypress\" | \"keyup\" | \"input\" | case1 | case2 | case3 | case4 |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| 1 | a |  |  |  |  |  |  |  | \u3042 |\n| 2 | i |  |  |  |  |  |  |  | \u3042\u3044 |\n| 3 | u |  |  |  |  |  |  |  | \u3042\u3044\u3046 |\n| 4 | Enter | 1254, 1256, 1258 | 1254, 1256, 1258 | 1254, 1256, 1258 | fired 3 times | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 | \u3042\u3044\u3046 |\n. Thanks.\nI found a strange results for the Opera at Windows.\nOpera @ Windows  (more sequence)\n| Seq | Keyboard input | \"keydown\" | \"keypress\" | \"keyup\" | \"input\" |\n| --- | --- | --- | --- | --- | --- |\n| 1 | a | 197 |  |  |  |\n| 2 | i |  |  |  |  |\n| 3 | u |  |  |  |  |\n| 4 | Enter |  |  |  | fired |\n| 5 | a | (not fired) |  |  |  |\n| 6 | i |  |  |  |  |\n| 7 | u |  |  |  |  |\n| 8 | Enter |  |  |  | fired |\n| 9 | Enter | 13 | 13 | 13 | fired |\nAnd I updated the table in my previous comment. (for Firefox @ Mac)\nFrom these results\n\nI think that it is better to stop polling with a short interval by 'keyup' event instead of 'input' event.\nIf CodeMirror will stop polling when there is no change for some seconds, I wish to specify the number of seconds by options or I wish to disable that feature by options.\n\nPatch\nPlease review this patch.\nhttps://gist.github.com/3cfb19345895223d8c92\n. I've replied on the gist.\n. Thanks for your comment.\nI have revised the patch.\nhttps://gist.github.com/3cfb19345895223d8c92\nIf satisfactory with this patch, after testing, I will send pull request again.\n. Many thanks!!!\nI confirmed that the CodeMirror2 works interactively by that commit useing IME.\n. Sorry for the late reply.\nI had tried this branch https://github.com/marijnh/CodeMirror2/tree/keymap .\nThis version almost works as expected even when IME is ON.\nHowever, when I tryed the following operations, it did not work correctly.\nSteps\n\nPress 'A'  for 1 second. \nPress 'Backspase' for 1 second.\n\nScreencast\nhttp://screencast.com/t/yV3bHNCVZWZ\n. Thanks.\nI tryed in newest version. I am a Japanese and use IME for Japanese usually.\nMy environments\n\nWindows: Microsoft IME\nMac: Google IME  or  Kotoeri\nLinux: Anthy\n\nThat problem was reproduced in all these environments. And not reproduced when IME is Off.\nIn Chinese, reproduced in the following environment.\nChinese environment\n\nWindows: Microsoft Pinyin ABC input style http://gyazo.com/57d9860659f960b1176c8b72975264f3\n. \n",
    "redcocker": "P.S. When using CodeMirror 2.1.1 or older, this problem doesn't occur.\n. ",
    "Suor": "May be it is possible to create a hidden textarea with full text, and then track selection in it created by in-browser built-in find?\n. This should work now, thanks for the tip.\n. It is based on markdown kind of htmlmixed based on xml mode - no code duplication.\nAnd I feel it is cleaner this way. It also makes name for a mode naturally.\n. ",
    "josephrocca": "In case others get to this page via google, looks like this is the best way to do this at the moment: http://codemirror.net/2/demo/search.html. Sorry! I really should have read the first sentence of that guide a bit better. Thanks for the amazing lib.. Thanks, marijnh!. ",
    "Venryx": "Is there an option letting you turn off the partial-render? I care more about being able to search the entire document than performance.. Never mind, found it on the Manual page:\n\"viewportMargin: integer\nSpecifies the amount of lines that are rendered above and below the part of the document that's currently scrolled into view. This affects the amount of updates needed when scrolling, and the amount of work that such an update does. You should usually leave it at its default, 10. Can be set to Infinity to make sure the whole document is always rendered, and thus the browser's text search works on it. This will have bad effects on performance of big documents.\". ",
    "saschpe": "Thanks, I'll give it a go. Other topic, are you interested in RPM-related modes? Like for spec, changes and prjconf files?\n. Err yes, we heavily use it in the Open Build Service (e.g. https://build.opensuse.org/package/view_file/openSUSE:Factory/bash/bash.spec?expand=1)\n. And IFIRC, I contributed quite some bits not too long ago :-)\n. ",
    "Page-": "Cheers, I must have messed up copying it into the branch for a pull request, thanks for fixing it :)\n. Well I was using chrome when this happened and I can't seem to reproduce it any more with changes I have made to the completion gathering since yesterday so it seems likely that was the issue, thanks for the help.\n. Yea, I tried to keep to your indentation style but I normally use hard tabs so I may have had one slip in by accident.  Wasn't quite sure what to do with expanding single line to multi-line and the sort.\nLooks like it should be fine otherwise though, the check is slightly different but I think it should still be ok.  Thanks for merging.\n. The other benefit is also that the pure CSS mode will only parse CSS, rather than highlighting less code that somehow gets into a css file (shouldn't really be done, but if you're writing CSS you don't expect mistakes to also be highlighted), that's just my thought anyway (maybe an option to disable LESS highlighting for when it's purely CSS?).\n. Ok, so I'm a bit late to the party here, however I have the issue that I want to be able to suggest autocompletions for an empty token as I know the set of possibilities that are available (and the user won't necessarily know in order to start the first character).\nJust removing this check would fix the issue for me, however as it's clearly desirable for some people I have three solutions that come to mind initially:\n1 - Put the whitespace only check behind a config option by changing the function signature to function(editor, getHints, options)\n2 - Add the option to specify custom behaviour for certain keys (such as backspace) so that behaviour can be specified that way.\n3 - Remove the check and instead have the hint gatherer return an empty list when the token is empty and for the case of backspacing out of the current token have the hint helper check that the token is the same as when the dialog was opened (possibly behind an option also for people who want to be able to backspace to a previous token and have the autocomplete remain)\nI'd like to know your thoughts before I start working on a patch, so as to use the preferred solution :)\n. It's no problem, it's great to have such a quick response though :)\n. You are right that it always starts from the beginning of the document, to do this we currently pass in the editor instance to the mode so that getValue can be called (I think there are better ways to do this in v3 but I only recently had a chance to update and haven't checked this out).\nThe \"analysis\" is just parsing with an OMeta grammar (a type of PEG), with the tokens matching rule names, useful for us as it means that we can write the parser once and have highlighting/autocompletion work with minimal effort based upon the parser (normally just marking that a rule should be highlighted and adding the CSS).  As for rehighlighting from the middle, it's not an issue for our use case as each line is a whole statement (albeit potentially dependant on previous lines), so we can pick up highlighting at any given line and just reuse memoisations from previous passes for performance (which has just made me realise that I can probably use that in order to take away a lot of the front-loading)\nIf you're interested you can see it in action here: http://www.sbvr.co/#3E3tU3\n. The reason I assign the new box object here is so that behaviour is consistent for the returned value, so it will only ever contain top/left values, rather than sometimes the full set and sometimes just top/left.\n. ",
    "jots": "excellent!  looking forward to it. i don't know why, but little things like that make the editing experience so much better.  Hoping to try out your keymap version tonight.\n. Thank you Marijn!\n. ",
    "CyberShadow": "OK, I'll report a bug.\n. OK. For your reference, the reported bug is DSK-350473.\n. No, but if you watch the snapshot changelogs, they mention the bug IDs. Not sure how that works with duplicates, though.\n. ",
    "lilydjwg": "Just now I'm annoyed by this one just time :-(\n. Instead of patching Firefox, I guess an extension may work.\n. @frabjous it's a big textarea, with all normal features like GTK editing keys available. The colorful text is laid under it.\nIt doesn't support multiple selections however.. I'm annoyed by Jupyter not supporting middle-click paste just yesterday....There is no way to copy a value from output to the input without this feature when I've mapped Ctrl-C to interrupt the kernel instead.. Here's one:\nhtml\n<!DOCTYPE html>\n<html>\n<meta charset=\"utf-8\" />\n<title>Test paste events</title>\n<body>\n</body>\n<script type=\"text/javascript\">\n<!--\n  document.onpaste = function(e) {\n    const p = document.createElement('p')\n    p.textContent = \"You've pasted something of types \" + e.clipboardData.types\n    document.body.appendChild(p)\n  }\n//-->\n</script>\n</html>\nSee it live.\nThis page shows when something is pasted. Middle-button pastes work in Google Chrome but not Firefox.. ",
    "adrianheine": "Pasting from X11 clipboard doesn't work for me either in CodeMirror in FF. That's #931.\n. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It's highly unlikely that we pick up this issue for CodeMirror 5, though.. @marijnh: The target is the current line content in Safari.\nI'm on 3c239efdbe29f1a7d332f16b0b52691548e080ec; throw scrolling works in Chrome 23 on Mac OS X (but I guess you knew that already), just not in Safari (I got 5.1.2).\nI reproduced the steps @njx went and the result actually looked quite ok to me: 33fe8230aad6c55f95bc6c094a0dc02d8c9a35fb. What I further learnt, is that I can mess with the original event target, as long as I don't move it out of cm.display.scroller (div.CodeMirror > div.CodeMirror-scroll). Thus I moved the line DOM element with the original target to the scroller and hid it and clean them up from time to time: b25701f50b831d5fcc69faf2d8a7e0ffee830a8f.\n. It works with 08a9a3445b0b374d3f1584a183b2dd96c9f8abc4 applied :)\n. Works great. I'm really glad I could help.\n. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It's highly unlikely that we pick up this issue for CodeMirror 5, though.. Also happening in Epiphany 3.22.0 with Webkit 2.14.0. Edit: \u2026 because it announces its vendor as \"Apple Computer, Inc.\". Stupid thing.\n. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It's highly unlikely that we pick up this issue for CodeMirror 5, though.. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It's highly unlikely that we pick up this issue for CodeMirror 5, though.. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It's highly unlikely that we pick up this issue for CodeMirror 5, though.. This should be fixed in master since #4463 got merged.. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It's highly unlikely that we pick up this issue for CodeMirror 5, though.. This is related to #1356, right (although that is only about wrapped lines and this probably also applies to un-wrapped editing)? Is this something we could do / already are doing in the rewrite?. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that might address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It's highly unlikely that we pick up this issue for CodeMirror 5, though.. I actually fixed that in 3126d9df613b03ef831ef73b31c47c967f6c4536.. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that should address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It's highly unlikely that we pick up this issue for CodeMirror 5, though.. I think this issue is no longer relevant, since CodeMirror 6 is going to be a complete rewrite. We are currently raising money for this work: See the announcement for more information about the rewrite and a demo.. This should be much better in master since #4463 is merged. Please open new issues for specific problems, and I'll have a look :). Since this is a closed pull request, could you just open a new issue and link to this PR?. What @marijnh posted was a generic example for amending (CodeMirror.hint) methods. In his case, he wanted to amend a hypothetical function CodeMirror.hint.foo, so he stored the function CodeMirror.hint.foo in a variable fooHint and then overwrote it with another function that first calls the original one (fooHint) and then did additional work (in this case, register an event handler).. > Eventually, I want to move CodeMirror's contenteditable mode to this approach as well, and I suspect it will help for this issue, but that's going to be a bunch of work it might take a while before I get to it.\nJust for clarity, this is something @marijnh would like to see happening, but currently neither has time nor funding to do so afaik.. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It's highly unlikely that we pick up this issue for CodeMirror 5, though.. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It's highly unlikely that we pick up this issue for CodeMirror 5, though.. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It's highly unlikely that we pick up this issue for CodeMirror 5, though.. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It's highly unlikely that we pick up this issue for CodeMirror 5, though.. I don't think we are going to change this, since we try to not disrupt the browser when doing composition. Right?. Could you post an example setup that has this issue?. We are working on a rewrite (CodeMirror 6) that will probably address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It's highly unlikely that we pick up this issue for CodeMirror 5, though.. Just to clarify: You tried out the CodeMirror 6 demo and found issues under iOS?. CodeMirror 6 is a complete rewrite, and it's currently under development. You can have a look at the announcement with embedded demo, and I would like to know how it works in iOS :). Have you brought this issue up with Greasemonkey?. We are working on a rewrite (CodeMirror 6) that might address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is unlikely that we pick up this issue for CodeMirror 5, though.. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. We are working on a rewrite (CodeMirror 6) that will completely overhaul this API, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is unlikely that we pick up this issue for CodeMirror 5, though.. From what I understand, this issue seems to be fixed. In any case, we are working on a rewrite (CodeMirror 6) that will address this and similar issues more thoroughly, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is unlikely that we put much work into fixing this and similar problems for CodeMirror 5, though.. This is a issue that's difficult to debug and would probably require a lot of work to fix.\nWe are working on a rewrite (CodeMirror 6) that will hopefully address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. This is a issue that's difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will probably address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. This would have to be rebased since I split lib/codemirror.js a year ago.. We are working on a rewrite (CodeMirror 6) that uses position: sticky for the gutter, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. What do you mean by merging? If you're talking about code, mode/javascript/javascript.js already has 875 lines of code and defines JavaScript, TypeScript, JSON and JSONLD modes. It wouldn't make sense to put the ~150 lines for JSX in that file, too.. If you select JavaScript mode, you get JavaScript, not TypeScript or JSX. These are different languages, they just happen to share a lot.. I'm closing this due to a lack of details. Please feel free to re-open if you have further information.. I'm closing this since it is a browser bug and we are not planning on working around it.. I suppose the patch fixed this. Feel free to re-open if that is not the case.. We are working on a rewrite (CodeMirror 6) that might fix this issue. Could you have a look at the demo in the announcement to verify that this issue is fixed in that version?\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is unlikely that we pick up this issue for CodeMirror 5, though.. Hi, I doubt we are going to fix issues related to very old Android versions.\nHowever, we are working on a rewrite (CodeMirror 6) that will greatly improve input handling and might fix this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. We are working on a rewrite (CodeMirror 6) that might address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. Seems to be fixed.. This is a issue that would probably require a lot of work to debug and fix.\nHowever, we are working on a rewrite (CodeMirror 6) that will probably address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. Ok, apparently this is something we have to accept, so I am closing this issue.. This seems like an issue that is difficult if not impossible to debug and solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will implement input handling differently and probably addresses this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. Apparently this is fixed, great!. This is a issue that is difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. This is a issue that is difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. I'm closing this for now until we have information that allows to reproduce the issue.. Since there was no further feedback indicating the opposite I suppose this is fixed. Please feel free to re-open if that is not the case.. I'm closing this for now since there's not enough information to reproduce the issue.. This is probably an issue that is difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will completely overhaul input handling and probably addresses this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. Thanks for your report. I cannot reproduce this issue in the markdown demo, so I suppose it has been fixed in the meantime. Feel free to re-open if that is not the case!. Thanks for your report (and the analysis). I cannot reproduce this issue in the gfm demo, so I suppose it has been fixed in the meantime. Feel free to re-open if that is not the case!. I can reproduce the issue with Firefox. I further reduced your CSS to\n```css\n.CodeMirror {\n  outline: 1px solid red;\n}\n.row {\n  max-width: 75rem;\n  display: flex;\n  flex-flow: row wrap;\n}\n```\nI also removed all loaded CSS and JS dependencies except codemirror.. You can still include all files you need separately, if you don't have any build process.. Actually, I think we should leave it as it is. With modules, it even gets a bit nicer.\n. Ok, I'll remove the few default exports then. I'll also move the CodeMirror.* setting to a separate module. I would also try to come up with reasonable subdirectories. What do you think about the size of the files? They have 10 to 571 lines, a lot are around 200 lines.\n. Firefox 48.\nI have a problem with a circular dependency. startWorker through highlightWorker (in src/display/highlight_worker.js) calls runInOp (in src/operations.js), which triggers endOperation, endOperations, endOperation_W1, which finally calls updateDisplayIfNeeded (in src/display/update_display.js), which might call startWorker. I don't know how and where to put these things.\n. Also, phantomjs downloading fails.\n. It is big, indeed. Thanks for your comments, I will address them. Do you want me to squash the changes into one or should I leave them as they are? I also just rebased on current master so that travis works again.\n. I think this is quite ok now. We have 7 directories, in order: edit, input, model, display, measurement, line, util. Each directory can only include from those after it. There's still src/modes.js, because I couldn't get myself to move it to util. I didn't address some of your comments yet, but I'm planning to do it. Issues:\n-  I think line is a really bad name, it's more like primitive model stuff.\n- The separation between edit and input is unclear to me\n- model should be called document and include Doc, but Doc currently depends on CodeMirror.\n. This is getting rebase-needy. Maybe you want to merge it unless you have specific issues with it?\n. I think I did everything we talked about.\n. Probably fixed, yay! (Feel free to re-open or comment if that is not the case). This is an issue that is difficult if not impossible to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will overhaul document representation and probably addresses this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. Although we cannot reproduce this issue and thus cannot do anything about it, we are working on a rewrite (CodeMirror 6) that overhauls input handling and might address this issue. We are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. This is one of many issues which are difficult to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will overhaul input handling and should address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. That happened to me multiple times while working on the split. Thanks for fixing it!\n. Seems to work fine on https://codemirror.net/mode/julia/index.html. Please re-open if there are issues with current CodeMirror.\n. Thanks. I think I'll need a few more weeks before I allow myself to consider something uncontroversial.\n. Which browser do you use? The autocompletion examples on codemirror.net work for me in Firefox 49.\n. That's perfectly correct JavaScript syntax. We are actually moving towards that code-style: #4259. What are you using for minification?\n. I can reproduce that on the haskell demo with addon/edit/closebrackets.js loaded and option autoCloseBrackets: true.\n. > What do you mean by that? The Range constructor just assigns its arguments to head and anchor.\nI was referring to the fact that from and to sort. I didn't expect so many places to directly access head and anchor. I suppose it makes sense to not loose this information here.\n. I'm not familiar with such semantics for selections (i. e., directionality). The way transposing works on non-empty selections is broken, anyway, though, so maybe we should follow your suggestion.\n. Amended.\n. I checked dracula-theme, and couldn't find any more specific colors. Interestingly, the atom theme seems to do the same, but I still think it's wrong.\n. I think autolinks would be the right thing to use here, and inside these _ shouldn't start an italic span.. I'm closing this for now since there is no new feedback indicating that the issue is still present.. We are using let and arrow functions, possibly newer ES features like default parameters. The wiki page you linked to recommends to use jsnext:main with a file that would normally work in target engines except for the usage of modules. That's not true in our case.\n. Since there was no further feedback I'm hoping this is actually improved. In any case, this is one of many issues which are difficult to solve with the fundamental approach currently taken by CodeMirror.\nHowever, we are working on a rewrite (CodeMirror 6) that will overhaul input handling and should address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is unlikely that we put more work into issues like these for CodeMirror 5, though.. I'm closing this for now since there was no further feedback. CodeMirror in general is currently not very accessible, though.\nHowever, we are working on a rewrite (CodeMirror 6) that will greatly improve accessibility, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. Thanks for the suggestions, @leftaroundabout. I have no idea what we could do in CodeMirror to further mitigate this problem, so I am closing this issue for now. Feel free to comment or reopen if you have a suggestion what we could do :). I see: mozilla/pdf.js#7844. Bugs like these really trip me up with the visual cursor movement :). Closing this since we cannot reproduce the problem and there was no further feedback.. This is one of many issues which are difficult to debug and solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will overhaul input handling and should address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. That Bubl\u00e9 patch is not necessary for this, since there are no object literals with short-hand methods, only classes.. I'm closing this until there's some code to reproduce the issue.. I couldn't find a problem with any of the samples on https://codemirror.net/mode/javascript/typescript.html.. No, I thought I closed, but apparently it has been closed for a year, so ignore my comment.. @valq7711 Would you be willing to submit a pull request for this?. I'll look into that. core_move_bidi_ are skipped in Webkit, that's why they don't list as failures in Chrome or Phantom.. Apparently Firefox 51 changed behavior around what I described in https://bugs.chromium.org/p/chromium/issues/detail?id=673405. Now, if two spaces from different bidi sections meet, only the one first in moving direction will have full width, while the second one can have a smaller width down to 0 in order to fit more content into the box. Looks especially strange with monospace text.. >Did you do any measurement of performance? From what I can see, there's still no caching of line-break info. The test suite feels a lot slower with these changes, but I didn't actually measure it either.\nI didn't do any conclusive benchmarks, but interactions felt okay. The test suite has a lot more to do at least in Firefox. I could measure phantom before and after.\n\nI'm getting test failures in Firefox 52 (core_wrappingAndResizing, core_move_bidi_Say \u0627 \u0628 \u062cabj S, core_move_bidi_Sayyy \u0627 \u0627 \u0628 \u062c)\n\nI have a local workaround for this.\n\nand Chrome 55 (core_rtlMovement) though the tests do pass in Phantom.\n\nFor me, \u064a\u062a\u0645 \u0627\u0644\u0633\u062d\u0628 \u0641\u064a 05 \u0641\u0628\u0631\u0627\u064a\u0631 2014 fails. I noticed that the (visually) last character is missing, too, maybe that's the reason? Do you have any idea what's happening there? If I add a margin on the line or increase the font size, the character appears; it seems to me like it's just cut off?. I can reproduce the chromium failure with master, too, same issue. Phantom passed for me locally, but travis doesn't agree. What's the current status for you?. I cannot reproduce the test failures \u2026 unless I checkout master, build, then checkout the branch and run the tests without re-building.. Ok, I'll try out other Chromiums. My Chromium 55 definitely passes all but the one test I mentioned above, whereas master fails 18 of the branch's tests. However, my Phantom also passes a lot more tests than travis.. I've written a small script that does that and with the patch I just pushed I get between 5% and 15% performance decrease with this branch. I'm pretty sure that's still in coordsChar.. No failure in Safari 10.. Doesn't really matter, too, since Windows users normally don't get visual movement.. Closing this since there was no further feedback.. This is one of many issues which are difficult to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will overhaul input handling and should address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. Closed until we get further information.. I think variable-3 in this mode is for variables used as a type, so [variable UserAttributes] should be [variable-3 UserAttributes].. We already have a list which definitely could be improved.. @marijnh I was thinking we could skip setGutterMark for all folded lines:\njavascript\n  function updateFoldInfo(cm, from, to) {\n    var opts = cm.state.foldGutter.options, cur = from;\n    var minSize = cm.foldOption(opts, \"minFoldSize\");\n    var func = cm.foldOption(opts, \"rangeFinder\");\n+   var done = false;\n    cm.eachLine(from, to, function(line) {\n+     if (done) return;\n      var mark = null; \n      if (isFolded(cm, cur)) {\n        mark = marker(opts.indicatorFolded);\n+       done = true;\n      } else {\n        var pos = Pos(cur, 0);\n        var range = func && func(cm, pos);\n        if (range && range.to.line - range.from.line >= minSize)\n          mark = marker(opts.indicatorOpen);\n      }\n      cm.setGutterMarker(line, opts.gutter, mark);\n      ++cur;\n    });\nThis is obviously too naive, but isFolded returns the fold mark, and I was hoping from that we can determine which lines are folded?. I'm closing this for now since there was no further feedback on how to reproduce this issue and whether it still persists.. > Seems reasonable.\nFor varying degrees of reasonable. The merged commit is 268cf9905509b87de33a00342ee1cce9a1bdc5cd, btw.. I added the mode to the wiki page.. Has been resolved in adobe/brackets#13067.. Could you try again with current master? If it still fails, can you give me the output of npm ls?. @marijnh Do you know why PhantomJS yields so widely different results on different systems? I don't get any failures with the same version, and while working on the stickyCursor branch, travisci's PhantomJS used to produce a lot of test errors I didn't see locally.. Hi, thanks for your pull request. Your changes are quite difficult to review currently since they include a lot of unrelated white-space changes. Could you try to update your fork's branch so that it doesn't include these changes? See Why and how to correctly amend GitHub pull requests for how to do this.. I think this is related to #4006.. Rebased. a7f80181 is intended for issues in moveVisually, yes. Those probably could come up with wrong bidi orders, too, though.. It's a bit jumpy in my Firefoy 51 on Linux with touch pad scrolling, but the scrolling ends where I would expect it to.. @marijnh usually cuts one release per month, as you can see from the tag overview.. From a quick look at annotatescrollbar.js it seems like Annotation.prototype.redraw indeed expects them to be in order.. Thanks, that's not entirely unexpected. Can you post a screenshot so that I can see which characters render on your windows? Also, do the tests pass in IE, Firefox?. Closing this since there was no further feedback.. I can reproduce truncated characters with roughly the steps you described in Firefox 51. The first line has to have more characters than the second.. I think @marijnh and I are very interested in CodeMirror being accessible and useful to a broad range of people \u2013 supporting contentEditable is part of this as far as I know. Without specific funding we will not be able to address broad suggestions such as this, though. If there are specific, easy-to-solve issues, we might be able to fix them on the go.. I think I would prefer an option that takes a regular expression, but I don't know how @marijnh generally feels about this feature.. @sfbayhacker Looking at Meld, for example, they have text filters for different types of comments, leading and trailing whitespace as well as any whitespace.. @sfbayhacker Looking at Meld, for example, they have text filters for different types of comments, leading and trailing whitespace as well as any whitespace.. What about the other 3 generic font families mentioned in the draft?. Found the question.. This also works with string, any, number, \u2026 Microsoft's monaco editor also highlights them as keyword. . Either way is fine. I think this is already a useful state that could be merged, but per-line direction isn't far away either.. This does not correctly work without wrapping lines. The issue is that cm.display.scroller.scrollWidth is capped at the visible width instead of giving the content's width. I think that's intended. See jsfiddle.. Scrolling (and scrollWidth is probably tied to that) only works for overflowing on one side (left in rtl, right in ltr). So, display.scroller.scrollWidth takes right overflow into account (because it is ltr), but the relevant overflow is on the left side.. I think so. Our content overflows left, but we measure scrollWidth on a ltr element, and I think that doesn't take left overflow into account. So, obvious solutions would be to measure somewhere else, or make the element we measure on rtl.. Both should be fixed now.. > When you have a long line in an rtl editor (which also has a vertical scrollbar), the left end of the line ends up below the scrollbar.\nChromium?\n\nAlso, anything beyond the first screen width, horizontally, doesn't get selection drawn (the selection rectangles stop at the original width) and doesn't properly handle mouse clicks (they are treated as if they are inside the original width)\n\nShould be better now.. > I saw the gutter in the wrong place a few times, directly after setting the direction option, or during scrolling. I can reliably reproduce this by opening mode/javascript/index.html in Chrome and running editor.setOption(\"direction\", \"rtl\") in the console.\nFixed.\n\nAnd clicking on the rightmost part of the document in RTL mode when there's a horizontal scrollbar (which is scrolled all the way to the right) often (but not always) causes the editor to scroll to the left, in Firefox and Chrome.\n\nI think this should only happen in Chrome, not in Firefox. I used Epiphany for Webkit testing, which as I realized today handles scrollLeft in rtl content like Firefox, not like Chrome. Epiphany uses Webkit2.. Hi, thanks for your work and for trying to understand my code! I had a quick glance to find the main difference performance-wise. I think it's that you are not measuring after every moveVisually step, but rather after half the logical distance. I'll have a deeper look now.. For a 50000 character mixed-content line, this runs coordsChar in roughly a seventh of the time master takes. Nice!. I'm pretty sure your new approach doesn't correctly work with rtl content and line-wrapping. Also, the case of ltr-only content was intentionally optimized.. Apparently this is better now, yay!\nAnyway, this is one of many issues we have with the way input is currently handled by CodeMirror. We are working on a rewrite (CodeMirror 6) that will overhaul input handling and should address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. setScrollTop does updateDisplaySimple (nice gecko hack! \ud83d\ude44 ) and startWorker. I suppose that's not necessary in endOperation_finish? I could extract the three lines of actual scroll position updating and call them in operations, though.. Thank you very much for trying this out so quickly and reporting the issue.. I'm closing this for now. Feel free to re-open if the patch didn't fix the issue.. What I did before is: Move one step, measure, continue until overstepped, then choose the closer one. This patch introduces a first phase of moving several steps before measuring until the diff is pretty small, since measuring is quite expensive. In /demo/bidi.html, this nearly always performed 3 iterations for a click, which I consider quite good.\nI don't know how a binary search over visual positions should work. This function is about mapping visual coords to logical positions. It's probably easy to guess how many columns into a line the visual coordinate is, but knowing which logical position it has is really difficult. It should be possible to really quickly move if you take bidi spans and column widths into account, but that would require having logic similar to moveVisually.. Hi, thanks for your report. CodeMirror's bidi algorithm does not take directionality markers into account. I can reproduce this issue in my Chromium 58. The Chromium developer tools have the same problem, too. I think this is a browser bug.. > Right, both vim and github's textarea only take text, so they won't use the HTML content.\nAnd that text content shouldn't contain the zero-width space, should it?. Right, I just wanted to point out that copying to vim is a valid, pretty minimal test. I can reproduce the issue on Linux with Chromium 58 with your setup.\nUpdate: Are these snippets rendered on the client or pre-rendered? @mattheworiordan. Thanks, I will look into it.. 6606ba4930ca8356d4871698e95c80c374e14829 fixed it for me.. Thanks for your report. Maybe there is an easy fix for this, but it's quite difficult to reliably position the cursor in contenteditable inputStyle in general, so I don't want to spend time looking into it. The code we currently use definitely has issues and for example doesn't work well with bidirectional content.. Actually, we are indeed working on a rewrite (CodeMirror 6) that will only support contenteditable. However, integration will be much better and we are planning to put a lot of work into issues like these. We are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. I'll first add a test for the misbehavior I saw and then I look into that. Does make sense, though :). I moved it and added a test.. Right, thanks :). Thanks for your report! Do you know whether this broke recently or never worked in the first place?. Thanks for your report! I'm sorry this code still produces hangs :( I'll look into it today or beginning of next week.. There seems to be an issue with this change, see #5109. @nickasd, could you have a look?. Thanks for your pull request! As far as I see, -- is indeed one of the most common and portable ways to have a line comment in SQL. It already seems to be supported in Line 74ff, though. Did you try it, for example on the CodeMirror website?. I see! I suppose the white-space padding for MySQL is not necessary since it is automatically added by the comment plugin. I think it makes sense to untangle what a dialect supports and what is used for lineComment, or at least make lineComment configurable. Since -- is so portable I would think it makes sense to use it per default in all dialects.. > the token regex allows for \\w!?+- characters to be between the : markup. Since there's no emoji spec that I know of (and because e.g. markdown-it allows pretty much anything the user specifies), I chose this character set to both 1) cover the most common emojis 2) minimize probability the regex will match non-emoji text.\nGitHub links to this cheat sheet. All emojis in there match [a-z_\\d+-].. Thanks for the fix, looks good to me! I also added a test in 5ed2e78e6dfe7344d3d4bf80b92f82d64f9f8239.. Hm, I'm not sure if there's a universally right way to do this. I can imagine that someone uses background-image for highlighting and actually prefers it to be overridden when searching instead of not having highlighting. In your case, adding !important to the spelling error's style would be a workaround if I'm not mistaken.. @marijnh  I added tests and commented on your change. Do you actually like having tests for such things?. Thanks for your report! I can confirm that the position after moving left until the cursor jumps a line is wrong in your example. I'll have a look. The direction branch is mostly obsolete and un-rebaseable.. That issue doesn't seem to be public. At least I cannot see it.. I'm closing this here and hope that the discussion with the Chrome developers is helpful.. This is one of many issues which are difficult to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will overhaul input handling and should address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. Whoa, I'll look into it. I don't really understand your last sentence, though. With wrapped lines, a single visual line always contains a logically continuous number of chars. Inside a visual line, all bidi spans that are present are visually ordered as in the bidi order. There might be spans missing, though. I was thinking about using the bidi spans instead of moveVisually yesterday as well.. Exactly. typeof won't return string, so null or undefined will be considered an array.. I can somewhat reproduce that. If, when I click into the editor, the document didn't have focus, the cursor is positioned where it was when the document lost focus. That's different with textarea.. Quick investigation shows that in my case the selection is internally correctly updated, but the display is not updated afterwards.\nEdit: Actually, I observe this behavior with a simple editor.setCursor call.\nEdit2: Apparently, it's all about window already having focus in my case. If I switch windows, the cursor is correctly updated. If I switch between dev tools and document, the cursor is not updated.. ContentEditableInput::showPrimarySelection needs to be called. It is called from ContentEditableInput::showSelection if CodeMirror thinks it was focused before (cm.state.focused) or if op.focus is set (mainly happens in the mousedown event handler) to the currently active element and document.hasFocus() returns true. When clicking, this logic is executed twice, first on mousedown and second on mouseup. cm.state.focused is false at both times. On mousedown, op.focus is set, but, if the window had focus before, document.hasFocus() returns false. If the window didn't have focus before, document.hasFocus() returns true and showPrimarySelection is called. On mouseup, document.hasFocus() is true in both cases, but op.focus is not set.\nI don't know if this is a browser bug, it definitely feels strange to me. @marijnh ehy do we need the hasFocus() check in operations in the first place? I think op.focus is only set in cases where we are pretty sure that we really really want to have the focus.\nEdit: See also #3979.. Ok, I'll do that. Btw, Webkit sets hasFocus already to true on mousedown. Probably a Firefox bug.. @westonruter Can you try current master?. Ok, so apparently I fixed a different issue, thanks for pointing me in that direction, though. I can reproduce your issue in your instance in my Firefox. Edit: Mh, I cannot reproduce this with a demo CodeMirror instance. Could you try to reduce your example to something more minimal? What I can already see from your demo is that CodeMirror is really confused about which line the click was in as opposed to CodeMirror having the right idea and just not updating the display correctly. This might be about the surrounding CSS and HTML.. What exactly does that mean? If I understand this correctly, you can already use Reviewable for doing reviews?. I'm closing this issue since it does not contain enough information for us to work with. Please feel free to reopen it when you provide example code!. Fixed in #5022, right?. Handbook confirms that. I'll push a fix.. And yes, that means that this.a < Type > (foo); is something different in JS than TS. . That's almost right. Your last commit is correct, but you pulled and merged your previous commits before pushing. Instead, you should just have force-pushed your squashed commit over your previous commits. If you now do an interactive rebase, remove every commit except \n22c5523 and run git push --force, you should be all set. In the end, there should be only one commit in this pull request.. That looks good! Thanks for staying with me.. Could you provide some example code that reproduces the issue?. Thanks for your report! I doubt it makes sense reporting weird highlighting for syntactically wrong code snippets. While this could obviously be highlighted better, there will always be bad cases humans parse better than CodeMirror, and I wouldn't want to touch the highlighting code for such a thing. @marijnh Do you agree?. Is this issue still present in Chrome > 62?. This is one of many issues which are difficult to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will overhaul input handling and should address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. This is one of many issues which are difficult to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will overhaul input handling and should address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. I cannot answer your question, but we are working on a rewrite (CodeMirror 6) that will overhaul input handling and could address this issue. We are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is unlikely that we pick up this issue for CodeMirror 5, though.. I'm in favor of this.. btw, I know we are not using eslint in this project, but if anybody ever wants to do something like this in a project that uses eslint, eslint-plugin-import can check this.. They are not generated. We are not accepting new modes and addons into the repo and might package the existing ones separately, but as far as I know we have no current plans to do so but rather keep them as they are.. It does work now, but I still don't understand the exact issue. Is it about embedding JS in HTML?. There was no further feedback, so I'm closing this issue for now.. I would say that multi-cursor is pretty broken with vim. I couldn't find an action that actually honors multiple cursors.. This is one of many issues which are difficult to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will overhaul input handling and should address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. I don't think the diffing is done by CodeMirror or any CodeMirror addon. It's probably somewhere in https://github.com/gerrit-review/gerrit/blob/master/gerrit-gwtui/src/main/java/com/google/gerrit/client/diff/.. As I wrote, I don't think this is the merge addon at work. Take a look at this completely random diff rendered by Gerrit 2.13.90.. Thanks for taking over :). What was the output of running npm install and npm run build? Note that you have to run them in that order.. There has to be some output of npm run build. What's the output of npm -v?. That's just the way npm works.. I just verified that Scala and Swift indeed support nested block comments, curious. Are there any other languages (in CodeMirror) that do that?. a7e29eee89aed63727e46d1e422cfa95b1200859 and ff21fec1 :). @nethip Marijn tries to publish one release per month towards the end of the month. The last one was 13 days ago, so I would expect him to publish one in 2\u20133 weeks.. Closing this until there's further information.. @dwelle since you were part of the discussion in #4850, could you have a look at this as well?. Thanks for your work, everyone :). Please have a look at current master.. lineSep is a constructor argument for Doc. Would using that work?. I think we are done here :). Hi. We're no longer accepting new modes into the main distribution. The recommended way to distribute new modes is to maintain them in their own repository and publish them to NPM as separate packages\u2014see for example the Elixir mode.. @tbertelsen If you squash your commits I will merge them :). The JavaScript mode has the same problem, I'll have a look.. I couldn't find any syntactically valid example for this issue, neither TypeScript nor JavaScript.. Hi. We're no longer accepting new modes into the main distribution. The recommended way to distribute new modes is to maintain them in their own repository and publish them to NPM as separate packages\u2014see for example the Elixir mode.. Cool! Feel free to add it to https://github.com/codemirror/CodeMirror/wiki/CodeMirror-addons.. That looks good! Could you try to add a test in test/sublime_test.js? For reference, I found a comment and Microsoft/vscode#14089 describing the indented behavior.. Thanks! Now, a last nitpick: Can you squash your commits into one and prefix the commit message with [sublime keymap]?. That's highly specific to your use-case, but should be possible with nested modes. You could have a look at the JSX mode for inspiration.. Well, that would be a Chrome bug. I don't have that version at hand, so I cannot try to reproduce it, but I doubt that Chrome would contain such a blatant bug in a released version. In any case, there's nothing we can do about it.. Hi, I don't know any Groovy. Could you give a small sample and explain what you'd expect?. Ok, sorry to hear that. Good luck with your project, though!. I'm closing this until there's more information.. Adding overflow-y: auto to .CodeMirror works as expected for me.\nNote that we use GitHub issues for tracking bugs and enhancements, not discussing and getting help. The forum on the other hand is open for questions like this.. Hi, just to clarify: You want the indentation of a new line to follow indentWithTabs instead of copying the indentation style of the previous line? So, if indentWithTabs is true, a new line should be indented with tabs, not spaces?. I'm pretty sure that mimetype doesn't exist, so instead the documentation should be updated.. I don't really understand the issue here, but we are working on a rewrite (CodeMirror 6) that will overhaul input handling, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. Oh wow, the code in this file is in an interesting state.. If you clone the git repository you have to run npm i and npm run build.. What did you pass as first argument to CodeMirror?. Sure, if you clone the git repository you have to run npm i and npm run build.. As Marijn mentioned we are working on a rewrite (CodeMirror 6) that will overhaul input handling and he is planning to address this issue. We are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. This is one of many issues which are difficult to solve or even debug with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will overhaul input handling and should address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. We're happy to take pull requests for this, but it's unlikely that the CodeMirror maintainers will implement this feature themselves.. Hello WMF! I'm running Firefox 58.0.1 on Linux and Shift+Alt+B jumps to the summary, Shift+Alt+< doesn't do anything.. Only the vim demo, and I don't see the issue there. I can reproduce it in your wiki, though.. Thanks! PESubsysVer apparently was added in 3.0b2, though.. Appreciated, apparently people are reading these :). dynamic import is stage 3, but I think that's okay for CodeMirror. Could you add a test?. Thanks! This obviously allows false positives (for await(;;) {} and for await(x in y)), but that's acceptable.. While listSelections is a method name used in CodeMirror, I have no idea what your problem might be. Unless you can reproduce the issue with a standalone CodeMirror instance, this is the wrong place to report it.\nPlease open an issue at the CKEditor 4 issue tracker. Also, there's CKEditor 5, did you try that one?. Ok, then your best bet is to open an issue in the CKEditor 4 issue tracker and try to work out what the problem is and where it comes from.. That should be the regular expression in line 85. Would you like to try to fix this?. Ok, it's actually pretty easy. Currently, variable names after dollar signs are matched with /[\\w\\d\\$_\\.{}]/, which means: any letter, number, the dollar sign, an underscore, a dot or square brackets are acceptable. You want to add a dash, so the correct regular expression would be /[\\w\\d\\$_\\.{}-]/. Do you want to try submitting a pull request for that change?. I doubt that's something we can help with, or at least it doesn't seem to be CodeMirror's fault.. Right, you have to build the file if you clone the git repository. Run npm install for that.. This is one of many issues which are a lot of work to solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will overhaul input handling and should address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. This is one of many issues which are difficult to debug and solve with the fundamental approach currently taken by CodeMirror.\nWe are working on a rewrite (CodeMirror 6) that will overhaul input handling and should address this issue, and we are currently raising money for this work: See the announcement for more information about the rewrite and a demo.\nNote that CodeMirror 6 is by no means stable or usable in production, yet. It is highly unlikely that we pick up this issue for CodeMirror 5, though.. Closing this until there's further information on how to reproduce the issue.. The current state of work is available on https://github.com/codemirror/codemirror.next.. I think this behavior matches the spec, see example.. Did you try the version 6 demo? While CodeMirror 6 is far from usable, it is intended to fix issues like these.. Thanks for trying out the demo! If you feel like it you could open an issue about your problem on https://github.com/codemirror/codemirror.next/issues.. We usually reference the elexir mode as an example.. Thanks for your contribution! I can reproduce the issue and your changes indeed fix it. I wonder what the root cause for this issue is and if there's a better way to fix it, though.. Marijn usually does one release per month, so there should be a release pretty soon.. I've published bubl\u00e9 0.19.4 with your patch.. I think that's my fault given that I implemented that warning in rollup and introduced the circular dependencies in CodeMirror :D. Yeah, it just looks at the import graph, not at usage.. Hi, we're not accepting new modes into the main distribution anymore. The recommended way to publish your mode is to put it in its own repository and publish it on npm---see for example the elixir mode.. Oh, you could squash the commits into one.. Thanks for your contribution!. Thanks!. Make sure to fix bin/authors.sh, too.. #5633. \u2026 however, this should be better in the demo for CodeMirror 6, right?. I'm closing this for now, please feel free to reopen if you end up with a small example demonstrating the issue :). Closing this for now, please feel free to reopen if Marijn's suggestion doesn't work for you!. I think the issue here is that the * at the end is treated as an operator. For multi-line expressions like \nkotlin\n(someValue + x) *\n  aBigCoefficient\nit makes sense to indent the second line.. Thanks!. Thanks!. Could you post a complete example that shows your problem?. I think meta would be the appropriate style.. Does the same happen for you in any of the demos on the website? Otherwise, please post an example setup hat has this issue.. I think you just have to add the property name to this array:\nhttps://github.com/codemirror/CodeMirror/blob/278503bdb57b874067b71dfd55e9c68e0e5ff44b/mode/css/css.js#L545. Same happens for me. I also tried disabled the matchbrackets addon, but it still happens.. Yeah, that was an accident.\n. renamed codemirror.js to main.js and legacy.js.\n. I already fixed that one locally :)\n. There is, I just didn't move everything yet.\n. Actually, I didn't know how to just require with rollup. Also has the nice advantage of not depending on CodeMirror.js.\n. See above.\n. I think this is currently too entangled with CodeMirror logic and concepts to be considered util code.\n. Good catch. I think that would currently fit in with measurement/, which I'm not too happy with.\n. I'd even say there should be a History.prototype.copy that wraps this.\n. I agree.\n. LineView is used in measurement/, and the way I laid it out measurement/ should not depend on display/.\n. See comment below. line/ only exists for untangling dependencies between display/ and measurement/.\n. Done.\n. I think it's okay that way. It's a separate commit, so we can easily take it out again, though.\n. Hm, the license header appears multiple times in the built file. That could be a reason for removing it.\n. Ok, did that.\n. I got myself intimidated by vim's apparently wrong syntax highlighting.\n. No, since to is assumed to satisfy pred, it is not actually tested.. That should do it, shouldn't it?\njavascript\nlet begin = findFirst(ch => measure(ch - 1).bottom <= y, end, 0)\nI find the current version to be a bit closer to the actual intent, though. It's the character after (+ 1) the last character (first from length - 1) whose bottom is not <= y. The simpler version looks simpler, but doesn't convey any meaning. As for off-by-one errors: I found tests to be a good solution to that problem :). I suppose if you're used to the concept of \u00bbposition\u00ab, that might be the case. I amended the last commit.. I wonder if this is acceptable, performance-wise.. These functions should be somewhere else, probably display/?. Why not? I could also store a wrapper { order: [], direction: ''} in line.order, so that the property is not on an array and doesn't leak.\nGlobal direction changes are probably rare, but this technique would also work for line direction changes, it is simple and lazy, and it exactly implements the logical cache cleaning in this case.. Done.. If I understand these two lines right, they are for breaking out of the infinite loop alternating between the two cursor positions closest to the coordinates. I would prefer an approach that makes this intent obvious, instead of a side-effect. I also think this implementation is not correct for ltr spans, see the test I just pushed as d56a5f95b009f4cfa0ee0b4b4b4710348e34728b.. Why do you not use throw and catch for this?. This is wrong in cases with lvl 2, I think. Example:\nhttp://unicode.org/cldr/utility/bidi.jsp?a=abcd+%D9%85+1+%D8%B1&p=LTR\nIf your line fits 6 characters, according to UBA, it will be\n```\n012345\n\nabcd E \nN F\n```\nBut the bidi ordering is:\n\"{\"level\":0,\"from\":0,\"to\":5}, {\"level\":1,\"from\":8,\"to\":10}, {\"level\":2,\"from\":7,\"to\":8}, {\"level\":1,\"from\":5,\"to\":7}\"\nThe first bidi part in bidi ordering order that's after, say, the right end of E will be order[1]. I suppose you are looking for order[3] though?. Hm, it's loading for me. Anyway, what I am saying is: There are cases in which a span A that comes before a span B in the bidi order comes after the span B in top-down order.. Could you make this \u00bbCodiva.io (Online Java Compiler and IDE with auto-completion and error highlighting)\u00ab?. I'm sorry, but there's still a small mistake. There's an extraneous space between \u203aauto\u2039 and \u203acompletion\u2039, it should be \u203aauto-completion\u2039 without a space.\nAlso, can you squash your commits together into one commit so that our git history is tidy? Here's a quick guide how to do that.. What about e and f?. The line I commented on is parsing hexadecimal literals, which use digits from 0 to f, right?. spec is not the result from resolveMode in the remainder of this function.. I think this would not correctly handle the following:\n\nFROM debian:stretch # I tend to use stable as that is more stable. You can just drop the non-capturing group.. suggestion\n  var mode_objc = CodeMirror.getMode({indentUnit: 2}, \"text/x-objectivec\");. suggestion\n  function MTOBJC(name) { test.mode(name, mode_objc, Array.prototype.slice.call(arguments, 1)); }. I think it would make sense to reuse isIdentifierChar.. I'm not sure if engines are able to do this on their own, but I would move the array out of the function to avoid reallocations.. \n",
    "umrashrf": "I think I have fixed it. I have just copied 3 folders (lib, mode, theme) and it had that bug but then I copied the whole folder of the source code now and it is working fine.\nSorry about that.\n. ok I respect that. how can I at least debug it knowing there are no bugs in the firebug and this works fine on Chrome and Safari without my app?\n. After some more digging of an hour I figured as I am setting textarea height as follows.\ntextarea\n{\n    height: 100%;\n}\nThis is causing CodeMirror not to work correctly. As I remove the height, CodeMirror starts to work as expected.\n. After some more digging of an hour I figured as I am setting textarea height as follows.\ntextarea\n{\n    height: 100%;\n}\nThis is causing CodeMirror not to work correctly. As I remove the height, CodeMirror starts to work as expected.\n. ",
    "lm": "I forget to mention that, in Smalltalk auto indention is problematic, someone actually writes code like this:\n\n[foo bar.\nbar foo]\n  repeat.\n\nIt should not autoindent in this case\u2026 im happier without smart indent, but I will try return it back in some kind.\n. There is issue with smart-outdent in Chrome (works fine in Opera), for example in JavaScript mode:\n1. write {\n2. press enter, next line is indented automatically\n3. write }, code should outdent, but nothing happen, it seems that indent() method in mode receives wrong state object, but works randomly or when CodeMirror lost cursor focus before.\n. Yes, it works fine with 70.\n. I have added support for indent.\n. ",
    "misfo": "That commit looks good to me, using countTimes is definitely cleaner.\n. Would it make sense to have a configuration option for word size that uses this code?  The option could be called \"wordUnit\" which could take the options \"small\" (i.e. /(\\w+)|([^\\w\\s]+)/), the default \"regular\" (i.e. \\w+), or \"large\" (i.e. \\S+).  Something like that could be useful to non-Vim users for the small amount of code it adds.  From playing around in some Windows apps, some of them navigate between \"small\" words (e.g. MS Word, MS Communicator)\nIf that doesn't seem worth it I can pull the extra word logic into vim.js.\n. Taking arbitrary regexes is doable, but the code will have to be completely different since it's checking one char at a time right now. Would it be acceptable to regex match the remaining (or preceding, if going backwards) string on the line? Or will that be a performance issue with long lines?\n. Okay.  Could it be an array of (character class) regexes then?:\nDefault word:\njavascript\n[/\\w/]\nVim word:\njavascript\n[/\\w/, /[^\\w\\s]/] // a string of word characters OR a string of non-word, non-space characters\nVim big word:\njavascript\n[/\\S/]\n. The updated pull request is #284\n. I switched the default word commands back to use \"word\" as their unit.\nThe position parameter is needed to indicate which part of the word to move to.  For instance, with Vim's e goes to the end of the words:\nfunction func(param, anotha) { }\n       ^    ^^    ^^      ^^ ^ ^\nAnd w goes to the \"start\" of the next word:\nfunction func(param, anotha) { }\n         ^   ^^    ^ ^     ^ ^ ^\nThis is an important distinction in Vim. Especially once vims motions are combined with its operators, it's important that the motion move to the intended character.\nThe findPosH function was previously moving to a different \"position\" in words based on which direction was specified.  If you were going backwards, it would back up after it hit the first char that didn't match. If you were going forwards it would just leave the cursor at the first char that didn't match (i.e. \"after\" the word).  So adding position as a param just allows this to be specified, since it's slightly different in Vim.\n. No, that's cool. I respect that you have to stay vigilant to keep unnecessary complexity out of the code.\nI'll take a look at the word motions when I get a chance...\nSent from my phone\nOn Dec 12, 2011, at 5:30 AM, Marijn Haverbekereply@reply.github.com wrote:\n\nI think that's starting to make findPosH positively incomprehensible. How about, since this is so specific that probably only VIM users need it (Emacs moves to start-of-unit when moving back, end when forward), we keep it in vim.js? Since I'm starting to feel bad about nit-picking your pull requests all the time, I took a first stab at an implementat in f01ee93f0bd2cf82d3a3ff6f9589da72a9621986 . Please take a look.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/284#issuecomment-3104857\n. > I also see a probable difference in direction; more normal users may just want Vim-like bindings, whereas my goal is parity (something I've never seen attempted in any system since the old era of vi clones and then vim clones; any \"Vim mode\" in another text editor that I've ever seen is wholly unusable and extraordinarily irritating because it's not complete enough). This makes it a fairly big project, and not particularly well suited to existing inside the main CodeMirror project repository.\n\nHave you tried Sublime Text 2's Vintage mode? That's the only Vim mode I've used that has more benefit to me than irritating inconsistencies. It's the best implementation I've looked at, too.\nI agree with @chris-morgan that there are some fundamental pieces missing currently that need to be added. For instance, there needs to be a general way that counts, operators, and motions are combined. Vintage has a ViEval that takes the \"parsed\" command and does the right thing with it. So for operations it can start a selection, move according to the motion/count, and then act on that text according to the operator. Something like this is important to get in soon or the keymaps are going to balloon out of control.\n. ",
    "peterkroon": "The title of this issue mentions FireFox 8 :-) btw same experience in\nff nightly.\nMy name is Peter Kroon so -> @peterkroon or my twitter @peterkroondrums :-)\nI can reproduce your experience in Chrome as well.\n2011/12/2 Jan Keromnes\nreply@reply.github.com:\n\nI have two different behaviors on chrome 15:\n- Holding Ctrl down and pressing X then S shows only the alert.\n- Ctrl-X + Ctrl-S (releasing Ctrl between the two) triggers the chrome Save File dialog.\n@peterskoon which browser are you using?\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/272#issuecomment-2990699\n. The save dialog box is still displayed. I did a hard refresh.\n. > Are you sure you're pressing ctrl-x first?\n yes\n. OK...well, worth to mention that it does not work in FF8+nightly on W7 32\n. Also fails on XP.\nMaybe you could provide a minimal example to experiment with?\n. In the current stable release 11.60 of Opera I'm able to drag but not drop.\nhttp://html5demos.com/drag\nThis demo also fails to drop in Safari W7 32 it does color the image.... \n. When I try to dnd in Safari W7 32 the tab crashes. I guess this is a Safari bug.\nI tried to dnd the eat function\nhttp://codemirror.net/mode/javascript/index.html\n. dnd is available in Opera: http://devfiles.myopera.com/articles/735/example.html\nTried the demo in Stable, Next and Labs.\nNot sure if this issue should be reopened.\n. I've already started this. But it's not finished yet.\nhttp://5060.nl/codemirror/lesscss/mode/css/\nThread: https://groups.google.com/group/codemirror/browse_thread/thread/b98ac11d9bfd4a52/99c2a6cddbf506e4?hl=nl&lnk=gst&q=lesscss#99c2a6cddbf506e4\n. Neat, then we could make a great DIFF mode or something else.\n. I can reproduce this: http://jsbin.com/esuhup/2/edit#javascript,html,live\n. http://codemirror.net/mode/mysql/index.html\nThe default is no coloring right now. when I exec in console: editor.setOption('mode','text/x-mysql'); I get colors.\nAlso:\nindex.html:6GET http://codemirror.net/theme/default.css 404 (Not Found)\nindex.html:6GET http://codemirror.net/css/docs.css 404 (Not Found)\n\nGood to see a MySQL mode.\n. It is, one more :-)\nIt reads CodeMirror2, should this be CodeMirror only? Found out that this appears on the other demo's only this way.\n. The <title> in http://codemirror.net/mode/less/index.html also reads CodeMirror2. Not sure if this is correct.\n. OK, if you could do almost the same on the LESS demo page. I've updated my previous post.\n. Thanks, but when I place the cursor back on line 3 the brackets will not highlight again......\n. Could you provide with with some more info on the bracketHighlighted(); function?\nI am unable to find it in codemirror.js. What does it do?\n. Ofcourse!\nStill I'm unable to find the function....\nI found 10 matches for bracketHighlighted.\nhttps://github.com/marijnh/CodeMirror2/blob/master/lib/codemirror.js#L79\nhttps://github.com/marijnh/CodeMirror2/blob/master/lib/codemirror.js#L81\nhttps://github.com/marijnh/CodeMirror2/blob/master/lib/codemirror.js#L518\nhttps://github.com/marijnh/CodeMirror2/blob/master/lib/codemirror.js#L520\nhttps://github.com/marijnh/CodeMirror2/blob/master/lib/codemirror.js#L1574\nhttps://github.com/marijnh/CodeMirror2/blob/master/lib/codemirror.js#L1684\n. Seem like the LESS mode fails.\nUnable so make a selection. Tested in Canary. Would this be a mode bug or a lib bug?\nhttp://codemirror.net/mode/less/index.html\n. Go to: http://codemirror.net/demo/theme.html\nSelect theme rubyblue and then select the entire find function in the editor.\nNow change theme to default. The selection does not get updated.\n. I was able to experience this only once. Just before I reported.\nI think this is a bug because you mention and experience this as well.\nJust tried it again at http://codemirror.net/mode/coffeescript/index.html.\nWhen selecting text from bottom to top and moving the mouse on the h1 tag, randomly/suddenly the selecting stops/breaks and at the top left of the editor there is an extra 2px line and at the bottom 1px line. The line appears from left to right and hangs over on the left side of the editor.\nView this screenshot: http://5060.nl/codemirror/Knipsel_001.JPG\nEdit: the 2 lines are supposed to hang over.....\n. Go to: http://codemirror.net/demo/folding.html\nSelect line 9-14 click on the gutter at line 10 to fold and click again to unfold.\nThe selection has changed.\n. Found another bug.\nFor example go to: http://codemirror.net/mode/groovy/index.html\nMake a selection. To unselect selection click on the selection.\nWhen selection get unselected the editor gets an orange line/field which appears very shortly.\nIs this because of tabindex or because of this new drawing.\nEdit: found in Canaray W7\nEdit: focus also happens when right clicking the editor\n. Well, when tabindex is removed the \"bug\" disappears. So it's not a related to the new drawing method.\n. > The problem is : I cannot new a line when I press \"Enter\" button in android default browser\nI can reproduce this on Android 2.3.3\n. When pressing enter, these do not get fired t all: onKeyDown,onKeyPress\n. Unable to reproduce....\nAre you using the latest development snapshot?\nCan't find and update your provided code.\n. Well that's a stable release.\nThe development snapshot can be downloaded right here: http://codemirror.net/codemirror2-latest.zip\nThis link is on the homepage of http://codemirror.net/\n. I've posted a demo here: http://5060.nl/codemirror/2012-01-31/mode/clike/index.html\nVisit this url on your mobile device.\nWhen you press the letter 'a' an alert will popup because the keyDown is triggered.\nWhen the alert box appears and you click OK you need to focus the editor again.\nWhen pressing the Enter key absolutely nothing happens(on my phone).\nEdit:\n\nWhen the alert box appears and you click OK you need to focus the editor again.\nNot true, the first input hides the cursor and does not display the character.\n. I just updated the firmware on my phone to 2.3.6 and the issue still occurs\n. Just to let you know. It does work in Safari but not with CodeMirror in safari.\nSee this demo: http://help.dottoro.com/ljdpgfkx.php\n. Not sure why I forgot to add those braces....\n\nActually, with: if(!options.gutter || !options.lineNumbers)gutterChanged();\nyou are able to back and forward with lineNumbers true/false.\nWhen setting lineNumbers the gutter stays false so the gutterChanged gets executed.\nWith: if((option == \"lineNumbers\" || option == \"gutter\") && value == false)gutterChanged();\none can't set to true after false.\n. I disagree on the argument 'just a small demo'....\nActually these kind of things are very important.\nWhy not make the demo work correctly and gain use experience? It's a small effort.\nServe the new CodeMirror user with a working demo.\nIf you still don't want to add the pull. Let me know so I can add a new pull for adding \"var\" on the scroller var.\n. I agree that a demo should be simple.\nHowever when holding on that F11 should be used in the demo you suggest that there is a workaround/catching the F11 event when exiting full-screen in Chrome. Which is not possible.\nTry at: http://codemirror.net/demo/fullscreen.html\nMake the browser go full-screen by pressing F11(not in the editor). You'll notice that the browser is now full-screen.\nNow we want the editor to go full-screen as well. We press F11 when the editor has focus. What happens is that the browser exits full-screen mode and the editor remains the same size(doesn't go full-screen). Binding to Ctrl-F11 will result in correct behavior and provides the expected result.\nSo, please reconsider.\nThank you.\n. You're welcome.\nHowever I reported 2 bugs in the report above.\nThe first has been fixed :-)\nThe second seems to be untouched or must I use some CM options configuration?\n. Unable to reproduce on W732 Firefox 10.0.2\n. I just tried it and when IE9 is in quirksmode Ctrl-f fails otherwise it seems to be ok for me.\nhttp://codemirror.net/demo/search.html\n. A match means I have to match certain characters to color all of them.\nFor instance, I need to know if I'm dealing with a hex color or id.\naaaeee makes it a hex color adding a curly brace at the end makes it an id.\nIf I use the current peek function I can look only 1 char ahead and this includes white-space.\nThis would mean that if \"#aaaee {\" has got the white-space(which it does) it would be parsed as a hex color instead of an id.\nThis also works for url(image.png) I need to look up for the ).\n-> url(  image.png  ) is valid css. but will get wrong parsing.\nTry it out.\nEDIT: changed code, look for my last post https://github.com/marijnh/CodeMirror2/pull/395#issuecomment-4186315\nI have implemented the altered function here:\nhttp://5060.nl/codemirror/lesscss/mode/css/\nOriginal here: http://codemirror.net/mode/less/index.html\n. > Even if this would be a good idea, you implementation is quite unacceptable. It makes peek have a side effect, which makes it very confusing.\nWhy?\n. Actually, it would be nice if one can pass a regex to skip whatever chars you want, not only white-space.\nWhy?\nWell: \neee aaa{\ncolor: green;\n}\nI still want #eee to be rendered as an id instead of a hex color.\n. I made a fix for the matter and provided a demo: http://5060.nl/codemirror/lesscss/mode/css/\nAdded a stream function called eatChars.\njavascript\neatChars: function(regex,matcher,consume) {\n  var start = this.pos;\n  while (regex.test(this.string.charAt(this.pos))) ++this.pos;\n  var bool = matcher.test(this.string.charAt(this.pos));\n  if(!consume)this.pos = start;\n  return bool;\n},\nLet me know if this is doable.\nEdit: added consume parameter and will try to port the theme to CodeMirror this week :-)\n. > So use match.\nNo, this gives me the incorrect and wrong result as I mentioned before\nI do not need to match, but I need to peek ahead via a liberal way.\nTry my provided demo with your suggestion, it fails.\n. > Did you read what the second argument to match does? I fail to see the problem.\nYes I did and it fails.\nI've pasted the piece of code that handles the id or hex color.\nWhen using stream.match(/^\\s*{/, false) I get unexpected result.\n```\nelse if (ch == \"#\") { // lesscss\n      stream.eatWhile(/[A-Fa-f0-9]/);//we don't eat white-space, we want the hex color and or id only\n  if(stream.current().length ===4 || stream.current().length ===7){//check if we have a proper hex color length\n      if(stream.current().match(/([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/,false) != null){//do we have a valid hex color value\n        if(stream.eatChars(/[\\s\\u00a0A-Fa-f<>,.\\\\-_]/,/{/))return ret(\"atom\", \"tag\");//we have a valid hex color value. look ahead if the value is used as an id\n        return ret(\"number\", \"unit\");\n      }else{//if not used as an id return as hex color\n        stream.eatWhile(/[\\w\\\\\\-]/);\n        return ret(\"atom\", \"tag\"); \n      }\n  }else{\n    stream.eatWhile(/[\\w\\\\\\-]/);\n    return ret(\"atom\", \"tag\");\n  }\n}\n\n```\n. Which browser/platform and did you try it on the website as well?\nhttp://codemirror.net/\n. I'm confirming the slowness/hanging.\nI can reproduce it when pasting 8000 object in the CodeMirror instance.\nI can't reproduce it when the textarea value already has the 8000 objects or more.\nSo the issue \"is\" when pasting large data in the CodeMirror instance do not render/color the entire document?\nHowever when the textarea already has got the value of the 8000 objects I can with ease Ctrl-X and Ctrl-V.\nXML used: http://5060.nl/codemirror/hamlet.xml\nhttp://codemirror.net/mode/xml/index.html\nTested on: W732 Canary\n. Which query?\n. Your XML is not valid:\nThis page contains the following errors:\nerror on line 1 at column 40272: Specification mandate value for attribute pl\nBelow is a rendering of the page up to the first error.\n. It works just fine here. I copied your xml in my html file and openen this in Canary.\nWorks perfectly.\nBut when i copied your xml from the browser it was already formatted. \nPerhaps this is the issue as your demo is not. I mean layout formatted.\n. It is the issue.\nWhen copied from http://dl.dropbox.com/u/2582168/test.xml works ok\nWhen copied from view-source:http://dl.dropbox.com/u/2582168/test.xml the rendering/highlighting seems to fail.\nI think this is a mode bug.\nTested on: W732 Canary\n. The pure xml mode seems to fail as well: http://codemirror.net/mode/xmlpure/index.html\n. Can't find video 404.\n. Thanks, I was indeed referring to the next line.\nI tried to hack it like how the comments are rendered. I looked at tokenCComment. So far, no success.\nIs it doable to make CM look at the next line?\nFeel free to shed some light on that.\nThank you.\n. I tried the demo again and it still gets stuck unfortunately.\nW732 Chrome 19.0.1060.0 canary\n. This also happens in FF Nightly 13.0a1 (2012-03-02)\nW732\n. Appears to be working on FF Nightly 13.0a1 (2012-03-04)\nW732\n. Sorry about that: Chrome 19.0.1059.0 canary\nI should have tested this further. Works OK in FF nightly.\nW732\n2012/3/4 Marijn Haverbeke\nreply@reply.github.com:\n\nWhich browser? I'm not seeing this on Chrome 17\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/418#issuecomment-4309095\n. Seems to be fixed in 19.0.1078.0 canary W732\nClosing this issue.\n. Rewritten mode completely: https://github.com/marijnh/CodeMirror2/pull/424\n. Thanks!\nAbout an hour ago I'd send you an email with the less theme. Please, have a look at it.\n:-)\n. > I disagree. A raw CSS mode is also good to have, at least until the LESS mode is a lot more mature\n\nI'll see what I can do about that. Feel free to comment and/or make suggestions.\n. Mmmm.... Yes, defining mime types might do the trick....\nI've placed this on my to-do list. Results might take a while. I'm not in a hurry with this.\n. There is no dnd in ie8 with CodeMirror...for now.....\nhttp://codemirror.net/lib/codemirror.js\n// Detect drag-and-drop\n  var dragAndDrop = function() {\n    // There is *some* kind of drag-and-drop support in IE6-8, but I\n    // couldn't get it to work yet.\n    if (ie_lt9) return false;\n    var div = document.createElement('div');\n    return \"draggable\" in div || \"dragDrop\" in div;\n  }();\n. The regular selection seems to be fin to me.\nIt might look different as the line gets highlighted when selected text.\n. Yes, making a text selection in ie8 seems to be buggy. Sometimes it works and not.\nhttp://codemirror.net/demo/activeline.html\nTested in ie9 with browsermodus set to ie8 W7.\nLooks like it has got to do with the speed of selecting(with mouse). When I select really fast I'm able to make a selection.\nUnable to make a selection when selecting text slow.\nWhen browser modus is set to ie7 the selection is not visible but when Ctrl-X the selection is cut.\nSo there is a visible problem here.\n. Look here: http://codemirror.net/doc/manual.html#keymaps\n. Looks like Ctrl-C is not binded using keymap.\n@marijnh why is that?\n. Shift-Insert works fine for me in a textarea.\nhttp://www.w3schools.com/tags/showit.asp?filename=tryhtml_textarea\nW732 Chrome 19.0.1062.0 canary\n2012/3/8 Marijn Haverbeke\nreply@reply.github.com:\n\nBrowsers (at least my Chrome) don't seem to do paste in a textarea on Shift-insert. As the thread you linked mentions, it is not possible for JavaScript to directly access the clipboard, so CodeMirror is dependent on the browser here.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/434#issuecomment-4392753\n. The latest stable release of FireFox is 10\nhttp://www.mozilla.org/nl/firefox/new/\n\nUnable to reproduce on W732\nChrome 19.0.1063.0 canary\nFireFox 13.0a1 (2012-03-08)\nBTW I noticed you need to press Ctrl-Z twice to get it going\n. Perhaps you can alter the code locally and try it with a try catch on that line.\n. It is still an issue. I provided a reminder for myself. Will look into it this week.\nI thought I'd closed this one.\n. > In the course of building our application, the default drag-and-drop behavior in the editor became a problem\nWhat was the problem? Should the dnd in CM become more flexible in some way?\n. > and in the interest of making that easy to use the dropzone is the entire page\nThat doesn't make any sense to me. I suggest a div box as a dropzone whenever there's a CM instance in the DOM instead of the entire page.\n. The flickering is indeed gone. However the DND appears to be broken.\n. Perhaps adding the css declaration via JS when CM is on a touch device.\nI don't know if dnd is available on touch devices, you?\n. @njx http://www.quirksmode.org/css/opacity.html\n. I can't reproduce this on Crome 20.0.1096.1 canary W732\nI pasted line 8 at http://codemirror.net/demo/theme.html to create the long line.\n. Same result for me: 20.0.1097.0 canary W732\nI'll try later in ie78\n. BTW you are talking about the first \"return\" right?\nI could not reproduce in IE8 and in the same IE8 with IE7 modus. WXP\n. Try the refresh function.\nhttp://codemirror.net/doc/manual.html#refresh\n. Can you provide a demo at: http://jsbin.com/ihunin/edit#javascript,live\n. :-)\nTry calling the refresh function after you have defined and initialized the editor.\nAlso you could try to call the refresh function in the console in Chrome\nSomething like: editor.refresh() to see if you get the expected result.\n. @hanxianlong Look here: https://github.com/marijnh/CodeMirror2/blob/master/lib/codemirror.js#L2809\n. > I also looked at it in IE 6, but there are a number of bugs in CodeMirror master that made it so I can't really test it there (in particular, scrollbars never seem to show up in IE 6 even with CodeMirror master--the content just makes the overall editor bigger).\nThis also happens in Opera Mobile+Mini on Android. It would not surprise me if this would also be on other mobile platforms.\n\nThis implementation doesn't work properly with drag-and-drop in IE9 (I have it commented out in this pull request). In CodeMirror master, there's already an issue where if you select some text and then click on the selection (without dragging), it stays selected. With my implementation, the behavior is worse: the input div actually loses focus. I'm not sure why this is happening, because I can't figure out where the onBlur() is coming from. (We do actually get into the code in onDrop() that calls focusInput(), but the onBlur() happens later.)\n\nI noticed this when the new selection drawing(whole line instead of given text) method was merged by your colleague @gruehle. But that was after version 2.2. CodeMirror 2.18 seems to be correct(not loosing focus): http://codemirror.net/codemirror-2.18.zip\n. Go to the LESS mode and delete the content.\nThe result is unexpected. Not sure if you already knew this. The background color doesn't fill the editor.\n. Sorry, forgot to add.\nTested in Chrome 20.0.1106.0 canary W732\n. The gutter image is still not displayed when changing theme to ambiance.\n. Exactly :-), look in the css file.\nhttp://codemirror.net/theme/ambiance.css\n. You are correct, I was expecting another image layout. Probably because of previous bug :-)\n. Just to be sure this is what I was expecting: http://5060.nl/codemirror/cm_theme.JPG\n. Well you're still right. Displayed in the image is the box-shadow.\nFor some reason it doesn't show up currently.\n. Thanks for fixing that @marijnh \nSorry for the trouble @WraithKenny \n@jankeromnes I guess this patch isn't needed anymore now, is it?\nhttps://github.com/jankeromnes/CodeMirror2/commit/6ce0c86e8bfce21e5eda24673eb2deb8e00da0d6\n. @jankeromnes Thanks for the explanation. Let's leave it like that.\n. I was able to reproduce this on Opera Next W732\n. W732 == Windows 7 32bit\n. I can reproduce this as well.\nChrome 21.0.1156.1 canary W732\n. After reproducing, Ctrl-Q or clicking on the gutter does not fold the code.\nNo error message in console is provided.\n. I'm not sure if it is related to the scala language.\nI think it's more demo mode bug.\nLook here: http://5060.nl/codemirror/SCALA_DEMO.JPG\n2012/6/2 Guillaume Mass\u00e9\nreply@reply.github.com:\n\n@peterkroon\nWhat do you mean by 2 vertical scrollbars ?\nIs this related to the scala language ?\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/559#issuecomment-6080775\n. You're right, I think this has got to do with the new scroller\nimplementation :-)\n\nhttp://codemirror.net/demo/fullscreen.html\nWhen I press F11 the only thing which happens is that the scrollbar of\nthe editor gets removed.\n2012/6/3 Guillaume Mass\u00e9\nreply@reply.github.com:\n\nwont work as well on ie9, chrome 19.0 and firefox 12 on windows\nthe same for http://codemirror.net/demo/fullscreen.html\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/559#issuecomment-6083264\n. @njx what do you think?\n. http://codemirror.net/mode/clike/scala.html\nWhen I type aaaaa at the end of line 4 and then remove them using the backspace key the inner scrollbar disappears.\n. DND works with CodeMirror in Opera.\nCurrently Opera has no support for setDragImage.\nI hope some day they will.\n. Opera now supports setDragImage: http://help.dottoro.com/ljdpgfkx.php\nI've tried creating an image via:\n\nvar img = elt('img');\n    img.id = 'rainbow_1';\n    img.src = 'data:image/gif;base64,R0lGODdhAgACAIAAAAAAAP///ywAAAAAAgACAAACAoRRADs='; //1x1 image\n    img.width = '100';\n    document.documentElement.appendChild(img);\n    //d.wrapper.appendChild(img);\n    //fake_image = d.wrapper.getElementsByTagName('img')[0];\nIn thefunction onDragStart(cm, e) { which failed...\n. I'll look into that and the rest of the mode as well.\nNot all coments make a lot of sense.\nIndentation seems to work properly in the demo that is.\nI haven't test it with different tabsizes.\n. You are quite right. I'll try to fix this.\nWhen I submit the code on GitHub the indentation alters for some reason....\n2012/7/3 Marijn Haverbeke\nreply@reply.github.com:\n\nOh, I didn't mean the indentation as produced by the mode. I meant the indentation of the file less.js itself.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/615#issuecomment-6736932\n. Looks like it when pasted into ACE.\n\n2012/7/3 Marijn Haverbeke\nreply@reply.github.com:\n\n\nWhen I submit the code on GitHub the indentation alters for some reason....\n\nSeriously, it doesn't.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/615#issuecomment-6739169\n. Web interface should work properly.\nI used the editor on GitHub and still some code did not indent.\n. Chrome Canary W732\n. Your patch did work but I can reproduce this issue again.\nPlease have a look.\n. Thank you Marijn!\n\n2012/7/10 Marijn Haverbeke\nreply@reply.github.com:\n\nWow, thanks. I don't know how you are always catching such bugs so fast, but I know that I'd be releasing a lot more bugs if it weren't for you.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/627#issuecomment-6869124\n. No it's not a new line issue. The layout of the editor gets messes up.\nPlease follow provided steps in previous post but repeat the paste a few times.\n. Follow the steps as written. They are pretty clear.\nI've uploaded a screenshot: http://img69.imageshack.us/img69/928/maraijnknipsel.jpg\n. Sorry about that, the upload failed.\nLook here: http://www.flickr.com/photos/82833352@N03/7589801978/in/photostream/lightbox/\n. I selected the code on line 1 using the mouse. No triple click.\nCopy via Ctrl-C and then placing the cursor at the end of line 1 using the mouse.\nPasting via Ctrl-V.\n\nI reported this bug because my experience was that stable and canary always had the same result to me.\nHowever this time I didn't check Chrome stable...\nToday there was a Canary update and it seems to be fixed.\nSorry I wasted your time.\n. Thanks for this. It was a poor report.\nI guess I was just too busy with all kinds of bug reporting and got a bit lost.\n. Go to: http://codemirror.net/mode/xml/index.html\n- On line 2 remove the first 2 spaces. Place the cursor on line 2 char 0 via the mouse.\n- Press the delete key twice to delete the 2 spaces before the comment.\n- Press the tab key and a tab gets inserted.\n- Press Shift-Tab and the tabs is deleted but 2 space chars are inserted.\n. Still inconsistent and doesn't makes a lot of sense to me.\nWhenever there should be any indentAuto it think it should be a tab and not 2 spaces. Or a tab with a width of  2 chars or any length you want.\nWhat about this one:\n- Go to: http://codemirror.net/mode/xml/index.html\n- Place the cursor via mouse on line 2 in the comment between m and m\n- Press tab and a tab gets inserted\n- Press Shift-Tab and nothing happens\n- Press backspace to delete the inserted tab\n- On the same line place the cursor via mouse betweenn and t\n- Press tab and a 1 space char tab gets inserted\n- Again pressing Shift-Tab doesn't do anything.\nInconsistency.\n. > I believe the 2-space indenting is, if anything, a fault in the xml mode.\nIt's not a fault in the xml mode. Just add the desired options and it works. http://codemirror.net/doc/manual.html#option_indentUnit\n\nDo you know what tabs are? They're not fixed spaces - their size varies depending on what column in the text they are. It's not a \"1 space char tab\" that gets inserted, it's simply a tab.\n\nWell, I missed my point here, yes.\nWhat I want to know is how do I insert a hard tab according to thetabSizeoption. So how do I skip the default tab algorithm?\nAnother thing I would like to know is how do I keep the desiredtabSizewhen I call thegetValue()function.\nWould be great if we can setgetValueTabSizeandgetValueIndentUnit. This way the user can set his own desiredtabSizeand keep the db data consistent.\nAlso, I couldn't figure out a reason to use different values fortabSizeandindentUnit. Anyone?\nIt would also be nice when thetabSizeandindentUnitvalue has changed therefresh()function could update the layout.\nI've created a little demo: http://jsbin.com/ihunin/68/edit#preview\nThe giventabSize/indentUnitfrom the code within the textarea is 4 spaces for 1 tab.\nNow, when I changetabSizeandindentUnitoption value from 4 to 8 or 16 the layout remains good.\nBut when i change the option values to 2 the layout gets messed up. Is this intentional or a bug?\nSo settingtabSizeandindentUnit to a lower integer then the original will break layout.\n. I think this is a mode related bug.\n- Open Chrome browser\n- Go to: http://codemirror.net/mode/xml/index.html\n- Press F12 to open console and run this codeeditor.setOption('indentWithTabs',true);editor.setOption('tabSize',4);editor.setOption('indentUnit',4);\n- Select the entire content in the editor withCtrl-Aand press theTabkey\n- Now pressShift-Tabthe indentation is broken. I also tested this with the same result at:http://codemirror.net/mode/javascript/index.html. The LESS mode seems to be fine. So it's probably a mode bug instead of a CodeMirror.js bug.\n- http://codemirror.net/mode/coffeescript/index.html breaks as well.\n. > If I follow your steps, pressing tab indents every line an extra tab, pressing shift-tab neatly and correctly re-indents the whole document using tabs instead of the default two spaces.\nhttp://codemirror.net/mode/xml/index.html\nEhh...no...\nThe</head>tag is aligned with the opening<title>tag. I think it should be oneTabless, not?\n. > They're not aligned..?\nThey are aligned, but not with the correct indentation.\nThe closing</head>tag is aligned with the opening<title>tag. I think that the closing</head>tag should have oneTabless.\n. But I think it's a mode bug because the LESS mode seems fine. I could be wrong...\n. In addition:\n- Moving the cursor 1 char to the right and you will be able to move the cursor up 1 or more lines.\n. In addition:\n- Note that the cursor position seems to be slightly too high on line 3 in equation on line 4\n. Thanks\n. Well, yes indeed, with this patch the cursor doesn't get stuck anymore :-) Excellent!\nWould be nice to see it getting a proper fix in the future.\nDoesn't this mess up/interfere the lineHeight feature you are building?\nPerhaps you are able to fix it along the way?\n. @skimberk1 \nLook at the LESS mode if you want SCSS.\nThe @ sign is like the $ sign, not? For declaring variables.\nI'l try to create a patch for that later today. \nSASS doesn't have the curly-braces. So this will require some more coding.\n. I get a 403\nhttps://dl-web.dropbox.com/get/Public/sample_template.xsl?w=3c2b1779\n\nIf you paste that into a code mirror and scroll quickly to the bottom and back to the middle of the template, you should notice that the editor does not finish loading / styling the editor and remains blank. If you scroll slightly up or down, the editor will then format properly.\n\nWhich browser? Opera?\n. Seems to work OK at: http://codemirror.net/mode/xml/index.html\nTested W732 Chrome, FF14+Nightly, Opera 12.5 Marlin\nWhat is your CM configuration, like do you use lineWrapping and or lineNumbers etc....\n. Ah JQuery UI.\nDo you have a page with several tabs?\nWhen you switch between editor(tabs) you might need to call the refresh() function\n. As an addition, I have also several tabs on my page but no JQuery UI and switching between editor/tab seems to work flawlessly. For me, there's no need for the refresh() function\nI've written my own lib to handle tab switching.\n. Are you able to provide a minimal demo at http://jsbin.com/ihunin/edit?\n. Thanks!\n. Thanks!\n. Tested on Chrome W732\n. Tested on Chrome W732\n. Thanks!\n. Your fix stops indeed the junping around in the editor.\nHowever I'm not able to select visibly any lines. Placing the cursor in the doc is not visible.\nI have the following settings:\n// The default configuration options.\n  CodeMirror.defaults = {\n    value: \"\",\n    mode: null,\n    theme: \"default\",\n    indentUnit: 4,\n    indentWithTabs: true,\n    smartIndent: true,\n    tabSize: 4,\n    keyMap: \"default\",\n    extraKeys: null,\n    electricChars: true,\n    autoClearEmptyLines: false,\n    onKeyEvent: null,\n    onDragEvent: null,\n    lineWrapping: true,\n    lineNumbers: true,\n    gutter: false,\n    fixedGutter: true,\n    firstLineNumber: 1,\n    readOnly: false,\n    dragDrop: true,\n    onChange: null,\n    onCursorActivity: null,\n    onGutterClick: null,\n    onHighlightComplete: null,\n    onUpdate: null,\n    onFocus: null, onBlur: null, onScroll: null,\n    matchBrackets: false,\n    workTime: 100,\n    workDelay: 200,\n    pollInterval: 100,\n    undoDepth: 40,\n    tabindex: null,\n    autofocus: null,\n    lineNumberFormatter: function(integer) { return integer; }\n  };\nThanks for all your comments.\n. I've made a little demo: http://jsbin.com/ihunin/83/edit\nIt's not the fastest way, especially not with large documents, but it should get you going.\n. And now with active line: http://jsbin.com/ihunin/85/edit\n. Which browser/platform?\nI've just tested in Chrome, Firefox latest stable versions.\nWorks fine. As well in IE9.\nW7\n. Which platform?\nI'm on Windows 7 and  it works fine.\nI altered the declaration of the i var a bit.\nLook here: http://jsbin.com/ihunin/88/edit\n. Trying to be more efficient: http://jsbin.com/ihunin/92\n- Place cursor via mouse on line 0 char 0\n- Press enter 10 times\n- Move upwards using the cursor key, press it 5 times\n- Press delete key -> line gets deleted and lineNumber persists\n2012/7/30 Marijn Haverbeke <\nreply@reply.github.com\n\nTry this for a version that's actually efficient:\nhttp://jsbin.com/ihunin/90/\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/668#issuecomment-7368584\n. > Probably the best solution is to define the same handler for onChange and onCursorActivity.\n\nI've already tried that and it is making things utterly slow.\nFor now my provided solution seems fine.\nNote: \nThis was what I came up with: http://jsbin.com/ihunin/94/edit\nJSBin got something called autosave, messed up my previous link.\n. Also note that I was trying to create less activity by adding if(currentLine != line){\nWhen the cursor is on the same line the gutter doesn't need to be updated.\nAs you can see the currentLine doesn't get updated with the current line value.\n. > I can't detect any slowness in http://jsbin.com/ihunin/95/edit\nRight, you nailed it :-)\n. This happens to me as well in Chrome after about 120 lines\n2012/8/6 gitbase <\nreply@reply.github.com\n\nUnfortunately if you keep enter key pressed for a while, it becomes slow\nin Firefox.\nI really hate firefox. my app has already started to become slow in\nFirefox, so probably I cannot implement this feature. Although thanks a lot\nfor this :)\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/668#issuecomment-7527537\n. Thanks\n\n2012/7/30 Marijn Haverbeke <\nreply@reply.github.com\n\nMerged.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/669#issuecomment-7368653\n. I can reproduce this on Chrome W732\nSo the problem is that the editor looses focus after the last [enter].\n. Right, I'll spend some time on it.\n\n2012/7/30 Marijn Haverbeke <\nreply@reply.github.com\n\nYeah, css is pretty limited for things like this.\nIf you can come up with a better solution, or want to create a gray arrow\nbackground (to be right-aligned in the span element) to use instead of the\narrow character, that'd be very welcome.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/673#issuecomment-7369338\n. I've came up with 2 css solutions.\nFirst one: make the tab very small\n\n.cm-tab::after {\n  content: \"\\21e5\";\n  display: -moz-inline-block;\n  display: -webkit-inline-block;\n  display: inline-block;\n  width: 0px;\n  position: relative;\n  overflow: visible;\n  left: -1.4em;\n  color: #AAA;\n  font-size: 6px;\n  vertical-align: middle;\n}\nSecond one: almost as the original, but with a different left property value and color\n.cm-tab::after {\n  content: \"\\21e5\";\n  display: -moz-inline-block;\n  display: -webkit-inline-block;\n  display: inline-block;\n  width: 0px;\n  position: relative;\n  overflow: visible;\n  left: -0.85em;\n  color: #9AE041;\n}\nThe last solution, makes it more easy to identify the character but it's very close the the next one.\nI prefer the second solution.\n. Or use the the arrow right \\2192 with left: -0.667em\n. That's what we need.\n. Are you able to make the tail longer?\nWhen using editor.setOption('tabSize',8);editor.setOption('indentUnit',8);or a greater number it gets kind of ugly..\n. Thanks.\n. In addition:\nI used the same settings as on http://codemirror.net/mode/javascript/index.html\nI just placed the entire codemirror.js file in the textarea and replaced < with &lt;\n. In even more addition:\nThis does not happen when you paste the lib in the editor. Scrolling seems fine then.\n. Update, I've altered the demo so that it's using the same codemirror.js file as on http://www.codemirror.net/\n. Fixed!\n. OK! Well, I din't try the theme demo.\nThanks for confirming.\n. This is what you are looking for\nhttp://codemirror.net/doc/manual.html#option_fixedGutter\n. Or: http://codemirror.net/doc/manual.html#option_lineWrapping\n. Mmm...this could also be handled with theextraKeysoption.\nSomething likeCTRL-Tab,to tab away from the editor.\n. Ctrl-TabandCtrl-Shift-Tabare already used by Chrome. Is CodeMirror able to override these? Have to test....\nAssuming that one uses tabIndex it is easy to switch to another element. Using optionextraKeys and add document.querySelector('[tabindex=' + (curIndex + 1) + ']').focus();\nHowever it is not sure if one uses tabIndexes, meaning my previous suggestion will break.\nI think it is a good option to be added. I still think you'll need theextraKeysoption to be able to tab in the editor and away from the editor.\n. > Note that mobile browsers are currently not supported, and no testing is being done on them.\nThis is worth mentioning on the CodeMirror website.\nFirefox & Opera both have mobile browsers.\n. I was planning to experiment with this myself. Gladd you did it! Saved me a lot of time :-)\nIE9 seems to be working OK. IE8 as well.\nI ran the test suite and no errors were given. Also opened up some modes. Looked OK.\n. I've downloaded the wrong files...so my previous post could be false.\n. I've downloaded the correct files.\nIE9 emulating IE8 does not fail on textContent. You need a real IE8 for that.\n. > Man I hate sysadmin work.\nHaha...:-)\nSorry to tell you, but IE7 is not fixed.\nmeasureEndOfLine: assertion failed (not at right)\nmoveV stuck: {line:0,ch:0} != {line:0,ch:26}\n2 failures\n. Thanks!\n. IE7\nverticalScroll: 110 != 100\nwordMovementCommands: {line:1,ch:8} != {line:1,ch:9}\n2 failures\nIE8\nwordMovementCommands: {line:1,ch:8} != {line:1,ch:9}\n1 failure\n. Opera W732\nwordMovementCommands: {line:1,ch:8} != {line:1,ch:9}\n1 failure\n. Firefox 15 BETA\nwordMovementCommands: {line:1,ch:8} != {line:1,ch:9}\n1 failure\n. Well...textContent doesn't exists in IE78 so your code will break.\nHowever we can hack IE78 like this:\nif(Object.defineProperty && Object.getOwnPropertyDescriptor && !Object.getOwnPropertyDescriptor(Element.prototype, \"textContent\").get){\n    (function(){\n        var innerText = Object.getOwnPropertyDescriptor(Element.prototype, \"innerText\");\n        Object.defineProperty(Element.prototype, \"textContent\", {\n                get : function() {\n                    return innerText.get.call(this);\n                },\n                set : function(x) {\n                    return innerText.set.call(this, x);\n                }\n            }\n        );\n    })();\n}\nThis will work on IE8, have to test IE7.\n. > innerText is not the same as textContent.\nWhat is the difference then? The hack I provided for IE78 does the job for\nme.\n2012/8/4 Pavel Feldman <\nreply@reply.github.com\n\ninnerText is not the same as textContent. I did not know IE was missing\nit. It could be implemented as removeChildrenAndAdd(parent,\ndocument.createTextNode(text)). I'll introduce setTextContent(el, text) to\nmitigate it.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/698#issuecomment-7505249\n. > innerText could collapse / trim your whitespace. See\nhttp://stackoverflow.com/questions/1359469/innertext-works-in-ie-but-not-in-firefox\n\nAlso, innerText preserves lineBreaks:\nhttp://www.davidtong.me/innerhtml-innertext-textcontent-html-and-text/\n2012/8/5 Pavel Feldman <\nreply@reply.github.com\n\nOn Sun, Aug 5, 2012 at 1:23 AM, Peter Kroon <\nreply@reply.github.com\n\nwrote:\n\ninnerText is not the same as textContent.\n\nWhat is the difference then? The hack I provided for IE78 does the job\nfor\nme.\ninnerText could collapse / trim your whitespace. See\n\nhttp://stackoverflow.com/questions/1359469/innertext-works-in-ie-but-not-in-firefox\n.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/698#issuecomment-7508082\n. Look at the Lazy Mode Loading\n. > Let me guess, you used insertAdjacentHTML because of your \"innerHTML is bad\" rule?\n\nNo, I don't think innerHTML is bad.\n\nCorrect me if I'm wrong, but is there any way in which insertAdjacentHTML is less XSS-prone than innerHTML? They both >take HTML, parse it, and add it to the document.\n\nYes, they both take html.\nIE takes js as well. insertAdjacentHTML only takes html + css(not in IE)\n. I've been updating the onMouseWheel implementation and stumbled on some code which doesn't make a lot of sense to me. I'm making the customScrollSpeed(not yet implemented) optional and I'm in the process of rewriting some of the code in this pull. I filed the related issue here: Issue #710\n. Thanks, got it now :-)\n. > I suspect that'd be more robust and future-compatible.\nOpera doesn't raise an error for function setDragImage even when it's not supported -> 27-08-2012.\nIE does.\n. > Opera doesn't raise an error for function setDragImage even when it's not supported -> 27-08-2012.\n\nIE does.\n\nMeaning that the feature-check is needed as provided in the patch.\n. > I'm confused. What error?\nWhen there's no feature-detect or browser-check, IE raises an error.\n\nDo you mean old Opera versions have non-working setDragImage method?\n\nCurrent Opera 12.01 on W7, yes\n\nWhat would be wrong with using if (e.dataTransfer.setDragImage) instead of if (gecko || chrome), \n\nNothing, just how I provided the patch.\n. Read more about this here\n. Thank you for that.\n. Pasting via right click menu works OK!\nCutting doesn't\nEdit: cutting does work when norton finished updating and restarted the system...\n. Appears to be working in Chrome 21.0.1180.83 m W732\nDoesn't work in Firefox 15 W732\n- Open Firefox browser\n- Go to: http://codemirror.net/3/mode/less/index.html\n- Place cursor on line 5 via mouse\n- When right clicked the select all is disabled\n- When selecting line 6-9 via mouse and right click on the selection the select all is clickable.\n. Sorry about that.\nChrome stable W732\n. OK, I'll post a video?\nWould that help?\n. I know you believe me. I just thought when you would see it happen it might ring some bells.\nI'll investigate some more on this.\n. I can no longer reproduce this.\nIt was not a similar sympton like #801 Right now cm behaves like #801 except the starting position is the bottom.\nI was able to reproduce this issue not so long ago(10-14 days)\nChrome stable W732\n. What I can reproduce is:\n- Place cursor via mouse on line 5\n- Ctrl-A -> Ctrl-X -> Ctrl-V\n- The content is not entirely visible, one needs to scroll down a bit. Line 707 is the last visible line\n. What I can also reproduce is:\n- Place cursor via mouse on line 5\n- Ctrl-A -> Ctrl-X -> Ctrl-V\n- Scroll the scrollbar via mouse to scrollTop=0 and beyond and the scrollbar jumps down to line 583\n. @marijnh Sorry about that, latetst stable Chrome, Chrome mode LESS [V3], Windows 7 32 bit\nJust double checked and was able to reproduce my steps plus result as mentioned in my last 2 posts\n@rahulchaturvedie You are right, but can you reproduce on the demo's at the website?\n[V2] -> http://www.codemirror.net/\n[V3] -> http://www.codemirror.net/3/\n. @marijnh \nhttps://github.com/marijnh/CodeMirror/issues/757#issuecomment-10155632 appears to fixed! :-)\nhttps://github.com/marijnh/CodeMirror/issues/757#issuecomment-10155697 still reproduceable\n. > I could reproduce your first test case, but couldn't see the thing where the scrollbar jumps as you drag it up.\nJust to be more clear: The matter occurs when the cursor is above the scrollbar not when the cursor is ON the scrollbar.\n. OK, I'll try again :-)\n- Go to: http://codemirror.net/3/mode/less/index.html\n- Place the cursor on line 5 via mouse\n- Ctrl-A -> Ctrl-X -> Ctrl-V\n- Drag the scroll-bar via mouse upwards\n- When you are unable to scroll upwards, meaning you've reached the top, keep on dragging upwards.\n- The scroll-bar should drop/scroll to the bottom of the editor but it doesn't \n. > (the precise height of the content isn't known until it has all been scrolled into view at least once,\nYou are scrolling from bottom to top, so the content has been scrolled once.\n. @bfrohs it's a Windows thing and it's regression as well. What's a vanilla textarea?\n. @marijnh @bfrohs \nFor what it's worth: the UI windows behaviour occors only on WebKit based browsers.\nI tested this on Chrome, Safari, Maxthon.\nOS: W732\n. Can't see the result at: http://codemirror.net/3/demo/mustache.html yet.\n. Ah, ehmmm, not really...\nHow can I do this?\n. Thanks!\n. Thanks!\n. Awesome!\n. I think this shouldn't be too hard to create.\nAlso look at the Match Highllighter demo\n. Mode CoffeeScript also shows some similar behavior\n. This is probably related to issue #779\n. OK, can you reproduce on Chrome 21.0.1180.89 m?\n. Yeah, also: cm.info('type') //returns stable or development snapshot\n. > This seems to be the way scrollbars work on Windows (at least in Chrome).\nDidn't know that.\n. Look here: http://jsbin.com/ohuraq/7/edit\nCodeMirror is allowing multiple event listeners now.\nWorks for me on 21.0.1180.89 m W732.\n. The error in console:\n```\nUncaught ReferenceError: options is not defined  codemirror.js 1119\nfunction drag_(e) {\n      if (options.onDragEvent && options.onDragEvent(cm, addStop(e))) return;\n      //Uncaught ReferenceError: options is not defined (repeated 122 times)\n      e_stop(e);\n    }\n```\n. Thanks!\n. I'm still able to reproduce my issue.\n. That's not it.\nI think your patch doesn't work.\nFollow the steps in my first post.\nFor me this issue is still reproducible.\nChrome stable\n. > The paths in your demo are bogus. if you set base to codemirror.net/3, you shouldn't be using ../../ in your links.\nOuch..\n\nYou could look into the indent method in xml.js if you want to fix that. (But if you submit a patch, please do so against the proper branch this time.)\n\nYou mean [v2]?\n. > Your past pull requests had a zillion irrelevant commits in them.\nNo idea where those came from it was branch v3 and I created a new\nbranch/patch based on the latest v3.\n2012/9/28 Marijn Haverbeke notifications@github.com\n\nI mean whatever you base your origin file on. Your past pull requests had\na zillion irrelevant commits in them.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/844#issuecomment-8974839.\n. OK, I've got it solved now(the commit thing).\n. Looks like only the cdata opening tag will align properly when alignCDATA: false\nWhatever is inside and the closing tag don't.\n. Fixed in #864\n. Sorry, it's not fixed.\n. Works for me as well.\nHowever typing in the editor in Opera is now slow, just as slow as it used to be a while ago in FireFox.\n. Thanks!\n. I have no linux, and was unable to reproduce...\nCould it be a browser issue only?\nI've set up a demo with only 2 textarea's and the submit button.\nhttp://jsbin.com/azurod/3/edit\n. I can reproduce on Firefox stable.\nW732\n. Unable to reproduce on Chrome stable W732\n. Unable to reproduce on Opera stable W732\n. Why not call it ambiance-mobile as it's optimized for mobile.\n. Fixed.\n. Now it has a lower height. Perhaps line-height: inherit will do a better job?\n. This works on my end: if (zwspSupported || opera) return elt(\"span\", \"\\u200b\");\n. Never mind just downloaded your fix.\n. @Leonya unable to reproduce on W732. Which OS are you on? Which demo/mode?\n. I'm able to reproduce now.\n- Go to: http://codemirror.net/3/demo/theme.html\n- Switch to theme solarized light\n- Copy/Paste the content in the editor a couple of times\n- The gutter background remains original height\n\nOS: W732\nEdit: I was unable to reproduce because I was looking at theme monokai\nhttp://codemirror.net/3/demo/theme.html?monokai\n. Not sure if you ran the test suite as well:\ncore_measureEndOfLine\nassertion failed (not at top)\ncore_moveVstuck\n{line:0,ch:28} != {line:0,ch:26}\n. Please provide the typed line which caused bogus behavior.\n. > if I click in the middle of a line, the cursor is drawn one character to the left of its actual position.\nI can reproduce this when clicking in the middle on line 8.\nBut I can't reproduce this at: http://codemirror.net/3/mode/less/index.html\n. ....place cursor via mouse at the end of line 197.\nCharacters are not added when typing.\nhttp://codemirror.net/3/mode/less/index.html\n. The difference would be noticeable in the gutter. The marks are placed on the left side in Opera and on the right side in Chrome. Also the Chrome layout has a wider gutter. \n. > The above patch should fix them (do double-check, if you have a moment).\nIt appears to be fixed, however:\n- Go go: http://codemirror.net/3/demo/visibletabs.html\n- Place cursor on line 11 at the end\n- Ctrl-] a new tab is inserted but it's inserted before the closing bracket and not after it\n- Feels like a bug to me\n\n(Thanks for finding all these bugs, by the way!)\n\nWell.....It's about that time....\n. > Ctrl-] is bound to indentMore. Indentation happens at the start of the line. If you want to insert a tab, use the tab key.\nOK\n. twilight is not on v3\nsolarized are not on v2\n2012/11/16 Marijn Haverbeke notifications@github.com\n\nCould you maybe be a little more specific? What's the problem?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/981#issuecomment-10441804.\n. > Solarized hasn't been ported to v2.x yet. You're welcome to do that.\n\nWhen will v3 be released, will that stop v2?\n. I'll leave it as it is for now.\n. > Is that the only one that failed? That's good news.\n\nIt is!\nCan you somehow output what value scrollbarWidth gets on that platform?\nI'll try to do this upcoming week.\nIt's not my iPAD unfortunately.\n\n2012/11/23 Marijn Haverbeke notifications@github.com\n\nIs that the only one that failed? That's good news.\n. Just tested and there is no scrollbar visible at all.\noutput of scrollbarWidthis0.\n\nNew fail: only occurs the first time when cached is cleared\ncore_scrollSnap\nassertion failed (scrolled clean to top)\n. Now another failure arises after #1105 \ncore_movebyTextUnit\n{line:0,ch:9} != {line:1,ch:0}\n. I didn't know Github's ace editor normalized the accents.\nGood to know as I was using the browser interface for this one.\n. I've got this covered in the new LESS/SCSS mode/theme. \nRight now , I'm trying to make this work with css only as well (Work in progress....).\nLook here: http://5060.nl/codemirror/CodeMirror-3/mode/less/index.html\nLine 227\n. Don't merge this yet. I've got a better one coming up.\nThanks.\n. Thanks.\n. Copy & paste works fine in the current stable release 12.12\nOS: win7 32 ultimate\n. Linux Fedora 8 x86\n. Linux Fedora 8 x86\n. Thanks!\n. I could also reproduce this with Opera stable, w7 32 ultimate\n. This problem still occurs although #1075 has been fixed & closed.\n. Thanks!\n. The jump is gone :-)\nChrome stable w7 32 ultimate\n. No problem in Chrome stable w7 32 ultimate.\nI did:\n- Open Chrome browser stable\n- Go to: http://codemirror.net/mode/javascript/index.html\n- Placed cursor via mouse on line 8, hit enter and copied \u0645\u0631\u062d\u0628\u0647\u0627 \u0645\u0647\u0627!(what does it mean?)\n- Moved the cursor on line 10 via cursor keys and then Shift-arrow-key-up multiple times to create a selection\n- I've encountered no problems\n. Crome stable w7 32 ultimate\n. > Now how many characters does your line have?\n112807\n\nWhen you paste it into a textarea in Chrome, does it paste correctly?\n\nYes, just tested here: http://www.javascriptkit.com/script/script2/charcount.shtml\n. CodeMirror chops of a lot.\nOf the 112807 only 47270 chars remain.\n. Line with 122981 chars can be found here: http://pastebin.com/MYBMKX4C\nOpera freezes and crash when pasting(W7 32 ultimate).\n. Thanks for fixing and updating this!\nHowever, when pasting the same long line in Opera stable(w7 32 ultimate) makes Opera freeze..\n. The long line: http://pastebin.com/MYBMKX4C\n122981 chars\n. > Now try it the other way round -- first ctrl-v (on a blank line), and then ctrl-a, ctrl-v. If that flips the effect around (now the ctrl-a, ctrl-v is fast), you're seeing a caching effect -- the layout of your long line is cached, so it doesn't have to be recomputed, which is why the second paste is faster.\nOK so what I experience is default behaviour?\nEdit: the caching is a neat feature!!\n. I'm trying to figure out a way in which people will use the testsuite.\nI don't think it will confuse people in their bug report.\nYou'll end up with a bug report regarding the bug and the testsuite(if any).\nSounds like a win win situation to me :-)\n. > But why would I need users to run the testsuite? It's a tool for development.\nYes, it's a tool for development, and everybody here is forking on CodeMirror.\nSo running the testsuite should not harm the users.\nThe thing is that I get the impression that I'm the only one reporting bugs for the testsuite and fixing those have solved some issues for me. In some browsers the testsuite runs fine in others it has failed. Perhaps I'm the only one using CodeMirror in a non Chrome browser as well.\nRunning the testsuite will do good on CodeMirror.\n. Try\n.CodeMirror {\n    height: 100%;\n}\n. Interesting.\n. http://my.opera.com/ODIN/blog/300-million-users-and-move-to-webkit\n. Alright, and then check if it's fixed.\n. Opera Next(beta) has been released with Chromium.\nThe reported still remains. Regardless of zoom.\nDownload here: http://my.opera.com/desktopteam/blog/\n. Side note: GET http://codemirror.net/mode/markdown/markdown.css 404 (Not Found) when I open http://codemirror.net/mode/gfm/index.html\n. I can reproduce this.\n@marijnh copy&paste the provided paste example in http://codemirror.net/mode/gfm/index.html, no dropbox account needed.\nchrome stable w7 32 ultimate\n. #580\n. I've tried adding the image to the wrapper but then for some reason Opera fails to find/use it. When I've tried to add it on the wrapper the element was given no id.\nIt needs to be added to the documentElement. I've given theimgan unique id which will hopefully not interfere with other programs.\n. > Why is it so important to call setDragImage?\nDragging code with CodeMirror in Opera looks like crap. It uses an image from the entire editor.\n\nDumping nodes into the document doesn't seem very attractive.\n\nCorrect, but it works for now. I've tried adding the img element on the wrapper but then Opera fails to use it.\n. Actually ,only 1 node is dumped into the document for all editors.\n. Heh, I've tried this with multiple editors and the image of the entire editor is used.\nStrange, console.log tells me that image 'CodeMirror-Opera-setDragImage' is being used...\n. When I use an image in the DOM which is not created viadocument.createElement only the first editor wil use that image and the others will use an image of the entire editor.\n. @danyaPostfactum\nI saw here: http://help.dottoro.com/ljdpgfkx.php thatsetDragImagewas working(also note that Opera supportsevent.dataTransfer.addElement...awesome!).\nThe workaround has been created by me.\n. Not fixed, still occurs in Opera.\n. - Go to: http://codemirror.net/demo/theme.html?solarized%20dark\n- Make a selection en drop it on it self\n- Same result as on the LESS mode.\n. The editor looses focus as well regarding of selection color.\n. Latest v3.1 is here that I used to try for reproducing.\nI was unable to reproduce.\nHow did the cursor get on the first column of the last line?\nPlease provide steps.\n. Did you try callingeditor.refresh()when the editor opens?\nhttp://codemirror.net/doc/manual.html#refresh\n. @schanzer I could reprocuce this by selecting line 6 to 7\nTry a bigger selection: start on line 3 and end on line 15 or do aCtrl-A\n. The editor jumps with the LESS mode as well.\nSelect line 5 to 20 via mouse.\n. @bfrohs All except the borders.\n. > Jumps to the right, and then comes back after a second?\nNope, it jumps up and down real fast as in #1182\n2013/1/26 Brandon Frohs notifications@github.com\n\nJumps to the right, and then comes back after a second? (Curious if it's\nthe same issue someone just reported to me when using v2.)\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/1188#issuecomment-12726323.\n. This was not a real IE8\n. Thanks!\n. @RaymondLim \nA few months ago I was working on a upgrade of the LESS mode(not finished).\nLook here: http://5060.nl/codemirror/CodeMirror-3/mode/less/index.html\nI've fixed the bug you mention in your first post in the upgrade.\nThe second one is new and needs to be fixed.\nAnother bug in the upgrade version is when you place cursor on line 159 between E``[and add a space and a character the color changes of E. This is incorrect behaviour.\n\nWith this upgrade version there is more dynamic highlighting of the code. The goal was/is to make a more professional theme and integrate SCSS which doesn't exists in the repository yet.\nI'm able to look at fixing the mentioned bugs upcoming week or the week after that.\n. I thought I would have some time to fix it this week. But no.\nMaybe next week.\n. Fixed with: #1805 \n. Fixed!\n. Fixed with: c2f2f34b6cedebf0a1ade910e17c438e2ae49623 or chrome update\n. Unable to reproduce on Ubuntu 13.04 Chrome stable 32 bit\n. got 1 message:\ncore_rtlMovement\nassertion failed (moved right)\n. It's better to look at the video I've made which says it all:\nhttps://www.dropbox.com/s/2jao1h9vokxpayz/video-2013-12-12-14-58-07.mp4\n2013/12/12 Marijn Haverbeke notifications@github.com\n\nDrag selection from bottom left to visible top right and drop\nWhere exactly are you dragging it? At this point, I have everything\nselected, so dropping anywhere is a no-op (a selection dropped on itself\ndoesn't cause anything to happen.)\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/1858#issuecomment-30421427\n.\n. Chrome stable w7 32 bit\n\nGo to: http://codemirror.net/mode/css/index.html\nSelect via mouse from top left to the very bottom left. The editor should have scrolled.\nDrag selection from bottom left to visible top right and drop.\nOn drop the editor jumps.\nIt occurs randomly.\nDoesn't matter if you drag down or up as long as you drag and drop in the viewport as demonstrated in the video.\n. No, It's gone.\n. > you can open almost no .less file with this.\n@soliton4 Could you provide some example code?\n. I have pasted the file in CM. Browser Chrome stable w7.\nNo crashing here.\nHowever I did notice a \"match brackets\" issue?\nAll closing brackets appear to be present.\nWhat are the exact steps to reproduce crash?\n. Reproduced.\nThe issue is the single spaced dot.\nUnfinished class declaration.\nWill provide a fix.\n2013/11/4 soliton4 notifications@github.com\n\nsorry the file grew and now it passes.\nbut i can reproduce the bug using this file:\nhttps://github.com/soliton4/nodeMirror/blob/master/src/test/test2.less\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1926#issuecomment-27673552\n.\n. Although the mode has issues, please report them.\nSo I can fix them properly. I will...I've invested a lot of time in the LESS mode....Thanks!\n\nI've started to merge SCSS in the LESS mode. Things are going well.\nCurrently using LESS mode as my main CSS editor and working on a way to raise an error when nesting occurs.\n. Why did you not merge df058fa. Makes more sence.\n. OK, I thought if I went beyond the stream.string I would get undefined.\n. The undefined is given when calling stream.current() after the stream.backUp(5)\n. Do you mean I can't backUp further then the stream.current().length?\nIn the provided example the stream.current().length= 2 and stream.column() = 14\nI thought I was able to go beyond the length of the stream.current()?\n. #2028 should be better now with improved colorizing of code.\n. Hi Marijn,\nLooks like you've merged the branch already.\nI'll have a detailed look and answer later.\nBest,\nPeter\n. Thanks.\nBut now the string isn't highlighted at all...\n. Most likely related to feature add on: #2049\n. > Let me know whether it works for you.\nNo\nPlace cursor via mouse after url(and press Enter the cursor has move 2 tabs instead of 1.\n. Sorry, it works.\nChrome's caching can be a pain sometimes...\n. Works fine.....\nAfter hard refreshing 4 times the test succeeded.....\nCaching ..\n. Yes, Thanks.\n. Patch ed7f8d0 did not fix this.\n. Nope\n. I'll leave it for now.\n. Thanks!\njavascript\neditor.on(\"focus\",function(){alert('hi')});\nWorks like a charm.\n. Seems to fail when:\n- Go to: http://codemirror.net/demo/closetag.html\n- Open console and run editor.setOption(\"tabSize\",\"4\"); and editor.setOption(\"indentUnit\",\"4\");\n- Close the html tag and type div\n- The cursor is indented way to far\n. The described problem only occurs when editor.setOption(\"indentUnit\",\"4\"); is set to some value other then 2.\nAdjusting the tabSize doesn't affect indentation.\n. When setting the replacerstring to it's original value \"\\n\\n\" and doing indentation like \nif (doIndent) {\n  cm.indentLine(pos.line + 1);\n  cm.indentLine(pos.line + 1);\n  cm.indentLine(pos.line + 2);\n}\nprovides the same wrong indentation.\n. When I look via webinspector(Chrome) and set the replacerstring value to \\n\\t\\n I can see that \\t isn't recognized as a tab but as space.\n. > You're setting an integer option to a string. Don't do that.\nAh yes, I see..\n\nWhat was the original pull request supposed to accomplish?\n\nWhen closing the opening html tag the empty line did not indent.\n. Patch d99da21fe85ac965b8ddc57b5daaa21104d650c9 fixed my issue.\n. This does add a signal and I'm able to do simple functions.\nHowever when adding a listener like below the e.detail and e.wheeldelta aren't provided.\nFor some reason it's limited.\n``` javascript\neditor.on(\"mousewheel\",function(e,cm){//begin custom function\n  var y = 'wheelDelta' in e ? -e.wheelDelta : 40 * e.detail; // e.detail -> firefox\n  //when top or bottom is reached of the scroller, do not scroll the window, editor needs to have scrollbars\nvar scroll = cm.display.scroller;\nif (scroll.scrollHeight > scroll.style.height.replace('px','')) {\n    if (scroll.scrollTop == 0 && y < 0)CodeMirror.e_stop(e);\n  }else if (scroll.scrollHeight - scroll.clientHeight == scroll.scrollTop && y > 0)CodeMirror.e_stop(e);\n});\n```\nI guess, it's a lot more work to get this going.....\nIn order to access cm I've adjusted the signal function to signal(cm, e.type, cm, cm); which prevents the undefined message and doesn't make it work.\n. Chrome stable.\nWith the code below I can get the scroll event but there's no wheelDelta\n``` javascript\neditor.getScrollerElement().onscroll = function(e){\n  console.log('wheelDelta' in e);\n};\n``\n. I don't know why i usedonscroll` in my previous code. Rather silly of me.\nYou provided code works.\nDo you know how I can get cm in my preventScroll function?\n``` javascript\n(function() {\n  \"use strict\";\nCodeMirror.defineOption(\"scrollEditorOnly\", false, function(cm) {\n    CodeMirror.on(cm.getScrollerElement(), \"mousewheel\", preventScroll);\n    CodeMirror.on(cm.getScrollerElement(), \"DOMMouseScroll\", preventScroll);\n  });\nfunction preventScroll(e,cm){\n    var y = 'wheelDelta' in e ? -e.wheelDelta : 40 * e.detail; // e.detail -> firefox\n    //when top or bottom is reached of the scroller, do not scroll the window, editor needs to have scrollbars\n        console.log(e);\n    var scroll = cm.display.scroller;\nif (scroll.scrollHeight > scroll.style.height.replace('px','')) {\n  if (scroll.scrollTop == 0 && y < 0)e_stop(e);\n}else if (scroll.scrollHeight - scroll.clientHeight == scroll.scrollTop && y > 0)e_stop(e);\n\n}\n})();\n``\n. Right, would be a good feature.\n. Thanks!\n. The minus-sign work on my system will only work when I use the numpad.\nNumpad keycode =109Keyboard keycode =189`\nUsage:\n``` javascript\nextraKeys {\n  \"Ctrl--\": function(cm) {\n    //keyCode 109 works but 189 doesn't \n  }\n}\n```\n. Sorry about that. The minus and equal sign won't work in latest Firefox stable. Window7 32bit\nI'm not sure if I should file a bug at mozilla for this.\n. Interesting and not what you would expect. Fortunately is was an easy fix :-)\n. I prefer not to...\nI tried the code below and it works like I want and just one scan.\njavascript\noption(\"extraKeys\", null, function(cm) {\n  var ek = cm.options.extraKeys, totKeyComb;\n  if (ek) {\n    for (var k in ek) {\n      if (k.match(' ') !== null) {\n        totKeyComb = k.split(' ');\n        for (var i = 0; i < totKeyComb.length; ++i) {\n          ek[totKeyComb[i]] = ek[k];\n        }\n        delete ek[k];\n      }\n    }\n  }\n}, false);\n. Is it possible to override option extraKeys with defineOption?\nHaven't tried it yet.\nAlso I've noticed that when I press the letter a in a CodeMirror instance function allKeyMaps is called twice.\nWould it not be cheaper to store the generated map in a var instead of generating it twice on each character insertion?\nI guess a listener must be added when extraKeys or keymap is called via setOption or fromTextArea or addKeyMap or removeKeyMap.\n. This is how I solved it.\n``` javascript\n(function() {\n  \"use strict\";\nCodeMirror.defineOption(\"CustomExtraKeys\", true, function(cm, val) {\n      if (val) {\n        var ek = val, totKeyComb;\n        for (var k in ek) {\n          if (k.match(' ') !== null) {\n            totKeyComb = k.split(' ');\n            for (var i = 0; i < totKeyComb.length; ++i) {\n              ek[totKeyComb[i]] = ek[k];\n            }\n            delete ek[k];\n          }\n        }\n        cm.setOption('extraKeys', ek);\n      }\n    }\n  );\n})();\n```\nthis allows markup like\n``` javascript\nextraKeys: {\n  \"Ctrl-0 Ctrl-1 Ctrl-2\": function() {\n    //do something here\n  }\n}\n```\n. Chrome woks in this case fine.\n. I was able to reproduce this on with Opera Presto on ubuntu as well.\nWould this be an easy fix?\n. Yes, don't override a default key setting.\n. > Why is that incorrect?\nI've explained that in my post.\n\nThe editor is still focused (if I type, text appears), so it should have a blinking cursor.\n\nNo the editor gets focus because the clearInterval never gets executed when onBlur is called when switching browser tabs.\n. Test-case run in location bar:\nhtml\ndata:text/html,<textarea></textarea>\nWhen re-focusing the the tab the cursor starts to blink in the textarea because it is also re-focused.\nSo this is default html behaviour.\nEither way, with all of the code above I've made CodeMirror more pleasant to code with.\nAnd I was wrong. The clearInterval does clear the blinker.\n. Yes, there is still a problem and not yet located or well explained.\n. @marijnh \nhttps://github.com/marijnh/CodeMirror/issues/2115#issuecomment-31731752\n\nThe browser knows this, but doesn't expose this information to JavaScript.\n\nHave you considered filing a bug for this at https://bugzilla.mozilla.org/ or https://code.google.com/p/chromium/\n. Thanks!\n. What's the thought behind that? Do you know?\n. Never mind\n. Seems fixed in scss as it has the same behaviour as css.\nLESS doesn't indent.\nThanks.\n. Could you provide more steps on how to get to your issue?\nNote that this LESS mode will be deprecated eventually.\nThis is LESS mode merged with the css mode\nAre you indenting .blah intentionally?\n. I used the same indentUnit as in your given snippet via console with the code below:\njavascript\neditor.setOption('indentUnit',4);\nPlaced the cursor via mouse at the end on line 3 and pressed Enter.\nIndentation works fine and matching brackets as well.\nBoth editor work fine.\nhttp://codemirror.net/mode/less/index.html\nhttp://codemirror.net/mode/css/less.html\n. I'm using the XML mode for my XSLT data.\nAs you may know:\nhtml\n<pre>\nText in a pre element\nis displayed in a fixed-width\nfont, and it preserves\nboth      spaces and\nline breaks\n</pre>\nAnd whenever I do Shift-Tab on my xslt to correct indentation the layout changes.\nThis is good but not for the pre tag.\nExample. Code below:\nhtml\n<tag_0>\n  <tag_1>\n    <pre>\n@font-face {\n  font-family: 'customfont';\n  src: url('webfont.eot');\n  src: url('webfont.eot?#iefix') format('embedded-opentype'),\n       url('webfont.woff') format('woff'),\n       url('webfont.ttf') format('truetype'),\n       url('webfont.svg#customfont') format('svg');\n  font-weight: normal;\n  font-style: normal;\n}\n    </pre>\n  </tag_1>\n</tag_0>\nthe outcome will be:\nhtml\n<tag_0>\n  <tag_1>\n    <pre>\n      @font-face {\n      font-family: 'customfont';\n      src: url('webfont.eot');\n      src: url('webfont.eot?#iefix') format('embedded-opentype'),\n      url('webfont.woff') format('woff'),\n      url('webfont.ttf') format('truetype'),\n      url('webfont.svg#customfont') format('svg');\n      font-weight: normal;\n      font-style: normal;\n      }\n    </pre>\n  </tag_1>\n</tag_0>\nSo there are 2 options.\n1. Ignore everything in the pre tag when Shift-Tab. Don't indent in any way.\n2. Indent the block of code inside the pre tag without re-formatting. This means that the code:\nhtml\n<tag_0>\n  <tag_1>\n    <pre>\n@font-face {\n  font-family: 'customfont';\n  src: url('webfont.eot');\n  src: url('webfont.eot?#iefix') format('embedded-opentype'),\n       url('webfont.woff') format('woff'),\n       url('webfont.ttf') format('truetype'),\n       url('webfont.svg#customfont') format('svg');\n  font-weight: normal;\n  font-style: normal;\n}\n    </pre>\n  </tag_1>\n</tag_0>\nremains as is or becomes:\nhtml\n<tag_0>\n  <tag_1>\n    <pre>\n      @font-face {\n        font-family: 'customfont';\n        src: url('webfont.eot');\n        src: url('webfont.eot?#iefix') format('embedded-opentype'),\n              url('webfont.woff') format('woff'),\n              url('webfont.ttf') format('truetype'),\n              url('webfont.svg#customfont') format('svg');\n        font-weight: normal;\n        font-style: normal;\n      }\n    </pre>\n  </tag_1>\n</tag_0>\nwhich is usefull when the pre tag is inside a lot of tags and you want to prevent scrolling to the left and back to the center of the page all the time. I call it fake pre tag indentation.\n. > That is what cbce0ff fixes for the HTML mode\nMmmm...\nIf the HTML mode is suppose to leave the pre tag alone then pressing Enter after the pre tag should not indent at all.\n- Go to: http://codemirror.net/mode/xml/index.html\n- Open webconsole and run editor.setOption('mode',{name: \"xml\", alignCDATA: true, htmlMode: true});\n- Paste code below in editor and Enter after opening of the pre tag\n- The cursor should be at the beginning0 of the line and not be indented\nDo you agree?\nhtml\n<tag_0>\n  <tag_1>\n    <pre>\n. OK, I'll come up with something.\n. I'm still working on this. But didn't had the time to provide a pr yet.\n. > How can shift-tab indent text that we don't know the correct indentation of?\nHow could the text be TAB indent if you don't know the indentation?\nWould this be a bug then?\n. Ah, Shift-Tab does a re-formatting with the correct indentation.\nCtrl-[ re-indents whatever's been selected.\nThanks!\n. Indeed, this is a to do.\n. Nice.\n2170\n. There's a lot more work to it. Closed for now.\n. The cropping was intentional btw.\nThanks for merging!\n2014/1/22 Marijn Haverbeke notifications@github.com\n\nMerged, but with the giant inline URL reduced to a saner size by using a\nproperly cropped and compressed png.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2166#issuecomment-33042576\n.\n. I'm talking about the script tag not the code inside the tag.\nHowever I did noticed when doing Shift-Tab twice the script tag will indent. Not on the first Shift-Tab.\n. Remove all content in the editor and paste code below in editor.\nThen do Ctrl-A => Tab => Shift-Tab, script tag will not indent......Shift-Tab now indentation of the script tag is correct.\n\nhtml\n<html style=\"color: green\">\n  <!-- this is a comment -->\n  <head>\n    <title>Mixed HTML Example</title>\n    <style type=\"text/css\">\n      h1 {font-family: comic sans; color: #f0f;}\n      div {background: yellow !important;}\n      body {\n        max-width: 50em;\n        margin: 1em 2em 1em 5em;\n      }\n    </style>\n  </head>\n  <body>\n    <h1>Mixed HTML Example</h1>\n    <script type=\"javascript/worker\">\n      function jsFunc(arg1, arg2) {\n        if (arg1 && arg2) document.body.innerHTML = \"achoo\";\n      }\n    </script>\n  </body>\n</html>\n. Happens in Chrome stable + canary and FireFox Nightly\n. Almost,\nYou will see when Ctrl-A and then repeat tab, you'll note that at a given point the selection is again without padding without the horizontal scrollbar\n. Looks good. Thanks!!\n. It fails in V4\n. Do select all and repeat Tab  or Ctrl-] 'till you've got a horizontal scrollbar.\nThe selection doesn't cover all the code.\nTested on: http://codemirror.net/4/\n. Fixed.\n. Ah here it is: https://github.com/duralog/CodeMirror/blob/master/mode/livescript/LICENSE\n. FireFox stable window 7 32 bit\n. V3 only\n. >  What does suggesting a scrollbar without actually showing it look like?\n\n. I can't reproduce this on FF ubuntu as well.\nLooks like it's Windows specific\n. If you don't want to style brackets then remove styles.\nI guess it's better to make it optional....\n. Hi Marijn, Good that you picked this up.\nLooks like the Travis build has failed but the test suite seems fine: http://codemirror.net/test/\n. Tested Firefox windows 7 32 bit\n. mmm...\nWorks OK without the quote on JSBin: http://jsbin.com/kuyegava/1/edit\nRemoving the quotes at:http://codemirror.net/demo/bidi.html gives me the same result.\n. Ah, the last forward slash confuses the mode, it's not a closing tag.\n<a href=../theme/>\n. Adding a space bertween /and > gives the expected behaviuor.\n<a href=../theme/ >\n. Actually the last forward slash is blue.\n. Looks like the css mode.\nWhen adding quotes on the url value no errors are raised.\n. Look here: http://codemirror.net/mode/htmlmixed/index.html\n. https://github.com/zhusee2/codemirror-composition-mod\nedit: it's interesting but not really sure if it helps.....\n. http://codemirror.net/doc/manual.html#refresh\n. Why not make readOnly as an addon?\n. And it would be out of the core..\n. https://developer.mozilla.org/en-US/docs/Web/API/Element.getBoundingClientRect\ncss\nFeature         Chrome  Firefox (Gecko)     Internet Explorer   Opera   Safari\nBasic support   1.0     3.0 (1.9)           4.0                 (Yes)   4.0\n. Note: Gecko 1.9.1 adds width and height properties to the TextRectangle object.\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Gecko/Versions\n1.9.1 =  FireFox 3.5\n. http://stackoverflow.com/questions/2245013/getboundingclientrect-problem-with-firefox\n. Fixed!\n. > The issue is that when you run editor.focus();, the focus is actually on web console and not on the page.\nThe textarea does get focus.\nTry the following steps.\n- editor.on(\"focus\", function(){console.log(\"hi, focus..\"); editor.setOption(\"value\", \"New value.\\n\");});\n- editor.setOption(\"value\", \"Hello World\\n\");\n- document.activeElement //I've got the body element\n- editor.focus();\n- document.activeElement //returns the textarea\n. You are right. This is not a CodeMirror bug.\nThis used to be different but that was probably some time ago. I remember being able to focus the CM instance from the console.\nThe onfocus is triggered when the webconsole is not active.\nExample:\n- editor.on(\"focus\", function(){console.log(\"hi, focus..\"); editor.setOption(\"value\", \"New value.\\n\");});\n- document.getElementsByTagName(\"textarea\")[1].onfocus = function(){console.log(\"test\");};\n- editor.setOption(\"value\", \"Hello World\\n\");\n- document.activeElement //the body element\n- editor.focus();\n- document.activeElement //returns the textarea\nTo get the focus triggered, click somewhere in the webpage. No need to click in the editor.\n. =============BEGIN WINDOWS 10, IE 11===================\n\"Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729; LCJB; rv:11.0) like Gecko\"\nTest Suite\nA limited set of programmatic sanity tests for CodeMirror.\nRan 1681 tests\n5 failures\ncore_move_bidi_\u038c\u021d\u01dd\u06aa\u0209\u06e5\u05f4\u06fa\u05c6\u0240\u04a9\u06cf \u04b3assertion failed (5)core_move_bidi_\u014c\u04f0\u0442\u0642\u0224\u0601\u01a5\u0605\u0663\u010e\u023a\u0661 \u03daassertion failed (In step 7, cursor didn't move right)core_move_bidi_\u067b\u043e\u04a4\u0455\u047d\u03a9\u05be\u0609\u00ef\u03af\u0584\u01f3 \u0675assertion failed (In step 6, cursor didn't move left)core_move_bidi_\u0605\u0601\u0106\u0555\u01bf\u0241\u01de\u03ee\u0620\u0229\u00f3\u0107 \u010fassertion failed (In step 0, cursor didn't move left)vim_dw_unicode_word3 != 2\nxxx\n\u038c\u021d\u01dd\u06aa\u0209\u06e5\u05f4\u06fa\u05c6\u0240\u04a9\u06cf\n\u04b3\n\u014c\u04f0\u0442\u0642\u0224\u0601\u01a5\u0605\u0663\u010e\u023a\u0661\n\u03da\n\u067b\u043e\u04a4\u0455\u047d\u03a9\u05be\u0609\u00ef\u03af\u0584\u01f3\n\u0675\n\u0605\u0601\u0106\u0555\u01bf\u0241\u01de\u03ee\u0620\u0229\u00f3\u0107\n\u010f\n1\ng  \n\n\n==============END WINDOWS 10, IE 11===================\n==============BEGIN WINDOWS 10 EDGE STABLE===================\n\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.79 Safari/537.36 Edge/14.14393\"\nTest Suite\nA limited set of programmatic sanity tests for CodeMirror.\nRan 1681 tests\n9 failures\ncore_measureWrappedEndOfLine\nafter != before (sticky)\ncore_rtlMovement\nassertion failed (moved right)\ncore_move_bidi_\u038c\u021d\u01dd\u06aa\u0209\u06e5\u05f4\u06fa\u05c6\u0240\u04a9\u06cf \u04b3\nassertion failed (5)\ncore_move_bidi_\u014c\u04f0\u0442\u0642\u0224\u0601\u01a5\u0605\u0663\u010e\u023a\u0661 \u03da\nassertion failed (In step 7, cursor didn't move right)\ncore_move_bidi_\u067b\u043e\u04a4\u0455\u047d\u03a9\u05be\u0609\u00ef\u03af\u0584\u01f3 \u0675\nassertion failed (In step 6, cursor didn't move left)\ncore_move_bidi_\u0605\u0601\u0106\u0555\u01bf\u0241\u01de\u03ee\u0620\u0229\u00f3\u0107 \u010f\nassertion failed (In step 2, cursor didn't move right)\ncore_move_bidi_\u03cc\u05ca\u06f7\u0662\u051c\u04bb\u041e\u05e6\u0409\u064a\u010d\u01df \u0469\nassertion failed (In step 5, cursor didn't move right)\ncore_move_bidi_\u0492\u0228\u049f\u0583\u019e\u0666\u0513\u0226\u06b0\u0493\u00e2\u01a5 \u06a4\nassertion failed (In step 5, cursor didn't move right)\nvim_dw_unicode_word\n3 != 2\n0123456789abc\u0627\u0628\u062c\u0627\u0628\u062c\u0627\u0628\u062c\u0627\u0628\u062c\n<img src=\"/\u05d1\u05d3\u05d9\u05e7\u05d43.jpg\">\n\u200b\n\u038c\u021d\u01dd\u06aa\u0209\u06e5\u05f4\u06fa\u05c6\u0240\u04a9\u06cf\n\u04b3\n\u014c\u04f0\u0442\u0642\u0224\u0601\u01a5\u0605\u0663\u010e\u023a\u0661\n\u03da\n\u067b\u043e\u04a4\u0455\u047d\u03a9\u05be\u0609\u00ef\u03af\u0584\u01f3\n\u0675\n\u0605\u0601\u0106\u0555\u01bf\u0241\u01de\u03ee\u0620\u0229\u00f3\u0107\n\u010f\n\u03cc\u05ca\u06f7\u0662\u051c\u04bb\u041e\u05e6\u0409\u064a\u010d\u01df\n\u0469\n\u0492\u0228\u049f\u0583\u019e\u0666\u0513\u0226\u06b0\u0493\u00e2\u01a5\n\u06a4\n1\ng  \n\n\n\n==============END WINDOWS 10 EDGE STABLE===================\n==============BEGIN WINDOWS 10 FIREFOX STABLE===================\nTest Suite\nA limited set of programmatic sanity tests for CodeMirror.\nRan 1681 tests\n4 failures\ncore_move_bidi_\u038c\u021d\u01dd\u06aa\u0209\u06e5\u05f4\u06fa\u05c6\u0240\u04a9\u06cf \u04b3\n    assertion failed (In step 5, cursor didn't move right)\ncore_move_bidi_\u014c\u04f0\u0442\u0642\u0224\u0601\u01a5\u0605\u0663\u010e\u023a\u0661 \u03da\n    assertion failed (In step 7, cursor didn't move right)\ncore_move_bidi_\u0605\u0601\u0106\u0555\u01bf\u0241\u01de\u03ee\u0620\u0229\u00f3\u0107 \u010f\n    assertion failed (In step 0, cursor didn't move right)\nvim_zb_to_bottom\n    4898 != 4898.5\n\u038c\u021d\u01dd\u06aa\u0209\u06e5\u05f4\u06fa\u05c6\u0240\u04a9\u06cf\n\u04b3\n\u014c\u04f0\u0442\u0642\u0224\u0601\u01a5\u0605\u0663\u010e\u023a\u0661\n\u03da\n\u0605\u0601\u0106\u0555\u01bf\u0241\u01de\u03ee\u0620\u0229\u00f3\u0107\n\u010f\n\n==============END WINDOWS 10 FIREFOX STABLE===================\n==============BEGIN WINDOWS 10 CHROME STABLE===================\nTest Suite\nA limited set of programmatic sanity tests for CodeMirror.\nRan 1681 tests\n3 failures\ncore_move_bidi_\u038c\u021d\u01dd\u06aa\u0209\u06e5\u05f4\u06fa\u05c6\u0240\u04a9\u06cf \u04b3\nassertion failed (5)\ncore_move_bidi_\u014c\u04f0\u0442\u0642\u0224\u0601\u01a5\u0605\u0663\u010e\u023a\u0661 \u03da\nassertion failed (In step 7, cursor didn't move right)\ncore_move_bidi_\u0605\u0601\u0106\u0555\u01bf\u0241\u01de\u03ee\u0620\u0229\u00f3\u0107 \u010f\nassertion failed (In step 0, cursor didn't move right)\nxxx\nok\n\u038c\u021d\u01dd\u06aa\u0209\u06e5\u05f4\u06fa\u05c6\u0240\u04a9\u06cf\n\u04b3\n\u014c\u04f0\u0442\u0642\u0224\u0601\u01a5\u0605\u0663\u010e\u023a\u0661\n\u03da\n\u0605\u0601\u0106\u0555\u01bf\u0241\u01de\u03ee\u0620\u0229\u00f3\u0107\n\u010f\n\n==============END WINDOWS 10 CHROME STABLE===================. Reproduced on Windows 10 Chrome stable\n\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36\"\nReproduced on Windows 10 Firefox stable\n\"Mozilla/5.0 (Windows NT 10.0; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0\". Not sure about ProseMirror but here is a demo for CodeMirror: http://codemirror.net/demo/changemode.html. I found this bug only in the 'original' CodeMirror with IE8.\n. > Why do you pop the keyframes context here?\nTo preserve correct indentation.\nAdd code below in editor Ctrl-A => Tab => Ctrl-Tab.\nWhen Ctrl-A => Tab => Ctrl-Tab is done Without popContext(state) the indentation after the closing keyframes bracket} is incorrect.\n``` css\nh1 {\n  animation-duration: 3s;\n  animation-name: slidein;\n}\n@keyframes slidein {\n  from {\n    margin-left: 100%;\n    width: 300%; \n  }\nto {\n    margin-left: 0%;\n    width: 100%;\n  }\n}\n/ Some example CSS /\n@import url(\"something.css\");\nbody {\n  margin: 0;\n  padding: 3em 6em;\n  font-family: tahoma, arial, sans-serif;\n  color: #000;\n}\nnavigation a {\nfont-weight: bold;\n  text-decoration: none !important;\n}\nh1 {\n  font-size: 2.5em;\n}\nh2 {\n  font-size: 1.7em;\n}\nh1:before, h2:before {\n  content: \"::\";\n}\ncode {\n  font-family: courier, monospace;\n  font-size: 80%;\n  color: #418A8A;\n}\n```\n. Ah, it's not needed at all.\nif (type == \"}\") return popAndPass(type, stream, state);\n. ",
    "thelucid": "No, it only happened after switching to the new HEAD version. I'm not sure what exact version I was on before but can probably find out if needs be.\n. I'm using Safari 5.1.1.\nI found the most consistent way to get the right caret height in my case (example: http://jsfiddle.net/thelucid/Hwxs4/) was to insert a span containing the entity '&#8203' or blank on IE (see feature detection in example) with it's style set to inline and it's height set to '100%', you could then get it's offsetHeight... I just leave the span in there with position of relative and flash another absolutely positioned span inside it for the caret as it doesn't affect the flow of the text due to the outer span's zero width (see example).\nHope this helps.\n. A quick benchmark:\n``` javascript\nfunction getLines() {\n  var count = editor.lineCount(), i;\n  for (i = 0; i < count; i++) {\n    editor.getLine(i + 1);\n  }\n}\nfunction getValue() {\n  editor.getValue();\n}\n```\n- getValue x 41,994 ops/sec \u00b13.79% (50 runs sampled)\n- getLines x 11,262 ops/sec \u00b13.70% (51 runs sampled)\nSurely getting the lines should be quicker as that's how they're stored?\nI'm not too concerned about the performance of this as that's plenty quick enough (unless the values are getting caged along the way) but is there an easier way to iterate over the lines?\n. Great, I'll give it a go. An cm.eachLine(function(line) { ... }) function would be good when making public to run inline with the other function names. If a start and/or end was required, they could be appended like with slice:\njavascript\ncm.eachLine(function(line) { ... }); // All lines in editor\ncm.eachLine(function(line) { ... }, 10); // All lines in editor from line 10\ncm.eachLine(function(line) { ... }, 10, 30); // All lines from start to end values\nCould also have an cm.getLines function that returned and array of lines.\n. If you're in agreement, I can look at adding this over the next couple of days.\n. I can't get iter to work, what are the start and end arguments expected to be?\n. Ok, thanks... updated suggested public API above. How do you feel about this, likely to get implemented?\n. I should be clear, I'm not suggesting you change your internals much, just adding cm object methods for nice public API. Of course, this public API could then be used internally.\n. ",
    "WraithKenny": "https://github.com/leafo/lessphp-site/blob/master/www/codemirror2/mode/less/less.js\nSeems to already have one :)\n. I'll close this one in favor of #304\n. Bah! The diff is filled with whitespace changes. Add \"?w=1\" to see less white ( https://github.com/WraithKenny/CodeMirror2/commit/ce96be6bfb43b84bee7e46804f426b52bec56905?w=1 ) \nThe real change is only a (function(){ ... })(CodeMirror) wrapper and the var assignment and reuse of the main function to define the less mode.\n. I have an app that uses CodeMirror in \"less\" mode to edit LESS.js and parse it in real time outputting to another CodeMirror that highlights in \"css\" mode. I have no idea how I could do that with the change that removed \"less\" mode a while back. Currently, \"less\" overrides and pretends to be \"css\". Are you asking me to revert that change in my patch?\n. on the other ticket @marijnh said \"I think defining the mime type, if not already claimed, is acceptable. \"\n. This request doesn't attempt to preserve the css override... and there's no change in whitespace.\n. Makes sense to me, I had thought the define less as css was intentional :) That was where my confusion came from. Thanks!\n. I know this is old, but if you use LessCSS, you can easily scope the entire lib with  \n.myplugin { \n    @import (less) \"codemirror.min.css\"; // Pre-bundled, or list all files here.\n} \nsuch that all of your rules will only apply to a CodeMirror that's a descendant of <div class=\"myplugin\"> .\n(Other extensions would have to opt in to this scheme for theirs to not clobber yours, however, you'd be a good citizen.). ",
    "leafo": "Just submitted a pull request for it, see #304\n. ",
    "mys3lf": "Hi. The images have the same size and i can't use css for the re-styling because every expressions is a placeholder for a special icon text combination. for example:\norginal highlighting:\n<span class=\"cm-placeholder\">[|[0:A]|]</span>\nreplacemenent:\n<span class=\"cm-placeholder\"><img src=\"custom_Icon_For_Id_0.png\" alt=\"icon\" /><span class=\"label\">A</span></span>\nAn other knock-out criterion for css is, that the icon of a placeholder can vary and the user can use own icons. \n. hi works after a few modifications. i had to add \"onUpdate: null\" to CodeMirror.defaults and changed \"event\" to \"e\" in the function handleKeyBinding (line 434)\n. I know that this is valid in JavaScript. If this isnt your code i will just write my own extension. \nThanks for your answer. \n. ",
    "gitbase": "aah, thank you!\n. hm, it doesn't happen in the demos. I am using fromTextArea, yes.\n. it is really weird, the content is there inside the textarea but doesn't get loaded in the codemirror editor.\nCheck Here. Click the Full Preview button (top right) and then click the browser back button.\nIf i disable the codemirror editors, the app works as expected (with plain textareas), i.e., the live preview renders.\n. ok, so i seem to find a dirty fix, but haven't implemented yet, because maybe you'll have a better solution or point out my mistake that's causing the problem.\nmy fix ->\njavascript\nif ( $('#html textarea:first').text() ) {\n    code_mirror_html.setValue($('#html textarea:first').text());\n    code_mirror_css.setValue($('#css textarea:first').text());\n    code_mirror_js.setValue($('#js textarea:first').text());\n}\n$('#html textarea:first').text() in jQuery is almost equivalent to document.getElementById('html').getElementsByTagName('textarea')[0].innerText in raw JS.\n. Check this out - Minimal Testcase\nClick Some random link and then hit the browser back button in google chrome.\n. oh wow, form tag with a name on the textarea fixes it! infact, just a name on the textarea fixes it, form not required :)\n. try this ->\njavascript\n    extraKeys: {\n        \"Tab\": \"insertTab\"\n    }\n. would really appreciate some help on this!\n. ok, I can use both onChange and onCursorActivity, but I am a bit confused.\nRight now I can see onCursorActivity precedes onChange. So if I wanted to perform some action only when there was a cursor movement and NOT any changes in the editor how would i go about doing it ? If i set a flag in onCursorActivity then I don't know when to perform that action as I don't want to perform when there is an onChange, getting me ?\nIf there's still a solution to this problem, will the order of calling both the events be same forever? because if that changes, then my code is going to break.\nHope you're getting me and can help :)\n. ok, I am using CM2 that I downloaded like 6months ago. In that one, onCursorActivity gets called before onChange.\nI'll try out the current release (2.25?) and use it. If it's like you said in the latest version, then I guess that'll solve my problem. thanks!\nUPDATE: Just tested, onChange is getting called before onCursorActivity in the latest release. great!\n. I'm not sure about lower ASCII values, but zero-width characters and BOM sounds like a good idea :)\n. It throws Codemirror not defined error.\nAlso it's just a textarea for me.\n. Chrome 20\nFirefox 14\nThere are some JS errors, JSbin shows them, check out.\n. wow, that's quite a bit of work :P\n. Unfortunately if you keep enter key pressed (or even up or down arrows) for a few seconds, it becomes slow in Firefox. The cursor gets stuck, and changes line suddenly when you release the pressed key.\nI really hate firefox. my app has already started to become slow in Firefox, so probably I cannot implement this feature. Although thanks a lot for this :)\n. I'll be waiting for it ;)\n. i am using onChange right now. Since it doesn't pass the text removed, I used the from.ch/line and to.ch/line to parse out the removed text from the entire text that was there in the editor before the change.\nI just wondered whether there's a better way or not. By better, I mean some easy API call to CM that would solve it. So fine, I guess this is the way for now.\nAlso upgraded to 2.3.2 - get/setHistory() are there, although I don't think they'll help me with this task :)\nThanks\n. ya thanks I already got it sorted with setOption hours ago!\n. Heh, I basically want to know how to go about writing tests to cover those 3 points.\nSo like, for the first point, I would like to know to emulate backspacing/deleting just as a user would do.\nFor the second point, how to emulate string replacement as a user would do and programatically make sure that CM uses replaceRange for user's string replacement or not.\nFor the third point, how to make sure that CM uses replaceRange always for undo/redo.\nI hope I made things more clear this time! :)\n\nOne more question I got right now (don't wanna open a new ticket, heh). I just noticed something. Lets say I got 10 lines in the Editor with 2 tabs at the start of each line, so something like:\njavascript\n    if () {\n        hello;\n        world;\n        foo;\n        bar;\n        .. so on;\n    }\nNow I select the entire JS code and press shift+tab that removes 1 tab from each line. For each line there is 1 change object. A master change object is passed to the onChange event that contains next property that nests down till the level of the number of lines.\nWould it not be possible to send just 1 object that acts like replaceRange ? So from and to of that change object would contain the line/ch and text would contain the new text added (as an array broken on newlines - just like it is atm for replacements) ?\n. hm, ok, lets see. I'll try today.\nSo I have been trying to read the next chains and form entire text removed and added so that I can directly use them in replaceRange in cases like multi-line tabs or shift-tabs as mentioned before (in my previous reply) or auto-indentation.\nI have a question though:\nIn the JS box when I hit enter key that doesnt leads to auto-indentation (and the caret is positioned at 0th position), the onChange object contains a next object that's unnecessary. Check this screenshot:\nhttp://img6.imagebanana.com/img/syy1qkcd/Selection_069.png\nSo, if you see the next object basically says add '' to 0,7 - 0,7 that means do nothing.\nWhat's the reason behind it ? Can the next just not exist when not required ?\n. One more thing, have you maintained a list of cases where the onChange object would contain a next object ?\n. hey thanks for the commit, although yeh you are right. I am going to go over my algorithm once again :).\n. wow, I have been going quite mad to make my app bug-free before launch :D\nhere's another bug (most probably) I found.\nLet's say I have this JS code:\n``` javascript\nfunction track(e) {\nif (currentPos < e.clientX) {\n\n}\n```\nNow when I typed that { after e.clientX) It trigger onChange event twice. First time it sent a change object that was meant for the addition of the {, while the second time, the change object was really weird.\nThe second object says, replace the tab before if with a tab. Screenshot:\nhttp://img6.imagebanana.com/img/j8chyoes/Selection_073.png\n. It seems that we can't work with electricChars set to false as I noticed a problem like, closing } won't re-indent (backwards).\nBut still, In the case i mentioned above, there is no 're-indentation' - So not sure why multiple change objects. But then I might not be able to see some cases where it is helpful.\n. Testcase: http://jsbin.com/osokik/3/edit\nJust backspace the { after if conditional and add it back. See console, it dumps 2 onChange objects.\nAlso uncomment electricChars: false, and then in the code hit enter key twice and add a } - it won't indent-back (or move back, whatever you call it).\niirc, CM version is 2.32\n. sorry about that.\nso, i tried to write some test cases but can't figure out how to.\nfor example, the fix you did for 'producing less noisy change objects on enter', i.e., suppressing the useless change objects - I would like to write a testcase to make sure that works as expected always. How would I go about doing it?\nI hope you understand that I want to do it totally programatically and not like setup an editor instance, then go to browser and hit enter and then let the JS code test it.\nTill now I have tried creating a keypress event with document.createEvent() + initKeyEvent() + dispatchEvent() - the onKeyPress CM core function does get called - but nothing is added as specified by the keyCode and charCode of the event object.\nI have also tried calling Codemirror.commands.newlineAndIndent(cm) directly, but it sends separate onChange object, not in next.\n. ",
    "CodesWithAFist": "I am running into this issue with the cursor being incorrectly positioned in both IE9 and Chrome. If I turn quirksmode on in IE9 it is positioned properly. Is this currently being worked on or is their a fix?\nUpdate.\nThis was only occurring on a refresh. Once a key was pressed in the text field, CodeMirror refreshed and the cursor was in its proper place. So on document.ready I called for CodeMirror.refresh() and it cleared everything up.\n. ",
    "uuf6429": "Well, it's significantly difficult considering multilines as well as well different line lengths (in chars).\nWhile not a serious shortcoming in itself, it would make a fitting feature for TextMarker (at least in my opinion).\n. Now that I reread the manual, I think this could be achieved via:\nTextMarker.prototype.count = function(){\n    var r = this.find();\n    return getRange(r.from, r.to).length;\n};\n. ",
    "noamway": "You right.\nAnother problem that I saw with other languages that is not English was the selection of the text inside tags.\nFor example take a look on:\n<div>Hello</div>\n<div>\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0430\u044f</div>\nTry to double click on the work \"hello\" and try to double click on the world \"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0430\u044f\".\nYou'll see that after you click on the word \"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0430\u044f\" the selection take the DIV tag with the word.\nIn the world today most of the big interface include multi-language interfaces.\nThanks again for the fast response if build an amazing framework :-)\n. There is any progress or time frame for RTL solution, maybe you have any workaround I can use?\nThanks\n. ",
    "gavriguy": "+1 for this - any direction on how this can be solved?\n. ",
    "arosolino": "Sorry I didn't know indentUnit had to be matched with tabSize, I set them both to 4 and works flawlessly now, thanks for the help.\n. Just a side note, it seems the bug lies when setting this \"code.style.\"\n. There was one bug that I seem to have fixed, sometimes when I loaded it would display too many lines when changing the value, but I added the code at the beginning of the updateDisplay function\ncachedHeightFor = null;\n. Ok there is a new bug, and I am sorry to load you with all of these but it's just things that I am finding.\nLet's say you have your editor to auto resize:\nhttp://codemirror.net/demo/resize.html\nAnd you have the editor set to wrap lines. You load in something that has 5 lines and the fifth line is wrapping so really there is 6 lines, it loads up fine, but if u change the setValue to something that is just 1 line eventually doc.height for some reason is set to 0, and when u switch back to the the one with 5 lines with 1 wrapping it sets the doc.height to 5, and the doc.height gets lower each time you switch.\nIt's a hard bug to explain. What I ended up doing is putting this in the setValue function:\ndoc = new BranchChunk([new LeafChunk([new Line(\"\")])]);\nI am not sure if this is ethical or will mess with anything but it fixed my problem.\n. It is working perfectly now, thank you for these updates.\n. Thanks, the new version 2.2 released has solved my problems.\n. ",
    "Pomax": "+1 - we're using CodeMirror for an online text based html editor, and a lot of people using it noted that they considered this kind of text selection feature intuitive, but missing.\n. Awesome, thanks loads! To the submodule update stations!\n. even with a normal css layout, this does not work. Somehow, the height for the codemirror block is getting completely wrong pixel values. Demonstrator: http://pomax.nihongoresources.com/downloads/temp/wpm_editor/demo/editor/\ndisabling codemirror shows a textarea that is 100% height, allowing codemirror to do its thing changes it into a much smaller field. No amount of setting CodeMirror-Scroll, -Gutter or -Lines changes this.\n. That's what I thought. we had the CSS line-height for all the codemirror pre and textarea set up so that irrespective of the font the line-height should be the same. Is it possible that the non-monospaced nature of the fonts might interfere?\n. ah, useful! This might need a small section in the user manual near the fromTextArea etc. functions.\n. it's the \"signal\" part that I was looking for. It does not appear to have a mention on http://codemirror.net/doc/manual.html anywhere, could it be added to the events section? (that currently only mentions that on/off are used, but nothing about signal)\n. From what we can tell, Chrome and Opera on Windows and Chrome on OSX (FF and IE do not seem affected)\n. As a clean from-file immediate load, I can't reliably reproduce it, but as a \"start up codemirror, then set new content after initial load\", like the original STR, I see it happen virtually all the time.\n. sorry, original STR should have been \"html-edit any of the elements in the head, and add a style element\". I'm not trying to make you play a guessing game but on windows and OSX this is a guaranteed way to reproduce the effect, tested by multiple people on multiple computers, and it's impacting our effort to localise Mozilla's webmaker.org to things like Thai or other non-latin scripts. Which OS are you testing this on? (because it does not happen on linux, it's probably using a better fallback font with metrics that don't mess up codemirror)\n. oh! that empty circle is a unicode combining mark placeholder... if it's putting that into spans in isolation then this might actually be a javascript split() problem, where a string with combining marks (in Thai that's also things like vowels) is being split up based on individual unicode code points, rather than splitting across \"letter\" boundaries. I wonder if there's a small JS lib that will do correct unicode splitting for us here (will have a look).\nIn terms of severity it's tricky: we have webmaker fully localisted for Thai and Russian, with Korean on its way, and we haven't released the localised version yet, but they're rearing to go. We're holding off on them until we can somehow fix or work around this issue though, since the user experience is one that might actually drive users away because they can't reliably edit their content.\n. That sounds pretty much exactly what is necessary here, too: you shouldn't be able to put the cursor between the two parts that make up \u0e14\u0e33, as it's \"one thing\" in combination (although hitting backspace should still work and turn it into \u0e14). Would this also work for base glyphs with more than one combining mark? Vietname o\u031b\u0340 for instance, which github's comment box mangles pretty badly but is \"o\" + 0x31B (combining horn) + 0x340 (combining grave tone mark) while still being only a single \"letter\" in terms of cursor positioning.\n. if that's an official recommendation, would it be possible to add that to the docs section for scrollTo? this would help others as well I'm sure.\n. ",
    "samuela": "+1 This seems like a pretty simple change so I may try to tackle it\n. No problem, guys! Next up is block selection...\n. Haha well give me a few weeks for this one... I'm not exactly sure what I'm going to be getting myself into with block selection\n. Thanks! Sorry for the confusion.. These properties do behave a little different than expected though. I'm not sure if this is just me but maybe some mention in the documentation would prevent this question from coming up again\n. I'm still running into some problems with indentAuto(). See http://jsbin.com/ihunin/49/edit#preview. Attaching it in extraKeys as a string seems to work but calling it by itself doesn't. Am I doing something wrong here?\n. Right, and in the jsbin I called CodeMirror.commands.indentAuto(editor). Really though what I'd like to do is something like this::\nCodeMirror.fromTextArea(document.getElementById(\"code\"), {\n    extraKeys: {\n        \"Tab\": function(cm) {\n            if(<blah blah blah>) {\n                CodeMirror.commands.indentAuto(editor);\n            }\n        }\n   }\n});\nBut I can't get that to work.. The weird thing is that setting \"Tab\": \"indentAuto\" in extraKeys does work. I'll post another jsbin when I get a chance.\n. Ok I put together a jsbin here http://jsbin.com/ihunin/54/edit#preview. I'm not writing this on my usual computer so if I recall correctly, setting \"Tab\": \"indentAuto\" worked on Chrome but now it doesn't look like it's working on Safari 5. Setting \"Tab\": function(cm) { CodeMirror.commands.indentAuto(cm); } has never worked for me though.\n. Right, and I understand that. Neither of them work for me on Safari. In the second one when I hit tab, I get the alert but no indent. Am I misunderstanding what indentAuto does?\n. Also, when indentAuto is called in an indented line, all of the indentation is deleted.. I expect indentAuto to insert either indentUnit spaces or one real tab depending on the options. Is this correct?\n. Got it, that makes sense now. Thanks!\n. Great thanks!\n. +1 I would also highly recommend implementing Sublime Text's Cmd-D shortcut which adds the next occurrence of the selected string to the multi-selection. For example, if my file looks something like\n\" foo bar foo \"\nand I select the first \"foo\",\n\" foo bar foo \"\nnow, hitting Cmd-D, I can easily select the next \"foo\"\n\" foo bar foo \"\nOne of my favorite features in any text editor ever and it shouldn't be too tricky to implement once multi-select is working.\n. This looks awesome!\n. ",
    "hatpick": "Is it possible to add a gutter on the right side of editing area?\n. I'm right clicking on the code mirror and it changes the cursor, but in the callback function, when I want to get the line number which has been right-clicked on, I get previous position of cursor.\nBrowser: Chrome Canaray 26\n. On the right-click I'm trying to open a context menu and get the chosen line in the editor (the line that has been right-clicked on) to do something, but apparently it first runs my callback function then changes the cursor position to that line. \nI'm using this version. 2.35\n. Sry, I'm using this plugin http://www.javascripttoolbox.com/lib/contextmenu/\n$(\".CodeMirror-lines\").contextMenu(menu_element, options);\n. Edited: this worked well for me. thanks!\n. Use cm.cursorCoords to find the {line, ch} you are clicking on\n. ",
    "Blindmikey": "I believe it would! \nIt seems I only conflict with the new indentation when working with CSS - when appropriate I stack my declarations eg:\n```\nrule {\n....\n}\n#rule .second {\n    ....\n    }\n\n```\nAnd other times It's not called for\n```\nrule {\n....\n\n}\nsecond {\n....\n\n}\n```\nSo I could add 'noSmartIndent' when working with CSS and that should alleviate the issue.\nThanks for the quick reply!\n. ",
    "nadouani": "Great, thank you very much\n. ",
    "vestimir": "hmm, tried ciw yi( (which are fairly regularly used text object combinations) with the latest version, and it didn't work. I'll try to figure out what's the problem over the weekend. \n. hmm It's working nearly perfect. The only issue is that the regex that matches a word (like in ciw) is catching a little more words backwards and therefore behaves differently from an actual vim. I'll try to figure it out. \n. I've found the problem it hooks to capital W and not to w, that is why it behaves differently. However there's a small problem, even though I have added 'w' as suffix, when I hit the key combination it always get capital W, even if I comment out the W binding. Is this something specific to CodeMirror? \n. yup, that was my problem. I didn't knew this convention. \n. Thank you! I think basic support for the text object is now complete, so close the issue. \nIn near future I'll try to add additional support for 'html tag' (cit, yit) text object and (maybe because it's not officially built into standard vim, but it's very useful) 'same-indentation' level. \n. hmm, I am using vim for code editing, and it's configured to strip trailing whitespace on opened files. I'll just diff the files before commit next time. And about the String prototype definitions, I am not sure if this is the right place for them in the middle of nowhere, but moving them to the top of the file caused problems. \n. Yes, that was also my concern. Sorry for the inconvenience. \n. In your code startIndex is not supplied on line 727 in vim.js, so it's not entering the for cycle and therefore it always gets -1. Either supply startIndex, or use the following version of the method - this one works correct:\njavascript\n  function regexLastIndexOf(string, pattern) {\n    for (var i = string.length; i >= 0; --i) \n      if (pattern.test(string.charAt(i))) return i;\n    return -1;\n  }\n. ",
    "treeform": "I have a diff that fixes the most pressing issues here:\nhttps://github.com/treeform/CodeMirror2/commit/4c13754cd75505e2e76b1b9f8918a07b559f3d82\n. oh wow that was fast thanks!\nUnfortunately i discovered a bug in my code yet i also fixed an annoying issue with \"@\"\nhttps://github.com/treeform/CodeMirror2/commit/1a2c96cc5f774e4217d229235dfbb80f65f10da7\n. ",
    "MariusKarthaus": "For our project I need to keep more information in the state (like block levels and scope information), hence the copy of the full state. But I guess that for the functionality of CodeMirror itself it is not needed.\n. For now I've started by building off of the php tokenizer, mainly using the hooks an adding a small token function to find method and object variables. I detect the start of namespaces, classes and functions and put them on a stack. The 'hard' part seems to be communication between my software, codemirror and it's modes. The state seems to be the only way to do this and it is unidirectional. I'm trying to get this done without making any changes to codemirror.js, although I came close to giving the tokenizer knowledge about the position in the document it was working on, and the possibility to pass along an object from the ide. I'll probably doing the rest by iterating over the tokens.\n. I do however understand your choice to keep the tokenizer as clean as possible, it just makes it a little harder for  me.\n. ",
    "gruehle": "There are two issues with themes:\n1. The span.CodeMirror-selected selectors needs to be renamed\n   .CodeMirror-selected\n2. Selection is not visible when using themes that specify a background\n   color, like \"night\". This is due to the z-index: -1 on the selection pre,\n   which causes the selection to be drawn behind the opaque background. I had\n   the same approach in my original change (with the z-index set on the div\n   instead of the selection pre/spans) and noticed the same problem.\nThe second issue is the reason why the LESS mode demo fails to show the\nselection.\nEverything else looks good so far! I'll do more testing on different\nbrowsers and let you know if I find any other issues.\nGlenn\n. Other than the issue Peter mentioned, everything else looks good. I tried Chrome, Firefox, Safari, IE8 & IE9.\n. I did find one more issue:\n- Go to the theme demo: http://codemirror.net/demo/theme.html\n- Enter a large amount of text (I used the text from codemirror.js)\n- Click+drag from the bottom of the text. Move the mouse to the top part of the window where it says \"CodeMirror: Theme demo\". This should start a scrolling drag selection.\nEventually the scrolling will stop and you will not be able to move the selection up any more. Note that this can be a bit hard to reproduce, but seems to happen more quickly when you keep moving the mouse while the text is scrolling.\n. Go to: http://codemirror.net/demo/theme.html\nMake a selection.\nResize the window horizontally until the size of the CodeMirror instance is changed.\nResult: the right edge of the last line of the selection bounces around while the window is resized.\nThe drag selection bug is fixed! \n. It's definitely moving more than one pixel for me. If I resize the window quickly, I can get it to move about 50 pixels. \nIt is most noticeable on WebKit browsers (Chrome, Safari). I've only tested OSX.\n. Thanks for the tips! I was able to get the functionality I want with this:\njavascript\nextraKeys: { \n    \"Tab\" : function(instance) {\n        if (instance.somethingSelected())\n            CodeMirror.commands.indentMore(instance);\n        else\n            CodeMirror.commands.insertTab(instance);\n    }\n}\n. Here is a screencast that shows the issue I'm seeing. This is the Theme demo from the CodeMirror website:\nhttp://youtu.be/UQAeGs9k73A\nOther people at my office have also reproduced the problem.\nWhich demo file shows the single pixel wobble? I'm not seeing it on my Mac (Chrome, Firefox, Safari).\n. FYI - here is the other discussion: #333\nIt includes a screencast that shows the problem (this is an old screencast, but the steps to repro and results are still the same):\nhttp://youtu.be/UQAeGs9k73A\n. Yes, that fixes the problem I was seeing. Thanks!\n. ",
    "njx": "Looks okay in master now.\n. No, unfortunately--I didn't change anything about the click handling for the horizontal scrollbar. Clicking on the vertical scrollbar does work better now though.\n. Oops--in my original commit, I didn't take into account the fact that for MarkedText (as opposed to Bookmark), split() actually returns a new mark. So now I only delete the mark from the old line if the \"split\" mark is actually the same as the original mark (meaning it moved instead of being truly split). Perhaps there's a better way to handle the two different cases though?\n. Seems fixed, thanks.\n. I'm seeing other issues relating to selection fixup around hidden lines as well, not just related to changing the text. For example, if I have a file with two lines, hide the second line, then do a \"select all\" on the first line, the selection is incorrect, and the actual selection that gets set depends on how long the second line is.\n. @peterkroon Good catch--I guess none of us use drag-and-drop in text editors so we didn't test it :) I'll look into it.\n. Hmm--the culprit is the \"pointer-events: none;\" that I added to the lines in the line div in order to make touchpad throw scrolling in Safari decelerate properly. I'll see if there's a better workaround.\n. It's not an issue with touch devices--it actually happens in Safari on the desktop (at least on Mac) when you do a two-finger throw-scroll on the touchpad. (Basically, the throw \"stops\" abruptly instead of smoothly decelerating to a stop.) The same problem occurs in the current master of CodeMirror as well. So technically it's not necessary for this flicker fix, but our goal was to make scrolling feel better overall.\n. Good idea--I hadn't thought of just using the existing scroller. That would definitely reduce the amount of change by a lot. I'll take a look at implementing it that way this week.\n@gruehle had the same point about not supporting two scrolling models. The specific issue in IE7 was that clicking and dragging on the scrollbar thumb didn't work. The reason appeared to be that clicking on the scrollbar causes an onBlur() from the main editor (since it's now a separate div), and for some reason in IE7 the bit in onBlur() that adds the \"focused\" class to the editor div was causing the scrollbar thumb to act like it got a mouse-up immediately. I don't think that would go away with your proposal, but perhaps we'd get lucky and whatever bug in IE7 is getting tickled might not happen to occur in that case :)\n. Hmmm, one problem with using the existing scroller div: On Lion, the scrollbar actually needs to overlap on top of the code (the content is supposed to bleed all the way to the right edge, and the scroll thumb just draws translucently on top of it when it fades in). Not sure how we would do this if the scroller is behind the mover div.\n. Ah--because we're manually handling all the events anyway? Makes sense. I'll try it.\nBy the way, just to be clear--do you mean \"mover\" should be a sibling of \"scroller\" (but scroller would still contain \"code\", though \"code\"'s only purpose would be to set the virtual height of the scroll area, similar to \"scrollbar-inner\" in my current implementation)?\n. Cool. I've started implementing it and have a prototype version of it working, although there are still a few glitches to work out and I've only tried it in Chrome. Definitely involves less code change than my original approach, so hopefully I can make it work.\nFYI, due to other stuff we're working on in this sprint I probably won't be able to finish the new implementation until next week. I'll put up a new pull request if/when I get it working.\n. Not at all--I'd be pushing back harder if I didn't think your approach was better than mine :)\n. Hi Marijn--I've made some progress on this, but am running into a snag in IE (big surprise :)) Specifically, IE doesn't target mouse events to transparent elements--the events go to the element underneath the transparent element. Since in this approach the scroller is above the linespace in Z-order, and we want to handle the mouse events on the scroller, this is a problem.\nI can hack around this in IE9 by setting the background to a transparent color (rgba(0,0,0,0)). But that hack doesn't seem to be working in IE7, even if I use the filter: alpha(opacity=0) syntax that old IE supports.\nI'm going to keep working on it, but I was wondering if you had any experience with these issues in IE.\n. Oops--that's IE8 that's having trouble, not IE7. Haven't tried IE7 yet.\n. Ah, figured it out--I had to use the ugly -ms-filter: progid:... syntax just for IE8. Yay IE.\n. Closing for now, since the new approach in https://github.com/marijnh/CodeMirror2/pull/495 seems to be working.\n. I started looking at fixing this by making it so that when skipHidden() is going upward, it resets the character to the end of the line that it lands on. But the existing heuristic depends on the previous selection, and I wasn't sure how that should interact with this. (In the \"Select All\" case, it probably should just ignore the previous selection.)\n. BTW, this isn't super urgent for us...if you felt like working on one of our bugs over the next couple days I'd be much more interested in #483 :)\n. Oops! Wrong repo :)\n. @peterkroon: sorry, could you explain what you mean by \"go to the LESS mode\"? Is there a particular demo file you're seeing this in? And in which browser/platform?\n. @peterkroon: ah, never mind, I see it. I'll look into it. Thanks.\n. @marijnh -- I've fixed all the bugs I know about (including the one @peterkroon mentioned--thanks Peter!), so this is ready for you to review/pull. I did some light testing on the same browsers/platforms I mentioned above, but wanted to wait until we've made any tweaks you request before getting folks to do deeper testing. Let me know if you have any questions. Thanks!\n. Thanks, looking into these. One problem I noticed in the flicker branch is that in themeChanged(), the right-hand side of the assignment should also use mover.className. However, even with that fix it's still broken. I'll push up a properly-merged branch into my pull request once I've fixed these issues.\n. I spent some time figuring out what's broken when I merge with your master. (You can see my merge at https://github.com/njx/CodeMirror2/tree/simpler-flicker-fix-merge -- it's basically the same as your flicker branch, except that I've fixed mover.className in themeChanged() as I mentioned above, and it's slightly more current.) The main problem I'm now seeing with the merged branch is that if I type a long line, it doesn't scroll to the right when I get past the right edge of the visible area.\nWhat seems to be happening is that when scrollCursorIntoView() calls localCoords() to figure out the coordinates of the cursor, it gets 0 for the x value, even though the cursor is at the right edge of the line. I believe this is caused by the changes to measureLine() that you made in c916509a. The <span> with the tempID is being created at the end of the line, and the new code eliminates the space that you used to put inside it. If I put the space back in in that case, it gets the right cursor coordinates and the scrolling seems to work.\nUnfortunately I don't understand this code well enough to understand why this is the case, or why you eliminated the space in the first place :) Could you give me some guidance here?\nAlso, regarding the two other bugs you mentioned, I'm having a hard time reproducing them, although I believe I have seen them intermittently. Could you tell me which demo file you're using and how you're creating/deleting the long lines?\nI'm going to be out at a conference next week, but I know you wanted to try to get this merged in soon, so I'll try to make progress on these issues as soon as I hear back from you. Hopefully I can get everything sorted out by Monday.\nThanks.\n. Oh--I just figured out how to reliably repro your second issue (in my old, pre-merged branch). I suspect the first one might be similar too. So don't worry about looking for repro steps yet.\n. Actually--I'm seeing the bug with not horizontally scrolling in your master too. I'll file it, as well as a bug that I think is causing the other behavior you were seeing.\n. Sorry for all the comments--last one for now, I promise :) \nI figured out that at least one of the bugs you were seeing was caused by a bug that you already fixed in master (the one in updateLinesNoUndo() where you were using i + newText.length instead of from.line + newText.length in the code that was trying to recalculate the max line length). So that issue should be gone. \nI filed https://github.com/marijnh/CodeMirror2/issues/511 on the horizontal scrolling issue--once you've fixed that, could you remerge with my branch (or let me know and I'll push a new merge) and see if you're still seeing issues? Thanks.\n. Cool, that fixed it--I pushed a new merge. I don't know of any other bugs in this right now, so it should be good to review and merge. Let me know if you see any other issues. Once you've made any tweaks you want to make and merge it into master, we'll do some more focused testing on multiple browsers, Win/Mac, etc. to confirm that it looks ok.\n. Thanks for the feedback. On the squashing/rebase point, just so I understand, does that mean you'd prefer I submit a new branch based off master with a single squashed commit each time I revise it? Or is there some other way to \"resquash\" into the existing branch? (I'm still only a green belt in git-fu, sorry :))\nI'm at a conference this week, but will look into your feedback further when I get a chance. In the meantime, a few off-the-cuff responses...\nI think the main problem with your new suggestion (having the content on top) would be on Lion, where the scrollbars have to overlap on top of the content in that case in order to match the standard native behavior (that was the reason we put the scrolling div on top in the current implementation).\nI can definitely look into moving the mouse handlers up to the wrapper and getting rid of the transparent background hack. On the point about widgets, I think they're actually being added to the scrollerInner right now, so mouse events should work fine in them. (It's okay to put them into the scroller since they aren't virtualized, so there's no flickering.)\nThat leaves the gutter issue, and I don't have a good alternative for that one...and you're right that the current implementation is broken. Foo. I'll think about it some more and see if I can come up with a solution. (I'll also look into the bug you're running into with the scrollbar creeping up...I've seen it too but hadn't been able to reproduce it since my last set of changes.)\nOne question, though--should we consider going back to the original implementation (with the separate vertical scrollbar)? It did work reliably (we've been using it in Brackets for several months now), and didn't have any of these issues, though it did have several flaws (middle-mouse scrolling doesn't work, we have to reference a separate element to get/set the vertical scroll position, and we have to manually set the size and position of the scrollbar differently on different platforms).\n. Oh, I forgot that my original implementation didn't work well on older IE versions. I'd need to track those issues down too if we did want to go back to that (since we didn't want to have two separate scrolling implementations).\n. ACE's implementation is basically the same as my original implementation (separate vertical scrollbar div). They use a different hack to figure out how to size it, but it's the same approach overall.\n. Hi Marijn--been trying to think of a way to fix this without success. \nI don't want to beat a dead horse :), but just so I understand your concerns about the original approach...If we\n(1) removed the old scrolling codepath (so there's only one codepath on all platforms) and\n(2) fixed the IE7/8 bugs in some reasonable way,\nthen the only real functional issue left is the lack of middle-mouse scrolling. Is that the main reason you aren't comfortable with it? Or is it more the fact that we have to manually position/size the scrollbar in that approach?\nJust want to make sure I know where the goalposts are :) Thanks.\n. Closing since I'm submitting a new version.\n. Good catch. I had it that way to keep the logic in that case the same as it was originally, but it didn't occur to me that we could use the new flag to optimize it further now.\u00a0Thanks.\n. Sounds good. We'll do some testing after you merge into master.\n. Ok--I just wasn't sure if you were going to make further tweaks when you merged it. I'll see if we can get our testing in on Monday.\n. Quick update on this--we've had some other distractions over the last couple of days, but should have our testing finished by tomorrow. We're testing on:\n- Snow Leopard: Safari, Firefox, Chrome\n- Lion: Safari, Firefox, Chrome (with and without mouse plugged in)\n- Windows 7: Safari, Firefox, Chrome, IE 8, IE 9\n- Windows XP: IE 7\nThe test plan involves taking a large file and testing various scrolling methods--scrollbar thumb, keyboard, mousewheel, touchpad--to make sure everything seems to be working properly. I've also done some more basic testing on various platform/browser combinations with just adding lines to a blank doc and then deleting them to make sure the vertical scrollbar properly appears and disappears.\nDoes that sound ok?\n. Thanks for suggesting the wordwrap testing. We had been doing testing with wordwrap on, but I did more testing around typing at the end of the document, and found some issues there which I've addressed with this new commit. The basic changes were:\n- move updateVerticalScroll() close to the end of updateDisplay(), after line heights have been recalculated\n- ensure that scrollCursorIntoView() gets called after updateDisplay() if line heights have changed\nHowever, there's still one wordwrap-related bug, and I'm having trouble figuring out a good fix. The bug is that if you type into the last line of the document when wordwrap is on, and the line wraps over into multiple lines, the content sometimes \"bounces\"--it scrolls up one line and then back down.\nThe problem occurs because updateLinesNoUndo() tries to \"guess\" the height of the line and update it right away (and often guesses wrong); later on, in updateDisplay(), the actual height gets correctly recalculated and updated. So the doc.height is actually incorrect for a period in the middle of the typing operation, and is often actually shorter than the true height in this case.\nupdateVerticalScroll() gets called at the end of updateLinesNoUndo(), while the doc.height is incorrect, and so the virtual scroll area gets temporarily set to that shorter height, causing the content to temporarily scroll upwards (which pushes the cursor off the bottom of the visible area). Later on, at the end of the operation, the virtual scroll area is properly recalculated, and then scrollCursorIntoView() causes the content to scroll back down.\nI believe the reason this wasn't a problem with the original scrolling method is that it didn't really matter if the size of the code div was wrong, because the outer scroller would always take all of the actual child content into account anyway. (This was why earlier bugs like the maxLine calculation being wrong didn't affect scrolling.) With the new scrolling approach, it's important for the calculated virtual scroll size to be accurate whenever updateVerticalScroll() is called.\nI considered taking out the call to updateVerticalScroll() from updateLinesNoUndo(), on the theory that updateDisplay() would always get called later and the scroll position would get updated at that point anyway. (That call basically replaced the original code at the end of updateLinesNoUndo() that updated the code div's size.) Removing that call mostly seemed to work, but it led to a different minor visual symptom, where if I pasted a large number of lines into the editor, I would seem to see a couple of interim repaints during the paste. It didn't seem terrible, but it also didn't seem like a good sign that the change was safe :) \nDo you have any thoughts on how I could work around this? Is there some easy way we could avoid having the height be temporarily wrong in this case?\n. Actually, in the original code, updateLinesNoUndo() updated the height of the code div at the very end. I replaced that with my call to updateVerticalScroll() since that's now the code that's responsible for keeping the virtual height in sync with the document height.\nIt makes sense to me to just take that out, and keep updateLinesNoUndo() purely about the document model--I wasn't sure if you had some other reason for updating the scroll height at the end of that function. If not, then I'll take it out and see if I can figure out what the visual glitch I was seeing is about.\n. Okay, I think I know what's going on. If I take out that updateVerticalScroll(), that fixes the \"bouncing while typing in the last wordwrapped line\" issue by making it so that scrolling-to-cursor doesn't happen until after the display is fully updated. But that means that if you paste a large block of text, it renders first at the current scroll position, and then immediately scrolls afterwards to the bottom of the pasted text. \nIt's kind of a chicken-and-egg problem. To avoid the issue with the scroll height getting set incorrectly due to the guessed line heights, I have to make sure not to update the scrollbar until after the true line heights are properly recomputed during display update. But if I don't scroll till then, then I'm going to be rendering in the old scroll position first. The only way I can think of around this is to try to get the accurate line heights before doing the render, but we use the render itself to determine the line heights...\nI'll think about it some more (would hate to get this far and have this one issue kill the whole deal :)), but maybe you can help me understand something: It looks to me like the only time the true line heights are computed is in updateDisplay(), and that only does it for the rendered range. So it seems like if you pasted a long document with wordwrap on, the doc.height (and various individual line heights) might actually be incorrect by a nontrivial amount for long periods of time (since any lines that have never been rendered might have an incorrect height). Yet there don't seem to be any glitches with the scroll position, mouse coordinate mapping, etc. in the current master, even though the actual overall calculated height of the doc might be changing as you render different sets of lines during scrolling. Is that just because the amount of adjustment that happens as you render/adjust line heights is small enough that it doesn't significantly alter the scroll parameters in a long document anyway? Or is there something else about the line height update that I'm not understanding?\n(Thanks for your continued patience...)\n. Hi Marijn--I spent a little more time thinking through this, and I think I have a solution that might actually also fit well with the existing code. But I want to make sure I understand one subtle bit of the existing code first.\nCurrently, in endOperation(), we do the following sequence (if the selection has changed):\n1. reScroll = !scrollCursorIntoView()\n2. updateDisplay()\n3. if (reScroll) scrollCursorIntoView()\nIf I understand the existing code correctly (before my patch), the rationale for the double scroll is that in the first scroll, the code div's width might not yet have been correctly updated (because we haven't updated the display yet), and so if we try to set the horizontal scroll position to the right of the old width, it will get clipped in the first scroll. So we have to scroll again afterward. Is that right?\nIf so, then my current case (where a large paste is causing multiple renders) is exactly analogous to the edge case you already have for horizontal scrolling. Because of my other changes, the vertical scroll area is no longer updated before endOperation() (in order to avoid it being temporarily set incorrectly due to the line height guesses being wrong). That means that the new vertical scroll position (at the bottom of the large paste) can't get set properly by scrollCursorIntoView() before the updateDisplay(), because it gets clipped to the old scroll height. So it renders at the old position first, then at the new position later after the second scroll.\nMy plan for fixing this is to make it so we don't actually try to scroll before the updateDisplay()--we just calculate what the desired scroll position should be, and use that to figure out what visible lines we should render (but don't actually set scrollbar.scrollTop yet, so it doesn't get clipped to the stale scrollHeight). Once those have been rendered, the line heights will then be correct (at least for that portion), so afterwards we can update the scroll height and everything will be hunky dory. We could handle the horizontal scroll position the same way--calculate the desired position before the updateLines(), but don't apply it until afterwards so it doesn't get clipped by the stale code div width.\nI've prototyped this and it seems to fix all my problems, but I want to clean it up and test it thoroughly before pushing it (probably to a new branch). But I just wanted to double-check that I'm understanding the rationale for the existing scroll/update/scroll code correctly.\n. OK, thanks. The last commit I just pushed hasn't been fully tested yet, but you can see the basic approach I'm taking (refactoring out the calculation logic from scrollCursorIntoView()/scrollIntoView(), and passing the calculated scrollTop into updateDisplay()). Note that afterwards, I just go ahead and call scrollCursorIntoView() to resync everything (instead of passing the previously calculated values) so that we know we're getting the true new cursor position based on the updated line heights--this might cause a small amount of rescroll but it should be minor (and I haven't seen it in my own testing yet).\nIf you get a chance to glance at it, let me know if it seems okay in general. I'll do deeper testing today and fix any problems I find if any, then put up a new branch/pull request with all the scrolling stuff rebased/squashed into a single commit.\n. Making progress, but I did find one issue: the act of pasting into an empty document causes the scrollbar to appear, but in my original logic the scrollbar doesn't show till after the line heights are calculated...which is problematic because the scrollbar appearing can actually change where lines wrap. So when linewrapping is on, I now pre-guess whether the scrollbar would need to show up and set its visibility appropriately before doing the line height recalculation. \nAlso, I ran into issue #548, which is also affecting my test case because when the gutter width changes it changes the word wrapping as well. My test case might be a little pathological (the source of the Wikipedia \"Cats\" article, which has a lot of very long lines), but I wanted to stress out my changes, and apparently I am :) In a more normal file, this doesn't seem to happen.\nStill need to do more testing with this latest change. I'm a bit tied up tomorrow but will continue to try to make progress.\n. Closing. Final (hopefully) squashed pull request at https://github.com/marijnh/CodeMirror2/pull/551\n. I can reproduce it in Chrome on both Lion and Win 7. It's a little subtle since the width is only changing by one space character.\nBTW, I just realized there's a \"View Source\" tab on the wiki page--I meant to do the standard browser \"View Source\" to get the HTML of the whole page. I'll clarify this in the steps.\n. Found this while testing my scrolling changes (they exhibit the same bug, which maybe is a good sign that the changes haven't disrupted the overall logic too much :))\n. No, the bug still occurs with my changes. I haven't debugged into it to figure out where the problem is.\n. Fixed. It turns out that I can't do the scrollbar element measurement at the same time as the other feature-detection cases because document.body doesn't exist at that point if the script is loaded in the <head>. So I do it during instance construction instead. (For Brackets that should also have the useful side-effect that if the user does plug/unplug the mouse, it will be reflected the next time a document is opened.) Hope this is okay.\nI retested Chrome/Safari/FF on 10.6 and 10.7, and IE 7/8/9 on Windows, to make sure the scrollbars appear properly (I didn't redo all my testing since the main thing was just to set the scrollbar style properly). Note that FF on Lion still always shows scrollbars in general (it doesn't support the new Lion scrollbars yet), so it does so in CM as well. That works fine with this new approach--it just means that it always hits the \"non-overlap\" case. If it does support the new scrollbars in the future, it should theoretically work fine too.\n. Great, thanks for all your help! And sorry about the missing semicolon, that was sloppy.\nOn May 31, 2012, at 4:31 AM, Marijn Haverbeke wrote:\n\nMerged at last. I'll send a mail to the list to ask people to help test.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/551#issuecomment-6033517\n. I'm guessing this is another issue with % and em font sizes/line heights causing rounding errors, but I haven't debugged thoroughly into it yet. I'm generally tied up this week, but should have some time either this afternoon or tomorrow afternoon to look at it.\n. Nope, this is a different issue--it looks like we're not dealing well with the 100% heights. Looking into it now.\n. This seems to have broken a few months ago with 9b900e5--it doesn't seem to have been affected by the new vertical scrolling implementation. Perhaps the fix could be analogous to the \"atLeft\" fix you made for the horizontal scrolling case, since it's kind of similar.\n. The problem with removing this code is that without it, interacting with the scrollbar causes the editor to lose focus, so after scrolling you have to click back into the editor to start typing again, use keyboard shortcuts, etc. People generally wouldn't expect focus to get lost just by interacting with the scrollbar.\n\n@nlwillia -- could you describe your use case a bit more? I'm not sure why a user would think that clicking on the scrollbar shouldn't be like focusing the editor (and in fact that's what would have happened in the old code if focus were outside the editor and then you scrolled the editor--the editor would take focus at that point, because the scrollbar was part of the editor).\n. BTW, I verified this behavior just now on Win 7 in Chrome. I don't know if all browsers/platforms cause the editor to lose focus when the scrollbar is clicked.\n. Hi Marijn--sorry for the late response on this. I just tried demo/theme.html in the v3 branch, pasting in a long file, and on Lion I don't see the scroll thumb at all (though it does scroll if I use the touchpad). Also, the scrolling is flickery on long/fast throws.\n. I should mention that I'm testing in Chrome 21.0.1180.89.\n. Yup, looks like the scrollbars are working again--and I can grab them as well, which is great! \nI'm still seeing noticeable flicker on long throws, especially in the gutter area. There's also a minor visual issue with the fake scrollbar on Mountain Lion (which changed the scrollbars slightly yet again...). I'll file separate bugs on these.\n. Mentioned to Marijn in email--I can take a look at this, but probably not before next week. I'm happy to get rid of the pointer-events hack if we can find an alternative solution to this bug.\n. Hi--I'd forgotten about this issue in Safari (since we only run Brackets in Chromium currently). I took a look at this in the current v3, and unfortunately, since we're back to manually handling mousewheel events, this bug is occurring again. Are you able to reproduce it on your Mac now, or are you still having trouble with touchpad scrolling?\nIt does seem to be correlated somehow with viewport size, in that if I increase the viewport margin it takes longer for the bug to occur, so your theory that it has to do with when DOM nodes are destroyed is plausible. I'm having trouble devising a hack to properly test this, though:\n- I tried saving off the first DOM node that got a wheel event, and then simply not killing that node in patchDisplay(). Unfortunately, that breaks patching, so it's not a good test.\n- I tried augmenting that experiment by also skipping over the unkilled node in the various other bits that advance curNode in patchDisplay(), but couldn't get that to work either, probably because I don't understand that code well enough.\n- Instead of killing the node, I tried reparenting it to document.body, but then the scrolling bug came back, so, if removal is indeed the culprit, reparenting is having the same effect.\n. @adrianlang -- awesome, thanks for working on this.\nI just tested it, and I have good news and (slightly) bad news. The good news is that it works great for me in Safari. \nThe slightly bad news is that it looks like the original bug now also shows up in Chrome. This isn't due to a regression in CodeMirror--it has to be due to some change in recent builds of Chrome that makes them exhibit the same behavior as Safari. (I verified this by testing the current v3 in Brackets, which is based on an older build of Chromium--it works fine there. Also, I checked out older v3 commits that I'm pretty sure worked last time I tried it in Chrome, and it's broken in the current Chrome.)\nThe good news is that I just tried commenting out the if (safari) cases related to scrolling in the latest patch, and that seems to fix the problem in Chrome as well. (The patch also doesn't seem to break Brackets, which is based on an older Chromium, so I don't think enabling it will break older versions of Chrome either.) So I think you just need to generalize the fix to also work in Chrome. \n. FYI, I'm on Chrome 23.0.1271.64.\n. Yup, latest v3 looks good to me with Chrome 23.0.1271.64 as well. Thanks!\n. b38776d alleviated this somewhat, but it still occurs in this case.\n. One thing to note is that the wobble isn't a single pixel--it appears to be multiple characters' worth, at least on my machine.\n. Sorry, I missed your comment. This does indeed seem to fix the flicker, although I agree it's a kludge :) \n. Just discovered a problem with this hack: it breaks horizontal scrolling (because the vertical scrollbar's div is the one handling the events). To fix this, I think you'd have to temporarily set that div to horizontally scroll as well, with the same parameters as the horizontal scrollbar.\n. Cool! It does seem to work fine in Safari, so #728 will be obsolete once this is in master. I am seeing one glitch with horizontal scrolling, which I'll file separately, but overall it seems to be working (and also seems to fix an issue with the fixed gutter jittering around that I had noted in earlier versions). Thanks for pushing on this!\n. Hi--sorry again for the delayed response. As I mentioned in #881, I'm now seeing flicker on initial throw scrolling in a large file, but it seems to go away once I've scrolled through the file once.\n. Hi--with your latest (Herculean!) changes, this is looking good in Brackets on my retina MacBook. I think your current approach makes sense--hardcode default values, but still measure to fine-tune the behavior.\nI am seeing a little bit of stuttering (more obvious when it's on my retina display than on the external monitor, since it's pushing more pixels), but it's not bad, and I suspect it's partly just due to the way mousewheel events are reported in WebKit--they're pretty jittery (we filed a WebKit bug on this; see https://github.com/adobe/brackets/issues/208 and https://bugs.webkit.org/show_bug.cgi?id=81040)\nStill need to try it with my Air--I'll do that tonight. If it looks good there, I'll close this.\n. Looks good on my Air too. Performance seems comparable to or better than our old v2 branch, and I don't see any flicker.\nThanks for pushing so hard to get this right!\n. 18px seems to be big enough, but setting the hard-coded width to that size all the time means you can't click on the rightmost characters of lines that hit the edge of the window. So maybe it would be best to add a hover.\n. I see your point--we don't have a guaranteed way to detect when the scrollbar is visible, and if we just make the div fatter whenever the mouse enters the area, that's going to lead to the same problem as just always making it fatter (you won't be able to click on what's underneath it). \nThe only way around this I can think of would be to actually decide ourselves when to show/hide the scrollbar div--basically mimicking the OS's own heuristics for showing/hiding the scrollbars. That would fix the \"dead zone\" that you get in the current implementation when you're not actually scrolling. From what I can tell, the heuristics are: \n- scrollbars are shown once a scroll actually starts or the scroller's client area is resized\n- once shown, the scrollbars autohide once a certain fixed time has passed since the last mouse event over the scrollbar area\nThat said, I don't know if we want to get into the business of trying to mimic the OS show/hide heuristics...if we're not comfortable with that, then probably the best we can do is just increase the fixed width on Mountain Lion to 18px.\n. The fix works, though it's a bummer that it widens the \"dead zone\" on the right. I don't have a great solution for this right now, so closing.\n. It was noticeable even before the scroll-wheel hack, but it was a little hard to compare apples to apples because the flicker made it harder to evaluate the stutter for long throws.\n. By the way, it seems noticeably worse in Chrome than in Safari (though that's always been the case for the virtualized scrolling in my experience).\n. Hi Marijn--sorry, I had an unexpected family emergency last week and have been out of town. (Everything's okay now.)\nIf I go back to the last time I pulled upstream (705b0a7) and change the default viewportMargin to 10 there, it does improve the overall scrolling performance, but when the overall window size is large it still hitches towards the end of the throw (probably because multiple rerenders during that time become more noticeable). \nWith the current upstream (as of b276da2) and the new default viewportMargin, the scrolling also seems faster, but the flicker is back during initial throw scrolling in a long file (e.g. codemirror.js). Oddly, after scrolling through the file once, going back to the top and then scrolling again, I don't see the flicker. I haven't had a chance to look through your most recent scrolling changes to see how it's currently working, so don't have a theory for why this is happening. Perhaps it's related to highlighting?\n. It was definitely flicker. I'll check on the scenario you suggested tomorrow and let you know.\n. Hi--I looked at this a little more closely today. It's definitely flicker, in the sense that what seems to be happening is that the rendering isn't keeping up with the scrolling, so the bottom portion of the editor is often blank during the scroll. It may be more noticeable if you make the editor taller, though I can see it even with the vanilla theme demo in v3 if I paste codemirror.js in. (I'm using Mac Chrome on a MacBook Air.)\nI tested the highlighting theory by adding a /* at the top of the file and then trying to quickly scroll down (I also removed some */s from the code so it would affect a large chunk of the code), but that didn't seem to re-trigger the flickering as far as I could tell. Also, the flickering is a little funny, in that if you do an initial throw scroll to scroll down, and then scroll back up after a little bit, it still flickers. It's only after a little bit of scrolling around the file that the flicker seems to stop, but once it does, it's fine from then on (even if you do something like delete all the text in the editor and then re-paste it).\nAnother data point: the flicker doesn't happen if I hold down Page Down instead of throw scrolling (which isn't surprising, but just wanted to mention it).\n. It definitely looks sloppy on the first set of throws, but after that it's fine, and it also seems fine if you then open other long files in Brackets within the same session. So your JIT theory seems plausible, though it's a little odd that it takes so long to kick in.\nI think we could track that issue with #810. As far as the speed/smoothness of scrolling goes (which was the issue in this bug), it's actually seeming quite good on my retina MacBook now, but I need to do a little testing with a slower machine before I'm comfortable calling this one fixed. I'll circle back on that tomorrow when I have my MacBook Air with me.\n. Verified that this and #915 are fixed, thanks.\n. Note that if you delete the long comment above the define() at the top of the file, this no longer happens.\n. I'm not seeing the selection problems on the latest v3 head, so perhaps other fixes you've made recently have fixed it. If I see them again, I'll reopen a bug with more specific info. Thanks.\n. Looks good, thanks.\n. Verified, thanks.\n. Sorry to file another one of these :( I just noticed it while regressing the previous bug. At least it doesn't involve throw scrolling...\nI did some git bisecting, and I think the reason this didn't come up before is that before 5d3a42e, the horizontal jiggling of the gutter only occured during the initial wheel sampling period (similar to the behavior the flicker used to have), and since I was testing vertical scrolling first, I would never notice the horizontal scrolling problem. Now, though, it happens all the time, even after scrolling around for awhile.\n. @marijnh -- unfortunately, that patch doesn't seem to fix the problem for me in either Mac Chrome 23.0.1271.64 or our older Chromium shell in Brackets. The gutter still moves far out of position during horizontal touchpad scrolling.\n. Hmmm...I think what's happening with the new patch is that I'm sometimes getting the better behavior you're describing (mostly stable, but occasionally overshooting), but I'm also sometimes getting much worse behavior where it's going all over the place throughout the scroll. I'll try to find reproducible steps for the worse behavior.\n. Also, when I integrate it into Brackets I always get the worse behavior (whereas in current Chrome I sometimes seem to get the \"mostly stable\" behavior).\n. Very mysterious. For awhile I was in the state where I was seeing the \"mostly stable\" behavior you described (even if I reloaded the theme demo page), but immediately after quitting and restarting Chrome, I'm now seeing the highly unstable behavior again (and it doesn't seem to be going away). I've cleared my cache and am still seeing the unstable behavior.\n. The ideal solution would be to somehow be able to handle just the horizontal scrolling manually, but I can't think of a way to get that to happen. Is there some crazy way to tamper with events so that we can get the horizontal component but poke it to 0 before it gets to the native code? (I would guess not, but...)\nThe only thing I can think of would be to pop the gutter out of the scroller and handle its scrolling manually, which would lead to its vertical scrolling lagging slightly behind the main code's scrolling. Not great, but might be a better tradeoff than what's happening right now. \nWhich browsers/platforms had the most problems with manual wheel event handling? We haven't gotten any complaints so far about our original scrolling implementation in Brackets on Mac or Win, but that's only running in Chromium right now (though we'll need to deal with other browsers eventually). My recollection was that the main problem was with Firefox, which seemed to send out very low-resolution wheel events--perhaps we could lobby for that to be improved (and since I think they're doing silent auto-update now, perhaps we don't have to worry as much about downrev versions).\n. Another (probably dumb) idea: could we use requestAnimationFrame() while a scroll is happening, using it to check the native scroll position at a high rate and update the gutter's horizontal position? Maybe that would let us keep in sync better than scroll events do. It's basically polling, though, so don't know what the performance impact would be. Also, we would still have to know when to start polling, which we wouldn't until after we got the first scroll event, so we would still have an initial jump...but maybe we could get in fast enough that it wouldn't be noticeable.\n. Hmmm, maybe it's not such a dumb idea. requestAnimationFrame() seems to be supported in all current browser versions except Opera, and in some ways it seems appropriate to what we're trying to do (maintain smoothness during an animation by updating things before the browser renders).\n. Understood. \nI'd like to prototype the requestAnimationFrame() idea just to see if it has any possibility of working, but most likely won't have time till next week due to the upcoming US holiday. It's true that you wouldn't catch the first scroll event, but maybe you could get called in between subsequent scroll events.\n(I guess another reason for skepticism is that even if you do get called at a faster rate than scroll events, the native scrolling might not actually update the element's scrollLeft and scrollTop in between. But there's no way to know without trying it.)\n. Hey--getting closer :) Just tested it out and it does seem to fix the horizontal scrolling. However, that commit is somehow reintroducing the previous problem of vertical throw scrolling stopping early, in both Safari and Chrome. (It doesn't occur if I roll back to the previous commit.) The behavior is different though: if there's any horizontal component to the scrolling, the scroll stops after a short time, but if the scrolling is purely vertical it works fine.\n. Ah--it's because you're returning before setting cm.display.currentWheelTarget if you detect any horizontal motion. If I copy the code that sets it into the if (dx ...) block (above the call to setScrollTop()), it seems to fix the problem.\n. Yes, that seems to work! I just did some light testing in Chrome, Safari and Brackets, and it seems fine so far. We'll be doing more CM work either later this week or next week so we can bang on it more then, but I'll knock on wood that this is it :) Thanks again for all your work on the scrolling stuff!\n. Shhh, the evil eye will hear you.\n. Shhh, the evil eye will hear you.\n. Argh, sorry!\n. Hi Marijn--I was going to add a unit test for this, but it didn't work since testground is invisible, so children of it can't take focus. QUnit and similar frameworks get around this by making the test area visible, but placed at a large negative coordinate offscreen; should we consider doing that for tests like this?\n. This patch works well in general when I manually test my use cases. However, in the course of trying to write a unit test for it, I discovered an edge case where it doesn't work. If the document is short enough, then in updateDisplayInner(), we hit the case if (intactLines < (to - from) * .7), which sets the lineDiv to display: none, killing the focus. So when it gets into the patchDisplay() call on the next line, the focus is already lost. Perhaps the focus restoration should be moved up into updateDisplayInner() so it wraps all that logic.\nRegarding the testground, I tried generally moving it offscreen for all tests, but one test (core_doubleScrollbar) fails if I do that. So instead I just moved it offscreen for my test (but did it by adding a CSS class that other tests can also easily add/remove if desired). Does that make sense? If so, I'll submit a separate pull for it.\n. Thanks, the new version still works for me.\n. Ah, I hadn't noticed that the final version of my unit test would still break the case you had mentioned previously. Sorry about that.\n. Works great, thanks.\n. Closing for now--realized that we have other issues with horizontal sizing/scrolling for nested editors that need a larger discussion.\n. Similar to #1102.\n. Makes sense, thanks.\n. Hi Marijn--I neglected to mention that this was using horizontal touch-scrolling, which might explain why you're not seeing it--I've updated the steps. It doesn't reproduce for me if I use a mouse and drag the horizontal scrollbar. However, if I do have a mouse plugged in, and then I touch scroll according to the steps above, the problem occurs after that whether I use touch scrolling or drag the scrollbar with the mouse. So I'm guessing it has something to do with the mouse-wheel handling. (Yay.)\nAlso, in order to reproduce it consistently, it appears that you have to do step 2 first (scroll horizontally while the editor is its natural width) before resizing the window narrower--if you start with the window narrow before scrolling, the issue doesn't seem to happen (at least not right away).\n. FYI, git bisect seems to indicate that the problem was introduced with 67a5429. I don't fully understand the code, but is it possible that when rewrapping a reused (widget) node, we're losing the information that marks that node as noHScroll?\n. Yup, it looks like that's the issue (although I'm not sure why lines are being rebuilt during a horizontal resize). I put up a test patch in https://github.com/marijnh/CodeMirror/pull/1187 that seems to fix the issue for me--it's just a quick hack, but maybe you could use it as the basis for a real fix.\n. Hmmm--looking at 83ad399, it seems like it assumes that all widgets are alignable (not just the ones with noHScroll set), unless I'm missing something about how that code works. (In my patch, I only re-added widgets with noHScroll to reuse.alignable.) That doesn't actually affect us since all our widgets are noHScroll, but it would affect anyone who had horizontally-scrolling widgets.\nAlso, I'm still seeing another issue where after resizing the window, the line widgets no longer keep their width set to fill the container horizontally. I have a suspicion that this is because in the reuse case, we're bypassing the code in buildLineWidget() that updates the width for noHScroll widgets. That issue doesn't repro in the gist I posted for #1184 initially though...I'll file a new bug once I've got that narrowed down.\n. That fixes the issues above, but now I'm seeing a new problem with the gutter in a nested CM instance inside the line widget not being properly positioned initially--no idea how that would be related to your changes, as they look fine to me. I'll come up with an isolated test case and file a new bug. Thanks.\n. FYI, it looks like the last issue I mentioned is fixed by @jasonsanjose's pull request #1206.\n. @marijnh - templates are put in <script> tags so they can be kept in the main HTML file without actually being rendered directly; typically, the app's JS code pulls the text of the template out of the <script> tag as a string, then passes it to the template framework (Handlebars, Mustache, etc.) to compile it into a template function. (This is considered nicer than having the template string as a literal in the JS itself since it keeps all the HTML-like content together.) Later, it calls the template function to merge data into the template, which produces another HTML string that is then shoved into the DOM programmatically via innerHTML, jQuery, etc.\n. Nice. @redmunds -- let's coordinate on the next merge from upstream (hopefully near the beginning of this sprint).\n. I like the idea of having both the \"+\" and \"\" flavors. That would give us the flexibility to choose time-based vs. non-time-based heuristics in different situations. Also, we could do things like generate unique origin strings in cases where we want more fine-grained (but non-time-based) control of merging--so if we want to guarantee that a new sequence of edits will merge with itself but not with previous edits, we could just generate a new unique \"\" origin for that sequence.\nThanks!\n. Thanks, this seems to be working at first glance (though we're only exercising the \"*\" form at the moment). Will let you know if anything crops up.\n. Interestingly, this didn't seem to actually fully fix our problem. I haven't dug into it to figure out why yet (and we're right up against the end of a major sprint), but we have a workaround we can use for now. I'll let you know if we figure out whether there's some other issue here.\n. Submitted as #1256. \nRegarding the \"proper\" solution, I was thinking of something fairly simple--basically, add a flag that would be set in endOperation() when a selection change would require a scroll-into-view while the editor was invisible, and then make it so on the next refresh(), if that flag was set and the editor is now visible, then scroll the current selection into view.\nAlternatively, maybe it would be good enough to just expose a parameter to refresh() that would force the cursor to scroll into view if it's not already visible, so that clients could pass it when they know they're re-showing an invisible editor.\n. Makes sense. Thanks.\n. Hmmm, this isn't quite as straightforward as it might seem. For our purposes, we would want change events from documents to be batched in operations, the same way editor change events currently are. But operations are fundamentally a view concept in CM today, not a doc concept.\nIdeally the way the model would work would be that documents can batch edits into operations at the document level, and then once the batch is done, the document (and all linked docs) send their change events to the views, which then do their updates. But this is a bit tricky since operations today also batch view changes like scrolling, etc.\n. Thanks!\n. More info: It doesn't seem to happen when a horizontal scrollbar is permanently visible (as on Windows, or on Mac with a mouse plugged in). It only seems to happen when there's no horizontal scrollbar, or it's the overlapping Lion scrollbar.\n. Actually, that's not accurate--@peterflynn has reproduced this on Windows (at least in Brackets). But in my testing, if I turn scrollbars to \"always on\" on Mac, I can't reproduce the issue in CM, so it's at least harder to hit if the scrollbars are visible. Still, that might be a red herring.\n. Ah, I figured it was some automatic browser scrolling but didn't think of the hidden textfield. The patch seems to work--thanks!\n. Thanks, that seems to fix it.\n. Okay, I think I know what's going on. We're setting vertical padding on both .CodeMirror-lines and .CodeMirror-gutters (since we want a little space at the top of the code area). I think the gutter padding used to be necessary in v2 because the line numbers were actually separate, but now that the line numbers are laid out as part of the lines themselves, it seems like we should only have it on .CodeMirror-lines. Does that sound right?\n(Also, it was probably wrong for this padding to be on .CodeMirror-gutters to begin with--it was probably on .CodeMirror-gutter in v2, but it was in a block of styles that ended up needing to be on .CodeMirror-gutters instead, so it just got moved along with them.)\nSo, if that sounds plausible, I'll just close this (but please confirm that it makes sense to only have top padding on .CodeMirror-lines and not the gutter). Thanks.\n. Updated title and description with more detail about the cursor change issue.\n. I can see your point, though I think one could argue just as well that insertion using replaceRange() at the cursor is like inserting \"before\" the cursor rather than after it. I think that was our mental model, since pretty much any user-initiated insertion action you do at the cursor causes it to advance, so it made sense to us that replaceRange() would have the same behavior if the insertion position was at the cursor. \nI guess the main issue is that we have a lot of existing code that relies on the previous behavior (potentially including code in Brackets extensions, which we don't directly control), so it would be a pain for us to add fixups in all those places. That would be ok if the existing (undocumented) behavior was obviously wrong :), but in this case it's not obvious to me that the original behavior was incorrect.\nWere there bugs that this change fixes, or was this more of an API cleanup?\n(As an aside, it doesn't look like the second argument to replaceSelection() is documented.)\n. > Moving the cursor forward there surprised serveral users, which is why I decided to stop doing it.\nI can see that that seems like the wrong behavior in some cases, although in other cases it might still be correct. For example, in one of our cases (HTML attribute code hinting), we have a case that looks like foo=\"|bar\", where the cursor is at | and the user selects a new attribute value, so we replace \"bar\" with the new value. In that case, it still makes sense for the cursor to go to the end, as it does when the cursor is in the middle of the value.\nAll that aside, after your most recent change we really only have a couple of edge cases that are now different, and if we want to fix them back to the previous behavior, we only need to change it in a couple of places (or we could fix them in a bottleneck wrapper function we have around replaceRange()). So I think we're okay with whichever way you want to go at this point.\nThanks.\n. One final thought...I wonder if the fact that there are various differing use cases here suggests that replaceRange() should take the same cursor positioning hint argument that replaceSelection() does (but only apply it if the cursor happens to fall within the range). \n. Makes sense. Thanks.\n. Just force-pushed an amended commit that clarifies the unit test by making another edit before clearing the history.\n. Makes sense--I was just thinking in terms of keeping the original behavior, but I think you're right that they're logically separate. Closing.\n. (Would this be as simple as setting doc.frontier and then calling highlightWorker()?)\n. (Oh, I misunderstood what doc.frontier is--it's the last line already highlighted, not the last line we want to highlight to.)\n. Actually, I have a better suggestion for fixing the problem we're having. I'll put up a pull request for it.\n. It looks like the problem was that our unit tests create a mock container for the editor, and that mock container is absolutely positioned with no explicit width, so it's 0-width by default. This didn't cause a problem before, but I can imagine that it would cause issues after this change, since the editor itself will be the one that's determining the width of its container, so I can imagine how it could get into some kind of feedback loop (though I didn't dig into it to figure out exactly where the loop was causing form). I was able to work around this just by setting an explicit width on the mock container in our unit tests, since that's more realistic anyway.\nI don't know whether this is something that actually needs to be fixed in CM; this use case certainly isn't likely in normal real-world usage, but perhaps it's possible for someone to have a 0-width or small-width container in some edge case (e.g. at the start of an animation?), and it would be bad for CM to hang in that case. (I didn't actually create a test case with vanilla CodeMirror to see if that would trigger the same hang, though.)\n. BTW, I didn't verify the original issue was fixed since I haven't been involved in the details--I'll put up a pull request in Brackets and have @RaymondLim verify that we're all set and can close this CM issue.\n. Seems fine, thanks.\n. Ah. Originally the intent of the flag was only to be used in cases where we were looking up a single token, not in scanning the whole document. But it makes sense to reset the frontier afterwards to make future lookups faster.\n. Thanks!\n. I believe the reason for this is that when CM hits the maxHighlightLength, it assumes that the current state should carry over onto the next line, which often won't be true. Would it be make sense for modes to specify a neutral state to reset to when the maxHighlightLength is hit?\n. (BTW, I realize that there's no state we could reset to that would be correct in all cases...but as a heuristic, it might make sense to let a mode specify some reasonable default behavior.)\n. In this particular case (which is probably the only common case where you would actually be hand-editing a file with such a long line), that wouldn't actually help, I think, since long lines are likely to be within CSS rules rather than outside them.\nWhat do you think of @peterflynn's comment? Was the tokenization hit for long lines significant, or was it just the highlight spans? \n. Updated title to note that this is with the closetag addon.\n. I think this has something to do with the fact that when you do the shift-right-arrow, the selection on line 3 (the blank line) starts to overlap the selection on line 4. Once that happens, various other bits of behavior seem to go haywire.\n. Yup, that seems to fix all of them. Thanks.\n. I actually don't know that I necessarily prefer the Ace/Sublime behavior; I haven't used multiple cursors much myself so I don't have a good feel for whether there are reasons they're designed the way they are, or if it's just an accident of the way they happen to be implemented. But it seems worthwhile to be consistent with other editors.\n. That seems to fix it. Thanks.\n. Seems fixed, closing.\n. Fix looks good, thanks.\n. Sure, I've already done that :) I just hate copy/pasting code. But it's fine for now.\n. I've also noticed that throw-scrolling on the Mac is flickery again--you can see blank areas as it scrolls. I'm wondering if that's related - if the fix for this bug doesn't fix that, I'll file a separate issue.\n. Looks like it was caused by https://github.com/marijnh/CodeMirror/commit/32c263022042726d2df60f31541a3ea3ce4df2aa\n. Looks fixed, thanks.\n. Seems fixed. Closing.\n. Thanks, that seems to have fixed it.\n. Submitted #2280 for this.\n. I think that would work for us. Thanks.\n. Thanks, looks like this is working properly now.\n. I see it intermittently on 10.9, but can't figure out a reliable recipe to reproduce.\n. What I was thinking was that the time-based merging should really only be restricted to the basic navigation operations, and that other selection operations should never merge. So perhaps you could just have some internal argument that would let you specify merging just for the move-by-char/move-by-word/move-by-page operations, and not expose it in the public API.\nThe heuristic you coded up basically makes sense, but one case it wouldn't handle would be if there were something like a bookmarking feature that identified different points (cursors) in the file, and the user switched between different ones. I think they would expect those all to be recorded in the selection history.\n. That's true, but I feel like it's going to be significantly more common for people to want to create navigation operations that shouldn't have their selections merged, so it makes more sense for that to be the default rather than requiring more work. It's similar to undo - you want to merge nearby typing edits, but you don't usually want to merge most other operations.\nThat said, if you were planning to also keep the heuristic that avoids merging non-empty selections, then I guess you would only need to call this special function if you're setting a cursor selection and you think the previous selection might have been a cursor. That seems a little weird from an API point of view though. The boolean on the selection APIs seems cleaner, though I appreciate not wanting to have endless lists of optional arguments.\n. Thanks - that looks good and seems to work well overall. The one tweak I might suggest is to go back to a longer default historyEventDelay - on my MacBook Pro with default settings, if I hold down an arrow key, the delay before the first repeat is longer than 500ms; a delay of 1250ms seems to be enough (I suspect the actual delay is about 1000ms, but setting values too close to there seems to still cause merges). But if you don't want to bake that long a delay into the defaults, we can just set the option ourselves, of course.\n. Thanks. Seems to be working well, and the fix for the redo issue seems to be fine as well. Closing.\n. Oops, I did find one more issue after using it for awhile. If you (relatively quickly) delete a character, hit the down arrow, then delete another character, then undo, the two edits both get undone. That's not a new behavior - it reproduces in v3 too - but the longer history event delay makes it significantly easier to run into.\nI wonder if an edit after a selection change should always force a new event - i.e., you should never merge an edit, a selection change, and another edit.\n. FWIW, I tried a few other editors, and they all seem to follow that heuristic - explicit selection changes between edits cause a new history item to start.\n. Yup, that seems to fix it. I'll let you know if we run into any issues.\n. I'm running into a problem with the last patch, though it's possible that it's really that my suggestion was bad :)\nI have an edit which I would like to be merged when it happens repeatedly. The edit does a replaceRange() followed by a setSelection() to select the updated content. After the patch above, it no longer merges, even if I wrap an operation() around the edit/selection change pair.\nIs this a consequence of my proposed heuristic above? I would assume that if a selection change is in the same operation as an edit, it shouldn't break merging, since it's really part of the same edit and not a user-initiated separate selection change.\n. Yes, that approach seems more consistent and makes sense, and all the merging cases I've tested seem to work fine. However, I found that the latest patch seems to have reintroduced the \"redo\" issue in the original bug report. As mentioned there, I don't think it's critical to re-fix this if doing so would complicate things too much, but if it's just a matter of reinstating some logic that got lost in the last patch that would be good.\n. Seems to be working. Thanks.\n. Hi Marijn - a followup to the merging changes. After the latest changes, it seems like if I do an edit and a selection (programmatically) one after the other, they won't merge, even if they have the same origin. I think I was expecting that you could use origins to merge associated edits and selections together.\nI can still get them to merge if I wrap them in an operation together, but it seems intuitive that specifying the same origin for an edit and a selection would allow them to merge together as well. Would that be easy to implement?\n(That said, I could also see the argument that now that selections are their own separate history events, it makes sense to use operations to group them with their associated edits. But it might be worth noting the behavior change in the upgrade guide.)\n. Looks good, thanks.\n. FWIW, we discussed this a little bit in Brackets. For now, we're keeping the CodeMirror behavior, because it's not obvious to me that the Sublime behavior is better, but are waiting to get feedback from users to see if anyone complains about it (we had one person comment on it earlier).\n. Yes, that seems to fix it. Thanks.\n. Verified, thanks.\n. (BTW, this isn't a request for v4 specifically - I know you're trying to close that down :))\n. FWIW, looks like all those issues repro in the CodeMirror demo, so it's not due to Brackets-specific issues.\n. (Updated description to point out that on the Mac this only happens if scrollbars are set to always visible.)\n. (Updated description again - it looks like the commit that actually introduced the bug was 2007b3c.)\n. Another data point: it seems like the problem occurs even if you take out the explicit code to update the line widget height and just let the widget node stay auto height as well as the nested editor. (In our case we have to manually set the height in JS because we have other stuff in the inline editor that we need to lay out programmatically, but that doesn't seem to be required to reproduce this issue.)\n. Yes, that seems to work in Brackets as well. Just out of curiosity, is there a reason why you set the min-height of the sizer to 0 instead of just setting it to docHeight as in the normal case? Or is it that it doesn't matter since the gutter container is always present even if there are no gutters, so it's always safe to just let it set the height?\n. That makes sense, although it seems like you'd get into the new code any time the sizer was smaller than the full width of the window, so this code would execute in other cases besides the bug case. That doesn't seem to be causing any problems for us at the moment, but I'm just curious whether there's any risk with this change if it happens to trigger in other situations besides the bug case.\n. Never mind, I guess the sizer is always going to fill the width. \n. Got it. I'll let you know if we run into any problems, but it looks good so far. Thanks for fixing this so quickly.\n. Looks good, thanks.\n. By the way, this and #2431 are the last bugs we're trying to fix before releasing the next version of Brackets with cmv4 and multiple cursors, so it would be great if you could help resolve this soon. Thanks.\n. Updated the fix since I realized scrollbars should be updated after the second check, not before. Let me know if you want me to rebase/squash these together.\n. Closing - the other approach seems better.\n. This appears to be because of 475b2be0 - the comment for that commit suggests that it removed a hack that was no longer necessary for #1474 (in order to fix #2384), but it seems like #1474 still reproduces, at least in Mac Chrome.\n. @marijnh - we're right in the middle of finishing up our release, and I'm tempted to just reintroduce the original fakedLastChar hack for now in order to get it out the door (I think we'd be willing to live with #2384 for now). Do you think there's any risk to doing so? Since that hack had been in CM for 9 months and doesn't look like it should affect/be affected by any other parts of CM, it seems safe enough to me, but I wanted to double check with you. Thanks!\n. Thanks.\n. Not sure how we missed this case in our testing before...\n. Yup, that makes sense and seems to fit the original intent of the code better.\n. Note that to reproduce this, the last line in the text probably needs to be blank. Updated description.\n. Actually, looking at the code more closely, it will probably happen whenever the last line is fully contained in the rectangular selection, but it only seems to reproduce when the selection crosses the end of the document.\n. That seems to fix it. Thanks.\n. Makes sense, thanks.\n. I've gotten this behavior fairly regularly for quite awhile - since well before cmv4 - so it's not a recent regression, I think. However, I've never been able to come up with decent repro steps. The steps above are about as close as I've gotten. Let me know if you have trouble reproducing bad behavior with these steps and I can try to find better steps. Or, if you think you know the problem and have a fix, let me know and I can try it out and see if it improves things.\n. (Updated steps in bug to clarify some things)\n. That's certainly what's happening (i.e., the throw continues even after the scroll position has been manually changed), but it doesn't seem like that should break anything - it doesn't cause problems in  editors or web pages from what I can tell, at least on the Mac.\nCan you think of anything in CM that would likely be affected by this? I was originally thinking it might be somehow related to the mousewheel sampling stuff, but that shouldn't actually affect the scroll position, if I understand it correctly, just what gets pre-rendered as it's scrolling.\nI just tried it in FF and Safari. I wasn't able to reproduce it in FF, but in Safari I was able to get similar weird behavior (horizontal scrolling reversing direction from what it should be, vertical scrolling broken). So it's conceivable it's a WebKit/Blink issue - though since it's intermittent it's possible that it does somehow reproduce in FF and I just wasn't able to trigger it.\n. Ah, I forgot that we were handling scrolls manually and using the measured wheel deltas on WebKit (I thought we were only using it for display update, but forgot about the gutter wriggling issue). It makes sense that that would cause a bug.\nThe fix seems to work in the CodeMirror demo page. I can't easily test it in Brackets at the moment, but I'll close this for now and I can reopen or give feedback the next time we do a merge.\nThanks!\n. BTW - I should mention that I suspect that there are other cases that can cause the wheel delta values to get messed up, but I don't have good repro steps for them. I think it can happen if the user accidentally does some unusual sequence of scrolls early on - e.g. start a throw scroll, then do something to stop it and quickly restart it at a slower speed. When this happens, the calculated deltas cause future scrolling to become either too slow/fast, or in some cases even reverses from what it should be.\nI've never been able to come up with a recipe for this, and I suspect it's impossible to truly fix in general because there's no way for CM to get any information that would help it figure out what's really going on...but I wonder if there's some way to guard against spurious information.\n. (Perhaps if we found that the calculated wheel delta was very tiny compared to the usual average for that browser/platform, or seemed to be reversed from what we expect, we could throw it out and try again.)\n. This was to deal with a bug that occurred in the original CodeMirror code as well as in the new scrolling code--when scrolling through long documents, a scrollbar would sometimes appear on the main browser on IE when it shouldn't.\n. This fixes a bug that I think is reproducible in the original CodeMirror scrolling code as well: on Safari, if you do a touchpad throw scroll, it decelerates for a little bit but then stops abruptly. This seems to fix the problem. The \"cursor: text\" above is necessary to make it so that you get the standard I-beam cursor while over the code (since the code div itself no longer handles the mousemoves).\n. This turns off middle-mouse-button \"pan\" scrolling, which doesn't work with the new scrolling implementation. (It just occurred to me that we might want to only do this if options.flickerFix is false.)\n. We only want to stop the event if we actually scrolled. If we didn't scroll, that means that we hit the top or the bottom of the scroll area, and we need to let the scroll event bubble up so that the main browser gets to handle the scrolling (e.g. if there's a scrollbar on the main browser as well).\n. I couldn't use the gecko and ie_lt9 variables here since they're in a different scope.\n. This argument didn't seem to be used--found this as I was renaming the \"code\" div.\n. The following logic had to change entirely since the gutter no longer receives mouse events directly (the scroller is in front of the gutter). So I look to see if the mouse position is over where the gutter should be. If we want to use mousemoves to detect when the cursor is over the gutter area (to change the cursor from an I-beam to an arrow), we could factor this logic out.\n. The next few diffs are just whitespace fixes (some of the indentation in master was wonky).\n. I had separately submitted this specific fix as another pull request (https://github.com/marijnh/CodeMirror2/pull/482), though in master it doesn't seem to affect anything. It's actually necessary for this pull request, though, because if maxLine isn't kept up to date, the scrollerInner's width won't be set properly.\n. Note that these have to happen before the logic below, otherwise the calculation of lineSpaceX() will be wrong.\n. All of the following deletions are okay because we end up recomputing the scroll area size in the call to updateScroll() that I added at the bottom of this function.\n. This actually fixes a (very) minor bug in CodeMirror right now--if you use Cmd-Right Arrow (or End) to go to the end of the longest line, the cursor is off the right edge of the visible scroll area.\n. The following confusing diffs are just a small refactoring of posFromMouse(), separating out the code that figures out where the clientX/Y coordinates of an event are relative to the lineSpace. I needed this for the gutter click detection code in onMouseDown().\n. This was the only way I could think of to get the cursor to update properly over the gutter. I was worried about setting the style on every mousemove, but it doesn't seem to be sluggish in my testing.\n. We have to set the min-height to 100% here to ensure that the mover is always at least as tall as the scroller client area, so that if a theme sets a background color it covers the whole area.\n. The mover is no longer inside the scrollerInner, so we don't have to consider that case. The only children of the scrollerInner are widgets. (Oddly, the widget doesn't scroll with the scroller, but that's true in master as well. Not sure why that is.)\n. The analogous code in master checks if scroller.clientHeight is nonzero. However, that breaks autosizing with the new scheme, because the scroller no longer has any children with content to prop it open if it's set to auto height. I'm not sure why the original code was checking for a nonzero clientHeight--I'm guessing it was to avoid doing work if the editor isn't visible, but this isn't doing all that much work anyway.\n. I wasn't sure what the hack this comment is referring to was about, so wasn't able to test whether removing it breaks something. Do you know what bug this was fixing?\n. ",
    "pigletso": "Sorry... but I tried all demos including some of real-would uses' examples, none of them work...\nAre you using the most original one default android browser? Or does anybody have met this issue too?\n. I think I found the issue of the enter key problem, it's \"overflow\" at div\nRelated article : www.androidannoyances.com/post/51\nHere is the original code:\nwrapper.innerHTML =\n      '' + // Wraps and hides input textarea\n        '' +\nAnd here is my fix code...(I think this is not perfect at all), but is aim to don't use overflow at div, then Enter key will works. After this fixed, the enter handling seems got wrong, I don't know how to describe, please have a try, Thanks.\nwrapper.innerHTML =\n      //'' + // Wraps and hides input textarea\n      '' + // Wraps and hides input textarea\n        //'' +\n        '' +\n. Yes it is 2.18 and 2.2 is the same code\nIt's line 23 in my 2.18 version\n. ",
    "kramer314": "It's not working for me either (on Android 2.3.3), with either virtual or physical keyboards - we've also had some people mentioning this on the sage-devel mailing list recently related to cursor positioning and cut and paste not working in the default browser for Android 2.3 and 3.2. I can dig out the threads if you'd like.\n. ",
    "capacman": "it may not be the issue but sometimes different keyboard types can cause some weird behaviors especially text correction is open on android. \n. ",
    "joshpangell": "I noticed you pushed some updates to the codebase recently. Any chance this bug is one of them?\nThanks\n. Hey Marijn, thanks for the response.\nStrange you can not reproduce this error. I've created a screencast showing how I do it. You will notice that on drag the browser refreshes. After about 3 times the whole browser crashes and produces an error. \nThe screencast was made using Safari Version 5.1.3 (7534.53.10). Here is a link to the video: http://bit.ly/xpCkZR\n\nWe're using Codemirror heavily on Cargo (http://cargocollective.com) and we love it. Thanks again for an awesome product.\n. Thanks guys. That has solved the crashing issue. \n. ",
    "dsmall": "Hi All - I think the problem is this statement in function onDragStart(e)\ne.dataTransfer.setDragImage(escapeElement, 0, 0);\nIf you leave it in, as soon as you start dragging, Safari and Webkit crash, Chrome displays a generic globe cursor and Firefox displays the edit caret. If you comment it out, all three browsers show a ghost image of the entire edit buffer with the selection highlighted and drag and drop works for all three. According to the Moz docs, you should only be seeing a ghost of the selection (which has been put into the escapeElement). I can make it work with an image but not with a pre element.\nNB All browsers are latest Mac versions Webkit r108077, Chrome 17.0.963.56 and Firefox 10.0.2\n. Hi Marijnh Thanks for fixing this so quickly. This is to confirm that the issue is fixed. Unfortunately, advancing from v3.12 to this latest commit has uncovered an issue with gutter widths. Sorry about that. david\n. Here is an example which runs from the codemirror/demo directory. With CM v3.12 it works as expected but after \ncommit 9d92920b4fbb2d50f0246ebae3eeacef50bd56f4 the first button click redraws the gutter incorrectly and you have to click the button a second time to get the desired effect.\n```\n<!doctype html>\n\n\n\nCodeMirror: Gutter Issue\n\n\n\n\n\n\n<style type=\"text/css\">\n  .CodeMirror {border: 1px solid black; font-size:13px}\n</style>\n\n\n\nCodeMirror: Gutter issue\nCM v3.12 is fine but after the commit \"coverGutterNextToScrollbar\" you have to set the gutter twice\n\nfunction findSequence(goal) {\n  function find(start, history) {\n    if (start == goal)\n      return history;\n    else if (start > goal)\n      return null;\n    else\n      return find(start + 5, \"(\" + history + \" + 5)\") ||\n             find(start * 3, \"(\" + history + \" * 3)\");\n  }\n  return find(1, \"1\");\n}\n    \n\nset gutter\nclear gutter\n\n\n    var editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n        lineNumbers: true,\n        theme: 'cobalt'\n    });</p>\n<pre><code>console.log('CodeMirror version: ' + CodeMirror.version);\n\nfunction setgutter() {\n    editor.setOption('gutters', ['CodeMirror-lint-markers']);\n}\nfunction cleargutter() {\n    editor.setOption('gutters', []);\n}\n</code></pre>\n<p>\n\n\n```\n. Looking at your other suggestions:\n1. If option fixedGutter is set to false, the buttons in the demo work as expected\n2. Can't make option coverGutterNextToScrollbar do anything\nThe problem seems to be in the left position of the CodeMirror-gutters element, for example here it is with the problem but when you click the \"set gutter\" button a second time, it changes to 0px:\n<div class=\"CodeMirror-gutters\" style=\"left: 16px;\">\n    <div class=\"CodeMirror-gutter CodeMirror-lint-markers\"></div>\n    <div class=\"CodeMirror-gutter CodeMirror-linenumbers\" style=\"width: 28px;\"></div>\n</div>\n. Thank you for the quick fix and confirming that gutters are agaiin working as expected.\n. ",
    "minrk": "I don't know if this or #1279 or #1284 should be reopened, but this bug is definitely still present for CM master (c294a0c91eb7e4059cbf8e665d6895a749745b18) and Safari 6.0.4. Just visit any demo (e.g. resize mentioned above) and drag to reproduce.\n. another repro (Chrome 28.0.1500.20 OS X 10.8.3):\n- http://codemirror.net/demo/resize.html\n- Ctrl + for 125% zoom\n- refresh page\n. @marijnh - can you show an example of what it would look like with hidden scrollbars and not drawn fake ones? I can't seem to make this happen.\nMy real goal here is actually to disable the scrollbars altogether - I simply never want scrollbars to be visible, but there doesn't seem to be any way to make that happen (overflow: hidden does not work). I have autoresized CM areas, but if the text is zoomed, it ~always draws scrollbars even though there isn't any room to actually scroll.\n. I haven't, but I should (or someone with more familiarity of browser internals / vocabulary should do so).\nI don't know that it's a bug, but it is true that on Chrome the two sizes CM compares to determine whether there is a scrollbar can differ by up to one pixel before a scrollbar is actually added. I have not seen this discrepancy on other browsers, nor on Chrome without text zooming, so a bug seemed most likely to my na\u00efve eyes.  It's too bad there doesn't seem to be a direct js API for \"Is there an effing scrollbar?\"\n. Not necessarily a generic one, but in this particular case you can do it because it happens to use an odd number of quotes. I'll illustrate the behavior in terms of number of times \" has been pressed:\n1. \"|\" (first autoclose)\n2. \"\"| (type over close)\n3. \"\"\"|\"\"\" (autoclose triple-quote)\n4. \"\"\"\"\"\"| (type over triple-quote-close)\nThe current behavior is:\n1. \"|\"\n2. \"\"|\n3. \"\"\"|\"\n4. \"\"\"\"|\n5. \"\"\"\"\"|\"\nThe changed logic would be:\nin auto-close:\n- when typing a quote, if the new quote is preceded by two other identical characters, autoclose with three instead of one\n- otherwise behave the same\nin maybe_overwrite:\n- if next three characters are quotes, skip over all three, instead of just one\n- otherwise behave the same\nThis would be easier to address if the implementation took a mapping of open and close strings, rather than a single string assuming single-character pairs.\n. With the attached patch, I don't see any autoclose behavior at all (on strings, brackets, or anything).\n. Scratch that, I was running mismatched codemirror versions. For realistic cases, your patch does behave as desired, thanks!  The one remaining case where it behaves weird (I can't think of when it would come up) is typing quote a fifth time:\n- \"|\"\n- \"\"|\n- \"\"\"|\"\"\"\n- \"\"\"\"\"\"|\n- \"\"\"\"\"\"\"|\"\"\" <-\nwhere it's triggering the auto-close-triple behavior after any number of quotes >= 3, rather than == 3. I don't think this case really matters, though.\n. Sure, I'll give it a shot.\n. Test page here.  The body font size appears to be relevant, because some font sizes do not show the issue. I did confirm that 4.1 is affected, in addition to 3.23 and 3.24. 3.22 is not affected.  If I recall correctly, there have been issues with size calculations in Chrome before.\n. I can't reproduce it with zero zoom in Canary (37), but I can at 125% zoom.\n. Actually, yes, I can reproduce it in Canary without any zoom, but it comes and goes, depending on the width of the window.\nIgnore that, I was still zoomed.  I can only reproduce it with zoom on Canary.\n. What's the best way to tell CodeMirror to never try to draw scrollbars under any circumstances?\n. patch does appear to fix the issue, thanks.\n. I see this patch is present in 3.22, and removed in 3.23 by 10901c3 to fix #2317, so presumably this PR will reintroduce that bug. Selfishly, I think fixing #2562 is more important than #2317, so I still think this should be merged and backported to 3.25.\n. closing in favor of c9192fc9b1ca26ea1f140d1098c391f8785e59a9\n. @marijnh I set up https://github.com/components/codemirror, which is where lots of bower packages that require build steps live, if you'd like to point to that. It's a mirror that grabs the npm package.. @marijnh 5.22.0 should be posted now with the bower.json restored.. The issue is that inserting spaces after certain characters (e.g. =) doesn't move the cursor, so it appears that there is no space. As soon as the first non-space character is inserted, the cursor shows up in the right place. The video above illustrates the cursor appearing after =, whether the cursor is actually positioned there or one space to the right.\nThis doesn't happen for everyone or all the time (I've seen it, but can't reproduce it right now), but others can reproduce it reliably right now.. 5.22.1 doesn't appear to exist, but 5.22.2 is on bower now, the first release produced by the automated bower packaging.. Thanks, CodeMirror's behavior matching underlying js details makes sense. Adding the workaround in Jupyter: https://github.com/jupyter/notebook/pull/2509. ",
    "mattcph": "Thanks, it has fixed the issue, but has the 'cool' effect of image drag.\nHow can we best report this dumb behaviour to apple?\n. submitted a report. thanks again.\n. ",
    "Steffi3rd": "\"I've determined that if the image element you are using on the setDragImage() method hasn't loaded, the browser will thread abort. The fix is simple. Make sure the image element is loaded before calling the method. The easiest way to do this is to create the image element outside of the event.\"\nhttp://stackoverflow.com/a/22610927/387912\nIt works for me \n. ",
    "rakeshrohan": "Hey @marijnh is this still valid if i want to use hover on gutter? \nBecause it says connect is not method for codemirror 5.5\ni will not be able to upgrade due to organization's policies. Could you please let me know how to proceed?. @marijnh  Thanks mate. It worked. But the firefox context menu is opening up even though event.preventDefault() and event.stopPropagation() is called.\nTried to debug your code. But i couldn't find anything related to it. . @marijnh . Great. Will you create a release for this patch?. ",
    "PaulDMendoza": "I'm fairly certain now after testing that the problem with this is that adding the the temporary element to the page that has the cursor forces the browser to render all of its contents.  Is there a way I can avoid this?\n. ",
    "GordonSmith": "Is that what you had in mind?\nThe css matches the Eclipse/IDE colouring, so is kind of wanted...\n. Thx - I shall look into this theme stuff.\n. Ahh ok, I think I understand the direction you are pushing me in!\nFWIW I have no strong feelings on the word \"declarative\" (ECL is a declarative language) as a theme name.\n. ",
    "benca": "I see the same issue.\niPad 3, iOS 6.1\nLatest versions of Chrome for iOS and Mobile Safari.\nIf you use the arrow keys to go left and right or up and down, the cursor itself moves (i.e., you will type where you just moved to), but the blinking bar remains where it originally was. \nETA: tapping on a certain position moves the physical cursor and you will actually type where it is.\n. There is a way of getting to the developer console. On the surface, no exceptions or errors are generated by using the arrow keys, but I can go through what's happening and take a closer look.\nThis looks like the relevant section of the code - is there somewhere specific you recommend I start looking?\n. So I want to do more on this but some tests indicate that the iPad is not sending the charcodes at all. But, it looks like the behavior differs based on whether the editor is created with fromTextBox or by calling the constructor and having it append some element with the editor. I am going to try and run a few test cases to see what exactly is going on here...\n. ",
    "rcarmo": "I can confirm this is still happening with the latest release and iOS 7.0.x. My current workaround is to enable vim mode (which works OK for me but is sure to annoy loads of people).\n. ",
    "crazyfrozenpenguin": "I just acquired a new iPad Air (iOS 7.0.4)and I can confirm this issue is happening in Logitech Ultrathin keyboard cover. The arrows are not working. I've detected this while visiting https://codio.com as it seems that it is using CodeMirror for their Web IDE. Very annoying since I was hopping to code straight from the iPad. Does anyone know if  this is an issue in android tablets to?\n. ",
    "unarsu": "Thanks. I don't need it anymore-- I was able to get acceptance of standards\nmode. Is there anything you want me to do with the request?\nOn Mon, Jun 18, 2012 at 9:52 AM, Marijn Haverbeke <\nreply@reply.github.com\n\nwrote:\nWe've reduced our browser support to only cover standards mode, since\nthere was no end of weird quirks mode bugs. Thus, this has become out of\nscope.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/365#issuecomment-6396355\n. \n",
    "zziuni": "I have been unfortunate. I would had used pure xml for our product's xml editor.\nOk. I would using XML/HTML.\nBut, Do you know why remove pure xml? This is good feature except IE bug. :)\n. @deebugger  You have not need an example of XML. http://codemirror.net/mode/xmlpure/index.html This example page was error in IE8.0.76011.17514. Error is 'xmlpure.js' 147 line \nSame error was our XML Editor in same version IE. But Others browsers was't error. only IE8 (don't test IE9).\nAs supporting IE8 is our important feature. So, Now we use XML/HTML mode. but I want to the possibility of pure xml mode.\n. missing click :((. \n@deebugger  You have not need an example of XML. http://codemirror.net/mode/xmlpure/index.html This example page was error in IE8.0.76011.17514. Error is 'xmlpure.js' 147 line \nSame error was our XML Editor in same version IE. But Others browsers was't error. only IE8 (don't test IE9).\nAs supporting IE8 is our important feature. So, Now we use XML/HTML mode. but I want to the possibility of pure xml mode.\n. thank you, deebugger, marijnh ;)\n. ",
    "ryangies": "Agreed, and yes such a feature would work. I would expect it to only affect the auto-inserted indentation--not lines which simply match a regexp.\nI initially set out to isolate indentString (inside function indentLine) as its own identifiable chunk. Thus allowing other code to determine if that chunk is the only thing on the line (and possibly remove it). I just couldn't understand how to correctly tag the node/token like that.\n. ",
    "SeBuDesign": "@marijnh it works! Thanks !\n. I figured it out, if you use the function save. It won't  be in the hidden text area, i don't know where it saves the text but when i post the textarea it will post the value of the codemirror editor. \nThanks for the quick support.\n. ",
    "AMalkov-Quest": "yes, the string is quoted, here is exact using\npath = \"actions/suite/run/?path=#{context.root}/suite-for-testing&context=localhost\"\n. I downloaded the latest release from http://codemirror.net January 24. It looks like this release contains the bug. I've just upgraded to the latest version from github and the bug is gone now. So thank you a lot!\n. ",
    "mbits": "I am also affected by this issue - neither the delete button or the arrow keys work on the demos on Firefox 10.0.2 Mac OSX 10.6\n. ",
    "AlmogRnD": "I'm using the XML mode and the JavaScript JSON mode, separately of course. \n. Yes works great, thanks. I did want to know if it's possible to disable the replace option in the search JS? \n. Yes that works, it goes back to the browser shortcuts. Is the updated code on Script compression helper almost ready for production? \nThanks CodeMirror is great. \n. I know the feeling, I will wait thanks for the great work and support please let me know when the new release is live. \n. When you search with the notification UI, you have the reg text is it possible to edit the text outside the main JS file? \nThanks,\nAlmog\n. I think your going to have to do a check this is what I did for the ESC key on my platform. \n// On ESC press\n    document.onkeydown = function(c){\n        if (c == null) { // IE\n            keycode = event.keyCode;\n        } else { // Mozilla\n            keycode = c.which;\n        }\n        if(keycode == 27){ // Escape, close box\n            modal_close();\n        }\n    }\nHope that helps \n. Don't know what quirks mode is but still can't get it to work, not to worried about this. but thought I should log it\n. Do you have a link I can test it, I'm currently have the stable version deployed.\n. Works great, do you any dates for update to the stable version? \n. Ohh crap I have no way of know which version I'm using, the current version is2.22 does this have the Uncaught type error I submitted 17 days ago and was the script compression helper updated? \n. My fault I missed that, thanks \n. It also hangs, which feels like the browser is crashing. Testing it on JSON as well save thing\n. Google Chrome, Windows 7 64bit, and the website is my platform Scoreoid which I just add CodeMirror. \n. \"I can't reproduce it when the textarea value already has the 8000 objects or more.\"\nI will send a video of the issue it's not just pasting it but when running the query \n. Here is the video http://dl.dropbox.com/u/2582168/Search_Crash.mov \nHere is the XML file - http://dl.dropbox.com/u/2582168/test.xml \nIt seems like it can't handle large data, it crash the browser.\n. That's my fault copied incorrectly, try this http://dl.dropbox.com/u/2582168/test.xml \n. Yes what I was saying thanks for confirming\n. Yes that is correct I'm not doing any formatting that is what is returned, I'm using CodeMirror to format it. That's one of the best feature is there away to improve this or workaround this? \n. search implemented in CodeMirror here is a video capture of the issue, in the video the browser crash's the same thing happens for the formatting. http://dl.dropbox.com/u/2582168/Search_Crash.mov\n. Try now it was uploading \n. I removed the video, thought you already saw it. I can't send you any files the data belongs to an active user on Scoreoid. Will try to create static data when I get a chance but again this is related to the other issues with large data. Just add 4,000 lines of code into CodeMirror and try to search it.\n. I agree I don't think its a big issue but wanted to document it for you to make sure it wasn't something else. If your looking for contributors to help with development would be glad to help. \n. I understand might be good to do a featured request somewhere. I don't think it needs to be like the examples I sent just format correctly which is why I add as a bug. Right now the formatting works great in XML but not in JSON the indention and color coding is all wrong. I will looking into seeing if I can fix this. \n. I have it set to the following isn't this correct  $code_mirror_mode='application/json';\nAnd for XML \n$code_mirror_mode='application/xml'; \nWhich works great \n. Sure thing, this is response from Scoreoid its valid JOSN type \n[{\"Player\":{\"id\":\"1927\",\"game_id\":\"28\",\"user_id\":\"0\",\"username\":\"Test101\",\"password\":\"\",\"unique_id\":\"\",\"first_name\":\"\",\"last_name\":\"\",\"email\":\"\",\"created\":\"2011-12-11 19:48:00\",\"updated\":\"2011-12-11 19:48:50\",\"bonus\":\"0\",\"achievements\":\"\",\"best_score\":\"150\",\"gold\":\"0\",\"money\":\"0\",\"kills\":\"0\",\"lives\":\"0\",\"time_played\":\"0\",\"unlocked_levels\":\"0\",\"unlocked_items\":\"\",\"inventory\":\"\",\"last_level\":\"\",\"current_level\":\"\",\"current_time\":\"0\",\"current_bonus\":\"0\",\"current_kills\":\"0\",\"current_achievements\":\"\",\"current_gold\":\"0\",\"current_unlocked_levels\":\"0\",\"current_unlocked_items\":\"\",\"current_lifes\":\"0\",\"xp\":\"\",\"energy\":\"\",\"boost\":\"\",\"latitude\":\"0\",\"longitude\":\"0\",\"game_state\":\"\",\"platform\":\"iPad\"}},{\"Player\":{\"id\":\"1928\",\"game_id\":\"28\",\"user_id\":\"0\",\"username\":\"Test102\",\"password\":\"\",\"unique_id\":\"\",\"first_name\":\"\",\"last_name\":\"\",\"email\":\"\",\"created\":\"2011-12-11 19:52:08\",\"updated\":\"2011-12-11 19:55:33\",\"bonus\":\"0\",\"achievements\":\"\",\"best_score\":\"400\",\"gold\":\"0\",\"money\":\"0\",\"kills\":\"0\",\"lives\":\"0\",\"time_played\":\"0\",\"unlocked_levels\":\"0\",\"unlocked_items\":\"\",\"inventory\":\"\",\"last_level\":\"\",\"current_level\":\"\",\"current_time\":\"0\",\"current_bonus\":\"0\",\"current_kills\":\"0\",\"current_achievements\":\"\",\"current_gold\":\"0\",\"current_unlocked_levels\":\"0\",\"current_unlocked_items\":\"\",\"current_lifes\":\"0\",\"xp\":\"\",\"energy\":\"\",\"boost\":\"\",\"latitude\":\"0\",\"longitude\":\"0\",\"game_state\":\"\",\"platform\":\"iPad\"}},{\"Player\":{\"id\":\"1929\",\"game_id\":\"28\",\"user_id\":\"0\",\"username\":\"Test103\",\"password\":\"\",\"unique_id\":\"\",\"first_name\":\"\",\"last_name\":\"\",\"email\":\"\",\"created\":\"2011-12-11 19:56:56\",\"updated\":\"2011-12-11 19:56:56\",\"bonus\":\"0\",\"achievements\":\"\",\"best_score\":\"0\",\"gold\":\"0\",\"money\":\"0\",\"kills\":\"0\",\"lives\":\"0\",\"time_played\":\"0\",\"unlocked_levels\":\"0\",\"unlocked_items\":\"\",\"inventory\":\"\",\"last_level\":\"\",\"current_level\":\"\",\"current_time\":\"0\",\"current_bonus\":\"0\",\"current_kills\":\"0\",\"current_achievements\":\"\",\"current_gold\":\"0\",\"current_unlocked_levels\":\"0\",\"current_unlocked_items\":\"\",\"current_lifes\":\"0\",\"xp\":\"\",\"energy\":\"\",\"boost\":\"\",\"latitude\":\"0\",\"longitude\":\"0\",\"game_state\":\"\",\"platform\":\"\"}},{\"Player\":{\"id\":\"1930\",\"game_id\":\"28\",\"user_id\":\"0\",\"username\":\"Test104\",\"password\":\"\",\"unique_id\":\"\",\"first_name\":\"\",\"last_name\":\"\",\"email\":\"\",\"created\":\"2011-12-11 19:57:31\",\"updated\":\"2011-12-11 19:57:31\",\"bonus\":\"0\",\"achievements\":\"\",\"best_score\":\"0\",\"gold\":\"0\",\"money\":\"0\",\"kills\":\"0\",\"lives\":\"0\",\"time_played\":\"0\",\"unlocked_levels\":\"0\",\"unlocked_items\":\"\",\"inventory\":\"\",\"last_level\":\"\",\"current_level\":\"\",\"current_time\":\"0\",\"current_bonus\":\"0\",\"current_kills\":\"0\",\"current_achievements\":\"\",\"current_gold\":\"0\",\"current_unlocked_levels\":\"0\",\"current_unlocked_items\":\"\",\"current_lifes\":\"0\",\"xp\":\"\",\"energy\":\"\",\"boost\":\"\",\"latitude\":\"0\",\"longitude\":\"0\",\"game_state\":\"\",\"platform\":\"Android \"}},{\"Player\":{\"id\":\"1932\",\"game_id\":\"28\",\"user_id\":\"0\",\"username\":\"De102\",\"password\":\"\",\"unique_id\":\"\",\"first_name\":\"rf\",\"last_name\":\"rd\",\"email\":\"\",\"created\":\"2011-12-11 20:12:32\",\"updated\":\"2012-02-23 10:10:08\",\"bonus\":\"0\",\"achievements\":\"\",\"best_score\":\"250\",\"gold\":\"0\",\"money\":\"0\",\"kills\":\"0\",\"lives\":\"0\",\"time_played\":\"0\",\"unlocked_levels\":\"0\",\"unlocked_items\":\"\",\"inventory\":\"\",\"last_level\":\"\",\"current_level\":\"\",\"current_time\":\"0\",\"current_bonus\":\"0\",\"current_kills\":\"0\",\"current_achievements\":\"\",\"current_gold\":\"0\",\"current_unlocked_levels\":\"0\",\"current_unlocked_items\":\"\",\"current_lifes\":\"0\",\"xp\":\"\",\"energy\":\"\",\"boost\":\"\",\"latitude\":\"0\",\"longitude\":\"0\",\"game_state\":\"\",\"platform\":\"\"}},{\"Player\":{\"id\":\"1934\",\"game_id\":\"28\",\"user_id\":\"0\",\"username\":\"Almog Test\",\"password\":\"\",\"unique_id\":\"\",\"first_name\":\"Almog X\",\"last_name\":\"Ko\",\"email\":\"aa@gmail.com\",\"created\":\"2012-01-31 09:07:46\",\"updated\":\"2012-02-23 08:43:19\",\"bonus\":\"10\",\"achievements\":\"one\",\"best_score\":\"300\",\"gold\":\"2\",\"money\":\"150\",\"kills\":\"3\",\"lives\":\"4\",\"time_played\":\"15\",\"unlocked_levels\":\"2\",\"unlocked_items\":\"5\",\"inventory\":\"hat\",\"last_level\":\"5\",\"current_level\":\"6\",\"current_time\":\"0\",\"current_bonus\":\"0\",\"current_kills\":\"0\",\"current_achievements\":\"\",\"current_gold\":\"0\",\"current_unlocked_levels\":\"0\",\"current_unlocked_items\":\"\",\"current_lifes\":\"0\",\"xp\":\"\",\"energy\":\"\",\"boost\":\"\",\"latitude\":\"0\",\"longitude\":\"0\",\"game_state\":\"\",\"platform\":\"\"}},{\"Player\":{\"id\":\"1937\",\"game_id\":\"28\",\"user_id\":\"0\",\"username\":\"Almog Test Almog Test Alm\",\"password\":\"\",\"unique_id\":\"\",\"first_name\":\"\",\"last_name\":\"\",\"email\":\"\",\"created\":\"2012-02-26 01:15:02\",\"updated\":\"2012-02-26 01:15:02\",\"bonus\":\"0\",\"achievements\":\"\",\"best_score\":\"0\",\"gold\":\"0\",\"money\":\"0\",\"kills\":\"0\",\"lives\":\"0\",\"time_played\":\"0\",\"unlocked_levels\":\"0\",\"unlocked_items\":\"\",\"inventory\":\"\",\"last_level\":\"\",\"current_level\":\"\",\"current_time\":\"0\",\"current_bonus\":\"0\",\"current_kills\":\"0\",\"current_achievements\":\"\",\"current_gold\":\"0\",\"current_unlocked_levels\":\"0\",\"current_unlocked_items\":\"\",\"current_lifes\":\"0\",\"xp\":\"\",\"energy\":\"\",\"boost\":\"\",\"latitude\":\"0\",\"longitude\":\"0\",\"game_state\":\"\",\"platform\":\"\"}}]\n. Sorry have to many things open, yes highlighting is fine color coding and indention was the issue. \nIts all red and indention works but not like the examples I added which indent per JSON object. \nIf you want to reproduce this your going to have to do it thur Scoroeid or I can send you an image\n. Here is this XML - http://dl.dropbox.com/u/2582168/XML.PNG\nAnd JSON - http://dl.dropbox.com/u/2582168/JSON.PNG\n. Back to the first question, would it be better to make it format it as JSON objects? \n. Ok I think I know how I can help, I need to create a JSON model, that can take string values and convert them to value JSON object. That will solve the color coding.\nThe formatting I guess I will need to update that as well. \n. Then why is there an escape function inside the JSON/JavaScrip module? \n. mode/javascript/javascript.js \nline 29\nfunction nextUntilUnescaped(stream, end) {\n    var escaped = false, next;\n    while ((next = stream.next()) != null) {\n      if (next == end && !escaped)\n        return false;\n      escaped = !escaped && next == \"\\\";\n    }\n    return escaped;\n  }\n\"return escaped;\"\n. Ok well I think that's whats casing the issue either way I tested everything and it only happens in JavaScript using CodeMirror.\n. Yes that is the issue, looking at the code for some reason it sees hebrew text as a unescaped instance of a character and then changes \"/\".  \n. Its not a conclusion I tested it but will double check everything \n. ",
    "velsa": "And another one:\nhrRE and ulRE regexps need to have \\- instead of - in them\nHow come nobody noticed this ? :)\n. And another one, pffff :)\ncodeRE has k: in its regexp\nWhat is it supposed to do ?\nIf I replace it with ?: then indenting with a tab works correctly.\nThe only problem is with indented list items, which are also highlighted as code blocks. \nHow would you recommend excluding them from code highlight ?\n. I am using tabs instead of spaces (find them more convenient :) with the following settings:\nindentUnit:         4,\ntabSize:            4,\nindentWithTabs:     true,\nIf you indent list with a tab - it becomes code, also if you indent it with 6 spaces - it also becomes code.\nhmmm..\nBtw, indenting a line which begins with [*\\-+] should produce code, only sublists shouldn't be code colored.\nE.g.:\n```\n* Normal list \n* Not a list ! This IS a code\n\n\nList item\nSublist item <- this one shouldn't be code colored\n```\n. Any updates on the above ?\nCan you give me pointers on how to resolve this ? I.e. where in your code can one place a check for a line being part of a list and not part of indentation ?\n. You're absolutely correct, metadata is not part of standard markdown, but rather an extension (e.g. http://pythonhosted.org/Markdown/extensions/meta_data.html)\n\n\n\nThanks for the state.f hint, will look into it\n. Here is a modified version of markdown.js: http://pastie.org/6607623\nNot sure if I did everything correctly, but so far it seems to work :)\nMy mods add support for markdown metadata highlighting and attribute lists highlighting\nWhat I want to do is see if there is an attribute list and previous line is blank and return \"error\" style\n. Sorry for bugging, @bfrohs, did you get a chance to look at the code  ?\nThanks !\n. ",
    "kajmagnus79": "(( Hi Marijnh! Thanks for fixing this issue :-)   (I'm sorry I never tested the patch)  ))\n. ",
    "zz85": "thanks for the clear explanation! for benefit of someone needing this functionality, related code is\nvar scroller = editor.getScrollerElement();\nscroller.addEventListener('mousedown', function(e) { // or mousemove\n    var pos = editor.coordsChar({x: e.clientX, y: e.clientY});\n    var token = editor.getTokenAt(pos);\n});\n. sure :)\n. Cool, thanks @jankeromnes . I'll take a look at that :)\n. nice to see CodeMirror get some OT love, i'm sure all these would come in useful one day.\nthanks for the work and sharing! :D\n. sounds reasonable, thanks! :)\n. hmm yes, double negatives... i used caseInsensitive following ternjs's change. let's see what @marijnh thinks :)\n. @marijnh hmm. let me test that.\nbut from my first looks it seems like queryOptions: {completions: {caseInsensitive: true}} might override any properties already in query.completions, unless usage of .request() ever pass in a completions property.\ndo you think it would be better to have a query hook filter option which takes a function instead (which might be even more flexible)?\n. quick test with queryOptions: {completions: {caseInsensitive: true}} works.\n. maybe my concerns are unfounded, but looks like this issue has been resolve, so I'll close this. Thanks!\n. ",
    "espadrine": "@zz85 I've nearly done the test page and I'll make the pull request today.\n. @zz85 @jankeromnes You can now look at it: ShareJS pull request.\nTell me what you think! Link to my repo.\n. @elygre Sure there is! A bit of fiddling with the API:\n``` javascript\nfunction betterTab(cm) {\n  if (cm.somethingSelected()) {\n    cm.indentSelection(\"add\");\n  } else {\n    cm.replaceSelection(cm.getOption(\"indentWithTabs\")? \"\\t\":\n      Array(cm.getOption(\"indentUnit\") + 1).join(\" \"), \"end\", \"+input\");\n  }\n}\nCodeMirror.fromTextArea(document.getElementById(\"the-editor\"), {\n  extraKeys: { Tab: betterTab }\n});\n``\n. I put the example in the keymap section, usedgetOption`,\nand simplified the example to just insert spaces (which is the incentive for adding the example).\n. Thanks \u263a\n. That's fair. Done.\n. Thanks a lot!\n. ",
    "peteguhl": "Hi Marijn,\n  I'm now more properly tokenizing and only then do I check keywords that have the same first character as the current token. \nThanks,\nPete\n. Sweet!  There is a problem now as the spaces were used as delimiters in the regex. I'll commit a fixed version momentarily.\n. Any token containing a keyword, such as the keyword 'ON' in user variable\n'strResponse' in the sample index.html, will be highlighted as a keyword.\nOn Wed, Mar 14, 2012 at 9:55 AM, Marijn Haverbeke <\nreply@reply.github.com\n\nwrote:\nWhat were those spaces delimiting? I.e. what goes wrong when they are not\nthere?\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/445#issuecomment-4499646\n. \n",
    "Confusion": "Hi Marijn,\nAs the two issues already filed (and the third one I was about to file) show, this is rather unexpected behavior. Would you consider accepting a patch that makes \"insert a tab at the cursor position\" the default behavior? That would be in line with what virtually every editor does and what most people expect?\n. Great, thanks!\n. Both examples indeed reproduce the problem we also noticed in our app (Chrome 25.0.1364.160 Ubuntu 12.04). And the patch makes it disappear.\n@minrk, in https://github.com/ipython/ipython/pull/3358 you suggest it may be a bug in Chrome. And indeed the problem does not appear in Firefox. Have you filed a report with them?\n. The %{} form is a synonym of %Q{}, which does allow string interpolation. %q{} is the form that does not allow string interpolation, see e.g. the section Strings here. \nAn irb snippet to demonstrate:\nirb(main):001:0> foo = 1\nirb(main):002:0> puts %{\"#{foo}\"}\n\"1\"\nThe quote method I cited works as expected, so the most likely explanation is that the author of the Ruby mode thought that %{} was a synonym of %q{} instead of %Q{}.\n. That doesn't seem to fix it. \nI now note that %q{} and %Q{} actually both show the same behavior.  When using %q{}, the rendering is legitimate (as you initially indicated), because the first } closes the %q{ and the subsequent \" opens a string that is never closed.\nWhen using %Q{} (or %{}), what happens is that the readQuoted method calls break after having tokenized the embedded %{} and returns the style. However, it hasn't yet tokenized the remaining \"} at that point. If you remove the 'break', it parses correctly for %Q{}, but not for %Q[] and other forms. \nI'm not clear on where the remainder of the line is consumed when the code as-is is used with %Q[], which seems to be key to solving this problem.\n. ",
    "eliranmal": "thanks for the reply:\n1. i'm aware of the latest FF release, i have 8.0 as to defer from my co-workers, enlarging the test coverage :)\n2. press amount is sporadic, sometimes it's 1, and others 2.\n. that's the same result.\ni've tried the groovy demo as well, on Chrome 18.0.1025.39 beta-m again, with the same outcome (line 491).\nBTW - i've updated the original post and added the console output, see there.\n. ",
    "firejune": "Turn off \"autoClearEmptyLines\" CM option\n. ",
    "benkeen": "I didn't realize that - thanks for the fix!\n- Ben\n. Sure! My time's not great these days, but I'll see if I can figure something out. \n- Ben\n. Hi Develooper, \nI'm afraid the Smarty mode actually only supports Smarty 2, not 3. Smarty 3 contains a number of new short-cuts and syntactical changes over Smarty 2, such as the problem you posted. \nWhen I get a little more time I'll investigate all the changes that have been made and update the Codemirror mode. \nSorry about that! \n- Ben\n. Hi Develooper - I'll take a look at this and see if I can add in support for Smarty 3. Keep you posted!\n- Ben\n. Hi Develooper. I updated the mode tonight to allow for the new Smarty 3 syntax. Pending pull request, but you can see it here: http://www.benjaminkeen.com/experiments/CodeMirror/mode/smarty/\nAll the best! \n- Ben\n. Hey, Develooper. Ah! Glad you caught this. I'll check it out tomorrow night. Thanks :)\nEDIT: Huh... actually, isn't this correct? If the comment isn't properly closed, it will all appear as a comment until the closing *}. Feel free to email me it if github's mutilating the code. (ben.keen@gmail.com)\n- Ben\n. Closing. There's a small issue with comments I'd like to resolve before I re-request a pull.\n. ",
    "zygfryd": "I was thinking of leveraging CSS to do it without re-parsing the document.\nParsing identifiers would style every identifier with a class containing its name, while parsing language constructs that give meaning to identifiers would dynamically add/remove stylesheet entries for those classes.\nI admit it's not very elegant in relation to switchable themes, because the mode has to generate CSS instead of only class names, but I think it might work pretty efficiently.\nNot sure if this approach can be extended to do scope-sensitive analysis instead of global though.\n. I meant something like this: http://zygfryd.pythonanywhere.com/document/2/\nAlthough that's a very quick and dirty implementation.\n(Try editing the imports to see how symbols are [un-]highlighted dynamically.)\n. ",
    "tues": "Thanks.\nSome keys can be captured only inside a textarea in KHTML. Usually just calling input.focus() is sufficient, but for some reason in CodeMirror focus is sometimes lost when clicking on the code, precisely every other click. I didn't have time to investigate the cause of this problem, but blurring and focusing seems to work well and I haven't found any negative side effects so I guess it's better than broken key bindings. I'll let you know if I find a better way to fix this. For now it looks like CodeMirror works in KHTML just as well as in WebKit, at least all the demos. Some key bindings still can't be captured, like Ctrl-W and Ctrl-Shift-R, but AFAIK it can't be fixed without patching Konqueror or maybe even Qt, because shortcuts are handled by Qt first. Of course users can disable these shortcuts globally in Konqueror (or change them).\n. ",
    "izaak": "You don't mention anything about the surrounding HTML/CSS or which browsers you're using.\nCan you reproduce this using the demo pages?\nIf you have any CSS applying font familes, sizes, line heights etc. on the editor's elements non-uniformly (div, pre, span) that could be the issue.  (i.e. reset CSS sheets that come with frameworks)\nThere are good techniques using DOM inspectors to figure out which specific CSS rules are being inherited and screwing up your editor.\n. ",
    "Siderite": "Strange you could not reproduce it, perhaps it depends on a specific IE9 version or a specific setup. I will come back with more details.. There are issues all over the board with IE and fixedGutter, On IE8, for example, the refresh of the entire editor when scrolling horizontally looks bad as well. We've solved this by removing fixedGutter on any IE version, but I would really appreciate it if you would guy would look into it, as well.\n. ",
    "pstadermann": "I can't figure out how to attach a file. The example text is the following:\n```\nXXXXXXXXXXXXXXXXXXX\n===================\nXXXX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\nX\n```\n. The same operations work flawless with Firefox 11.\n. Thank you very much for the fix. I would never have found this :)\nThe bug is described here:\nhttp://social.msdn.microsoft.com/Forums/lv-LV/iewebdevelopment/thread/6e946d03-e09f-4b22-a4dd-cd5e276bf05a\nSo ALL code containing \"splice\" is potentially buggy under IE8. Really scary. IE9 doesn't have the bug.\n. Marijnh, thank you for your quick response. I can understand, that you don't want to spend the effort for v3 and the old IE8.\nI will try to find a non-intrusive fix (maybe set the properties to null, before removing the nodes). Are you interested in a pull-request?\n. Sadly v4 is not an option at the moment (maybe later this year). I made a patch, that fixes the leak (hopefully without breaking stuff). I sent you a pull request, if you want to merge it.\nThank you for your quick replies!\n. ",
    "Fauntleroy": "We built a feature that allowed you to drag and drop files for a file uploader, and in the interest of making that easy to use the dropzone is the entire page. Since CodeMirror caught file drops I merely needed to disable its drag and drop capabilities so the file uploads would work unimpeded.\n. lineWrapping: true that is! Yikes...\n. This demo seems to work properly. I'll have to update and take a closer look at my implementation.\n. Erm, well yes I could loop through every line and clear the makers, but I was hoping there was something more... efficient. Does CodeMirror not keep track of line markers internally? I'll have to take a look and see if I can make a pull req for this.\n. ",
    "dxw": "When you click \"submit\" in good browsers, CodeMirror calls save() before it calls the onsubmit handler. In IE8 it calls the onsubmit handler first and then the save() method, which is no good if the onsubmit handler is POSTing data from the textarea.\nThe test checks that the former behaviour is occurring thus is succeeds in good browsers and fails in IE8.\nThe guilty section of code is the \"Deplorable hack\" which obviously does nothing in IE8 because IE8's form.submit is not a function: https://github.com/marijnh/CodeMirror2/blob/master/lib/codemirror.js#L2078\n. ",
    "kaniga": "But there is no background work done in any of the ui elements. CPU is flat and no global key-handlers are present.\nIf that was the issue, then IE would have been slower than FF or at least as slow..\nWhen I try to narrow down the problem and start remove html elements it gets a bit better with every bit of html I take off.\nI cannot pinpoint it to any specific html bit..\n. I've sent you a demo to your email.\n. ",
    "Glench": "if anyone else finds this like I did, you can now look at change.origin to distinguish between programmatic and user input\n. ",
    "peterflynn": "Hmm.  It reproduces for me in Chrome (18.0.1025.152 m), Firefox (3.6.28), and IE (7)... and on Mac too -- just checked in Safari (5.0.5).\nSo if you cut & paste line 8 a few times, including the leading spaces, the third copy of return is the last thing that fits in the viewport, right?\nSo here are very precise steps from that point:\n1. Put the cursor just to the left of the \"n\" in that \"return\"\n2. Hit the right arrow key twice\n3. (The gutter should now be partway out of view -- with the \"8\" still visible, but the \"1\" in lines 10-12 being clipped)\n4. Hit the home key twice (or hold down the left arrow key forever)\nFollowing those steps in all the browsers I've tried, the gutter will not become fully visible again.  You have to grab the scrollbar with the mouse, or (counterintuitively) scroll the view even further to the right first.\n. And just to make sure we're talking about the same text content, here's a Gist of the modified code I think we're talking about:\nhttps://raw.github.com/gist/2356031/dc5f9ba424d9c395c646980308ac5c385c821163/gistfile1.txt\n. Fwiw, it looks like the stack overflow issue was caused by http://code.google.com/p/chromium/issues/detail?id=56588.  Although there's no recursion going on, V8 apparently passes all arguments via the stack.  So if you call Function.apply() with a very large array... boom, out of stack space.\n. Still reproduces for me in some cases:\n1. Go to file:///C:/code/Brackets/brackets-app/brackets/src/thirdparty/CodeMirror2/demo/theme.html\n2. Select all, copy & paste a second copy of all the text\n3. Move cursor to the top (Ctrl+Home)\n4. Ctrl+End\nAlso, this seems to have caused a major new scrolling bug: #665\n. It looks like the fix for #665 also fixes the remaining cases where this still occurred for me\n. Edit: nevermind, this is now captured as #665.\nThere's more strange stuff going on here...  After following the steps above, if you press left/right arrow while the cursor is on the last line (the line covered by the horizontal scrollbar) the vertical scroll position fluctuates wildly.  The top of the viewport alternates between line ~203 & line ~3007 (it was at ~3208 before you start hitting left/right).\n(I'm on Chrome 20.0.1132.57)\n. Another problem that seems related:\nAfter pasting in the long text, do this:\n1. Scroll up a bit and click to put the cursor there (e.g. put the cursor anywhere on line 2650)\n2. Press and hold the down arrow\nWhen the cursor gets to the bottom of the viewport, the scroll position wildly jumps up and down.  It is still sort of scrolling down a line at a time, it's just that every other time it jumps backwards by about 2200 lines.\n. Actually -- I can reproduce my issues with any sufficiently long text, no horizontal scrollbar needed.  I'll file a new bug.\n. I have a potential fix -- see pull request #666\n. There are variations of this where the scroll position actually oscillates up and down:\n1. Open http://codemirror.net/demo/theme.html\n2. Select all and copy the text\n3. Paste until you get about 2000 lines of text.  (I did this exponentially, reselecting periodically to make it go faster. But it also repros if you save this result in the clipboard, refresh, and paste in the entire 2000-line block at once).\n4. Put the cursor on line 925\n5. Press and hold down arrow\nWhen the cursor gets to the bottom of the viewport, the scroll position starts jumping up and down by about 500 lines.  Neither position is close to the cursor (the cursor is around line 930 and the lowest the viewport ever gets is line ~760).  It is still sort of scrolling down a line at a time, though: the two (incorrect) scroll positions do move lower in 1-line increments as you press the down arrow.\nNote: all these bugs also repro if you hit the down arrow slowly, one keystroke at a time.\n. Similar issues also occur if you try to scroll the view (and move the cursor) by dragging a selection off the bottom of the viewport using the mouse.\n. Looks like this was caused by 914441c (the fix for #642, although it does not actually appear fixed in some cases).\n. Pushed up what I think is the fix: pull request #666  ...sorry for the creepy number :-/\n. Hmm, I don't see that problem either before or after applying my fix... are you testing on a branch where you've made other changes?  If so, can you try on a clean branch of Marijn's master that has only my patch added?\nTo be clear, here's what I tested:\n1. Open my local copy of CodeMirror2/demo/theme.html\n2. Click to place a cursor -- it's visible, blinking as expected\n3. Drag to select text -- still looks correct\n4. Edit theme.html to include your code above, overriding the defaults\n5. Repeat steps 1-3 -- everything still looks fine\nAre you able to reproduce your cursor/selection problem in a simple testcase like that?  Or does it require more?\n. I can confirm fixed too -- I was seeing this in Chrome just by pasting codemirror.js into the theme.html demo and then dragging the thumb downwards quickly.  It reproduces consistently for me up through 853794a but no longer repros in c61b8cd.\n. If you scroll all the way to the right after step 3, the appearance gets even stranger.  The selection highlight finally ends a few px before the border, but the segment of the border that used to be overlapped by the highlight still shows the highlight color.  That part almost sounds like a browser repainting bug... (fwiw I'm on Chrome 21.0.1180.77 m)\n. Prior to beadea5 lineSpace had a fixed width rather than a min width, which prevented the bug even though the selection div still used right instead of width.  That doesn't support the 'widthForcer' fix to #550, but I wonder if there's an alternative fix that would let you go back to a fixed-width lineSpace?  E.g. if the cursor width was measured in advance, could that just be taken into account in measureLine() or in the endOperation() code that calls it?\n. @marijnh should the start point be clipped to zero?  Otherwise if the script block is within 100 chars of the start of the file, you'll be calling slice() with a negative start index -- which will almost always yield empty string.\n. MDN says \"If negative, it is treated as (sourceLength+beginSlice) where sourceLength is the length of the string\" -- i.e. negative numbers are treated as offsets from the end of the string.\nAnd that's the behavior I see in Chrome, at least: \"foobar\".slice(-1, 5) --> \"\".\nIt sounds like substring() works the way you describe, though... so maybe the most straightforward thing would be to just call that instead of slice()?\n. Cool, thanks!\n. p.s. -- it seems a little odd that 'sawCollapsedSpans' is global to the entire CM namespace.  Might it be more efficient if it were per-CM-instance?\n. (I wouldn't consider this a high priority issue or anything though)\n. Fwiw I did some bisecting, and:\n- The first issue (color changes after adding a space before opening paren) first appeared in 436fa0532.  (Although I assume @peterkroon already has a handle on this if it's fixed in his latest code).\n- The second issue (bracket matching) first appeared in 3721870ef -- which interestingly, changes the bracket-matching code but has no changes to less.js itself.\n. Fwiw, I can only repro this (in Brackets on Win) when there's no horizontal scrollbar present -- if I resize the window such that a horizontal scrollbar appears, then there's no jiggling.\n. @marijnh We'd still like to get \"smart home\" functionality at the very start of the line, though.  Is there any way to invoke \"goLineLeft\" normally, but when you're on the first line of the wrap to invoke \"goLineStartSmart\" instead?\nIn the single-cursor world it seems like you could just map Home to a wrapper handler that does a few charCoords() checks and then invokes whichever of \"goLineLeft\" or \"goLineStartSmart\" is appropriate.  But in the multiple-cursor case we can't do that since the answer might be different for each cursor.  It looks like the only way is to copy-paste all the logic of both those CM functions into new function, so the conditional that switches between them can be pushed down into the cm.extendSelectionsBy() too.  Is there any cleaner way of doing it?\n. (Sorry for the 14-month delay before one of us replied, btw :-P)\n. @marijnh It doesn't seem like such an edge case behavior, given that it's the exact behavior many popular code editors use (e.g. Sublime, WebStorm, ACE, Atom, Notepad++, etc.)...\nWhat about hoisting out logic from goLineStartSmart() into a per-selection utility?  Then we could have a \"goLineStartSmart\" and a \"goLineLeftSmart\" which share most of that code.\nIf the proliferation of similar Home-like commands feels unpleasant at that point, I suppose you could also factor out \"smart Home\" as an option flag instead of a separate flavor of command.  Then the standard \"goLineStart\" & \"goLineLeft\" could call the smart-home utility function conditionally based on the option, with no need for separate commands.  (But of course then you'd lose the ability to have different shortcuts for \"raw Home\" & \"smart Home\" available simultaneously).\n. Also -- on closer inspection, it's pretty messy to copy that CM code into a custom handler locally, since it depends on a whole tree of internal CM functions like lineStart(), getOrder(), etc.\n. @marijnh Sorry for the slow reply once again -- this works great though! Thanks!\n. @chriscoyier Is the last example supposed to have balanced parens?  I can repro the same bug with @media screen and (max-width: 100px) { instead of 100px;, and balanced parens is more what I'd call \"very common.\"  In fact, I don't think it's possible to write a valid screen-res media query without that syntax.\nIndentation worked correctly in this case very recently.  It seems to have broken somewhere in a6698dc6...c921c10de6.  That suggests the cause is most likely either db38471bb or 9ca3d37a2.\n. It was definitely 9ca3d37a that caused it, just confirmed.  I wonder if there's some alternative fix for #1533 that could be used as a stopgap?  CSS code is fairly broken right now (media queries are very common), and it sounds like a full cleanup of all the mode's indenting code could take a while...  I may try to look at it this weekend if no one else is able to.\n. @bfrohs It fixes the problem for me, but introduces a regression with url(...) syntax.\nExample:\nscss\n@media only screen and (max-width: 300px) {\n  #one {\n    display: block;\n    width: 40px;\n    background: url(http://example.com/logo.png) no-repeat 20px 20px;\n    padding: 0;\n    margin: 0;\n  }\n  #two {\n    display: none;\n  }\n}\nNew lines anywhere below the url() line are all back-indented by one tab stop.  Also notice that no-repeat and padding/margin are all colored wrong (they're orange & black on master).  I'm guessing the problem is with the \")\" handling?\n. It seems that CodeMirror also fires a no-op change event at step 4.  My guess is that it sees the Tab keyup and somehow erroneously goes through (part of) the codepath used when the hidden textarea is modified... except in this case its contents haven't been modified.\n. Fwiw, this bug has been around for a while -- at least since fb6df35, probably longer.\n. Edit: forgot you need to add another <script> tag to make the test page work.  Added to description now.\n. Thanks @peterkroon!\n. @marijnh Shift+Delete on Windows is an alias for Cut, so it shouldn't be bound to the same behavior as the others.  It was working correctly before this patch.\n. Is halting tokenization early a big efficiency win, or it is just limiting the number of spans per line?  If the latter is the main win, then you could just continue running the mode's tokenizer to the end of the line but ignore everything it returns until you get the end state.\n. @marijnh In the past you've mentioned that ultimately, you could solve long lines by splitting them at some interval so you have regularly-spaced mode-state \"save points\" like what newlines provide in normal files.  That seems like a big undertaking.  But I wonder if a simplified variant of that idea could provide a stopgap solution here:\n- Introduce a flag in the tokenization code: either stop at the line-length cutoff (just like today), or process the full line.\n- When the user is typing, re-tokenize using the cutoff (just like today).\n- When there's a pause in typing, circle back and re-tokenize without the cutoff.  If this provides a different start state for the next line, repeat on that line, etc.\n- You could imagine doing similar two-stage processing when initially tokenizing a document, as well: a fast pass to get some semblance of code coloring applied to the leftmost bit of each line (which will usually be accurate), followed by a slower \"full\" pass that would fix up edge cases like the one here.\n- In all cases you could still stop rendering token styles at the standard line-length cutoff, to keep the DOM weight down.  The \"full\" pass tokenization would only be used to compute the correct start state for the next line.\nI'm guessing that would be significantly less complex to implement... though I'm not sure if even this approach would be simple enough to be worth the effort.  Just thought I'd throw it out there.\n. Fwiw, we see this issue in Brackets as well -- but it's highly system-dependent.  For example, on my Win 7 laptop (a MBP running Boot Camp) there's no problem.  But on my much faster Win 8 desktop, it's extremely laggy.  It may depend on the system's GPU or graphics drivers -- we only started seeing this after upgrading to a CEF version with Chromium's threaded compositing (i.e. GPU-assisted) turned on.  Light Table uses CEF as well so similar issues are probably at play...\nRe this issue not appearing in the browser as much: sometimes this just boils down to viewport size.  The CodeMirror demo pages often have small fixed-size code editors where repaints are much cheaper than apps like Brackets / Light Table where the CodeMirror UI is almost full-screen.  (But it may also come down to runtime: e.g. CEF is not identical to Chrome and they're often on different versions of Chromium as well).  It might be useful to edit the CM test page to make the viewport the same size as it would be in Light Table, and then load it in the CEF shell too (e.g. using window.location to load up the CM demo page instead of the app's usual UI content).\n. @ibdknox Oops sorry, good point.  All Chromium, in any event :-)\n. @joshuafcole I can think of two more, at least:\n- CEF/node-webkit !== Chrome.  They are often different Chromium versions, and you never know what other subtle differences there might be.  When comparing Brackets vs. vanilla CM, we usually try to point our app shell at the CM test page rather than loading it in the regular browser.\n- CodeMirror can be extremely sensitive to the layout of its parent hierarchy, which of course differs greatly between the full app and any simple CM test pages.  In one case (#1514) we found that minor changes to the line-number gutter's CSS styles caused major differences in performance.  Sometimes we've debugged CM-Brackets rendering perf diffs by 'bisecting' the UI: stripping chunks out to simplify the app, or adding containment layers to the CM test page, until they meet in the middle... looking for the spot where the performance diff jumps up or down.\n. My only concern with a throttle is that it might make the highlight feel laggy on systems where it currently works fine...  Is there a PR or branch up somewhere so people could test it out?\n. @marijnh It makes a noticeable difference on the machine I was seeing this on too.\n. Works great, thanks!  Sorry for the slow response.\n. CC'ing @pauldhunt and @miguelsousa, who have worked on some of Adobe's open-source typography efforts -- just in case they have any quick insights to share :-)\n. I'm not super familiar with the semantics of Ctrl+Del in various editors, but a few notes for added color:\n1) CodeMirror doesn't appear to fully follow the notes in that earlier discussion thread -- in particular the bit that says \"the start & end of each line is always a stopping point.\"\nFor example:\ncss\nbody {\n    color: red;\n}\nIf you place the cursor after \"{\" and press Ctrl+Right, most editors will move the cursor to col 0 on the next line.  CodeMirror moves the cursor to the end of the word \"color\" instead.\nAssuming Ctrl+Del follows the same \"stopping point\" logic as Ctrl+Right, fixing this would fix the bug adobe/brackets#6860 as originally reported.\n2) But in some editors at least, Ctrl+Del stops earlier than Ctrl+Right would.  In the above code, put the cursor at col 0 of the middle line.  In Sublime, Ctrl+Right jumps to the end of \"color\" but Ctrl+Delete removes chars only up to the start of \"color.\"  I'm guessing in this case Ctrl+Delete is driven by the select-word logic (i.e. the range that would get selected if you double-click -- sans the part to the left of the cursor).\nIf that's truly a behavior common across most editors (and not just some Sublime thing), then maybe this could be fixed by changing Ctrl+Delete to use select-word as its boundary guide rather than the Ctrl+Right stopping points.\n. @marijnh I wouldn't say imitating Sublime is my goal, personally.  In the original forum thread where I did the research, there was remarkable consistency among \"modern\"/GUI-based editors: IntelliJ/WebStorm, Eclipse, Visual Studio, Notepad++, Sublime, ACE/Cloud9, and Coda all follow the stop-at-newlines behavior I described above, iirc.\nThanks for the speedy patch, in any event!  The new behavior definitely feels nicer to me.  I could imagine the differing treatment of 1 space vs. 2+ spaces feeling weird for some users (I'm not aware of other editors that use that heuristic).  So far it hasn't seemed too noticeable in my usage, but on the other hand I don't tend to work with e.g. column-aligned code where multiple spaces between tokens are common.  I guess just something to keep an eye on...\nThanks again!\n. Or rather, I should say -- I'm not aware of editors where 1 space vs. 2+ spaces makes a difference for Ctrl+Left/Right navigation.  As you pointed out though, those cases do differ for Ctrl+Delete, at least in Sublime (i.e. Ctrl+Delete and Ctrl+Right don't behave the same).  I'm not sure if that Ctrl+Delete behavior is consistent with any other editors.\n. Fwiw, I looked at a view editors and there's a bit of a split:\n- Sublime, Coda, TextMate -- Ctrl*+Delete behaves differently for 1 space vs. 2+.  In Coda and TextMate (but not Sublime), Ctrl+Right shares this difference -- just like CM master.\n- IntelliJ/WebStorm, Notepad++, Eclipse, ACE/Cloud9 -- Ctrl+Delete treats any number of spaces the same (as does Ctrl+Right), i.e. spaces are never deleted along with non-space chars.\n(* it's actually Alt+Delete on Mac, of course)\nSo the current CM behavior (after the patch here) does have precedent after all.\n. Works for me, too!  Thanks again.\n. @SAPlayer I think what you're describing is the same thing as adobe/brackets#7351, and the current thinking there is that brackets-shell is sending spurious window-resize events down to the browser control... so this might not wind up being a CodeMirror bug at all (assuming that it's correct for CodeMirror and/or the browser to adjust the scroll position under certain resizing conditions, e.g. very small window sizes).  Just fyi.\n. @SAPlayer In 7351, one report says the scroll pos jumps all the way to the top -- which sounds exactly like what you reported in 6869.  (No one on the Brackets team has been able to reproduce it that strongly, but you'll see in the comments some of us have been able to get it to scroll by several screenfuls, which is still a lot). But certainly the original report sounds 100% identical to the first issue you listed in 6869.\n. @marijnh Fyi, the problem commit seems to be bbefd22af3, a supposedly IE-specific set of changes -- although we're seeing this bug on Chrome.\n. Posted a PR with a fix\n. Fwiw, +1... this is one of the few missing pieces that makes me a little hesitant to have drag & drop turned on by default in Brackets, since it's very hard to get the insertion location right without it.\n. I looked at the rest of that diff and all the other negations appear correct.\nI did notice one other possible bug in that commit though: https://github.com/marijnh/CodeMirror/commit/bbefd22af3#diff-69ea38ebbc0152fa18e2928063a0f622R2598.  The original test on that line was true for IE 9 and 10, while the new test is true only on IE 9.  However, the comment above it refers specifically to IE 9 and makes no mention of IE 10... so it's also possible the old test was buggy and that commit was just fixing it.  I wasn't sure, and it's unrelated to bug #2620, so I left that line untouched here.\n. Makes sense -- thanks!\n. @marijnh I think you have to change your OS preferences to remap that global shortcut to see the bug with Control-Up/Down.  But in adobe/brackets#7102 someone mentioned that Control-Left/Right also insert weird chars on Mac -- and I think that might be reproducible with default OS X settings.\n. Ah, sorry for the bad link -- must have been something in my autocomplete history.  This does repro in the CM v4 version that Brackets is using (685061675b5ce), but it not on the tip of the tree (i.e http://codemirror.net/mode/javascript/), so it must have been fixed fairly recently.  Thanks!  Closing.\n. I'm guessing 5ba05207 was the fix\n. @JeffryBooher Are you still seeing this?  @redmunds confirmed the bug fixed in Brackets after we picked up the changes here.  Are you able to repro it with the same exact steps in adobe/brackets#8523?  If not, could you try to nail down new repro steps?  Might be something different.  (Also, double check that your CodeMirror submodule is up to date -- you never know!)\n. @marijnh It sounds like you might be referring to the crosshair that appears when you hold down Alt?  That wasn't contributed by Adobe, but also this bug is about something different -- Raymond is referring to the regular \"I beam\" mouse cursor that appears any time you mouse over CodeMirror or any other text field.\nIt does look like this is a Mac OS problem.  Windows uses an XOR cursor for this, but Mac seems to use a fixed-color cursor that is hard to see on dark gray backgrounds.  I can see the same problem with a plain textarea: http://jsfiddle.net/Qz7F2/\nJudging by forum threads like this -- https://discussions.apple.com/message/17250405#17250405 -- it sounds like this is a fact of life on OS X, and the only solution is to supply a custom mouse cursor for widgets that you know have a dark background.  (Which, according to the thread, TextMate and Sublime do already).\nIt looks like CSS cursor allows a url() value, so it might be plausible to do that in CodeMirror (and/or Brackets).  We can investigate that and at least create the image assets.  Is it something you think would be worth including in CM core?\n. @arrbie Please see the links I posted above. This is a limitation of Mac OS -- every app that wants to not have this problem needs to supply its own solution.  Chrome didn't do that extra work to fix this; that's not CodeMirror's fault or Brackets's fault.  Though we could put in extra effort to work around it, every text field on the web would need the same workaround so it seems much more sensible for Chrome or the OS itself to fix this.\nThat said, it looks like OS X 10.10 or a recent version of Chrome has actually fixed this, since I don't see this bug anymore either Brackets, CodeMirror, or my simple JSFiddle link above.\n. @nickjs They do use different modes -- SCSS is built on top of css.js mode (via the \"text/x-scss\" alias), while SASS is a completely separate mode implemented in sass.js.\n. Btw, it does work ok with trailing commas in object literals, which are also permitted:\nvar foo = {\n  a: 1,\n  b: 2,\n};\n. No problem - this wasn't urgent on our end either. Thanks for the fix!\n. Cool, thanks for the quick fix!\n. @marijnh This was behavior we originally requested, in #2382.  Until now I've never heard any objections/confusion related to this.  As others have noted, a number of other popular editors work the same way out of the box -- including Sublime, Visual Studio, and the WebStorm/IntelliJ family.  Personally, I use this feature every day so I definitely wouldn't want to see it go away.\nI wonder if the simplest solution is to just add a CM option for this (which we could expose as a Brackets preference)...\nThe suggestion to disable copying blank or all-whitespace lines is interesting, but I'm not sure it's the best solution:\n1. In @mfarooqi's example of hitting Copy by accident when he meant to hit Paste, it's equally likely the cursor was on a line with text on it -- so this wouldn't fix that case.  (Though it's an open question how much an editor should be designed around user error).\n2. Copying a non-blank, but all-whitespace line can still be useful, e.g. while reformatting whitespace.\n3. It might be confusing if copy without a selection appeared to work only sometimes -- how long would it take to figure out the pattern? (especially if it distinguishes between blank and blank with whitespace).\nI've flagged the original Brackets bug for review with the larger team, so we should be able to get back to you with a more firm opinion soon.\n. Btw, to @redmunds's point about paste: that part I would call a bug.  It was reported as a bug in Brackets already, since that's not how other editors with this feature work: https://github.com/adobe/brackets/issues/9130#issuecomment-55810368.  When line cut/copy/paste is available regardless of cursor position, it makes moving code around really smooth and fast.\n. Looks great, thanks!\n. I did a little investigation in the downstream Brackets bug (adobe/brackets#10590), but it's tough to tell what's going on.  Mousedown causes a brief focus change from the textarea to the .CodeMirror-scroll div (unavoidable when dragDrop is enabled, since preventDefault() can't be called on mousedown).  When focus changes, browsers always try to scroll focused element into view, and here it looks like the browser may be confused about how to scroll when .CodeMirror-scroll gains focus -- afaict it's already entirely in view, so no scrolling should be needed.\nI'm unclear why the length of the text selection has any influence on this behavior -- that may be a valuable clue.\n. Btw, the token types used in SASS are really inconsistent with the set used by the CSS/LESS/SCSS modes.\n|  | CSS/LESS/SCSS | SASS |\n| --- | --- | --- |\n| Tag name selector | tag | atom |\n| Class selector | qualifier | atom |\n| Id selector | builtin | atom |\n| Property name | property | property |\n| Numeric value | number (including any unit suffix) | number (but unit suffix is unit) |\n| Enumerated value | atom | attribute |\nWould there be any objections to changing SASS to match the others more closely?  And maybe porting the unit thing into the others, since that seems like a nice enhancement...  (CC @ankitstarski since you seem to have worked on the SASS code most recently)\n. With CM master on my Mac (10.9 in Chrome) I can't get any modifier key to cause drag to copy either.  Alt-drag and Shift-drag move the text without copying, Ctrl-drag opens a context menu on mousedown and doesn't drag at all, and Cmd-drag seems to blur the CodeMirror widget on mousedown and also doesn't drag at all.\nI think the blur is what breaks Cmd-drag, not the event having its flags wrong.  But that's moot because Cmd is the wrong modifier anyway -- on a Mac, Alt is the modifier you use to indicate copy when dragging.\nThe patch here seems to work for me, both in Chrome and in Brackets.\n. And yeah, I don't see the weird effect from @infin80's screencap either\n. @marijnh Ah, yes it does change that too -- good point.  This patch as-is couldn't land, then.  How hard would it be to decouple those two modifier uses so Mac could use Cmd to add selections but Alt to duplicate when dragging?\n. To be clear, I think this is the issue @MarcelGerber is describing:\n1. Select some text\n2. Mousedown on the middle of the selection\n3. Move the mouse less than 1 char's width away from the mousedown pos, then mouseup\nResult: selection collapses to a cursor\nExpected: seems like it should be consistent with mousing up elsewhere within the selection: no edits are made, but the selection is not cleared either.\nHowever, this seems very minor to me.  It happens on Mac with or without Alt (and with or without Marijn's change), and it happens on Windows too if you're not holding down a modifier.  Probably not worth putting a ton of effort into fixing...\n. @marijnh No, I agree.  I think the way CM defines \"significant distance\" is a bit unusual -- the threshold seems higher in CM than in other apps; and if you move a huge distance but then go back to near the mousedown pos, it treats it as if you hadn't moved past the threshold, which is atypical -- but as I said above, I don't think any of that is really worth fixing.\n@infin80 I think you're describing all features that CodeMirror already has...\n. Yes, just Cmd-click exactly as you described for multiple cursors. To drag/drop text, make sure you enable the dragDropText preference and then restart Brackets.  But for more discussion of Brackets-specific issues please use brackets-dev or https://github.com/adobe/brackets\n. ",
    "remaerd": "This must be the strangest bug I've ever met: After added the refresh method, I open chrome and the problem still remains. But when I try to open the element inspector, the content just pop out!\n\u53d1\u81ea\u6211\u7684 iPad\n\u5728 2012-4-11\uff0c16:17\uff0cPeter Kroonreply@reply.github.com \u5199\u9053\uff1a\n\nTry the refresh function.\nhttp://codemirror.net/doc/manual.html#refresh\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/490#issuecomment-5064189\n. Thanks for your kindness support. I push my codes to Github so you can take a look at them. My project is going pretty big so I don't know where could find the bug. But I use CodeMirror in only one place. \n\nhttps://github.com/remaerd/showstudio/blob/master/coffee/views/show_passage_passage.coffee\nThanks again.\n. peter:\nI just figured out that when I resize my window, the CodeMirror display the content correctly. The Chrome Inspect Element take place in the window which force the screen to resize. But how can I do that without resizing my window?\n. Problem solved. I have to write ugly code in another coffee file. And like you said, refresh() is the solution.\nThanks!\n. ",
    "thevinci": "I have the exact same problem. I tried editor.refresh() and editor.focus() and it doesn't do anything.\n. I moved over to https://github.com/marijnh/CodeMirror/issues/784.\n. Here are some previous issues that could be related to this:\nhttps://github.com/marijnh/CodeMirror/issues/490\nhttps://github.com/marijnh/CodeMirror/issues/540\nI know this is v3, but maybe this got ported over as well:\nhttps://github.com/marijnh/CodeMirror/issues/779\n. I appreciate your hard work and help. This is good stuff. Had a chance to stop by your website to check out your other stuff. I donated.\nThe only thing I have is jQuery. Fade in fades the element in. It does a css: display: 'block' and then a opacity 0 -> 1. I set a callback argument to refresh or set scrollTop height to 0 after the animation.\nI tried everything to isolate the problem. I think it could narrow down to this. I have a pretty complex app with many elements nested upon each other with different positioning.\nThanks again for the help.\n. ",
    "mattpass": "Yep, that sounds good, updated pull.\nOnly reason I did the increasing in the 2 x functions, was because I didn't think it should apply to indentFinder - as I can't think of a case where you'd want mismatching indents (bit different to tag & brace matching where there is really an 'end').\nSo, did what you suggested to keep it simpler, but have the line...\nif (rangeFinder !== CodeMirror.indentRangeFinder && hideEnd === true) end++;\n...to handle hiding the end but only if we're not matching by indent.\n. FYI, there seems to be a general Webkit problem with text based form inputs while in fullscreen mode - isn't specifically a CodeMirror issue.\nDemo: http://icecoder.net/_coder\nClick in the text input box next to 'Find', then type some chars - works fine.\nNow click the Fullscreen icon (top right, next to logo). Go back to the text input field and type again. No alphanum chars work, only space, backspace etc as you said.\nQuite a serious bug with Webkit it seems!\n. Logged the issue on Chromium. Hopefully they'll fix soon.\n. Good example with the fake windows login screen webpage.\nHowever, if a phisher only has to add that to get around security, haven't webkit provided a security feature and also a  workaround to their own security? LOL\nAlso doesn't explain why space & backspace should work still?\n. That alert system sounds good and very much like what you get with Chrome.\nSpace & backspace for navigation were my first thoughts too. Maybe only allowing those keys, tab, esc, arrows etc are more a general policy which also encompasses keystroke events. Would make sense.\n. @varemenos Sure, http://code.google.com/p/chromium/issues/detail?id=143676&q=fullscreen&colspec=ID%20Pri%20Mstone%20ReleaseBlock%20OS%20Area%20Feature%20Status%20Owner%20Summary&rlz=1Y1XIUG_enGB514GB514\n. Awesome! Great to see a working demo of this.\nAn inline widget demo would be even more awesome of course ;D\n. Found a bit of a bug with the var height lines demo too.\nClick & drag to select anywhere from the first line of line 5 to the third line (ie, multi-line select). It'll highlight the first & last lines only.\nDumped a load more text into line 5 to extend it to around 10 wrapped lines and repeated the same thing, again, only highlights first and last line, the inner 8 aren't highlighted.\nIssue occurs in all browsers.\n. @bfrohs Thanks, was probably best to add a new issue.\n. Agreed. Seems to be a part of all modern editors now.\n. Extending the above idea, perhaps a more general 'info' API could be available to return various info, ie;\ncm.info('version') // returns 2.23\ncm.info('releaseDate') // returns dd-mm-yy or timestamp\n...etc\n. Ahh I did not know the comment was at the top of files, I use your compression API which strips out comments.\nI agree tonnes of metadata wouldn't be a good idea and thought this would just be a few bytes. Anyway, I like the ideal of 2.33+ to indicate it's also a dev version.\nRun-time use cases for CodeMirror.version:\nBeing able to determin the version when comments are stripped out.\nComparing against http://codemirror.net/latest-version.txt to know if a new version has been released.\n. No, my Android 4 phone had never viewed those URLs before. Just to confirm this I cleared all cache, history etc, visited those 2 demos and got the same results.\nRan through all v3 demos and saw missing line no's in:\nactiveline\nfolding (JS demo: no line no's; HTML demo: shows them)\nfullscreen\nsearch\nvariableheight\ninlinewidget\n(Note: I've obviously excluded those where line no's are not being shown in v2 demos either, such as closetag)\nTried the above on Chrome on my phone too and line no's show, so it's just the OS's default browser that's affected.\nWill try and look at bugfixing this, but not sure when that would be (1 week+).\n. Saw you just closed this and so quickly checked on my Android 4.1 (Jellybean, latest version), all fine now.\n. Can confirm I'm seeing the same on my own CM setup.\nI'm using v3.14 right now, so not just reintroduced in v3.15.\n. Note it's 4 of the themes that get affected, not 6 as detailed in my commit. This issue will also affect the v2 master branch I believe.\n. That's understandable but on a related note, there is a difference between CM 2 and 3 here - when switching themes, the themes BG is not seen if a BG is set on the CodeMirror class as it trumps the theme's BG.\nTo see this in action, I have taken the theming demos from v2 and v3, and in those HTML files, set a red BG on the body tag and white BG on the CodeMirror class:\nhttp://icecoder.net/cmColorDefs/2.html\nhttp://icecoder.net/cmColorDefs/3.html\nYou can see if you change from default to the ambient theme, in v2, you get to see the grey speckled BG of the theme. Do the same in the v3 version and it sticks with the white BG.\nSeems the v2 branch uses the themes BG, but v3 branch sticks with whatever is set in CodeMirror class?\nIn this way, if you have a dark BG and so set something on the CodeMirror class you then have a problem switching themes.\n. Happy to put in a pull req, but neither of those options seem to work.\nIn http://icecoder.net/cmColorDefs/3.html, the codemirror.css is the first included file, so the subsequent theme CSS files should override styles I believe. I tried including the theme CSS files before codemirror.css too, but that didn't work either (unsurprisingly).\nLooked at changing blackboard.css from:\n.cm-s-blackboard { background: #0C1021; color: #F8F8F8; }\nto\n.CodeMirror, .cm-s-blackboard .CodeMirror { background: #0C1021; color: #F8F8F8; }\n(to cover all angles) and that doesn't seem to work either. Weird.\nStill sticks with whatever is set in the HTML file under the .CodeMirror class, this case background: #fff.\n. Got it and that works. OK, pull req coming up shortly.\n. Uggh, not sure why it's done that. Cancelling this pull.\n. Ah, even better, thanks.\n. More examples to help pinpoint the issue:\nThis will collapse fine on all 3 div's:\n<div>\n</div>\n<div>\n</div>\n<div>\n</div>\n...but neither of these will collapse the parent div on line 1:\n<div>\n<span>\n<div>\n</div>\n</span>  \n</div>\n<div>\n<div>\n</div>\n</div>\n. Yes that seems to work for my test case now, many thanks.\nIn fact you may be interested in my test case - allows a user to see tag breadcrumbs for the current cursor position. You can also hover over each breadcrumb to select to that depth, and also click the breadcrumb to set cursor just after the tag.\nTo see this, go to http://icecoder.net/_coder/ open nestTest.html by double clicking on it. Then interact with the nest breadcrumb chevrons at the bottom.\nMaybe useful as an addon? (Note: needs a little fixing which I'll be able to look at now I have the updated foldcode.js).\n. @bfrohs Thanks. Yeah, would be a nice tweak to show a breadcrumb for the item at the cursor pos, whatever that is (eg tag, text etc). Right now just shows from the parent and backwards.\n. Can confirm this works too.\nTest:\nHad 28.0.1500.72m, had this bug.\nUpdated Chrome to latest version (28.0.1500.95).\nVisited exactly the same line & position where bug occurred and now works fine.\nHooray!! :+1: \n. Much better, doesn't jump around now (tested in IE9 and Chrome).\nSmall issue tho - place cursor within function on line 2 and press any key. Wait for JS Hint errors to show and press any key again. Line 2 temporarily dissapears and reappears with updated errors. (IE9 and Chrome again).\n. Works great, many thanks.\n. @bfrohs Sounds like a similar issue.\nI'm using CM 3.14 tho (not dev, just release version) and that looks like something fixed 5 months ago, so latest version should have that fix?\n. Thought I'd check in and see if this issue has been fixed and indeed it seems to be! No idea what fixed it, but I don't see this issue anymore.\nTested using: Browserstack on iPad - iPad 3rd (so iOS 3.2 to 7.0) plus iPhone 5 and 5S (iOS 6.0 and 7.0) and the keyboard comes up now.\nClosing this issue and any similar issues.\n. @netpoetica This sounds like a possibility. Should alert @marijnh to this and get his thoughts on it.\nWould be great to see this fixed.\n. Thought I'd check in and see if this issue has been fixed and indeed it seems to be! No idea what fixed it, but I don't see this issue anymore.\nTested using: Browserstack on iPad - iPad 3rd (so iOS 3.2 to 7.0) plus iPhone 5 and 5S (iOS 6.0 and 7.0) and the keyboard comes up now.\nClosing this issue and any similar issues.\n. Screenshot to show original and new:\n\n. First point - it's all within an operation, so counts as 1 undo level I believe? Don't think it pollutes the history?\nRe other 2 points - ah, didn't know about the use of the null type for parens. If we restrict to just apostrophe's as you initially suggested, it covers both of these?\n(ie, change to:\nif (left === \"'\" && !cm.getTokenTypeAt(cm.getCursor())) cm.execCommand(\"delCharAfter\");\n. Could do if it brings the same cancelling effect on general text when typing apostrophe's.\nIn my tests tho I could only detect the correct type after the ' char was actually typed if the cursor was flush to the end of a HTML tag.\nEg...\n<div>|</div>\n...was reporting a 'tag brackets' type for me I believe.\nSo was undoing after typing a char only for the reason we could pick up the null type...\n<div>'|'</div>\n...is what we get after typing an apostrophe, but we can also detect a null type now, so know deleting the char to the right is OK.\nOnly matters for the first char tho I guess?\n. I use Emmet with CM in that way and works great. Don't think it should be part of CM's corr and Emmet handles this as described.\n. Found it's a classname overriding issue.\nCopying the CSS classes from your demo page (http://codemirror.net/demo/matchhighlighter.html), it contains a .CodeMirror-focused class, (using same styles as .cm-matchhighlight), which seems to override selected/selectedtext?\nSo think the issue still remains, using the stylings below, the red background is shown on selected text, overriding the green background selected text that should be seen:\n.CodeMirror-selected  { background-color: green !important; }\n.CodeMirror-selectedtext { color: white !important; }\n.CodeMirror-focused .cm-matchhighlight  {color: white; background: red}\nRemoving .CodeMirror-focused styling fixed my issue, but still maybe a problem as it shouldn't override selected text styling?\n. Added a demo on JSBin for you:\nhttp://jsbin.com/lexeqomoqi/1/edit?html,output\n. This looks interesting but a couple of the filetypes shouldn't be there?\nGitHub Flavored Markdown - isn't just README.md but could be anything with a .md extension such as CONTRIBUTING.md or HISTORY.md\nNginx - can include other .conf files too thru the use of includes say include vhosts/more-sites.conf or wildcards (`*.conf``)\nThe other filetype values (Asterisk etc) I'm not sure on but the above I am.\n. GitHub will render any file ending with the .md extension. See examples here: https://github.com/icetbr/markdown-examples\nYou also couldn't list Nginx conf files as they too could be any name with the extension .conf\nJust don't think you can name specific filenames for either of these languages.\n. This is a sample of what the theme looks like BTW:\n\n. Thanks. Was trying to use what I thought were the best parts of Seti, Monokai and Flatland.\n. Good feedback, thanks. Looking at it, maybe is a bit subdued under JS mode. Put in a new pull request with a slight colour boost:\n\n. Sounds like you want to call CodeMirror's refresh() method after initialisation and also after switching tabs.\n. I've tried including simple.js (both in the bundle and as a separate JS file) and it still complains of the same issue: Uncaught TypeError: a.defineSimpleMode is not a function.\nI can see the simple.js file contains the CodeMirror.defineSimpleMode function but is odd it's causing an issue?\nI'm bundling quite a lot of files into one (36 in fact) and all works fine if I exclude rust.js and simple.js.\n. @melloware - I didn't manage to get to the bottom of this and like using the CodeMirror compression helper, so in the end I excluded rust from my editor.\n. OK I see your point on the gutter. There was also changing the cursor from pointer to help also which seemed to make sense but no biggie.\n. (Note: not expecting anyone to fix the issues on my site, just noting them for reference and fixing bugs seen on CodeMirror hosted demos may help resolve my own. For reference only). :-)\n. ",
    "Gozala": "\nThe use of the .CodeMirror-something is to make it unlikely that the class names with clash with anything people already\nhave in their page (a selected { background: red } rule might occur, and CM should be embeddable in any random page).\nThe CodeMirror- vs cm- inconsistency is a result of historic unplanned evolution, It doesn't bother me enough to change it > (which would be a pain for people who upgrade).\n\nI see. Another option could be configurable prefix passed as an optional option to the CodeMirror constructor, but I guess it may cause more harm then benefit.\nThanks for the insights. I'll try to write up overlaying mode for punctuation characters.\n. Thanks! Problem was indeed the CSS file, although I'm sure I have not made any edits to it, it's just I have update codemirror but forgot about updating CSS file. Sorry for wasting your time on this.\n. It seems to work great so far, thanks a lot!\n. I really don't care if that's make file or whatever else, as long as there is something. Makefile's just tend to work so it felt like obvious choice. As of maintenance cost, I just used vim macro to generate everything from this page:\nhttp://codemirror.net/doc/compress.html\nI guess something along that line could be done. It's just by today I have being using that link which I'd love to stop doing :)\n. I'd like to make something like a Mathematica docs and notepad: https://vimeo.com/44968627\n. @marijnh We started on this on twitter, so I thought I just create a ticket for this. You said you don't know when you'll have a time for that, but if you could write up overview what would be a correct way to do it, someone (thinking of self) might give it a shot.\n. > Something like this will be useful. But I'm thinking more in the direction of making all options that somehow pertain > to sets expose and add/remove interface, and simply using defineOption to define extensions like this, with the\n\nchanger function taking care of adding/removing the necessary options.\n\nMy main problem when writing code-mirror plugins is that code need's to require reference to CodeMirror in some way:\nhttps://github.com/Gozala/interactivate/blob/gh-pages/interactivate.js#L6-11\nWhich usually is a pain as it implies certain tooling / environment / packaging etc.. I really wish plugins were only providing\nthings, without any direct dependencies on codemirror's presence, letting editor decide what to do with provided properties. \n\nCommands are global. You can't have per-instance commands, so those don't need to be wrapper like this.\n\nDesire here is a same, I wish to just provide set of functionality and let the code-mirror decide hod to handle it.\n\nStop isn't something I've ever needed in a plug-in -- but if you have a compelling use case I'd love to hear it.\n\nFor ambiance editor I would like to allow installing / uninstalling plugins from the editor itself at runtime. Unless plugins handle uninstall it will be really hard to manage. Although I can imagine that being out of the scope for\nthe codemirror itself. \n. > Disablin a plug-in on an instance would simply be handled by the change handler for the option noticing it being\n\nset to false/null/whatever\n\nGot it!\n\nSo, if you're extending CodeMirror (it's written without dash, by the way, so the lowercase require/npm name is\n'codemirror')\n\nI'm requiring my own local wrapper module there. I don't think you could actually require codemirror  from npm and expect it to work, can you ?? It would be amazing if you could.\n\nis it really such a problem to depend on the CodeMirror object?\n\nNo it's just a preference, not a big deal either way. A I can always write an adapter that would wire two things together. \n. Do you mind having an option like indentWithSpaces or alike to do:\njs\nfunction(cm){ cm.replaceSelection(Array(cm.getOption('tabSize')).join(\" \"); }\nAlso to be honest I expected indentWithTabs: false to do exactly that\n. @canuckistani I think you had few other issues did not you ? If so could you please submit them ?\n. Oops I actually meant Backspace but sure, I'll try to make it an add-on.\n. Oops wrong target branch closing in favor of #1108\n. > Use line widgets if you need to put block elements into the editor. They can't be part of a line.\nI actually started with widgets first, but the problem I've run into was that widgets are added below the lines of text, what I wanted instead is to replace a line(s) of text with a widget.\nCould such an option be added then ? Or maybe there is some other way  to implement this that I don quite see yet ?\n. First of all thank's a lot for these changes and tips how to do this. It seems to accomplish most of what I'm trying to do although I'm not sure why markText would not just do that. Code that I end up with looks as follows:\n``` js\nfunction merge(a, b) {\n  b = b || {}\n  var keys = Object.keys(a).concat(Object.keys(b))\n  return keys.reduce(function(result, name) {\n    var descriptor = Object.getOwnPropertyDescriptor(b, name) ||\n                     Object.getOwnPropertyDescriptor(a, name)\n    return Object.defineProperty(result, name, descriptor)\n  }, {})\n}\nCodeMirror.prototype.markLines = function(from, to, options) {\n  from = { line: from.line }\n  to = { line: to.line }\n  var marker = this.markText(from, to, merge(options, {\n    collapsed: true,\n    inclusiveLeft: from.line == 0,\n    inclusiveRight: true,\n    replacedWith: void(0)\n  }));\n  var widget = this.addLineWidget(to.line, options.replacedWith, {\n    showIfHidden: true\n  });\n  marker.clearMarker = marker.clear\n  marker.clear = function() {\n    this.clearMarker()\n    editor.removeLineWidget(widget)\n  }\n  marker.replacedWith = widget.replacedWith\nreturn marker\n}\n```\nAlthough it's feels hacky, but end up with that because I could not get any \"clear\"\nevents.  Maybe I'm doing it wrong ?\n``` js\nCodeMirror.prototype.markLines = function(from, to, options) {\n  from = { line: from.line }\n  to = { line: to.line }\n  var marker = this.markText(from, to, merge(options, {\n    collapsed: true,\n    inclusiveLeft: from.line == 0,\n    inclusiveRight: true,\n    replacedWith: void(0)\n  }));\n  var widget = this.addLineWidget(to.line, options.replacedWith, {\n    showIfHidden: true\n  });\n  var handle = editor.getLineHandle(to.line - 1)\n  CodeMirror.on(handle, \"clear\", function handler() {\n    CodeMirror.off(handle, \"clear\", handler)\n    editor.removeLineWidget(widget)\n  })\n  marker.replacedWith = widget.replacedWith\nreturn marker\n}\n```\nAnother unfortunate hack is manual set of marker.replacedWith, I could've done marker.widget = widget instead,\nbut then I wont be able to use editor.markLines(from, to, marker.getOptions()) although I guess I could implement\nCodeMirror.TextMarker.getLineMarkerOptions and then use that instead.\nWhat I'm getting to with this is if something like this is not baked in, it would be great to have a document\nsuggesting an idiomatic way to go about it, maybe even on of the examples. Also I'm willing to help out in doing\nthat if you think this makes sense and will provide with a feedback.\n. > Why don't you simply use another property name? (And read it out again later.)\nI did considered that but then it won't show up in marker.getOptions(). \nBTW do I subscribe to \"clear\" events incorrectly or why aren't they called ?\n. Yes getting options for an existing marker would be great, also if TextMarker is exposed implementing move as suggested in #1110 would be very easy. So yes it will simplify some of my code & I'd love that.\nAs of attachOnExit I'm afraid cursorEnter and cursorLeve events won't really solve my use case since I need to remove marker on cursor enter I'll have to observe when cursor leaves area where marked was set before. That being said I don't mind doing it as I do it now, I just thought markers that only decorate range when cursor is not there was common enough use case to bake this thing in.\n. Looking good, thanks\n. I was considering to extend clojure-mode state by adding subType to it so that forms under comment or one following #_ would have additional class name \"commented\" that way themes\ncould just fade them, while still keeping them syntax highlighted.\nI also would like to reuse this subType idea to add additional class names for (syntax) quoted \\ unquoted forms.\nI may take a stub at this when l get some free time. I'll post here if I'll start work on it. Would also appreciate comment here if someone get's to this earlier.\n. > Isn't this what the insertLeft option to setBookmark does?\nI assumed so, but it does not seem to have any visible effect :(\n. BTW I actually pass that option with value true:\nhttps://github.com/Gozala/CodeMirror/blob/addon/palette/addon/display/palette.js#L101-L104\n. Yeah sorry I for not posting update yet, it warks as expected on the\nmaster. It was failing on last tagged version though (or maybe I was on a\nwrong tag)\nOn Friday, January 31, 2014, Marijn Haverbeke notifications@github.com\nwrote:\n\nI guess you got it to work, since your plugin does show the cursor on the\nleft of the bookmarks now?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/2201#issuecomment-33775361\n.\n\n\nRegards\nIrakli Gozalishvili\nWeb: http://www.jeditoolkit.com/\n. > @gozala What do you think of these changes?\nThey look fine by me, thanks for asking.\n. I'm trying to figure out what exactly is going on, but so far I'm not able to figure out why typed key does seem to be dropped.. One thing I noticed is that keydown handler being invoked but not the keyup event which makes me wonder if maybe document containing codemirror is stealeaning focus from the document where editor is rendered which mabye prvents event from being dispatched.. ",
    "chris-morgan": "Oh, good; my observation had been that as soon as I did that, the shift modifier came into effect and so it made a selection, and I was worried that that would mean I'd need to clear the user selection, which would then make visual/select modes harder later on. Much better to fix it!\nI'll verify this tomorrow or so.\n. I've been thinking about all this for the past few days and have come to the conclusion that it would be better if we started a separate project for Vim for CodeMirror. My present intention and desire is to make what will be more or less a full port of Vim, though (initially at least) omitting most of Vimscript (Eventually, almost everything except the syntax and highlight commands). Yes, this means implementing registers correctly, all the modes - especially operator-pending mode to replace the current mess of vim-prefix-* keymaps, commands, options, the facility for user mappings, et cetera. As this is a significant undertaking and quite separate from CodeMirror, and also remembering that the primary CodeMirror maintainer is not a Vim user, it seems to me that it will function better if managed as a separate project.\nSo, I propose that we stop working on CodeMirror's vim.js and leave it approximately as it is, and instead work on engineering (rather than merely putting in here a little, there a little) a full reimplementation in a separate project. Later on it can be decided whether it should be pulled back into the CodeMirror repository - but my opinion is that the answer is probably no.\nDoes this seem reasonable?\n. I was not intending to be forking CodeMirror; I was intending to develop and maintain the Vim bindings - what is presently vim.js - separately. The deployment effect of it would just be that instead of including vim.js from CodeMirror, one would include it from another project (which could be linked to from the CodeMirror site, if desired). People already have to do some work to enable Vim mode, storing it in a separate project scarcely increases their effort but could considerably improve things for the developers. I realise that in these past few days some enhancements in Vim support have required modifications in CodeMirror itself, but these can still be done in CodeMirror through pull requests. Cases where you have changed things in both CodeMirror and vim.js at the same time would require a little more work, but I think the benefits for the general case are greater. I don't anticipate many things requiring much in the way of CodeMirror changes.\n. I also see a probable difference in direction; more normal users may just want Vim-like bindings, whereas my goal is parity (something I've never seen attempted in any system since the old era of vi clones and then vim clones; any \"Vim mode\" in another text editor that I've ever seen is wholly unusable and extraordinarily irritating because it's not complete enough). This makes it a fairly big project, and not particularly well suited to existing inside the main CodeMirror project repository.\nI'm not proposing getting rid of what's there already - just in starting a different project which will do it all properly (and will probably end up at least dozens of kilobytes compressed). Sorry I didn't make that clear; it has been in my thoughts that way but I more or less forgot to mention it. At the end, one will be simple and do what many people want and the other will do everything and feel like Vim but be fairly big (and thus at least a tad slower, though I doubt that will be an issue). I'm not sure which would be more popular at that point.\nYou have been very quick in dealing with pull requests - thanks for that - but being in a different project will make a project of the scale that I'm suggesting much easier.\n. @misfo: I haven't used Sublime Text 2 at all. I have heard that its Vintage mode is better than most, but it's still missing plenty that I use regularly. Ctrl+I, Ctrl+O, advanced registers like </code> and <code>.</code>, commands like:s` and oh, so much more. I couldn't cope with using it as it is.\n@marijnh: I can't think of anything immediately that would require much changing in CodeMirror other than an implementation of block selection (for Vim's \"visual block\" and \"visual select\" modes) which could be useful for other things anyway. To be sure, I may think of something later. I'll see how it goes! I certainly realise that you wouldn't be wanting to include anything in the core that would only ever benefit Vim emulation.\n. ",
    "lopuhin": "Thanks for feedback! Regarding cursor appearance - there are two functions\nthat are called when switch to and from insert mode, and should change\ncursor appearance. I don't know if it is possible with css, and I am not\nsure if it's good to emulate it with \"insert\" cursor, I'll try to check\nthese two options.\n26.04.2012 12:59 \u00d0\u00cf\u00cc\u00d8\u00da\u00cf\u00d7\u00c1\u00d4\u00c5\u00cc\u00d8 \"Jan Keromnes\" \nreply@reply.github.com\n\u00ce\u00c1\u00d0\u00c9\u00d3\u00c1\u00cc:\n\nThanks for this! Just to confirm that the mention worked, and that the $\nbehavior is correct. It seems odd because in escape mode, the cursor should\nbe on the next character instead of before it. I think I remember an\neffort to change cursor appearance according to mode (just before next\nchar for insert mode and on next char for normal and future visual\nmode), @marijnh do you know anything about it?\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/509#issuecomment-5352279\n. \n",
    "BrendonSled": "Yea those were added to the branch accidentally, I use this code on my site\nso some of these changes are for personal reasons.\nI believe I have fixed all the drag bugs\nPlease let me know if everything is working properly now\n. Also just to be clear the only file that has any drag commits is the main lib/codemirror.js\n. ",
    "timrchavez": "I have no idea if they care or not.  I'm not sure what the usage rules are for Github Pages.  We'll close since you're uninterested in doing a CDN, regardless.\n. ",
    "larscwallin": "I just read that pages.github might be the best solution for CDN. (Read more: http://code.lancepollard.com/github-as-a-cdn/)\n. ",
    "syntagmatic": "You can checkout the highlighting in action at:\nhttp://fleetinbeing.net/beans/\nThe theme used is designed to match coffeescript.org, though there are a couple places where's it's not exactly the same. This theme's not part of the pull request, but it should probably be called \"Idle\" rather than coffeescript if included.\nhttp://fleetinbeing.net/beans/css/coffeescript.css\n. ",
    "enjalot": "Your alternative implementation makes sense :) Thanks for including this, I'll be sharing what I used this for with the mailing list soon, and it wasn't for syntax highlighting ;)\n. ",
    "metzen": "Ah excellent, the \"consume\" arg to match was exactly what I was looking for.  This does solve the issue partially, as it correctly parses the . or @ as a separate token from the variable that follows it.  However, I think we'd also want to continue applying a \"meta\" style to a variable that follows a meta token like @, so that the entire decorator can be displayed in a particular visual style.  For example, in the following snippet:\npython\n@dot.separated.decorator\ndef foo(bar):\n  pass\nThe dot.separated.decorator should also receive the \"meta\" visual treatment, while tokenizing each package component separately to allow for correct code completion.  I've taken a crack at a solution to this in:\nhttps://github.com/metzen/CodeMirror2/commit/3e20687701ab9159f739699bec04c1f79e856dfa\n. ",
    "peritus": "Thank you for answering so quick!\nI pushed a commit implementing these changes, you figure out how to reorganize the css/demo pages/etc. Looks nice.\n. ",
    "AugmentBLU": "Yes I'm using ctrl-c/v... in Windows 7.  I tried the example and couldn't reproduce so I suspect there's an issue with the integration with MODX or conflict with extJS.  I guess you would have to install MODX and the CM package to test it.\nWith no JS errors appearing in the console, it might be a hard task to track down. \nHere's the package on GIT https://github.com/splittingred/CodeMirror\n. ",
    "J-Rojas": "Hmm.. well it looks like this demo does exactly this...\nhttp://codemirror.net/demo/activeline.html\nSo I have to see what the difference might be with the version I have.\n. Ah... seems like the project that I'm using set the active line incorrectly...\nupdated from...\nonCursorActivity: function() {\n    codemirror.setLineClass(hlLine, null);\n    hlLine=codemirror.setLineClass(codemirror.getCursor().line, \"activeline\");\n},\nto...\nonCursorActivity: function() {\n    codemirror.setLineClass(hlLine, null, null);\n    hlLine=codemirror.setLineClass(codemirror.getCursor().line, null, \"activeline\");\n},\nand it solved the problem.\nClosing.\n. Glad you've put together such a useful project!  Looking forward to finding more bugs and helping out :)\n. Hello.  I'm confused, what is the point of the default \"save\" command that you have in the code?\nIf a person is trying to extend the save functionality to save a file to server for example, how would recommend they go about doing it so that it can trigger the default CM2 functionality along with the extra logic?\n. Thanks for the hint.  I've taken the logic that I suggested above and attached it within my code to the save command as you suggest.  It calls the default save() method and then calls onSave() which I attached after creating the CM instance.\n. ",
    "massemanet": "ack. poor git-fu.\n  apologies.\nOn Mon, May 14, 2012 at 7:49 PM, Marijn Haverbeke <\nreply@reply.github.com\n\nwrote:\nHi. This contains all the old patches as well, and doesn't apply cleanly\nto the current repository at all. Could you rebase to my master branch,\nre-apply your changes, and resubmit?\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/539#issuecomment-5696940\n. retrying...\n. I'm having problems with rebasing. I tried reading on your master, but that\nleft me unable to push my rebased branch.\nYou don't happen to have a link handy that explains this for dummies like\nme? Google has been unkind to me...\nOn Jul 12, 2012 3:57 PM, \"Marijn Haverbeke\" \nreply@reply.github.com\nwrote:\nThanks. Merged. Next time, please try to submit a pull request with a\nsingle (non-merge) commit, rather than a tangle like this (your history was\nfreely mixing your commits with upstream stuff, and ended with a commit\nthat claimed to be rebase, though it really was a branch merge).\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/630#issuecomment-6934303\n. Thank you marijn. Sorry for wasting your time.\nOn Jul 13, 2012 2:31 PM, \"Marijn Haverbeke\" \nreply@reply.github.com\nwrote:\nThere are multiple opinions about how git is to be used. But this works\nfor me:\n- never pull from a branch that might not have all commits you have\n- do git fetch ... and then git rebase FETCH_HEAD instead, so that\n  your branch stays a strict extension of the upstream branch\n- that way, when you submit a pull request, your patches will all be on\n  top, and it's easy for me to integrate them\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/630#issuecomment-6960432\n. The purpose is to allow (hypothetical) collaborators to test...\nBut your point is well taken.\nOn Aug 19, 2013 4:03 PM, \"Marijn Haverbeke\" notifications@github.com\nwrote:\nMerged as 3b50151 https://github.com/marijnh/CodeMirror/commit/3b50151, but without the huge\ntest_*.html files -- everyone checking out the repository will have to\ndownload everything in it, so I don't feel that having 1000+ line files in\nthe repository is a good idea unless they actually serve a significant\npurpose.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1754#issuecomment-22873849\n.\n. the buggy \"try\" handling is a regression I didn't notice.\nThat's a stopper, I'll close the pull request.\n. marijnh found a stopper in the new indenter.\n. that's by design; I didn't want the indenter to leave blanks on empty lines. I.e. I don't want it so that hitting return twice will create a blank line with a bunch of spaces. \nThere is probably a better way to solve that problem(?) And it is pretty inconvenient to hit return-tab instead of just return to make a new, indented, line. I can certainly roll it back if you prefer.\n. \n",
    "jackmahoney": "No I am talking about the text area targeted by fromTextArea() method. I have content echo into that by php before the page is presented. This content is hidden in the code mirror until user types a character\n. The content is echoing into the text area before the call to fromTextArea. If the editor is being initialized in a hidden state how do I make sure it is visibile or that it is initialised in a visible state?\n. The container div is never hidden. It is an iFrame that is present when the DOM is loaded.\n. ",
    "kevinburke": "One easy way is to put it in another div that you are showing/hiding, so you don't have to worry about which element is being shown/hidden. Then when you show the bigger element, call refresh() on the codeMirror object.\n. ",
    "kitanata": "I am also experiencing this issue.\n. ",
    "gradyward": "I am also experiencing this issue, and can easily reproduce it. How do I go about creating a test case using JSBIN?\n. My error was with the way that JQuery Tabs interact with code mirror.  Here is a fantastic blog post which has two potential solutions to the problem.\nhttp://jtmorris.net/2013/06/codemirror-editor-not-displaying-default-value/\n. ",
    "hikari-no-yume": "Ah yes, my bad. Sorry.\n. ",
    "MasseGuillaume": "live demo: http://scalakata.heroku.com/\n. What about adding append( string ) and prepend( string ) helpers methods to the api. \nIt would help developers familiar to jQuery.\n. Another thing related to insertion that I found confusing in the documentation:\nIs there a way to change the textarea via javascript and update it on the mirror.\n. Ok Thanks :-)\n. @peterkroon\nWhat do you mean by 2 vertical scrollbars ?\nIs this related to the scala language ?\n. wont work as well on ie9, chrome 19.0 and firefox 12 on windows ( they all have double scroll bars )\nthe same for http://codemirror.net/demo/fullscreen.html\n. Ctrl + D is the bookmark shortcut in chrome\n. @marijnh we are using multiple selection + searchcursor at https://codebrew.io/ it's looking good for now.\n. I'm using POST to an iframe display syncing remove them from the view and their content are emptied.\n. closes #1831 \n. It's not clear in the documentation (http://ethanschoonover.com/solarized)\nyou can see in some implementations they use the same color:\nhttps://github.com/deplorableword/textmate-solarized/blob/master/Solarized%20(dark).tmTheme#L21\nhttps://github.com/deplorableword/textmate-solarized/blob/master/Solarized%20(dark).tmTheme#L23\nin the demo http://codemirror.net/demo/theme.html?solarized-dark\nif you change \n&.cm-s-dark .activeline {\n    background: rgba(255, 255, 255, 0.05);\n  }\nto \n```\n&.cm-s-dark .activeline {\n    background: rgba(255, 255, 255, 0.25);\n}\n```\nyou can see there is no benefit to have and active line + selection at the same time\n. ping this is done\n\nHaving active line highlighting and selection at the same time is how CM currently works, so that has to function.\n. This is what I'm using now. If I send a PR, can you merge this ?\n\nactive line\n\nactive line with selection downward\n\nactive line with selection upward\n\n. it's using smartIndent but it's not smart enought for scala.\nset smartIndent: false in your code mirror config\n. I think it's pretty hard to write a correct scala mode.\nThere is another bug in the multi lines string. A triple double quote (\"\"\") opens and closes a string.\n. @marijnh wow thanks !\n. I'm still having this issue\n\nIn the gif I'm pressing down down ... up up arrows. Line 6 is not part of the markText so I should be able to set my cursor at this location.\n. There you go: http://jsfiddle.net/5z90e01d/4/embedded/result/\npress the down arrow key, you will not be able to skip the replacedWith block. I think it's because it's another codemirror. note I really need the inner codemirror instance because it will have recursively markedText (so I cannot just use runmode).\nI work fine if it's just a normal block: http://jsfiddle.net/mgrak49f/4/embedded/result/\n. @marijnh thanks worked fine. Is there a way to give you donation for your work ?\n. @marijnh it can also be done with lineWidget. This was inspired by chromium devtools\nhttp://codepen.io/anon/pen/XbGZZN\nhtml\n<textarea></textarea>\ncss\n.CodeMirror-linewidget {\n  overflow: visible !important;\n}\n.CodeMirror-linewidget .inline {\n  position: absolute;\n  border: 1px solid black;\n  margin-left: 10px;\n  margin-top: -16px;\n}\n``` js\nvar editor = CodeMirror.fromTextArea(document.querySelector(\"textarea\"));\nvar nl = \"\\n\";\neditor.getDoc().setValue([\n  \"*\",\n  \"*\",\n  \"**\"\n].join(nl));\nvar i = 0;\nvar t = [\n  \"*\",\n  \"*\"\n].join(nl);\nvar node = document.createElement(\"pre\"),\n    offset = 0,\n    base = 0,\n    v, max = 0, te;\nfor(v = i; v < i + t.split(nl).length; v++) {\n  base = editor.cursorCoords(new CodeMirror.Pos(v, 0)).left;\n  offsetPos = new CodeMirror.Pos(\n    v, editor.getDoc().getLine(v).length\n  );\n  offset = editor.cursorCoords(offsetPos).left;\n  if(offset > max) {\n    max = offset;\n  }\n}\nnode.style.left = (offset - base) + \"px\";\nnode.className = \"inline\";\nnode.textContent = t;\neditor.addLineWidget(i, node);\n``\n. yep I'm talking about the find dialog addon. I will work on it.\n. I'm investigation the issue :)\n. it's stuck in the loop with alternating scrollLeft values: 6, 853, 6, 853, ...\n. I'm using https://github.com/marijnh/CodeMirror/tree/4.4.0\n. can you release 4.4.1 for this fix ?\n. @marijnh superb. thanks a lot :)\n. oh that's correct. I was using\"Tab\": \"insertSoftTab\"`\n. @marijnh thanks a lot I will spend some time there to answer questions  ;-)\n. ",
    "krockot": "Yes, this solves the problem as well.  Thank you\n. Very true, that was pretty lazy.  I've taken your advice: The initial-# cases have been moved into the # clause, and otherwise decimal matching occurs only when a digit or [+-.] is encountered.\nDecimal matching is unfortunately still pretty complicated, but I'm not sure it could be made more efficient by moving  additional logic out of the compiled regexp.\n. ",
    "NMyVision": "This is my first time using github so let me know if something is messed up. Also there is a bug parsing xml mime 'application/xml' everything works as html.\n. ",
    "toolness": "By the way, I'd be happy to add this test to the test suite for CodeMirror, just let me know.\n. Awesome, thanks Marijn!!\n. ",
    "doyousoft": "i'm using FF13\ni'll try to send you a test document\nin fact, this is the searchcursor.from() method which can return undefined if atOccurrence == false\n. http://jsfiddle.net/vGpqh/2/\nTested on FF and webkit browser\nHow to reproduce :\nfirst, do an initial replace with a query that matches some items\nbut instead of clicking YES, NO or STOP, click again on the replace button\nsearch again with a query that match some items (could be the same query as above)\nand you'll see the error after you'll enter the replace pattern\nFor some reason, on my version, it happens on all the replace command, doesn't need to do this initial replace.\nI don't understand very well the atOccurrence variable so i need your help to understand what's really going on here.\nthx\n. ",
    "jnewman": "Sincere thanks! I'll do my best to make it worth your while. \nToo bad about the CommonJS site (I hope it's not related to the MySQL password problem), but the InternetArchive (IA) snapshot from 2010 seems to be the same as the live version was, prior to the outage. \nBased on the IA snapshot, I think I should've done:\n\"directories\": {\n    \"lib\": \".\"\n},\n\"main\": \"lib/codemirror\"\nThanks again,\nJosh\n. ",
    "tsujigiri": "Ah, I see. Thanks!\n. ",
    "michael": "ah well. Thanks. :)\nOn Thursday, June 21, 2012 at 2:19 AM, Marijn Haverbeke wrote:\n\nThe 'proper' way to handle this is to call .refresh() after un-hiding it. http://codemirror.net/doc/manual.html#refresh\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/issues/587#issuecomment-6475048\n. \n",
    "redmunds": "Ooops, wrong repo. Closing.\n. Closing.\n. > The existing htmlmixed mode already parses the content of style blocks as css\nYes. We added the mode to the state for easily detecting mode anywhere in htmlmixed document.\n. state.mode is still referenced in copyState. Let me know if I should also remove that.\n. Removed state.mode and compareStates.\n. Verified that this fixes Brackets issues. Thanks.\n. I guess it was assumed that any time a new editor was created it would receive focus, so selection would change anyway, but I can see how that may not always be the case. It also seems to work if this is done before new editor is created. Removing the selection works around a webkit inefficiency.\n. Note that the original bug in the referenced issue is different from what I described above. Start with this comment if you care to look at the Brackets issue. \n. Demo is simple, but not small -- bug is loading JS for code hinting in Brackets. This is the test I am using in Brackets on Win7:\n1. Unzip this Reveal.js presentation: https://dl.dropboxusercontent.com/u/28581497/reveal.js-2.0_test.zip (447KB)\n2. Open file: reveal.js-2.0/hint-test.html\n3. On line 27, you'll see: //window\n4. Remove slashes to uncomment line, put cursor following window\n5. Type \".\" and wait for code hints to appear.\nNote: Worst performance is on initial load, then much better on subsequent hinting due to caching. To run test a second time, switch to another file & back to this one, or close & re-open file.\nUsing Chrome Dev Tools profiler, the time in CodeMirror.getTokenAt() doubled between Brackets Sprint 29 & 30\nSprint 29:  717ms\nSprint 30: 1497ms \nYou can get Brackets downloads by going to http://download.brackets.io/ and clicking on \"All Downloads\" button.\n. You asked for a simple demo, not necessarily a small demo :)\nIn general, the code is synchronously parsing an entire htmlmixed document. The purpose is to extract JS from <script> blocks and maintain line numbers as it goes.\nIt starts at the beginning of the doc and calls getTokenAt() until it hits the end. I have only looked at the average time for calls to getTokenAt(), so I am not sure if the first call takes significantly longer.\nThe code calls CodeMirror.innerMode(outerMode, ctx.token.state).mode.name in the loop for each token, so setOption(\"mode\", ...); could be getting called implicitly by some other method.\nIt would take me a while to put together a similar demo in an HTML page, so hopefully you can take a quick look at the code.\nThe main loop is in the HTMLUtils.findBlocks() function:\nhttps://github.com/adobe/brackets/blob/master/src/language/HTMLUtils.js#L476\nThe TokenUtils.moveNextToken() function is defined here:\nhttps://github.com/adobe/brackets/blob/master/src/utils/TokenUtils.js#L76\nAny advice on better techniques for parsing an htmlmixed (or any other mode) document would be appreciated. Thanks.\n. Yes, the precise flag is the culprit. cc: @njx\nTime spent in getTokenAt() dropped from 1523ms to 82ms! What a difference a cache makes :)\nI'll also pass on the info about addon_runmode to the team.\nThanks! Closing.\n. Thanks. I don't think a fix for v3 is necessary.\n. Fixed. Thanks. Closing.\n. For this particular case, when determining the number of selections on clipboard code could detect when newline is followed by another newline or end-of-text and interpret that the newline is part of selection and not a selection separator.\nOf course, this only fixes the case where selection ends in a newline, but that is a common case for me, personally, so I think it's worth considering.\nI guess this assumption is not true if selection contains a multi-line selection with empty lines, but the handling of that case doesn't seem any worse that the way it is now. For example, in recipe above, if you have 4 selections/cursors when pasting, then a match is detected and each part of copied selection is only pasted once.\n. As I said, \"multi-line ranges where the range is a single line ending in a newline\" is a common case for me, and the handling of the other cases may be a little different, but it's already broken (based on my expectations) so I don't think it's any worse.\nThe only other ways I can think to fix this are:\n- Create a custom clipboard format, but that would break interoperability across other apps, so that's not a good solution\n- Store a \"numberOfSelectionsInLastCopy\" value. This would have to be cleared whenever focus leaves app to best handled clipboard data from other apps.\n. Patch works great! I couldn't find any unexpected behavior. Thanks.\n. One other change I think would be useful would be to not only match exact number of selections for copy/paste, but also to match exact multiples. For example:\nStart with multiple selection with 2 selections: <span class=\"foo\"> and </span> and Copy. Create another multiple selection with 4 cursors (where vertical bars are the cursors):\n<p>aaa |bbb| ccc |ddd| eee</p>\nPaste results in:\n<p>aaa <span class=\"foo\">bbb</span> ccc <span class=\"foo\">ddd</span> eee</p>\n. No precedent. This would distinguish CodeMirror from Sublime!\n. Thanks! Fair enough. I predict that CodeMirror will become the precedent that Sublime Text copies!\n. @marijnh I honestly don't use the \"copy line cursor is in\" feature -- I was only aware of it because I accidentally did it one time :)\nSeems useful to be able to copy entire line if cursor is at beginning of line. Seems weird (to me) to copy line when cursor is at end (or middle) of line because you have to move cursor to beginning of line when pasting a whole line, anyway.\nCopying an empty line seems like it would never be the intention, so I think that should not be done (i.e. don't clear clipboard). Copying an all whitespace line could be the intent and useful, so that should be allowed.\ncc @peterflynn @njx \n. @MarcelGerber Thanks for the head's up. Added.\n. Brackets needs an SVG mode for SVG-specific code hints. This seemed like a simple, clean way to do it. Any other suggestions?\nDo you have a template for creating an SVG mode? All of the tags, attributes, etc. have already been collected for the code hints, but I couldn't find a good example to follow.\n. This is for SVG code hints in Brackets (not CodeMirror code hints). Thanks for the additional info. I added this to Brackets instead (pull request is https://github.com/adobe/brackets/pull/9969 if you're interested). Closing.\n. ",
    "kovalev07": "Sorry. It is not issue. I changed style in codemirror.css\nfrom .CodeMirror {line-height: 1em;}\nto .CodeMirror {line-height: 1.5em;}\nbut i not changed in eclipse.css\nfrom .cm-s-eclipse span.cm-keyword { line-height: 1em;}\nto .cm-s-eclipse span.cm-keyword { line-height: 1.5em;}\n. ",
    "e-kag": "For those of you still afflicted by this webkit bug, this is my hack to deal with it:\n```\nfunction cleanExtraCarriageReturns() {\n    const $lines = $('.CodeMirror-line');\n    $lines.each(function(lineNum, line){\n        const $line = $(line);\n        const $spans = $line.find('>span').children();\n    if ($spans.last().hasClass('cm-invalidchar')) {\n        const lineTokens = editor.getLineTokens(lineNum);\n        const token = lineTokens[lineTokens.length - 1];\n\n        const to = {line: lineNum, ch: token.end};\n        const from = {line: lineNum, ch: to.ch - 1};\n        editor.getDoc().replaceRange('', from, to, IGNORE_OP);\n    }\n});\n\n}\n```. ",
    "xzel23": "OK, I'm still affected by this, so I bisected it. Last version that did not expose this bug was 4.0. I will try to identify the exact code change now.. JavaFX WebView component is also affected (Version 11 and 12-ea). It's also based on Webkit.. ",
    "ananyasen": "I see your point. Simply the regexp check does work. Updated the logic accordingly.\nI was just being over-cautious to prevent an exception, but obviously that was not necessary.\n. ",
    "Dr-Emann": "Awesome. Thanks!\n. Looks like this might have to do with the auto-closing brackets, the haxe mode page seems to indent properly when typing your examples.\n. ",
    "marcj": "sorry for my silly question, but in which scenario does one need the line numbers in hex?\n. ",
    "oxling": "I was working on something that displays assembly. You might see a lot of code like JUMP $AB00, so it's much easier to understand when the line numbers actually correspond to the hex locations in the code. I admit it's kind of a niche use, though.\n. ",
    "nawnit00": "Hi,\nI'm cloning repository from our local web site to Git repository at Linux server but it is showing error like 'coundn't connect to host while accessing http://localhost... HTTP request failed' (see the attached screenshot).\nPlease help me to resolve this error.\n\nThanks,\nNawnit Kumar\n. ",
    "Raynes": "That fixed it! Hurray. I could have swore that I tried removing that...\nI actually have it git submodule'd in the repo, so everything updates when I pull.\nThanks a lot for the quick response, and sorry for bugging you with a non-bug. :)\n. I think git pull --rebase someremote somebranch is equivalent.\n. Wow, I missed this. Apologies @marijnh!\nI would not have any kind of special support for (comment ..). It's just a regular macro that is read and evaluated by Clojure, not a real comment. There is absolutely nothing special about it. #_ on the other hand is a legitimate \"do not read this form\" thing and should be handled.\n. ",
    "spastorelli": "Thank you. Sorry about the commit message format. Noted for the next time.\n. I have made some follow up changes (commit 067d25f):\n- changed foldedLines to an instance variable and added getFoldedLines() function.\n- from last commit, moved the expand logic to replaceRange1. As far as I tested this should cover (in addition to previous covered case) pasting and dragging. \n- also extended region to include end line and changed isFolded to check if the changed line is the end line of the folded region. this should cover case when newlines are added/copied/dragged from end line of the fold.\nThanks for your time in reviewing.\nPTAL\n. ",
    "pvorb": "Thank you very much! ;-)\n. ",
    "Phoscur": "Ofc, close it if it's in your way. I see this as a place to talk about this.\nSo you don't want to even consider the simple feature?\n. ",
    "jdlx": "argh.. k, thx. ;)\n. Hm.. this approach does have a catch: e.g. the moment you have more CodeMirror instances on one page as i have.. a static CSS def won't do, specific defs via class/id would kind of suck. Do i assume correctly i also can't go by setOption(option, value)?\nBackground: i'm generically using CM across my frameworks backend pages by looping through textareas, and invoking CM if applicable.. $(\"textarea\").each(function(){ ... and so on. Since the textarea dimension are not all the same, i'd need some way to dynamically control each CMs dimension.. any hint you might give me?\nthx,\nJan\n. Excellent.. works for me!\n(And no, CSS is no real way since i can't know what Addons/Plugins are installed etc. .. i do need to derive dimensions directly from the given textarea)\nthx,\nJan\n. ",
    "oscar-broman": "You do realize Chrome Canary is a quite unstable development version, right? Unexpected results are to be expected.\n. Shift-Tab will invoke the indentAuto command - not decrease it.\n. Shift-Tab has to do with indentation only, it only affects the first whitespace in lines.\nThe tab key does both, though, since sometimes you want to insert tabs in your code, but if the cursor is in the first whitespace then you will be indenting.\nDo you know what tabs are? They're not fixed spaces - their size varies depending on what column in the text they are. It's not a \"1 space char tab\" that gets inserted, it's simply a tab.\nGo to this demo and start adding spaces at the beginning of an indented line, you'll see what tabs are.\nI believe the 2-space indenting is, if anything, a fault in the xml mode.\n. They're not aligned..?\n. ",
    "vectorsize": "Hi Marjin, I'm using chrome Version 20.0.1132.57 on mac. I have a working example that reproduces the error here:\nhttp://interior.substance.io/text/\nAfter selecting some text and applying a style (like em) I do a markText to the selected text, then when clicking again I replaceSelection. I'm passing the selected string back again. It works perfectly for short ranges but not multiple lines.\n. Thank you, and sorry bout not mentioning the use markers :)\n. Awesome! thanks\n. ",
    "thywhite": "I'm also have a similar problem. If line wrapping is turned on, a cursor about html tags has wrong position. \nHere is my tag and script.\n``` html\n<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n\n\nEditor Based On CodeMirror\n\n\n\n\n\n\n.activeline {background: #e8f2ff !important;}\n\n\n\n\n\n\nToolbar Area\n\n\nPanel Area\n\n\n\n\n\n\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"namlEditor\"),{\n    mode :  {name : \"xml\", htmlMode : true },\n    lineWrapping : true,\n    lineNumbers : true,\n    extraKeys : {\n        \"Tab\": \"indentMore\", \n        \"Shift-Tab\": \"indentLess\",\n        \"'>'\": function(cm) { cm.closeTag(cm, '>'); },\n        \"'/'\": function(cm) { cm.closeTag(cm, '/'); }\n    } ,\n    onCursorActivity: function(cm) {\n        cm.setLineClass(hlLine, null, null);\n        hlLine = cm.setLineClass(cm.getCursor().line, null, \"activeline\");\n    }\n});\nvar hlLine = editor.setLineClass(0, \"activeline\");\n\n\n\n\n```\nTested on win 7 x86 / IE9 standard mode.\n. ",
    "sirtet": "Wouldn't it be a good idea to turn some/all of these special characters into explicit span's, to be able to make them more easyly distinguishable? (Just fond out now, from looking at above commit, that the unicode code is in the title-tooltip, did not realize this while using.).\nMy own Use-Case is web content editing like this:\nhttp://w8tcha.github.io/CKEditor-CodeMirror-Plugin/demoFramed.html\nI sometimes did get \"illegal\" char's after pasting, and never knew what they were, just saw the red dot. \nIt would be great when editing content, to identify them more easily, to be able to decide if they should stay or be deleted.\nMaybe add an aditional class with the corresponding unicode code? i'd then add the html-entity-code as CSS :before ...\nalso, the tooltip could be extended to a pattern like ex. Zero-width-Space (Unicode Char. xxx)\nPS: not sure if it would be better to add a new ticket instead of posting on a closed one...\n. Yes, i saw the tooltip, and i'd suggest to expand Them a bit as stated above, so LEDs techie-users can unterstand them.\nAnd yes, an additional Class based in the Charakter code is what i'd suggest too.\nI think i did not write anything about the meaningfulness of the 'illegal' class, but it's ok if you read my mind ;-)\n. So with specialCharPlaceholder you can even change the placeholder-content per every char-code?\nBut i am not grasping on how to use it.\nI searched for a demo that has a function in the config options, but found nothing.\nCould you give an example how this looks like?\nSo you did not want to go with the extra class per codepoint in the default? Wouldn't that have been only an extension, and not a change of the default beahviour?\nAlso, i thought the bare JSON notation of the unicode in the tooltip was a bit cryptic for non-programmers, so i'd change\nline 4436\nfrom\ntoken.title = \"\\\\u\" + ch.charCodeAt(0).toString(16);\nto something like\ntoken.title = \"Unicode U+\" + ch.charCodeAt(0).toString(16);\nMore work, but even more context for the user would result, if the options could also define a descriptive string to every char-code:\n\"u0019\": \"EM\", \"End of Medium\";\nwhat would render to\n<span class=\"cm-invalid char-0019\" title =\"Unicode U+0019 (End of Medium)\">EM</span>\n. Yes, i see. Only my skills are not that good, so\na)\ni don't see how exactly i need to implement it, and \nb)\ni'd like to understand why it's done this way. \nI had the impression, that it's a bit complicated and error-prone, if i need to define the char-code in 2 different places.\ni guess it could have something to do with flexibility, execution speed, ease of implementation...\nmy (non)-understanding of how to use:\nSo everything that is defined in specialChars: will be sent through specialCharPlaceholder,\na call would then look something like this?\nvar editor2 = CodeMirror.fromTextArea(document.getElementById(\"code2\"), {\n     specialChars: /[\\t\\u0000-\\u0019\\u00ad\\u200b\\u2028\\u2029\\ufeff]/g,\n     specialCharPlaceholder: \n          specialCharPlaceholder(ch) {... switch case 0000 case 0019 default ... return token}\n});\n. I wanted better visibility for html entities like &nbsp , so after reading here i did \n.cm-s-default .cm-atom {\n    color: #00f;\n    background: rgba(0,0,255,0.3);\n}\nWhich works nice, but the selection is not very visible on the background. \nBy accident i found out, that combining this with my first approach (a background image) it improves the highlighting-differentiation, so i added this:\nbackground-image: url(data:image/gif;base64,R0lGODlhAQABAIAAAP/M/////yH5BAAHAP8ALAAAAAABAAEAAAICRAEAOw==);\nthanks marijnh\n. Scroll did not work: Not sure, but trying to replicate the effect, i think it was a match on line 1, which was covered by the dialogue itself...\nPlus a new thing i saw:\nThe existing replace all function is saying \"replace\" in the dialogue, same as the replace function... maybe change this to \"replace all\"? or, it would be kind of obsolete if there was the proposed \"Yes to all\" button on the replace function.\nDid i mention? CodeMirror is awesome, thanks!\n. @mihailik , did you ever try to do this?\nI just had a bunch of html source editing to do, so i thought some more about what exactly i miss:\nI found that besides wanting to select intities like &nbsp; i mainly wished for an easy way (via n-clicking) to select tags: I had to move around html tags with or without attributes, eg. <figure class=\"caption\">\nI think for the entity-case, a doubleclick-selection would be good, as this probably really is to be seen as one word in most cases.\nBut i would not say the same for Tags. maybe i just want to select the class-name, maybe the whole class-attribute, maybe the whole tag.\nOne option could be to increase the selected range with each doubleclick (similar as a triple click selects the whole line).\nOr, the selection could depend on where i doubleclick (or, triple. leave doubleclick for normal word-selection)\nSo: triple on the tag name would select the tag, triple on a attribute name would select the whole attribute, etc. (eg. extend to css: triple on a selector, on a declaration). Ah i see, yes it does, but...\nTab-ing after the last button exits the dialogue, i think it should cycle through it.\nI had windows dialogues in mind, there you can move the focus with cursor keys (stops at end) and with tab (loops to the first button after last).\nThat's why i also had the idea of direct keybindings.\nPS:\nTab-ing on the \"replace\" and \"with\" steps, aborts the dialogue.\nI think that's wrong from the user-experience. It should... hmm, do the same as enter?\n. Ok i see.\nIn my view, i just saw the dialogue more as a DIALOGUE than a part of the page. And on dialogues, browsers don't leave them with tab either i think.\nFor aborting, i thought ESC. was enough, and very standard.\n. ",
    "krisbulman": "Since Brackets is using Codemirror2, hopefully this will get some momentum. I'm personally only interested in an SCSS port of the Less syntax, which there are definitely a few changes to make. I started a wiki page and set up the beginnings of the port here https://github.com/krisbulman/CodeMirror2/wiki for anyone interested. \n. @bfrohs How can I object really, anything that makes the modes easier to extend would be ideal to work from. \n. ",
    "GarthDB": "Looking at putting together a mode for stylus.  I'm looking through existing modes for inspiration.  Since Stylus supports all valid css syntax, would it be best to write Stylus as a new mode like Sass, or a submode like Typescript?\n. @marijnh thanks for the quick reply. That was exactly what I was thinking.  I can't think of another language pair that has the same relationship.\n. @dbratcher - sadly no.  I made a stylus extension for brackets, but it just uses the css mode.\n. ",
    "dbratcher": "@GarthDB any progress on the stylus mode? I'd be willing to draft up a rough version as it's own mode (not a sub mode that sounds tougher :) )\n. not entirely sure what this commit was all about... but I've added a jade mode here: 087331f \nI'm looking to add stylus soon\n. Thanks for integrating the code for me. Unfortunately there was a rather annoying bug with that first run, which I fixed in a new pull request #1633\n. ",
    "joshuafcole": "I've started looking into this as part of looking into rewriting Light Table's skin and structure CSS in stylus [1]. I'm currently stuck on the fact that Stylus provides an excellent Lexer with all the information (and thensome) that we need, but it expects buffered input, whereas Code Mirror modes want their tokenizers to be streaming. I have some ideas on how I can bridge that gap, ranging from minimally invasive but horrifying to very invasive but speedy quick [2].\nThe options I've looked at so far are:\n1. Slurp the entire stream into a string to lex. I imagine the performance of this method (particularly on large files) could charitably called abominable, though I haven't tested it.\n2. Expose the regular expressions for slurping tokens and the priorities of each from the Stylus lexer. This way we can optimistically try each until we get a match or end of string and feed just that into the lexer.\n3. Rewrite the Lexer to work with a stream rather than a buffered string. This sounds like a huge task, but after a cursory inspection, the lexer looks very well written and each token matcher follows a standard pattern. It should be relatively mechanical to swap the string buffer with a stream abstraction similar (or identical) to the CM stream.\nIf anyone has any better thoughts (or can provide additional information / advice about the existing options) please let me know. Otherwise I'm going to aim for option 2 or 3 with the LearnBoost guys and see where the chips fall.\nCheers,\nJosh\n[1] https://github.com/LightTable/LightTable/issues/1652\n[2] https://github.com/LearnBoost/stylus/issues/1722\n. 1. Yeah, the newline token matcher also matches indentation:\n   https://github.com/LearnBoost/stylus/blob/fa895d716f6c4233fa109182cd13c98d6cfdad2c/lib/lexer.js#L686\n2. And the selector matcher allows for line breaks:\n   https://github.com/LearnBoost/stylus/blob/fa895d716f6c4233fa109182cd13c98d6cfdad2c/lib/lexer.js#L886\n3. And comments:\n   https://github.com/LearnBoost/stylus/blob/fa895d716f6c4233fa109182cd13c98d6cfdad2c/lib/lexer.js#L592\nOther than that, general lookahead is implemented in the lexer, but is only used in the parser.\n1. I think indentation can be split from the newline matcher (relatively) simply by anchoring it to the start of a line with context,\n2. and I think for our purposes portions of selectors split across lines will still match as selectors.\n3. Comments (particularly multiline comments) might be a bit trickier. I imagine a hacky solution would be to check for comments at the head of the stream before lexing and tracking them manually in the mode state instead of feeding them to the lexer.\nOut of curiosity, why do we have the limitation of not being able to look beyond newlines in CM mode tokenizers? is it because files are always tokenized on a line by line basis? If so, buffering the entire stream would only ever be a maximum of one line, so shouldn't be hideously inefficient, right?\nThanks again for the guidance, one of my favorite parts of using an editor backed by CodeMirror is how vocal and helpful you are!\nCheers,\nJosh\n. For folks still looking for a Stylus mode in CM, I've published a very rough 0.0.1 (currently wrapped with the LT specific stuff, but perfectly serviceable on it's own) here:\nhttps://github.com/joshuafcole/LT-Stylus\nIn regards to writing my own lexer, stylus seems (to my naive eye) to be a very ambiguous language. Whereas SASS/SCSS and LESS have a lot of syntax constructs to make parsing simpler [1], Stylus makes almost all of it optional. The same identifier might refer to an element selector, a function call, a mixin, a variable, a CSS property or a CSS keyword.\nIn order to get decent results for Stylus, I think I'm really going to have to build an AST instead of just tokenizing. In the interim, plugging the existing lexer in gives okay-ish results but with very little extra effort on my part, and I get free security against bit rot and language enhancements breaking things.\nTo give an example, the following stylus and SCSS are equivalent.\n``` css\nfont-size = 24px\na()\n  text-decoration underline\nborder-width()\n  3px\nbody\n  font font-size sans-serif\n  a()\n  border border-width() solid pink\n```\n``` css\n$font-size: 24px;\n@mixin a() {\n  text-decoration: underline;\n}\n@function border-width() {\n  3px;\n}\nbody {\n  font: $font-size sans-serif;\n  @include a();\n  border: border-width() solid pink; \n}\n```\nI'm certain it's not impossible, but it does seem outside the range of a weekend project.\n. @peterflynn I accounted for viewport size (or tried to, I think it was a fair comparison) by manually editing the viewport size of the example editor in the browser to match the size of the editor in Light Table. Are there other externalities there I'm not considering?\n. I'll try and put some time into investigating that further then as time\npermits and I dig further into node-webkit. In the meanwhile, adding the\nthrottle seems to be an adequate solution which won't be thrown out of\nwhack by user theming / plugins.\nOn Wed, Nov 27, 2013 at 6:45 PM, Peter Flynn notifications@github.comwrote:\n\n@joshuafcole https://github.com/joshuafcole I can think of two more, at\nleast:\n- CEF !== Chrome. They are often different Chromium versions, and you\n  never know what other subtle differences there might be. When comparing\n  Brackets vs. vanilla CM, we usually try to point our app shell at the CM\n  test page rather than loading it in the regular browser.\n- CodeMirror can be extremely sensitive to the layout of its parent\n  hierarchy, which of course differs greatly between the full app and any\n  simple CM test pages. In one case (#1514https://github.com/marijnh/CodeMirror/issues/1514)\n  we found that minor changes to the line-number gutter's CSS styles caused\n  major differences in performance. Sometimes we've debugged CM-Brackets\n  rendering perf diffs by 'bisecting' the UI: stripping chunks out to\n  simplify the app, or adding containment layers to the CM test page, until\n  they meet in the middle... looking for the spot where the performance diff\n  jumps up or down.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/2007#issuecomment-29435870\n.\n\n\nScrew the environment. Please print this email immediately. And then burn\nit.\n. Definitely a valid point. At maximum key repeat speed, the highlight can lag about 1-2 lines behind the current line on the mac I was testing (this is purely visual). I'd considered that issue in the LT thread (as my linux machine works perfectly fine). Setting the throttle to zero by default and providing a configuration option seems like the best solution to me. I'm not super familiar with CodeMirror, but I imagine hooking into it's options system shouldn't be too difficult. I took a shortcut with this solution as a proof of concept and since I really didn't know how to integrate optional support for it into Light Table.\n. Looks awesome, I'll give this a spin on my machines (affected and otherwise) and let you know the results!\n. marijnh: I can confirm a significant improvement using your patch. It's also visually snappier than my throttling solution and I think a cleaner fix overall. I strongly support it.\n. Okay, I'll see if I can figure out a way to disable the automatic keybindings in a reasonable browser.\n. I've investigated this further and found that findNext is being triggered on both the leading and trailing edge of the C-s shortcut. I also tried updating the search/searchcursor code from latest codemirror and found that it's pretty heavily modified in terms of functionality, so this issue is safe to close. Sorry for the false positive!\n. ",
    "jeffmay": "Here is the fixed link: http://dl.dropbox.com/u/3878302/sample_template.xsl\nThis happens to me in Firefox on Ubuntu 12.04, but I'll try it in some other browsers and let you know.\nI'll give upgrading to 2.32 a try.\nThanks!\n. It seems to only happen when I have:\n{ lineWrapping: true }\nIn both Chrome and Firefox on Ubuntu 12.04. I have to get VirtualBox set up again on my machine to test out Safari and IE.\n. Also, it seems to happen with CodeMirror 2.32 as well on CodeMirror 2.25, as long as lineWrapping is enabled.\n. Just as an update: I saved the sample page (http://codemirror.net/mode/xml/index.html) as HTML and updated it to use { lineWrapping: true } and I couldn't replicate the issue. I have the code mirror inside of a wrapper that I am messing with as well as that wrapper being inside of a JQuery UI tab. I'll play around with this until I can replicate the issue.\n. Yea, I have several tabs and I call refresh after switching between them, since the content is changed when switching tabs. It also refreshes when the scroller element resizes.\nI implemented my own find and replace bar based on the sample from CodeMirror 2.16. When I remove these enhancements, I still get the problem, so it most have something to do with the container, or it could just be some sort of race condition that appears on my page because of the number of elements and styling.\nI'm going to revert to CodeMirror 2.16 for now, but I'll keep investigating.\n. Yea, I'll work on this and see if I can make a reproducible error.\n. ",
    "Carreau": "ok, no problem, I was just a proposal, I'm fine with defying this externally. \nGreat workBTW :-)\n. well, one way I see to fix it, would be to check in CodeMirror.getMode that the given mode has a indent function and and otherwise bind function(){return 0} , before returning it ...\n. Hi, \nFYI, I'm still seeing that in a less pronouced manner on 3.13.0 , I'll try to see if this is specific to the styling I applied to CodeMirror. \nThe difference is it is only 1 caracters, and only for certains width of the editor. \nI'll try to do it in a small reproductible manner in a standalone editor.\n. Awesome !\nHuge thanks !\n. Hi there, I guess the problem is not with the v, but with the fact that node semver is expecting vX.Y.Z no vX.Y where z is bugfix., this is what Raphael, and Ace are using. \nWould using a 3 digit notation be also a Problem ?\n. Hi,\nSame as @ellisonbg, using bower to try to install codemirror. \nusing the described way of using bower install <package>#<version> seem to fail with codemirror. same if you edit the components.json by hand a try to set version to string like ~3.0.0 or >3.1 .\nI tried different combinaisons without success, and came across this issue. Digging a little deeper I found that some package that can be installed with bower like cloudhead/less.js use 3 digit version tags.\nI had a quick look through bower source, and for what I understood, bower is using a package that expect 3 digits version number in tags (not 100% sure though).\nSo I just pitched in to say that the issus might not be in the prefixed v, but in the number of digit.\nI can't re-test right now I'm behind a coporate proxy that prevent bower from working, but I'll try later, and give the exact error message of bower.\nFinally I would say that I agree with @marijnh that this is (also) something that should be fixed upstream, because it is annoying not to be able to use any tag or sha with bower. But, I understand the point of view of bower developer that try to impose a versioning-tag convention among project.\n. Wouldn't that prevent the autoloading of cython mode that would be looked into mode/cython/cython.js ?\n. Ok, that fine with me, I've seen mode/meta.js but I wasn't sure of the use of it. \nI'll see if I can find how to have cython register in meta.js to work with autoload and made as you suggested. \nThanks a lot for your time.\n. So I've got it to work, you can now enter java or cython in autoload demo and it works.\nBut I need to loop through CodeMirror.modeInfo (if it exists) to match by name in 2 places: resolveMode, and autoload add-on. Is it ugly? Would changing the modeInfo to a dict based on mode-name be acceptable (I guess not for compatibility with 3.x branch ).\nIf you think such changes are acceptable I'll clean-up the history, and can make separate PRs depending on how you like your history.\nThanks.\n. But modes and mimeModes know only of modes that have been loaded. I thought that including meta.js, which defines CodeMirror.modeInfo was designed to keep track of the modename <-> mimetype <-> file definition relationship. \nAnyway if modeInfo is not supported in current version I guess I'll have to revert my changes ?\nThanks.\n. Well, this seem to go beyond the scope of this PR. I cleaned up things, to stick only into providing\n- more configurability in python mode.\n- docs in pyton/index.html\n- a new cython mode defined in python.js file, and entry in meta.js\n- example cython in pyton/index.html and docs/modes\nOnly exception, gfm was missing a mimetype in meta.js as markdown was taken, I used text/x-gfm.\n. Thanks a lot.\n. > Thanks, Marijn! If simplifying the regexps gives a speed improvement, the IPython guys @fperez might be interesting of making the same kind of transportation for python.jl.\n1) I guess you mean .js :-) \n2) changing to 1 regexp would bread compatibility with the parserConf option . And mode like cython/ipython rely on that to slightly change the parsing. We could adapt, but I don't know for other project.\n. Thanks a lot, will try the new version soon !\n. Great ! Thanks ! I'll finis implementing the functionality in my project and see if I can contribute with an utility function and/or a stripped down example after !\n. Well, that was fast ! Thanks !\n. Thanks, yes, docs on its way, will send docs/example fro #2214 in a few minutes first :-) \n. > Nice demo, but I am not really looking to include it in the distribution -- I know from experience that people will then expect me to look at their improvements, factor it out into an addon, fix bugs, accept feature requests, etc.\nSure I understand, it was just to give an idea of how the data attribute could be used.\n\n(Also, there is no need to close the  tags on all files you touch! HTML5 allows them like that.)\n\nWill be careful not to do that. I know that it is allowed not to close, sadly some linter/parser don't take that into account and fail to do what they are supposed to. It was easier to add closing tag that to dive in other project to fix the parser.\nThanks.\n. Always a pleasure to fix docs when it's so well written.\n. Thanks ! \n. I guess it was a bad start for 2015... Thanks a lot, should have reviewed beta more carefully.\n. > My only OS X device died for good a few weeks ago, so I can't currently test this\nOld my condolences, I would have an availlable old spare os-x laptop, I would have gladely send it to you (assuming you type on AZERTY keybord :-P ). \nI'll dig a bit. \n. Hum, seem indeed to be osx shenigan indeead. When you past into a web textarea but no other input field of course, osx will append space before and/or after depending on wether the character before (and/or after) is a whitespace or not, depending on how you copied it. (ie I can repoduce the bug on above linked page)\nI'll dig to see if there is a flag to  set on the text area to tell OS X not to try to be smart.\n. Webkit feature called \"smart copy/paste\"  seem to be a won't fix, or more precisely a \"dont' really care ehencement request\".\nhttps://bugs.webkit.org/show_bug.cgi?id=29732\nShould I close ? \n. Even the past event handler might get the data with space, and you won't have any way of knowing wether the sent data spaces at start or end is indeed coming from user or webkit \"smartness\". \nSo you would displace the bug from people double-clicking-to-select-that-dont-want-space-and-have-one to people click-and-draging-to-select-that-want-space-but-dont. (IIUC) \n. Indeed you are right, seem to return the raw text. \nMaybe in wishlist once clipboard API stabilises ? \n. Meh... I can see the use, but then that make every themes that define an operator style useless/inconsistent. \nWhat if I send a PR that change themes that don't have an operator style from ... .cm-keyword  to ... .cm-keyword, ... cm-operator ? That would still make operator visible, but leave freedom for theme that want to define a different operator style.\n. Thank you very much !\n. Done in #3974, not sure how/where to do tests though. I manually expanded and tested the examples in completions.html still.\n. > Oh, oops, our messages crossed each other there (and somehow github didn't do its usual auto-updating on the thread). Sorry for the duplicate work!\n\nI'll see if I can pull out the new tests and merge them separately.\n\nNo worries I could have submitted another patch. Thanks !\n. Thanks ! I didn't knew about hintOptions that seams undocumented. \n. Ok, thanks, closing then. \n. Unexpected token 14:2 next char is v ... seem legit, but wait, previous line no ; :smile: \n. > The project uses two spaces for indentation\nOoops, sorry, I knew that. \n\nAnd you can directly put the call to sol() in the condition, no need for a variable.\n\nGood point. \n. done.\n. Done.\n. Also added 2 test for  #3975 as 03d684f you merged recently, and rebased on master.\n. ",
    "abique": "Thanks a lot :)\n. ",
    "jochenberger": "Sorry for commenting on a very old issue, but I'm also en countering very high memory usage when running 10 MB of JSON data through the runmode plugin. I wrap the content in a scrollable div, but the runmode plugin is doing all its work eagerly, right?\nShould I create an issue or just use a \"regular\" CodeMirror for huge files?\n. I just encountered that issue. Unfortunately the workaround does not work if the .cm-tab is wrapped inside other spans. For example, I have the following structure:\nhtml\n...\n<span class=\"cm-punctuation\">\n  <span class=\"cm-tab\" role=\"presentation\" cm-text=\"    \">   </span>\n  <span class=\"cm-tab\" role=\"presentation\" cm-text=\"    \">    </span>\n</span>\nMaybe the workaround should check the last child that has text content.\n. It's also correct if I add a return value\n. Yes, you're right, I just noticed myself while trying to reproduce the issue in a fiddle. Sorry.\n. ",
    "ymikhailenko": "match[0].substr(-2) fixed the issue.\n. ",
    "ikrestov": "\nNote that mobile browsers are currently not supported, and no testing is being done on them.\n\nSorry, my mistake, did not notice. \nBut, CodeMirror is usually working on mobiles, rather then crashing, except for some glitches depending on the browser.\nMy practice showed that it is usable on Stock Android/ Almost usable on Chrome for Android.\nAnd unusable in Opera, and probably will never be, as Opera ignores styles for inputs.\nAs I am testing (using) CodeMirror with mobiles, I will be trying to fix bugs that I come across, if it is useful for community, I will commit them to the fork. \n. ",
    "pavelfeldman": "My test case is scrolling in demos/fullscreen.html in the fullscreen mode with content increased to 2K lines.\n- Running Timeline in Frame mode on Chrome Canary shows that repaint frames went down from 85ms to 45ms\n- Reloading stock demos/fullscreen.html shows that time to paint went from 210ms to 120ms\n- There is room for further optimization: there are 7 reflows initiated by updateDisplay. The major problem is subsequent access to clientHeight/offsetHeight followed by the DOM mutation.\n. innerText is not the same as textContent. I did not know IE was missing it. It could be implemented as removeChildrenAndAdd(parent, document.createTextNode(text)). I'll introduce setTextContent(el, text) to mitigate it.\n. On Sun, Aug 5, 2012 at 1:23 AM, Peter Kroon <\nreply@reply.github.com\n\nwrote:\n\ninnerText is not the same as textContent.\n\nWhat is the difference then? The hack I provided for IE78 does the job for\nme.\ninnerText could collapse / trim your whitespace. See\nhttp://stackoverflow.com/questions/1359469/innertext-works-in-ie-but-not-in-firefox\n.\n. On Mon, Aug 6, 2012 at 2:01 PM, Marijn Haverbeke <\nreply@reply.github.com\nwrote:\nThis is awesome. I had the belief, from a variety of blog posts and\nexperiments, that you can't really beat innerHTML's speed with direct DOM\nmanipulation. Guess that doesn't hold.\nThe 2\u00d7 claim seems exaggerated, but I did see a speedup in the 10%-20%\nrange on most browsers, and a slight (5%) slowdown on Opera. Combined with\nthe reduced worry about XSS, this seems definitely worth it. Merged.\nGreat, thanks! In fact, 2 x is almost true for me locally (Chrome Canary on\nMacBookPro). 85ms -> 45ms per frame upon scrolling;  210ms -> 120ms first\npaint time.\n\nYou had a bug in the handling of lower ascii characters in getElement, as\n\nwell as a bunch of seriously slow code (accumulating a separate text node\nfor every character), which I've fixed in\ne236f8a963f2ac72628fba5a9a73033a653c90f5 .\n\nThanks for taking care of these.\nRegards\nPavel\n\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror2/pull/698#issuecomment-7520567\n. Where do I learn more about v3, its features and milestones? I am asking since I am assessing the potential use of CodeMirror as a part of the WebKit Web Inspector. We are using fixed gutter in the present editor and would not want to change the model.\n. Actually, to make sure I understand the problem properly. I thought that adding horizontal scroll to the scrollbar, hiding it from the scroller and adjusting gutter's style upon onscroll + delegating it to the scroller's scrollLeft would solve it. There probably are complexities I don't understand.\n. Oh, Ok, I see. I started from this way of living in the WebKit's editor, but then we needed to make gutter an independent div to the left from the main area + we sync the vertical offsets using JS. Syncing height turned to be less noticeable - rows don't change their height too often.\n\nAs for the WebKit integration requirements, fixed gutter is fairly important to us, primarily due to the breakpoint markers. We don't want breakpoints to get behind the screen - one would need to scroll to remove them + you always want to know what line you are at. We don't have line wrapping and even if we did, it would be turned off by default. So yes, it is important for our use cases. Tell us if we can help with it.\n. Eclipse, Sublime, TextMate, Notepad, textarea I am currently typing in right now and virtually any editor?\n. What you've done is good, but I don't think it is good enough:\n- Select a word\n- Hit Delete\n- Play with undo/redo - things work well, selection is restored\n- Now move cursor to a random place in the file\n- Play with undo/redo - selection is no longer restored\nSide note: I don't think one should compare undo/redo behavior with the one in browsers, I'd rather target code editors. Popular ones I listed above seem to be consistent in this regard.\n. The one I described is now fixed, there is one remaining though:\n- Select a word\n- Hit \"a\" to replace the word with single character \"a\"\n- Play with undo / redo, things work fine\n- Move cursor to another line\n- Play with undo / redo.\nSelection is restored when undoing just fine, but cursor is not moved to after \"a\" upon redo.\n. Yep, its a dupe of #728.\n. Yet I can see it clearly. Does this mean you don't want to make 60 configurable?\n. Ok, my teammates are making me perform blind testing.\n. Ok, I failed :)\n. Note that I only detect keywords within the property values, we don't want \"padding\" property to become a keyword. So these are not strictly \"keywords\". However, from the highlighter perspective, I think it makes sense to decorate these as such.\n. ",
    "travisbot": "This pull request passes (merged 328376f9 into 7ac53982).\n. This pull request passes (merged 729edd6b into 7ac53982).\n. This pull request passes (merged f55cd3de into 6c05854c).\n. This pull request passes (merged 6430ce2d into ed2863d9).\n. This pull request passes (merged 9a1917ab into ed2863d9).\n. This pull request passes (merged 28bfd185 into ed2863d9).\n. This pull request passes (merged 483965ec into ed2863d9).\n. This pull request passes (merged f6564874 into 472d099b).\n. This pull request passes (merged 0d020d0b into 472d099b).\n. This pull request fails (merged 4b04b00b into c0ab8708).\n. This pull request passes (merged a2cdcd5e into c0ab8708).\n. This pull request passes (merged 1ee415bb into c17f9f9a).\n. This pull request passes (merged 7d53303c into 4a034c12).\n. This pull request passes (merged 4743deb4 into 97030154).\n. This pull request passes (merged 95142120 into 3c281106).\n. This pull request passes (merged d4ea5baa into 8d0c522b).\n. This pull request passes (merged e4542b2a into bf3a6f44).\n. This pull request passes (merged d0b697c9 into ee160098).\n. This pull request passes (merged ec484a1a into ee160098).\n. This pull request passes (merged ec484a1a into ee160098).\n. This pull request passes (merged 7644ac16 into 79fa0bdb).\n. This pull request passes (merged 99ac0920 into 21898103).\n. This pull request passes (merged c30632a0 into 21898103).\n. This pull request passes (merged 777687db into 21898103).\n. ",
    "maracana": "ok, that's right.\nbut if I replace multiple lines for the active class and 'lose' the number of these lines\nExample:\n  setTimeout (function () {editor.setLineClass (5, \"active_line\");}, 5000);\n  editor.setLineClass (31, \"active_line\");\n  editor.setLineClass (3, \"active_line\");\n  setTimeout (function () {editor.setLineClass (12, \"active_line\");}, 12000);\nHow do I leave it null again? I do not have indexes\nI have found no solution with setLineClass\nIs there any implementation of this nature in codemirror actually?\nthanks\n. ",
    "michaelnero": "The latest dev snapshot fixed the issues I was seeing.  Thanks for responding so quickly and being awesome!\n. ",
    "Leonya": "Just an observation on pointer-events - we are the guys who need to find out the token that had been clicked. So we've added some pointer-events: all rules for the elements we need in order to override pointer-events: none\nWhile upgrading to CM 2.33 I've noticed that you removed pointer-events: none so I dropped our pointer-events: all additions. Guess what? Clicking the tokens broke for us, they became partially clickable in a weird way, i.e. clickable at the bottom, but not on the top. So I actually had to re-add all of the pointer-events magic.\n. Will this only be part of version 3? I'd love to be able to register event handlers such as onGutterClick after the instance has been inited. For now I've patched the source code with a simple\nonGutterClick: function(func) {\n  options.onGutterClick = func;\n}\nbut better to have it supported in a more natural way.\n. Cool, that'll do for now. Am I assuming correctly that on allows attaching multiple handlers and controls event propagation? Usually (i.e. jQuery) you can return false in an event handler to prevent the rest of the handlers from executing.\n. But CodeMirror-mark-collapsed is the marker element itself. Found out actually that setting className after setGutterMarker does the trick, styling is then applied in all browsers.\n. I couldn't reproduce it with your demo, nor by modifying it to match my code as closely as possible. Probably something is wrong on my side, I don't think it's a CM issue anymore.\n. Alright, using operation now and everything is super-snappy.\n. Yep, the offsetParent fix worked.\nI'll investigate the CSS problem and let you know.\n. > Could it be that codemirror.css has not been loaded when the editor is initialized?\nThat's it, I've confirmed it. I'm using dynamic CSS/JS injection in GWT and it seems that it doesn't bother with ensuring the correct order of resources. Happens both in Chrome and FF. Oh well, I'll keep the patch then until I figure out a better way to load 3rd-party resources.\n. demo/marker.html is using multiple gutters.\n. Right, it does in the demo. Something is wrong with my implementation.\n. Looks like a weird Chrome bug. If I change marker.className = 'CodeMirror-something' to marker.className = 'codemirror-something' (all lowercase) it starts working properly. Even though my CSS file contains the CodeMirror-something selector. My guess is, it happens when CSS is loaded dynamically via JS.\nThe workaround I've found is to create the marker using jQuery:\njavascript\n      var marker = $('<div class=\"CodeMirror-something\"/>');\n      return marker.get(0);\nHave you encountered something like this before? I'm really puzzled but glad it finally works.\n. I'll make a test case and submit it to Chrome, it is indeed very uncommon.\n. BTW, I've already tried the latest HEAD (9d1d38c) to see if there was a fix in there somewhere - nope.\n. The settings are\njavascript\n{\n  lineNumbers: true,\n  readOnly: 'nocursor',\n  lineWrapping: false,\n  matchBrackets: true,\n  tabMode: 'spaces'\n}\nThe document is highlighted source code, so yes, it contains lots of marked spans, a bunch of gutter markers and some folded lines as well. No widgets, no rtl. A demo is tricky because the project has not been released/announced yet, so it's only hosted in the intranet for now. I can't really describe the sequence of actions that triggers an infinite loop, it seems to happen rather randomly. Oddly enough, it usually happens when I move the mouse to the gutter area and click a marker - oddly, because the mouseover handler is not even triggering in the gutter area, only in the document itself.\n. Alright, so the loop in question is\njavascript\n      for (;;) {\n        var estX = getX(estimated);\n        if (estX <= x && estimated < to) estimated = Math.min(to, Math.ceil(estimated * 1.2));\n        else {toX = estX; to = estimated; break;}\n      }\nx is 0, y is 53, from is 0, to is 54, estX is 0, estimated is 0\n. The caller function is window.CodeMirror.CodeMirror.coordsChar and its' state is\n``` javascript\noff = {\n  width: 1457,\n  height: 360,\n  top: 43,\n  left: 93,\n  bottom: 403,\n  right: 1550\n}\ncoords = {\n  top: 96,\n  left: 82\n}\n```\n. Thanks for a fix, it helped!\n. Gutter background disappears as you scroll the document (it's only visible until the bottom of the viewport)\n. Sorry, the comment was intended for https://github.com/marijnh/CodeMirror/issues/791\n. Sorry, I don't understand. If CM stops mousedown, than my mousedown handler won't work in the same cases as my click handler.\n. https://gist.github.com/Leonya/5145774\n. I've made a recording of the jittery gutter - http://screencast.com/t/Qs0octD4A8z\nIt's easy to reproduce - paste a large JS file into the editor and try scrolling.\n. I'm on OS X 10.8 and this bug appears both in Chrome 26 and Firefox 20 (which does not have the new-style transparent scrollbars, if it matters). I couldn't reproduce it on Ubuntu either.\n. I think you need a large-ish file, and you need to do the scrolling pretty quickly at the bottom of the file in order to reproduce this. \n. I don't want to set nocursor, I want to have it on the desktop.\n. Ouch, this is super-ugly. A change to properly support titles seems pretty straightforward: https://gist.github.com/Leonya/5948899\n. I have the same configuration and the same problem. Except that removing .CodeMirror-lines { padding: 0; } from my styles doesn't fix the problem, the editor still has zero height in all IEs. Replacing clientWidth with offsetWidth helps though.\n. It's the same problem. My styles are\n```\n.CodeMirror-lines {\n  padding: 0; // vertical padding\n}\n.CodeMirror pre {\n  padding: 0; // horizontal padding\n}\n```\nI tried removing the first rule but didn't notice the second one which is why clientWidth was still 0.\n. Thanks, found a workaround.\n. I have, indeed. Unfortunately, after inspecting the head/anchor values between events they don't seem to be any different from simply selecting across lines. line -> line -> line is indistinguishable from line -> widget -> line\n. Yes, it needs to be a bit more complicated:\n``` html\n<!doctype html>\n\n\n\n\n\n\n\n\n  var cm = CodeMirror(document.body, {\n    lineNumbers: true,\n    styleActiveLine: true,\n    value: \"1\\n2\\n3\\n4\\n5\\n6\\n7\\n8\"\n  });\n  var w = document.createElement(\"PRE\");\n  w.innerHTML = \"--- widget --- widget --- widget ---\";\n  cm.addLineWidget(4, w, {above: true});\n\n\n```\nIt's not this specific addon causing this though, many others do as well. You have to set top on the gutter element's wrapper when there's a widget above the line.\n. As soon as you click the line number 5, the corresponding line number marker jumps to the widget line. After you resize the window it jumps back.\nBefore:\n\nAfter:\n\n. No, I was using 3.20, works fine in master indeed. When is the next version coming out?\n. Nothing special really - marking a few hundred ranges with a class. Most work fine, a couple throw the aforementioned exception. If I wrap markText in a try-catch, the catch is not entered, marking works just fine. I suspect a Chrome bug.\n. I've added\nconsole.log(cm, line, findViewIndex(cm, line), display.view[findViewIndex(cm, line)])\njust before lineView declaration in regLineChange. undefined is returned as soon as we are dealing with a line outside the viewport. Only happens on certain files, I don't see anything special about them.\n\n. Reverting back to revision 60d4f1e5e4 helped. There's just a handful of commits between that one and 8cdb38c54b.\n. Probably requires some folded ranges to be present?\n. Yes, thanks!\n. I've made a demo that demonstrates the issue: https://gist.github.com/Leonya/9804311\nI don't know if you approve of such usage scenario but it's been working fine for me for a long time. If there was a public updateGutters method (or if updateGutters was part of refresh procedure) that would solve the issue for me.\n. It does, thanks!\n. The problem is, my tests are much more high-level than yours, I'm testing a diff tool written using CM, not CM itself. I'd have to disable half of my test suite if I follow your suggestion.\n. Will try to... Meanwhile, reverted back to 3.23\n. Initial width is set correctly but it's not being updated.\n. Thanks, this helped.\n. Oh, thanks.\n. By the way, I sent a pull request that fixes a couple of typos in jade.js\n. Could you please republish 5.18 or release 5.19? The current release is unusable.\n. Thanks, could you please cut the 5.26.1 release, I'd really appreciate that.. True, but very common.\n. ",
    "ibdknox": "@marijnh @njx confirmed fixed on latest chromium :)\n. This issue appears to be specific to chromium on a retina macbook and doesn't seem to be in codemirror's realm of responsibility.\n. I did expect the padding on the right side of the line, but it looks like I falsely attributed the problem I'm seeing to styling. It appears the real issue I'm running into is that refresh doesn't recalculate the maximum width of a document. See this gist for a small repro\nBasically if I create an editor and set its content without appending to the dom, then append it and refresh, the width is incorrectly set and will only be reset when the longest line is modified.\n. +1 on this - right now dealing with this is pretty clunky.\n. I was doing it at keyboard repeat rate which I think defaults to like 40/s (25ish ms). I'm just surprised that line numbers causes that big of a jump in the time it takes to refresh. Here's a little gist that shows the difference: https://gist.github.com/4551461\nAre there any gains to be made in refresh performance in general? Or some shortcut to take when hiding and showing editors frequently? \n. Patch works wonderfully, thanks.\n. That may be a possibility, I've been thinking about working with you on a general \"attack performance\" gig (specifically this and line numbers). Not quite at that point though.\n. Any more thoughts here?\n. Awesome. Thanks for the heads up. :)\n. Any thoughts on how to fix the cursor placement issue? If you put two bookmarks at the end of the line with insertLeft the cursor ends up in between them instead of after the last character. I looked into it a bit and from what I could tell the issue has to do with the way it assumes positions equate to a single measurable span.\n. I'll make the changes today or tomorrow to get it off your plate.\n. @marijnh made the requested changes.\n. Ah sorry for the double report then, I just know it's already hard keeping track of all the open bugs much less the closed ones. Is there a process you'd prefer me to follow in the future? Just comment on the original post or would you rather a new bug opened instead? Happy to carry on either way.\nIn terms of the patch, it works wonderfully and in the more complicated case it's not clear what the \"correct\" thing would even be, so I'd punt that if it were me too heh. Thanks!\n. @peterflynn Light Table uses node-webkit actually, which is based on the content shell of Chromium. For whatever that's worth here.\nI can easily get the same thing to happen in Chromium though scrolling upwards assuming I make the editor a decent size.\n. It's inline-block\nOn Sunday, May 25, 2014, Marijn Haverbeke notifications@github.com wrote:\n\nIs this widget display: block? If so, does making it inline-block fix the\nproblem?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/2575#issuecomment-44147637\n.\n\n\nCheers,\nChris.\n. Fwiw, this same thing happens with the widgets for folding if you make it\nthe longest line and get the marker at the end where it should force\nhorizontal scrolling.\nOn Sunday, May 25, 2014, Marijn Haverbeke notifications@github.com wrote:\n\nIs this widget display: block? If so, does making it inline-block fix the\nproblem?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/2575#issuecomment-44147637\n.\n\n\nCheers,\nChris.\n. That does indeed seem to work around it. For those playing at home, this does the trick \ncss\n.Codemirror-widget::after  { content: \"\"; }\nThanks Marijn!\n. ",
    "doxhung": "Thank you for your information, Marijn and Mattpass.  I'll report that issue to the Webkit developers and hope they will fix it soon.\n. Hey y'all,\nI found out the solution for this (webkit) issue on the Stackoverflow (http://goo.gl/jERQv). It is:\nWith the above sample code of Marijn:\nReplace:   document.body.webkitRequestFullScreen()\nwith:         document.body.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);\nAnd it works like a charm in webkit browsers. I hope this can help you all on the similar projects.\nP/S: FYI, on the Mozilla Developer Network, they said \"Any alphanumeric keyboard input while in full-screen mode causes a warning message to appear; this is done to help guard against phishing attacks.\" (https://developer.mozilla.org/en-US/docs/DOM/Using_full-screen_mode). So it is not an issue of the the browser.\n. Of course, my site doesn't perform phishing attacks, so I still use the above solution.\nThanks and hope your day went well!\n. ",
    "varemenos": "@mattpass could you provide the link for the bug you filled? I'd like to track its status\n. ",
    "priand": "Sure. I created a Dojo 1.7 control that acts like a TextArea but using CodeMirror as the editor. This is a reusable component that you can put in any page, as many times as you want.  And this dojo control automatically includes the CodeMirror code, so the app developer doesn't have to add an explicit ",
    "jmendeth": "For the record, see how easy is it to convert CodeMirror into a RequireJS module now:\nJust turn the second line:\njavascript\n// CodeMirror is the only global var we claim\nwindow.CodeMirror = (function() {\nInto this:\njavascript\n// CodeMirror is the only global var we claim\ndefine(function() {\n. > If the requireJS optimizer doesn't properly resolve relative paths, that sounds more like a bug in that tool.\nAgreed.\n. Yep. The point here is that GFM should only highlight the text\n(letters that are seen when rendered) and not attributes (like URLs).\nOn the other hand, extending Markdown correctly could require\nsome restructuration/refactoring of the Markdown mode. Dunno.\nI'll have a look at it soon.\n. yep, I see...\n2013/3/1 Brandon Frohs notifications@github.com\n\n@jmendeth https://github.com/jmendeth if I remember correctly, this is\nmore of an issue with how the overlay mode works, and not how Markdown\nparses the file. Definitely open to suggestions though.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/961#issuecomment-14294770\n.\n. @marijnh I know. That's why I'm suggesting to add another class to the\nselected text (that would be used to change colour, text-shadow, etc.).\nWould you be open to a pull request? I really need that feature.\n. Yep. Actually, the matchhighlighter addon does something like that.\nThen I propose to have an addon that applies the class when used.\n. I agree. Also, selection should be a core feature.\n\nThe ideal would be that themes had a JS file that exposed theme's properties\nto CodeMirror, just like it is done with ACE.\nOn the other hand, trying to detect it with getComputeStyle would be\na really nasty workaround, and not a simple solution.\nI think I'm gonna put an option (turned off by default).\nJust gimme some time...\n. @marijnh Yeah, I see it's a real mess. :interrobang:\nBut don't worry, I can get a general idea of how it works\nnow --I've traced a bug through all that function... :)\n. Finally, I've decided to make a selection/mark-selection addon.\nIt's the least invasive and most simple solution.\nI've tried it and it works without problems here.\n. Committed a demo page for mark-selection, see 96ed2dd.\nTry it online!\n. Sorry for that, didn't know about defineOption.\nOnly one thing: the docs say getCursor('end') would\nreturn the head (the side of a selection that moves if\nyou press arrow keys) that isn't necessarily the end\n(lastest mark) of the selection.\nAnd it seems markText needs from, to ordered\n(from must be less than to, other it won't work).\n. At least I understand them such way.\nQuoting that same link:\n\nIf it [the argument] is not given, the current cursor pos, i.e. the side of the selection that would move if you pressed an arrow key, is chosen. Alternatively, you can pass one of the strings \"start\", \"end\", \"head\" (same as not passing anything).\n[Emphasis added]\n\nSo doing getCursor('end') is the same as getCursor('head') and getCursor(), which returns the side of the selection that moves. It hasn't to be the first or last mark (depends on if you select forwards or backwards).\n. Aaaah! Something made me think the other way. :cold_sweat:\nSo I had to go with lessthan. Thanks for clarifying!\n. See the manual (mark-selection part) here.\nSee the new active-line demo here.\n. Yeah, that's exactly what I thought when I was writing the message.\nBut the thought that came after it:\n\n@marijnh always merges manually, combining or splitting up patches as necessary.\n\ntogether with my mum shouting I had to take out the dog,\nmade me press the \"commit\" button. :)\n. :+1: for me.\nClean, functional approach.\n. > This will fall apart completely on lines with mixed font sizes or wrapped lines.\nIndeed. Not completely though. I [partially] kept this in mind.\nIt is meant to be used on monospaced lines even if they wrap (I tested it).\nIt is guaranteed to work on any line with only one font.\n\nIt's what browsers do natively, I see no reason for CodeMirror to do something different.\n\nYes and no.\nAs I said in my (lengthy, I know) exposition, CodeMirror does nothing wrong.\nHowever this problem doesn't appear on a regular <textarea> (see).\nIt's typical of code editors like CodeMirror, because they need to put\nlines in individual blocks.\n. > What I'm wondering about is why you consider this a problem. Drawing the selection like this is a widely used convention, and doesn't really get in the way.\nI repeat, the selection is correctly drawn, it's simply that it doesn't look that good. :)\nWhat image do you prefer:\n \u00a0 or \u00a0 \n. @marijnh By the way, the mixed fonts demo is wrong;\nthe first line is actually a level three heading. ;)\n. Ok, it's been a few days without activity.\nTo summarize this PR:\n\nWhen the line-height of the code is different than normal, the\nselection no longer lands between lines, thus creating a bit unestetical\nappearance. This is in any way a bug, it's just a consequence of how\nthe W3C spec defines inline bounds.\nI came up with a simple solution to remediate this problem.\nIt will not work on lines with multiple font/line sizes, but in\nthese cases the current selection is already OK, no fix needed.\n\nDo you agree on merging this? Too invasive?\nToo much performance impact? Think such a\nfeature isn't needed? Other issues?\nI truly respect your decision and opinions.\nPD: but really, what of the two images do you prefer? :)\n. Edit: monkey-patcher not needed, see next comment!!\n\nOk, I'll mantain a monkey-patcher separately. :disappointed:\nHowever, I don't see why it is confusing. The manual says it clearly:\n\ndon't use it if you're mixing fonts in a single line.\n\nI don't see it fragile or half-hearted either.\n- It will work with any font.\n- It will work even if the text wraps.\n- It will work even if some lines have different heights or fonts.\n- You don't need to manually pass in the height of the lines.\n- Very simple solution.\n- (IMHO) low impact on performance.\nIt only breaks in the case above.\nBut really, when you're mixing fonts you don't need that feature, so it's fine.\nAnd frankly, why the hell would a code editor mix fonts in a line? :)\nThank you for your time anyway.\n. @marijnh I'm happy to announce that I've found a much cleaner workaround,\nand it is to add a vertical padding to the spans to compensate the space.\nFor example:\ncss\n.CodeMirror-mytheme {\n  line-height: 1.5em;\n}\n.CodeMirror-mytheme pre > * {\n  padding: .15em 0; /** depends on line-height **/\n}\nSee code at Dabblet. More info on LeaVerou/dabblet#3.\n. :+1: * 999999\n@marijnh I'll look at configuration parameters though.\n. ",
    "mikebridge": "Further to the record, the RequireJS's shim feature works with CodeMirror too:\njavascript\n    \"shim\": {\n        \"codemirror\": {\n            \"exports\": \"CodeMirror\"\n        }\n    }\n. ",
    "heruan": "I used the shim feature, but how to make it work with modes? Each mode use window.CodeMirror, which is undefined using RequireJS.\n. Awesome, thanks! I noticed the mode modules make assumptions on RequireJS paths, e.g. the gfm mode:\njavascript\ndefine([\"../../lib/codemirror\", \"../markdown/markdown\"], mod);\nIt would be better something like this instead:\njavascript\ndefine([\"codemirror\", \"codemirror/mode/markdown\"], mod);\nto let the developer choose RequireJS module names > paths mapping (as it should be).\n. I agree, it makes sense. Just one note: if I create a CodeMirror instance from a required textarea, CodeMirror will save its content on the original textarea on form submit: this won't work though, since form validation happens before triggering the form submit event, thus since the original textarea is still empty the validation fails and the submit event isn't triggered.\nI think it should be more reliable to keep the original textarea synchronoulsy updated instead of on its form's submit.\n. See #2018 \n. ",
    "kashifshamaz21": "@marijnh I agree with @heruan 's comment that, the paths in the define shouldn't be relative, but should be something like:\ndefine([\"code-mirror-folder/codemirror\", \"code-mirror-folder/codemirror/mode/markdown\"], mod);\nThe reason is:\nThis way, the users have option to place code-mirror package anywhere in their project and just need to set \n\"code-mirror-folder\" to point to the directory containing this plugin source.\nIf relative paths are used in the define, it creates problem when you use requireJS optimizer to minify the plugin and its addons into a single file.\n. ",
    "djadmin": "\nto let the developer choose RequireJS module names > paths mapping (as it should be).\n\n+1.\n@marijnh : The problem comes when we have changed our baseUrl in require Configuration. The add-ons looks for '../../lib/codemirror.js' which comes out to be a different based on different baseUrl.\nIt would be great if we could have something like this for every addon which supports AMD.\ndefine([\"codemirror\"], mod); instead of define(['../../lib/codemirror']);.\nThanks\nDheeraj\n. +1. Thank you for the help.\n. Hey, I cant reproduce it. I've tested it on firefox & chrome as well.\n Ctrl-V is scrolling to the bottom even if do 50  X  Ctrl-V\n. Adding to what marijn suggested with code:\n``` Javascript\nCodeMirror.registerHelper(\"hint\",\"yourOwnHint\",function(cm,options){\n    var cur=cm.getCursor(),token=cm.getTokenAt(cur);\n   var start=token.start,end=token.end;\n//Perform any opertaion or check before providing completion\nreturn {\n  list:[\"cms39_error_handler_db\",\"cms39_array_to_string\",\"cms39_string_to_array\",\"cms39_html_compress\",\"cms39_sanitize_output\",\"cms39_requiretovar\",\"cms39_session_start\",\"cms39_getvaluefrompath\",\"cms39_setvaluefrompath\",\"cms39_arraytoxml\"],\n  from: CodeMirror.Pos(cur.line, start),\n        to: CodeMirror.Pos(cur.line, end)\n}\n\n});\n```\nOr the other thing he suggested about adding your functions to \"javascript-hint.js\"\nEg:\nJavascript\njavascriptKeywords.push(\"cms39_error_handler_db\"); // Further on\n. The problem is that you are forcing autocomplete to use only your hinting function which will not trigger the anyword-hint or any other hint. As Marijn mentioned, you should first read http://codemirror.net/doc/manual.html#addon_show-hint \nAnd if you just want to add few keywords which should be shown with the javascript keywords, you should try push it to the javascriptKeywords as I mentioned in the second section.\n. I've change the required feature you suggested, Please check it here https://github.com/marijnh/CodeMirror/pull/2440\n. I am able to reproduce it on Mac OSX(10.9.1) Chrome(33) & firefox(25) , and Windows 7 Chrome (32) .\n. Actually , Technically there is no scrollbar, but I'm to scroll it down till the line numbers goes off.\n\n. The simple way to get rid of this bug is to \nchange line 34 of rulers.js to\nvar bot = 0;\nCheck the patch.\nhttps://github.com/marijnh/CodeMirror/pull/2440\n\n. I don't think there is a problem with the patch, since it allows you to produce vertical lines till the line numbers you've in the editor instance irrespective of the height of the editor.\nOr as @lkcampbell suggested if we want the vertical lines with height as the visible editor then we should do something like :\nvar bot = -cm.display.scroller.offsetHeight + editorHeight();\nEg: var bot = -330 + 255 ; (in this case)\nSorry, I don't know how to get the editorHeight() :/\n\n. Yes, It works like a charm. Exactly what @lkcampbell wanted.\n. Okay ! So you mean to say , when the height of the editor is more than the line numbers(able to see the part without linenumbers), there you want the ruler lines to extended, right?\n. The CodeMirror hint widget closes when it encounters space. Since your problem is user-specific, it would be better if you make the changes in your implementation only.\nChange the line 88 in Show-hint.js\nvar closeOn = this.options.closeCharacters || /[()\\[\\]{};:>,]/;\n. Thanks guys for adding the Goto line command to CodeMirror :+1: \n. There is an API to replace the selection(s) with a given string \n\ndoc.replaceSelection(replacement: string, ?select: string)\n\nA simple example is given below which will replace the selection with the given string.\neditor.replaceSelection(replaceStr);.\nPlease refer the manual (http://codemirror.net/doc/manual.html) for more information.\n. Sorry about that, I'll correct it.\nAnd I wrote the feature keeping the Single selection in my mind(for V3.x). I will handle the cases for multiple selections too.\n. Yeah ! I din't handle that case.\n. ",
    "inkrement": "thx, works great!\n. works like a charm! \nthx\n. ",
    "takluyver": "We'd prefer to indent only with spaces (that's the standard in the Python world).\n. Jumping in on OP's behalf: he is most likely using the Python mode as he originally reported it on Jupyter. I also replicated the behaviour in this demo, which is Javascript.\n. ",
    "dchichkov": "I would argue that any editor that [by default] inserts tabs into python code is evil.\n. ",
    "ugin": "I understand your opinion about a single core file, but it gets hard to work on specific parts (view, document, etc).\nBetter improvements can be made if we had simpler parts with clean APIs. Maybe someone has a better idea on how to improve the document module (if was a separate module), he would keep the same API and hack on a new version, to add 'on change, save to filesystem', etc.\nLet's face it, CodeMirror is a small project with a huge impact (Adobe Brackets, Webkit devtools, Google Script, etc.)\nPlease try to consider this from an objective perspective, as CodeMirror is not a module (to be kept in a single file), is a complex code editor (2000+ loc).\nI know is not easy for someone to come and change your way of doing thinks, but maybe others can share their opinion and the community should vote on how to proceed, sound fair?\n. I understand and agree to some extent, thank you for your time :)\n. @marijnh :heart:\nI would like to help if you could share what's on your mind and how to split it. Do you want to use npm for modules or simple files within the project?\n. ",
    "janl": "<3\n. @marijnh what are you afraid of in particular?\nAt Hoodie, we built a few things that help with this. Most notably:\n- Ubersicht: a cross-org \u201cwhat is going on\u201d tool with lots of filtering options: http://espy.github.io/ubersicht/#hoodiehq\n- grunt-semantic-release: makes releasing SemVer compliant modules a snap, takes care of all the boring grunt work like tagging and pushing to npm, having the same LICENSE file etc.: https://github.com/boennemann/grunt-semantic-release / announcement here: http://hood.ie/blog/semantic-releases.html (yes grunt, this might get ported to raw npm, but that might take a while cc @boennemann)\nNot saying that solves everything, but these two help us manage 50+ repos.\n. Ah I see! How about a meta package that bundles everything as it is today, but is comprised of the separated modules?\n. for us it helps that they each get their own CI treatment, e.g. might not apply here tho.\n. ",
    "seidtgeist": "Finally, a GitHub comment thread linked from Twitter that isn't negative. I applaud your fine discourse! :)\n. @silverwind Interesting, which parts of CM are you requireing in node?\n. Bro, after reading all this, all I can think of is this awesome horseshark:\n\n. Does someone who participated in this thread have a stable solution that works with the latest version of CodeMirror and that they can recommend?. For the maintainers, might it make sense to have a label and/or title/description blurb to mark issues that are addressed by version 6 to improve clarity?\nEdit: Just noticed the \u201cFixed in rewrite (hopefully)\u201d milestone \ud83d\ude4f. ",
    "kof": "If you publish a separate small lib dedicated to one task, the chance is big someone will use it in a different project and possibly improve it to solve that task even better. If you don't make a separate repository - no one will use your modules, which are part of some bigger project. In best case they will copy paste them.\n. ",
    "silverwind": "Regarding module-loaders:\nI'd love to require() parts of CM directly in node (for the purpose of dynamic mode loading) without having to first load them into a vm containing the global. If there's a loader which unifies the node and browser enviroments, it'd have my vote.\n. @ehd Right now, meta.js for mime types and extensions. The data is used for dynamic mode loading based on the Content-Typeon the file request. Besides that, I run all CM resources through automatic minfication on server startup.\nWhen I designed that, I wasn't aware of method like CodeMirror.findModeByExtension and CodeMirror.findModeByMIME, which most likely would've made this a lot simpler.\n. Looks like GPU memory corruption, try with hardware-acceleration off in Firefox.\n. Okay. One last quesion: The nginx mode for example should only work on a file called nginx.conf. Do you think it would be reasonable to add a filename field instead of ext in this case? Maybe in regex format?\n. Yeah, I'll do, it's an interesting topic.\n. Also could set gfm's name to GitHub Flavored Markdown for clarity.\n. > GitHub Flavored Markdown - isn't just README.md but could be anything with a .md extension such as CONTRIBUTING.md or HISTORY.md\nREADME.md is the only one rendered by default on Github as far as I know. I could see adding others here, but I wonder if these are just loosely based on convention or if there's a defininte list. \n\nNginx - can include other .conf files too thru the use of includes say include vhosts/more-sites.conf or wildcards (*.conf`)\n\nI first thought of allowing paths and using regexp pattern to match stuff like the common names for vhosts files, but decided against it for simplicty. I could easily extend it if requested.\n. > GitHub will render any file ending with the .md extension.\nYeah, but what I meant is, only a README.md is displayed below a directory's root, making it kind of special. I just went ahead and added your suggested filenames to gfm.\n\nYou also couldn't list Nginx conf files as they too could be any name with the extension .conf\n\nIf there's path support, I could possibly use /nginx[\\/\\\\]\\.conf$/ and get a good success rate because these conf files most likely reside in /etc/nginx. But I think that would require a findModeByPath which would then fall through to findModeByFileName, just like I do for extensions. I've changed the nginx filename to act like *nginx*.conf now.\nPaths would probably a very rare use case, and probably not worth the extra weigth it adds to CM. While I could myself use it, most commonly you only have a filename available in a web app.\n. > Just wanted to voice that I also think you should just add the .md extension instead of specific filenames. \nI would if i could, but the extension is already mapped to the vanilla markdown mode. If we can agree that Github Markdown is more popular, we could remap the extension.\n. Reduced the function a bit. Filenames are defined by a single regexp now.\n. Will do later today.\nFor the case of Markdown (if you agree), I think it's the best possible guess we can make. GitHub-based filenames are pretty common, and (if I remember correctly) the difference between regular and GitHub markdown are subtle enough, so it will render mostly correct in the wrong mode too.\n. Updated and squashed the commits. Case sensitivity now depends entirely on the regexp.\nAlso changed Dockerfile to be case-sensitive.\n. Awesome, thanks!\n. I also noticed some strange gutter alignment recently, but only in the themes mdn-like and pastel-on-dark.\nOn Firefox, the line numbers look like this in mdn-like:\n\nOn Chrome, in pastel-on-dark, I see the whole gutter moved a few pixels to the right, leaving a small gap on the left:\n\nIt appears the inline style values get calculated incorrectly. On Chrome, CodeMirror-gutters gets left: 5px, and If I set it to 0, it looks correct.\nUnfortunately, I can't reproduce in the demo and setValue seems to have no effect on the bug for me.\n. I think I have an regression window here:\nlast good: 4.6.0\nfirst bad: 4.7.0\n@Manoj-RG can you confirm it works in 4.6.0 for you?\n. Reverting https://github.com/codemirror/CodeMirror/commit/cde95c423cd59621b1f7b33a0de04f539fb9888a fixes it for me.\n. Try my demo. Go to 'Prefs' above and set 'Editor Theme' to 'mdn-like'. The issue should be visible immediately (floating gutter in Chrome, gutter bleeding into text in Firefox). My demo runs CM 5.0 right now.\n(If for some reason, the link doesn't open to a CodeMirror, nagivate to any other text file).\n. Can do, but I can assure you that no script touches CM positioning or gutter positioning.\n. Still investigating, I got this rather interesting display:\n\nThe bugged lines have\nleft: 12px; width: 34px;\nwhile the good ones have\nleft: 0px; width: 34px;\n. Well, I was able to solve the issue about the floating gutter in Chrome it seems. I think the cause for it was that I did cm.setOption(\"theme\", theme) before the theme's CSS was available. The theme sets a border-left: 6px, and I think CM didn't see that 6px border in .clientLeft yet when getDimensions ran before the theme was applied though CSS after an XHR.\nThe line number misalignment in Firefox is still unresolved. The left: 12px corresponds to two times the width of mentioned border, so i'd say it must be something about the border again.\n. Dumping out the 3 vars in getDimensions shows a browser inconsistency in offsetLeft:\nFirefox:\njs\nn.offsetLeft = 6\nn.clientLeft = 0\ngutterLeft =  6\nChrome:\njs\nn.offsetLeft = 0\nn.clientLeft = 0\ngutterLeft = 6\n. Probably this: https://bugzilla.mozilla.org/show_bug.cgi?id=850684\n@marijnh think you can work around that bug?\n. Also, I think the left calculation is wrong even in Chrome with the border present. This is with 6px:\n\nSetting it to 3px seems to be the correct value so it won't overflow.\n. I'll see if I can provide a patch for Firefox, but I'd appreciate a workaround in the meantime :)\n. Firefox build finally finished, turns out the miscalculation of offsetLeft is not caused by bug 850684. The fact that it doesn't show in the demo means to me that it must be another edge case related to the positioning of CM's parent nodes.\n. I scanned all offset related bugs in bugzilla, and while there are at least 5-6 dupes of above bug, none matches our case.\nI wonder if we could do without JS positioning on the line numbers. How about using CSS positioning like right: 0 on the line numbers inside the gutter? Would certainly be a lot less prone to browser bugs.\n. I'm not sure how much help a plain HTML would be. The bug is only happening in a seemingly rare condition where Firefox miscalculates offsetLeft. Been trying to reproduce in JSFiddle, but no luck so far.\nhttps://github.com/codemirror/CodeMirror/issues/3098#issuecomment-75554110 is a separate bug, where the border of the gutter isn't taken into account when calculating line number width.\n. Finally found the cause, it's box-sizing related. Minimal testcase for Firefox here:\nhttp://jsfiddle.net/silverwind/ozrsqch2/6/\n. Awesome, thanks :+1: \n@Manoj-RG: Please verify. I'm not totally sure this change covers your issue.\n. These new modes seem to be missing in meta.js.\n. @Dominator008 would you mind also adding an entry for this mode in mode/meta.js?\n. Thanks!\n. Indeed it's working as advertized using setOption. Sorry for bothering you.\n. ",
    "kolya-ay": "@marijnh, have you considered using rollupjs as module builder (might be used for PromseMirror too)? It works with ES6 modules, produces almost no boilerplate and supports cyclic deps which might be useful while refactoring.\n. ",
    "rahulchaturvedie": "Hi Marijnh,\nI am getting this issue as well on chrome scroll bar jumps to the top of the page in chrome latest version.\nDid you guys got it resolved or if there is any work around then please let me know as well.\n. peter.. this is something strange happening here\nwhen I am accessing the page with localhost:8080 then I am getting this error but when I call this page using my system name rahul:8080 then it works absolutely fine.\nFirst i thought its a cache issue, i cleared it but again getting the same issue, also I check the same in totally different machine and still same thing\nI am using CodeMirror version 2.34\nand this thing is happening only in chrome.\nplease suggest.\n. I am using it for xml mode\n. ",
    "0i0": "it is ridiculously productive to any kind of coding. the thing is, it takes a little time to understand the power of this.\nwe are used to think in a single coding dimension... and the jump to multiple dimensions is to understand there are many many things you can do in different ways\na great example will be if you use search and replace on something..\nand you want to replace only most of the matches\ntraditionally you would go over ALL of them one by one.\nwith multi select you can just put cursors on all matches (single action), than directly remove the ONLY ones you don't want to change\nfor example if you want to replace 21 out of 27 matches this will be 7 actions vs 28 actions \n(not to mention on each action you have to check yourself if it is a one you want to replace or not)\nanother example is if you want to add (,) at the end of a block of code at every line\nyou really have to try it to understand it more\nI have been working with it for about a year now with JS HTML C# and python and I still find new ways of using this that amazes me\n. ",
    "pablokvitca": "I think it is a great feature with tons of usefulness and, once you get used to it, very indispensable. It's like using for a while just a computer to write and then going back to use pen and paper, it's AWFUL.\nAlso I think this feature will bring many more users and costumers to any service using CodeMirror, so I believe it a great feature to spend time, and work on.\nI even found this on the CodeMirror Forum at Google Grupos: \"...All cursor and selection display is\ndone through DOM nodes, so you could extend the code to display more\nthan one.\" I thought of doing it (a patch or something as marijnh said on a comment, two before this one.) but I'm a student and don't have much time, and also I'm not very experienced on this so even is I manage do it, I think it would be full of bugs and things like that.\n. -----Original Message-----\nFrom: Jan Keromnes notifications@github.com\nDate: Mon, 03 Dec 2012 04:28:34 \nTo: marijnh/CodeMirrorCodeMirror@noreply.github.com\nReply-To: marijnh/CodeMirror reply@reply.github.com\nCc: Paulpablokvitca@gmail.com\nSubject: Re: [CodeMirror] Feature Request - multi selection (#778)\nVim is also able to paste rectangles anywhere (before inserting the new text, it deletes currently selected text if any, but the pasted section does not care about the shape of the selection it replaces). The behavior I see is, paste the first line of the clipboard as if it was pasted normally, and then paste all the other lines of the clipboard relatively to the first pasted line. For multi-selections that happen to be rectangular, it happens as follows in Vim:\n```\ncopy this:\na b\nc d\npaste into this (with cursor on or just after J):\nE F G H\nI J K L\nM N O P\nresult:\nE F G H\nI J a b K L\nM N c d O P\nedge case when you paste off limits:\nE F G H\nI J K L\nM N O P a b\n        c d\n(new lines and white spaces are spanned as necessary)\n```\nI don't see why having a \"multi-cusor-sublime-ace model\" would cause trouble implementing rectangular pasting. The Emacs behavior you described sounds to me like:\n1. delete previously selected text\n2. insert all ranges in the clipboard relatively to the pasting position\nDoes Emacs fit the pasted rectangular text into selected rectangle if their dimensions are different? Maybe that would be a little more tricky.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror/issues/778#issuecomment-10950928\n. ",
    "mightyguava": "I would think any operations on selections would operate on all ranges in all selections, individually. What exactly is the benefit of multiple single range selections over a single multi-range selection?\nvim.js's internals are probably (I am too inept in C++ to verify) completely different from Vim's implementation. There wouldn't be much difference to vim.js whether we use multiple single range selections or one multi-range selection. \n. I'd be happy to add automated tests (when I get the time). How do you feel about pulling in a testing framework like QUnit or Junit? I see the framework you implemented for testing. It's really cool actually. But I don't see why not to use an existing established framework. It won't impact CodeMirror's dependencies if it's only used for testing.\nNot sure if you get notified on closed pull requests, so tagging you @marijnh\n. First, I think this CL is great and it should be merged immediately (assuming there are no regressions :). But I would like to propose limiting changes to this class and do a rewrite for instead, reasons being:\n1. Configurable keymaps is an important part of vim. The current approach (hard-coded prefixes and \"mini-keymaps\" inside the vim keymap) is not maintainable and is inherently incompatible with configurable keymaps. It would be best to separate key mapping and motion/action functions.\n2. I really like how you have refactored motions into a map of keys to function calls with no logic in the map. But like the last point, it would be better if this was more configurable.\n3. Switching between keymaps (or really actions like yank and delete, or insert mode) is pretty ad-hoc here. It doesn't reflect how Vim is meant to work and will only get more confusing as we add more features. For example, for visual mode, are we going to have to create a prefix 'vim-prefix-v' and redefine behavior for each key?\n4. We need to store an explicit internal state in Vim for the sake of sanity and code maintenance, and so new code doesn't end up breaking existing behavior.\nI started a separate keymap at https://github.com/mightyguava/CodeMirror/blob/master/keymap/vim2.js currently with only hjkl, 0$^, d, and repeats implemented. The approach heavily borrows from the Vintage python implementation for Sublime Text 2 https://github.com/sublimehq/Vintage. The Vim class adds a layer of indirection between CodeMirror's keymap and its own keymap, so all key handling is done inside Vim. Vim's internal keymap is just a map of key presses to config objects rather than functions. There's also explicit differences between motion commands and action commands, with plans to add others that combine action and motion.\nThe code is still pretty hacked together at the moment and visual mode is quite a ways off but this should make implementing visual mode quite a bit easier. Porting over the existing functionality should be pretty quick once a framework is settled on. Let me know what you think.\n. Fair enough. There is never enough time to do the things that we want to do. I will continue porting over features/functions from here and try to match its functionality. Good luck on implementing visual mode! And if you ever have free time hope you can help me port some things over too.\n. Thanks for the comments! Looks like priority-wise for me, key-to-key mapping first and then move on to visual mode. Will wait for more comments here before trying to decide on whether to merge. If anyone can help this reach feature parity or add other improvements please feel free to. I'd really appreciate it.\nReplies to @jankeromnes\n- Arrow navigation - as stated above, I plan to implement this with a user configurable key-to-key mapping. Map arrow keys to hjkl. Same for backspace, space, ctrl-n, ctrl-p, etc.\n- Didn't know Y, D can repeat. Will add\n- The current implementation's \":\" only supports line numbers, which is covered by gg and G. I felt Ex mode would be a step after visual mode.\n- Support for marks: I saw the map for marks in the existing code but couldn't get it to work. Just investigated a bit and the existing mark implementation has yankTillMark and deleteTillMark (without the prefix \" or `), while the new implementation implements it as an orthogonal motion. Also, still can't figure out how to activate them in the existing implementation.\n- Verbosity: Yep the code is longer, but for good reason. I avoided long one-liners and added { } and line breaks for most control conditions, which expands the code a lot but the gain in readability is more important. New code respects an 80 char limit with the exception of the key maps. The register implementation is also almost 100 lines.\n. Alright repetition on Y and D are done, arrow keys and more are mapped. Repeat on insert mode is hard because it would require Vim to hook into CodeMirror's keyhandling, or have Vim take over insert mode. Neither sounds like a good approach. I could probably do * and / if that'll get your vote to merge :)\n. Re: @mattsacks \n1. The implementation has nearly reached feature parity, with many improvements, and it is quite an exaggeration to call it halfway. I completely agree that it is bad to replace the current code with something that doesn't have full feature parity, but please understand that my time is limited and I have been doing this by myself, working on what I thought was most important. A large part of the reason why this pull request exists is to ask for comments on what is important and what should be done before replacing the existing implementation. Another part is to ask for your help!\n2. I haven't been able to figure out how to trigger marks in the current implementation, even with some cursory investigation of the code, so I assumed it was not functional. It's quite possible that I may just not know about another way to use it? Please let me know so I can add the functionality.\n3. I have been implementing in the order here: http://whileimautomaton.net/2008/11/vimm3/operator, which lists text objects last. I have also never used it in the years I used Vim. Maybe I'm missing out. Will attempt to port over the code in the current implementation, but will not attempt a rewrite until after visual mode if it's not compatible. Also, anyone is free to contribute on what they feel is important.\nAbout the implementation:\n1. Wrapping it into the 80 char limit sounds good (might actually go with 100 char). That's what I originally had but it ended up getting harder to parse than keeping each entry on a single line.\n2. As for keyToKeyMapping, I originally planned to do what you wrote, but keeping a single map ended up being much simpler and I couldn't convince myself to implement arrow keys, etc, without some kind of key to key mapping. A full mapping system would come after text objects and visual mode, but I will definitely keep this in mind.\n3. Will split stuff onto new lines, got a bit lazy. I am completely against changing { return; } to return; however, pet peeve of mine? :)\n4. getRegister is a method on registerController, getMark is not implemented since I'm just storing handles to CodeMirror bookmarks. Could you clarify the benefits of exposing getMark and getRegister to the keyMap?\nThank you very much for reading the code over. I realize it is very long, but hopefully it wasn't difficult reading (that was the whole point of reimplementing). I will work on the key points you brought up.\nI'm fine with getting rid of use 'strict';, but I'd like some kind of automated code style enforcement. Maybe adding JSLint to the Travis build?\n. Oops was trying to post a comment. Chose 80 char line limit in the end because that way I can fit a 3 way merge on my screen. Also can fit 2 files side-by-side on my laptop, which is very convenient. 100 is just a bit too long.\n. Text objects have been ported over. Found tons of bugs while testing, but the only new one is a cursor jumping bug when I try da{ on the entire function block in vim2.html. Everything in the trace looks right up to the operation() function in CodeMirror. It seems like CodeMirror is adding 2 extra spaces after deletion. Anyways don't think it's a huge issue and will probably investigate more after visual mode. @marijnh do you know why the Chrome debugger can't step out of the operation function?\nAlso implemented Ctrl-f and Ctrl-b, though I would really prefer if there was a way to get a page down position without actually moving the cursor, so I don't have to do the ugly hack I have now.\nFeature parity has been reached!\n. Thanks for testing this @xLanny \nI added [cyd][ai]W, but the off-by-one error is still there for inner words (and also reproduces in the old implementation). The problem is probably that the \"inclusive\" option does not behave correctly. It should get fixed automatically if text objects triggers are rewritten to use the same keyMap system as the rest of file uses. I practically did a copy and paste from the old implementation on this and had the not had the time to rewrite. It wouldn't be a hard fix if you change inclusion in the text objects, but a better fix would be to move to the defaultKeyMap. I have comments in the file if you are interested and have time. If not then a quick fix is fine too and I will do the rewrite after figuring out visual mode. Thanks for volunteering!\nThe remaining things you mentioned are preserved from the existing behavior, with the exception of ex mode. I left it out on purpose because I haven't thought of a good way to handle ex mode mappings yet and how to properly process ex mode commands. This should probably be a longer discussion, so maybe we can move that into a separate issue? Not sure what the standard way to separate out topics of discussion on GitHub is.\nFinally, here's a summary of text object bugs found so far. All but the cursor jumping are carried over from the old implementation:\n- No repeats on word objects\n- Off-by-1 error when operating on i[wW]\n- [cyd][ai]w does not properly expand backward when symbols are matched rather than alphanumerics\n- Exception is thrown if [cyd][ai][[{(] is triggered outside the scope of the outermost brace\n- ]}) are not implemented\n- Tag text object is not implemented\n- Cursor jumping when doing ca{ on the function scope braces on the demo page (I was unable to track this down, cursor positions look fine up to control is given back to CodeMirror, and no other operations are triggered on the Vim side)\n. A basic, mostly functional visual mode has been implemented! I have to say, it's pretty cool.\n. Tuned visual mode and implemented visual line mode. Not going to try to implement blockwise visual mode since there's no blockwise selection in CodeMirror.\n. Are there objections toward replacing the old Vim that I haven't covered?\n. I agree visual mode isn't perfect. There are many many more features in Vim, and including quite a few things in visual mode, that I haven't gotten to yet. I will try to cover the more important ones over time.\nThe off-by-1 error was actually because I forgot to turn on \"showCursorWhenSelecting\", so the fat cursor wasn't showing up. The fat-cursor in CodeMirror always shows on the character after the current cursor index. In Vim's visual mode, the fat-cursor shows on the character at the current cursor index. So what the Vim keymap does is always include the character after the cursor, even though it's not in the selection. It should feel natural now.\nD, X, and Y are fixed.\nThe Ctrl-[ behavior change has been integrated.\n. I replaced vim.js with vim2.js. It seemed the consensus was that we didn't want 2 alternate implementations at the same time, which is why I tried so hard to reach feature parity. I moved it over now since it seemed ready for merging.\n. I'm going to be adding more unit tests over the next few days, but won't be doing a test drive due to the obvious conflict of interest... I also welcome anyone to test and find/fix bugs.\n. Accounted for #1010, replied to #1011.\n. D in the new implementation should, in normal mode, delete to end of line, and is repeatable. In visual mode, it should delete the entire selection linewise, and is not repeatable.\n. In Vim, the extra character at the end of the line can be enabled with virtualedit=onemore. This feels more natural to me than stopping on the last character, so I decided to do it this way in CodeMirror. It also happens to be the much easier thing to do because CodeMirror's cursor indices do go 1 past the end of the character, as viewed with a fat cursor.\n. I totally agree it should made an option. This is really a matter of personal preference. A quick search of popular vimrc files on Google turns up virtualmode = none,all,onemore etc.\nRegarding the default behavior, I think onemore should be the default because it would be more natural for someone who is new to Vim. This is actually one of the things that kept me from moving to Vim years ago. Any Vim pro should know how to turn it off.\nThat said, please don't block the reimplementation on this issue. It is not a regression. Let's get that through and then tackle this.\n. I think this is fixed by https://github.com/marijnh/CodeMirror/pull/1036. @aeosynth could you verify? Option to change the default hasn't yet been implemented though.\n. CodeMirror does not allow placement of the cursor past the end of the line as far as I know. There hasn't been enough demand for making it possible to do so but it could be a useful feature.\n. I can be reached at mightyguava@gmail.com\nI could explicitly list out the keys that are bound and return null immediately, but I think it would actually end up adding cruft. Is there any other reason you want to make the codemirror facing bindings explicit? Some more details below:\nIt's true that a lot of the Ctrl key mappings don't do anything, but everything else should have bindings (f work on any character). I can have the keymap function return null for unbound keys but it would still need to execute the command matching function to figure out if the key is bound. There wouldn't be a performance benefit and nofallthrough is set so it shouldn't make a behavior difference.\nAs for cruft, I'm not sure how far you dug into the code, so I will err on the side of caution. The new vim keymap implementation  maintains an internal set of keymaps distinct from CodeMirror's keymaps, removing the need for multiple versions of keymaps for handling different prefixes. It can map sequences of keys, like 'g~', 'f=', and '2g~3g~'. Binding as many keys as possible on CodeMirror and then letting vim figure out if it's needed makes it much easier to extend behavior.\n. I agree that part of the code's pretty ugly. I'll see if I can clean it up the next time I have to add a binding on CodeMirror.\n. This didn't break A, it was already broken :p. I did not read the vim documentation when I implemented A. I thought it was similar to X, but it actually behaves more like D. A quick change on the defaultKeyMap should sort this out.\n. Ah my mistake, this does break A, I did implement it properly originally... Sorry, fixing now\n. Not broken by c674f74. Existing bug. Should be a quick fix.\nEdit: My bad, I was looking at a wrong version. You are right.\n. Hmm was hoping to make this and #1018 separate commits since #1018 is a fix for a specific regression, but that doesn't work so well with merging. If you want to merge just this one that's fine. Otherwise please merge the other one first and I'll rebase this branch after. Thanks!\n. Looks great, thanks for adding unit tests! I don't think setting it to Infinity will be a problem.\nSo I actually messed up $ a while back and fixed all but one issue. Since this pull request is closely related, would you mind adding a motionArgs with inclusive: true to $'s definition on the keymap? Otherwise using operators with $ will skip the last character on the line.\n. Thanks! Please see my reply on the code comment.\n. Why don't we pull this in as-is and do the stickyHPos in a different change. I'm refactoring a bit of the state logic while implementing search so it would cause a rather nasty merge conflict anyways.\n. Just noticed, this should probably get merged into master instead of v3, or both it that works. Not sure how github handles these things.\n. I like that idea. We could defer to matchbrackets.js when findMatchingBracket is available and use vim.js's if it's not. The issue is that matchbracket is only available in v3 and I'd like to keep improvements in v2 with vim.js. Is it only the \"cursorActivity\" event what makes it need to be a v3 util?\nI wouldn't mind overwriting vim.js's implementation either (assuming we can get it into v2), matchbracket.js looks to be strictly better. Forcing people to pull in a 60 line file to enable bracket matching doesn't sound too bad.\n. The brace matching issues mentioned should have been fixed by @lynschinzer's fix above. @siefkenj would you mind verifying and closing?\n. Ah I lost track of this issue. Actually, blockwise selection is mostly done. Just working out the bugs now. Try it out at http://codemirror.net/demo/vim.html\n. Yes, that's being fixed in https://github.com/marijnh/CodeMirror/pull/2751\n. I am planning to work on :, but cleaning up text objects and braces will take priority since they are already in the code. I'm also planning to add customizable key mappings via a config object for these cases. I forgot that ,/ was a personal key mapping, but for now being able to clear the highlights at all is more important than matching vim defaults.\n. Since you are doing style cleanup, I'm going to be picky. Did this all come out of jsHint? I ran jsLint before submitting the rewrite and there was only 1 warning. Isn't jsHint supposed to be less opinionated?\nAlso, this seems to be breaking t and T according to the automatic build. Could you do some manual testing as well?\n. I keep a patch file around locally for it. There isn't a way to only run vim tests otherwise. I originally planned to have a separate vim test file but I wasn't sure how Travis worked and wanted automatic testing on it. Now that I think about it, since all the tests are in vim_test.js, it would be quick to add a test/vim.html that runs just vim tests, while test/index.html runs all tests. @marijnh would you be ok with that?\nFeel free to patch this in: https://github.com/mightyguava/CodeMirror/commit/00633340b0c2a0883b3e2c6c3dc490d5c4fe22de , just remember to revert it before submitting :)\n. The convention in codemirror's codebase seems to be named functions, so I tried to respect that. If there are any (I'm out right now) functions using var foo = function, feel free to change those. Either I did them out of habit or they were copied from the old implementation.  \nI defer to @marijnh if he has different opinions.  \n\nMight Guava\nSent with Sparrow (http://www.sparrowmailapp.com/?sig)\nOn Sunday, December 2, 2012 at 6:38 PM, siefkenj wrote:\n\nWhile we're on the topic of cleanup, what is the consensus of named function defined out of top-level scope vs var = anonymous function? It seems most of the utility functions are defined as named functions.\n\u2014\nReply to this email directly or view it on GitHub (https://github.com/marijnh/CodeMirror/pull/1036#issuecomment-10937399).\n. The change to get rid of min/max looks great! Thank you for bearing with my nitpicks. I really appreciate the time you took to clean up the code.\n. Ha sorry I was going to clean up search after it got merged since I had already implemented it and trying to jsHint the file would probably get me multiple conflicts with yours. I'll do another cleanup sweep tonight if you don't get to it first.\n. This breaks search highlighting in v2. Any way to have 1 fix that will make both versions work?\n\nIf not, could this be held off for a while and then be patched to only v3? There's a bunch of code cleanup for vim.js being done right now that may cause conflicts if vim.js diverges.\n. @siefkenj proposed a potentially large refactoring here https://github.com/marijnh/CodeMirror/pull/1036#commitcomment-2240938. I haven't had time to look into whether it should be done yet but it might result in reordering/reindenting quite a few things. Reindenting always causes merge conflicts\nEdit: then again, this would be a tiny and obvious merge conflict if it happens. So if you don't mind resolving it if it ever comes up, then I have no complaints :)\n. Sounds good. The conflicts should be tiny.\nI don't want to abandon master just yet. master vs v3 have minimal difference to vim.js, so it doesn't really hinder development. When we start getting more conflicts then that would be the time to \"take the plunge\". Glad to see v3 going to stable though.\n. Appears to be merged. Thanks!\n. There's may be a small merge conflict in v3 here because of the divergence in how className is set on the marked text. Please take care merging. I don't plan to touch the mark setting code again any time soon so it shouldn't happen again.\n. That sounds great! I agree that an interface for adding and removing wrapper modes would be the best solution.\nRebased to master to get rid of all the comments carried over from the version upgrade.\n. Very cool implementation of overlays. Updated my patch with the new feature.\n. This is a limitation of dialog.js. Vim doesn't have any control over it after calling openDialog and these keys aren't mapped. dialog.js doesn't allow additional key mappings to be registered. Anyone want to take this on?\nI think it would be cool if we could make dialog.js open a small CodeMirror instance that looks like a dialog. Then we would be able to hook in features that would make the dialog more vim-like, and implement 'Up' for search/ex history. I'm not sure what would happen when we nest CodeMirror instances in the DOM though. @marijnh what do you think?\n. I had thought that refactoring the key handling would be much more difficult. If refactoring makes sense, I agree it would be a much better solution.\nThere are several Ex commands I want to implement, like search/replace, before tackling this (history would only be useful if there were things to look up in it). I'll take a look into the refactoring another time.\n. @marijnh I may take on this refactoring and improving the dialog over the next few weeks. But before that a couple of questions:\n1. Do you have any hints/suggestions on how to do the refactoring and anything to watch out for? Event handling logic is always rather tricky and I'd rather not break CodeMirror completely.\n2. Would you like event handling be added as an option (as a part of the options map?) to dialog.js, or keep it lightweight and create an alternate file that exports the same interface?\n. Initial attempt to factor out the key handling logic at https://github.com/mightyguava/CodeMirror/commit/06670a935d1f992a07195ebfef9dd48c1ec623f6. There were a few very codemirror specific bits nested inside the core keyhandling logic that I had to work around. The code seems a bit ugly, but is (hopefully) functionally equivalent to before the refactoring, with the addition of a createKeyHandler() function. Please take a look before I attempt to finish this up.\nI wasn't sure how to handle the /^go[A-Z]/ commands. I'd appreciate suggestions on that. Feel free to bring up other issues. Thanks.\n. Thanks for catching that. Fix in https://github.com/marijnh/CodeMirror/pull/1078.\nWhat do you think about mapping ; to : by default? It's an extremely common mapping. I thought about doing this in the original pull request but didn't know if I would get strong feedback from Vim purists.\n. I don't think there was a consensus reached in the virtualedit=onemore debate. @aeosynth and @marijnh were for vim defaults; @jankeromnes and I were OK with either as long as there was an option. I did not have strong opinions about that specifically so I did not argue it further.\nI do strongly feel that mapping ; to : should be a default. This is a huge time saver that I honestly believe everyone should do, but a lot of people simply don't know how to. I just brought it up today with a few people who didn't know about it and they pretty much said wow. Most proficient Vim users I know have it mapped. Also, ; doesn't do anything in the reimplementation and it doesn't seem like anyone cares enough to implement its default Vim behavior, so mapping it has no downside.\nI'm not second guessing vim here, I am suggesting improvements to Vi IMproved. Why shouldn't we consider improving Vim by adding the most commonly used and most useful mappings as defaults? Vim wouldn't be nearly as popular as it is today if it didn't attempt to improve on Vi. It went through heavy criticism for second guessing Vi, and it succeeded. Why can't we propose adding improvements to Vim in a next-gen editor like CodeMirror?\n@aeosynth The only personal binding I have in the source is one that there is currently no alternative mapping for because no one has yet made it possible to have an alternative mapping. If you take some time to look at the code, you would see it's still not possible. I would not have added it if I there was a way to customize it. Anyone's free to implement :noh though and I'd happy to remove ,/ when that's done.\n. @marijnh I disagree about the awkwardness of the mapping, but I greatly respect your opinion as the creator and owner of CodeMirror and will not push the issue further. I'll continue to stick to just the Vim documented features in future contributions, though please excuse the occasional workaround.\n. @clausreinke Glad to see appreciation for the Vim mode :) Please do feel free to suggest features. I have a long list of things to do but it's hard to prioritize. While I haven't actually been working to match Ace (didn't know about Ace till I started reimplementing the keymap here), the new Vim keymap should already have surpassed the Ace keymap in terms of functionality and expected behavior (definitely let me know if it hasn't). It's a good time to figure out what to work on next. I'm thinking :substitute\n. Could you merge this into v2 too? It is a bugfix.\n. Took a pass through the code. Overall I really like it. Here's some initial comments (I'm quite nitpicky :)\n- selChange() mostly looks good. I'm in agreement with your approach. Will take a deeper look when you make the actual pull request. One suggestion I have is that the logic may read better and be more compact if you switch the order of the conditionals, i.e. make the outer conditional if (!cursorEqual(sel.head, sel.anchor).\n- I agree that it is confusing to use the cursor as an extension of selection looking at this as a dev, but it is intuitive to me as a user. I initially tried what you are doing now (by extending the actual selection and turning off the cursor), but you no longer see where head is. I would prefer not to change this unless you find a way to highlight head. Maybe by setting a textmarker with a CSS class that follows vim.selHead and pretends to be a cursor?\n  - If you kept the cursor instead of extending the selection, I don't think you would have to maintain separate vim.head and vim.selHead? Minor enough though.\n- b is pretty broken in visual mode, and ge is a little buggy too. Didn't look into the cause but might be a bug when head crosses over anchor? I'm sorry to say that there are practically no tests for visual mode so a lot of regressions won't be caught, and the negligence is now coming back to bite. It would be great if you could add tests. I think with a bit of thought, it would be possible to make most of the existing motion tests double as visual mode tests.\n- The selection can now extend 1 character past the end of line, which causes some quirkiness in vertical movement.\n- I originally kept vim separate from cm not because it was not guaranteed to be created (getVimState() is called first thing in handleKey, the real entrypoint to vim.js), but that I wanted to abstract hide that vim is a property of cm. The passing around of vim is so that if someday I got around to adding a way to define custom actions/motions/operators they would have access to it. I am open to changes on this if you have better suggestions that would not detract from the above, but let that be in a separate change and focus on visual mode here.\n- Some style nits: please put { } and line breaks around even trivial conditionals, reasonable spacing around expressions, '' instead of \"\" for strings for easy searching, as respected by the rest of the file. A consistent style makes the code oh so much easier to read.\n- Could you split the changes to d and D and text object manipulation into a separate branch? It should be straightforward with git add -p.\n. > Unfortunately I don't have any idea if there is a clean way to do this. @marijnh maybe you can think of something to show a cursor at a custom location without invasive changes to CodeMirror itself?\nI didn't notice those inconsistences before. Thanks for pointing them out.\nI don't think using cm.markText() is an invasive change. I was thinking that you would maintain a TextMarker object (separate from the vim marks) that follows selHead, update it in selChange, and add a small CSS class (or use the fat cursor's) for the mark in codemirror.css. While not ideal, it would be ok if the cursor didn't blink in visual mode.\n\nHow about having vim.cm store a pointer to the parent object and pass around vim instead of cm?\n\nThat does sound good, but would that create a circular reference, which may cause garbage collection problems trying to dispose of cm? I am not experienced with Javascript memory. @marijnh do you have any suggestions on a good way to have an abstraction between vim and cm state yet link one to the other? I thought about maintaining a map of cm => vim in vim.js but wasn't sure if that would end up causing garbage collection issues als well.\n\nAs for d and D this would be difficult\n\nSounds good, leave it in. It's just a nit.\n. > What is wrong with just storing it as a property of the CM instance?\nNothing wrong with storing it that way. I don't want it to be directly accessed that way since it's a private property. Rethinking it though, it's fine to let the client just break if they play around with the state. So @metatheos feel free to get rid of vim passing, preferably in a separate branch.\n. Sorry, I'm still mostly coding in v2 and had to cherry-pick the fix.\n. That's quite a bug... Thanks for fixing!\n@marijnh looks good to me.\n. Your code looks great overall, just have a few nitpicks in the line comments above and the question below\nWhy are you using 3 pixels for moving lines? Is that going to work if the user increases the font size to something ridiculous?\nI think a function that sets to/from and head/anchor separately would be fine, as long as CodeMirror is able to handle it properly. The weird way it's done now is because CodeMirror v2's selection model wouldn't work well at all with what you are trying to do (I think), but we are on v3 now.\n. Well, I'm seeing that typing 'r ' replaces the current character with the word 'Space', which is definitely a bug. I don't understand what you mean by using 'r ' to split lines though. Could you provide a more concrete example?\n. Got it, github is stripping out your <Enter>, you should enclose it with backticks. So you are saying r<Enter> should replace the current character with \\n. I agree and I think I have an idea of how to fix that.\nBut could you type out again the key sequence that results in\nhello\niorld\nDoing r<Enter>i would get me helloEnterworld, with the cursor before the E, in insert mode. No newline is inserted.\n. @metatheos Awesome! I was planning to tackle this today but you got to it first :) You may need to special case <CR> in the replace motion, since you'll probably want to use newlineAndIndentContinueComment to make the newline instead of \\n\nYes... visual mode handling is quite inelegant since CodeMirror's selection model is a little bit different from what would be expected of Vim. I believe I added a hack to include the last character in visual mode here https://github.com/metatheos/CodeMirror/blob/58e56150cb750840ddb27ed89a46c2d61819ef9e/keymap/vim.js#L875. Is it not working for you?\nI also thought you were planning in https://github.com/marijnh/CodeMirror/pull/1235#issuecomment-13551933 to keep a separate selection model and emulate CodeMirror selections with setSelection, which can go a long way to make this better. Or is that for later?\n. This is fixed by the above change by @metatheos. Please verify and close.\n. Sorry for the delay. I was away for the long weekend. The new visual mode looks vastly superior to the previous version. Thanks!\nIf you want to merge moveByLinesToFirstNonWhiteSpaceCharacter, I suggest merging with moveByLines instead, and add an additional argument for which character the cursor lands on the line. It would also make a bit more structural sense and probably less duplication.\nRegarding the custom selection function. I strongly agree that that changing CodeMirror's internal state here is bad. A rule I followed implementing vim.js was to not change CodeMirror's internal state in any way. This made some parts of the logic a bit convoluted, but let vim.js be much more future proof. As you said, a better solution would be to refactor CodeMirror's selection API a bit to make it work for the vim use case. Maybe changing setSelection to accept a sel object with anchor, head, from, and to? Defer to @marijnh here.\n. > Now I feel stupid. I'll do just that. Any idea how I could improve the handling of 0-based repeat on _, while I'm at it? I don't like how I introduce motionArgs.repeatOffset just for that.\nSorry, don't have a better idea. I find _ weird by itself, and don't see how you could not special case it.\n\nAlso: would you mind if I rename textObjectManipulation to textObjectRange and invert its inclusive-parameter, renaming it to inner? I found these names rather confusing as they are.\n\nSure. The text object manipulation motion is a bad hack I threw in to carry over the functionality from the original vim.js implementation. Any changes to clean it up is fine by me.\n\nAs for the detection for mouse interaction, I've restored that for now, but I hope I can take a stab at solving #1084 the way @marijnh suggests soon. This might result in some tools to handle various mouse-related issues and also help with solving #1038.\n\nSounds great. I didn't do it earlier because the fix would be v3 specific and somewhat involved. At this point, keeping vim.js v2 compatible is moot.\n. If it would be safe to modify sel.from and sel.to in a beforeSelectionChange event, without changing sel.anchor and sel.head, then I agree it could make for a great solution.\n\nAs for the merge it depends on whether @mightyguava likes the current state and the way I implemented his suggestions. Especially he might not want the workaround of reimplementing setSelection() to stay in, which I would understand.\n\nAh didn't know you were waiting on me for this. If @marijnh will be adding beforeSelectionChange, then I would rather the code to emulate setSelection to not be merged. As I said before my concern is forward compatibility with possible future changes to CodeMirror's selection model (for example, multi selections https://github.com/marijnh/CodeMirror/issues/778). I don't mean to make it hard on you but I'd rather not chance breaking visual mode completely down the road. Thanks for bearing with me.\n. > and >> work for me in Firefox 19 on Mac. I'll try Linux when I get a chance tomorrow. Could you elaborate with:\n- The exact keys you hit\n- The expected result\n- The actual result\n> and < have the exact same code path and use cm.indentLine to perform indentation, so I can't understand why they would behave differently...\n. Thanks! Please see my comments inline in the file. And thanks for adding unit tests too.\nI see why you couldn't implement delmarks!... I overengineered the argument parsing here and ended up making it work nicely than if I had set up a few helper functions for doing the parsing. Will put reworking it on my list.\n. It's safe to assume that StringStream will always be loaded before vim.js. It is part of CodeMirror's core library. The exCommandDispatcher's command processing code uses it.\n. Wow you are fast. Looks good to me. Thanks again!\n. Thanks for the continued contributions! Here's a first round of comments:\n- Please avoid duplicating code. It would not be difficult to merge all this into 1 function and still make it readable.\n  - Use motionArgs.forward to specify direction\n  - Use motionArgs.linewise to specify move to line instead of character. You can then add an additional check at the end of the function and call findFirstNonWhiteSpaceCharacter() to get the first whitespace. linewise has the added benefit that it should make these actions compatible with operators.\n- Use cursorIsBefore() to check if the mark is before/after the current location.\n- Use cm.indexFromPos() to get an character index from the start of the document. This will make your distance comparison trivial.\n- It looks like these actions also support a count. This should be trivial to do by wrapping the function in a for loop.\n- Please test with an action too like d[', and add unit tests if it's not too much trouble.\n. I noticed that [' and ]' actually should go to the first non-whitespace character even if there are no marks set. There's also  a good bit more simplification that can be done. Take a look at https://github.com/mightyguava/CodeMirror/commit/4cd2b92b599c60e415491bf9de7a0953c04391bf\n. I had meant that that was the behavior I observed in VIM 7, and that is why I changed the code to do so.\n. Looking better! But this still has the bug that if there is a mark on the same line but to the left of the cursor position, [' will go to the first nonwhitespace character on the same line instead of a mark on the next line.\ni.e. if you have the following lines, where marks are characters surrounded by brackets.\n1abc[d]efg\n2abcd[e]fg\nIf your cursor is at the end of the second line, [' should move the cursor to 1, but it actually moves it to 2.\nThe behavior in VIM is to go to the next line with a marker.\n. Fully agree, looks good to me. Thanks for working through all my nits and for writing such thorough unit tests.\n. > Handle beforeChange/change-events. The advantage here is that it covers autocompletion and any kind of keyboard events you don't want to repeat. The disadvantage is that it needs to understand the change-events correctly and replicate them on an own buffer. And then there are motions you'll need to extract (and if q is supposed to repeat them, things get messy).\nI agree this would be the better approach and I started heading down it earlier, but I don't have the time right now to figure out how they can be pieced together inside a buffer. We'd also have to take into account deletion. Maybe @marijnh would have suggestions.\n. Took a look at the VIM documentation. It looks like Ctrl-U/D should not support repeat. The amount they are scrolled by is configured with the 'scroll' option. Unfortunately I haven't gotten around to adding options to the keymap.\nNevertheless I agree with @metatheos that you should not be touching the core for this. @metatheos's approach is a pretty good start. I would compute the number of lines equivalent to half a page (this might take a little work) and feed that value into moveByDisplayLines. No need for the if/else block since half-page is being used as the default; in the future when options are added we can just override the value.\n. Ah I see. I apologize for my confusion. I did not look at scroll and missed its special behavior. @metatheos's original suggestion sounds more right then, though for the default case of half page scrolling, the vertical offset needs to be restored too.\nPersonally I wouldn't mind if you go with @metatheos's second suggestion either as it would be much cleaner...\n. One of the considerations I had for a set Ex command is that we would need some kind of object to manage global and local options, both of which are settable at runtime. I think cm.setOption can only set document local options. Do we not have a need for global Vim options?\n. I think @metatheos's suggestions are reasonable. I will draft up a patch for it Monday if @dextius doesn't before then.\n. > I just wanted to help, sorry I didn't have the context needed to be of use.\nNp, glad to see enthusiasm about the keymap. Your change is small enough that I should be able to piece it together without too much work.\nCongrats on the baby!\n. https://github.com/mightyguava/CodeMirror/commit/8435720d42b013d6a11039360058ba12021a4040 implements custom scrolling in the fashion discussed with @metatheos. I also tweaked moveByDisplayLines a bit for edge cases. @marijnh let me know if I should open a separate pull request.\nI think there may also be a bug with cm.coordsChar. In an editor instance with a single wrapped line, calling cm.coordsChar(cm.charCoords(pos), 'div'), 'div') with pos being on the second row, I get the corresponding position on the first row. replacing 'div' with 'local' always gets me ch: 0, line: 0. Or it's quite possible I'm not using the arguments properly? Currently arbitrarily using an offset of 8 pixels to compensate in the commit.\n. I see what you are trying to do with the whitespace changes, but this is shared logic for # and * and seems to break the tests for # and *. Maybe instead of doing this, add in preceding whitespace in the text object manipulation logic after calling expandWordUnderCursor?\nAs for the var wordEnd = idx + wordAfterRegex[0].length - 1;, this was based on char index rather than bounds, so wordEnd is index of the last char, not the right bound for the word. I'm ok with this change except that you'll need to remove the + 1 in var query = cm.getLine(word.start.line).substring(word.start.ch, word.end.ch + 1); in the search logic. Please test for additional breakages.\n. You should be using getVimGlobalState() and saving the last character search there instead of the per editor vim object. Otherwise ; and , will not work across editor instances.\nEverything else looks good though. Thanks for the contribution.\n. Looks good to me. Thanks for adding unit tests! @marijnh please merge when you get a chance.\n. Great, thanks for the continued contributions.\nGithub crashed as I was looking at it and is still down\u2026 but here's some comments for what I managed to catch\n- cm.getTokenAt() relies on the mode identifying the number for you. This won't work if (1) there's no mode set, (2) the mode doesn't assign numbers the 'number' type, (3) the number is part of another token, like a function or variable name.\n- Ctrl+A/X in vim should seek for the next number on the line and move to it.\nI would reuse the logic in expandWordUnderCursor. It should only take a small amount of refactoring to make it able to search for numbers.  \n\nYunchi Luo\nSent with Sparrow (http://www.sparrowmailapp.com/?sig)\nOn Tuesday, April 9, 2013 at 4:08 AM, Lin wrote:\n\n@mightguava, please have a check.\nAs soon as you approve it, I'll add some test cases for it.  \n\u2014\nReply to this email directly or view it on GitHub (https://github.com/marijnh/CodeMirror/pull/1444#issuecomment-16099571).\n. > Btw, as far as I can see, the inclusive part of expandWordUnderCursor() doesn't seem to work properly.\nWhen a user performs a diw on the word \" lisp \",\n\nYou are exactly right. The text object manipulation code is very buggy and I have not had time to fix it. I carried it over from the previous implementation of the mappings at the strong urging of contributors, but have had the time nor interest in fixing it. If you dig up the original pull request I made for this version of the keymap you will find a somewhat comprehensive list of problems. expandWordUnderCursor's main purpose is for use with * and / and is hacked a bit for text objects.\n. Looks great. Fine to merge after you address my last few comments. Would you mind adding unit tests for the seeking/backtracking behavior? Thanks.\n. Oh I should have looked closer. Didn't see that backtracking was disabled by default. You are right to leave it disabled. Testing the seek forward behavior would be nice though, but I don't mind too much.\n. Nope, looks great. Thanks for doing due diligence with the tests. @marijnh Please merge when you get a chance.\n. I don't like that you are changing a value on motionArgs inside the motion and then expecting the caller to do something different based on the changed value. It is fragile since the caller, evalInput, may at some time check inclusive before the motion is called and break this behavior.\nThat said, your unit tests should catch it :) and I don't immediately see a better way of doing this so let's go with what you have.\n. I think it's poor communication on my part rather than lack of understanding on your part, but I will try to explain clearer. evalInput is the function that calls individual motions in the main flow of execution, and handles inclusive after the motion finishes by shifting the resulting indices.\nCurrently the logic you have is correct because evalInput always checks inclusive after executing the motion. I'm concerned that this introduces an indirect dependency on the ordering. evalInput may get modified in the future to check motionArgs.inclusive before calling the motion, expecting it not to change throughout its execution.\nA possibly better way of doing this would be to call evalInput, temporarily replacing the value of vim.inputState with one you construct in repeatLastCharcterSearch. This is similar to what's done in repeatLastEdit. However there's some hackery in that too so I'm not really sure if it's better. Please don't feel obliged change this, it's not too important.\n. > Here's the first draft of HML motions, I've also attached a demo in case someone would like to try out (the demo is not intended to be merged).\nH, L motions actually support count. They are well documented at the bottom of the page here http://vimdoc.sourceforge.net/htmldoc/motion. If you want to first commit the subset of that functionality that you've already implemented I'm totally fine with that. Based on your previous commits though, you seem to value completion also so I'm bringing this up.\n\nAs usual, I'll need some comments from you guys.\nI have some doubts on how shall I handle the half-occluded lines on top and bottom.\nIn original Vim, the scrolling of text is line-wise, but in CodeMirror, the scrolling is pixel-wise. At the current draft, I'm handling it by setting some torlerance/threshold to determine whether the line is visible enough to the user. It's just a na\u00efve approach I could come up with.\n\nI'm no expert either with the scrolling here. I think the tolerance is fine, or not having the tolerance is also fine. This is subjective and should be better determined through usage.\n\nAnother thing to mention is that I've added getUserVisibleLines() to vimApi in order to allow users to reuse it from outer scopes. Do you think it's a good idea?\n\nI think this function is a great idea and it's something I've wanted for a while. My opinion though is that it should go in codemirror.js. I've been bad about merging in helpers I've written in the vim keymap but this seems like something that would be useful for a lot of things. @marijnh what do you think?\n. > I totally agreed. However, this proposal once being turned down by Marijn #1434 , and he kinda convinced me with his point of view.\nOk I think it would be good to have this function in vim.js, but what's your reasoning for exposing it on the vimApi?\n. Ah I see you are using it inside your demo. I don't think this is something that should be on vimApi since vimApi is meant to be used for controlling vim. getUserVisibleLines() would make more sense on codemirror, but since @marijnh feels it's too high level in the core, I agree with him that the alternative is for users should re-implement it.\n. In my opinion, if it goes anywhere, it should go in codemirror.js. Second option would be a collection of addon utils for codemirror. It doesn't look there's a place it fits in right now so I would assume @marijnh isn't interested in having one in the codemirror repo. I would suggest you just have a duplicate implementation in the application you use codemirror with. Or if you are feeling ambitious, start a repo for a set of codemirror util functions, if one doesn't already exist.\n. Looks good to me. @marijnh please merge.\n. Cool. I didn't take a very close look but I trust you to test thoroughly. I don't mind that ]m doesn't only operate on method level. It's quite possible Vim takes advantage of syntax mode parsing to figure this out, and I agree it's not worth your time to get it right at the moment. Please document the differences concisely in code comments.\n. Looks good to me. Thanks for making the changes. Any attempts to make the code conform better to the rest of vim.js makes it significantly easier for me and on other contributors to grasp the code.\n. Thanks for contributing to the Vim keymap!\nLooks good. Just 2 minor comments.\n1. Could you rename overwriteMode to replaceMode to better match vim naming?\n2. @marijnh toggleOverwriteMode doesn't appear to be part of the documented API. Is it safe to use here?\n. Good job finding the bug! The behavior is closer but I don't think it's still quite correct. VIM's behavior is that\n1. An empty line with no spaces is treated as a word\n2. An empty line with space is not treated as a word\nSo for case 1 below, from (0,0), w will move the cursor to (1,0)\nword1\\n\n\\n\n  word2\\n\nBut for 2 case below, from (0,0), w will move the cursor to (2,2)\nword1\\n\n     \\n\n   word2\\n\nWith your patch, w will move the cursor to (1,2). I'm not exactly sure what the right fix would be, but maybe instead of changing moveToWord, change findWord to treat empty lines as words would yield more accurate behavior?\n. Getting closer. These changes are breaking backwards motions b and ge unfortunately. Why don't you take a look at https://github.com/mightyguava/CodeMirror/commit/ac85ead0518d76b85348055550316abf28bdc43c. Let me know if that fixes your issue and then we can work on merging it.\nIf you want to try merging, apply it to a clean codemirror branch and merge in your unit tests and I think we have the results you wanted. \n. Hmm that you are special casing delete is actually making me think the approach isn't quite right. Yank and change are identical to delete, and chances are the special casing is missing other corner cases too.\nThe patch also seems to be messed up in terms of the history. Don't have much time right now so I'll take a closer look when I have a bit more time.\n. Patches provided in https://github.com/marijnh/CodeMirror/pull/1519 should fix the bugs exposed here. This pull request can be closed if that is merged.\n. I'd been hoping someone would take a serious crack at fixing text objects. This is one of the best patches I've seen so far. Great job and thanks for the unit tests!\nThe patch mostly looks good, except that I think you need to also consider words separated by multiple spaces? Your patch seems to only take into account single spaces.\n. Looks good to me. Thank you for taking the time to make these changes. I really appreciate your attention to detail. Lots of people will be happy to see these fixes :)\n. Cool feature. I didn't know about it.\nIt mostly looks good. In addition to the in-code comments above, I believe the jumplist commands should NOT be motions? i.e. the key sequence d, Ctrl-o should not be orthogonal and should not delete everything between the cursor and the previous position in the jumplist.\nChanging them to actions should fix the orthogonality problem. It looks like they also aren't supposed to work in visual mode, but it's not too important to match this, though it'd be nice as a future improvement.\n. This looks good to me. @marijnh please merge when @lynschinzer commits the unit tests. No need for another review from me.\nThanks for the continued contributions!\n. You are right, my bad. Thanks for the fix.\n. I vaguely remember that findMatchedSymbol has a few corner cases that can cause it to throw exceptions, and there was a plan to follow CodeMirror's matchbrackets code to do this https://github.com/marijnh/CodeMirror/issues/1031.\nDid you check corner cases? Deleting line 8 in the vim demo seems to cause brace seeking to completely fail.\n. Turns out it was a bug with the jumpList. I didn't check the exception before. Made a comment on the pull request.\nCan't pick out any corner cases at the moment. We can fix things as they come along if there are still issues.\nThe work mentioned in https://github.com/marijnh/CodeMirror/issues/1031 would still be useful so that vim can skip over braces in comments and quotes, if you are interested. Thanks for the continued contributions.\n. As much as VIM's behavior feels like a bug, let's conform to it as has been done previously when there were choices as to whether to diverge.\n. It would be best if defaultKeyMap was treated as immutable. There are a few things that need to be done before this set of changes.\n1. The default keymap needs to be made/copied into a per-instance map so that we can make local and global changes to the keymaps (or maybe have an instances of custom local/global keymaps in addition to default keymap).\n2. Make ex mode's set keymap behavior not write directly into default keymap\n3. I think a more appropriate way of setting options would be to implement set and setlocal like in Vim, as well as exposing a programmatic interface similar to cm.setOption.\nI've been meaning to do this for a long time but it'd be a big batch of changes and haven't found time to do so. Would you be OK with keeping the original, un-customizable behavior as the only option for now since it matches desktop VIM, and revert the last change?\n. Looks great. Thanks!\n. Looks good to me.\n. Not quite familiar with this CodeMirror scrolling. I think I mostly copied from a discussion on the google group for this.\n@marijnh would you mind reviewing this one? It scrolls the current cursor position to the top, center, or bottom of the page. No vim specific knowledge is needed.\n. Can't believe I forgot to test that case. Disadvantages of coding past 3am. Fixed. Let me know if you find any other issues.\n. Thanks for your continued contributions. I really appreciate the time and effort you spend on this.\nThis is a very ambitious change. I think we should discuss how this should be done and break the implementation into pieces. It's far too large of a change to do in 1 shot. I only played around with it for a few minutes and found several bugs in the behavior. Especially, the insert mode replay is quite buggy.\nIn my opinion, it doesn't make much sense to implement q with the keymap like this. It's not feasible to properly record insert mode behavior using vim as a \"keymap\". Rather it needs to use low-level hooks to CodeMirror's key event system, and possibly a way to mimic key event firings into CodeMirror.\nThat's not to say that I don't want this to be done. I think this is a great start and you made some great progress towards a working macro implementation. We just need to change the approach a bit.\nHere's what I'd like to see:\n1. You made some unrelated changes regarding the jumplist, enterInsertMode, and some renamings. Please make a pull request for these first so they don't clutter up the meat of the change.\n2. Split up the normal mode recording/replay and insert mode recording/replay into 2 separate changes. I'd prefer to see and review the normal mode changes first.\n3. After we polish up the normal mode changes, we can consider how to properly record changes made in insert mode. As I wrote above, this will probably involve changing the vim mode from a keymap to an editing mode that takes over key handling from CodeMirror. We may need to discuss with @marijnh when we get there too.\n. Re: recording in insert mode: @metatheos makes some good points about the advantages and disadvantages of 2 possible approaches here https://github.com/marijnh/CodeMirror/pull/1305.\n. I like @metatheos's approach to pure vim behavior, but the change event approach also has its advantages.\n1. Regarding capturing key events passed to vim-insert, it's really cool that you proved it works. However, I'm not convinced that it will work for all keys. The vimKeyMap you are using to create the lookup table does not attempt to capture all possible keys. It tries to capture all keys that matter to normal mode. You really should listen instead for lower level key events to capture all keys, and possibly using CodeMirror.keyName to decipher them.\n2. Relevant to the last point, keys in insert mode should not be viewed as keys, but as characters. We need to make sure that all unicode characters the user may enter are captured by the macro. A bit of experimenting with the event should reveal if and how this can be done with key events, or @marijnh may know off the top of his head\n3. In my opinion the main advantage to @metatheos's first approach is capturing cursor motion. Note though that this is not cursor motion caused by edits, we get that for free either way. This is cursor motion from arrow keys. While it's simple to record arrow keys using cursor events, I don't believe there's a good way of triggering arrow key events (Left, Ctrl-Left, etc) on CodeMirror in replay. Sure we could emulate them by calling relevant commands, but I think it would turn out fragile. @marijnh any thoughts?\n4. Addons that trigger programmatic edits, like the ones in addons/edit, autocomplete in addons/hint, would be incompatible with the key based approach, yet they are tremendously helpful in code editing. For autocomplete I believe even emulating key events on CodeMirror wouldn't work since it uses its own key handler.\nThere are probably other tradeoffs that I haven't considered, but these are the ones that are immediately obvious to me.\nVim's capture all keys approach works well because it has the lowest level hooks to the characters entered by the user, allowing it to completely emulate a user typing into the keyboard. We don't have that convenience here so we have to take pains to working around it.\nPriority-wise, 1 and 2 are crucial, 3 and 4 are nice-to-haves. I'm not sure if 3 is more important than 4. That completely depends on how useful cursor keys are in insert mode. I find that I generally don't have a use for them, so I consider 4 to be more important than 3. What do you think?\nIt just occurred to me that it may be possible to do a combination approach. Let all edits in insert mode be recorded by change events. Let all cursor movements be recorded by key events. This way you just have to specify arrow keys + modifier combinations in the keymap. Of course, feasibility of cursor movements still depends on how well we can emulate array keys in replay. A new interesting corner case to watch out for with this approach is shift-left and ctrl-shift-left, since depending on what the user does after, this may be a cursor motion or an edit.\n. Looks good. Nit: in general, prefer == over ===.\n. Looks good. Thanks.\n. First round of comments. This is open discussion, so feel free to push back against any of my comments:\n- @ should be repeatable\n- I really dislike duplicated logic. For @@, either simply merge it with replayMacro and add a special case for the @ character, or have replayLatestMacro call replayMacro with actionArgs.selectedCharacter set to registerName\n- Instead of having a conversion from normalModeKey to registerText, what do you think about changing usages of normalModeKey in the keymap so that normalModeKey == registerText? The changes shouldn't be extensive and saves a level of complexity\n- Regarding storing the keyBuffer in registers, I'm wondering if it makes sense here. I might be making a horrible suggestion here and any divergences I've suggested to Vim has invoked hostile reactions so far so I want your take on this.\n  - The benefit of converting to text is that in Vim, you can actually open a register as a buffer and modify the macro, generate macros dynamically, as well as persist macros in your startup script. All of the above don't seem like it will ever be a part of the Vim mode, short term or long term.\n  - If we don't convert to text, we save quite a bit of complexity. The serialization/deserialization logic doesn't need to exist. The macros also have no reason to coincide with registers. Thus we can maintain separate sets of registers and macro keybuffers (since making macros keys and paste buffers persist in the same location can be a source of confusion).\n\nThis part really took me some effort to let it work. I tried to take the low-level hook approach, but it seemed like I'll need to change a lot of code, so instead of changing I feel much safer with adding.\n\nI appreciate that you are very careful about not regressing, but the \"I feel much safer with adding\" line of thought is going to increase technical debt and make things harder down the line. The accrued technical debt is why I decided to scrap the orignal vim mode implementation and start from scratch.\n. > Enter -> \\n\n\nBackspace -> \\b\nTab -> \\t\n\nThe above 3 I would make <Enter>, <Backspace>, <Tab>. They do not directly translate to the escape sequences you specified. VIM uses special sequences to denote them as well, ^I for Tab and ^M^ forEnter`.\nWould you mind separating this set of changes into its own pull request as well, preceding this one? It would make it much easier on me to review and I'd really appreciate it.\n\nEither approach is fine with me, which one you see is more maintainable?\n\nGo with the approach you prefer. Going back to keyRegister shouldn't be too hard if needed as far as I can see. I think at this stage the textRegister approach is overengineering but since you have it coded up and working I don't see a good reason to revert that. Wanted to bring up the alternative thogh.\n\nSome times I fail to see some big ideas in terms of code quality and such, could you suggest me some trust-able reading materials for that?\n\nI think it's just something you end up picking up when you work on gigantic projects, but here's a couple references I found on the net. In my opinion, you are doing pretty well.\nhttp://salvetore.wordpress.com/2012/08/08/open-technical-debt/\nhttp://stackoverflow.com/a/162866\n. > Can it be more specific? Repeatable by @@ or .?\n\nIf it means @@, then I already have it implemented.\n\nSorry, I meant it should be repeatable with a count. 2@@ should run the macro twice.\n. > Seems like the only thing left is to delete normalModeKeyToTextToken and its call sites. Anything else I'm missing?\nSounds right. The buildLookup function would make more sense to have in the insert mode implementation if you weren't planning to remove it already.\n. Just a couple more nits. Thanks for following through with this.\n. Looks good to me. Thanks again.\n. Looks good except the comment above.\n. Looks good, thanks!\nBtw, before you start on coding up insertMode logging, it might be a good idea to write a short google doc with an implementation overview. This way we can agree on some details beforehand and can potentially save you from revising the approach later. Would be good for distilling your thoughts too. No pressure though, I'll be happy to just review a pull request too.\n. Great start. My comments are mostly superficial but make for better readability and sanity.\nNoticed a few bugs:\n- Ctrl-[ seems to be the only key that gets recorded exiting insert mode.\n- Errors are getting thrown in rawKeyEventToCmSpeicalKey on IME input. Using CodeMirror.keyName may or may not fix that.\n- Recording unicode isn't actually working on my mac. I held down u to activate the selection prompt, pressed 3 to enter \u00f9. On replay nothing was entered. Edit: Seems to work when I tested again. There's probably a subtle glitch somewhere.\nWhat exactly are you doing with the cursorActivity handler? Are you using the key event handler and the cursorActivity handler in combination to detect if the key caused a cursor movement?\n. > Exactly, or do you know of some other ways?\nI see. So you are only recording the key in the handler if the cursor moved and no edit was made? That is indeed better than my proposed approach of recording arrow keys specifically. I'm worried it might miss some keys, maybe paranoia.\nI'm curious how you handled the case I mentioned before about selecting text in insert mode. Suppose you press Shift-Left to select some text. You could press Left again to deselect everything. You could press Delete to delete it. How is this accounted for?\nTried a simple macro recording to demonstrate the last case: qaiaa<Shift-Left><Shift-Right><Ctrl-[>q. Pressing @a produced the text aLeftRighta. The expected result should have been aa.\nPersonally I'm a fan of doing things incrementally. Get change events and entering/exiting insert mode to work perfectly. Then get cursor movements to work perfectly. Then proceed to improving .. There are far too many corner cases to consider for a project like this and it's quite difficult to process them all at once.\nAre you under some time constraints? If not, I recommend breaking apart the code as before and scrutinizing and committing it incrementally. We'll end up with the best results that way. Going back and fixing bugs in this will be a painful experience otherwise.\n. > I'll be pretty busy from tomorrow on, yet I would like to break this mess into small pieces too, I can just do it with slow paces. What order would you suggest?\nI suggest this for the order of pull requests:\n1. Getting change events to work perfectly, completely ignoring cursor activity and key events. This would include the fake ESC in exitInsertMode, making sure IME input works, and removing the toString. Following what @marijnh wrote, I don't think you need to catch the Enter key. This would be the first pull request\n2. Getting cursorActivity handlers to work perfectly in insert mode. This is where I'd start adding the mess of key handling logic This would be the second pull request.\n3. Possibly a third pull request for fixing up bugs/style here and there.\n4. Integrating your work into .. There are actually a couple of bugs I noticed in the existing . implementation that should be fixed as well.\nFollowing the above, try to make the scope of your changes as narrow as possible. I.e. don't include key handling logic or the . register in the first pull request. This way we can both do thorough testing on the changes and make sure that there aren't gaping bugs.\n. Thanks for bring this to attention. There are a couple of minor issues with your patch.\n- dd on last line is not being pushed into the paste buffer correctly\n- does not fix dj on second last line.\n- I don't think your special case is needed. The vim keymap aborts if you try to delete past the last line, so it can't occur. This does not match vim behavior but is quite minor and is a separate issue.\nPlease see  https://github.com/mightyguava/CodeMirror/commit/33e5a4771ea50bc578fb0b11384987f99b0dfb2b for a corrected patch\n. Good to merge. Thanks\n. Thanks for the continued work. I was hoping that you would do insert mode for . after all the macro work was finished, but this doesn't look too large. Seems to be mostly correct, but the structure needs a bit more work.\n- Using lastEdit to store insertAt is rather bad practice. The small convenience it adds here for you will no doubt cause a lot of confusion to anyone reading the code. In general, it's very very bad to repurpose an existing variable for a different usage, with or without documentation. It's acceptable for the top level API on CodeMirror since it's well documented and adds a lot of convenience, but not OK for internal code here. The usage of suppressChanges is questionable too. An alternative:\n  - Remove the additional code in enterInsertMode (except registering the event).\n  - Clear lastInsertModeChanges in commandDispatcher.recordLastEdit\n  - Add a state variable inReplay to macroState to ignore changes in insert mode during macro or repeat edit replay. This makes suppressChanges obsolete.\n  - To make A,I,a,i,O,o work properly, I agree, some restructuring is needed. As a temporary hack, I suggest adding an isEdit: true for these actions in the keymap. Also add an actionCommand argument to recordLastEdit, to be saved as vim.lastEditActionCommand. In processAction, if isEdit is true, record the action and command. Then in repeatLastEdit, call processAction instead of evalInput if the lastEditactionCommand is set.\n  - In repeatLastEdit, instead of having a special section for isInsertModeChanges, leverage macroModeState.lastInsertModeChanges. If it is not empty, then trigger the insert. Something like the below.\nif (lastEdit) {\n          if (repeat && actionArgs.repeatIsExplicit) {\n            vim.lastEdit.repeatOverride = actionArgs.repeat;\n          }\n          var currentInputState = vim.inputState;\n          vim.inputState = vim.lastEdit;\n          if (vim.lastEditActionCommand) {\n            commandDispatcher.processAction(cm, vim, vim.lastEditActionCommand);\n          } else {\n            commandDispatcher.evalInput(cm, vim);\n          }\n          if (macroModeState.lastInsertModeChanages) {\n            repeatLastInsertModeChanges(cm, repeat, macroModeState);\n            return;\n          }\n          vim.inputState = currentInputState;\n        }\n- From a previous thread:\n\nFinally, it doesn't look like you are processing the next property on change objects. According to the documentation: \"If multiple changes happened during a single operation, the object will have a next property pointing to another change object (which may point to another, etc)\". I've managed to make it show up by pressing a key and then enter together very quickly.\n\nIf changeObj can be chained using the next property. You'll need to iterate through and process all of them. This is why auto-indent is currently not being captured.\n. It looks like this is caused by \"nofallthrough\", which vim sets to prevent random key presses in normal mode from inserting characters into the editor.\nIf handled = \"stop\" is returned from lookupKey(), handleCharBinding() will call preventDefault(). I'm not sure if this is intended behavior or an oversight. @marijnh? If it's intended behavior, then it'd be nice to have an additional option for a keymap to have \"nofallthrough\" behavior without preventDefault.\nWorks in Chrome because Chrome doesn't let you capture system shortcuts.  \n\nYunchi Luo\nSent with Sparrow (http://www.sparrowmailapp.com/?sig)\nOn Thursday, May 30, 2013 at 1:14 PM, Francis Reyes wrote:\n\nfor example in http://codemirror.net/demo/vim.html\nClicking in the code mirror window, and insert some text, press ESC.\nApple +T, Apple+N, Apple+W, etc doesn't add a new tab, open a new window, or close a window as expected.\nUsing Safari 6.0.3 (8536.28.10)\n\u2014\nReply to this email directly or view it on GitHub (https://github.com/marijnh/CodeMirror/issues/1558#issuecomment-18694958).\n. @marijnh thank you for the quick patch. Unfortunately disableInput does break vim mode. It should be possible to edit in normal mode. For example, pressing dw should delete a word, and then pressing p should paste the deleted word back in.\n\nIn VIM normal mode, text insertions from CodeMirror's hidden input should be disabled, but programmatic edits triggered by the keymap should still work. Is that doable?\n. Opened https://github.com/marijnh/CodeMirror/pull/1565 to address.\n. Yeah saw those events, they are probably useful, but been too swamped with other stuff.\nRe: inputRead: vim keymap checks for changeObj.origin == '+input' || changeObj.origin == 'paste' to determine whether it's user input. Is that the same as inputRead?\nRe: keyHandled: I think that can nicely replace the keyDown handler I'm using to record Delete and Backspace events in insert mode.\nNot directly related: I've been thinking about this for a while. How feasible/reasonable would it be to have a macro.js addon that allows you to record all keypresses + input on codemirror and then repeat them? As I've been implementing the feature for vim, it seemed less and less vim specific, and potentially useful to any power user.\n. @heppe finished the rest of the work :)\n. It doesn't look like @lynschinzer has time to help with testing in the short term, so @marijnh let's just merge? I'm working on the subsequent changes for executing macros now and will have followup pull requests soon.\n. Great thanks! The computation looks so concise the way you write it.\n. Thanks for the report. I will try to get to them after the macro stuff.\n. That would be great. I would be very careful and tackle the bugs one at a\ntime. There might be code that's relying on this set of behavior so fixing\none thing might break something else.\nOn Jun 18, 2013 11:27 AM, \"John Connor\" notifications@github.com wrote:\n\n@mightyguava https://github.com/mightyguava If you haven't already\nstarted, I'd be happy to take a look at fixing this.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/1612#issuecomment-19618748\n.\n. Looks good. Thanks for the cleanup.\n. Good question. I've been using lastLine in new code, but am not sure if that's the right thing to do. It would depend on how linked subviews behave when you delete/insert lines. I have never gotten around to experimenting.\n\nIf the linked subview shrinks/grows when you insert/delete lines, then I'd use lastLine. If its size stays constant, then I'd use lineCount. @marijnh will know this much better than I do.\n. The strange vim behavior you are referring to seems to apply to all of the operators from my testing. Can the bounds checks you added be inside evalInput? Just don't execute the operator if the checks match.\nAnd following from that, I think we should still clip the start & end cursors before passing them to the operator, just to make sure that no logic in vim.js breaks due to out of bounds.\n. Looks good, just a couple minor comments.\n. Agreed. We could probably register a drag handler (listening to 'drop' events) that's always active in normal & visual mode. It would catch the mouse selection events, updating both the visual mode status and <, > marks. This works as an interim fix. Feel free to create an issue so this doesn't get lost.\nCode looks good. @marijnh please merge when you get a chance.\n. Given that the most common motions and operators do the same thing in both modes, instead of using different keymaps, I'd rather introduce a concept of context to keys registered in the keymap. i.e. an o key registered with context: 'normal', and an o key registered with context: 'visual'. It's another one of those things I've had on my queue but just never had time to get to :-\\\n. I see, fall-through works too. There's no support for that currently in the vim keymap either. I just don't want this to head in the direction of an unwieldly pile of keymaps like the original implementation.\n. https://github.com/marijnh/CodeMirror/pull/2148 adds rudimentary support for :nmap and :vmap, as well as adds a ctx, or mode parameter to CodeMirror.Vim.map(). There isn't any detection for circular mappings or anything else that might happen with customized mappings.\n. This looks like a breaking change for existing users of the vim keymap, which is not ok. We need to have a period of time (at least a few CodeMirror releases and possibly until the next major release) for both registering as a keymap and registering as a mode to work. I would restore the initialization functions, keep track of whether Vim is initialized, and if initialization has not already been done by the time handleKey is executed, do the initialization then.\nAlso why are you clearing global state whenever the vimMode option is set? The whole point of global state is for it to persist between codemirror instances, even if new instances are created later.\nFinally, there are a few reasons why I kept the state as getters instead of directly referencing the variables\n1. I don't like the fact that vimState needs to be kept as cm.vimState. That vim and cm are kept distinct with getVimState(cm) makes it easier for me to think about them separately and leaves room for a different future implementation.\n2. And at some point, I think it would be good add an option to specify the object to use for global state instead of creating an internal object. This both improves testability and gives the user more control over the keymap. Keeping truly global state is pretty bad\n3. Having functions leaves more room for abstraction and testing niceness if I ever decide to clean up the mess of unit tests.\n. > if vim is kept as a keymap instead of an option, how can i deregister the beforeSelectionChange listener when the keymap is changed? should i only add that listener if vim is an option (leaving behind legacy users), or should i patch codemirror to allow update functions in keymaps? i suppose i could call getOption('keyMap') inside the listener\nI agree with you and @marijnh that the Vim keymap has grown enough that it should be considered more of a mode than a keymap, so I wouldn't patch codemirror to callback on keymap change.\nI think not deregistering the beforeSelectionChange is fine because keymap change isn't really something that would usually be done except at cm initialization, and we currently don't deregister any of the visual/insert mode listeners on keymap change. But that's a weak argument, so leaving behind legacy users would also be an ok option. Either is fine really. I just don't want this change to completely break the vim keymap.\n\n1084\nWhat is wrong with just storing it as a property of the CM instance?\nNothing wrong with storing it that way. I don't want it to be directly accessed that way since it's a private property. Rethinking it though, it's fine to let the client just break if they play around with the state. So @metatheos feel free to get rid of vim passing, preferably in a separate branch.\nthis led me to believe that you were ok with storing vimState on cm\n\nI am a bit back and forth on that yes... Since you called it out, stick with storing vimState on cm, but I still prefer to keep the getVimGlobalState function.\n. getVimState isn't really useful anymore. Can you rename it to maybeInitVimState() and use it only in defineOption and handleKey?\nLooks good otherwise. Thanks for the changes.\n. Thanks, good to merge.\n. Sounds reasonable. The vim keymap doesn't support options as of yet, but not entering insert mode if the document is readonly seems like a sensible default.\n. Yes, in VIM it enters insert mode with a warning, and you are able to make changes to the document. You may not be able to save any changes. On CodeMirror, if 'readOnly' is true, it is not possible to make any edits so it doesn't make sense to be able to enter insert mode.\nI don't feel strongly about this. If you really want this as a configurable option, I'll put it on my list when I get a chance to add options support to the keymap.\n. This probably regressed from when g~ was rewritten a while ago.\nI think the hack isn't too bad. I'm wary of adding more things into evalInput (it's complicated enough as it is), so just going to put the hack inside swapcase.\n. Good idea. Mostly looks good, just a few comments.\n1. You are missing an enter visual-mode event at line 582\n2. You are not distinguishing between Visual and linewise visual as vim does. I think it may be better to do something like this: signal(cm, 'vim-mode-change', {mode: 'visual', style: 'linewise'}) (property names up to you). All the information is there and the event is more extensible.\n3. Events aren't as easily discoverable readability-wise. Since there's no documentation page for the vim mode, could you document the new event in the comment block at the top of the file, above 'code structure'?\n. Looks good. Thanks!\n. I believe this was fixed in https://github.com/marijnh/CodeMirror/pull/1722.\n. It would be better to use cm.lastLine() instead of cm.lineCount(). Good otherwise. Thanks for the fix.\n. Looks good. Thanks! A unit test would be nice too if you are so inclined, but good for merge.\n. How does hidden lines behave with other types of movement like word-wise/character-wise movement and search, etc? Does it uncollapse the lines or just skip over them?\nShould VIM be checking something more generic instead, like if the range it's trying to move into is atomic or collapsed?\nWhat's the use-case and is this addon something that should be a part of the codemirror repo? I guess that's more of a question for @marijnh \n. Since the issue is that VIM is not skipping over collapsed lines, then I think the fix for VIM should be to skip over collapsed or atomic range in the CodeMirror sense, rather than to skip hidden lines as defined by your new addon. Otherwise it would fix your specific use-case, add a dependency to the hideline addon, and still leave VIM broken for otherwise collapsed lines? How inefficient would it to check each line and see if it's collapsed?\nHow does hidden lines behave with other types of movement like word-wise/character-wise movement and search, etc? Does it uncollapse the lines or just skip over them?\n. @marijnh In desktop VIM, the j and k keys treat collapsed ranges as a single line. So if lines 2-20 are collapsed, and the cursor is on line 1, 3j moves to line 22. To use setSelection I think vim would have to call it once for each line it is trying to move through; 3 times in the example I gave. That seems rather inefficient. Is there a constant time way to do this? Judging from the API it doesn't seem likely.\nExperimenting with code folding, there are a few more subtle issues with the vim mode. Desktop VIM pretty much treats a collapsed range as a single line. Operations like delete on the first line of the collapsed range operates on the entire range. With the existing code vim would only delete the first line. The fix for j and k may partially fix this.\n. Hmm something like the below doesn't work for the foldcode addon. clearOnEnter is destroying the collapsed range while vim is trying to figure out where it should go.\nvar curEnd = cm.getCursor();\nfor (var i = 0; i < repeat; i++) {\n  curEnd.line++;\n  cm.setSelection(curEnd, undefined /* head */, bias);\n  curEnd = cm.getCursor();\n}\nWould it be difficult to either (1) expose a helper that can do skipAtomic just like setSelection but returning the destination instead of moving the cursor, or (2) adding the desired functionality as a new unit to moveV?\n. @marijnh The snippet in my last post works ok on non-clearOnEnter ranges, but the behavior is still non-ideal. It looks like trailing text after the fold widget is considered on a different line than text before the fold widget. With the foldcode addon modified to not set clearOnEnter, j (line down) moves to the visually end of the line containing the fold instead of the next visual line.\nTo address your third question, I personally don't use folding, but I imagine it would be rather inconvenient for users if j would expand any folded ranges.\nAll this arises from the issue that desktop VIM's j and k follow the archiac behavior that arrow down should move to the next logical line, not the next visual line (accounting for wrapping, etc). Though for some reason folding is accounted for; I assume the behavior was added later on. Visual movement, gj and gk, make much more sense and it is common to map j and k to gj and gk respectively. (@Dominator008 actually this mapping will probably address your problem. Just do CodeMirror.Vim.map('j', 'gj') instead of your hack to disable j and k).\nBut it's not my place to second-guess VIM's behavior. If it would be difficult to introduce an API for computing cursor offsets (analogous to findPos) that treats a folded range as either a single character or a single line, then I think the bias parameter you added is a reasonable compromise.\nSorry for the rant. I got a bit caught up in this :x\n. Hmm it looks like almost all of vim mode's motions will get stuck at folds. Which leads me to think that any naive use of setSelection as a means of iterative code navigation will probably get stuck at fold boundaries when clearOnEnter is not set. This sounds more and more like an API issue. @marijnh what do you think of computing bias from the current position/selection by default and possibly using a passed in bias as an override?\n. @marijnh Yes, what you describe is correct. When you press j in vim, the cursor will skip all of a wrapped line (and any ranges folded into that line), and move to the corresponding character in the next line. The computation you describe sounds like it would work. Even I am skeptical of whether it's worthwhile to add to findPosV, so up to you.\nRegarding bias, I really think it would be better to compute a default based on the cursor's current position. Otherwise it would be really easy for users of setSelection or setCursor to get stuck on folded ranges.\n. Great, thanks! Confirmed that the vim no longer gets stuck at fold boundaries.\nIf you are curious about the behavior, just enable vim on the folding demo page, and change the foldcode addon to clearOnEnter: false. Press j near the fold boundary and you'll see vim's behavior. It is now able to move over the folded area instead of getting stuck on it.\nIt's still non-ideal that j will move the cursor to the right of the fold, and then move to the next line. But I don't think there's much that can be done about that unless we add the new movement mode we discussed in findPosV. I'm ok with leaving the behavior as is, since the cursor no longer gets stuck.\n. @marijnh don't think this is vim specific. It wouldn't be hard to make sure that vim doesn't call replaceRange on delete commands if there is no text to delete, but it seems like this is something replaceRange should handle. What do you think?\n. Not being able to repeat keys is a \"feature\" in Lion. The only way I know of to fix the issue is to go into the terminal and type\ndefaults write -g ApplePressAndHoldEnabled -bool false\n. Took a look, but still don't know what the cause is.\nIn the first case, without clicking on the address bar, holding down j:\n- First keyDown event has keyCode 74\n- Second and following events have keyCode 229\nI assume 229 is some kind of signal for IME.\nIn the second case, after clicking on the address bar and back to CodeMirror (or really just losing and gaining focus), and holding down j:\n- All keyDown events have keyCode 74\n- No value is detected from the input element in readInput. No handlers are triggered that I can see.\n. @marlun Does running the command in the second post solve your issue? You might have to reboot.\nAFAIK the still-open problem is Safari specific (and actually now working for me).\n. Fix for last line looks good. Thanks.\nA method to disable the vim keymap doesn't seem right.\n1. vim's global state isn't meant to be accessed externally. The _ at the end of getVimGlobalState_() denotes that it is a private variable meant only to be used internally by vim. The method is just there for testing.\n2. A better way to disable the keymap to disable vim mode would be to call CodeMirror.setOption('vimMode', false) and then assign a different keymap that just swallows all key strokes.\n. Actually, CodeMirror.setOption('readOnly', 'nocursor') is probably what you want.\n. Ah that's a weird bug, I'll try to fix when I have more time.\n. Well, I agree that this is correct behavior for visual mode, it's wrong for normal mode. dcc doesn't work in normal mode. s is documented to be a synonym to cl, which you are changing. This is something probably better solved adding context specific key bindings.\n. Type :help s into vim\n[\"x]s                   Delete [count] characters [into register x] and sta#\n                          insert (s stands for Substitute).  Synonym for \"cl\"\n                          (not |linewise|).\n. I took a crack at this since adding generic context support seemed a bit tricky. Sorry if I duplicated your work. Please see if the following patches address the bugs.\nhttps://github.com/mightyguava/CodeMirror/commit/6b1e82ce9f9c8b2430bed59b9e4db6f8d97bf999\nhttps://github.com/mightyguava/CodeMirror/commit/3bdb6091dbd5cacc211763363141ddc69635e9d1\nOn branch https://github.com/mightyguava/CodeMirror/tree/context\n. Looks good to me. Thanks! I may have to start documenting the API...\n. I think this is a direct result of the fact that the vim keymap accounts actually counts the fat cursor as a part of the selection, to better match desktop VIM's behavior.  It was a lazy choice on my part and a better solution would probably have been to emulate the cursor instead. To change the behavior would require many small but intricate changes to how visual mode is handled. I probably won't be able to commit to this any time soon.\n. Fixed in https://github.com/marijnh/CodeMirror/pull/2642\n. Thanks! Looks good on the vim side\n. There are 2 things missing from CodeMirror for that to work:\n1. Insert mode in vim mode doesn't use the key handling system normal mode uses, and unfortunately it'd be quite a bit of work to get that into insert mode\n2. CodeMirror doesn't directly support consecutive keystroke bindings in a keymap. You'd have to create a single keystroke binding that switches to another keymap to listen for the second keystroke. Also, that would break actually typing j...\nNeither of those are easy changes, nor common needs, so I wouldn't expect using jj to leave insert mode to be possible any time soon.\n. Well, for one thing, I could type jabcdk and you'll still exit insert mode. But yes, it is feasible to do what you are suggesting. I just foresee the full solution to be rather messy and unmaintainable. A better solution may be to register a keyPress handler on CodeMirror to catch k before CodeMirror gets it, plus a timeout for if k is not pressed after j.\nTyping j and then removing it is also quite a hack. It'd be a much better experience to never show it. I can imagine this method having weird quirks, including problems with IME.\nI don't plan to spend time figuring out the \"right\" way to do this, but I think it would have to do with getting the entire set of vim bindings to use the raw keyPress and keyDown events rather than CodeMirror's key handling framework, so that normal and insert mode keys can be treated similarly. This won't be simple.\n. Well, let's see how it turns out then. I would be open to most hacks that don't mess up the existing structure and doesn't add a maintenance burden for me, should I finally get time to do the \"right\" solution I mention above.\n. Sorry, I barely have time to keep up with pull requests, let alone contribute code at the moment. @binny has been doing most of the work lately as part of Google Summer of Code, but I think he has his hands full too.\n. @gekkoe's solution has been merged. https://github.com/marijnh/CodeMirror/pull/2719 I'll close this until complaints for needing other insert mode bindings rise.\n. Sorry I forgot to test this one last time before pushing. The error was introduced by my abuse of exceptions as user error messages. Fixed.\n. Thanks for the patch! <CR> looks good, but I have a couple of nits for <C-e> and <C-y>.\n1. <C-e> and <C-y> shouldn't be defined as motions. Motions can all be used in conjunction with operations to transform text, while <C-e> and <C-y> should only perform scrolling. Right now if you do d<C-e> it actually deletes 2 lines, where the expected behavior is to do nothing.\n2. In desktop vim, <C-e> and <C-y> do not move the cursor if it's on-screen, it does keep the cursor from going off-screen. Right now your code will allow both keys to move the cursor completely off-screen.\nI suggest that you add <C-e> and <C-y> as actions instead and implement a scroll method similar to moveByScroll in the actions object.\n. I remember having the same question quite a while ago for the other scroll actions but not coming up with a better answer. @marijnh do you know of a better way?\n. This looks great! Thanks for adding unit tests as well.\n@marijnh please merge this at your convenience. Thanks.\n. @marijnh I'm not exactly sure what the use case is still but I can try to describe @Dominator008's previous comment.\nIn desktop vim, vertical movement by line is done with the j and k operators. This movement is on logical lines, so if line 1 is wrapped and takes up 2 visual lines on the screen, pressing j while on line 1 will move the cursor to line 2, and visually this would be line 3.\nIn the context of folded line, the behavior is a bit different. The entire folded block is treated as a single logical line. So if line 3-4 are folded together, and the cursor is on line 2, pressing 2j should move the cursor onto line 5.\nWith the current API CodeMirror offers, the vim mode is not able to determine the size of the fold, nor is there a way to treat folded blocks as a single line. The vim mode currently ignores the existence of folded lines and relies on setCursor to move the cursor past the fold if it gives a position inside the fold. The cursor doesn't end up in the position it should in desktop vim, but at least it no longer gets stuck on the fold as in #1743.\nUsing the visual movement operators gj and gk avoids these problems, but in order to stick closely to real vim behavior, I can't replace j and k with them in the default key mapping.\nLet me know if there are still points that are unclear.\n. So in Linux OS, middle click to paste doesn't actually switch into insert mode. VIM treats everything you are pasting as key strokes, so until VIM sees a or i or something similar that will cause you to enter insert mode, you will be making vim execute arbitrary commands in normal mode. Getting vim mode to duplicate desktop VIM behavior will be next to impossible.\nThe strange behavior you are getting of pasting after entering insert mode is probably because the text you pasted actually went directly into CodeMirror's hidden textarea, but the textarea was not polled until entering insert mode, at which point editing becomes enabled.\nI think your desired behavior sounds reasonable. I could probably detect middle click, read out the text in the hidden input and insert it manually into the page. @marijnh is there a better way to do this in vim's normal mode, when disableInput is set on the keymap.\n. I don't believe vim mode does anything special. It just sets disableInput when not in insert mode. readInput short circuits if cm.state.disableInput is set. Maybe it's easy as removing disableInput from the keymap when middle-click is detected?\n. Listening to paste events instead sounds great and as you said will cover pasting from the menu too. I didn't think of that. Will try it when I get a chance. Thanks!\nI saw there were problems with middle-click paste in firefox before in CodeMirror 2. Did that ever get fixed?\n. @marijnh to clarify, creating a bookmark in vim uses the key sequence m, markName, where markName can be any letter in the alphabet. So m, a creates a bookmark named a. Pressing ', a should move the cursor to bookmark a, but it appears that the closebrackets addon is intercepting the ' key before vim can get at it.\nIs there an easy way to fix this?\n. Yes. That is correct.\nOn Dec 20, 2013 2:25 PM, \"Marijn Haverbeke\" notifications@github.com\nwrote:\n\nIs the problem that the keymap from the closebrackets addon should only be\nactive when in insert mode, or is that not it?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/2061#issuecomment-31034759\n.\n. This actually is now fixed since vim is intercepting keys before core codemirror handles them.\n. Maybe just short circuit when cm.state.disableInput is set? The vim keymap sets it in normal mode and I think in general you wouldn't want a \" inserted when disbleInput is set on the keymap.\n. Both sound good to me, the former sounds safer. If you go with that, please reference a patch and I'll update vim mode accordingly.\n. The vim changes look sane and I can't find any issues with local testing. The addon changes look great too. Will probably fix more than a few weird bugs in vim mode. Thanks @marijnh!\n. . doesn't play well with visual mode in general. The implementation isn't quite complete yet...\n. Looks great, thanks. \n. Heh... can't believe I forgot to unescape after reading the escapes :$\n\nJust have 1 question and please prefix all commits to the vim keymap with [vim].\n. Looks good to me.\n. Cleaning the code for unescaping looks good, but I'm not sure about the change to automatically escape |. While I'm all for making the vim mode confirm to real vim, I don't see search/replace here to ever match vim's pattern engine, and I think it would be better to make it clear that the behavior here will match exactly that of regular javascript regex. There's a short hint on the search dialog that one is expected to use javascript style regexes.\nAlso, personally I don't want | to be escaped automatically, since I actually do want to use in searches as OR. Wouldn't escaping it automatically remove the ability to use it as OR in search?\n. Hmm I've always lost arguments regarding making CodeMirror's vim mode more vim-compatible vs more modern. IIUC vim's regex is different because it predates PCRE. But I'll make an attempt anyways... \n- Javascript regexp is more or less a subset of perl-compatible regular expression, which is the de-facto standard. Javascript regexp most notably has no backtracking/lookahead, verbose regexes, named groups. I don't think any programmers will have trouble using it.\n- There's clear documentation for Javascript regex. There's clear documentation for Vim regex. Where are users going to look for documentation for something that falls in between Javascript and vim regex? Most features of the keymap current either match real vim or doesn't work. I'd like to keep it that way.\n- A cursory look at CodeMirror's documented integrations makes it look like Javascript is pretty high in the list of languages.\nIf you really feel strongly that vim's way is better, let's cover all of the basic cases: the special characters toggled by vim's magic. I believe the list that JS as supports is: ?, +, {, (, ), |. Matching groups in the replace part should also be changed from $1, $2, ... to \\1, \\2, ...\nI still think this is going to be a large source of confusion. I hope you can commit to improving the vim keymap's fidelity to real vim's regex if you want to proceed down this route.\n. Hey sorry for the delay. Just (partially) finished a move.\nIt looks like searching works as expected, but incremental search is not. Both \\| and | seem to be interpreted as special characters.\n. LGTM!\n. Thanks! Looks right to me--\nSent from my phone. Excuse the typos!\nOn Fri, Jan 31, 2014 at 5:02 AM, Marijn Haverbeke\nnotifications@github.com wrote:\n\nClosed #2206.\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror/pull/2206\n. Thanks! I'm not quite familiar with text objects so it'd be great if you could add unit tests for your additions, to prevent future breakages.\n\nWhile testing, I noticed that da} does not delete the brackets, while the other combinations do. Behavior is also strange if the cursor is on }. Could you take a look?\n. da} is definitely working. I can still find a bunch of things to break :) Though I don't think any of them are caused by your changes\n1. di}, di], di) don't work for me in the vim demo, though the da versions do work. You intended to fix di as well right?\n2. doing da{[( where no closing brace exists moves the cursor right 1 character. It should stay still\n3. doing da{ while the cursor is on the inner { in the demo deletes the outer block, when it should delete the inner block. Off by one error somewhere?\n4. doing da[ while the cursor is on { or ( deletes the {} or () block, when it shouldn't do anything\n5. doing da[ while on the cursor is on } or ) deletes the inner {} or () block. Doing di[ seems to delete the outer\nI think you should fix 1 before committing this pull request since that's part of what you set out to do here. The other ones are bonus. I'll split them into issues if you don't want to tackle them just yet.\n. Ah, oops. I was accidentally using the one on codemirror.com. Sorry about that. Shouldn't be reviewing code late at night.\nLooks good to merge!\n. The cause is testEdit doesn't support before values of more than 1 line, so the cursor initial position is set in the wrong place. 3cffd84e507bce5a81128e4e2363c2bfd11dd74a fixes it.\nThis also revealed a strange bug where if one attempts to place cursor beyond the end of a line, the beforeSelectionChange handler in vim will create a 1 character selection on the last character of the line. The intended behavior is to place the cursor just before the last character. The commit fixes that too.\n. Oops, should be 3cffd84e507bce5a81128e4e2363c2bfd11dd74a. Updated the previous comment too.\n. All fixed by @lazywei\n. Starting with a 0 b,\n:s/\\(\\d\\)/\\$1\\1 produces a \\00 b, should be a $10 b\n:s/\\(\\d\\)/$\\1\\1 produces a $10 b, should be a $00 b\nCould you check for other corner cases as well?\n. Looks good.\nI noticed that replacing with \\ is a bit broken. For example, given a 0 b, s/0/\\\\\\\\\\\\ should produce a \\\\\\ b, but instead produces a \\ b. It looks like this was caused by 712f28ce25eaf1573f1fc3bdfccc6cced90bdea7.\nMy suggestion would be to split up the functions for flipEscaping the search part, unescaping the replace part, and swapping $ for \\ in the replace part. flipEscaping is a bit messy right now.\n. @marijnh please merge this when you get a chance. @heppe heppe will do a cleanup as a followup.\n. Looks good. I wish there were cleaner ways to do string escaping.\n. Looks good. I'd add a separate set of unit tests for search without substitute as well.\n. Great. Thanks! Good to merge\n. Updated in 01e7ab9.\n. Hmm ok. How about... \"Note that the vim mode tries to emulate the most useful features of vim as faithfully as possible, but will not strive to become a complete vim implementation\"\n. K, updated in bc6d7db\n. Your change definitely looks correct, but wouldn't saving lastSelection in exitVisualMode make gv work for all actions, not just y? You'd need to put the save in 1 place as well.\nWith my suggestion, recording the last selection when it was cleared by a mouse click may or may not work. If it doesn't, you can just read the cursor positions out of < and > registers in exitVisualMode.\n. Sorry, forgot to catch this on the last pass. The lastSelection should be stored in the editor state - cm.vim.state, not the global state. Otherwise all CodeMirror tabs/instances on the page would share the same selection.\n. Ah looks like there's a little more to this change. gv restores whether you were in linewise visual or characterwise visual mode, so you'll have to store that extra bit of state. You also need to set visualLine, visualMode, and signal the mode change. Otherwise vim's internal state will be broken until you move the cursor.\n. Cool. visualMode and visualLine aren't mutually exclusive. You are setting visualMode to false if visualLine is set. It should be set to true.\nCould you add another unit test for visualLine?\n. Looks great. Good to merge. Thanks!\n. Sounds like a bug with lastHPos, used for maintaining vertical position when traversing lines of different lengths. @heppe do you have time to take a look? If not, I can probably get to it in the next week or 2...\n. Implemented in https://github.com/marijnh/CodeMirror/pull/2319\n. Sounds pretty feasible. Will look into it soon.\n. This is going to be a GSoC project if there's interest\n. https://github.com/marijnh/CodeMirror/pull/2613\nhttps://github.com/marijnh/CodeMirror/pull/2591\n. This is also blocked by https://github.com/marijnh/CodeMirror/issues/1990, which may be quite hard...\n. Still would take some work but at least it's doable. I will get to it sometime.\n. I think so. There's a separate issue for in-editor completion https://github.com/marijnh/CodeMirror/issues/2306\nIt would be pretty easy to get this completion by turning the ex prompt into a CodeMirror instance, but Vim shouldn't be managing multiple CodeMirror instances in any way. We may need to fork some of the proposed/desired feature requests into a separate repo. Need to think more on this.\n. The vim mode allows the host application to bind custom commands. It's entirely up to the host application to configure this. File management is outside the scope of CodeMirror.\n. I find smartCase, which is the enabled option, to satisfy most of my use cases, but this sounds like a good addition.\n. CodeMirror does have its own model for tags, I'm not sure about definitions. However, it's unlikely it will be compatible with vim's model. I will leave this open as a possible future feature\n. Sounds like a good little plugin to implement for Vim. A bit outside the scope of the core lib. Will block this behind https://github.com/marijnh/CodeMirror/issues/1990\n. Your branch is behind marijnh:master. Could you update your branch?\n. Actually, it looks like you did a bad merge. Please clean up your commit and only include your changes\n. Looks great! Glad to see this finally finished. Just have a few nits.\n. Merged as 3d225b5a201096de2f5e14db7d1e57c680fde042\n. Due to the fact that CodeMirror places the cursor to the side of the character but Vim places the cursor on top of the character, there's actually a bit of finagling in the keymap cusor's edges. If the selection is left to right, the fat cursor is on top of the last selected character, but CodeMirror's selection doesn't actually extend to it.\nSo when switching directions, you actually have to +1 or -1 to the anchor to account for that in the motion.\nThe current logic for checking the selection crossed over assumes that the anchor doesn't move. Now that you do move the anchor, you'll have to update the logic to reflect that. The other option is to do this logic inside your motion and just overwrite selectionStart and selectionEnd as you are doing now.\nAlso, please remove tab characters. They fail lint.\n. Getting closer\n- v_o now doesn't work if the anchor is directly above the head.\n- cursors received from getCursor should be copied with copyCusor before being changed. Generally good practice to consider return values from API methods to be immutable unless otherwise documented.\n- Please add unit tests\n. Thanks! Squashed and merged as https://github.com/marijnh/CodeMirror/commit/9cff2b6e42f826d68259a94a0baa2126af9da6bc\n. Yeah, the current way to map keys is a hack. But still, the user shouldn't be able to unmap any keys from the default keymap. If you would like to add unmap, I would ask you also store custom key mappings in a separate array. This shouldn't be too hard, though you'll have to change how key buffering works for multi-key mappings.\n. Thanks! Squashed and merged as https://github.com/marijnh/CodeMirror/commit/0271023f20b085a0029aceb1d9e1afdd01574515. I added an error message for nonexistent mappings.\n. This fixes https://github.com/marijnh/CodeMirror/issues/2301\n@marijnh, @heppe, @dbarnett, I'm not quite sure if this belongs in CodeMirror. We already have confirmation dialogs for error messages, and a prompt for search/replace and ex commands. This is a little different since it's displaying information about vim's internal state.\n@marijnh registers in vim can be thought of as general-purpose text buffers. They are most commonly used as separate paste buffers. This command displays the contents of each existing register in a dialog. The output of the command looks something like this, where 1 and a are labels for separate registers, and next to them are the contents.\n```\n----------Registers----------\n\"1 static int n = 0; \n\"a static char *bufp = buf; \n```\nPersonally I'd rather not add more UI here, especially considering the contents of registers can get long and the UI can get ugly. I'd rather expose a getRegisters() endpoint on the vim API and let the caller map a :registers command that renders a UI if they want. Though I can see how having it built into vim would be convenient.\nOpinions?\n. That sounds good. Will merge this pull request. I agree it's time to think more about how to expand further on the vim mode in the future.\n. Merged as b3bf93d. @binora I made some style changes and removed the code to create valid but not yet created registers since it wasn't needed. Diff against upstream to see the changes.\nIn the future, please start with a clean branch by doing git checkout upstream/master -b mynewbranch, and merge by doing git rebase upstream/master instead of git merge. There are tutorials on github for how to generate clean pull requests.\n. Looks much cleaner than it used to be, but I don't think you can just delete the key parsing/serializing code outright. See my inline comments.\nAlso, this breaks :registers. There isn't a good way to unit test that command since it just shows a dialog. Maybe it would be good to make a mock showConfirm function.\n. This is a regression. The current code assumes that all keys in the buffer are strings of length 1. This is not true. There can be keys with length > 1. Each of these special key [combinations] are surrounded by < and >. The previous parsing logic took that into account when deserializing the key buffers on replay.\nThat said, I think the small regression here is fine as a tradeoff the clean up. Please submit a followup fix.\n. Sounds good. Looks much better :). The style thing was a bit poorly thought out. If anything I'd stick in just color. But yeah sounds like we can leave it as is.\n. Merged as 96b8519. Thanks for working through my nitpicks.\nI noticed that the unit tests for :registers were borked and fixed them in 809fe262184b433fb38c202628d27d81d90c401a\n. Oh, wait, your test was right. I read it wrong... So I ended up refactoring your refactor a bit...\n. Cool, merged. Thanks.\n. Thanks. Merged\n. This should be a simple fix. Would you like to take a crack at it?\n. Looks good. Merged :)\n. Thanks, merged as a67f6e1. Fixed some lint nits like spaces after comma as I mentioned last time.\n. Merged as afcede2\n. I would add a matchIndent argument to the existing paste action. You'd add the indent in paste instead of creating a new action, avoiding the need for modifying the unnamed register or calling handleKey. And IIUC ]p should accept a register prefix to specify the register to read from as well. paste already has the logic to handle all this.\nIt also looks like you are only handling indent on the first line. Might want to add a loop, probably in a helper function called indentText? Watch out for de-denting text past 0.\n. Thanks! Don't have time to look at it this weekend, will update Monday\n. Looks much better. Sorry to add more complexity, but to make this completely correct, you'll also need to account for tabSize and indentWithTabs options in CodeMirror, and use tabs instead of spaces when appropriate. It might be sufficient to simply replace the pasted in chunk's indentation with the indentation you are trying to match, instead of creating your own indentation with spaces.\n. Here's a test case 3111feb. Notice that since tab size is 2, exactly 2 spaces at the start of each of the pasted lines are replaced with a single tab. I'd say try it out on real vim with noexpandtab to try it out.\n. Thanks! Merged as 35eb774 and ebffc6b.\nI didn't observe the same behavior you did in my VIM. For me, if the clipboard data was indented with space, while the current line is indented with tab, not all spaces are converted to tabs when pasting. Only the spaces that were of the same width as the tabs on the original were converted.\nBut I highly doubt anyone will ever complain about this, so let's just use what you have.\nI think the code is good as is. Maybe the entire matchIndent logic block could be factored into a separate function, but fine to leave too.\n. This applies specifically to mouse events no? Why not just add a mouseUp listener instead of adding a new event to CodeMirror?\n. You can register for mouse up events by doing cm.on('mouseup', handlerFn). See the manual http://codemirror.net/doc/manual.html#events\n. Sorry, I misread that part.\nSo to restate the problem, we need to reset some state in the vim mode whenever the cursor position changes due to mouse activity. The options I can think of at the moment are\n1. Use the selectionDone event you have (probably name it something better)\n2. Add an afterSelectionChange event with a source parameter that indicates if it was due to mouse, keyboard, program, etc\n3. Add a source parameter to the existing cursorActivity event.\n4. Register a mouseup event on the document body with CodeMirror.on(document, \"mouseup\", handlerFn), putting cm into the function closure. You'd do the registration in a handler for mousedown coming from cm.\n4 will probably be the easiest and does not require changes to CodeMirror core. 3 probably isn't too bad either. @marijnh what do you think is best?\n. @marijnh, waiting for your comment on this. Personally I like 3 best, but might be tricky. 4 would be fine too.\n. Thanks. Merged as f005c72. I added 9e6cbfa to cleanup, merging the cursorActivity handlers. Better not to have multiple handlers for the same thing lying about.\n. Hmm... interesting solution to the over-selection bug, but still quite a hack. I defer to @marijnh on the approach.\n@marijnh Nothing too vim jargon heavy here. Vim considers the character the fat cursor is currently on top of a part of the selection. CodeMirror handles it as if the cursor wasn't fat. There's some hacks existing in the vim keymap to work around this by playing with the selection. But it doesn't know about double/triple-clicking so we tend to over select.\nDo you have any opinions here? \n. To make vim's conceptual selection match the CodeMirror selection, we'd need\n1. when head is before anchor, the cursor is displayed to the right of the head\n2. when head is after anchor, the cursor is displayed to the left of head\nI didn't look very far into if making the fat cursor display this way would be difficult in CodeMirror, but it sounds pretty simple at the moment :) WDYT?\n\nDo I understand correctly that the cursor, in non-insert mode, always covers at least one character? We could even do away with the fat cursor style entirely and simply enforce that\u2014that the selection isn't empty. I guess the fact that a fat cursor should be drawn at the head of the selection is an issue.\n\nThat is the case in visual mode. This mode is automatically entered when a selection is made, and is the only mode there can be a selection in. The selection can never be empty as you said.\n\nThere has been another user requesting the ability to add multiple, selection-like layers. If we implement that, we could use such a layer to display the cursor, and always make it cover the character in the selection that sits next to the selection's head.\n\nThis sounds nice for vim mode too. In addition to character-wise selection, there's a line-wise selection mode. It'd be nice for the entire length of the line on the page show up as selected, not just to the last character on the line. But I don't think this bit of visual polish is very important\n. I think I'd still prefer a visual change to make the fat cursor render where vim expects it to be to hacking the selection model even more. @marijnh would that be hard?\n. Yes, the thing you outlined before. Would it be difficult to make this behavior change (or add an option) to where the fat cursor is displayed on selections?\n. Oh I was thinking of a smaller, specific change to get the fat cursor to show to the left of the head position if the head is positioned after the anchor. I thought that's what you meant in your first paragraph earlier. Or would you rather not have that hack in the core?\nThe fundamental but subtle difference here is that the vim model has a selection start and end on a character, while codemirror and most modern editors have a selection start and end in between characters. So a hack will need to go somewhere :)\nSent from my phone. Excuse the typos!\nOn Mon, Mar 17, 2014 at 9:46 PM, Marijn Haverbeke\nnotifications@github.com wrote:\n\nSomeone will have to design an API for creating those selection-like layers, and implement it. That'd be moderately difficult, I guess.\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror/pull/2372#issuecomment-37867845\n. > Just a query, If we display the fat cursor left to its position when head is after anchor while selection in vim mode, wouldn't that break existing cut and yank implementations?\n\nYes, this will break existing delete and yank implementations and more, as I mentioned on the linked issue.\n\nAnd after implementing block wise selection in vim mode using Ctrl-V, while selecting there may be a situation when head and anchor have same horizontal position but are on different lines, then how we'll display the selection? showing just line (but it does not happen in vim)?\n\nVim should enforce a 1 character selection on each line.\n. I think I had the same thought a while back, but ruled it out because:\n1. The cursor wouldn't blink. It's not a big deal, just not as nice visually. Though I guess a simple css3 animation or a settimeout could take care of that.\n2. The mark is shared with the host application, which can call findMarks or getAllMarks() to get a handle to it. This might cause issues with host applications that expect to iterate over marks only it created.\n. Ok, that convinces me. Let's do this with marks. Fixing vim mode's selection model to match CodeMirror's sounds great.\n@esjey Let's put this pull request on hold for now. I'll try to get to fixing the selection model in vim this weekend.\n. https://github.com/marijnh/CodeMirror/pull/2642 obsoletes this patch.\n. Thanks. Merged as 0afc1a5.\nCould you write more descriptive commit messages in the future so it's easier to merge?\n. So... this is the one part of the vim mode i'm not very good with since I never use text objects.\nYour changes look good to me so far. I like the TODO list :). I agree text objects needs a good refactoring.\nIn the vim mode, we don't usually add tests for specific functions like findMatchedSymbol. Tests are written at the functional level testing behavior only. So we write tests for daw or di{. I'd like to keep it that way.\n. There's a tradeoff for how specific the test should be. If you test each private method the behavior depends on, each private method gets good coverage, but you end up testing implementation detail. You also have to have additional tests for how these methods work together. Another disadvantage here is that if some refactoring or major changes take place to the implementation that doesn't affect the actual behavior, you end up having to rewrite your unit tests. Just yesterday @marjinh expressed that vim actually has too many fine-grained tests and should probably try to consolidate some of them. On the other hand, if you have overarching functional tests, then individual methods are not thoroughly tested, and you end up with poorer coverage.\nThere are many discussions on the internet on how/if to test private methods. More practically, I've found that for vim, each feature is small enough that only functional level testing is required and necessary. Once you get a bit more familiar with the feature and with the keymap, it's actually quite trivial to track down most bugs.\nThe only naming conventions I try to maintain is that the test should start with the set of keys e.g. da( that it's testing, underscore separate, and not duplicated.\nFinally a comment on the actual implementation. IIUC, findMatchedSymbol does exactly what findMatchingBracket does in matchbrackets.js. Maybe we can just call that instead of having a separate implementation?\n. No there isn't, but adding this dependency is fine since it's an included plugin.\nPlease make a note in demo/vim.html that vim will depend on matchbrackets.js for % and text objects. There should probably be some useful message shown if CodeMirror.findMatchingBracket isn't available though, to let the user know to include matchbrackets.js\n. @lazywei Is this the final state? I don't understand the logic. It looks like you copied the code from findMatchedSymbol into selectCompanionObject, look for a matched bracket, and then use findMatchingBracket to look for the other bracket. This doesn't make all that much sense.\n. Great, merged as 7c0d208, 0820321. I followed up with a6cdacd, 28c2f3e to clean up a little bit.\n@marijnh The API for scanForBracket changed a little bit to allow you to specify which brackets to look for. Please take a look. Also, if I read this correctly, the config object isn't exposed at all, so it can never be set.\nUnrelated, I noticed that the core_rtlMovement test is failing on Chrome 34.0.1847.60 beta.\n. Ah I missed doMatchBrackets.\nThat sounds perfectly sane to me. Let me know if f5195dc is what you had in mind.\n. Great. Merged as f5195dc.\n. Forgot to unregister. And noticed a couple subtle bugs. Still working on it.\n. Done. Much more complicated than I thought. If you hold down alt and click outside the window, keyup never gets fired... Using global event handlers on keyup and mousedown as a workaround.\n. Forgot about mouseover. It works even better than mousedown.\n. Nice, merged as f61c1f1\n. Could you explain what relCurEnd is doing? It's not intuitive to me. What extra data are you trying to store to make . work for indent?\n. Thanks, merged as 47814e1, with a small cleanup and fixing linewise in 88b26fc. This fixes a . partially for all visual mode operators, which is great. But the approach is a bit messy. It's not easy to do better until we fix the selection model in the vim mode, so I'll get to that soon and do a cleanup.\n. Thanks, merged as 5b366e6.\nLooks like append() was removed in 3d225b5 by @heppe. I blame myself for not writing unit tests for append. Thanks for adding them.\n. Thanks, merged. I add 3b6fa1c to delete some of the tests since these commands are aliases and only need spot checks.\n. Sorry to cut in here, but I just wanted to say that, wow, EDA playground and EPWave look really cool. Much less intimidating than running command-line simulators and debugging in ModelSim. It's about time Verilog moved into the 21st century. I wish it was around when I was learning Verilog.\n. Fixed in 1e42d9a. Not quite sure why the -1 was there... but % seems to work fine without it.\n. The \"/ register should not update during incremental search. It should only update when the user presses enter to perform the search.\n. Ah good point. I didn't look closely enough.\n@binora could you add the unit test, and I will merge the code.\n. I believe I'm still waiting for the unit test @heppe mentioned to be added here.\n. Thanks! Merged.\n. @binora could you try to fix this? I took a look and it should be a simple fix by changing moveByPage to use findPosV instead of moveV. Unfortunately I don't own a keyboard with PageUp/PageDown buttons :)\n. Fixed in #2522 \n. Thanks, merged and squashed as 2852469 and efb741a\n. Hmm... I force-pushed a while ago trying to fix master that I broke, and reverted those patches. I re-pushed these patches a few minutes ago and they turned into 38cc619 and f7f506f.\n. Np, it was my bad for messing up master to start with anyways :(\nYou said on the other thread that you were pushing some more changes so I figured I'd wait until you were done before re-pushing these patches.\n. Thanks, merged. Added 998a1b6 as a small fixup\n. Thanks. Merged as 6db5ec2 and 546eb6c.\nFYI Binny, I don't receive notifications when you make changes to the pull request. I only get notified when you make a comment. So when you make changes, just comment that you did so.\n. Thanks, merged as 6abb339\n. The motivation here is to keep track of each individual keystroke that goes into vim's command buffer and learn when the sequence ends to clear status right? I don't understand why whether a command is an edit should affect whether you signal end or not.\nRight now, you signal keystrokes on each of the process* stages, so keystrokes can show up 2 at a time or not at all, depending on how long the sequence is that gets buffered.\nDo you really need a vim-command-keypress event? You should be able to reliably get all key presses via the standard keypress event on the CodeMirror instance. It would be fine to expose cmKeyToVimKey on the Vim API if that's what you are after.\nTo figure out when a sequence ends, it should be enough to keep track of when inputState, since it contains the complete state of the current command. Just add a small function to wrap the vim.inputState = new InputState() statement and signal the event.\n. If you track the inputState as I mentioned, a motion should trigger a keyPress followed immediately by a command-done. I don't think you would need to filter motions out in that case.\n. Put a bit more thought into this. Using the vanilla keyPress event probably won't work because vim uses a combination of keydown and keypress events. Can you have a look at https://github.com/mightyguava/CodeMirror/commit/c53678284c5237bbcf7bf6164ac8ff1eacd2ac36 and see if that's what you need?\n. Great, merged upstream as c6e7cd1.\n. Looks good to me.\n. The vim mode doesn't bind any Cmd- keys. It looks like a bug with Firefox that allows w keypress to be handled by the editor when Cmd-w is pressed. My guess is that the preventDefault on the w keypress is somehow canceling the Cmd-w.\n. Don't think there's anything we can do about it here... Maybe raise it with Mozilla?\n. Hmm maybe not a Firefox bug per-se, but vim is working as intended here imo... vim doesn't bind to \"W\", it binds to \"'w'\" (https://github.com/marijnh/CodeMirror/pull/2175). Here's the stacktrace when Cmd-w is pressed:\nVim/vimApi.handleKey :: vim.js:687\nVim/buildVimKeyMap/keyMapper/< :: vim.js:4031\ndoHandleBinding :: codemirror.js:3004\nhandleCharBinding/handled< :: codemirror.js:3061\nlookup :: codemirror.js:4723\nCodeMirror.lookupKey :: codemirror.js:4738\nhandleCharBinding :: codemirror.js:3061\nonKeyPress :: codemirror.js:3119\noperation/< :: codemirror.js:2008\nAs far as CodeMirror and vim know, w was pressed, and w was handled, so preventDefault gets called. This is killing the Cmd-w.\nThe keydown definitely isn't getting handled.\nYou can reproduce the issue with:\nfunction doNothing() {\n        return true;\n      }\n      var editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n        extraKeys: {\n          \"'w'\": doNothing\n        }\n      });\n. Didn't realize firefox keypress events included modifiers.\nThis is not fixing the problem for me. I believe Cmd is classified as meta on Macs. It should be safe to turn off meta+key events for macs at least since it is never used to enter special characters.\n. Closing this issue since it appears to be fixed. Please reopen if you disagree.\n. Thanks, merged as ad83f54\n. The search history buffer is going to be identical to the ex command buffer. I think it'd be better if you created a buffer (OOP) object here to handle lookups and iteration instead of using an array. It can later also encapsulate logic of handling prefix looks, e.g. when e is typed, only return previous searches that begin with e. You can then just instantiate one for search and one for ex.\n. Thanks for putting in so much effort Binny, but I hope you know that you are only expected to be working full-time on GSoC on weekdays. We aren't expecting you to work on weekends. You should spend time enjoying your summer break as well.\nAbout the Travis build, I suspect there's an infinite loop occurring somehow that's stalling the test? I would try removing all the tests you added and see if the Travis build still fails.\n. > So we have to do something analogous to implementation of Register and RegisterController. Correct me if I am wrong. Also, I'll try to update openDialog as you suggested along with renaming the variables and let you know of my progess.\nYes, that's close to what I had in mind, though I don't think you need to have 2 separate classes in this case, since the 2 buffers are completely separate.\n. Looking much better and cleaner.\n. Added a few comments. Almost there\n. That's fine.\n. Merged as 6850616!\n. Merged as 222d8b7\n. The documentation for global gives a good but short overview of how it works in vim. We should try to match that here.\nThe global commands work by first scanning through the [range] lines and\nmarking each line where a match occurs (for a multi-line pattern, only the\nstart of the match matters).\nIn a second scan the [cmd] is executed for each marked line with its line\nnumber prepended.  For \":v\" and \":g!\" the command is executed for each not\nmarked line.  If a line is deleted its mark disappears.\nTo clarify, suppose you call :global/2/s//4\n1\n2\n3\n1\n2\n3\nglobal should in a first pass, mark lines 2 and 5 (starting at index 1). Then in a second pass, it should execute :1s//4, :4s//4 as separate commands, since there are 2 matching lines. It will not call :1,4s//4 or :1,6s//4 or :%s//4.\nThis should require no changes to how :substitute or any other ex command handles ranges. The approach I'm outlining won't work for asynchronous commands like when confirm is needed for :s, but we can work that out later.\n. > I share mightyguava's concern about creating a new way for line ranges to be passed around. I think it can be put into the params object of that is passed into ExCommandDispatcher.processCommand. Looking at that object in the debugger when I replace 'c' with 'd' with a visual range active, I see this, which seems to indicate that setting line and lineEnd in the params object might be all you need to do.\nExCommandDispatcher.processCommand doesn't accept a params object, it only accepts the raw ex command string. You can just prepend the line number to the command string like I mentioned above.\n. Something like :1s//4 is a perfectly legal ex command. The existing linespec parser will process it without changes. See :help range on valid range specifiers. It's not a hack, and is how global is documented to work. Seems cleaner than adding an extra param to me.\n. Merged as 1a82111 and a93f14a\n. This does seem to fix confirm, but it requires any potential future commands that may be used with :global to call the callback in order to function. I think we should have exCommandDispatcher call the callback for all non-async commands, potentially adding an attribute to the exCommandMap to distinguish them from synchronous commands.\n. We should not be adding any commands that makes such narrow assumptions. This opens the path to accruing a lot of technical debt. If making :global work only with :substitute was satisfactory, we could have gone with transforming :global/regex/s//replace/ into :substitute/regex/replace/\n. Thanks, merged as e3e455b.\n. Looks like a good start. Here's a couple bugs I found:\n1\nIf you have the following text:\nabc\nabcabc\nabcabcabcabc\nand you start selecting on the first line, extending to the lines below, the selection cannot extend right past the 3rd character because the first line only has 3 characters. If I try to do so the selection reverts back only the first line. This appears to be a bug with extendSelection. We should definitely fix that in CodeMirror.\n2\nWhen I click to get rid of the selection, it looks like I get stuck in setExtending mode until I press esc. You should probably turn off setExtending and clear the selection when the selection is cleared with the mouse.\nOverall, good job with this. I like how you made switching between difference visual modes pretty seamless.\n. Looks good! I didn't find any bugs in my cursory check, but it looks like a unit test caught a bug. Please add unit tests.\nAlso, let's not turn off showCursorWhenSelecting for now so as not to confuse the user before the feature is fully ready. It looks like removing that extra selected character in regular visual mode will have to come first.\n. Found another bug: If you start visual block in the middle of line 5, and press k to select up, the selection will expand to include the left side as well. It looks like the anchor's horizontal position is overwritten.\nPlease add tests for visual block mode and I will merge. Next step will be to update all the functions to work with multi-line selections...\n. Yes, that does appear to be fixed, thanks.\nEvery bug that was uncovered in this pull request (including the one just now) should have at least 1 test exercising that failure case. This will prevent similar regressions from occurring in the future. The single test you added so far is only enough to cover that visual_block exists, not that it's working properly.\nPlease look through the previous comments and add tests for them, and also add tests for corner cases that you find interesting.\n. Thanks, merged as aa43a39. I still think there are some corner cases you could check.\n1. Moving the head in a circle around the anchor and checking the selection at each corner.\n2. Switching between visual character, visual line, and visual block modes.\n. Merged as e20d175. Thanks\n. I'm keeping the global replace behavior on by default, but added support for g to toggle it off in cb50e1a.\n. Changed my mind... now that g actually is supported, then it matters more that behavior matches vim since people expecting to need to type g to turn on global replace may accidentally turn it off. 9021584\n. @marijnh waiting for your feedback on this. Sorry I didn't make that clear.\n. Still only a total of just over 1 second speedup.\n. All existing edit logic still assumes the selection is 1 character longer if selecting forward. e.g. delete will delete 1 extra character.\nIt is also not possible to select the last character of a line, since the character is clipped.\n. Cool. I swear I got different behavior earlier.\nThere's one more subtle bug that if you enter visual mode and move upwards, the head is 1 character to the right of where it's supposed to be.\nabc\ndef\nFor the above, if we start visual mode at e, and press j, bc\\nde should be selected, but only c\\nde is selected.\nCould you update existing and add additional tests for visual mode?\n. Ah and one more thing. If I have a selection on only 1 line and want to select in the other direction instead, I have to press h or l twice to change the direction of selection. I should only have to press it once. So if I have abc and have bc selected, if I want to select ab instead, I have to press h 3 times, when I should only have to press it twice. 2 of those times, only b is selected.\n. Yes, we want to be consistent with codemirror's model in that the cursor, fat or not, does not consume 1 character. The cursor's look is completely superficial.\n. Getting closer, there's still a bug... Try vkk\n. Looks good. Can't merge this yet since the cursor is disabled. How far along are you with using marks to fake a cursor?\n. That sounds right... You will probably have to figure out how to do cursor blinking by yourself though. It shouldn't be too hard--\nSent from my phone. Excuse the typos!\nOn Thu, Jun 19, 2014 at 6:55 PM, binora notifications@github.com wrote:\n\nNot much actually.Here's what I think about the options available in markText\nclassName: Trying to add css cursor blinking code in codemirror.css  (by searching  the web).\n from ,to :  same i.e. head +- 1.\nGive me some direction.\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror/pull/2642#issuecomment-46601858\n. Ok, merged as 461a303 and d662f18. Added patch 8726ab6 for a small fix.\n\nI think you misunderstand how CSS3 animations work... The visibility attribute had no effect on animation. It only seemed to look right because showCursorWhenSelecting was not turned off. See 02274d3 for a corrected animation.\n. You are right, but as the vim documentation says, y$ is more logical behavior. There's no need to be Vi-compatible here.\nhttp://vimdoc.sourceforge.net/htmldoc/change.html#Y\nIf you prefer yanking the whole line? You can map Y to yy.\n\nSent from my phone. Excuse the typos!\nOn Tue, Jun 17, 2014 at 8:54 PM, sirex notifications@github.com wrote:\n\nIn vim, Y yanks whole line, but in CodeMirror with vim mode, Y yanks text from current cursor position to end of line (y$ in real vim).\nYou can reproduce it in CodeeMirror with vim mode by typing these keys: Yp. It should paste whole line, below.\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror/issues/2643\n. We all have our preferences. The current behavior has been in place for 2 years now and this is the first reported argument against. I may consider changing it if there is more support.\n. Blind conformance to vim behavior isn't always the best option. It appears generally agreed upon that Y being mapped to yy is illogical and is inconsistent with C and D. The behavior is in Vim because it is carried over from Vi. The official Vim documentation itself also calls this illogical.\n\nAs per discussions at https://github.com/tpope/vim-sensible/issues/47 and https://github.com/neovim/neovim/issues/416, this is a trivial yet divisive issue with poor arguments against (having the current mapping). The main coherent argument I see is potential for breaking vim plugins, which is not applicable here.\nI'd rather go for sensible rather than blind conformance in the vim bindings, especially since it's long evolved from just plain bindings to a mini re-implementation of vim in javascript. This is the approach that we've gone with vim regex vs pcre. This is also the approach I'd like to stick with.\nFrom another perspective, being the standard vim bindings provided with CodeMirror, it's more important to have it work with a sane set of defaults out of the box than pure Vim conformance. If we wanted just the Vim defaults, we might as well as conform to set compatible instead of set nocompatible in Vim and go back to plain old Vi.\nIf it were easier for users to introduce their own mappings on CodeMirror integrations, I'd be more open to blind conformance to Vim. But as introducing a system to load mappings would be out of scope for CodeMirror, let's go with the sensible defaults rather than the purist defaults.\nAnd for a final argument, those more likely to be most likely to be surprised by blind vim conformance are those less experienced with vim and therefore less likely to know how to work around the inconsistencies/illogicalities. Whereas experienced vim users may either agree or disagree with non-conformance, but the ones who disagree will know how to configure their vim the way they like.\n. Thanks, closing for now.\n. I'd rather not have if (vim.visualBlock) checks in every function here. Instead, can we create a selection between curStart and curEnd in evalInput before calling the operator? Then remove the curStart and curEnd arguments to all operators. The operators will just always operate on the current selection. And instead of having conditionals for visualBlock, just always assume the multi-selection case, since it covers the single selection case, and always use replaceSelections and listSelections when possible. If the multi-selection case doesn't make sense to generalize in some cases, then we can have separate blocks for blockwise and non-blockwise code.\nDoes that sound good? I think this will make things less convoluted overall.\n. Yep sounds reasonable.\n. Thanks, merged as 2a8480e. Added 44592da. Could you create separate tests for visual block code instead of merging them into existing tests?\n. Oops, didn't see @heppe's comments. Ended up merging cfc0801 and adding 6aadaae.\n. Thanks, merged as 93c846b\n. Merged as d08aa03\n. @heppe is this ready to merge?\n. Merged as ddd36cb\n. Merged as 770c097\n. Blockwise visual mode is currently still under active development by @binora. We simply haven't gotten to these commands yet. Binny, could you add them to your list if you haven't already?\n. https://github.com/marijnh/CodeMirror/pull/2680 and https://github.com/marijnh/CodeMirror/pull/2684\n. Merged as bce6992\n. Replaying the visual block delete operation works only once. The approach looks sound though.\n. Merged as 9312c71.\n. Merged as a711779. Thanks\n. This sounds like a CodeMirror core bug, since it's not respecting the history delay.\nI just took a look into the history code. This seems to be what's happening if changeGeneration is called at the end of a change operation, then select, then change chain.\n1. changeGeneration clears the lastOp at the end of an operation\n2. New operation starts in response to key event\n3. setSelection updates the lastOp to the new opId.\n4. Change is done under same opId\n5. In addChangeToHistory, codemirror sees that the opId hasn't changed, merges with the previous change, even though the previous change came from an old opId.\nSo I understand now why changeGeneration must be called after setSelection for this to work. This definitely sounds like a bug in core but I'm not well versed enough with that code to suggest a better change. @marijnh could you comment on this?\n. Yup, that fixed it. Thanks Marijn!\n. Don't think this is right. Per my comment on the LT thread, I already fixed this behavior.\n. I think you are misunderstanding the order of events here.\nthis.onRecordingDone = cm.openDialog('(recording)['+registerName+']', null, {bottom:true});\n1. openDialog is called, creating the dialog\n2. openDialog returns a function that can be called to close the dialog. This is saved as this.onRecordingDone\n3. When macro recording ends, this.onRecordingDone gets called, closing the dialog.\nWhat you have opens the status dialog with the recording message, then opens another blank dialog immediately over it. When onRecordingDone is called, the blank dialog gets closed. The recording message stays open forever.\nTry the existing code here http://codemirror.net/demo/vim.html\n. Thanks, this has been merged as 2ae5509. I added 4d25787 to clean up a little bit.\nIn summary, I made changes so that:\n1. Default timeout is raised to 200ms.\n2. Added options for enableInsertModeEscKeys, insertModeEscKeys, and insertModeEscKeysTimeout. These are settable by calling CodeMirror.Vim.setOption('optionName', value) at any time.\n. And fixed the macro recording issue in 45fe0a1.\n. Yeah I made a follow up patch to set it back to false by default. Didn't mean to set it to true. HEAD should be right.--\nSent from my phone. Excuse the typos!\nOn Tue, Jul 22, 2014 at 6:11 PM, gekkoe notifications@github.com wrote:\n\nNice! \nLove the ability to call it with setOption. I might even be able to leverage that to create a user-configurable setting on the front end from within LightTable.\nThat said, didn't you want the enableInsertModeEscKeys set to false by default? That's why I had submitted it that way.\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror/pull/2719#issuecomment-49821905\n. I pushed 176f1bc which removes the enableInsertModeEscKeys and insertModeEscKeys options.\n\nThe key map can now be defined in a more vim-like way, by doing CodeMirror.Vim.map('jk', 'Esc', 'insert') in code or imap jk Esc in the ex prompt.\nSorry for the breaking change, but this is significantly better from the interface perspective and in code.\n. Merged as dc97f2a, thanks.\n. Merged.\n. Insert mode key bindings are not very well done in the vim key map and makes this rather tricky to do right (though easy to hack in). I plan to redo the key handling code soon and will look into this then.\n. Totally forgot about this. Done: 5432702\n. Merged as b4ecdde, thanks!\n. I found 2 bugs so far.\n1. The block ends up getting pasted in the column before the cursor. It should be on the column after the cursor.\n2. If the column the cursor on exceeds the length of the line below, vim should extend the line below with whitespace/tabs to match the column. Right now it just pastes to the end of the line.\n. Merged as 9de315b\n. I believe the faint line you are referring to can be enabled by installing\nthe rulers addon http://codemirror.net/doc/manual.html#addon_rulers. Text\nwrapping is implemented by the hard wrap addon\nhttp://codemirror.net/doc/manual.html#addon_hardwrap\nOn Thu, Aug 14, 2014 at 4:10 PM, David Barnett notifications@github.com\nwrote:\n\nIt would be very convenient if CodeMirror supported an explicit text width\nthat would (optionally) show a subtle marker at that width to help you\nnotice when you've typed past it. For instance, many codebases have a\nconvention of not typing past 80 characters, so being able to enable a\nfaint line between col 80 and 81 would be very nice.\nThis wouldn't necessarily have any heavy side-effects like force-wrapping\nlines, but could possibly enable some text wrapping features in the future,\nlike support for vim's 'formatoptions' setting.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/marijnh/CodeMirror/issues/2762.\n. Great, merged as 9b06427.\n\nI believe today is the official pencils down date for GSoC. Thanks for all your hard work over the past summer Binny!\n. Yes, in a few days. Have rather limited internet access.--\nSent from my phone. Please excuse the typos!\nOn Fri, Sep 12, 2014 at 6:36 AM, Travis Heppe notifications@github.com\nwrote:\n\n@mightyguava were you still planning to merge this?\nReply to this email directly or view it on GitHub:\nhttps://github.com/marijnh/CodeMirror/pull/2781#issuecomment-55338996\n. Merged and did a spot test in IE9.\n. Looks like strict was added for emacs bindings in 0b20cf2e673ff29e6af759c0cfb25ffb6d1a3306. I actually can't reproduce the issue @wing9405 is reporting.\n\nPassing in strict breaks forward bracket matching in vim mode.\n@wing9405, what version of CodeMirror are you using? And are you able to reproduce this in the vim demo here? codemirror.net/demo/vim.html\n. Vim mode supports custom key maps via the CodeMirror.Vim.map(lhs, rhs, context) function. Unfortunately, it doesn't look like Codio has hooks for you to do this. A potential workaround is to run Javascript on the page using a browser extension, as CodeMirror.Vim is in the global namespace.\nWe've discussed having a .vimrc a few times now and the conclusion has always been: CodeMirror is an editing component. Making it possible to load a .vimrc-like file would be an IDE feature that's out of scope here. Something like that would have to be implemented on Codio's side using the existing CodeMirror APIs.\n. Sorry, took a look at Codio and I don't think the workaround will work. It looks like it's using dependency management and puts CodeMirror inside a function closure so it's not globally accessible. I was being naive and thought Codio would be similar to jsfiddle where to just load codemirror.js as is. i.e. you could just use something like this extension https://chrome.google.com/webstore/detail/custom-javascript-for-web/poakhlngfciodnhlhhgnaaelnpjljija?hl=en to run a piece of Javascript that calls CodeMirror.Vim.map for you.\n. Ah, I should really get around to writing some documentation.\nSuppose you want to map jk to Esc in insert mode, you would call CodeMirror.Vim.map('jk', '<Esc>', 'insert'). That's equivalent to :imap jk <Esc>. If you leave out 'insert', then it would be equivalent to :map jk <Esc>. The mapping applies to all CodeMirror instances on the page (in the same browser frame).\nWhile in a CodeMirror instance, you could also type :imap jk <Esc> to achieve the same effect. But the change doesn't persist across refreshes.\n. document.querySelector('.CodeMirror').CodeMirror.constructor.Vim.map('jj', '<Esc>', 'insert')\nFYI :imap support was only committed a few days ago, so it's not in Codio yet. nmap, vmap, and map should all work.\n. I'm not very good at explaining how Javascript objects work, but simply put, you aren't passing anything into the constructor here. The constructor conveniently happens to be the object that contains all the API methods. So you call methods on .constructor instead of calling .constructor itself.\nMaybe putting it in code might be clearer.\nvar CodeMirror = document.querySelector('.CodeMirror').CodeMirror.constructor;\nCodeMirror.Vim.map(';', ':');\n. I have never dealt with scripting in Safari plugins before so I don't think I can be of much help. 2 things that come to mind are timing and sandboxing. Try increasing your timeout to like 10 seconds and if that doesn't work see if it's possible to fetch other elements on the page. If the second fails, I'd suggest asking on the plugin forums.\n. <leader> sounds like it could potentially be useful. It doesn't look like many people set up custom key maps for the vim mode so I'm not sure it's worthwhile right now.\nWrt commenting out code, that sounds like something to be implemented by the IDE using our yet-to-be-implemented plugin API. I just have not found the time to get around to it and no one has volunteered to do it themselves.\nKeeping this open for future reference.\n. FYI, register 0 contains the contents of the previous yank command.\n. This change is to address https://github.com/codemirror/CodeMirror/issues/2847\n. @heppe PTAL. Addressed comments, but it looks like the force push wiped them out.\n. Merged as 6d04226\n. @binny can you take a look at this? You are much more familiar with this code than I am.\n. @heppe too.\n. Merged as b216b2a. Sorry for taking so long.\n. jsfiddle uses an ancient version of CodeMirror. This error does not occur on recent releases.\n. Ah right, forgot that https://github.com/codemirror/CodeMirror/pull/2839 hasn't been released yet. Fix should be out soon.\n. Thanks. Merged as eac6c9b\n. Looks fine to me. Please add some unit tests. Thanks!\n. Thanks, merged. gUgU works fine for me. It makes the current line upper case. gUU doesn't work though... Not sure how to fix that.\n. Sorry for taking so long to get to this. I added a quick fix 2b8106f to make vim fail more gracefully so that it doesn't hang when this happens, but doesn't address the root issue.\nThe correct end result should actually be \nteshellothello\nme hello hello\nplehelloahellose\nWhich is not trivial to get right... I'm going to think more on this before attempting a real fix.\n. I second Marijn's opinion here. There is a nearly endless list of vim\nconfiguration parameters and we don't want to go on the path of porting\nthem over.\nOn Tue, Oct 28, 2014 at 9:06 AM, Marijn Haverbeke notifications@github.com\nwrote:\n\nThis feature request has very little to do with the vim mode. You can\ncontrol the indentation behavior with regular CodeMirror options, and the\nway tabs show up with CSS rules. I don't think there is currently much\ninterest in providing vim commands for all possible configuration tasks.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/2895#issuecomment-60751702\n.\n. > @mightyguava @marijnh would you consider adding api to allow external code to add options like these?\n\nYes, I am completely open to having a better API for external code to add options. I'd also be open to an API that enables a plugin system for Vim mode. I just will never have time to do it myself.\n\ne.g by allowing to pass setter and getter functions to CoedMirror.Vim.defineOption\n\nLet me be the first to admit that the defineOption API is not very well thought out. I think the type option isn't really necessary, since Javascript isn't meant to be type safe...\nCould you give more information on how this API would look? My approach would be to do something similar to CodeMirror.defineOption, which allows you to pass in a handler function that gets called everything setOption is called and let the caller handle all the work.\n. Ah I forgot that nofallthrough and other options are already part of the keymap object. Yeah, this is great. Thanks Marjin!\n. I'd like to change the vim keymap defineOption interface as well, and potentially merge it with the core editor's defineOption. The interface is a bit different right now because vim mode options have instance values that fall back to global values. The option values are also potentially not stored by vim but by whomever defines the option (See https://github.com/codemirror/CodeMirror/pull/3200)... Haven't thought very hard on what a better interface would be nor if it's reasonable to merge with the core editor's defineOption either.\n. Thanks, merged.\nI think a mark can return undefined if the text it was marking got deleted. Don't immediately see a better workaround for it.\n. All merged, thanks!\n. Gah, that's definitely a regression, probably came out of the block selection work...\n. Update here, I'm working on a fix, but it's going to take a bit... The visual mode logic is quite convoluted.\n. The visual mode off-by-one is be fixed\n. You could register your handler before turning on the vim mode, i.e.\nvar editor = CodeMirror.fromTextArea(...);\n// register handlers\neditor.setOption('vimMode', true);\nand that should put your handlers before vim gets it.\n. I suppose vim mode could check for preventDefault and codemirrorIgnore values on the event and ignore it if either is set. Would that solve your problem?\n. Tricky problem. @marijnh do you have any suggestions on a good way for clients to suppress keypress and keydown handlers registered on CodeMirror instances?\n. Yes, that's probably a good idea. I didn't realize until after I finished the insert mode key handling work that I didn't actually have to move the key handling out of the keymap layer.\nA function on the keymap that is called for each key would make the vim code cleaner if we take this approach.\n. I took a crack at this today, and realized I do need the editor instance. Vim mode's key mappings can change depending on its current state\n. @cldwalker This should be resolved on Monday when I sync up with @heppe\n. > I patched in the change and wasn't able to break it. One minor annoyance is that when a visual block passes a short line to the left of the block, it leaves a spurious cursor at the end of the short line. To repro, in the vim demo, use this key combination from the initial position.\n\nl,l,l,,j,j,j,j\nThat's a pre-existing bug, though.\n\nI don't see a \"spurious cursor\" in either the old or new code. Could you send me a screenshot?\n. Great, squashed and merged as c78d76c. Thanks for the reviews.\nRegarding vim.head, I agree that would be ideal, but to make it work a bit more work has to be done. Right now vim.head is only used and updated in visual mode. To make motions use it means making this track all cursor activity. It also means that operators that call motions internally to update the cursor position will have to set vim.head and then call the motion. Not terribly hard, just will take me a bit of work.\n. Huh, you are right. I never took the time to think about that... This is going to be another difficult off-by-one bug to fix.\n. Merged as 4fad3f8\n. Great, merged. What was broken in the commented out unit test?\n. Merged as 6f25f67. Thanks.\n. Made a small modification and merged as 1e5ae06, thanks\n. Made a small modification and merged as 1e5ae06, thanks\n. That should fix it.\n. Oops, here you go\n. Ah good catch, f97df90 adds checking for falsy return from keyName\n. Merged, thanks!\n. Wow, all this time I never knew that was the correct behavior. Merged as f1692af\n. > I understand that I can define custom ex commands through defineEx(), and define key-to-key mappings through map(), but is there any way to map a particular (sequence of) keys to execute an arbitrary Javascript function?\nNo, there is not. I'm open to adding one. Just never had a request (oddly), and have not had time to think of a good API\n\nWould it be sufficient to just append an appropriate object to the defaultKeymap? Or is there an alternative API available for this?\n\nAdding to defaultKeymap will not work unless the command is already defined in vim.js\n. I think I like the addMotion option a bit better (would call it defineMotion to better align with CodeMirror). I'd remove head from the argument list though, it's a bit controversial whether it should have been added to the list of arguments to start with...\nFor binding to them, I'd have a\njs\nmapCommand('keys', 'type', 'name', {motionArgs: {}});\nand corresponding unmapCommand function.\nAdding a userKeymap for storing the user-defined map is something I've wanted to add for a while now, but I don't consider it necessaary for this.\nAs for validation, I don't believe CodeMirror core does validation on any of its extensions, so I'd just not bother with it for vim either.\n. Cool. Looks like a nice clean API. Agreed that your alternate mapCommand proposal looks better. Would you like to submit a pull request?\n. That sounds like a very reasonable suggestion.\n. So looking back on this, Light Table has a solution for this https://github.com/LightTable/LightTable/issues/688. Does this not work for you?\n. Merged as e7598d0, thanks!\n. Merged as dfad61d. Thanks\n. The check was a red-herring. handleExternalSelection should not have been triggered in this case. Fixed in 11fa758\n. Unfortunately, because the behavior that was broken is async, I couldn't find a good way to test it\n. Merged, thanks!\n. I'd rather set didn't special case filetype. It opens up the path for a lot of clutter in set. Can you use the new callback support in ddbf33f and use defineOption to build this behavior instead? Aliasing ft to filetype in set is fine to me though.\n. Ah I didn't think that far. The options API here doesn't actually support local options. I've expanded it in https://github.com/codemirror/CodeMirror/pull/3200. Please take a look and see if it fits your requirements\n. Thanks. Merged as 346d16c and added 2c45249\n. Merged as a405048\n. @dbarnett please see if this fits your needs\n. Merged as 9e4e946\n. Merged as de9393f, made a small edit to pass lint\n. Merged as d5fbfc9\n. Repeat works for me with @:. Can you provide reproducible steps + browser info? Did you get any errors?\n. Ah, there isn't actually support for repeating Ex commands with macros, but I've added support for @: since it was simple enough.\n. Oops. I've made the prefix optional, but you still need to pass in undefined.\n. > Everywhere else in the documentation, an optional parameter could just be omitted, not set to undefined. I think the check of arguments.length that I mentioned earlier would be a better solution. That said, there certainly may be other constraints of which I am not aware, so certainly please do as you see fit.\nThat's not entirely true. If there is more than 1 optional parameter, and you want to set the second optional parameter, the first can't be omitted. You either need to pass in a value or undefined. I very much dislike method overloading in general, and fake overloading by omitting parameters in Javascript kind of just makes me cringe.\nThat said, the Vim API is a bit poorly designed to that respect. Unfortunately, the methods were added over time and all have existing usages. I only recently managed to document them. I will look into making the API cleaner in the next major release, but for now I can't tweak the order of arguments.\nI can, however, revert my last commit and instead update the documentation to say that the prefix is required, if you prefer.\n. That sounds fine too. Updated in fbd336f.\n. Hmm, either the CSS is messed up, or vim is trying to make the cursor 0 characters wide. I can't tell from just the picture. Do you have a reproducible example or a link to whatever you took the screenshot of?\n. Here's the bug:\nThe cursor is just a space rendered over text. It renders to the same width as the text because CodeMirror uses the default monospace font in the browser.\nText inside your CodeMirror instance is rendering with a non-monospace font. This is pretty obvious if you type something like lalalalala. Given that the cursor is a space, it gets a super thin space.\nThe non-monospace font seems to be caused by the lang=\"zh-CN in your <html> tag. I guess whatever font Safari uses for rendering Chinese monospace text isn't actually monospace.\nMy suggested fix is to have a CSS rule like the below to override the monospace font to whatever you want it to be.\ncss\n.code-editor-codemirror .CodeMirror {\n  font-family: Courier;\n}\n@marijnh do you have any thoughts on a fix we can do on our side?\n. @DelightRun I believe @marijnh means to have vim mode dynamically use the actual width of the character the cursor is on top of instead of relying on the monospace font. Different browsers and OS use different fonts and we don't want to interfere with those.\n@marijnh how do I go about doing this? Using charCoords() to get the size, compute the width, and then setting it directly on the cursor div?\n. > But on second though this is a bit scary -- it is almost guaranteed to add another dom-layout-round-trip and the payoff doesn't seem great enough to justify that.\n@marijnh Yes, I agree with that. The bug appears to be isolated to Safari for CJK pages and possibly other languages. If this problems comes up again, we can add it as a dynamicallySizeFatCursor option in vim mode or in core.\n@DelightRun CodeMirror should support arbitrary Unicode characters, assuming the font provides those characters as expected. Are you referring to a different issue?\n. We could expose a generic addRegister API on vim mode and let the integrating party deal with handling read/writes to it. I'd have to look into how feasible it is and what it would look like.\n. That was simpler than I thought...\n@kevinushey let me know if this rudimentary api is sufficient for your use case. https://github.com/codemirror/CodeMirror/pull/3315\nRegisters should really just be text buffers, but unfortunately linewise and blockwise yank complicates things a bit. And macro recording complicates it more... But if you just want the system register to act like a keybuffer, then the implementation should be pretty trivial\n. :d is not supported. I'm happy to merge if anyone wants to submit an implementation\n. Oops, adding the new register to the list of valid registers now. Also added a check that the register name is a single character.\n. Oops, adding the new register to the list of valid registers now. Also added a check that the register name is a single character.\n. Great, thanks for confirming! Merged\n. @kevinushey 7367b4db1ebb7a9b65d820b9c0ee953767ee8b8b adds name into the list of valid registers. Does that not work for you?\n@nightwing there are actually 2 clipboard registers, * and +. I'm unclear what the difference is. I think + is only for xterm. I don't see much use for more registers and I don't see overriding * as a common use case, so I'm okay with making the method called setSystemRegister and always set * too. Is that what you were getting at?\n. @kevinushey Line 961? https://github.com/codemirror/CodeMirror/commit/7367b4db1ebb7a9b65d820b9c0ee953767ee8b8b#diff-6dc93a20c528b2867b24cce681ef9872R961\n. For gq to be meaningful, CodeMirror needs to have some idea of how a file should be formatted. Right now, CodeMirror has some notion of how far code should be indented. It doesn't understand how code or text should break. It doesn't understand how comments should be break. I don't believe these concepts make sense in the context of an editing component either.\nSo I don't think this is a feature that makes sense to add to CodeMirror. That said, VIM mode has documented APIs for extending it in the environment it's used.\n. This is the expected behavior for vim. Indentation in normal mode should be done with >.\n. Yes, exactly. Smart indentation is indented only for 'insert' mode.\n> is for shifting blocks of text, and is the only indentation command supported in normal mode. See 'shift-left-right' http://vimdoc.sourceforge.net/htmldoc/change.html\n. @nightwing what is the expected behavior? That \"linewise\" is ignored and only the selection is copied? I don't use blockwise mode very often. Is there a general behavior for all linewise operators in visual block mode?\n. @vincentwoo glad you like it. I think search history and incremental search are both useful things that could benefit the core search addon as well. Unfortunately nowadays I only have the time to make bugfixes to the vim keymap. I took a look at the code, and based on the way these are implemented in the vim mode I'd have to rebuild most of the functionality. I don't have the appetite to take this on at the moment.\nI might come back to this later when I have more time, or I'm available for pull requests or advice if you are interested in doing it.\n. Sure. I'll try to take a look at this tomorrow, or latest by Friday.\nCheers,Yunchi\nOn Mon, Jun 20, 2016 at 5:20 AM -0400, \"Vincent Woo\" notifications@github.com wrote:\n@mightyguava I know you're not active developing the vim mode, but this might be an important enough fix to take a look?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub, or mute the thread.\n. Okay, yeah looks like this probably broke in https://github.com/codemirror/CodeMirror/commit/4fad3f82c4a40ef91883d04b83f1c1751b6c022a where I added the call handlers. I undid most of the work in that commit later but didn't revert that part.\nI've moved the Backspace handler the defaultKeyMap, and removed the autocomplete bindings. If you want to add custom bindings like autocomplete, you should be able to do it via the vim mode API.\nIt's been quite a while since I touched this project so I'm not fully confident on the changes. Please see if it looks sane and I'll merge it https://github.com/codemirror/CodeMirror/pull/4088\n. @vincentwoo \n. I actually have a change to rename lastMotion to a boolean stickyHPos, since there isn't really a use case for the last motion otherwise. What do you think? Would you mind making that change or I can do it later?\n. I was thinking of setting to false by default. I don't see many functions needing it.\nJust had another thought. An arguably cleaner way would be to add a makeHPosSticky (or just stickyHPos or something like that) option in motionArgs. That way we can set stickyHPos inside evalInput on vim according to the bit in motionArgs.\n. inclusive is also an option that is used only by evalInput, so I don't think it's too much of an issue. I think that having stickyHPos set by shared code is actually a benefit. We can then also define a different version of | that doesn't set the sticky bit (though that doesn't really make sense :p)\nUsing lastHPos that way would be breaking encapsulation. If you really want to let the individual functions set stickyHPos, maybe adding stickyHPos into the cursor object that is returned by them? Not sure if I like doing that either.\n. always\n. What's this lineOnly argument? Is this left over from _goto...?\n. This logic isn't quite right. The cursor will never go anywhere if it's on a mark going backwards. I think you should do a strict before/after comparison here. (A bit curious also why your unit tests didn't catch this... seems like they would)\nThis whole section could be simplified quite a bit yet again if you use ternary operators, like \nmarkIsAfterCursor = (motionArgs.forward) ? cursorIsBefore(cursor, pos) : cursorIsBefore(pos, cursor)\n  markIsAfterClosest = (motionArgs.forward) ? cursorIsBefore(closest, pos) : cursorIsBefore(pos, closest)\nDoing it this way also makes it easier to make forward/backward direct opposites of each other so you don't make logic mistakes like this.\n. javascript doesn't have block scope. It's more readable to put closest inside the for loop\n. Never mind about the logic being wrong, I got lost reading the code... Would prefer if you used ternary operators like i said above though\n. I don't think /g works in IE. Could you define this as new RegExp('-?\\d+', 'g')?\n. Should this be end < cur.ch?\n. Pet peeve of mine: Please wrap trivial conditionals. It makes code so much easier to read.\n. I meant wrapping with braces.\nelse {\n  return;\n}\nwould be preferable, else { return; } would be fine too. My eyes kept jumping to the line after else for the logic in the return until I realized there were no braces.\n. You are right. Please disregard.\n. Could you factor this and other constant objects (like modeInit and modeCompleted's options)out of this function? It makes for readability. I think it goes against Lisp style? But this is Javascript :)\n. Looked a bit more into the code. For something like this, I suggest you extract out a state object that contains all the local state as its properties. The state object is passed in as an argument to all functions in modeInit and modeCompleted. This way you can move modeCompleted and modeInit out without decoupling local states, and still make the actual findSymbols logic readable. I like that you have findSymbols as a controller for executing the logic in various modes, so that you have a separation of responsibility. The long initialization code blurs the concept though, and I think it would be better to separate them.\nA second suggestion is that instead of modeInit and modeCompleted, do something like:\nvar findSymbolModes = {\n   section: {\n      init: function(state) {\n        ...\n      },\n      isComplete: function(state) {\n      }\n   },\n   method: {\n      ...\n   }\n};\nWhether init is called would be conditional on if the mode has an init property.\nWhen you have a slough of variables like this that may or may not be temporary variables, local state, or constants, it's always better to extract out explicit state.\n. Can the cm.setBookmark be moved into the jumpList logic? And correspondingly do bookmark.clear() when the bookmark is removed from the jumpList? Not good to leave things not cleaned up.\n. There's already a cursorEqual() function for this.\n. This line breaks if the previous jump position was deleted. curMark will still exist but curMark.find() returns undefined. Could you add a check for that?\n. Please change this clause to symbol || isMatchableSymbol(symbol) for sake of clarity.\n. I don't think you need to swap q out of the keymap. Why not just special case it inside handleKey? i.e. if you are in macro mode, and you press q, end the macro recording directly in handleKey.\n. If you check for q here and exit macro mode, you can return and not have to swap out q from the keymap, or discard the last character in the keyBuffer.\nEdit: I think I finally see your concern about the second character (for commands other than q, like f). You could check if inputState.keyBuffer is empty. If so, exit macro recording mode.\n. I don't think these should be changed. These are codemirror format keys. Same for the other onPromptKeyDown function below.\n. Use charAt(0) so it doesn't break in IE, I forget if 9 supports it but small enough change.\n. So one of the reasons I wanted <Backspace> and <Enter> was because they match the codemirror names. If you use <CR>, then this mapping won't work for those keys.\nTo fix this, 2 ways would be special case the mapping here for those 2 keys, or change usages of <CR> and <BS> back. Either way, the various aliases for <CR> should be accounted for in parseKeyString in the ex mode code.\n. I can't seem to understand your regex. Can it not be /<\\w-\\w+>|<\\w+>|./? Why are ? and \\n needed?\nAlso, tiny nit, regexp.exec seems to be faster http://jsperf.com/string-match-vs-regexp-exec. But don't care much.\n. \\w does not match <, > so ? shouldn't be necesary. I brought up \\n precisely because of <CR>. Since we are going with <CR>, \\n should either not be a valid character, or be converted to <CR>\n. I see, that makes perfect sense. <\\w+?> probably doesn't need ? then?\n. This line should be reverted as well.\n. Should you empty the macroKeyBuffer here too? I'd actually feel safer if the keyBuffer was passed as an argument into executeMacroKeyBuffer instead of overwriting the macro recording state.\n. Nit: move this above logKey and remove the this.macroKeyBuffer.pop(); line in toggle.\n. I think @marijnh is still trying to support IE8, which doesn't implement forEach. Maybe a for loop instead? Also the insertModeHandleNormalModeKey call probably shouldn't be here yet.\n. Don't make a temp var for macroKeyBuffer. It's best to minimize the number of global variables.\nSimilarly, isMacroPlaying should be a property of macroModeState.\n. This should be part of a later pull request.\n. Is this change intended?\n. This logic can mostly be replaced with CodeMirror.keyName\n. Key conversion should have its own function. This is not sane to read.\n. Use CodeMirror.lookupKey(key, ['vim-insert'], handler) instead.\n. I think you are misusing stopPropagation. Please name it properly for what you are using it for.\n. What about Esc and Ctrl-C? It may be better to record the exit insert mode detection into exitInsertMode and record a fake ESC key in there\n. Fallthrough switch case statements are generally bad practice, as it is here. Use if/else instead to be more coherent.\n. Why record <CR> especially? Why not make the newline a part of the change chunk?\n. Are you sure this is the only way to intercept key events? Can it not be done with cm.on?\nWe can't use options.onKeyEvent because that will interfere with CodeMirror clients that want to use this low level hook.\n. replayInsertModeKey?\n. Separate this into 2 statements so it's readable.\n. Why is the ? back?\n. Do not add properties to changeObj. Make changeObjToString accept it changeObj as an argument.\n. The lookup logic is still better replaced with CodeMirror.keyName. Let CodeMirror.keyName parse the key into CodeMirror format. Extract out the key parsing code from handleKeyEvent_ into a parseCodeMirrorKey function and use it in both places. There's no need to have a concept of vimKey. All keys in the vim keymap should be vimKeys. Only the layers directly interfacing with CodeMirror events should have any concept of CodeMirror keys and should convert them immediately to vim keys. This makes for better abstraction and less confusion.\n. 1. it shouldn't be called global key if it only applies in insert mode. I think it makes more sense as a property of the macro state\n2. It's a bit confusing trying to track down when and in what order the stop key propagation bit is being set and used. Why is it necessary? What exactly are you using it for?\n. Oops sorry you are right. Yeah we discussed this and I thought it was merged before as well. Which is why I found it weird you added it in again...\n. Thanks for the explanation. I would instead just set the key to null or undefined. Makes it clear it's been consumed.\nYou can leave stopPropagation if you are so inclined, but please add a code comment where it's defined and list exactly what you have above. As you know stopPropagation is usually used in to stop an event propagation within a single event loop, not across 3 separate event loops, so its usage here can be a bit confusing.\n. You seem to be right. @marijnh would it make sense to add on(\"keydown\"), etc to the codemirror API so that multiple handlers can be reigstered? Otherwise our choices are to commandeer cm.options.onKeyEvent, or to use the keymap and list out every key that can possibly result in cursor movement.\n. Just a nit. I was thinking\nkey = modifier ? modifier + '-' + key : key;\nkey = isSymbol(key) ? \"'\" + key + \"'\" : key;\nor if/else.\nNested ternary operators are hard to read.\n. I see what you mean. Still, changing toString for this is quite an abuse of the method, considering it's more meant for display use.\nLooking at this from a different perspective: lastChange isn't a key. Yet you are storing it inside the keyBuffer. This is making things more complicated than necessary. Maybe you could instead store it as a separate changeBuffer on the macroState object. When this chunk of changes is complete, push the keys into the keyBuffer individually, and continue with a different chunk.\n. I see. According to the documentation \"text is an array of strings representing the text that replaced the changed range (split by line).\" There's a bit of trickiness here. If you press Enter, then you get ['',''], without taking automatic indentation into account. On the other hand, if you paste something like abc\\n  def, you get ['  abc', '  def'], which does have automatic indentation. I'm not sure how to work around this. @marijnh do you have thoughts?\nI'm going to guess that if Enter is always an individual change event. While we probably shouldn't rely on it, I don't see a way around it. If you get an ['',''], assume it's an Enter and record <Enter>. If it's anything else (multi-line), assume it's a paste and record \\n for the breaks. And then during replay, if Enter is encountered, trigger an Enter. If \\n is encountered, simply insert it as a character.\nFinally, it doesn't look like you are processing the next property on change objects. According to the documentation: \"If multiple changes happened during a single operation, the object will have a next property pointing to another change object (which may point to another, etc)\". I've managed to make it show up by pressing a key and then enter together very quickly.\n. Just remembered that paste and insert have separate origins. There shouldn't be any difficulty picking Enter vs \\n then. Enter for insert, \\n for paste\n. Consolidate the 2 if statements. You should probably also do vim.inputState = new InputState(); here too.\n. Does setting curStart.ch = null and then calling setCursor(curStart) always put the cursor at the end of the line? If so then I'd prefer if you make the intent clear here. If not, could you please explain?\n. I see, thanks for that. Comment would be good.\n. Need to register the click handler here too.\n. yeah sorry, this one covers the inverse. Mouse select from click & drag.\n. That sounds reasonable. The logic should be similar to the matchbrackets.js addon. @marijnh?\n. Ah I didn't notice the defineExtension call. Yes we can use that, though it's missing the ability to match opening and closing quotes.  Does that sound like something reasonable to tack onto the matchbrackets addon even though it's not actually a bracket?\n. Could you add a setForMacro function or something similar? It's ugly to modify state via setText sometimes and directly other times.\n. Nit: Could you add the space back after the if where you removed it throughout? And for new additions.\n. A few comments about what this function is for would be nice and how the data structure that gets returned is meant to be used would be nice.\n. This block can be replaced with var text = Array(actionArgs.repeat).join(text).\n. This code existed to handle keys modifiers and special keys like <C-w> and Space. Your current code treats each character as a separate key.\n. Use input instead. In general, avoid reading unexported properties of prototypical objects.\n. I'd rather not have the special case here. Instead, add an excludeFromCommandHistory: true onto the exCommandMap entry for registers and check that here.\n. The style convention in this file, and in most of this codebase, is to always have a space after comma. Please correct that throughout your changes in this commit.\n. Don't abbreviate. Write insertModeChangeRegister. If the client cares about code size, they can minimize.\n. Separate this into 2 unit tests, one for each register\n. I'd store this directly on vimGlobalState, not on the searchState part, so don't need the setters and getters. Make sure to define it in resetVimGlobalState, initialized to null or undefined. I'd also rename it to lastSubstituteReplacePart\n. Should probably do this after the parsing step, and throw an error if there is no replacePart and lastSubstitute is null.\n. Why do you special case the visual selection registers? Real vim doesn't seem to.\n. The _ in _cm is here to suppress the unused variable error generated by the linter. You should remove it since it's no longer unused.\n. Nit: Always put spaces around operators, e.g. around ==. Consistent style goes a long way towards readability\n. I'd cache the whole cursor returned by mark.find(), and then do\nvar pos = mark.find();\nreturn motionArgs.linewise\n    ? { line: pos.line, ch: findFirstNonWhiteSpaceCharacter(cm.getLine(pos.line))\n    : pos;\nNo reason to call it twice\n. Let's modify the test to add some spaces on line 3 so that it ensures the cursor ends up on the first non-whitespace character\n. That's not the behavior I see in vim, nor do I see the behavior you describe documented anywhere. Try running vanilla vim with vim -u /dev/null\n. Instead of using replaceRange, create a separate test. More specific tests are more informative and usually much easier to debug.\n. Nit: space after ch:\n. searchAsInPrompt isn't particularly descriptive. Instead of adding a searchAsInPrompt argument here, I'd add a wholeWordOnly: true argument to * and #.\n. You can just do if (isKeyword && !searchAsInPrompt) can't you? Try not to nest conditionals as a general rule. It get confusing fast.\n. That's a good point. Reusing a single CodeMirror instance sounds good. I will look into it soon. I'll just merge this then.\n. Yeah, fixed.\n. Why do you use cursor, can't you just use selectionEnd?\n. Strange as it is, the behavior I see from real vim when you select upwards and press A is that the cursor is moved to the front of the bottom line, i.e. in front of anchor. Let's match Vim's behavior\n. This code opens up new prompt every time a character is typed without closing the old one. It'd be better to update it to open a new prompt only if a query is looked up from the history buffer.\nYou can update showPrompt to return a function that closes the prompt. It's supported by the dialog.js extension. You'd just have to pass it through.\n. Don't save an empty query.\n. You could remove your repeated up ? ... : ... statements here and below if you define a var dir = up ? -1 : 1 and use that as an intermediate.\n. I don't think you need to have separate logic for handling an empty prefix. Why does it matter if it's empty or not?\n. Let's rename this nextMatch. getQuery has a connotation that you are doing a direct lookup and should return the same value every call given the same arguments, vs searching through a buffer.\n. Should probably call this something other than close now. @marijnh are you ok with this change? Not the best API but changing the return type might break a lot of things.\n. This isn't. I was thinking that the alternative to this would be to change the return type to something more robust.\n. I get it now, your implementation depends on the prefix not being in the historyBuffer. If it is in the historyBuffer, you use the previousPrefix.\nThis is a rather poor assumption, since it's not unlikely for prefix to match a previous search term or ex command. It would be better to maintain extra state about whether the value in the input is user entered or autocompleted.\n. I'm trying to say the current way of indirectly determining whether the input is user entered is not correct. Suppose the previous search terms were [d, a, ab]. If you now type a into the search box and press Up, you would get matches d, a, and ab in that order. The expected matches should be a and ab.\nIt would be much less convoluted to keep track of this explicitly instead.\n. Can't you just initialize it to 0 in the constructor? I don't see how this conditional can be true more than once.\n. You should only reset if the input changed. Right now it would reset if you press Left or Right or any other key that doesn't enter anything\n. Duplicating code should be avoided as much as possible. Could you extract the above into a function that given a slash-delimited input with an arbitrary number of slashes, return a list of tokens? It should handle escaping.\n. :global is linewise. There's no need to use searchcursor. Just iterate over each line and do a .test() on each line.\n. Per the documentation for :global, \"In a second scan the [cmd] is executed for each marked line with its line\nnumber prepended.\" Let's pass the range here the same way instead of sticking state onto the exCommandMap. s should be called once for each matching line, not given an entire range.\n. Kind of a corner case, but should lineEnd be equal to lineStart or lastLine if params.line is specified but params.lineEnd is not?\n. This is not a very descriptive name for the function. Something like splitBySlash would work much better.\n. Can you change substitute to use this function as well?\n. What should happen if there is no cmd?\n. I don't understand what you mean here. If argString is of the form ' hello/world', tokens will not be empty because there is a slash in there.\n. This seems inefficient. It's equivalent to do ranges[ranges.length - 1].anchor\n. Do not touch doc.sel. You should never change any state stored under doc or cm except cm.vimState. Can you work around this?\nIt looks like this is trying to remove a line from the selection? Then you should be able to call getSelections, slice out a line, and then call setSelections\n. I don't quite understand why you need to use setExtending in combination with manually managing the selection with addSelection.\n. Then call ranges.reverse() separately. Compressing code like this only makes things more confusing and bug prone.\n. \"In case of Visual Block Mode\" is obvious from the if statement. Explain why you need to short circuit here. And also wrap your if body with {}\n. It would be nice to comment on what this function does and how it works.\n. var swap = getIndex(ranges, selectionStart) > -1\n. if (!selectionStart || !selectionEnd)\n. Why do you need to call updateLastSelection here? Aren't you reselecting based on the last selection?\n. Why is this conditional no longer needed?\n. De-indent 2\n. Did you need to move this line? updateLastSelection shouldn't change selectionStart and selectionEnd here right?\n. I really don't see where updateLastSelection changes ranges. Please reference a line number\n. Still waiting for a reply on this.\n. Please split out the part where you are restoring the last selection into a separate function, and call it explicitly when in replay mode. Or, this might be easier, split apart this function into 2 subfunctions that it calls so things are obvious:\nfunction getSelectedAreaRange(cm, vim) {\n  if (!vim.visualMode) {\n   return getLastSelectedAreaRange();\n  } else {\n   return getCurrentSelectedAreaRange();\n  }\n}\nRight now it's rather confusing what this function is doing.\n. Yes, but that's an existing issue, and should only impact symbols keys not character keys.\n. Changed the function name instead.\n. Done\n. Done.\n. Added comments.\n. I think this is also explained by the command added in commandMatches.\n. I've been trying to move towards single line if they fit. Makes some of the functions here much easier to read.\n. Thanks, patched in a5e36cf\n. Why do you need to check lineLength(cm, head.line) > head.ch? Everything else looks good.\n. Technically, it's not, but we want to match vim where possible, so I added a TODO to document it.\n. Fixed, I was just being lazy.\n. I don't understand what you mean by this. findKey is a new function added to use for CodeMirror keymap's call param. handleKey's API has not changed, so there should not be any side effects\n. Ah, the documentation is out of date. Updated.\n. Went with your first option\n. Added a comment to defineOption to clarify that it's currently not possible to define a buffer-local option that does not have a global value. I mostly didn't add it to the current API because I'm planning to change the signature a bit in the next major release. The current one has far too many arguments.\n. ",
    "iclanzan": "Please implement multiple cursors/selections. I find it extremely useful.\n. ",
    "slang800": "+1 ... where can I go to throw money at this?\n. +1 for \"next occurrence selection\" ... I use that all the time\nAlso, sublime's Ctrl +Shift+L to break up a selection into multiple selection by lines is really useful.\n. Whoo! @twiss - thank you SOOO much for working on this! I have really been looking forward to seeing this feature added to CodeMirror.\n. ",
    "remy": "Nicely done. One bit of feedback (initially), esc tends to put the cursor back into single cursor mode. It took me a while to figure out how to go back (mostly because I was using the keyboard to type in multi cursor, so didn't initially think of just clicking else-where).\n. Just my suggestion: \n1. clicking (as it does now) goes back to single cursor. \n2. if multiple cursors are in place, then hitting escape goes back to the first cursor\n3. if the user has overridden the escape key inside CM, then the multi cursor ignores escape\n4. expose a method that the author can call to remove the multi cursor (i.e. if I want to make the keybinding cmd+esc for instance, I can then call the removeMultiCursor method...or something).\n. Nice :dancers: \n. Sorry @marijnh that was my fault, when @JimUBC said the issue was appearing in jsfiddle, I took the common comment, I didn't realise it was a different issue.\nAs you were.\n. It's @remy by the way :)\nWe'll merge this change in this week to jsbin.\n. Then surely this logic should be removed from the source entirely? If it's\na redundant check that should be controlled through a key binding (not that\ntoggle would work...but that's a different issue).\nIt also means the documentation needs updating, because it suggests that\nblock comments can be enabled via options, but it conflicts with line\ncomments.\nOn Sat, 13 Jun 2015 20:30 Vincent Woo notifications@github.com wrote:\n\nThat's expected behavior. Sublime also line comments by default. If you\nwant to do block commenting, you can very easily bind a key to\nblockComment.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3328#issuecomment-111742250\n.\n. \n",
    "grssam": "Alt-Esc on Windows 7 kind of switches between open windows. You might want to prevent default and stop propagation.\n. Ok then, for some other reason, Alt Escape is not working. That is, it is not bringing my number of cursors back to 1.\n. I tested there only. As soon as I hit Alt Esc, my window changes to other program and the multi selections still remain there.\n. Can't you have a mapping such that it always is called even if users replace it using extraKeys or keyMappings ?\n. Um... This is my tab method:\n``` javascript\n    cm.addKeyMap({\n        Tab: (cm) => {\n          if (cm.somethingSelected()) {\n            cm.indentSelection(\"add\");\n            return;\n          }\n      if (this.config.indentWithTabs)\n        cm.replaceSelection(\"\\t\", \"end\", \"+input\");\n      else\n        cm.execCommand(\"insertSoftTab\");\n    },\n    \"Shift-Tab\": (cm) => {\n      cm.indentSelection(\"subtract\");\n    }\n  });\n\n```\nWhen this.config.indentWithTabs is true, Hard tabs are inserted correctly, but when its false, nothing is inserted. The cursor does not move at all. What is the correct way to use the insertSoftTab command ?\n. I am using 4.0.3\n. ",
    "MattSturgeon": "This looks great, nice job!\n. I think this is actually a pretty good idea, to have a simple overview of how codemirror does things internally in an easy to find location. @ajvincent How specific do you think it should be?\n. I think your suggestion @marijnh makes the most sense if (key==up) cursor=sell.start; if (key==down) cursor=sel.end\nCollapsing in the direction typed gives the user control, and corresponds one keypress to one change on screen. Just my two cent\n. I'm using activeLines.indexOf() to prevent pushing a line to the array twice, if indexOf isn't defined though it'll just push the line anyway (to prevent an exception). If you'd rather I use another method or just let duplicates in without checking, just say so :)\n. ",
    "nodesocket": "@bfrohs I'll generate a jsFiddle shortly. It is going to be a bit difficult though because of the complexity.\n. @bfrohs I'll generate a jsFiddle shortly. It is going to be a bit difficult though because of the complexity.\n. Just finished up the fiddle.\nhttp://jsfiddle.net/Q9RqA/\nClick the button, then notice that the CodeMIrror box seems empty, though there is content, click into the box and type a character.\n. I got a fiddle that works. I know it is a strange example, the contents of editor are javascript.\nhttp://jsfiddle.net/dHCJN/1/\nNotice the inclusion of shell.js at the bottom. If I remove shell.js it does not break.\n. bump, any solution for this? Last issue I need resolved.\n. Thanks for the reply. The injected html is inserted into the textarea server-side, so parsing the textarea value in JavaScript, finding what I want to replace with html, getting the line and character is going to be messy right?\nWould be awesome to have a special codemirror tag like:\n{{codemirror parseHtml}}<a href=\"https://googel.com\">Google</a>{{/codemirror}}\nThat is then injected into the textarea, and codemirror when rending parses this.\n. ",
    "thomasgriffin": "Ahh, that's what I was needing with the caveat. Didn't know I would need to refresh the editor - here's what I used and it works fine:\njs\n/** Initialize the code snippet editor from CodeMirror */\n    var cwwp_code_editor = CodeMirror.fromTextArea(document.getElementById('cwwp-code-snippet'), {\n        enterMode:      'keep',\n        indentUnit:     4,\n        indentWithTabs: true,\n        lineNumbers:    true,\n        lineWrapping:   true,\n        matchBrackets:  true,\n        mode:           'application/x-httpd-php-open',\n        tabMode:        'shift',\n        theme:          'elegant'\n    });\n    $(cwwp_code_editor.getWrapperElement()).slideDown('normal', function(){\n        cwwp_code_editor.refresh();\n    });\n. ",
    "nabab": "Ok, thanks, I'll check the dev snapshot out.\nCheers!\n. And I confirmed it works fine now. Thanks!\n. ",
    "danielnitsche": "Great, thanks for the information.\n. ",
    "joscha": "using CodeMirror 2.33\n. ",
    "nickjs": "Of note, if your mode name doesn't include xml or htmlmixed at all, for example the mustache overlay demo, the regex still won't match. Is there a way to check the \"parent mode\" or some other similar mechanism?\n. Hey Marijn, this is great. Thanks so much for putting it together so quickly!\n. Hmm, since this is an area where Sass differs from SCSS (and I'm sure there are more), does it make sense to have separate modes for them? I'm actually really ignorant about the differences between the two, so forgive me if that's a dumb idea...\n. @peterflynn You're absolutely right, I had no idea. Thanks, I've made my code use the correct mode now!\n. Thanks @marijnh! I totally understand what you mean about closeOnBlur leading to fragility. I think the better solution would be somehow give more granular control to dialogs and/or the opener of a dialog about its close and open conditions. I'll think about this more and maybe send another PR :)\nIn the meantime, I'll add some docs!\n. Hey @marijn, I actually tried that first, but it started messing with some of the default indentation. Not sure why exactly, maybe something is depending on it being null/undefined?\n. @marijnh Nope, I was wrong, your patch is great, I'll close this one out.\nThe problem was that I was still using the sass mode for what was actually scss code, and so it was recognizing block comments as code and causing all the indentation to go funky. Totally my fault, sorry!\n. ",
    "pixelchild": "I too really wish there was a max length config option.\n. ",
    "gskinner": "For anyone else encountering this, here's a method I wrote to enable maxLength on CodeMirror editors. It hasn't been tested extensively, but seems to work properly with multiline copy/paste & regular editing. Just define a maxLength option on your CM instance, and add this beforeChange handler:\n```\nCMUtils.enforceMaxLength = function(cm, change) {\n    var maxLength = cm.getOption(\"maxLength\");\n    if (maxLength && change.update) {\n        var str = change.text.join(\"\\n\");\n        var delta = str.length-(cm.indexFromPos(change.to) - cm.indexFromPos(change.from));\n        if (delta <= 0) { return true; }\n        delta = cm.getValue().length+delta-maxLength;\n        if (delta > 0) {\n            str = str.substr(0, str.length-delta);\n            change.update(change.from, change.to, str.split(\"\\n\"));\n        }\n    }\n    return true;\n}\nmyCM.setOption(\"maxLength\", 25);\nmyCM.on(\"beforeChange\", CMUtils.enforceMaxLength);\n```\n. PS. I'll try to track down the exact version that this and #2577 broke in.\n. Here's an image demonstrating the differences. In v3.20, Safari looks the same as FF & IE.\n\n. This issue was injected in v4. v3.24 is fine, but v4.0.1 is not.\n. I was unable to isolate this in-library, but I worked around it in RegExr by having my highlighting logic track adjacent highlights and insert a 1px gap when necessary. It also had the side effect of letting me force all browsers to draw on-pixel.\n. Fair enough. My workaround is working fine, so no problems here. Mostly thought I should report it since it varied between versions, and was browser specific. Thanks for the response!\n. This issue was introduced in v3.22. Works fine in v3.21.\n. I wasn't able to find a fix, but I was able to work around this for now by disabling the hover behaviours while the mouse is pressed.\n. Great. Thanks!\n. So, it seems to be related to asynchronous calculations / layout. If I resize the window until this issue occurs, wait a moment, then force it to redraw the highlights again, then it will redraw correctly. \n. Looks like it is a problem with my code. In short, I was deferring highlight redraws by 500ms after window resizes, but due to a difference in how IE handles the event, it was only being deferred by 1ms, which is not sufficient time for CodeMirror to update after a resize.\nFixing it so that a 500ms delay was consistently applied in IE has resolved it. My only concern is whether there are cases where CM might take longer than this. Mostly, I'm just trying to ensure that my highlighting logic runs after CM's resize is done - is there a good way to guarantee this or should I just stick with the arbitrary 500ms (which, realistically shouldn't ever be a problem in my case).\nThanks again!\nJust as an FYI:\nI wrote a custom highlighter that draws to a canvas layered behind CM. The DOM level highlights are fantastic for many use cases, but this approach allows me to manage hundreds of thousands of highlights, and draw thousands of them at a time, with no real performance impact.\n. After some fussing around, I was able to find a solution that appears to size correctly and maintains autohide on the scrollbars. As Marijn suggested, this involved wrapping the CodeMirror element in a parent div. The parent div (which is sized via its flexbox parent) needs to have position:relative set, and the CodeMirror element needs to have position:absolute set. You can then set CodeMirror to 100% / 100% and it will fill the available space.\nHere's a working example for anyone encountering the same issue:\nhttps://jsfiddle.net/m37txcka/4/\nThanks for the help Marijn!. ",
    "billymoon": "Is the code still available anywhere?\n. ",
    "azawawi": "Have fun. Thanks for reporting it :)\n. Since you found it and fixed it. Take it :)\nHave fun.\n. Here is an example of a space-eating overlay. I hope you find it useful.\nCSS code:\ncss\n.cm-space {\n    background-color: lightgrey;\n}\nJavaScript code:\njavascript\nvar spaceOverlay = {\n    token: function(stream, state) {\n        var ch;\n        if (stream.match(\" \")) {\n            stream.eatSpace();\n            return \"space\";\n        } else {\n            while (stream.next() != null && !stream.match(\" \", false)) {}\n            return null;\n        }\n    }\n};\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"editor\"));\neditor.addOverlay(spaceOverlay);\n. Cool. Here is the updated code.\nCSS code:\nCSS\n.cm-whitespace {\n    background-color: LightGreen;\n    opacity: 0.3;\n}\nJavaScript code:\n``` JavaScript\nvar whitespaceOverlay = {\ntoken: function(stream) {\n\n    if (stream.eatWhile(/\\S/)) {\n        //Eat all non-whitespace tokens with no whitespace highlighting\n        return null;\n    }\n\n    // Consume the whitespace character\n    stream.next();\n\n    // And give it the cm-whitespace CSS class\n    return \"whitespace\";\n}\n\n};\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n    // If true, a single span for all adjacent whitespace characters will be used\n    // Otherwise a span per whitespace character will be used\n    flattenSpans : false\n});\neditor.addOverlay(whitespaceOverlay);\n```\n. Just for fun...\nAdd the following and you will get a small dot like most editors. I just added it to Farabi. Enjoy.\nCSS\n.cm-whitespace {\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAAxJREFUGFdjYGBgAAAABAABXM3/aQAAAABJRU5ErkJggg==);\n    background-repeat: no-repeat;\n    background-position: center;\n}\n. ",
    "ForbesLindesay": "Did this ever get looked at?  I've been trying to update the JavaScript mode so that it recognizes functions as \"in scope\" even if they were declared after they were used.  It's not proving easy...\n. The language has 1380 stars on GitHub and is only about 6 months old.  It has an enormous list of implementations, which I think suggests quite a few people are using it.\nAs for concrete examples of it's use, I use it as the configuration language for https://github.com/ForbesLindesay/stop and https://github.com/ForbesLindesay/mandate\nYou can see an example of such a configuration file: https://github.com/ForbesLindesay/demos/blob/master/.stop.toml\nI'd like to see support for TOML integrated into Brackets, which I believe means getting it into CodeMirror first.\n. Thanks, I'll be more than happy to maintain this and handle any bugs that crop up.\n. I don't think it's all that standardized at the moment, unfortunately.  It seems to be pretty implementation specific.\n. Awesome, thanks\n. @marijnh Yes, I'm happy to look into this.\n@arcanis Am I correct in thinking that the \\\\ doesn't really have anything to do with it.  i.e.\npegjs\nstart = [^\\\"This text should not be colored as a string]+\n      / [^\\\\\"This text should not be colored as a string neither]+\n      / [^\\\\'This text should not be colored as a string neither]+\n      / [^\"This text should not be colored as a string neither]+\n. @arcanis thanks, I'd forgotten that I'd made that case work.  I've submitted a pull request with the bug fix now so this should be resolved quickly.\n. I think if there was a way to deal with the stream.sol() that should probably work.\n. Also indentation, column etc.  Basically all the stream methods would need to be fixed to work with the indentation.\n. Yes, that works perfectly.\n. If anyone needs a pollyfill in the mean time:\nIf anyone needs a pollyfill in the mean time:\njs\nif (!CodeMirror.StringStream.prototype.hideFirstChars) {\n  var SS = CodeMirror.StringStream.prototype;\n  var countColumn = CodeMirror.countColumn;\n  SS.sol = function () {\n    this.lineStart = this.lineStart || 0;\n    return this.pos == this.lineStart;\n  };\n  SS.column = function () {\n    this.lineStart = this.lineStart || 0;\n    if (this.lastColumnPos < this.start) {\n      this.lastColumnValue = countColumn(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);\n      this.lastColumnPos = this.start;\n    }\n    return this.lastColumnValue - (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);\n  };\n  SS.indentation = function () {\n    this.lineStart = this.lineStart || 0;\n    return countColumn(this.string, null, this.tabSize) -\n      (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);\n  };\n  SS.hideFirstChars = function (n, inner) {\n    this.lineStart = this.lineStart || 0;\n    this.lineStart += n;\n    try { return inner(); }\n    finally { this.lineStart -= n; }\n  }\n}\n. Also CodeMirror.countColumn.  It looks like the StringStream is out of date.\n. I ended up needing a lot of adjustments so I decided to auto-build a node version from the CodeMirror source.\nhttps://github.com/ForbesLindesay/highlight-codemirror\nThe result is somewhat more complete.\n. I was using the polyfill for StringStream.hideCharacters\n. @MoOx highlight-codemirror works very well now.  Auto-generating FTW\n. That sounds like a good approach, we could then request brackets move to javascriptmixed as the default JavaScript mode.\n. :+1:\n. For what it's worth, I haven't touched that project since I first published it, so don't trust me too much on that one.  However, if someone else is keen to update it I'm happy to hand it over :smile:\n. Downloading the module is cheap, practically free.  What does matter is whether end users need to download it to their browser as part of the bundle, but this doesn't change that.\n. Yes, I agree.  It would probably be best to rename and then add an alias jade => pug so that anyone using the name \"jade\" doesn't suddenly have their stuff break.\n. The || DIFF_EQUAL here won't work because you just declared DIFF_EQUAL so it will always be undefined, You either need to make your variable have a different name, or get a reference to the global object first and then do something like || window.DIFF_EQUAL.\n. ",
    "cben": "What about simple limited lookahead?\nI'm specifically interested in markdown and rst underlined headers.\nCould also be addressed with background scan + change event hooks doing markText(), but that's way harder to write correctly.\nAlso, if the scan wants to call getTokenAt() to use mode's parsing (e.g. to skip literal blocks) without replicating the whole mode, then it's no longer background; the sanest approach I see is replacing scan with renderLine (when mode has already run), calling markText under setTimeout(0)...\n. AFACIT disableSpellcheck only existed in codemirror v1.\n. I'm also interested in this, but I do have a use case for highlighting list\nbullets/numbers:\nI find coloring the whole list text to be distracting, so I'd like to color\nonly the bullets/numbers.  (and maybe color the text in much subtler colors\nclose to black)\nIt'd be ok to use a single style (\"formatting\" is a good name) for all\nuses, since one can style any subset based on the other class, e.g.:\n.cm-em .cm-formatting, .cm-strong .cm-formatting {opacity:.5;}\n. Thanks for the changes, the old classes felt very arbitrary.\nShould I rename header1..header6 to header-1..header-6 for consistency?\n\n\nBut then you'd also want to add those classes when the mode is not mixed\n\nSounds like overkill - only people that expect to mix modes would bother styling those classes, no?\nCompare with multiplex.js - it doesn't support adding a class to all tokens, only delimStyle (already covered in markdown by formatting-code) and innerStyle (a new markdown cfg option?).\nLeaving outer tokens alone also means no performance concerns unless you mix heavily.\n. @bfrohs Do you intend to also handle lists this way, replacing variable-2, variable-3, keyword with list-#?\nAlso, a couple belated questions about quote handling (not complaining, just curious):\n- Why emit combined formatting-quote-2 styles?\n  Isn't it always possible to style .cm-formatting-quote.cm-quote-2?\n- What's the motivation for maxBlockquoteDepth resulting in error if exceeded?\n  Are there markdown converters that choke on too deep quotes?\n  If it's intended to defend the CSS author who can only style a finite number of levels, the old approach of using level % max seems more useful than presenting user with error style.\n. sudo apt-get install chromium-browser but I'd be surprised if there is a difference from Chrome.\n=> Indeed, also happens on freshly installed Chrome 31.0.1650.63 (stable) and 32.0.1700.72 (beta) on Ubuntu 13.10.\nDoes not happen on Chrome 23.0.1271.97 Ubuntu 13.04.\n. Turns out I can only reproduce this under Gnome Shell under my user (or my wife's), not under a freshly created user, so it's probably some gnome extension I have.  I'll try to narrow it down but unclear if it's interesting.\n. I can reproduce - typing ``` on line 17 (after the end of the existing code block).\nThe 3rd backtick is not shown but the editor bomes unusable - any attempt to type or move emits the same error.\n. See #839\n2014/1/15 Lukas Oppermann notifications@github.com\n\nHey,\nI think I found a \"bug\" in markdown.\nWhen I type the following, only the ===== gets classes for being a\nheader, and the text Header does not. I think either both should get this\nclass or none of the two, or maybe the ====== could get an additionally\nclass, if neither of the above work. Otherwise it makes it hard to style\ncorrectly. Thanks.\nHeader\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/2143\n.\n. Hmm.\nI don't see the fact that markdown was originally designed for conversion to html and that html happens to represent <h1>, <h2> etc as different elements (instead of nested sections) as decisive.\nBut it's true that <h1> is a plausible mnemonic for header1.\n\nI also don't feel strongly either way, I just want a decision before I contribute numbered headers for a couple more modes :-)\n. Correction: gfm mode is fine.\n. Is there an ipython issue tracking this?\nThe closest things to a \"spec\" for how underscoresBreakWords: false should behave are pandoc's intraword_underscores extension and Github flavored markdown.  Neither documents what \"inside a word\" means exactly.\nBoth disregard a_{ but start emphasis on }_a.  And even underscore between letters can close emphasis:\naa}_{bb_cc => aa}_{bb_cc\nThat sounds somewhat asymmetric and arbitrary, now I'm not sure if emulating them precisely is a win.\nIn any case, it's not sufficient for latex in markdown \u2014 pandoc, github & codemirror all agree that ${a}_{b}$ foo ${c}_{d} and $a*b$ foo $c*d$ emphasize \"foo\".\n\nA much better solution is using addons/mode/mode/multiplex.js to switch to stex mode between dollars (which prevents markdown mode from seeing the formulas!).  In fact that's exactly what its unit test does.\nIt also gives you TeX syntax highlight within formulas.\nIt's still not perfect:\n- It doesn't handle backslash escapes \\$.  It's somewhat tricky to extend multiplex.js to handle this.\n- For my markdown+latex use case, I'd like to still see outer styles (e.g. cm-header) within tex formulas.  I have an almost-working patch to support that in multiplex.js.\nSo I'm also considering implementing (optional) latex math directly in markdown.js.\nIn the long term, I'd like to add various pandoc markdown extensions to codemirror...\n. Bisected => 82fbd5d6f4acf0b81677ba937811f27b45bb6e29 is the first bad commit\nOn Mon, Apr 7, 2014 at 10:26 AM, Leonya Khachaturov \nnotifications@github.com wrote:\n\nThere is an error in the console: \"Uncaught Error: Mode markdown failed to\nadvance stream. \"\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/2447\n.\n. Wait, that's not useful, it's just where the underlying bug became an error.\n\nOn Mon, Apr 7, 2014 at 12:22 PM, Beni Cherniavsky-Paskin \nbeni.cherniavsky@gmail.com wrote:\n\nBisected => 82fbd5d6f4acf0b81677ba937811f27b45bb6e29 is the first bad\ncommit\nOn Mon, Apr 7, 2014 at 10:26 AM, Leonya Khachaturov \nnotifications@github.com wrote:\n\nThere is an error in the console: \"Uncaught Error: Mode markdown failed\nto advance stream. \"\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/2447\n.\n. Minimal example:\n\n\n\"$a $b\"\n. Indeed fixed.\nSorry for above commit noise (should not amend in public with bug # in commit message...);\nfinilized my tests in PR #2514.\n. I used some in the 2nd commit but fixed them all in later commits :)\nSo yes the failed test support can be dropped now (though I don't see the\nharm).\nOn Tue, Apr 29, 2014 at 2:08 AM, Marijn Haverbeke\nnotifications@github.comwrote:\n\nI don't see how a mode test that's expected to fail makes sense, and you\ndon't seem to be using any.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2514#issuecomment-41655270\n.\n. Oh, I see.\nI wanted to first write tests that should pass but are known to fail now (TDD style) and thought thought expected-fail tests are appropriate.  But you only intended them for situations when an exception is the correct behavior?\n\n=> Rewrote history.\n. Dave, not sure if that fits your use case, but if the pre classes you add in renderLine are a simple function of existing span classes, you could instead modify or wrap the existing mode's token() function to produce line-... classes and codemirror would lift them to the pre. \nExample: https://github.com/cben/mathdown/blob/ae4cbf5d6e621e32b7a44c0bf57a51059e6324a2/mathdown.js#L90-L109\n(but don't learn from how I monkey-patch an existing instance mode.token)\nSpecifically classes.replace(/(^| )(header\\S*)/g, \"$1line-cm-$2\"); (cm- is there because I wanted same class prefix as implicitly added on regular styles). \n. If the linked text is a deterministic function of the text (git commits\nhashes?),\nI'd first get a mode that styles the relevant span (e.g. gfm.js styles git\nhashes as 'cm-link'; should be easy to apply to shell mode with\naddOverlay()),\nand then hook renderLine\nhttp://codemirror.net/doc/manual.html#event_renderLine event to turn the\nrelevant spans into links.\nIf you're injecting html as an action, see markText\nhttp://codemirror.net/doc/manual.html#markText with replacedWith option.\nOn Sun, Jun 1, 2014 at 1:22 PM, Justin Keller notifications@github.com\nwrote:\n\nbump, any solution for this? Last issue I need resolved.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/marijnh/CodeMirror/issues/2601#issuecomment-44788164.\n. Working example: http://mathdown.net/?doc=demo-indentwrap\nCode:\nhttps://github.com/cben/mathdown/blob/428d6fe5a6cf54c9d4a8385cfced42079edcc323/mathdown.js#L151-L167\n\nThe indentation doesn't line up perfectly in my case because I'm generally\nusing a variable-width font,\nand while I do style leading spaces and bullets to be fixed-width [1],\ncm.defaultCharWidth() does not represent my fixed font, and I've been so\nfar too lazy to fix it...\n[1]\nhttps://github.com/cben/mathdown/blob/428d6fe5a6cf54c9d4a8385cfced42079edcc323/mathdown.js#L96-L114\n     plus styling .cm-leadingspace, .cm-formatting-list,\n.cm-formatting-quote in mathdown.css\n2015-05-16 7:01 GMT+03:00 mikagenic notifications@github.com:\n\nI've been trying to modify the indentwrap sample to create a hanging\nindent but no luck.\nWhat I'm trying to achieve is that for example for a line that starts with\na hyphen, when it wraps, the next (wrapped) line will indent under the\nfirst non space character after the hyphen and not under the hyphen as\nin the sample.\nIs this possible ? Can I get any pointers to implement this ?\nThanks!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3263.\n. Indeed:\nhttp://johnmacfarlane.net/babelmark2/?normalize=1&text=%23foo%0A%0A%23%23+bar\n\nBut it's notable that one of the few exceptions is CommonMark (the spec\nsays \"The opening sequence of # characters cannot be followed directly by a\nnon-space character.\")\nPerhaps it's better to make it an option?\n2015-06-23 8:18 GMT+03:00 Wes Cossick notifications@github.com:\n\nCodeMirror fails to add the class cm-header to headers that lack a space\nbetween the final '#' and the title. For example:\nH1 ... has class cm-header\nH2 ... has class cm-header\nH1  ... does not have class cm-header\nH2  ... does not have class cm-header\nWhether or not there technically should be a space, nearly all Markdown\nparsers will process #H1 without a space identically to # H1 with a\nspace. This leads to inconsistencies when formatting is applied to the\nheaders while editing using the cm-header class and when previews are\ngenerated using other parsers.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3343.\n. Not a bug.\n\nThe indented code is correctly colored - it's indented 4 spaces which is exactly how much list continuation lines should be indented.  It'd need 8 spaces to be parsed as code-inside-list.\n[Some other markdown parsers allow less than 4 spaces for list continuation lines.  CommonMark settled on using as much as the list marker + space after it \u2014 2 in this case.  But in any case, all parsers I'm aware of would require 4 extra spaces for a code block (so 6 in this case).  babelmark test => no parser treats this as code inside list.]\nThe fenced code block is not recognized because you're using the bare markdown mode.  Fenced blocks (and a few more things) are supported by the gfm mode built on top of the markdown mode.\n. Only relevant aspect that differs in the https://codemirror.net/mode/gfm/ vs https://codemirror.net/mode/markdown/ demos is that the markdown demo highlights the trailing spaces, while gfm doesn't.\nBut both actually apply cm-trailing-space-a and cm-trailing-space-new-line classes, it's just that only demo/markdown/index.html has CSS to make it visible.\n. Babelmark confirms that practically nobody parses this as code block.\nOnly cebe/markdown in GFM or MarkdownExtras modes a <pre> but without content.  (Apparently it considers aa to be info string, which it doesn't bother to output.)\nThe CommonMark rule is that info string can't contain any backticks.\nA single backtick gives more varied results:\nhttp://johnmacfarlane.net/babelmark2/?normalize=1&text=%60%60%60+info+%60%0Acontent%0A%60%60%60\nbut still only showdown, cebe/markdown in GFM or MarkdownExtras modes consider it a code block.  (many others emit a trailing empty <pre> since first `` info didn't open a codeblock, so they consider the last line ````` to open one.)\nSo I propose adopting CommonMark's rule as very simple and reflecting concensus.\n. Love the intent of an approximation, but this ignores for example beaaccac1ecfe9489fb51e4869af15a13fc2cd2.\nLet's see, the probability of 1 hex digit beeing [a-f] is ~~6/10~~ oops 6/16.\nThe probability of first 6 being [a-f] is ~~(6/10)6 = 4.6%~~ oops (6/16)6 = 0.3%.\ne5a13e622afb152e6411a8e8ce632a2cbe56b40a actually requires digit in first 7; (6/16)**7 = 0.1%.\nIMHO it's OK to be err on side of \"not hash\" for short 7-letter words, but for longer it's possible and would be nice to have much lower false negative rate.\nEDIT: I can't count :(, you were precisely right it's 0.1%.\nI'm gonna play with it anyway, as I also want to suppress opposite 1234567 being considered a hash.. I also see doc/docs.css references 'Source Sans Pro' (and pulls it from google) but that's in context of body { font-family: 'Source Sans Pro', Helvetica, Arial, sans-serif; } so clearly deliberate :heavy_check_mark: . ",
    "superlou": "Also interested in limited look-ahead, particularly for Fountain.io markup.  I've been able to mostly implement highlighting by updating state with blank lines, but I think the canonical syntax definitions rely on look-ahead.\n. ",
    "feizhang365": "e.g: mode http://codemirror.net/demo/search.html  use Find previous,  to find /id/  will cause memory leak\n. ",
    "mindplay-dk": "I'd like to just have a simple drag-handle, a bar running along the bottom edge of the editor, that the user can drag to resize vertically.\nThis seems like a pretty basic requirement? A standard textarea can be made user-resizeable.\nYet, I can't find an add-on or plugin or fiddle or anything else demonstrating this.\nHas anyone figured out how to make the window resizable?\n(it would be really nice to have a standard add-on listed for this basic feature - many of the listed/standard add-ons are far more advanced features than this...)\n. I disagree that anything to do with drag-and-drop in DOM/JS is easy to implement.\nIt took me an hour just to get this far and I still have no idea how to make it capture the mouse, so that the drag operation continues if you drag outside the window/frame. But I'm probably doing something wrong. There's a million ways drag-and-drop goes horribly wrong with DOM and JS.\nIMO the lib should offer functionality on par with a plain textarea. The question gets asked enough on StackOverflow, and nobody gives any practical answer or an example, just short remarks like \"do it yourself\", or in one case how to do it with jQuery UI, which isn't going to be the answer most people are looking for in this day and age ;-)\n. If somebody else needs it (or wants to take point on turning it into an add-on) here's a mostly working vertical resize bar. If you click and drag repeatedly, it still sometimes gets confused and \"sticks\", but most of the time it works. Sorry, I did my best ;-)\n. ",
    "Sphinxxxx": "@mindplay-dk https://github.com/Sphinxxxx/cm-resize. A small update: My cm-resize is now on NPM:\nhttps://www.npmjs.com/package/cm-resize. @JoseTadeuMarques - One problem: If the editor needs horizontal scrolling, you now get two scrollbars, and only one of them works:\nhttps://jsfiddle.net/cepg4t95/\nAny way to avoid that?. ",
    "lunakid": "Joining the club with probably the simplest (and therefore perhaps least brittle) implementation I've found so far: CodePen, or StackOverflow (with explanations). (Proof-of-concept example impl. only!)\nWhile functionally OK (on browsers supporting ...Observer (which means most), and CSS resize (e.g. not Edge yet), the appearance is not perfect:  there's some extra bottom padding to make room for the resize handle on e.g. Chrome.\nThe reason is because (a) CM, unaware of the handle, happily draws the scrollbars, the filler, and the text box there -- which (b) on WebKit (only?) extends underneath the scrollbars, and (c) I couldn't find a way to get the handle still rendered visible (on top of the other items + also clickable) on Chrome.\nFirefox, OTOH, draws the handle on the top of the other bits -- even over scrollbar arrows, if there happens to be one there --, and you can grab it, too, so resizing works even without any extra empty space.\nHowever, even for FF, just for a tidy appearance, it would be desirable if CM could either detect, or be instructed, that there's a resize handle, so room should be made for it when sizing the scrollbars, or drawing the filler. (I guess it's problematic because of that browser-dependency of calculating box sizes differently with scrollbars.)\nBeing no expert in the matter, hopefully I'm missing something obvious, which could fix the cosmetics too, so CM could finally have a proper resize handle, without resorting to convoluted workarounds.\nTo recap, CM should simply:\n\nhook the appropriate Observer object to get the resize events,\nand make sure the CSS resize handle can appear.\n\n@marijnh: as this approach does not add any custom UI to CM, could it be implemented right in the lib (preferably eliminating the current resizer DIV), to enable sizing merely adding a CSS resize? That would be wonderful.\n(BTW: I've also tried styling the .CodeMirror DIV directly with resize: both, and hooking the resize events (via the same ...Observer handlers as in the linked example), but I failed to get the scrollbars right with that approach, so gave up and resorted to an outer container DIV with the resize prop.). @JoseTadeuMarques, I'm puzzled. Can you show an example? Do you mean newer CM versions support it out-of-the-box? Which version did you use? Are you 100% sure that the CM instance itself is resizing, and you didn't just see a resizable box with scrollbars? (Which is, of course, not the same.) Thanks!. Guys, it's a bit too early for the celebration just yet. ;) \n@JoseTadeuMarques, unfortunately, what you see is not what you think: the CM instance is not actually resizing just by setting the CSS. What you describe and what you saw is only a HTML DIV resizing (which is quite unsurprising, adding a CSS rule for just that).\nTo understand what CM resizing really means, i.e. resizing the actual CM Javascript object (with all its geometry-related internal state), rather than just resizing a HTML box on the screen, see e.g. my demo at CodePen, where e.g. the line numbers + line wrapping clearly evidences how the editor properly recalculates its state with that method -- which was necessary exactly because just setting CSS resize does not cut it. (I.e. it will not pass resize events to the CM instance to get it recalculate its state!)\n(For those who want to understand the mechanics, please see the details in my original comment above.). Great, thanks a lot!\n. ",
    "JoseTadeuMarques": "in case this will help anyone, this did the trick for me:\n.CodeMirror {\n      resize: vertical;\n      overflow: auto !important;\n    }\nI got a resizable Codemirror Instance. @lunakid \nThe question in this ticket was this:\n\"I was wondering if CodeMirror could be made to support the CSS resize attribute. So that I could write something like this:\"\nfor this, I used what I said :\n.CodeMirror {\n  resize: vertical;\n  overflow: auto !important;\n}\nto try this out, open this:\nhttps://codemirror.net/demo/simplemode.html\nthen go to the Codemirror instance and inspect it. Then, in the div with class=\"CodeMirror\", try the css I just wrote. Then you will see the resizing working. Scrollbars are also applied obviously.\nI might have used the wrong words though, I can agree, as I'm not sure the instance itself is being resized. The box is however being resized, and the resize property is being applied properly, as asked in this ticket!\nI'd stick to @Sphinxxxx suggestion though with the new npm module tho. @Sphinxxxx use cm-resize :). ",
    "rzhw": "Not quite sure actually, tried that as my first fix attempt. Erring on the safe side with all HTML characters.\nIs it unnecessary for those to be escaped? I'll remove that (override this commit or create a new one?) if that's the case. Though I suppose such a small change might not really be worth a pull request :P\n. ",
    "jbt": "Yep, looks good to me!\n. ",
    "huangp": "version 2.33. \ncodemirror-compressed.js is generated at http://codemirror.net/doc/compress.html\n        includes:\n        - codemirror.js\n        - css.js\n        - htmlmixed.js\n        - javascript.js\n        - xml.js\n        - runmode.js\nSorry I can't find a demo with line wrapping and line numbers set to true.\n. Wow that's quick. Thanks guys.\n. I came across that stackoverflow link. But realize it only support a limit set of dictionaries. And type.js does NOT support Unicode languages. (Maybe this is the limitation of javascript?)\nI still think using browser's built-in spell checker is the best way. Gmail is doing that with a contenteditable div. \n. Just FYI to anyone following this issue. We did manage to trick the browser by setting contenteditable=true and spellcheck=true. It appears to work on Firefox (will highlight wrong words) and sometimes on Chrome (not always highlight but sometimes it does). But it has a major show stopper problem: when you use browser's spellcheck correction function, i.e. right click on the wrong word and choose the correct word, the value change event is not detected by codemirror. I am using version 3 not sure about version 4.\n. I tried with 3.16 and 3.20. I think I find something different this time. It only happen when I set \ncss\n.CodeMirror { height: auto; }\nThis will make the content display in full without scrollbar. When I added this, resizing browser window back and forth a few times (so the line wrap and unwrap) and it will happen (a bit random). I don't know whether this is a code mirror bug or what.\n. Yes it seems to work. Thanks.\n. It fixed the problem where content is ascii characters. But if the content is unicode, the cursor is still mad. \nTry this:\n``` html\n\n\n\n\n\n\n\n\n\n\n\u30db\u30b9\u30c8\u3068\u306e\u8a8d\u8a3c\u3067\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4f7f\u7528\u3059\u308b\u4ee3\u308f\u308a\u306b Manager \u306e SSH \u30ad\u30fc\u3092\u4f7f\u7528\u3057\u305f\u3044\u5834\u5408\u306b\u306f\u3001\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306e\u5185\u5bb9\u3092\u30db\u30b9\u30c8\u306e /root/.known_hosts \u30d5\u30a1\u30a4\u30eb\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n\n\n\n  var myTextarea = document.getElementById(\"code\");\n\n  var editor = CodeMirror.fromTextArea(myTextarea, {\n    lineNumbers : true,\n      lineWrapping : true,\n      disableSpellcheck : false,\n      mode : \"xmlhtml\"\n  });\n\n\n\n```\nAfter loaded, resize your browser window so the line wraps and then the cursor will go mad.\n. ",
    "xavadu": "I have exactly the same issue in the version 5.44.0. ",
    "tandraschko": "We use 2.2.5 but AFAICS the code hasn't been changed: https://github.com/marijnh/CodeMirror/blob/master/keymap/vim.js#L716\n. Great, thanks! :)\n. ",
    "dougkoellmer": "Sorry, I cannot.  My config looks like this:\nJavaScript\n        var config = \n        {\n            mode:\"htmlmixed\",\n            lineNumbers:\"true\",\n            readOnly:false,\n            indentWithTabs:true,\n            indentUnit:4,\n            extraKeys:\n            {\n                \"Ctrl-S\":onSave\n            }\n        };\nI've been testing some more, and if I continually add and remove text from the editor, the cursor eventually behaves correctly, but I can't give deterministic steps...it seems completely random.\nWhen the cursor is missing, it's because its height is 0px.\n. In the next few days, I will just send you the link to my project itself...hopefully it will be apparent there.\nThanks for your attention...expect some cash to flow your way if my app makes any money.\n. My baby didn't want me working the past few weeks...sorry for not posting an example.  I've updated to beta 3v2.  The cursor height problem is fixed, but the cursor invisible problem as described above is still there.  This time I've managed to narrow it down to the fact that the cursor will misbehave until you do a window resize, after which it behaves normally.  I've tried spamming different combinations of refresh, focus, setSize at different times and anything else I can think of, but for some reason manually changing the window size is the only thing that works.  shrug\n. I tried some other things, but settled on a workaround for now.  It's obviously hacky, but manually dispatching a resize event did the trick.  Used this as refererence: http://stackoverflow.com/questions/8712036/dom-event-fired-by-window-resize.\n. I haven't had time to isolate it, but I can give the basic STR now.\n1. Create a code mirror instance.\n2. Set the display to none on the element that contains the host element given to code mirror.\n3. Add the element containing the host element to the document.\n4. Upon user action (or just in a later execution stack) clear the display property so that the editor becomes visible.\n5. Focus the editor (user action or programmatically).\n6. If the editor has no text, the cursor will be invisible. That is, the cursor's style will have display:none or visibility:hidden (I forget which).\n7. A window resize, whether by user action or programmatically as described above, will show the cursor when you focus the editor again.\nI hope that helps until I have more time to isolate it.\n. Sorry, forgot to mention that.  I am doing that immediately after making it visible, before focusing.  I also tried doing it a \"frame\" later.\n. I'm not asking you to debug it, just making you aware.  Only time is preventing me, although I've spent quite a while commenting on it now.\nThanks for your help.  I'll post back when I have a demo.\n. Ok, check out http://www.b33hive.net/codemirror_issue_877_repro.html on latest Chrome (Version 22.0.1229.94 m).\nSmall correction to my STR: cursor is invisible because its height is 0px.\nAs I said, the issue doesn't confront me anymore, just thought you'd like to know.\n. Ok, check out http://www.b33hive.net/codemirror_issue_877_repro.html on latest Chrome (Version 22.0.1229.94 m).\nSmall correction to my STR: cursor is invisible because its height is 0px.\nAs I said, the issue doesn't confront me anymore, just thought you'd like to know.\n. ",
    "ComFreek": "Where do I find these tests? I couldn't find them in the CSS or Markdown mode directory.\n. @marijnh Done ;) I've created another typescript.html demo file in the mode directory. I wonder whether it would be better to only have one demo file. What do you think?\n. @marijnh You can just delete these lines ;)\nI wanted to commit this change myself but the git merge upstream/master command is giving me \"Conflict\" messages. Isn't there a way for forcing all local files to be overwritten?\n. The last command outputs:\nHEAD is now at f7317f0 Removed unneccssary if-else-clause\nThat's the last commit I've done so far.\n. I'm sorry, I have always pressed the Enter key ;)\nReally, how the hell did I confuse both keys?!? \n. We also have to change the sample files for each changed MIME type.\n@jankeromnes Is it possible that I add the necessary commits to your pull request? I could not find a simple way for directly adding changes to a foreign pull request.\n. @jankeromnes  I've forked the CM repository (deleted the old one) and pushed my commit to it. Have I done it right? https://github.com/ComFreek/CodeMirror\nOne suggestion though: I didn't need to change anything in some samples because they didn't specify any mode in the settings object passed to CM (the last loaded mode will be used then, right?). So, shouldn't we stay consistent across all samples (i.e. specify the mode everywhere)? This gives the option to quickly copy & paste it for a beginner.\n. ",
    "shaund": "I'm seeing the same behavior in firefox, but not chrome (at 2560 x 1600).\nIt might just be firefox, because even in this box I'm typing in now, if I hold down a key I see micro-stutters--though less than I see at http://uxcandy.com/~boomyjee/cm-test/cm3-slow/.\n. The changes made quite a difference. I no longer can notice a difference between a native input and CM\n. ",
    "boomyjee": "I thought, it was, but v3 has lots of other minor issues and important to me performance problems.\nI've created a ticket for this:\nhttps://github.com/marijnh/CodeMirror/issues/892\nv3 is too raw just for now.\nBut when i switched there was no cursor problem, it's true.\nIs there a way to fix this in other way? Maybe setting line-height explicitly?\nAnd if you're talking about future perspective, than yes - i'll definitely switch to v3.\n. ",
    "clausreinke": "Thanks. It works now. JS isn't nice for rewriting code without a safety net. \n(btw, the reduction of flickering from the other patches is also noticable in opera:-)\nAre the jsbins reported on this tracker going into some collection of regression tests? \nBeing able to run the regression tests before new releases would be confidence-building.\n. Good to know, thanks. Somehow I missed both that part of the patch and the test dir.\n\"All passed\" is always nice to see.\nThe sequences from this bug do not seem to be reflected directly, though:\n- mark, edit, undo, clear (not cleared, after undo)\n- mark, edit, undo, redo (no redo)\n\"bar\\baz\\bug\\n\": \\b or \\n (not that this matters;-)?\n. Yes, please stick to Vim. Having maintained a Vim plugin for several years, I can attest that there are no typical Vim users - they are all used to being able to configure their Vim to their liking. Well-meaning attempts to pre-configure tend to run into issues with some users, and key mappings are especially contested. In this case ';', repeats the latest line-wise character search 'f'/'F', which is useful for jumping to the next comma, for instance.\nGreat to see so much work on the Vim mode, btw! I don't regret having chosen CM over Ace, but until recently, their Vim support seemed more active, and it is good to see that remedied. I do hope at some point to move some of my Vim usage to a web-based solution.\n. > Actionscript is an ECMA script lang similar to javascript, but with more \n\nOOP features ...\nUltimately though my ambition is to fork brackets to create a code\naware  IDE for actionscript with a strong autocompletion engine etc. \nResponsibilities for things like code intelligence obviously shouldn't \nreside with CodeMirror, however i figured it would be a good idea to \nhave a solid base to extend a simple naive mode into a more feature \ncomplete one over time. Only been poking around for a couple of \ndays, so open to suggestions. \n\nWouldn't that put your efforts close to ECMAScript 6 (what the\nJavaScript mode is going to move to) and TypeScript (for which\ninitial CM mode and Brackets plugin exist)? \nNot saying its is all the same, and I have no idea whether \nActionScript implementations expose any kind of language \nservice API (as the TypeScript implementation does), just \nthinking in terms of sharing efforts, code, and organisation.\nhttp://codemirror.net/mode/javascript/typescript.html\nhttps://github.com/tomsdev/brackets-typescript-code-intel\nClaus\n. > Okay, probably good suggestions. What I know is that actionscript was \n\ndesigned to be ECMAScript 4 compliant, though by the time the spec was \nfinalized actionscript had broken spec in a few places as it had already \nbeen released to market at that point. What those departures are I actually \nhave no idea, and would need to ask Adobe engineers. Also I'll be honest \nthat I'm not well versed with what the differences between the incarnations \nECMAScript are. \n\nThe way I understand it, ES4 was considered too ambitious, so ES5 \n-the current standard- was agreed on as a smaller step forward, which \nis quite different from AS3. Both AS3 and ES5 designers have stated\nthat they feel the languages are different and likely to diverge further.\nES6, currently in development, is bringing back some of the difference \n(minus the controversial stuff, and with other redesigned features). \nTS implements some of the ES6 features (such as classes) via \ntranslation to ES5/3, and adds types, so is probably the version\nclosest to AS3 (even the type systems feel similar, from reading).\nMost of the differences are in semantics, so shouldn't matter too\nmuch while you're focused on syntax highlighting.\nClaus\n. ",
    "viktoralekseev": "Ok, i will try to reproduce this bug once again and replay to you in 2 days.\n. I can not reproduce this bug on clear v2.34. I think this bug is related to my custom changes and can be closed.\nSorry for inconvenience!\n. Thank you for CodeMirror! :+1: \n. ",
    "johnjbarton": "Ah, ok now I'm beginning to understand. \nSince I am able to view 24 lines I expected onViewportChange to report 0,24.  Now I realize that \"viewport\" does not mean \"viewing portal\" but rather \"rendered DOM behind the viewing portal\".\nAnd your comment about viewportMargin makes sense now. viewportMargin is not \"the viewport's margin\" as in padding/border/margin and it's not \"100px\".  Rather viewportMargin is \"size of the renderedDOM behind the viewing portal\" defaulting to 100 lines of source code.\nOf course I thought \"viewport\" was obvious enough that explaining what I expected was unnecessary ;-)\n. I am not able to reproduce this on the codemirror index.html by applying the styles from our page. Maybe this is interference on the JS side.\n. \nOn the left side, the codemirror instance shows the cursor motion bug, on the right the cursor works fine.  On the left side the gutter has the wrong size; on the right the gutter is correct.\nThe cursor failure seems to be caused by the same scaling problem as the gutter.\nDefeating the measurement cache does not alter the result.\n. If I open the URL for the tracuer demo (after node expressServer.js in ./demo):\nhttp://localhost:8099/demo/repl.html#function%20foo()%20%7Breturn%205%3B%7D%0Avar%20a%20%3D%201%3B%0Avar%20b%20%3D%202%3B%0Avar%20c%20%3D%203%3B%0Avar%20d%20%3D%204%3B%0A\nthen the gutter is correct. \nIf I reload the gutter is incorrect.\n. CodeMirror-gutters height is set by \njs\nfunction paddingVert(display) {return display.mover.offsetHeight - display.lineSpace.offsetHeight;}\nvar totalHeight = docHeight + paddingVert(d);\nd.gutters.style.height = Math.max(totalHeight, d.scroller.clientHeight - scrollerCutOff) + \"px\";\nIn the cases I looked at, the height computes to approximately display.mover.offsetHeight when updateScrollbars() is called. But later display.mover.offsetHeight (set by layout, not by JS), changes and the gutters do not track that change.\nSo somehow I am triggering a layout change that cm does not detect. \n. The layout change is related to font-size. Using the default font my pre boxes are 13.3px high. and everything works; if I set .CodeMirror font to 12px, my pre boxes are 15.5px high but the gutter is still number-of-lines times 13.3px.\nSo the workaround is simply to not set the font size on .CodeMirror and let users apply control plus or control minus to resize fonts (which works fine).\n. I believe that the problem here was min-height set on .CodeMirror rather than on .CodeMirror-scroll.\n. Please see #3677\n. Well our analysis was all wrong.   \nIf we get lucky, then \nmeasure.clientHeight 827 sWidth 12\nin NativeScrollbars update(), and we never call the zeroWidthHack().\nIf we get unlucky then these values start as zero, and we set pointerEvents=\"none\" then don't recover.\nEvery time we switch files in our tool we are unlucky  :-(\n. I dug in to this further. Note that our results vary if we stop on Chrome Devtools breakpoints. \nWe seem to go through a state where measure.clientHeight > 0 but sWidth == 0 so the zeroWidthHack() is triggered. Once it triggers we end up taking the true branch in\nif (elt != bar) bar.style.pointerEvents = \"none\";\nSo if we could avoid triggering the zeroWidthHack() or if we could have elt == bar, we would not have the bug. Somehow we are using CodeMirror in way it's not quite expecting, both in terms of order of operations (clientHeight and nativeScrollbar width changes) and in terms of how elements are arranged (elt vs bar). \nI'd love to have a simple reproduction, but it seems hard. \nFor now we set \n.CodeMirror-vscrollbar {\n  pointer-events: auto !important;\n}\n. With measure.clientHeight and sWidth non-zero we change codemirror on a resize event:\ncodeMirrorWrapper.on('resize', function() {\n    this.codeMirror.refresh();\n...\nThat results in clientHeight 0, sWidth 12. \nNext we change the content:\nthis.codeMirror.getDoc().setValue(contents);\nThat results in clientHeight 0 sWidth 0.\nThen we call CodeMirror.setOptions(), which later calls\njs\nfunction wrappingChanged(cm) {\n            if (cm.options.lineWrapping) {\n                addClass(cm.display.wrapper, \"CodeMirror-wrap\");\n                cm.display.sizer.style.minWidth = \"\";\n                cm.display.sizerWidth = null \n            } else {\n                rmClass(cm.display.wrapper, \"CodeMirror-wrap\");\n                findMaxLine(cm)\n            }\n            estimateLineHeights(cm);\n            regChange(cm);\n            clearCaches(cm);\n            setTimeout(function() {\n                updateScrollbars(cm)\n            }, 100)\n        }\nAnd the updateScrollbars call here changes clientHeight to 594 while sWidth remains 0.\nDoes this help?\n. ",
    "aslushnikov": "This bug is back to life:\n1. Go to http://codemirror.net/demo/preview.html\n2. Substitute second line \n<html>\nwith\n<html a b=\"2\">\n1. Observe that =\"2\" have \"cm-error\" class\n. Just for the record: border-box model actually results in a duplicated horizontal scroll (if any).\n\n. Thank you for the workaround!\n. > Is the \"Do not insert closing bracket if a spacechar or closing bracket follows cursor\" behavior based on any convention?\nThe plugin mimics Sublime Text 2 default behavior.\nThanks!\n. Looks like this is not yet fixed.\n. Great job! You commit covers almost all functionality the add-on brings in. The only exception is the situation when the cursor is in the very beginning/the very end of the line. \n1. In your version, it ignores line breaks\n2. In the addon, it just moves to the end/beginning of another line\nThe second case mimics Sublime Text and I am personally more comfortable with it. If you are OK with this behavior, I've left some comments on your commit. \n. It looks like I'm not clear enough in my description. Let me bring in a test case to clarify things.\nHere is the snippet with a cursor marked as |\nfunction foo()\n|\nIf we hit Ctrl-Backspace now, it will translate snippet into the followign\nfunction foo|\nOn the contrary, given the same starting position, Sublime will convert this into the following:\nfunction foo()|\nThose comments on your diff are results of my hackish attempt to bring in Sublime's behavior.\n. Sublime moves it to the start of the second line.\n. Sublime moves it to the start of the second line.\n. My mistake :)\n. Or not :)\nWhat do you mean by \"empty lines\"? Do you mean \"lines full of spaces\", or just \\ns?\n. So, I did a small research regarding this corner case. There were 4 editors, in each i inserted this code\nfunction foo()\n|\nand hit Ctrl-Left. \n- Textmate behaved similar to CodeMirror: function foo|()\n- ST2, Eclipse and AppCode (IntelliJ idea core) all did the same: function foo()|\n\nStill, do you feel this behavioral difference is a problem?\n\nThat's a problem for me, and it looks for me that client base of ST2 + Eclipse + IntelliJ is more then that one of TextMate. So more people got accustomed to this thing.\nAnyway, if this behavior won't be in a standard CodeMirror functionality, I'll simply make an addon :) \nThank you for your time!\n. Yep, that is good as well.\n. Thanks!\n. Thanks for the patch! \n. Thanks for the reply,\nI'll give it a shot.\n. Great, thanks!\n. Do you mean smth like this?\n. That works for me, thank you for your time.\n. The following repro works for me in Chrome 26.0.1410.63 (Linux)\n- Go to http://codemirror.net/demo/complete.html\n- Hit Ctrl++ twice\n- Update CM's size with document.body.style.width = \"881px\"; editor.refresh();\n. Does the editor.lineAtHeight(0, \"local\") return the top visible line? It always returns 0 for me\n. Thanks, that works.\n. It looks like scrollIntoView method doesn't work properly now: the topmost line is not 100% visible (step number 4)\n. It seems be working for me,\nThanks!\n. I'm ok with it, but it breaks scrolling experience as we don't reschedule highlighter during continious scrolling session (so it gets executed and interrupts smooth scrolling). How about additionally adding startWorker(cm, 100)  to setScrollTop method?\n. Verified; thanks!\n. > Are you saying the individual calls to getBoundingClientRect are the slow part, not the fact that you're actually forcing a layout with the new stuff in the DOM?\nCaching of getBoundingClientRect actually saves a bit, but not much: without it rendering time goes up to 1200ms. (I'm still talking about rendering of 75k chars in a line) So the most time is still spent in layouting. \n\nOne concern I have is that browser don't all render characters at rounded pixel coordinates, you might easily get rounding errors this way. \n\nThinking about it a bit more I suddenly realized that the approach obviously won't work for nonmonospaced fonts with kerning pairs. But under the constraint of monospaced font (which imply that width(string) = sum of widths of string chars) it should be perfectly good.\nGiven this, how about a \"codemode\" option for codemirror which will assume the font to be monospaced? Though this is not a general solution for the problem, it would make it possible to render very long lines which you hit here and there in CM-based IDE's.\n\nIn any case, there's a rough outline of a different solution in issue #1022 , which is to measure precisely, but don't do it for the whole line at once, only for the visible/edited parts, as needed.\n\nI have an on-going effort to implement this, but it is still not-working and far from any 'proof-of-concept' state. \n. > doesn't the browser cache the layout information for all elements when it does a layout, thus making further reads (the separate calls to getBoundingClientRect) of the layout information very cheap, as long as no changes are made to the DOM?\nIndeed, after the layout was done, the consecutive calls to getBoundingClientRect are relatively cheap. I say relatively because getBoundingClientRect still has some code to run and it doesn't do any caching (at least in chrome). \nThus said, saving returned value of getBoundingClientRect in javascript where possible is a good idea which turns out to save some time. \nIn the patch I attached to the issue, a lot of elements in measure array reference the same span element (which is the main point of the patch). Instead of calling getBoundingClientRect many times for the same span, I call it only once and then reuse the value. This saves roughly 1200ms for my test case.\n. > Ah, I missed that part. How does this happen, though?\nIt references \"same actual span element\" - see my clarifying comments on the patch\n. I have some thoughts about this that should considerably reduce amount of large hops; i'll try to implement this after I polish/finish this patch. \nBtw, will you consider landing this without coordsChar improvement?\n. > maybe we'll have to increase the size of the cache a bit, since the maximum size of cached measurements is a lot smaller with this approach\nLooks like there's no need for this: measurements are not recreated but full-filled with missing info instead. \n. # Status update:\n- the patch poorly handles spans created by CodeMirror.markText method (these spans should be handled with care). As a result, mark-selection addon becomes unusable.\n- the patch has some problems with selection of arabic text (don't have any idea why)\n- there are issues with wrapped lines support, specifically cursor height sometimes is not big enough (might be fixed via changing measurement area from 50 to, say, 300)\n- setting cursor via mouse doesn't work instantly as it does series of measurements with forced layouts. Good news this could be sped up. \nTo sum up, at the moment this patch works reasonably good for non-wrapped code editors that does not heavily use 'markText' functionality, which sounds really promising. Still, there is a lot to be done to bring it to finished state.\n. Do you still plan on working on this? \n. Uh, I see now. I felt that the code I removed was placed there intentionally, but was confused by the option naming.\nThe workaround is fine - I'll go for it. Thanks.\n. Btw, how about renaming nocursor into nofocus (and keeping nocursor in the code for a while for backward compatability)?\n. The work aroung turned out to be hard-to-handle in case of multiple codemirror editors.\nI updated pull request so that it introduces \"nocursor\" option which hides cursor, and \"nofocus\" option which makes editor unfocusable. (as \"nocursor\" used to be before)\nWhat would you say?\n. Although your suggestion is reasonable, it still doesn't solve the core problem I aim. It also looks like my example brought in a bit of confusion. Let me revisit it:\nvar a = sweet|\nIt would be great if in this case inserting \" will result in a \", not in a pair of \". \n. > What is the motivation of that use case? \nThe situations like this happen here and there during code editing/refactoring, specifically when dealing with #include's in cpp code.\n\nAnd how is it different from var a = ###|\n\nIt's exactly the case as far as ### represents a word.\n. Yes, I'm going to turn sweet into a string. \n\nChecking for the cursor being after a word character seems arbitrary and wrong in this case.\n\nFor me it feels natural;  ST2 also does this.\nTo sum up, I'm OK with combining both solutions into one - it will cover both mine and yours concerns. What would you say?\n. Please, revert it again - the stuff doesn't work for the following testcase:\n- Copy single word\n- Press Ctrl-V and keep it pressed for some time; you'll see $ signs popping here and there.\nI'm working on the fix.\n. The hot-fix is out\n. Friendly ping\n. Do you guys have any progress on this? How do you feel about adding additional option maxTokenizationLength which will define maximum line length for tokenizer to process?\nCC'ing @crdev as he might be interested in this bug\n. I'm not sure I follow you, could you please elaborate on this in more details?\n. Thank you for this patch.\nStill, doesn't work for the following case:\njavascript\nconsole.log(\"/*string gets corrupted.*/\");\n. @marijnh, no ideas here how this could be fixed in general; and yes, mode-specific config might be a nice way to go.\n. Indeed, this fixes the issue.\nIs this mac_geLion part of the condition crucial? Can we remove it from core so that chrome's overlay scrollbars will be working fine with codemirror?\n. Nope; still happens for me in Chrome M35\n. I do exactly the same, though I'm on Chrome 35 (linux) (should not be relevant though). It takes a bit longer after your patch, but still sooner or later I end up with the whole text selected. My way to do this is to click in a random different places inside the selected text area for some time - and it happens.\n. Yay, cannot repro any more, thanks!\nThe focus inside \"contextmenu\" seems to be a different beast, I'll come up with a reduction for this and file another issue.\n. Thank you for the fast fix, it works.\n. Ahh, I see now.\nThank you, that addresses my concerns.\n. I'm on MBA'12, Chrome 39.0.2171.62.\nI've copied the default text in the demo ot get 4000 lines, three times hit Tab, and then once hit Shift-Tab.\n- Every Tab took ~350ms to process.\n- Shift-Tab took ~550ms to process.\n. When I select multiple lines and hit TAB, I expect the whole block to be indented on the same amount of spaces. Are there any cases when this is not true?\n. Thank you.\n. An option would be great, thank you.\n. I'll play with it. Though I was initially under impression that Acorn is somewhat less maintained:\n1. In a blogpost, you claim to set up a project page, but it seems to go down\n2. In that same blogpost, there's a link on benchmark which is also down\n3. On esprima comparison page, the Acorn seems to be broken \nWhat's your goal regarding codemirror modes correctness? We rely on them heavily in devtools front-end.\n. This issue bites us a lot =/\n. ",
    "HKochniss": "Hrm that is very interesting. So it is optimized for memory usage.. keeping GCs to a minimum a guess.\nSo I guess it's not possible that multiple parsing behavior is impacting scroll performance? I guess I could manage my own state in the mode, just skipping the mode parsing if already done? \nAfter all, the only usecase for me is readonly mode, and I'd like to get the most perf out of CodeMirror I possibly can. Do I have to manage my own state, or is there some easier way to circumvent the multiple parses?\nOr is it guaranteed to be a nonissue for any normal (nonheavy) mode? I still have the feeling the scrolling is sometimes less smooth than native text scrolling, though that might be totally subjective (FF 17 alpha here)\n. not really a problem, it's just a gut feeling, because I really care about user experience and scrolling performance versus native scrolling could be impacted. To be totally honest though, I don't understand the need for executing the mode multiple times, esp. in the (very special and I'm sure not too important) case where there is no codefolding, and everything readonly. A simple check as \"did the mode run to every line in memory\" could probably just fix this? But again, I could probably just add a flag in my state object. I'll just experiment a bit.\nBut don't bother, it's really just premature optimizations I guess, maybe it's not humanly possible to \"feel\" a difference between a mode running once or thrice on 250 lines of code.\n. ",
    "haldean": "This breaks delete-to-character and change-to-character; this is going to be more difficult than I thought. Closing until I come up with a better way. Sorry for the noise!\n. ",
    "utkukaratas": "oops. this is on qtwebkit. the user agent string is below, afaik it is equivalent to mid 2011 chrome. \n\"Mozilla/5.0 (Macintosh; PPC Mac OS X) AppleWebKit/534.34 (KHTML, like Gecko) Qt/4.8.2 Safari/534.34\"\n. @marijnh that is exactly as you said. \nthese two lines gets everything right.\nvar qtwebkit = /Qt\\/4\\.[0-9]/.test(navigator.userAgent); // qt4.x webkit\nvar flipCtrlCmd = qtwebkit || opera && mac;\n. Yep, applied it to the master branch and it does work as expected.\n. ",
    "aeosynth": "works great, closing\n. > Whenever I use the current vim implementation in CodeMirror, I have trailing-space alarms going off in my brain and this is somewhat annoying.\nMy feelings exactly.\nonemore should be enabled through the command line, once that's working again.\n. > I think onemore should be the default because it would be more natural for someone who is new to Vim.\nI would argue against attempting to provide 'sensible' defaults, as no one will agree what those are, and instead just stick with vim's current defaults.\n\nThat said, please don't block the reimplementation on this issue. It is not a regression. Let's get that through and then tackle this.\n\nAgreed.\n. master and v3 branches both work for me, closing\n. This fix works for me.\n. > ,/ for clearing the current query\nI don't think this is vim's default behavior.\nedit: personally, I use the following in my .vimrc:\nviml\nnm <C-C> :noh<CR>\n. http://vimdoc.sourceforge.net/htmldoc/pattern.html#last-pattern\n\nTo clear the last used search pattern:\n:let @/ = \"\"\nThis will not set the pattern to an empty string, because that would match\neverywhere.  The pattern is really cleared, like when starting Vim.\n\nof course, this needs the : prompt\n. using jquery / expressjs\nvar url = 'YOUR_URL';\nvar val = cm.getValue();\n$.post(url, val);\napp.post('YOUR_URL', function(req, res) {\n  var body = req.body;\n  insert(body);// put your sql magic here\n  res.send();\n});\n. Seeing that they were executable.\n. Windows users randomly make executable files, presumably because that os doesn't recognize unix file permissions.\n. > Then we able to hook in features that would make the dialog more vim-like, and implement 'Up' for search/ex history.\nthat would be cool\n. > What do you think about mapping ; to : by default?\nI think we've been over this, and the consensus was to not second guess vim. Also, now that we have mappings, you should probably remove your personal mappings from the source, ie https://github.com/marijnh/CodeMirror/blob/master/keymap/vim.js#L210.\n. A few thoughts:\nMaybe this issue should be discussed in the google group.\nDoes CodeMirror want to create and support a Vi IMproved improved, or should that be a separate project? HappyEdit is a \"Vim-inspired text editor\" built with Ace; a similar project could be started using CodeMirror as the base.\nI would be ok with improved defaults, as long as I could revert all of them with a single setting, ie compatible.\nThe ,/ keybind is undocumented; one has to read the source or discover it accidentally to know that it's there. Searching for gibberish is one way to remove highlighting.\n. cool. your patch doesn't touch test/run.js, so npm test (and travis) still won't lint keymaps\n. @santec travis build failed:\n\nmode/sql/sql.js: Found tab character at line 37, column 0\n. i'm using lineCount, should i use lastLine instead?\n. fixed V not entering (actually exiting incorrectly) visual mode. i rebased on master and now the commits are weird...\n. cool. i still have one more issue from #1612 to fix up, linewise motion not clipping correctly\n. ok, fixed motion clipping. this last one was a bit awkward; code is duplicated for change and delete operators, to emulate weird vim behavior (that i didn't know about until today). also fixed the rebase. submitting to @mightyguava for review\n. click handler added, bounds check done in evalInput. i feel like that function should be rewritten to return earlier\nI think we should still clip the start & end cursors before passing them to the operator, just to make sure that no logic in vim.js breaks due to out of bounds.\n\ni don't know the codebase well enough to have an opinion\nedit: there is no triggerOnMouseDown, so i didn't add tests for the click handler\n. @marijnh can we get some mouse hook for tests?\n. fixed, but entering visual mode when selecting text w/ the mouse should be cleaner; if / when a status bar with the current mode displayed gets implemented, the displayed mode will not change immediately\n. this addon would be useful even with the default keymap; many text editors show a persistent status bar\n. i was thinking of separate keymaps for each mode, falling through to the normal mode keymap, but contexts sounds good too\n. if vim is kept as a keymap instead of an option, how can i deregister the beforeSelectionChange listener when the keymap is changed? should i only add that listener if vim is an option (leaving behind legacy users), or should i patch codemirror to allow update functions in keymaps? i suppose i could call getOption('keyMap') inside the listener\nhttps://github.com/marijnh/CodeMirror/issues/1084#issuecomment-15012968\n\n\nWhat is wrong with just storing it as a property of the CM instance?\n\nNothing wrong with storing it that way. I don't want it to be directly accessed that way since it's a private property. Rethinking it though, it's fine to let the client just break if they play around with the state. So @metatheos feel free to get rid of vim passing, preferably in a separate branch.\n\nthis led me to believe that you were ok with storing vimState on cm\n. state checked for in handleKey, globalState reset only once, beforeSelectionChange listener added only when vim is an option. also switched to the .state convention\n. done\n. > Does setting curStart.ch = null and then calling setCursor(curStart) always put the cursor at the end of the line?\nhttp://codemirror.net/doc/manual.html#api\n\nIf you give ch a value of null, or don't specify it, it will be replaced with the length of the specified line.\n\n\n\nIf so then I'd prefer if you make the intent clear here.\n\nwould adding a comment suffice? \"null ch so cursor moves to eol\"\n. how is this code reached?\nedit: removing it causes no tests to fail\nedit2: oh, another mouse event\n. ",
    "nwinant": "That fixes it! Thanks for the help.\n. Textareas behave fine (I actually tested that before submitting the bug, which I should've mentioned in my original report. Sorry about that.) The problem really does seem to lie with CodeMirror on FF on Linux. I'll see if I can reproduce it on Windows, but the fact that I can't reproduce it on OS X leads me to suspect that it only occurs on Linux.\n. Excellent! And I've just verified that this bug can be reproduced on FF 15 on Win XP (we're not exactly a big windows shop...)\n. ",
    "frostyfrog": "Since no one has linked to it already, here is the relevant bug within Firefox's Bugzilla. It looks like there are options that currently work in the developer edition of Firefox (I tried the first provided example, turned the <p> element into a <textarea> and the code worked). It appears that the FF team are still trying to make sure that the clipboard API standard gets nailed down first before this will get fixed in CodeMirror.\n. ",
    "frabjous": "The bug in Firefox's Bugzilla linked to by frostyfrog was marked as resolved about a month ago, but the problem persists for codemirror. Any progress on this?. The following minimal HTML will fire the onpaste event  in Firefox 55 (linux) with a middle click:\n<html>\n<body>\n<div width=\"100%\" contenteditable onpaste=\"alert('you pasted');\" >\n  Middle click here\n</div>\n</body>\n</html>\nIt also works on textareas, etc., even without the contenteditable attribute.\nI can't figure out how to make that work for codeMirror, however, if it is possible.. Middle click works fine to paste in Firefox with the similar EditArea javascript editor -- Example here. How did they manage it?. Incidentally, with the following small changes to the mwe, it already works in firefox:\n~~~~\n<!DOCTYPE html>\n\n\nTest paste events\n\n\n\n<!--\n  document.onpaste = function(e) {\n    const p = document.createElement('p')\n    p.textContent = \"You've pasted something of types \" + e.clipboardData.types\n    document.body.appendChild(p)\n    return false;\n  }\n//-->\n\n\n~~~~\nThat is, adding the \"contenteditable\" flag to the body tag makes it generate the events. The return false at the end of the function prevents it from actually pasting in the contents, as it normally would.\nI have no idea if these changes are compatible with the rest of codemirror's codebase.. ",
    "nthiery": "A fix would be most welcome, e.g. for our teaching with Jupyter under linux.\nThanks in advance!. ",
    "simcop2387": "Wanted to chime in that there's also a related Firefox bug ticket open about this issue too.  https://bugzilla.mozilla.org/show_bug.cgi?id=953389. ",
    "suvayu": "The original FF issue has been resolved.  Does this mean we can have this fixed?  I'm using Jupyter, and middle click not working severely limits my productivity.. Hi @marijnh, I can middle click paste pretty much everywhere in FF on a wide range of websites.  Could you be a bit more specific (sorry, I'm not a web developer).  Maybe I could help test and narrow down the exact issue?\nPS: the latest release is FF 60.. Hi @marijnh, I had a look at the generated html. I'm not sure how to reproduce a minimal example so that I can file a bug report on the FF bugzilla. I feel waiting for the issue to be fixed without a specific bug report on the FF bugzilla isn't going to help the situation. I would be happy to file the report, and follow up, if you could help me create a minimal example.\nThanks. Hi @marijnh, sorry to repeat myself.  I am not a web developer (only good with languages like Python, C++, etc), and don't know how to create an example from your description of the issue. Could you please help with a code snippet I could work with?. Okay, perfect!  Now I'll follow up with the FF bugzilla.. You can find the new bug report here.\nCheers,. ",
    "nchevobbe": "Hello there, I'm currently monkey-patching the codeMirror version we use in Firefox DevTools, and everything seems to work fine (using dispatchEvent instead of focusing the input on scroller's paste).\nCould someone assign me the bug? I'll open a PR shortly.. I won't :) PR's coming up\nLe ven. 18 janv. 2019 \u00e0 14:45, Marijn Haverbeke notifications@github.com\na \u00e9crit :\n\nApparently not, github won't let me assign this to you (I guess you can\nonly assign team members?). But don't let that stop you!\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/931#issuecomment-455550768,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjSO2Vj54xotY0s7lSFXeK6O6zE5nneks5vEc_vgaJpZM4APVFn\n.\n. I'm only able to test this on OSX with Firefox (using the MiddleClick software to have a true middle-click). I did not find a way to enable middle-click paste on Chrone on OSX.\n\nI would be interested to know if everything is okay in other browser and platforms.. > Did you test whether this breaks middle-click paste on Chrome? There dispatchEvent will also be present, so if it works as-is on Chrome, it looks like the fallback code isn't going to be used anywhere.\nYeah, I was just being cautious for old-browser support.. > Unfortunately, this works neither in Chrome nor on Firefox for me (using Linux)\n:/ , I'm positive it should work on Firefox (maybe only Nightly for Linux, but I doubt it). Okay, time to  boot-up my VM.. Hello Martin,\nI put up a page to test this PR : https://codemirror-firefox-middle-click.glitch.me/\nIt's working for me on: \n- Firefox 64+ on OSX\n- Firefox 67 on Ubuntu 17.10 (64-bit)\n- Chromium 67.0.3396.99 on Ubuntu 17.10 (64-bit)\nI'm currently upgrading my Ubuntu VM in order to test Firefox 64 on it.\nCould you tell me if: \n- it still does not work for you with my demo page\n- what steps you do to try to paste (I tested the patch by middle-clicking on the current cursor line, on the cursor itself, and also on part of the screen which is only covered by the scroll container, but maybe I'm missing something).\nThanks!\n. Verified it also works on:\n- Chromium 71.0.3578.98, Ubuntu 18.04 (64-bit)\n- Firefox 64, Ubuntu 18.04 (64-bit). Sorry, here it is https://codemirror-firefox-middle-click.glitch.me/. > Chrome (71.0.3578.98) still doesn't do anything when I middle click on an editor.\nworst case, I could use the gecko floag from https://github.com/codemirror/CodeMirror/blob/ed8dfeb5e2ed25b5dd1f1eccc7b757ca6dbd118d/src/util/browser.js#L6, but i'd like not to.\n\nThough I did notice that middle-click paste on Chrome works when the editor is unfocused, but not when it has focus.\n\nThat's a lead, I'll check this.\n. One silly question: does it works for you on Chrome without this patch? (it does on my machine on https://codemirror.net/demo/simplemode.html). Could this be somehow OS specific? What distrib+version are you testing on? (As stated before, it does work for me on Chromium, on Ubuntu, both with and without my patch). It's working for me, both with and without my patch on Google Chrome 71.0.3578.98 (Official Build) (64-bit)\nI'm going to grab a Debian image and check everything there.. Okay, so on Debian it's working for Firefox, and for Chromium, but only if unfocused (same as you basically). I can see the textarea focus event listener being fired, but I don't know if it may cause the issue.\nShould we proceed with this patch and create an issue for Debian+Chrome ?. Thanks for helping me figuring this out @marijnh :) \nAlso, thanks for maintaining this repo (and for the new version, I'm excited to try this one out :) ). ",
    "chrisaljoudi": "@marijnh Tested using Firefox 17.0.1 and CodeMirror 3.0 on Windows 7 -- can't reproduce. Firefox seems to restore the values appropriately.\n. @marijnh yes, it indeed seems to. I apologize for not coming up with the appropriate fix in the first place (admittedly, I don't understand the internals nearly well enough).\nThanks!\n. ",
    "kidwm": "I've made some test cases and tried to triage this issue.\nThis test page consists of three textarea.\nhttp://file.kidwm.net/sandbox/problem/\nAfter page loaded, just hit Ctrl + R, The contents of second an third textarea would disappear.\nThen add some texts in the first and second textarea, hit Ctrl + R again, you would see the new contents go into the second and third textarea.\nhttp://file.kidwm.net/sandbox/nofirst/\nremove CodeMirror from the first textarea, now works good.\nhttp://file.kidwm.net/sandbox/noauto/\nadd  to the form element, disabling the autocomplete feature is just a workaround.\n. @jquense My patch-up approach was rejected. Could I try to improve your code and send PR again? \n. ",
    "pydichandra": "Sorry, I should have been more careful in testing out the patch. I'll make\nsure the future patches will be clean.\nOn Fri, Nov 9, 2012 at 8:16 AM, Marijn Haverbeke\nnotifications@github.comwrote:\n\nSo, that patch doesn't seem to work at all. Worse, it breaks highlighting\nof multi-line strings. I've pushed commit 9039744https://github.com/marijnh/CodeMirror/commit/9039744078d9fdf50c42a0144ccc2b64d650edfeinstead.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/935#issuecomment-10234740.\n. Defined block comment continuation extension. please take another look?\n. I am enabling multi-line indent for statements that span more than one line and for function calls/declarations.\nFor statements that are under multi-line statement blocks are indented 'indentUnit' from start line of multi line statement.\n\nex:-\npublic class A\n----implements B\n----implements C {\n------int i; <== here int i; indented 2-spaces from \"implements C\", where as it should have been indented 2-spaces from \"public class A\".\n. in my proposed patch, multi-line function calls, declarations were also indented 4-spaces. if function declaration, call contains at least one argument then further arguments are aligned to first argument column.\n. multi line statements will be indented by statementIndentUnit.\neg.\nproduct.ui.ContentPane.prototype.enterDocument =\n    function() { // 4-spaces == statementIndentUnit\n  var i = 0; // 2-spaces indentation\n...\n}\nOn Wed, Mar 27, 2013 at 2:13 AM, Marijn Haverbeke\nnotifications@github.comwrote:\n\nWhat does this accomplish?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1397#issuecomment-15511980\n.\n. https://github.com/pydichandra/CodeMirror/commit/02f5cfb7baaf076487df90aa71733b4d0678c6ee\nwas\nthe change in my local repository;\nthat uses statementIndentUnit from parserConfig. If that is not defined\nthen indentUnit is used for statementIndent.\n\nOn Thu, Mar 28, 2013 at 5:50 AM, Marijn Haverbeke\nnotifications@github.comwrote:\n\nYour patch has several problems\n- It looks for the option in the config rather than parserConfigobject. That will only hold editor-wide options, whereas this is clearly a\n  mode-specific one.\n- It completely breaks the mode when the option is not specified.\n- It removes support for the current model, which I personally find a\n  lot saner.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1397#issuecomment-15586646\n.\n. Thanks Marijn!\n\nOn Tue, Apr 2, 2013 at 2:14 AM, Marijn Haverbeke\nnotifications@github.comwrote:\n\nYour patch still breaks the usual, aligned indentation for function calls.\nSee attached patch for a cleaner approach.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1403#issuecomment-15764675\n.\n. \n",
    "ChrisChiera": "Thanks! And yes, it's happens each time when enabled. When disabled there is a brief flash of white (rather than the black theme). I would love for the black theme to stay but imagine that will come in the future.\n. ",
    "spiffin": "Okay - thanks Marijnh.\n. ",
    "fe9lix": "Removing box-shadow on the .cm-s-ambiance class is only a minor visual change but results in a drastic performance improvement when the viewport is scrolled. It is only this single style that is a performance bottleneck. I'm going to submit an ambiance-light theme as you suggested.\n. ...yeah, maybe that's a better name...\n. Correction: It's not the call to getBoundingClientRect() in measureCharPrepared but the call range(node, start, end).getBoundingClientRect() in measureCharInner. Here, pageXOffset is added to both left and right (width is fine). However, the fix above still applies.\nI think it's safe to say that Safari is more or less the monopoly browser and iOS 7.0/7.1 are currently the most widely used versions.\nThe problem does not occur for the vertical positions and the device orientation also does not matter. Different values in the viewport meta-tag also make no difference. I would be happy if somebody else could confirm this.\nI've just quickly tested if there are issues with the bounding rects of text ranges on Safari:\nvar node = document.createTextNode(\"xx\");\ndocument.body.appendChild(node);\nvar r = document.createRange();\nr.selectNode(node);\nvar selection = window.getSelection();\nselection.addRange(r);\nconsole.log(r.getBoundingClientRect());\nSeems to report correct values, even when zoomed or scrolled. So, the behavior might be caused by the nested markup in CM? Any other ideas what could be causing this?\n. Sure - I'll get back here as soon as I have the time to figure out what exactly causes this problem.\n. ",
    "Develooper": "Why was this issue closed? It's still not fixed.\n. In that case it would make sense if you write on codemirror.net at \"Supported modes\", that it only support Smarty 2 syntax. Currently it looks like CodeMirror would support all Smarty versions (including Smarty 3-syntax).\n. Hello Ben,\nthank you, that's wonderful!\nI've just found a problem with Smarty comments. May I post them here?\n{$a = 1}    {* set $a to \"1 }\n{$b = 2}    { set $b to \"2 }\n{$c = 3}    { set $c to \"3 }\n{$d = 4}    { set $d to \"4 }\n{$e = 5}    { set $e to \"5 }\n{$f = 6}    { set $f to \"6 }\n{$g = 7}    { set $g to \"7 *}\n{* ##### Example Code ##### *}\nIf you copy it into your Smarty3-box it looks very colorful, but it shouldn't. It seems like the content of comments get parsed like normal code.\nEDIT:\nIt seems like the comment editor on github is buggy too. it removes the * at the beginning and end of the Smarty comment. Only the first opening comment is shown corrently here.\n. ",
    "suhajdab": "It's not critical on our end, as we're developing features for a product released next year. Just though you should know & hope you'll be able to find the issue before we release :)\n. Our IE versions match and I certainly see it. I made a quick video of reproducing the bug in case I explained it poorly.\nWhen I move the move below the hasSelection text, I click.\nhttp://www.youtube.com/watch?v=agn9fIqeclc\nAlso: Browser Mode: IE9  Document Mode: IE9 standards\n. Can't see it in 3. Just been afraid to upgrade because we built quite a system around it...\n. Tested on localhost and on http://codemirror.net/demo/complete.html and the problem still exists. :(\nMade sure lines from https://github.com/marijnh/CodeMirror/commit/475b626cdb42a426278de3c87fa50ccd751cfb6f are in the script.\n. Very sure. Cleared cache, restarted browser and still http://www.youtube.com/watch?v=tLTiQ1_qMao&hd=1 \n. I set a breakpoint just after the if statement ( line 1354 ) and selectionEnd = 1, selectionStart = 1. I had another breakpoint inside the if statement ( line 1351 ), but it never entered.\n. FYI: I've been debugging on IE 10.0.9200.16441 ( installable on win7 ) and get the same result in IE10 & IE9 browser mode.\n. I could not reproduce the bug anymore! Thank you for the fix!\n. Ok, but that means that browsers ( namely >= IE8 ) that don't support rgba can't see the cursor when inside any highlit text, right?\nAlso then this makes no sense:\n.cm-searching {\n  background: #ffa;\n  background: rgba(255, 255, 0, .4);\n}\n. That is really strange! It works for me both in an updated complete.html demo and our own solution in Safari 6.0.2 (8536.26.17).\nHere is the jsbin experiment: http://jsbin.com/axiqok/30\nDoes this work for you?\n. I'm puzzled. Here is a jsbin with the exact copy of codemirror.js I commited. http://jsbin.com/oripew/2/\nIt works as expected for me. Does it crash for you?\n. Strange. I did start off by using jsbin's logo image and when that worked, tried the datauri mini gif to avoid adding an image resource to codemirror... (scratchinghead)\nI got osX 10.8.2 & Safari 6.0.2 (8536.26.17). You?\n. Thumbs up. Another one off my list. Thanks!\n. Bad news! I don't know what happened, but on the same Mac, with the same version of Safari I previously tested on, both your fix & mine crash most of the time, but not always(!). The only version that so far never crashed is http://jsbin.com/axiqok/32, on the other hand you mentioned that it indeed crashes for you. \nMaybe the fix should be reverted? Ugly is still better than crashing.\n. Yesterday, after having cleared all caches, it was crashing ( both locally and on CM demo ), but I was too busy to investigate. Today all lights are green...\nLet's not roll back just yet, but I will be testing this now on regular basis.\nAlso sent reports to apple every time Safari crashed... maybe they can see something and fix one day. (dreaming)\n. Yes! Perfect! Thank you! :)\n. ",
    "loadx": ":+1: \n. ",
    "mattsacks": "Couple of things with regards to this branch:\n1. I am completely against having two implementations of the Vim keymappings in CodeMirror. It doesn't need to be any harder to maintain. If you're going to refactor the entire file for better extensibility in the future (an idea that I totally support), you can't just go halfway and ask for it to be brought in anyway.\n2. Marks (and effectively, registers) are available in the current Vim implementation.\n3. Text-objects are one of the first things Vim users test when gauging a \"vim-mode\" in another editor. I don't think it's okay to lack support for even the most basic text-objects (ones that don't span multiple lines).\nAbout the implementation:\n1. I like the defaultKeyMapping style. Personal thoughts:\n   - Maybe try to split some things out onto new lines? Just a pet peeve.\n   - keyToKeyMapping isn't necessary. You should facilitate whatever mapping system you implement with some defaults.\n2. Okay, still reading the code. Definitely split stuff out onto new lines. { return; } can just be return; too.\n3. You have setMark and setRegister but no getMark and getRegister.\nBesides that, it's a lot of code to comb through - but it all looks great for the most part. There's just some key things you need to address before this needs to be considered as an actual replacement of the current implementation. Thanks for all your work on this. \nsidenote: @marijnh, is use 'strict'; necessary/preferred? I've heard rumors of it slowing down JavaScript execution due to the environment it needs to consider (as apart from the default, not strict).\n. Sorry, halfway or half-implemented is oversimplifying the effort put into this branch. I apologize.\nBut honestly, text-objects are one of the most novel features of Vim and give it a lot of power. I think you're missing out on making them lower priority than visual mode (which I think will have a lot more complexity to it than text-objects, but maybe not).\n80 chars is more standard of a text-width than 100.\nMarks are currently implemented using the 'm' prefix, but I'm not sure if you can actually jump to them yet. It's just an object that stores the current line (and should store the current cursor) number. \n. ",
    "elygre": "When using the \"cm.replaceSelection\"-solution, it is no longer possible to indent code by marking multiple lines and pressing \"Tab\". Is there a workaround or code sample that shows how to keep that (very useful) functionality, while still enabling insertion to be spaces instead of a tab?\n. Brilliant. This should probably go in the documentation, instead of the version that doesn't handle this scenario.\nThanks.\n. I encountered this issue quite a while ago, and found / was told about the customization I required (see further above).\nNow, if this is a frequent enough request that people push many different variations, perhaps a good solution could be an easier accessible documentation of those? For example, on http://codemirror.net/doc/manual.html, a new heading below \"Keymaps\" called \"Tabs\" or somethings, with a listing of various ways of doing this? If the heading was created, I could surely provide text for at least the one we're currently using, including pros & cons and the actual code. We might perhaps even provide examples for each of them various ways.\n. ",
    "Enygma2002": "Thumbs up for including that in the docs. I`ve lost some time looking for the way to do it right. A simpler, more user friendly, method wouldn't hurt either.\n. @danieleds \"correct\" from your point of view :)\nPersonally I prefer to indent the line when TAB is pressed, like other IDEs do (e.g. eclipse). The TAB character has no(t much) meaning inline, except maybe 20+ years ago.\nOthers might find it useful though, thanks for sharing :)\n. ",
    "briangonzalez": "@espadrine \nYou're a lifesaver, sir. Thank you!\n. ",
    "anodos": "Spaces are mandated at our organization. Tabs are not consistent enough across editors and terminals and we got tired of having to reconfigure every editor and terminal in order to display source correctly. It's pretty annoying that CodeMirror doesn't have a simple way to do this. The method in the docs is incomplete, and @espadrine provides a partial solution above.\nI say partial because all the solutions given so far have a bug: say your indent is set to four spaces. If you are in column 2 then pressing TAB should add enough spaces to take you to column 4, but instead TAB always inserts 4 spaces no matter what column you are on.\nSo now we have to \"patch\" this manual solution. Making the \"use the existing tools approach\" even more complex and error prone.\nIs it really that difficult for CodeMirror to include this option out of the box? It seems to me that CodeMirror has had no difficulty solving much more difficult problems than this.\n. I did bother to explain exactly what I want, so I will quote myself, \"If you are in column 2 then pressing TAB should add enough spaces to take you to column 4, but instead [with the examples given so far] TAB always inserts 4 spaces no matter what column you are on.\"\nSince this wasn't clear enough, I'll translate a little. Tabs don't blindly advance you 4 spaces (in this example), they always take you to the column that is either the next tab stop or the next multiple of the tab size. In all the examples given so far 'indentUnit' # of spaces are inserted no matter what column your cursor is currently on. If I am positioned on column 2, then I expect two spaces to be inserted to take me to the next multiple of 4. If I am on column 4 then I expect four spaces to be inserted to take me to the next multiple of 4. And so on. \nI have several other code editors and all of them support using spaces instead of tabs and all of them simulate tabs with spaces by inserting just enough spaces to take you from your current position to the next tab stop. This is standard behavior for code editors when using spaces instead of tabs.\n. I think what we must have here is a failure to communicate. You are sensing a tone of entitlement, so I can see you are misunderstanding me, since I meant no such tone. It is also very possible at this point that you won't try to understand what I am saying. But I will give it one last go.\nSince my attempt at explaining isn't working, maybe an actual working demo will do the trick.\nI have handy IntelliJ IDEA, Visual Studio, WebStorm, Eclipse, and some other editors. They all have options to use spaces instead of tabs, and all work as I've described. As a working demo I'll using WebStorm, since I have it open right now.\nWebStorm has a checkbox on its \"Code Style -> JavaScript\" \"Settings\" panel for \"Use tab character\". By unchecking \"Use tab character\" WebStorm will use spaces instead of tabs. You can set up a tab size and indent size right below the check box. For this demo, set the tab and indent sizes to 4 and make sure \"Use tab character\" is unchecked. Now, go into a blank .js file and press tab. You'll see it has inserted 4 spaces. Type something that is two characters long, say, \"Hi\". Now press tab again. WebStorm will insert 2 spaces, which now positions your cursor on column 9. If you type a single character and press tab, WebStorm will insert 3 spaces.\nThis demo should show what I'm trying to communicate, while also proving that at least one popular editor works this way.. though the others also have the same option and work in the same way.\nOh, and I'm not asking anyone to do this for me... I've implemented it myself, and am willing to share the code with anyone who is interested.\n. ",
    "lyrixx": "Hello.\nEvery time I use Code Mirro, I had to set this:\nextraKeys: {\n                Tab: function(cm) {\n                    var spaces = Array(cm.getOption(\"indentUnit\") + 1).join(\" \");\n                    cm.replaceSelection(spaces, \"end\", \"+input\");\n                }\n            }\nCould we have an option to do that ? \nI know you don't want, but really, it's not easy for new comers (like me :p ). More over this feature is really needed when editing YAML files.\nIf you still don't want, Can we add this snippet to the documentation ?\n. Oups, The last time I used code mirror (~1 year ago), the snippet was not in the docs ;)\nThanks.\n. ",
    "danielearwicker": "If the requirement is to emulate the behaviour of Visual Studio (with Tabs: Insert Spaces) or emacs with \"indent-tabs-mode nil\", or countless other editors, then the idea is to make it look like a tab has been inserted, so the cursor moves to the next tab stop.\nTherefore the count has to be reduced by the modulo of the current cursor position with the whole count. The example on this page (and in the documentation) doesn't do that. You would need something like this:\nextraKeys:{\n    Tab: function (cm) {\n        if (cm.doc.somethingSelected()) {\n            return CodeMirror.Pass;\n        }\n        var spacesPerTab = cm.getOption(\"indentUnit\");\n        var spacesToInsert = spacesPerTab - (cm.doc.getCursor(\"start\").ch % spacesPerTab);    \n        var spaces = Array(spacesToInsert + 1).join(\" \");\n        cm.replaceSelection(spaces, \"end\", \"+input\");\n    }\n}\n. Thanks - I edited my previous comment accordingly. Also added the check for somethingSelected() to avoid interfering with the built-in (very standard) behaviour for indenting a block of selected text with Tab, or un-indenting it with Shift+Tab.\nIronically, that built-in handling of a selection does a fine job of inserting spaces! It seems strange that in the default configuration, the end user will get a mixture of tabs and spaces depending on whether they hit the tab key with or without a range selected.\n. @chriscalo Indenting the current line with no selection would probably annoy a lot of people. It\u2019s very common to line up \u201ctable-like\u201d declarations by hitting the tab key at end or middle of the line.. ",
    "danieleds": "I made some minor changes to @scrapmac code to get a correct behaviour when, for example, a word is selected and the tab key gets pressed. In this case, no indentation should occur and the word should be replaced by the tab (or spaces).\nTested with codemirror v4.5\nhttps://gist.github.com/danieleds/326903084a196055a7c3\n. Sorry, is this ready to be merged?\n. @vincentwoo sure\n. ",
    "JasinYip": "Try this :)\nextraKeys:\n    'Tab': -> editor.execCommand 'insertSoftTab'\n. We're using bower and waiting for this fix to be included in the next release. Would you mind to cut a bugfix release?  Thanks :smile: \n. But if I locked(set readOnly: true by using markText) the code, it can not be deleted.\n. Thank you very much! It works ! :)\n. Are there any news? We are dying for this \ud83d\ude2d\n. We do not mean to bother. However, solving this bug means a lot to us. If it can be solved with higher priority, we can definitely support more on this project by all means.\n. It looks not that simple to me...\nI found that even we call getHelpers instead of getHelper, it can only return javascript-lint, excluded myLinter. Because getHelpers will check the mode of CodeMirror Doc(by calling getModeAt(post)) and access into mode.helperType && help[mode.helperType] code block, then push help[mode.helperType] into the variable found only one time. I haven't read all of the source code so I can't make sure what's the right way to fix it.\nDo you have a good idea for this?\n. Maybe I didn't express cleanly...What I mean is when I pressed elsif, it should indents automatically, not copy-paste and without any shift-tab thing...\n. ",
    "amrondonp": "I'm having a little trouble in a use case I want to support. I want to let the users paste their code or upload the code from a file.  I have been thinking that is not very efficient to replace the tabs in the code string whenever it changes. I would like to do this without changing the source code of codemirror. any ideas?. ",
    "remcoros": "Verified, that works (a bit better :-))\n. you are so fast :+1: \n. ",
    "bennyschudel": "thanks for your fast reply. I'ts quite hard to explain what I'am actually doing. I've created a browser extension which once is activated on a page turns every numeric object into a custom slider. So every number on the page can be changed. Every slider has its on settings and these settings are stored into local-storage so that if I tweak the slider settings I don't loose them on page-refresh. The easiest way to accomplish this is of course to use the id-attribute if it is present or to create one if not. But this is not possible with codemirror I guess. That's why I've tried to use markText to give it a custom unique class which I could reference to and reassign everything upon page-reload.\n. ",
    "xeenon": "Sorry for the bad pull request, I'll try again.\n. Thanks for the suggestion! I'll give it a try.\n. It would be nice if CodeMirror.extendMode had a way to get the original property of the mode. Then you could just do:\nCodeMirror.extendMode(\"css\", {token: function (stream, state) { ... }});\nAnd somehow reference the original token property in the extended one. Maybe this._token or this.originalToken?\n. This approach works, but it fails for the xml mode because htmlmixed does this:\nif (style == \"tag\" && stream.current() == \">\" && state.htmlState.context) {\nIn my case style is \"tag m-xml\" not \"tag\". Maybe htmlmixed is making a bad assumption and it should split on space and look for \"tag\" in the array?\nIf you think htmlmixed should split on space here then I can submit a patch. I can also submit a patch for extendMode storing away the original property if desired. It makes things much cleaner:\n```\nfunction extendedToken(stream, state)\n{\n    var style = this._token(stream, state);\n    return style && (style + \" m-\" + this.name);\n}\nCodeMirror.extendMode(\"css\", {token: extendedToken});\n```\n. I'll do that. What about the extendMode change I mentioned?\n. Thanks! Does this eat the optional whitespace inside the parenthesis?\n. Touch\u00e9!\nIt does eat leading space but not trailing space. Here is the example in the Web Inspector:\nhttp://timothy.hatcher.name/css-url-spaces.png\n. Well I would expect both prefix and postfix spaces to be included in the string style \u2014 not just the postfix spaces as it is now. But ideally no prefix or postfix spaces would be included since those are not part of the URL that the browser uses to load the resource.\n. It does show up in the Web Inspector timeline taking about 0.5ms. That adds up when you have multiple instances in the document.\nThe cursor still blinks in all instances in our case, even when not focused. Adding if (!cm.state.focused) return; to the beginning of restartBlink is all that seems to be needed to fix this.\n. Thanks!\n. Well you could put it outside the interval function at be beginning of restartBlink. The interval is canceled in onBlur and restarted in onFocus via restartBlink. Keeping the interval firing while not focused is wasteful on power (the process can't sleep longer).\n. Thanks again!\n. It still fails with e5df8cc3ae.\n. Looks good. Found another issue. #1330\n. There is ::selection too.\nThere are any number of vendor specific pseudo elements for experimental or internal features. Things like: ::-webkit-search-decoration, ::-webkit-input-placeholder, etc.\nThe shadow DOM lets you designate an element as a custom pseudo element by using the \"pseudo\" attribute. Doing so creates an association with that element in the shadow tree and lets you access it via CSS selectors.\nSo we should just remove the fixed list of pseudo classes and elements and make the mode parse anything after the colon (or double colon) as a pseudo.\nIt is also surprising that the modes have fixed lists of tag names. As HTML evolves, so will the tags \u2014 like , which is missing from the list. You can also make up your own tags in XML and style them with CSS, and those wouldn't highlight correctly.\n. It appears the double colon (which is allowed and recommended by CSS3 for pseudo elements, to distinguish from pseudo classes) is not parsed correctly either. Only the single colon seems to be supported. The code confuses pseudo elements and pseudo classes by mixing the two in a pseudoElements variable. That name should be generic if it has both types in the list.\nAs mentioned above the list should go, and be replaced by parsing. So double or single colon should be supported.\n. I might take a look if I get time. I also filed a similar issue as #1466.\n. I think this was fixed by c690083563f86739dc3d271516916d88b04370ed.\n. Good point. Highlighting correctly is important to give user feedback on what will or will not be recognized.\nIn our case, we get a list of recognized properties and keywords from the rendering engine. So we would like everything we know that is recognized to be highlighted correctly for proper user feedback.\nWould a designated way for CodeMirror embedders to extend or replace the lists used by the modes be acceptable? If so I might take a crack at adding that support.\n. Great, thanks!\n. After looking at the code, I think we have enough to do this already after the changes to add the \"css-base\" mode.\nvar cssSpec = CodeMirror.resolveMode(\"text/css\");\ncssSpec.propertyKeywords = {...};\ncssSpec.colorKeywords = {...};\ncssSpec.valueKeywords = {...};\nCodeMirror.defineMIME(\"text/css\", cssSpec);\n. The main issue we are experiencing is the inconsistency of bookmark cursor placement when the line is empty vs when it has content in CodeMirror 3.14.\nHere is checkmark bookmark at position 0,0 with other text on the line. The cursor renders to the right of the bookmark.\n\nThe above screenshot in the original report has a blank inline block bookmark at 1,0 but in CodeMirror 3.14 the cursor is rendered to the left, not the right like with the checkmark and lines with content.\nHere is how it looked in CodeMirror 3.13:\n\nWouldn't it make sense for the insertLeft bookmark option to control the side the cursor renders on? (We use the default of false.)\n. Looks better; however, it is acting up on single character lines. When the cursor is at 0,1 with a widget bookmark at 0,0 the cursor renders to the left of the character and to the right of the widget.\nYou can see in this movie that the cursor sticks at 0,0 when typing then jumps to 0,1 when more characters are added by autocomplete (does not happen with 3.13). You can really see it when deleting chacter-by-chacter or when there is no completion. I also can't manually position the cursor visually at 0,1 when there is only a single character and a bookmark at 0,0. Though, I can still delete to remove the character, so the position really is 0,1.\n\n. Fair enough.\n. Yes, that pollyfill needs work.\nIn my snippet above, I used the cursor inside cursorDiv. Why isn't that an option? Maybe it isn't always present? It works well for scrolling into view the line being typed, at least in our case.\nHowever, it sounds like from #1104, that you won't consider a large pollyfill. Would you consider a hook to replace this CodeMirror function from the outside? Our only choice to fix this right now is to modify CodeMirror, which we would rather not do long term without merging it into master.\n. That 30px would be wrong for a CM instance that has no horizontal scrollbars, as in our case.\nAn event would work for us, if it prevents the CM implementation.\n. I guess what I meant to say was, the cursor div is the right position already by accounting for that 30px. If it was always there it would work.\nThanks for the patch, I'll give it a try in an hour when I get to my computer.\n. But I'm likely not testing the right cases that require that 30px padding. Thanks again, will let you know shortly if it works for us.\n. Yes, your fix works for us. Thanks!\n. ",
    "MasonM": "I tacked on a few more commits with some fixes. Sorry for the mess! \n. ",
    "jondkinney": "I'm using Codio which uses CodeMirror. Does CodeMirror allow for setting set virtualedit=all? I'm a long time tmux/vim user and greatly prefer letting my cursor go into 'invalid' places. Thanks!\n. @mightyguava thanks for the info. At least I won't bang my head against the wall trying to figure out how to turn that on now :) \nI do think it'd be great to have that as a setting though! It's very helpful if you can see where you want your cursor to go but there is vertical whitespace between where you are and where you want to go. Having the cursor be able to just go straight down (into invalid space) is nice instead of jumping around to the beginning of the next line.\n. Just wanted to :+1: this feature. I didn't even know about it in 'normal' vim until I saw this, but now I want to use it all the time :p haha, looking forward to the addition in the future!\n. @mightyguava thanks so much for the info! I'll raise this with the Codio folks. In the mean time, could you elaborate a little bit on the workaround you specified? Probably pointing me to some docs would be enough. But if you have any examples of how to use a specific plugin to achieve this, that would be really great!\nThanks again.\n. Well, that's a bummer. Thanks for looking into it though! Assuming that they provide a hook at some point, or I decide to roll my own cloud IDE (haha)... I've been looking around but I can't seem to figure out what a custom mapping would look like when implemented through that API. Do you have an example?\nCodeMirror.Vim.map(lhs, rhs, context)\nI don't know exactly what I'm able to pass to lhs and rhs and context.\nThanks!\n. :+1: \n. @marijnh thanks for the response, and sorry if this is a silly question, but could you elaborate on if/how that'd work from a plugin running arbitrary JS in Safari or Chrome?\nI understand what a constructor to a class is, but I'm unclear what I can pass into the constructor to re-define a keymap for all the instances of CodeMirror in the dom.\nThis is clearly wrong:\ndocument.querySelector(\".CodeMirror\").CodeMirror.Vim.map('jj', 'Esc', 'insert')\nAny tips? Thanks!\n. Well, it took some fiddling, but I was able to get it working with the following\n\nWhich is this code:\njavascript\n$(document).ready(function() {\n  setTimeout(function() {\n    document.querySelector('.CodeMirror').CodeMirror.constructor.Vim.map('jj', 'kkkk');\n  }, 2000)\n});\nObviously typing 'kkkk' when you type 'jj' is utterly horrible :p but it proves it works. I'm also mixing jquery and regular js there, but I think $('.CodeMirror')[0].CodeMirror.constructor works as well.\nI am, however, having a bit of an issue getting the same code to work in a similar plugin in Safari during auto-load. If I execute the script manually in Safari (through the same extension) it works fine... odd, but this doesn't work:\n\nI get the error: TypeError: undefined is not an object (evaluating 'document.querySelector('.CodeMirror').CodeMirror.constructor') so the call to .CodeMirror immediately preceding the call to .constructor is returning undefined and then .constructor can't be called on that, of course. Odd, not sure if you have any insight on Safari plugins or not...\nThanks for the tips to getting this going in lieu of proper support from Codio!\n. Perhaps this is helpful? https://github.com/AtomLinter/linter-rubocop\n. Thanks for the info @marijnh. I'm curious how I'd be able to add this to something like Codio (if I were to dig in and make it work) if it's \"out of scope for the main CodeMirror distribution\". Seems like Codio would need to allow me to add 'plugins' to CodeMirror (or something) and I'm doubtful they'd do that. \nIs there any concept of CodeMirror supporting it's own plugins internally, such that if someone implements CodeMirror on their site there is a way to open a preference pane (internal to CodeMirror, so it's work everywhere CodeMirror is instantiated) and search for/select plugins? I'm thinking of Sublime Text here for inspiration.\nAlso, I did see that Light Table is using CodeMirror and they have a Rubocop plugin... I haven't dug into it too much yet, but does this help at all? https://github.com/seancaffery/lt-rubocop\nDo you think any of it is re-usable as a starting point?\n. ",
    "rioleo": "It occurs with code between lines 454 and 472 on https://github.com/rioleo/fabrique/blob/master/index.php or can be demonstrated live by clicking on line 3's y value (100) and sliding it downwards: http://rioleo.org/fabrique\n. I am using Chrome 23.0.1271.91 on Snow Leopard.\n. ",
    "friksa": "CodeMirror documentation indicates that disableSpellcheck:false config option should do the trick, but it does not work.  Using the built-in browser spell checking on a text area is a much better way to go than using a javascript library.  Then I do not need to train multiple dictionaries and it knows my language regardless of where I am in the world.  Seems like it is time to drop CodeMirror for Markdown and look at http://markitup.jaysalvat.com/home/ - sad... since I really like CodeMirror.\n. ",
    "eduncan911": "FYI, I was able to enable spell checking using the HTML5 attribute spellcheck=\"true\" on the <span> tags generated by CodeMirror.\nhttps://github.com/prose/prose/issues/169#issuecomment-51290639\n<pre> is not supported though.\nMaybe CodeMirror can drop all of these <pre>s and use spans instead?  Would require a small CSS tweak to mimic the standard behavior of <pre>; but, I think it would be very much worth it.\n. @marijnh the thread with many details was mentioned above:\nhttps://github.com/prose/prose/issues/169#issuecomment-51637456\nIn short:\n<span contenteditable=\"true\" spellcheck=\"true\">misssspelled wordds herre!</span>\n. :+1: \n. Perhaps each browser implements their own callback event when a spelling\ncorrection has been performed.\nOn Aug 17, 2014 7:00 PM, \"Patrick Huang\" notifications@github.com wrote:\n\nJust FYI to anyone following this issue. We did manage to trick the\nbrowser by setting contenteditable=true and spellcheck=true. It appears to\nwork on Firefox (will highlight wrong words) and sometimes on Chrome (not\nalways highlight but sometimes it does). But it has a major show stopper\nproblem: when you use browser's spellcheck correction function, i.e. right\nclick on the wrong word and choose the correct word, the value change event\nis not detected by codemirror. I am using version 3 not sure about version\n4.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/marijnh/CodeMirror/issues/1017#issuecomment-52438444.\n. @scottyli See my post https://github.com/codemirror/CodeMirror/issues/1017#issuecomment-52249542.\n\nWhich, points to my JS examples over in another comment thread:\nhttps://github.com/prose/prose/issues/169#issuecomment-51637456\n. :+1: \n. ",
    "tablatronix": "I just noticed that ckeditor seems to work, but probably because its using an iframe with \n<body contenteditable=\"true\"  spellcheck=\"true\">\n. I cannot reproduce this with a fiddle, it must be some other dependency in my environment causing this. Will post a fiddle if I can figure out what it is.\n. I was asynchronously loading theme css files, so it was a newb race condition mistake. Whatever calculates the gutter size was running on default gutters not the themes.\n. boo\n:+1: \n. composer.json for installing codemirror for anyone else that needs it\n{\n    \"require\": {\n        \"codemirror/CodeMirror\"      : \"4.12.0\"\n    },\n    \"repositories\": [\n        {\n            \"type\": \"package\",\n            \"package\": {\n                \"name\": \"codemirror/CodeMirror\",\n                \"version\": \"4.12.0\",\n                \"source\": {\n                    \"url\": \"git://github.com/codemirror/CodeMirror.git\",\n                    \"type\": \"git\",\n                    \"reference\": \"4.12.0\"\n                }\n            }\n        }\n    ]    \n}\n. yes, you are right, the new syntax is probably better , I used old verbose, I needed to parse it with legacy tools, and its easier.\n. Thanks, I will test options and plugins, and try to narrow it down.\n. Well this is only occuring on the minified code, from your minification helper, so probably an uglifyjs issue.\nI have not tested further, my node is not working properly...\n. I think its something in my dev or build or svn clobbering the actual tab characters in the source.\nThe minified code seems to have tabs as actual tabschars. l+=\" \" , shrug.\n. I am considering this a uglify bug, although it could be a config option also on the minifier. I would not expect tabs to be present in escaped strings, probably not the best practice, maybe there is a config option that is causing this, changing \"\\t\" into \"TAB\"\n. Thanks, I meant to look into this again.\njscompress.com also uses uglify.js so I wonder if this is a known issue with uglify.\nNot sure if I ever checked it, looks similar to this \nhttps://github.com/mishoo/UglifyJS2/issues/54\n. ",
    "scottyli": "@huangp how exactly did you get it to work with contenteditable=\"true\"  spellcheck=\"true\" ?\nThese method have not worked for me:\n1. Attaching to the body <body contenteditable=\"true\"  spellcheck=\"true\">\n2. Attaching it to the CodeMirror element\n3. Attaching it to individual span elements within .CodeMirror <span contenteditable=\"true\"  spellcheck=\"true\">\n. ",
    "WesCossick": "For those still wondering, or for future viewers, I've created a CodeMirror plugin that spell checks as your write. It's super simple to set up. Check it out at: https://github.com/NextStepWebs/codemirror-spell-checker\n. @kofifus would you be interested in submitting a PR with this functionality to https://github.com/NextStepWebs/codemirror-spell-checker?\n. Making it an option would help, certainly. I still believe the default should be that it can be followed by a non-space character, since this appears to be the most common implementation across parsers (as seen in the link above).\n. The problem is that GitHub is where users expect to find a change log for each version; after all, GitHub is a version control system that tracks changes. The best way to do that is looking at the 'Releases' tab, a handy feature GitHub has built for this exact reason. This tab is used when new releases are alerted via services like Sibbell. Unfortunately, not all repositories use this feature, but that means they use a CHANGELOG file. This is where users can go to view the changes for each release and is a bit less useful than the releases tab. The problem is, CodeMirror uses neither. So now as a user, I'm wanting to find the changes for each release, and I've exhausted all my standard options on GitHub and have found nothing. I will probably not dig around in the repository until I find that HTML file you just mentioned, and even if I do, reading HTML code on GitHub is not anywhere near as friendly as reading a well formatted markdown document.\nSo now I'm a user trying to find the change log, and I've hit a dead end. If I'm determined enough, I'll probably search Google for \"CodeMirror change log\" and I finally find the releases on your own website, not GitHub the version control system.\nMy pull request solves this scenario and saves wasted time for users. A user searching for the change log will go to GitHub, see the CHANGELOG file, open it, and know exactly where to go.\n. Thanks, I really think using the releases feature will be a great improvement. Especially for those of us using Sibbell and/or RSS feeds for keeping up-to-date with new releases on the dozens of libraries we rely on.\nAlso, for reference, I think SimpleMDE does a great job of explaining each release in terms of New, Improved, and Fixed. But then again, I may be a bit biased since I'm the one who writes the releases.\n. Determined to be a CSS problem with SimpleMDE.\n. @marijnh, thoughts on this PR?\n. Do you believe this addon is any more specifc than continue list, which is already included in the repository? I would argue that each fulfils similarly useful and specific roles.\n. SimpleMDE just introduced a parsingConfig option that allows passing in CodeMirror mode configuration options, including fencedCodeBlocks. However, since CodeMirror parses fenced code blocks no matter what, it can't be disabled by setting fencedCodeBlocks to false.\n. I thought that was the case at first too, but it also matches a fenced code block with four back ticks at the top and bottom. Four tick marks would mean two pairs of inline, single line code spans.\n. Interesting, I did not know that. I'm guessing, then, there isn't a great way to disable fenced code blocks.\n. That sounds like it would the accomplish the same thing, so I wouldn't be opposed to this solution either. Maybe even having both in conjunction with one another. One question though, would Word Documents and/or PDFs be considered binary files?\n. I'm thinking that only plain text would result in something legible when dropped in the editor. Non-binary files can still result in a mess of characters.\n. The PR worked in my local repository, though I've made a number of other changes that could have affected the way it behaved there versus when I copied and pasted just this relevant change into a new branch.\nWith that said, thanks for cleaning it up and committing the improvement.\n. ",
    "kofifus": "I created a spellchecker with typo corrections :\nhttps://gist.github.com/kofifus/4b2f79cadc871a29439d919692099406\ndemo:\nhttps://plnkr.co/iZ7ArW8sTMl8qU2VA0Bc\n. Thx Wes, I don't see how a PR will work as basically there is not much common code ..\n. I have updated the gist to use an async version of typo.js, this gives much better speed/memory performance and shows suggestions as they are found .\ngist\ndemo\n. gist licensing is https://gist.github.com/martinbuberl/c0de29e623a1e34d1cda7e817d18bafe. Sorry for that.\nI opened a new discussion at http://discuss.codemirror.net/t/hanging-indent/243\ncben can you please repost your answer there so I can comment on it ? (and thanks!)\n. thx StudioJunkyard but that's a chrome app so totally different thing. I'm looking for multi platform / native browser support vie contenteditable.\n. Thx marijnh, \n'the way the browser shows underlines' is the main feature of spellchecking ... if it does not work predictably, then basically this patch does not work :( \nThere are two options I can see, either a fix to CM to allow typo recognition predictably, which I understand may not be possible, or use an external spellchecker (as ie i've done in gist ) which works well but has the disadvantages of loading big dictionaries into memory and being a bit slow ...\n. Thx marijnh,\nHow should I then solve the problem with opaque overlay and overlay order described in https://discuss.codemirror.net/t/addoverlay-removeoverlay-and-opaque/835/3 ?\n. Hi mattpass,\nDid you try inputStyle: \"textarea\" ?\nI think it defaults to \"contenteditable\" on mobiles which can cause such bugs ?\n. check FirePad which (among other things) implements that\n. hey vincent .. what does up arrow means on ipad ? touch above ?\n. ah ok didn't know you can do that :)\n. Heu Adrian, Marjin .. as you're doing all this restructuring work, maybe have a quick look at my project here https://github.com/kofifus/New ... IMO a convenient way to create javascript 'classes' which is better than the standard 'class' way ... anyway great work and thx\n. +1\nI have also seen buggy mouse movement behavior moving the caret in Firepad + Safari + COntentEditable which may be solved by this or related\n. ",
    "MikhailTymchukDX": "@kofifus what is the license for your gist code? If it's not explicitly stated, no one can use your code, just watch it :). ",
    "nicolacity": "Would it be possible to solve the major performance issues on long lines before tackling this more robust solution? I'm seeing a major regression since v2 with extremely long line lengths.\n. ",
    "siefkenj": "Ok, inclusive=true is now added.  So many green and orange dots on github, I'm not quite sure what's being merged :-P\n. Looks fixed to me :-).\n. I ran it through the codemirror jsHint demo http://codemirror.net/3/demo/widget.html  I guess it is more picky than jsLint...?\nThe vim_t etc. failing was stupidness on my part (I ran the test suite after all the other changes!).  Do you know how to run just the vim tests from the test page?\n. While we're on the topic of cleanup, what is the consensus of named function defined out of top-level scope vs var = anonymous function?  It seems most of the utility functions are defined as named functions.\n. No problem.  I like seeing code look good, and it will be exciting to have a workable vim mode.  Most other programs vim keybindings are next to useless....  Also, thanks for the quick feedback!\n. I'd like to wait for comments first.\n. I'll switch to another branch.  I have a feeling that they'll be more cleanups and possible restructuring coming soon.  I'll work with @mightyguava to try and keep things consolidated.  I just wanted to make sure the cleanups that touched a lot of stuff got in quickly so things wouldn't get ugly as all the search functions get added.  Sorry about the patch mess!\n. That's certainly a more descriptive name.  I've been trying to think of what else might end up using it, but haven't been able to think of anything, which doesn't really say much 'cause I think we all just use our favorite vim shortcuts and neglect the other 90% of them (I didn't even know about | till today).\nThe issue I see is, when would stickyHPos be set and unset?  Certainly setting it in the functions that want to declare a stickyHPos isn't an issue, but do we want to force every other function to set it to false?  Perhaps you had a different idea of how to do it?\n. This is sounding better, but I'm not sure if it belongs in motionArgs...I mean, it isn't something that any of the functions that will be passed it as true will use...An alternative that might be confusing for others reading the code is in evalInput, save the value of lastHPos, set it to null, see if the evaled function has set it to non-null, and if so set stickyHPos to true otherwise to false...\n. ",
    "dbarnett": "Looks like multi-cursor support is available now. Time to revisit blockwise selection? Can we reopen this issue?\n. Oh, cool. FWIW, pasting a blockwise yank is a little different from the behavior in vim, but glad to see it coming along!\n. This is much, much more useful with powerful Tab completion, BTW (#2299). A common pattern I use is to open another file in the same directory as the file I'm editing with :e %:h<Tab>somefile. Could also get by with some kind of directory view and :e %:h showing a directory listing (doesn't necessarily have to look like netrw\u2026 could just be a popup list).\n. Caveat: Changing the mode doesn't seem to totally work. I tried setting to clike in the vim demo and it had some coloring and indentation behavior that was not quite clike. But that could be fixed in setOption, which already tries to handle 'mode' specially, and even just the querying is something I've been wanting for a while.\nSome parts like the alias handling could be generalized. Could do that as follow-up or on the second setting that needs it.\n. Oh, the mode quirks might have been specific to how 'clike' is configured on the demo/vim.html page. I tried hacking some other pages and it seemed to work fine.\n. Awesome, agree that will be much better. One thing, though: What's the best way to get access to the cm object from this callback?\n. Updated to use option callbacks and refactored alias registration. PTAL.\nI did change the arg order of Vim.defineOption to add aliases before callback and keep the callback last. Shouldn't affect any callers since the callback arg was just added, but I could just as easily make it a separate Vim.defineOptionAlias func or whatever makes sense to you.\n. > Caveat: Changing the mode doesn't seem to totally work. I tried setting to clike in the vim demo and it had some coloring and indentation behavior that was not quite clike.\nI figured out what was going on with the clike mode quirks here. You have to set the mode to \"text/x-csrc\" instead of \"clike\" for it to load the right options. So setOption('mode', getOption('mode')) loses information, which is unfortunate.\n. Aha, I had a small discrepancy getting the 'mode' option in a different way than I was setting it. Fix in #3218.\n. > @dbarnett please see if this fits your needs\nYep, that ought to do it. Thanks!\n. @heppe Still waiting for this to get reviewed and merged, right?\n. Is it worth loading some themes along with the vim demo page now that there's a related feature? If you go to the vim demo page now and do :colorscheme ANYTHINGBUTDEFAULT, it loses all theming.\n. Thanks! Left one comment (take it or leave it), but LGTM.\n. Oh yeah, sorry, there is an error:\nUncaught TypeError: Cannot read property 'changes' of undefined\nexecuteMacroRegister @ vim.js:4775\nactions.replayMacro @ vim.js:2139\ncommandDispatcher.processAction @ vim.js:1179\ncommandDispatcher.processCommand @ vim.js:1099\n(anonymous function) @ vim.js:826\nrunInOp @ codemirror.js:3120\nCodeMirror.operation @ codemirror.js:5202\nvimApi.findKey @ vim.js:820\ndoHandleBinding @ codemirror.js:3990\n(anonymous function) @ codemirror.js:4061\nCodeMirror.lookupKey @ codemirror.js:5744\nlookupKeyForEditor @ codemirror.js:4004\ndispatchKey @ codemirror.js:4020\nhandleCharBinding @ codemirror.js:4060\nonKeyPress @ codemirror.js:4113\n(anonymous function) @ codemirror.js:3130\nHappens in Chrome 42 on Linux if I visit http://codemirror.net/demo/vim.html and do\nvim\n:s/char/foo/\n@:\n. Fixed in 0185ceeae1.\n. Weird. I did some last-minute refactors, but thought I verified tests pass after those. Which ones failed? (Travis results look broken for a different reason.)\n. Yeah, I moved the test file and changed the name and at least thought I re-ran tests. No idea about the other change preventing negative indent, though. Didn't see any failures at all and I think that one would have shown up before my last-minute changes.\nAnyway, sorry for test failures. I'll do better next time. =)\n. How often do you do version bumps? It looks like there hasn't been a new version since 5.6.1, before this change.\n. Is it going to be possible to improve this highlighting without completely rewriting the parser, or is it at a local maximum right now?\n. The other option is for vim.js to pass inner prompt content with an explicit nowrap style, and leave dialog.css alone. Hard to say which is a better default for dialogs in the abstract. But if/when you do want wrapping, you can always wrap the inner content in an explicit white-space: normal style.\n. Intentional behavior.\n\"the contents should be indented\" \u2014 you mean because of some spec, or because you just expect things inside of curly braces to be indented? Not indenting inside @component is an intentional choice, and at least in Google's GSS code that's standard convention.\n. Looks like you just need to use \\b in the regex and add a test.. There's a subtlety that for :set, setOption gets called twice, with and without cm, so even for local-only options you need to expect cm undefined and silently return. I'm not sure if that behavior was intentional. It leads to some ambiguity, and could probably just be fixed at the :set level to detect local-only options, but otherwise it should be documented.\n. ",
    "tonytonyjan": "I just obey the rules of markdown syntax. it is necessary indented by three spaces when markup nested lists, like:\n*   level 1\n    *   level 2\n        *   level 3\n. Ok, I'm going to enhance this feature in the future.\nThanks for your suggestion, @marijnh =)\n. ",
    "JosephPecoraro": "So the fix for this issue, calling offsetHeight, actually triggers a style recalculation in WebKit. Is there is a cheaper way to check if the editor / cursor is invisible?\n. Also, this now nicely matches up with the operator chars list in parse-js.\n. I apologize for the use of \"should\". I normally phrase issue / bug titles as they might appear in a commit message if they are accepted. But I could see how that can be misleading and even potentially insulting. Hopefully the issue body made that clear. I'll rephrase my issue titles in the future.\nThanks for adding the enhancement! That was a quick turnaround.\n. Oh nevermind! Trying with trunk this is fixed. I hadn't updated in a couple weeks. Closing, thanks!\n. Hmm, after further testing I see this on longer lines of input. I opened #1353.\n. Is it expected that we should call refresh somewhere? If we're in an operation, then a refresh doesn't seem to do anything and the scrollIntoView never works. For example replacing the click handler with:\njavascript\n// Set the lines and scroll into view line 251.\ndocument.getElementById('button').addEventListener('click', function() {\n    cm.setValue(\"abc\");\n    cm.operation(function() {\n        cm.setValue(lines.join(\"\\n\"));\n        cm.refresh();\n        cm.setSelection({line: 250, ch:0}, {line: 250});\n        cm.scrollIntoView({line: 250, ch:0});\n    });\n});\n. Calling cm.refresh() after re-inserting the editor in the DOM. That sounds like what we should do.\n. Okay, I think I've got a concrete reduction.\nSafari 6.0.3. CodeMirror 1b150c9.\n``` html\n.CodeMirror {width:50em;height:15em} /<em> 15 lines tall, 50 letters wide </em>/\n\n\n\n// Create editor with line wrapping.\nvar cm = CodeMirror.fromTextArea(document.getElementById('code'), {lineNumbers: true, lineWrapping: true});\n// Insert some content that is all on one line and will wrap more than once.\nvar str = '<?xml version=\"1.0\" encoding=\"UTF-8\" ?><!DOCTYPE html><html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\" xml:lang=\"en\" id=\"bp-doc\"><head><title>Iowa governor holds hearing on releasing killer</title><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\"/><link rel=\"apple-touch-icon\" href=\"http://l.yimg.com/a/i/w/go/ui/apple_webclip.png\"/><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/><style type=\"text/css\">.pageTab{width:33%;display:table-cell;text-align:center;font-weight:bold;-webkit-box-sizing:border-box}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6{padding:0;margin:0}h1,h2,h3,h4,h5,h6{display:inline;font-size:inherit}img{border:0}table{border:0;border-collapse:collapse;border-spacing:0;width:auto;font:inherit}pre,code,kbd,samp,tt{font-family:monospace;line-height:99%;font-size:108%}a{color:inherit;text-decoration:none}ul, li{list-style-type:none}html, body{height:100%}body{-webkit-text-size-adjust:none;font-size:15px;font-family:Helvetica, Arial, sans-serif;background:#fff}#content{min-height:250px;background:#fff}body.cln #content, .group.cln{padding:5px 0}.subtext{color:#6271a0}.uim .subtext{color:#6271a0}.featured .subtext{color:#446b94}.subdued{color:#7c7c7d}.uim .subdued{color:#7c7c7d}.featured .subdued{color:#7c7c7d}.disabled{color:#bcc5cc}.uim .disabled{color:#bcc5cc}.uim.featured .disabled{color:#bcc5cc}.important{font-weight:bold}.important, .negative{color:#b30200}.uim .important, .uim .negative, .uim .hd .uic.important, .uim .hd .uic.negative{color:#b30200}.featured .important, .featured .negative, .featured .hd .uic.important, .featured .hd .uic.negative{color:#b30200}.positive{color:#056005}.uim .positive{color:#056005}.featured .positive{color:#00a400}.link{color:#006ec2}.uim .link{color:#006ec2}.featured .link{color:#006ec2}.url, .url a{color:#398f08;word-break:break-all}.uim .url, .uim .url a{color:#398f08}.featured .url, .featured .url a{color:#398f08}.value{color:#405288}.uim .value{color:#405288}.featured .value{color:#405288}.uim .subtext.description{color:#000}.small{font-size:87%}.title{font-size:115%;font-weight:bold}.article{font-family:Georgia, serif}.article.title{font-weight:normal;font-size:120%}.searchWrap{padding:0 0 0 0;margin:8px;position:relative;-webkit-border-image:url(http://l.yimg.com/jg/api/res/1.2/yl3AWOLZ0yCxPZ4ocCvaOQ--/resource:/brand/yahoo/web/1.0.85/image/Hero/ui/base/onesearch_input) 0 15 0 15 stretch stretch;border-width:0 15px 0 15px}.searchWrap input[type=text], .formField.searchWrap input[type=text], .searchWrap input[type=search], .formField.searchWrap input[type=search]{-webkit-appearance:none;border:0;color:#000;font-size:105%;padding:8px 0 8px 20px;width:98%;-webkit-tap-highlight-color:rgba(0,0,0,0);margin:0;margin-left:-5px;background:transparent url(http://l.yimg.com/jg/api/res/1.2/68ANZwGpF6Idm5Y6O.5fSA--/resource:/brand/yahoo/web/1.0.85/image/Hero/ui/base/mag_glass_simple) no-repeat;background-position:left center}.clearText{display:none;width:19px;height:19px;position:absolute;right:-10px;top:50%;margin-top:-10px;background:transparent url(http://l.yimg.com/jg/api/res/1.2/.6bWgU0z_ecXM_iJkUuk7g--/resource:/brand/yahoo/web/1.0.85/image/Hero/ui/base/clear) left top no-repeat;-webkit-tap-highlight-color:rgba(0,0,0,0)}.focused.typing .clearText{display:block}.buttonSet{display:block;width:100%;text-align:center;padding:0 8px 5px 8px;-webkit-box-sizing:border-box}.buttonSet .formField, .buttonSet .formField input{display:inline-block;width:auto}#page{position:relative;background:#fff}#page.hiding .oneSearch, #page.hiding .osFilter, #page.hiding .pageNav, #page.hiding, #page.hiding .tabSection{-webkit-transform:translate3d(0,0,0)}#allSites{height:0;overflow:hidden;background:#fff;position:absolute;top:0;left:0;z-index:1;width:100%;clip:rect(0,0,0,0);display:none}#allSites.showing{clip:auto;height:auto;overflow:visible;display:block}#allSites.loading{background:#fff url(http://l.yimg.com/a/i/w/go/web/spinner-1.0.0.gif) center center no-repeat}.as-section{display:none}.as-section.showing{display:block}#allSites .titlebar{padding:5px 8px;border-bottom:1px solid rgba(0,0,0,0.25)}#allSites h3{display:inline-block;color:transparent;width:166px;height:21px;background:transparent url(http://l.yimg.com/jg/api/res/1.2/Clz.dSP8pO7D8vWIm34oVg--/resource:/brand/yahoous/web/1.0.45/image/Hero/icon/logo_everything) no-repeat;background-position:top left}#allSites .uiCommand{text-shadow:rgba(0,0,0,0.7) 0px -1px 1px;float:right;display:inline-block;color:#fff;font-weight:bold;font-size:87%;margin-top:2px;padding-left:18px}.uiCommand a.depressed{text-shadow:-2px 0 8px rgba(255,255,255,0.9) !important}#allSites .pageTab{width:33%}#as-featured{position:relative;-webkit-user-select:none;width:100%;padding-top:10px;overflow:hidden;min-height:400px}#featured-list{position:absolute;-webkit-tap-highlight-color:rgba(0,0,0,0);top:0;left:0;white-space:nowrap}#featured-list.showing{-webkit-transform:translate3d(0,0,0)}#featured-list li{-webkit-box-shadow:#666 0px 0px 8px;-webkit-border-radius:6px;display:inline-block;margin:16px 0;width:207px;height:271px}#featured-list.showing li{-webkit-transform:translate3d(0,0,0)}#allSites.loading #featured-list ul, #featured-paginator.loading{-webkit-transition-property:opacity;-webkit-transition-duration:500ms;opacity:0}.app{padding:0.3em 8px;border-top:0;border-bottom:1px solid #e0e0e0;display:table}.app:nth-child(2n){background:#f9f9f9}.app img, .app .description, .app .link{display:table-cell;vertical-align:middle}.app .description{width:100%;font-weight:bold;font-size:93%;-webkit-box-sizing:border-box;padding-left:8px;white-space:nowrap}.app .link button{display:block;white-space:nowrap;-webkit-appearance:none;border:0;-webkit-border-image:url(http://l.yimg.com/jg/api/res/1.2/T9dVm3yrdCvErx.5GGktMQ--/resource:/brand/yahoo/web/1.0.85/image/Hero/ui/base/app_button) 0 5 26 5;border-width:0 5px 0 5px;padding:6px 0;color:#fff;text-shadow:rgba(0,0,0,0.6) 0 -1px 1px;font-size:78%;font-weight:bold;text-align:center;-webkit-box-sizing:border-box}#as-websites{padding-top:5px}#as-websites .site{display:inline-block;width:50%;border-bottom:1px solid #dfdfdf}#as-websites .site > a{display:table;width:100%;-webkit-box-sizing:border-box;padding:0.3em 8px;height:36px}#as-websites .site.linked > a{background:transparent url(http://l.yimg.com/jg/api/res/1.2/KgogrCdgxWaKzIUGC78uQA--/resource:/brand/yahoo/web/1.0.85/image/Hero/ui/base/arrow_blue) no-repeat;background-position:98% center}#as-websites .site.full{width:100%;display:block}#as-websites .site.last{border-bottom:0}#as-websites .site > a > *{display:table-cell;vertical-align:middle}#as-websites .site strong{width:100%;-webkit-box-sizing:border-box;padding-left:8px}#allSites .hr{display:block}#as-preloader{visibility:hidden;position:absolute;left:-1000px;top:-1000px;background-image:url(http://l.yimg.com/jg/api/res/1.2/KgogrCdgxWaKzIUGC78uQA--/resource:/brand/yahoo/web/1.0.85/image/Hero/ui/base/arrow_blue),url(http://l.yimg.com/jg/api/res/1.2/T9dVm3yrdCvErx.5GGktMQ--/resource:/brand/yahoo/web/1.0.85/image/Hero/ui/base/app_button),url(http://l.yimg.com/a/i/w/go/web/spinner-1.0.0.gif),url(http://l.yimg.com/jg/api/res/1.2/Clz.dSP8pO7D8vWIm34oVg--/resource:/brand/yahoous/web/1.0.45/image/Hero/icon/logo_everything)}.withTabs #titlebar{border-bottom:1px solid rgba(0,0,0,0.25)}.pageBranding{background:-webkit-gradient(linear, left top, left bottom, from(#528ea2), to(#112e47), color-stop(0.42, #336384));-webkit-background-size:auto 100%}#allSites .pageHeader{background:-webkit-gradient(linear, left top, left bottom, from(#595959), to(#171717), color-stop(0.42, #383838))}</style>';\ncm.setValue(str);\ncm.refresh();\n// Output the selection, as it changes.\nCodeMirror.on(cm, \"cursorActivity\", function() {\n    document.getElementById(\"selection\").textContent = cm.getSelection();\n});\n\n```\nThe selection (and typing) on the bottom line is unexpected. It appears to be off by one line:\n\n. Maybe there was a style mismatch causing slightly different wrapping?\nTry this live example (codemirror.js and codemirror.css inlined): http://jsfiddle.net/2eryj/\nI'm seeing issues selecting from the \"-1000px\" onward in \"top:-1000px\" about 6870 characters in.\n. No collapsed / folded content.\nWhat do you mean by a non-zero first line? I've seen this happen in two cases:\n1. First time loading the editor and jumping to a line. So the editor would have been empty before the setValue + scrollIntoView calls.\n2. Formatting the content in the editor. So the editor would not have been empty, before the updated setValue and scrollIntoView calls. Typically in this case the the line count goes from a small number to a very high number and the scrollIntoView would be a line number that didn't exist in the original pre-formatted range.\n. Nope, no subviews are involved. Just an editor.\nI'll see if I can get you more info later today. I can reproduce the issue pretty reliably, but just haven't been able to recreate it in a reduction form. Thanks for taking a look so far.\n. Ahah! So the reduction that I had would have worked as long as the CodeMirror global \"sawCollapsedSpans\" is set to true. My reductions weren't triggering that, and our application seems to trigger that separately from within a different editor. So just forcing that state to be true, and then running the reduction below, I reliably get the uncaught exception.\nFirst, Make this change to force CodeMirror into a certain mode:\n``` diff\ndiff --git a/lib/codemirror.js b/lib/codemirror.js\nindex 652f86c..1f14af6 100644\n--- a/lib/codemirror.js\n+++ b/lib/codemirror.js\n@@ -33,7 +33,7 @@ window.CodeMirror = (function() {\n   var captureMiddleClick = gecko || (ie && !ie_lt9);\n// Optimize some code when these features are not used\n-  var sawReadOnlySpans = false, sawCollapsedSpans = false;\n+  var sawReadOnlySpans = false, sawCollapsedSpans = true;\n// CONSTRUCTOR\n```\nThen, run this reduction:\n``` html\n.CodeMirror { height: 500px; width: 500px; }\nChange text and reveal line\n\n\n// Create editor.\nvar textarea = document.getElementById('code');\nvar cm = CodeMirror.fromTextArea(textarea, {lineNumbers: true, lineWrapping:true});\ncm.refresh();\n\n// 100 lines of content\nvar lines = [];\nfor (var i = 0; i < 100; ++i)\n    lines.push(\".something {width:100px;}\");\nvar str = lines.join(\"\\n\");\n\n// Set the lines and scroll into view line 78.\ndocument.getElementById('button').addEventListener('click', function() {\n    cm.operation(function() {\n        cm.setValue(str);\n        cm.scrollIntoView({line: 77, ch:0});\n    });\n});\n\n```\n=> I then see the following uncaught exception:\n[Error] TypeError: 'undefined' is not an object (evaluating 'child.chunkSize') (codemirror.js, line 4634)\nI do not know how / why sawCollapsedSpans is getting set. I assume that is because of a different editor in our application that has markers. Regardless, it seems like a case that might not be handled correctly. However, I can investigate how / why sawCollapsedSpans is triggered in our app if you want me to.\n. Ahh, okay I'll update. Thoughts on adding an API option to scroll something into view centered?\n. Sure, getScrollInfo and charCoords to see if a position is visible, and getScrollInfo and defaultTextHeight to determine how to really center the line. I was suggesting centering as a replacement for the optional margin parameter. But I see your point, and it may be best to keep the API generic to allow for potentially more use cases. Thanks again.\n. Awesome! Thanks for the quick fix!\n. Hmm, the same kind of issue can happen with:\njavascript\n    for ((i=0); (false); ++i);\nThis time the condition breaks the lexical stack.\n. Hmm, I'm clearly new at this GitHub pull request game. Sorry for it creating multiple issues. I guess a pull request automatically creates an issue. I'll keep that in mind for the future.\n. My suggested patch had a failure. It was treating whitespace after a single line comment as a variable. Test:\njavascript\n// ---\n  if (true) alert(1);\n. Seems like the JavaScript tokenizer needs a way to differentiate between single line and multi-line comments, so on the read from the next stream we know if we're still really in a comment context or not. Doing some tweaks to return ret(\"multi-comment\", \"comment\") in jsTokenComment I can get this working in the same vain as my original patch, but I'm not sure if that is the way you would prefer this be written. If you'd like me to propose a patch let me know.\n. Perfect thanks!\n. Hmm, unfortunately my patch (86e6f2f) is not perfect. It causes the following to fail:\njavascript\n// ----\n if\nIt treats the first whitespace after the comment as an identifier / variable:\n\nI'm guessing the fix will need to be more subtle. Suggestions are appreciated.\n. Things are better with your fix. Thanks!\n. This input seems to have the same issue and might be more explicit. This breaks at the ::\njavascript\nif (1,(1?a():1)) true\n. diff\ndiff --git a/mode/javascript/javascript.js b/mode/javascript/javascript.js\nindex 9b5ed89..660b32a 100644\n--- a/mode/javascript/javascript.js\n+++ b/mode/javascript/javascript.js\n@@ -272,7 +272,7 @@ CodeMirror.defineMode(\"javascript\", function(config, parserConfig) {\n     if (atomicTypes.hasOwnProperty(type)) return cont(maybeoperator);\n     if (type == \"function\") return cont(functiondef);\n     if (type == \"keyword c\") return cont(maybeexpression);\n-    if (type == \"(\") return cont(pushlex(\")\"), maybeexpression, expect(\")\"), poplex, maybeoperator);\n+    if (type == \"(\") return cont(pushlex(\")\"), commasep(maybeexpression, \")\"), poplex, maybeoperator);\n     if (type == \"operator\") return cont(expression);\n     if (type == \"[\") return cont(pushlex(\"]\"), commasep(expression, \"]\"), poplex, maybeoperator);\n     if (type == \"{\") return cont(pushlex(\"}\"), commasep(objprop, \"}\"), poplex, maybeoperator);\nThis seems to work well for me. I haven't seen a regression yet.\nI'm a bit confused by the maybeexpression. It was added in (76ef886edd) for https://github.com/marijnh/CodeMirror/pull/330. An empty paren expression there is not actually valid JavaScript, but I could see how it would be useful in fault tolerant editing.\n. Something like this might do the trick:\ndiff\ndiff --git a/mode/javascript/javascript.js b/mode/javascript/javascript.js\nindex f501174..0dd1aee 100644\n--- a/mode/javascript/javascript.js\n+++ b/mode/javascript/javascript.js\n@@ -370,11 +370,15 @@ CodeMirror.defineMode(\"javascript\", function(config, parserConfig) {\n     return function(type, value) {\n       if (type == \"keyword b\" && value == \"else\") {\n         cx.state.lexical = new JSLexical(indent, 0, \"form\", null, cx.state.lexical);\n-        return cont(expression, statement, poplex);\n+        return cont(maybeif);\n       }\n       return pass();\n     };\n   }\n+  function maybeif() {\n+      if (type == \"if\") return cont(expression, statement, poplex, maybeelse(cx.state.indented));\n+      return pass(statement, poplex);\n+  }\n   function forspec1(type) {\n     if (type == \"var\") return cont(vardef1, expect(\";\"), forspec2);\n     if (type == \";\") return cont(forspec2);\n. Yep, that patch looks good. That can close this issue. Thanks!\n. We have a CodeMirror pretty printer. It uses the CodeMirror tokenizer, and decides where to add newlines, whitespace, and indentation. Most (nearly all) of the issues where just quirks I saw when we tried to pretty print jquery.min.js and the token stream took an unexpected turn. From an editor point of view, these could sometimes fix syntax highlighting issues, albeit in edge cases that are unlikely to appear in hand written code. This issue however likely doesn't cause an issue with editing and is obscure, so I'll close it.\nSince you were so effective at fixing the issues I filed earlier, I figured I'd continue to file them. I'll stop filing obscure issues, like this one, which may not be worth the complexity to fix and happen rarely. I have noticed that the parser has gotten more complex with the recent changes. Having a totally correct JavaScript parser might not be the goal for this project which needs to be resilient against any kind of input anyways so might even expect to handle invalid code.\nThanks for the fixes so far; with the last few bugs getting fixed we are in great shape.  The remaining Issue #1443 could make help make our pretty printed output look a lot nicer and more consistent. If I'm not mistaken, that would break tokenization of JSON objects or at least object literals, and may have been a recent regression due to one of the more obscure bugs I filed.\nAgain, I really appreciate your quick responses and fixes for the issues I've filed!\n. On a related note. It would also be good to test this at the same time:\njavascript\nif (!1,(1)) true;\nIt is similar in nature (a comma expression starting with an operator and the expected closing character happens before the real close is expected). Currently it works as expected.\n. In ToT the original cases were fixed, but the extra case noted in the comments broke:\njavascript\nif (!1,(1)) true;\nFixing the original issue was more important then this secondary issue.\n. Sorry about the duplicate Issue and Pull Request. Is there a way to create a pull request for an issue that already exists to avoid creating a duplicate issue #? \n. Thanks for the reduction!\nI've filed a WebKit bug and I'll be following up on this:\nhttps://webkit.org/b/121130 Unexpected word wrapping for wrapped content then raw content\nI think you can close this issue, unless you want to create a workaround.\n. WebKit has fixed the issue http://trac.webkit.org/changeset/157391 and verified in the current nightly.\nThings work as expected for me now in WebKit Nightlies. Closing!\n. Hmm, I was trying on:\nhttp://codemirror.net/mode/css/index.html\nAnd it doesn't look syntax highlighted as I would expect. Does that not use the most up to date version of the CSS mode?\n. To give an example of what I mean, pasting the snippet above into the editor I see \"error\" colors for property values inside the @supports conditional, I'd expect it to look more like the colors normally inside a rule.\nFor example, this line @supports ( (color: red) or (color: blue) ) { becomes:\nhtml\n<span style=\"padding-right: 0.1px;\">\n    <span class=\"cm-def\">@supports</span> ( (\n    <span class=\"cm-property\">color</span>: \n    <span class=\"cm-error\">red</span>)\n    <span class=\"cm-keyword\">or</span> (\n    <span class=\"cm-property\">color</span>: \n    <span class=\"cm-error\">blue</span>) ) {\n</span>\nBut a normal rule, p { color: red; }, becomes:\nhtml\n<span style=\"padding-right: 0.1px;\">\n    <span class=\"cm-tag\">p</span> { \n    <span class=\"cm-property\">color</span>: \n    <span class=\"cm-keyword\">red</span>; }\n</span>\nThe color \"red\" was treated as an error in @supports, but keyword in a rule.\n. Oh interesting. This could just an issue with color keywords and works with everything else!\nstates.atBlock is doing a valuesKeywords check but not a colorKeywords. Maybe this could be using wordAsValue to get value/color/variable behavior or maybe it should just be checking value/color on its own.\n. This got me the syntax highlighting I expected, but you may find other changes that might be necessary:\ndiff\ndiff --git a/mode/css/css.js b/mode/css/css.js\nindex 1e6d2dd..63698c1 100644\n--- a/mode/css/css.js\n+++ b/mode/css/css.js\n@@ -273,6 +273,8 @@ CodeMirror.defineMode(\"css\", function(config, parserConfig) {\n         override = \"string-2\";\n       else if (valueKeywords.hasOwnProperty(word))\n         override = \"atom\";\n+      else if (colorKeywords.hasOwnProperty(word))\n+        override = \"keyword\";\n       else\n         override = \"error\";\n     }\n. Go ahead and apply it! Thanks and sorry for the initial confusion.\n. Sure, I'll start on it.\nThere does appear to be decent support for some of these CSS4 ones already:\nhttp://caniuse.com/#feat=css-media-interaction\n. Looking at it now, even the syntax highlighting for \"url()\" is not quite right.\n. Nice, Thanks!\n. That was fast, thanks!\n. In css.js there is:\njavascript\n  function wordAsValue(stream) {\n    var word = stream.current().toLowerCase();\n    if (valueKeywords.hasOwnProperty(word))\n      override = \"atom\";\n    ...\n  }\nWhich checks for lower cased property names in valueKeywords. However valueKeywords doesn't contain all lowercased property names. In this case it would contain translateX but not translatex.\nHowever, we do want to canonicalize in some way when checking keywords, because value keywords are not always case-sensitive. For example both of these should (and do) highlight the same way (in CodeMirror):\ncss\nbody {\n    font-style: italic;\n    font-style: ITALIC;\n}\n. Thanks for the quick change!\nThere are other values that can be canonicalized to all lowercase, if you want to address this in the same way:\n\"geometricPrecision\"\n\"optimizeLegibility\"\n\"optimizeSpeed\"\n\"rotateX\"\n\"rotateY\"\n\"rotateZ\"\n\"scaleX\"\n\"scaleY\"\n\"scaleZ\"\n\"skewX\"\n\"skewY\"\n\"translateX\"\n\"translateY\"\n\"translateZ\"\n\"visibleFill\"\n\"visiblePainted\"\n\"visibleStroke\"\n. Perfect that was what I was expecting to see! Thanks!\n. This is probably a pretty rare case to handle, but since I came across it I thought I'd mention it.. Good point.\nThanks for the quick fixes marijnh!. ",
    "mokraemer": "Weird, I use Linux too. I've tested this issue several times and it wasn't working.\nMy integrated version inside the cms still isn't.\nI've to do some further investigantions on this - thanks for your fast reply!\n. you're right, opera seems to have changed a few internals on handling of onkeydown - I assume they got closer to the standard. I'm currently investigating where in the hierarchy the event gets canceled :-(\nBut I can acknowledge it has nothing to do with CM.\n. Thanks for your answer - unfortunately I don't have a simple page that reproduces this issue.\nIf you don't mind, I'm going to mail you credentials to a test cms, where you can see this.\n. ",
    "samholman": "I have the same issue with Opera 12.11 on OSX. With CM 2.36 and CM 3.\nCopy/Paste is broken in my own integration of CM but also in the usage demos.\nOn attempting to paste, CM's cursor jumps to the bottom of the editor and fails to paste anything.\nAbout Opera\nVersion information\nVersion\n12.11 \nBuild\n1661 \nPlatform\nMac OS X \nSystem\n10.7.5 \nBrowser identification\nOpera/9.80 (Macintosh; Intel Mac OS X 10.7.5) Presto/2.12.388 Version/12.11\n. Oh dear. Opera has always been my favourite browser, but even I, as what you might call a die hard opera fan, am really having my doubts. A switch may be on the cards.\nBut thanks for your quick response and fix. :-)\n. ",
    "rufuscoder": "Ok thanks that really helped!\n. ",
    "shenzhuxi": "Sorry I think I miss-understand http://codemirror.net/demo/xmlcomplete.html and http://codemirror.net/demo/closetag.html. \nBy the way, is there any document or demo about how to enable xmlHints autocomplete for infinite level? \n. I think this is what I mean. \n\"You don't have to think about tag orders in an HTML page, just type \"<\" and it gives you in proper sequence, according to standard HTML layout. \"\nhttps://groups.google.com/forum/?fromgroups=#!searchin/codemirror/html$20autocomplete/codemirror/BN8ZCrxq_K8/AkJ2qWoob6IJ\nI find on CodeMirror 3.0 it works if I modify xml-hint.js file line 98 like this\n``` javascript\n<             element += getOpenTag(text);\n\n\n        element = getOpenTag(text);\n\n```\n\nShould we do that or create another html-hint.js file? \nBy the way, I'm working on connecting CodeMirror with Drupal now http://drupal.org/node/274431.\n. javascript\nCodeMirror.xmlHints['<mainLevel><'] = [\n          'second',\n          'two'\n      ];\nDo you think defining all the conditions is a good way for XML hints?\n. I'm sorry for my too-short description. \nI'm trying to use CodeMirror with Drupal and enable HTML autocomplete. Because XML is a subset of XML, so I think I should use xmlHints. I try to follow http://codemirror.net/demo/xmlcomplete.html demo and find that if I want to use xml-hint.js I need to write all the HTML marks combinations and also write for multi tag levels.\nFor example: \n``` javascript\nCodeMirror.xmlHints['<'] = \nCodeMirror.xmlHints['<'] = \nCodeMirror.xmlHints['<'] = [\nCodeMirror.xmlHints['<'] = [\nCodeMirror.xmlHints['<'] = [\nCodeMirror.xmlHints['<'] = [\n          'div',\n          'p',\n          'span'\n      ];\n```\nIf I didn't miss anything, I think xml-hint.js can't be use in real use-cases. I agree with what's mentioned in https://groups.google.com/forum/?fromgroups=#!searchin/codemirror/html%2420autocomplete/codemirror/BN8ZCrxq_K8/AkJ2qWoob6IJ\nxml-hint.js should just let user type \"<\" and gives a set of tag candidates which can be defined. For that, we just need to change Line 98 like this:\n``` javascript\n<             element += getOpenTag(text);\n\n\n        element = getOpenTag(text);\n\n```\n\nIf forking CodeMirror and creating a pull request is the best way for you, I can do it. \n. ",
    "gustavohenke": "I'm arriving here after a few problems related to this.\n@marijnh, it would be useful to add rules that override box-sizing in your CSS.\nJust to mention a few huge names:\nTwitter Bootstrap 3 is using it and that blog post from Paul Irish, already quoted before. Probably Zurb Foundation 4 is using it, too.\n. ",
    "sn3p": "I'm using CodeMirror and Bootstrap3 in the same project and noticed the same issues.\nThe double scrollbars only appear when lineNumbers: true.\nThis fixed both issues for me (jsFiddle):\ncss\n.CodeMirror-scroll,\n.CodeMirror-gutters {\n    -moz-box-sizing: content-box;\n    -webkit-box-sizing: content-box;\n    box-sizing: content-box;\n}\n@marijnh maybe consider including this small fix since box-sizing: border-box; is widely used and accepted.\n. This is caused by the textarea codemirror creates. I'm not exactly sure what this does, but positioning the textarea out of sight seems to do the trick:\ncss\n.CodeMirror textarea {\n  left: -9999px;\n}\nHaven't thoroughly tested this thought.\n. ",
    "hayeah": "@marijnh thanks for fixing this. I too was tripped up by bootstrap's setting box-model : (\n. ",
    "mhils": "Thanks for the quick merge and the improvement!\n. ",
    "mihaisucan": "Tested. Bug seems to be fixed. Thank you!\nThe \"!\" there was not relevant to this bug report. In a RTL line that should be placed before the arabic text, but as Marijn points out, the line is LTR. /me confused. You can close this issue - unless you have any further changes to do.\nTo answer Peter's question: the text reads \"marhaban Maha\", which means \"Hello Maha\". :)\n. ",
    "prismofeverything": "Actually, it seems to do a variety of things for newlines, including having empty \"text\" with no \"next\" or \"outside\" and just pointing \"to\" to the next line, ch: 0.\n. ",
    "metatheos": "\nAs an aside, you might want to have the vim mode use defineOption to add a vimMode option which, when turned on, sets the keymap to vim and does a few other things, such as registering cursoractivity handlers that force the cursor back when it is placed in an invalid position.\n\nI've been looking into this suggestion recently and thought I should share my progress at some point so @mightyguava can look at it and make a few suggestions.  In metatheos/CodeMirror@318c66d8baf2d246925263fc0c21232067fd8fa0 I made vim.js register the option vimlike.  It sets the keymap, creates the vim-state and registers for beforeSelectionChange-events.\nThe large amount of red in the commit might be surprising.  Actually it was reasonably easy to get the basic functionality of handling cursor-changes and turning visual mode on/off based on mouse input.  The most difficult point was to deal with vertical movement since I need to set the two column-variables whenever there is an external change to the cursor.\nTo solve this I've ended up managing a local vim.head so I can (mostly) tell where a change is coming from.  To make sure the head is updated in every local operation, those operations now use setCursor(cm,vim,pos,force) which sets the cursor and also updates vim.head.  The force-parameter is intended for all those cases where the head is allowed to be placed after the last character of a line.\nThere are a few additional changes covered in the commit:\n- Cursor is clipped correctly after d and D (adapted tests as well)\n- In visual mode I'm not using the cursor as extension of selection anymore, since I found the behavior confusing and inconsistent.  I'm hiding the cursor, since I can't either show my own or change it to beam for the duration of selecting.\nI didn't make a pull request yet, since with all that shotgun-surgery there might be issues no test caught.  Additionally I'm thinking of getting rid of all the passing around of vim, since with the vim-state being created during the option-change I can expect cm.vimState to be valid.  I might also improve the handling during linewise visual mode by managin a local anchor.\n. > One suggestion I have is that the logic may read better and be more compact if you switch the order of the conditionals\nYou're right I'll really need to look over all the code for the pull request, reorder things and look for obsolete code. This is just the state after I finally got it to mostly behave right.\n\nbut it is intuitive to me as a user\n\nI had mostly two issues from the user-standpoint:\n1. It's visually inconsistent (sometimes the cursor is over the selection, sometimes it isn't) and a blinking extension for selection is not intuitively identifiable as either being covered by operations or not.\n2. It's technically inconsistent. If you d text selected through visual mode, the result is different from right click and cut.\nShowing a fake cursor to the user would indeed be a solid alternative to moving the actual sel.head, sel.from and sel.to around independently.  Unfortunately I don't have any idea if there is a clean way to do this.  @marijnh maybe you can think of something to show a cursor at a custom location without invasive changes to CodeMirror itself?\n\nI don't think you would have to maintain separate vim.head and vim.selHead?\n\nMight very well be true, I have a branch in my personal setup where I could try merging back a few of the issues I've fixed later on. There I've tried allowing to pass my own sel.from and sel.to in the beforeSelectionChange-callback and didn't need this separation.\n\nb is pretty broken in visual mode, and ge is a little buggy too.\nThe selection can now extend 1 character past the end of line\n\nI'll look into that and add tests, thanks for trying it out. I've touched way too much code to find all issues fast myself I fear.\n\nbut that I wanted to abstract hide that vim is a property of cm\n\nHow about having vim.cm store a pointer to the parent object and pass around vim instead of cm?\n\nSome style nits\n\nSure, I'll add that to my cleanup\n\nCould you split the changes to d and D and text object manipulation into a separate branch?\n\nAs for d and D this would be difficult, since it fell into place by itself and I had to make tests check for the correct behavior, I've actually changed c and C to avoid clipping there. The changes to text object manipulation on the other hand should be filtered out, I included them by accident since they were lingering around from before the other changes. I wanted diw,caW and anything similar to behave better, but tripped on whitespace-handling around eol.\n. I tested the stock browser 'Browser' on my Phone (Android 4.2.2) as well (autoresize-demo on the homepage, should be CodeMirror 3.02), and it has the issue.  This App might only be present on devices upgraded from lower versions of Android (as far as I know the only preinstalled browser on Nexus 7 is Chrome, no idea about the other recent official devices).\nMostly this seems to be an issue with how the soft keyboard works on android (or more specifically how it works with a havily customized textarea in a WebView).  If you try running your android-emulator with the hw.keyboard flag enabled, the backspace-key works as it is supposed to.\nTry following page in a WebView or the stock browser:\n<html>\n<head></head>\n<body>\n<textarea id=\"textin\">Hello world</textarea>\n<div id=\"eventout\"></div>\n<script>\n  document.getElementById(\"textin\").onkeydown=function(e){\n    e.preventDefault();\n    var it=document.createElement(\"li\");\n    it.innerHTML=\"Down: \"+e.which;\n    document.getElementById(\"eventout\").appendChild(it);\n  };\n</script>\n</body>\n</html>\nWhat you will notice is that the default IME will allow you to change its own representation of the text (the one where it makes suggestions) and will send events down to the page, expecting them to have the same effect on the textarea. Once you have deleted 'Hello', it will stop sending backspace-events, although the the actual content of the textarea won't have changed.\nWhile looking into the issue I ran into this workaround specifically for CodeMirror.  I didn't try it myself yet, but the idea seems to be \"dumbing the IME down\" by overriding the InputConnection the IME uses to retrieve text for smart things and to send changes back (details on that here).  As a caveat it is stated that IMEs tend to call deleteSurrondingText() on the InputConnection instead of sending the key-event for backspace (KeyEvent.KEYCODE_DEL), which is handled by overriding the function and making it send the key-events.\n. I ran into that myself while doing stuff around the vim-keymap, not sure if it was a change I made or it might be some existing special case. It happend just once for me though, so no idea how I got there (in my special case it might be directly messing with sel that got me there, but again not sure if I was doing that at the time). In my opinion a core function infinitely spinning as a response to bad input is just as bad as it covering a bug, so I'd suggest to replace == by <=.\n. This might be related to why I'm clipping the cursor I receive in the beforeSelectionChange event here. I noticed that on empty lines I tend to get a sel.head.ch of -1, which I think is coming from quite deep into the internal setSelection. I'll put tracking it down from there on my list.\n. How I can reproduce it: \n- Shift+a: enters insert mode (which is handled mostly by core) at eol\n- Shift+Enter: insert linebreak without indent, head seems to be at character 0 at this point (at least that's what editor.doc.sel.head says in the console)\n- Shift+Backspace: spin away\nAt least in this case the issue seems to be in readInput (called from p() in line 1375), which eats up the line-break from the previous line and sets from (line 1406) one character before the start of the line.\n. I see a test failed and for a good reason, I'll have to change the way moveByDisplayLines checks whether the next gj/gk would leave the document (vim.js:980). Right now the check also triggers if moving to space created by line wrapping. Unfortunately neither Chrome nor Firefox tripped on the test before I committed (because of how they wrapped lines). I'll probably have to add a second call to cm.charCoords() testing\n(cm.charCoords(res,\"local\").bottom+3)>=cm.doc.height\nor\n(cm.charCoords(res,\"line\").top-3)<=0\ndepending on direction (unless there is a better approach to this). \nNo idea right now why the test still fails on IE, basically cm.setCursor(0, 176), followed by cm.moveV(-1,\"line\") leaves the cursor at {line:1, ch:34} (seems to only happen in the testing-setup though).\n. > Why are you using 3 pixels for moving lines? Is that going to work if the user increases the font size to something ridiculous?\nFor the 3 I'm imitating codemirror's own moveV. Assuming I understand the code correctly, I'm retrieving a bounding box of the character I'm currently at and then probe either 3px above the top edge or 3px below the lower edge, at the same horizontal position. The value is probably chosen so it reliably changes line but doesn't skip anything. Guess I should also imitate the continuous steps of 5 while I'm over illegal space (I assume this is required to handle widgets or other exceptionally large spacing between lines).\n@marijnh While looking deeper into the issue of handling gaps I started to wonder whether codemirror's own moveV works as intended. In the test-setup my code failed, moveV randomly skips a few (visual) lines around the gaps left by wrapped lines (you can try it by setting up a visible version of the \"verticalMovementCommandsWrapping\" test, and start from the right side of a longer line, moving up/down).\n\nIndeed -- I can't reproduce this in my own setup. If you have a somewhat minimal testcase, I'll gladly take a look at it.\n\nWhile looking for a testcase I found out what was confusing IE on my test. It's because vim-tests create the codemirror-instance with a mode: 'text/x-csrc' option, but that mode doesn't seem to be loaded. Actually loading the mode breaks the 'o'-test because autoformatting kicks in and indents the new line by two spaces.\nI'm inclined to just add an ugly 'out of document'-check for now (or even none, since that shouldn't matter until someone starts approaching q/. and needs to handle 'bell' in some way), and add both a clean version (need to look up how I best turn a \"local\" y into the \"page\" one for the api-version of coordsChar()) and proper crossing of larger gaps separately later. Also I'll move firstLineNumber. At first I thought about moving it to parseLineSpec_ (where it actually belongs), but that would break {num}gg. Could have been such a clean solution. I could also remove the mode-option from vim-tests while I'm at it.\n. @marijnh That was fast. Right now I'm not using the changes, but I've got a pending patch that also does the stepping over 'outside'-areas. The next patch changes a bit more though, so I probably should not stall this request even further if there are no issues with the current state. I want to use div or local coordinates instead of the default page ones (mostly because of scrolling) from the next patch onward, but coordsChar() expects page-coordinates and transforms them to local ones. Would you prefer me to do the inverse transformation in the vim-code or are you ok with (me) adding a mode-parameter to the api-version of coordsChar()? The one thing I'm not sure about is what I'd need to watch for in the offset between local and div, I've only seen display.viewOffset as a difference in the existing transformations.\n. > Just make sure the default stays the same.  \nI thought of:\ncoordsChar: function(coords, mode) {\n  if(!mode || mode==\"page\"){\n    {current code}\n  }else if(mode==\"div\"){\n    return coordsChar(this, coords.left, coords.top-this.display.viewOffset);\n  }\n  return coordsChar(this, coords.left, coords.top);\n},\nbut I could actually change the internal version if you prefer that. As long as this is the correct behavior I can get a patch ready tomorrow.\n\nDo you feel the code in moveV should be factored into a more generic method that you could then reuse for this patch, or are you doing something sufficiently specific that you'll need to write your own version anyway?  \n\nOff the top of my head I'd say it at least requires a bit of code-bending. The new function would have to take a passed cursor (plus target x) and update the cursor. Sounds to me like that would only work by having a common helper-function.   Also I will need to know whether it succeeded in moving the cursor or failed due to hitting the edge of the document.\nTo give you some context: motions in vim can be prefixed by numbers, to make a single motion of that many steps (which I could do by feeding the result back in a few times). Motions are also not only moving the cursor, but are used to describe the scope of commands, like d{motion} for 'd(elete) from here to there', with 'there' being the position the cursor would move to.\n. @marijnh Almost there, seems to work well for me if I do the changes I commented on. I don't have any previous experience with github and little with git, so no idea if I can bring my master-branch up to date and make the changes myself without flooding this pull-request with commits.\n. Thanks for the pointer. To celebrate the fact that github lets me force-push to rewrite history and handles that in the pull-request nicely, another bonus-commit. This one should make vim play nice with subdocuments containing just a partial line-range of the original document.\n. @mightyguava I've added a few changes at vim.js:598 for that in my personal version of CodeMirror (not the one on github though), and planned to commit those here once I've got the current additions stable. In my version I actually explicitely catch the keys from specialKeys that have printable equivalents (Space and Enter right now). My code doesn't do anything with the others, but probably it should do something 'bell'-like (maybe we should open an issue about how to deal with these errors in general). Also in my code r<CR> leaves the cursor at the start of the new linebreak (as in 'behind the last character of the line') which I need to fix. I'd like to sort out the selection-issues first though, since a more significant change I made to r is allowing it to operate on selections. For that again I had to write a test first that expected wrong results, due to selection being one character short.\n. > you'll probably want to use newlineAndIndentContinueComment\nYou're right, I definitely have to adapt that for consistency. Vim-help actually states that it will insert only one linebreak if <CR> or <NL> is the replacement character for a given range, so this is a special case anyway.\n\nIs it not working for you?\n\nI would need to check why it didn't work. I also could have added the same hack to r of course, but at that point I was curious whether it would work out to improve visual mode either way ;)\n\nI also thought you were planning in #1235 to keep a separate selection model and emulate CodeMirror selections with setSelection, which can go a long way to make this better. Or is that for later?\n\nI would prefer to maybe add optional from/to-arguments to setSelection if codemirror can reliably deal with that in general. Locally I do have an implementation that feels a lot more clean, save the new vim.js-specific setSelection that is pretty much:\nfunction setSelection(cm, vim, curStart, curEnd, linewise){\n  cm.operation(function(){\n    var from, to;\n    {do the same as cm.setSelection}\n    if(linewise){\n      from.ch=0;\n      to.ch=lineLength(cm, to.line);\n    }else{\n      to.ch++;\n    }\n    sel.from=cm.clipPos(from);\n    sel.to=cm.clipPos(to);\n  })\n}\n. > If you want to merge moveByLinesToFirstNonWhiteSpaceCharacter, I suggest merging with moveByLines instead\nNow I feel stupid. I'll do just that. Any idea how I could improve the handling of 0-based repeat on _, while I'm at it? I don't like how I introduce motionArgs.repeatOffset just for that.\nAlso: would you mind if I rename textObjectManipulation to textObjectRange and invert its inclusive-parameter, renaming it to inner? I found these names rather confusing as they are.\nAs for the detection for mouse interaction, I've restored that for now, but I hope I can take a stab at solving #1084 the way @marijnh suggests soon. This might result in some tools to handle various mouse-related issues and also help with solving #1038.\n. > Any changes to clean it up is fine by me.\nI just looked through it while trying to improve cw, which led me to looking into aw and iw. At first \"Manipulation\" confused me a bit, I think \"Limits\"  gives a better idea what it is there for.  Also inclusive has a special meaning in vim that is -- as far as I can tell -- unrelated to the use there, so inner might be more descriptive.  I had a patch to improve aw and iw but just noticed that it still needs some tweaks to behavior around the end of lines. The actual fix for cw seems to be even more tricky.\nI merged the two motions, and added two small fixes in another patch. One was an oversight by me (gj and gk are not considered linewise in vim) and the other one was t walking back if there was no such character on the line (because it could not tell whether it got an actual coordinate or an error-value).\nSince you mention v2, how relevant is support for the version? I'm not too familiar with how CodeMirror is used by others so I hope I'm not ignorantly trampling on anything here.\n. The idea of beforeSelectionChange sounds really interesting, maybe that would work even better than an extended api for setSelection().  \n\nI don't have a clear grasp of what the selection problem you're having is like, exactly. \n\nAs I've written in the notes on visual mode, there are a few differences between vim-selection and the default selection handling.  The short version: it covers at least one additional character at the end, and sometimes more in both directions (moving sel.from and sel.to without changing sel.anchor or sel.head).\nYou can also try the vim-demo if you prefer that, press v to activate visual mode and move around using hjkl/arrow keys to select text.  You'll notice that in the current version on the homepage the selection does not include the character under the cursor, while in my version the selection expands under the cursor as well. One notable special situation is that on pressing v, initially sel.to is set to sel.head+1, while sel.anchor and sel.head are still in the same position, which would make setSelection() return early (in the homepage-version there is some flipping of head and anchor to avoid that and I could work around that by moving the cursor before setting selection).  Another thing to try is V for linewise visual mode, which now allows to move the cursor freely within the selected lines (so sel.from and sel.to are only moved whenever sel.head changes lines).\nWhile what I do works whenever I am actively setting selection, a few areas are out of reach this way (namely click/drag and undo).  The vim-keymap does not register for any events at this point, but I'm planning to try your suggestion from #1084 soon.  What I like about beforeSelectionChange is that it might allow me to cover both cases with common code.  Do you think it should be safe to modify sel.from and sel.to in general and especially during beforeSelectionChange?  In that case I would call the normal setSelection() (which I now emulate instead) and do my final touches in the event handler.\nAs for the merge it depends on whether @mightyguava likes the current state and the way I implemented his suggestions.  Especially he might not want the workaround of reimplementing setSelection() to stay in, which I would understand.\n. > There's an invariant that from/to always correspond to anchor/head (from to the lesser one, to to the greater). This invariant is not going away.\nOk, that kicks my approach out of the window. I understand that you don't want to risk stability issues you'd have to deal with though, I'll see if I can get my changes to visual mode out again so the remaining ones can be merged.\n. @mightyguava are you ok with how the patch looks right now? In that case I'd suggest a merge as \n[vim keymap] better r, t, new +/-/_\n- handling special keys better for commands requiring a character\n- r can operate on selection\n- fixed: t moves back if character not found\n- +/-/_ via extension of moveByLines motion\nAlso I'd like you to take a look at d776f74 if you're interested. There I played around with making the selection right but the (now hidden) cursor wrong.\n. You're right, the original commit would have better just been an use-case.  I should have opened a normal Issue first to ask whether sel.from/sel.to values not being a permutation of sel.anchor/sel.head is something CodeMirror is designed to handle.  If it was, I still could have made a pull-request with proper api-access to the values.  Sorry about that.\n. @jackolantern My first idea would be something like\njavascript\n//params.input holds the full input line\nif(params.argString==\"!\" && params.input.match(/^\\w+!(?:\\s+|$)/)){\n  //logic for :delmarks!\n  return;\n}\nto cover \"delmarks!\" as well. Is there a reason this didn't work for you? I might be missing a special case here.\n. For insert-mode I see two approaches:\n- Log the keys. I'm not sure how well it works to put something into vim-insert that reads the key and passes it down for default handling. Also movement needs to be handled properly here. For . movement in insert mode is not part of the recorded operation (cursor movement starts a new insert-session at the new location), for q it obviously is (which means repeating external input).\n- Handle beforeChange/change-events. The advantage here is that it covers autocompletion and any kind of keyboard events you don't want to repeat. The disadvantage is that it needs to understand the change-events correctly and replicate them on an own buffer. And then there are motions you'll need to extract (and if q is supposed to repeat them, things get messy).\nI'll try to finish event-handling over the course of the next week, which is also related to handling external motions, so maybe it will help with that issue for both cases.\n. Currenty I actually lean towards recording keypresses. Look at qacw<Down>abc<Esc>q. While . would just do iabc<Esc>, for q the <Down> in insert-mode needs to be repeatable, something cursor-events won't catch.\n. @marijnh \nFor q:\nImagine having multiple cursors at once, that are all supposed to react to keyboard input in the way you would expect watching them individually.  q is this, but asynchronous.  The command q{character}{input sequence}q allows you to record {input sequence} while doing it at one location, and to replay it at another location by just pressing @{character}.\nIn this case I can imagine motion to be an issue, since it will be hard to tell whether the cursor moved getRange(from,to).length characters horizontally or N lines vertically, or if it jumped by clicking. Unless of course I'm the one causing the motion or one event reports this kind of information.  But still just logging keypresses would probably be true to vim-behavior.  Indicative of this is how it handles qa:tabe<Space>fil<Tab>t<Tab><CR>q:q<CR>@a (:tabe[dit] opens a file in a new tab).  It would do tab-expansion on the filename (assuming there is something like 'file.txt' and 'file.js') during recording, but open 'fil^It' while replaying.  I'm not opposed to deviating from vim-behavior though, if the result is cleaner and/or more robust/sane.\nFor .:\nHere motion can be ignored, since any cursor-movement unrelated to text-change closes the current recording session for ..  I have a basic idea how I would handle this using accumulated change-events.  This would include keeping track of character indices after the last change (through indexFromPos, no idea how expensive that is) and map them to indices before the first change.  Once a change reaches outside of the buffer's index-range both buffer-range and original range would be expanded.  It might still end up being easier to store the separate change-events as a linked list, replacing the absolute coordinates by count of characters left/right of pre-event cursor (from either indexFromPos or getRange().length) instead of merging them.\n. @dextius Great to see so many vim users wanting to contribute to improve the keymap. I'm just passing by myself, so my opinion is not as relevant as that of others here, but I'll still throw a few suggestions in.\nI'm quite sure you don't really need to touch the core here.  Your use-case is probably also not too useful to non-vim-users of codemirror, even less reason to inject it into the core as a hack.  If you really want to add it to the core, than maybe by making findPosV accept doubles for amount, but I don't know if this is a good path to take.\nWhat you might want instead is to call cm.getScrollInfo() (see here) and use the result to get a cursor half a screen from the current one. Something like:\njavascript\nmoveByScroll: function(cm, motionArgs,vim) {\n  var gvim=getVimGlobalState();\n  //motionArgs.repeatIsExplicit seems to be set to false on implicit 1, but not (always) to true on explicit repeat\n  var repeat = (motionArgs.repeatIsExplicit===false) ? gvim.customScroll : gvim.customScroll=motionArgs.repeat ;\n  var scrollbox=cm.getScrollInfo();\n  var curEnd=null;\n  if(repeat){\n    //move cursor by specified range and restore vertical offset\n    var orig=cm.charCoords(cm.getCursor(),\"local\");\n    motionArgs.repeat=repeat;\n    curEnd=motions.moveByDisplayLines(cm,motionArgs,vim);\n    var dest=cm.charCoords(curEnd,\"local\");\n    cm.scrollTo(null, scrollbox.top+dest.top-orig.top);\n  }else{\n    //no customScroll set and no repeat given, scroll by half-page\n    var delta = (motionArgs.forward ? 1 : -1) * (scrollbox.clientHeight/2);\n    var orig=cm.charCoords(cm.getCursor(),\"page\");\n    curEnd=cm.coordsChar({left:orig.left+2, top:orig.top+delta+3});\n    cm.scrollTo(null, scrollbox.top+delta);\n  }\n  return curEnd;\n},\nmight work, but is not too robust in this shape.  Also the global vim-state would have to listen to resize events and reset customScroll. And once there is some error-handling in place it would probably have to report 'out of document'.\n. By my understanding vim-doc says that repeat sets the value of 'scroll' (stored in gvim.customScroll above). And that it is reset on every resize. I chose to make the default value a special case, since -- in contrast to vim -- in codemirror the height of lines can vary. The alternative should be retrieving it from cm.defaultTextHeight() either on resize or in if(!repeat). Since vim deviated from vi by counting display lines instead of lines, my interpretation of the default value was 'scrollbox.clientHeight/2 pixels' instead of 'scrollbox.clientHeight/(2*cm.defaultTextHeight()) display lines' (though I should better move the bottom edge and not the upper). In the alternative case it should be possible to simplify the if-block to\njavascript\nif(!repeat) repeat=scrollbox.clientHeight/(2*cm.defaultTextHeight());\n//original true-branch from here:\nvar orig=cm.charCoords(cm.getCursor(),\"local\");\nmotionArgs.repeat=repeat;\nvar curEnd=motions.moveByDisplayLines(cm,motionArgs,vim);\nvar dest=cm.charCoords(curEnd,\"local\");\ncm.scrollTo(null, scrollbox.top+dest.top-orig.top);\nreturn curEnd;\n. You're right, it would be more robust to set the scrolling based on the new cursor-position. Just adding scrollbox.clientHeight/2 as I did in the first example might introduce some drifting. Another thing in my example that needs to be checked is how it deals with clipping, namely how to make sure the cursor recovers the way it should.\nAlso the point of (not) supporting option-setting made me think of registering\njavascript\nCodeMirror.Vim.defineEx('cmset','cmse',function(cm,params){\n    var match=params.argString.match(/^\\s*(\\S+)\\s*=\\s*(.+)/);\n    if(match){\n        var option=match[1];\n        var value=JSON.parse(match[2]);\n        cm.setOption(option,value);\n    }\n});\nafter adding some safeguards for invalid values all over the place.\n. Sorry for the confusion, I didn't mean adding any kind of check to the actual setOption or the option-callbacks, 'all over the place' was misleading in that regard. It's not even about guarding against anything malicious or type mismatch. I meant catching JSON-parse exceptions, verify that the option actually exists and generally check if there is anything given at various points in the function above, but nothing really complex.\n. ",
    "weltschmerz1": "I came here from Google wondering about the same thing. In case anyone is wondering how to apply this only to some text editors and not all, this worked for me:\n``` javascript\nvar cm = CodeMirror.fromTextArea(htmlElement, { / options / });\n// Some condition to apply this to only text editors that are meant to be readonly\nif (readonly) {\n    var $wrapper = $(cm.getWrapperElement());\n    $wrapper.addClass('CodeMirror-readonly'); // hides cursor\n}\n```\nPaired with the following css:\ncss\n/* Hide cursor in readonly fields */\n.CodeMirror-readonly .CodeMirror-cursor {\n  display: none !important\n}\n. Following up on this, it would be very useful to track the appearance of the autocomplete dropdown from outside of a CodeMirror instance.\nThe above mentioned \"shown\" could be combined with something like\njs\nthis.cm.on('endCompletion', function () {\n  // autocomplete dropdown disappeared\n});\non a CodeMirror instance.\nbecause the above mentioned \"close\" event does not reliably trigger for me when the autocomplete dropdown disappears.\nIn any case, I needed a \"global\" approach (i.e. completely outside of any CodeMirror instance). My case is that I listen to the escape key being pressed, in which case I want to unfocus a form (which includes one or more CodeMirror textareas) - but only if no autosuggest dropdown is being shown.\nI got around the issue by doing this for now:\n```js\n$('body').on('DOMNodeInserted', '.CodeMirror-hints', function () {\n  // Autocomplete dropdown is now showing\n});\n$('body').on('DOMNodeRemoved', '.CodeMirror-hints', function () {\n  // Timeout so as to not race with CodeMirror\n  // (or a user who too eagerly hits the escape key twice in a row)\n  setTimeout(() => {\n    // Autocomplete dropdown is now hidden\n  }, 1000);\n});\n```\nBut this feels really ugly, and the \"DOMNodeInserted\" and \"DOMNodeRemoved\" events are deprecated. The fact that the timeout is necessary is weird also, but otherwise CodeMirror always beat me to it.\nHaving said all this:\nIdeally, there would be global events like\njs\nCodeMirror.on('autocompleteShown', function () { ... });\nand\njs\nCodeMirror.on('autocompleteHidden', function () { ... });\nI'm assuming a user can never be in two CodeMirror instances at once, therefore no two autocomplete dropdowns can ever be shown at the same time, and so their would be no need to tie this to an instance.. ",
    "nasser": "\nFor outerType, you're referring to codemirror.js:4519, right? I'll find away to pass that in.\nThe correct position of the scrollbars should be on the left in a right to left layout. I think direction: rtl' on the scrolling element might do it. Otherwise we have to resort to JavaScript.\nSelection drawing code shouldn't be hard to change at all. Where in the code should I look?\n\nAlso, mouse clicking the mouse does not set the cursor position or give the editor focus. In fact, it seems to have no effect at all when I enable rtl. Any idea what could cause this?\nThanks for the feedback!\n. ",
    "jiji262": "Could you tell me how to use RTL feature in 3.14?\n. @marijnh It seems the same:>\n. IE 9.\nAnd  another question, when set codemirror to READONLY, how to support copy/cut?\nIt doesn't work on Firefox too. Ctrl-C also doesn't work in READONLY mode\n. This fixed my problem, thanks very much.\n. ``` javascript\nonKeyEvent : function(cm, evt) {\n                    if (evt.type == \"keyup\" && ((evt.which >= 65 && evt.which <= 90) || evt.which == 56) && !evt.ctrlKey) {\n                        var isComment = cm.getTokenTypeAt(cm.getDoc().getCursor()) == \"comment\";\n                        if(!isComment){\n                            //show hints function\n                            CodeMirror.showHint(cm, CodeMirror.sapscriptHint, {\"keywordsText\": keywordsText});\n                        }                      \n                    }\n                },\n\u00b7\u00b7\u00b7\nI used show_hint.js plugin here. and this problem happens every time.\n```\n. ",
    "curvedmark": "This does fix the problem. Thanks\nHowever, height: 100%; is different from height: auto. In my case, I have other elements exist inside the container. So I really can't give CodeMirror a full height.\n. Actually there is another problem with height: 100%;. By using height: 100%;, codemirror's height is fixed, it no longer grows as more text is typed, and scrolling is now handled by codemirror instead of the container.\nI updated the demo to put an additional element before codemirror: http://jsfiddle.net/vgZrs/4/\nI also tested the v3.1 branch, which has the same issue: http://jsfiddle.net/vgZrs/5/\n. Thanks for the heads up.\nI've actually simplified my design to just use a 100% height editor, but I suspect the container will eventually to be added back. When that happens and it's still not fixed in the CodeMirror, I would certainly take a stab at it.\nHowever, a quick search shows someone did try to implement a cross-browser scrollIntoViewIfNeeded. The implement has a few limits mentioned by the author. Not sure how much that might be of help.\nAlso I did try to understand how the editor is scrolled into view by reading your blogs. One of them mentioned the hidden textarea, said browser scrolls it into view when there is activity in it. So I expect the content of the hidden textarea and the content of the editor are in sync, but probing the value of the hidden textarea shows it's only a few spaces chars (after the editor has been initialized, in the demo I provided earlier). Is the description in the blog still valid (in which case I must have missed something) or the model has actually changed?\nThank you for sharing this great project and providing thorough documents. :)\n. I'm inspired to come up with a flawed solution: http://jsfiddle.net/vgZrs/6/\nIt blur() and focus() the hidden textarea when Enter is pressed, which scrolls it into view, but somehow this method doesn't work with keydown event, so if you keep pressing Enter, it won't scroll until you release the key.\nBut do you think I'm on the right track? If the hidden textarea could somehow be updated when Enter is pressed, the problem will be solved.\n. A naive thought: why not let the textarea receive the actual Enter key, but does not insert the char into editor? Is it really hard to do that?\n. ",
    "rickhall": "Just wanted to add my $0.02...it seems without this ability, auto-resized CodeMirror instances are of questionable usefulness, because at some point they will grow to big and need to be scrolled by their container.\n. ",
    "danday74": "Thanks to @jmuharsky who has provided a very simple and clear reproduction of this problem:\nhttps://jsfiddle.net/jmuharsky/kpza6wuu/2/\n. ",
    "coderaiser": "In Chrome Version 26.0.1369.0 canary everything works fine but extra character prints\n```\n>\n\n```\nand error in js console\nUncaught TypeError: Cannot read property 'line' of undefined codemirror.js:2146\nLooks like in expression:\nvar line = getLine(doc, curPos.line), toClear;\ncurPos is undefined\n. Everything works good, thank you. And it's definitely better to clearTimeout then just ignore it as I did.\n. ",
    "togakangaroo": "\"By design\" is a fair response to this but I'm not sure I understand how it would be so much more expensive. You are already polling a text area, this would just require polling another one as well - seems like a fairly minor performance penalty. Since not implementing this would shut down the default expectations of data-binding frameworks like knockoutjs I'd urge you to think about adding this.\nFor the sake of progeny, shimming this is simple enough.\nFrom inside a custom jquery Ui widget wrapper (and using underscore):\n``` javascript\n      ,shimSaveTriggersChange: function() {\n            this.editor.save = .wrap(this.editor.save, function(original){  //this.editor is the CM editor\n                original.apply(this, arguments);\n                $(this.getTextArea()).trigger('change');\n            }, this);\n            this.editor.on('change', _.bind(this.editor.save, this.editor));\n        }\n    ,_shimPollOriginalTextarea: function() {\n        //https://github.com/marijnh/CodeMirror/issues/1119\n        var  interval   = this.editor.getOption('pollInterval')*1.1\n            ,widget     = this;\n        window.setInterval(function shimPollOriginalTextarea(){\n            var textAreaVal = widget.$editor.val();\n            if(widget.editor.getValue() != textAreaVal)\n                widget.editor.setValue(textAreaVal);\n        }, interval);\n    }\n\n```\n. Ah, fair enough. thanks for the explanation.\nOn Jan 2, 2013 5:03 AM, \"Marijn Haverbeke\" notifications@github.com wrote:\n\nThe thing is that the hidden, internal textarea has been engineered to be\ncheap to poll -- it never contains a lot of text, and it always has most of\nthe text inside of it selected, so that the value only needs to be\nextracted when it has no selection (typing will clear the selection).\nAn external textarea does not have these properties. Getting and setting\nthe content of a textarea is relatively expensive if the string is long, so\nit would not be cheap to poll. Furthermore, it'd need _completely_different polling code, since it behaves nothing like the hidden textarea\n(which does not contain the whole document).\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/1119#issuecomment-11804975.\n. \n",
    "geverl": "So when does it consider it appropriate? In my experience it always does, which is annoying, especially if you want to display only a function, in which case it always adds a blank line at the end, which is neither needed nor useful.\n. Where can I find the patch?\n. ",
    "robertop23": "I thinks this can be merged, pull request are accepted.\n. ",
    "shurama": "Disabling matchBrackets didn\u2019t work. I disabled all the options, but the same result:\n```\n   self.mirror = CodeMirror.fromTextArea($pm.gc(\"Text2Edit\").Element().get(0), {\n    mode: \"javascript\" //,\n\n    //lineNumbers: false,\n\n    //gutters: [\"CodeMirror-linenumbers\", \"breakpoints\"],\n\n    //lineWrapping: true,\n\n    //enterMode: 'keep',\n\n    //fixedGutter: true,\n\n    //matchBrackets: true,\n\n    //theme: \"neat\",\n\n    //extraKeys: { \"Ctrl-Space\": \"autocomplete\" }\n\n});\n\n```\nEnter works fine except when the cursor is at the end of a line.\nI tried any text, for example this one:\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\nlineNumbers: true,\ngutters: [\"CodeMirror-linenumbers\", \"breakpoints\"]\n});\neditor.on(\"gutterClick\", function(cm, n) {\nvar info = cm.lineInfo(n);\ncm.setGutterMarker(n, \"breakpoints\", info.markers ? null : makeMarker());\n});\nfunction makeMarker() {\nvar marker = document.createElement(\"div\");\nmarker.innerHTML = \"?\";\nmarker.className = \"breakpoint\";\nreturn marker;\n}\nBest Regards,\nAlex Malin\nFrom: Marijn Haverbeke [mailto:notifications@github.com] \nSent: Monday, January 07, 2013 1:17 PM\nTo: marijnh/CodeMirror\nCc: shurama\nSubject: Re: [CodeMirror] Enter in IE9 sometimes doesn't work (#1138)\nI could not reproduce this. Does the problem go away if you disable matchBrackets? Which text, precisely, did you paste in? And does the problem happen on all lines, or only on specific ones?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/marijnh/CodeMirror/issues/1138#issuecomment-11948216 . \n\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435: \u0420\u0438\u0441\u0443\u043d\u043e\u043a \u0443\u0434\u0430\u043b\u0435\u043d \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u0435\u043c.\n. IE version number is:\nOn  http://codemirror.net/mode/javascript http://codemirror.net/mode/javascript everything works fine...\nI open codemirror editor inside jquery modal dialog. Maybe this will help\u2026\nBest Regards,\nAlex Malin\nFrom: Marijn Haverbeke [mailto:notifications@github.com] \nSent: Thursday, January 10, 2013 11:56 AM\nTo: marijnh/CodeMirror\nCc: shurama\nSubject: Re: [CodeMirror] Enter in IE9 sometimes doesn't work (#1138)\nThanks for the added information. Still no luck reproducing it. Does it also happen for you on http://codemirror.net/mode/javascript ? Which CodeMirror version are you using? And which precise IE9 version?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/marijnh/CodeMirror/issues/1138#issuecomment-12087539 . \nhttps://github.com/notifications/beacon/vYA5e6s-wkdQnqKisbASb95LQ28PocI7pNgZaWJBwuq5fLs8PnHkfZ-QD3iSer8g.gif \n. ",
    "SamuelEnglard": "No problem, miss understood this file's purpose, will switch it to a new file then\n. ",
    "sukima": "May be related:\n```\n$ git checkout master\n$ git pull origin master\n$ npm install\n$ npm test\n\ncodemirror@5.0.1 test /Users/suki/source/CodeMirror\nnode ./test/run.js\n\ncore_measureEndOfLine\nassertion failed (not at right)\n1 failure\n{ [Error: Command failed: 2015-03-08 14:44:10.370 phantomjs[54443:5703212]  WARNING: Method userSpaceScaleFactor in class NSView is deprecated on 10.7 and later. It should not be used in new applications. Use convertRectToBacking: instead.\n] killed: false, code: 1, signal: null }\n2015-03-08 14:44:10.370 phantomjs[54443:5703212]  WARNING: Method userSpaceScaleFactor in class NSView is deprecated on 10.7 and later. It should not be used in new applications. Use convertRectToBacking: instead.\nnpm ERR! Test failed.  See above for more details.\n``\n. @marijnh Are you asking me? This was with PhantomJS using thenpm test` command. Opera has nothing to do with it. But since it is the exact same error message it can now be reproduced in two environments (phantom and opera).\n. PhantomJS 1.9.8 (Max OS X)\n. ",
    "martinstarman": "I can reproduce this issue. If I zoom to 75 %, this test failed:\n- scroll_movedown_resize\n- scroll_moveright_scroll\nIf I zom to 90 %, this tests failed:\n- core_lineWidgetChanged\n- scroll_moveright_scroll\nOpera, version 28.0.1750.51, stable channel, Win7 32b.\n. @marijnh Thanks for your comments. I change the code, but i dont know if I'm using innerMode correctly. \n. @marijnh Thanks!\n. ",
    "jasonsanjose": "Thanks!\n. I see. Thanks for reviewing the fix. Would it be more correct to call updateDisplay in this case?\n. Closing. See comment thread in #1153.\n. I tried using a div with overflow:scroll instead of a nested CodeMirror instance as a simpler test case. However, that usage works as expected and does not exhibit this issue. \n. Yes, this does help. But it looks like there was some regression in determining the initial height of a CodeMirror instance inside a widget. I think you can consider this issue closed while I investigate the sizing issue separately. Thanks!\n. Great, that fix works for Brackets. Thanks!\n. Hmm, that didn't work for me on Chrome 26.0.1410.65 on mac. You meant .CodeMirror-gutters { clear: both; border: none; } right? I tried that in developer tools with this demo http://codemirror.net/demo/resize.html and I still see the  whole editor repaint.\n. Ah, that makes sense. That patch fixes my jsfiddle example. I'll try this out in Brackets.\n. I could still reproduce something similar in Chrome 29 and Canary 31, see #1787.\n. Yes, this seems like a duplicate of #1022. I tested your fix and it seems to be a good enough option for us. Thanks for the fast turnaround.\n. @marijnh I actually see both behaviors.\n. Oh, my mistake. I thought that's what you meant in your prior comment.\n. @RaymondLim I actually was able to reproduced it still in my example http://jasonsanjose.github.io/uploads/word-wrap-bug.html with the same frequency as before.\n. Perfect. Confirmed the fix. Thanks!\n. Looks good. Thanks!\n. Got it. Thanks for the clarification. Closing.\n. Yes, I'll update the docs with some usage examples.\nGood question about multiple linked modes. I didn't intend for multiple active linked modes, I can rework the API to be more explicit about that. I think it's a valid use case though. Using Eclipse as a precedent, it can be desirable in the case of nested modes:\nfoo.myMethod([argOne], [argTwo])[exit1]\n...use code hints to insert and begin a new nested linked mode at argOne...\nfoo.myMethod([bar.getResource([nestedArg])[exit2]], [argTwo])[exit1]\nI can't think of a good case for disjoint/non-nested linked modes though.\n. I fixed both the bugs you mentioned https://github.com/marijnh/CodeMirror/pull/2327#issuecomment-36616974 and https://github.com/marijnh/CodeMirror/pull/2327#issuecomment-36617048. I also updated the docs and did some refactor to how markers are cached.\nI added some notes about future plans:\n- Nested linked modes\n- Error checking for overlapping ranges\n- linkedModeFocus and linkedModeBlur events\n- Smart sorting based on LinkedPosition document\nOverall though, I'd like to get some feedback on the overall design and get your thoughts on (1) is this desirable to land as an addon and (2) if it is, would you like to see any of those unimplemented features arrive first.\n. For cross-document editing in Eclipse, they leverage this for rename refactoring across all open documents/editors.\nThe snippet combination is a good suggestion. The other simpler case I had in mind was just the autoCloseBrackets addon. You could define a position within the brackets/quotes/braces and an exit position just after:\nvar str = \"[position]\"[exit]\nIt doesn't seem like much to use the right arrow to move past the closing quote, but I found it surprisingly convenient. Though I just realized that the autoCloseBrackets addon basically gets this \"overwrite\" behavior when you have a matching pair.\nI definitely agree with your verbose comment and conventions. That should be easy to address.\nI'm not in a hurry. Your feedback so far has been great. I posted this PR to the google group as well for discussion.\n. I used keydown for preventDefault(). Do keymaps support this? Looks like keymap handlers only pass the cm instance.\n. ",
    "soswow": "I have it in my pull-request attached. (but I made pull request into adobe's clone.\n. ",
    "sdeancos": "Yes, it's the same issue.\nThank anyway!\n. Thank you so much for help!\nI will try the solution that you propose give me a soon as possible.\nMany thanks!\nMy best wishes with the project.\nBest regards.\n. Hi!\nI try your solution:\nMy code:\n$(window).bind('beforeunload', function() {\n   myEditor.save();\n});\nbut not working... however I have found that works well with the option readOnly.\n. ",
    "joelrbrandt": "It's easiest to get this to reproduce with 100k+ character lines. But, I've seen it happen with ~8k lines, which isn't very long for data URIs.\n. @marijnh Confirming fixed, thanks for your help!\n. ",
    "matias-capeletto": "Hello marijnh,\nI was just going to report a fix that may be related to this.\nhttps://github.com/marijnh/CodeMirror/blob/master/lib/codemirror.js#L3696\nThat 5000 should be 50000:\nif (stream.pos > 5000) {\n    // Webkit seems to refuse to render text nodes longer than 57444 characters\n    stream.pos = Math.min(text.length, stream.pos + 50000);\n    style = null;\n  }\nThanks a lot for the lib!\n. @marijnh Sorry for the noise, good it is fixed now :)\n. ",
    "danyaPostfactum": "peterkroon, it's cool! Where did you found this workaround for Opera?\n. ",
    "dadamsuk": "It is on the last line when the editor is opened.  No steps required, just open the editor and there it is, stuck on the last line.  It's not being used on a public facing app but I'll try to recreate it and give you a URL.\n. Just tried that; makes no difference.  Am putting together an example (hopefully).\n. I've found the problem.  The cursor CSS lacked the \"position: absolute;\".  I hadn't updated that with the new 3.1 .js source.  Apologies for taking your time on this.\n. ",
    "arthuredelstein": "I was just about to do that. Thanks, aking!\n. ",
    "onecrayon": "That behavior makes much more sense to me; I was a little puzzled when I looked in the code and found that widgets defaulted to obscuring the position they were being placed at. :-)\n. ",
    "glinden": "Only when you wrap the whole thing in an app.  There apparently are subtle differences between Chrome on Android and the WebView render used by Android app, and it's only a bug with the WebView renderer (or, possibly, some weird optimization related to text selection and backspace in the Android virtual keyboard that shows up only when the WebView renderer is used in an app).\nHonestly, my expectation is that you will close this as \"will not fix\".  I know mobile is only loosely supported and this is a bit of an obscure case (though it is true a lot of people want to package up HTML5 sites as WebView apps so that the code never needs to contact the network from the mobile device).  I'm more just reporting something that wasn't reported yet, something that you might want to know about, not really expecting a fix, just giving information in case others hit it.\n. Hi, Marijn.  Thanks for remembering it and looking at it again.\nShort answer is that it doesn't appear to be fixed with this patch.\nLonger answer is that I went back and re-coded up the simple test case described in the first post in this thread, then tried it with the latest v4 codemirror code.  The behavior is slightly different; you can backspace one character, but not over the rest, when selecting into existing text (so, if you click into the CodeMirror text area on some existing code that was in there when it was initialized, then hit backspace, you oddly can go back one character, but no more).  I also tried requiring the latest Android SDK (4.4), which apparently has a lot of changes to WebView to make it closer to Chrome, so I had hoped that might yield a solution (since this works fine in the Chrome browser on Android devices, just not in a WebView Android app that has the HTML embedded in the app).  But that didn't make any difference when I tested it.\nIn the end, I think this is a bug in Android's WebView client.  As described in the first post on this thread, WebView appears to make an assumption about what text is editable as an optimization, but CodeMirror's use of a div seems to break that assumption.  But since CodeMirror only loosely supports mobile and using WebView to package up a website as an app is a bit of a hack, I really had no expectation that this would be fixed when I reported it.  Very much appreciate you looking at it again, though, and thanks again for your hard work on this CodeMirror library.\n. Hi, Marijn. You are persistent, aren't you!  Unfortunately, that patch didn't work, no change in the behavior.  But, given the time you spent on this, I thought it only right that I fire up a debugger and try to get to the bottom of this, so I spent a few hours doing that.\nShort story is that readInput() in codemirror.js isn't even getting key events when the backspace key isn't working.  So, I don't know, but I'm not sure there are solutions you can do involving changes to readInput() that are likely to matter.\nLonger story is that I attached debuggers to a small running app implementing the test case at the beginning of this thread using the latest v4 codemirror.js.  I debugged both codemirror.js and made an attempt to step through the Android code in the debugger to find out why key events aren't getting sent in this case.\nWhat is going on is that the virtual keyboard (aka \"soft input\") on Android has some amount of text it considers editable.  When I stepped through in the debugger, I noticed that codemirror.js: readinput() isn't even getting called when you hit backspace.  Why not?  It appears to be because WebKit (which is what Android WebView uses) doesn't consider the div with the source code in it to be editable, so it uses the default behavior, which is to say the virtual keyboard is editing an empty string.  When you try to backspace over an empty selection, the Android code gobbles up the backspace event and doesn't pass it on.\nWhat I'd say this means is that you aren't likely to find a fix for this in readInput() in codemirror.js.  You might find a workaround, possibly a quite ugly one, if you were sufficiently hacky about what you do with the div CodeMirror uses to hold the source code (though I'd guess this is complicated by the fact that that div contains HTML to do the syntax highlighting of the code).  You might also be able to trick the WebKit browser into thinking it's editing one thing but actually have it edit another by swapping things out right as an attempt to edit the code starts, but, again, that's a lot of work and ugly just for this.\nUnfortunately, what we appear to have here is an obscure and nasty interaction between Android's rather odd virtual keyboard, Android's WebView implementation and the underlying WebKit renderer, and the way CodeMirror tries to use a div to contain the editable source code.  Fortunately, the damage here is pretty limited, as this only comes up if you try to build an Android app using WebView, not if you try to view a web page using Chrome on Android.\nSo, I'd say this is a case where you probably want to say, \"known problem, will not fix\".  But, if you want to try something else, let me know and I can see if I can help.\n. By the way, my coding skills are sad and tired at this point (some might even say decrepit).  So, if anyone else wants to give this a go, it's not too bad to do.  Basically, follow the instructions at\nhttp://developer.android.com/sdk/installing/bundle.html\nhttp://developer.android.com/guide/webapps/webview.html\nhttps://developers.google.com/chrome-developer-tools/docs/remote-debugging\nThen code up a very simple WebView app (like the Java code at the top of this thread) with a very simple index.html file that includes codemirror.js (like the one at the top of this thread).  You can then hook up your Android device to your computer using a USB cable, enable debugging on the Android device, run your app in Eclipse, then have Chrome/Eclipse debuggers set all kinds of breakpoints in your Javascript (like codemirror.js) and your Java libraries (like Android) to investigate.  It's kind of a fun way to learn more about all this stuff too.  If anyone else wants to try it, please do.\n. @marijnh  I've failed to be clear, sorry, I probably should have kept it shorter\nI get that you're doing a hack with the textarea to try to toss in an underscore char into it that can then be deleted. I think the problem is that the hack isn't working with WebView under Android because the virtual keyboard isn't looking again at the textarea to see if it has changed.  So, you try to give it another underscore character to delete, but the virtual keyboard is already up and ignores that.  And, because it ignores the change to the textarea, it stops sending backspace events when it has deleted the first underscore character.\n. So, I'm a big fan of trying to make simple test cases that illustrate the problem.  Here's a small HTML file that attempts to do something like the hack you are doing with the textarea.\nhtml\n<html>\n<head>\n</head>\n<body>\n<textarea id=mytext></textarea>\n<script>\nfunction resetText() {\n  var mytext = document.getElementById(\"mytext\");\n  mytext.focus();\n  mytext.value = \"_\";\n  window.setTimeout(resetText, 100);\n}\nwindow.setTimeout(resetText, 100);\n</script>\n</body>\n</html>\nYou presumably expect that to constantly keep an underscore character in that textarea no matter how much you try to delete it, right?  And that's how it works under most web browsers and most keyboards.\nI loaded a simple Android WebView app on to a Nexus 7 where the app just loads that HTML into a WebView.  Then, in that WebView app, if you try to edit the textarea using the virtual keyboard, you can only delete the underscore once, then it no longer registers that you are clicking backspace anymore.  That's a problem.  That's not the behavior you are expecting.  You are expecting that you can keep deleting as long as you keep changing the textarea, but that's not the behavior this test case produces under Android WebView.\nI should add that it's a little inconsistent about it.  Sometimes you can delete the underscore more than once.  It appears to be some kind of timing issue where the virtual keyboard can enter some state where it thinks there is no longer anything to delete.  What is consistent is that, if you keep trying to backspace, it always eventually enters some state where it stops registering the backspace (and stops sending keydown backspace events to the web page).\nIn any case, you're depending on something like this working consistently.  You're assuming that, when you update the textarea, the virtual keyboard will start working with that textarea's updated value.  But there appears to be a bug in the interaction between WebView and the virtual keyboard on Android that breaks that.  Tracking down exactly where that is in the Android code might be helpful and was what I was unsuccessfully trying to bungle through yesterday.\nLong story short, if you can't depend on this simple test case working properly on Android under WebView, I think you have to either do something significantly different than your current attempt at a workaround, find the problem in the Android code and submit a patch, or give up on supporting CodeMirror under WebView on Android.\nI hope that helps!\n. If it helps, I looked around a bit more, and it looks like several others have struggled with this and got much further than I did.  If you're at all interested in the details of the mess, here are some good sources:\nhttps://code.google.com/p/android/issues/detail?id=42904\nhttp://stackoverflow.com/questions/14560344/android-backspace-in-webview-baseinputconnection/14561345#14561345\nhttp://stackoverflow.com/questions/18581636/android-cannot-capture-backspace-delete-press-in-soft-keyboard/19980975#19980975\nLong story short, Google claims this is by design, that you should never count on the virtual keyboard actually sending key events to the application.  So, not only can you not fix this with changes to CodeMirror.js, an Android patch wouldn't be accepted.\nIt seems the only way to fix this is to, as some people have done, override the default behavior of the virtual keyboard in the Android app (by defining your own InputConnection, it appears).  But I'd say that means you should definitely punt on supporting CodeMirror under WebView on Android, maybe just refer people to the workarounds people have done (second and third links above) if they ask about this.\n. @jaredrummler I didn't try the InputConnection override of the default behavior of the virtual keyboard. That seems like a fragile solution to me, too fragile to be worthwhile for my particular application. I put effort into this more because I was interested in the root cause (\"Google claims this is by design, that you should never count on the virtual keyboard actually sending key events to the application\").\n. ",
    "Nisk": "Hi, I'm also running into this issue, I've only started playing with codemirror(on Android 4.2.2), so it's far too early to give up yet. If the link to the solution above works, I'll be happy, though I'm using PhoneGap, so editing Java might be difficult (it's compiled into .class jar library), I'll have to see. Just giving this issue a bump and wondering if anyone has any other solutions?\n. ",
    "sthomp": "Noticed this issue in the stock browser (not chrome) on Android 4.1.2. Just going to http://www.codemirror.net and trying the simple demo seems to be enough to trigger this issue of backspace not working. \n. Seeing this issue on Chrome 28.0.1500.71 on OSX. \n. I've also started noticing a problem with the cursor position and line wrapping on Chrome 28.0.1500.71.\nI can replicate the issue easily on the line wrapping demo page (http://codemirror.net/demo/indentwrap.html).\nJust start typing random gibberish till you type to the next line. Then you'll see that the cursor no longer lines up.\n. ",
    "mrjoelkemp": "This version of CodeMirror works fine on a Nexus 4. https://code.google.com/p/codemirror-android/source/browse/assets/codemirror2/lib/codemirror.js. Not sure what the version number is.\n. ",
    "fhoffa": "Seems this is more of an accessibility issue, instead of Android issue.\nMany virtual keyboards don't send a backspace key event when the text is empty. (This comes from a conversation I had with people that understand keyboards way better than me - I'm being the messenger).\nTo reproduce:\n1. Install the \"Chrome virtual keyboard\": https://chrome.google.com/webstore/detail/chrome-virtual-keyboard/pflmllfnnabikmfkkaddkoolinlfninn/details. (I did it on Linux). Turn it on.\n2. Go to http://codemirror.net/demo/complete.html.\n3. Try to delete the existing text.\nExpected result:\nI should be able to delete the pre-existent text.\nActual result:\nI can't.\n(but I can add text and then delete it without problem)\nPicture:\nhttp://i.imgur.com/6j2HtyL.png\nActual request:\nIs it possible to make CodeMirror compatible with all accessibility and virtual keyboards?\n. ",
    "AntoineFouilleul": "I don't know if this patch helps with this issue but now CodeMirror crash on FireFox 26 :\nline 172 : d.input.setSelectionRange(1, 1);\nError : \"NS_ERROR_FAILURE\" \nKnow Bug : Firefox explode when calling 'setSelectionRange' on hidden element !\n. Fixed. Thanks !\n. Only the Firefox error for now. I will test with a nexus 7 in a few hour and i will tell you if it's fixed.\n. Can't tell you if backspace problem is fixed on Android because i can't install and dev custom application on it. \n. First, thank for your reply and you're doing a very great job with CodeMirror.\nYou right with my fix, it's not a good idea. \nMy bug also occurs with previous versions of IE and it only occurs when my codemirror instance is not displayed. \nMy use case is that i call \"setValue\" of a CodeMirror instance which is not displayed yet.\nIn facts [in codemirror.js/measureCharInner() line 1221], the function : \"getClientRects()\" return an empty array when the element is not display. Instead of \"getBoundingClientRect()\", which return the correct array of rect (in any version of IE).\nso maybe i should try to add this ?\nline 1220 :\n\n...\n     } else if (ie && cm.options.lineWrapping) {\n         var rects = range(node, start, end).getClientRects();\n         rect = rects[bias == \"right\" ? rects.length - 1 : 0];\n+        if(!rects) {\n+           rect = range(node, start, end).getBoundingClientRect();\n+        }\n     } else {\n...\n\n. It work ! No bugs anymore.\nThanks a lot.\n. ``` html\n<!doctype html>\nCodeMirror: Bug scroll bar\n\n\n\n\n    .CodeMirror {\n        border: 1px solid #eee;\n        height: 100%;\n    }\n\n\n\n\n\n\n        var editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n            lineWrapping: true\n        });\n    \n\n```\nTry with something like that ! ;)\nAfter adding big content in the editor, try resizing to hide some lines.\n. I can reproduce it with chrome windows, firefox, and ie11.\nWhen adding big data, don't insert \"Enter\" character. e.g Only the same letter to render multiple line (linewrapping)\n. ``` html\n<!doctype html>\nCodeMirror: Bug scroll bar\n\n\n\n\n    .CodeMirror {\n        border: 1px solid #eee;\n        height: 100%;\n    }\n\n\n\nCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirrorCodeMirror\n\n\n        var editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n            lineWrapping: true\n        });\n    \n\n```\nThen resize the window verticaly to reduice height and hide some text (maybe under 100px)?\n. Yes i'm working on the last v4 commited branch.\n. I try to debug this problem:\nI think that function which return how many line are visible (\"visibleLine\" (442)) do wrong calcul when option ,linewrapping is active. \nMore precisely, it's mabye in function \"lineAtHeight(doc, top)\" (line 448) which always return line 1 in my case (big content with no return) ?\n. Lien de la demo sur jsbin :\nhttp://jsbin.com/ihunin/334/edit\n. Fixed ! Awesome (night) work !!!\nI'd got another problem related with vertical scrollbar. Dojo splitter don't trigger resize event of window, so editor don't show scrollbar sometimes. I had to call window.onresize manually.\nThanks for the multiple fix !! (#2248 and #2233)\n. Sorry for that reduiced issue.\nI will try to complete it.\nInformations : \n- v4 branch \n- line wrapping option activated.\n- browser firefox\nthis is my demo url :\nhttp://codemirror.net/4/demo/indentwrap.html\nthen type \"fobar\u0643\u0627\u0626\u0646 \" and select all text\n. Thank a lot for this patch.\nUnfortunately, I couldn't test it for now because we have finished development of our application and the version in production is 4.2.0. So, we have to find time to test this patch in master branch and then test the migration among 4.2.0 and ?4.4.0?.\n. It's better, unfortunetly i can reproduce it with release 4.6.0 (with demo too)...\nNot exactly the same bug but very similar.\nIn fact, when I zoom at 50%, 75%, 100%, 125%, 150% it's fine ! But between these levels, cursor is offset by ~3px approximately. Not huge either ! ;)\nBy the way, great job dealing with IE bugs !!\n. ",
    "jaredrummler": "I just want a confirmation: @glinden were you able to get this working with one of the answers from StackOverflow? \n. ",
    "merbin2012": "This is the \"Android system webview\" problem. Thats why after update this onle i faced many problem in my application, the application name is  HTML Code Play.\n. editor.getCursor() not working in mobile\nIn desktop system return {line: 7, ch: 6}\nbut in mobile return {line: 7, ch: 0, bad: true}\nwhat can I do?\n. \nWhen I click the external2.js error, it show the following line\nvar editor=CodeMirror.fromTextArea(document.getElementById(\"newtxtid\"),{styleActiveLine: true,matchBrackets: true,mode:mixedMode,extraKeys: {\"Ctrl-Space\": \"autocomplete\"},lineNumbers:true,gutters:[\"CodeMirror-linenumbers\",\"breakpoints\"],lineWrapping:true,autoCloseTags:true,autoCloseBrackets:true,value:\"<html>\\n  \"+ document.documentElement.innerHTML+\"\\n</html>\",matchTags:{bothTags:true},extraKeys:{\"Ctrl-J\":\"toMatchingTag\"}});. It can solve by using the following code.\n.CodeMirror {\n    line-height: 19px !important;\n}\n. @marijnh Thanks for response. Can you please tell me the approximate release date of codemirror 6?. ",
    "sudocode": "@marijnh I don't think that's the issue. I tested it using a month-old 2012 Macbook Pro Retina with hardly anything running in the background. Also I did test across different browsers for the versions I mentioned.\n. Tested using Windows 7 and IE9, which seems to be working fine. I'll see if I can duplicate the issue on another Apple machine.\n. Tested using a friend's 2012 Macbook Pro Retina (running OSX Lion) and a 2011 Macbook Pro (running OSX Mountain Lion). The Retina repeated properly on certain keys (like 'a'), but lagged horribly on others like the 'h' key. Similar behavior with the 2011 MBP.\n. ",
    "jtmkrueger": "I think it's worth bumping this as an issue, since it's seen no activity in a year and  I'm still seeing it on my 2011 MBP.\n. ",
    "michielbdejong": "ok, thanks! will close this issue now and reopen it when i can actually reproduce the problem consistently somewhere...\n. ",
    "jdleesmiller": "I've also seen this, but I have found a shorter example, so I thought I'd record it here in case it helps. (I'm not sure whether it should go here or in #1353 -- both seem relevant.)\nPaste the following line\nHere is a line with a long word at the end aaa\u2026aaa\non a new line in\nhttp://codemirror.net/demo/btree.html\n(or any other demo with lineWrapping enabled).\nNote that the word at the end has an ellipsis character (U+2026) in it.\nResize until the second \"aaa\" no longer fits on the line. In FF20.0.1 (WinXP) and IE8 (WinXP), wrapping and cursor movement are as expected. In WebKit (Safari 6.0.4, Chrome 26 Linux), the second \"aaa\" appears to wrap onto the second line, but the cursor behaves as though the whole \"aaa\u2026aaa\" has wrapped onto the second line for both insertion and selection.\n. Many thanks for your help with this. I have voted for the Chromium bug.\nWe've had users report this on\nVersion 28.0.1500.52 Ubuntu 13.04 (28.0.1500.52-0ubuntu1.13.04.2)\nVersion 28.0.1500.63 m on Windows 7 (but 27 is still the stable version on Windows acccording to http://www.chromium.org/developers/calendar)\n. I've checked it in 28.0.1500.95, which hit stable today, on Mac and Windows, and it now seems to be fixed.\n. I also thought this was due to the Lion \"feature\", but then I found that the movements do repeat in Safari under some conditions. Here are steps that illustrate this:\n1. Go to http://codemirror.net//demo/vim.html\n2. Place cursor on first character with mouse.\n3. Click on the address bar to remove focus from codemirror.\n4. Place cursor on first character with mouse, again.\n5. Hold down the j key.\nNow the cursor moves down multiple lines while the j key is held, as expected. However, typing in insert mode no longer works.\nI did mention this toward the end of the original issue report, but it wasn't very clear, sorry.\n. ",
    "ali1k": "Dear marijnh , thanks for the response. I will revert it to V2.0 and will find out how to update deck.js plugin to V3\n. ",
    "pixelchutes": "Nice work, @njx!\n. ",
    "mgsloan": "I certainly agree that papering over a bug is bad.  However, unfortunately I'm not yet very good at post mortem debugging javascript.  Unless you can direct me towards a reversible debugger?  I'll try to pay more attention next time.\nI do think it likely has to do with the vim-keymap, as I do favor it (thanks for adding that, btw!).\nI don't agree that it's acceptable for a function to non-terminate when something else in the program messed up.  Carrying on would be fine, and throwing an exception would be reasonable too.  Locking the browser window is not cool when you're working on a serious application.\n. I haven't seen this for a while, but I got an infinite loop here again.  This time with \"dir == 36\".  I kidd you not.  No, I don't know how that's possible.  It makes absolutely no sense.\nI'll try to repro this variant of the bug.\n. Ahh, I have a suspicion that this may have been the original bug as well.  Anyway, \"Shift+Backspace\" when the cursor is on column 1.\nI'd love to see this infinite loop fixed, as well.  Thanks!\n. So, in my case this happens even when not in vim mode, but I can only make it happen in the following demo (I tried a few of the other ones, non-exhaustively):\nhttp://codemirror.net/demo/vim.html\n. I should have been more specific, sorry!  Yeah, just straight Shift+Backspace doesn't do it, not sure why I didn't include a better explanation.  Here's a better repro:\nClick the end of a line in the vim demo, do \"Shift+Enter\" followed by \"Shift+Backspace\".\n(Chrome v25)\n. Thanks for the quick fix!\n. Thanks for the quick turnaround, this works for my usecase!\n. Right, I actually dislike the standard vim behavior for this - it doesn't seem useful!  I suppose when using vim in a terminal it's rather unavoidable.\nMiddle click detection when on linux seems reasonable to me (I guess that'd be /Linux/.test(navigator.platform)).  Thinking about this more, it might make sense to leave it in normal mode, since the user didn't explicitly switch to insert mode.\nThanks for looking into this!\n. Awesome, glad this got addressed in a more general way!\n. I didn't - sorry about that - but I just couldn't see using the code from anyword-hint as is.  I suppose I could set one up, but I haven't done that sort of benchmarking before in javascript.  Usually if I'm worried about that sort of thing, I'm doing profiler based optimizations.\nOne place I could see mine having some performance issues is if the performance of getLine relies on spatial locality.\n. lastIndex gets reset to 0 when the match fails.  Some docs don't make this very clear, but this one does: http://www.w3schools.com/jsref/jsref_regexp_lastindex.asp\n. Using http://stackoverflow.com/a/4644364/1164871 with\njavascript\nbench(wordCompletions, 100, [cm, \"th\", 1, 500, -1], this);\nbench(CodeMirror.hint.anyword, 100, [cm], this);\nAnd putting \"th\" line 1 of codemirror.js, with the cursor after, I get:\nMean execution time was:  0.65\nSum execution time was:  65\nResult of the method call was: [\"th\", \"the\", \"that\", \"these\", \"this\", \"themeChanged\", \"throws\", \"than\", \"theme\", \"their\", \"theoretically\"]\nMean execution time was:  8.27\nSum execution time was:  827\nResult of the method call was: \nObject {list: Array[11], from: Pos, to: Pos}\n. For my use case, it makes sense to have this as a separate function with a few modifications (I'm using anyword as a fallback autocompletion).\nIf you want me to open up a pull request against the anyword addon, I can do that, though.\n. Looks good!  Ontop of those changes, I also get a minor speedup by using m[0].lastIndexOf(curWord, 0) == 0 (like in google's lib) instead of m[0].indexOf(curWord) == 0.  In extreme cases (long words, short query) this could be a big speedup. \nMean execution time was:  0.65\nSum execution time was:  65\nResult of the method call was: \nObject {list: Array[2], from: Pos, to: Pos}\nMean execution time was:  0.75\nSum execution time was:  75\nResult of the method call was: \nObject {list: Array[2], from: Pos, to: Pos}\n. Hrrrm, actually let me check into that a little more, the results are inconsistent.\n. Huh, curious.  I guess chrome must particularly specialize x.indexOf(y) == 0.  I'm not sure if it's a good idea to rely on all browsers doing that though.  Firefox seems to reliably be a little bit slower (0.2 ms per run), but I suppose that's no big deal.\n. ",
    "Niggler": "Just checked out the current code.  I see that the behavior did change (when i type <script type=\"text/python\"> the ensuing code isnt highlighted).\nJust based on a quick glance of the code, I would think it would be straightforward to add other script types in htmlmixed.js (in the html function).  If that sounds reasonable ill submit a pull request\n. ",
    "yusafkhaliq": "a quick workaround http://jsfiddle.net/yusafkhaliq/uhcC7/7/ \n. ",
    "angelozerr": "That's really cool! Many thank's to have accept my request and improve it.\n. Many thank's marijnh!\n\nNext time, don't take advice from tutorials written in 2008\nWhat do you mean please?\nI'm neebie with CodeMirror and I'm not a big killer with Javascript, so any suggestions are welcome!\n\nI have tried your demo and it works great but I have several suggestions.\n1) I have a problem to integrate your work on my MapReduce WebBrowser project because my old getContents method doesn't exists. As I said you for my Javascript MapReduce function I have this content in the textarea editor : \n\nfunction () {\n}\nJSHint throws error because it's not a valid javascript, so I had getContents which returned 'var f=' + cm.getValue() + ';' and it was this content which was validated and not just cm.getValue().\nIs it posible for you to integrate this methode please?\n2) lintWith should perhaps accept array function too\nI think lintWith should perhaps accept array function too if you wish manage several lint. For instance we could implement a lint with JSON-Schema and the JSON editor could check if JSON is valid and if it checks the JSON Schema.\nBut perhaps it's more complex than an array and manage conditionnal lint. The json lint is thrown id it is valid (JSON syntax valid), you execute the JSON Schema lint.\n3) Conditionnal lint\nIn my case I would like don't execute the Javascript lint if the editor is empty, we could add an optionnals method like isExecuteLint\n4) CSS\nJust add cursor: pointer; for the lint-span* lik ethis:\n.CodeMirror-lint-span-error, .CodeMirror-lint-span-warning {\n  background-position: left bottom;\n  background-repeat: repeat-x;\n  cursor: pointer;\n}\n. > The tooltip code you included was a disaster (way too long and clunky, and wrong in several places).\nFor tooltip I have done that quicly, but I agree with you.\n\nWrap your linting function with something that adds the wrapper text.\n\nHow to do that? I would like to use the javascript-lint and the code is: \n\nCodeMirror.javascriptValidator = function(cm) {\nJSHINT(cm.getValue());\nI my case I would like to do : \n\nCodeMirror.javascriptValidator = function(cm) {\nJSHINT('var f=' + cm.getValue() + ';');\nWith my old getContents method I was able to do that.\nFor your other answer I will see when I will try to develop json schema lint.\n. Cool! It works great. Many thank's\nI have an other idea, but I would like experiment it before. My idea is to develop a XQuery editor but instead of doing the validation on client side, I would like to do the validation on server side by executing the xquery by the XML Database by using AJAX.  I tell me that the lint should perhaps manage asynchronysous mode (populate the annotations list with asynchronysous mode).\n. Hi, \nI have already the problem, please see my pull request at https://github.com/marijnh/CodeMirror/pull/1277\n. That's shame that you have not posted on cm forum. I have developped jQuery Ajax to process validation on server side. You have demo with XQuery at http://codemirror-java.opensagres.cloudbees.net/xquery.html\nYou can find the CodeMirror.remotingValidator here https://github.com/angelozerr/CodeMirror-XQuery/blob/master/codemirror-xquery/addon/lint/remoting-lint.js\nand the use here https://github.com/angelozerr/CodeMirror-Java/blob/master/src/main/webapp/xquery.html\n. It works well with Chrome and FF, but not with IE8. My patch resolved IE too.\n. I have cleand my cache etc\nThe bug is very hard to reproduce (sometimes it comes every time and\nsometimes never -().\nIt comes often when the list opens (and the mouse is not inside in the\nopened list) and I scroll quicly several times the scrollbar on t e rigth\nof the list , the list closes.\n2013/2/22 Marijn Haverbeke notifications@github.com\n\nI (once again) can't reproduce the problem anymore in IE8. What I do is\nopen the completion demo, put the cursor somewhere where it's not in a\nword, press ctrl-space, and scroll the resulting (long) list of completions\nby clicking the scrollbar of the pop-up.\nMake sure your cache is cleared, etc.\nYour patch caused the editor to be deselected when scrolling the widget,\nused onmouseleave naively (it will also fire when the mouse is moving\nbetween elements inside the widget), and generally added more complexity\nthan needed.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1277#issuecomment-13944430.\n. Ok, that's shame for me-(\n\nI will try to debug it (but very hard with IE tools) when I will have time.\nRegards Angelo\n2013/2/25 Marijn Haverbeke notifications@github.com\n\n\nIt comes often when the list opens (and the mouse is not inside in the\nopened list) and I scroll quicly several times the scrollbar on t e rigth\nof the list , the list closes.\n\nI'm still not managing to reproduce this. You'll have to debug it\nyourself.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1277#issuecomment-14031958.\n. Is it possible to give me some directives to do that? Is it the mode which must manage that (store the column between start/end comments, functions etc).\n\nThank's for your help.\nRegards Angelo\n. You can close this issue. I have managed (auto) code folding at https://github.com/angelozerr/CodeMirror-XQuery/wiki/Code-Folding\nDon't hesitate to contact me if you wish integrate this feature in the CodeMirror.\n. Ok I will do that when I will have time.\n. Hi Marijn,\nBefore answering your questions, I have done this feature to work with\nString item (like Javascript, XML Hint) or complex Object (like my XQuery\nHint).\nPopulate the hint (data.list) can be done with 2 means :\n1) model : each item of the data.item are the model (ex:String, Object like\nVarDecl, FunctionDecl I'm using for XQuery mode). To show the item in the\nautocomplete list, we need a wrapper (it's my updatItem method). To pick\nthe item we need too a wrapper (it's my pickItem).\n2) completion item : each item of the data item are an object\nCompletionItem with text, className. A pick method is important too because\nthe inserted content can be different from the text (and cursor can be\nsetted too like I have done for xml hint attribute).\nThe choice I have done is 1). Why? because you can populate the list\ndirectly with the model (string, object, etc) and you need not to\ninstanciate a CompletionItem  by using string or object each time the\ncompltion should be populated.\n2013/3/7 Marijn Haverbeke notifications@github.com\n\nI see several problems with this\n-\nIt puts the burden of creating the completion html nodes entirely on\n   the client code. Why not just attach a classname to each completion?\nIf I understand you wish to use 2) mean. So you cannot use string to\npopulate completion (or you can but you will have to create an instance of\nCompletionItem each time). clasname is not the only info you need.Youu need\n\n1) classname to manage icon.\n2) text to display a text in the list completion (which can be totally\ndifferent from the content to insert. See sample explained after.\n3) pick item\n (ex: for snippet for, you display for in the completion and after picking\nyou insert the content for(var i=0; ....\nIn my XQuery Hint I display function like this\n\nxx:toString($i as xs:int) : xs:string\nanf if you pick it, it inserts :\n\nxx:toString($i)\n4) information (not developped) to display a second popup with info (like\njavadoc).\n\n-\n(I.e. allow elements in the completions array to be either strings or\n   objects with a text property and some other data attached to them,\n   such as className). You might want to also support a hook that allows\n   the item to draw itself completely, but I think the common case is to just\n   add an icon, so let us make that easy.\n-\nThe 'pick' logic is per completion list, not per item. Doesn't it make\n   a lot more sense to make it per-item?\nAs I have decided to work directly with model (I populate the list with\nModuleDecl,  VarDecl which are created by my XQuery mode) I have done like\nthis and it's the overriden updateItem which manages the label :\n\n\nfunction updateItem(elt, completions, i) {\n  var completion = completions[i];\n  if (completion instanceof CodeMirror.ModuleDecl) {\n  // Module completion\n  var moduleDecl = completion;\n  elt.className = elt.className + \" CodeMirror-hint-module\";\n  elt.appendChild(document.createTextNode(moduleDecl.prefix));\n  return true;\n  }\n  if (completion instanceof CodeMirror.VarDecl) {\n  // Variable completion\n  var varDecl = completion;\n  elt.className = elt.className + \" CodeMirror-hint-var-\" + varDecl.scope;\n  elt.appendChild(document.createTextNode(getVarLabel(varDecl)));\n  return true;\n  }\n...\nreturn false;\n}\n\n-\nThat would also get rid of the logic where a pick handler is allowed\n   to return false to decline the action. If a completion has a pick handler,\n   it really has something to do.\n    -\nTry to keep pointless changes (like renaming background to\n   background-color in show-hint.css) out of pull requests.\nok sorry.\n-\nAlso, make sure the tests pass.\nhow can I do that?\n\nSo if I understand you wish to use the 2) solution with completion item\n(it's the same ide like Eclipse\nCompletionProposalhttp://help.eclipse.org/helios/index.jsp?topic=%2Forg.eclipse.platform.doc.isv%2Freference%2Fapi%2Forg%2Feclipse%2Fjface%2Ftext%2Fcontentassist%2FCompletionProposal.html).\nI like this clean idea, but I'm afraid with memory because you must create\na completion item each time the compltion will open.\nI'm waiting for your answer. How can we work together? You wish I do a\nsecond patch with completion item idea?\nRegards Angelo\n\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1321#issuecomment-14548421\n.\n. Many thank's Marijn,\n\nI will adjust my xquery hint with your new API and tell you if I have some problem. You speak about pick method is not hint method?\nAn other feature that I need is to sort completion, I do that in my xquery hint but perhaps it should be in  the show-hint?\n. Hi Marijnh,\n2013/3/15 Marijn Haverbeke notifications@github.com\n\nI've merged in the theme (c5554d5https://github.com/marijnh/CodeMirror/commit/c5554d5f42776b629b4a786dba43170baf16874a)\nand the support for onUpdateLinting (8be65a4https://github.com/marijnh/CodeMirror/commit/8be65a4e5fa69070d77d215f06aa5f06b19ddc86\n).\nOk , cool. I don't know if you have seen my last commit\nhttps://github.com/angelozerr/CodeMirror/commit/d684f50d4064a2404dc96dcc0b8e3be453162a31,\nbut I have created  a new addon statuts-lint which displays the status lint\n(displays the number of errors/warnings and if you click on it, it select\nthe first error/warning in the ditor).\nAs for the rest... you have to understand that adding lots of code to\nCodeMirror has a cost for me. People will find problems in it, and I'll\nhave to fix them, or at least communicate about them. The XQuery hinting\ncode is huge, messy, and doesn't seem to work very well (I wasn't able to\nget completions at several points in the demo, for example where it says return\n$provider_user_data, removing part of the variable name and completing it\ndoesn't work.\nArgh, I will see this bug.\nI appreciate your intention to contribute to CodeMirror, but I simply\ndon't have the time and energy to review your contributions in detail or\nrewrite them. So for big things like this, please distribute the code\nyourself (open a github repo and slap a README on it). I'll gladly add a\nlink to it, but I don't want to maintain it.\nIt's really shame for me-( My fear is that CodeMirror changes some API and\nmy XQuery Hint  will not work more). But I understand your problem with\ntime and energy (I have the same problem with my open sources project).\n\nRegards Angelo\n\u2014\n\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1359#issuecomment-14958608\n.\n. Hi Marijn,\n\nFor your information I have created\nCodeMirror-XQueryhttps://github.com/angelozerr/CodeMirror-XQuery (I\nhave fixed the problem that you have found for completion too).\nYou can play with the demo at\nhttp://codemirror-java.opensagres.cloudbees.net/xquery.html\nYou will see the status lint in action too. Click on the status lint error,\nand it select the erro rin the editor.\nRegards Angelo\n2013/3/15 Marijn Haverbeke notifications@github.com\n\nI don't know if you have seen my last commit\nI did see it, and the same comment goes for that -- adding a hook to the\naddon to make this possible is great, but another demo plus a bunch of code\nis more than I want to deal with.\n\n\u2014\n\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1359#issuecomment-14960486\n.\n. Hi Marijn\n\n2013/3/16 Marijn Haverbeke notifications@github.com\n\nSeems to work much better now!\n\nCool!\n\nI'm thinking about ways to make 3rd party add-ons easy to find. I'll write\nsomething about this to the list soon.\n\nI'm waiting for that. For the moment I have explained  why I have created\nthis project at\nhttps://github.com/angelozerr/CodeMirror-XQuery/blob/master/README.md#why-codemirror-xquery\nHope you will OK with that.\nRegards Angelo\n\nOn Sat, Mar 16, 2013 at 5:36 PM, Angelo notifications@github.com wrote:\n\nHi Marijn,\nFor your information I have created\nCodeMirror-XQueryhttps://github.com/angelozerr/CodeMirror-XQuery (I\nhave fixed the problem that you have found for completion too).\nYou can play with the demo at\nhttp://codemirror-java.opensagres.cloudbees.net/xquery.html\nYou will see the status lint in action too. Click on the status lint\nerror,\nand it select the erro rin the editor.\nRegards Angelo\n2013/3/15 Marijn Haverbeke notifications@github.com\n\nI don't know if you have seen my last commit\nI did see it, and the same comment goes for that -- adding a hook to\nthe\naddon to make this possible is great, but another demo plus a bunch of\ncode\nis more than I want to deal with.\n\n\u2014\n\nReply to this email directly or view it on GitHub<\nhttps://github.com/marijnh/CodeMirror/pull/1359#issuecomment-14960486>\n.\n\n\u2014\nReply to this email directly or view it on GitHub<\nhttps://github.com/marijnh/CodeMirror/pull/1359#issuecomment-15007726>\n.\n\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1359#issuecomment-15012725\n.\n. Many thank's for adding onSelect and onClose callback. I will see how to create the addon for that.\nThey look fancy, but add no useful information.\nYou speak about completion information? If it's that, my patch was not about this feature but for this 3 improvments : \n\n1) The completion shows every time the attribute and element name in any case (for instance for element it shows every time 'a' and not ('a' and ' for element).\n3) when attribute is selected the cursor is setted on the middle of the quote. \n\nand make it much harder to reuse the completion function in a different context.\nI'm sorry, I don't understand? You speak about completion information, if it's that as I said you my patch was for the 3 improvments that I have described.\n\nIt was the first step to improve the html hints. My idea was to add required attributes informations in the html structures and when you pick an html element with required attributes, it insert too). The completion information could too dispaly the required attributes.\nIt's out of the scope of this issue, but I think html-hint could be managed with xml-hint by using a common structures (like your HTML structures). My idea is to create a xml-hint which works with JSON-Schema (http://json-schema.org/). Your HTML structure could be transformed with JSON Schema. The JSON-Schema structure could be used too for lint feature (so you configure the \nI think the completion information is very interesting for javascript hint. I have seen your demo with http://ternjs.net/ and I think it should be very cool to display the type, signature of the function in the information autocomplete (like Ctrl+i).\nWhat do you think about that?\nRegards Angelo\n. Hi Marijnh,\n\nyour code tends to be messy\nI'm not a big expert with javascript, sorry-( But I hope I will improve my javascript skills by developping CodeMirror addons:)\nthe English in your commit messages and emails is bad\nI know that too-(\n\nOk I have tried to implement my hint contextual information with your 2 callbacks onClose, onSelect, but I cannot do that. I will try to explain my need (you can see my commit at https://github.com/angelozerr/CodeMirror/commit/6de5f4abf823be043560ae2c71f4f7a163ce2a48)\n1) onClose/onSelect callbacks\nYou provide onClose/onSelect callbacks from the data. I will prefer to define those callback in the options with interface. If you see CodeMirror.showContextualInfo code it returns onClose and onSelect function : \n\nCodeMirror.showContextualInfo = new function() {\n  return {\n   onSelect : function(cm, data, completion, hints) {\n...\n    },\n   onClose : function(cm, data) {\n...    }\n  }\n}\nTo use it, I configure the show hint options like this : \n\nCodeMirror.showHint(cm, CodeMirror.htmlHint, {\n  \"handler\" : CodeMirror.showContextualInfo\n})\nThe benefit with this mean is that I don't polluate the CodeMirror.htmlHint with dependency of CodeMirror.showContextualInfo.\n2) onClose/onSelect\nfor the onClose, I don't need cm and data as parameteres but for onSelect I need  completion, hints parameter. I need hints (with the ul element) because I must update the position of my div contextual info according the position of the hints.\n3) fix a little bug with Esc.\nWhen I key Esc to close the hints, the onClose callback is not called. I have fixed like this (not sure that it's a clean fix) : \n\nEsc: closeWithEsc\n...\nfunction closeWithEsc() {\n    close(false);\n}\nWhat do you think about my explanation?\nMany thank's for your help.\nRegards Angelo\n. Hi Marijnh,\nMany thank's for your help. I have adapt my code to use your show-hint API (onSlect/onClose) and it works great. I have created show-context-info.js addon. You can see explanation, screenshot, links demo (about HTML and XQuery) at \nhttps://github.com/angelozerr/CodeMirror-XQuery/wiki/Completion-Context-Information\nI have decided too to host my own html hint and it is more generic than you because you can use it with any XML structure. For instance I use it for XML Spring beans (see demo at http://codemirror-java.opensagres.cloudbees.net/codemirror-xquery/demo/springcomplete.html) \nRegards Angelo\n. Just for information, to see sample with this new API, please see the show-context-info.js at https://github.com/angelozerr/CodeMirror-XQuery/blob/master/codemirror-xquery/addon/hint/show-context-info.js which uses this new API.\n. If I understand your comment, your fullscreen javascript in your demo cannot be used for editor which is inside  a relative or absolutely positioned element? \nIn my case, I use this javascript like your demo, so it works for  me. I will host this addon on the CodeMirror XQuery.\nRegards Angelo\n. I'm sorry marijnh, my explanation was not enough. The url is not displayed.\nThe code which displays the tooltip (CodeMirror.on(obj, \"select\", function(cur, node) {) doesn't use data.url and teh url is not displayed.\nPerhaps you could share the code which display the type (showType) and the docs (CodeMirror.on(obj, \"select\", function(cur, node) {) \n. Sorry @marijnh for my none answer-(\n. Many thank's, it works great now.\n. I will be very glad to contribute to CodeMirror with my template hint addons, but I'm not sure that marijnh wishes this addon (If I remember our conversation about that with marijnh). For indents problem, I know it because I had no time to implement it.\nI would like to say too that I have developped some SAX Java code which transforms Eclipse templates to my JSON template hints (@jasonsanjose if your are interested with that , tell me) .\n. Thanks!\n. @marijnh I have created a demo with Completion guess:\n\nYou can play with the online demo at  http://demo-angelozerr.rhcloud.com/CodeMirror-Java/guess-types.html\nHope you will accept this PR, in order to Completion Guess will work. Thanks!\n. @marijnh I have tried to test your patch, it works well with complete.html demo but with tern.html demo the completion doesn't open (it seems that completions.options.hint is null https://github.com/codemirror/CodeMirror/blob/master/addon/hint/show-hint.js#L43)\nJust for your information, I have tried too the [html5complete.html](https://github.com/codemirror/CodeMirror/blob/master/demo/html5complete.html] and I have the error \"Uncaught TypeError: Cannot read property 'line' of undefined\" when I try to open the completion.\n. Thanks @marijnh for your info.\n. By default options.somethingSelected is the same thing than true.\nIn my case (when I set options.somethingSelected to false), I must remove this.cm.getSelection().length to startLen (like today)\n. > Ah, somethingSelected: false is how you indicate that completing with selected text is allowed?\nYes that it is! Perhaps my code is bad. My need is to open completion with selected text and adjust startLen according the selection.\n. ",
    "dandavison": "@marijnh Makes sense. I did this as a quick solution for me and thought I'd see what you said. I definitely took the easiest route I could see and I agree it's intrusive! I'll look forward to your work on the emacs mode.\n. @marijnh Incidentally, personally I find not having the Ctrl-K Ctrl-Y sequence to be a major problem when working with CodeMirror. Chrome provides it in address bar, textarea editing, javascript console (Firefox only provides Ctrl-K). And, of course, these are all default readline bindings, bash being the most influential case. Do you think any of the replacement-from-kill-ring commands should be available by default in CodeMirror, or only when emacs mode is specifically activated?\n. @marijnh I just had a quick test. On OS X 10.6.8 and 10.8.2:\n- Text entry widgets in core GUI dialogs support Ctrl-Y and Ctrl-K (e.g. Settings -> Network -> Advanced -> Add Network)\n- The incremental search box in native applications such as Finder, ActivityMonitor, Settings, supports Ctrl-K and Ctrl-Y\n- TextEdit supports Ctrl-K and Ctrl-Y with accumulation of consecutive kills\nCtrl-f and Ctrl-b (forward and backward char) are also supported in those OS X interfaces. Other emacs-like bindings such as Ctrl-W and Alt-D are not.\n. ",
    "thefuntastic": "Good point, I hadn't considered that fully. Originally started by porting Haxe.js, which is in turn a near copy paste of javascript.js - so didn't see aversion to the methodology. Actionscript is an ECMA script lang similar to javascript, but with more OOP features - so somewhere in between Haxe and js I guess. However as I started there were a lot of things that didn't feel right, and the clike implementation behaved more consistently. \nI could add actionscript to the c-like implementation fairly easily, though i might need some help as to how to provide for exceptional cases such as regular expressions. Also the granularity on the clike class is pretty coarse and naive. I think it's useful to highlight things like attributes (public private etc).\nUltimately though my ambition is to fork brackets to create a code aware IDE for actionscript with a strong autocompletion engine etc. Responsibilities for things like code intelligence obviously shouldn't reside with CodeMirror, however i figured it would be a good idea to have a solid base to extend a simple naive mode into a more feature complete one over time. Only been poking around for a couple of days, so open to suggestions. \n. Okay, probably good suggestions. What I know is that actionscript was designed to be ECMAScript 4 compliant, though by the time the spec was finalized actionscript had broken spec in a few places as it had already been released to market at that point. What those departures are I actually have no idea, and would need to ask Adobe engineers. Also I'll be honest that I'm not well versed with what the differences between the incarnations ECMAScript are. \nIn any case I've had a look at the javascript/typescript mode, and see how it could work adding actionscript to that. I also was planning to take a thorough look at the type script implementation to understand how to add code intelligence and the like. \nI think I'll close this pull request for now and resubmit when I've had more time on the project and am more informed on what the right way forward is. \n. ",
    "dhbahr": "A question on this issue, how do one specifies the 'null' mode? I get a 404 for the alleged null.js\n. ",
    "cbou": "It's not just bower, it's about Semantic Versioning (http://semver.org/). This standard is now widely used by many javascript project. That's why it would be nice that CodeMirror use this sort of standard too. That bower can handle CodeMirror better will be a positive side-effect.\nCodeMirror user might be surprise but not JavaScript users.\n. ",
    "dsoprea": "Just about the only reference to the async functionality on the Internet is this page. Until the docs are modified, I posted a small Github project to bridge the gap:\nhttps://github.com/dsoprea/CodeMirrorRemoteValidator\nI wasted too much time figuring this out, guys. Other than this shortcoming, your project reaches nearly unreachable levels of awesomeness.\n. I searched all over. I only post if it's going to take more than a day or\ntwo to write a solution myself.\nIf this option (an option that is significant since only two, very common\nlinters are included, and very few others would be available within\njavascript) can't even be included in the list of options in the\n-documentation-, than I'm not going to assume that the forum is going to be\nof any greater help.\nThanks for responding, Angelo. Also, if it wasn't for your initial post, I\nwould've had to do some very exotic changes before inevitably seeing and,\nlater, understanding the async stuff.\nDustin\nOn Tue, Apr 16, 2013 at 4:41 AM, Angelo notifications@github.com wrote:\n\nThat's shame that you have not posted on cm forum. I have developped\njQuery Ajax to process validation on server side. You have demo with XQuery\nat http://codemirror-java.opensagres.cloudbees.net/xquery.html\nYou can find the CodeMirror.remotingValidator here\nhttps://github.com/angelozerr/CodeMirror-XQuery/blob/master/codemirror-xquery/addon/lint/remoting-lint.js\nand the use here\nhttps://github.com/angelozerr/CodeMirror-Java/blob/master/src/main/webapp/xquery.html\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1272#issuecomment-16432928\n.\n. Scanning through the code didn't do it, and I'm not saying you need to have\na fifty-person documentation team. It was only Angelo's change that brought\nit to my attention. I'm saying that instead of removing his change and\nsaying that it wasn't useful, you should have added it as an example in the\ndocs. God knows you have dozens of other examples.\n\nOpen-source or not, if it's not an advertised feature, you're saying we\nshould assume it's there, and search you code?\nObviously, I struck a nerve. As with all bug activity, it arose out of\nfrustration and research, and a hope for improvement. An open-source\nproject is one that is exposed to the world for exactly that purpose... Not\nso the developer can take it personally when the world takes an interest.\nNevermind, then.\n\nIf this option can't even be included in the list of options in the\n-documentation-, than I'm not going to assume that the forum is going to\nbe\nof any greater help.\n\nYes, we don't have a large, well-paid team of talented documentation\nwriters working on CodeMirror. If scanning through the 200 lines of lint.js\nto figure out whether it supports your use case or how to make it support\nyour use case is too much for you, and you'd rather spend your time sending\nout negative messages like this, then maybe you should not be using\nopen-source, volunteer-maintained software.\n\u2014\nReply to this email directly or view it on\nGitHubhttps://github.com/marijnh/CodeMirror/pull/1272#issuecomment-16651690\n.\n. ",
    "lkcampbell": "There is one problem, though.  The span encompasses all of the space characters together.  Here's a screenshot of what happens when I use the tokenizer code supplied above and assign a single pixel border and red background to the style:\n\nIf I have ten spaces in a row, I don't want one span around ten spaces, I want ten spans around each space so I can assign one colored dot for each space character.\nIs there a way to do this with the current codebase?\n. Dennis does bring up a good point.  I imagine opening up all Brackets editors with the flattenSpans option always set to true would be even more of a performance hit than this initial pull request idea.\nWhat about a mode-level flattenSpans option?  Seems like that would provide more overlay flexibility.\nI can investigate this idea if you all think it is worth investigating.\n-- Lance.\n. Works great!\nThank you for your help on this.\n-- Lance.\n. Yeah, I see the problem now, I actually removed that comment just moments ago :).  You are exactly right, I was thinking of it as a tree model.  There may not be a solution to my bug.  I'll play around with it some more and see what I can come up with.\n. Okay, I understand what you are saying now.  It would work in this case, correct (in fact that's how I simulated the expected result screen shot) but this is a simplified case of the real bug.  In the real scenario, both of the modes need flattenSpans set to false.  But I have some ideas I will play with today.\n. Marijn, thanks for your time and help.  After this discussion, I was able to figure out how to fix my bug.\n. Actually, it would probably look weird to have the ruler line stop at the last code line.  It should stop at the bottom of the editor view and readjust it's height to match the height of the editor.\n. @marijnh, I can reproduce in Safari Version 7.0.3 (9537.75.14) as well.  Maybe it's a Mac thing.\nI will try in Windows.\n. @marijnh, no not just a Mac thing.\nI can reproduce in Windows: FF 28, MSIE 9, and Chrome 33.\n. Here's a screenshot for reference to show what it looks like after I scroll the editor window downwards:\n\n. @marijnh, sorry I should have clarified that I am scrolling down with my mouse scroll, not with scrollbars.  Updated the repro steps.\n. @djadmin, correct, the patch you provided is one solution to the problem based on my inexact Expected Results in the original post.\nNow that you have provided this newest screenshot and we have discussed it more, I like the version where the ruler goes to the bottom of the page.  I will update the Expected Results.\n. Works great!  Thanks, closing as fixed.\n. @djadmin, it definitely looks a lot better.\nThe only suggestion I have is this: can you make the bottom of the guide extend to the bottom of the editor viewport but no further?\nIf you need me to create a visual mockup, let me know and I will.\n. To further clarify, I am using the addon for an extension for Brackets and the user can size the editor viewport however big or small they want it to be.\nIs there a way that to make sure that the ruler line is always exactly as long as the editor is high\nHere's a visual example to show the problem:\n\nSee, the bottom of the ruler line stops just short of the bottom of the editor, at the last line, line 55.  Is there any way to extend that line so it goes to the very bottom?\n. @djadmin, yes that's correct.  But only to the bottom of the editor.  Don't go beyond it or we will have the old issue happening again :).\n. ",
    "DennisKehrig": "Since flattenSpans is not a mode-specific option, this doesn't go far enough. I now append a space character to the style every other time. So \"whitespace\" !== \"whitespace \", but the CSS class is the same.\n. Awesome, I look forward to using it once Brackets updates to this!\n. ",
    "tillprochaska": "Hi\u2014\nStill crashes for me. I\u2019m using Sfari 6.0.2 (8536.26.17) on Mountain Lion. :(\n. ",
    "geier": "Ok, it seems to have something to do with the neo2 keyboard layout I'm using (it works fine with a standard qwerty layout). I'm pressing Mod3 (CapsLock) and the key labelled \"u\" on a qwerty keyboard for \"<\"; and Mod3 and the key labelled \"i\" for >.  Since it works fine with neo2 in Chromium, it's probably a Firefox problem and you can close this bug report.\nSorry for not investigating this properly.\n. ",
    "chriscoyier": "It's not a bug, per-se, as the demos that come with CodeMirror don't have that in the CSS. But I think it's a fairly common thing to have in a site's CSS. So whatever is causing that weird \"bug\" would be awesome to fix.\n. I couldn't seem to get that to work. \nYou could inject some CSS to make it work, but that seems a bit heavy handed. This is tested and does work though:\n```\n  if (ios) {\n    var div = document.createElement('div'),\n        ref = document.getElementsByTagName('base')[0] || document.getElementsByTagName('script')[0];\ndiv.className = 'fit-vids-style';\ndiv.innerHTML = '&shy;<style>textarea { border: 1px solid black !important; }</style>';\n\nref.parentNode.insertBefore(div,ref);\n\n}\n```\n. Works!\nhttps://github.com/chriscoyier/CodeMirror/commit/d68e86024c7252a6e5da149bd8d60f62a410aaa8#diff-1\nShall I pull request or would you rather code it in your own style?\n. sent\n. I can confirm this is still an issue in Safari 7 / OS X.\n. It does appear to be fixed in v4. \n. Hey hey, we have this issue on CodePen too. A simple example is, which you can reproduce on http://codemirror.net/mode/css/scss.html --\nwrite like:\na {\n  color: red;\n  &:hover, &:focus {\nThen enter, you'll see the bracket goes indented too far. And the space before properties looks like it doubles.\nLet me know if I can help more!\n. Video from a CodePen user where we have latest installed :: http://www.screenr.com/1KhH\n. @peterflynn yah that's just a mistype, but it's kinda broke/weird even with balanced parens.\n@media screen and (max-width: 100px) {\n        }\nTyping the first line above closes the paren like the second paren (too far indented).\n. This doesn't seem to be a problem anymore in 3.14 - did this fix already go out in that?\n. @bfrohs Ah yeah, on the normal demo page it's still a problem. We're on CM 3.14 on CodePen though, and for some reason it's not doing it anymore (either of those examples). I haven't put in your patch yet either, so now I'm confused. \n. I can confirm this issue as well. Happens in Chrome, not in Firefox (22).\n. Yep, it is.\n. hallelujah!\nThis is probably closeable since it's isolated to chrome and chrome auto updates.\n. Might be messy with all those weird commits. The only one that means anything is https://github.com/chriscoyier/CodeMirror/commit/cc2cca172f68816d8e1ec45c6b9da94f53aeafe8 (still a noob at pull requests)\n. thank you =)\n. I'd love to see an article like this, or any other deep-dive interesting stuff about CodeMirror being blogged about. If you're up for it, I'd be happy to publish on http://css-tricks.com which has a decent readership and might be good for some promotion as a side benefit. And can help pay for the time and effort as well.\n. I'm still open to the idea of a CSS-Tricks article! If you're interested in that, one possible angle is something pretty high-level, like a basic intro to how CodeMirror works at all.\n- Replicating the features of a textarea that we take for granted, like cursors and selecting and stuff\n- What the biggest challenges were/are\n- Your approach to the APIs\n- Your general approach to open source development and how it's working for you\n- Anything else.\nIf you'd like, I can email about it.\n. Fantastic thank you very much!\n. @bfrohs Works great! Thanks very much for keeping up on this, it's hugely appreciated.\n. Got another one for you @bfrohs =)\n```\n@for $i from 1 through 15 {\n  div {\n    &:nth-child(#{$i}) {\n      &:after {\n  }\n}\n\n}\n}\n```\nTestable here: http://codemirror.net/mode/css/scss.html\nIf you put your cursor after the { after :after { and hit return you won't get all the way indented to the right place.\n. @bfrohs Awesome! Thanks for the update a GOOD LUCK on the interview. Let me know if you need a good reference. \n. Awesome, glad to see it's being considered. Looks a little buggy yet. See: https://chriscoyier.viewscreencasts.com/1389889cf5e94eb6bf1ba0bb821dfeba\n. Works great. If there becomes a better way at some point I'd love to know.\n\n. I'm afraid I'm out of my depth here a bit too, but I can maybe provide more clues.\nIt has something to do with scope. \n\nSometimes you do want that scope. If you have a line with just div on it and press return, you want a new scope (new indentation level). Put if you put a key/value pair, like color: red and press return, you want to stay in the same scope (same indentation level).\nSome key/value pairs seem to work ok. For instance width: 100px is ok and z-index: 5 is ok. But color: red or background-color: blue start new contexts.\nIs that helpful to anyone?\n. @marijnh @ankitstarski @quezo it works!\nThe indentation stays good, in some quick testing. I'm deploying it live on CodePen, as that's a mighty good improvement for our Sass users.\nThe syntax highlighting is a bit funky though (note the dif colored colons) - would this be related to that?\n\n. Works wonderfully, thank you so much!\n. I sure I am misunderstanding. \nThis came up for us at CodePen all the sudden and I'm having a heck of a time tracking it down. We offer users the ability to switch between tabs and spaces (and how wide). We use three options to set the behavior. Like if a user wants 4-width tabs, we set:\neditor.setOption(\"indentWithTabs\", true);\neditor.setOption(\"indentUnit\", 4);\neditor.setOption(\"tabSize\", 4);\nOr if they want 2-width spaces, we set:\neditor.setOption(\"indentWithTabs\", false);\neditor.setOption(\"indentUnit\", 2);\neditor.setOption(\"tabSize\", 2);\nAnd that works great in the editor for HTML and CSS, but for a reason I haven't been able to figure out, fails in the JavaScript-mode editor. The indentation width works fine, but it's always tabs even if we explicitly set that option to false. \nBut I see if I go to the css mode demo and try to make it work with spaces, it doesn't work there either, so there must be more going on to make spaces work at all that I'll have to root out. \n. I'll close this up, as the problem I'm experiencing is our own fault as a result of other complications, not a CodeMirror root issue. \nFor anyone interested, the issue was a result of using the Emmet.js add-on for CodeMirror. It handles indentation in the way we want, based on those three settings from above, for all our HTML-based and CSS-based modes. We specifically have Emmet turned off for JavaScript because it doesn't do anything useful for JavaScript. Thus, our JavaScript editor was showing the correct default CodeMirror behavior, which to us felt broken, but really wasn't. We'll have to use extraKeys to intercept Tabs and use that for the spacing behavior we want again, which is fine for now. \nIt does kinda feel like having indentWithTabs set to false would make spaces be the default indentation all around, but I also imagine it's too late to change something like that even if it was desired.\n. Nah it's fine with me. A user just reported it to us at CodePen so I figured I'd pass it along. \n. ",
    "hsk81": "Hi marjinh, you can see the result at the test URL http://webed.blackhan.ch (which is only a test URL; later once my 2nd version for NoTex is ready, things will be available at the usual URL https://notex.ch).\n. Hi Marijn, thanks for the fix; it solved the exception problem, but since loadmode.js operates on the mode name sql and not the MIME type, I'd to use explicitly the setOption ('mode', mime). Since the other modes don't require this, because there is a 1-to-1 mapping between the mode and the mime, I'd missed this step. Thanks for the tip! :smile: \nMaybe on the loadmode add-on page http://codemirror.net/demo/loadmode.html you should enable MIME input for this case? Because right now to enable e.g. text/x-mariadb I first have to enter sql in the box, which loads the mode, and then second enter text/x-mariadb: The second step fails in loading a mode, but enables the desired SQL dialect (since the sql mode is already loaded).\n. +1 I've observed the same issue: On FF everything is fine, but on Chrome (more specific: Chromium on a 64 bit Linux machine) the cursor is off by one ore more characters if the line is wrapped.\n. Chromium    28.0.1500.52 (Developer Build 207119) \nOS  Linux \nBlink   537.36 (Unknown URL@0)\nJavaScript  V8 3.18.5.8\nFlash   11.2 r202\nUser Agent  Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1500.52 Safari/537.36\nCommand Line     /usr/lib/chromium/chromium --flag-switches-begin --enable-sync-favicons --sync-keystore-encryption --flag-switches-end\n. Okey found it: The problem is the debugger expression in line 1067, since if I just remove it (and only keep the trailing semicolon) then YUICompressor compiles/packages without complaining; but otherwise it does not seem to like debugger a lot. What does it do by the way? It's the first time I've seen it.\n. The catch statement has nothing to do with the actual content of this pull-request, which is about fixing issues about where stex (or python) inner modes start/end: as an example before the patch the mode would classify :math:\\sum{\\frac{1}{n}}`` as:\n:math:`\\sum{\\frac{1}{n}}`\n ^ ...   stex      ... ^\nwhereas the actual classification should be:\n:math:`\\sum{\\frac{1}{n}}`\n       ^ ... stex  ... ^\nWhile fixing this I happened to stumble upon catch which I'd introduced earlier to catch any unknown bugs and keep the mode going. But since I felt the same suspicion as you have I decided to at least report it on the console so devs become aware if they face a bug and fix it. But now I think it's actually not needed (no bugs reported on any sample rst docs I've in my NoTex.ch editor), and have removed it therefore.\n. I'm not sure I understand what you really intend: What do you have in mind? With unspecified errors do you mean actual bugs in the rst mode? [Of which I'm not aware of any; if so I can probably fix them, but I need corresponding bug reports]. Or do you want to come up with some generic way to handle any unspecified error in any mode?\nBTW: If you have not noticed commit 7e41d23 has removed the catch statement; now, if any new/unreported bug happens then users are directly exposed to, leading to faster fixes [for rst].\n. @cben: I saw this thread too late [already fixed;-] .. to be honest, it has been a while since I've written this mode and the innerMode issue seems to me a little \"opaque\" today; but yeah, I guess you got what you wanted.\n. ",
    "RaymondLim": "You can also see incorrect color if you paste the following CSS into the page.\n.box-warning-rouge{\n      border: 1px solid rgba(215, 44, 44, 0.7);\n      background: rgba(215, 44, 44, 0.4); \n        &:hover{\n           background: rgba(215, 44, 44, 0.2);\n        }\n    }\n.box-warning-rouge{ and border are rendered in the wrong color.\n. I tested in Safari, but I don't think the browser would matter.\n. Thanks. It does fix the issue.\n. I can reproduce this in Chrome and Safari, but not in Firefox.\n. @marijnh \nI wonder whether you're testing on Mac. If you are, then you need to turn on \"Show scroll bars\" to \"Always\" in \"General\" tab of system preferences. Otherwise, you won't be able to reproduce it. Also the cursor will stay on the next line only when you decrease the window height (not on increasing the height) small enough to trigger the vertical scroll bar showing up.\n. @marijnh Thanks for trying. I'll try to describe it on my own words and see you can reproduce it on your end.\n1. Open Jason's page (http://jasonsanjose.github.io/uploads/word-wrap-bug.html) in a browser. (I think any browser will do. I tried it in Safari and Chrome on Mac, and Firefox and Chrome on Win 7.)\n2. Make sure that the width of the browser window is just a few pixels more than the longest line on line 6 and no scroll bars showing in the browser. Note that you need to turn on Show scroll bars as Always on Mac.\n3. Set the cursor inside any word on a line below line 6.\n4. Try to resize the browser window by holding down left mouse button on the bottom edge of the browser window and move mouse up slowly as you watch the hair cursor. \n5. As soon as you see the cursor jumps to the next line, release your mouse button. The cursor should stay on the same position as the one before you let go of the mouse button.\n. Yes, the patch indeed fixes the issue. Thanks.\n. Yeah, you both are correct. I still can reproduce it with Jason's page in Chrome and Safari browser on Mac. The one case that it fixes is only in Brackets when resizing from the bottom edge.\n. Thanks @marijnh. The new patch fixes the issue both in browsers and in Brackets. But it can also cause Brackets to hang. The hang seems to be caused by the infinite loop due to this condition check (cm.options.lineWrapping && oldWidth != cm.display.scroller.clientWidth). So if I change lineWrapping to false in Brackets, then we can avoid this hang. I don't have a reproducible case with CodeMirror demo pages though. For now my only reproducible case is running Brackets unit tests with changes in 7ea6f43.\nUpdate: Below is the call stack that I got from running unit test in Brackets.\ngetRect (codemirror.js:5465)\nmeasureLineInner (codemirror.js:1106)\nmeasureLine (codemirror.js:1019)\ncursorCoords (codemirror.js:1201)\nupdateSelectionCursor (codemirror.js:790)\nupdateSelection (codemirror.js:769)\nupdateDisplay (codemirror.js:417)\nendOperation (codemirror.js:1376)\nwindow.CodeMirror.withOp (codemirror.js:1417)\nCodeMirror (codemirror.js:70)\nEditor (Editor.js:375)\ncreateMockEditorForDocument (SpecRunnerUtils.js:358)\ncreateMockEditor (SpecRunnerUtils.js:382)\ncreateTestEditor (Editor-test.js:64)\n(anonymous function) (Editor-test.js:87)\njasmine.Block.execute (jasmine.js:1024)\njasmine.Queue.next_ (jasmine.js:1842)\njasmine.Queue.start (jasmine.js:1795)\njasmine.Spec.execute (jasmine.js:2122)\njasmine.Queue.next_ (jasmine.js:1842)\njasmine.Queue.start (jasmine.js:1795)\njasmine.Suite.execute (jasmine.js:2267)\njasmine.Queue.next_ (jasmine.js:1842)\njasmine.Queue.start (jasmine.js:1795)\njasmine.Suite.execute (jasmine.js:2267)\njasmine.Queue.next_ (jasmine.js:1842)\nonComplete (jasmine.js:1838)\njasmine.Suite.finish (jasmine.js:2224)\n(anonymous function) (jasmine.js:2268)\njasmine.Queue.next_ (jasmine.js:1852)\nonComplete (jasmine.js:1838)\njasmine.Suite.finish (jasmine.js:2224)\n(anonymous function) (jasmine.js:2268)\njasmine.Queue.next_ (jasmine.js:1852)\nonComplete (jasmine.js:1838)\njasmine.Spec.finish (jasmine.js:2096)\n(anonymous function) (jasmine.js:2123)\njasmine.Queue.next_ (jasmine.js:1852)\n(anonymous function) (jasmine.js:1832)\n. Yes, no longer hang but slow as you said. Below is two separate sections of console output.\nstarting updateDisplay loop codemirror.js:413\nwidth changed from 26 to 76  -- doing a hard re-measure codemirror.js:422\nwidth changed from 76 to 102  -- doing a hard re-measure codemirror.js:422\nwidth changed from 102 to 128  -- doing a hard re-measure codemirror.js:422\nwidth changed from 128 to 154  -- doing a hard re-measure codemirror.js:422\nwidth changed from 154 to 180  -- doing a hard re-measure codemirror.js:422\nwidth changed from 180 to 206  -- doing a hard re-measure codemirror.js:422\nwidth changed from 206 to 232  -- doing a hard re-measure codemirror.js:422\nwidth changed from 232 to 258  -- doing a hard re-measure codemirror.js:422\nwidth changed from 258 to 284  -- doing a hard re-measure codemirror.js:422\nwidth changed from 284 to 310  -- doing a hard re-measure codemirror.js:422\nstarting updateDisplay loop codemirror.js:413\nwidth changed from 310 to 336  -- doing a hard re-measure codemirror.js:422\nwidth changed from 336 to 362  -- doing a hard re-measure codemirror.js:422\nwidth changed from 362 to 388  -- doing a hard re-measure codemirror.js:422\nwidth changed from 388 to 414  -- doing a hard re-measure codemirror.js:422\nwidth changed from 414 to 440  -- doing a hard re-measure codemirror.js:422\nwidth changed from 440 to 466  -- doing a hard re-measure codemirror.js:422\nwidth changed from 466 to 492  -- doing a hard re-measure codemirror.js:422\nwidth changed from 492 to 518  -- doing a hard re-measure codemirror.js:422\nwidth changed from 518 to 544  -- doing a hard re-measure codemirror.js:422\nwidth changed from 544 to 570  -- doing a hard re-measure codemirror.js:422\nstarting updateDisplay loop codemirror.js:413\nwidth changed from 570 to 722  -- doing a hard re-measure codemirror.js:422\nwidth changed from 722 to 874  -- doing a hard re-measure codemirror.js:422\nwidth changed from 874 to 1026  -- doing a hard re-measure codemirror.js:422\nwidth changed from 1026 to 1178  -- doing a hard re-measure codemirror.js:422\nwidth changed from 1178 to 1330  -- doing a hard re-measure codemirror.js:422\nwidth changed from 1330 to 1482  -- doing a hard re-measure codemirror.js:422\nwidth changed from 1482 to 1634  -- doing a hard re-measure codemirror.js:422\nwidth changed from 1634 to 1786  -- doing a hard re-measure codemirror.js:422\nwidth changed from 1786 to 1938  -- doing a hard re-measure codemirror.js:422\nwidth changed from 1938 to 2090  -- doing a hard re-measure codemirror.js:422\nstarting updateDisplay loop codemirror.js:413\nstarting updateDisplay loop codemirror.js:413\nwidth changed from 26 to 52  -- doing a hard re-measure codemirror.js:422\nwidth changed from 52 to 78  -- doing a hard re-measure codemirror.js:422\nand can continue up to a very large number \nwidth changed from 13626 to 13953  -- doing a hard re-measure codemirror.js:422\nstarting updateDisplay loop codemirror.js:413\nwidth changed from 13953 to 14280  -- doing a hard re-measure codemirror.js:422\nwidth changed from 14280 to 14607  -- doing a hard re-measure codemirror.js:422\nwidth changed from 14607 to 14934  -- doing a hard re-measure codemirror.js:422\nwidth changed from 14934 to 15261  -- doing a hard re-measure codemirror.js:422\nwidth changed from 15261 to 15588  -- doing a hard re-measure codemirror.js:422\nwidth changed from 15588 to 15915  -- doing a hard re-measure codemirror.js:422\nwidth changed from 15915 to 16242  -- doing a hard re-measure codemirror.js:422\nwidth changed from 16242 to 16569  -- doing a hard re-measure codemirror.js:422\nwidth changed from 16569 to 16896  -- doing a hard re-measure codemirror.js:422\nwidth changed from 16896 to 17223  -- doing a hard re-measure codemirror.js:422\nstarting updateDisplay loop codemirror.js:413\nwidth changed from 17223 to 17578  -- doing a hard re-measure codemirror.js:422\nwidth changed from 17578 to 17933  -- doing a hard re-measure codemirror.js:422\nwidth changed from 17933 to 18288  -- doing a hard re-measure codemirror.js:422\nwidth changed from 18288 to 18643  -- doing a hard re-measure codemirror.js:422\nwidth changed from 18643 to 18998  -- doing a hard re-measure codemirror.js:422\nwidth changed from 18998 to 19353  -- doing a hard re-measure codemirror.js:422\nwidth changed from 19353 to 19708  -- doing a hard re-measure codemirror.js:422\nwidth changed from 19708 to 20063  -- doing a hard re-measure codemirror.js:422\nwidth changed from 20063 to 20418  -- doing a hard re-measure codemirror.js:422\nwidth changed from 20418 to 20773  -- doing a hard re-measure codemirror.js:422\n. It looks like we always start out with an empty editor window and show the gutter (line numbers) by default. If I set lineNumbers to false, then I don't see the width of scroller element constantly changing.\nBelow is what I see in the console with lineNumbers default to false.\nstarting updateDisplay loop codemirror.js:413\nwidth changed from 26 to 50  -- doing a hard re-measure codemirror.js:422\nwidth changed from 50 to 26  -- doing a hard re-measure codemirror.js:422\nstarting updateDisplay loop codemirror.js:413\nstarting updateDisplay loop codemirror.js:413\nwidth changed from 26 to 152  -- doing a hard re-measure codemirror.js:422\nstarting updateDisplay loop codemirror.js:413\nstarting updateDisplay loop codemirror.js:413\nstarting updateDisplay loop codemirror.js:413\nstarting updateDisplay loop codemirror.js:413\nwidth changed from 26 to 152  -- doing a hard re-measure codemirror.js:422\nstarting updateDisplay loop codemirror.js:413\nstarting updateDisplay loop codemirror.js:413\nstarting updateDisplay loop codemirror.js:413\nstarting updateDisplay loop codemirror.js:413\nwidth changed from 26 to 152  -- doing a hard re-measure codemirror.js:422\n. Verify that the original issue (with Quick Docs or Quick Edit in Brackets) is also fixed with the latest update to CodeMirror.\n. Thanks for fixing it so quick. The patch does fix the scenario that I described, but if you're typing a new tag inside two html comments as shown below, then you can still see the issue.\n<!-- some html comment -->\n<di|\n<!-- another html comment -->\n. Great! the new patch resolves the issue.\n. @marijnh Thanks for fixing it right away. I verified that it is fixed for most cases except in the following case.\n```\nfunction testRef1() {\n    \"use strict\";\n    return 100;\n}\nfunFuncArg(testRef1); //also test return type\n/*\n * @param {function(string,number): string} f\n /\nfunction funFunc2Arg(f) {\n    \"use strict\";\n    var s = \"test\";\n    return f(s, 10);\n}\nfunction testRef2(s, n) {\n    \"use strict\";\n    return s + n;\n}\nfunFunc2Arg(testRef2);\nvar funArr = [];\nfunArr.index1 = testRef1;\nfunArr.index2 = testRef2;\nfunArr.index1(\n```\nPrior to ES6 support changes It used to show index1() -> number.\n. Yep, that patch indeed fixed the remaining case. Thanks.\n. Yes, please add a special case for this to be consistent with the behavior for other tags. And it is ok for",
    "jackolantern": "I updated the branch based on your comments.  I see how to use the CodeMirror.StringStream, but I'm not sure how to make it available in the vim.js file?  Do I just assume that it will always be loaded by the browser before vim.js, or do I need to do something to include it?  (Sorry, I'm not really much of a javascript guy) \n. I think the reason you are seeing [' and ]' go to the first non-whitespace without a mark set is because you changed\nif (closest && motionArgs.linewise) {\ninto\nif (motionArgs.linewise) {\nso the code which sets the cursor to the beginning of the line is running regardless of whether or not a mark is found.\nI am looking at your other changes and will take another stab at it now.\n. @marijnh I had some stuff come up this week.  I will have a fix/tests checked in tomorrow.\n. @marijnh I believe that all of the bugs are resolved and that this branch can be merged in.  @mightyguava Do you agree?\n. @mightyguava My git skills are pretty sad.  I ended up deleting the other pull request because I had a rebase get out of control :/\nThis fixes the original bug I submitted, as well as the issue you pointed out with findWord.  There remains a bug in the code which I describe in the last sentence of the commit message.  (Because this bug exists in the current master, I don't think it should hold back this PR)\n. @mightyguava This commit uses the code from SHA: ac85ead (but not all of the tests, because some of them seemed to be crashing the test suite)\nHowever it also passes the vim.inputState.operator all the way down to moveToWord.  I think that this is necessary, because it seems to me that deleting a word with dw really is a special case.  What do you think?\n(Also, this still has the bug where the cursor ends up at the wrong position after a dw.)\n. So this breaks in the case of:  (interpret \"*\" as a space)\nword1\n**  \n**word2\nIf I place the cursor on the \"o\" in \"word1\" and press \"dw\" I end up with:\nwoword2\nAnd I should end up with:\nwo\n**\n**word2\n. I can't seem to break it!  Also it looks like this fixes all sorts of stuff, like \"dH\", \"dL\", etc.  :D\n. @mightyguava updated from 33e5a47 \n. @mightyguava If you haven't already started, I'd be happy to take a look at fixing this.\n. :/\nOkay, so I guess https://github.com/marijnh/CodeMirror/pull/1621 is the same thing.\nI will stop working on #1612 because it looks like @aeosynth has it under control.\n. ",
    "dpathakj": "Typo.\n. ",
    "apbot": "Yes, I agree. In my particular case, I just remove them, as they appear as a a result of a copy-paste, and  I do not use them. But your approach is better in general.\nI haven't encountered problems with other symbols, but I really haven't tested that. I only came across soft hyphen.\n. ",
    "dqminh": "Sorry, i should have make a pull-request from our official github organization. I will close this and open a new one :sweat_smile:\nEDIT: here is the new pull request https://github.com/marijnh/CodeMirror/pull/1313\n. i think it should be possible. Let me take a look at clike.js and sql.js and try to improve this.\n. @marijnh i updated the code in css.js to be extensible and also added text/x-scss mime there. Can you take a look ?\n. @marijnh @chriscoyier @dubiousdavid  i think the line was introduce here https://github.com/marijnh/CodeMirror/pull/1313/files#L0L449 with the purpose of handling propertyValue inside nested block.\nActually it wasnt obvious to me what the incorrect behavior is. When i pasted @chriscoyier example and press enter, it adds one more indentation level, and remove it when i pressed } to close. Which seems reasonable to me as it's easier to write new property this way.\n. @marijnh ahhh i see the wrong behavior now when revert back to the last known bad state. Thanks a lot for the fix :heart: \n. ",
    "ryandietrich": "Had a new baby last week.  Free time is currently less than negative\ninfinity.\nI just wanted to help, sorry I didn't have the context needed to be of use.\nOn Thu, Mar 28, 2013 at 8:35 AM, Yunchi Luo notifications@github.comwrote:\n\nI think @metatheos https://github.com/metatheos's suggestions are\nreasonable. I will draft up a patch for it Monday if @dextiushttps://github.com/dextiusdoesn't before then.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1312#issuecomment-15591714\n.\n. \n",
    "MiguelCastillo": "That's too bad...  It is easily corrected with a single extra line your css, which is what I am currently doing.\nThank you for your quick response though, much appreciated.\nMiguel\n. Hey dude, thank you.  I just saw this change go in :)\n. Thank you for this change!\n. I was not aware that when I make a pull request, changes that go in after my pull request become part of the pull request.  The only stuff that needs to go in is 440917a. The second entry from the top.\n. We are in the process of updating Brackets to codemirror 5.11 and found that this change affected some of our unit tests.  The issues are around the specific check near.line == pos.line in this commit https://github.com/codemirror/CodeMirror/commit/1fae53703cf4099d4f4855ef18dd14d60514c82f\nHere is a lil history if you folks wanna take a quick peek.\nhttps://github.com/adobe/brackets/pull/12177\nTo see the issue:\n1 go to https://codemirror.net/index.html\n2 open the browser console. We are going to execute the following commands\nvisibleRange1 = editor.markText({line: 0, ch: 0}, {line: 4, ch: 0}, {collapsed: true, inclusiveLeft: true, inclusiveRight: true, clearWhenEmpty: false});\nvisibleRange2 = editor.markText({line: 5, ch: 0}, {line: 8, ch: 0}, {collapsed: true, inclusiveLeft: true, inclusiveRight: true, clearWhenEmpty: false});\n3 Select anything spanning multiple lines.  I expect (and the unit tests as well) that all three of the following selections would generate the same result...  But the first selection has unexpected results.\n```\n// This line shows the issue\neditor.setSelection({line: 4, ch: 0}, {line: 5, ch: 1});\n// And should it be the same behavior as?\neditor.setSelection({line: 4, ch: 0}, {line: 5, ch: 0});\n// And should it be the same behavior as?\neditor.setSelection({line: 4, ch: 0}, {line: 5, ch: 2});\n// Or even?\neditor.setSelection({line: 0, ch: 0}, {line: 8, ch: 0});\n```\n4 The selection issue can be revealed by clearing the ranges after trying each selection in the previous step.\nvisibleRange1.clear();\nvisibleRange2.clear()\n5 Checkout the selected range.\neditor.doc.sel\nPlease let me know if I can help clarify follow the steps or understand more of the issue.\nThanks a million!!\n. ",
    "ericallam": "Yup, I'll take a look.\n. @marijnh awesome, thank you!\n. I unfortunately don't have time to look at this right now but @xeenon feel\nfree to add it in there\nOn Sun, Apr 21, 2013 at 11:52 AM, Timothy Hatcher\nnotifications@github.comwrote:\n\nIt appears the double colon (which is allowed and recommended by CSS3 for\npseudo elements, to distinguish from pseudo classes) is not parsed\ncorrectly either. Only the single colon seems to be supported. The code\nconfuses pseudo elements and pseudo classes by mixing the two in a\npseudoElements variable. THat name should be generic if it has both types\nin the list.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/1461#issuecomment-16729200\n.\n\n\n\"I wish you way more than luck\" - DFW\n. ",
    "satchmorun": "Whoops, some typos. Let me clean up up and redo.\n. Yup, I just pulled and then tried it with .list and inList is giving me consistent results (on OSX on Chrome & Firefox, though that shouldn't matter).\nHere's a quick video showing it doing (and logging) the correct thing: http://screencast.com/t/urvTvmdq\n. No worries, I'm familiar with those urges :)\n. ",
    "TomMalbran": "This would be great. But better if it also inserted before closing brackets, dots and commas. Is strange that you need to wrap those inside brackets, but is common to insert open and closing brackets before them.\n. It does. Thanks for the quick fix.\n. I've been using this feature for some time now and I got used to the underline over the selection and since sometimes what you select is not exactly the same as what is highlighted, it can be nice to have a highlight over the selection.\nSo I am closing this request for now.\n. ",
    "duralog": "yeah I suppose it could be confusing .. :) I really like livescript though.. sorta makes javascript a bit more functional. so yeah, I noticed that when I was using it this morning. I had been compiling the file module with the bare option.. I was just about to clean it up and add the commits. thanks for doing that. appreciate it :)\nI also noticed some errors in the regexes and a few other things are kinda funky after using it a bit now... so I'll merge this and have an another update shortly\n. ",
    "curran": "Related discussion thread how to set view stay in current position when cm.doc.setValue().\nFWIW, this is how I managed to call setValue and not have any scroll modifications:\njs\n  // Set the value, but do not scroll to the top.\n  var scrollInfo = this.codeMirror.getScrollInfo();\n  this.codeMirror.setValue(value);\n  this.codeMirror.scrollTo(scrollInfo.left, scrollInfo.top);\nI wish there were an options object to setValue, similarly to setSelection, so one could say:\njs\nthis.codeMirror.setValue(value, {scroll: false});. I'm facing the same issue. Searching for a way to disable scrolling on setValue.\nI noticed that if I click off the CodeMirror instance first, then call setValue, the scrolling behavior is not quite the same. One alternative that might work (in my case at least) is to programmatically simulate the blur (un-focus) of the editor.. Thanks @marijnh !. @adrianheine Thanks so much for the quick review & merge!. Great idea. Done!\nhttps://github.com/datavis-tech/codemirror-theme-ubuntu\nhttps://www.npmjs.com/package/codemirror-theme-ubuntu. ",
    "mikelehen": "Awesome.  Thank you!\n. Looks good.  Thank you!\n. That did indeed fix it.  Thank you!\n. ",
    "edsharp": "Thank you - that is indeed more elegant.\nThe only thing that didn't replicate is on line 307, my style guide uses indentUnit * 2\n``` xml\n\n\n\n```\nI could make this multiplier an option, similar to indentUnit?\n. Ah :)\nOn 18 Mar 2013, at 12:54, Marijn Haverbeke wrote:\n\nNot an option in the editor! Just in the mode itself. See attached patch.\n\u2014\nReply to this email directly or view it on GitHub.\n. Do you want me to extend your code to handle a single quote as well as a double quote?\n. I'm sorry, but with autoCloseBrackets:true, your patch doesn't work :(\n\n<foo bar=\"boom></fo>\"\n. Thanks, that works as I'd hoped.  \nI have an unrelated issue in the XML tokeniser.  If you have a single quoted attribute and you include a backslash escaped single quote or equivalent with a double quoted string, then the the tokenizer considers the attribute string closed by escaped the single quote, rather than continuing on until it finds the actual closing quote.\ne.g. <tag attr=\"\\\"\" everything-else-here-is-incorrectly-marked-as-a-string=\"and-this-now-isn't!\"\nIs this something you'd consider enhancing?\n. I have also just found another example that breaks the auto close!\n<tag attr=\"foo'></tag>\nIt doesn't care ensure that the opening quote style matches the closing quote style, so the > after the single quote broke it!\nMy problem is that in the XML I am dealing with, there can be regular expressions in the attributes and hence it pushes all the edge and corner cases!  Worse, the regular expressions can be used for matching shell prompts and hence these are common occurrences!\n. ",
    "abrooks": "I've provided a working patch with tests in pull request #1503 that addresses this issue. If that item is pulled, this one can be closed.\n. I'd be happy to. Give me a few minutes or so and I'll push again.\n. @mightyguava Good call. Vim deletes all whitespace trailing or preceding for the \"a\" inclusive motions. This will take longer as I adjust the code. I'll update the pull request with the new changes when they're done.\n. This updated push addresses both the multi-whitespace tests and the fixed logic to handle the multi-whitespace inclusion. Really, the logic reads more like the Vim behavior now anyways.\nLet me know if there are more tests or other changes to the commits you'd like to see.\n. Thanks! I really appreciate the project and hope to contribute again. :)\n. ",
    "adhintz": "Thanks. I was mostly just trying a few pulls to learn how github works.\nOn Mar 19, 2013 2:21 AM, \"Marijn Haverbeke\" notifications@github.com\nwrote:\n\nWell, this seems very insignificant. But hey, you took the time to make a\npull request, so I took the time to merge it in. 962cabehttps://github.com/marijnh/CodeMirror/commit/962cabe4a3a30da1536c8a4a06cdd9ac22e5acfb\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1377#issuecomment-15104293\n.\n. \n",
    "mutahhir": "Hmm, I don't have Linux installed. I tested on chrome, safari and Firefox\non Mac.\n. @marijnh I completely understand. I developed it particularly for mac safari / chrome, so there are bound to be a lot of inconsistencies. Eventually I'll have to support other platforms and will post back a better way. Thanks again for a great editor!\n. ",
    "tqc": "Sorry, I meant \"under\" in the 3d sense, forgot there was also a 2d meaning.\nCodeMirror has its own optimized scrolling, so does it ever make sense to have an editor larger than the viewport? Certainly a reason for an option rather than a default, though I don't see the use case myself.\n. The problem is that on iOS the scroll in view functionality is rather more aggressive, and the viewport size can change on focus. In that environment the current version will sometimes move the whole view when you move the cursor below the middle of the page, even though the entire control is already visible.\nI'm seeing the problem on a large control that is supposed to be fixed in place, but I think the same issue could occur in a smaller field depending on how it is positioned.\nThe only way I can think of to get iOS to treat CodeMirror the same as a regular text area is to make the text area full size, which presumably introduces new issues.\nAs an immediate solution I'm thinking add a new option fixTextAreaPosition that defaults to false and is only used on iOS since on other platforms the scrolling is more controlled by the user. Does that make sense to you?\n. Ah, I think you misunderstand how the scroll in view function works on iOS. A moderately sane implementation would simply check that the control is still visible, and would indeed be a good thing. Unfortunately that isn't what iOS has. Rather than requiring the control to be hidden, scrolling is triggered by the control being in the bottom half of the screen, hidden by the keyboard or not.\nPerhaps a more concrete example would help. Assume a screen 1000px high, with the keyboard 300px at the bottom - i.e. we always have at least 700px available.\nMy layout is a 50px header followed by 650px CodeMirror - there is nothing in the space used by the keyboard, so it never needs to scroll.\nEditing the top part of the code works fine - the hidden textarea is at the top with or without my fix. The problem is that when you move the cursor to the bottom 200px of the code editor, the hidden textarea gets an absolute position greater than 500px, which triggers scrolling. \nThe problem is particularly annoying if you happen to be editing lines either side of that boundary - you tap where you want the cursor, and the view jumps away. I'm pretty sure that can be triggered within a scrolling form as well.\nI see the fix as platform-specific rather than use-case-specific - basically it is a workaround for an iOS bug, with the complication that the default behavior is occasionally correct.\n. There is an easy workaround for that usage at least:\n.CodeMirror-activeline-background {\n  background: rgba(255, 0,255,0.1) !important; \n}\nThat won't work as well for high contrast themes though, so a better solution is probably needed.\nI tried a few other options to get everything in the right stacking context across all browsers, but didn't have much luck. Choice of stacking context is apparently somewhat browser dependent, and as with many things, mobile safari is extra sensitive. I think it has something to do with the combination of scrolling and relative positioning that creates additional stacking contexts on iOS, but to go any further than that the changes get to be more than I am comfortable with.\nDoes the active line background have to be in lineDiv? Its behaviour seems quite similar to the cursor or selection, so perhaps it would fit well on the same background layer.\n. There is no good description of how it works, just trial and error and lots of painful past experience.\nI was able to get the line numbers showing up by setting the gutter z-index to -1 - The same is used for an IE fix, so presumably doesn't have too many associated issues.\nThe line backgrounds are a bit harder - If touch scrolling is enabled, all positioned elements get their own stacking context regardless of z-index setting. The only way to give the line foreground and background different z-index is to remove position:relative from the line wrapper, which means that the absolute positioned background doesn't work.\nI've set up an alternative that works fairly well with some limitations - mainly that the line height will need to be set from script, which is not so good when line wrapping is enabled.\nIf you can't see a better way of handling the positioning, I could see it working as a platform specific option - it probably isn't too unreasonable to be unable to combine line wrapping, opaque line backgrounds and touch scrolling on iOS. \n. 6.1, but it's actually more subtle than just never working - enabling touch scrolling changes the rendering method significantly. iOS touch scrolling has a lot of interesting features, but since it makes a huge difference in how native the app feels, we generally have to put up with it.\nCodeMirror does actually work pretty well on iOS as is - I'm trying to build something that works perfectly enough to use as my primary editor, so run into more subtle issues like the click event delays. Selection wasn't working due to the mouse event timing, and it was only once I fixed that the layering issues became obvious.\nSetting the z-index to -1 does allow code to appear on top of the gutter. However, that is better than hiding all the line numbers, and it can only happen if a fixed gutter is used. Normally that would be an issue, but on iOS that sort of positioning has its own issues - the timing of scroll events makes the gutter jump around. That doesn't look good, so it makes more sense to change the options and choose between line wrapping or a scrolling gutter.\nFixing the gutter scrolling properly would probably involve separating the line numbers from the lines, but that seems like way too much effort for a fixed gutter.\n. That could work, though I might go slightly further and have the option actually turn on touch scrolling as well to keep everything in one place.\n. ",
    "crdev": "Does \"start of a drag action\" mean the \"dragstart\" event? If so, could the \"blur\" be dispatched by CM once \"dragstart\" (rather than \"mousedown\") is dispatched on the DOM element? I never drag text around while editing (does any software developer do?), yet clicking inside a selection is a pretty common action.\n. For anyone who is seeking a workaround for this issue.\nSince the time period between mousedown and mouseup is not specified (a user is free to hold the LMB down for a couple of hours), the workaround suggested in this comment will not work. You need to monitor the mousedown state for your target element (i.e. the one against which the editor has been created) and handle the editor-dispatched \"blur\" event ONLY if the mouse button is up. Some other conditions may apply, but this approach worked for me.\n. ",
    "MissChocoe": "This is an issue for me two. The order of the event is hard to predict, especially in IE since the mouse up trick doesn't work well (the event order isn't always right). So finally, I used a timeout which I don't find really elegant but does work.\n. Oh thanks! Now I know how to make them work. Sorry about the false bug report.\n. ",
    "jdar": "fyi to any who find this page https://github.com/tregusti/brackets-gherkin/blob/master/main.js\n. Author would be: Glenn Jorde \nFine w/o license block. I'll assume you're doing that. (let me know if you want me to.)\n. Sorry, not really a pain point for my shop. Good luck!\nOn Fri, Dec 9, 2016, 11:03 AM Marijn Haverbeke notifications@github.com\nwrote:\n\n@hason https://github.com/hason or @jdar https://github.com/jdar --\nWant to take a look at this?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/4425#issuecomment-266050135,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AACSTNjYrf8eoXtIospU6ByvCkiiqMNRks5rGXvXgaJpZM4LJFRN\n.\n. \n",
    "AlexNisnevich": "Some quick notes:\n- The easiest way to run the game locally is to use Python's SimpleHTTPServer:\npython -m SimpleHTTPServer\n- The problem seems to have something to do with the CodeMirror editor being to the right of a canvas element. We've tried floating the editor, using position: absolute; right: 0;, and even just making both the editor container and the canvas container have display: inline-block, but regardless of how we do it, the problem always persists. On the other hand, when we try placing the editor to the left of the canvas, the problem goes away.\n. ",
    "andyli": "Alright! What about standardizing the notation to be name:type? Name may be method name, property name or argument name in a method?\neg:\nhtml\n<dt id=\"getLineNumber\"><code>doc.getLineNumber(handle: lineHandle): integer</code></dt>\nhtml\n<dt id=\"option_mode\"><code>mode: string|object</code></dt>\n. Sounds good to me. I will work out a pull request :)\n. Thanks for the merge, I'm fine with most of your changes. Just to clarify:\nUse of colon for type declaration of function is consistant between TypeScript, ActionScript, Haxe.\nFor function type, which both TypeScript and Haxe use arrows, notice the different between left-hand-side and right-hand-side:\nvar func:(i:number)=>number = function(i:number):number { return i+1; } //TypeScript\nvar func:Float->Float       = function(i:Float):Float return i+1; //Haxe\nI see the doc entries as function declarations instead of function types, so I chose using colon. But if you want to stick with arrow, I'm fine.\nI'm not use for object, as you said, they wouldn't help much. What about having a <dl> for those complex object type? For example:\n\"change\" (instance: CodeMirror, changeObj:object)\n    changeObj\n        from: {line, ch}\n        to: {line, ch}\n        text: array<string>\n        removed: string\n        ?next:changeObj\n    Fires every time the content of ...\n. ",
    "RedaBenh": "really important to write a small  example of how to get instance of Codemirror from textArea. ",
    "tristen": "Its inserting this:\n- listing\\n - listing\nWhat I expected was this:\n- listing\n- listing\n. ",
    "lynschinzer": "@mightyguava\nNow I've used getGlobalVimState() instead of local states to store lastCharacterSearch info, thanks for reviewing.\n. I see.\n. Looks perfect to me. In your new patch, once the custom map is set, the default map will be ditched entirely, so users don't have to wonder if there's other behavior besides their custom map.\nPretty neat, please merge it.\n. @mightyguava, please have a check on this.\n. > Great, thanks for the continued contributions.\nThanks for initiating this Vim keymap.\nI've been seeing several web-based vim editors, and this one is so far the most promising one. Especially that you've implemented #``* searching, which makes me possible to do actual coding with it.\n\ncm.getTokenAt() relies on the mode identifying the number for you. This won't work if (1) there's no mode set, (2) the mode doesn't assign numbers the 'number' type, (3) the number is part of another token, like a function or variable name.\n\nI see, thanks for explaining. Now I understand it one step better.\n\nCtrl+A/X in vim should seek for the next number on the line and move to it.\n\nAwesome, I've never noticed there's such detail in it.\nI'll try to fix up everything you've mentioned above.\nBtw, as far as I can see, the inclusive part of expandWordUnderCursor() doesn't seem to work properly.\nWhen a user performs a diw on the word \" lisp \",\n- what she expect is: \"  \"  (two space)\n- what she actually got: \" p \" (p surrounded by two space)\nlikewise, when she performs daw,\n- what she expect is: \" \" (one space)\n- what she actually got: \"  \" (two space)\n. Now it behaves almost the same way as the original Vim.\nI'm aware that there's one thing I've implemented differently than the original.\nIn the original, when the cursor is at the very end of a line and you press ctrl-aorctrl-x, it won't track back to the nearest numerical token.\nIn contrast, my implementation does the track back.\nTherefore, in the actionArgs, I allow users to enable this feature via the 'backtrack' attribute.\nIf 'backtrack' is not set or set to false, the backtracking will be disabled, and the key-binding will behave just the same as original Vim.\n. Currently, the backtracking behavior is disabled by the hard-coded actionArgs in order to conform with the original Vim, so there's no way I can test it in the unit test, would you like me to enable it?\n. That should fix it, @mightyguava, is there anything else I need to fix?\n. I don't like to change motionArgs inside the motion either, this is a rather ugly side-effect I made.\nBut it's a shame that this is so far the only way I could fix it. By stepping through the call stack, I couldn't figure out other better places to dynamically change the state of inclusive(inclusive here depends on the previous input and the current input). Seems like the only valid place to set motionArgs.inclusive is at the keymap, but motionArgs there are all hard-coded, it's not like I could make a dynamic inclusive there elegantly.\nGlad that you accept it.\nBtw, you've mentioned evalInput will be called befoe the motion,  could you show me some possible scenario so that I can repeat them? That would help me understand the code better.\n. > H, L motions actually support count. They are well documented at the bottom of the page here http://vimdoc.sourceforge.net/htmldoc/motion. \nExcellent! That's exactly what I was looking for, I'm always aware that I might omit some of the details in my implementations. Next time I'll try to put some efforts on sticking to the vimdoc.\n\nI think this function is a great idea and it's something I've wanted for a while. My opinion though is that it should go in codemirror.js\n\nI totally agreed. However, this proposal once being turned down by Marijn #1434 , and he kinda convinced me with his point of view. \n\nI would add linewise: true to the motionArgs for these motions to make them behave properly with operators.\n\nThanks for pointing this out, I should have taken a closer look at evalInput.\n. >  I don't think this is something that should be on vimApi since vimApi is meant to be used for controlling vim. getUserVisibleLines() would make more sense on codemirror, but since @marijnh feels it's too high level in the core, I agree with him that the alternative is for users should re-implement it.\nHmm... I surely have no intention to tarnish the purity of vimApi. So, any suggestions on a better place to expose getUserVisibleLines()? I'm fine with anything you want it to be.\n. > In my opinion, if it goes anywhere, it should go in codemirror.js. Second option would be a collection of addon utils for codemirror. It doesn't look there's a place it fits in right now so I would assume @marijnh isn't interested in having one in the codemirror repo. I would suggest you just have a duplicate implementation in the application you use codemirror with. Or if you are feeling ambitious, start a repo for a set of codemirror util functions, if one doesn't already exist.\nI'll assume this means simply remove the line getUserVisibleLines: getUserVisibleLines, from vimApi.\nFair enough then, now I shall get my hands on the test cases.\n. Alright, I'm on it.\n. Now I've figured it out, it's due to each browser has a different value of editor.defaultTextHeight(),\n- Chrome is 13px\n- Firefox is 12px\n- Opera is 16px\nSo, if the editor window has a fixed height, say 96px, Firefox can dispaly 8 lines, but Opera only got 6.\nI'll try to rework on the test cases to make them independent from the default text height.\n. @marijnh \nThis patch should fix the current issue.\nSince I code Javascript for Chrome exclusively, I've never come across this kind of compatibility issue.\nIs there a good way to automatically run the tests over different browsers?\nThat could save some repetitive work in the future.\n. Test cases will follow soon if there's no big issues with the current patch.\n. Now I've done the unit tests. Currently, I'm gonna take a ferry trip from Stockholm to Helsinki, and I might not have Internet access until the day after tomorrow. So, I won't be able to respond to your new comments until then. Catch you later.\n. Thanks +1, this patch is seriously awesome!\n. > Cool feature. I didn't know about it.\nSeriously? I'm interested how you do the similar thing without using this feature?\n\nI believe the jumplist commands should NOT be motions? i.e. the key sequence d, Ctrl-o should not be orthogonal and should not delete everything between the cursor and the previous position in the jumplist.\n\nGood call, I didn't even think about the orthogonality issue.\n. With the current patch:\n- [x] cm.setBookmark moved into the jumpList logic\n- [x] bookmark.clear() being called when the bookmark is removed from the jumpList\n- [x] use cursorEqual() instead of the reimplemented one\n- [x] changed from motion to action to fix orthogonality issue\n- [x] suppress this action in visualMode\n- [ ] create test cases (in progress)\n. @marijnh\nTested on Chrome/Firefox/Opera, all my tests passed.\n. @mightyguava \nDeleting line 8 in vim demo won't reproduce the bug for me, brace seeking still works as intended.\nAre there any other ways to test these corner cases?\n. Thanks for spotting the jumpList bug, I've opened up #1515 to address the issue.\nRegarding to #1031, I'll spend some time to get my bearings.\n. The current patch makes the forward seeking a bit different than the original:\n```\nOriginal: %forward seeking does not skip \"comments/quotes\"\nCurrent patch: Skip \"comments/quotes\" if cursor is outside of \"comments/quotes\", \n                     otherwise seek to match-able brackets\n```\nThis is a bit beyond the original, do we want this feature?\nBesides, now the bracket-matching handles comments/quotes almost the same as original:\n```\nCursor outsides \"comments/quotes\" only matches \nother outsiders(brackets outside \"comments/quotes\").\nBut insiders can match both insiders and outsiders.\n```\nFrom what I've got so far, it's technically feasible to eliminate all the bracket-matching inside \"comments/quotes\", so that insiders would never match any insiders or outsiders, but that would make it nonconforming the original, do we want it? Or shall we leave it like this to conform with the original?\n. I'm kinda scary of touching the vimApi, but in order to allow toggling optional behaviors, I've added CodeMirror.Vim.settings.changeDefaultKeymapBehavior_() for changing motionArgs in the defualtKeymap.\nIt might look a bit ugly to you though, please let me know what you think and give me some suggestions to make it look good.\n. Is this good enough? What else shall I do?\n. @marijnh Testing DOM related stuff across a bunch of browsers manually is a painful experience, the current patch doesn't cover test cases for IE, hope this suffices.\n. Oops, never saw that coming. In that case, I'll change the tests to a more robust form.\n. I tried the duplicated computation approach, but I couldn't get it right, there's always a few pixels off, to figure it out might take far too much time. Here I just do a simple check for zb Almost. I still get this failure:\n\nvim_zt==zEnter\n  3255 != 2812\n\nPredictable, since #1528 is merged before this one, the old Enter no longer be a valid key in vim keymap.\nI'll change it to <CR> to fix this issue.\n. > Please condense both down to a single commit, put them on the same branch, make sure the tests pass, and overwrite one of the pull requests with the result, closing the other.\nAlright, the current change set is merged to #1527, please discard this pull request as soon as you merged #1527.\n. @mightyguava\nI'll need your suggestions to make it look good.\n. Good, I'll divide the whole thing into several steps. But this might take a bit longer since my vacation is gonna end soon...\nI commit this whole thing is just aiming at let you see the overall changes I'm gonna make, which might set up a good basis for our later discussions.\n\nI only played around with it for a few minutes and found several bugs in the behavior. Especially, the insert mode replay is quite buggy.\n\nNo surprise there are holes in my implementation. If possible, tell me how to reproduce the bugs.\n\nIn my opinion, it doesn't make much sense to implement q with the keymap like this.\n\nThat's exactly why I'm doing this experiment. The vim keymap format is not compatible with codemirror's keymap format at all. Wait till someone else to fix that and implement the macros didn't seem like to gonna happen any time soon. \n\nIt's not feasible to properly record insert mode behavior using vim as a \"keymap\". Rather it needs to use low-level hooks to CodeMirror's key event system, and possibly a way to mimic key event firings into CodeMirror.\n\nThis part really took me some effort to let it work. I tried to take the low-level hook approach, but it seemed like I'll need to change a lot of code, so instead of changing I feel much safer with adding.\nIn my implementation, I'm concerning with 3 types of input formats:\n1. insertModeKey: codemirror's keymap format, featured by:\n'Shift-A' denoting   'A'\n     'A'       denoting   'a'\n     '\\'*\\''   denoting   '*'\n2. normalModeKey: vim keymap's format, can be converted into insertModeKey\n3. registerText: plaintext from the editor text buffer, text stream can be converted into normalModeKey sequence and executed in both normal and insert mode\nIf the vim keymap format uses codemirror's keymap format, I only need to care about format 1 and 3, which could have saved me lots of work here.\n. Now that we are done with the normal mode part in #1527, we can move along and focus on the insert mode.\nIt seems like @metatheos 's first approach is more appropriate for our current implementation, since I've already proven  its feasibility in the current pull request.\nAlso, @metatheos himself tend to adopt the first approach too. \nWhat do you think?\n. Ah, I see why you're so obsessed with the change approach now.\nIndeed, the first approach turns out to be a lame when it comes to dealing with unicode chars.\nSince I was only focus on letting it work as a code editor, I didn't take that into consideration in the first place.\nSeems like the change + raw key approach has become the our only choice now.\nSo far I have no clue how to get my hands on it on code level, that might take quite some time to figure out how to do it correct.\n. > Nit: in general, prefer == over ===.\nAfter viewing the benchmarks from\nhttp://jsperf.com/comparison-of-comparisons\nI kinda agree with you.\nIn Chrome, === is no longer faster than ==\n. That should do it.\n. - [x] @@ duplicated logic. For @@, either simply merge it with replayMacro and add a special case for the @ \n- [x] remove ugly swapping of 'q'\n- [ ] @ should be repeatable\n- [ ] change normalModeKey to registerText in defaultKeymap\n- [ ] textRegister vs keyRegister \n\n@ should be repeatable\n\nIt's already repeatable by @@, do you mean repeatable by .?\n\nInstead of having a conversion from normalModeKey to registerText, what do you think about changing usages of normalModeKey in the keymap so that normalModeKey == registerText.\n\nThis is exactly what I wanted. Now that we've reached a consensus on this part, I'll do the following changes to the defaultKeymap:\nCtrl-a  ->  <C-a>\nC-Space  ->  <C-Space>\nC-Backspace  ->  <C-BS>\nSpace  ->  <Space>\nEnter  ->  <CR>\nBackspace  ->  <BS>\nTab  ->  <Tab>\nRegarding to textRegister vs keyRegister, I personally in favor of the textRegister approach, since that could make future implementation of .vimrc more convenient. This is also for the sake of conforming to original Vim.\nThe keyRegister approach is not bad either, I'll regard it as a cached version of textRegister, I can still convert between key sequence and text stream when I need to. \nEither approach is fine with me, which one you see is more maintainable?\n\nI appreciate that you are very careful about not regressing, but the \"I feel much safer with adding\" line of thought is going to increase technical debt and make things harder down the line. The accrued technical debt is why I decided to scrap the original vim mode implementation and start from scratch.\n\nSome times I fail to see some big ideas in terms of code quality and such, could you suggest me some trust-able reading materials for that?\n. > The above 3 I would make <Enter> <Backspace>\nYeah, I know you mean <CR> <BS>, by typing :h key-notation in vim, I found a complete list of vim's key-notations.\n\nWould you mind separating this set of changes into its own pull request as well, preceding this one? It would make it much easier on me to review and I'd really appreciate it.\n\nSure, please see #1528.\n. Since #1528 is merged, now our progress is updated to:\n- [x] @@ duplicated logic. For @@, either simply merge it with replayMacro and add a special case for the @ \n- [x] remove ugly swapping of 'q'\n- [x] change normalModeKey to registerText in defaultKeymap\n- [ ] @ should be repeatable\n- [ ] finish textRegister\n\n@ should be repeatable\n\nCan it be more specific?  Repeatable by @@ or .?\nIf it means @@, then I already have it implemented.\n. Ah, good call, I'll fix it soon.\n. - [x] @@ duplicated logic. For @@, either simply merge it with replayMacro and add a special case for the @ \n- [x] remove ugly swapping of 'q'\n- [x] change normalModeKey to registerText in defaultKeymap\n- [x] @ should be repeatable\n- [ ] finish textRegister\nSeems like the only thing left is to delete normalModeKeyToTextToken and its call sites. Anything else I'm missing?\n. - [x] @@ duplicated logic. For @@, either simply merge it with replayMacro and add a special case for the @ \n- [x] remove ugly swapping of 'q'\n- [x] change normalModeKey to registerText in defaultKeymap\n- [x] @ should be repeatable\n- [ ] finish textRegister\nSeems like the only thing left is to delete normalModeKeyToTextToken and its call sites. Anything else I'm missing?\n. - [x] @@ duplicated logic. For @@, either simply merge it with replayMacro and add a special case for the @ \n- [x] remove ugly swapping of 'q'\n- [x] change normalModeKey to registerText in defaultKeymap\n- [x] @ should be repeatable\n- [x] finish textRegister\n\n\n[x] Transparentize hidden states\n[x] Revise logKey logic\n[x] IE compatible array.forEach\n[x] Remove deprecated lookups\n\nAnything else need to be fixed?\n. Alright, that should do it.\n. @marijnh \nThe changeset in #1517 is now merged to this branch. #1517 is no longer needed, please discard it.\n. @mightyguava\nThe moment when I ran the test suite without changing the related tests, regressions popped out like a firework show...\n. The current patch should address the above 4 comments, anything else need to be fixed?\n. > Are you using the key event handler and the cursorActivity handler in combination to detect if the key caused a cursor movement?\nExactly, or do you know of some other ways?\n. > Suppose you press Shift-Left to select some text. You could press Left again to deselect everything. You could press Delete to delete it. How is this accounted for?\n<S-Left> should be logged by cursorActivity. When text is selected and Delete is pressed, change should log the <Del> key. If Left is press to deselect the text, we won't detect anything.\n\nAre you under some time constraints? If not, I recommend breaking apart the code as before and scrutinizing and committing it incrementally.\n\nI'll be pretty busy from tomorrow on, yet I would like to break this mess into small pieces too, I can just do it with slow paces. What order would you suggest?\n\nTODO:\n- [ ] use CodeMirror.keyName\n- [ ] extract key conversion logic to vimKeyToCmKey()\n- [ ] use CodeMirror.lookupKey(key, ['vim-insert'], handler) instead.\n- [ ] remove stopPropagation\n- [ ] exitInsertMode fake ESC\n- [ ] change fallthrough switch to if/else\n- [ ] <CR> vs \\n\n- [x] Why is the ? back?\n- [x] options.onKeyEvent\n- [x] handleInsertModeKey to replayInsertModeKey\n- [x] separate nested ternary operators\n- [ ] remove toString\n\nKnown bugs:\n- [ ] Ctrl-[ seems to be the only key that gets recorded exiting insert mode.\n- [ ] Errors are getting thrown in rawKeyEventToCmSpeicalKey on IME input. Using CodeMirror.keyName may or may not fix that.\n- [ ] Recording unicode isn't actually working on my mac. I held down u to activate the selection prompt, pressed 3 to enter \u00f9. On replay nothing was entered. Edit: Seems to work when I tested again. There's probably a subtle glitch somewhere.\n- [ ] Pressing @a produced the text aLeftRighta. The expected result should have been aa\n. > 1. Getting change events to work perfectly, completely ignoring cursor activity and key events. This would include the fake ESC in exitInsertMode, making sure IME input works, and removing the toString. Following what @marijnh wrote, I don't think you need to catch the Enter key. This would be the first pull request\nFor the first part, please see #1550.\n. > 1. Getting change events to work perfectly, completely ignoring cursor activity and key events. This would include the fake ESC in exitInsertMode, making sure IME input works, and removing the toString. Following what @marijnh wrote, I don't think you need to catch the Enter key. This would be the first pull request.\n@mightyguava\nI tried iBus with Chinese and Japanese IME, they seemed to work well on my Ubuntu 12.04.\nBut normal mode seems to have some glitches on IME support:\nExpected:\n When the IME is on, any text input won't be inserted when it is in normal mode.\nActual:\n When the IME is on, text can be inserted directly in normal mode as if it were in insert mode.\n. Allow me to close this PR for now. I might reopen it later when I have enough spare time.\nIf anyone is interested to get this feature done, feel free to reuse the code in this PR as well as in #1535.\n. >  @lynschinzer, if you have time could you help test? Thanks.\nAwesome, thanks for finishing that PR for me, later if I have time I'll try to help testing out this feature.\nBesides, the authorship here is no big deal, since we both are going after the same thing, don't let that kind of notion to slow us down.\n. Sure, thanks for addressing this issue.\n. I see. I sort of learned this lisp-like coding style from Marijn. Could you show me some examples how you format it? It would be nice if we used the same coding style.\n. Since I only have Ubuntu running on my laptop, I couldn't confirm this myself.\nIn that case, I tend to trust Marijn, since the /regex/ syntactic sugar looks more elegant.\n. Well, without the =, the cursor will backtrack 1 character backwards if you place the cursor right after a digit, which is an undesired feature.\nSo, end <= cur.ch is sane.\n. This local never get used anywhere in the current context, I'm surprised that the linter didn't catch it.\n. Trivial bug fix. The nextCh here was assuming cm.getLine() would return line breaks, which in fact, was a false assumption. The previous code works simply because the auto indentation inserts white spaces at the head of a new line. Without those white spaces, the seeking process would be blocked by a single new line between a matched-bracket pair. \n. mode can be moved out from this funtion without much trouble. But for modeCompleted and modeInit, since they are more or less coupled with the local states, moving them out would mean moving those relevant states out from the scope as well, and that might not be a good picture. I would suggest, put mode outside and let modeCompleted and modeInit stay inside, what do you say?\n. You're right, I'll fix it.\n. Should be symbol && isMatchableSymbol(symbol). You've pointed it out previously, and I forgot to change it, my bad.\n. I know you prefer the defaultKeymap to be treated as immutable, but so far this hack is the only way I could achieve the very distinct behavior of key q:\n```\n- when entering record mode, keymap receives ['q', 'character'] \n  (requires higher precedence than ['q'])\n\nbut when exiting record mode, keymap receives only ['q']\n  (requires higher precedence than ['q', 'character'])\n```\n\nIt's a shame that ['q', 'character'] and ['q'] are mutually excluding each other in the defaultKeymap,\nkeep them static won't do us any good, so I've got no choice but to make them swap.\n. Catch q in handleKey during macro mode is an easy hack, but skip pressing the second key stroke i.e. character isn't that straight forward, I'll try to find my way to hack it around.\n. ? is for stopping greedy matching, so matching something like <Space><Enter>blahblahblah will only match <Space> not <Space><Enter>. \\n is there because . failed to match it, I'm not quite sure if we need it since we use <CR> to indicate line breaks, I put it there just in case.\n. Ah, I see your point now, I use <\\w+-.+?> over <\\w+-\\w+> is to in case something like <C-[> shows up. Maybe I shall change it to /<\\w-.+?>|<\\w+>|./ ?\n. Exactly, let's use /<\\w-.+?>|<\\w+>|./ for this.\n. Quite right, I'll fix it.\n. Done.\n. No, the macroKeyBuffer shouldn't be empty here, it should be empty before text stream are parsed into the macroKeyBuffer. I put that empty routine inside parseRegisterToKeyBuffer.\nYou're probably right, I made some hidden states and behaviors here that makes it counter intuitive. I'll revise the code to a more transparent form.\n. Yes, it is intended.\nWithout dialog.js, we won't have openDialog functioning, and we can't see whether we've entered the macro recording mode from the prompt.\n. Sorry for the confusing name, I forgot to change it to rawKeyEventToVimKey which is not doing quite the same as CodeMirror.keyName.\n. I'll put the conversion logic into a new function named vimKeyToCmKey().\n. Seems like It happened to use the same name as some built-ins, how about I change it to stopGlobalKeyPropagation?\n. Alright.\n. Yeah, and I'll explain the same thing again:\nWhen it comes to matching something like <C-[>aaabb<C-[>xxx, it suppresses greedy matching so that it only matches <C-[> rather than <C-[>aaabb<C-[>.\nActually, I thought we've already done this change in previously merged pull requests, back then we both agreed on changing it to /<\\w+-.+?>|<\\w+>|./.exec(text), I wonder why that patch didn't take effect here. Could it possibly because I lost it during some git stashing...\n. > Why is it necessary? What exactly are you using it for?\nGiven the event firing order:\n1. raw key event\n2. change\n3. cursorActivity\nWith this stopPropagation thing, 1 can suppress the callback of 2 and 3, and 2 can suppress 3.\nWhen I log a key in change, the same key no need to be logged again in cursorActivity, so I'll need to suppress cursorActivity.\n. >  I would instead just set the key to null or undefined.\nGood idea! This is way much better than the silly stopPropagation.\n. @marijnh didn't leave me much choice on this...\nFrom what I can see on http://codemirror.net/doc/manual.html, there's apparently no key-relevant events for cm.on.\nHope I'm wrong...\n. >  Why not make the newline a part of the change chunk?\nFor a newline, chageObj.text doesn't give me ['\\n'], it gives me ['',''] instead.\nI'll try to see if newline works well here.\n. Right.\n. Good.\n. I don't quite get it. How?\n. It's not adding property, it's overwriting changeObj's toString() default behavior.\nBefore this overwriting, [{text:'daw'},'a','x','<Right>'].join('\\n') == '[Object Object]ax<Right>'\nAfter this overwriting, [{text:'daw'},'a','x','<Right>'].join('\\n') == 'dawax<Right>'\nIt doesn't seem like there's other way of doing it.\n. Now I see.\n. So this is where window.addEventListener comes in handy.\n. > CodeMirror.on also does DOM handler registration (in an IE-portable way), by the way.\nThanks, this is very good to know. The user manual definitely need to highlight this feature.\n. I tried cm.on('keydown', function(e){alert(e)}), but no event gets fired. What am I missing here?\n. Done.\n. ",
    "RajSoa": "My question is will this indentation work for python, groovy, beanshell and XSLT? Do I need any specific js library for each in order to make the indentation work?\nAs per my knowledge, python.js has a method called  indent(stream, state, type) . Can you tell me, what exactly are the stream and state parameters?\n. IE version 9\nCodemirror version 3.11\nThis is similar to the issue mentioned in the following link\nhttps://github.com/marijnh/CodeMirror/issues/57\nHas this issue been fixed? If yes then how?\nThe indentation provided by javascript mode does not work properly. The cursor position gets messed up. When I hit enter after a closing bracket or an opening bracket, the cursor moves down but the brackets don't move. For opening bracket situation, the cursor should go inside of the opening and closing bracket. \n. Thanks. I did not know that I can comment on a closed issue. \nActually I was not asking to change your javascript.js code. I want to know which code should I modify to acheive the following scenario.\nThe cursor is between the opening and closing bracket {cursor} . When user hits enter, \n1) Cursor should be indented on a new line\n2) And the Closing bracket should go to the next line and should be aligned accordingly.\nPlease let me know.\n. Actually this is based on a bug. My lead expects this behavior to happen.\nAssume that the cursor is between opening and closing brackets and user hits enter, there shud be a new line created and the closing bracket shud be on the next line after the new line. This is not happening currently.\nSo I want to know if I can manually modify the code to make it work. \nPlease help\n. I am trying to use selectLines() to achive this. but its not available in codemirror.js. Which Js file do I need to download?\n. ",
    "ryun": "Check out this example: http://codemirror.net/1/contrib/php/\n\"This is a complex demonstration of the PHP+HTML+JavaScript+CSS mixed-mode syntax highlight capabilities of CodeMirror.\"\n. ",
    "steverandy": "@marijnh tried it. \nDoesn't work.\n. Using latest chrome on OS X.\n. Yes I did. \nBelow is the snippet.\n@editor = CodeMirror @$(\"#editor\")[0],\n  mode: \"markdown\"\n  lineNumbers: false\n  lineWrapping: true\n  width: \"100%\"\n  height: \"100%\"\n  minHeight: 400\n  saveFunction: @saveDebounced\n  cursorScrollMargin: 20\nI recorded the screen to better show what happened.\nhttps://dl.dropboxusercontent.com/u/2271268/cursormargin.mov\n. Actually there is still space to scroll. It's just that once the cursor hit the edge of visible view, there is no some kind of padding bottom.\nI tried the trick with CSS that you mentioned above, but it didn't work.\n. ",
    "smpb": "Thank you. I understand my mistake.\nMay I suggest that this particular behaviour be addressed in the documentation?\nI browsed through it once more, to check if I had missed anything, and saw nothing related option objects reuse.\nCould be helpful to others.\nThanks again.\n. ",
    "bitwiseman": "Also, repros in IE9 and Chrome on windows 7.\n. ",
    "zerkms": "Sample solution: pull request https://github.com/marijnh/CodeMirror/pull/1482\n. @deoxxa fair point :-) Guilty\n. ",
    "deoxxa": "https://twitter.com/zerkms/status/348220251160313856 (lol)\n. ",
    "jbalsas": "Hi @marijnh, sorry it's taken me so long to get back at this. \nI've verified that the done function is indeed called, but it has some delay with respect the regular mouseup event. Also, yes, the selection is the normal CodeMirror selection, everything behaves as if regular mousedown-move-up events are triggered.\nThe problem is that it works like this by design. It is designed to let the user resume the gesture after briefly lifting the fingers, in order to make adjustments to the selection. For that, the OS seems to introduce a small delay before dispatching the mouseup event, which is cancelled it if the gesture is resumed before the delay has finished.\nWith this in mind, I'd say a possible fix would be to invalidate or force complete the current select operation after a keypress if we are on this case. Does that sound right to you? Is there already any similar case?\n. Afaict there's no native way to detect this case. I've checked, and the mouse events in both cases are exactly the same, so there's no way to tell them apart based on any event-related information.\nOne thing I've noticed though, is that inside done, in the regular case the mouseup event is immediate, and cur = posFromMouse(cm, e) always matches the position from the last mousemove. Checking that this condition holds true before the doSelect(cur) fixes this issue. Going even further, it looks as if this doSelect(cur) could just be removed. Do you think it would be ok to do so? Is there a case in which it makes a difference?\n. Yes, simply removing the doSelect does fix this issue and doesn't seem to introduce any noticeable issues.\nThe done's body already executes only once. The problem is that it executes well after other actions like keypresses that change the cursor position discarding the selection, so the resulting effect is like it restores it.\nAnother possible option if you don't want to just remove the doSelect call could be to expose the up operation so that we could detach it from mouseup on the keypress handler.\n. Thanks a lot! I've pulled the latest changes and the issue doesn't reproduce anymore :)\nAbout the editor not being focused right ahead... I haven't seen anything weird so far. Can you elaborate a set of steps that you think could cause problems?\nIn any case, this looks good to close! Thanks again! :)\n. ",
    "ryfys": "does it work? I've opened index page on codemirror site and copied code on main page. It still doesnt copy formatting\nhttp://clip2net.com/s/6vB2gO\n. I know. Under formatting I mean new line\n. ",
    "tophf": "@marijnh, every grammar token in CSS is case-insensitive (spec), not just colors. \nHere's a quick fix: css.js\ndiff\n@@ -77,9 +77,9 @@ CodeMirror.defineMode(\"css\", function(config, parserConfig) {\n       return ret(\"qualifier\", \"qualifier\");\n     } else if (/[:;{}\\[\\]\\(\\)]/.test(ch)) {\n       return ret(null, ch);\n-    } else if ((ch == \"u\" && stream.match(/rl(-prefix)?\\(/)) ||\n-               (ch == \"d\" && stream.match(\"omain(\")) ||\n-               (ch == \"r\" && stream.match(\"egexp(\"))) {\n+    } else if (((ch == \"u\" || ch == \"U\") && stream.match(/rl(-prefix)?\\(/i)) ||\n+               ((ch == \"d\" || ch == \"D\") && stream.match(\"omain(\", true, true)) ||\n+               ((ch == \"r\" || ch == \"R\") && stream.match(\"egexp(\", true, true))) {\n       stream.backUp(1);\n       state.tokenize = tokenParenthesized;\n       return ret(\"property\", \"word\");\n@@ -162,16 +162,16 @@ CodeMirror.defineMode(\"css\", function(config, parserConfig) {\n       return pushContext(state, stream, \"block\");\n     } else if (type == \"}\" && state.context.prev) {\n       return popContext(state);\n-    } else if (supportsAtComponent && /@component/.test(type)) {\n+    } else if (supportsAtComponent && /@component/i.test(type)) {\n       return pushContext(state, stream, \"atComponentBlock\");\n-    } else if (/^@(-moz-)?document$/.test(type)) {\n+    } else if (/^@(-moz-)?document$/i.test(type)) {\n       return pushContext(state, stream, \"documentTypes\");\n-    } else if (/^@(media|supports|(-moz-)?document|import)$/.test(type)) {\n+    } else if (/^@(media|supports|(-moz-)?document|import)$/i.test(type)) {\n       return pushContext(state, stream, \"atBlock\");\n-    } else if (/^@(font-face|counter-style)/.test(type)) {\n+    } else if (/^@(font-face|counter-style)/i.test(type)) {\n       state.stateArg = type;\n       return \"restricted_atBlock_before\";\n-    } else if (/^@(-(moz|ms|o|webkit)-)?keyframes$/.test(type)) {\n+    } else if (/^@(-(moz|ms|o|webkit)-)?keyframes$/i.test(type)) {\n       return \"keyframes\";\n     } else if (type && type.charAt(0) == \"@\") {\n       return pushContext(state, stream, \"at\");\n@@ -793,7 +793,7 @@ CodeMirror.defineMode(\"css\", function(config, parserConfig) {\n       },\n       \"@\": function(stream) {\n         if (stream.eat(\"{\")) return [null, \"interpolation\"];\n-        if (stream.match(/^(charset|document|font-face|import|(-(moz|ms|o|webkit)-)?keyframes|media|namespace|page|supports)\\b/, false)) return false;\n+        if (stream.match(/^(charset|document|font-face|import|(-(moz|ms|o|webkit)-)?keyframes|media|namespace|page|supports)\\b/i, false)) return false;\n         stream.eatWhile(/[\\w\\\\\\-]/);\n         if (stream.match(/^\\s*:/, false))\n           return [\"variable-2\", \"variable-definition\"];. Sure, just was afraid it doesn't meet the bar :-). Why not add all the numpad keys like divide? For example, currently it's not possible to assign blockComment command to Ctrl-Shift-NumpadDivide (keyCode: 111).\n. Found a list that applies to javascript despite the page title:\n| name | keyCode |\n| --- | --- |\n| NumpadMultiply | 106 |\n| NumpadAdd | 107 |\n| NumpadSubtract | 109 |\n| NumpadDecimal | 110 |\n| NumpadDivide | 111 |\n| NumpadEnter | 13 |\nNumpad 0-9 were already added as 0-9 but the codes are different so I think it might be better to add them under their true names (but this is quite a major change so probably the idea is bad after all): \njs\n    // Number keys\n    for (var i = 0; i < 10; i++) {\n        keyNames[i + 48] = String(i);\n        keyNames[i + 96] = \"Numpad\" + i;\n    }\nNumpadEnter has the same code in js as Enter so there's probably no need to add it.\n. 0a83a4b broke completeSingle: true.\n. The \"side effect\" refers only to my hacky implementation which has nothing to do with the feature if I understand your objection correctly. You can simply disregard that code and what it implies. \nThe idea per se may be implemented properly if you can extend CodeMirror's overlay API so that when token() is invoked from highlightWorker's doc.iter it receives an additional parameter to indicate start/stop of the iteration in this run of highlightWorker and a parameter to indicate the overall completion.\nEdit: I've removed that code.. Not knowing the stage of processing is not what makes overlays fast, obviously, and I don't know why you appear to think there's a direct connection. \nOn the other hand, knowing the processing state would open more possibilities at an effectively zero cost of comparing a boolean parameter or a line index number. For example, with the latter it would be possible to alter overlay behavior based on proximity to the active line. And that's just one example off the top of my head.. That ironic retort sounds like you didn't read the second paragraph. Welp, I guess I'm not good at selling ideas so I see no point of pursuing this further.. FWIW, commenting out export default CodeMirror in /src/codemirror.js removes $1 from the rollup output, and the result is just as usable at least in my case.. > I wasn't able to find out why it behaved like that\nIt made sense in case one wanted to add an opening bracket inside existing text, then a closing one at another place. Without this check a pair of brackets is always added now, which is why I suggested to allow users to configure the behavior. OTOH CodeMirror can surround a selection with brackets when the user types an opening bracket - this is probably a well-known method, although maybe not that obvious if one doesn't know about it.. @marijnh, the new behavior is counter-productive and even annoying in JavaScript mode, which I'm positive of after having tried coding for more than a few minutes (in Chrome devtools). When editing an existing script I've noticed I delete the closing bracket ~99% of time I type an opening one. I think it should be either configurable - as I suggested initially - or enabled on a per-mode basis.. ",
    "serpent213": "Just noticed that the backspace behaviour is not quite original: should undo character input unless cursor was moved, I think, otherwise just move cursor left.\n. ...still not original, but a bit better.\n. ",
    "mizchi": "related to https://github.com/codemirror/CodeMirror/issues/3158\n. @marijnh OK, so I reported to webpack https://github.com/webpack/webpack/issues/624\n. ",
    "chandrap": "Here is the use case:\nFor .java we are using 4-space indentation for multi-line function calls.\nWe configure codemirror with dontAlignCalls for .java files.\nFor .cc files, we align calls if there is at least one parameter in the\nfirst line of function call. If first line of function call doesnt contain\nany parameter, we indent sub-sequent lines in the function call with\n4-spaces.\nexample:\nvoid aligned(int i,\n                  int j, // aligned multi-line function calls\n                  int k) {\nvoid foo(\n    int i, // aligned with 4-spaces -- similar to dontAlignCalls; but align\ntakes priority\n    int j,\n    int k) {\nThx,\nChandra\nOn Sun, May 12, 2013 at 11:23 PM, Marijn Haverbeke <notifications@github.com\n\nwrote:\nDo you really need both modes (dontAlignCalls and dontAlignCalls +\nnonAlignedCalls)? I find the names sound like both do the same thing, and\nin fact, I'm not entirely close on what the difference is.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1518#issuecomment-17794517\n.\n\n\nChandra\n// follow me @ http://twitter.com/pydichandra\n\"Overcoming the unexpected and discovering the unknown is what ignites our\nspirit.  It is what life is all about.\"\n. ",
    "puffnfresh": "It's a solution I thought about but I would not like to put my moveUpAcrossRegions function into CodeMirror.commands. I'm compiling to JavaScript, so mutating an external object is slightly messier (plus, urgh).\nBinding a \"go\" command to a key enables Shift selection when Shift is pressed. Binding a \"go\" command to a key containing Shift does not enable Shift selection when Shift is pressed. Doesn't that seem inconsistent?\n. I understand the intention. I think it's inconsistent. It just doesn't make sense that \"go\" means \"pass through shift\" unless it's actually bound to shift. That's a wat.\nYes, it's all crummy.\n. ",
    "voy": "It works. Thank you!\n. ",
    "probertson": "Would you be willing to consider pulling the killLineSmartStart() function, even without the default bindings?\nI'm interested in having these shortcuts in Brackets. I started by writing a Brackets plugin, but I wasn't able to access some of the CodeMirror hooks I needed to be able to do it well. (I do have a Brackets plugin working but it's pretty hacky -- it deletes one word at a time while testing if the cursor has reached the start/end position.)\nWith the killLineSmartStart() function then at least I would have something to hook into. Or if that's too specific, if I write a function for finding the \"smart start\" position would you consider taking that as a pull request? That's the main hook that I am missing to do a cleaner plugin.\n. From a selfish perspective, I'd rather have higher-level APIs to write to, so in that sense I prefer having the killLineSmartStart() function =)\nBut yes, now that I've taken what I learned hacking on CodeMirror back to my Brackets plugin, these are the functions that I don't have access to that I would want to have access to if I'm creating a plugin with killLineSmartStart() functionality:\n- posEq() -- easy to replicate\n- Pos() function -- easy to replicate since I can still call new CodeMirror.Pos()\n- lineStart() -- has dependencies on other functions in the bidi code, so this is harder to replicate\n- getOrder() -- also tied into the bidi code\nThe other thing I'm using that doesn't seem to be officially documented is calling the killLine() command this way:\n- CodeMirror.commands.killLine(cm)\nThe killLine() function isn't listed in the API docs (and neither is the CodeMirror.commands mechanism of accessing it), so if there's an \"approved\" way of accessing it I'm not sure what it is.\nP.S. Thanks for being so responsive!\n. ",
    "danheberden": "Oh, we're gonna ditch version unless the repo doesn't have a tag - so as long as you tag your repo as vX.X.X or X.X.X (which it looks like you started doing with 3.13.0), you don't need to worry about it. \n. I wouldn't remove the version yet - we need to update bower to use the new spec implementation. I just wouldn't worry about updating it for now, if you don't mind. \n. yay! \n\n. ",
    "dirkg": "Hi Marijn,\nIndeed, the problem is fixed!\nThank you very much for the very quick fix!\nI am now building a javascript based static website generator tool. Your CodeMirror software is the perfect solution for authoring the content (HTML) and for the configuration of the website tool (templates, settings, ...).\nAs you will understand, your CodeMirror software will play a crucial role in my project. Therefore within a few months from now, I will request for a paid support contract with you, in order to give you something in return for your great software you made available for me.\nMany thanks!\nDirk Goossenaerts \n. ",
    "inexorabletash": "From code inspection, it looks great. I'll report back when I've had a chance to actually try it out (within a day or two).\n. Tried it out - it's live at http://calormen.com/jslogo/ (hit the arrow to make the entry field multi-line). Works great in multi-line mode... but the change introduces one bug with regard to keymaps.\nhttp://calormen.com/jslogo/ uses styles and a keyMap to provide a \"single-line\" entry by default (REPL-style). The keyMap overrides Enter to \"run\" the current entry. The \"explode\" feature revision alters the behavior when Enter is pressed between brackets (regardless of whether or not explode is specified). The add-on consumes the keypress rather than letting the app see it.\nPrior to a808849: type show [ and it autocompletes to show [] with the cursor between the brackets. Press Enter - the page catches it and runs.\nAfter a808849: type show [ and it would auto-close to show [] with the cursor between the brackets. Then press enter and the cursor jumps to after the brackets. Pressing Enter one more time is required to run it.\n(The single-line entry is a bit of a hack, but otherwise works well. I'll file another issue eventually about supporting that via an add-on.)\n. Ah, I'd misunderstood the options. Yes, this works as expected with: autoCloseBrackets: { pairs: X, explode: Y } - perfect.\nOne more nit: The backspace-removes-bracket-pair behavior seems to have broken as well.\n. And indeed, if you hit Backspace inside a pair, an exception will be thrown: line is an undefined reference in closebrackets.js line 33\nHere's a fix - basically, restoring the previous declaration/initialization of line.\njavascript\n-        var cur = cm.getCursor(), around = charsAround(cm, cur);\n+        var cur = cm.getCursor(), around = charsAround(cm, cur), line = cm.getLine(cur.line);\n. I hadn't thought through that case. It seems reasonable, but I wouldn't consider it required for the feature.\nOn Jun 2, 2013, at 9:03 AM, Marijn Haverbeke notifications@github.com wrote:\n\nThat was a refactoring screwup, should be better now.\nDid you expect backspace, when inside an 'exploded' pair, to remove all whitespace inside the pair?\n\u2014\nReply to this email directly or view it on GitHub.\n. Tried the new code - seems great now.\n. \n",
    "mario-d-s": "@marijnh your last commit seems to have fixed it. However now the problem is that the height is calculated incorrectly. The cursor appears slightly above each line, even when refreshing. I might be doing something wrong myself, but just to make sure I'll try to throw you a demo together. What's the best way to send it to you btw?\n. ",
    "reqshark": "Yea let's drop in this one by aaronmccall. Aaron's looks pretty XMLy so let me know if CodeMirror is ready for that or what. I totally agree, I'm super confused all the time but I could kick you back another commit with the aaronmccall mode or miksago's classic tmbundle. Let me know so I could start using your app right away, it looks awesome\n. Oh tough luck. Yea I look like a retarded person because I'm accustomed to everything being done for me by much better programmers who happen to surround everything I'm into. I guess that comes with the turf in any decent programming language these days... So yea I meant no offense, I'm looking at the CodeMirror modes now and OK I see what you're saying. Well jade is like a JavaScript library, written through JavaScript in the first place as far as I know, what is that called, a dictionary...  it's probably doable over loops or reversing reg exs already written, so I'm def interested... Earlier today I enjoyed Adobe's build--it had me on a fun little environment in no time with free server reloads plus client side page refreshes (well you just have to switch socket.io on) and it was great--not even one line of file watcher stuff: https://github.com/DennisKehrig/brackets-v8-node-live\n. Can't believe there's a picture out there on the internet that captured my state of mind during this commit, the fact that you brought it into this discussion is even more impressive\n. ",
    "francisreyes": "for example in http://codemirror.net/demo/vim.html\nClicking in the code mirror window, and insert some text, press ESC. \nApple +T, Apple+N, Apple+W, etc doesn't add a new tab, open a new window, or close a window as expected. \nUsing Safari 6.0.3 (8536.28.10)\n. ",
    "sausman": "This seems to have fixed itself in Chrome 29.0.1546.0 canary\n. ",
    "Dominator008": "Should be better now. Setting the \"left\" property on \"display.gutters\" after makeDisplay() seems to work.\n. Thanks a lot for taking a look. My use case always line wraps and doesn't need dynamic option setting, so I got it to look the way I wanted already (for now) without spending too much time on it. That said, I will continue fixing the problems and hopefully the next commit will be much better :)\n. Using an option seems more elegant. Thanks!\n. Yes I agree, but while markText({line:0},{line:1},{\"collapsed\": true});\nmakes the entire second line disappear, markText({line:-1},{line:0},{\"collapsed\": true}); leaves the first line empty with line number \"1\" still showing.\nit would be nice if these two behave the same way. It might be better to have a \"hideLine\" function instead of using markText().\n. So I guess there's no way to completely hide the first line then...\n. In fact, being unable to hide lines completely causes another problem:\nIn http://codemirror.net/demo/activeline.html,\nIf we use markText({line: 0}, {line: 1}, {collapsed: true}) to \"hide\" the second line, then any cursor click on the first line beyond its length will be considered a hit on the hidden second line, and thus will not mark the first line active.\nI wonder how hard it would be to restore the \"hideLine\" interface.\n. Thanks for the quick fix. One more problem, and this time involving selection so it might be harder to fix...\nPerform the same markText() action on the same demo to hide the second line, then triple clicking on the first line selects both the first line and the second one. I guess doSelect() is also confused by collapsed spans.\n. And the dummy lines also confuse the VIM mode.\nIn http://codemirror.net/demo/vim.html, do editor.markText({line:1},{line:3},{collapsed:true}) to collapse the third and fourth lines, then 'k' and 'h' will get stuck on the end of the second line. I might work on some hack around that...\n. Confirmed. editor.markText({line:-1},{line:0},{\"collapsed\": true, \"inclusiveLeft\": true, \"inclusiveRight\": true}) correcly hides the first line. Thanks!\n. Thanks for starting this, but I'm not sure if the everyone will like it this way. VIM's default behavior is to enter insert mode with a warning. It might be better to make CodeMirror's VIM mode more configurable.\n. No I'm totally fine with this :) Hopefully it will get merged soon. Thanks!\n. Does this look better? Or should we still provide a setBypassed() method?\n. Whoops, sorry about that. Thanks!\n. @mightyguava Ideally this should be extended to take care of all hidden spans, not just whole lines. But I haven't thought much about how VIM mode should behave in that case.\n. The current use case is Gerrit Code Review (used by Android, Chromium, etc.). An example can be found at https://gerrit-review.googlesource.com/#/c/48696/1/gerrit-gwtui/src/main/java/com/google/gerrit/client/diff/DiffTable.java,cm. The \"skipped common lines\" feature is implemented using CodeMirror's markText() function. VIM mode doesn't understand collapsed lines and the cursor will get stuck on the line above a skipped region. Our current workaround is to disable 'j' and 'k' in VIM's keymap and use moveV() instead, which isn't ideal at all.\n. It does seem more ideal to fix VIM instead. But I haven't dig around CodeMirror core enough to find an easy and clean fix. Besides VIM mode, CodeMirror core also ignores collapsed spans sometimes. For example, triple click on the line above a region of hidden lines. I'd like to explore a better way of handling collapsed regions.\nI would prefer VIM mode to just skip all collapsed regions, but it might be hard to do so.\n. Thanks. Yes I would also prefer not to have this addon and fix Vim mode instead. By the way I worked around #1668 in my use case. The triple click issue is not quite urgent, but I would like to find a fix also.\n. Thanks a lot for the suggestion. Remapping to 'gj' and 'gk' does make a lot of sense and I guess users will be totally fine with it. The only problem that's left in our use case is that Shift-N still gets stuck above a hidden region. The bias parameter also sounds reasonable.\n. Confirmed this fixes Vim mode's navigation problem. Thanks @marijnh and @mightyguava !\n. In most C-like languages variables cannot start with a digit. The current version correcly parses, say, 0x008088 as a number.\n. Thanks!\n. It sometimes comes back after scrolling out of view and scrolling back in.\n. With your test file, start typing on the second line and the line number \"2\" will disappear.\n. Thanks Marijn!\n. I have my own implementation of the \"activeline\" addon and I'm trying to use the \"beforeChange\" event. The cursor could move into a hidden line, in which case the line shouldn't be highlighted, but I don't think there's a way to detect that.\nIs lineIsHidden() expensive?\n. You mean getLineHandleVisualStart()? I'll try it. Thanks!\n. Actually I've been using getLineHandleVisualStart(). The issue is that, as @mightyguava said in https://github.com/marijnh/CodeMirror/pull/1743#issuecomment-23599405, \"'j' will move the cursor to the right of the fold, and then move to the next line.\". The workaround in my use case is to map \"j\" and \"Down\" to \"gj\", \"k\" and \"Up\" to \"gk\".\n. In my use case most assembly is armv6 so defaulting to x86 won't help much. It might be better if we rewrite this mode and let it determine the architecture automatically. I feel that it shouldn't be too hard for x86 at least?\n. @silverwind Thanks, I created #3400\n. I think what happened was that I deleted the \"vhdl\" branch from my fork, branched from master another one with the same name, but apparently Github closed the PR for me :(\n. This should be closed in favor of https://github.com/codemirror/CodeMirror/pull/3911, which has been integrated.\n. It defaults to \"file://\" when testing locally on Chrome.\n. @davido I trust in @marijnh. He knows what's going on and can hopefully fix it :)\n. Thanks @marijnh !\n. @marijnh It turned out that your patch didn't fix the TypeError in our project. I've filed another pull request that fixed the problem for us. #3855.\n. I'm running Chrome 51 on Linux. Also happening on Firefox 45 on Linux. Try scrolling down then scrolling right on the right pane.\nScreenshot of how it looks like:\n\n. I suspect https://github.com/codemirror/CodeMirror/commit/ecaa8914751ad5472f315bce5f0c49c232aa5c26 caused this.\n. @RandomlyKnighted https://github.com/VapidWorx/powershell-cm-mode\n. @ashmind Can you squash the commits? Thanks.\n. @ashmind Maybe squash into three / four commits?\n. @marijnh I don't think the alternative patch is correct. See https://github.com/codemirror/CodeMirror/commit/8ba727a0310b2e87d6a2c310580d368b1e3cc791#diff-502b01b98b1553a622969a4b62a90a3eR328\nIf you check the original ret() method, you can see that these lines were supposed to return known.style and null respectively, not word. I guess you overlooked this when you did the refactoring :).\nPlease see #3919 for a new fix.\n. Ok fine, I think the section should be http://www.ecma-international.org/ecma-262/5.1/#sec-7.8.4 and the production for multi-line strings is LineContinuation. Seems like the style guide needs to be corrected.\n. This cleanup looks much better. Thanks!\n. Can you squash the commits into one? Thanks!\n. This does not look like a patch.\n. @marijnh Yeah that's confusing and does seem like a bug in NPM. I would expect npm publish to include everything in the tarball generated by npm pack. A workaround is to use npm pack, verify everything is in there and and publish that tarball instead, not ideal though.\n. @marijnh Thanks. However, now package.json says \"5.13.3\" while NPM says \"5.13.4\". I guess we should fix this discrepancy by putting \"5.13.5\" in package.json and publish that?\n. Thanks :+1: \n. Can you do an npm publish? It still says 5.13.4 on NPM.\n. Oh the \"version\" in 5.13.4's package.json does say \"5.13.4\", so it's correct. Thanks.\n. @marijnh Our project (Gerrit) displays the metadata, eg.: https://gerrit-review.googlesource.com/#/c/75967/9//COMMIT_MSG\n. @marijnh Well technically this is similar to the newly added mbox mode. Although rarely edited, the metadata is useful for viewing.\n. @marijnh That sounds good to me. The migration could be part of Version 6.\n. We can start with some documentation to encourage people to do so, with a recommended format / example package.\n. \"gg\" is also a multi-stroke binding so technically it should not be overridden. While I haven't looked at the implementation details, I think this is how it should work:\n1. When codemirror.js receives the first \"g\", since it's part of a multi-stroke binding, vim.js should also be notified of this event.\n2. When codemirror.js receives the second \"g\", If it finds a multi-stroke keymap for it, then handle it. Otherwise, vim.js should be notified of the second \"g\" and handle it.\nDoes that sound reasonable?\n. Note that Promises would need to be polyfilled for browsers like IE <= 11.\n. Once this is merged, can we have a 5.14.1 release? Thanks!\n. I think I've hit something like this before, and had to force inputStyle to \"textArea\" on mobile browsers: https://github.com/GerritCodeReview/gerrit/commit/44679ef551cbedbba48f3724059652211cacaaa8.\n. Not sure if you\u2019ve hit https://github.com/npm/npm/issues/5082.\n. Anecdotal comment seems to suggest that adding an explicit files section in package.json helped: \nhttps://github.com/lifegadget/ui-responsive/commit/38c8c267045d15a699626bb7922a55c30f420a19 but then it started happening again. :(\nA workaround might be to do a npm pack before the npm publish and make sure everything is in the tarball.\n. Thanks!\n. This needs an additional newline afterwards.\n. ",
    "ezs": "Yes, I'd like to be able to control three more events, \"click\", \"mousedown\", and \"mouseup\" (although the name onKeyEvent might need to be changed to something more neutral). \nBut with the onKeyEvent API, how would I know what text in the editor I clicked on? In my case, I want to know the CSS class of the text I clicked on - i.e., if the element contains the CSS class that I use to identify hyperlinks, I could get access the text of the hyperlink and set the browser's location.href to point to that page. Otherwise the element does not contain the class I use to identify hyperlinks, I let the event pass on to CodeMirror to handle if warranted (e.g., for text selection).\n. Thanks for the prompt response!\n. ",
    "azarubin": "Is it okay if I add it as an add-on then?\n. ",
    "shrimpwagon": "Thanks so much. I tried looking for it and that is the first time I saw an answer.\n. 'keydown' and 'keyup' is not working either. Is my code correct?\n. AAHH... 3.13, sorry.\n. Totally works, I think I downloaded 3.13 a day before your new 3.14 release. Thanks so much!\n. htmlmixed doesn't work.\n```\n <!doctype html>\n\n\n\n\nvar editor = CodeMirror.fromTextArea(document.getElementById('page-content'), {\n    mode: \"htmlmixed\",\n    lineNumbers: true\n});\n```\n. This is the issue:\nhttp://stackoverflow.com/questions/17622750/codemirror-html-mode-not-working\nThe basic usage examples on your site are not working at all becuase of this.\n. No, but wait...\nI was talking about the basic example. The one on the codemirror website. It says to use text/html without even including a mode js file. THAT I couldn't get working for the life of me. The first codemirror example doesn't show to use xml. You know what I mean?\n. Thank you.\nSorry for the rude subject. Thanks for all the time you have put in.\nIt works now but it's not colorizing for some reason. I'm just doing the basic usage example from the home page. I went through the code lines and there isn't any other CSS being applied other than Codemirror.\n. I appreciate the help.\nI totally did look through the docs. So I tried htmlmixed mode and I keep getting this in FireBug console:\nTypeError: htmlMode.startState is not a function\nhttp://www.saferack.local/libs/codemirror/4.7/mode/htmlmixed/htmlmixed.js\nLine 89\n. Yes! Thank you, right. After poking around the example index.html files in the mode folder I did finally figure it out.\nSorry, I think the expectations is a little off. Hear me out. On your home page, one would think, that that is all you need to color code the HTML and Javascript. But really that example just gives you the basic editor without coloring.\nI would guess, now this is a guess, that a lot of folks come to Codemirror to be able to not only edit but colorize the HTML. Which includes CSS and Javascript most of the time. However the home page example does not truly reflect the proper setup.\nI ultimately had to do this:\n```\n\n\n\n\n\nvar editor = CodeMirror.fromTextArea(document.getElementById('page-content'), {\n    lineNumbers: true,\n    mode: {\n        name: \"htmlmixed\"\n    }\n});\n```\nNone of this is clear in any of the online examples or documentation I could find. Maybe YOU as the core developer understood this but as a first time implementer of Codemirror this is not apparent.\nAlso, I had to realize that the first parameter is the textarea DOM object.\nI know you want to keep things simple. Especially for the home page. But your example compared to what is actually needed is a bit confusing.\nJust some thoughts.\nThanks so much!\n. ",
    "sathyamoorthi": "I was pretty sure that you can't accept this pull request as it is now, as i stated  earlier. So you have to change these codes to CodeMirror standard. Below are my problems and code changes to solve them.\n_CodeMirror.findMatchingTag_ gives only one tag's (open / close) position. To find other tag's start and end position i have to replicate toTagStart, toTagEnd in my extension. So i added the following.\n\nIn the below case,\n\nbased on my cursor location, i will expect tag highlight on <p> and </p>. But, \n_CodeMirror.findMatchingTag is returning </span>'s start and end location. In this case, i should run _CodeMirror.findEnclosingTag. But there is no clue, when should i call findEnclosingTag. So i added the following.\n\n. but the check at 30th line will improve performance a lot. without that check it will mostly scan the document while user scrolls. \n. Whatever you have now is perfect. I am just trying to avoid unwanted scans.\nLet me try to explain this better on our\ndiscussionhttps://groups.google.com/forum/#!topic/codemirror/ngS7c1aBbJg\n.\n. sure. thanks for the patch.\n. If it is not a real tag hit, we don't need to loop through all the times.\n. You added this condition to improve performance in non HTML mode. So change of this line won't affect any core functionality. \n. ",
    "Slava": "Hi guys,\nany chance on improving the vim bindings integration? For example ci\" or gqq?\n. ",
    "Profpatsch": "Since a quite major IDE (Light Table) uses Codemirror as its editor backend now, I guess the demand for proper modes has risen quite a bit.\nhttps://github.com/LightTable/Vim/issues/12#issuecomment-32341972\n. ",
    "yoshuawuyts": "Nice!\n. ",
    "ayush-jayaswal": "Can you provide me the code for that. it would be of great help.\n. Ok thankx for your concern..\n. ",
    "raphj": "One more detail : the infinite loop seems to be triggered not only for the first character, but for the first character of any line. \n. The fix seems to work here. Thanks !\n. ",
    "lmh2072005": "Infinite loop in measureChar again\nwhen I dblclick  the beginning of a line which has content  ,this Trigger  the Infinite loop in measureChar.\n. ",
    "DamonOehlman": "I can see the problem is fixed in master, which is great :)   Just wondering when a new release will be pushed to npm?\nWhile not a massive issue atm, as I'm referencing the git repo directly I'm keen to replace that with a released version again soon...\n. Great - I'm fine running from github at the moment so all good :)\n. ",
    "emjoseph": "Thanks - that worked.\nSorry for posting it here.\n. ",
    "mrmachine": "Right you are. The second and subsequent editors were inside a div that had display: none specified in CSS, which was later set to display: block with JS. I tried calling refresh(), but I called it on the wrong element, because I wasn't assigning the editor to a variable that I could access again later. Sorry!\n. ",
    "nalanj": "I'm able to reproduce this on Chrome 28 on Mac, if anyone needs help troubleshooting.\n. ",
    "mikemorris": "Confirming that this has been fixed as of Chrome stable 28.0.1500.95\nhttps://code.google.com/p/chromium/issues/detail?id=246127\n. ",
    "malayhm": "Chrome 29 is released today and the issued is fixed from chrome side.\n. Chrome 29 is released today and the issued is fixed from chrome side.\nhttps://code.google.com/p/chromium/issues/detail?id=246127\nNot sure about Safari...\n. Chrome 29 is released today and the issued is fixed from chrome side.\nhttps://code.google.com/p/chromium/issues/detail?id=246127\n. Tried with suggested fix, but its still failing (same behavior after second .)\n. That worked like a charm :)\nThanks :)\n. SQL is the problem.\n. @nisargjhaveri : steps to reproduce:\n1. In sql hint type \"select * from table \"\n2. Make sure you add a space after table (cursor has one space before)\n3. Hit ctrl + space to show list of hint keywords\n4. Select SELECT (or any keyword) from the list\nWhen keyboard is added, space between table and cursor is removed, hence cm value is:\n\"select * from tableSELECT\"\n. ",
    "androidadvocate": "Hi this issue is still happening and it's now 2015.\n. ",
    "samueleaton": "Triggering a resize event whenever I wanted the cursor to go to the correct position worked for me:  window.dispatchEvent(new Event('resize'));\n. This is happening again for GFM\n. ",
    "danielo515": "I'm still suffering this issue.\nI have tried with refresh and triggering a resize event and nothing works.\nAny other solution?\n. I'm using it along with other libraries. Should I include them in the demo as well ?\n. Hello @marijnh \nLet me know if this is too complex\nhttp://tiddlywiki.com/plugins/tiddlywiki/codemirror/index.html\n- On the lorem ipsum \"window\" click on show preview\n- Click on the arrob at the very top right:\n  \n- Put the cursor at the end of line one, and move it.\nRegards\n. Hello @marijnh,\nI'm not sure of the refresh() on that particular example, but I'm sure that in the other place where I'm using code-mirror I am triggering the refresh.\nLet me build an example and I'll post it here.\n. Ello @marijnh ,\nWhat do you mean with regular CodeMirror Instance ? I have tried on several examples of codemirror web page and it happens in all of them. With how many rows have you tried? I'm talking about very large ammounts. In my example I'm using 227k rows.\n. I think sometimes an image is better than thousand words. Take a look at this screenshot, it's from codemirror.net\n\nCan you see how the scroll bar goes crazy and there are a lot of unnecessary space at the right?\nAll that I have done is to paste a very long text. If  you see that text on notepad++ you can see there there are no werid characters:\n\nNote that I have show blank characters activated. I checked the text and all the lines have more or less the same length, not exactly the same.\n. I leaved an example text file here, so you can test your own:\nhttps://www.dropbox.com/s/xef136zgwrjdavi/codemirrorBreak.txt?dl=0\nRegards\n. Thank you @marijnh  for your patience. What I expect is the editor to do not increase its width. In the following screenshot you can see that all the editors are the same width. The first one has 200k numbers, the second one, which was on the same size than the others, holds the example file I posted here, and the other two are just empty at their original size. What I want, is the second editor to be wide enough to just hold its wider line. Here is the screenshot:\n\nHope it is clear now.\n. Hello @vincentwoo , \nCan you see the latest screenshot I posted? Do you see the second codemirror editor? It is far wider than the others, it's like 90% of the screen. But as you can see the text it contains is not as long. The other editors are just wide enough to hold it's contents. All of them have the same configuration. What I expect is the second editor be as wide as the first one.\n. That's a lot of shame on me. I checked the whole dataset several times. I even activated the mini map and I checked it from the beginning to the bottom several times. The only thing I did not do was to run a regular expression. I think the dataset was so big that it was not properly rendered. Thank you very much and sorry everyone for wasting your time. \n. ",
    "gonzalezi2": "I think this might be a related example but I am getting the cursor jumping as well.\nChrome  49.0.2623.112 m\nHere's a video of it in action. \nhttps://www.youtube.com/watch?v=6VLSZdoeSQ0\n. ",
    "peterrobinson": "I am still having what seems a related problem in 2017. You can see this at http://www.textualcommunities.org/app/community/?id=57598982b952f25827bd401c&route=view\n(Press the 'view' button to see the text and input at lower right)\nType fast anywhere in the text input window at lower right and the cursor leaps to the start of the text and goes on from there. Why? I have linewrap on -- turning it off does not help\nI am using Chrome Version 56.0.2924.87 (64-bit) on a Macbook pro with Sierra 10.12. ",
    "fourplusone": "doesnt work yet :(\n. ",
    "rosmanov": "I made another version with multiplexing:\nhttps://github.com/rosmanov/CodeMirror/tree/smartymixed/mode/smartymixed\nSome hacking still has place, however.\nIn the pull request I fix an issue of the Smarty mode itself, where everything within {literal} ... {/literal}\nis parsed just as normal Smarty code. The parsers should return null there.\nBut I can't do the same in the second version for now :-/\n. > Why not? Is the old code so messy?\nI'll try to fix it ASAP :) What about the new code? Is it good enough?\n. > Actually, the code still seems to duplicate a lot of the things that htmlmixed already handles. It could probably be >really small if it were built on top of both htmlmixed and the plain smarty mode.\nWell, here is the next HTML mixed + Smarty version:\nhttps://github.com/rosmanov/CodeMirror/blob/smartymixed/mode/smartymixed/smartymixed.js\n. @marijnh, @brandonwamboldt Definitely, this breaks some features, e.g. the following fill not be highlighted:\nThis is a {$var}.\n- {$entry@key}\n. @marijnh have to think. Don't know right now.\n. @brandonwamboldt, @marijnh looks good now! I think we can skip Smarty in attributes. My vim scheme doesn't support Smarty within attributes, too. I doubt even a popular editor does.\n@brandonwamboldt please update the mode/smartymixed/index.html file so we can see the bugs fixed.\n. @znap026, I think something has changed in recent versions of codemirror. Please submit a new issue. We'll try to fix it.\n. @marijnh I just followed Github's instructions https://help.github.com/articles/syncing-a-fork/\n. ",
    "jchook": "IMO this change should have generalized adding arbitrary attributes to the markText span, including dataset.\n. I worked around this by setting title to something like 'HAX' and then finding the span via jQuery with $('span[title=\"HAX\"]'). Seems like a missing feature although perhaps it's intentional to avoid add-ons that rely on manual DOM manipulation.\n. ",
    "twiss": "Thanks, that's good to hear! I'll do those things.\n. Not really, I changed it. The copying still happens though, because I don't want to merge the selections while selecting.\nI'll let you know.\n. Marijn, what do you think about the selection drawing stuff? (7c1f088, 8c9d277 and 76b15f2) It does make it very clear what you've selected and it looks a bit more polished too, but the code is a real mess, and I'm not even sure I like how it looks, so maybe I should just drop it.\n. @slang800 Glad you like it!\n. Thanks for the feedback. I'm on a holiday as well, I'll reply when I'm back.\n. > The implications for the public API are actually not as severe as I expected. On the whole, I think your extensions of the API are quite uncontroversial.\nThat's good to hear, I hope the same goes for 0fc33fb. Another idea would be to be able to replace command names like \"goCharRight\" with \"each.goCharRight\" everywhere, which eliminates the need for every addon to be updated, and is cleaner too, but not, I think, flexible enough on its own.\n\nOne thing I'm not clear about yet is whether we want to preserve 'handles' to selections (allowing querying and updating of a specific selection range through the API),\n\nI'm not sure when someone would need that, but we could pass the selection index to the function in eachSelection() to make things like that easier to do.\n\nand how the primary selection should be determined. It seems that it is currently always the last one that was made. Was that a conscious choice or a random effect of how the code works?\n\nMy idea was to not have a primary selection at all, so doc.sel is now purely the current selection inside eachSelection(). The code, in eachSelection and elsewhere, that tries to keep doc.sel consistent is only there because some code seems to depend on that, but I didn't investigate yet. doc.unmergedSel is also part of that. However, because of that, the code to have and maintain a primary selection is already mostly there and now that I'm thinking more about it it seems like a good idea to give editors the option.\n\nTangentially, should doc.sel remain a thing, or would it be cleaner to always have code that accesses a selection be explicit about which one it wants to touch?\n\nWell, that would be cleaner for the functions that don't do anything sensible (yet?) outside eachSelection() (e.g. setSelection, extendSelection, getSelection), but that's not all of them. Maybe it would be easier to just throw if those functions are called outside eachSelection?\n. > How about this:\nYes, that's fine too. See 46f44b8 and 800ff17.\n\nWhat is postponeEndOperation?\n\nWithout it, when an addon handles a character and selectively returns CodeMirror.Pass to eachSelection, some of the changes to the document are made immediately (by the addon) and some later, inside readInput, which is strange visually and breaks undo. postponeEndOperation puts all changes in one operation. I agree it's scary, but I don't see a very clean solution except removing this functionality or making all the changes immediately, e.g. by parsing the onKeyPress event (I'm not sure that's possible, though). Perhaps it could be made more robust, though, by testing some edge cases (e.g. the handler throws, or readInput returns false for some reason).\n. Well, that's a possibility but it wouldn't change much by itself since the operation should end after the timeout in fastPoll(), right?\n. > Could you write a bit more (possibly as a comment in the code) on how selecting and merging of selections is supposed to work? How does doc.unmergedSelections relate to doc.selections? What does doc.unmergedSel do?\nWe want to merge selections while still selecting to be able to draw them correctly, e.g. when you add a selection around a cursor, that cursor should disappear. (Also so that in the edge case that some text is typed while selecting something reasonable happens.)\nHowever, when you move your mouse back to where you started, the merging should be undone. That's doc.unmergedSelections for, to be able to do that. doc.unmergedSel is the index of the primary selection in doc.unmergedSelections. We want to know that because that selection doesn't necessarily exist separately in doc.selections.\n\nWhat exactly are the various ways in which multiple selections can occur?\n\nWell, you can ctrl-click, ctrl-drag or call addSelection to add one selection, and (ctrl-)alt-drag or (but not on linux) (ctrl-)middle-drag to add a \"block\" selection, i.e. either selections around all text in the selected area, or a vertical line of cursors. In the current version of mergeSelections, selections can't touch, except if they both have text in them.\n\nWhy does merging the selections only have to look at adjacent ones?\n\nAssuming the selections array is always sorted, all pairs or triples of selections that need to be merged will be \"in a row\", which is what mergeSelections looks for.\n. Sure! Should I open a new pull request or should I rebase this branch to be the same as yours? Sorry, I'm not very familiar with git. In the matchtags addon, do you still want the jump-to-matching-tag command to work for all selections? It seems bad to just throw selections away.\n. Alright, go ahead :)\n. > Will continue thinking about this, but as it stands I'm not sure how to proceed. A big problem is that you'll often want to somehow first compute a changeset from the set of selections, and then apply that atomically. This makes for much more awkward code, for example for indentSelection or killLine and various addons. But iterating over the selections and making changes will change the selections from underneath you, and cause hard-to-reason-about and unlikely-to-be-correct code.\nWell, what about this: commands are passed (cm, selections), and addons are responsible for iterating over the selections themselves? That's more flexible than what we have now and also more explicit.\n. Fixed in 655e902.\n. Moved to #1734.\n. Fixed in 962a969.\n. Yes, except that it didn't contain secondary cursors (I tried to continue to do the same thing). Removed in 962a969.\n. I made this change against an older version of CodeMirror, so I'm not even sure if it still does anything. Reverted in e2e0122.\n. I wanted a consistent behaviour that didn't depend on a primary selection, and it seemed like a good idea to be able to take a look at all selections, so now it scrolls to the first selection when movingUp, the last otherwise. I agree it's bad, do you have a better idea?\n. Added in 3616489.\n. No reason, fixed in 7254213.\n. Fixed in 1993a05, if there's more I've missed please let me know.\n. Fixed in 44f6291.\n. ",
    "adrocknaphobia": "@ibdknox We're working with @marijnh to get this work completed in November.\n. ",
    "JoostvanPinxten": "Yes, you are right; this is most probably the same issue. You may disregard this bug report.\n. ",
    "mihailik": "Fair enough.\nWill you be able to point me in a direction where I can learn about the way\nJS parsing works in CodeMirror please? There's not much comments in the\ncode, so it's hard to figure say the meaning of cont, pass and others from\nthe  usage.\nMany thanks\nOleg.\nOn 9 Jul 2013 09:43, \"Marijn Haverbeke\" notifications@github.com wrote:\n\nI'm not really willing to go down this route -- adding random hacks here\nand there to fix ad-hoc problems as they come up. I tried to do the obvious\nthing, extending maybeType to also ignore question marks, but it turns\nout that the parameter lists in class methods aren't even recognized as\nfunction definitions in the current Typescript mode.\nIf you want to add proper statement rules for the various Typescript\nconstructs like class and interface, so that the mode actually has a\nstrategy for parsing them rather than relying on the fact that parsing them\nas JavaScript doesn't go completely wrong, that'd be welcome.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1661#issuecomment-20660674\n.\n. Just wanted to point out, this patch is not about touch experience.\n\nIt is about fixing mouse experience. By mouse here I do mean mouse: a little oblong box found normally next to the keyboard.\nTouch I quite agree is a separate big deal. But when you do have that mouse, you want it to act like a mouse.\n. It's basically the opposite problem: mouse is interpreted as touch. You try to select (with physical mouse connected to a tablet) and it pans/scrolls the content.\nMy take here is to listen to touch events and detect mouse by the size of the touch area, i.e. 1x1pixel or less. As you notice mouse-diguised-as-touch dragging, you e_preventDefault, then adjust selection.\n. No proper docs, a part of this summary covers the state:\nhttp://patrickhlauke.github.io/touch/tests/results/#mobile-tablet-keyboard-mouse-events\nIn my tests, on Android 4.* all browsers treat mouse as touch. No drag-to-select, doubleclick zooms, no right-click menu. Windows/desktop is obviously saner. iOS doesn't support mouse.\nThis change doesn't save the world, merely goes 90% towards the goal \u2014 selection basically works. Still missing: over-dragging to scroll, drag-drop of selected text, right-click menu.\n. I'm not quite sure actually.\nI did try to forward touch events through the mouse handling code path, and it complicates things a bit. Starting from the fact that e.clientX becomes e.touches[0].clientX, but also these ad-hoc subscriptions at the end of leftButtonelect need to be updated to subscribe to touch* events too for example:\nhttps://github.com/codemirror/CodeMirror/blob/master/lib/codemirror.js#L2922\nJust handling touch separately is definitely less mess right now. With your work in it may well be opposite.\n. Well, you still want to preventDefault on touchmove, to avoid pan/drag. Not that I like duplication.\nWhat's the driver behind your touch changes? Maybe if I understand it, I can go away, think and have an idea how tablet+mouse could fit into it.\n. Mousedown doesn't even get fired on pan/drag. But preventDefault on touchstart does actually prevent dragging \u2014 I'll try to play with it a bit more.\n. Somebody's already done it, including the bonus dialog:\nhttp://djadmin.github.io/\nSpecifically the addon code:\nhttps://github.com/djadmin/djadmin.github.io/blob/master/addon/search/goto-line.js\nLooks worthy, should it be added to the CM addon tree?\n. OK, shall I implement it close to what @marijnh suggested, separate from @djadmin 's take?\n- Use Alt-G as a shortcut\n- Parse single number: line\n- Parse colon-separated: line:character or relative to the current line :character\n- Parse plus-minus offsets relative to the current position: +line, -line\n- Parse percentages: 30% - those take in account line counts, not character size\nHow does that sound?\n. The URLs above point to mobile branch at the commit \"Don't immediately focus on click in IE\", a tip of mobile banch as of today.\nCan point them to your local repo.\n. Looks like the crucial piece involved in this bug is at line 1290, in TextareaInput.reset function:\n} else if (!typing) {\n    this.prevInput = this.textarea.value = \"\";\n    if (ie && ie_version >= 9) this.hasSelection = null;\n  }\nNot sure what !typing check is for here. But changing textarea.value from its current content to the empty string is picked up by the copyObj.poll (see line 1344) as a sign of deletion.\n. TypeScript CodeMirror? That would be so cool!\nBesides, there seems to be another pasting bug still hiding, where newlines are converted to spaces on Android's Chrome Mobile. Hoping to catch it soon.\n. The 'mouseout' event bubbles up (see MDN below), so your handler for that event will fire even if you move your mouse from one tooltip child to another. The MDN article suggests using 'mouseleave' instead.\nhttps://developer.mozilla.org/en-US/docs/Web/Events/mouseout\nIt also could be sensible to remove the tooltip on editor losing focus and editor scrolling.\n. Sorry, scratch that. CodeMirror.contains takes care of the mouseout for child elements. I'll add a separate pull req. for losing focus and scrolling.\n. Got it!\nI used contenteditable=true in my investigations, and that works OK. Apparently, CodeMirror uses contenteditable=plaintext-only. That's the one that breaks.\nPasting inside PRE, when parent DIV is contenteditable=plaintext-only results in newlines replaced with spaces. At least in Chrome Mobile on Android, will check others later.\nNow the question is how to work around it. I wonder whether replacing PRE with particularly styled DIVs is necessary.\n. Sample with contenteditable=plaintext-only in JSBin:\nhttp://jsbin.com/zofabobaqo/1/edit?html,output\nCopy from textarea (blue) and paste into DIV (AA), PRE (BBBB) or SPAN (CC). It works fine everywhere except for PRE.\n. Well, one fix would be to avoid contentEditable='plaintext-only' and go for contentEditable='true' (line 1484).\nIt appears that the key difference between 'true' and 'plaintext-only' is in the way that alien input is treated, and it's not treated in a good way after all in browsers that do support 'plaintext-only' (although I didn't try it on Safari yet, it could be Blink's quirk).\n. The multiline/squash bug is fixed!\nThere is definitely still something wrong during pasting.\nOften it would insert an exta newline in front of the pasted text. It looks like the logic calculating the beginning node of the pasted text gets confused. Perhaps that should be a separate issue? I'll collect more info and try to ping down a clear reproduction case.\n. Thanks a lot @marijnh.\nThough I do not think lineSeparator would add value. It certainly does not help the use case I have.\nMy suggestion is to revert this change and leave it as is for now. It complicates code without solving any practical problem.\nThe use case I have is that user edits a file from external source, and upon save the only changes are those the user made.\nI totally see it is not a trivial one to implement, so don't disagree with letting it rest until better opportunity (or until a friendly fork). But let's help that future work by not muddling the code with options almost nobody uses.\n. No worries for not reverting, that's why I said 'suggestion' :)\nBut sorry, I might be missing the point. All the original line endings are removed from the document. How exactly do you intend to preserve mixed line endings with an extra parameter?\n. Is it really how it should work? This approach produces visual garbage like red dots, may still break addins, and it even glues lines together (try \"foo\\nbar\\rbaz\").\nWhereas keeping precise account of actual line terminators handles any of those cases and more. Say, you'd be able to implement stricter Unicode conformance, as there are actually more than 3 line terminators in the standard.\nAlso those compilers that pay attention to EOLs commonly have unit tests for handling the relevant combinations. It would be nice for CodeMirror to be able to open such unit test input files without going weird :)\n. The build in Travis stailled, no idea why.\nIt did produce 3 small warnings, which I've fixed now.\n. It is indeed a significant change, but handling EOL correctly is vital in many scenarios.\nImagine you open a big file and change one line -- you don't want the whole file suddenly be reformatted with tabs replaced with spaces, CRLFs with LFs and so on. Imagine how difficult it would be to read this very pull request, if my editor decided to swap one whitespace convention for another :)\nThat said, I don't understand what you mean by filtering. Would you elaborate please?\n. I don't see what you're saying at all, I'm sorry. Existing users already using LF convention would have their LFs exactly the same way. The whole point is to preserve the EOLs as is, whatever they are.\nLiking your suggestion on 'userland' solution a lot, but sadly neither Bill Gates nor Linus Torvalds seem to be over-excited on the idea. Unless you manage to convince them, let's assume the input files may come with arbitrary convention.\n. :+1: \n. Longtouch works fine for me on:\n- current Chrome mobile (46.0.2490.76, on KitKat) and\n- on current FireFox mobile (42.0, KitKat).\nBut fails just the same way as for you on:\n- Android Browser (KitKat), which reports itself as Chrome/33.0.0.0\nAlso check out inputStyle flag. Note that there are several sub-implementations for 'contenteditable' handling quirks in different browsers.\nAlso see #3653 Arrow keys hide keyboard - Chrome mobile 46 and #3654 Newline/editing bugs in Android Browser #3655 Colouring not picking changes until non-word characters - some mobile browsers\n. Mozilla/5.0 (Linux; Android 4.4.4; UMI eMAX Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/33.0.0.0 Mobile Safari/537.36\n. Reasonable, thank you!\nMight be worth mentioning in the manual, also clarifying if CodeMirror merely backs off highlighting during composition, or if it doesn't fire 'change' events either.\n. Reasonable too.\nA bigger problem is completions/hints (which some IDEs pop up intelligently listening to the 'changes').\nTyping this var div = document.crea| will sure have keyboard app suggestions like create created creator, but not context-aware IDE suggestions like createElement createTextNode. And on desktop it indeed works like that.\nPerhaps for code composition is harmful anyway. Typing foreach you get For each instead and such other.\nCan you please add a switch to ignore composition concerns, making mobile more aligned with desktop? Naturally off by default, but for code editors it would be brilliant!\nAgain, thanks for giving it a thought.\n. What I meant is that with that option enabled, don't do this:\n\nso CodeMirror has to leave the input field alone until the composition ends\n\nPolling seems to work, if other events are being suspended by browser during composition, I checked with JSBin\n. Yes, and in case of ode editor/IDE that is a desirable tradeoff.\nPerhaps I should experiment with implementing that and come with results before going any further. Thanks a lot!\n. How about introducing wordTokens option in addition to simpler wordChars? That way mode-specific findWordAt is not needed.\nThe existing findWordAt would be modified to consider tokens instead of characters.\nThe win is that no alternative parsing logic needs to be written, it all relies on the tokenisation that is proven to work.\n. XML tags use case would work as expected with my suggestion. As in pressing Ctr-Left in this case:\n<in|put ->\n  |<input weird\n  <|input expected\nPerhaps I should try implementing it, there might be bigger obstacles on that way.\n. See also discussion in #3655 [mobile] Colouring not picking changes until non-word characters\n. I've created a gist with a CodeMirror using this option and HTML mode:\nGist hosted with githack\nGist itself\nURL shortener to quickly type on mobile:\nhttp://tinyurl.com/updateWhenComposing\n. IME is an expected downside, insignificant in the target use case: mobile code editing.\nI am not aware of any accessibility issues. Both reading and writing should work just the same.\n. To put it into context, currently code editing on mobile with CodeMirror is a major pain. Because of autocorrection, lack of completion and #3653 (troubles with arrow keys).\nComparing to that, troubles with occasional ideographic in string literals/comments is very minor.\nBut you've mentioned composition refactoring you're planning. Would that bring back 'change' events during composition? Would you elaborate please?\nMany thanks!\n. Sure, if a better solution is in the works let's close this one.\n. Only a bit: I am keeping this option in my forked code, so it's fine in my app :-)\nOr shall I try to implement that other solution?\nI assume the crux of the plan is to tweak the line rendering. If composition is on (plus some extra checks), rendering will update existing elements in place, instead of recreating from scratch.\n. Thanks, I shall stab indeed :-)\n. This PR is the least fix for the biggest arrow-key problem \u2014 in case you prefer to be extra-conservative\n#3673 Fix mobile shift arrows perhaps would \nmake more sense. It uses collapse+addRange instead of removeAllRanges+addRange for most cases.\n. @dpursehouse @davido\nDoes this look OK?\n. Thanks a lot @marijnh ! I've spotted a couple of things:\n1. zero-based character offsets \u2014 this is the most important, as majority of editors and tools use one-based line/columns, so copy-pasting positions will be ever so slightly off\n2. remnants of search.js addon docs in the comment/header\n3. small consistency jinxes - use Pos and Number differently in different places\n4. semicolons \u2014 are you intentionally migrating to no-semicolon rule? it's a bit jarring when only a couple of lines skip them and others stick to old-style semicolon\nLook at #3683 Cleanup of the header, consistency tweaks for fixes to (2) and (3).\nI wasn't sure if (1) is intentional, so didn't fix it yet. But please consider it, as it might make CodeMirror feel buggy if it always lands you one-character off what you expect.\nSemicolons (4) are opinionated, so left it out too. If you agree to keep it consistent, I could put them back?\n. Ignoring mousemove for say 200ms after keydown/up would make it go away and also fix over-sensitive mouse problem.\n. Pull request #3812  Adding jumpCharBase (defaults to 0)\n. Is there a reproduction case?\nI tend to respect typography done by professionals, so it'll be great to know what is the downside.\n. Tried to reproduce, don't see any issues whatsoever (IE11, Chrome, FF - Windows):\nhttp://jsfiddle.net/5k94a6h2/1/\nIs it platform-specific?\n. Got a reproduction case. Indeed, the cursor movement jumps over the ligature, inserting a zero-width space after:\nhttp://jsfiddle.net/5k94a6h2/4/\nGiven that CodeMirror is used for much more than just editing code, would you consider a PR for a fix?\nIdeally the width of the ligature should be distributed among the individual characters proportionally to the widths of the characters measured standalone. Detection can be triggered by zero-width characters.\nProper zero-width characters unrelated to ligatures should remain zero-width (based on the fact they have zero width when standalone).\nAlternatively 'standalone' may be replaced with 'surrounded by spaces from both ends' to avoid being tripped by crazy Unicode.\n. Note Visual Studio supports ligatures in code editor no issue:\n\n\nHere first two fs are joined by a ligature, but there is no fff ligature so you can see a tiny space. However the cursor moves properly between all three of them.\n. Funny enough, author's name on the cover page is infotext on yellow as well ;-)\n\n. Wouldn't tooltip appear because of mouse move in the first place?\nMovement might continue for a few pixels after the tooltip shown, triggering the event immediately anyway.\n. Below setCursor doesn't use Pos, so it's more consistent to do the same here.\n. Also normally across the codebase semicolons are standard. Would it be reasonable to have the same style here?\n. To be consistent with your preference to Number instead of parse*** -- and to match the terseness of the surrounding code.\n. ",
    "rogerz": "This bug can also be reproduced on Safari 6.0.5 on MaxOSX 10.8.4\n. ",
    "parisk": "Great. Good to know about that. Thanks.\nParis\n2013/7/15 Brandon Frohs notifications@github.com\n\nHey @ParisK https://github.com/ParisK, just wanted to let you know that\non GitHub, you can reference issues by typing # followed by either the\nissue number (e.g. #1678) or you can select it from a dropdown list by\nbeginning to type the issue's title without spaces (e.g. type\nclickingcodemirror and click the corresponding issue).\nAnd just so it gets pulled into this discussion: #1678https://github.com/marijnh/CodeMirror/issues/1678\n.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/1679#issuecomment-20997307\n.\n. Cannot reproduce as well. Tried at http://codemirror.net, http://sourcelair.com and at the demo pages referenced by Marijn above.\n\nSystem info:\n    * OS X 10.8\n    * Chrome 29, Stable Channel\nSome other people complained about similar issues (e.g. CodeMirror freezing after clicking on a block-comment).\n. Did anyone had the time to check out the my last 3 commits? I think it would be great if the Pull Request got included into 4.8.\n(@marijnh)\n. It seems like the problem with the undefined acorn is that http://marijnhaverbeke.nl/acorn/acorn.js redirects to GitHub. Maybe we could move these assets to a CDN.\n. @dabbott great job seems to have been done on your PR! I see that it doesn't apply XML highlighting though on the XML expressions. Do you think that this is something that we could work out? I could try out contributing that on your PR.\n. Hi @dabbott I took a look at your first screenshot that does not highlight the tag names, but then found out that you are highlighting them as JavaScript entities after taking a better look at your second one.\nAfter I finish some final touches here, I could try giving some help with what's left.\n. :tada: really happy to see this implemented at all. I hope that our contributions helped you implement it faster and better.\n. Actually yes. As I mentioned in the description I am totally aware that this mode exists, but I took a different approach in this PR.\nThe YAML-frontmatter imposes the existence of front matter in the document, thus it does not highlight properly GFM documents without front matter data. This PR takes Markdown as the first-class citizen and offers YAML front matter meta data as an option to the document.\nIf you believe that this contribution conflicts with the existing YAML-frontmatter mode, I am willing to modify it in order to make it comply better with the code base.\n. @marijnh did you have any chance to take a look at my last comment (https://github.com/codemirror/CodeMirror/pull/3760#issuecomment-169832923)?\nI am really interested in listening to your opinion about the different approach taken here and how could we implement this functionality differently in order to make it fit the project's needs.\n. :+1: awesome. I wasn't sure about the proper course of action or if the current behavior was a bug or feature.\nThanks for fixing this @marijnh.\n. Cool, could you please check if https://github.com/sourcelair/CodeMirror/commit/72e3c92e37d107cb2d146a1e21311cc1cfd59a2d#diff-4b334edf14b1bb6080b9c2b2f1cf600aR22 works for you?\n. > What if a line comment starts immediately after a command word?\nThis is not valid syntax at the moment. All Dockerfile instructions should be followed by at least one argument, so no line comment can occur right after a Dockerfile instruction.\n\nCan directives span multiple lines?\n\nYes. Directives can span multiple lines and I mistakenly did not take this into account. Right now I am working on it.\n. Actually it's not. It is defaulting back to JavaScript and re-evaluates if it needs to switch to XML mode (https://github.com/codemirror/CodeMirror/pull/3742/files#diff-8fe55bb9634da263c3fa302cdbefb06cR42).\nI could track the dangling open tags and wait for them to close before switching back to JavaScript, but I am not sure if it is a good practice. HTML tags are valid JSX syntax (http://facebook.github.io/react/docs/jsx-in-depth.html#html-tags-vs.-react-components) and from my understanding closing tags is optional in HTML5. I could implement that but sounds like it will introduce a lot of overhead, especially in the state object.\n. You 're right I got this initially wrong because I was trying to be more tolerant over when a tag starts (the XML mode is as well).\nI took a look at the syntax of HTML tags (http://www.w3.org/TR/html-markup/syntax.html#syntax-start-tags) and added a stricter control. I am considering a valid \"tag open\" only when it matches the proper syntax of starting a \"Start tag\" (<tagname) or an \"End tag\" (</tagname) which allows no spaces in between <, / (if inside an \"End tag\") and the tag name, which should be a case insensitive alphanumeric.\nI think I improved that a little bit (still has some edge cases) with https://github.com/codemirror/CodeMirror/pull/3742/files#diff-8fe55bb9634da263c3fa302cdbefb06cR17.\n. It seems like the officially provided Babel syntax for Sublime does that as well (waits for tags to close before switching back to JavaScript syntax).\nCan you give me a hint on how can I get that info from the XML mode state?\n. Thanks. Just updated my mode to exit XML mode only when context is null after matching a tag closing token.\n. The edge cases should be even less right now. I made it stricter on when should it start considering a \"tag open\" according to the lastType detected by the JavaScript mode.\nReference: https://github.com/sourcelair/CodeMirror/commit/4f18f9c7474c490766bafa5e37d08bd85ba1d4e7#diff-8fe55bb9634da263c3fa302cdbefb06cR43\nAlso, it would be really helpful here if I could access also the following information:\n-  the exact token recognized in the lastType (e.g. if the lastType == \"operator\", knowing if it was = or - could help making highlighting even more semantic).\n- if there are any new lines between the last token recognized and the current one.\n. ",
    "vsevik": "updateScrollPos call is missing now, I think we still need it to restore scroll position that might have changed after editor parent element resizing.\n. I was working on implementing scrolling beyond last line, but now it seems to me that doing it inside the editor code is more appropriate. Could you please have a look on https://github.com/marijnh/CodeMirror/pull/1713 ?\nI need to update scroll positions there because otherwise they might be messed up on resize.\nIf only one line is shown on the screen and editor height is  increased while padding-bottom is not increased yet, then view and model scroll positions become unsynchronized.\n. Sure. The idea is that sometimes you want to scroll beyond the last line in order to make last lines of file appear on top of the screen, so that you don't need to look to the bottom.\nThis is especially useful when you add some code to the very end of file and you end up always looking at the bottom edge of the screen. This could be worked around by adding a hundred of new lines to the end of file, but having it as an editor feature seems more convenient.\nThis feature is implemented in many editors (vi, sublime, ace) and is requested a lot in the editors where it is not present (eclipse).\nYou can see a working implementation of such feature in this Ace Editor example: http://ace.c9.io/build/kitchen-sink.html - just scroll down as much as possible and you will see that only last line of the code is left on screen.\n. No, the space should always present (so that the scrollbar size is consistent), but the bottom margin height might change depending on the clientHeight of the viewport and last line height.\n. I am sorry for confusing you, I guess Ace Editor behavior is a bit different from what I am implementing here. I don't like how the scrollbar changes its size there.\n. Sublime and gvim match better.\n. The editor size in this example is 1029x300 by default.\nIf you add some text, scroll to the very end of file and then run editor.setSize(1029,400) increasing the editor height you will lose the scroll position.\nThat's exactly why I think we need to restore scroll position in setSize (or workaround it somehow).\n. The padding bottom itself is not updated on setSize actually\n. Friendly ping\n. Ok, I am implementing it as an ad-hoc solution then.\nFor the record - I still think this functionality is important enough: editors often open a search field/line in the bottom thus resizing the editor. When such a search field is closed it is essential that the text in editor is not moved, which is why scroll beyond last line and correcting scroll position on resize is needed.\n. Yes, it does.\nThank you!\n. ",
    "CodeAnimal": "OK great, I didn't realise. I'll take a look.\n. ",
    "misterbeegee": "Looks good to me. Thank you!\n. ",
    "mtaran-google": "Thanks for the suggestions! I don't program in JS much, so it hadn't occurred to me to use a property like that :)\n. This was on Ubuntu 12.04 LTS with the latest Chrome. I can also try FF on there and get back to you.\n. I got a chance to try this in Chrome on a friend's ubuntu 12.04 laptop and could still repro this problem. More detailed repro case:\n1. Go to http://codemirror.net\n2. Select a word in the CodeMirror instance\n3. Press and hold the middle mouse button somewhere else in the CodeMirror instance for a few seconds.\nIt should insert a '$' character at the point where you clicked. I tried debugging this, but when I ran it with some breakpoints in the Chrome debugger in the relevant places, it inserted the text correctly no matter how long I held the mouse button. But when I middle-click without the debugger I consistently get this '$' insertion happening when I hold the button down for more than around a few hundred milliseconds. And this isn't just me having trouble with this, people have been reporting this at Google for quite a while...\n. I installed virtualbox (apt:virtualbox-ose) and ran the latest ubuntu with Chrome 35 and was able to repro this. Would you mind trying that?\n. This is happening on Unity and Gnome. Anyways, I investigated some more and filed http://crbug.com/380465 (and http://crbug.com/380471 because the original webkit bug was supposed to have been fixed but clearly wasn't). Also looks like this was reported independently as #2384\n. Thanks, those work for me! I'd started off with an old version of the addon and wasn't clear on what the recent change had fixed. Anyways it's all good now.\n. I changed the hanging indent to default to the overall indent unit, but part of the point is that some people need these to be different. \n. Thanks for the info and the merge!\n. I think the default behavior might have changed in Emacs. On my Mac's built-in v22, what you describe happens. However, I downloaded v24 and it in fact deletes the whole selection when I press backspace. This is also described in the documentation: http://www.gnu.org/software/emacs/manual/html_node/emacs/Using-Region.html (second paragraph after the list).\nPeople keep complaining about it internally -- would you mind reconsidering the change?\n. Looking into it a little more, I believe part of the issue is that transient-mark-mode is enabled by default in more recent versions (http://www.emacswiki.org/emacs/TransientMarkMode), and it seems that that also turns on the selection-deleting behavior.\n. That works great, thank you!\n. Verified!\n. That patch fixes it! Thanks for the quick response :+1: \n. Yep, the functionality is correct. Thanks for the fix!\n. Yep, the functionality is correct. Thanks for the fix!\n. Sorry about that. I'll send it again.\n. Yes, it fixes this bug. I've discovered another issue and will send a PR for that too.\n. That is correct, the error came from some internal CodeMirror code. We spent a while trying to find the root cause, but were unsuccessful because there's a ton of stuff happening inside the functions endOperation calls. If you're interested in taking a look I can dig up some of the stacktraces and tell you between what versions the bug was introduced.\nThis was a pretty big deal for us because we listened for 'change' events to do autosave. We worked around it by listening to 'changes' instead, but the fragility of this section of code still seems like a significant issue. \n. I looked and remembered the reason it was so annoying. We have code that normally reports and aggregates stack traces from errors automatically, however for this issue we only got user complaints that autosave mysteriously stopped working and had to work backwards from that without any clear repro case. Switching to the 'changes' event made things work again.\nI was actually using some of the C++11 string errors as test cases (though they did produce traces) because they similarly stopped all 'change' events. The difference was that the user reports indicated that all the CodeMirror instances looked and worked fine, whereas if a C++11 string parsing error happened you would no longer be able to type and when you scrolled area around the error would disappear. Hence an error like that is easier to diagnose, but it's still unreasonable that it should have disastrous consequences like stopping 'change' events from all CodeMirrors. And because so much code (all the language modes, at the very least) can get from the code I enclosed in the try it's fairly likely that over time some of it will error out in new and exciting ways. \n. Excellent! Yes, that addresses my concerns and is much cleaner. Thanks :)\n. I agree, it's quite scary. Added some tests, including a commented one that doesn't pass (before or after this patch) but should.\n. Thanks, those should be fixed.\n. How about http://plnkr.co/edit/z87vMrRHpgusoqTyUQ4J?p=preview\n. Works great! Thanks :)\n. Unfortunately that doesn't seem to fix the infinite looping problem. I added a limit of 10 iterations to scrollPosIntoView() and that at least makes things work on my side. In normal operation I've only seen the loop run once or twice, so I don't think this affects any existing useful behaviors.\n. Okay, after way too long I found the problem was that we were setting overflow-x: auto on .CodeMirror-scroll for historical reasons. Removing this makes your margin calculation code do the right thing, so I think you should be good to go.\n. You're right, that works great with the patch! Thanks a lot for the quick response :)\n. That fixes it, thanks!\n. Yep, it seems to be sufficient to get good performance in the example I was using. Thanks!\n. This should solve our issue, thanks for the quick response! :)\n. I believe the original issue was that Chrome on Android would send the backspace key event but would not fill in the key code properly. It'd probably be easy to test it out when the next Android Chrome beta comes out, since I'm not sure if this will actually be an issue.\n. The other problems I've noticed:\n- in namespace re2 { re2 is highlighted\n- static method names in their declarations seem to be highlighted, but not the (more common) instance methods\n- some initializations of variables like of l on line 240 and fanout on 279 get highlighted incorrectly\n. No, I wasn't calling it like that. The repro case is still that you just have the text above in the editor and call editor.wrapRange(...) and it still goes into an infinite loop and causes the tab to get killed.\n. Github seems to hate html attachments, even when they're reamed with .txt. Here you go though:\n``` html\n<!doctype html>\nCodeMirror: Hard-wrapping Demo\n\n\n\n\n\n\n\n  .CodeMirror {border-top: 1px solid black; border-bottom: 1px solid black;}\n\n\nCodeMirror\n\nHome\nManual\nCode\n\n\nHard-wrapping\n\n\n\nHard-wrapping Demo\n\n\n    implemented using an Android [`TextureView`](http://developer.android.com/reference/android/view/TextureView.html).\n\n\nDemonstration of\nthe hardwrap addon.\nThe above editor has its change event hooked up to\nthe wrapParagraphsInRange method, so that the paragraphs\nare reflown as you are typing.\n\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n  mode: \"markdown\",\n  lineNumbers: true\n});\n\n\n```\nAfter opening this, run editor.wrapRange({line:1, ch:0}, {line:1, ch:null}, {column:80}) and it should hang.\n. We're running into this too (since we recently tried turning on contenteditable mode as default for users on desktop as well). Are there blocking issues with fixing it to work reasonably well with current vim mode?. So it's not possible to hide the underlying system cursor?. That would work for us! Would you mind wiring it in to the vim mode code?. Sounds good, thank you :). It still gets super slow if I have 200 lines of \"var foo = var foo = var foo = var foo = var foo\". Then if I again have my cursor in 'var' and hold ctrl+d, it goes at a constant speed till around line 50-60, and then quickly gets much slower and grinds to a halt around 90-100.\n. This is positioning in the HTML, as opposed to abstractly computing the locations at which selections should appear? Since CM draws only (roughly) the viewport-visible part of the code, whould it also be possible to limit selection-drawing to only those that intersect the viewport?\nThis may also be a relevant read.\n. How about adding another class like multiline-string (for the languages that support such a thing) and including that in the commenting heuristics?\n. That works well for our use cases, thank you :)\n. I played with a chromebook, and it looks like meta+click does get propagated to the JS, but even after you meta+click and drag, on keyup the OS functionality of opening a big search popup gets fired, and preventDefault doesn't help. \nBut, meta+shift+click does the trick, and since those buttons are physically next to each other (meta is where capslock is on other OSes), I think that would be a reasonable alternative.\n. Yep, that works great! Thanks :)\n. Yes, it does. Thanks!\n. smart backspace is a good idea overall -- why not just apply it to all cursors?\n. Shouldn't it then replay the ctrl+space that triggers the (synchronous) autocomplete, and so get the same result?\n. I repro this on Linux with a normal mouse, so I don't think momentum scrolling is involved. It doesn't repro for you with Linux + mouse?\n. Ah, I should have specified. No, the actual problem happens when you use the scroll wheel.\n. FYI, with today's CodeMirror APIs this is actually not that hard. Basic hacky implementation that works on codemirror.net:\njs\nfunction showRelativeLines(cm) {\n  const lineNum = cm.getCursor().line + 1;\n  if (cm.state.curLineNum === lineNum) {\n    return;\n  }\n  cm.state.curLineNum = lineNum;\n  cm.setOption('lineNumberFormatter', l => \n    l === lineNum ? lineNum : Math.abs(lineNum - l));\n}\neditor.on('cursorActivity', showRelativeLines)\n. No, because then when you focus to another window/tab, the highlight will go away, which is counter to what IDEs like intellij, visual studio code etc do.\n. I've uploaded a video of what the interaction in intellij looks like. But my point is that there shouldn't be a cursor at all (for the purposes of match-highlighting) until the editor gets focus. After that, the cursor should remain (for the purposes of match-highlighting) even when the editor loses focus.\nintellij-highlighting.mp4.zip\n. I think that does sound like it would work!\n. Looks good! Thank you :)\n. Sorry, it appears to depend on what string you use. I couldn't repro it with just a string of as, but the following works on codemirror.net:\njs\ndocument.querySelector('#demolist').style.display = 'none';\nlet val = 'long ';\nwhile (val.length < 20000) { val += val; }\neditor.setValue(val);\neditor.setCursor({line: 0, ch: 8000});\nIf you then click in the editor, you should see the cursor in the middle of the character.\n. I wasn't talking about any special highlighting of the URL.\nWe are currently using this config for markdown mode: \njs\n  {\n    name: 'markdown',\n    underscoresBreakWords: false,\n    fencedCodeBlocks: true,\n    strikethrough: true\n  },\nThe problem, as described above, is that when you paste my example into https://codemirror.net/mode/markdown/ the _ starts an italicized section, which here is undesirable. The desired fix would be some adjustment of the tokenization etc. in the markdown mode so that underscores in contexts like this (e.g. preceded by / and maybe other characters) don't trigger the start of italicizing.\n. I should have been more specific. I meant we want to use this in the same way as styleActiveLine, which currently only affects the part of the line that shows text and not the gutter.\n. We don't have the connectors anymore (since we switched to using the aligned diffs) and I don't see why the diff marking classes should be any more or less expensive to add than the classes already added to tokens for syntax highlighting.\n. friendly ping (this should fall under our support contract :). Playing with the demo, it appears that when multiple top panels get created, closing them causes visual scrolling (when there's only one panel things work fine). That seems like a bug. Otherwise, this solution works great.. This also happens at the end of \n```md\n\nfoo\n```\n\nThis is useful when you want to make a block quote contain two paragraphs, which per CommonMark require a line with just a > between them: http://spec.commonmark.org/0.12/#example-153\n. ping :)\nthis also falls under our support contract. That's a separate issue.\nThe problem here is that only the text gets copied, whereas what's actually desired is that the text and the spacer get copied, since the text+spacer in one pane will (in aligned mode) have the same height as the text+spacer in the other pane, hence producing no flicker.. I maintain that not doing this is essentially not following through on the intent of the past contract for the aligned mode.\nIf you won't fix this issue, can you at least expose an API for customizing what the arrows do on click, so that we can fix this ourselves? I think there might be a separate recent bug on this.. 1.5: Set align mode, and 3-way :). Sorry, my script tags in the repro steps got eaten by markdown processing :)\nIt repros with the attached file. Scroll to the bottom, over the right panel.\nmerge.html.zip\n. Yes, I believe that fixes it. Thank you!. The same kind of issue (with same verification steps) happens on the left pane if you're scrolling the left pane by dragging its scroll bar.. It's a little tricky, but here are two files which repro it for me on merge.html. Put them into the left & right panes, and then quickly drag the left scroll bar down. Put a breakpoint on the first line of NativeScrollbars.prototype.setScrollTop conditional on this.vert.scrollTop > pos. When I did this, I caught it stopping with the following stack trace:\nNativeScrollbars.setScrollTop (codemirror.js:3447)\nendOperation_finish (codemirror.js:3801)\nendOperations (codemirror.js:3723)\n(anonymous) (codemirror.js:3706)\nfinishOperation (codemirror.js:2124)\nendOperation (codemirror.js:3703)\n(anonymous) (codemirror.js:3858)\nsyncScroll (merge.js:191)\n(anonymous) (merge.js:147)\nsignal (codemirror.js:1246)\n(anonymous) (codemirror.js:7497)\nscroll (async)\nendOperation_finish (codemirror.js:3802)\nendOperations (codemirror.js:3723)\n(anonymous) (codemirror.js:3706)\nfinishOperation (codemirror.js:2124)\nendOperation (codemirror.js:3703)\n(anonymous) (codemirror.js:3858)\nsyncScroll (merge.js:191)\n(anonymous) (merge.js:144)\nsignal (codemirror.js:1246)\n(anonymous) (codemirror.js:7497)\nscroll (async)\nsetScrollTop (codemirror.js:3239)\n(anonymous) (codemirror.js:3541)\n(anonymous) (codemirror.js:3393)\nIt's interesting to me here that it has two async scroll event boundaries in the trace...\nleft-ex.txt\nright-ex.txt\n. Beautiful! Yes, now I don't see any of these issues. Thank you :). Thank you, yes these work great.. Yes, I think the solution you describe (\"done intelligently\") would be the preferred way out of this.\nOur interactions with CodeMirror are already complicated enough, especially when dealing with two and three pane scenarios, so adding spacers manually isn't really an option.\nFYI: The use case for us with the line widgets is showing code-review comments inline. You can also reply to those comments, etc. so it'd be great if the .changed() method on the LineWidget also properly updated the sizing of the corresponding spacer.. it mostly works, but this seems to still break it:\n\n3 pane & aligned\nh = dv.editor().addLineWidget(118, document.createElement('div'))\nset height:100px on the new div in the inspector\ncall h.changed()\nscroll the middle pane down\n\nactual: scrolling of the middle pane gets disconnected\nexpected: stays connected. I still repro the same issue, even without .changed()\n\n3 pane & aligned\nd = document.createElement('div'); d.style.height = '100px'; h = dv.editor().addLineWidget(118, d) (line 120 locally when I just git cloned)\nscroll middle panel all the way down\n\nactual: scrolling of the middle pane gets disconnected from the left/right\nexpected: stays connected. Then please add some documentation in the manual section for doc.setGutterMarker specifying that trying to color contiguous sections of the gutter is not supported, because this is just not a warning that currently exists, and as such isn't something that your users will just know not to do.. Our contract includes \"Ensuring that the CodeMirror website is kept accurate and accessible\". \nIf you insist that this use case is unsupported, it should be noted as such on the site.. Because on our end this was something that did appear to work for all use cases for many years, and you now saying that it's \"not supported\" is of little help to us.\nThe question here is not about the \"infinite number of things that CodeMirror does not do\", but about this specific usage of gutter marking. For most of those other things that CodeMirror can't do, if someone tries to make CodeMirror do them, they'll see an error or just not observe the right behavior, and then either give up or ask for help. Whereas with this, if you just set the background color on a gutter marker, it'll appear to work fine in almost all normal cases.\nThat's the kind of gotcha that really needs to be documented.. This isn't really about a line, it's more about generally trying to make a UI that continuously colors a swath of the gutter using gutter markers. It appears you're saying that's the unsupported use case.\nWe do set height=100% on the gutter wrapper. That results in broken alignment in merge mode.. the patches are generally immediately visible on the codemirror site, so in this case it would be at http://codemirror.net/mode/r/\nseems to work well there :). The key thing is that an HTML block (per CommonMark at http://spec.commonmark.org/0.27/#html-blocks) can also be terminated by a blank line. So in this case, the point is that the initial <div> and the final </div> are supposed to be interpreted as separate HTML blocks.. Seems to work well, thank you :). Yep, I believe we're good now.. Do any of the above proposals sound better? From our usage, this recent change (per above, originally due to Cr58) is a bug in how line widgets work. Would appreciate a response as soon as possible :). Ah, that issue with && was my problem. I'll reopen or file a separate bug if I come up with a better case :). I think it'll be easier to have this be internal to our project (since publishing an open source repo involves some bureaucracy. This way we can also use new ES features easily :)\nThanks for taking a look, though!. Where is this behavior documented? And what's the motivation for having this context-sensitive functionality, since I don't know of any other editor that behaves this way? \nI do agree that both functionalities have their own use cases, but it would be best to have them as separate commands that each just do the one thing. It's fine to have them not be bound by default \u2013 we can do that on our end.. An option to turn the behavior off would be fine as a workaround, but I do think there is room for the two commands (since as I said, this behavior is quite useful in some cases).\nIn particular, pasting still happens when you add modifiers on top of ctrl/cmd+v. So if there were different commands for these two behaviors, they should be assigned to ctrl+v, ctrl+shift+v, ctrl+alt+v, etc., and should still work, right?\nI'm not suggesting they should be assigned in CodeMirror's keymaps, but we could assign them as such in ours.. Eh, no that's too much hassle since we also have another system of commands/shortcuts that acts as a superset of CodeMirror's. We'll just set this option to false for now and if someone wants this behavior as a separate command I can point them back at this thread :). That's understandable. I'd mostly just like direct confirmation, and some documentation of this known issue on the site/manual (given that, e.g. ctrl+z/ctrl+shift+z/ctrl+y do work, which makes it not surprising when a user thinks that the right click menu's undo/redo will work too).. Ha! I hadn't actually checked, but you're right that's what it does. Oh well :). These chunks are getting streamed in from the network over perhaps several seconds. The chunks in general usually have sane-length lines -- this is just an edge case we encountered. I suppose we could try and do some buffering in our code to build up lines in memory and only do line-wise insertions into the CodeMirror for display. That's probably the sanest approach, would you agree?. @marijnh if adrianheine doesn't fix this within the next day or so, we'd appreciate a roll-back. Reset the relevant code (I'd say search cursor etc.) to the state where this bug was not present.. Heh, okay, I got a chance to play around with this some more. Try this:\n\nhttp://codemirror.net\ntriple click on one of the lines (e.g. line 7) to select it all\nmove your mouse directly to the right, so that it's outside the border of the CodeMirror, but not above or below it.\nmiddle-click. FYI, I was reproing this in Firefox too, so I don't think it's chrome\nspecific.\n\nOn Aug 19, 2017 09:33, \"Marijn Haverbeke\" notifications@github.com wrote:\n\nI can see this happen now -- even when the editor isn't focused. My best\nguess is that Chrome is using some kind of heuristic to find the element\nthat the user might have meant to click on... the mouse target isn't\nrelated to CodeMirror there, and the focus isn't on it, so from what I\nunderstand of the DOM, there really isn't any reason to deliver the pasted\ncontent on the editor, yet it does. No paste event is fired, either.\nThe fact that this only happens up to a certain pixel distance from the\neditor seems to also point in the direction of a misguided heuristic. But\ninterestingly, I can't reproduce this with a plain textarea, so it might be\npossible to work around it by changing some DOM structure or CSS value ...\nI haven't been able to figure out such a workaround yet though.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/4900#issuecomment-323533413,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AE0RXzVMffBUXalnqCRSB-gBhNOoPqT6ks5sZw5GgaJpZM4Ov03f\n.\n. You're right. I was mistaken \u2013 I never did get it reproing on FF. But for the Chrome specific behavior, would you mind putting together a simpler repro case than the full codemirror, and filing a bug at https://bugs.chromium.org/p/chromium/issues/list? If you link it here, I can comment on it to get it prioritized a bit.. I'd rather have the actual discussion with the relevant Chrome developers directly, to determine what it was they did or did not intend. But to do that, I need a small repro case that I can attach to a bug. Since you noted you could get this happening on other input fields, would you mind putting a small one together?\n\nSomething super minimalist like \nhtml\n<html>\n<br>\n<br>\n<input>\ndoesn't appear to repro.. Thanks! Filed https://bugs.chromium.org/p/chromium/issues/detail?id=786490. Ah, yes, it appears visibility-restricted to Google. Sorry about that. But I think the relevant tagging should help prioritize a response.. The point isn't necessarily to select things in the same column. The issue comes up whenever you start a selection far enough to the right that you can't see the leading column. It can even be annoying when you're just trying to select a section of one row because the mouse can accidentally go a little high or a little low while dragging. This sort of thing can come up when opening large data files, log files, minified JS, etc. In many of these cases the mouse is the tool many of our users would like to use, so it would be helpful if the editor cooperated.. erm, looks like the line 484/460 should be dealing with delLineRight, not smartBackspace. I can create a new one (I normally never deal with git). I suspected it would be cleaner if you wanted to fix this one, but I don't have a preference.. ah, sorry, I meant to file these in /google-modes :(. That's fair, but it should at least A) include some way to customize this special-casing, and B) at least pair up \", since in natural language usage that one is pretty univerally paired up with another \".. I'm not sure I understand why tokenization is relevant here. Is tokenization (or other non-local info) used for closing other types of brackets? It doesn't appear to be, since if you type ), go left, and then type (, it does the naive thing and just inserts (), resulting in the nonsensical ()).\nLooking at other editors/IDEs:\n- Sublime appears to use some heuristics in comments, different from the heuristics in tokenized code (e.g. if you have the cursor before \"\"\"\" in comments and mash \", you will type over the existing quotes and continue, whereas in normal code you'd type new quotes and would always have four quotes in front of your cursor)\n- Atom and VSCode appear to still do tokenization, and the behavior seems to be the same inside a comment and outside\n- IntelliJ just doesn't complete () or \"\" in comments at all.\nThese behaviors above appear sensible/internally-coherent, whereas CodeMirror's does not. Could you expound on why Sublime's and Atom's/VSCode's approaches wouldn't be workable for CodeMirror?\n. It's less coherent because the end user's mental model is unlikely to distinguish between \"closing bracket-like-things where the start and end are the same character\" vs \"closing bracket-like-things where the start and end are different characters\", so in a  given context it's more natural to either have them both enabled or both disabled. Or at the very least, it would be great if you could provide an option so we can give this functionality to our end users.\nConsider:\n- Atom: the top-level option toggles auto-closing of both \"\" and {} style brackets\n- VSCode: The 'editor.autoClosingBrackets' setting toggles whether both styles of brackets are auto-closed.\n- Sublime: the 'auto_match_enabled' option toggles whether both styles of brackets are auto-closed.\n- IntelliJ alone gives two separate top-level prefs, one for quotes and one for brackets (but still, neither of them apply in a comment context). The point I was trying to make with the options that other editors give was that other editors generally have only one option that toggles auto-closing of both \"\" and {} style brackets. Since these options are intended for user configuration, this is evidence for the fact that the authors of those editors thought that their users most commonly want the same behavior for \"\" and {} style brackets. I'm generally in agreement with those authors.\nThere are several ways that you could help:\n1. Provide an option that just disables all bracket autoclosing in comment context\n2. Change the modes (at least e.g. google modes) to do string tokenization inside comments. Strings inside comments wouldn't be styled any differently from plain comments, but then you'd be able to match quotes inside strings, right? Or would it be hard to make the case of e.g. /** \" */ properly close both the comment and the string at the */?\n3. Use Sublime's heuristics (which it also appears to use in all other contexts without tokenized strings, e.g. plain text mode):\n  - When a user types a quote:\n   if next char is same kind of quote:\n      move right\n    elif prev char is \\w \\d or same kind of quote:\n      insert only one quote\n    elif next char is \\s (or end of line) or in `}])`:\n      insert two quotes\n    else:\n      insert only one quote\n   - When this happens in multi-selection, if the prescribed behaviors are the same in each selection, do that behavior. If the prescribed behaviors are different, just insert one copy of the quote at each selection.\n   - When backspacing, if the prev and next chars are both the same quote, delete them both.\nNumber 2 or 3 would definitely be preferable, of course.. actually, it seems this only happens on mac, and not linux, since the the key code there gets interpreted as Mod whereas on linux it gets detected as Ctrl. Thanks for writing up the great repro case + explanation, Tobias. It looks like the main issue in #4850 was that the existing selectLinesUpward/Downward has a slightly different behavior, in that the earlier implementation goes by logical lines whereas the new one (and Sublime's) goes by visual lines. Since the latter behavior matches Sublime's, I would say it should be the only one retained (at the proper shortcut).. I similarly don't have access to a windows machine but http://docs.sublimetext.info/en/latest/reference/keyboard_shortcuts_win.html agrees with your keybindings.\nThough on linux, the sublime bindings for these actions are alt+shift+up/down. Since the \"PC\" keybindings are also used for Linux (and those bindings are otherwise unused in the CM sublime PC keymap), would you be opposed to including them as well?. I think it should. Haven't tested. If it doesn't, will follow up.. Passing that option does appear to work if you use a full CodeMirror. But we use a CodeMirror.Doc and give that a value (and then potentially attach linked docs to multiple CodeMirror views of the same file). There is no documented way to set the line separator on a Doc, though it appears that just doing doc.lineSep = '\\n' after construction does the right thing.\nCan you please describe this workaround in the manual? Or provide a real API for this use case?. Actually, no. What I would need to do to work around this right now is to create a doc with '' content, then set the line sep, then set the actual content I wanted in there, and then clear the history so it's not randomly polluted. This really needs an actual API.. Thanks, that does work!\nThough BTW now the next sentence in the docs isn't correct: \"The last two arguments are optional and can be used to set a mode for the document and make it start at a line number other than 0, respectively.\", but there are three optional params etc.. Looks good to me.. Indeed, I can't get it to repro with the final code either. It looks like the syntax highlighting was only broken when my code was also in an intermediate/broken state. Sorry for the noise.. ^ and $ should continue to match start-of-line and end-of-line, even with the multi-line regex search feature. This is how multi-line regexes are handled in Sublime, VSCode, Atom and IntelliJ. For example, given the file\nfoo\n  bar\n  baz\n  quux\nthe regex ^\\s+.*\\n\\s+ matches two regions, one starting one the line with foo and one starting on the line with baz, in each of those editors. In https://codemirror.net/demo/search.html it only matches the first region.\nPresence of \\s etc. shouldn't alter the behavior of other regex special characters.. Considering VSCode is implemented in JS (Atom's implementation boils down to a native module), and does provide this functionality, I suspect that some reasonable implementation exists. \nCan you take a look at how they do it and maybe use some of their approach?\nhttps://github.com/Microsoft/vscode/blob/73d60bd4c8308f018c4bd761d38702a8f0e91c3a/src/vs/editor/common/model/textModelSearch.ts#L132\n. the repro, in case it gets modified:\n```js\nconsole.clear();\nconst parentDoc = new CodeMirror.Doc('original content');\nconst cm1 = new CodeMirror(document.createElement('div'), {value: parentDoc.linkedDoc({sharedHist: true})});\nconst cm2 = new CodeMirror(document.createElement('div'), {value: parentDoc.linkedDoc({sharedHist: true})});\nparentDoc.replaceRange('changed', {line: 0, ch: 0}, {line: 0, ch: 8}, '+whatever');\nparentDoc.replaceRange('final', {line: 0, ch: 0}, {line: 0, ch: 7}, '+whatever');\nconsole.log(cm1.getValue());\ncm1.execCommand('undo');\nconsole.log(cm1.getValue());\n```. We probably could but we're not the only product at Google which uses CodeMirror, and Google isn't the only place that uses Chromebooks.\nWhat's obscure or not tends to be subjective -- it's just what you've been exposed to. Rectangular selection is also supported in ~all major IDEs and editors. The bug for letting webpages natively consume alt+click is assigned, but it's unclear when it'll be fixed, so a workaround would be greatly appreciated.. Will try it out tomorrow and let you know how it goes.. Heh, I was looking through the code trying to figure out how to deal with this and noticed that there's already a hack in there to create rectangular selections on CrOS with meta+shift+drag (I think this was at my request a long time ago).\nCould you note this in the manual somehwere? I'll similarly have to add it to our internal docs, since it's extremely obscure right now.... ",
    "brandonwamboldt": "@marijnh FYI you can close this as #1869 made it redundant\n. @marijnh I've submitted a PR to remove the bower version number. I tested this using a new git repo and some tags, and bower now pulls the version using git tags if version isn't specified in bower.json. The bower docs also do not list version as a required attribute any more.\n. @marijnh FYI you can close this as #1869 made it redundant\n. @marijnh @rosmanov I've updated my PR with a new fix, can you take a look? The problem before was that the parser was switching to Smarty mode as soon as it entered a tag, which it shouldn't.\nNow the parser will only enter a smarty mode when it encounters an opening tag, or if the line contains no HTML tags (Fixing @rosmanov's example). \nI'm still pretty unfamiliar with the code base, so let me know if I messed something up. One thing to be aware of is that it won't highlight tags found in an attribute, because the HTML parser eats the entire string at once. I could probably figure a way around this, but neither of the editors I am using support smarty tags in attributes.\n. @rosmanov  Added class=\"{$bodyclass}\" to the <body> tag to demonstrate that the original problem (#1768) no longer occurs.\n. @marijnh This should be ready to be merged, could you take a look when you get a chance?\n. Thanks!\n. And FYI, works fine:\n```\n\nbower install git@github.com:marijnh/CodeMirror.git --allow-root\nbower CodeMirror#          not-cached git@github.com:marijnh/CodeMirror.git#\nbower CodeMirror#             resolve git@github.com:marijnh/CodeMirror.git#\nbower CodeMirror#            checkout 3.18.0\nbower CodeMirror#            resolved git@github.com:marijnh/CodeMirror.git#3.18.0\nbower CodeMirror#~3.18.0       install CodeMirror#3.18.0\n\nCodeMirror#3.18.0 bower_components/CodeMirror\n```\n. Any chance you could post an example of this problem occuring, using JSBin or something? \n. @bfrohs Could you take a look at this when you get a chance? I've been trying to get more involved with CodeMirror, and this issue seemed like something not to difficult to work on.\n. ",
    "netpoetica": "Seems like backspace/delete key works without issue, just not typing anything new into iOS. Replicated on iOS simulator:\n- iPhone iOS 6\n- iPhone iOS 5.1\n- iPhone iOS 7.0.3\n- iPad 7.0.3\nI think it's safe to say all iOS devices. Also verified on iPhone 5 iOS 7.0.3 (not simulator).\nA solution is available here but I'm not sure where to implement this in Code Mirror source. I would imagine somewhere around here.\n. ",
    "unwitting": "Is there any update on this? A project I know of is waiting on a solution to exactly this and it seems we already have a suggested fix? \n. ",
    "q42jaap": "I've traced the behavior difference for typing while the showhint dialog to a change in show-hint.js\ncompletion.widget.close() is called in activity() instead of finishedUpdate (deac75cfc70429afe6c289383b39ee241aed094f).\nI think the old behavior is better, keep the dialog open while typing. Maybe it could be an option when to close the widget.\n. I'm using 3.15 while the xmlcomplete demo seems to be using the master...\n. ",
    "Jamesking56": "I have set the mode option on both and the same problem occurs.\n. I made a JSFiddle but it sortof proved your point, must be something to do with my framework:\nhttp://jsfiddle.net/9Muxq/\n. ",
    "anachronin": "Thanks. Just saw threads with similar bugs for Chrome 28.\nJust updated from 28.0.1500.71 to 28.0.1500.95.\nThe bug is gone!\n. ",
    "mohitsuman": "Thank you for the help. Much appreciated.\n. ",
    "bendecoste": "Updated! Thanks for looking. \n. ",
    "vincentwoo": "I should mention that this bug occurs on the latest stable Chrome, on both OSX and Windows 7.\n. I should also mention that tabMode: 'spaces' didn't work for me either.\n. I've managed to diagnose this a bit:\nindentAuto: function(cm) {cm.indentSelection(\"smart\");},\nindentMore: function(cm) {cm.indentSelection(\"add\");},\nindentLess: function(cm) {cm.indentSelection(\"subtract\");},\ninsertTab: function(cm) {cm.replaceSelection(\"\\t\", \"end\", \"+input\");},\ndefaultTab: function(cm) {\n  if (cm.somethingSelected()) cm.indentSelection(\"add\");\n  else cm.replaceSelection(\"\\t\", \"end\", \"+input\");\n},\ndefaultTab was what Tab was bound to by default (naturally), which seemed a bit odd. Upon rebinding Tab to indentMore, behavior was much more in line with what I expected. I'm not sure why defaultTab exists, given that it shells out to the same thing indentMore uses, and only differs in the no-selection case.\n. I think that the default behavior of tab should be aligned with the default behavior of the parsers - which emit spaces when you press enter. It is strange that these two things are different.\n. Why is that not valid JavaScript? Many times you will want to type an expression just like that, before adding something like var object = {... to the front.\n. Fair enough. Interestingly, I agree that this is the behavior in Chrome's web console, but if you check what node does:\n```\n$ node\n\n{a: 1, b: 2}\n{ a: 1, b: 2 }\n```\n\nfood for thought\nI still think such a change would be a usability win - the current indenting scheme of increasing indents per line is aggravating, irrespective of any program invalidity. Why not keep the indent level the same if the program is invalid?\n. Understood. Thank you for the clear explanation.\n. I did not expect it to be per-line in some scenarios and block in others. The manual reads \"A string that will be inserted after opening and before closing comment markers. Defaults to a single space.\"\nWhen doing blockComment in languages that support block comments\njava\nclass Solution {\n  public static void main(String[] args) {\n    System.out.println(\"hello\");\n  }\n}\nbecomes, by default:\njava\n/* class Solution {\n  public static void main(String[] args) {\n    System.out.println(\"hello\");\n  }\n} */\nwhich is okay, but by passing padding: '\\n', I achieve:\njava\n/*\nclass Solution {\n  public static void main(String[] args) {\n    System.out.println(\"hello\");\n  }\n}\n*/\nI am trying to point out that this becomes very different in non-block comment languages.\n. If you look at this comment: https://github.com/marijnh/CodeMirror/issues/2387#issuecomment-38081097, it definitely seems like padding is applied only once per marker in block commenting languages. \nWhen passed padding: '\\n', Python commenting adds a newline every line, but Java adds newlines only around the comment markers.\n. I'm fine with whatever functionality you think is appropriate - I just would prefer that it be documented, because you can eventually hit some surprising edge cases that are hard to know about in advance unless you are familiar with a lot of commenting modes.\n. @marijnh Yes, it would.\n. @marijnh Did you get a chance to look at this one? Sorry to pester, but wanted to get a sense for how hard this might be to fix.\n. I believe I am hitting this case in PhantomJS as well - \nTypeError: 'null' is not an object (evaluating 'r0.left')\n        at hasBadBidiRects (/Users/vwoo/firepad/bower_components/codemirror/lib/codemirror.js:7465)\nSo it's probably good this was fixed.\n. :thumbsup: \n. Awesome, thanks!\n. Just wanted to say thanks for both of your work on this. I'm not an obj-c pro either, but will definitely forward any customer complaints I get about the syntax highlighting.\n. Okay, I took your advice on countColumn. I also registered the function in the commands map, which I hope you don't mind. I think it's a useful one.\n. Thanks! Out of curiosity, can you explain how/when indentUnit and tabSize differ?\n. My colleagues and I see this default backspace behavior on sublime 2 and 3, with no customizations to the keybindings. It might be relevant that we all use OSX. Would you be okay with merging a version of this that works correctly with multiple cursors? I can take a crack at it.\n. @marijnh would it be untoward to ask what your price for this would be? Happy to talk offline as well.\n. Whoops, sorry about this one. My bad.\n. Additionally, is there any interest in using a popular JS markdown parser to run the MD mode instead of a hand-rolled one? Say, for instance, https://github.com/chjj/marked?\nIt seems you could build the markdown highlighting mode on top of marked.js' Lexer fairly easily (https://github.com/chjj/marked#pro-level):\n``` javascript\n$ node\n\nrequire('marked').lexer('> i am using marked.')\n[ { type: 'blockquote_start' },\n  { type: 'paragraph',\n    text: 'i am using marked.' },\n  { type: 'blockquote_end' },\n  links: {} ]\n```\n. Thanks!\nOn Jun 1, 2015 2:03 AM, \"Marijn Haverbeke\" notifications@github.com wrote:\nThe clike mode's electricInput property was too restrictive, and didn't\nfire on {}EOL, only {EOL. Attached patch fixes the problem for me (but\nnote that you'll also need patch 5e989bd\nhttps://github.com/codemirror/CodeMirror/commit/5e989bdabd38535794987c8192f3ca16e24f92a6\nfrom early last month).\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3295#issuecomment-107375371\n.\n. @Milesraven this issue almost certainly doesn't belong here. This is the repository for CodeMirror, a JavaScript component for editing code in browsers.\n\nYou should probably go to the Sonic Pi forums of support website for help.\n. @danielo515 for what it's worth, I personally still do not understand the issue, or what you expect to happen.\n. Okay, I see what you mean now. Your problem is that you think that CodeMirror is introducing additional horizontal scroll width, which you in turn are convinced has to do with the number of line numbers.\nHowever, I think it might be something in your dataset. I pasted the first 100k lines in your text file, and the editor was fine. Pasting lines 100k-200k did cause the problem you are describing, though. Maybe you can isolate what part of your text file causes this problem?\n. Oh, I found it. \nLine 164695: 10704x649aused by Saused by SubscriptionxErrorException(Consumer does not belong to DTAC.)\nDo your homework next time!\n. That's the definition for the lineComment extension. Block commenting works as expected: https://github.com/codemirror/CodeMirror/blob/master/addon/comment/comment.js#L76\n. That's expected behavior. Sublime also line comments by default. If you want to do block commenting, you can very easily bind a key to blockComment.\n. Certainly not out of the box, but you can use CM methods like markText to annotate ranges with additional classes, or replace their DOM representation entirely.\n. Yup\n. Pretty interesting! How performant is the minimap on larger documents?\n. Looks nice. Reminds me of a higher-contrast monokai\n. This issue is very difficult to understand. Can you please illustrate the problem with two different jsfiddles or some screenshots?\n. This seems like a fairly dangerous change. I think CM runs off the assumption that newlines are \\n pretty widely throughout the codebase, addons and such included.\nWould it be easier to achieve what you want by filtering the input to setText on your end before passing it to CM?\n. > Imagine you open a big file and change one line -- you don't want the whole file suddenly be reformatted with tabs replaced with spaces, CRLFs with LFs and so on.\nI might and I might not - it's more likely that users of CM have gotten used to a particular convention already, which is what I meant by dangerous.\n\nThat said, I don't understand what you mean by filtering. Would you elaborate please?\n\nIn your linked issue, you said:\n\nThat means getValue may return different text to what setValue was called with, depending on the newlines used.\n\nI meant that, if this is in fact your core issue, you can standardize the newline situation in userland via something like\neditor.setText(text.replace(...)) \n. cc @mightyguava, who I think is the \"vim guy\"\n. FWIW I think this is actually a pretty reasonable request. A one-time tiny file addition that can alleviate the confusion of maybe 10% new users seems like a very friendly, worthwhile change to have. I have definitely googled \"codemirror changelog\" a fair number of times.\n. In the Firepad repo we have straightforward changes + download links in the releases tab: https://github.com/firebase/firepad/releases\n. Beautiful, thank you.\n. This doesn't appear to be true on https://codemirror.net/demo/sublime.html. When I highlight multiple lines by cmd + triple clicking and hit tab, they get indented. Can you make a JSFiddle repro case or explain how to cause the issue on the linked page?\nAre you using the sublime bindings? CodeMirror doesn't behave like sublime by default, you have to tell it to.\n. Are you using the sublime keymappings? This issue is reproducible here: https://codemirror.net/demo/sublime.html is probably my fault when I introduced the \"smart backspace\" behavior.\n. I'm sorry, can you explain more about readOnly? What is it? The tab? Which tab is readonly and which one is not? Can you make a http://jsfiddle.net/ to demonstrate?\n. I don't quite have the time right now either, so let's leave this issue as a TODO for now. Maybe some of the other enterprising contributors could take a whack at it.\n. The original unminified CodeMirror files are fairly well documented. Can you reproduce the problem on any of the CM demo pages or in a JSFiddle? If not, we're probably not going to be able to help you. The issue is very likely on your end.\n. A couple things:\n- We don't get pings if you update your comment. If you have new information, please add a new comment.\n- Your writing is pretty manic. It's still not clear to me what \"the issue\" is, per se. Please try to state the smallest number of things we have to do to reproduce your issue. It would help a lot of you could create a fiddle or codepen with your problem, as well. As it stands I have to guess what you mean.\nSo, guessing:\nAre you saying that if you include mode files in a particular order, and try to use a specific mode, the editor hangs on a quotation mark? The HTML mode absolutely does require that the XML mode be loaded first. HTML is a subset of XML. You can look at the demo HTML mode page's source code here: https://github.com/codemirror/CodeMirror/blob/master/demo/html5complete.html, where you will see that the XML mode is loaded prior to HTML mode:\nhtml\n<script src=../lib/codemirror.js></script>\n<script src=../mode/xml/xml.js></script>\n<script src=../mode/javascript/javascript.js></script>\n<script src=../mode/css/css.js></script>\n<script src=../mode/htmlmixed/htmlmixed.js></script>\nand if you examine the html mode itself: https://github.com/codemirror/CodeMirror/blob/master/mode/htmlmixed/htmlmixed.js, you'll see that it tries to require the XML mode.\nmod(require(\"../../lib/codemirror\"), require(\"../xml/xml\"), require(\"../javascript/javascript\"), require(\"../css/css\"));\nIt also tries to require the JS and CSS modes, because HTML can embed arbitrary JS/CSS content, but I think those two are less critical to the functioning of the mode.\n. The requires indicate what the JS file needs. On a browser, they do nothing and fall back to the regular case: mod(CodeMirror);.\nI tried changing the order of the script tags, but everything still works fine for me. Please make a fiddle or codepen that demos the problem.\n. Can you make a JSFiddle or CodePen that demonstrates the issue for us?\n. Can you copy/paste text out of one of the demo CodeMirror pages? Say, http://codemirror.net/mode/javascript?\n. It's going to be hard to help you unless you can point us at a particular page that causes the problem for you. jsbeautifier has potentially modified their editor, and they seem to be on an old version of CM (3.11). Perhaps you should file an issue with them, if it's reliably reproducible?\n. Thanks, works for me!\n. @marijnh I deleted the mode stuff because I am a big idiot who codes tired. I restored it - I thought the mode code could never do anything because mode was always null... hah.\n. oh god, good catch, sorry\n. I can't reproduce, do you have more specific steps to follow? What browser are you using?\n. I'd agree that the approach you describe is probably better, but I'm mostly trying to maintain an extant library. It'd probably be very difficult to rewrite this bit at the moment.\nFirepad is trying to have invisible sentinels at the start of each line. Using inclusiveLeft with a collapsed range seemed like the blessed way to do that in CodeMirror. Conceptually, should there be any difference between such an empty line and a line with nothing but such a collapsed range on it? To my mind, it DOES seem like both of those are the same thing. You should be able to place your cursor to the right of a collapsed range with inclusiveLeft, no?\n. Well, in Firepad, these sentinels store additional rich-text formatting information. I don't quite understand the entire system back to front, but basically Firepad is using an OT system wherein metadata like that has to be part of the document in order to be versioned appropriately by OT. You can read part of the implementation that deals with sentinels here: https://github.com/firebase/firepad/blob/master/lib/rich-text-codemirror.js.\nI'm mostly trying to follow along and diagnose cursor movement bugs in this part of the code. To me it seems that it is not entirely clear what the difference between inclusiveRight and inclusiveLeft are in a collapsed, atomic range. If a range has 0 width, can you not place your cursor before OR after it? What does before vs after mean when it comes to an element with no width?\n. @marijnh Thank you very much again for the patch, it almost addresses all of our issues (I think). Here's a nagging case where it doesn't quite work:\n1. Get a blank editor on HEAD CodeMirror.\n2. Run\njs\n   editor.setValue(\"1foo\\n2\");\n   for (var i = 0; i < 2; i++) {\n     editor.markText(\n       { line: i, ch: 0 },\n       { line: i, ch: 1 },\n       { inclusiveLeft: true, collapsed: true }\n     );  \n   }\n3. Place cursor before the f in foo on the first line\n4. Hit down\nAt this point you would expect the cursor to move to the second line, but instead moves to the end of the first (after the o in foo).\nI dug into your refactor and I suspect (through my admittedly limited understanding) that the issue is related to this line: https://github.com/codemirror/CodeMirror/blob/710f43a1c55ffa4102ef4c3fce46329ad5643da7/lib/codemirror.js#L2253.\nThe way I read that line seems to say to me \"If we are moving rightwards, and approach a span with inclusiveLeft set, move the cursor to the nearest eligible direction in the opposite direction\". However, I think it should be in the current direction, no?\nMy logging seems to indicate that skipAtomic is called with a pos of the first character of the second line and an oldPos of the second character of the first line, and it hits the collapsed range at the start of the second line. At this point it decides to move the cursor backwards one, to get it out of the range. I think, based on your earlier explanation, that the correct behavior is to move it past the range.\n. Thank you very much for the followup patch. It seems to address our issues, which I very much appreciate.\n. Thank you for the very prompt fix!\n. If you use the sublime keymap, this is default behavior. I made this change a while ago and it's pretty easy to port into your application as well: https://github.com/codemirror/CodeMirror/blob/master/keymap/sublime.js#L246\nIt's simply a matter of calling toggleComment with indent: true\n. I have a very hard time following the examples of the other modes, and would consider paying for this to be added to the Swift mode. Would you be interested in spending a bit of time implementing it?  I can be reached again at vincent@coderpad.io.\n. Is this correct? Should it be 5.11.0, instead, then?\n. Ah, gotcha, thanks.\n. my guess as well is that this is an oversight\n. can confirm on chrome 49 on windows\n\n. I personally would be happy to see something like this in place, but would also want to see a more concrete proposal for how the system would work in practice. For instance, what would the JSON files look like? Are you going to try to whitelist css properties?\n. I think (since you'd have to do this work anyway) you might be better off just hand-auditing all the themes, then producing like a \"theme-master\" template that also talks about which properties are \"safe\" to change. Like @marijnh said, it might be overkill to introduce this as a build-time thing, and some themes conceivably could use the extra freedom (I recall one theme using an image background). I agree that a good, safe, guideline is a good thing to have, though.\n. You uh... commented out everything? keyMap: \"sublime\", is what triggers the sublime key mapping.\n. You probably did something else wrong. Can you make a jsfiddle or codepen? Literally all you have to do is include the extra sublime.js file and specify the keyMap option.\n. You just randomly pasted some stuff in a fiddle. You need to actually include JS libraries, etc. I recommend you learn basic HTML/JS before attempting to use a third party library like CodeMirror.\n. This is a very cool writeup.\n. There is not. I updated the PR.\n. Hey @marijnh, did you get a chance to take a look at this? The code in the PR is very similar to what was previously in sublime.js, just with support for multiple cursors.\n. Can you give a reproducible error that this fixes? What steps should we follow on https://codemirror.net/demo/vim.html to cause broken behavior?\n. @mightyguava I know you're not active developing the vim mode, but this might be an important enough fix to take a look?\n. That seems sane to me but I am by no means a vim-mode expert either.\n. It does, but it also feels like a bit of a hack. Is no max-width at all a sane default for CodeMirror? If not, why not a much higher one?\n. Nope, nevermind, I'm a fucking idiot:\n\ncm.on(type: string, func: (...args))\n  Register an event handler for the given event type (a string) on the editor instance. There is also a CodeMirror.on(object, type, func) version that allows registering of events on any object.\n. Wait, actually, I misunderstood the manual again. Looks like CodeMirror.on still requires that you pass in an obj.\n\nI'd love a syntax like CodeMirror.on('beforeChange', function(instance, changeobj) {!\n. The undocumented option finishInit almost works, except for that CodeMirror.fromTextArea overrides it.\n. > CodeMirror.defineInitHook(func: function)\n\nIf your extension just needs to run some code whenever a CodeMirror instance is initialized, use > CodeMirror.defineInitHook. Give it a function as its only argument, and from then on, that > function will be called (with the instance as argument) whenever a new CodeMirror instance is initialized.\n\ngod, nevermind, why am I so bad at this\n. I'm not an expert in how that particular mode is implemented, but here are my thoughts:\nSince shift-tab is by default bound to indentAuto, the mode will try to make a guess at what the indentation levels should be. You can try to make the case that it should be smarter, but in this case, you cant tell the difference between a recursive call inside the function versus an outside invocation:\npython\ndef foo:\n    print 1\n    foo()\nand\npython\ndef foo:\n    print 1\nfoo()\nare both quite valid.\nHowever, that's not to say your complaint is without merit. CodeMirror will also try to auto indent:\n``` python\ndef foo:\n    print 1\ndef bar:\n    print 2\n```\nto\n``` python\ndef foo:\n    print 1\ndef bar:\n        print 2\n```\nwhich are both unfortunately equally valid Python (though the latter would certainly be considered more unusual).\nTo fix this, I believe that the python mode may need some specific \"opinions\" about how to resolve stuff like this, which might be hard/complicated.\n. Clicking works fine for me in my app and in the CodeMirror demo. If you want someone to answer your question you need to provide a reproducible test case. Otherwise, no one is going to be able to help you.\n. I'm not sure that such a change belongs in master for markdown's stylings. If I understand you correctly, you wish to style headlines with # and === differently?\nIt's not too hard for you to either modify the markdown mode to classify them differently, or to write a script in userland that looks for such headers and mark them with a custom class.\n. This cm.operation call in active-line.js appears to be the cause of the problem - for some reason, trying to change the css classes on the active line in the middle of the selection change messes up the arrow key movement.\nInterestingly, I found that if you put a setTimeout on the operation, you can move the cursor normally as long as the highlighted active line has not yet caught up with the actual active line.\n. If you use an ipad pro with hardware keyboard on you can literally use a keyboard. In this case, I am talking about a normal up/down arrow that appears on a keyboard.\n. Yeah, I ended up just disabling that addon for mobile users. I'm not sure how to proceed so I'm happy to just leave this issue here as a warning to future users.\n. Will try hopefully in the coming days, need to get on an OSX machine w/ simulator! Anyone else is welcome to try too (using browserstack et al).. Frankly, probably neither of those themes should specify any kind of font-size. I think a PR to at least remove the size in pastel-on-dark seems sane. Can you make one?\n. My app uses absolutely positioned CodeMirror containers and is not broken on Chrome 53. Can you link to a jsfiddle/codepen that repros?\n. Super strange. Both Version 53.0.2785.89 (64-bit) and Version 53.0.2785.101 (64-bit) Chrome break in OSX on your codepen. I do not see the same problem with my own app and absolutely positioned editors. This does seem like a somewhat serious bug.\n. Problem is not present on Version 53.0.2785.101 m on Windows 10\n. I suspect this to be related to the bootstrap css you've included - when deleted, I don't see the issue. May be related to border-box, etc.\n. @simonlast you need to set mode: \"text/x-c++src\", not just clike. clike is a general purpose class for highlighting many languages syntactically similar to C, but you have to specify which one you want, still.\n. Isn't the programmer implementing CodeMirror fully in control of when the mode changes? The mode should only change when you tell it to with setOption, no? Why do you need an event?. Thanks!. This is probably related to #4194 . Could this be related to https://github.com/codemirror/CodeMirror/issues/4454?. Also, FWIW, I could not reproduce on Safari Version 10.0.2 (12602.3.12.0.1) at http://codemirror.net/mode/javascript/.. I could not cause the issue to appear, perhaps @tolmasky could try?. This seems like a great opportunity for a PR! If LESS and SCSS officially support line commenting, I don't see any reason why that shouldn't be merged into the handlers for those modes.. I'm not sure I see the value of the option. Would it make more sense and be simpler to hardcode lineComment to // for less/scss?. It might be because of onBlur holding context of the CM instance variable.\n@saadataz: if you remove the global listeners manually, do you see these elements freed?. This is probably not easily achievable in JS, since there are no events for input undo/redo in the browser. Is it possible to tell the browser not to offer undo/redo in context? I'm guessing no.. I'm pretty sure the situation is as described: https://stackoverflow.com/questions/15516218/how-to-handle-undo-redo-event-in-javascript\nI think a PR adding the documentation you desire would be helpful, certainly! :). What is a roll-back in this context?. Yup, at least one: https://github.com/codemirror/CodeMirror/issues/3878\nOn Thu, Dec 7, 2017 at 10:29 AM, Adrian Heine n\u00e9 Lang \nnotifications@github.com wrote:\n\nI just verified that Scala and Swift indeed support nested block comments,\ncurious. Are there any other languages (in CodeMirror) that do that?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/5096#issuecomment-350053946,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAlbyJClzlRi0zH7bdX9g-a9MxIWgkswks5s-C6AgaJpZM4QrQef\n.\n. Thanks so much, Adrian.. No prob. We'll try to make some time to figure this one out.. The console reports that editor.display.barWidth is 0. I take it that this is incorrect?. I can also confirm that plugging in a mouse (which uses the more typical \"simple\" instead of \"overlay\" type of native scrollbar) causes barWidth to be 15, instead. Without a mouse, it is 0.. I managed to work around this a bit by applying padding-right to the CodeMirror instance to force the editor to not place characters near the scrollbar zone.. Great catch. I've just applied your suggested fix.\n. you don't need these anymore right? as long as the hardcoded linecomments are set below for just less/scss?. Doesn't really seem necessary. We're just trying to signal that an option was missing. We could return a hash signalling error, but this changes the least of the original code without requiring try/catch blocks.. \n",
    "velosipedist": "Here is official gude to basic \"Mappings\" markup ways.\nIt says that Mapping key even not have to be escaped, just inserting space after it\n\nMappings use a colon and space (\u201c: \u201d) to mark each key: value pair.\n\nSo even this example should be valid.\nAlso mappings have JSON-like \"flow\" format, but have no clarifications about space-folowed keys.\nThis example will raise parse error if we remove quotes from key.\nTherefore, it can still rely on exact JSON parsing algoritm (where quoting of keys is always required).\n. Just tried, thanks :)\nThis case\nyaml\nga:metrics: somevalue\n\"ga:visits\": quotevalue\nparsed correctly now :ok_hand: \nBut flow formats behaves differently:\nyaml\n{ga:metrics: value}\nis highlights ga:metrics as key. Expected intuitively, but broken on parser example.\nIf flow-map is sub-item of global document, it's keys became unhighlighted:\nyaml\nga:visits: {subkey: 123}\nsubkey is plain text colored in Codemirror, but expected to be colored as key. :confused: \n. okay, thanks. Maybe make sense to rewrite this mode or use existing parsing solutions like https://github.com/nodeca/js-yaml package.\nBTW, it also uses Codemirror as demo editor engine. \n. ",
    "Miaonster": "Yes, it's a duplicate of #1642 . And it's fixed after upgrading to the latest Chrome 28.0.1500.95. I'll close this issue. @marijnh , Thanks for your reply.\n. ",
    "ingorichter": "Would somebody please review this PR? This is required for a story in Brackets/Edge Code by the end of this week. Thank you!\n. Got it! Thank you very much.\n. ",
    "nadavkav": "rtlMoveVisually helped me.\nThanks :smile: \n. ",
    "bchintx": "Nice!  Looking forward to getting these new properties!\n. ",
    "pmamat": "Hi Marjin,\nI like your additions to reset the cursor position and scroll back within the site.\nBut: How did you solve the issue you gave in #1490? ...aha, I see. The trick is \"position: fixed\" -- I didn't think about this. That's much more easier than angelozzer's and my suggestion!\nI'm going to try it out.\nPhilipp\n. Hi Marjin,\none more comment:\nIs there a reason why you did not add the functions setFullscreen(cm) and setNormal(cm) in the CodeMirror's scope?\nPhilipp\n. All good things come in threes...\nYour suggestion does not work if the CM's size (width / height) is given in a CSS file included after the addon's one or defined on the page. I think it would be better to set cm.getWrapperElement().style.width and height to \"auto\" and reset it to \"\" in setFullscreen and setNormal!?\nPhilipp\n. ",
    "ciaranj": "Thank you, looks good to me ;)\n. Hmm, the merge appears to be behaving oddly now, what is the correct way to programaticaly set values in the two merge panes?  I'm using:\nthis._mergeViewer.right.orig.setValue( 'foo' );\nthis._mergeViewer.edit.setValue( 'bar' );\nWith my previous patch things were working as I expected them to (I believe), now (without ever touching the new showDifferences option, the differences are sometimes out of date, or not shown at all.  (If I type in the edit window explicitly the differences  are corrected immediately)\n. Yeah, I guess things didn't work correctly (for my perhaps obtuse use-case of wanting to programmatically update what the current edit pane is comparing against).  Please see the pull request in #1771 :)\n. Hmm, ironically I spent a painful amount of time attempting to match the existing style, I'm guessing what you're referring to is '..' rather than \"..\" as everything else appears equivalent to what I could find in there already ?\n. Ok, thank you for the clarifications on your preferred styles, perhaps https://github.com/marijnh/CodeMirror/blob/master/CONTRIBUTING.md  would benefit from some additions to the coding standards sections? I naively assumed that if the linter was happy then the code was acceptable, I shall bear this in mind in the future though :)\n. That would work, yup (hadn't actually considered that!)  :) Still its always preferable to have less stuff actually in the DOM in general ?  Don't mind either way (tested that CSS would work for me,and it does!)\n. ",
    "rhiokim": "Did you test on the MacBook?\nI've tested in other environments only occurs in the MacBook keyboard & wireless keyboard\n\n. Thanks @marijnh @parisk \nWell indeed.\nI should maybe just at the code level debugging.\n. ",
    "pyrotechnick": "I figured I'd done this incorrectly. It was more of a heads-up. Thankyou.\n. ",
    "rohanbhangui": "okay thanks will look into it\n. @marijnh: one last question: other than using setValue to clear a codemirror instance: what is an alternative\n. ",
    "santec": "The old oracle mime type had a separate list for functions. I forgot them when I merged the oracle mode into the sql mode, sorry.\nMime types I created/modified recognize just a few functions, and highlight them like other keywords (\"keyword\"). Editors I know do the same thing.\n. IMO, 3. However marijnh decides\n. As far as I remember, the indentation code is from the old MySQL mode. I never looked at it\n. ",
    "alicoding": "OS both tested and breaks.\nOS X Mavericks (10.9)\nMountain Lion (10.8)\nChrome Version 29.0.1547.65\nAlso Safari, Opera as well.\n. Tested again with Mac OS X 10.8 and Windows 8 on Chrome stable 64 bit and they breaks on that Thai language.\n. So I was going to do what @marijnh was asking and found out that jsbin also have the same issue (and I believe jsbin.com uses codeMirror as well)\nI have tested with Chrome stable, Canary, Opera, Safari and all broke except Firefox.\nBelow is the video to demonstrate the problem.\nhttps://dl-web.dropbox.com/spa/n5v3bx9nnjkdpzf/codemirror.mp4\n. Wondering if there is any update or workaround to this bug yet?\n. ",
    "niftylettuce": "Same issue here\n. I still have same issue, if you set a custom font, like Inconsolata, the line height or cursor positioning is way off (until you start to make some interaction/typing/clicking in the textarea rendered into .CodeMirror class.\n. \n\n. @marijnh @srawlins Can we please update documentation here https://github.com/codemirror/CodeMirror/blob/master/demo/mustache.html? \nmode: {name: \"handlebars\", base: \"text/html\"}\n. We need to document this capability more apparently, I had to dig deep for it... should be in a FAQ somewhere so it easily shows up on Google when you search \"codemirror custom font size\"...\njs\ncm.getWrapperElement().style.fontSize '24px';\ncm.refresh();\n. @marijnh can you please document how to set custom font size and family properly?  can't get it working still.\n. ",
    "brettz9": "Thanks for the merges... Btw, do you want a pull request to change getAnnotations() when in async mode to put the updateLinting callback at the end? https://github.com/marijnh/CodeMirror/blob/39016dee813ff3232cd5eddebcab4253e92d5acd/addon/lint/lint.js#L113 \nI didn't see that async in use anywhere, so I was assuming it should be safe to move that argument to the end so as to parallel the newly merged commit where options would be the second argument in both?\n. Sure! Have been away from CM for a while, but really impressed with how steadily you continue to make progress with it.\nBtw, FYI, I've gotten CodeMirror integrated into https://github.com/brettz9/webappfind . This basically lets a person double click a file on their desktop (currently Windows only) or use \"Open with...\" to send a command to a Firefox add-on which in turn allows a web app (determined by file extension, protocol registration or a filetypes.json file kept in the same directory as the chosen data file) to read the contents of that file (and, if so designated, to have the ability to save modifications back to disk)--but without exposing any other privileges (including access to other files) to the web app. I have a number of demos, many of which are using CodeMirror (e.g., so one can work anywhere on their desktop yet open up JavaScript, CSS, etc. files in their web app of choice).\n. Cool, thanks. I've made a note to update whenever I may get non-Windows bindings added...\n. Do you mean you don't want the user to have to go through an extra build step or you don't want a pre-built file? I'm only doing the latter.\nSince asm.js uses CommonJS modules (synchronously), it requires something like browserify to get it working in the browser. I provided the comment in the code about the browserify \"build step\" just for anyone who cared to update it to use the latest asm.js code, not that anyone has to build it themselves. I already included the pre-built version along with the one-line raw version, and if I added it to a CDN like http://cdnjs.com/ , I'd need to prebuild it there myself as well.\nSimilarly, if I added its own nested package.json file, if that's what you're suggesting, it will still require a browserify step (and I suppose require manual npm installation if the dependency is not specified in the root of CodeMirror (?)).\n. Ok, it looks like I should be able to use the \"scripts\" field in package.json to automate the browserify step when npm is being used--can I add such to the main CodeMirror package.json or do you wish the user to have to additionally run npm install within the asm lint directory?\nAlso, as far as the specific value for \"scripts\", the docs suggest avoiding the action at \"install\" time in favor of \"prepublish\" time so that, if asm.js and browserify are stated as devDependency's, users won't have to have them downloaded on their behalf while still getting the resultant file installed. I think this will avoid the blob needing to be part of the repo (and it can be .gitignore'd to avoid it accidentally getting committed) but it will be available for those installing the published npm version. Sound right?\n. Ok, then assuming a nested package.json file does not automatically get built when a parent is built, can I instead put my own package.json file inside an asm lint directory (with just the CommonJS shim file and registerHelper code) with normal \"install\"-time dependencies for asm.js and browserify? That way, normal CodeMirror users won't have to wait through a build step, but those interested can simply run npm install . inside the ASM lint directory without needing to find dependencies themselves or ensure they are naming the built file correctly.\n. Ok, sure. I guess I can add CM within peerDependencies using the major version, 4.* since there should be no breaking changes in the APIs until the next version if you're using semver as expected by npm...\n. Ok, added to https://github.com/brettz9/asm.js-lint / https://www.npmjs.org/package/asm.js-lint and mentioned at https://github.com/marijnh/CodeMirror/wiki/CodeMirror-addons . I decided against using peerDependencies, since it added CodeMirror as a child of the plug-in, whereas I'd figure most people would want to install the plug-in within CodeMirror (your .gitignore already ignores node_modules, so the user is safely prevented from accidentally committing the installed asm.js lint code to a CodeMirror repo).\n. Actually, I just noticed you do buble processing... I'll file a separate PR to add to your Rollup then to create an ES6 distributed build, as recommended practice is to ensure the distributable is fully ready to use even for ES6 modules.... It makes the code easier to grasp at a glance.... I've rebased and reverted to Buble; I reported the issue with array destructuring at https://github.com/Rich-Harris/buble/issues/152\nI also added package-lock.json to .gitignore to make clear your desire it not be added (though I personally find it helpful to know everyone is working against the same versions unless they wish to explicitly override).\nBtw, are you open to a PR for ESLint and config that matches your current (intentional) conventions?. Ok, re: ESLint and re: package.json. I added contributors merely to get rid of the linting warnings I have for my package.json linter, and if I spent the time searching for who the others were, I would have wasted time because, as confirmed by your answer, I suspected you are pretty particular about how you want things, or rather, how you don't want things. Sometimes one makes a tentative PR and then without wasting a lot of time, get feedback to adjust accordingly; I would obviously add them if you had wanted the field.\nAs far as the modes/add-ons, would you be interested in my refactoring them as ES6 modules?\nUntil such time as dynamic import is available (so that one would merely need to pass the mode/add-on names to some CodeMirror method), one could perform static imports which may be imported and then passed the CodeMirror instance, e.g.,\njs\nimport CodeMirror from '...';\nimport cssMode from './modes/css/css.js';\ncssMode(CodeMirror);\nOne would be able to express the source as ESM now and at least the source would be theoretically future-compatible even if you desire torecommend the cleaner dynamic import-based API in the future.. Okedoke, makes sense... I've amended the commit (and the issue summary) to minimize the scope... The one package.json meta-data field I thought should at least be kept was changing maintainers to author as it looks like that is how it is supposed to be expressed, with the docs merely mentioning that \"npm also sets a top-level \"maintainers\" field with your npm user info.\". No worries... I had a cold today limiting what I could do anyways and just thought I'd do something light with the intent of using it down the road; but glad to hear full module support is apparently all part of the plan even if my help wasn't needed in this form.\nI've amended to remove the minified files... Let me know if you would like me to remove the sourcemaps change as well for the non-minified lib file. Even for non-minified files, they can be useful for debugging (esp. development work that needs the option of looking back at the specific source files).... Ok, amended... That look all right?. ",
    "flyskyko": "I have a problem with korean also. in my case is on IE.\ncontenteditable is still have a problem. it drops a character.\nfor example, I try input a '\ud55c\uad6d'.\ncomposition start with '\u314e', and then '\ud558', and then '\ud55c' and composition end.\n'\ud55c' is show in editor. but next letter '\u3131' is dropped.\nI found a solution when using a textarea.\njavascript\nif (!cm.state.focused || /*(hasSelection(input) && !prevInput) ||*/\n    isReadOnly(cm) || cm.options.disableInput || cm.state.keySeq)\n  return false;\nwhen korean is composition, IE make a selection on composition character.\nso, I remove a one of condition. (hasSelection(input) && !prevInput).\n\n. http://codepen.io/anon/pen/wBbyeW\nIn MacOSX Chrome:\n\nIn Windows Chrome:\n\nIn Windows Chrome, event fired keydown, input, input, keydown, input. Is this a clue?\n. It seems ok for a my custom hint function. But I think that Up and Down also works like Enter.\n\nAlthough my problem is solved, complete demo still has a problem.\n\n. I notice that different behavior between VM and native windows.\nFirst Korean word is not display until write a non-Korean letter and some of composition underline is not removed on native windows.\nHere is on native(Windows7 IE11):\n\n. ",
    "zakdances": "Sorry for my tone. I was inferring that it'd be great if ModeRunner returned the same kind of token object as cm.getTokenAt, but now that I know there's no nesting information, I guess there's no point.\nI'm surprised that CodeMirror does not keep track of lineage. I guess if the goal of CodeMirror is simple syntax highlighting, it's not necessary, however I think there's many great use cases to have a more robust parser. I'd love CodeMirror not only to keep track of simple tokens such as .myClass, { and } but also \"compound\" tokens such as\n```\n.myClass {\n}\n```\nI don't want to clutter up the issues tab here, so would the mailing list be a more appropriate place to discuss this?\n. That looks great, thanks for the commit.\n. I do read the documentation. What part of your link are you inferring is an answer to this issue?\nAre you referring to pre-change coordinate system of the \"from\" and \"to\" objects? Because In using the text array and\ntext is an array of strings representing the text that replaced the changed range (split by line\nso how does that explain why the text array consists of three empty strings?\n. My mistake, I meant closebrackets.js. Ok, I think understand what you mean when you say split by line. Each item in the array represents a new line, even if it's empty, correct?\nHowever, there is still the matter of the indentation on the second line of the change. It is not represented in the array. Could something like a \\t be added to the appropriate index in the text array so it can be represented? \n. @marijnh Have you had a chance to confirm whether or not the change event receives the tab/spaces that closebrackets.js generates on the second line after explosion? If not, can I help by creating a simple test case? What would be the best way to make & share that?\n. Hmmmm...ok I'll see if I can recreate that. Thanks for testing it out.\n. It may not be exactly what you're looking for, but if you're an AngularJS user there is a premade module available. You can then declare and inject CodeMirror addons in the same way (as AngularJS modules, factories, or services).\n. ",
    "tomchiverton": "Any update ?\n. On IE10/Win8.0 the cursor and any new test work fine.\n. That's IE11, and doesn't occur in IE10 where as this does - see my comment on the issue. It might be the same underlying issue I suppose.\n. Still breaks on v3.20\n. ",
    "benbro": "@blackvladimir\n@solin\nIs it OK to include the Octave CodeMirror mode from the PR above in CodeMirror?\nThanks\n. Please consider adding RTL support on a line level and not just document level.\nIt's common in text editors to define the text direction and alignment per line.\n. ",
    "blackvladimir": "It is OK to include it.\n. ",
    "vdecree": "I found the issue was caused by another one of the stylesheets being included in the project. I've yet to find the line causing the issue but i think i can find it and fix the problem. Thank you\n. Sorry mis-clicked there. There must be a style changing something on the textareas that could cause issues for Codemirror, i will post what i find.\n. ",
    "ajvincent": "Tough to answer, @MattSturgeon , since the best resource we have is the cm-internals set of pages.  I'd say less detailed than that, for sure (though it's interesting reading - many links to those pages from the overview would be good).  I'm really thinking this ought to be about the major pieces - elements, module files, and techniques, etc. - but not diving deep into details.\nI'd say start with a typical use case scenario:  say, I've got this block of HTML markup in a textarea, and I want to see how CodeMirror transforms it into an editor.  Then walk us through the major steps involved in how that editor is built, and how it reacts to a keystroke, for instance.\n. I ran a quick test, and setting the disabled=\"disabled\" attribute on at least one of the hidden textareas associated with CodeMirror seems to fix tab order when readOnly is set.  I'm not sure which one, and it may require more than one.\n(Though of course removing the disabled attribute would be prudent when CM isn't read-only.)\n. ",
    "maxnordlund": "Another thing I would like to know is how/why the rendered DOM looks the way it does. Do you absolutely position everything and avoid all nesting, or do you try to keep the DOM similar to the language AST, or some completely different approach? And more importantly, why?\n. ",
    "shreevatsa": "For anyone else who runs into this: you may want to first read these two pages, which though apparently out-of-date are highly informative (thanks @marijnh for writing them up!):\n\nhttps://codemirror.net/1/story.html (from May 2007) (\u201c Implementing a Syntax-Highlighting JavaScript Editor\u2014In JavaScript / A brutal odyssey to the dark side of the DOM tree /\u201d)\nhttps://codemirror.net/doc/internals.html (from Nov 2011) (\u201c(Re-) Implementing A Syntax-Highlighting Editor in JavaScript\u201d)\nAnd then of course http://marijnhaverbeke.nl/blog/#cm-internals (Sep 2012 \u2013\u00a0Oct 2014, so far)\n[Maybe also http://marijnhaverbeke.nl/blog/#prosemirror , currently two posts from July 2015]\n\nOr maybe I'm just the weird one who enjoys reading historical documents. :-). ",
    "marlun": "This is happening to me now on http://codemirror.net/demo/vim.html I can repeat (hold down) keys like the arrow keys but if try hjkl movements they do not repeat. I'm on OSX 10.9.4 and I've tried in Firefox 33.0a2 and Chrome 36 (stable).\n. I had https://pqrs.org/osx/karabiner/ installed and key repeat was working for me using other apps on OS X but I had not executed the command above but now when I have and I've restarted my computer, key repeat works in codemirror too.\n. ",
    "as3boyan": "I mean that when popup is shown, completion generated once, and each time it shows it call generation again. Maybe there is a way to change that delay? Because when I type it blinks all time.\n. I don't like it, and I need to get completion list from Haxe completion(Just list of completion in XML format) only once. Even if I use some completion like anyword-completion - it will generate completion list every time I type something - that is the waste of CPU resources - I could use it in another way. But maybe for such things CPU impact is very small, I haven't tested performance.\nAbout blinking - I just don't like it, you know any blinks kinda distracts me, I want to see it smooth. Most IDEs show it without blinking. \nI don't know why, but this thing annoys me pretty well. Anyway - I included show-hint.js from old version of CodeMirror to index.html page, instead of using latest show-hint.js.\nhttps://github.com/misterpah/hide/tree/master/bin/includes/js/codemirror/addon/hint\n. @marijnh I tried latest CodeMirror on it's website, it seems like completion is not blinking anymore, right? It's great!\nIt's great so I can finally use latest show-hint.\n. Thank you, @marijnh, works perfectly!\n. @marijnh I will try.\n. It was caused by error when CM was trying to parse(using regex search) \"Buffer\" instead of String.\nBecause I didn't specified encoding, node.js returned Buffer.\nSo with specified encoding it works fine.\njs.Node.fs.readFile(path, js.Node.NodeC.UTF8, function (error:js.Node.NodeErr, code:String):Void\nOr another solution that works - convert buffer to string:\ndata.toString(), where data is instance of Buffer.\nSorry, anyway I hope that this report could help people to find such bugs.\n. Commit 3364250\nUncaught TypeError: Object #<Object> has no method 'on' linkedmode.html:62\nI tried older commit.\nLooks like multiple cursors. But it's just a demo.\nThis one by @angelozerr, looks great, and provides contextual info\nhttp://codemirror-java.opensagres.eu.cloudbees.net/xquery.html\nhttps://github.com/angelozerr/CodeMirror-XQuery/wiki/Completion-with-Templates\nhttps://github.com/angelozerr/CodeMirror-XQuery/tree/master/codemirror-extension/addon/hint\n. \nStops on ${cursor}.\nreused code form CodeMirror-XQuery(by @angelozerr)\nhttp://as3boyan.github.io/\nSeems like idents work pretty badly, maybe Haxe mode needs fixes... Or maybe I'm missing something.\n. Done in https://github.com/marijnh/CodeMirror/pull/2450\n. Or I should add definition for each expression? I don't think that this is good solution, but if that is the only solution... I can try then.\nBTW: it works in a same way for while loop in JavaScript mode.\nFirst animated image should show for (i in 0...10), anyway it works in a same way.\nSame thing for conditionals in Haxe:\n``` haxe\nif flash\nend\n|\n\n``\n. It seems like it's very hard to modify current Haxe mode, it seems like it's easier to copy JavaScript mode or clike mode and add some things from Haxe mode.\n. Actually it's not only when I use it with auto-closing brackets, I got same thing when I paste code snippets and usecm.indentLine`. But it might be connected somehow.(I use closebrackets addon there too).\nHere is the live demo:\nhttp://as3boyan.github.io/\nTry to insert for loop from code snippets completion.\nIn regular mode, when I type for (i in 0...10) and hit enter, it increases indent level. I would prefer to not do this. So I think about re-basing Haxe from JavaScript mode to avoid such cases... If you have better idea please let me know...\n. I got same issue even without \"closebrackets\" addon for code snippets\n. You right, I fixed title. I wonder can it check if < in string...\n. I can't catch it. It simply gets ignored.\nI tried binding to \"'('\" as experiment = doesn't work too. But \"')'\" - works fine.\nSeems like CM waits for all these actions(closing brackets) to finish...\n. And attribute=\"|\" completion doesn't works too for this case.\n. #2599 - this is the fix for xml-hint to make it work for case attribute=\"|\"\n. I just added this to mbo\ncss\n.cm-s-mbo .CodeMirror-foldmarker {\n  color: blue;\n  text-shadow: #b9f 1px 1px 2px, #b9f -1px -1px 2px, #b9f 1px -1px 2px, #b9f -1px 1px 2px;\n  font-family: arial;\n  line-height: .3;\n  cursor: pointer;\n}\n.cm-s-mbo .CodeMirror-foldgutter {\n  width: .7em;\n}\n.cm-s-mbo .CodeMirror-foldgutter-open,\n.cm-s-mbo .CodeMirror-foldgutter-folded {\n  color: gray;\n  cursor: pointer;\n}\n.cm-s-mbo .CodeMirror-foldgutter-open:after {\n  content: \"\\25BE\";\n}\n.cm-s-mbo .CodeMirror-foldgutter-folded:after {\n  content: \"\\25B8\";\n}\nI am wondering how this css affects visuals? Is this a marked text color or something?\ncss\n.cm-s-mbo span.cm-searching {\n  background-color: none;\n  background: none;\n  box-shadow: 0 0 0 1px #ffffec;\n}\n. I was able to fix it by setting alpha to 0.3:\ncss\n/* .cm-s-mbo .CodeMirror-matchingtag {background: #4e4e4e;} */\n.cm-s-mbo .CodeMirror-matchingtag { background: rgba(170, 170, 170, .3); }\nFull css for updated mbo theme(with adjusted colors for foldgutter):\n``` css\n/ Based on mbonaci's Brackets mbo theme /\n.cm-s-mbo.CodeMirror {background: #2c2c2c; color: #ffffe9;}\n.cm-s-mbo div.CodeMirror-selected {background: #716C62 !important;}\n.cm-s-mbo .CodeMirror-gutters {background: #4e4e4e; border-right: 0px;}\n.cm-s-mbo .CodeMirror-linenumber {color: #dadada;}\n.cm-s-mbo .CodeMirror-cursor {border-left: 1px solid #ffffec !important;}\n.cm-s-mbo span.cm-comment {color: #95958a;}\n.cm-s-mbo span.cm-atom {color: #00a8c6;}\n.cm-s-mbo span.cm-number {color: #00a8c6;}\n.cm-s-mbo span.cm-property, .cm-s-mbo span.cm-attribute {color: #9ddfe9;}\n.cm-s-mbo span.cm-keyword {color: #ffb928;}\n.cm-s-mbo span.cm-string {color: #ffcf6c;}\n.cm-s-mbo span.cm-variable {color: #ffffec;}\n.cm-s-mbo span.cm-variable-2 {color: #00a8c6;}\n.cm-s-mbo span.cm-def {color: #ffffec;}\n.cm-s-mbo span.cm-bracket {color: #fffffc; font-weight: bold;}\n.cm-s-mbo span.cm-tag {color: #9ddfe9;}\n.cm-s-mbo span.cm-link {color: #f54b07;}\n.cm-s-mbo span.cm-error {background: #636363; color: #ffffec;}\n.cm-s-mbo .CodeMirror-activeline-background {background: #494b41 !important;}\n.cm-s-mbo .CodeMirror-matchingbracket {\n  text-decoration: underline;\n  color: #f5e107 !important;\n }\n.cm-s-mbo .CodeMirror-matchingtag { background: rgba(170, 170, 170, .3); }\n.cm-s-mbo span.cm-searching {\n  background-color: none;\n  background: none;\n  box-shadow: 0 0 0 1px #ffffec;\n} \n.cm-s-mbo .CodeMirror-foldmarker {\n  color: blue;\n  text-shadow: #b9f 1px 1px 2px, #b9f -1px -1px 2px, #b9f 1px -1px 2px, #b9f -1px 1px 2px;\n  font-family: arial;\n  line-height: .3;\n  cursor: pointer;\n}\n.cm-s-mbo .CodeMirror-foldgutter {\n  width: .7em;\n}\n.cm-s-mbo .CodeMirror-foldgutter-open,\n.cm-s-mbo .CodeMirror-foldgutter-folded {\n  color: gray;\n  cursor: pointer;\n}\n.cm-s-mbo .CodeMirror-foldgutter-open:after {\n  content: \"\\25BE\";\n}\n.cm-s-mbo .CodeMirror-foldgutter-folded:after {\n  content: \"\\25B8\";\n}\n```\n. If it's ok, then I can create pull request for this change.\n. ",
    "nwidger": "The purpose of this commit is to make the search/dialog addons more flexible.  For the dialog addon, we needed to be able to control under what conditions the dialog will close.  Previously, it would close on hitting Enter/Escape or when the blur event fired.  The options.closeOn array allows the user to override this behavior.\nFor the search addon, we wanted to be able to control the search behaviour using buttons inside the search dialog and have the search term update as the dialog's input value changed.  Being able to pass dialog options through the search addon with options.dialogOptions allows for this.  The options.onButtonClick function in the dialog addon allows the search addon to define a handler that runs findNext/findPrev from within the search dialog.\nAny feedback would be appreciated as we're very interested in getting these changes (or something equivalent) merged upstream.\n. Just for a concrete example, with this commit you could have a 'Find' button on a page with the editor with a click handler such as:\n``` JavaScript\n    var queryDialog = 'Search:  ' +\n        'Previous ' +\n        'Next ' +\n        'Close';\nvar findOptions = { queryDialog: queryDialog,\n                    dialogOptions: { closeOn: ['Esc', 'click'] } };\n\n$(\"#find-button\").click(function() {\n    CodeMirror.commands.find(editor, findOptions);\n});\n\n```\nClicking Find would generate a search dialog with three buttons Previous, Next and Close which function as expected.  Because closeOn doesn't contain 'blur', you can Tab between the input field and the buttons.  Pressing Enter doesn't close the dialog when you start a search since closeOn doesn't contain 'Enter' (but it will close on 'Esc').  This is the kind of behavior we'd like to be able to achieve.\n. Perhaps we could modify the dialogDiv function to use a different wrapper element than cm.getWrapperElement()?  That could be an element ID passed in through options.wrapper or something.\nAs for multiple dialogs, one solution would be to store state is something like cm.state.dialog and just prevent more than one dialog to be open at a time.\n. Just wondering if you have any further comments on this patch or what can be done to possibly merge it.\n. Thanks for taking a look at this one.  The patch doesn't seem to fix the problem, though.  The jsbin link example from my previous post still throws the same error despite it loading a copy of merge.js that includes the patch:\nUncaught TypeError: Cannot read property 'parent' of null codemirror.js:6491\nlineNo codemirror.js:6491\nchangeLine codemirror.js:3674\n(anonymous function) codemirror.js:4017\n(anonymous function) codemirror.js:1987\nclearMarks merge.js:173\n(anonymous function) merge.js:186\nrunInOp codemirror.js:1971\nCodeMirror.operation codemirror.js:4217\nupdateMarks merge.js:184\nupdate\nalthough perhaps it took a few more iterations before the error was thrown, but that could just be me being impatient. :) Please let me know if I can provide any more info, not sure if you've been able to reproduce this yourself or not.\n. Still throwing an error, but now it's coming from the condition of that else if.  Seems like mark itself is null:\nUncaught TypeError: Cannot read property 'parent' of null merge.js:172\nclearMarks merge.js:172\n(anonymous function) merge.js:186\nrunInOp codemirror.js:1971\nCodeMirror.operation codemirror.js:4217\nupdateMarks merge.js:184\nupdate\n. Success! Thanks so much for taking a look at this, the latest patch seems to have made the error go away.  Do you think you'll be doing a release soon or should I just plan to add the patch manually for now?\n. ",
    "soaserele": "A piece of modified code from http://codemirror.net/demo/xmlcomplete.html as example:\njavascript\n      var dummy = {\n        attrs: {\n          color: [\"red\", \"green\", \"blue\", \"purple\", \"white\", \"black\", \"yellow\"],\n          size: function(cm) {\n              var result = [\"large\", \"medium\", \"small\"]; // Let's say this array was dynamically generated\n              return result;\n          } ,\n          description: null\n        },\n        children: []\n      };\n. ",
    "fflorent": "Hi,\nIs the last commit okay?\nFlorent\n. Do you have any date (or idea of date) for the next release?\nFlorent\n. Okay, nice! Thanks!\nFlorent\n. ",
    "tger": "OK, no problems. Sadly, right now not even the ES6 spec seems to offer the needed Unicode support.\nAnyway, for my client use case (Swedish) all I need is 6 additional characters, so trivial local patch for me.\n. ",
    "jackycute": "Hi, I found this problem too.\nAnd it's not only happen in hyphenated text but also in a very long text on wrap mode.\nThen, we can't click to move the cursor to the end of wrap line, or even select to it.\n\nAlso found related issue in brackets, but seems they made some work arounds.\nhttps://github.com/adobe/brackets/issues/5408\n. No, desktop version using \"contenteditable\" input type won't cause this, but using this mode in Chrome is extremely slow, I don't know why.\nBoth Input types in desktop version are fine, very cool.\nThe good new is, I found I can debug on mobile via Safari, which my iPhone connected to my Mac.\nLet's talk about \"textarea\" mode in mobile first.\nThe real problem is, when I input in composition, the backspace action didn't trigger any composition event, and instead, CodeMirror found I click the backspace and clear its textarea, which cause the built-in autocomplete failed and lost focus to where I didn't know.\nThen I need to click finish on my keyboard and click to another line to type again.\nbtw, there is a built-in blinking cursor in iOS Safari, which sometimes not at same position as CodeMirror's cursor.\nThen, I checked the \"contenteditable\" input type on my iPhone, it was quite interesting.\nWhen I type in composition like Bopomofo, as I previous mentioned, it just show them but not combine to the Chinese word I want.\nBut if I click the built-in keyboard for auto complete, it can input the auto complete Chinese word!\nAnd the console bump for three event: compositionstart, compositionupdate, compositionend in a time.\nSo, I go find is there a event firing specifically on auto complete, then I found input event on contenteditable.\nIt will fire twice input when I click on the auto complete word.\nIn the end, I inspect the keydown event, it only receive event which keyCode is 0 when I type Bopomofo. \nSame as Japanese input on iPhone safari.\ninput.forceCompositionEnd is not called ANY at both input types and both languages.(Or maybe I inspect it in a wrong way)\nIn Bopomofo(it's Tradition Chinese), if you type \u310b\u4e00, it should show several items included the \u4f60 on the built-in keyboard's auto complete list, and you choose which you want to input the word, much like Japanese.\nHope these tests will help you, it's so confusing why mobile browser behave so strange.\nBut in the example of the html5doctor, I am completely fine to type Chinese and Japanese there.\nhttp://html5doctor.com/the-contenteditable-attribute/\nThank you again!\n. Tks! @lackneets \n. Thank you @marijnh !\n. Thank you very much!\n. Thanks a lot! OMG, You guys are so awesome :+1: \n\n. +1\n. Thanks for explanation :smile: \n. @leeoniya Thanks for heads up!\n. This might related to https://code.google.com/p/google-diff-match-patch/issues/detail?id=67. I know, just as a reminder \ud83d\ude04 . ",
    "akkatracker": "Does anyone know if this is going to be fixed?\n. ",
    "squirrelyscoutz": "I discovered an acceptable workaround\nWhen the cursor is above the problem line (in my case line 31) and I hit enter twice the line then becomes available for me to interact with (moving my code to line 33). I can update my code as needed then delete the two extra spaces (returning to line 31) and move on as expected.\n. ",
    "Sarseth": "Newest Chrome here, 100% zoom, no weird plugins. Happens every time when I go to another challange and try to write on page for first time. Everytime. Have to click false \"ENTER\" then ctrl+z to work normally.\n. ",
    "HamerWV": "It is March 25 2017, having the same problem.  Windows 10 and Chrome.  Have not figured out a way to stop it from happening.  Just annoying.. ",
    "sogen": "+1. ",
    "joelmoss": ":+1: \n. :+1: Great stuff!\n. :+1: \n. Ah my bad. This is related to the CSS file loading order. Cheers!\n. nope. sorry.\n. ",
    "znap026": "@brandonwamboldt I think its still broken i have your fix in my version and it's still doing the same. even in the smartymixed index.html example. and on http://codemirror.net/mode/smartymixed/\n. Thanks just to ask is there a way to get the correct syntax highlighting without putting  at the top?\n. Ie set the mode to \"smartymixed\" but it even does it on the demo page just\ndelete everything before the body tag and its broken as before. thank for\nthe help\nOn 13 October 2014 15:39, Marijn Haverbeke notifications@github.com wrote:\n\nI think you need the mode option:\nhttp://codemirror.net/doc/manual.html#option_mode\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/2832#issuecomment-58901260\n.\n. \n",
    "bogal": "Another vote for this feature.. ",
    "limonides": "Another vote for this feature.. ",
    "neojski": "It looks like this one can be closed due to #1873 which resulted in https://github.com/marijnh/CodeMirror/commit/b510049b57221e27ab09ea068f737ea9805233f4 :-)\n. Yeah, you're definitely right about dcc which clearly is broken in normal mode. I'll try to implement it depending on the mode.\nWhere can I find the documentation that s is defined as cl? Thanks.\n. I think that this problem is not coffeescript related. Go to http://codemirror.net/mode/javascript/index.html, then go to empty line. Click tab. Expected: two spaces. Result: tab. It works the same with other languages too.\n. I still feel that something is not ok. Try writing this:\n```\na = ->\n  alert 'a'\ndecrease indentation level here and hit enter\n# you end up here\n``\n. Strange, since it is fully reproducible by me. Maybe I explained it badly. Do exactly this:\n1.a = ->2. <kbd>enter</kbd>\n3.alert 'a'`\n4. enter\n5. ctrl+[ (decrease indentation level)\n6. enter\nYou end up in the column 3 while I expected column 1.\n. Ah, I see. But I still feel like it's working differently than in any other editors I'm using.\n. ",
    "bausmeier": "Great stuff. Thank you @neojski.\n. ",
    "dignifiedquire": ":+1: Looks pretty sweet\n. Sorry for the noise. I was too stupid to enter paths..\n. @neochief for me the packages directive worked out:\njs\nrequire.config({\n  packages: [\n    {\n      name: 'codemirror',\n      location: '../js/CodeMirror',\n      main: 'lib/codemirror'\n    }\n  ],\n  paths: {\n    jquery: '../../js/jquery/jquery-1.11.0.min'\n  }\n});\nand then you can just do\njs\ndefine([\n  'jquery',\n  'codemirror',\n  'codemirror/mode/javascript/javascript',\n  'codemirror/mode/clike/clike',\n  'codemirror/mode/php/php',\n  'codemirror/addon/edit/matchbrackets',\n  'codemirror/addon/hint/show-hint'\n], function($, CodeMirror){\n  var initialize = function(){\n    var exp = CodeMirror.fromTextArea($('#export')[0], {\n      lineNumbers: true,\n      mode: \"application/json\"\n    });\n  }\n  return {\n    initialize: initialize\n  };\n});\n. Cool thanks.\n. Thanks for the quick answer, setBookmark is exactly what I need.\n. ",
    "mbonaci": "Thanks, I really appreciate that.\nBTW,\n:+1: and a big thank you for making CodeMirror and Tern open source and publishing them under such a permissive license!\nKeep up the good work.\n. I'm doing this in Brackets, and although Brackets is just html+js+css, where can I check out how it looks in the real browser?\n. If I don't put .CodeMirror-focused I get a weird behavior when the Brackets editor is focused:\n\nI don't know how to avoid that default selection color without that. Maybe you can help? I can put both with and without focused?\nSorry about whitespace, I wanted to make it all uniform.\n. You're right. Will do.\nThen I'll clean this up.\nThanks for not freaking out, I gave you all excuses :)\n. I thought you did some work on it, because CSS works beautifully on Codio :)\n\n\nI think the problem is only with Brackets and I don't have time to investigate.\nThanks for everything.\n. Right! \nRemoved.\n. ",
    "hason": "I would like to highlight localized scenarios e.g: http://pygments.org/demo/125534/\n. More problematic is the current status. Some bower implementations e.g. https://github.com/francoispluchino/composer-asset-plugin) install this package into bad directory CodeMirror, exactly as defined in the file bower.json.\n. ",
    "anstosa": "Thanks for the quick turnaround @marijnh. Much appreciated!\n. ",
    "jparmenter": "@bfrohs Is this issue up for grabs? I'm interested in taking it on. I have plenty of questions and would love some help to get this implemented.\n. What a second pair of eyes can do on code I was staring at for a while!\nUpdated my branch based on your feedback. I made a commit with the failing test. Any idea what's causing the test to fail I'll add it back in.\nAlso should I include one of the css changes for tabs? I suppose that can be updated later.\n. -  return null; to return getType(state); Didn't break any tests but didn't fix the strikethrough test.\n-  Non-consuming match broke tests for me.\nI'm fine not worrying about this edge case too much.\nThis pull request should be good to go. Thanks for all the help @bfrohs! I really enjoyed contributing and would be interested in doing more.\n. ",
    "MarcelGerber": "This can be closed now.\n. Please see the comments on adobe/brackets#5913, too.\nYou don't have to use such a difficult regexp to repro this.\n. Yes, you're right.\nPHP tags work in ",
    "jshado1": "Yes, i'll try to get one together this afternoon.\n\n: .\nJacob\nfrende\njacob@frende.me\n. Hiya, sorry I haven't had time to create an example. But just to show what's happening:\n\n. ",
    "getvictor": "I'm seeing this issue as well on 3.16 and 3.19. I have CodeMirror in a resizable div like on jsfiddle.net. When the div is resized, .CodeMirror-gutters does not get resized because it has a hardcoded element height. That element height is only updated when the whole browser window is resized.\nIs there a workaround for this?\n. I disabled hardware acceleration in Firefox and restarted Firefox. However, it did not help -- I was still able to reproduce the issue.\n. Filed a Firefox bug here: https://bugzilla.mozilla.org/show_bug.cgi?id=981442\nHere's an updated video of the issue (where you see the whole browser): https://www.youtube.com/watch?v=TgOWhe8WVho\n. I haven't seen it recently, so maybe it got fixed.\nAlso, I recall seeing a very similar issue on SourceForge commit browser, so this issue is likely not CodeMirror specific.\n. ",
    "malmaud": "Thanks! \n- It's based on python mode (python.js), which used RegExp literals. I replaced them with literals.\n- This is how the original python mode was organized. I think it's to make it easy to ensure that if a one-character operator is a prefix of a two-character operator, the two-character operator still gets identified (e.g., the string \">=\" should get parsed as the single two-character operator \">=\", not two single-character operators \">\" and \"=\". The parser can ensure this just by checking for two-character matches before one-character matches.\n- I took take of all but the below error, which I don't understand. Does 14:2 mean line 14, column 2? I can't see where an unexpected token is.\n  \"mode/julia/julia.js: Unexpected token (14:2) \"\n. Thanks, Marijn! If simplifying the regexps gives a speed improvement, the IPython guys @fperez might be interesting of making the same kind of transportation for python.jl. \n. Great, thanks for looking through this. https://github.com/marijnh/CodeMirror/pull/1900 addresses some of these (exception-handling, floating-point literals, triple-quotes), but still leaves out a lot of operators and keywords. \n. Thanks, I'll get the linter set up locally.\n. Let's hold off on merging until we hear from @StefanKarpinski on which keywords we should highlight. This addresses @stevengj points on PR #1897 \n. How do you feel about highlighting words that are not formally keywords, but are commonly-used functions from Base? Like any, all, printf, open, etc. The IPython notebook highlights some of these.\n. There have been a lot of enhancements to julia.js since the merge with CodeMirror. I'll make sure those enhancements cover these cases and then submit a PR. \n. Ya, that PR would be highly appreciated. \n. Realistically I don't think I'd get around to this for a while.. ",
    "stevengj": "Awesome, thanks!\n. cc: @loladiro, @JeffBezanson in case they want to comment on the parsing rules here.\n. Yes, \ud835\udc1a is in an astral plane (U+01d41a), and it appears that CodeMirror is using 16-byte UTF-16 code units (not Unicode characters) for cursor calculations, since this is how JavaScript indexes strings.  Unrelated to #1813 (combining characters, not surrogate pairs).\nProbably Jupyter needs to convert this to/from Unicode character counts itself (so that it has an encoding-independent index).. There seem to be a lot of missing operators, such as |> or === or .>>> or ::; see the ops-by-prec variable in julia-parser.scm for a full list.\n. A difficulty here is that Julia has an insanely huge builtin namespace (length(names(Base)) is > 1200).  Not sure if there is a good criterion to use for inclusion here.  @StefanKarpinski?\n. This should be [ef], not e, in order to match single-precision literals like 1.2f3.\n. Shouldn't catch or finally also end a block?\n. missing typealias.  See also the reserved-words list in julia-parser.scm.\n. Note also that ... is a special delimiter in Julia.\n. ",
    "polkovnikov-ph": "https://github.com/dmajda/pegjs-website/pull/7\nIn case someone is interested, I've made a pull request to PEG.js website, so that it will use CodeMirror and PEG.js mode. Guys, you rock!\n. That was a bit quicklier than I could expect. Thank you!\n. I found refresh function, which is said to be designed for this. Though, it's very slow.\n. https://github.com/marijnh/CodeMirror/pull/2210\n. .class * rules were used in Bootstrap, so I decided to add the ones which\nreturn browser's default behaviour. The specific problem is that due to\nborder-box rendering line numbers are (roughly) centered in the gutter.\nIt's possible that there're some other problems, including plugin-specific\nones. Forced border-box is not a good idea anyway, and I don't know how\ncould it be fixed to make CM rendering-agnostic.\n2014-02-03 Marijn Haverbeke notifications@github.com:\n\nI don't like using .something * rules very much. Is there a specific\nproblem you are addressing with these? Could we fix it with specialized\nrules?\n\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2210#issuecomment-33930635\n.\n. Reopen it, please. I just didn't have time to polish that source. :)\n. I know about this issue for several years, but as nobody commented I feel like I should. This is not expected and obvious behaviour. Most editors unindent on Shift+Tab.. \n",
    "StefanKarpinski": "Keywords: https://github.com/JuliaLang/julia/blob/master/contrib/julia-mode.el#L86-L90 and sometimes in.\n. ",
    "mick000": "Hi Marijnh,\nThanks. i tried this option of setting $(\".CodeMirror\").css('font-size',\"20pt\"); in a standalone html file, this time around, the font size change was happening fine as expected. But I am using this code mirror editor with Google Web Toolkit panels. Basically I have an application developed using Google Web ToolKit(GWT). I am adding this editor to one of its panels. There the re size is not working fine even if I set it for just .CodeMirror. Any pointers for the same? I guess code mirror should be compatible to be used with a GWT application right?\n. Thanks a lot marijnh. It worked.\n. ",
    "brianporter01": "Marikn:  thanks for the quick reply.  I\u2019ve done some additional testing since my first post.  I have it narrowed down to a simple sequence.  In IE, if I start with a blank document and put \u201cstart\u201d on the first line.  Then return down 5 lines and put \u201cend\u201d.  Then go back to line 3 and press [tab].  Pressing tab will collapse line 3 and 4 together in the editor.  Attached is a screen shot of IE 10 on the left and Firefox 24 on the right.  It does it in IE, but not firefox or chrome.  I also have your sample pages installed and I can not get the behavior to occur on your sample pages in any browser (including IE).  So, there\u2019s something about my page that is enabling this bug in IE.  But, it\u2019s a pretty simple page, so I can\u2019t quite see what it would be yet.  I\u2019ll keep trying to narrow it down.  Let me know if you have any thoughts with this new information.\nThanks.\nBrian\nFrom: Marijn Haverbeke [mailto:notifications@github.com] \nSent: Tuesday, October 29, 2013 4:01 AM\nTo: marijnh/CodeMirror\nCc: brianporter01\nSubject: Re: [CodeMirror] Line numbers / cursor breaking (#1912)\nThere are no special characters in the text you pasted -- it probably got cleaned out somewhere along the way (clipboard, browser, github, who knows). Could you upload the raw file that is giving you the problem somewhere, and give me a link?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/marijnh/CodeMirror/issues/1912#issuecomment-27284045 .  https://github.com/notifications/beacon/Zkcwyev9QzDuwXZhQWxq4qGRKCCmcUtCmF5AJt2BA5OQzzn6zD2rEygJL3AhYrug.gif \n. Marijn,\nOK, I found the issue.  I don\u2019t claim to understand why, but it has to do with the doctype attribute.  My page had:\nhtml PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"\nI looked at your samples and it has:\ndoctype html\nSure enough, when I changed my master page to have the newer html 5  doc type, it worked in IE and all the other browsers.  Then, just for kicks, I went into your index.html page in your docs and changed the doc type there to be the first one, and it created the same IE bug.  If you use this doc type, then in IE hit return a few times, then press [tab] on one of the blank lines, you\u2019ll see it collapse the line numbers together.\nSo, I\u2019m good for now, thanks for the response and engagement on this issue.  The tools you\u2019ve created are very cool and useful!\nBrian\nFrom: Marijn Haverbeke [mailto:notifications@github.com] \nSent: Tuesday, October 29, 2013 4:01 AM\nTo: marijnh/CodeMirror\nCc: brianporter01\nSubject: Re: [CodeMirror] Line numbers / cursor breaking (#1912)\nThere are no special characters in the text you pasted -- it probably got cleaned out somewhere along the way (clipboard, browser, github, who knows). Could you upload the raw file that is giving you the problem somewhere, and give me a link?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/marijnh/CodeMirror/issues/1912#issuecomment-27284045 .  https://github.com/notifications/beacon/Zkcwyev9QzDuwXZhQWxq4qGRKCCmcUtCmF5AJt2BA5OQzzn6zD2rEygJL3AhYrug.gif \n. Nice.  Thanks Marijn.  I\u2019d probably save myself a lot of time if I would just read the documentation.  :-)\nFrom: Marijn Haverbeke [mailto:notifications@github.com] \nSent: Tuesday, October 29, 2013 2:07 PM\nTo: marijnh/CodeMirror\nCc: brianporter01\nSubject: Re: [CodeMirror] Line numbers / cursor breaking (#1912)\nYes, this is a known issue -- IE will enter some pseudo-standard bogus mode when you give it a doctype like that. This is why <!doctype html> is recommended at http://codemirror.net/#browsersupport\n\u2014\nReply to this email directly or view it on GitHub https://github.com/marijnh/CodeMirror/issues/1912#issuecomment-27327995 .  https://github.com/notifications/beacon/Zkcwyev9QzDuwXZhQWxq4qGRKCCmcUtCmF5AJt2BA5OQzzn6zD2rEygJL3AhYrug.gif \n. ",
    "nesl247": "I've got the same issue using IE11 on Win 8.1 via this demo http://codemirror.net/demo/variableheight.html . See line 5. When at the end of the line, the cursor is showing about 8 characters to the right of where it actually is. Only happens for me though when wrapping is enabled.\n. This is definitely the issue I was talking about in #1913, which sounded as close to what I was experiencing, so I commented there instead of creating a new ticket. It does sound like the same underlying bug, but different effect.\n. I believe he's trying to fix a bug that I reported where if you switch tabs, or pull up the find dialog in IE, and go back to to CodeMirror, you can type, but almost nothing will actually be input. Special characters seem to still work, but A-Z, 0-9 definitely don't.\nI reported this issue to Codio, but confirmed it on the CodeMirror demo pages.\n. This is a quote from the Codio forums where I reported this issue to them originally:\n```\nTo help you troubleshoot, I've narrowed it down to 100% being CodeMirror and not Codio's implementation of it. The issue happens on http://codemirror.net/demo/theme.html.\nTo reproduce:\n1) Click into the box at the end of the function block and hit enter\n2) Enter any text (type a bunch of characters, don't copy and paste)\n3) Hit ctrl + f\n4) Close the find box\n5) Start trying to type again\n```\n. This has also been something I've been dealing with. Quite annoying.\n. Ah ok. Thought CodeMirror was handling that.\n. ",
    "ducbin": "Yes, I use typo.js to check the spelling errors. So my solution is:\nvar typo = new Typo(\"en_US\");\nCodeMirror.defineMode(\"checkmode\", function(config, parserConfig) {\n  var checkmodeOverlay = {\n    token: function(stream, state) {\n      var ch;\n      var re_url = /(www.|(ftp|https?):\\/\\/)(-.)?([^\\s\\?.#-]+.?)+([^\\s]*)/;\n      var re_word = /([a-zA-Z]+)/;\n      if( stream.match(re_url)) {\n        return \"link\";\n      }else {\n          var ch = stream.match(re_word);\n          if (ch) {\n              var ch2 = stream.next();\n              if ( ch2 != undefined) if ( !ch2.match(/^[a-zA-Z]+/) ){\n                  if (!typo.check ( ch[0] )){\n                      stream.pos--;\n                      return \"spell-error\";\n                  }\n                  stream.pos--;\n              }\n          }\n      }\nwhile (stream.next() != null && !stream.match(re_url, false) && !stream.match(re_word, false)  ) {}\n  return null;\n}\n};\n  return CodeMirror.overlayMode(CodeMirror.getMode(config, parserConfig.backdrop || \"text/html\"), checkmodeOverlay);\n});\nAnd that works :). What do you think about this solution ?\n. Sorry to disturb you one more times, I have a problem when I type \"ENTER\" to go new line, with the condition\nvar ch2 = stream.next();\nif ( ch2 != undefined) if ( !ch2.match(/^[a-zA-Z]+/) ){\nstream.next()  is undefined, so the last word is not checked.\nSo I know the last typing is \"ENTER\" ? And in this case, stream is for new line, so what I have to do to highlight the last word in previous line (like return \"spell-error\")\nThank you so much\n. But it's same case when you are typing (  stream.next() == undefined too  ), so it's not cool when you're typing and that checks the word not finished\nFor ex: you're typing the word \"understand\", you types each character and that check u, un, und, unde, under ..... With gmail or MS Word, just after you finish typing, that check the word.\nAny suggestion ? How to detect you type \"ENTER\" to break line ?\n. Thank you. I will try\n. ",
    "gabehollombe": "Confirmed, can reproduce as described by @edsharp.\n. ",
    "lukasoppermann": "Jipp, that is exactly what I need to do. It should be possible, write? If you do not flatten the spans all elements have a tag around them anyway. ideally though it would produce a flattened span (all the text in one span only) and on or two spans with the indocator \n<span class=\"cm-indicator\">#</span><span class=\"cm-header\">headline</span>\nor for elements like em, links, etc\n<span class=\"cm-indicator\">**</span><span class=\"cm-em\">text</span><span class=\"cm-indicator\">**</span>\n. Well, that would be even more awesome. \nIt is really important to me, because the users I am expecting will need to get comfortable with markdown, so by making the indicators (or better name) less obvious they can get used to using markdown without being confused by all the indicators. Visually it makes it possible to separate content & structure.\n. Any news yet?\n. Awesome. Looking forward to it. :+1: \n. Thanks for the update, looking forward to it.\n. Hey,\nfirstly thanks for adding this feature. Personally I think every markdown formatting char should have this class. Maybe one does not want to hide the - for lists, but add a different color, to set a focus, or something. I would appreciate if all elements would get this wrapping class. By Default you could not change the highlight color, or change it only for the ones you need it for, but if there is a good use case to change anything about this (maybe the formatting is applied with css but not bullet points, etc.) the user can change it when needed.\nBtw. I can not get it to work, is it not merged yet? Because your commit is still open, right?\n. Did you already get around implementing this?\n. Ahh, yeah no Thanksgiving over here. :) I forgot about it. Looking forward to the changes, once you get to it.\n. Hey, works perfect for me, did you also include @davedawson suggestion? \nI think this could be pretty nice for high quality formatting as well. If not, I will open a new issue. Apart from this, it works like a charm. Thanks a lot for all the effort! Superb.\n. Yep, will do thanks for the awesome help so far.\n. Couldn't you use a normal regex?\n. It does not work fine here: http://codemirror.net/demo/variableheight.html\nLine 21 should be a list item.\n\n. But even though \"* text\" should not make it italic. It should only be italic if it has NO whitespace between the asterisk and the text. At least as far as my test went. \nI also think the parser by John Gruber has an \"error\", because * text * makes the text italic (em) because the second asterisk is seen as a \"character\" this should probably (?) not happen.\n\n. That would be very awesome. I am new to codemirror, but I love it already. :+1: \n. Awesome, thanks for the update.\n. Okay, somehow for me the cm-formatting-list does not work, I pull the latest version of codemirror and my setup is\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"mark\"), {\n    lineNumbers: false,\n    lineWrapping: true,\n    flattenSpans: true,\n    extraKeys: {\"Enter\": \"newlineAndIndentContinueMarkdownList\"},\n    mode: {\n        name: \"markdown\",\n        highlightFormatting: true\n    },\n});\nWhat did I mess up?\n. No, actually the \"error\" occurs whenever I have a headline #header or whatever and a list afterwards without any blank line in-between. Is that by design or a bug? I could not find anything like this specified in the markdown syntax guide but I might be wrong. If it is by design, is there a way to toggle this behaviour? \n. Sorry for the late reply, it works like a charm, thank you very much.\n. Yes, it works fine, now, Thanks for the quick fix!\n. Hey @bfrohs I copied the markdown.js and it works perfectly. Looking forward to the other changes, this will make the styling possibilities so much better. Thank you very much.\n. Hey, so the quotes work perfect.\nBut the link text is still cm-string are you still going to fix that?\nAlso, would it may be possible to change the text class of the list from cm-variable-# to cm-list-text-# if fear it will otherwise clash with other styles when using overlays (I have markdown, js, html and css highlights in one editor, which makes sense for code highlighting).\nIt would be awesome if you could address those things as well. Thanks for the changes so far.\n. Well, I am not writing an overlay, I am just using the other modes with markdown. So I figured if javascript syntax uses variable-2 I will have to style the variable-2 of javascript the same way that my lists are styled, which might not  make sense. (Or do I have an error in my thinking?)\n. Exactly that is what I mean. It is a problem for me, because I need my markdown lists to have a black color, but the source-code is supposed to have colorful (easy to distinguish) syntax highlighting. \nMaybe you could just add an additional class? So one style can apply to everything, but markdown can be styled separately as well? Maybe only if formatting is turned on?\nAnd apart from this, would it be okay to add a class to the link-url in markdown? \n. Personally I just need to seperate markdown from everything else. I think it could make sense to add something like cm-mode-MODENAME to do sophisticated styles, but I personally do not need it for anything but markdown.\nI would argue that markdown is a text-based format while js, html, etc. are more code-base (variables, keys, etc.) so I think it very sensible to use more specific classes for markdown, while using the same key, variable, value, number classes for different \"code-based\" highlights. In my eyes this would justify straying away from the standard classes.\nThank you very much for looking into it.\n. Hey @marijnh, this does indeed solve my problem with it. Did you do a performance test as you suggested?\nThank you very much for adapting this part.\n. Sure, that is what I am doing at the moment, I just figured you probably have that already for the detection of whether an element is for e.g. bold or not. I guess many people could use it to build editing functions and widgets, right?\nI understand if you say it is out of scope for codemirror, I just figured if you do it internally anyway, maybe you can expose this mechanism via the cm. api? I can do cm.getLine why not cm.getWord...\n. Well, this has nothing to do with bold, its just for getting word boundaries. This could be used for anything, like widgets, etc.\n. But this does not fix it, does it?\n. Is there an option to disable this kind of headline?\n. Makes sense for me. \n. Hmm, I did test in chrome. Did you try a version were a scrollbar is added to scroll horizontally? If it is fixed with 4.0 that would be awesome, I will test it.\n. Okay, actually it was a problem with a reset file which set the markdown indicators spans to display inline-block\n. @bfrohs any news on this?\n. Cool, thank you very much, I will test it once it is merged.\n. Hey @bfrohs, so it works to not produce wrong results, but the link only gets a cm-link class, should it not also get a cm-strong class? \nThis only happens for the following:\n**http://www.link.de**\nAll the versions were there is a link-text work perfectly fine. Thanks a lot already.\n. @bfrohs okay, cool, thank you.\n. Works fine for me, didn't notice any unwanted effects so far, thank you very much.\n. This helps, awesome, could you not maybe integrate this? It could be another option, like noactivity or something like this? That would help because it could be documented and I guess it should not be such a big effort integrating it.\n. If so it could include an option like noactivity.\n. @marijnh sorry to go on again, but did you consider moving nocursor to an addon?\nI just feel it is not an uncommen usecase to for e.g. have an editor which you want to drag and drop or have some other actions on. So I basically want it to be disabled (but have the styles like when it is enable) and once I click on it it enables.\nThis is all fine but it really sucks when you drag it and then the highlight kicks in. Is there no way to also disable the highlight in the editor?\n. @marijnh but will you add a way to freeze the editor entirely? This is very useful.\n. Well, often when an editor is part of a page you want it to be \"disabled\", but with CodeMirror you would of course want the syntax highlight to stay the same.\nSo freezing would mean that it does not react to any mouse or keyboard event at all, but keeps the syntax highlight of the text. (Is this understandable?)\n. I would like it.\nBeni Cherniavsky-Paskin notifications@github.com schrieb am Mi., 3. Dez.\n2014 23:09:\n\nA major difference between the markdown mode and CommonMark is list\nindentation.\n[cc @lukasoppermann https://github.com/lukasoppermann]\nmarkdown.js strictly follows the 4-space rule, so continuation paragraphs\nare only considered part of the list if they're indented 4 spaces:\n- A list item\n<- 2 spaces here, so this is NOT a part of the list item but a top-level paragragh.\n- A new list opens here.\nwhereas CommonMark codifies complex but more intuitive rules where it's\nenough to indent under the the first char after the list marker (2 spaces\nin the above case).\nThere are multiple reasons why the relaxed behavior of CommonMark is less\nsurprising in a converter but I'm not sure it's right to\nunconditionally do it in an editor, as it can encourage users to\nbelieve \"sloppy\" 2-space lists are correct markdown, which is not\nuniversally true.\nOTOH, when writing for a converter that accepts such lists, it's confusing\nand annoying if the editor requires 4 spaces.\nShould we change it? Should it be an option?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/2962.\n. Thank you, I was accidentally using an old version, due to some package dependency issues.\n. Ahh, nice thanks. One more question, is there a way to get a \"visual\" line? So if the line wraps because it is to long, can I get only the first part until the wrap, so basically to the position goLineLeft moves to, but without changing the selection.\n. That would be pretty awesome, if it is not too much trouble. I am trying to write an addon for codemirror and need this for positioning it. \n\nBtw. is there any best practises for writing reusable addons for cm?\n. No, I just need the position basically about where the last character is. I will give it a try.\n. Hey, I need to position an element centered above the first selected \"visual\" line (or last selected line in some circumstances).\nSo your solution is not working (I misunderstood you).\nAddons: Yeah, okay, I figured, just thought maybe I missed something. :)\n. Hey, yes, this is true. It works fine if I just have 1 line, part of one line or multiple lines. What I have trouble with and what I think (??) your suggestion does not solve, is when I have one \"editor-line\" (w.g. line 23), which is shown n two lines, due to a wrap.\nIn the 2 screenshots, I would like to get the center of the first selected \"line\", but actually multiple \"lines\" are \"editor-line\" 23.\nIf I average x, I would be to the left of the selection, for the first screenshot.\n\n\n. Okay, I will give it a try and report tomorrow. Thank you very much for the help so far.\n. Yes, it worked, thank you very much.\n. ",
    "davedawson": "Just to chime in here, I'd love to have a specific wrapper for each type. For example having cm-formatting-list-bullet and cm-formatting-list-number would be super helpful in targeting everything. \n. Finally got around to testing this out. It's working great for me. Exactly what I was looking for. Thanks, @bfrohs! \n. Having cm-formatting-list is already incredibly helpful. Having something like formating-list-ol, formatting-italics or formatting-heading-4 would allow us to target those elements even more specifically. \n. ",
    "weiqj": "Thanks a lot for your quick response. It will be great if folding can be added for Lua.\n. Please see the attached screenshots.\nFirst picture shows scrolling to the rightmost. Note the word \"list\" got covered by scroll bar. There is no way to see the last 3 characters.\nI need to add at least 3 tailing spaces in order to make the word \"list\" show up. Adding two spaces the word still doesn't show up. Once the third space is added the line magically shifted and the word showed up.\nYes I did call refresh() every time the size changes. It was wrapped within a SmartGWt container but I don't think it matters. Does it?\n\n\n. Sorry I should attach the options earlier.\nSee options below.\nIt was created from CodeMirrow.fromTextArea()\n{\n            tabMode: \"indent\",\n            matchBrackets: true,\n            theme: \"neat\",\n            indentUnit: 4,\n            indentWithTabs: true,\n            lineWrapping: false,\n            lineNumbers: true,\n            gutters: [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"],\n            highlightSelectionMatches: {showToken: /\\w/}\n}\n. As I said, it is a GWT wrapper. It's will take a lot to have a self-contained demo page.\nBelow is the GWT native js code.\nvar textarea = $wnd.document.getElementById(editorid);\n    var editor = $wnd.CodeMirror.fromTextArea(textarea, {\n        tabMode: \"indent\",\n        matchBrackets: true,\n        theme: \"neat\",\n        indentUnit: 4,\n        indentWithTabs: true,\n        lineWrapping: false,\n        lineNumbers: true,\n        gutters: [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"],  \n        highlightSelectionMatches: {showToken: /\\w/}\n    });\n    editor.setSize(320, 200);  // Initial size, will be resized when the container size changed.\n    editor.refresh();\n. ",
    "creationix": "How do you add a folder?  I'm reading through the indent-folder and am trying to use it with lua (no it's not 100% correct, but it would give me a starting point).  I can't get the folds to do anything at all currently.\n. Nevermind, I figured it out.  The mode needs to opt into the folder with a \"fold\" property.\n. ",
    "marclaporte": "The current situation is that folks are getting outdated versions of CodeMirror:\nhttps://packagist.org/search/?q=codemirror&orderBys%5B0%5D%5Bsort%5D=downloads&orderBys%5B0%5D%5Border%5D=desc. A potential option to explore:\nhttps://asset-packagist.org/\nhttps://asset-packagist.org/package/search?query=codemirror&platform=bower%2Cnpm. ",
    "mebersole": "Thanks for the info, closing this issue!\n. What is \u201ccm hp\u201d?  I\u2019ll try this week \u2013 at a conference.\nFrom: soliton4 [mailto:notifications@github.com]\nSent: Wednesday, March 05, 2014 9:36 AM\nTo: marijnh/CodeMirror\nCc: Mark Ebersole\nSubject: Re: [CodeMirror] ie 10 bug? (#2338)\n@mebersolehttps://github.com/mebersole could you pls provide a more precise description and try to reproduce it on the cm hp?\n@marijnhhttps://github.com/marijnh\nhttps://github.com/soliton4/CodeMirror/tree/e81052f8c8499dcf2d51851777082859108b046b\nthis is the version im using.\nim still stuck with the floating codelines. can we have a hangout or chat about it one day? would be more productive i think.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/2338#issuecomment-36762488.\n\nThis email message is for the sole use of the intended recipient(s) and may contain\nconfidential information.  Any unauthorized review, use, disclosure or distribution\nis prohibited.  If you are not the intended recipient, please contact the sender by\nreply email and destroy all copies of the original message.\n. I tried on http://codemirror.net/demo/theme.html after cutting & pasting in a bunch of code, but couldn\u2019t get a repro with IE 10.  I\u2019ll see if I can get a video of the repro sometime soon.  If someone else can beat me to it, please go for it!\n\u201cjavascript conference\u201d \u2013 I think you\u2019re confusing me for someone who does real coding \u263a  I\u2019m at the ACM SIGCSE conference about Computer Science education.\nFrom: soliton4 [mailto:notifications@github.com]\nSent: Wednesday, March 05, 2014 6:27 PM\nTo: marijnh/CodeMirror\nCc: Mark Ebersole\nSubject: Re: [CodeMirror] ie 10 bug? (#2338)\n@mebersolehttps://github.com/mebersole cm hp\ncodemirror homepage\njavascript conference?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/2338#issuecomment-36807754.\n\nThis email message is for the sole use of the intended recipient(s) and may contain\nconfidential information.  Any unauthorized review, use, disclosure or distribution\nis prohibited.  If you are not the intended recipient, please contact the sender by\nreply email and destroy all copies of the original message.\n. ",
    "jeffjenk": "Sure I will take a look at doing it like that.\n. ",
    "Akman": "This error appear when I call setValue method with following data:\nvar value = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n';\n  value += '<!DOCTYPE html>\\n';\n  value += '<html xmlns=\"http://www.w3.org/1999/xhtml\">\\n';\n  value += '  <head>\\n';\n  value += '    <base href=\"%D0%9D%D0%BE%D0%B2%D0%B0%D1%8F%20%D0%B7%D0%B0%D0%BC%D0%B5%D1%82%D0%BA%D0%B0_files/\" />\\n';\n  value += '  </head>\\n';\n  value += '  <body>\\n';\n  value += '    <!-- Insert your code here ... -->\\n';\n  value += '  </body>\\n';\n  value += '</html>';\n  editor.setValue( value );\n. ",
    "wyuenho": "This didn't seem to be a problem for the 2.x line. Is this a regression?\n. Ok nevermind I just realized I set readOnly to nocursor\n. ",
    "mini-emmy": "I definitely agree with you. Since I had to put something together for our application I thought I would post it here in case someone wanted to reuse it short term until a better solution is ready. It would be nice if in the new hint functionality you still could add on your own keywords on the fly as well as the language specific ones as we have found this very useful.\n. ",
    "foo123": "The idea was that i had to develop some custom modes for some projects, and doing all the work opver and over, seemed like a waste of time.\nDid not know about the other alternatives, i will check them out.\nAbout indentation, this can be solved very smoothly if some kind of context-specific information can be added to the grammar specificcation (this will also enable error detection). Else only information about indentatioon can be added to the grammar\n. Hi,\nhave added syntax rules to the grammar, inheritance and various optimizations in the generated matchers/tokenizers\nYou can check it out here:\nhttps://github.com/foo123/codemirror-grammar\nand\nhttp://foo123.github.io/examples/codemirror-grammar/\nCreated a simple util, here also:\nhttps://github.com/foo123/regex-analyzer\nand\nhttp://foo123.github.io/examples/regex-analyzer\nCheers\n. thanks for the fast response,\ni understand the logic behind what you suggest,\nhowever any way the mode can call the indentLine method of the current instance, or any ideas about a work-around\nFor hand-made custom modes, parser knows the name for a closetag for example (although this does not always work as expected), however an automated parser, does not have hardcoded dependencies\nHope this is clear enough.\n. Maybe making some methods available to the parser (regardless of the add-on i am implementing), might be a\ngood idea since the parser can handle indentation (or other things) better.\nthe electricChars is rather restricted. For example the custom xml mode will outdent a closetag, regardless if it matches the top tag (at least this is what i am getting, maybe i am doing it wrong?)\n. ok, i will try to fnd some workaround somehow\na note: about the indentLine method, is not necessary, but the mechanism (eg. which line is currently being rendered etc..) is not available or known to the parser, that is what i meant, not the actual top-level method\ni think the current line (or similar information) would be good to be available inside the mode\nAnyway, thanks again \nCheers\n. Aother related question..\nCan i implement a stream.reIndent() method myself?\ni see the code in codemirror lib for indentLine, has to take under consideration the history and current selection etc..\nif the stream class had a reIndent method, would be a lot easier. it is very convinient to be able to reindent the current stream if needed and as needed, since it is executed in time and in place for the associated token.\nif i re-indent the stream in the parser, and set the pos, start, etc.. properties to their correct values, it is possible sth will  break (maybe the current selection, or getTokenAt method )\nFeel free to close this issue.\nThanks\n. Maybe you are right..\nYou see the problem is that that mode's indent method is called AFTER a newline\nand i am looking for a way to re-indent the current line as the user types, that is the thing..\nelectricChars, provides a way, but it is restricted, i need something that can identify a whole string for example\n. Any way the electric chars option can be used to match the newline character (when user types to go to next line),\nbut before jumping to next line\nThis could also do, the mode's state has information about what is expected, so the indent method can use this information to re-indent the current line, before proceeding to the next\n. Maybe we are on a different page here..\ni am not sure to which comment the last answer applies.\nelectricChars is used to re-indent the current line dynamically\nThe current line might be a newly created line, and lookng for way to trigger the electricChars option but without hardcoding the chars, since they are variables and can change from state to state.\nMaybe i am not explaining myself  correctly..\n. is it possible to trigger re-indent, just before user goes to next line?\nCan electricChars be used in this way?\nThanks\n. ok,\nwill see if i can come up with sth\nthanks\n. Hello again, instead of opening another issue, i found this old issue and continue sth (if needed can open a new one).\nThe codemirror-grammar add-on has new versions with interesting and important features (including a full grammar specification in BNF form and context-specific actions,..smart indentation is going to be added as well).\ni need some things to be able to make some actions or tokens work correctly.\n1. the current line number (in the source code) that is currently being edited (cant find it anywhere)\n2. and/or a way to determine SOF (start of file, meaning the very start of the very first line) and not SOL (start of line)\nThank you.\n. Yes i'm aware of both the issues you raise.\nFor example, line numbering might be an issue for inner modes as well, however it is easily resolved since codemirror manages inner modes switching and keeps line counts (maybe this requires a few extra code but still straight-forward)\ni would say it is potentialy a good idea (for example ACE passes the row number, maybe different from line number per se) since it enables highlighting in new ways and with new conditions\ni'm also aware of the startState method to keep track of SOF (i usualy check the source code before posting issues) but in the source code it seems startState method can be called multiple times (for example if no state is found, CodeMirror 2.0 is what i use to test), so this is confusing.\nAlso as far as i can tell of how CM highlights, i need SOF to be set in the entire line, not just the first encountered token. And as far as i can tell, CM can copy the state (in same line) and SOF will be lost on that copied state (which is still on same SOF line)\nIt is good that one can use the startState to signal SOF, but is it actualy correct?\nThanks again, Marijnh\n(ps if you will, consider the issue i opened for a reference to codemirror-grammar add-on in codemirror)\n. Yes i've read that too\nbtw \n\nI've been waiting for a common standard for such specifications to emerge, but not much progress seems to be made there.\n\ncodemirror-grammar add-on (the reason for this issue as well) solves this problem as well as the problem of extending existing modes to handle variations and new dialects in an optimum way,\nIt solves the problem in two ways\n1. Full-featured Grammar specifications, handling lexical, syntax analysis and actions to a great detail\n2. Grammar is intuitive and descriptive\n3. Grammar is JSON format and can be extended/merged with other grammars as needed\nNow about the issue, yes but can SOF flag be maintained in the entire line, not just the first token?\nHaving SOF indicate the entire line then using stream.sol() is easy to get the start of the line. but is important to be able to maintain SOF on the entire first line as whole, not just until first token. Hope it is clear.\nThis is where i'm having problems and a line number or row number would immediately solve this easily\nThe reason this is extremely useful is that there are cases where some code can only be placed first (or in the first non-empty line), e.g <doctype> in xml/html and not elsewhere, so this provides better highlighting abilities\n'\nThere is also a method blankLine in a mode, can this be used (along with startState) to achieve sth like that? If yes, an example would be most helpful\n. Ok, i'll try that and see.\nStill, consider the issue of passing line numbers or at least row numbers (in the sense of relative line number vs absolute line number) to highlight modes (have added a comment on the issue of new features about this as well). It can give new highlighting abilities with less clutter.\nThanks again, cheers!\n. Helo Marijnh, i would like to suggest a few options\n(check the codemirror-grammar add-on as well)\n1. make electricChars accept a variable/dynamic input (this is already achieved by electricInput option as far as i can tell)\n2. Pass current line number on to the current highlight mode\n3. A way for mode to determine if it is on first line of code or last line of code (important when some code can only be placed only on first line, or first non-empty line but not elsewhere and so on..) This information is already available in Codemirror, just pass it on to the current mode (does not break anything as far as i can tell, while extremely useful for highlighting)\nBest\n. Hello, why not try the codemirror-grammar add-on (author) and do it your-self quite easily. On top of that one can have a base js-grammar and only the necessary extensions for JSX etc.. and extend the base as needed, if needed\nCheers\n. No this is how the default js-mode in codemiror handles indentation, it uses the unix-convention hard-coded. Personaly i use Allman-style but for inline contexts (as in the return example above) i use unix-style. Which i think is best, since allman-style has several advantages, like makes code easier to read, delimits blocks very easily, can comment-out parts very easily and so on..\n. added a reference in the wiki page under a new category Highlighting / Extra Modes which seemed more appropriate.\nps. the add-on is currently being revised to new versions with new features, open to suggestions, if there are any. The idea is to make it as self-contained as possible, both in terms of language highlight-specification detail and in terms of editor-specific out-of-the-box features like autocomplete, annotate, fold indentation, and so on..\nCheers\n. The state-machine in simple modes add-on is similar to what ace editor uses (which supports a similar feature) as well (based on that common specification, and codemirror's success) and is how cm-grammar add-on was initialy created (doing only lexical analysis, without having to create the same old mode over and over) but with a separate style model, so editor-specific styles are not hardcoded, but are just a modular parameter. \nThen when having to highlight xml (and similar popular languages) became not-trivial with a simple lexical analysis, then the syntax model of the grammar add-on was created to handle xml (or similar) easily. Syntax was created as a generalisation to regular expressions both for ease of notation and intuitiveness (which turns out to be a variation of what is known as PEG form).\nThen more features were added and an ability to write rules as natively (and easiest) as possible (without these configuration objects) so parsing syntax directly in bnf/peg form was added, plus some new token types (action tokens) to enable complex context-specific functionality (like unique in-context identifiers and so on) which are important to many (programming) languages. \nThe need for such an add-on was created when having to highlight arbitrary code for which no mode existed or highlighting alternatively without delving into each mode's source code (and without duplicating the same modes over and over where only \"tokens\" changed).\n. @marijnh \nFor a new model for a common and modular specification for (interactive) highlighting, you might want to see this part\n. ",
    "jvdl": "Right, what you're saying makes sense. I kind of figured it might have been something like that.\nMy use case for having custom line numbers is because I'm working on a bespoke diff viewer, so rather than showing just line numbers, I'm showing \"from\" and \"to\" lines with insertion/deletion markers, and will be adding other line widgets to lines as well.\nAt the moment my workaround is changing the last line of the editor to not be empty to prevent this from being triggered (though I see that making the last line of the content being injected would be more robust as a workaround).\nIt would be relatively trivial to add an option for this in updateDoc\n```\nvar alwaysInsertAfter= doc.cm && doc.cm.options.alwaysInsertAfter;\n// First adjust the line structure\nif (from.ch == 0 && to.ch == 0 && lastText == \"\" && ! alwaysInsertAfter) {\n```\nWould be happy to add a pull request for this if it seems like something that's valuable.\n. Brilliant. Thanks!\n. ",
    "arcanis": "FWIW, I can't test it right now, but I think that moving the \"inChracterClass\" branch before the \"state.inString\" and \"state.inComment\" branches should do the trick (in mode/pegjs/pegjs.js, at lines 34, 47 and 56).\n. @ForbesLindesay The highlighting is correct with start = [^\"Foo] but wrong with start = [^\\\\\"Foo]\n. ",
    "mukhortov": "I see. In this case I guess it works not in the way it was designed. If you try to write a CSS line body {, or comment a line it adds unexpected indent. \n. Probably I'm wrong. It works fine in general cases.\n. ",
    "Leroyk2": "When you change the useragent to ie10 it works fine! \n. Use IE11 and hit control +f search for something what doesn't exists in the text. Hit control + f for the second time. Now it is not possible to type some text in the search box.\n. ",
    "cgag": "I hacked something last night trying to make jk take me out of insert mode, which works basically as you described in point 2.  What I have is ugly and hardcoded, but it actually works pretty well. I just insert j, then remove it and leave insert mode if the next key is k. Typing jk requires extra work, (type j, another character, then just edit in normal mode), but it's rare.  Code: https://github.com/cgag/CodeMirror/commit/ff6d554ad989863789ae729a7003e10790d16e85\nIt'd take a bit of work, but it seems pretty feasible to generalize this to any two keys.  Any thoughts on whether or not thats a good/bad idea?\nedit: it also moves your cursor backwards by one when you exit insert, which it shouldn't, but it works as a proof of concept\n. Ah good catch on jk, I guess I misunderstood how fallthrough works.   That keyPress handler sounds interesting, I'll look into that.  Inserting j then removing it though is an approximation of what vim really does, it inserts j without advancing the cursor, then removes it when you hit k.\nI know this is hacky, but I think getting some sort of hack solution to this would be huge.  I'm also using codemirror through lighttable, and not having 'jk' map to escape is by far my biggest gripe with it. jk, kj, or jj for escape is super common.  I agree that it wouldn't be simple to handle insert mode bindings in a general way, but some sort of support for these keybindings would be a major improvement imo.\n. I lost interest in this and haven't revisited it sorry.  I'm with you on it being the biggest barrier to using light table or any other codemirror based editor though.\n. Ah, looks like di} and da} are broken only on the inner bracket pair in the demo (something with the fact that { is indented farther than the closing }.  I'll look into it tomorrow. \nEdit: \nChanging the conditional to: \njavascript\nif((start.line == end.line && start.ch > end.ch)                          \n    || (start.line > end.line))\nseems to work in every configuration of pairs I can come up with.  I didn't see any existing tests for the text objects with the opening pairs {[(, I'll try to throw some together tomorrow. \n. Added another commit with the updated logic and a decent amount of tests, let me know if you can break this one. \n. All those in point 1 seem to be working for me, and they all share same logic so I'm not sure what's going on.  How are you testing this stuff, are you just cloning my repo and opening index.html from master?  I'm not sure how to reproduce what you're seeing. \n. Excellent :D.  Thanks for the incredibly quick reviews/replies.\n. ",
    "Cottin": "+1\nAny progress on this recently @cgag and @mightyguava ?\nAfter you've learned jj by reflex, Light Table is almost unusable without this feature :)\n. ",
    "gekkoe": "@Cottin I have improved on the hack that @cgag posted here: https://github.com/gekkoe/Vim/commit/31aec4353724f61c8a76774848401f8a0fa3f7bb so that it only waits for the second key in the sequence for 100ms rather than dropping you out of insert mode even if it's pushed much later.\nThere's still a minor issue with using this ESC sequence while macro recording that I'd love a fix for, and it's still an ugly hack. But it works. :-)\n. I've submitted a pull request with a generalized solution to this issue (you can edit the vim.js file in a couple of places to customize it to the sequence and timing you need). https://github.com/gekkoe/CodeMirror/commit/462e5e11980b517f19b871f6c9d96a71d35fc545\nAssuming that the request is accepted, it may be time to close this issue, though some might point out that a true multi-key bindings solution is still lacking. My code only deals with the ESC binding so many of us can't stand to edit without.\n. Please look again @mightyguava. This is not the same issue.\nThe problem that you already fixed was one where the system would attempt a call to openDialog even if the function didn't exist.\nThe new change I've made though, is to give the desired vim-like behavior, which the current code does not. \nThe direct call to cm.openDialog that I've added is what first brings up the \"recording [x]\" message when recording starts. This is currently not called at all, meaning recording starts with no status message.\nThe only call in current code to openDialog contains the message that should go at the start of the process, but happens on the event that is actually intended to get rid of the message when recording has finished (as pointed out in comments a few lines above). \nThat's why I did a direct call with \"recording[x]\" followed by setting an event with a call that contains an empty string, to zero out the dialog when recording has finished.\nWith this change, it runs well, and exactly as you'd expect from observing the behavior of vim.\n. Ahhhhh, thanks for the clarification! I should have read up more on openDialog. I had just gotten done making a version to work right on the LightTable version of the code, and the function there worked differently. \nInteresting design there. I have to keep reminding myself \"Looks like C, acts like Scheme.\"\n. Nice! \nLove the ability to call it with setOption. I might even be able to leverage that to create a user-configurable setting on the front end from within LightTable.\nThat said, didn't you want the enableInsertModeEscKeys set to false by default? That's why I had submitted it that way.\n. ?\n. output -> (recording)[x]\n. Sets up an event that will be later called on line 565 to blank out the output from the line above this one.\n. ",
    "juhasch": "I guess this is true. I proposed a fix for getIndent() , still it may be better to fix the caller and not the function being called. And the call is coming from inside codemirror.js. How should this be fixed ?\n. I run into this with my codefolding extension for IPython, see:\nhttps://github.com/ipython-contrib/IPython-notebook-extensions/wiki/Codefolding\nIf there is a multiline string or a Python function at the end of a codecell, it triggers the TypeError when the notebook is loaded. The reason for this is that I save the folding state in the notebook and try to restore the folding to how it was when the notebook was saved by calling foldCode().\n. ",
    "abram": "Done and done. (I was making an unnecessary optimization by not attaching the dblclick handler if it wasn't going to be used.)\n. ",
    "heppe": "I have that working locally now.  I just need to get it to keep the cursor\non screen.  To measure the height of a line, though, I used\n        var oneLine =\n             cm.charCoords({line: 1, ch: 0}, 'local').top -\n             cm.charCoords({line: 0, ch: 0}, 'local').top;\nIt seems like there ought to be a more direct way to do that.  Is there?\nThanks,\n-t\nOn Wed, Nov 27, 2013 at 6:48 PM, Yunchi Luo notifications@github.comwrote:\n\nThanks for the patch! looks good, but I have a couple of nits for and .\n1. and shouldn't be defined as motions. Motions can all be used in\n   conjunction with operators to transform text, while and only perform\n   scrolling. Right now if you do d it actually deletes 2 lines, where the\n   expected behavior is to do nothing.\n2. In desktop vim, and do not move the cursor if it's on-screen, it\n   does keep the cursor from going off-screen. Right now your code will allow\n   both keys to move the cursor completely off-screen.\nI suggest that you add and as actions instead and implement a scrollmethod similar to\nmoveByScroll in the actions object.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2010#issuecomment-29435959\n.\n. If nothing else, that snippet could be wrapped in a utility function, but\nthat shouldn't be done if there is something pre-existing.\n\nOn Mon, Dec 9, 2013 at 11:51 AM, Yunchi Luo notifications@github.comwrote:\n\nI remember having the same question quite a while ago for the other scroll\nactions but not coming up with a better answer. @marijnhhttps://github.com/marijnhdo you know of a better way?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2010#issuecomment-30166833\n.\n. Thanks.  24022a1 was intended.  It is more general than the pre-existing debug mechanism.  It is case insensitive, matches anywhere in the test name (not just the beginning), and reports the number of tests that were skipped.  Per a suggestion from mightyguava, I was working on separating it out into a separate pull request, but I guess that won't be necessary now.  How would you feel about me getting rid the 'debug' filtering code now that this filtering is in place?\n. Maybe we'll never get there completely, but I strongly feel that we should\nmatch vim's pattern matching to the greatest extent possible.  Code Mirror\nusers are not necessarily javascript programmers, so the javascript flavor\nwill not necessarily be their background.\n\nIn this specific case, it seems that terminal vim has the opposite escaping\nexpectations from javascript.  If you want to express 'OR' in terminal vim,\nyou can escape it.  I can modify this pull request to match that behavior\nif it would satisfy you.\n-t\nOn Sat, Jan 25, 2014 at 10:39 AM, Yunchi Luo notifications@github.comwrote:\n\nCleaning the code for unescaping looks good, but I'm not sure about the\nchange to automatically escape |. While I'm all for making the vim mode\nconfirm to real vim, I don't see search/replace here to ever match vim's\npattern engine, and I think it would be better to make it clear that the\nbehavior here will match exactly that of regular javascript regex.\nAlso, personally I don't want | to be escaped automatically, since I\nactually do want to use in searches as OR. Wouldn't escaping it\nautomatically remove the ability to use it as OR in search?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2178#issuecomment-33296251\n.\n. My preference would be to favor compatibility over modernity, i.e. match\nreal vim, not perl.  I'd like to be able to jump back and forth between\ncider and real vim without retraining my fingers. And yes, if we start down\nthis path, I'll take it the rest of the way, continuing to stamp out the\ndifferences.\n\nUltimately, this is a product call that I think we should get marijn to\nweigh in with an opinion on.\n-t\nOn Sun, Jan 26, 2014 at 2:57 PM, Yunchi Luo notifications@github.comwrote:\n\nHmm I've always lost arguments regarding making CodeMirror's vim mode more\nvim-compatible vs more modern. IIUC vim's regex is different because it\npredates PCRE. But I'll make an attempt anyways...\n- Javascript regexp is more or less a subset of perl-compatible\n  regular expression, which is the de-facto standard. Javascript regexp most\n  notably has no backtracking/lookahead, verbose regexes, named groups. I\n  don't think any programmers will have trouble using it.\n- There's clear documentation for Javascript regex. There's clear\n  documentation for Vim regex. Where are users going to look for\n  documentation for something that falls in between Javascript and vim regex?\n  Most features of the keymap current either match real vim or doesn't work.\n  I'd like to keep it that way.\n- A cursory look at CodeMirror's documented integrations makes it look\n  like Javascript is pretty high in the list of languages.\nIf you really feel strongly that vim's way is better, let's cover all of\nthe basic cases: the special characters toggled by vim's magic. I believe\nthe list that JS as supports is: ?, +, {, (, ), |. Matching groups in the\nreplace part should also be changed from $1, $2, ... to \\1, \\2, ...\nI still think this is going to be a large source of confusion. I hope you\ncan commit to improving the vim keymap's fidelity to real vim's regex if\nyou want to proceed down this route.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2178#issuecomment-33333542\n.\n. PTAL\n. PTAL\n. done\n. added a unit test for search without substitute\n. Make sure that if you start with a multiline block\n123\n1\n123\nwith the cursor on the top 3, two j's gets you to the bottom 3, and not the\nbottom 1.\n\n-t\nOn Fri, Feb 21, 2014 at 4:18 PM, Dale Jung notifications@github.com wrote:\n\nAh thanks for the pointer. I set the state.lastHPos when I call setCursor.\nWhich seems fine for my use case.\nOut of curiosity, what's the usecse for lastHPos? If you grab the cursor\nposition, wouldn't that be sufficient? I commented the line where endChwas being set to\nlastHPos and I couldn't figure out where it breaks.\nThanks!\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/2289#issuecomment-35787524\n.\n. :registers should be back to its old behavior.\n\nPer our off-channel chat, I still think that parsing/serializing can be avoided.  The old behavior was to keep key buffers in the MacroModeState, serialize them on record mode exit, and deserialize back into key buffers on replay.  It therefore follows that key buffers are sufficient to express all behaviors implemented thus far.  The new behavior is to store the key buffer in the register itself.  If there are problems with special keys and/or modifiers, I don't believe it is a regression (at least not in this pull request).\n. deferred moving the style, since it's not important to these new unit tests.  I followed your suggestion of overriding the openNotification method and restoring it in the finally block.\n. @yunchi Your version is better.  I didn't know about the 'is' assertion\ncommand.\nOn Sat, Mar 8, 2014 at 1:58 PM, Yunchi Luo notifications@github.com wrote:\n\nOh, wait, your test was right. I read it wrong... So I ended up\nrefactoring your refactor a bit...\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2342#issuecomment-37111237\n.\n. @mightyguava  That is effectively the behavior we're getting with his code.  If the search is aborted with an escape key, the function, onPromptKeyDown, will restore the register back to its original state with \n   updateSearchQuery(cm, originalQuery);\nIt would be good to enforce that behavior with a unit test, however.\n. I believe this is ready to merge.\n. @marijnh mighty guava is unavailable to do this merge.  Would you be able to do it?\nThanks!\n\n-t\n. I notice that it doesn't interact with the command repeat as terminal vim.  If you select a line, convert to upper case with 'U', then move to another line, then the '.' command should do the same thing for the new line.\nWasn't able to find any other problems, though.  Good job!\n. Actually, another related issue is that it also doesn't work with vim macros.  In terminal vim, you can\n'q', 'a', 'v', 'j', 'q'\nthen move to another line and replay that macro with\n'@', 'a'\n. looks good to me.  ready for merge.\n. @binora: good work!\n. minor bug: \n\", a, y, w, j, j, v, j, j, \", a, p\nreplaces two lines with a word.  In real vim, it leaves the contents of the 'a' register as the word, but in the vim demo, with this change, the 'a' register gets bashed.\n. One minor style request.  After that, this should be ready to merge.\n. @mightyguava please merge this at your convenience.\n. @marijnh If you approve of the approach of restoring the bookmark at the end of a range after cm.replaceRange, this pull request is ready for merge.\n. binora reviewed this and said off-channel that it looks ok.  Should be ready to merge.\n. @marijnh The commit, 84d97a3, was indicated as breaking the build, but binora and I are both locally seeing proper execution of the demo, unit tests and lint.  Any ideas what might be wrong?\n. This change looks good to me as soon as mightyguava approves.\n. demo looks good, and besides the one comment I just left, code looks good too.\n. I share mightyguava's concern about creating a new way for line ranges to be passed around.   I think it can be put into the params object of that is passed into ExCommandDispatcher.processCommand.  Looking at that object in the debugger when I replace 'c' with 'd' with a visual range active, I see this, which seems to indicate that setting line and lineEnd in the params object might be all you need to do.\nObject {input: \"'<,'>s/c/d/g\", line: 4, lineEnd: 6, commandName: \"s\", argString: \"/c/d/g\"\u2026}\nargString: \"/c/d/g\"\nargs: Array[1]\ncommandName: \"s\"\ninput: \"'<,'>s/c/d/g\"\nline: 4\nlineEnd: 6\nproto: Object\n. How about we give it an optional params argument?  That seems much cleaner\nthan prepending and later stripping.\nOn Thu, Jun 5, 2014 at 8:51 PM, Yunchi Luo notifications@github.com wrote:\n\nI share mightyguava's concern about creating a new way for line ranges to\nbe passed around. I think it can be put into the params object of that is\npassed into ExCommandDispatcher.processCommand. Looking at that object in\nthe debugger when I replace 'c' with 'd' with a visual range active, I see\nthis, which seems to indicate that setting line and lineEnd in the params\nobject might be all you need to do.\nExCommandDispatcher.processCommand doesn't accept a params object, it\nonly accepts the raw ex command string. You can just prepend the line\nnumber to the command string like I mentioned above.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/marijnh/CodeMirror/pull/2618#issuecomment-45300579.\n. Since we don't know when (or even if) we will be adding addition commands\nto :global, can we wait do do that refactor until we find that it is\nactually needed?\n\nOn Mon, Jun 9, 2014 at 10:09 AM, Yunchi Luo notifications@github.com\nwrote:\n\nThis does seem to fix confirm, but it requires any potential future\ncommands that may be used with :global to call the callback in order to\nfunction. I think we should have exCommandDispatcher call the callback\nfor all non-async commands, potentially adding an attribute to the\nexCommandMap to distinguish them from synchronous commands.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/marijnh/CodeMirror/pull/2625#issuecomment-45516264.\n. On Mon, Jun 9, 2014 at 12:44 PM, Yunchi Luo notifications@github.com\nwrote:\nWe should not be adding any commands that makes such narrow assumptions.\nThis opens the path to accruing a lot of technical debt.\nok.  I'll do it then.\n\nIf making :global work only with :substitute was satisfactory, we could\n\nhave gone with transforming :global/regex/s//replace/ into\n:substitute/regex/replace/\nnot quite.  There's still the difference in behavior for 'a' and 'q' in\nconfirm mode (line-wise vs file-wise).\n\n-t\n. another bug: pasting seems to be broken\n,j,j,l,l,x,p\nTo be fixed in a follow-up pull request.  After the minor comment touch up that I requested, this looks good to go.\n. demo LGTM, code mostly LGTM (minor comments only)\n. LGTM\n. @mightyguava Yes, LGTM.\n. this looks ready for merging.\n. I noticed a bug whereby if you try to replay in a location such that the last line falls on a short line, it operates on fewer characters than would be expected.  I think this is more a general problem with visual block than an indication that there is something wrong with this pr.\n. I'm able to replay delete operations in my testing.  I found, however, that there are some bad interactions with the undo/redo buffers.  Multiple consecutive delete operations are all undone together with a single undo, and if you redo, you lose the ability to replay.  I was testing with something along the lines of\n<C-v>, l, l, j, d, j, j, ., j, j, ., u, <C-r>, .\nPlease incorporate that into a unit test.\n. It looks like your code loses the ability to replay when the visual block that it is replacing hits the end of a line.\n. LGTM\n. LGTM\n. LGTM\n. @mightyguava I wasn't able to repro #1 from your list, but I don't see a commit after your comment, so I'm not sure how it might have been fixed.\nI was able to see #2, however, and it's worse than you describe.  It doesn't paste at the end of the line, but rather chucks out whatever contents were on the line past the shortest line that is touched by the pasted block.  That definitely needs a fix and a test before this can be submitted.\n. LGTM.  This looks ready to merge.\n. LGTM.  ready to merge.\n. demo looks good.  Also tested with firefox and safari on my mac.  Can't test ie, though.\n. LGTM\n. @mightyguava were you still planning to merge this?\n. this one can be closed (IIUC I'd need to have the right permissions to be able to do it myself). looks good to merge as is.  Thanks!\n. I patched in the change and wasn't able to break it.  One minor annoyance is that when a visual block passes a short line to the left of the block, it leaves a spurious cursor at the end of the short line.  To repro, in the vim demo, use this key combination from the initial position.\n   l,l,l,,j,j,j,j\nThat's a pre-existing bug, though.\nNow I'm off to look at the code...\n. On Tue, Nov 18, 2014 at 11:54 AM, Harutyun Amirjanyan \nnotifications@github.com wrote:\n\n\nif we have vim.head it would be better to not add _head parameter to\n  all motions which can use vim.head instead.\n\nI agree with Haratyun.  I'd be ok with that refactor going into a\nfollow-on pull request, since this one is pretty big.\n\n-t\n. modulo one minor nit, seems ready to merge.  LGTM.\n. LGTM\n. This makes the vim bindings behave as if autoindent were set, which for editing code, is probably what most users will want.  It is also more consistent with what you get with other commands, such as 'o' (to start editing on the next line).  In the long run, I think we want to make this configurable with a :set command, but this is a step forward.\nThis looks good to merge.\n. one minor style nit, but other than that, this looks good to merge.\n. looks good to merge\n. I captured this in a vim unit test\ntestVim('macro_yank_tick', function(cm, vim, helpers) {\n  cm.setCursor(0, 0);\n  // Start recording a macro into the \\' register.\n  helpers.doKeys('q', '\\'');\n  helpers.doKeys('y', '', '', '', '', 'p');\n  helpers.assertCursorAt(0,4);\n  eq('the tex parrot', cm.getValue());\n}, { value: 'the ex parrot'});\nThe next step is to actually fix it.  Working on that now.. a backslash on one of the quotes in the first call to helpers.doKeys got swallowed.. This is complete.  Am I able to close it, or do I need to have someone do it for me?. That may be, but vim, when not in insert mode, visually represents the cursor as a box highlighting the character after the cursor.  See this screen shot: https://goo.gl/photos/vrH2RAYkDn4hbVUi9\nHaving the bracket matching operate on any character other than what is highlighted in that case looks pretty wrong.  It's made even worse by the fact that the next character position isn't even reachable via the keyboard (though with mouse clicks it is).  Can you think of a better solution for this?\n. made changes according to your comments, but still need to fix the unit tests. looks good to me. Is there a good reason why unmatched brackets of one type need to interfere at all with matching brackets of another?\nAlso, I never quite figured out why matching the braces in { a-> } would be broken but in { > } wouldn't be.. Should line 1981 then be replaced with the following?:\n      // Only include angle brackets in analysis if they are being matched.\n      var bracketRegex =\n          (ch === '<' || ch === '>') ? /[(){}[\\]<>]/ : /[(){}[\\]]/;\n      var matched = cm.findMatchingBracket(Pos(line, ch), {bracketRegex});. added some comments.\n\n. done.  I wasn't sure what style guide we were following, and there seemed to be a lot of 'if(' cases (without space) lying around in the file.\n. I converted this line to use setText.  I did not, however, make a parallel setInsertModeChanges(), however, because I felt that would be a dangerous interface.  The caller might assume that the array was being cloned, but it is not.  I'll clean up this area a bit in a follow-on CL.\n. had to use actionArgs.repeat + 1 to make the unit tests pass, but done.\n. commented out code.  Use it or lose it.\n. thanks for making this change ;-)\n. am I missing something?  How is this changing a return type?\n. Testing with real vim, I see that if there are multiple matches on a line, then they will all get replaced.  The unit tests should make sure to enforce that behavior.  Is the concern about it being linewise simply because we want to avoid matching across line breaks, because of performance, or is it something else?\n. I think 's' needs to be called potentially multiple times per line.  We need to be careful not to restart at the beginning of the line, though.  The search string could be a substring of the replacement string, which would lead to infinite recursion if we did.\n. does this mean that modified keys won't work with non-standard layouts?  I don't have a way to test that.\n. add a comment here to indicate that 'general' refers to non-insert mode\n. which convention are we following?  blocks on a single line if they fit (fix this) or blocks always line fed (fix line 687)?\n. having trouble seeing what's going on in this function, but I'll stare at it some more tonight.\n. one line if it fits\n. Of what use is a partial match?  Would we apply a partially matched command?\n. add a comment here as we discussed off-channel:\n partial commands (e.g. the first character of 'gg') are not applied, but we keep the buffer around to make progress towards a full match.\n. add a comment explaining what \"sel\" is.\n. fits on one line.\n. ditto\n. can you be more specific here?\n. why is that a problem?\n. It looks like there's still a bunch of places where the callers are expecting command.\n. not a new problem, but can you put a log message here into the console?  Do we have any mechanism to do that?\n. on lines 238 and 635 you are assigning command = findkey(), and then testing against 'function', but findkey is defined as returning true or false.\nOr maybe I'm missing something.\n. not a fan of this structure: (a || {}).key\nIt seems to be used elsewhere, so I'll let it go, though.  Any changes here are optional.\nMy reasoning is that if you're scanning for places where the object is dereferenced, it's easy to miss.  Alternatives would be\ncfg = cfg || {};\nvar scope = cfg.scope\nor \ncfg = (cfg ? cfg.scope : null)\n. same as above\n. done * 3.  I wasn't sure if checking the DOM every time the cursor moves was kosher, but maybe it's ok. done. that code is run only once on startup.  This code is run every time we attach/detach the vim keymap (but too early for the startup code).  Per your other comments, I reverted this change.. reverted.  I felt that it was cleaner having all the configs coming from the same object, but needign a compatibility layer would be even worse.. ",
    "hitsthings": "So I ended up tracking this back to the early return from updateDisplayInner when !display.wrapper.clientWidth https://github.com/marijnh/CodeMirror/blob/master/lib/codemirror.js#L456\nBlaming it back, I found that the early return was introduced along with .refresh() on resize: https://github.com/marijnh/CodeMirror/commit/7c34a9\nI'm sure there's good reason for the early return, but removing just the single return; line fixes the issue.\nAlternatively, jQuery uses offsetWidth instead of clientWidth for their visibility check (https://github.com/jquery/jquery/blob/master/src/css/hiddenVisibleSelectors.js). That works in IE10, but older versions of IE will also need a check similar to ((elem.style && elem.style.display) || jQuery.css( elem, \"display\" )) === \"none\") to truly know that the element is hidden which probably expands to something much more complicated.\nI'd be happy to submit a pull request with a fix. Is there an approach you'd prefer? Is s/clientWidth/offsetWidth/ on that line a decent enough fix (and old IE doesn't get the early return)?\nCheers!\n. Ah good to know. Thanks for the quick turnaround. \n. 3rd-party observation: It works fine on the demo http://codemirror.net/demo/theme.html . There's no style that would compete with it that I can see.\n. 3rd-party observation: It works fine on the demo http://codemirror.net/demo/theme.html . There's no style that would compete with it that I can see.\n. Cool, cool, cool.\nIf I understand you correctly, then instead of just outputting the HLJS class names in a flattened form, for every CSS class/combo that HLJS applies (e.g. 'tag', 'title', 'attribute' above), I'd need to map it to a cm-(token) value that themes know about (e.g. there's no 'cm-title' afaik, so I might map .tag > .title to cm-tag). Obviously this requires some judgement calls, but it sounds doable.\nThanks for the guidance, I'll see what I can come up with.\n. Oh wow simple mode looks great! I had tried to do this but ended up more or less rewriting hljs and didn't want to go there. Will give simple mode a try. Thanks for the tip! \n. I don't fully understand the code, but I can see that addLineWidget is correctly increasing doc.height, then regChange is called.\nBut in endOperation, it's taking the !forced code path and just doing an updateViewOffset and returning false. This means updateScrollbars is never called, so the new document height is never propagated into the sizer element.\nI'm a bit stuck now just because I don't know the correct change to get this to work without possibly affecting performance somewhere else. Hopefully you know better than I do how to fix it. :)\n. FYI, there is a compounding issue I'm seeing where if I do an editor.refresh() to fix this bug and get the real scrollHeight, it gets reverted sometime later and CodeMirror \"forgets\" about the widget height. I don't have a reduced case for it just yet, but thought I'd mention it in the meantime. I think it has something to do with finishing the initial load. Note the scrollHeight decrease while the clientHeight goes from \"everything visible\" to begin returning the actual CodeMirror size.\n\nI'll open a separate bug for this when I have a clear reproducible case, unless you happen to know what's going on already.\n. Tested locally, and that definitely solves the first problem. Thanks!\nSecondary problem still happens though. I'll try to pinpoint it in another issue.\n. Sorry I can't submit a PR to fix this one right away - reporting it for reference in the meantime.\n. Fixed in 3.24 so I'm closing.\n. Are you still supporting and updating the 3.x branch? I'm about to look at the fix (I'd imagine it's straightforward) and would like to get it onto that branch as we're not ready for a version bump yet.\n. Fixed in 3.24 so I'm closing.\n. Ah wrong target branch\n. Awesome! Cheers!\nOn 16/04/2014 7:55 PM, \"Marijn Haverbeke\" notifications@github.com wrote:\n\nMerged into v3.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2462#issuecomment-40581966\n.\n. Marijn, for what it's worth, this (scrolling glitches) has been our biggest class of bugs as well. I've been trying to fix some of them over time, but there are lots of little edge cases.\n\nLet me know if you have any guidance on the best way I can help to make it more robust. Perhaps more tests in a specific area you know is untested? Are there test infrastructure changes that would help? E. G. Running in more browser environments? Any bit of code that has lots of regressions and would benefit from a refactor so it's easier to grok? Any other weak points that you think are low hanging fruit for more robust scrolling?\nIt's a very vague question, so no worries if you don't have any guidance. \n. Thanks Marijn. I definitely value all the time you've put into this project already. I watch this repo and lurk on all the issue threads, and the investment I see from you is much appreciated. Paying you for your time is definitely an option for us. I'll propose that internally and we'll email you about it if we do decide to go down that route. In the worst case, I'll submit a PR for it myself (when I find the time) because I see a lot of value in a change like this.\nCheers!\n. Hi again, Marijn,\nStefan let me know you guys are talking about consulting for this. Awesome! I'm available to clarify any technical details if you need. I'm aahmed if you want to send me an email @ atlassian.com.\nBest,\nAdam\n. The changes definitely do as requested. Thanks so much!\nWe mostly cared about scrolling, and in our case performance didn't change much, despite the theoretical upside. Hopefully it helps others anyway. :)\n. 4.0 looks like it doesn't have room for the tests and my last patches were applied a little differently. I'll resubmit the patch for 4.0 separately if it still needs the change.\n. When I do, any qualms with me bringing back the test file widget_test.js?\nEDIT: Actually looks like you wrote a similar test anyway https://github.com/marijnh/CodeMirror/commit/bdb0f16f2a5dfcbbc6ef62fdb2b8d3f4acf44e04\nWill look closer at 4.0. Sorry for spamming.\n. Will do. Thanks! \n. Will do - I've not tried to make a reduced test case yet, so the problem could be in our code. \nNote though that the problem is the measure div does reserve space for the gutter, but that since coverGutter widgets use the gutter space as well, the measure div is too narrow for them. \n. Here is a test case: http://jsbin.com/yibezere/1/edit\nThe widget has 2 inline-block elements which fit on a single line when coverGutter is true, but not when in the measure div.\nThis means the document height is wrong until the widget is scrolled into view. (see the console for the height measurements)\n. I think they don't fail because you have Mac's hidden scrollbars. I didn't think about that. On my Android I had to increase the width of the children to see the problem. http://jsbin.com/yibezere/4/edit has wider child elements and reproduces the issue on my Android. \nI'll have to rethink how it's tested, or at least add logic to size them based on the visibility of scrollbars. \nI'm not sure which part of the problem you don't understand though. CoverGutter elements display at a wider width than other widgets, right? Does it not make sense that they need to also be measured at a wider width then? There is currently no code in the widgetHeight function to differentiate them from other widgets (and the implementation of coverGutter is JS-based not CSS-based, so code is required). It'd be great if you could clarify which part doesn't make sense to you and I'll see if I can explain differently.\n. ### Re: Cannot Reproduce\nInteresting. I will look at the test again to see if I can find any issues. I can fail the test in Chrome 35 (stable), Chrome 37 (Canary) and Firefox 29. Are you sure you checked out the right commit? I pushed two commits - one with a failing build, and one that fixes it. If you just checked out the branch head, the test will pass because I've fixed it. More recently I force pushed to add support for hidden scrollbars to the test (and to make it fail when the measure div is too wide, if that ever happens.\nRe: Understanding the problem\nYou are correct - the measure div is the exact same width as a normal line. And that's the problem. :) A widget with coverGutter: true shouldn't be the same width as a line - it needs to be wider.\nWhen a widget with coverGutter:true is placed in a line, the CodeMirror-linewidget element has width and left/margin-left/padding-left styles applied to it that differ from a non-coverGutter widget. You can see this in positionLineWidget on line 937.\nBut this logic never happens when measuring a widget in the measure div.\nIn a measure div:\n\nIn a line:\n\n. It does look like phantom isn't failing on the test, so I will look into that.\n. Actually Phantom fails for me, but Travis is reporting it passes? Does Travis run something else? Maybe Linux is immune to the problem somehow...\n\n. So I DLed turnkey node (http://www.turnkeylinux.org/nodejs) and ran npm install/test from there and it's still failing (other tests are failing too).\n\nI'm kinda at a loss for what's going on on your box and on Travis CI... I cannot reproduce your cannot reproduce!!! :)\nI assure you this problem is real though. I had a coworker running on Mac run the tests too and it fails for him.\n. Have you had a chance to think about this, Marijn? I'm certain there is a problem with the code. If the test doesn't fail for you, the problem is in the test. I can revert my test changes completely and have this go untested, if you prefer.\nLet me know if you still need clarification on the problem too. I'm hoping my screenshots made it clear.\n. Just to add another perspective to this, read-only is generally how we use CodeMirror in Atlassian Stash (in most places, for now). We want a read-only view of the document, but we still want some keyboard handling (like arrow keys to scroll the document, ctrl+c to copy, ctrl+a to select all, tab focus, etc) so we don't use nocursor. We hide the cursor with CSS because it's a bit misleading in an uneditable document to have it flashing at you.\nAll in all, there is probably something between read-only and nocursor that would be ideal for this kind of use. But I agree that nocursor on its own is not helpful.\n. Sorry for the delay. Wasn't really the answer I wanted but I can live with that. Cheers! \n. I'm going to butt in. Apologies if I'm overstepping.\nmyTextArea is just a variable. The example leaves out the creation of myTextArea because there are many ways to obtain one or create one and CodeMirror doesn't care how you get one.\nI read that line in the manual to mean \"a variable whose value is a textarea element\". That you assumed it was an \"element by ID\" says more about your experience with JS and web development than it does about the documentation - this is relatively basic knowledge in that realm.\nThe only question is who the audience is for the docs - should that knowledge be assumed or must the docs go into extreme detail on all matters like this? \nMarijn's response seems to indicate that it should be assumed and that you are an outlier in his target audience. I tend to agree.\nIt works in Chrome and Firefox because you got lucky and those browsers automatically create variables based on element IDs. Presumably this 'feature' was meant to cater to devs like yourself who are unfamiliar with how to obtain an element, though in reality I think it just causes confusions like this one. The Web is full of mistakes like that which can't ever be removed (to support backwards compatibility with preexisting sites). \n. Coolio, cheers!\nI wonder if some dictionary of pseudo class prefixes could be used? hover, focus, active, :, -, first, last, nth, empty,... \nI'll try to PR something like that unless you  have qualms.\n. I haven't tested this, but I'm pretty sure this is just an issue with your RequireJS paths.\nIf you're trying to load the modes from local and the lib from CDNjs, then you'll need to use RequireJS's \"map\" param to tell the modes to look for the lib in a different path. Currently they'll look for it in a relative path (e.g. lib/CodeMirror/lib/codemirror.js instead of codeMirror).\nIf you want ot load everything from CDN, then I think:\n\"codeMirror\" : \"https://cdnjs.cloudflare.com/ajax/libs/codemirror/4.8.0/codemirror\"\nshould probably instead be\n\"codeMirror\" : \"https://cdnjs.cloudflare.com/ajax/libs/codemirror/4.8.0\"\nAnd\nrequire(\n[\n    \"codeMirror\",\n    \"lib/CodeMirror/mode/javascript/javascript\",\nshould probably be\nrequire(\n[\n    \"codeMirror/codemirror\",\n    \"codeMirror/mode/javascript/javascript\"\nAll with a grain of salt since I've not double-checked this.\nUPDATE: Actually the pure CDN version won't work anyway because CodeMirror is on CNDJS in a different structure than it is expected (codemirror has been promoted from ./lib/codemirror.js to just ./codemirror.js). You'll need to use RequireJS \"map\" or some kind of hacky path like:\n\"codeMirror/lib/codemirror\" : \"codeMirror/codemirror\"\n. Awesome. Thanks for fixing it!\n. Just wanted to voice that I also think you should just add the .md extension instead of specific filenames. Nothing about the filename describes the flavor of Markdown, and .md files will always be Markdown.\nI like this patch overall, thanks for it! Means we can simplify some of our own code that worked similarly.\n. Ah in that case, I'm the opposite. :) Idremove the added filenames entirely. There is really nothing about those filenames that says their flavor. \n. You need to add lib/CodeMirror.js and the php mode script files to the page.\nThis is a pretty generic new programmer kind of question so next time I'd suggest asking for help somewhere where you can get more help, like stackoverflow.com\n. ",
    "AndreyNikitin": "you can see error here on IE10 on win7 when clicking on left CM and type something, after that click on rigth CM and when writing you got nothing written (no symbols are written).\nhttps://codio.io/andrey/CodeMirror/master/demo/merge.html\n. sorry. tried another way. on left CM we enter code. then click on arrow to drop new changes from rigth to left. then click on left CM. now can't enter data.\n. microsoft provides virtual machines with ie for testing purposes http://www.modern.ie/\n. ",
    "julieyuan": "I am really sorry, I should file this one in Brackets repo. So closeing it.\n. Hi @marijnh  I agree that it is useful  to have two cursors for mixed direction texture sometimes . Just like what you said, it can deal with LTR/RTL characters flexibly. But for me , sometimes it is a little bit confusing and hard for user to distinguish their position if they tab back/undo or input numbers. \nThere is one issue similar to this one, but I am not sure whether they are related or not. If I input a number at the primary cursor position, the number will be added to the left of the whole string. If I input a number at the secondary cursor position, the number will also be added to the left of the whole string. For more info, please refer to the comments here\nSo, I think if the number issue is not related to the two cursors issue, it seems OK to keep the two cursors. \nThanks:)\n. ",
    "JimUBC": "Here is the error I see in jsbin, \n\nAfter I dismiss the alert this is what I see.\n\n. ",
    "chrisdlangton": "Yes i have seen the link - its widely referenced.\nNo benchmarks because as i am sure you are aware the JavaScript time is not accurate.\nThe benefits are milliseconds per billion iterations, but this is no reason to ignore best practice and importantly performant scripts.\n. Sorry. You misinterpret. JavaScript time is not accurate refers to the JavaScript time apart from jsperf, as in to point out that any bench-marking done using native JavaScript time should be taken with a grain of salt. As I now see you are unaware of the JavaScript time issues please read;\nhttp://ejohn.org/blog/accuracy-of-javascript-time/\nYour tests do not offer bench-marking - so how do past contributions get bench-marked acceptably? Direct me and i shall provide the benchmarks for you.\nAs for jsperf timings being moot, I dont need to because i agree with jsperf which is widely used as a reference.\nCan you point out how you ascertain non-caching is faster? IE gains ~30% increase where as the only browser that has no gain is latest FF and Safari on Widows (FF on mac & *nix still gain from cahcing, so does safari on mac).\nPutting the reference to \u201cbest practices\u201d aside, the work has been done, your tests all pass. The changes are non-intrusive, it was non-trivial work to shame to be wasted.\nThe performance benefit indeed is negligible, but every millisecond counts, right?\n. Let me get this straight.\na) this PR will be closed because i did not supply a benchmark\nb) there is no included benchmark solution\nc i) you avoid to respond with an acceptable benchmark method\nc ii) you avoid to confirm how past contributions were accepted without benchmarks.\nd) tests all pass\ne) you don't acknowledge the benefits but do acknowledge where there will be no benefit?\nAlmost half PRs are closed on first attempt so i fully accepted resistance - i'll open another PR when you are ready to confirm the acceptable benchmark solution.\n. Will this library uncache the length for loops that currently implement it\n. ",
    "lenntt": "I'm sorry, my analysis seems to be incorrect. I cannot reproduce this on the demo page as well.\nI'll look into this later by upgrading my codemirror and check its configurations.\n. oops, I just verified this is fixed for me when I use the latest ruby.js.\n. Thanks Marijn, works great. I obviously overlooked the setOption (and the vimMode)\n. ",
    "VinayKonduri": "Please reply as soon as possible. Thanks In advance\n. ",
    "aadsm": "Thank you very much!\n. ",
    "eugeneo": "I'm comparing this behavior with the text fields, at least on Mac. E.g. I checked the field in Safari that I am now typing the comment in.\nHere:\n1\n2\n3\n4\nI select 2-4, press up - the caret is immediately before 1. Selecting 3-1 and pressing down will put caret before 4.\n. It is interesting that this is platform-dependant. I just tried Windows and it is almost consistent with Mac (the only difference being that if you put caret before 1, then do Shift+Down twice and press down - on Mac the caret will be before 3 and on Windows it will actually be before 4).\nSo this is a matter of preference, with users most likely to prefer their OS way.\n. ",
    "piranha": "But how do I give additional parameters to this function? String could start with ' or with \" and I'm not sure how my function will know what started it. Should I wrap it in another function to make it close over starting character or is there a more performance-friendly way?\n. Ah, I guess I should make it like tokenFactory, right?\n. Ok, I'm sorry for spamming your inbox, but whole thing seems to be done already, it just checks that string starts with delimiter of length more than 1, and in CoffeeScript any string can be multiline.\n. I've checked this and it works for me (fixes #2050).\n. ",
    "MoOx": "I was trying to use codemirror-highlight module with CodeMirror > 3.20.1 (where resolveMode is implemented), but Now I'm getting the error below:\n```\n\n\nReferenceError: CodeMirror is not defined\n    at Object. (XXX/node_modules/codemirror/addon/runmode/runmode.node.js:100:1)\n    at Module._compile (module.js:456:26)\n    at Object.Module._extensions..js (module.js:474:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.require (module.js:364:17)\n    at require (module.js:380:17)\n    at Object. (/XXX//node_modules/codemirror-highlight/lib/highlight.js:6:18)\n    at Module._compile (module.js:456:26)\n    at Object.Module._extensions..js (module.js:474:10)\n```\n\n\nIt seems you add the CodeMirror var dep here https://github.com/marijnh/CodeMirror/commit/78435a5f1d61f8ba93386e8d865c4051b2e3c0f2#diff-fc4fb9076b0dba88ff02c5df320e7a25R94\nIs this expected ?\n. I found an other use case that create incorrect parsing\nscss\nbody {\n    color: darken(rgba(#fff, .8), 10%);\n}\nBoth rgba & #fff are highlighted as errors, but this it totally valid in Sass (scss).\nDo you want a new issue for this one ?\nNote: I use to use Prism.js & create the Sass(scss) parser that inherit from CSS. The fact that it inherit bring more issue than it solves.\n. Cool for the patch. Thanks !\nForget the second issue I've probably an outdated version. I'll update & check this asap.\n. ",
    "plqplq": "I am just trying it on the same PC in the same browser, and all the demos seem to work correctly. So now I am going to push those demos into my app, and I will report back here. thanks\n. OK I have found the problem:\nour site has this:\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\nI change to this:\n<!DOCTYPE html>\nand it works. So I think codemirror only works in html5.\nHere's the full page that makes it go wrong:\nhtml PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"\n\n\n\n\n\n\nwindow.onload = function() {\n    var ele = document.getElementById(\"txt\");\n    var editor = CodeMirror.fromTextArea(ele);\n}\n\n\n\n\n\nfunction xarg(obj)\n{\n    return x(obj.title, obj.subtitle, obj.types, obj.defaults, obj.widths, obj.lookups, obj.fieldnames, obj.keyfields, obj.descfields, obj.infoline, \n                        obj.paramselected, obj.paramunselected, obj.param, obj.allowed, obj.outputfield,\n                        obj.maxlength, obj.rows, obj.returnxml, obj.returndescription, obj.recordsep, obj.argssep, obj.xparam, obj.dlgWidth, obj.dlgHeight);\n}\n\n\n\n\nIts not a problem for me as I can rewrite this page to HTML5.\nthanks\n. ahh sorry the full page did not paste properly into github\n. ",
    "jefflloyd": "Sorry to bump this but regarding the cursor's taller positioning, is that something that can be fixed? I'm using padding-bottom which is less desirable: \n\n. ",
    "mauricioszabo": "I tried some tests with the code in this link, and found out that it's working. But, I want to test it on the code I was writing, I think the problem can be with the minification helper or the page's structure. Could you wait a little, so I can debug the problem and send you a feedback?\n. Ok, solved. The problem was that I was not selecting the \"css.js\" mode, when using the minification helper.\n. ",
    "christophemarois": "@anaran Thanks, that fixed it.\n. ",
    "SebastianZaha": "Forgot to mention, I tested this on Chrome, OSX Mavericks.\n. Hmm, maybe I misunderstand something then. How do you do copy paste now in the emacs mode (without my patch)?\n. If I press C-space, move around, press M-W, and then when I move towards my insertion point, the selection still folows my cursor. If I then C-Y to paste, all is good again. But as far as I can tell, I cannot copy something and then not paste it, because the selection will be forever following my cursor around.\n. ",
    "dmohs": "Yes it does. Awesome! Since that commit is in master, I'm going to delete this branch. Thanks!\n. ",
    "mcavalletto": "I've ham-handedly pushed the addition of Django template support to the same branch instead of submitting it separately; let me know if you need them disentangled.\n. On Jan 6, 2014, at 7:03 AM, Marijn Haverbeke notifications@github.com wrote:\n\nSee the attached patch for an alternative solution to the issue of styling tokens ... \n\nThanks, that looks great -- moving this into the core is a cleaner solution.\n\nIs the non-mixed Django mode ever useful, or would it make sense to just include it as an implementation detail... \n\nYes, I'm using the non-mixed Django mode to let users edit a Django template that generates a plain-text email. \nHowever, I think you're right that the overwhelmingly common use case would be within the context of a mixed mode, with the non-mixed case a rare oddity -- is there a reasonable way to address both objectives by packaging them in one file while still allowing people to invoke the non-mixed mode in those rare cases?\nMuch appreciated,\n. Yeah, the Django modes are straightforward parallels of the Smarty code, which has the same duplication.\nAnother flaw in the mixed-mode support for Smarty that is inherited by this Django implementation is that they do not consistently infiltrate lower-level contexts -- for example, if you place Smarty tags inside of an HTML tag's quoted attribute value (eg <div class=\"{$classname|htmlspecialchars}\">), it's parsed by the XML mode without Smarty support -- and the same is true of the HTML Embedded Scripts modes (eg <div class=\"<%= 'class1 ' + 'class2' %>\">).\nThe way that Smarty/Django/ASP/JSP/etc documents are interpreted first by their templating engine and then separately by the web browser or whatever else receives their output makes them fundamentally unlike some of the other mixed modes, and I haven't yet found a way to represent that in a CodeMirror mode.\n. ",
    "atomicpages": "License has been updated to be compatible with CodeMirror!\n. ",
    "gibiansky": "Looks great. Thanks!\n. Also, the same thing happens for asterisks... but the fix is a bit uglier, since we don't have such a convenient place to change a regex. I'm not sure how to fix that one.\n. Also, the same thing happens if you start with a brace, such as }_a. \nWhat is the right way to fix all of this?\n. I don't think there's an IPython issue tracking this. I like your suggestions, though. Something like this would be a good start:\n``` javascript\nvar starts = [/[^$]\\$/, \"$$\",\"\\begin{aligned}\", \"\\begin{align}\", \"\\begin{align}\"];\nvar ends = [/[^$]\\$/, \"$$\", \"\\end{aligned}\", \"\\end{align}\", \"\\end{align}\"];\nvar modes = Array(starts.length);\nfor (var i = 0; i < starts.length; i++) {\n    var start = starts[i];\n    var end = ends[i];\n    modes = {\n       \"open\" : start, \"close\": end,\n       'mode': CodeMirror.getMode(config, \"text/latex\"),\n     delimStyle: \"delimit\"}\n     };\n}\nCodeMirror.defineMode(\"ipython_markdown\", function(config) {\n  return CodeMirror.multiplexingMode.apply(null,\n    [CodeMirror.getMode(config, \"markdown\")] + modes\n  );\n});\n```\n(I'm not great at Javascript so I don't think this code would work directly, just using it as mostly pseudo-code.)\nSince multiplex.js can do regexes, why not just make the token a non-backslash character followed by $? There must be some other cases to handle like line starts but it seems like it should be doable with one or two ugly regexes to handle the situation.\nThoughts?\n. ",
    "santhoshtr": "\nThis is a case of CodeMirror's simplistic grapheme cluster algorithm not handling the language. Unfortunately, JavaScript does not provide the primitives needed to do sane cluster-boundary detection (finding character properties, etc).\n\nI would like to understand it a bit more. What exact algorithm you need to place the cursor at a logically correct position? If we want to support a lot of languages, we should leave this kind of primitive functionality to browsers. Trying to imitate such behavior will reach no where. \nAlso. how Chrome gives different output than Firefox in this case?\n. I have faced the cursor movement, logical cluster issues in the development of Visual Editor for Wikimedia. Thought of understanding the problem in detail so that I might be able to help.  Will check later, don't have time to find out the details now. Thanks.\n. >  Characters \"\u0d28\u0d4d\u0d24\u0d4b\" act as a single unit, as far as cursor movement is concerned, but only the second code point in that string is an extending character. If I read the document at http://www.unicode.org/reports/tr29/ correctly, this should count as three grapheme clusters, not one. What is going on?\nYou cannot rely on TR29 for getting grapheme clusters for the purpose of the counting or cursor movement.  TR29 clearly explains this. You have to use tailored logic to meet your purpose. That too is not enough since in Indic scripts, depdending on the font, multiple consonants with the help of a joining character like VIRAMA can create single ligatures. Sometime stacking of characters happens. Chrome and FF does not agree on the implementation of character movement on Indic scripts. Chrome allows you to move your cursor as per logical boundaries. FF also follow the same rule, but FF allows placing cursor if you try to do it using a program. You have to ask the browser whether you can place a cursor here or not. Iterating that question over a range of text will give you a reliable cursor placing positions. This can be used for creating a stack of edits useful for undo redo etc. \n. > By 'ask the browser' you mean create a textarea and try to set the cursor in the textarea there? Or is there a more efficient/convenient way to do it on (non-editable) DOM nodes?\nYes, create an editable node and keep on trying to place cursor. Of course it is inefficient and hacky.\n\nIs there an easy/cheap way to determine whether a string might have stacking?\n\nNo, that is not possible. It not only depends on the data but also the font used.\n. ",
    "Jaygiri": "I have removed my previous comment.\nThis language is Malayalam. Fix for #2125 is not fixing positioning for this language.\n. Thanks for the quick-fix. I am testing the fix.\n. Thank you Marjin,\nThis patch has fixed cursor positioning for Hindi. Apart from Hindi this patch has fixed following languages.\n\nHindi  \u0928\u092e\u0938\u094d\u0924\u0947\nKannada \u0cb9\u0cb2\u0cc6\u0cc2\u0cd5\nLao \u0eaa\u0eb0\u0e9a\u0eb2\u0e8d\u0e94\u0eb5\nPanjabi \u0a39\u0a48\u0a32\u0a4b\nTamil \u0bb5\u0ba3\u0b95\u0bcd\u0b95\u0bae\u0bcd\nTelugu \u0c39\u0c32\u0c4b\nThai \u0e2a\u0e27\u0e31\u0e2a\u0e14\u0e35\n\nThese languages still not showing correct position of cursor. Marathi and Nepali both share script with Hindi, same rules should be applied there too.\nMarathi \u0939\u0945\u0932\u094b\nNepali \u0928\u092e\u0938\u094d\u0915\u093e\u0930\nBangali \u09b9\u09cd\u09af\u09be\u09b2\u09cb\nGujarati  \u0ab9\u0ac7\u0ab2\u0acb\nKhmer \u1787\u17c6\u179a\u17b6\u1794\u179f\u17bd\u179a\nMalayalam \u0d38\u0d28\u0d4d\u0d24\u0d4b\u0d37\u0d4d (see #2115)\nI tested all the languages available in Google Translate - cursor positioning for other languages looks good.\nThanks again.\nPS: I have tested Hello for most of the languages. It might miss few use case. I am only confident about Hindi, Gujarati, Marathi, Nepali and Bangali.\n. ",
    "cartove": "@marijnh Arabic doesn't work correctly same as Thai.\n. ",
    "sadig41": "Can't make RTL for arabic?. ",
    "idanush": "Thanks :+1: \n. ",
    "coodoo": "hey thanks for getting back to me. \nI was basically asking this, note the expected result. (as a side note, brackets uses codemirror).\nI'm hacking into the code now as you suggested trying to implement this, but hopefully this had already been done somewhere so I got something to base on :)\n. hey that was nice, you basically nailed it, thanks for helping out here.\nI did some minor changes to better fit the feature, here's what I got, probably you could make it better?\n``` javascript\nvar tabs = 0;\n// persist tab count for current line\n// otherwise once new content was pasted I can't get this information\ncm.on('keyup', function(cm, evt){\n    if( evt.keyCode == 9 ){\n        var currentLine = this.doc.getLine(cm.getCursor().line);\n        tabs = currentLine.match(/\\t/gim).length;\n        console.log( 'pos: ', tabs );\n    }else{\n        tabs = 0;\n    }\n})\ncm.on(\"change\", function(cm, change) {\nif (change.origin != \"paste\" || change.text.length < 2) return;\nvar spaces = tabs * cm.options.tabSize;\ncm.operation(function() {\n    for (var line = change.from.line + 1, end = CodeMirror.changeEnd(change).line; line <= end; ++line)\n        cm.indentLine(line, spaces);\n});\n\n});\n```\nWith above code, I could paste anything with random number of tabs ahead, result looks like this:\n``` javascript\ncm.on(\"change\", function(cm, change) {\n  if (foo != bar ) return;\n  cm.operation(function() {\n    for (var line = 2; line < end; ++line)\n      cm.indentLine(line, \"smart\");\n  });\n});\n    // 1 tab\n    cm.on(\"change\", function(cm, change) {\n      if (foo != bar ) return;\n      cm.operation(function() {\n        for (var line = 2; line < end; ++line)\n          cm.indentLine(line, \"smart\");\n      });\n    });\n        // 2 tabs\n        cm.on(\"change\", function(cm, change) {\n          if (foo != bar ) return;\n          cm.operation(function() {\n            for (var line = 2; line < end; ++line)\n              cm.indentLine(line, \"smart\");\n          });\n        });\n            // 3 tabs\n            cm.on(\"change\", function(cm, change) {\n              if (foo != bar ) return;\n              cm.operation(function() {\n                for (var line = 2; line < end; ++line)\n                  cm.indentLine(line, \"smart\");\n              });\n            });\n```\n. The use case is like this:\n- I might move cursor to line 3\n- hit tab key twice\n- then paste in multiple line of code\nThat keyup handler part is used to track which line the cursor was at before pasting, also detect how many tabs were there in that line, so that I know how to indent pasted content accordingly (say there were two tabs in the line, so I know every pasted line must add 8 spaces to maintain the indentation).\nMake sense?\nI just have a feeling there should be a more elegant way to do that but this was my first 30 minutes with the code base so...\n. Thanks for the reply and that makes sense, I've found a way to workaround the issue.\n. replaceRange has an API like this:\ndoc.replaceRange(replacement: string, from: {line, ch}, to: {line, ch}, ?origin: string)\nI passed in the origin argument with a value @ignore and made sure all event listeners check for that argument then act accordingly, worked like a champ for me, hth.. ",
    "xkxx": "hum, I think it would be better to have an option to turn it on, because currently reading asm.js code in CodeMirror is tad disorienting, because none of the operators are highlighted.\nIs there any data backing the performance increase which came from this optimization?\n. ",
    "sheerun": "+1\n. ",
    "kasatch": "I am using CodeMirror version 3.16.\nAfter applying patch the problem is gone. Thanks for the fix/workaround. :)\n. I confirm that after downloading the latest version with your patch, the issue is resolved. :-)\nThank you for help. :-)\n. ",
    "rfranke": "The Modelica mode can now be seen under \n    http://omuses.github.io/moijs\n. ",
    "Miraculix87": "That may be true but why is the semicolon used on ervery other line like: \nhttps://github.com/marijnh/CodeMirror/blob/master/theme/midnight.css#L24\nhttps://github.com/marijnh/CodeMirror/blob/master/theme/midnight.css#L25\nhttps://github.com/marijnh/CodeMirror/blob/master/theme/midnight.css#L26\nSeems to me it was a typo. So, for consistency's sake would it be better to add it or to remove all the other ones.\nalso see\nhttp://www.w3.org/TR/CSS21/syndata.html#rule-sets\n. ",
    "wesleywiser": "@marijnh I thought about that but there would need to be more invasive changes than just changing the recognized keywords since F# also has a number of additions to the OCaml style grammar. For instance, comments can be any of ///comment /* comment */ (* comment *) where OCaml just supports (* comments *). Do you think that's the right approach?\n. Ok. I'll take a look at those and change the pull request.\nOn Jan 11, 2014 4:15 PM, \"Marijn Haverbeke\" notifications@github.com\nwrote:\n\nThere are some modes that parse multiple similar languages already (the\nCSS mode handles LESS and SCSS, the JavaScript mode handles JSON and\nTypeScript, etc) though configuration options. Something like comment\nsyntax is very easy to make configurable.\nIt'd save quite a bit of code duplication, which is always nice.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2136#issuecomment-32107315\n.\n. @marijnh Good call. It was easy enough to re-use the existing OCaml mode.\n. \n",
    "brondsem": "As a workaround, you can style the previous lines with this snippet in your own code.  I'm not sure if there would be an appropriate place to include this as part of the built-in markdown mode.\njavascript\nfunction updateSectionHeaderStyles(cm, change) {\n  var lines = cm.lineCount();\n  for (var i = Math.max(0, change.from.line-1); i <= Math.min(change.to.line+1, lines-1); i++) {\n    var line = cm.getLineHandle(i);\n    cm.removeLineClass(line, 'text', 'cm-header');\n    cm.removeLineClass(line, 'text', 'cm-header-1');\n    cm.removeLineClass(line, 'text', 'cm-header-2');\n    var lineTokens = cm.getLineTokens(i);\n    var tok = lineTokens[0];\n    if (!tok || !tok.type || tok.type.indexOf('header') === -1) {\n      // first token could be some spaces, try 2nd\n      tok = lineTokens[1];\n    }\n    if (tok && tok.type && tok.type.indexOf('header') !== -1\n      && tok.string !== '#') { // not ATX header style, which starts with #\n      var classes = tok.type.\n        split(' ').\n        filter(function(cls) { return cls.indexOf('header') === 0; }).\n        map(function (cls) { return 'cm-' + cls; }).\n        join(' ');\n      var prev_line = cm.getLineHandle(i-1);\n      cm.addLineClass(prev_line, 'text', classes);\n    }\n  }\n}\nmyCodeMirror.on(\"change\", updateSectionHeaderStyles);\nupdateSectionHeaderStyles(myCodeMirror, {from: {line: 0}, to: {line: myCodeMirror.lineCount()}});\n. That does make sense and I'll see what I can do.  I wonder if its ok for the gfm mode to support ~~~?\n. Updated with a new commit.\n. I think actually it isn't a fenced block being parsed in that case, but a multiline ` code span being parsed (which [is allowed](http://spec.commonmark.org/0.22/#code-spans)).  Visually they look similar because they are both code/comment lines.  But if you look at the parse state (e.g. by settinghighlightFormattingon and checking the CSS classes) there iscm-formatting cm-formatting-code cm-commentfor the first line of a ``` section whenfencedCodeBlocksis off, and when it is on it iscm-formatting cm-formatting-code-block cm-comment`\nThe markdown mode does in fact check that fencedCodeBlocks is on before parsing for that.  I've looked at that recently for my PR #3496\nI am not sure what to do about the end result of this though.  Perhaps figure out some way to style code blocks differently than code spans, if you want to differentiate them.\n. I don't remember exactly how code spans are parsed by the markdown mode, but the CommonMark spec says they can be multiple ticks, so four consecutive would begin one span.  See the first sentences of http://spec.commonmark.org/0.22/#code-spans\n. ",
    "tobloef": "Any possibility of this issue getting reopened as a feature request? It would be very nice if the workaround posted by brondsem wasn't necessary. \n. ",
    "dwelle": "Made a quick naive fix in this branch over here. It's still not 100% CM-compliant, but it fixes styling for the line immediately before the ------ setext line.\nAlso not sure if it doesn't have some major performance implications. Do we have some perf benchmarks we could run on this?. we can close since it appears to work correctly now. Gonna look into this.. associated commit doesn't really \"fix\" this, but for now IMO better than nothing  :blush:. Mainly styling issue. I purposefully enabled gutter to illustrate, but we keep the gutter disabled and in certain cases having padding in the hundreds of pixels, which makes it very ugly when selecting lines.\nIn the first 2 screens I see no point why the selection should span to the start -- it may make some sense when the padding is 5-10px, but when it's more, it's more distracting than not.\n3rd screen seems like a bug altogether since the selection does not start from the beginning, while the text does. I mean, there's at 2-3px offset of the selection from the start of the editor, which shouldn't be the case (or at least the text shouldn't be allowed to start right off the border, even if paddingLeft is set to 0, same as the selection layer isn't).\nEither way, how about we add an option clipSelectionToContentBox to support this behavior?\n. > What for?\nTo make the editor in the center of the screen while making it possible to click outside the bounds to the left/right to put the cursor on respective line.\nThis is how we've done it previously with ace, and both in ace and cm it works superb (except ace's visual glitch).. @adrianheine yea, I guess it's just another point in the tally against defaulting to contenteditable in the future. Seems it comes down to line-height of pre elements... It's set to inherit by default but if the document doesn't set it anywhere, ~~FF sets it (in this case) to some value which I have no idea where it got from (there's no line-height set anywhere in the ancestry tree AFAIK).~~ Actually, it does seem to use the default normal (wasn't clear from FF's computed panel) as any browser should, but it seems it doesn't apply it correctly to the empty line as it does to the non-empty line.\nIn the demos, line-height is inherited from body defined in docs.css.\nSetting it explicitly solves the issue.\n. Can't say.. I've only recently started migrating from ace.\nAlso, happens for contenteditable inputStyle. In textarea there's whole another bug with wrapped lines, but I'm not sure if textarea is even meant to be supported on mobile devices at all.. Also would add that the above behavior happens when using textarea inputStyle.\nIn contenteditable, the bug works in the opposite way: goLineLeft works well, but with goLineRight  the cursor always (irrespective to it's initial position on that line) ends up on the beginning of next line.\nFor the contenteditable behavior, I used CM 5.26.0. For the original bug, 5.27.x (or whatever is on the demo page).. The initial bug seems to be caused by charCoords() reporting wrong top position - returns next (visual) line, when the cursor is at the end of previous line.\nUsing cursorCoords() instead seems to work fine, tho I didn't look into why.\n// amended `goLineLeft`\ncm.extendSelectionsBy(() => {\n    const top = cm.cursorCoords( false, \"div\" ).top + 5;\n    return cm.coordsChar({ left: 0, top }, \"div\")\n});. Yep, I patched it the same way in my fork.. WTBS, goLineLeftSmart should use the same.. And now it becomes obvious why goLineLeft doesn't work correctly (https://github.com/codemirror/CodeMirror/issues/4840) when (visually) at the end of line 0, because the charCoords() checks char 40 which is at line 1 (but the cursorCoords() checks cursor which is at line 0).\nThis nicely illustrates why the OP behavior is clearly wrong, coz currently this call:\nconsole.log( cm.cursorCoords().top, cm.charCoords(cm.getCursor()).top )\nreports top pos of 2 different lines (when cursor visually at the end of line 0).. Solution seems simple: Set position's sticky: \"after\" when moving horizontally (unless there's something that'll break due to this change, but I think it shouldn't).\nYou can check a proposed fix here - it also contains changes to goLineRight to make the behavior consistent, and also fixes related issue: https://github.com/codemirror/CodeMirror/issues/4840. > When there's no whitespace around the line-wrapping point, it should appear at the end of the current line before moving to the next line.\nNot necessarily. E.g. Atom, Brackets, or notepad++ doesn't do that -- they don't allow you to move the cursor after the last character on a wrapped line if there's no space after it, and instead move it to next line:\n\nSublime text does allow that, but to counterbalance it, it doesn't allow that from the right-to-left movement on the next line.\nSo, we should decide on a behavior (I'd go with the one used in most editors, i.e. the first one), and stick to it.\nProblem with current behavior is that it's not consistent. It allows both behaviors which is not consistent and thus results in incorrect behavior (as demonstrated e.g. when setting cursor programmatically).. @Niharika29 no... there are 2 different inputStyles (contenteditable & textarea, one used on mobile and the other on desktop, simply put) and if we let browsers do their own thing on each (which is not possibly anyway, at least for textarea inputStyle, due to how CM works), we would end up with potentially wildly inconsistent behavior (WTBS, currently there still are inconsistencies stemming up from some of the parts of contenteditable behavior being left up to the browser).\nIn any case, even native behavior varies across browsers. If you try this fiddle, chrome handles cursor movement \"correctly\", while FF has the same inconsistent behavior as CM currently does. So deferring to native browser behavior wouldn't solve this problem.\nI'm gonna issue a PR addressing this, but we need to settle on a solution (there are 2 ways to do this, both correct). Also it'll be a breaking change not to take lightly (unless we put it under an option, but that could complicate the codebase considerably, and I think CM should handle cursor movement correctly by default).. You can simply do cm.getCursor().line - 1. I have a pretty solid (IMO) implementation of this and can issue a PR if there's interest.\n(can't post a link to a fork, coz I have it implemented as a part of a wrapper lib for cm editor, so would require a bit more work to separate it into a standalone feature and put into a fork for PR).. Right on.. I personally don't like the behavior of putting next cursor on a wrapped line, so I didn't bother with that case. WTBS if that's a standard behavior, we should probably stick with that (or let user choose).\nFor that purpose, I'd do what cm does and use findPosV. also would ensure it accounts for when text is selected and tries to select same amount of columns (ST doesn't do that, but it seems to be fairly standard--and useful--behavior nowdays).\nAnd make sure (if you're doing the PR @nickasd) that original selection direction is taken into account. >  I found that it has the Ctrl-Shift-Up/Down hotkey \nActually, it uses ctrl+alt+down/up (which is standard -- ace, atom do the same)\n\nSince Sublime has no wrapping lines, there should be a way to have cm.findPosV() find the logical next line and not the visual (possibly wrapped) one. \n\nIt has line wrapping (and if not by default, it can be easily set). But common behavior is for the cursor to extend to the visual (wrapped) line first, so you do want to use the cm.findPosV\n. on second thought... the EOL seems not really consistent throughout the project. At least some files in bin/ folder seems to have LF only.. IMO I'd normalize the EOLs in that folder to CRLF . speaking of which, made the editorconfig itself LF-only by mistake due to my default settings... :man_facepalming: . force-pushed change to .editorconfig commit, and added the .gitattributes changes. yea, CRLF can burn. rebased to latest master and amended. force pushed once again to align with project's styleguide. Sounds like a good idea. Should not be part of plain markdown, but gfm specifies emojis so I'd put it there.\nI can look at it next week.\n/cc @marijnh . The basic functionality has been implemented, so can be closed - I don't think the replace-emoji-markup-with-actual-emoji is applicable for markdown mode, at this time.. I don't think syntax mode is made for replacing text. If you register a change handler and scan only what's been written (current line), or pasted (block of lines), then perf shouldn't be an issue.. Yea, I'm aware of that -- not sure if that's really authoritative. I started with that regex but decided to include ?/! so it covers :?: etc. coz it seemed it might be common. But since we're implementing gfm, I guess it is. Gonna revert.\n. Btw, do we frown upon adding custom props on stream object? I'd like to either cache some line-specific data, which would be much easier than putting it in state where we'd have to initialize/copy/reset manually.\nPoint is for other block/inline tokens on the same line to have access to some state data relating to that given line. As I understand it, the stream object is re-used for the whole line so the data we'd cache on it would not be ever re-set for that line, right?. Do you think we should get rid of the gfm fencedCode and move it to base markdown as suggested in OP?. > The gfm mode definitely needs to be rewritten\nFore sure. But before then, what I'm suggesting is to move fencedCodeBlocks over to base markdown since they belong to CommonMark by default.\nThe base markdown mode would always be non-compliant and buggy if we keep fencedCodeBlocks in gfm.\nI.e., as of now, this makes using base markdown mode not very useful.. Cool. I'll make a PR later.. Are you talking about hard wrapping?. @adrianheine unfortunately I'm on Windows and don't have access to a mac machine, so can't add much to this discussion, If I understood it correctly.\nWTBS (/c @mtaran-google) is OP talking about the logical/visual lines at all? I understood that this issue is only related to key mapping.. LGTM for PC, as for mac no idea...\nIn my sublime text 2 default OSX keymap, there's:\n{ \"keys\": [\"ctrl+shift+up\"], \"command\": \"select_lines\", \"args\": {\"forward\": false} },\n    { \"keys\": [\"ctrl+shift+down\"], \"command\": \"select_lines\", \"args\": {\"forward\": true} },\nwhich seems to be current behavior in CM.. . in that case we can either ignore it (I'll remove the eol from the editorconfig), or we can ensure files are checked out with lf, because currently it's forced to autocrlf on windows due to the .gitattributes config (which takes precedence over global git config, where I have autocrlf=false).\nWe could tweak the .gitattributes as follows:\n*.txt   text eol=lf\n*.js    text eol=lf\n*.html  text eol=lf\n*.md    text eol=lf\n*.json  text eol=lf\n*.yml   text eol=lf\n*.css   text eol=lf\n*.svg   text eol=lf. should ensure LF both on check-out and check-in (commit). permanently removed this test coz it's not a valid CommonMark codeBlock termination... will need to update tokenizer later.. ",
    "bvallelunga": "@marijnh I implement the suggestion above and it worked for all cases but one. When a user hits the enter key creating a new line, codemirror automatically smart indents the new line. But the change object does not reflect the indentation so when the other users receive the change object it is not indented. Do you have any suggestions?\nMy editor init code\njavascript\nCodeMirror.fromTextArea(document.getElementById(\"code\"), {\n        lineNumbers: true,\n        lineWrapping: false,\n        matchBrackets: true,\n        matchTags: true,\n        extraKeys: {\"Ctrl-J\": \"toMatchingTag\"},\n        tabMode: \"indent\",\n        theme: \"laborate\",\n        indentUnit: 4,\n        indentWithTabs: true,\n        smartIndent: true,\n        autofocus: true,\n        dragDrop: true,\n        autoCloseBrackets: true,\n        autoCloseTags: true,\n        highlightSelectionMatches: true,\n        styleSelectedText: true,\n        styleActiveLine: false,\n        showTrailingSpace: true,\n        gutters: [\"CodeMirror-linenumbers\", \"breakpoints\"]\n });\nWhat I Typed\njavascript\nfunction {\n      alert(123);\n}\nWhat Other Users Saw\njavascript\nfunction() {\nalert()123;\n}\nYou can see that because the other users did not have the indentation. When I typed 123 in the alert it was placed outside the alert for the other users. Thank you again for all the help you have and will bring. If I can buy you a beer just to say thanks I would be done to. Do you have a gittip or paypal?\n. i was not checking for the next property on the change event. thank you. i completely forgot about the next property\n. ",
    "dongpei021": "This works. Weird not included in documentation.\n. oh, I am using an old version. Thanks\n. ",
    "sheopory": "Apparently that doesn't happen. At least in IE9 a simple test case fails:\ncm.focus()\nassertTrue(cm.hasFocus())\n. Just test. What is a good way to test this now?\n. FWIW I do intend to revert this change. Just curious what the best way to test focus is.\n. ",
    "elyseholladay": "thanks for filing this for me, chris! sorry\u2014got busy, should have done it myself :sparkling_heart: \n. ",
    "ankitstarski": "@chriscoyier as I told Marijn that this was my first contribution and I was in a haste to submit the patch. I'll try to improve this code even more in a few days. Also, I'm fan of CSS-Tricks, thanks for such a good resource. I've learnt a lot from it. \n@marijnh I thought of dedenting issue. But, highly nested nature of SCSS and lack of braces in SCSS makes it impossible for even a human to determine the correct point of dedent.\neg:\n``` scss\nbody\n    color: red\ndiv\n    position: relative\n\n```\ncould also be interpreted as \n``` scss\nbody\n    color: red\ndiv\n    position: relative\n```\nany alternate opinions for auto-indent?\nAnd yes... I love eloquent javascript :P\n. Yes!\n. Hi, \nI'm new to this.\nI don't understand what happened here. Can anyone help?\nTravis CI says weird error 1 and  mode/sass/sass.js: Trailing whitespace at line 256, column 45 but it also says All passed. \nI checked there no white space there and I'm using git's auto convert CRLF to LF setting.\nThanks \nAnkit\n. Fixed it!\nIt was a linting error after all.\nPreviously bin/lint on my PC was showing (minor) Licence blob error only because of different line endings. I had to fix my line endings then it worked fine except a few trailing spaces of course.\n. It was my first contribution so I was in a kind of eagerly rush to see this code getting merged also I was trying to play safe by not altering the code too much.\nNow I think can fix it completely; I'll get back to you in a few days. \n. ",
    "ConnorKrammer": "Here's an update on this.\nI did some more testing and discovered that, even with a font size of 15px, the problem exists (just not as noticeably). It seems that as long as each line is short enough so as not to trigger line wrapping, the problem goes away entirely.\nMy test case for this was to create a CodeMirror instance with the default font styles and paste in ~5000 lines of text, some of which triggered line wrapping. Then I watched the size of the CodeMirror-sizer element as I scrolled through the document and CodeMirror rendered it. Just as with the larger font sizes, the height on the sizer element changed as I scrolled. In comparison, with the same number of lines, in every font size that I tried, as long as none of the lines wrapped onto the next line then the size was accurate, and remained constant.\nI've updated the title to reflect this.\n. So, I've narrowed it down.\nBasically what happens is this: when a large number of lines are inserted, unless the viewport is set to render the entire document, lines outside of the render range don't have their heights updated. This isn't a problem if the lines aren't long enough to wrap around (since their height defaults to one line by default), but if they do wrap then the total CodeMirror-sizer's height is off.\nI'll keep looking for a fix. It's possible that this isn't something that you'd want to change in the CodeMirror core, and that should be implemented by users, but it would be nice if there was a function to call to force an update on all line heights (something like refresh()).\n. Whoops.\n. ",
    "ilvalle": "I've seen that the content of the file is:\n```\ncoding: utf8\n```\n. Sorry, I've discovered what was wrong with my code. By changing\neditor.foldCode(CodeMirror.Pos(8, 0));\nto\neditor.foldCode(CodeMirror.Pos(0, 0));\nfixed the issue.\n2014/1/22 Marijn Haverbeke notifications@github.com\n\nIt is not clear what you are doing. Please provide an HTML page that\nreproduces the problem.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/issues/2167#issuecomment-33020495\n.\n. \n",
    "WebsiteDeveloper": "@marijnh Thanks\n. ",
    "amsul": "Yeah it fixes this issue.\nHowever my script continues to execute until I get the warning:\nObject [object Object] has no method 'startState'\nI believe it has something to do with the \"null\" mode defined within runmode.node.js. Although it's defined the same way in other areas so I'm not completely sure that's the cause.\n. Not quite sure how I would submit a test case for this scenario - but I have given some more context and a fix here: #2207 \nHope that helps!\n. Sweet!\nBrings me to another question.. is it possible to configure that when I'm initializing an editor? \n. Yeah that seems to work for xml.. But when using html, it doesn't seem to cascade the option through :(\n. Yup, sure. Looking into it now..\n. It doesn\u2019t quite work as expected at the moment. Take a look here: http://jsfiddle.net/zSmGP/\nIf you comment out line 10 and uncomment 6-9 and run it again, it parses the content as text/plain.\n. Yup seems so! Moved stuff around while debugging and forgot to undo it. Just updated the PR without those changes.\n. ",
    "colelawrence": "If the line height is greater than 1.25 there becomes an attaching selection area as seen here:\nI achieved the second image by simply adjusting line:20 of the index.html\nfrom:\n    .CodeMirror pre { padding-left: 7px; line-height: 1.25; }\n\nto\n    .CodeMirror pre { padding-left: 7px; line-height: 1.5; }\n\n. This is actually fixed in v4 though (except those linenumbers)\n\n. A change event is fired on doc.setValue(), I would assume that the literal meaning of swapping documents would mean that the document doesn't change.\nIt looks like the swapDoc operation fires the \"swapDoc\" event:\nhttps://github.com/marijnh/CodeMirror/blob/master/lib/codemirror.js#L3292\njavascript\n    swapDoc: methodOp(function(doc) {\n      var old = this.doc;\n      old.cm = null;\n      attachDoc(this, doc);\n      clearCaches(this);\n      resetInput(this);\n      this.scrollTo(doc.scrollLeft, doc.scrollTop);\n      signalLater(this, \"swapDoc\", this, old);\n      return old;\n    }),\n. I think the answer to whether this is practical/possible is on these lines:\nhttps://github.com/marijnh/CodeMirror/blob/master/lib/codemirror.js#L1484\n. What if the textarea always had a single space value \" \" with the cursor after it and we just listened for event changes? Can I immediately clear input and never actually show the textarea value? It shouldn't cause too many problems considering that selection doesn't work at all for mobile devices anyway.\nIs that the same concept used for that last attempt: https://github.com/marijnh/CodeMirror/commit/532c8f3a983b94957662169bc3cd06eb2dfd41b3 ?\n. Did you edit which commit that was?\nI found what you were talking about here: 3c3003cff45675b502c7536b42236739a1688e36\nIt works for the first time you backspace on Android Chrome, but then obviously the textarea is empty again.\nI tried a couple things also, and came to realize that you will need to reset that '_' part of the textarea and prevInput upon every backspace (Also I think I saw backspacing over newlines showing a different behaviour).\n. I can check right now.\nOn Oct 20, 2014 11:09 AM, \"Marijn Haverbeke\" notifications@github.com\nwrote:\n\nIs this still happening in recent Android versions?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/2234#issuecomment-59787186\n.\n. Yes, this is still a relevant bug tested on v4.6 from http://codemirror.net\n(20/10/14)\n\nThe issue as researched before, lies in the fact that an invisible\ntextinput appears where your cursor is for typing, but Android does not\nfire backspace keyevents when you change the text input.\nThis means that as you type the characters you type are inserted into the\ninvisible text input (intended) but backspacing the text input more than\nwhat you typed when that input was created, does not delete previous text.\nIt was discussed that this might be solved by initiallizing the input with\na single space that could be backspaced, but I think I remember there being\ncomplex problems behind this solution.\n On Oct 20, 2014 11:09 AM, \"Marijn Haverbeke\" notifications@github.com\nwrote:\n\nIs this still happening in recent Android versions?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/2234#issuecomment-59787186\n.\n. Awesome! Thanks!\nOn Feb 24, 2015 7:40 AM, \"Marijn Haverbeke\" notifications@github.com\nwrote:\nClosed #2234 https://github.com/codemirror/CodeMirror/issues/2234.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/2234#event-240904330.\n. I can't seem to reproduce the first situation anymore. I must have been right clicking my selections in the first scenario.\n. I did not. The cursors do not have a z-index attributed to them.\nI took another screenshot with a semi-transparent blue selection color:\n\n\nWe can see that the selection boxes are being drawn over the cursors. I can replicate this glitch on Chrome 32, Canary 34, Opera 19, and Firefox 25.\n. Normally the cursor isn't shown when selecting in CodeMirror, but it is shown in all the text editors I've used so I want it shown. What is strange is the way that left border is covered, it looks like the left border would show to the left of the selection, because the selection and cursor are set to the same left value.\nHere's another photo taken of the codemirror.net/4 page\n\n. Active line is now rendered above the selection\n\n. Cool! I was tinkering with the multiselect.js file and noticed you use cm.getCursor(\"from\") and cm.getCursor(\"to\") instead of just cur = cm.getCursor(), even when you need cur.from on more than one occasion. Is that significantly easier/more efficient to use?\n. Cool, thanks!\nI'll reopen when feedback is needed :smile:\n. What is the difference between this and runmode?\n. Oh! It was the way you worded it\n\nCreated a Puppet mode that only performs syntax highlighting\n\nIt sounds like a CodeMirror Mode that only highlights syntax if that makes sense.\nI didn't realize this was a language :smile: my bad!\n. I'll reopen this when after I make more progress.\n. @marijnh Is the Esc keybinding intentionally inoperable because of the way the browser handles it?\nFor the escape key I've had to use a keyup event listener on the window before, then refocus the CodeMirror and execCommand(\"singleSelectionTop\") because CodeMirror does not hear the Esc key being pressed/released.\nIs this something that we can fix?\nI'm on Chrome 32.\n. Yikes! I'm sorry, it's probably one of my extensions because I just tried it in incognito and it worked fine.\n. Whoops pulling into the wrong branch\n. Oh, this is a syntax highlighting feature. Would this be specific to the php language highlighter?\n. I'm not seeing this on Chrome 36, Win8 or Opera 23, Win8.\nLink to line in question: \nminimal = hasCopyEvent &&\n. > What if you just set cursorBlinkRate to zero and define a CSS animation for CodeMirror-cursor?\nThe cursor is hard for me to track while moving quickly, so I use the timeout before applying the animation class.\n. Oh cool, that's a good idea.\nOn Aug 14, 2014 6:33 AM, \"Marijn Haverbeke\" notifications@github.com\nwrote:\n\nGood point, but that can also be solved outside of the CodeMirror core --\nregister a \"cursorActivity\" handler that briefly removes the animated css\nclass, and then puts it back.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/marijnh/CodeMirror/issues/2733#issuecomment-52172501.\n. Thanks for your initerest, I will look at it later today and get back to\nyou.\nOn Sep 25, 2014 4:21 AM, \"Alpesh Prajapati\" notifications@github.com\nwrote:\nHello @ZombieHippie https://github.com/ZombieHippie , I have put your\ncss code for animation. However, I am finding one issue only in chrome.\nCursor first blinks and when you select any word through double-click,\nagain you click on any where in page, cursor stops blinking. It should\nrestart blinking but it doesnot.\nCan you please take a look at this ?\nThanks,\nAlpesh\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/2733#issuecomment-56793961\n.\n. Actually, I'm not sure if I can diagnose this issue, as I haven't needed to\nlook at this code for quite some time. Considering this will not be merged\ninto master, it may not be an issue worth other people's time to look at.\nSorry.\nOn Sep 25, 2014 4:21 AM, \"Alpesh Prajapati\" notifications@github.com\nwrote:\nHello @ZombieHippie https://github.com/ZombieHippie , I have put your\ncss code for animation. However, I am finding one issue only in chrome.\nCursor first blinks and when you select any word through double-click,\nagain you click on any where in page, cursor stops blinking. It should\nrestart blinking but it doesnot.\nCan you please take a look at this ?\nThanks,\nAlpesh\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/2733#issuecomment-56793961\n.\n. @marijnh, thanks for the feedback, I'm looking into a way around this glitch with github.\n\nI'm looking into the lineNumberFormatter option.\n. > But there's still the issue of this being entirely unsupported by some of the older browsers that we support.\nMay we check compatibility to determine which method to use? I'm fairly certain that if the line numbers are TextNode, or if they are css:before content, they should style the same.\n. I'll update this issue after\n[ ] I have done performance tests, and\n[ ] I find resources attesting to a cross platform compatibility check.\nOn Tue, Dec 15, 2015, 3:19 PM Marijn Haverbeke notifications@github.com\nwrote:\n\nSure. Checking for someElement.style.content != null might cover the\nfeature check. Also please do some benchmarks (for example creating /\nmodifying a test page full of nodes filled with content vs plain text\nnodes) to see if there's a performance impact.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3695#issuecomment-164899680\n.\n. @marijnh Hello, do we know of any browsers that do not support css content? CSS Content - caniuse W3Schools CSS Content\n\nMay you suggest a browser that this would break in? So that I may verify support checks for the feature?\nI have made some modifications to the source of my gh-pages branch so we may see the discerning differences between css content and textnode on this \"side-by-side\" testing page\nTesting the change on both my desktop (very up to date hardware) and my netbook which does all graphics rendering on it's inexpensive dual core processor, there is very little difference in the speed at which the page is rendered.\nDo we also need to update the code underneath the patchDisplay code?\n. @marijnh I agree that a change like this should probably be considered for a major release as it could break a plugin that depends on reading the DOM structure for line numbers.\nI wonder if just using CSS user-select: none could also address this.... Ah, okay. That's right, I had forgotten that effect.\nOn Fri, Oct 20, 2017, 10:53 AM Marijn Haverbeke notifications@github.com\nwrote:\n\nI wonder if just using CSS user-select: none could also address this...\nUnfortunately, no. That'll hide the selection markers, but still copy the\ntext on at least some browsers.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3696#issuecomment-338246764,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ACyjUw7-xH6awVissTAegxns97iFr-BDks5suMHtgaJpZM4Gy_sP\n.\n. @marijnh Yeah, that would work too.\n\nif (typeof callback.appendChild === \"function\") {\n. ",
    "iclems": "Will be trying to stress test CodeMirror only with latest Chrome tomorrow and report asap\n. ",
    "prdonahue": "This issue is prominent in Postman, although they are using a very(!) old version of CodeMirror, i.e., v2.38. Does anyone know if this issue was ever identified and resolved? If so, could you please point me to the commit or version in which it was fixed? Thanks!\n. ",
    "prasoon2211": "@marijnh : Review please.\n. So, it seems that there were some more hacks for detection of cell magics in the IPython codebase.\nChanged status to WIP.\n. I'm closing this. Someone else (a regular IPython contributor) has started a separate work for this (here)[https://github.com/Carreau/CodeMirror/compare/ipython-mode].\n. ",
    "nournia": "Excellent. Thanks.\n. Great work! It doesn't have anyone of reported bugs in this PR.\n. It seems that this bug doesn't exist any more, but I've experienced another issue like this one.\nWhen there is a wrapped line which is over fitted to the editor size, pressing right arrow on next line (after that wrapped one) moves cursor to last character of first segment of wrapped line (that is first line of wrapped line). I expect it to be moved to the last character of wrapped line.\nSort of complicated, I hope you can reproduce it!!!\n. ",
    "ftorr": "I asked other developer to test that and he reproduced the issue in IE11 and also IE10, I will test at home just to make sure ins't some network issue.\nTo test use this link http://jsbin.com/tuce/ as the second link doesn't have the iFrame and it is hard to reproduce.. \nI will update this later with the tests results at my home pc. \nThanks for the replay.\n. Thanks, the patch makes the selection works much better, about the scroll issue I think we can leave with that for the time been.\n. ",
    "fpossenti": "I am the other developer stated above.\nI confirm I can reproduce the problem on IE11, IE10 and also IE9.\nWith the URL [http://jsbin.com/tuce/] it happens all the time on all three browsers.\nWith the URL [http://jsbin.com/Unuyadoh/] it happens on IE11 and IE10 depending on where I drag the mouse (if I drag it over the \"Forward\" button it works, if I drag it over the address bar there's a 50% chance it won't work). Works on IE9.\n. ",
    "flaki": "Hi! Can I ask for this to be reconsidered, or the \"interface creep\" to be somehow worked around?\nThis is a very handy function, and in its implementation not immediately straightforward (and I just accidentally stumbled upon the function itself in the source, which solved my problem immediately). I expect exposing it would be more useful than not to a lot of people, and could save a lot of time for folks trying to come up with a solution to the problem it solves.\nThank you for your consideration Marijn and sorry to bring this up again!\n. ",
    "JackTheHack": "Make sense. Thanks! \n. ",
    "azumbrunnen": "hey guys! any workaround for this for contentEditable? Seems like there is no way any text editor is going to support Android with this mess right?\n. ",
    "Pinpickle": "Yes, I would consider it more of a bug with Mobile Safari than anything else. Ace has similar problems too.\nBut isn't that the job of a web developer? To work around the various bugs and quirks all the browsers have.\nAs normal textareas do work with updating window.innerHeight, I may do some tinkering with the textarea that CodeMirror uses and see if there is a specific property of it that causes the problem.\n. ",
    "nextrevision": "I guess I'm confused at what the similarities would be. It looks like runmode requires an existing mode in order to highlight. Puppet is a language, for which no current modes exist, hence the pull request to add a mode for the Puppet language. Could you clarify how runmode can do what this new mode is attempting to?\n. Ha, no worries! I see what you mean, reading the description again I can see how that was misworded and edited the description to be a bit more specific. I guess what I was attempting to say was that the mode current;y doesn't include any indentation.\n. Indeed that does, thanks for pointing that out. Closed the PR because travis failed and wanted to remedy.\n. ",
    "bgilb": "not sure why it's failing the test?\n. ",
    "saebekassebil": "Cheers @marijnh !\n. ",
    "Kosyne": "That would make sense. The theme I use (twilight, sublime text), highlights 'self' and 'cls' the same as parameters, but the other themes do different things with it.\n. ",
    "youyouk": "Hello, I had the same problem because I was calling coddemirror.js files from the \"cloudflare\" server. I downloaded and unpacked it on the files of the website and now it's working perfectly. \n. ",
    "lax4mike": "Here is the solution: http://blog.entelect.co.za/view/6435/minification-and-why-i-m-seeing-instead-of-whitespace\n. ",
    "bultas": "solution that works for me was add meta charset UTF8 to html file where you load js file\n<meta charset=\"UTF-8\">\n. ",
    "mikecrittenden": "@bultas's solution worked for me as well.\n. ",
    "SebastianKrieger": "I do see the exact same behavior using codeMirror react and webpack+uglify.\nI used <meta charset=\"UTF-8\"> in html as well as output: {ascii_only: true} in uglify option in webpack.\nBoth did not fix the issue... Did anyone fixed it another way?. yes, maybe you are right, at least with the second statement. Not many others seem to experience this behaviour like me..\n\nMaybe as help for people who may run into this and read this page, is there a work-around like configuring the visual whitespace element to be sth. else ? Or so... if not its ok.... wow finally! Found the source! After hours of checking everything else the reason was a missing utf-8 content type in s3 metadata which just showed up in production version. Thank you for the replies! . ",
    "egaga": "Vim example page *) is contradictory to the marijnh suggestion. Could you change the example to mention vimMode instead of keyMap? Thanks!\n*) http://codemirror.net/demo/vim.html\n. ",
    "cldwalker": "@mightyguava Thanks for the pointer. I've updated to only hook into exitVisualMode and added a test. I'll pass on adding the additional p behavior for gv. Note that I had to use marks, not because of the mouse - which worked fine, but because yank resets its cursor before exitVisualMode.\n. @mightyguava I've updated with all those concerns addressed. However, gv still doesn't seem to bring back linewise visual, just characterwise visual. Any idea what may be missing? I've looked in toggleVisualMode to no avail.\n. Ah, that makes sense. Updated and good to go.\n. Updated. Good catch on the multiline yanks. There was some subtlety around how vim handles yanks when the subsequent lines have smaller indents than the first line. The second ]p test should demonstrate that. I've also added [p with a test.\n. No worries. I should get to this by Friday\n. I've updated to account for indentWithTabs. I didn't see how I could simply replace a paste's indent for this test case so I kept with the current approach. I'm not sure what behavior we should have for tabSize. Could you explain or better yet write a failing test case for what we'd want here?\n. Thanks for the test. Updated but with a test tweak that matches what I'm seeing in vim: any spaces from the paste were also converted to tabs. So the final result being '\\t___\\n\\tabc\\n\\t\\tdef' instead of '\\t___\\n\\tabc\\n\\t  def'. If you think whitespaceLength should be moved up or other cleanup, just let me know.\n. Thanks for the code reviews and glad to have this in :)\n. I believe this issue is preventing Light Table's Vim from upgrading - see LightTable/Vim#45\n. @jquense You may find this useful (similar to first link) - https://github.com/antimatter15/codemirror-jsx/blob/master/jsx.js\n. A couple of LightTable users have experienced this issue as well - https://github.com/LightTable/Vim/issues/49 . This is caused by an os-level global config that changed in 10.9 or 10.10. You can globally disable that config in shell with defaults write -g ApplePressAndHoldEnabled -bool false\n. Anything I can do to expedite this? unmap is a normal vim command so it seems reasonable to add this\n. @marijnh I'm aware you're looking for a vim maintainer. I could help with some of those duties but I'd need to be unblocked on this issue so LightTable can use a recent version of CodeMirror. Seems this is a chicken and egg problem :). Would you be open any of these solutions as a PR to unmap a default key? :\n- Add an optional third arg to unmap that is a boolean that disables checking if the keybinding is user defined\n- Just delete the requirement that only user-defined keybindings can be unmapped\n- Expose defaultKeymap in the vimApi to allow a user to modify defaultKeymap as desired. This is leaking more internals than I'd like but a possible solution if we're averse to changing unmap\n. ",
    "dalejung": "Ah thanks for the pointer. I set the state.lastHPos when I call setCursor. Which seems fine for my use case. \nOut of curiosity, what's the usecse for lastHPos? If you grab the cursor position, wouldn't that be sufficient? I commented the line where endCh was being set to lastHPos and I couldn't figure out where it breaks. \nThanks!\n. ```\ndiff --git i/keymap/vim.js w/keymap/vim.js\nindex 558e4c8..f884f7b 100644\n--- i/keymap/vim.js\n+++ w/keymap/vim.js\n@@ -251,6 +251,7 @@\n     // Keys with modifiers are handled using keydown due to limitations of\n     // keypress event.\n     function handleKeyDown(cm, e) {\n+      if(e.codemirrorIgnore) { return; }\n       var name = lookupKey(e);\n       if (!name) { return; }\n@@ -262,6 +263,7 @@\n     // Keys without modifiers are handled using keypress to work best with\n     // non-standard keyboard layouts.\n     function handleKeyPress(cm, e) {\n+      if(e.codemirrorIgnore) { return; }\n       var code = e.charCode || e.keyCode;\n       if (e.ctrlKey || e.metaKey || e.altKey ||\n           e.shiftKey && code < 32) { return; }\n```\nthis helped give me the behavior that I wanted. The other issue is that I have to modify the _handlers array directly since on() doesn't give me the ability to insert a handler before the vim keymap handlers.\n. How would I cancel vim handling for certain events?\n. Yeah, that how I patched my local CodeMirror. I think it's the wrong place to handle it, but we'd need to split handlers into app and internal in order to remove it. \n. ",
    "anaran": "Thanks for taking a look and for the great feedback!\nI hadn't seen http://codemirror.net/4/demo/sublime.html but it looks fairly similar in terms of presenting the help (and has great bindings I was missing so far).\nI'll see if doing an addon seems feasible for me.\nDoes one particular help key binding seem doable, considering the different models of vim, emacs, sublime?\n. @marijnh Thanks for your guidance.\nI have implemented a prototype in\nhttps://github.com/anaran/scratchpadjs/blob/master/codemirror_addon_help_help.js\nwhich I have tested in a local CodeMirror npm install by placing it under\nnode_modules/codemirror/addon/help/help.js\nWould codemirror/addon/help/help.js be a good place for it?\nPerhaps you could point out any blatant flaws before I add this to my fork for a pull request.\nThanks!\nanaran\n. @marijnh I now have a demo online to look at:\nhttp://anaran.github.io/CodeMirror/demo/help.html\nDepending on your feedback I can create a pull request of a squashed merged from my gh-pages to a delivery branch in my repo.\nStill missing are:\n- [ ] addon documentation\n- [ ] addon test\n. I'm working to resolve this mess. In the end this will be a clean pull request of two commits, which I can squash to one if desired.\n. OK, that is cleaned up now. Please let me know when it is necessary to squash to a single commit.\nI find it valuable to seen the automated for changed separate from the manual fixup in the second commit.\n. Also, failing tests use a noun:\n1 failure\nwhile the consistency assumption would lead 1 failed.\nThe failure, however, is only colour-marked, therefor cannot be searched for by text, e.g.\naddon_help_commandsHelp\n    TypeError: wrap.CodeMirror.commands is undefined (localhost:8000)\n(that particular failure will be gone later tonight)\n. See the URL in the very first line of this issue report. And no, I have not been able to break that one yet :-)\nI find verbosity and text search important while working on tests on my own branches, either hosted via branch gh-pages on github, or better yet via a server on my localhost, like pushd /var/tmp/CodeMirror/ && python -m SimpleHTTPServer.\n. I don't understand your comment in the context I am reading it in, which is issue #3245.\nAre you referring to my help commands prototype, #3249?\nLet me know if you're interested in that  help addon functionality, if we can find a way to generalize its integration..\n. ",
    "joemathai": "is the tab completion only for the Excommands ?\n. ",
    "Hamabama": "works great! thanks a lot!\n. ",
    "ngzhian": "The latest commit will identify non-default keymap and commandmap with a property user == true. Unmap then checks this property and does nothing if user is not set.\nAlso, I saw this particular TODO, and think I will look into this before implementing a most robust system for differentiating user-defined and default mappings.\n// TODO: Convert keymap into dictionary format for fast lookup.\n. ",
    "jasonLaster": "Sublime and many other text editors support deleting to the right of the cursor with. <cmd>+delete or <meta>+delete\nIt'd be great to have support for delLineRight so that it'd be possible to add this key map if we want it. \n\n. ",
    "watkinsmatthewp": "Possibly. Here's what I currently am doing in my Subversion web app to accomplish what I want (see the screenshot):\n1. Using Infinity for the viewportMargin to load the whole document\n2. Iterating over all divs with the CodeMirror-linebackground class looking for the start of (or single-line) diff chunks in jQuery\n3. Storing all line numbers in an array\n4. Scrolling to the beginning of each chunk using the scrollIntoView function for each line number in the array\nThis works, but as you point out in the documentation, it's not very efficient for large documents to load the whole doc in a viewport margin, nor to iterate over the whole diff looking for the beginning lines of each chunk. \nI would love a way to navigate the chunks natively. Maybe adding a getChunkCount() and a scrollToBeginningOfChunk(chunkNumber) functions?\nThanks!\n\n. That was fast and works perfectly, and saves a ton of hassle on my end. Got another request though:\n1. Add option to determine whether or not to ignore or show whitespace changes.\nThat's definitely a bit more substantial\n. ",
    "naught101": "Ah, there is already a bug report at mozilla: https://bugzilla.mozilla.org/show_bug.cgi?id=953389\n. ",
    "nisargjhaveri": "@malayhm, can you please tell something more about the issue? I am not able to understand the problem.\n. @malayhm, I am not able to reproduce this. Is it still effective or outdated? Please check. For me it seems to be working fine.\n. I've updated the PR.\n. Sure. I'll look into it.\n. @marijnh, I have added some tests for sql-hint. Please have a look.\nPlease check that I wrote the tests in right way, as I did not find any docs and wrote on basis of other tests and driver.\n. Sorry, I didn't follow the style guilds properly. Please review the tests. If it looks fine, I'll recommit this.\n. Thanks. :)\n. Surely, I know the source. But I don't want to edit the source, as it is maintained by someone else. I want to be able to update the source from the upstream.\nIf I edit the source, I won't be able to update the hint source every now and then to get latest bug fixes and updates.\nI want to show some more info about completion hint that is selected. The only way is to update the hint source as of now, but I don't want to change that.\nIsn't this a good enough use-case?\n. Oh! This may work. Thanks.\nBut still, I would like some events on editor. This is now just personal opinion as there is a workaround. :)\n. Fair enough. Thanks.\n. ",
    "binora": "Ok , Thanks for being so patient all this while , I'll keep these things in mind.\n. I have rectified it by introducing  getLastSubstitute and setLastSubstitute methods to get the last replace part . Is that good enough or this could be done in much efficient way ?\n. Oh,I apologise.I'll keep them more descriptive in future.\n. @mightyguava  Sorry for the delay.\n. Ok.I'll keep that in mind for the future. :)\n. Ok.I'm gonna change my approach here and make a commit again soon.\n. @mightyguava @heppe \n Sorry for the delay.Please provide you opinion about this approach and some necessary changes(I'm sure there are).\nAlso, The build always times out.Please help me out here.\n. So we have to do something analogous to implementation of Register and RegisterController. Correct me if I am wrong. Also, I'll try to update openDialog as you suggested along with renaming the variables and let you know of my progess.\nI am enjoying my summer break to the fullest with this project! I will let you guys know when I won't be available beforehand.\n. I guess the close() method in both search_register_escape and search_history was causing the build to time out.Maybe I'm wrong.\n@heppe  @mightyguava Please have a look at this patch.\n. Lets just rename prefix to query and add comments.sounds good?\n. please review the latest commit.\n. @mightyguava @heppe Please have a look.\n. @mightyguava Kindly play with this patch and check for bugs.\n. @mightyguava The unit test was there already.Please have a look at the patch and see if it resolves the bug ( if i understood it correctly). \n. @mightyguava  Please check\n. actually, the second commit fixes the assumption in edit logic.I'm sorry. Should've given a better description.\n. Its actually because Codemirror does not consider the cursor to be fat. Hence, the bugs.So, I'll have to put some conditionals to solve the bugs you pointed out..\n. @mightyguava  I fixed the mentioned bugs.Let me know of more.\n. Not much actually.Here's what I think about the options available in markText\nclassName: Trying to add css cursor blinking code in codemirror.css  (by searching  the web).\n from ,to :  same i.e. head +- 1.\nGive me some direction.\n. @mightyguava There are still some additions or edits to be made here.Please review.\n. Yeah, That does sound good.I'll try to generalise as you suggest.So, For now, I'll not use curStart and curEnd passed in the operator method i'm working on so that we can go step by step to update each method and merge it.Is it sane enough? \n. I updated selectBlock to return the end opposite to selectionEnd.So, the marks get updated properly.Also, I made the yank method independent of curStart and curEnd.Please have a look.\n. @heppe @mightyguava \n Please review and suggest necessary changes.\n. @heppe @mightyguava  Please have a look\n. @heppe @mightyguava  Have a look as per convenience.\n. @heppe @mightyguava \nI had to special case visualblock here because of a  little difference in linewise operation in visual block from the rest of the modes.\n. Sure.I'll add 'I' to the list.\n. @heppe Please have a look.\n. replaying change operation(in blockwise visual) doesnt work.The insert mode changes have to be changed the way they are stored in case of blockwise visual.\n. @heppe @mightyguava  Please review.\n. There are still some ittle inaccuracies, but I wanted to discuss more on this approach.\n. @mightyguava Please review.\n. Bug: After a blockwise selection, Pressing the 'Esc' key to exit visual mode does not clear selections.\n@heppe Have a look.\n. @mightyguava @heppe Please have a look.\n. This patch fixes the following bugs:\n1.  Long line/short line selections. ( as mentioned TO-DO list)\n2. Pasting blockwise text beyond the last line.\n3. Placing the cursor at the right place after exiting blockwise visual.( It was off by one)\nI redesigned selectBlock method to solve the bugs and also to make it more cleaner than the previous.\n@heppe @mightyguava  Have a look.\n. Actually , in case of > and < registers used in visual mode , the cursor should not move to first non-whitespace character. Isnt that so ?\n. Sorry , My bad. Will remove that.\n. I have to reset the previousPrefix and the iterator in case of an empty query.That's what I had in mind.\n. Maybe i named the variable previousPrefix wrong.After one autocompletion, the prefix entering the method is the next matched search query present in the historyBuffer.On pressing up or down again, I have to find the next matched query using the same short prefix used in the start (which I store in previousPrefix).Indirectly, I'm trying to figure out whether the value in the input is user entered or autocompleted using  this logic.\n. I guess this conditional is not needed at all now that I realize it.\n. ok.i'll change it.\n. agreed.ok i'll make the necesaary change.Also, undo after this command works in steps rather than undoing all the changes at once.Anything we can do about it?\n. splitBySlash returns nothing if there's no slash in the beginning of the argString.\n. right.Was planning to do something else earlier.\nOn Thu, Jun 12, 2014 at 11:08 PM, Yunchi Luo notifications@github.com\nwrote:\n\nIn keymap/vim.js:\n\n@@ -2423,6 +2471,33 @@\n     function escapeRegex(s) {\n       return s.replace(/([.?*+$[]\\/(){}|-])/g, '\\$1');\n     }\n-    function selectBlock(cm, selectionEnd) {\n-      var doc = cm.doc, pos = [], ranges = cm.listSelections();\n-      var start = ranges[0].anchor, dir = 1;\n-      var end = ranges[0].head;\n-      if (start.line > selectionEnd.line) {\n-        dir = -1;\n-        start = ranges.reverse()[0].anchor;\n\nThis seems inefficient. It's equivalent to do ranges[ranges.length -\n1].anchor\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/marijnh/CodeMirror/pull/2633/files#r13714859.\n. Ok.I'll look into this.\n. Actually, I need the reversed ranges array in this case for extending selections later.\n. Yes. But I have to store the current selection also into last selection and then reselect.\n. Yes, I had to because the selections( ranges ) change after selection code above these lines. I need  ranges  to maintain cursor head of the last selection. \n. Oh, I didnt carefully look at the line number of your comment. Yeah, I don't need to move that.\n. The code seemed to work with/without it. Later, I realized extra calls were being made to updateMark in its absence. I apologise for not replying since I thought I re-added it back in the second commit.\n. \n",
    "chaitan94": "I made the shift-alt-up/down bindings duplicate for each cursor, and for the shift-ctrl-d binding, I rechecked the ranges after the duplicating lines. I think this should fix it.\n. But still this starts the search from the bottom of primary selection, whereas in sublime it searches from the bottom-most, I've made an another issue https://github.com/marijnh/CodeMirror/issues/2348 which might be related to this problem.\n. Added the changes.\n. ",
    "haraldschilly": "another case a python 3.6 \"format strings\", i.e. they start with f\" or f' or for raw strings, e.g. rf'a b \\n {x} d' is a prefix of rf is possible.. I refined the one above to be a bit shorter. It seems to trip over nested { { .. } }:\nif (true) {\n  for (let i in [1, 2, 3]) {\n    console.log(`${i}`);\n  }\n}\nconsole.log(\"this is all orange\");\nconsole.log(\"this is all orange\");\nconsole.log(\"this is all orange\");\n\n. ",
    "waywardmonkeys": "Okay, it should be better now.\n. Thanks!\n. ",
    "srajanpaliwal": "i added some more binding for sublime and corrected a previous swap line bind implementation\n. I tried implementing setSelections .But \"undo\" when using setSelections didn't reset the cursors. I think ,it's because \"undo\" invoked by Ctrl-Z does not change the selection. i know \"selectionundo\" is present but i didn't know how it can be used.\n. In Sublime When the line getting swap reach bottom of the view ,it scrolls with the line. but it was not happening in CodeMirror. so added scrollIntoView\n. ",
    "shashank-jaiswal-2013": "I have changed the color to black instead of red and have created the pull request. Please do check.\n. If you don't want to add non-standard properties inside the propertyKeywords variable, then probably, a possible solution may be to define another variable inside \"mode/css/css.js\"\nExample:\n\nvar nonStandardPropertyKeywords_ = [\n    \"scrollbar-arrow-color\", \"scrollbar-base-color\", \"scrollbar-dark-shadow-color\",\n    \"scrollbar-face-color\", \"scrollbar-highlight-color\", \"scrollbar-shadow-color\",\n    \"scrollbar-3d-light-color\", \"scrollbar-track-color\"\n  ], nonStandardPropertyKeywords = keySet(nonStandardPropertyKeywords_);\n\nand inside the \"lib/codemirror.css\" file define another class as =>\n\n.cm-s-default .cm-nonStandardProperty {color: #555;}\n\nDo you want me to do that..?\n. ",
    "aartrost": "Hi Marijn,\nThanks for the quick reply. The markers not being included from derived documents should not be a problem in my case. \nHowever bookmarks are very convenient in my case as they don't interfere with the text itself. If I want to achieve the same functionality with markText I'll have to insert some arbitrary char and replace that by using .markText and the replacedWith option. \nThis will add to the history, the replacement char will show up in the final output and it can break syntax highlighting as I'm dropping in chars that break up tokens. (demo here: http://jsfiddle.net/aartr/3sp2U/3/).\nI'll probably do something horribly wrong, but as far as I can see that was the only solution. \n. Hi Marijn,\nThanks a lot, that's going to be very helpful! There's one last thing though. Since 3.22.1 adding markers to a headless document is broken. The Emitter passed to signalLater is undefined. Click the 'add Swatch' button for an example: http://jsfiddle.net/aartr/3sp2U/4/.\n. ",
    "shhaumb": "Though setCursor function won't change lastHPos because doing that will remove the functionality for which there is lastHPos.\n. I need the instance of codemirror in listener, how should I do that if I don't create a new signal?\nI think the name of the event \"selectionDone\" is not appropriate even if I create a signal. \n. mouseup event is not being dispatched on cm. It is not mentioned in manual too.\nBut I can add listener of mouseup event on document. Should I do this way?\n. Please tell me, which option should I follow?\n. Please check my last commit.\n. In real Vim, double and triple clicking doesn't effect the cursor position. But in codemirror vim mode, it activates the Visual mode. So I tried the analogy between cursor behavior in real vim and codemirror vim while switching from Normal mode to Insert mode and vice versa, and inferred that the fat-cursor blinks at the right of its position.\n1)In real vim, cursor is always blinking at the head of selection.\n2)In real vim, if I switch mode from Normal to Insert, cursor doesn't change its position. hence in normal mode the fat cursor was being shown right of its position (if it were in insert mode in form of line-cursor). Because if I select a word in Visual mode and then switch to normal and then to insert, the cursor will be one character left of the end of the word (if you take it as line-cursor).\n3)But if I switch mode from Insert to Normal, it goes one character left. I think it is there so that if I switch from Insert mode to Visual, it should start selecting from the left character of the cursor position in Insert mode.\nHence, when I select a word in real vim in Visual mode, the fat-cursor position (considering it as line-cursor) is always one character left of the end of the word.\nI'll soon submit a v4 branch compatible commit.\n. Just a query, If we display the fat cursor left to its position when head is after anchor while selection in vim mode, wouldn't that break existing cut and yank implementations?\nAnd after implementing block wise selection in vim mode using Ctrl-V, while selecting there may be a situation when head and anchor have same horizontal position but are on different lines, then how we'll display the selection? showing just line (but it does not happen in vim)?\n. @marijnh Can it be done this way? Instead of manipulating DOM for cursor and range at vim side after redrawing selection, change the range in updateSelection function using a signal and let codemirror draw both cursor and range where vim expects.\n. @marijnh  I've created an issue #2397 as you said.\n. When we do an operation after selection in Visual mode and then repeat it using ., the operation takes place w.r.t. new position of cursor. i.e.\n1) (if selection is within one line like)\nabcdefghi\nabcdefghi\n(and I press d then it becomes)\nabfghi\nabcdefghi\n(cursor is on f, if I move cursor to e below one line and then press . then it becomes)\nabfghi\nabcdhi\n(it performed operation on efg).\n2) Similarly If selection is multi line, the operation takes place w.r.t. new cursor maintaining total no. of lines selected but the horizontal position of head of last line of selection remains same.\nSo I needed a variable to store relative curEnd position w.r.t. curStart position.\n. ",
    "tpaksu": "I load them both, the linter as a rawgithub.com remote resource, and the\nlinter addon, but sometimes the remote resource can't be loaded. The other\nlint addons use a try catch mechanism to prevent that, but these two\ndoesn't have any. And the script execution logs these errors to console\nbefore ending script execution preventing further scripts on queue:\nError : JSLINT is not defined / CSSLint is not defined\non their relevant lines. you can try yourself without loading the remote\nresource and adding an alert after instantiating the editor. The alert\nwon't show up.\n2014-03-17 12:40 GMT+02:00 Marijn Haverbeke notifications@github.com:\n\nHow are they blocking the page load? And why would you load these addons\nbut not the linters they depend on?\n\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2376#issuecomment-37802395\n.\n. Yes, thank you.\n. \n",
    "nikmauro": "i have this json data \nvar customFunctionsData  = [\"cms39_error_handler_db\",\"cms39_array_to_string\",\"cms39_string_to_array\",\"cms39_html_compress\",\"cms39_sanitize_output\",\"cms39_requiretovar\",\"cms39_session_start\",\"cms39_getvaluefrompath\",\"cms39_setvaluefrompath\",\"cms39_arraytoxml\"];\nI want when press \"Ctrl-Space\" for autocomplete javascript-hint to merge the customFunctionsData values with editor values. \n. I try this code and i have 2 issues.\n1) The auto complete not working\n2) This code has disable the anyword-hint.js\n``` javascript\n CodeMirror.registerHelper(\"hint\", \"yourOwnHint\", function(cm, options) {\n                var cur = cm.getCursor(), token = cm.getTokenAt(cur);\n                var start = token.start, end = token.end;\n                return {\n                    list: [\"cms39_error_handler_db\", \"cms39_array_to_string\", \"cms39_string_to_array\", \"cms39_html_compress\", \"cms39_sanitize_output\", \"cms39_requiretovar\", \"cms39_session_start\", \"cms39_getvaluefrompath\", \"cms39_setvaluefrompath\", \"cms39_arraytoxml\"],\n                    from: CodeMirror.Pos(cur.line, start),\n                    to: CodeMirror.Pos(cur.line, end)\n                }\n            });\n        CodeMirror.commands.autocomplete = function(cm) {\n            CodeMirror.showHint(cm, CodeMirror.hint.yourOwnHint);\n        }\n\n        var editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n            lineNumbers: true,\n            matchBrackets: true,\n            mode: \"<?= $mimetype ?>\",\n            indentUnit: 4,\n            indentWithTabs: true,\n            enterMode: \"keep\",\n            tabMode: \"shift\",\n            theme: '<?= get_option('plugin_codeeditor_theme') ?>',\n            extraKeys: {\"Ctrl-Space\": \"autocomplete\"}\n        });\n\n```\n\n. ",
    "ExoticObjects": "Attempting to use the code that djadmin added above CodeMirror.registerHelper(\"hint\",\"yourOwnHint\",function(cm,options){\ndoes not work. \nIt never gets called unless I set the second argument to 'coffeescript', and then my default coffescript completions don't get called. So THAT's no good...\nHere's an actual code sample of what @marijnh said above (found here):\n```\nvar anyWord = CodeMirror.hint.anyword;\nCodeMirror.hint.anyword = function(cm) {\nvar inner = anyWord(cm) || {from: cm.getCursor(), to: cm.getCursor(), list: []};\ninner.list.push(\"codemirror\", \"docs\", \"are\", \"very\", \"unclear\", \"on\", \"this\", \"topic\");\nreturn inner;\n\n};\n```\nCodeMirror is pretty fantastic, but this particular section of the documentation is light on code samples and heavy on words that can be interpreted incorrectly.\nThe following is not too helpful:\n\nIf no hinting function is given, the addon will use CodeMirror.hint.auto, which calls getHelpers with the \"hint\" type to find applicable hinting functions, and tries them one by one. If that fails, it looks for a \"hintWords\" helper to fetch a list of completable words for the mode, and uses CodeMirror.hint.fromList to complete from those.\n\nThis describes ways to replace default completions for a given language. If you add a helper, it will use it, and replace the one used by the language. If you add a 'hint', it will use the first one that succeeds. (In my experience, it will not call all 'hint' helpers). If you add a 'hintWords' helper, it will use that and only that - it will not use your 'hints' and your 'hintWords' together. \nSo, to add to a language's set of words to autocomplete, you need to do what @marijnh said above. That information doesn't exist anywhere in the documentation, but rather in a single stackoverflow post (and in his comment above, though less clearly). It should be documented, and even better, CodeMirror should make this easier to do, as it's a very common use case.\n. ",
    "lazywei": "@mightyguava I didn't quite understand why we don't write test for specific (and maybe private) functions?\nFor example, today we have bug in findMatchedSymbol.\nWrite behavior test only. We will fail at da{_should_delete_inner_block. We'll only know what behavior fails, but we will not know where the bug is.\nActually, it took me some time to locate the bug.  IMHO, if we have some tests for findMatchedSymbol, then it may be easier to locate the bug, right?\nBy the way, I don't know what the convention of testing function name is. (da(_open_spc etc.) So please let me know if my naming isn't correct.\n. Hi @mightyguava,\nThank you so much for the thorough explanation. It's really nice of you to tell me the underlying philosophy of writing tests.\nI will then try to use functions in matchbrackets.js and see if the bugs will be fixed automatically. Then, I will see what we can do with currently VIM test suits. Thank you for taking time on this matter :-)\n. @mightyguava , I've tried to integrate matchbrackets.js's findMatchingBracket into vim. It works well.\nHowever, I have no idea how to handle internal dependency in CodeMirror. For now, I need to require it manually by\n<script src=\"../addon/edit/matchbrackets.js\"></script>\ninstead of handling this in vim.js. Is there a dependency handler in CodeMirror?\n. @mightyguava not yet. There are still some boundary cases needed to be dealt with.\nThe reason I did this is because, currently, findMatchingBracket needs a position of one side of bracket so it can find another.\nSo I need to find the one side of the bracket first myself so I can call findMatchingBracket. I know it's awkward, but I can't change the API of findMatchingBracket, it will cause too many unexpected exceptions. \nI will move the \"find the one side of the bracket\" into matchbrackets.js. Then I can make findMatchingBracket to deal with null given position.\nOn the other hand, the original findMatchedBracket didn't deal with the case like:\n(\"abc)\")\nI think there may some other this kind of small bugs needed to be fixed. I'll let you know when I think this PR is ready for merged.\nSorry for take this PR so long.\n. Oops.. I just implemented nearest bracket myself..\nSo I can just rebase master and use that function, right?\nVIM does what you say exactly, so I think matchbrackets is suitable in this case.\nThanks\n. @marijnh @mightyguava \nI'm still working on using scanForBracket to replace current moveToMatchedSymbol. However, it introduces some new problems. I think it will be more suitable if I open a new PR and discuss the problems there.\nSo I'd like to merge this PR first. Please help me review the code, and please let me know if there is any concern.\nThanks!\n. Thanks :beers: \n. ",
    "dangoor": "Perfect! Thanks for the quick fix!\n. @mfarooqi Perhaps you can see if this problem appears for you on the CodeMirror page (use Chrome because that's closest to Brackets, though Brackets is a few versions behind the current Chrome release).\n. ",
    "wnr": "Thanks for implementing this :)\nI have tried it out in brackets now and I have the following feedback:\n- ctrl-x results in a highlight flash while ctrl-c doesnt.\n- ctrl-x with mix of word / line cursors breaks the cutting (only the words get cut).\n- Same as above goes for ctrl-c.\nThanks\n. Well, I do think it's confusing that only the selections get cut. Sublime and IntelliJ do cut all cursors (selections and non-selections). However, I do think it's sane to just copy the selections on copy. Similarly, I think only the selections should get copied on cut (the same way sublime behaves), but still all lines/selections should get removed.\nI can agree that the selection flash is okay, but I feel it should behave the same with copy also then. However, this is not really an issue to me.\nSo I guess the real issue is that the lines with no selections do not get removed (does not need to be copied) on cut. If that gets fixed I believe CM would work in the same way as the other editors (except for the flashing highlight, which is okay). :)\n. ",
    "neochief": "Hey Friedel, could you, please, explain what was the solution?\n. Okay, here's the best way I could done it.\nMy dir structure\n/\n- editor\n-- js // editor's scripts, I need CodeMirror here\n--- libs\n---- require\n----- require.js\n--- main.js\n--- app.js\n--- editor.html\n- js // page's scripts, I have my CodeMirror files here\n-- CodeMirror\n- page.html\nmain.js\n```\nrequire.config({\n  paths: {\n    jquery: '../../js/jquery/jquery-1.11.0.min',\n    'lib/codemirror': '../../js/CodeMirror/lib/codemirror',\n    'mode/javascript/javascript': '../../js/CodeMirror/mode/javascript/javascript',\n    'mode/clike/clike': '../../js/CodeMirror/mode/clike/clike',\n    'mode/php/php': '../../js/CodeMirror/mode/php/php',\n    'mode/htmlmixed/htmlmixed': '../../js/CodeMirror/mode/htmlmixed/htmlmixed',\n    'mode/xml/xml': '../../js/CodeMirror/mode/xml/xml',\n    'mode/css/css': '../../js/CodeMirror/mode/css/css',\n    'addon/edit/matchbrackets': '../../js/CodeMirror/addon/edit/matchbrackets',\n    'addon/hint/show-hint': '../../js/CodeMirror/addon/hint/show-hint'\n  }\n});\nrequire(['app'], function(App){\n  App.initialize();\n});\n```\napp.js\ndefine([\n  'jquery',\n  'lib/codemirror',\n  'mode/javascript/javascript',\n  'mode/clike/clike',\n  'mode/php/php',\n  'addon/edit/matchbrackets',\n  'addon/hint/show-hint'\n], function($, CodeMirror){\n  var initialize = function(){\n    var exp = CodeMirror.fromTextArea($('#export')[0], {\n      lineNumbers: true,\n      mode: \"application/json\"\n    });\n  }\n  return {\n    initialize: initialize\n  };\n});\n. This worked perfectly, thanks!\n. Sure! Here's a minimal code to reproduce it:\nhtml\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.30.0/codemirror.css\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.30.0/codemirror.js\"></script>\n</head>\n<body>\n    <div id=\"test\"></div>\n    <script>\n        editor = CodeMirror(document.getElementById('test'), {\n            value: \"123 321\"\n        });\n        editor.setSelections([\n            {\n                anchor: {line: 0, ch: 0},\n                head: {line: 0, ch: 2}\n            },\n            {\n                anchor: {line: 0, ch: 4},\n                head: {line: 0, ch: 6}\n            }\n        ], 0);\n    </script>\n</body>\n</html>\nSteps to reproduce:\n\nCreate a test.html with the given code.\nOpen it in Chrome. It should produce 2 selections, as expected.\nOpen dev tools, go to the mobile view.\nReload the page. Now it will produce only one selection.\n. Thanks for the reply, Marijn. I've tried to run a replacement command after selection and it, indeed, replaced both occurrences, even though only one is visually selected.. \n",
    "marcello3d": "I'm just using StringStream class so I can reuse my tokenizer both for editing in codemirror and tokenizing files outside of the editor (but still client-side in the browser).\nMaking runmode-standalone.js module loader friendly would work for my use case.\n. ",
    "sunrise987": "The existing code calls append() function on a Register object which does not exist and results in an exception being thrown. This change fixes that bug. Additionally, it fixes another bug: the unnamed register does not match the last used register after an append which is what the behavior should be as in vim.\n. ",
    "Redsandro": "Okay, apart from above modifications, the call to autoFormatRange() also changed from autoFormatRange(startChar, endChar) to autoFormatRange({startLine, startChar}, {endLine, endChar}). Just putting it here since I won't be the only one with this problem and the referenced repository doesn't allow new issues or (line)comments. (?)\nAs for codeMirror, ideally it would ignore incorrect calls in stead of throwning uncaught errors (and ignore further execution).\n. Great! :thumbsup: \nSorry, 'forgot' to read the documentation. :sleepy: \n. ",
    "AleksandarDev": "No, you can't. It must be Win8 in order to run it. However, WebView control doesn't support HTML5 and it works in IE10 document mode so you can test that (i only have IE11 available)\ndoctype is included, no custom styling, just pure demo from home page\n. According to documentation Windows 8.1 use IE11 in document mode so that isn't a problem as it seems. \nTake a look into picture. You can barely see scrollbar on right top side. When I drag'n'drop some selected part of page, it is even fully visible. So it seems like some margin/padding problem.\nCan you direct me in right direction where that is located so that I can try and fix it?\n\n. Fixed it by removing condition from line 184\n. I don't think this is problem for many devs. Not many people will use mirror in c#/XAML winrt application (there is javascript/html version available). In the documentation there is a line that basically says that this control isn't full-blown IE11 so you have to take that into account too. \nDon't have an idea how would you detect that it's in WebView control?\n. ",
    "jdfreder": "I should mention, the freeze occurs when the opening delimiter is typed.  i.e.\nhtml\n<b>hello</b> world\nwont cause a crash but as soon as the delimiter is typed\n<<<b>hello</b> world\nthe browser crashes (independent of where it is typed).\n. In attempt to help track this down, I've created a fiddle that demonstrates the problem. http://jsfiddle.net/S6dEv/18/\nThe second you type the closing delimiter, in this case a $, the browser will crash.\n. > Thanks for the reproducing page. Attached patch should address the problem (faulty assumption in overlay.js, which gfm uses).\nNo problem, thank you for fixing the bug.  I was going to try to track it down myself but I got sidetracked with other problems in the software I work on.\n. What will be the next version of CodeMirror that will include this fix? v4? (just need to know so I can tag it in my PR against IPython)  -Thanks again for the great editor!!\n. ",
    "nicbou": "I can confirmed the problem is fixed for me. I was trying to do something very similar (latex in markdown) and the freezing is fixed with no change in my code.\nThanks!\n. Take a look at gfm/gfm.js in the modes.it is an extension of markdown.js.\n. Oops! Forgot to mention: there is a section in the documentation that explains how modes work. \n. I'd like to add extra data about this issue. \n- Your patch works\n- When you press enter twice, the list should not be continued. The intent is clearly to have a paragraph break. Google Docs and Word bullet lists can be used as an example. At the very least, checking that the previous bullet isn't empty would improve usability.\n- Multiplexing should be supported. Lists should not be continued when you are writing LaTeX, raw text or code.\nRegarding the first point, I find that the following regex does the job just fine: /^(\\s*)([*+-]|(\\d+)\\.)(\\s)[^\\s]+/\nShould I open a new bug?\n. Sounds good. I have noticed it doesn't have the same impressive quality as\nthe rest of the project. I use it a bit, so I'll just send my changes once\nit reaches a satisfactory behaviour.\nOn Jul 25, 2014 6:24 AM, \"Marijn Haverbeke\" notifications@github.com\nwrote:\n\nMy position on continuelist is that I'm sort of sorry that I accepted it\ninto the distribution -- it's a very special-case tool, and I have no time\nor interest to support it. Pull requests welcome, but I'm not going to work\non this myself.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/marijnh/CodeMirror/issues/2621#issuecomment-50132331.\n. Thank you! It works fine for me. The behaviour on nested list is to cancel all lists, which I believe makes sense. Is this what you guys had in mind?\n. \n",
    "popinet": "Hi Marjin\nThanks for the fast answer.\n\nThe semicolon is not an |electricChar| in the C-like mode, and won't\nreindent in that mode's demo page either.\n\nYou are right, my mistake. It is an \"electric char\" in emacs though.\n\n|\\n| can not be electric. The behavior of entering a newline depends on\nthe binding for the |Enter| key. The default keymap binds it to\n|newlineAndIndent|, whereas the Emacs keymap is configured to not do\nanything special for it (thus causing a normal newline to be inserted).\nThis is intentional, since by default emacs does not indent on enter.\nYou can change it by doing\n|CodeMirror.keyMap.emacs.Enter = \"newlineAndIndent\";\n\nThanks a lot for the tip.\nStephane\n. > I know, but I find this often gets in the way when hand-aligning code.\n\nStyles differ though (I tend to indent my lines right away, rather than\nwaiting for the terminating semicolon).\n\nI agree, but I use codemirror for a site which targets programming \nbeginners, so I would like to force them to indent as much as possible.\n\nYou can override this with\n|CodeMirror.extendMode(\"clicke\", {\"electricChars: \"{};\"});\n\nGreat, ta\nCodeMirror.extendMode(\"clike\", {electricChars: \"{};\"});\nworks fine.\nThanks again for your help\nStephane\n. ",
    "dwikle": "Yes, this mode does do everything that the Verilog mode does.  Technically there is a larger set of keywords in this mode as SystemVerilog is a superset of the original Verilog language. The only effect of using this as a drop-in would be getting syntax highlighting on some additional keywords, as well as different colors.\nI could make a configuration option to support legacy Verilog, though honestly I think anyone using this for Verilog-only would be fine using this mode as-is.\n. I updated this pull request to replace the existing verilog mode with my new implementation.  And I am using the electricInput option and it works perfectly.\n. Correct - thanks!\n. I though about using a loop to construct these pairs, but since they are some exceptions I thought the repetition was worth the clarity.  But I will revisit this.\n. I initially had it only reindenting on characters which ended the closing keywords, but found that it resulted in behavior that would totally mystify users.  Because if they manually changed the indentation but then typed one of the electricChars, it would reindent - but only on specific letters.  So I thought it better to behave consistently, even if it's a bit excessive.\nWhat I really want to do is only reindent only on matches of an entire closing keyword.  Something like and 'electricWords' option.  This was something I was planning to explore after getting the initial mode developed.  If you have any suggestions on how best to do this let me know.\n. Yes, I'll update to the new loader style.\n. Yes, that would work well.  I would want to be able to reindent on both\nspecific characters as well as arbitrary text, which could both covered by\na regex.\nOn Tue, Apr 1, 2014 at 12:33 PM, Marijn Haverbeke\nnotifications@github.comwrote:\n\nIn mode/systemverilog/systemverilog.js:\n\n\n// contextClosing may be mulitple keywords separated by ;\nvar closingKeywords = contextClosing.split(\";\");\nfor (var i in closingKeywords) {\nif (text == closingKeywords[i]) {\nreturn true;\n}\n}\nreturn false;\n}\n}\n  +\n// Interface\nreturn {\n  +\n// Characters to force current line to reindent\nelectricChars: \"{}()[];abcdefghijklmnopqrstuvwxyz\",\n\n\nA possible solution to the electricChars issue would be to allow that\nproperty to contain a regexp, in which case the reindentation will only\nhappen when the line (up to the newly typed text) matches the regexp. Does\nthat sound like it'd work for you?\n\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2412/files#r11168425\n.\n. \n",
    "HelgeSverre": "Would love the option to pass wordChars as a parameter to the findWordAt function, and fallback on the default, I think  that is a more flexible approach.. Example of the answer from @marijnh \n```javascript\neditor.on(\"drop\", function (cm, event) {\n    var coords = cm.coordsChar({\n        left: event.x,\n        top: event.y\n    });\ncm.replaceRange(\"Some Text\", coords);\n\n});\n```. ",
    "fmay": "I agree with this. Shift tabe seems to move back to the start of the line if it is not an auto-indented line (at least in a Markdown file) but does nothing if on an auto-indented line. I would love to see it with consistent behavior whereby it always moves back by a tab unit.\n. ",
    "scottdraves": "thanks for responding.  that seems to turn off all indentation, even when it was right.\n. note: the bold is involved, if you just stick with just the regular weight, it's fine.\nthis is where we first encountered this bug: \nhttps://github.com/twosigma/beaker-notebook/pull/2366\nbut then it seemed ubuntu mono had problems too:\nhttps://github.com/twosigma/beaker-notebook/pull/2376\nand eventually we figured out we could lose just the bold and that would fix it.\n. thank you for researching and explaining that, we were quite baffled.\n. thanks.\n. ",
    "ivanpierre": "Yes ;) \nI made a theme for Light Table that use CodeMirror adding all the syntaxes managed. So I had to go across the whole code to figure out all the tokens of all the syntaxes...\nhttps://github.com/ivanpierre/lt-theme-kilroysoft#i-dive-in-the-code\nGoing further to make a general css creator for any syntax added, I have no way to know the output tokens to manage except diving into code. As tokens are absolutely not controlled they can be any string according to programmer fantasy. It would be nice to have possibility for a minimum to be able to retrieve a token list from a syntax.\n. Missing ones :\ncoffeescript.js : punctuation, error\ncss.js : meta, interpolation\nmarkdown.js : em, strong, emstrong\nxml.js : word, equals\ndiff.js : positive, negative\neiffel.js : ident\nerlang.js : special\nplsql.js : plsql-string, plsql-comment\nr.js : arrow, arg-is, dollar, semi\nNone to say for the specially developed parsers as there is no specification on token names.\nAnd tokens can have various definitions according to languages, so I'll likely have various styles for each parser according to user.\nBut I can patch this using a standards syntax standard file and catch all the returned tokens.\n. Well, it's not a token problem. In fact I don't bother witch name they are. But If a write a program enabling to change CSS value for a syntax and store it to the peculiar CSS for that syntax, the program cannot figure out what the token are (I don't want my program to parse the parser). And it would ease corrector or creator to know exactly what they are.\nBut well it's closed, I'll add external data file for syntax-token link...\n. ",
    "lemonhub": "i cant recreate it with 4.0 so no worries.\nalso its entirely possible that the bug was caused by some custom styling of ours so dont think about it.\n. ",
    "genemars": "Based the code on the clike.js to get autocompletition for cscharp and erronously assumed that every language would use that structure. It's a pity there isn't a way to reuse all keywords already defined in those files.\nAlso wondering if there's a fallback mechanism for show-hint.js to mix helpers (eg. if no word found in javascript-hint hint then use anyword.hint). I had currently modified the show-hint.js file in order to achieve that.\n. The autocompletion now works for C# but I don't see the fallback to anyword-hint when current word is not matching.\nI currently changed the helper hint/auto in show-hint.js:\nCodeMirror.registerHelper(\"hint\", \"auto\", function(cm, options) {\n    var helpers = cm.getHelpers(cm.getCursor(), \"hint\"), words, result;\n    if (helpers.length) {\n      for (var i = 0; i < helpers.length; i++) {\n        var cur = helpers[i](cm, options);\n        if (cur && cur.list.length) {\n            result = cur;\n            break;  \n        }\n      }\n    }\n    if (!result && (words = cm.getHelper(cm.getCursor(), \"hintWords\"))) {\n        result = CodeMirror.hint.fromList(cm, {words: words});\n    }\n    if (!result && CodeMirror.hint.anyword) {\n      result = CodeMirror.hint.anyword(cm, options);\n    }\n    return result;\n  });\nso that hintWords and anyword get called anyway if no matches are found from previous helper.\n. ",
    "longouyang": "Here is a jsbin that showcases the problem: http://jsbin.com/ihunin/357/edit\nWhen you give focus to the editor and your cursor is on the matched parens, CodeMirror correctly applies the CodeMirror-matchingbracket class and styles the background blue. However, try typing an extra right paren -- CodeMirror doesn't add the CodeMirror-nonmatchingbracket.\nIn the current CM code, the condition for pushing a mark is too restrictive -- we always require a match.from and a match.to. In the fix I suggested, I moved the check for match.to deeper inside of the code (from line 4 to 7) -- in my informal testing, this seems to work.\n. Looks good to me - thanks! Should I close this issue or do you prefer to do that yourself?\n. ",
    "nathanhammond": "I'm going to operate under the assumption that initializing CodeMirror while transformed doesn't work in most cases.\n1. Would you like CodeMirror to support being correctly initialized while transformed?\n2. Is there a code-weight or code-complexity cost that makes it not worth addressing?\n(I appreciate that there is a .refresh() workaround, but the \"jump\" when calling on completion of the animation is less than desirable.)\nI'm not yet sure if I'm volunteering to do this, but I'm thinking about it. :)\n. I'm going to document everything I learn about this here so that it exists somewhere other than in my head.\nThere is no way to detect a transformation using just getBoundingClientRect(). It has to be paired with a \"canary\" element to test the intrinsic attributes.\n``` js\nvar canary = document.createElement('div');\ncanary.style.position = \"absolute\";\ncm.appendChild(canary);\nvar rect;\ncanary.style.right = \"0px\";\ncanary.style.bottom = \"0px\";\nvar calculated = {};\ncalculated.height = canary.offsetTop;\ncalculated.width = canary.offsetLeft;\nrect = canary.getBoundingClientRect();\ncalculated.right = rect.right;\ncalculated.bottom = rect.bottom;\ncanary.style.right = \"auto\";\ncanary.style.bottom = \"auto\";\ncanary.style.top = \"0px\";\ncanary.style.left = \"0px\";\nrect = canary.getBoundingClientRect();\ncalculated.top = rect.top;\ncalculated.left = rect.left;\nvar parent = cm.getBoundingClientRect();\nvar properties = ['height', 'width', 'right', 'bottom', 'top', 'left'];\nvar transformed = properties.some(function(property) {\n  return calculated[property] !== parent[property];\n});\n```\nThe alternative to this is to traverse all the way up the DOM tree:\n``` js\nvar computedStyle;\nvar node = cm.parentNode;\nvar properties = ['transform', 'webkitTransform', 'mozTransform', 'oTransform', 'msTransform'];\nvar transformed = false;\nif (getComputedStyle) {\n  while (!transformed && cm.parentNode) {\n    computedStyle = getComputedStyle(node);\n    transformed = properties.some(function(property) {\n      return computedStyle[property] && ~computedStyle[property].indexOf('matrix');\n    });\n    node = node.parentNode;\n  }\n}\n```\nWe might be able to avoid actually processing everything through a matrix transformation if we are exceptionally clever with the first approach. Alternatively, running all positioning math through a matrix transformation would be guaranteed correct.\njsPerf says to use the second solution.\n. @schanzer If you're bored, follow along here. :)\n. The root cause is that the response returned from getBoundingClientRect() is not aware of transformations, it is based upon the bounding box of the element's location on the screen.\nThe strategy for CodeMirror to reach transform independence can therefore be accomplished in one of two ways:\n1. Replace all calls to getBoundingClientRect() with offset-based calculations in order to understand the intrinsic size (prior to transform).\n2. Create a new getIntrinsicBoundingClientRect() that returns information as if it weren't transformed and replace all calls to getBoundingClientRect() with it.\nThe second solution would theoretically be an almost drop-in solution while the first seems more reliable long-term but far more invasive.\n@marijnh Do you have any preferences or thoughts?\nEdit: Also need to account for getClientRects().\n. Needing getBoundingClientRect's precision probably means that the first solution would only ever get us part of the way there and that the second solution would be necessary in every scenario. Since that is the case and the second solution is relatively non-invasive I'm going to take a swing at building getIntrinsicBoundingClientRect and getIntrinsicClientRects.\nIf we assume that the transformation is static then any performance hit would be on initialize and every other call can use the already-calculated transformation matrix. This would add one matrix multiplication operation to every call to getBoundingClientRect which, fully segregated from the the DOM, should be below our threshold of caring.\nWithout the assumption that the transformation is static, every call to getIntrinsicBoundingClientRect would require recalculating that matrix. This would trigger the DOM tree parent walk from my above comment (except always traversing to the root node), which will have some performance impact. These would still all be reads without interlaced DOM writes so it wouldn't trigger relayout, but it's still going to be heavier than simply saving off the transformation matrix.\nIf it all works my proposal would be that CodeMirror adopt getIntrinsic... with a static transformation matrix calculation by default and create an option to opt in to calculating the transformation matrix on every call.\nSound reasonable?\n. I didn't call it a duplicate because (from what I can tell) it's a different calculation function: cursorCoords() as compared to getDimensions().\nFrom my quick glance over the code they aren't dependent upon each other. To make a general \"works with transforms\" fix we'd need to do both of these.\n. Okay, I'll rename the other bug to be a bit more inclusive. :)\n. ",
    "FunkMonkey": "another use-case: integrating codemirror into a reveal.js presentation for live-coding. Reveal.js automatically scales presentation based on the window size. \nThus, I think it is a pretty useful feature. Thanks a lot for looking into this!\n. ",
    "sgoo": "I can't reproduce this anymore either, thanks for looking into it.\n. My testing shows this fails in IE9 and above. I haven't tested in IE older than that.\n. Hi Marijn, sorry for taking so long to get back, yes that patch does fix it for me.\n. This doesn't fix the problem\n. But when closeOnEnter is set that line never runs. This fix is to help the case when closeOnEnter is used, without breaking existing implementations that rely on the current behavior.\n. Sorry what I meant by \"closeOnEnter is set\" is when it is set to false (the non default value). If you have a look at the JSBin I linked in the Issue you will see what I'm talking about in IE10.\n. Thanks!\n. There is the :not() selector, so I guess the style could be updated to something like this?\ncss\n.CodeMirror:not(.CodeMirror-browser-select) ::selection { background: #d7d4f0; }\nSo people can set the CodeMirror-browser-select class on the .CodeMirror if they want to keep the default browser ::selection.\n. That looks sane to me, and looks like it should keep our line widgets using the default browser selection.\n. ",
    "beaufortfrancois": "Dup of https://github.com/marijnh/CodeMirror/pull/2456.\nClosing it.\n. ",
    "eterevsky": "It's hard to say. Here's the screenshot of DevTools:\n\nwhile the context is:\nhtml\n<pre>\n  <span class=\"cm-tag cm-error\">&lt;</div>\n</pre>\nIt might be a bug in Chrome.\n. ",
    "takuji": "I tried the latest code and it worked exactly as I want.\nThank you very much!\n(Sorry for my poor pull request. I'll use rebase when updating the code next time.)\n. ",
    "shyam-gala": "Thanks. I will try out the patch and get back to you.\n. ",
    "kluo": "Is there no way to have the editor's content set when it is hidden? If you have to call refresh after the editor is visible, there will be a brief, but noticeable lag when the editor is populated with the content.\n. ",
    "thealjey": "Just in case, and for everyone who doesn't read the documentation carefully enough (like me), but stumbles upon this.\nThere's an autorefresh addon just for that.\nWorks like a charm :trophy: \n. ",
    "Real-Gecko": "+1 for autorefresh addon, really handy.\n. ",
    "zhouboluo": "Same question. And I also used modal.   The autorefresh:true, refresh() and focus() all don`t work. How can I do?. ",
    "martinwojtus": "I have simple (but not very elegant) solution for this problem -> call $('.CodeMirror-code').html(''); before modal is shown. . ",
    "lightnine": "javascript\nsetTimeout(function() {\n   editor.refresh();\n},1);. are you solve this problem?. ",
    "jessegrosjean": "Ok thanks, this is fixed too.\n. Fixes for me, thanks!\n. ",
    "blakeembrey": "Yep, that fixed the updating issue. However, with a large number of editor instances performance is pretty dreadful. Is there a way to improve the updates?\n\n. The example I was testing had 67 editors with a total of 124 lines in the document. I'll try to make a minimal test case now, did you need anything else specifically? It's essentially the JSBin I provided x10.\n. Ok, I updated the JSBin with the exact documents in use without all the cruft. One thing worth noting is that I'm using CodeMirror inside a 100% height iframe that autoresizes itself, so any logic for hiding unseen documents, etc. likely won't be working (if that exists, need to go through the code properly). Anyhow, the issue can be viewed when hitting enter in both cases but it looks like it's worse inside the iframe.\n. ",
    "nawroth": "@marijnh Thanks for cleaning it up. We'll get back to you with a more complete version later on!\n. ",
    "davemyersworld": "makes sense. thanks for fixing...\n. thank you! that does the trick!\n. ",
    "architectcodes": "Thank you :) I'll test it and let you know if something goes wrong.\n. Hello. Just letting you know that I'm having some problems injecting the patch into Brackets. I hope the guys at https://github.com/adobe/brackets/issues/7648 should help.\n. After all, applying the patch seems to take effect. Strangely, the only sign of this is the def statement becoming red in one function in a specific file:\n\nApart from that the indentation behaviour stays the same:\n\n\n\n\nrunning: Brackets Sprint 38 on a Windows 8.1 x64 machine\n. Seems to behave the same way:\n\nAdditionally, when I copy the contents of the said file, the def statement is also highlighted red:\n\n. The same happens with functions. I tried it on the initial example:\n\n. All of this should be typed line by line, I don't think indentation should be applied when pasting a block of text. Anyway, there you go.\nAll lines without any indentation:\n```\ndef test_function():\nindented_list_test = [\n1,\n2,\n3,\n]\nreturn\ndict_test = {\n'a': 1,\n'b': 2,\n'c': 3,\n}\ntuple_test = (\n1,\n2,\n3,\n)\nresulting_variable = module_with_a_long_name.some_package.do_something_fancy(\n\"this first parameter is also longish\",\n\"and it's much more readable,\",\n\"when placed below the function call.\",\n\"Not to mention line-length conventions used in the Python community.\"\n)\n```\nAnd the expected result:\n```\ndef test_function():\n    indented_list_test = [\n        1,\n        2,\n        3,\n    ]\n    return\ndict_test = {\n    'a': 1,\n    'b': 2,\n    'c': 3,\n}\ntuple_test = (\n    1,\n    2,\n    3,\n)\nresulting_variable = module_with_a_long_name.some_package.do_something_fancy(\n    \"this first parameter is also longish\",\n    \"and it's much more readable,\",\n    \"when placed below the function call.\",\n    \"Not to mention line-length conventions used in the Python community.\"\n)\n```\n. If you want to test the problematic file, I'd rather not post it here as it's proprietary. However, if you want, I can send it to you privately. Do you know if there is a way to do it through Github?\n. All works well now, thank you for the work!\n. ",
    "beeftornado": "Looking deeper, I see it is a specific line in the .sh script causing the exception.\nprint_exit \"${ERROR}script error:${NORMAL} $@\" >&2\n. \n. Confirmed fix\n. ",
    "Tomas-A": "Should the link appear only when starting with \"www\", \"http://\", \"https://\" and \"ftp://\"?\nI couldn't find other examples which the github editor itself would treat as a links.\nwww.a.a\nhttp://a.a\nhttps://a.a\nftp://private.ftp-servers.example.com/\n. I know where the issue is, code snippet from https://github.com/marijnh/CodeMirror/blob/master/mode/css/css.js :\njavascript\n  function tokenBase(stream, state) {\n    var ch = stream.next();\n    ...\n    // there are more cases involving - after certain character(s) so it doesn't happen all the time but if it managed to reach this statement then\n    } else if (ch === \"-\") {\n      // it fails since the next character is space\n      if (/[\\d.]/.test(stream.peek())) {\n        stream.eatWhile(/[\\w.%]/);\n        return ret(\"number\", \"unit\");\n        // this suceeds until another - is met, hence everything until another - is colored in another color (default gray) \n      } else if (stream.match(/^[^-]+-/)) {\n        return ret(\"meta\", \"meta\");\n    } ...\n  }\nNot sure how to fix, but I have tried to remove that condition at all, however after that the following test (css_tagVendor) failed.\ncss\nfoo { \n  -foo-box-sizing: -foo-border-box; \n}\nIt has to highlight -foo- as \"meta\" (vendor-prefix) in this case. Although some other editors and including this one doesn't highlight it at all.\nThe solution could be to check only for alphanumeric characters (all tests pass with this fix)?  Or can it contain other characters as well? \n. ",
    "thany": "As mentioned in the referenced issue, removing the - from the comment also makes it render correctly. See here:\n\n. ",
    "tomByrer": "Ah, perhaps some vedor-prefix-check gone wild?\nBTW, http://codemirror.net/mode/css/index.html has same issues if you add in tests there:\npadding: calc(3em - 6em); /* remove-dash */\n. cheers @marijnh & @Tomas-A \n. > is in the code itself (check CodeMirror.version), and also added in a header when you compress with http://codemirror.net/doc/compress.html\nThat's handy!  Not so handy if using the source code directly, or compressing or concocting with own-rolled scripts.\n\nI don't think putting that in every file is a very good idea.\n\nI don't think inserting the full licence is a good idea either.  That's why in my linked top-line comment example I suggest:\n(C) 2014 by Marijn Haverbeke & others @license MIT\n. > It is still in the code though\nOh there it is, on the bottom.  First time after submitting an issue/PR to 50 other repos that I had to look at the bottom of the code to find a version.\nThanks\n. ",
    "Heurlinius": "I'm unable to trigger the bug in any way with the patch, so it seems that this problem has been fixed. Thank you!\n. ",
    "juliantaylor": "it is already linked which is how I found the original source, but this is not sufficient for some distributions rules. Packages must be built from modifiable sources which is not the case for minified files.\nNot having the source means packages might have to repackage the tarball of each project using codemirror. As this is just one small file its probably less work if the original source is simply added to codemirror itself.\n. ",
    "ManUtopiK": "I made a little hack that temporary solve this issue.\nI use \"mark-selection\" addon, which apply CodeMirror-selectedtext style on the selection. Also, I can override css of the selection span.\n. ",
    "robinp": "Markdown parsed the leading > signs.\n. Wow, thanks! This resulted in ~30x speedup. Idea: could add batch keyword in that section of the manual so it is easier to find.. ",
    "destitutus": "\nIs this the same problem as #2528 ? Does the patch provided there help?\n\nI am not sure, it need a check\n. > Is this the same problem as #2528 ? Does the patch provided there help?\nyes, looks like problems is same\n. ",
    "daveosborne": "Thanks mightyguava, I would much rather use the vanila keyPress event, but didn't see a way to filter movement keys out. I had tried out a few approaches, but I couldn't do it in a precise way without replicating the vim.js parsing of the commands, which led me to the process* stages and emitting keys there. Admittedly it's a bit heavy-handed.\nI'll try your solution as described and submit another PR.\n. Amazing, this works perfectly with my modified Vimderbar using keyPress, and it's a much better solution. Thanks so much for putting in the time to do this right.\n. I also just noticed that in visual mode, the enter key doesn't move down a line. \nI see only one key binding for  in vim.js, but it's specifically for normal mode.\n. I've tried it in Linux and Windows in Chrome, Firefox, Safari and IE and the bug is reproducible for me in all of them. Does it exit insert mode for you?\n. ",
    "bemjb": "I don't know if it's possible to extract them from the specs, but maybe just from Jens Meiert's page (http://meiert.com/en/indices/css-properties/), since he seems to be a really good job of keeping that up to date.\n. ",
    "Frigory33": "Hello,\nI am interested in this feature as I use it very often.\nYour implementation doesn't work for me on latest Firefox (but it works well on Chromium), as of CodeMirror 5.14.2. It simply moves the text ignoring Ctrl, or in worst cases, if you put your mouse at the wrong place (there are such places in the editor), it will open your text as an URL in the current tab.\nCopying with middle click doesn't work either (on Firefox), so I think I have no way to quickly copy with my mouse\u2026\nHoping to help.\n. Much thanks for your fix.\nI think Firefox fires a mousedown event: http://api.jquery.com/mousedown/\nunless a menu (like the contextual menu) is open. But it still shows the scrolling tool.\n. Thanks for your patch.\nI think I tested something similar and had another error, but I'll only be able to test again on next week.\nIf it still doesn't work, I'll provide a minimal code so that you can test yourself. Did you already?\n. You were right, it doesn't crash anymore (but my indentation causes the lines' first word to be red thus I'll keep my solution for now \u2014 at least, the bug is fixed).\n. OK, thanks for your reply. Yeah, let's follow the KISS rule. Then I'll propose my changes to this possible separate project.\nHappy hacking.\n. ",
    "daveagp": "I am using mark-selection.js and styleSelectedText, but it doesn't \"break selection\" because my .css has rules like\n.CodeMirror-selectedtext {...}\n.markedText {...}\n.CodeMirror-selectedtext.markedText {...}\nBut I think what I really have to do is read more about CodeMirror-selected. Thanks!\n. I don't think I can use CodeMirror-selected, but it is easy enough for me to just force my own css to increase the z. Thank you again for looking at it, and for the amazing open software! \nThis is what I'm using it for, a tool for students to do practice Java exercises (yellow == not read-only):\nhttp://cscircles.cemc.uwaterloo.ca/websheets/index.php#HelloWorld\n. Yes! That's certainly likely. So this is probably not the best as it stands.\nHacking around it could be done by storing, within the pre element, which classes were added by what mechanisms. I am not totally sure what is the best way to store things inside of it or that's even a good idea.\nI am also currently trying a different approach, calling addLineClass in renderLine. It is throwing an error:\n\nLater I'll see if I can debug that, or play around with the store-in-pre approach. Thanks especially if you have any advice on which of those is better.\n. Looking further, here's what caused the crash.\nI press a key\nThis causes some stuff and eventually the first call to endOperation\nendOperation calls patchDisplay which calls buildLineElement \n  which calls buildLineContent which calls the renderLine signal callback (my code)\nmy code calls addLineClass; \n- in regLineChange, cm.curOp.viewChanged is set to true\n- then there is an second call to endOperation (while the first is still midway complete)\n- updateDisplay is called inside there, calling patchDisplay and everything, it completes ok and actually looks ok too?\nfinally my code finishes, \nand we continue the outer call to patchDisplay, but it crashes on the very next line, a call to insertBefore\nSummary there's a comment // Not drawn yet in patchDisplay, but what actually happens from the perspective of the outer call is\n} else if (!lineView.node) { // Not drawn yet\n    var node = buildLineElement(cm, lineView, lineN, dims); \n     //--- it's just been drawn now as a side-effect!\n    container.insertBefore(node, cur); //--- this fails\nSee this picture which I used to check that it was indeed already drawn:\n\nI found one way to fix it is that regLineChange should not set cm.curOp.viewChanged = false; when there are signal callbacks to renderLine pending. (which you can do by ++ing a counter before calling signal on \"renderLine\" and --ing after). But I feel I don't know the right way to fix it since I don't understand the lifespan of operations and what is intended when there are visual changes happening during the ending of some operation.\nSince I already have a hack that works for my purpose (I never delete classes) I guess I would be interested to pursue this until it actually works, if you think it would be useful for me to look more in to this, but I'd need some clarification on what is intended.\nThanks again! It's a very interesting codebase, a pretty good learning experience for me.\n. Here's a minimal example of the bug:\nhttp://wwwnew.cs.princeton.edu/~dp6/CodeMirror/test.html\n. I commented on the patch, \nhttps://github.com/marijnh/CodeMirror/commit/24a6c79b3dfb43dde588e8c4d2189b76d37fba60\nbut I should also comment here, that said patch worked wondefully -- see http://cscircles.cemc.uwaterloo.ca/websheets/index.php#Distance -- it colours the full lines correctly as new ones are added, when I add a class to the pre in the renderLine callback.\nThanks for the suggestion Beni, although I have not tested it!\n. ",
    "mindjuice": "You can hide the cursor by setting cursorBlinkRate to a negative number in the options.  Not sure if this was the case when you posted this, but I'm adding this since I found this post by Googling CodeMirror hide cursor and later found the answer.. ",
    "laurelnaiad": "I've been dragged into using bower myself on a project in order to follow conventions... \nFor initial install, bower can use package.json to know the version number it's going and getting.\nHowever, once installed, the bower.json (usually in bower_components/codemirror) lacks the version number.  As such, when bower needs to decide whether the version that is in the project already is up to date with what is specified in the app's bower.json, it doesn't have any bower.json-based version information to go on... and defaults to assuming that everything is fine, when in fact the bower.json may be calling for an upgrade.  Essentially one cannot cause users of their client app to receive upgraded versions of codemirror using bower.\nI hope that makes sense.  It seems odd to try to describe it -- basically the package.json technique works for an initial bower install but can't track versions thereafter. The only way to use bower and stay up to date would be to target your repository's master branch AFAIK, which isn't really a hot idea.\n. right, top level property in bower.json -- and it is much appreciated -- thanks!\n. ",
    "kkirsche": "Also their maintainer says they probably won't ever use it: http://stackoverflow.com/questions/24844901/bowers-bower-json-file-version-property\n. Na. But consider that Bower may be under NPM anyway which is still something being discussed bower/bower#1520\n. Also their maintainer says they probably won't ever use it: http://stackoverflow.com/questions/24844901/bowers-bower-json-file-version-property\n. ",
    "bernex": "Thanks!\n. ",
    "CareyJWilliams": "Cheers :+1: \n. @marijnh Just stumbled across something that may be related to the above:\naddLineWidget only works on CodeMirror (cm) instances, but again it appears to be tied to the doc instance (so swapping an editor's doc removes the widget, and swapping back to the original doc replaces it).\nIs this intentional?\n. Great, that's good to hear. I'll make a mental note to look into this some more then.\nI don't know how setCursor works exactly, and I know the DOM manipulation is untidy but it does seem necessary for me, without it the cursor doesn't ever become visible for me, even when setCursor is called (this is in webkit, I've not yet tried it elsewhere).\n. ",
    "whirish": "Never mind, fixed it myself. I ended up doing this, and it worked like a charm =)\ncodeMirrorFirepad.setOption(\"mode\", \"clike\");\nCodeMirror.autoLoadMode(codeMirrorInstance, \"clike\");\ncodeMirrorFirepad.setOption(\"mode\", \"text/x-java\");\nCodeMirror.autoLoadMode(codeMirrorInstance, \"text/x-java\");\nNote: this works for all c-like languages\nSincerely,\nLiam O'Flynn\n. ",
    "objectkit": "As it happens, did come across this documentation from an indirectly related project, with short, but scant details of the various css class rules. May come in handy for others, and myself, so posting here for reference: https://github.com/Belar/BearTheme/blob/master/BearTheme.css\n. Gotcha. Apologies for leaving this open for so long. Thanks!. ",
    "allouis": "I'll check the patch out tomorrow morning and let you know how it is, thanks for looking into this\n. Please note: the core_rtlMovement test is failing, in both master and my branch.\n. Ha indeed!\nAh good call, thanks :smile: \n. Chrome version 36.0.1985.125 running on OSX 10.8.5\n. What do you mean by platform btw?\nOn Fri, Jul 25, 2014 at 5:27 PM, Marijn Haverbeke notifications@github.com\nwrote:\n\nOkay, that's pretty much what I'm using. Which platform?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/marijnh/CodeMirror/pull/2725#issuecomment-50172510.\n. Ah: OSX 10.8.5\n. Okay thanks, sure thing - apologies!\n. \n",
    "dexbg": "Ok, thank you for the fast answer.\n. ",
    "mkaminsky11": "I'm working on one https://github.com/mkaminsky11/swift-codemirror\n. I think that it's done, I just never thought of submitting one...I will, though\n. made a pull request https://github.com/codemirror/CodeMirror/pull/3346\n. since it pulls all of the information from CodeMirror's viewport, which only shows a snippet of larger documents for performance reasons, it's pretty good. \nThe only disadvantage of this is that it can't show large parts of the file (only what is rendered by CodeMirror), but the performance gains are worth it.\n. He's saying that there are no line numbers in runmode (https://codemirror.net/demo/runmode.html)\n. Proposed the ability to pass a lineNumbers attribute like \njavascript\n  CodeMirror.runMode(document.getElementById(\"code\").value, \"application/xml\", document.getElementById(\"output\"), {\n    lineNumbers: true\n});\nIn https://github.com/codemirror/CodeMirror/pull/3358\n. ",
    "jeeftor": "@mkaminsky11  - How close are you being ready to do a pull request?\n. ",
    "radix": "so, LightTable has the behavior where when you enter \"(\", a matching \")\" is inserted automatically after your cursor. This is becoming a pretty common thing for editors to do (Sublime Text does it as well, if I recall). I believe given these two features interacting, erroneous results are much more common than correct ones. Quite often I type a long function call or definition, and realizing I'm getting close to my line length limit, I hit enter to continue my argument list on the next line, with the \")\" still in front of my cursor.\nI understand the desire for the behavior you described, but I just want to make sure the statistics of when it's doing the right thing vs the wrong thing are considered.\n. Hmm. I wonder if the behavior could be conditional on whether a comma is before the cursor? i.e., in the case of\nfoo(a|)\na RET would move the \")\" under the \"(\", but in the case of\nfoo(a,|)\na RET could move it under the \"a\"?\n. ",
    "lagesag": "Similar issue on Chrome with min-width:0 workaround on <fieldset>.\ndisplay:table-cell workaround spoils rendering on IE11, where otherwise CodeMirror works fine inside <fieldset>.\n. ",
    "CodaCodr": "Thanks.  You might consider my solution, also :)\n. Well, you obviously know your code better than I do but, at the point the spans are \"flattened\" I'd look for \"block\" and skip if found.  Using your solution (the api) I get a fix for my problem but the solution pollutes ALL spans.\nMaybe I'm missing something :/\n. Sarcasm.  Always helpful.  So, cm does not honor css as written and, because of that, we get an all-or-nothing solution that makes the doc MUCH fatter and performs less optimally.\nSeriously, I thought the point of stepping through the stream, token by token, was to style it, you know, using css, you know, token-by-token.\nHere's a workaround:\nUse a \"tick class\".  In your stream handling code, toggle the offending classname between \"tick-whatever\" and \"tock-whatever\" and leave .flattenSpans:true to get flattened (optimized) spans everywhere else:\n.cm-bjsonchar-tick, .cm-bjsonchar-tock {\nfont-size:125%;\nmargin:4px;\n}\nMessy but works.\n. > Where would it look for block? In the style name? That seems a little magical.\nThat, unless I am much mistaken, is sarcasm, since, block cannot be seen in a style name (aka rulename) and suggesting it would be magical is tantamount to argumentative.\nAngry? hardly.  My \"case\", as you put it, is made.\nAs to the workaround...\nA tick class would tick and tock (or flip and flop if you're an eletronics head) between to states/modes.\nHaving found a jsonchar (refer back for my list of tokens being sought), send cm either bjsonchar-tick (first and other odd times) or bjsonchar-tock (second and other even times) having  stored which was sent last time in localstate or whatever and updated each go around. But ONLY do that for those chars listed... problem solved, methinks...\nHere's a quickie using arrayed classes...\nCodeMirror.defineMode(\"bcode\", function(config, parserConfig) {\n  var $b_overlay = {\n    localState: {\n     charClasses: [\"bjsonchar-tick\", \"bjsonchar-tock\"],\n     charClassIX: 0,\n     inCommentPair: false,\n     inString:      false\n    },\nthen, somewhere in token....\ntoken: function(stream, state) {\n  ....\n  for(...) {\n    if(stream.match(char)) {\n      klass = localState.charClasses[localState.charClassIX];\n      localState.charClassIX = localState.charClassIX === 0 ? 1 : 0;\n      return klass;\nLike I said, messy but works.  :/\n. You may well be right about V8 - I have no way to know for sure.  But I take a different approach; do the best I can to treat all 3rd party code as a locked down \"server\" and write my code as a client that runs against it (i.e. however badly it may do its job, \"deal with it\").\nAnd frankly, I can blame CM for hiding the errors... there is no clue given in the stack trace as to what the root cause was.  CM is crashing because it assumes I write perfectly good mode code.  A very silly assumption ;)\nObviously, for you, it's a nightmare scenario. What are you meant to do... try-catch every line? :/ Ridiculous.  But at some key points, I would certainly code defensively against dumb errors (like mine). mfactory exploded and CM failed to catch it - it failed to tell me and failed to inform itself there was no point continuing because it was going drive off a cliff...\n. Okay... I took another look.  Because CM is making the assumption (that my mode code is perfect) the code in the finally block (by definition) is executed... and therein lies the problem (as defined in this issue, anyway).\nSo... I did this...\n// Run the given function in an operation\n  function runInOp(cm, f) {\n    if (cm.curOp) return f();\n    startOperation(cm);\n    try { \n      return f(); \n    } catch(e) {\n      throw e;  // <-- now I'll see MY dumass error(s)\n    }\n    /finally/  endOperation(cm);\n  }\nAs the comment says, now I see my errors and a relevant stack trace that makes perfect sense (to me and my code) not a bunch of unrelated \"causal\" stuff from CM going bang much later in the chain.\n. With the error in the mode file, it's never going to matter... like I said, it's heading over a cliff.  What matters most is reporting the root cause of the error (not reporting a bunch of crap later that really doesn't matter.  That cost me three hours this morning)\nI'm surprised you're not getting this...\n. And, in case that's down to github formatting... the content of the old finally clause is still there ... github has removed my stars...\n// RGT: we need this to catch so NW can reveal any errors in the mode file\n  function runInOp(cm, f) {\n    if (cm.curOp) return f();\n    startOperation(cm);\n    try { \n      return f();\n    } catch(e){\n      throw e;\n    }\n    endOperation(cm);\n  }\n. Node-webkit !== Chrome;  But thanks for the info.\nQuestion: is codemirror supported in a node-webkit environment? \nThe answer to that right now is \"kinda\".\n. ",
    "grothesque": "Marijn Haverbeke notifications@github.com writes:\n\nThis is already possible. You can style the CodeMirror-cursor \nCSS class to influence the way the cursor is displayed, and use \nthe cursorBlinkRate option to control the blinking (set to zero \nto disable blinking entirely).\n\nThanks, it works!\n. ",
    "normanrz": "Just openend a PR that addresses the cancelling of the list when you hit enter twice https://github.com/codemirror/CodeMirror/issues/2868.\n. ",
    "jmcriffey": "Attached?\n. Sweet thanks, I'll check it out.\n. This looks like it fixes the issue. Thanks again!\n. ",
    "segrax": "Appologies mate, didnt realize the repository was still needed after a pull request was submitted, will re-create it\n. ",
    "afc163": "My mistake, now it is good.\n. I am not very familiar with CodeMirror, keymap and theme, that is ok too.:cry: \n. In my case, there is some custom css code for .cm-header cause similar problem. Remove the the below display: inline-block; everything works fine.\ndiff\n  .cm-header {\n    color: #202020;\n    margin: 4px 0;\n-   display: inline-block;\n  }. ",
    "jaydp17": "@marijnh Have a look at this\n. ",
    "bijanbwb": "I just looked into it further and it can't be an issue with CodeMirror after all, because it's affecting a few of our courses that don't even use CodeMirror.\nIt's so odd that it seems to work fine for most challenges and most courses, but that it's reproducible on single-line \"console\" challenges.\n. Thanks for checking it out though and responding though, I really appreciate it.\n. ",
    "timothee-alby": "Indeed, it's fixed.\nThanks a lot :)\n. Great, thanks a lot!\n. Cheers!\nOn Mon, 18 Jan 2016, 10:56 a.m. Marijn Haverbeke notifications@github.com\nwrote:\n\nClosed #3769 https://github.com/codemirror/CodeMirror/pull/3769.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3769#event-517727845.\n. \n",
    "Synchro": "To be fair, it was my IDE (PHPStorm) that spotted it!\n. ",
    "sirex": "@mightyguava since this is vim mode, then it is logical to be as close as possible to real vim behaviour.\nI use YpVr= combination a lot with reStructuredText and Markdown for making headings. Probably many people found their ways, how to use Y which yanks whole line in vim.\nI was a bit disappointed, when Y did different thing, than I expected.\nAnyway, I still vote for changing Y to be compatible with vim. Anyone using vim will expect Y to yank whole line.\n. Actually I use vim for about 10 years and I use Y a lot. Didn't knew, that same thing can be done with yy. Probably Y worked better for me.\nI think we can close this issue and open it if there will be more people like me.\n. ",
    "davidmaxwaterman": "I'll just add my tuppence-worth here. I've been using vi and subsequently vim for 30 years, and have been using 'Y' all that time and find it a bit off-putting to only now have to convert to 'yy'. I don't use vim with any special compatibility mode.\nI guess I fall into the category of people who can figure out how to make it work, but what actually happened was I concluded it was broken due to a limited feature set or bug and just gave up, going back to real vim (inside crouton in this case) - as you can tell from the above link in vim.js.\nAnyway, up to you what you want to implement, but bear in mind some of us are using vim because we grew up on vi (I still have an original AT&T user manual somewhere, iinm), and so compatibility is of non-zero importance. I guess I have indeed learned some vim-only features, so going back to vi itself would be just as problematic. Still, this is the best implementation in javascript that I've seen.\n. ",
    "dsummersl": "It would be helpful to know how to override codemirror's behavior here; I've found the non-standard behavior of CodeMirror to vim/vi behavior of Y quite interrupts my workflow. Anyone have a snippet they could share to change this setting?. ",
    "fetzi": "I've updated to the current sources from github. the problem still arises.\nOk, now a more detailed description of the problem.\nIn my editor I have a horizontal scrollbar. Now when I start selecting at the line beginning and scroll to the right (to the outside of the editor) and release the left mouse button the \"selection mode\" is not canceled. that means when i reenter the editor with the mouse the highlighting continues and the highlighted text follows the mouse arrow. Only when i press the left mouse button a few times or by closing the editor the problem disappears.\nIs the problem now clear to you?\nOtherwise I could make a short screencast for you.\n. ",
    "jonegerton": "Re Travis Fail:\nThe most recent Travis fail is on a js file unrelated to my changes - think its probably related to the recent work on vim. The error is: \n\nkeymap/vim.js: Unused function beforeSelectionChange\n. \n",
    "bnjmnt4n": ":+1:\n. ",
    "aakash-cr7": "Hello.\nI am new to open source. Please can you guide me how to contribute?\n. @sbruchmann  Thanks for the advice!\n How can I start working on this project?\n. ",
    "sbruchmann": "@aakash-cr7 You can find a good introduction at https://guides.github.com/activities/contributing-to-open-source/\n. You\u2019ll have to keep track of your marks on your own and clear them yourself when they aren\u2019t needed anymore.\njavascript\nconst markers = [];\nmarkers.push(cm.markText(\u2026));\nmarkers.forEach(marker => marker.clear());\nSee documentation for doc.markText().\n\nGitHub Issues is a bug tracker. There\u2019s a dedicated forum for questions and user support at discuss.codemirror.net.\n. How is that related to Markdown?\n. The continuelist addon is a good starting point for an implementation of the requested behavior.\n. @7sixer I use CodeMirror in Electron without any issues. I\u2019m loading modes via require.. Yes.\n\nNew features\nThe core is now maintained as a number of small files, using ES6 syntax and modules, under the\nsrc/ directory. A git checkout no longer contains a working codemirror.js until you npm build (but\nwhen installing from NPM, it is included).. \n",
    "DmitryBaranovskiy": "Clicking on drag selection turns it into cursor at the moment.\nIf making pull request was an option, I wouldn\u2019t bother with creating the issue :)\n. ",
    "abhishekmittal09": "Thanks.. it works.. :+1: \n. ",
    "halfninja": "Also affects us on most IE10 installations, though I have one IE10 of the same version (though in a VM) that works fine - not sure what the difference is at the moment. Version 10.0.9200.16921\n. Tested in previous versions - works in 3.24, but broken from 4.0 onwards.\n. ",
    "meaxwell": "I have tested this in 4.5.0 and the problem is better except in the case of when the line is blank. \nWhen there is text in the line it acts correctly.  When the line is blank and the zoom is greater than 100% then the cursor cannot be seen.  When the zoom is less than 100% then the cursor is too far to the right.\n. works perfectly.  Thanks\n. ",
    "okonomiyaki3000": "I know this file already passed lint but I thought I'd try a stricter standard. If it's alright, I'll do the same for other files. \n. Well, I can't really explain this build failure. \n. ",
    "dschu-lab": "Yeah, but there is no event after an editor is created, isn't it?\nMy workaround is no real solution, because the timeout depends on how long it takes to create an editor.\nIt would be nice, if I could do something like CodeMirror.on('init' .... ), or is there something similar?\n. ",
    "christianalfoni": "Hi, very sorry for my late response, I must have missed the email notification. I think I did this the wrong way, changed it around a bit now. Not considering +input and +delete, just using \"from\" and \"to\" as a selection and replacing that with content of \"text\". Works perfectly :-)\nThanks for your response!\n. Ah, that is great! Is this part of next release? Or am I on the wrong version? Thanks for your time :-)\n. ",
    "WhatFreshHellIsThis": "Hello, yes definitely javascript mode as you can see from my config though I guess it's possible that the value in the config isn't resulting in the editor knowing it's in javascript mode?  How can I tell for certain? Everything appears to be in order, I can edit code in the window and it's syntax highlighting appears correct.\nIn the console the value of CodeMirror.lint.javascript is:\nCodeMirror.lint.javascript\nfunction e(a,b){if(!window.JSHINT)return[];JSHINT(a,b);var c=JSHINT.data().errors,d=[];return c&&i(c,d),d}\nThere is some reference in the code if I recall correctly about 'finding' the linter.  Perhaps it's not finding it due to the combined scripts?\n. Very odd, I commented out the lint: true part of the config so I don't get that error and can load the script, and this is what I get executing that line of code on the editor and logging the results to console:\nfunction e(a,b){if(!window.JSHINT)return[];JSHINT(a,b);var c=JSHINT.data().errors,d=[];return c&&i(c,d),d}\nIf I'm not mistaken that does what it's supposed to does it not?  So I only get the error if I specify lint:true in the config but if I don't then the code could run fine.  Very wierd, not sure where to go from here.  Perhaps I should try without the consolidated scripts and set it all up separately like in the demo just to see if that's the cause, or do you think that's a waste of time?\n. Unfortunately, there are precious few different ways to load the scripts when it's the single consolidated one generated off the CodeMirror site.  \nI'll try to carve out some time to try it without using the consolidated script from the CodeMirror site and instead try to replicate the demo with separate scripts though I'm not sure if that works what it will solve as I'll still just need to consolidate all the scripts in my build anyway.\n. Ah..ok, got you, I'll hunt around and try to figure it out.\n. So I tried the separated scripts and it worked properly immediately.\nI'm going to pick it apart more and try to figure out the exact issue but it does appear to be related to the combined scripts in some way.  \nI wonder if something is conflicting with something else because my combined script has quite a large number of add-ons selected for it as you can see in my first post and my quick test with the separate script files I only included the ones for testing Javascript editing and linting and none of the many others. \nI have one last block of time I can afford to devote to this tomorrow so hopefully I'll pin it down then otherwise there just won't be a linting feature in the application.\n. Ok, I've figured it out and this is actually related to an Angular directive https://github.com/angular-ui/ui-codemirror/ though what I discovered may actually reveal a problem with CodeMirror itself.\nIt turns out when you use the directive the order the options are specified in matters and if the mode: 'javascript' does not come before the lint option then it gives the error I've reported here, however that is not an issue when not using the directive.  \nIn the Angular directive it feeds the options to the CodeMirror instance via this bit of code:\nfunction updateOptions(newValues) {\n            for (var key in newValues) {\n              if (newValues.hasOwnProperty(key)) {\n                codeMirror.setOption(key, newValues[key]);\n              }\n            }\n          }\nWhich I've discovered does not work at all the same way as the regular configuration method CodeMirror uses in all the examples in that for some reason when it's set via that bit of code above the order appears to matter greatly.  \nThings that are not in a certain order just don't work, i.e. if the Lint: true option comes after the gutter option then it doesn't show the warnings in the gutter at all, whereas when the options are set in the html page directly not using the Angular directive as in all the CodeMirror demos then it doesn't matter what order the options are specified in (I've tested and this is the case).\nSo it appears that CodeMirror doesn't handle the options being fed to it one by one using setOption in the same manner that it consumes and uses the options normally when specified in one chunk on the html page but I'm not sure if this is really a bug with CodeMirror setOptions function or if it's the way the Angular directive has been coded to do it.\nIn summary it appears that when setOption CodeMirror function is used, unexpected things happen if the options are in a certain order.\nNot sure if I should close this issue or not at this point.\nI've opened an issue in the Angular directive case here for this as well: https://github.com/angular-ui/ui-codemirror/issues/61\n. Thank you @marijnh, I appreciate your time and help with this.\n. Hi @nicholaswright same error but it sounds like an entirely different cause from this particular issue, you might want to open a new issue.\n. ",
    "nicholaswright": "Hi, I was getting the same error. It was being caused when I included the lint specific CodeMirror options (gutters: [\"CodeMirror-lint-markers\"] and lint: true) when in the wrong mode. For example, when CodeMirror is in htmlmixed mode those options will generate the error, but when in javascript mode it's okay. So add a condition that checks the mode and only include them when necessary. \n. ",
    "Mad-Chemist": "As @nicholaswright mentioned above, I get this error consistently when using \"htmlmixed\" as my mode.  As soon as I choose \"javascript\" for my mode, the error stops happening and linting works properly.\nAny suggestions?\n. ",
    "nilp0inter": "Yes, it's possible. With this patch any random type will not be converted to 'error' anymore.\nDo you think that it's a common behavior? Is it a documented feature?\n. Ok, I've just modified the patch. All tests passed.\n. ",
    "donpinkus": "Thanks for the speedy response Marijnh! \nI'm letting a user mark up their code. Basically they can click on a variable, and give a \"description\" of that variable. In CodeMirror, I want to give an indicator that this variable has been described. \nI was thinking I could wrap the variable in span tags, or add a class like described to the existing span tags.  Otherwise I'm not sure how I can reliably target that variable for highlighting. \nmarkText looks interesting, but also looks like it's set by character numbers so may break if text is typed before the marked text. I'll give it a shot.\n. Awesome, thanks @marijnh!\n. ",
    "ishamf": "Thanks!\nActually, I didn't fully read the spec too when I first reported this, so I just picked an example that demonstrates the issue...\nI've tested the new code, and it works for the common use cases, with two bugs: Indented YAML comments with a : are parsed as a key-value pair, and some valid YAML are not highlighted.\n\nSource\nAfter I found that, I started reading the YAML spec and found something that I think is a definition of a valid YAML key.\nThe previous YAML that don't highlight correctly are defined as flow plain scalar styles. Basically unquoted plain strings. And it says... (emphasis mine)\n\nPlain scalars must not begin with most indicators, as this would cause ambiguity with other YAML constructs. However, the \u201c:\u201d, \u201c?\u201d and \u201c-\u201d indicators may be used as the first character if followed by a non-space \u201csafe\u201d character.\n\nI've collected all the indicators that are not allowed (I think). They are:\n,[]{}#&*!|>'\"%@`\nThis file contains some YAML that uses those characters.\nThe indicators may be included in the middle of a string. For example, this:\na [list]: but not here\na {map}: but not here\nmy-email@example.com: works\nis valid YAML.\nAlso, they can be included in the beginning of a string if it is a quoted string.\n\"@cow\": x\n'@grass': x\nOne thing that might be a problem is comments:\n```\nThis fails\na #comment: x\nBut this doesn't\na#comment: x\n```\nI'm not good with regexes, so I can't contribute code to solve this problem (sorry!) but I can probably contribute a summary of a valid YAML key.\n- It can be contained by '' or \"\", bypassing all the following rules.\n- It must not begin with ,[]{}#&*!|>'\"%@\n- It can contain anything, even the above characters, except:\n- The string # (with space before it) because that starts a YAML comment, preventing the colon and the value from being read.\n- It is terminated by colon space : (space after colon not optional)\n. This last commit seems fine. Invalid keys are still highlighted as keys, but I don't think it's a big problem in actual use.\n. ",
    "nomennescio": "I'm experiencing this issue on Win7 with Chrome 59.\nWhen copying text to the clipboard, and pasting, text larger than 1000 bytes will get replaced by a single '-'. In my case it will even get triggered WITHIN the CodeMirror pane, as well as when switching between the pane and an external editor.\nIsn't that also what the indicated code seems to do?\nminimal = hasCopyEvent && (range.to().line - range.from().line > 100 || (selected = cm.getSelection()).length > 1000);\nvar content = minimal ? \"-\" : selected || cm.getSelection();\nSo why is that piece of code in in the first place? It seems to be exactly the piece of code that is triggered, just as the original bug reporter mentioned.\nThe only \"workaround\" is to copy-paste smaller pieces of text, one by one, until the whole block is copied. That is ridiculous.\n. To copy and paste text, I use the CTRL-C and CTRL-V keys after CTRL-A (or selecting text with the mouse).. I've also found why this bug triggered.\nIt seems to be due to a Chrome plugin\nhttps://github.com/jswanner/DontFuckWithPaste\nAdding the site to the 'exclude URL pattern' list, will not trigger the bug.\nIt is probably due to assumptions on your part about an expected series of events, which that plugin changes.  . ",
    "guiambros": "+1! The \"-\" behavior was driving me crazy the last few weeks. I thought it was a bug on Jupyter Labs/Notebook, until I realized copy/paste worked fine in Firefox.\nIn the end the culprit in my case was also DFWP, the same Chrome extension mentioned by @nomennescio. Disabling the extension, or adding to the URL exclusion list, solved the issue for me. Details here.\nWhile the issue is not caused by CodeMirror directly, maybe there's an opportunity to replace the default \"-\" with a more intuitive message (or maybe a message in console.log?) explaining why the user is seeing it.. > DFWP seems to completely disable all copy/cut/paste events.\nExactly. DFWP disable clipboard events, in order to block sites from nefarious or annoying behaviors -- e.g., forms not allowing you to paste in password confirmation field.\nIn this case, even with DFWP enabled, the copy & paste still worked with <1000 characters. It was only over this limit that the JS injected by DFWP triggered the hidden textarea hack in CM, resulting in the \"-\".\nAnyway, I agree with the sentiment; you're certainly asking for trouble when you install a Chrome extension that modifies your clipboard behavior -- even if the intent is to restore its original functionality :)\nThanks for the quick patch! Much appreciated.. ",
    "StephenVanSon": "So you suggest I do my own scanning in the autocomplete function or in the mode? I understand how the mode works just because it's a simple example but I don't fully understand the autocomplete function, I mostly just tweaked the words and commented out functions that weren't critical. Sorry if that's a stupid question I've only been programming 2 years and haven't attended university.\nThanks for the quick response by the way!\nEdit: I can copy my code for you if that would help?\n. When writing this from scratch where do you suggest I start? I'm guessing I would reference the function scriptHint for help but I don't even understand a lot of what it is doing. Thanks so much for your help!\nThis is the code I have isolated so far as essential: \n```\n(function () {\n  function forEach(arr, f) {\n    for (var i = 0, e = arr.length; i < e; ++i) f(arr[i]);\n  }\nfunction arrayContains(arr, item) {\n    if (!Array.prototype.indexOf) {\n      var i = arr.length;\n      while (i--) {\n        if (arr[i] === item) {\n          return true;\n        }\n      }\n      return false;\n    }\n    return arr.indexOf(item) != -1;\n  }\nfunction scriptHint(editor, keywords, getToken) {\n      // Find the token at the cursor\n  var cur = editor.getCursor(), token = getToken(editor, cur), tprop = token;\n// If it's not a 'word-style' token, ignore the token.\nif (!/^[\\w$_]*$/.test(token.string)) {\n  token = tprop = {start: cur.ch, end: cur.ch, string: \"\", state: token.state,\n                   className: token.string == \".\" ? \"property\" : null};\n}\n// If it is a property, find out what it is a property of.\nwhile (tprop.className == \"property\") {\n  tprop = getToken(editor, {line: cur.line, ch: tprop.start});\n  if (tprop.string != \".\") return;\n  tprop = getToken(editor, {line: cur.line, ch: tprop.start});\n  if (!context) var context = [];\n  context.push(tprop);\n}\nreturn {list: getCompletions(token, context, keywords),\n        from: {line: cur.line, ch: token.start},\n        to: {line: cur.line, ch: token.end}};\n\n} \nCodeMirror.keywordHint = function(editor) {\n    return scriptHint(editor, Keywords,\n                      function (e, cur) {return e.getTokenAt(cur);});\n  }\nvar keywords = (\"Abs,Max,Min,\").split(\",\");\nfunction getCompletions(token, context, keywords) {\n    var found = [], start = token.string;\n    function maybeAdd(str) {\n      if (str.indexOf(start) == 0 && !arrayContains(found, str)) found.push(str);\n    }\n      forEach(keywords, maybeAdd);\nreturn found;\n\n}\n})();\n```\nAnd here is the code I have written so far from scratch. I don't really understand the from: {line: , ch: } and to:{line: ,ch: }. Any help on what I'm missing to make it work? \n```\n(function () {\n    function forEach(arr, f) {\n        for (var i = 0, e = arr.length; i < e; ++i) f(arr[i]);\n    }\nfunction arrayContains(arr, item) {\n    if (!Array.prototype.indexOf) {\n        var i = arr.length;\n        while (i--) {\n            if (arr[i] === item) {\n                return true;\n            }\n        }\n        return false;\n    }\n    return arr.indexOf(item) != -1;\n\n}\n\nfunction hints(editor, keywords) {\n    var cur = editor.getCursor();\n    var currentDocument = editor.getValue();\n    var currDocAsArray = currentDocument.split(\"\");\n    var indexOfFunction = 0;\n    for (i = 0; i < currDocAsArray.length; i++) {\n        if (currDocAsArray[i] === \"@\")\n            indexOfFunction = i;\n    }\n    var typedCharacters = currentDocument.substring(indexOfFunction + 1, cur.ch);\n    return {\n        list: getCompletions(context, keywords),\n        from: { line: cur.line, ch: currentDocument.indexOf(typedCharacters.substring(0,1)) },\n        to: { line: cur.line, ch: currentDocument.indexOf(typedCharacters.substring(typedCharacters.length -1)) }\n    }\n\nvar keywords = (\"Abs,Max,Min,Int\").split(\",\");\n\n\n}\nfunction getCompletions(context, keywords) {\n    var found = []\n    function maybeAdd(str) {\n        if (str.indexOf(start) == 0 && !arrayContains(found, str)) found.push(str);\n    }\n    forEach(keywords, maybeAdd);\n\n    return found;\n}\n\n})();\n```\nAlso I am new to javascript.\n. Thank you very much! Your help is greatly appreciated for a beginner like me :), especially because that  code makes a lot more sense to me than the one using tokens.\n. ",
    "vvlevykin": "Yes, this is still the case for both 4.5.0 and the master branch.\nThe minimal example is (for 4.5.0):\n``` html\n<!DOCTYPE html>\n\n\n\n\n\n            #cmContainer {\n                border: 1px solid black;\n                width: 350px;\n            }\n        \n\n\n\n\n    <div id=\"cmContainer\"></div>\n\n    <input type=\"button\" value=\"swap to 1\" id=\"swap1\" onClick=\"clickSwap1()\"/>\n    <input type=\"button\" value=\"swap to 2\" id=\"swap2\" onClick=\"clickSwap2()\"/>\n    <script>\n        var cm = CodeMirror(document.getElementById('cmContainer'), {\n            'lineNumbers': true\n        });\n\n        var doc1 = CodeMirror.Doc(new Array(50).join(new Array(20).join('abc ') + '\\n'));\n        var doc2 = CodeMirror.Doc(new Array(10).join(new Array(3).join('def ') + '\\n'));\n        cm.swapDoc(doc1);\n\n        function clickSwap1() {\n            cm.swapDoc(doc1);\n        }\n\n        function clickSwap2() {\n            cm.swapDoc(doc2);\n        }\n    </script>\n\n</body>\n\n\n```\n. It fixed the issue, thanks!\n. ",
    "alpesh1988": "Sorry , I had deleted my comment but you can look at similar issue i found at http://code.google.com/p/chromium/issues/detail?id=418177\nThanks\n. ",
    "ShimShamSam": "@marijnh The online demo at codemirror.net has all lines in the DOM, despite the text editor only being capable of showing a few lines.\n. Ah, I see. It is just greatly overestimating the height\n. ",
    "JeffryBooher": "I've been hitting this quite a bit debugging. I wonder if we could just add a maxRetries to get out of the infinite loop.\n. @peterflynn This happened for me while loading a project.  I got stuck in this infinite loop in codeMirror.scrollPosIntoView() \njavascript\n   for (;;) {\n      ....\n      if (!changed) return coords;\n    }\nchanged is never set to false so it continues on. I'm not sure why but, If I run into it again, I'll capture more data. I just thought that it would be better than, having an infinite loop, to just give up after so many tries.\n. @peterflynn I just ran into this again but I'm still not sure how it can happen yet.  \nWhen scrollPosIntoView is called (MainViewManager.js)\npos = {ch: 23, line: 1447}, end = {ch: 24, line: 1447}, margin = 3\nThis may have been due to having a very narrow view window but i don't have a reproducible scenario yet but i'm not sure yet why it happens.\nIn this case the line 3737:\nif (Math.abs(cm.doc.scrollLeft - startLeft) > 1) changed = true;\nthe expression jostles between 800 and -800 on each successive iteration so changed is always set to true\nAnother potential problem, however, might be if those coordinates are now out of range due to editing the document in another editor.  Another case to test.\n. I'm not a language expert / loc engineer but it seems that a webkit input that has that string will put the LTR char on the left of the RTL string if the cursor is to the left of the RTL string.:\nssss\u0639\u0631\u0628\u064a\u0629asdfgh\nIf the cursor is inside an RTL string, however, It positions the RTL character n characters from the right of the LTR string where n is the number of characters from the left the cursor is.  So if I put the cursor second from end of an RTL sequence and type an LTR character, the LTR character is inserted second from the right of the string:\n\u0639\u0631\u0628\u064a|\u0629asdfgh then typing s becomes => \u0639\u0631\u0628\u064as\u0629asdfgh\nI don't know which is correct but having 2 cursors may be confusing. I think that's what our Loc engineer was saying. But there doesn't seem to be any way to add an LTR character to the left of an RTL sequence which may be necessary to spell some words which do not translate and have to be represented in an LTR language.\nLet me see what our localization engineer has to say about it.\n. I captured the current state but there is a lot of data so I tried to whittle it down to what was not HTML nodes and just keep what I thought was meaningful. Let me know if there is something that you need that isn't here.\n``` javascript\nCodeMirror {\n    display: {\n            alignWidgets: false\n            curOp: null\n            display: Display\n            alignWidgets: false\n            cachedCharWidth: null\n            cachedPaddingH: null\n            cachedTextHeight: 15\n            disabled: false\n            externalMeasure: null\n            externalMeasured: LineView\n            inaccurateSelection: undefined\n            lastSizeC: 1100\n            lineNumChars: 4\n            lineNumInnerWidth: 30\n            lineNumWidth: 55\n            maxLineChanged: false\n            maxLineLength: 162\n            pollingFast: false\n            prevInput: \"\"\n            selForContextMenu: null\n            shift: false\n            updateLineNumbers: null\n            viewFrom: 1023\n            viewOffset: 15345\n            viewTo: 1117\n            wrapper: {\n                clientHeight: 1100\n                clientLeft: 0\n                clientTop: 0\n                clientWidth: 74\n                offsetHeight: 1100\n                offsetLeft: 1296\n                offsetTop: 29\n                offsetWidth: 74\n                crollHeight: 1100\n                scrollLeft: 0\n                scrollTop: 0\n                scrollWidth: 104\n            }\n    }\n    doc: {\n        doc: CodeMirror.Doc\n        cantEdit: false\n        children: Array[9]\n        cleanGeneration: 2\n        cm: CodeMirror\n        first: 0\n        frontier: 1154\n        height: 17310\n        history: History\n        id: 2\n        mode: {\n            blockCommentEnd: \"/\"\n            blockCommentStart: \"/\"\n            electricChars: \":{}\"\n            fold: \"brace\"\n            helperType: \"javascript\"\n            indent: function (state, textAfter) {\n                    jsonMode: undefined\n                    jsonldMode: undefined\n                    lineComment: \"//\"\n                name: \"javascript\"\n            }\n        modeOption: \"javascript\"\n        parent: null\n        scrollLeft: 1102\n        scrollTop: 15523\n        sel: Selection\n        size: 1154  \n    }\n    options: {\n            addModeClass: false\n            autoCloseBrackets: false\n            autoCloseTags: {\n                indentTags: Array[0]\n                whenClosing: true\n                whenOpening: true\n            }\n        autofocus: null\n        coverGutterNextToScrollbar: true\n        cursorBlinkRate: 530\n        cursorHeight: 1\n        cursorScrollMargin: 3\n        disableInput: false\n        dragDrop: false\n        electricChars: false\n        extraKeys: Object\n        firstLineNumber: 1\n        fixedGutter: true\n        flattenSpans: true\n        gutters: Array[1]\n        highlightSelectionMatches: false\n        historyEventDelay: 1250\n        indentUnit: 4\n        indentWithTabs: false\n        keyMap: \"default\"\n        lineNumbers: true\n        lineWrapping: false\n        matchBrackets: Object\n        matchTags: Object\n        maxHighlightLength: 10000\n        mode: \"javascript\"\n        moveInputWithCursor: true\n        pollInterval: 100\n        readOnly: false\n        resetSelectionOnContextMenu: true\n        rtlMoveVisually: false\n        scrollPastEnd: false\n        showCursorWhenSelecting: true\n        singleCursorHeightPerLine: true\n        smartIndent: true\n        specialCharPlaceholder: function defaultSpecialCharPlaceholder(ch) {\n                specialChars: /[\\t\\u0000-\\u0019\\u00ad\\u200b-\\u200f\\u2028\\u2029\\ufeff]/g\n                styleActiveLine: false\n                styleSelectedText: false\n                tabSize: 4\n                tabindex: null\n                theme: \"dark-theme\"\n                undoDepth: 200\n                value: \"\"\n                viewportMargin: 10\n                wholeLineUpdateBefore: true\n                workDelay: 100\n                workTime: 100\n        }\n    }\n    state: {\n            checkedOverlayScrollbar: true\n            cutIncoming: false\n            draggingText: false\n            failedTagMatch: false\n            focused: true\n            highlight: Delayed\n            matchBothTags: true\n            matchBrackets: Object\n            modeGen: 2\n            overwrite: false\n            pasteIncoming: false\n            suppressEdits: false\n            tagHit: null\n            tagOther: null\n    }\n}\npos {\n  line: 1066, \n  ch: 3\n}\nend {\n  line: 1066, \n  ch: 5\n}\nmargin = 3\n```\nthe pos and end values are such that they are out of view and the view (view only wide enough to show line numbers)\nThen it goes into its infinite loop trying to find the scroll position. I'm not sure at what point this capture is but here is the state of one iteration of the loop:\n``` javascript\ncoords {\n    left: 21, \n    right: 21, \n    top: 16005, \n    bottom: 16020\n}\nendCoords {\n    left: 35, \n    right: 35, \n    top: 16005, \n    bottom: 16020\n}\nscrollPos {\n    scrollLeft: 21\n}\nstartTop = 15523\nstartLeft = 1102\n```\non the next iteration:\n``` javascript\ncoords  {\n    left: 21, \n    right: 21, \n    top: 16005, \n    bottom: 16020\n}\nendCoords {\n    left: 35, \n    right: 35, \n    top: 16005, \n    bottom: 16020\n}\nscrollPos {\n    scrollLeft: 1102\n}\nstartTop = 15523\nstartLeft = 21\n```\nit goes back and forth like this over and over waffling the startLeft value.\nInterestingly I just noticed that it's hitting BranchChunk.chunkSize() and the leafChunk object has no lines property. \nHere's the state of one such object:\njavascript\nBranchChunk {\n    children: Array[6]\n    height: 2310 \n    parent: CodeMirror.Doc\n    size: 154\n}\nIt's throwing an RTE which may be causing some other issues.  It's definitely difficult to debug when it hits this.\nHope this helps. Let me know if you need more data.\n. looks like I targeted the wrong repo somehow...\n. Theoretically it could be reproduced outside of Brackets.  The inputs to scrollPosIntoView have to be off-screen in the right way.  I'll get you the input values.  I can reproduce this reliably.\n. ",
    "crystalin": "Hi, the stack trace is limited and I can't see the root:\ntoo much recursion codemirror.js:5317\nconsole.trace(): codemirror.js:5317\nindexOf() codemirror.js:5317\nlineNo() codemirror.js:4944\nwindow.CodeMirror</TextMarker.prototype.find() codemirror.js:3711\nlineIsHiddenInner() codemirror.js:4043\nlineIsHiddenInner() codemirror.js:4044\nlineIsHiddenInner() codemirror.js:4044\nlineIsHiddenInner() codemirror.js:4044\n...\nWith a debug inside I was able to get those attributes:\nconsole.debug('lineIsHiddenInner', doc, line, span, span && span.to, span.marker.inclusiveRight && span && span.to == line.text.length, line.markedSpans.length);\n=> \n\"lineIsHiddenInner\" Object { children: Array[1], size: 2, height: 50, parent: null, first: 0, scrollLeft: 0, scrollTop: 0, cantEdit: false, history: Object, cleanGeneration: 1, 6 de plus\u2026 } Object { text: \"\ue000Voila une note\", height: 25, parent: Object, stateAfter: true, styles: Array[3], order: false, markedSpans: Array[1] } Object { from: 0, to: null, marker: Object } null undefined 1\nHere is a ss of the properties:\n\n. line 4044: I'm not sure it is the expected behavior but it fixed my problem:\n--    return lineIsHiddenInner(doc, endLine, getMarkedSpanFor(endLine.markedSpans, span.marker));\n++      var sp = getMarkedSpanFor(endLine.markedSpans, span.marker);\n++      if (!sp || sp == span) {\n++        return null;\n++      }\n++      return lineIsHiddenInner(doc, endLine, sp);\n. Sorry you are right, The issue doesn't appear with the current version. \n. ",
    "glaforge": "Just a quick comment to say I'll definitely be looking into the great suggestions you've given above.\nI'm a bit under water for now, but I will come back to improving this pull request sometime soon.\nThanks a lot for your help and attention!\n. Fair enough. I haven't had time at all to further work on this :-(\nWhen I find a moment to come back on this topic, should I create a new issue, and reference it from here?\n. ok thanks (and sorry again for lack of time)\n. ",
    "mgaitan": "This is happening to me.\nwith \njavascript\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"id_raw\"),\n    {'mode': 'rst'});\nI got \n\nbut with\njavascript\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"id_raw\"),\n    {'mode': 'rst-base'});\nit works\n\n. @marijnh here I did a minimal example \nin mode \"rst\" doesn't work\nhttp://mgaitan.github.io/CodeMirror-debug2740/rst.html\nin mode \"rst-base\" it does\nhttp://mgaitan.github.io/CodeMirror-debug2740/rst-base.html\nthe code of these examples are here\nhttps://github.com/mgaitan/CodeMirror-debug2740/tree/gh-pages\nthe lib is 4.6.2\n. how silly of me! thank you very much,\n. ",
    "jjrambo": "Silly of me too. Thanks for your help.\nOn 09/29/2014 11:00 PM, Mart\u00edn Gait\u00e1n wrote:\n\nhow silly of me! thank you very much,\n\u2014\nReply to this email directly or view it on GitHub \nhttps://github.com/codemirror/CodeMirror/issues/2740#issuecomment-57264459.\n. \n",
    "arrbie": "We are still waiting for the \"I beam\" cursor to become visible in dark themes. There is a very pale shadow outline, but that is definitely not enough. We would really like a white \"I beam\" cursor. Any progress on this?\n. ",
    "hakantunc": "I was planning extending it to support nesC specific autocompletion but I changed my mind.\nI didn't know it would appear in the pull request. Probably I'll revert it.\n. ",
    "patricktokeeffe": "I just inadvertently discovered the default behavior for Shift+Up/Down is to select from current position to same position on visual (wrapped) line above/below. \nThat is EXACTLY the kind of navigation I'm trying to implement. Which means the default Up/Down behavior is that much more insane. \n. I'm thinking this is wacky not because of CodeMirror itself -- but the combination of CodeMirror in IPython Notebook. \nConsider this chunk from keyboardmanager.js:\njavascript\n        'up' : {\n            help    : '',\n            help_index : '',\n            handler : function (event) {\n                var index = IPython.notebook.get_selected_index();\n                var cell = IPython.notebook.get_cell(index);\n                if (cell && cell.at_top() && index !== 0) {\n                    event.preventDefault();\n                    IPython.notebook.command_mode();\n                    IPython.notebook.select_prev();\n                    IPython.notebook.edit_mode();\n                    var cm = IPython.notebook.get_selected_cell().code_mirror;\n                    cm.setCursor(cm.lastLine(), 0);\n                    return false;\n                } else if (cell) {\n                    var cm = cell.code_mirror;\n                    var cursor = cm.getCursor();\n                    cursor.line -= 1;\n                    cm.setCursor(cursor);\n                    return false;\n                }\n            }\n        },\nThere is also a 'down' handler but no 'shift-up' nor 'shift-down' here. Might explain why I couldn't override Up or Down in extraKeys. I still don't understand why Shift+Up navigates like it does by default but I feel more sane having found this. \n. Based on feedback from IPython folks, I think this is specific to IPython. The CodeMirror user manual was helpful pinning down the issue though. Thanks & closing.\n. ",
    "steelbrain": "+1\n. ",
    "toddmcbrearty": "This is a big one\n+1\n. ",
    "pvoznenko": "Thanks for explanation and thanks for project! :)\n. ",
    "lochel": "You are right, there are some copy & paste relicts that should get cleaned up first. \nThis mode is prepared to handle more than just Modelica. I started already implementing support for MetaModelica as well. That\u2019s why I am using the <def> function. But I don\u2019t want to push that changes before the Modelica stuff is working properly.\nI fixed the indention of the when clause, but I am not sure what you mean by the other comments on the indention.\n. Now, all issues you mentioned are fixed.\n. ",
    "akhoury": "/facepalm thanks\n. ",
    "kylefox": "Don't feel bad @akhoury \u2014 I just spent ~2 hours trying to figure out the same problem, and I too had neglected to load the CSS mode. Whoops.\n. ",
    "mleduque": "Nice, I need nothing more.\nThanks.\n. ",
    "liquid2026": "The error happens all the time, when the editor loads and i get content with the code (error only on safari):\nfunction text_update()\n{\n    if(CMeditor)\n    {\n    var v=getval('text');\n    if(CMeditor.getValue() != v)\n    CMeditor.setValue(v);\n    }\n    else\n    getE('text_value').value=getval('text');\n}\n. ",
    "frederickf": "Since diff_match_patch is a dependency, it seems reasonable to me that diff_match_patch would be in the define. That still allows for the flexibility to use the paths config to provide the mapping to the diff_match_patch file. \n. ",
    "multimike77": "There are no errors showing up on the console.\n. ",
    "darealshinji": "To be honest I don't know too much about javascripts. This is basically based off of the Shell script mode. It was written for a different project which uses codemirror and I simply wanted to submit it to upstream.\n. Ooookay? Makefile syntax is actually very simple, much more simple then most of the stuff CM supports. And it's really widespread. Too bad you don't want to support such a common script language.\n. Yeah, the example was really a bit too long.\n. And example file for Debian's rules files.\n. That 'comment' line originates from the Shell script mode. I just left it there.\n. ",
    "wing9405": "@mightyguava I cannot reproduce it in codemirror.net/demo/vim.html, and I found the cause of the difference in the behavior of '%'. In my version of vim.js in CodeMirror, findMatchingBracket is called with one less column value. That is, \n// in $CODEMIRROR/keymap/vim.js\n...\nmoveToMatchedSymbol: function (cm) { \n  ...\n  if (symbol) {\n    var matched = cm.findMatchingBracket(Pos(line, ch-1));\n    return matched.to;\n  } else {\n  ... \n}, \nThat minus one is the cause of the difference. (It does not exist in the current master branch.)\nWe (the development team I belong to) are using a fork of CodeMirror, and it must be the time to merge the latest version once again.\nThank you.\n. ",
    "sdegutis": "Debugging results:\nI get this error:\nUncaught Error: There is no line 136 in the document.\nWhich is apparently triggered by using getLine.\n. When I replace the contents with the word \"hi\" and a single trailing newline (thus literally \"hi\\n\"), I can reproduce this bug, which gives me the error Uncaught Error: There is no line 1 in the document.. If there is no trailing newline, the bug does not happen.\n. ",
    "maxodoble": "Hello,\ni am using latest codemirror and you can reproduce it also with your webpage version:\njust try to copy and paste the following string into the editor (somewhere inside the existing text) at your webpage: http://codemirror.net/mode/rst/index.html\nTeststring: (sorry, i forgot to quoute the backticks in my first posting!):\n:ref:xtest\nthe \"bla bla :math: bla\" problem is harder to trigger, but i stumbled upon this more than once. \n. ",
    "pickhardt": "Depends. What needs to be updated?\n\nSent from my Android.\nOn Sep 16, 2014 2:19 AM, \"Marijn Haverbeke\" notifications@github.com\nwrote:\n\n@pickhardt https://github.com/pickhardt Are you interested in doing\nfurther maintenance on this mode?\n\nReply to this email directly or view it on GitHub\nhttps://github.com/marijnh/CodeMirror/issues/2807#issuecomment-55716915.\n. I see. That could be an annoying bug but thankfully seems pretty uncommon. I going to pass though because I don't have the time and also aren't very familiar with this code anymore.\n. \n",
    "joepie91": "Thanks. Is there a particular place where I can test this patched version, to make sure the issue is resolved?\n. Alright, that seems fixed to me. There are a few more indentation issues (that already existed prior to this patch), but I'm going to try and figure out some more specifics about those before creating tickets.\nI'm not surprised that it's a complicated mode; I've heard complaints in a number of places from people writing CoffeeScript syntax highlighting code and such, about the complexity of writing a correct parser for CoffeeScript. It's somewhat inherent to the language, I suppose. The amount of ambiguous cases in the language probably doesn't make it any easier.\n. ",
    "sanjoypal": "Thanks for the fix. The autoSelfClosers is alphabaticall arranged. Would you please fix that too?\n. ",
    "sangster": "Please see my subsequent commit. \n. Thanks for the chance to take part in such an exciting project.\n. ",
    "pwFoo": "Great to have a textile mode :) \nTested it and for example underline (example: +underline+ ) doesn't work. I looked at Redcloth, but \"+\" should do underlined text as also at http://txstyle.org/ textile demo.\nI use / prefer http://txstyle.org/ so that's my reference g\n. ",
    "ipelovski": "I'm hovering the text (actually the \"@\" which is underlined). I can reproduce it in both Firefox and Chrome.\n. Wow, that was fast. Thank you for the fix.\n. ",
    "amyhua": "Thank you!\n. ",
    "mfarooqi": "@le717  Thanks for proceeding it further. \n. Its simple..until something is not selected or line is empty, copy function shouldn't be functional.. rather only paste should work.. there C and V are so close on keyboard. an unexpected COPY instead of PASTE clears the clipboard.\n. by the way... brackets are puerly for coders.. and in coding by default\nsyntax does have spaces on every next lines...\nRegards\nMuhammad Farooqi\nm.farooqi@skype 92 345 5244 143\nOn Thu, Oct 2, 2014 at 11:39 PM, Triangle717 notifications@github.com\nwrote:\n\n@marijnh https://github.com/marijnh The expected behavior is the\nper-line copy and cut should not act on a blank line. If there is\nwhitespace, then it should act. The code is already working that way except\nfor the two aforementioned lines, d.input.value = lastCopied.join(\"\\n\");\nand d.input.value = text.join(\"\\n\"); which break it by appending a new\nline to the \"selected text\" (nothing), thereby creating this bug\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/2824#issuecomment-57680622\n.\n. are you a follower of Sublime?.. I'm sure not.. but  what all other great\nsystems do. I used first sublime.. but just because of this issue I quit\nusing sublime... and moved to adobe Code CC.. That was a great app. in fact\nthat is.. But some extensions were not supported by Adobe Code CC.. .And a\nguy in Adobe told me to go with Brackets.. This Code CC is a same build but\nBrackets is updated.. And when I started Brackets.. I had this issue.. I\ndon't know whether it's a bug or not.. but it is not in Adobe Code CC..\n\nI'm currently working on an html5 ONE page application with 4000+ line of\ncode.. If i need to copy a function... I select that.. Copy it... and on\nany next lines.. paste it.. and accidently press Option+C instead of\nOption+V .. all selection gone..  I then again need to search.. what I had\ncopied..\nIt's not a bug.. then it's not a feature too...\nRegards\nMuhammad Farooqi\nm.farooqi@skype 92 345 5244 143\n. check out this please ... https://github.com/adobe/brackets/issues/9311\n. only that much text is enough that could make page scrollable.. either\nhorizontal or vertical. .even blank enters produces this effect.\nRegards\nMuhammad Farooqi\nm.farooqi@skype 92 345 5244 143\nOn Tue, Oct 28, 2014 at 6:50 PM, Marijn Haverbeke notifications@github.com\nwrote:\n\nHave you been able to reproduce this? Any idea what the minimal HTML that\ntriggers the problem is?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/2897#issuecomment-60757520\n.\n. @dangoor. I'm sorry if I couldn't get what exactly do you mean by CodeMirror Page. I'm a chrome user, If you mean to see online editors then it is working perfectly fine over there. But See the following lines maybe the result is changed because of update.\n\nOne more thing to update: \nI updated my OS to Yosemite 10.10 Two days back. Now here in new OSX Brackets's scrollbars are not blinking. I think there must be something wrong with the OSX Mavericks, even the latest one. 10.9.5.\nAnd Now I found another thing wrong with Brackets 0.44.  Do I post as a new issue?.\n. @dangoor . .i\"m installing Mavericks on VirtualBox. I'll update you once that is installed. \n. ",
    "le717": "@marijnh The expected behavior is the per-line copy and cut should not act on a blank line. If there is whitespace, then it should act. The code is already working that way except for the two aforementioned lines, d.input.value = lastCopied.join(\"\\n\"); and d.input.value = text.join(\"\\n\"); which break it by appending a new line to the \"selected text\" (nothing), thereby creating this bug\n. ",
    "muxahuk": "fixed. Forgot to add mode that requires php to work.\n. > Depends on XML, JavaScript, CSS, HTMLMixed, and C-like modes\n. ",
    "ADangl": "The editor is instantiated with a simple CodeMirror.fromTextArea call.\nWhen the user cancelles the operation immediately before the editor is fully loaded, the text area is destroyed.\nWithout the try catch in compensateForHScroll() the user gets the script error 'Client Error: Script Error: \"Unspecified error.\"'\nWith the try catch in compensateForHScroll() we cannot reproduce this and any other script error.\nThis is the call stack of the script error:\nMain page\n\ncompensateForHScroll, codemirror.js, line 544\n    getDimensions, codemirror.js, line 732\n    DisplayUpdate, codemirror.js, line 560\n    endOperation_R1, codemirror.js, line 2031\n    endOperations, codemirror.js, line 2012\n    endOperation, codemirror.js, line 2003\n    runInOp, codemirror.js, line 2141\n    operation, codemirror.js, line 4427\n    updateInViewport, foldgutter.js, line 88\n    Anonymous function, foldgutter.js, line 113\nIm am using CodeMirror 4.6\n. \n",
    "Vadorequest": "@marijnh Is there any workaround for this?\nWe are running into the same issue on IE11.\nhttps://cloud.githubusercontent.com/assets/14806310/18201769/492a88f8-710c-11e6-88f9-47402b34eb0f.png\n. ",
    "dobos": "I'm getting the same error when using a codemirror form inside an asp.net UpdatePanel. I need to resize the codemirror panel when the (partial) page is loaded, so I register an ajax event:\nvar prm = Sys.WebForms.PageRequestManager.getInstance();\n        prm.add_pageLoaded(Function.createDelegate(this, this.init));\nAnd the init function looks like this:\nthis._codeMirror.setSize(this._width, this._height);\n_width and _height are both 100%\nI'll try to strip the page down to minimum but it's unlikely I'll have time to create a stand-alone reproduction that doesn't use asp.net and update panel.\nEDIT: after playing around a little bit: when I put the codemirror outside the UpdatePanel it works, so it's likely that the browser recreates the codemirror object on a partial page update but certain variables point to a destroyed instance of codemirror.\n. ",
    "bobthecow": "No problem. Thanks for the merge!\n. ",
    "i-tu": "Good question. I made this CodePen to investigate: http://codepen.io/anon/pen/DGmoc . It would seem to work on Chrome and Safari. (note, Hasklig needs to be installed for this to work: https://github.com/i-tu/Hasklig/blob/master/target/Hasklig-Regular.otf?raw=true)\n. If the Hasklig font is installed (from here: https://github.com/i-tu/Hasklig/blob/master/target/Hasklig-Regular.otf?raw=true), you should see something like this:\n\n. I tried for a while, but wasn't able to embed the font. FontSquirrel claims the file is corrupt and inline base64 encoding doesn't seem to work either, nor a direct link to the font file on a server. I must be doing something wrong, but I don't know what.\n. Ok, that sounds fair enough.\n. ",
    "jgors": "any update on having a vim style leader key implemented?. ",
    "antonmedv": "I do not suggest using images for emoji. Mac OS already support it (press ctrl\u2303 + cmd\u2318 + space).\nIt will be cool to insert unicode symbol in editor :+1: \n. I'd like to insert emoji with this: \n\nSo a can programing on Swift :smiley: \n\n. ",
    "dborowitz": "I used a slightly incomplete URL where I got the code block from, the full URL is https://ceres-solver.googlesource.com/ceres-solver/+/b7d321f505e936b6c09aeb43ae3f7b1252388a95/docs/source/faqs.rst\n. That changes the stack trace but doesn't fix it:\nUncaught AssertException: undefined rst.js:79\nassert rst.js:79\nto_normal rst.js:279\ntoken rst.js:552\ntoken overlay.js:38\nprocessLine codemirror.js:4552\n(anonymous function) codemirror.js:984\nwindow.CodeMirror.LeafChunk.iterN codemirror.js:4874\nwindow.CodeMirror.BranchChunk.iterN codemirror.js:4964\nwindow.CodeMirror.BranchChunk.iterN codemirror.js:4964\nwindow.CodeMirror.createObj.iter codemirror.js:4996\ngetStateBefore codemirror.js:983\ngetLineStyles codemirror.js:4540\nbuildLineContent codemirror.js:4592\nmeasureLineWidth codemirror.js:1168\nendOperation codemirror.js:1396\n(anonymous function) codemirror.js:1455\nCodeMirror codemirror.js:77\nCodeMirror codemirror.js:48\nwindow.CodeMirror.CodeMirror.fromTextArea codemirror.js:3769\n(anonymous function) test.html:325\nNew complete test file:\n```\n\n\n\n\n\n\n\n\n\n\n  <!--\n    The following code block is from:\n    https://ceres-solver.googlesource.com/ceres-solver/+/b7d321f505e936b6c09aeb43ae3f7b1252388a95/docs/source/faqs.rst\n    and is available under the following license:\nCeres Solver - A fast non-linear least squares minimizer\nCopyright 2010, 2011, 2012 Google Inc. All rights reserved.\nhttp://code.google.com/p/ceres-solver/\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n* Redistributions of source code must retain the above copyright notice,\n  this list of conditions and the following disclaimer.\n* Redistributions in binary form must reproduce the above copyright notice,\n  this list of conditions and the following disclaimer in the documentation\n  and/or other materials provided with the distribution.\n* Neither the name of Google Inc. nor the names of its contributors may be\n  used to endorse or promote products derived from this software without\n  specific prior written permission.\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\nAND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\nARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE\nLIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\nCONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\nSUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\nINTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\nCONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\nARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\nPOSSIBILITY OF SUCH DAMAGE.\n\n-->\n  .. _chapter-tricks:\n===================\nFAQS, Tips & Tricks\n===================\nAnswers to frequently asked questions, tricks of the trade and general\nwisdom.\nBuilding\n. Use google-glog &lt;http://code.google.com/p/google-glog&gt;_.\nCeres has extensive support for logging detailed information about\n   memory allocations and time consumed in various parts of the solve,\n   internal error conditions etc. This is done logging using the\n   google-glog &lt;http://code.google.com/p/google-glog&gt; library. We\n   use it extensively to observe and analyze Ceres's\n   performance. google-glog &lt;http://code.google.com/p/google-glog&gt;\n   allows you to control its behaviour from the command line flags\n   &lt;http://google-glog.googlecode.com/svn/trunk/doc/glog.html&gt;_. Starting\n   with -logtostdterr you can add -v=N for increasing values\n   of N to get more and more verbose and detailed information\n   about Ceres internals.\nIn an attempt to reduce dependencies, it is tempting to use\n   miniglog - a minimal implementation of the glog interface\n   that ships with Ceres. This is a bad idea. miniglog was written\n   primarily for building and using Ceres on Android because the\n   current version of google-glog\n   &lt;http://code.google.com/p/google-glog&gt;_ does not build using the\n   NDK. It has worse performance than the full fledged glog library\n   and is much harder to control and use.\nModeling\n. Use analytical/automatic derivatives.\nThis is the single most important piece of advice we can give to\n   you. It is tempting to take the easy way out and use numeric\n   differentiation. This is a bad idea. Numeric differentiation is\n   slow, ill-behaved, hard to get right, and results in poor\n   convergence behaviour.\nCeres allows the user to define templated functors which will\n   be automatically differentiated. For most situations this is enough\n   and we recommend using this facility. In some cases the derivatives\n   are simple enough or the performance considerations are such that\n   the overhead of automatic differentiation is too much. In such\n   cases, analytic derivatives are recommended.\nThe use of numerical derivatives should be a measure of last\n   resort, where it is simply not possible to write a templated\n   implementation of the cost function.\nIn many cases it is not possible to do analytic or automatic\n   differentiation of the entire cost function, but it is generally\n   the case that it is possible to decompose the cost function into\n   parts that need to be numerically differentiated and parts that can\n   be automatically or analytically differentiated.\nTo this end, Ceres has extensive support for mixing analytic,\n   automatic and numeric differentiation. See\n   :class:NumericDiffFunctor and :class:CostFunctionToFunctor.\n. Putting `Inverse Function Theorem\n<http://en.wikipedia.org/wiki/Inverse_function_theorem>`_ to use.\nEvery now and then we have to deal with functions which cannot be\n   evaluated analytically. Computing the Jacobian in such cases is\n   tricky. A particularly interesting case is where the inverse of the\n   function is easy to compute analytically. An example of such a\n   function is the Coordinate transformation between the ECEF\n   &lt;http://en.wikipedia.org/wiki/ECEF&gt; and the WGS84\n   &lt;http://en.wikipedia.org/wiki/World_Geodetic_System&gt; where the\n   conversion from WGS84 from ECEF is analytic, but the conversion\n   back to ECEF uses an iterative algorithm. So how do you compute the\n   derivative of the ECEF to WGS84 transformation?\nOne obvious approach would be to numerically\n   differentiate the conversion function. This is not a good idea. For\n   one, it will be slow, but it will also be numerically quite\n   bad.\nTurns out you can use the Inverse Function Theorem\n   &lt;http://en.wikipedia.org/wiki/Inverse_function_theorem&gt;_ in this\n   case to compute the derivatives more or less analytically.\nThe key result here is. If :math:x = f^{-1}(y), and :math:Df(x)\n   is the invertible Jacobian of :math:f at :math:x. Then the\n   Jacobian :math:Df^{-1}(y) = [Df(x)]^{-1}, i.e., the Jacobian of\n   the :math:f^{-1} is the inverse of the Jacobian of :math:f.\nAlgorithmically this means that given :math:y, compute :math:x =\n   f^{-1}(y) by whatever means you can. Evaluate the Jacobian of\n   :math:f at :math:x. If the Jacobian matrix is invertible, then\n   the inverse is the Jacobian of the inverse at :math:y.\nOne can put this into practice with the following code fragment.\n.. code-block:: c++\n  Eigen::Vector3d ecef; // Fill some values\n  // Iterative computation.\n  Eigen::Vector3d lla = ECEFToLLA(ecef);\n  // Analytic derivatives\n  Eigen::Matrix3d lla_to_ecef_jacobian = LLAToECEFJacobian(lla);\n  bool invertible;\n  Eigen::Matrix3d ecef_to_lla_jacobian;\n  lla_to_ecef_jacobian.computeInverseWithCheck(ecef_to_lla_jacobian, invertible);\n\n. When using Quaternions, use :class:QuaternionParameterization.\nTBD\n. How to choose a parameter block size?\nTBD\nSolving\n. Choosing a linear solver.\nWhen using the TRUST_REGION minimizer, the choice of linear\n   solver is an important decision. It affects solution quality and\n   runtime. Here is a simple way to reason about it.\n\n\nFor small (a few hundred parameters) or dense problems use\n      DENSE_QR.\n\n\nFor general sparse problems (i.e., the Jacobian matrix has a\n      substantial number of zeros) use\n      SPARSE_NORMAL_CHOLESKY. This requires that you have\n      SuiteSparse or CXSparse installed.\n\n\nFor bundle adjustment problems with up to a hundred or so\n      cameras, use DENSE_SCHUR.\n\n\nFor larger bundle adjustment problems with sparse Schur\n      Complement/Reduced camera matrices use SPARSE_SCHUR. This\n      requires that you have SuiteSparse or CXSparse\n      installed.\n\n\nFor large bundle adjustment problems (a few thousand cameras or\n      more) use the ITERATIVE_SCHUR solver. There are a number of\n      preconditioner choices here. SCHUR_JACOBI offers an\n      excellent balance of speed and accuracy. This is also the\n      recommended option if you are solving medium sized problems for\n      which DENSE_SCHUR is too slow but SuiteSparse is not\n      available.\nIf you are not satisfied with SCHUR_JACOBI's performance try\n  CLUSTER_JACOBI and CLUSTER_TRIDIAGONAL in that\n  order. They require that you have SuiteSparse\n  installed. Both of these preconditioners use a clustering\n  algorithm. Use SINGLE_LINKAGE before CANONICAL_VIEWS.\n\n\n. Use Solver::Summary::FullReport to diagnose performance problems.\nWhen diagnosing Ceres performance issues - runtime and convergence,\n   the first place to start is by looking at the output of\n   Solver::Summary::FullReport. Here is an example\n.. code-block:: bash\n ./bin/bundle_adjuster --input ../data/problem-16-22106-pre.txt\n\n iter      cost      cost_change  |gradient|   |step|    tr_ratio  tr_radius  ls_iter  iter_time  total_time\n    0  4.185660e+06    0.00e+00    2.16e+07   0.00e+00   0.00e+00  1.00e+04       0    7.50e-02    3.58e-01\n    1  1.980525e+05    3.99e+06    5.34e+06   2.40e+03   9.60e-01  3.00e+04       1    1.84e-01    5.42e-01\n    2  5.086543e+04    1.47e+05    2.11e+06   1.01e+03   8.22e-01  4.09e+04       1    1.53e-01    6.95e-01\n    3  1.859667e+04    3.23e+04    2.87e+05   2.64e+02   9.85e-01  1.23e+05       1    1.71e-01    8.66e-01\n    4  1.803857e+04    5.58e+02    2.69e+04   8.66e+01   9.93e-01  3.69e+05       1    1.61e-01    1.03e+00\n    5  1.803391e+04    4.66e+00    3.11e+02   1.02e+01   1.00e+00  1.11e+06       1    1.49e-01    1.18e+00\n\n Ceres Solver v1.10.0 Solve Report\n ----------------------------------\n                                      Original                  Reduced\n Parameter blocks                        22122                    22122\n Parameters                              66462                    66462\n Residual blocks                         83718                    83718\n Residual                               167436                   167436\n\n Minimizer                        TRUST_REGION\n\n Sparse linear algebra library    SUITE_SPARSE\n Trust region strategy     LEVENBERG_MARQUARDT\n\n                                         Given                     Used\n Linear solver                    SPARSE_SCHUR             SPARSE_SCHUR\n Threads                                     1                        1\n Linear solver threads                       1                        1\n Linear solver ordering              AUTOMATIC                22106, 16\n\n Cost:\n Initial                          4.185660e+06\n Final                            1.803391e+04\n Change                           4.167626e+06\n\n Minimizer iterations                        5\n Successful steps                            5\n Unsuccessful steps                          0\n\n Time (in seconds):\n Preprocessor                            0.283\n\n   Residual evaluation                   0.061\n   Jacobian evaluation                   0.361\n   Linear solver                         0.382\n Minimizer                               0.895\n\n Postprocessor                           0.002\n Total                                   1.220\n\n Termination:                   NO_CONVERGENCE (Maximum number of iterations reached.)\n\nLet us focus on run-time performance. The relevant lines to look at\n  are\n.. code-block:: bash\n Time (in seconds):\n Preprocessor                            0.283\n\n   Residual evaluation                   0.061\n   Jacobian evaluation                   0.361\n   Linear solver                         0.382\n Minimizer                               0.895\n\n Postprocessor                           0.002\n Total                                   1.220\n\nWhich tell us that of the total 1.2 seconds, about .3 seconds was\n  spent in the linear solver and the rest was mostly spent in\n  preprocessing and jacobian evaluation.\nThe preprocessing seems particularly expensive. Looking back at the\n  report, we observe\n.. code-block:: bash\n Linear solver ordering              AUTOMATIC                22106, 16\n\nWhich indicates that we are using automatic ordering for the\n  SPARSE_SCHUR solver. This can be expensive at times. A straight\n  forward way to deal with this is to give the ordering manually. For\n  bundle_adjuster this can be done by passing the flag\n  -ordering=user. Doing so and looking at the timing block of the\n  full report gives us\n.. code-block:: bash\n Time (in seconds):\n Preprocessor                            0.051\n\n   Residual evaluation                   0.053\n   Jacobian evaluation                   0.344\n   Linear solver                         0.372\n Minimizer                               0.854\n\n Postprocessor                           0.002\n Total                                   0.935\n\nThe preprocessor time has gone down by more than 5.5x!.\nFurther Reading\nFor a short but informative introduction to the subject we recommend\nthe booklet by [Madsen] . For a general introduction to non-linear\noptimization we recommend [NocedalWright]. [Bjorck] remains the\nseminal reference on least squares problems. [TrefethenBau] book is\nour favorite text on introductory numerical linear algebra. [Triggs]_\nprovides a thorough coverage of the bundle adjustment problem.\n\n    var rsteditor = CodeMirror.fromTextArea(document.getElementById(\"rstexample\"), {mode: \"text/x-rst\"});\n  \n\n\n```\n. ",
    "rschroll": "Thanks for the quick fix!\n. ",
    "plafue": "Oh, you are totally right, i oversaw that (in all fairness, it's an undocumented feature hidden in line 364 :D). I will close this request. Thank you very much for taking the time in answering, though! \n. ",
    "abdelouahabb": "oh, thank you :+1: \ntornado is powered by friendfeed (facebook), it is a webserver that beats the 10k problem, it has a simple-yet-powerful templates engine!\nthank you again :)\n. i just cleaned the list, and ordered them by alphabet,\ni created the pull.\n. sorry, i just learned how to do that, my apologizes.\neverything is okey now.\nsorry again.\n. got it, thank you again, and sorry again :+1: \n. for the moment I use this trick:\nhttps://github.com/abdelouahabb/CodeMirror/commit/521c476de9b8a961a3205e7284863de88d012a96\n. ",
    "rgbkrk": "Very much so, thank you! The IPython project uses both codemirror and tornado extensively.\n. Just to note on how to do this (for those ending up here via google), some quick tips:\n\nonly require('codemirror') as well as codemirror addons in componentDidMount\ncheck out bin/highlight.js (here in this repo) -- it can be adapted for server side rendering\ncodemirror css does need to be loaded globally\n\nHappy hacking and consider donating to @marijnh for the ever-so-excellent CodeMirror.. Thank you. CodeMirror is so excellent, and I'm ever so delighted the more I dig into the extension points available.\n. I'm happy coding it up, I'm mostly unsure about how to access search across each instance. I suppose I need to look at this as if it's a new addon, following on from codemirror/addon/search/search?\n. Thank you!. ",
    "willy-vvu": "You're welcome! I'm a big fan of CodeMirror, and it feels great to give back to the community - even with this minuscule addition. I'm looking forward to seeing this change propagate to Brackets, so that when I type my next @, it won't turn red.\n. ",
    "dannyhope": "Cheers @marijnh I\u2019ll let @rem know about that\n. ",
    "herkulano": "The color is not the same as the original (http://chriskempson.github.io/base16/ you can see it in the \"hello\" line). \nimho the color is a usability problem, as it's hard to tell what is selected.\n. ",
    "ksiegel": "There seems to be another layer of oddness to this. I've gotten the same results as you in that file, but still the same results as before for in my implementation.\nIn trying to duplicate this on small scale, I've learned that running cm.refresh() resolves it - but that doesn't fix any underlying symptoms that might or might not exist, or other ways that it may manifest itself.\nNow, this is from just meddling around in the sample, I've found that the following can duplicate this issue in Chrome 37, Firefox 32 and IE 11. Hiding and displaying the parent div is not what I'm doing in my implementation, but I threw it in this sample because it's easy DOM manipulation that does demonstrate the issue. My implementation animates neighboring elements - an accordion-styled list. Apparently somewhere in the browser it ends up manipulating CM's parent element somehow, but nowhere in my code do I tell it to manipulate CM's parent - nor do I have easy access to call .refresh() from within those manipulations. I know you're thinking we can blame jQueryUI - I thought that too - but I mean, the issue still doesn't exist pre- e72560b \n```\n\nfunction calculateBuildingPermitFee (data){\n    var buildingPermitFee = 12 * Math.ceil(data.costTotal/1000) + 25;\n    return -buildingPermitFee;\n}\n\n  var codeTextarea = document.getElementById(\"code\");\n  var editor = CodeMirror.fromTextArea(codeTextarea, {\n    lineNumbers: true,\n    matchBrackets: true,\n    continueComments: \"Enter\",\n    extraKeys: {\"Ctrl-Q\": \"toggleComment\"}\n  });\n\n  codeTextarea.parentElement.style.display = 'block';\n  // editor.refresh(); // See below - a dirty way to force the issue to be shown without refresh() accidentially fixing said issue\n  editor.execCommand('goDocEnd');\n\n```\nI suppose this issue might as well be renamed to Cursor hides/skips lines containing \"Math.ceil,\" but not \"Math.max\" after certain DOM manipulations, if you see fit\n. Fair enough.. but I still think it's funny it only happens after e72560b. Perhaps someone in the future will find a way of duplicating it/something similar when not using DOM manipulations. Until then, .refresh() it shall be! \nThanks again for your time, I do appreciate it! \n. ",
    "raine": "This is the version of CodeMirror the fiddle uses:\nhttp://cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/codemirror.js\nLatest npm release of CM is where I initially encountered this problem.\n. Cheers! Somehow missed that one while searching for vim issues, sorry for the noise.\n. ",
    "mustafa0x": "I'm testing the (now old) direction branch briefly, and bidi still seems to be badly broken.\nFor example, the cursor's behavior when it reaches the end or beginning of a line (while holding down the left or right arrow key) is very erratic. Without \"use visual order\" it seems to behave more sensibly, but the order is switched.. Ah, ok.\nThe issue is present in master as well.. ",
    "kerabromsmu": "Cool! I wish adding function and macro calls ware as simple. Trying to\nfigure out.\nOn Mon, Oct 20, 2014 at 1:35 AM, Marijn Haverbeke notifications@github.com\nwrote:\n\nThanks. Merged as 4bd6fea\nhttps://github.com/codemirror/CodeMirror/commit/4bd6fea3753c16448d291257cd565269849e6b5f\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/2880#issuecomment-59666680\n.\n. I've created another pull request -- with factor.js and index.html. This one turned out to be glitchy.\n. Thanks!! I was trying to do that, but didn't find how. ;]\n. Yep, you're right. I had to do it to make it work in adobe brackets. Turns\nout they don't load the simple mode, and the way they let you load the\nmodules, I cannot use it. So I had to emulate it.\n\nActually, I made an extension for brackets that uses the same code and just\nupdated it here to match that one for consistency. Not only consistency,\nbut that too.\nNot sure what you can do about it.\nOn Jun 11, 2015 11:52, \"Marijn Haverbeke\" notifications@github.com wrote:\n\nWoah, you basically reimplemented the simple mode addon. What limitation\ndid you run into, precisely? And would it make sense to extend the simple\nmode addon instead?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3312#issuecomment-111045762\n.\n. Actually, I don't remember. Probably I did, but still went for a quicker\nsolution, because otherwise I would have to wait for the next version of\nbrackets to release. I'll check anyway\nOn Jun 11, 2015 13:17, \"Marijn Haverbeke\" notifications@github.com wrote:\nHave you tried opening an issue for Brackets to load the simple-mode addon\nby default? It is tiny, and a bunch of modes are using it, so they may be\nopen to that.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3312#issuecomment-111077475\n.\n. Sorry - I was sure I was using the simple mode. Fixed it now. The patch improves the coloring - it includes more cases where coloring would make sense.. It's actually improved on line 26 in the new version. In Factor, there are several words that define strings. One of them is just a quote (\"). The others are words ending in a quote, which is reflected as /\\S*?\"/. . This requires a bit of explanation of the language. Factor is a sort of a modern incarnation of Forth. It has no punctuation. In fact, there are no keywords either, but some words fit better as keywords when you want to make more sense of the program. For the most part, those are the defining words - they parse the compiler input. And, Factor allows any symbols in the words except whitespace. And so, many words in standard Factor library look like puntuation or include punctuation. Parentheses in particular denote the \"stack effect\", which hints the compiler on the state of the stack before and after calling the defined word.. I'll just remove this and only leave the dot. Must have been some workaraound for some silly mistake I made while doing this, which is already fixed.. It looks like punctuation is the same color as identifiers. This doesn't really help read this code. It would be better to visually separate stack effect in some way. Btw, can I find a list of all defined token styles (comment, meta, variable etc.) somewhere?. Thank you! Changed the parantheses and \"--\" to \"bracket\", stack items to \"meta\".. So, is it good to go now?. \n",
    "nightwing": "@mightyguava added tests.\ngUgU doesn't work, but i am not sure how to fix that, perhaps check at https://github.com/nightwing/CodeMirror/blob/vim-gUgu/keymap/vim.js#L986 needs to be moved to the input handling stage.\n. @mightyguava @marijnh would you consider adding api to allow external code to add options like these? e.g by allowing to pass setter and getter functions to CoedMirror.Vim.defineOption\n. Looks good, i couldn't find any serious bugs, just have several small notes\n- in visual mode when moving to a shorter line, cursor is not visible\n- vim.lastHPos and vim.lastHSPos are part of selection model as well. Since most of selection variables are on vim I think it makes more sense to have vim.head vim.anchor instead of vim.sel.head and vim.sel.anchor. \n- if we have vim.head it would be better to not add _head parameter to all motions which can use vim.head instead.\n- handling of vim.lastHPos seems to be flaky in general. e.g try double clicking at the middle of a word, press up and press down. (but this is probably broken in previous version too)\n. In vim vip switches to visual-line mode, but i couldn't find a way to do that here.\nIf cursor is on a single empty line between two paragraphs, vip should only switch to visual-line mode without selecting the next paragraph, and Vip should select next paragraph. Commented text is for vip which now behaves same as Vip.\nI thought this is not very important, but I just now realized that ip not being linewise motion is a bigger problem, since it breaks things like yipP as well.\n. True, i was just trying to make the smallest change possible. Updated patch might be better.\n. This is caused by toUpperCase function behaving differently on chrome and firefox.\nThe \u0587 (\\u0587) character is a word character, but it doesn't have uppercase and is written as two characters at the start of the word (\u0535\u057e or \u0535\u0552). toUpperCase returns  \u0535\u0552 on Chrome and \u0587 on firefox.\n. Technically not recognising \\u0587 as a word character is a bug and correct solution would be to add  it to nonASCIISingleCaseWordChar regex, but since it's unlikely to affect many people, just replacing it in the test with any other word character is fine too.\n. It is possible to set clipboard content when editor is used in an nw.js app or on a site with a chrome extenison installed. So this feature might be useful to a sizable group of users.\n. @mightyguava are there any registers other than * that users might need to override?\n. :imap jk <Esc> works\n. It depends on the way esc is written:  <Esc> works, but other forms like <ESC> or <esc> do not\n. This is likely related to keyboard layout. di] works with qwerty\n. Vim doesn't allow unmaping default bindings (see vim.wikia.com). \nBy default when there are conflicting keys like in the example above vim waits for a short while to decide if sequence was finished or not which http://stackoverflow.com/questions/14737429/how-to-disable-the-timeout-on-the-vim-leader-key but this can be disabled. When timeout option is disabled vim always picks the longest sequence.\nThe behavior change between 4.6 and 4.7 was caused by a change in  commandMatches to returns all matches instead of stopping after the first one.\nRemoving  defaultKeymap[i].user check from unmap is probably not a very good long term solution, since that will make support for noremap impossible.\n. This is an intentional deviation from vim default see https://github.com/codemirror/CodeMirror/issues/2643.\nY is equivalent to y$ which is not a linewise motion. yy works like Y in vim\n. Sorry, missed a line from commit, tests pass now.\n. Do you know why p text object is inconsistent with behavior of { and  }?\nIn Ace i have changed function isEmpty(i) { return !cm.getLine(i); } to  function isEmpty(i) { return !/\\S/.test(cm.getLine(i)); }, but that changes the behavior of { as well.. @mightyguava when pressing shift-Enter handleKeyPress calls handleKey with \\r as key name, after which keysMatcher is always null since . doesn't match \\r.\n. this checks for e.ctrlKey twice\n. Visual mode selection is empty on empty lines. And visualBlock selection can be empty when clipped to a shorter line.\n. It might be nicer to not throw here, since there is no way to clear defined register, and it's not very likely for someone to override register by accident anyway.\n. ",
    "makerimages": "Will try, thanks a lot! :) Have to figure out how to append this with jQuery though.... WHich seems impossible... do you offer any afterwards appending options @marijnh ?\n. ",
    "jmcphers": "I can't repro in a vanilla textarea, not sure what's different about CodeMirror's usage that triggers this bug. Incidentally, older versions of the ACE editor are similarly broken in Safari 8.\n. ",
    "dinotao": "Same problem on Mavericks Safari 7\n. ",
    "baoshan": "Came across the problem in Yosemite / Safari 8. It's easy to reproduce (in the homepage's demo):\n1: Cmd + A\n2: Enter (2 lines)\n3: Cmd + A (2 lines)\n4: Cmd + X (1 line)\n5: Cmd + A (this one is optional)\n6: Cmd + V (3 lines, should be 2 lines)\n. Thanks @marijnh for explaining the internal.\nThe \"changes\" event seems to be my rescue.\n. My intuition here was if the inputRead event is designed as an analogue to the input event on an input or textarea tag, that should also be fired on backspace.\nPlease correct me if inputRead is not an equivalent to input.\n. I also noticed the position of the popup widget slightly shifts (horizontally) while I types.\n. I screencasted my operation with a dom inspector opened. I can see the left of the popup changes from 456.615px to 456px.\nPlease let me know if I should setup a live version for your convenience.\n\nThanks.\n. I setup a live version here.\nTry to change the label to ABC Classics and see if you can catch it.\nThanks.\n. Forget to mention that happens in Safari, not Chrome, to me.\n. Another phenomenon I noticed:\nWhen using asynchronous hinting function, type two characters very fast, e.g. AB.\nThe add on doesn't call the hint function the when you press B because the 1st call to the hinting function hasn't called back yet. Which will lead to wrong hinting results be shown. (Apple in the popup list, while the input text is AB indeed)\nPlease let me know what I missed to implement a correct asynchronous hinting feature.\nP.S. Could the add-on handle racing in XHRs and shows only the correct popup list? Or XHR racing should be handled by myself?\n. I diffed https://raw.githubusercontent.com/codemirror/CodeMirror/master/addon/hint/show-hint.js and http://521.cloudapp.net:3000/css/addon/hint/show-hint.js. They're the same file.\n. Please let me know if my demo can reproduce the racing issue on your machine.\n. I provided the demo at http://521.cloudapp.net:3000. Please let me know if you can't browse it.\n. In case you're interested in the implementation. I stripped down the relative code as:\ncm.on('inputRead', function() {\n            if (cm.state.completionActive) {\n                return;\n            }\n            var hint = function(cm, callback) {\n                var from = get_from();\n                var to = get_to();\n                var uri = get_uri(); // Some calculations here.\n                var req = new XMLHttpRequest();\n                req.onload = function() {\n                    return callback({\n                        from: from,\n                        to: to,\n                        list: JSON.parse(req.responseText)\n                    });\n                };\n                req.open('GET', uri);\n                return req.send();\n            };\n            hint.async = true;\n            return cm.showHint({\n                hint: hint,\n                completeSingle: false,\n                closeCharacters: /$./\n            });\n        });\n. Sounds great! :)\n\nOn Apr 15, 2015, at 3:34 PM, Marijn Haverbeke notifications@github.com wrote:\nThis does indeed seem to be Safari-only -- I can't get it to happen on any other browser. I'm Mac-less at the moment, since my old MacBook died, but there should be a new one on the way, and I'll test when it arrives.\n\u2014\nReply to this email directly or view it on GitHub https://github.com/codemirror/CodeMirror/issues/3166#issuecomment-93240147.\n. Congratulations for the new mac. I have restored the demo.\n\nThanks.\n. I agree with you that any treatment like rounding to a nearest integer is somewhat hacky.\nHave you find a way to prevent racing? Thanks.\n. So we mainly talk about size measuring on this thread. I changed the title accordingly.\n. It seems the simplescroll addon is a good solution.\nCan I use native scroll bar for the desired layout?\nThanks @marijnh .\n. I tried:\n``` css\n.CodeMirror {\n  width       : 816px;\n  margin      : 0 auto;\n}\n.CodeMirror-simplescroll-vertical\n{\n  position   : fixed;\n  right      : 0;\n}\n.CodeMirror-lines {\n  / or apply a border /\n  box-shadow  : 0px 0px 3px rgba(0,0,0,.3);\n}\n```\nAnd it looks fine.\nOne thing left unsolved: I can only scroll in the editor zone, not the whitespace around them.\nAny trap in the above snippet?\n. I'm facing the exactly same issue I guess. Hint not showing due to isNewCompletion. I wonder if @marijnh can kindly explain what the line means:\nif (data && this.data && isNewCompletion(this.data, data)) return;\nWhat's the semantics of a new completion? Why new completions are not shown? The answer may help other potential contributors (me including) better understand the design.\nThanks!. Sorry, will do my own homework next time. But for the concrete case, I mean isNewCompletion here. If I remove the line:\nif (data && this.data && isNewCompletion(this.data, data)) return;\n3849 seems no problem, works well, the autocomplete suggestions move with the cursor & token in the /demo/complete.html. Also my issue and @fwielstra 's issue can be solved. Can you confirm this line still deserves its position?\nThank you and please lead me if I could do more.. Thanks for the patch! Will do my job in case of anything strange.. Thanks for the patch! Will do my job in case of anything strange.. ",
    "mallman": "Just FYI, still broken as of Safari 10.0.3.. ",
    "pyrtsa": "Still an issue in Safari 12.0. Also it seems the bug already happens when copying (not pasting) because I see the same newline in text copied from CodeMirror and pasted elsewhere (in any native text editor).\nFor tracking down this, it might help to know that the extra newline also appears when asking for the current selection in JS Console (Safari):\n\nGo to https://codemirror.net.\nOn the demo editor, select the HTML comment on the first line (past the end of that line).\nShow the JavaScript Console (\u2325\u2318C).\nEnter the command document.getSelection().toString()\n\nExpecting the result to be:\n\"<link rel=\\\"stylesheet\\\" href=\\\"lib/codemirror.css\\\">\n\"\nGetting this result instead:\n```\n\"\n\"\n```. ",
    "colefichter": "Hi, I'd just like to chime in that I'm currently in the exact same position. The Examples on the site don't clearly indicate what needs to be included and the source for the demo files has lots of stuff that isn't obviously related to editing, so again it's unclear exactly what are dependencies to get a simple HTML mode going and what is related to the greater demo page.\nEven something as simple as explanatory comments in the demo pages would help. Or maybe create a basic HTML/JS/CSS demo as suggested above?\nPerhaps even just explain somewhere that \"htmlmixed\" mode doesn't imply that it contains everything to get an html mixed mode environment working? The name suggests that the one extra file should be enough.\n. ",
    "stevebutterworth": "I had the same problem, don't want to use a dependency loader and its really not clear what the dependencies are on htmlmixed mode and the basic examples page is pretty misleading. Shame 'cause once its going its awesome.\n. ",
    "acidhax": "There's no documentation anywhere that explicitly states that we have to load ANY \"mode\" at all. I landed here in search for the fix for htmlMode.startState is not a function, once I read someone say to \"Read the documentation\". Which they meant, look for that one comment that tells you vaguely how to use a project.\nI would suggest reworking the project documentation, in its current state it assumes too much. Give a basic example on Prettying JS and HTML, and people will understand.\n. ",
    "romanenko": "@shrimpwagon, :+1: \nYep, it is not obvious that it is required to include all the dependent libs to use htmlmixed mode, if no module loader is used. And error message is confusing and non-informative.\nI've been looking through docs for some time, until I tried to google for an answer and found this issue.\n. ",
    "brianjenkins94": "I also spent way too long looking for the solution to this problem.\nPlease consider updating the documentation.\nAlternatively you could have codemirror.js report a missing dependency.. ",
    "toetagger": "I dont doubt the fault probably does lie with IE but the manual seems to state use \"var myCodeMirror4 = CodeMirror.fromTextArea(QTA4).\nIf the manual gave the other working format it would be more compatable.\nIf you can show me how the manual format works in ie within a form otherwise I would be happy to see your point of view\n. I get the feeling that I am just misunderstanding what you are saying but this is from the manual.\n\"However, for this use case, which is a common way to use CodeMirror, the library provides a much more powerful shortcut:\nvar myCodeMirror = CodeMirror.fromTextArea(myTextArea);\nThis will, among other things, ensure that the textarea's value is updated with the editor's contents when the form (if it is part of a form) is submitted. See the API reference for a full description of this method.\"\nStraight from the manual. \nIf myTextArea is not the DOM id what is it and how do I use it?\nClicking on the API reference it states: \nCodeMirror.fromTextArea(textArea: TextAreaElement, ?config: object)\nI read this to mean the element by ID.\nIf its a misunderstanding fair enough, but this could be made clearer in the documentation? \nIt also doesnt seem clear to me why this would work in firefox and chrome and not IE if you are saying its wrong\n. ",
    "dvorapa": "Oh sorry, I haven't known about it before. Thank you\n. ",
    "devoncarew": "@marijnh, if I was going to tackle this, what would be the best existing mode to look at as a starting point?\n. Looks like the original PR was against an older version of the repo. I updated it to the latest.\n. > Did you consider simply creating another specialization of the clike mode? Dart's syntax looks pretty C-ish (but I might be missing something).\nI did look at that. I think it would get you pretty far, but I'm not sure it would be able to capture the corner cases. Which to be fair, this current implementation doesn't address, but it's something that could be built on and customized to handle those cases, whereas I'm not sure the clike mode could. Off the top of my head:\n- comments can nest (so, /* /* */ != /* /* */ */)\n- multi line strings are written as '''...''' or \"\"\"...\"\"\"\n- raw string as r'' or r\"\"\n- you have string interpolation, so expressions in strings, that you'd want to color differently (\"foo bar: ${foo.bar()}\")\n\nIn any case, I'm not too keen on having copy-pasted and slightly modified modes like this.\n\nThe d mode seemed like a pretty good template to start with, and then to iteratively customize for Dart support. I'm not sure how else to start a new language file; the modes all seem to share a fair amount of code.\nIn any case, I can start a new PR to investigate the clike mode, but may want to revisit this one.\n. Thanks! I have an implementation working using the clike mode. I'll clean that up in the next day or two and put it out in a PR.\n. Closing this - a Dart mode was landed in https://github.com/codemirror/CodeMirror/pull/2952.\n. I definitely would like to iteratively improve this going forward, to add better support for dart syntax (string interpolation, raw strings, ...). I may not get to that work in the short term however.\nI'll look at refactoring this PR into a separate dart.js mode file.\n. Hmm, looking into it, I'm not sure how a separate dart.js file would reference the clike def(\"application/dart\", {...) function in order to define the clike dart mode.\n. OK, I updated this PR to move the logic from clike.js to mode/dart/dart.js.\n\n. Hmm, I just experimented with ST and it looks like you're right. You can't really go wrong doing what sublime does :) It does strike me as odd though. Perhaps I would only want it to complete based on the left hand side, but when inserting, I'd want it to be aware of and try and match fragments to the right.\nIn any case, I'll close this out.\n. ",
    "gkoberger": "@marijnh honestly, I've never used Objective-C before, and this is my first time working on a \"parser\" like this.\nBased on Googling, it seems you're right. I'll make the change!\n. @marijnh Would it be something like this?\ndef(\"text/x-objectivec\", {\n  name: \"clike\",\n  keywords: words(\"IBAction IBOutlet readwrite readonly nonatomic SEL\" +\n                  \"super self copy if else for in enum while typedef switch case return \" +\n                  \"const static retain\"),\n  builtin: words(\"char bool BOOL double float int long short id void\"),\n  atoms: words(\"YES NO NULL NILL ON OFF\"),\n  hooks: {\n    \"@\": function(stream) {\n      stream.eatWhile(/[\\w\\$_]/);\n      return \"keyword\";\n    },\n    \"#\": cppHook\n  },\n  modeProps: {fold: [\"brace\", \"import\"]}\n});\n. Very worrying :) But we're using CodeMirror for http://readme.io, and I've gotten half a dozen requests. So, I wanted to do something to try to fix this.\nThanks!\n. Thanks.\n. @mkaminsky11 thanks for doing this! :)\n. ",
    "pablopla": "@nournia probably the following commit fixed this issue\nhttps://github.com/codemirror/CodeMirror/commit/25415bfdd31d0212c033822e4fd5ea456d3e6c36\nMaybe you could edit bidi.html or do a short screen capture to show your issue because I'm not sure I understand how to reproduce it.\n. ",
    "jasonzhao3": "Hi @marijnh,  It seems there are still issues with rtl support, such as the mouse cursor and the first space when you typed in the rtl mode. Is there any plan to fix this soon? I'm now integrating codemirror to our code base to replace the old rangy-based highlighter. The cursor really drives me crazy. \nAlso, since you have done lots of work, could you share some thoughts about where the problem may be and how difficult it is to fix it? I can also join you to debug this. :)\n. Also I found if you use arrow key to navigate through words mix of ltr and rtl characters, you will get quite weird behavior -- different from what I tried in a  rtl textarea.\n. ",
    "williamstein": "Yes - that would be a major improvement.\n. I have precisely the same problem with SageMathCloud and users complaining\nabout this.  Maybe a multimode that switches to proper latex on $ would\nwork well enough?\n- William Stein (cell phone)\n  On Nov 24, 2014 11:20 AM, \"Ben Bray\" notifications@github.com wrote:\n\nAh, I see your point. I suppose this is more of a problem specific to the\nuse of CodeMirror on sites that support MathJax. Still, it's interesting to\nme that italic are ignored for single character subscripts in LaTeX but not\nmore than that, which suggests there may be an easy fix to the problem. Any\nchance this can be easily resolved somehow? If not, where in the repo would\nI begin looking if I want to make a contribution of my own?\nThanks!\n\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/2942#issuecomment-64247669\n.\n. On Mon, Nov 24, 2014 at 2:24 PM, Marijn Haverbeke notifications@github.com\nwrote:\nA multiplexing http://codemirror.net/doc/manual.html#addon_multiplex\nmode that switches to the stex mode between $$ markers would be very easy\nto set up, and probably solves your problem\n\nFor what it is worth, here's what I did for SageMathCloud (in coffeescript).\nCodeMirror.defineMode \"gfm2\", (config) ->\n    options = []\n    for x in [['$$','$$'], ['$','$'], ['\\\\[','\\\\]'], ['\\\\(','\\\\)']]\n        options.push\n            open  : x[0]\n            close : x[1]\n            mode  : CodeMirror.getMode(config, 'stex')\n    console.log('gfm2', options)\n    return CodeMirror.multiplexingMode(CodeMirror.getMode(config,\n\"gfm\"), options...)\nIt's really awesome how easy it is to do things like this using\nCodeMirror.\nWilliam\n\nProfessor of Mathematics\nUniversity of Washington\nhttp://wstein.org\n. The workaround I'm using for now is just to revert to the stex.js file from codemirror-4.7.\n. Hi,\nI was using CJSX (the coffeescript analogue of JSX) recently in codemirror,\nand needed syntax highlighting and indent.  I found a mode for Adobe\nBrackets and rewrote it to work in codemirror, and put it here:\nhttps://github.com/sagemathinc/smc-public/blob/master/static/codemirror-5.3/mode/coffeescript2/coffeescript2.js\nAnybody is welcome to it (under the Brackets's MIT license)...\nWilliam\nOn Fri, May 29, 2015 at 12:16 PM, Patrick Costanzo <notifications@github.com\n\nwrote:\n[image: :+1:]\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3122#issuecomment-106906712\n.\n\n\nWilliam (http://wstein.org)\n. On Thu, Jul 2, 2015 at 1:18 PM, Marijn Haverbeke notifications@github.com\nwrote:\n\nThe browser's built-in spell-check doesn't work with the way CodeMirror\nrenders the content. You can integrate something like typo.js, by writing\nglue that uses markText to highlight suspected mistakes and hooking into\nmouse events to show a set of suggestions. Several people have done this\nbut I'm not aware of an open-licensed implementation. This is out of scope\nfor the main project, since the result is always going to be sub-optimal\n(big download, typo.js is often horribly slow) and I don't want to deal\nwith the resulting support requests.\nFor what it is worth... In SageMathCloud (which is open source) spellcheck\nruns a command on the backend server using ispell\n\nhttps://github.com/sagemathinc/smc/blob/fc866b99e74297a3f4f748868680c5c35f2b9e8d/salvus/page/editor.coffee#L2492\nthen highlights all words that are not spelled correctly using a Codemirror\nplugin:\nhttps://github.com/sagemathinc/smc/blob/fc866b99e74297a3f4f748868680c5c35f2b9e8d/salvus/page/misc_page.coffee#L771\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3356#issuecomment-118154370\n.\n\n\nWilliam (http://wstein.org)\n. > We're not taking requests for modes, or even adding new modes to the main distribution in general. You'll have to implement (and distribute) this yourself.\nWould you consider having a page that links to \"community supported modes\"?    Basically, an analogue of https://github.com/primus/primus#community-plugins for codemirror.    For example, I've written modes (for use in https://cocalc.com), and will be writing more.... ",
    "erik-kallen": "If you include CodeMirror on a Bootstrap size, for example, the scrollbars are off.\n. ",
    "rjharmon": "\ninside each of those, lots of these - one for each...?:\n\nparseJs?\n. ",
    "bollwyvl": "Thanks again!\nOn Nov 22, 2014 3:39 AM, \"Marijn Haverbeke\" notifications@github.com\nwrote:\n\nThanks! Merged. Don't worry about small styling changes in obscure modes\nlike this -- the original behavior is unlikely to be very well thought out\nanyway.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/2936#issuecomment-64073622\n.\n. Thanks for the quick reply: in the jsond-ld, the 8 or so \"@context\"-like\nkeywords are substantially different from all other strings... I assumed\nthey would no longer be considered strings, as such. Also, this appears to\nwork on the playground. I don't think this will have any effect on non\njson-ld parsing other than the cost to check the mode.\n\nShould i be checking this after these tokens have been identified as\nstrings... Maybe in tokenbase? I couldn't see how to do this at a higher\nlevel.\nThanks!\nOn Feb 7, 2014 3:38 AM, \"Marijn Haverbeke\" notifications@github.com wrote:\n\nIn mode/javascript/javascript.js:\n\nwhile ((next = stream.next()) != null) {\n     if (next == quote && !escaped) break;\n     escaped = !escaped && next == \"\\\\\";\n   }\n   if (!escaped) state.tokenize = tokenBase;\n-      return ret(\"string\", \"string\");\n-      return type;\n\nWhat was the rationale behind this change? It seems like it'd prevent the\nparser from recognizing strings as atomic expressions.\n\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2229/files#r9532413\n.\n. Or do you mean that i shouldn't call ret until i am ready to return\nbecause of the state of the outer type and content?\n\nSo,\nvar isld = jsonldmode && peek && ...\n...\nReturn isld ? ret(\"jsonld-keyword\", \"meta\") : ret(\"string\", \"string\");\nThanks for the quick reply: in the jsond-ld, the 8 or so \"@context\"-like\nkeywords are substantially different from all other strings... I assumed\nthey would no longer be considered strings, as such. Also, this appears to\nwork on the playground. I don't think this will have any effect on non\njson-ld parsing other than the cost to check the mode.\nShould i be checking this after these tokens have been identified as\nstrings... Maybe in tokenbase? I couldn't see how to do this at a higher\nlevel.\nThanks!\nOn Feb 7, 2014 3:38 AM, \"Marijn Haverbeke\" notifications@github.com wrote:\n\nIn mode/javascript/javascript.js:\n\nwhile ((next = stream.next()) != null) {\n     if (next == quote && !escaped) break;\n     escaped = !escaped && next == \"\\\\\";\n   }\n   if (!escaped) state.tokenize = tokenBase;\n-      return ret(\"string\", \"string\");\n-      return type;\n\nWhat was the rationale behind this change? It seems like it'd prevent the\nparser from recognizing strings as atomic expressions.\n\nReply to this email directly or view it on GitHubhttps://github.com/marijnh/CodeMirror/pull/2229/files#r9532413\n.\n. perhaps bee2d22 makes my intent to affect regular JS parsing as little as possible clearer?\n. \n",
    "icorderi": "Is true, I haven't been able to find all the grammar on a singe place but there is a lot of info on the Rust grammar definition throughout this document.\nI'll be more than happy to help out map that into CodeMirror. \n. I'll ask around tomorrow at the IRC channel. \n. @marijnh I left an issue at Rust's repo, hopefully we get some feedback and volunteers for this.\n. ",
    "eldargab": "Basically, my complain is that selection/cusror heights look a bit narrow to my eyes. I'd like them to be a bit wider.\n\nProbably, if their height would be just equal to the line height, that would be fine.\n. Oh, it turns out it's quite outdate. With recent CodeMirror everything works, thank you.\n. ",
    "lfender6445": "For others looking for same thing try\n```\n.CodeMirror\n{\n  line-height:21px;\n}\n```\n. ",
    "benrbray": "Ah, I see your point.  I suppose this is more of a problem specific to the use of CodeMirror on sites that support MathJax.  Still, it's interesting to me that italic are ignored for single character subscripts in LaTeX but not more than that, which suggests there may be an easy fix to the problem.  Any chance this can be easily resolved somehow?  If not, where in the repo would I begin looking if I want to make a contribution of my own?\nThanks!\n. ",
    "Menci": "@williamstein A bug in your solution is if I type a $ in a inline code or code block, it'll be highlighted as TeX.\nlike\njs\n$('#div').html();\nSee https://github.com/Moeditor/Moeditor/issues/5\nMaybe we can find a way to set the \"priority\" of the marks?\n. So how can I get the correct line heights before the lines are shown? Or I can't?\n. Excuse me, how can we move the # to the left if we only have the first type headings. Thanks.\n. I am so sorry put it in the non-right place, and thanks for the option, I'll try that.\nAnd, could you please tell me where to place support requests like this?\n. ",
    "Lanfei": "Get it~\n. ",
    "robertleeplummerjr": "Very good point. I will address it asap.\nOn 4:38AM, Tue, Dec 2, 2014 Marijn Haverbeke notifications@github.com\nwrote:\n\nLooks good. But shouldn't the inner mode, which is currently hard-coded as\nJavaScript, be configurable for when people want to use another language?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/2959#issuecomment-65204496\n.\n. Addressed.  I added a setting: \"bracesMode\", which you simply set to the\nmode of your liking, and the parser handles the rest.\n\nOn Tue, Dec 2, 2014 at 8:00 AM, Robert Plummer <robertleeplummerjr@gmail.com\n\nwrote:\nVery good point. I will address it asap.\nOn 4:38AM, Tue, Dec 2, 2014 Marijn Haverbeke notifications@github.com\nwrote:\n\nLooks good. But shouldn't the inner mode, which is currently hard-coded\nas JavaScript, be configurable for when people want to use another language?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/2959#issuecomment-65204496\n.\n\n\n\nRobert Plummer\n. The setting is optional, and you can see it in use here:\nhttps://github.com/Bovid/CodeMirror/commit/84e3b10926a7fe4ffcf6239b3f217d88d3e4e876#diff-ec10f15d1a98e0907559c3a77e482f4eL94\nOn Tue, Dec 2, 2014 at 10:24 AM, Robert Plummer \nrobertleeplummerjr@gmail.com wrote:\n\nAddressed.  I added a setting: \"bracesMode\", which you simply set to the\nmode of your liking, and the parser handles the rest.\nOn Tue, Dec 2, 2014 at 8:00 AM, Robert Plummer \nrobertleeplummerjr@gmail.com wrote:\n\nVery good point. I will address it asap.\nOn 4:38AM, Tue, Dec 2, 2014 Marijn Haverbeke notifications@github.com\nwrote:\n\nLooks good. But shouldn't the inner mode, which is currently hard-coded\nas JavaScript, be configurable for when people want to use another language?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/2959#issuecomment-65204496\n.\n\n\n\nRobert Plummer\n\n\nRobert Plummer\n. It is the standardization of the tikiwiki language, sort of like an\nupgrade.  So you should really search more for tiki (which you already\nhave).  Here are so more accurate numbers:\nhttps://packagist.org/packages/wikilingo/wikilingo\nOn Thu, Dec 4, 2014 at 4:21 PM, Marijn Haverbeke notifications@github.com\nwrote:\n\nClosed #2965 https://github.com/codemirror/CodeMirror/pull/2965.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/2965#event-202921458.\n\n\nRobert Plummer\n. Also, thank you for your wicked fast attention to detail.\nOn Thu, Dec 4, 2014 at 4:24 PM, Robert Plummer <robertleeplummerjr@gmail.com\n\nwrote:\nIt is the standardization of the tikiwiki language, sort of like an\nupgrade.  So you should really search more for tiki (which you already\nhave).  Here are so more accurate numbers:\nhttps://packagist.org/packages/wikilingo/wikilingo\nOn Thu, Dec 4, 2014 at 4:21 PM, Marijn Haverbeke <notifications@github.com\n\nwrote:\nClosed #2965 https://github.com/codemirror/CodeMirror/pull/2965.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/2965#event-202921458.\n\n\nRobert Plummer\n\n\nRobert Plummer\n. I like the way you think ;).  I'll jump on that asap.\nOn Thu, Dec 4, 2014 at 4:29 PM, Marijn Haverbeke notifications@github.com\nwrote:\n\nThen maybe we shouldn't have two modes? If this parses everything that the\ntiki mode parses, how about we just replace the tiki mode with it? If it\ndoesn't yet, maybe make it so?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/2965#issuecomment-65706971\n.\n\n\nRobert Plummer\n. This language is the same used by Excel, Google Sheets, OpenOffice, LibreOffice, and jQuery.sheet.\n. Yes.  I will take care of all of these requests.  Thanks for being as\nthorough as you are Marijn, you are an awesome developer.\nOn Thu, Dec 11, 2014 at 11:17 AM, Marijn Haverbeke <notifications@github.com\n\nwrote:\nIs the word 'formula' a commonly used term for this language? If not,\nwould it be okay to rename this mode to 'spreadsheet'?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/2976#issuecomment-66643225\n.\n\n\nRobert Plummer\n. Renamed to spreadsheet.\n. Done.\n. Done.\n. Fixed.\n. The idea here was to find a number followed by letters or underscore, which is never acceptable.  I don't believe changing this to \\w+ would allow for that.\n. Done.\n. Fixed.\n. Fixed.\n. It depends on the implementation, the problem with spreadsheet formula language is that there really isn't a \"standard\" like HTML5, for example.  Some do accept this, others do not.  Probably should be a setting to switch this back and forth.\n. ",
    "bikubi": "It works!\nBut, playing around with it, I discovered that\naaa - bbb - ccc - ddd - eee\nis interpreted like\nhtml\naaa <del> bbb </del> ccc <del> ddd </del> eee\n(the highlighting alternates) instead of \naaa \u2014 bbb \u2014 ccc \u2014 ddd \u2014 eee\nor aaa <strong> bbb </strong>\u2026 instead of aaa * bbb *\u2026, respectively. Again, php-textile, textile-js and hobix agree on this.\nAs this predates (and seems to be somewhat independent of) my original issue, should I file a new issue? (I haven't had much github experience yet, sorry!)\n. Yes and yes. I'll try my best to define, due to lack of a proper official definition (?), by example and in agreement with the two mentioned implementations:\n```\n-yesphrase-\n-yes phrase-\n- nophrase -\n-nophrase -\n- nophrase-\n-no phrase -\n- no phrase -\n-no\nphrase-\n```\nDigging further, textile-js and php-textile need surrounding square brackets for \"confusing phrases\":\n-nophrase-*nophrase*\n[-yesphrase-][*yesphrase*]\n[-yesphrase-]*nophrase*\n-nophrase-[*yesphrase*]\n. It works!\nCould you clarify or give an example for \"non-whitespace characters directly inside a phrase\", though?\nOh, and by the way: thank you! :)\n. Ah, yes! Sorry, i got confused by word character vs non-whitespace.\n. I stumbled over another quirk... Dashes get special treatment in textile, so deletion/negative phrases require special treatment, too, I guess. The other prase modifiers should be OK as they do not share characters with any special characters (as ellipses-dots or dimension signs).\nIn a--b c--d, -b c- should not be a phrase, because a\u2014b c\u2014d has higher \"precedence\", as far as I can tell, again referring to the two implementations (and gut feeling - this stems from a real world / production case).\nOpen endashes (a - b) as well as open emdashes (a -- b c -- d) seem fine, but the latter can trigger \"empty\" phrases:\na -- b -- c -- d\nis interpreted as\nhtml\na <del>--</del> b <del>--</del> c -- d\nnote that the last -- in a line remains unaffected, and that this does only affect empty - phrases (** does not trigger an empty phrase).\nPlease tell me if you feel that my findings are too picky, if you need clarification or if i should open a new issue.\n. Yes. (Sorry for taking so long.)\n. ",
    "davazp": "I have restricted keywords to first elements in a list.\nI am going to be using CodeMirror with Common Lisp for a while, so I will send another pull request if I find common false positives.\n. ",
    "jbredeche": "thanks @marijnh!\n. ",
    "elisee": "Awesome, just tested with our operational transform library for real-time collaboration and it now works great :) Thanks!\n. Hey sorry for the lack of an answer. I don't know much about CodeMirror's internals so I thought I'd take a look later and forgot. Thanks for taking care of it!\n. ",
    "sokra": "The error was already fixed by https://github.com/codemirror/CodeMirror/commit/e0326500f0e90f481d998632b7ec25268cf04a74.\n. ",
    "MikeInnes": "Makes sense, thanks for the explanation.\nSublime and Atom seem to have a similar mechanism, and both appear to treat the arrow and subscript-0 as letters \u2013\u00a0i.e. the a and the unicode character both get selected together. That's all I was expecting.\nI couldn't tell you how they determine what characters are letters and not, though. I found it a little surprising but it's not at all a big problem.\n. ",
    "benmosher": "FWIW, I had to cram CodeMirror into a tight space but also allow its children to render overflow. Used overflow: visible !important; to get around the referenced overflow: scroll !important; in c818907. \nI also explicitly set margin-bottom: 0; and margin-right: 0; to negate the negative margins, and that works fine.\nI am using scrollbarStyle: null. Perhaps a future version could update this or add another style (intrinsic size mode?) that has no scrollbars, but instead is intrinsic size. (or maybe I missed a cleaner way to do this?)\nAnyway, overriding the margins on CodeMirror-scroll back to 0 is a fine workaround. Mostly mentioning here in case others arrive here via search engine after seeing only n - 1 displayed in their CM instance. \ud83d\ude05\nThanks!. ",
    "austinpray": "For posterity:\nwe had a dumb css rule\ncss\n.some-container * {\n  box-sizing: border-box;\n}\nThat wreaked havoc on codemirror's margins and such. Set box-sizing back to normal and everything works as expected.. ",
    "rafaelcastrocouto": "I did manage to find how to do it! :laughing: \nThx ... \n. ",
    "xtinec": "In my use case, I preventDefault (e.returnValue=false in the case of IE8) in ondragstart and handle the dragging with some custom behavior. So, I just needed the selection to not clear when drag starts. I modified codemirror.js a bit to allow the drag/drop detection for IE8 and it seems to work.\nAny chance you would consider enabling the feature-detection of drag/drop for IE8?\n. ",
    "charlieroberts": "Just another thank you for this to Gabriel... exactly what I needed.\n. ",
    "gbraad": "Unintentional... has been fixed, but seems it doesn't add this new commit. I'll rebase and make a new pull request instead.\n. ",
    "ioanb7": "@hitsthings You were right. Not only my code is half from local, half from cdn, but moreover there is a different folder structure on the cdn. I decided to request them both from local and it works!\nI don't know if that's a bug because the codemirror library has been included, and the mode has been defined; thus, something must be internally wrong. Anyway, since it's not such a big issue, I will close this.\nThank you so much!\n. ",
    "sandermarechal": "I think the 'blur' event fires before validation. So, why not update the textarea when the user leaves the CM area? Alternatively, update the textarea on a regular interval. Would it be a problem to update the textarea every 1000ms or so? You could expose the update frequency as a configuration option for people who want to tune it.\nThis would also improve interoperability with other JS libraries. If the textarea is kept up-to-date, other scripts can simply get the contents from the textarea instead of having to add special code to read from CM instances.\n. ",
    "SebastianZ": "\nI don't keep open issues for mode requests. I've added regexps to https://github.com/codemirror/CodeMirror/wiki/Mode-wish-list \n\nThanks and sorry for opening the issues. I didn't know about that wiki page.\n\nIf you want a mode, you'll have to write it\n\nI may try myself on it at some point, though I'm not familiar with lexing yet.\nSebastian\n. ",
    "drom": "Great. It works. Sorry for not reading the documentation ;)\nThank you one more time for the tool.\n. Thank you for comments. I have fixed linter errors, added index.html demo and colorforth.css color schema.\n. There are some historical (cultural) reasons behind creating of this colorforth theme for Forth mode.\nI hope to get some involvement form Forth community by doing so. Here is the blog about it: \nhttp://blogs.msdn.com/b/ashleyf/archive/2013/11/02/colorforth.aspx\n. You are right, It is not very good contrast. I have tweaked some colors. Does it look better?\n\nThese are the brightest Red, Green, Yellow I can get.\nI would like to keep different background for compilation and interpretation time.\n. ",
    "pingram3541": "You're right.  This issue is another function that is updating the preview from the cm instance (causing a loop if you will).  Any suggestions for having a cm code view that updates a local preview iframe upon change but also have that same iframe as editable that in return updates the cm as well?\nI think I might try using some kind of flag when the preview is in focus, then the function that updates the preview from the cm changes is held back until the focus is removed.  I'll post back and close this out so others can benefit from this type of setup.  Thanks.\n. My solution was to watch focus/blur events on child iframe window and then toggle a class which indicates I am editing the preview content and while still updating my cm via setValue, I am telling my background function that updates the preview based on cm changes not to fire if that class is present on the iframe.\nOne solution I found was this - https://developer.mozilla.org/en-US/docs/Web/API/document.hasFocus\nBut it seemed more direct to jQuery's on method rather than to continuously check for focus.\nvar previtem = document.getElementById(\"preview\").contentWindow;\n$(previtem).on(\"focus\", function(){\n  $(\"#preview\").addClass(\"editing\");\n});\n$(previtem).on(\"blur\", function(){\n  $(\"#preview\").removeClass(\"editing\");\n});\nOpen to suggestions on a cleaner and leaner approach. Thanks.\n. Perfect!\n. ",
    "spearce": "Almost. :)\nWhen search is cleared the overlay on the editor is removed, but the scrollbar annotations are still present.\n. ",
    "wcandillon": "@marijnh Thank you so much for the review! \nMy use case is to have the JSONiq code highlighting available on http://brackets.io. Anything that helps me towards that, I'm in.\nCan you give me a pointer on how such dependency work? Is it like an npm dependency? I couldn't find a build system for the editor. I assume for other mode have similar needs (like javascript and jshint). Couldn't find a relevant pointer in the source code.\nThe part form XQLint that is included in the mode, is only the browserify build of the JSONiq lexer classes: https://github.com/wcandillon/xqlint/blob/master/Gruntfile.js#L107\nThe file is big because the lexer is complete.\nRegarding the lexer going out of date, I am sure to understand how this situation is different from any other mode where the language might evolve.\n. @marijnh that's a bit harsh. Tools like jshint or csslint are not used in Codemirror? My use case is the same. XQLint is used in both ACE and Atom to syntax highlighting and markers, please let me know what I have to do to bring this to codemirror as well.\n. ",
    "esdras": "glad I could help :-)\n. ",
    "ratchup": "Re: Is this an entirely different language from Verilog/SystemVerilog\nhttp://codemirror.net/mode/verilog/?\nNo, this language is an extended form of system verilog. (The extended\nsystem verilog is submitted to a preprocessing tool which produces system\nverilog.) Right now, this extension is experimental and not part of a\nstandard.\nRe:  If not, would it make sense to write this as a configuration of that\nmode instead?\nI did consider adding this extension to the verilog mode module. (I'm\nguessing that would be the impact of adding a configuration of the verilog\nmode.) However, I had a couple of concerns: 1) I was unsure how this\napproach (of adding configurations) would scale (in terms of\nmaintainability) for two (or more)  pre-processor modes; 2) This tool (SVX)\nis currently in development so the editor support needs might change. (And\nI thought a separate mode would allow for more flexibility than an\nintegrated mode. I could be wrong about this, but it seemed to me that\nhaving multiple indentation flows [one for the main mode and (potentially)\nothers for the different configuration flows] would make for a busy module.)\n(I tried to make a svx mixed mode [like html mixed\nOn Fri, Jan 9, 2015 at 11:34 AM, Marijn Haverbeke notifications@github.com\nwrote:\n\nIs this an entirely different language from Verilog/SystemVerilog\nhttp://codemirror.net/mode/verilog/? If not, would it make sense to\nwrite this as a configuration of that mode instead?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3021#issuecomment-69359291\n.\n. Re: (I tried to make a svx mixed mode [like html mixed ...\n\nSorry, I was trying to type too quickly and I accidentally sent the message\nbefore I was done.\nSo,\nI tried to make a svx mixed mode [like html mixed mode] which would call\nsvxverilog and verilog modes. But right now, that approach isn't working\nfor me. (I'm having CM framework problems.)\nRegards,\nRay\nOn Fri, Jan 9, 2015 at 4:26 PM, raymond ratchup ray1248@gmail.com wrote:\n\nRe: Is this an entirely different language from Verilog/SystemVerilog\nhttp://codemirror.net/mode/verilog/?\nNo, this language is an extended form of system verilog. (The extended\nsystem verilog is submitted to a preprocessing tool which produces system\nverilog.) Right now, this extension is experimental and not part of a\nstandard.\nRe:  If not, would it make sense to write this as a configuration of that\nmode instead?\nI did consider adding this extension to the verilog mode module. (I'm\nguessing that would be the impact of adding a configuration of the verilog\nmode.) However, I had a couple of concerns: 1) I was unsure how this\napproach (of adding configurations) would scale (in terms of\nmaintainability) for two (or more)  pre-processor modes; 2) This tool (SVX)\nis currently in development so the editor support needs might change. (And\nI thought a separate mode would allow for more flexibility than an\nintegrated mode. I could be wrong about this, but it seemed to me that\nhaving multiple indentation flows [one for the main mode and (potentially)\nothers for the different configuration flows] would make for a busy module.)\n(I tried to make a svx mixed mode [like html mixed\nOn Fri, Jan 9, 2015 at 11:34 AM, Marijn Haverbeke \nnotifications@github.com wrote:\n\nIs this an entirely different language from Verilog/SystemVerilog\nhttp://codemirror.net/mode/verilog/? If not, would it make sense to\nwrite this as a configuration of that mode instead?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3021#issuecomment-69359291\n.\n. Re:\nIf the language is unstable, maybe it is better to hold off on integrating\nthis in the distribution for now?\n\n\nI think of the preprocessor language as experimental- within Intel the\nconsumer tool (the preprocessor) underwent several iterations before being\nreleased as open source. Some flows supported by the tool, such as the HDL\npipeline extensions, are more developed than other flows.  So, there is\nroom for more development and hence, I consider the language experimental.\nAnyway and however, I think that  holding off on integrating this into the\ndistribution for now is not unreasonable from the maintenance point of\nview. I want to be able to provide to those  who are interested (which, I\nguess, is a small population of the code editor user community) this addon\nmode to support user use of the preprocessor tool and to facilitate\ndevelopment of the tool. (I think there is a chicken and egg issue here-\nthe tool needs to be used in order to facilitate further development so\nthat the tool can be used more...)   (I guess I'm asking the question:\n\"What is the best way to provide EDA Website code editor for the\npreprocessor tool and also minimize the ongoing code editor maintenance\neffort?\" However, I don't know much about the CM mode interface and so\ncan't give a good answer to the second clause...)\nRe:\nBut even if we put this in the main distribution, I think it would be\npreferable to add configurability to the Verilog mode. Duplicated code is a\nmaintenance burden and will prevent improvements to one of the modes from\nhelping the other mode. See also the clike, css, and sql modes for examples\nof modes that handle families of languages.\nI'll look at the suggested modes and see what I can do...\nRegards,\nRay\nOn Mon, Jan 12, 2015 at 4:11 AM, Marijn Haverbeke notifications@github.com\nwrote:\n\nIf the language is unstable, maybe it is better to hold off on integrating\nthis in the distribution for now?\nBut even if we put this in the main distribution, I think it would be\npreferable to add configurability to the Verilog mode. Duplicated code is a\nmaintenance burden and will prevent improvements to one of the modes from\nhelping the other mode. See also the clike, css, and sql modes for examples\nof modes that handle families of languages.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3021#issuecomment-69543445\n.\n. I redid the request as a config option in verilog mode. I tried to use an aspect oriented approach to add configurability to the Verilog mode.\n. Thanks for looking at my code.  I'll work on cleaning up the hygienic\nproblems of indentation, respecting the API (\"touching the internals of the\nstring stream abstraction\"),  removing superfluous code and indirection,\nmaking the svx configuration less invasive, and making the hook mechanism\nmore general.  I hadn't intended to mutate the mode's configuration\nobject, and would like to fix that problem. However, I'm in  need of some\nguidance on this exact issue. Is there someone that I could talk to or a\npointer that I could look at to resolve the mutation problem?  Thanks...\n\nOn Thu, Jan 29, 2015 at 6:04 PM, Marijn Haverbeke notifications@github.com\nwrote:\n\nI took a look at this, but as it stands the code really isn't clean enough\nto be integrated. For a start, its indentation and whitespace are different\nfrom the other modes, and rather inconsistent internally. More importantly,\nthe actual code itself seems alarmingly confused. You are initializing\nvariables to an empty object only to directly overwrite them, you are\nreturning objects from which you use only one field (in the hooks), you are\nneedlessly touching the internals of the string stream abstraction (its\npos and string fields), and your hooks' logic, instead of simply\ndispatching on the content of the line, first sets some variables, and then\nlater dispatches on those variables. It is also a really bad idea to\nmutate the mode's configuration object, I'm not sure what you were\ntrying to accomplish with that, but it's going to touch other instances of\nthe same mime mode, since they share that object.\nSo if you want this merged, tighten up the code style, remove superfluous\ncode and indirection so that someone who is not you has a chance of\nunderstanding what is going on, and please also try to make the\nconfiguration less invasive -- there's not need to have multiple vx-specific\nproperties on the state even when in another configuration -- your hooks\ncan add those when they need them. Also try making the hook mechanism\ngeneral, not vx-specific, and try to give the individual hooks more obvious\nnames.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3021#issuecomment-72122659\n.\n. I fixed the \"mutate the mode's configuration object\" problem; made the vx configuration flow less invasive to the verilog mode flow; gave the individual hooks more obvious names;  removed superfluous code; and tried to make the hook mechanism more general. Please let me know what I should do next. Thanks.\n. I put spaces around the binary operators in the svx flow; changed vxhooks to hooks; removed the codeRegion placeholder var; moved the \"svxGenIndent\" function out of the object literal hooks area (since dynamic dispatch is not needed); moved the 5 literal properties in the svx mime to variables; and removed thisMode from the parameter lists. \n. Yes, the language is now called transaction level verilog (TLV). I think of\nthis change as connotative of a language scope reduction.  In regard to the\nquestions about the stability and maturity of the language, I will ask the\nlanguage architect about these topics. I know that Steve has additional\nplans to enhance the design flow supported by TLV, but I'm not sure how (or\nif) these plans will impact the  CodeMirror support.\n\nOn Wed, Mar 18, 2015 at 5:08 AM, Marijn Haverbeke notifications@github.com\nwrote:\n\nDid the targeted language change its name? Again, are you sure this\nlanguage is mature and stable enough that it makes sense to keep a mode for\nit in the CodeMirror core library?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3131#issuecomment-82832425\n.\n. I received feedback from Steve: It's desirable for TLV mode to be part of\nthe CM release. (Reduces maintenance, distribution, and installation\nissues.)  But this may be a burden for the CM maintainer.  To be fair and\nhonest, the expectation is that the language is evolving (as all languages\nare) and that  periodic update requests will be submitted. (The expectation\nis that these updates will not happen  on less than a monthly interval.)\nThe name change has to do with the language being adopted by the industry.\nThe language is currently being deployed at sandpiper.edaplayground.com.\nSupport in CM will be a draw for CM during the anticipated rapid adoption.\n\nOn Wed, Mar 18, 2015 at 10:54 PM, raymond ratchup ray1248@gmail.com wrote:\n\nYes, the language is now called transaction level verilog (TLV). I think\nof this change as connotative of a language scope reduction.  In regard to\nthe questions about the stability and maturity of the language, I will ask\nthe language architect about these topics. I know that Steve has additional\nplans to enhance the design flow supported by TLV, but I'm not sure how (or\nif) these plans will impact the  CodeMirror support.\nOn Wed, Mar 18, 2015 at 5:08 AM, Marijn Haverbeke \nnotifications@github.com wrote:\n\nDid the targeted language change its name? Again, are you sure this\nlanguage is mature and stable enough that it makes sense to keep a mode for\nit in the CodeMirror core library?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3131#issuecomment-82832425\n.\n. This is not a review, but just a few comments...\n\n\nThis code revision much more faithfully models the TLV syntax and semantics\nthan the current release does. So, the revision is a major improvement over\nthe current release.\nSome code comments:\n---line 306\n    if (hooks.token) {\n        // Call hook, with an optional return value of a style to override\nverilog styling.\n        var style = hooks.token(stream, state);\n        if (style !== undefined) {\n          return style;\n        }\n      }\nThe return  model for the verilog mime token hook function style-not-found\ncase is now \"undefined\". So future verilog token hook functions, if any,\nneed to follow this convention. (Impact: guess it is small)\n---line 489\n         // Process TLV line prefix -- correct indentation.\n          if (state.tlvCodeActive && (state.indented == 0) &&\nstream.match(tlvLinePrefixMatch)) {\n            stream.match(/ */);\n            state.indented = stream.pos;\n            stream.pos = 0;\n          }\nDirect update of parent internal state (stream.pos). (Impact:\nmaintainability of StringStream \"class\". Regression test desirable?)\nOn Fri, Oct 28, 2016 at 11:49 AM, Marijn Haverbeke <notifications@github.com\n\nwrote:\n@0b10011 https://github.com/0b10011 @dwikle https://github.com/dwikle\n@ratchup https://github.com/ratchup Want to review this (or at least\ntake a look whether it breaks anything obvious)?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/4347#issuecomment-256956671,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AJ8gwqBwKH1xa1XtoEkYkeNJKUQn2BOiks5q4hmcgaJpZM4KfOon\n.\n. Re: There are various points where you are assigning to properties of\nthisMode, which is, unless I'm really confused, referring to the\nparserConfig object passed to the mode... you probably shouldn't be\nchanging it.\n\nYes. And thanks for the clarification about the mutation problem...\nOn Mon, Feb 2, 2015 at 4:22 PM, Marijn Haverbeke notifications@github.com\nwrote:\n\nIn mode/verilog/verilog.js\nhttps://github.com/codemirror/CodeMirror/pull/3021#discussion_r23959888:\n\n\nname: \"verilog\",\nvxModeIsOn: true,\nvxHooks: {\n\"\\\": function(stream, state, thisMode) {\nvar codeRegion = \"\", vxIndent = 0, style = false;\nvar curPunc  = stream.string;\nif ((0 == stream.pos) && (/\\SV/.test(stream.string))) {\ncurPunc = (/\\SVX_version/.test(stream.string))\n? \"\\SVX_version\" : stream.string;\nstream.skipToEnd();\nif (curPunc==\"\\SV\" && state.vxCodeActive) {codeRegion = \"2v\";};\nif (/\\SVX/.test(curPunc) && !state.vxCodeActive) {codeRegion =\"2vx\";};\nif (curPunc==\"\\SVX_version\" && state.vxCodeActive) {codeRegion = \"2vx\";};\nstyle=(thisMode.svxkeywords.propertyIsEnumerable(curPunc))\n? thisMode.svxkeywords[curPunc] : \"builtin\";\nthisMode.svxCurCtlFlowChar  = thisMode.svxPrevPrevCtlFlowChar\n\n\nThere are various points where you are assigning to properties of thisMode,\nwhich is, unless I'm really confused, referring to the parserConfig\nobject passed to the mode. This object is shared by all instances of the\nmode (it is the value passed to defineMIME), and thus you probably\nshouldn't be changing it.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3021/files#r23959888.\n. \n",
    "happibum": "Thank you for the pointer. I can use the option. :)\nI am sorry to comment on this closed issue. \nI just found a tiny inconsistency.\nThe HTML syntax checker(not the highlighter) also ignores characters after 10000th column.\nFor example,\n<li>\n<div>aaa..aaa</div>\n</li>\ncan show error on the third line. (because of missing close div tag?)\nOn the other hand, it seems JavaScript syntax checker does not ignore such characters.\nFor example,\nvar x = \"aaa..aaa\"; if (x) {\n} else { }\ndoes not show any syntax errors.\nIs it possible to make the HTML syntax checker not depend on maxHighlightLength?\n. ",
    "dpursehouse": "The reason we didn't add it in Gerrit is that the license is unclear.  See the commit message of @davido's commit that was referenced above.\n. Nice.  Any idea when this will be in a release?\nOn Fri, 4 Dec 2015, 19:14 Marijn Haverbeke notifications@github.com wrote:\n\nClosed #3682 https://github.com/codemirror/CodeMirror/pull/3682.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3682#event-482479724.\n. Then we can get it into Gerrit 2.13. I don't think we can wait 2 weeks to\nrelease 2.12.\n\nOn Fri, 4 Dec 2015, 19:38 David Ostrovsky notifications@github.com wrote:\n\nNice job indeed. Really appreciated.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3682#issuecomment-161933396\n.\n. Oh, OK.  Thanks. \n. \n",
    "davido": "Indeed, @dpursehouse meant this non answered question to clarify the license: [1].\n- [1] https://github.com/djadmin/djadmin.github.io/commit/6ee5941512d73cdcede929b6b832896842e0845d#diff-5\n. Nice job indeed. Really appreciated.\n. Ack.\n. Can we consider to revert 0df380b and release new version of CodeMirror? CodeMirror upgrade was reverted in Gerrit Code Review because of this problem, and new and shiny jump-to-line dialog feature as well: [1], [2].\n- [1] https://gerrit-review.googlesource.com/75143\n- [2] https://gerrit-review.googlesource.com/75142\n. ",
    "jenspohle": "@marijnh:\nat the beginning of this thread you posted some lines of code, that shall make the \"goto-line-function\" work.\nWell, javascript is not my strong ;-)\nCan you tell me, in which files i have to place it, to make it working?\nThank you very much in advance! :-)\n. ",
    "dalguji": "Hello, would there be any updates on this issue? I am looking forward to seeing https://github.com/ipython/ipython/issues/7448 resolved, which depends on this issue.\n. I am not quite sure. @Carreau, could you advise on this?\n. ",
    "m00nlight": "Just saw the homepage of emacs demo of codemirror, which said that chrome prevent the capture of Ctrl-W and Ctrl-N from javascript. So there is no solution for Chrome browser, right?\n. Doing some search on google give me the following informations:\nhttp://stackoverflow.com/questions/7295508/javascript-capture-browser-shortcuts-ctrlt-n-w/7296303#7296303\nSeems hopeless to do it in Chrome. \n. ",
    "forresto": "Doesn't look like it:\n\nHere's a reduced CodeMirror-in-Polymer case:\n``` html\n<!doctype html>\n\n\n\npolymer + codemirror lint tooltip autohide bug\n\n\n\n\n\n\n\n\n\n\n\n\n\n  Bug: codemirror/CodeMirror#3039\n\n\n\n\n\n\n\n\n\nPolymer('code-mirror', {\n  ready: function () {\n    var cm = CodeMirror(this.$.code, {\n      lineNumbers: true,\n      value: '\"hello lint\"',\n      mode: 'javascript',\n      gutters: ['CodeMirror-lint-markers'],\n      lint: true,\n      width: 300,\n      height: 300\n    });\n    console.log(cm);\n  }\n});\n\n\n\n``\n. At that point,nis#shadow-rootwith native implementations andShadowRoot` with webcomponents.js polyfill. The line should be:\nif (n && n.nodeType == 11) n = n.host;\nThis works for native (Chrome). You probably don't want to worry about Polymer's polyfill morass, but this is needed for it to work everywhere:\nif (n && n.nodeType == 11) {\n      n = n.host; \n      if (typeof unwrap == \"function\") n = unwrap(n);\n    }\n. ",
    "kevinushey": "I also notice that joinLines does not place the cursor in the correct location after a join (it should lie on the joined line; instead it is placed ahead)\n. I think the issue was related to the 'exitVisualMode' command moving the cursor; we want to ensure we set the cursor position after exiting visual mode.\n. Some thoughts on how I imagine this might work:\n1. Add an API for adding specific entries to the operators, actions and motions objects. I imagine this would be with e.g.\njs\naddMotion(\"name\", function(cm, head, motionArgs) { ... });\nOr even:\njs\nadd(\"motion\", \"name\", function(...) {});\nValidating the function could be tricky; maybe it could be applied to some dummy text and see if it actually e.g. returns a Cursor object (in the case of a motion)?\nAfter doing this, one could bind a (sequence of) keys to a particular action by either appending to the default keymap (probably not desired), or by asking the appropriate parts of vim.js to check both a defaultKeymap and a userKeymap for dispatching on a set of keys. Does that make sense?\nIf it does, I'd be happy to prototype and PR an implementation (time permitting)\n. I've been using something super simple and it seems to work well: https://github.com/rstudio/ace/commit/7d81d46b873ec022524d4128eef670dd11597415\nThe API is 'low level', though, so the onus is entirely on the user to pass in the correct objects, but that's not really that bad, I suppose -- the interface is fairly obvious to anyone who reads the source code. Any thoughts on whether something like this would be appropriate for vim.js?\nI feel that the define* API is probably fine as-is, but the mapCommands might be better as e.g.\njs\nfunction mapCommand(keys, type, name, args, extra) {\n    var command = {keys: keys, type: type};\n    command[type] = name;\n    command[type + \"Args\"] = args;\n    for (var key in extra)\n         command[key] = extra[key];\n    defaultKeymap.push(command);\n}\nAlternatively, extra could be expanded to the other optional arguments explicitly e.g. context, isEdit, ...\n. Awesome, thanks!\n. @marijnh In my case, my web application is running on top of Qt WebKit, and we have some relatively 'easy' access to the system clipboard via callback functions. It seems that (at least for my case) it would be possible to handle this; in general though, I think users would have to define how the system copy + pastes get handled, since (as you point out) this can't be handled reliably in a cross-platform way just within JavaScript.\n@mightyguava That would be perfect for my use case.\n. I think this PR also needs to add * to the set of valid registers: https://github.com/mightyguava/CodeMirror/blob/52301d01858aaa3302e5c6cbcd66e3c8f18f367b/keymap/vim.js#L358\nAlternatively, that check could just ensure that the register name is a single character?\n. I think this PR also needs to add * to the set of valid registers: https://github.com/mightyguava/CodeMirror/blob/52301d01858aaa3302e5c6cbcd66e3c8f18f367b/keymap/vim.js#L358\nAlternatively, that check could just ensure that the register name is a single character?\n. Awesome, thanks!\nI'm doing a local test of this PR and it looks like everything works as expected (with adding * to the set of valid registers as noted before).\nThanks for implementing this, this is very helpful!\n. Ah, I'm sorry -- the * register really does need to be added in here: https://github.com/mightyguava/CodeMirror/blob/52301d01858aaa3302e5c6cbcd66e3c8f18f367b/keymap/vim.js#L358.\nThis is needed for spots like this: https://github.com/mightyguava/CodeMirror/blob/52301d01858aaa3302e5c6cbcd66e3c8f18f367b/keymap/vim.js#L983-L986\n. @mightyguava I don't see that change in https://github.com/codemirror/CodeMirror/commit/7367b4db1ebb7a9b65d820b9c0ee953767ee8b8b -- just the defineRegister implementation and the other minor changes.\n. Doh! Yes, there it is. Sorry for being so obtuse -- thanks!\n. ",
    "dmitrykiselyov": "Ok. Now I'll know. Thanks.\nIt was not pure luck, I mentally asked you to reopen :)\n. Ok. Thanks for the adjustments to code style. How to run bin/lint?\nI'll improve my knowledge of git and the next pull request will be shine :sparkles:\n. Thanks :+1: \nI think that with the $ sign ($ bin/lint) will be more obvious for Windows users :smile: \n. I hope this pull request will be :sparkles: :pray:\n. What the best way to do a pull request with only the latest commit in the master branch of my forked repository?  I was guided by this.\n. Thanks :+1:  Next time I will try git rebase. \n. Thank you!\n. Thanks you!\n. ",
    "andreich2013": "Yes, maybe that is not a good idea, but it works incorrectly... As I know Douglas Crockford recomended use i = i + 1 instead i++ in his books. \nWe are using javascript mode. Yes - \"/*\\n{\" - it is. For more details, this is Appery platform and this is link where our editor is - https://appery.io/servercode/\n. ",
    "kamelkev": "Thank you so much Marijn, works exactly as expected now.\n. ",
    "cpetrov": "@marijnh Thank you, this solution would work out great for our needs.\n. ",
    "nickasd": "I found that this issue still happens for argument hints. In the tern demo, just move the cursor to the arguments of slice() on line 6 and scroll down: the tooltip will not scroll and stay fixed.. I think you misunderstood, the demo doesn't work when adding the above lines. Other commands work, but not the \"go to definition\" one.. Actually that's what I thought would make it work: server.server.addFile('asd.js');. I thought that adding a file this way would cause the switchToDoc function to be called. Am I misunderstanding the role of that function?. Yes, that would work, but I was looking for a way to add documents without having to add them to CodeMirror first, since there could be a lot of them. Would it be a performance issue? Does creating a new document involves some significant parsing even before displaying it?. Potentially there could be hundreds of documents and only a couple of them could ever be opened, that's why I was looking for a more efficient way. If not for a scenario like this, I don't really get what the getFile option could be useful for, since one could simply add all the documents at the beginning. In my opinion, switchToDoc would be the perfect place to create the new CodeMirror document if it didn't exist yet.. That's what I thought at first, but what if you have wrapped lines? I don't use Sublime myself so I don't know what the default behavior is (whether to add the cursor to the next line or to the position immediately below which might be on the same wrapped line). Anyone knows this?. Right, didn't see that method. Now it's as easy as\ncm.addSelection(cm.findPosV(cm.getCursor(), 1, 'line'));\nAlthough for the case where you want to add the cursor to the next logical line (i.e. ignore wrapped lines), this doesn't work, since cm.findPosV() returns the visual vertical position. Maybe an optional visually parameter could be added as in cm.findPosH()?. So apparently after downloading the trial version of Sublime I found that it has the Ctrl-Shift-Up/Down hotkey (and not Shift-Alt-Up/Down as I first thought). Since Sublime has no wrapping lines, there should be a way to have cm.findPosV() find the logical next line and not the visual (possibly wrapped) one. Can this be done (like I suggested above)?. > Actually, it uses ctrl+alt+down/up (which is standard -- ace, atom do the same)\nIn Sublime 3 on the Mac the command is called \"Add previous/next line\" and it uses Ctrl-Shift-Up/Down. Which system are you using?\n\nBut common behavior is for the cursor to extend to the visual (wrapped) line first, so you do want to use the cm.findPosV\n\nOk, now I can confirm this. Although this is not standard behavior for all IDEs (see Brackets for example), Sublime adds the cursor to the next visual line.. Brackets has the Alt-Shift-Up/Down shortcut instead. I also noticed the somehow unintuitive behavior that if the cursor is on the first visual line of a wrapped line, after adding a cursor to the line below (the next logical line), moving the cursors down with the keyboard will keep the same distance even if the following lines are not wrapped.\nJust to be sure: we still want the Sublime behavior (since it's the Sublime key map)?. Thanks for the fast response. I cannot find a documentation for this method in the manual. I guess for index I should pass the character index, but what is string? And would it be possible to automatically infer tabSize from the current settings?. This should be fine. Just wondering if your change will restore the \"Select text from start of file to cursor\" behaviour you described at the beginning, since the cmd+shift+up shortcut was removed?. ",
    "rakibtg": "Okay, things getting prettier with Require.js :)\n. ",
    "KwanEsq": "Great, thanks!  Apologies for the lack of a test, I didn't immediately grok your test syntax, and figured if you wanted one you would let me know.  I'm attempting to write one for #3065, though not sure if I'm doing it correctly.\n. I've attempted to add some tests for this, but I'm not sure if I'm being over- or under-thorough.  They do at least all pass, though I had to wrestle with indenting errors for the first test for a while (hence making the smaller ones as possible replacements).\nRe: your comment\nYes that's correct (I did mean to link to https://developer.mozilla.org/en-US/docs/Web/CSS/@document in my PR, but forgot)\nThat might be possible.  The original (dumb) way I did it when I was patching Firefox directly was to just treat @document (and @supports) as @media via changing\njavascript\n} else if (type == \"@media\") {\nto\njavascript\n} else if (/@(media|supports|(-moz-)?document)/.test(type)) {\nwhich got it most of the way.  The main reason for separating it was for the non-url functions like\ncss\n@document url-prefix(http://www.mozilla.org/) {\nsince it wouldn't parse their contents as strings.\nMaking just the tokenBase() changes (with document-as-media) seems to be enough to fix that, but the functions themselves are still tagged as errors.\n. Okay, I've tried merging @media, @supports, and @document into one in KwanEsq/CodeMirror@5561e21355892db8c3defb78f331be2c27d13e4c, and it seems to work as it passes all tests.\nThis isn't general for any future @rules, since I'm not sure how one would distinguish between one-line @rules, like @import and @namespace, and @ blocks like the three in question, or would you not bother?\n. Awesome, thanks a lot for the merge.\n. Great, thanks a lot!  Looking forward to 4.13.\n. ",
    "DaveConroy": "This problem is present on iPad iOS 8 and Android 4.2.2 tablet on codemirror 5.0 when there is more than 99 rows as seen in this picture.\n\nAlso note that at the two red arrows in the image the numbers go\n10\n10\nSo it appears that this is not just a styling issue as the number 10 (or could be 100 as the 0s could be on top of each other) is repeated twice.\nThis issue is also present on the codemirror website by just hitting backspace until you go past line 100 so it doesn't seem to be cause by our styling implementation.\nhttp://codemirror.net/demo/marker.html\n. ",
    "zhangns": "I ran into the same problem in Android ~~TextView~~ WebView using the master branch code (haven't tested with mobile branch yet), and fixed it with a css style.\ncss\n.CodeMirror-gutter-elt {\n    white-space: nowrap;\n}\nI think it is just a styling issue. \"0\" in \"100\" is wrapped to the next line and overlaps with \"0\" in \"101\", and the wrapped \"1\" in \"101\" overlaps with \"0\" in the \"102\" line, etc..\nThe problem doesn't occur in a desktop browser. I have no idea why ...\n. ",
    "JamesNK": "I downloaded the uncompressed source and after some debugging found the solution was to pass these options when creating the CM instance:\n'lint': { 'getAnnotations': schemaLint, 'async': true }\nI still think it would be useful to have an example.\n. ",
    "leopatras": "The linter demo does not make use of the special linter options, so novices like me do not necessarily understand thats its easy to customise.\nIt was only clear to me after several hours reading und debugging the lint.js code.. ",
    "patrick-wolf": "Thanks!\n. ",
    "crantok": "Yes please.\nJust started using Light Table. Searched to find out how to change ctrl-c to copy while in insert mode. This was the top hit on google.\n. Thank you. Works for me.\n. The codemirror vim keymap wiki page ( https://github.com/codenvy/plugin-editor-codemirror/wiki/Vim-keymap ) only shows the use of > for manual indenting. Experimentation in the codemirror vim key bindings demo ( https://codemirror.net/demo/vim.html ) seems to confirm this. Does your response indicate that smart indentation is intended only for 'insert' mode?\n. ",
    "Mange": "I can't even copy at all. I have to disable Vim mode, copy with CTRL-C and then enable vim mode again.\n\nCtrl-C exits insert mode.\nYanking only places text in the \" register. Not possible to paste in other programs.\nCannot yank to + or * registers as they are not implemented.\nX11 Primary selection does not work either.\nNo right-click menu to choose \"Copy\" from.\nCtrl-P still works to paste, however. Weird.\n\nThis is from using GraphQL Playground, which is using CodeMirror inside an Electron app, on Linux.\nIMO yanking to + should perform a normal copy to the system clipboard, no matter what people think about the Ctrl-C situation. That could be a first step.. ",
    "ngn": "In some languages quotes inside strings are escaped by doubling them up.  For instance, to represent the JavaScript string '\\'a' in APL, one would type '''a'.\n. Thanks.  So, for the time being I'll stick with loading the .js in the popup window so it gets the right window and document.\n. Initially I thought this would be due to some arbitrarily set constant in CodeMirror.  25 bits in the browser - that's an interesting insight.  Thank you.\n. In my particular case there's never a gutter, so this turned out to be easier:\nMath.floor((e.clientWidth-cm.display.scrollbarFiller.clientWidth)/cm.defaultCharWidth())\nwhere e is CodeMirror's root element.  Padding contributes a negligible number of pixels which I don't mind compensating for with a constant.\nI noticed that defaultCharWidth() initially reports a wrong width, always an integer.  After a call to refresh() it starts returning the correct one.\n. Yes, though it's not hosted on a web server.  It's bundled with a NW.js app.\n. I see.  Thank you.  I have an easy workaround -- cm.refresh().\n. ",
    "anntzer": "Can this be made part of the individual language modes?  e.g. I tried adding closeBrackets: {triples: \"\"} to octave.js (which behaves similarly to APL), but this didn't seem to have any effect.. Perhaps this doesn't really belong here (I am not sure) but I tried editing this out (setting triples to the empty string) of python.js as shipped by jupyter notebook (/usr/lib/python3.6/site-packages/notebook/static/components/codemirror/mode/python/python.js) and this had no effect.  Any suggestions?. I am trying to make typing three quotes in a row NOT insert six quotes (well, the real goal is to fix octave.js which should have that setting  as it uses the same syntax as mentioned in https://github.com/codemirror/CodeMirror/pull/3083#issuecomment-74395375).. thanks!. ",
    "mloginov": "No. It happens if completions update on each key press. \nhttp://screencast.com/t/eCfHmUNxReI\n. Also fixed lagging if hints changes very often. Looks like this bugs appears on complex layouts.\nBefore\nhttp://screencast.com/t/bOT0aelSm\nAfter\nhttp://screencast.com/t/uwssrWjc\n. No. I open only one completions like in your example. But I found where problem can be. \nLooks like the problem in show-hint addon in update method. \non cursor activity -> update -> throw update signal -> getHints(async) -> finishUptate and throw select signal on new widget creation.\nBut if getHints gets a lot of time(for example if 100 docs was added to tern) you can get 2 update events in tern addon and then 2 select events for different positions. \nNow, because tooltip stored in local scope it wouldn't be removed. \nI added it to ts.completionHint just to be sure that tooltip would be removed in any case.\n. You should use tern addon to reproduce it. Problem in tern tooltip that appears in 'hint' method.\nJust use example from http://codemirror.net/demo/tern.html\nBut slightly change tern addon(getHint method) like this to emulate ternServer delay\n\n    this.getHint = function(cm, c) {\n        setTimeout(function () {\n            return hint(self, cm, c);\n        }, 400);\n    };\n\nThen to reproduce. \n1. Clear textarea. \n2. Open hint by Ctrl+Space\n3. Type fast - 'e' - 'backspace' - 'e' - 'backspace' etc. \nTest case http://jsfiddle.net/09aao7f9/8/\nVideo http://screencast.com/t/JyDDF9Teg\n. ",
    "robinst": "That was fast :). Thanks :+1: \n. ",
    "jpsduarte": "Could anyone post the entire code? I'm trying to use this example to get informed when the user select some option of the autocompletion. I have defined a default schema json for the hintOptions but I don't know how to subscribe to it. \n. ",
    "iulianmihai": "@marijnh \nwhat is fooHint returning? and is necessary to be used in the event?. ",
    "davidje13": "I have just hit a similar requirement to weltschmerz1. I solved it in a slightly different way, because in my use-case I have access to the hint function. Summarising the important parts:\n```javascript\ncm.registerHelper('hint', (modeName), (cm, options) => {\n  // ... generate data with a list of suggestions\nconst CM = cm.constructor;\n  CM.on(data, 'shown', CM.signal.bind(cm, cm, 'hint-shown'));\n  return data;\n});\nlet isAutocompleting = false;\ncm.on('hint-shown', () => {\n  isAutocompleting = true;\n});\ncm.on('endCompletion', () => {\n  isAutocompleting = false;\n});\n```\nThis provides an event on the code mirror object named hint-shown which is only fired if the popup actually appears (i.e. it does not fire if we ask for the autocomplete to appear but it has no suggestions, or if it has only 1 suggestion and auto-applies it). The existing endCompletion event is sufficient to detect when it is closed (it will sometimes fire even if the popup wasn't visible in the first place, but for just tracking popup visibility that's fine).\nAll this is due to the need to track whether an autocomplete popup is currently visible. In my case I need to know this because my editor has a refactor-like mode, where pressing enter advances to the next parameter to edit (therefore the interceptor must preventDefault in order to stop newlines being inserted, but only if the key isn't being used to accept a completion).\nMy problem would go away if any of the following is provided:\n\nProviding the shown event on the CodeMirror object itself (or fixing startCompletion), rather than requiring the hack I described above\nOr better: a method which returns a boolean for whether the suggestions box is currently visible\nOr even better: a place where I can intercept key presses only after all plugins have had a chance to intercept them (i.e. just before they would cause a direct text change). @marijnh If you're referring to things like:\n\nmyElement.style.fooBar = 'baz';\nThat isn't considered an \"inline style\" by the security policy. It's there specifically to catch injection attacks, so javascript-based mutations aren't blocked (javascript execution implies much bigger problems!)\nAs far as I can tell, those 3 places really are the only issues. I can run CodeMirror with a very restricted security policy and it's fine, except for those (try it yourself with the not-very-strict example I gave).\nI've already modified my own copy, so this isn't something I'm desperate for, more an FYI: you can make this library compatible with modern security layering (which has been standardised and is very widely supported) by changing about 6 lines of code.. ",
    "andrey012": "Marijn,\nSorry, I'll revert the change and will try to find another way without having to modify CodeMirror core.\nI just thought, that there is certain disparency:\nwhen I use Tab key without selection - it adds one \\t char which is 4 spaces.\nbut when I use Tab key with selection - it adds 2 space chars.\nhttp://software-developments.com/u/150220-1752-12-125097723101278069255506862254471279130238-0_codemirror_disparency.mp4\nAG\nMarijn Haverbeke wrote:\n\nThe current behavior is intentionally the way it is. If you want a different behavior, simply bind Tab to something else.\n\u2014\nReply to this email directly or view it on GitHub https://github.com/codemirror/CodeMirror/pull/3094#issuecomment-75240127.\n. \n",
    "gzzhanghao": "@marijnh The patch is backward compatible, the original table format is supported as well.\n. ",
    "goyatparmod": "We have still same issue.... even thought we have .css with \n-moz-box-sizing: content-box;\n  box-sizing: content-box;\n\n. But When it hit line number 10 it automatically adjust content on screen properly. \n\n. Thanks to marijnh....mwileyTibco..My problem is also solved ..I use  https://codemirror.net/addon/display/autorefresh.js  and autorefrsh:true and it work very well.\nui-codemirror=\"{lineNumbers: true,\n                                     lineWrapping : false,autoRefresh:true,\n                                     theme: 'paraiso-light',\n                                     styleActiveLine: true,fixedGutter:true,\n                                     lint:true, coverGutterNextToScrollbar:false,\n                                     gutters: ['CodeMirror-lint-markers'],\n                                     mode: 'javascript'}\"\n. ",
    "Manoj-RG": "@goyatparmod  In my case, I was using the version 4.6.0 and I was not allowed to migrate to higher versions. I fixed this gutter issue by making the 'fixedGutter' parameter to FALSE. I don't know how it worked. I was trying multiple options and finally setting the 'fixedGutter' parameter to FALSE fixed my issue (same version 4.6.0). \n@silverwind  and @marijnh \nThanks for your awesome work\n. ",
    "mwileyTibco": "I had the exact same issue when displaying a CM element on an Angular-wrapped bootstrap tab that's hidden when the page loads (i.e. another tab is shown by default). When the user clicks on the tab with the CM element, the element would appear, but it would behave as @goyatparmod described (weird until you enter the 10th line). I figured I might have to call CM.refresh when the tab gets activated. The trouble was figuring out what event actually corresponded to the tab being activated. I found that the element wasn't hidden, so trying to react to element.show() didn't help. Rather, the element had width & height set to 0 until the tab it was displayed on became active. This actually might explain the weird CM behavior because it would have initialized with zero width and height. So instead of reacting to .show() I tried .resize() and it works. I suspect this might help you @goyatparmod because you're showing the code in a modal kinda like I'm showing it in a tab.\nIn essence the code looks something like this (sorry just off the top of my head here...)\nhtml\n<div id=\"target\"></div>\njavascript\nvar elem = $('#target');\nvar cm = CodeMirror(elem[0], {});\nelem.resize(function(){\n    if(elem.width() > 0){ cm.refresh(); }\n});\n. ",
    "stateoflux": "Whew! so glad I stumbled across post.  I had the same issue as @goyatparmod and i've working on it for the past few hours trying to figure how to fix.  Installing the \"autorefresh\" addon and setting the config option to true solved the problem for me.\n. ",
    "dcsaszar": "Could we please reopen this issue, as it seems to be present still?\nI created a fiddle to reproduce. It shows another issue (CodeWarrior being not visible at all), but this isn't relevant here.\nhttp://jsfiddle.net/TcqAf/184/ tested with Firefox 42.0\n. @tedwong The quick fix was using codemirror/addons/display/autorefresh and autoRefresh: true, as mentioned in https://github.com/codemirror/CodeMirror/issues/3098#issuecomment-147022207\nI later fixed it by initializing the editor at a later point in time, when the page rendering was more complete. I don't remember the specifics.. ",
    "tedwong": "@dcsaszar  did u solve the issue?. ",
    "bitbeans": "n1 thank you very much!\n. ",
    "sccolbert": "I was referring to this function:\nhttps://github.com/codemirror/CodeMirror/blob/master/lib/codemirror.js#L3413\nI was concerned about the  clientHeight and clientWidth reads causing unnecessary reflow but didn't see that they would only be called at 100ms intervals.\nThis is a non-issue. I apologize for the noise.\n. Cheers!\n. ",
    "andrewray": "Wonderful - thanks!\n. ",
    "doppl3r": "Hi marijnh, could you point me in the direction in which I can prevent the default scroll options? Is there a certain file I can change/include this code? What should the code look like?\nThis 12-20 line hop (based on font-size) is tempting me to migrate back to notepad++ haha\n. Perhaps this is a newb question, but does this go into the brackets.json file?\nex:\n{\n    \"themes.theme\": \"darcula-theme\",\n    \"fonts.fontSize\": \"11px\",\n    \"livedev.multibrowser\": true,\n    \"wordWrap\": false,\n    \"closeBrackets\": true,\n    \"styleActiveLine\": true,\n    \"scrollAmountY\": {\"size\": 1, \"unit\": \"lines\"}\n}\nI assume 'no' would be the correct answer because i'm still skipping many lines on mouse scroll.\n. ",
    "lukas-vlcek": "Because I need cm instance and did not find other way how to get hold of it. IIRC it should be possible to pass it via second options argument too but I do not know how to do it. Moreover, passing it via generic map is less type secure in my case (I am using Closure Compiler thus I prefer the option to benefit from \"strongly\" typed arguments if possible).\nMore specifically, the reason why I think I need cm instance is that I want to get start and end position of errored token. The parser error can give me any position inside the token, but I want whole token to be underlined in editor.\nHere is (pseudo-code) of what I do:\njs\nCodeMirror.registerHelper('lint', 'json', function(text, options, cm) {\n    try {\n        someParser.parse(text);\n    } catch (error) {\n        var actualToken = cm.getTokenAt(cm.posFromIndex(error.offset));\n        return [{\n            'message': error.message,\n            'from': CodeMirror.Pos(error.line, actualToken.start),\n            'to': CodeMirror.Pos(error.line, actualToken.end),\n        }];\n    }\n});\nMay be there is better way of doing it?\n. Thanks.\n. ",
    "markrian": "What an incredibly fast turnaround for a ticket! Amazing. Thank you.\nAs for the docs, it's not just \\t that's missing, it's also the character range \\u200b-\\u200f, and the (admittedly redundant) global flag. Are these also intentional?\n. ",
    "eranimo": "What about this?\nhttps://code.google.com/p/lite/source/browse/trunk/Lite/web/doc/codemirror/jsx.js?spec=svn1482&r=1482\nI've tried using it, but I get an error: Uncaught RangeError: Maximum call stack size exceeded\n. ",
    "weblogixx": ":+1: Would also love to see this feature.\n. ",
    "baconbrad": "+1\n. I think CodeMirror is working correctly and the problem is your code.\nWithout seeing the rest of your code these recommendations may either be correct or wrong depending what you are wanting to achieve. If you really don't want to return a value and just do a return maybe try one of two options: return void which is like returning null or continue instead of returning nothing. Or you may want to return true or false. Either way using the return keyword is optional. However if you use return Groovy expects you to actually return something. In this case it looks like you are using return in order to break the each loop which is in itself not a recommended practice.\n. Thanks @marijnh , that did fix the issue. But is there a reason .CodeMirror input { font-size: inherit } or something like it isn't shipped with codemirror.css?\n. Are you referring to code folding?\n. There are a small handful CSS4 classes supported on most modern browsers such as Placeholder pseudo-class, Scope pseudo-class, Matches-any pseudo-class, Range pseudo-class and a few others. But there is still a lot of the spec not yet implemented.\n. Just so you know there are complications to using Allman style curly braces with JavaScript. JavaScript engines have ASI (automatic semicolon insertion).\nSo\njavascript\nreturn\n{\n    a: \"A\",\n    b: \"B\"\n};\nGets interpreted as\njavascript\nreturn\n. Yup, you can return it using:\n``` javascript\nvar obj =\n{\n    a: \"A\",\n    b: \"B\"\n};\nreturn obj;\n```\nJust figured I would let you know. ASI is typically why Allman is not used in a lot of JavaScript projects. I am unsure if that factors into why CodeMirror handles it this way though.\n. ",
    "Ore4444": "+1\n. ",
    "pcostanz": ":+1: \n. ",
    "jquense": "this has driven me crazy for months I finally broke down and just wrote a better mode\nhttps://gist.github.com/jquense/265b46c740da4d20a718\nIt doesn't handle jsx expressions as well as I'd like (see comments) someone smarter than me, please improve it!\n. @kidwm please do! the current issues with my approach is tracking the inline jsx expressions right now it just works when the js starts and ends on the same line. I've tried more nuanced attempts at it (tracking brackets in state) but haven't had the time to solve the issues there. \nI'd be great if you took a whack at it :) \n. :tada: WOOHOO! Thanks so much @marijnh\n. ",
    "TimothyGu": "This should be closed after b3f9487046e37facd64196380ebdd8639efc57b5.\n. Fixed all comments.\n. > Could you explain this header format (\"Author: ...\", etc)? Isn't the author/date/commit style metadata tracked outside of the commit message? Why would you want to put it in there?\nThey are technically outside of the message proper, but I think git show --format=fuller is a case legitimate enough to warrant a place in the general Git mode.\n. So I assume that there will be a set of \"official\" modes/addons/keymaps that are recommended by CodeMirror? (edit: perhaps these selected few will be present on minification helper?)\n. Derp\u2026 fixed.\n. Hmm you are right. However, is there a way to look ahead to the next line? Something that would make endDef recognize\nc\ntypedef a b\n;\n?\n. A word boundary: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#special-word-boundary or http://www.ecma-international.org/ecma-262/6.0/#sec-assertion\nI'm just trying to fetch the next word/token.\n. ",
    "rsmith31415": "Well, if you look at the second image above, line 8 is being cut off. Let me show you a bigger screenshot:\n\nI don't think the logo and \"Other demos\" field are a big problem because that's page dependent, but the last line of code is missing from the CodeMirror box when your input is short enough to be displayed without scrollbars.\n. I was tinkering a bit with min-height in the Ipython notebook and this has a positive effect in the print preview, but I think I needed to increase the height of empty CodeMirror boxes to display the last line of code correctly. Something like this:\n\nMaybe all it takes is an adjustment to the CSS and/or an additional media query targeting the print preview.\n. ",
    "adammartin1981": "If there is a better way that I've missed to circumvent this issue then feel free to tell me, I was looking for some kind of Widget.updateData method but couldn't see one.\n. Didn't test fully whilst typing - please ignore\n. ",
    "flying-sheep": "eh, and how can i help to debug it?\n. cool! but seems like it\u2019s actually 0e4c156a9ab63dcbc5fa9f60ada54e3c5d5ad03b. that was fast \ud83d\ude06\nalso check out the PR number!. ",
    "lackneets": "I have the same problem. \nHere I found a hack solution: not pretty well but works\nhttps://github.com/zhusee2/codemirror-composition-mod\n. ",
    "episodeyang": "Hey guys:)\nHas there been any update on this? If Jacky's solution is good, maybe we can incorporate it into the core code base?. Hey @Marijnh! How is it going : )\nYeah, that sound reasonable. I will wait for these updates:). ",
    "zxl777": "+1  I am waiting for these updates too ;). ",
    "EveLuty": "is there anything new for that ? I found that problem also in my project.. if there are some update, it will be great. :+1: . ",
    "barretlee": "How is it going? seems still not working.. textarea input style has lots of other problem, such as cannot select words.\nI have an idea, we do not hidden textarea, rather put it under the rendered div, set opacity to 0, it may resolve the selection problem .. ",
    "gfx": "The same in iOS Safari with Japanese IME.. With inputStyle: \"textarea\", IME works well, but the native cursor for textarea also displays in addition to the CodeMirror cursor.\n\nThe black one is CodeMirror's cursor while the blue one is the native textarea's.\n. When an editor is implemented in TypeScript + React (with SSR), import * as cm from \"codemirror\" has two meanings:\n\nLoads the codemirror library\nRefers the @types/codemirror .d.ts file\n\nIn order to use @types/codemirror,  I'd like to import codemirro in the top level in a React component; that is, compile-time Universal JavaScript makes sense.. Thanks. Right. How about e9d3f1e3? (as long as I tried, browser.js seems not to be available for addons). ",
    "inductor": "What's up with this issue? :s. ",
    "mhlx": "thank you @zakahiro. ",
    "liquibyte": "I patched my local version and that did fix the space replace undo issue, however the actual undo functionality of the menu is now disabled in its entirety even though the menu choice is enabled.  Ctrl-z works as expected so not really a show stopper for me but I imagine it could be to those not familiar with the keyboard.\nI don't envy you having to try and support so many browsers.  Good work by the way.  I'm using this in a microblog project I'm writing because, as far as I can tell, there's no way to syntax highlight a textarea without javascript or messing with the DOM on a level I'm not willing to explore at the moment.  I'm still having a hard time figuring out how to integrate require.js into everything as I'd like to have highlighting for many languages available.  Javascript is not my strong suit.\n. Yep, that works.  I should really take a look at FF source one of these days but it's so big and unwieldy.  It doesn't even compile on Gentoo by default without a lot of work, but the same could be said of Chromium as well due to webkit issues.\n. I hate to do this to you but I found another bug that is a result of the patching.  Copy and paste no longer works from the menu.  I get our nonsense character back now \"\u21da\".\n. That seems to have fixed it in Firefox.  The behavior didn't manifest in Opera or Chrome originally but I can verify that the undo menu selection in the webkit browsers isn't working right after the patch.  If you copy and paste and then undo, nothing happens.  It works as expected in FF though.\nI'll keep my eye out for unexpected behavior as I test out my project on various browsers.  Right now I'm just working with FF mostly with the occasional test for odd rendering quirks in Opera and Chrome to make sure that everthing looks right but I'm working with PHP so I don't have to worry about anything other than my own css goofs.  I don't use Window or plan on testing in IE.  I went through that fiasco the first go around and decided to just not support it with special attention, if it works, it works, if it doesn't it's their fault.\nI plan on doing a test page for each language once I get require working.  I've mapped out the dependencies so I can load each one but it's been slow going as I'm not that familiar with it so I'm having to learn how it works.  I can add to the documentation with detailed examples once I get done if you'd like.  The short example given in the codemirror documentation wasn't all that helpful as it assumes a basic knowledge of require.  I've not really worked with javasript all that much but can muddle through.  I did the drag and drop fixes on the Flatpress admin panel a year or two ago.\n. ",
    "oslyak": "My not very smart implementation with jQuery, but works. ;-)\nWorks only with top panels and panel should have classes: \"cm-panel top\"\n```\n// codemirror/fullscreen.scss\n.CodeMirror-fullscreen {\n  position: fixed;\n  top: 0; left: 0; right: 0; bottom: 0;\n  height: auto;\n  z-index: 9;\n  padding-top: 40px;\n}\n.cm-panel.top.cm-panel-fullscreen {\n  position: fixed;\n  z-index: 10;\n  top: 0; left: 0;\n  width: 100%;\n}\n// codemirror/fullscreen.js\n.....\n  function setFullscreen(cm) {\n    var wrap = cm.getWrapperElement();\n    cm.state.fullScreenRestore = {scrollTop: window.pageYOffset, scrollLeft: window.pageXOffset,\n                                  width: wrap.style.width, height: wrap.style.height};\n    wrap.style.width = \"\";\n    wrap.style.height = \"auto\";\n    wrap.className += \" CodeMirror-fullscreen\";\n    $(wrap).siblings(\".cm-panel.top\").addClass(\"cm-panel-fullscreen\");   // This string added!\n    document.documentElement.style.overflow = \"hidden\";\n    cm.refresh();\n  }\nfunction setNormal(cm) {\n    var wrap = cm.getWrapperElement();\n    wrap.className = wrap.className.replace(/\\s*CodeMirror-fullscreen\\b/, \"\");\n    $(\".cm-panel\").removeClass(\"cm-panel-fullscreen\");  // This string added!\n    document.documentElement.style.overflow = \"\";\n    var info = cm.state.fullScreenRestore;\n    wrap.style.width = info.width; wrap.style.height = info.height;\n    window.scrollTo(info.scrollLeft, info.scrollTop);\n    cm.refresh();\n  }\n```\n. ",
    "hankduan": "Thanks for the quick response! Can you provide a little more detail regarding why \"it has to\"? i.e. what behavior is it trying to prevent? \n. ",
    "Scorpiion": "@kasperpeulen sounds like great features :+1: \n. Any specific reason for closing this issue @marijnh? \n. Got it, I can understand that, good to clean up the list every once in a while. \nPull requests are welcome but you want to keep the issue list as clean as possible, that's cool, keep up the good work! :+1: \n. ",
    "AJDBenner": "Seems to be working perfect using that demo, sorry about that\n. ",
    "ju1ius": "\nIf you are contributing to a project it is generally a good idea to look at the code style it uses, and conform to that.\n\nSorry for that. I did read CONTRIBUTING.md, but the \"double-equal\", \"double-quotes\", \"multiple-vars\" et al. weren't mentioned. Maybe the contributing notes should be a little more specific about this ?\nThanks for your time !\n. ",
    "petitben": "Sorry didn't notice the presence of the forum...\n. ",
    "infin80": "It does work OK in Chrome on Mac (albeit looking like its gonna copy all the text) but not in Brackets.\n\n. That behavior is perfectly normal if i understand it correctly. The cursor has a plus sign which should mean I can copy with the option key but I know you guys tried (or will try for that) later.\nFound this online and thought how cool it would be to have....While editing a file you can set multiple carets by holding Ctrl (Cmd for Mac) and clicking where you want them to be, thus allowing you to write in many places at once.\n\n. If CodeMirror has that, is there a way to activate that feature (and poss others) in Brackets?\n. ",
    "nethip": "@infin80 Are you sure you tested this on chrome. Because it looks like you have tested this in safari as I get the similar drag effect in safari but not in Chrome on Mac.\n. Thanks @marijnh for the patch. We have tested your patch and the selections are much better. However, we have seen some selection issues. \n\nUnable to select the last character without using the keyboard. Please refer to the video below.\n\n\n\nUnable to select text from right side. \n\n\n\nUnable to select just text without selecting the opening and closing tags\n\n\n. Thanks @marijnh for detailed explanation.\nRegarding the first bug, we found that the selections are much better now. But sometimes selection of plain RTL text is not getting shown. Here is a video for the same. I am not sure if it is again related to RRRLL case though.\n\n. Sure @marijnh. Please find the file attachment. I am using chrome browser to test the scenario. And also I am using the indentwrap.html demo from master to test it.\nArabicSelection.zip\nThe problem that I had reported above can be seen on line no: 70.. @marijnh That was super fast \ud83d\udc4d Thanks for the patch! I will try out the new fix and update my findings. Thanks!. @marijnh I validated your patch and here are my findings. \nThe problem looked to be fixed. And even the selection not happening with the last character seems to have got fixed. Thanks for the quick fix \ud83d\udc4d \nI am seeing the following issues\n1) I am seeing a hang with the following workflow.\n\nI figured out that cm is going into an infinite loop at the following place.\n\nComing back to the original issue, third one in https://github.com/codemirror/CodeMirror/issues/4926#issuecomment-326559127, reported above, I see that there no way I can selectively select just part of the text, in some scenarios. I checked the behavior with native textarea in  chrome and found a similar behavior. However I found that the user can somehow select the desired text, which is not possible with the current version of cm. Here is a video capture of selections inside textarea. I think if we can have this behavior in cm, the selection issues w.r.t RTL text should go away.\n\n. @marijnh Thanks for looking into it! I will try out the new fix and update you.. @marijnh I have tested new patch. I am still seeing the hang upon selection of text in line no 68. I am try to select the text after the  tag and and upon reaching COMPANY, the hang is still happening.. @marijnh I cloned the repo again and built using 'npm run-script build'. I am running into the same issue.\nHere is a video recording of what I doing.\n\nI am on 5c087ac4e4fab2b3d9510caa006616535a207ff6. Thanks for pointing me to the right branch @marijnh . I thought this patch, to do with infinite loop, made it to master. \nI did play around a bit with the branch. I took all changes from master and merged them to coordsCharInner locally to test out. I can see that the hang is gone. \ud83d\udc4d . I can also see that now the selections shown represent the actual selections inside cm.  However I see 2 issues.\n\nSelections when starting from LR or RL boundaries are getting inverted. I am not sure if this falls into the same category, you had explained about in https://github.com/codemirror/CodeMirror/issues/4926#issuecomment-326801167\n\n\n\nSelections are not predictable. When selecting the same block of text I am seeing different selections being set.\n\n\nI want to thank you for taking my feedback and incorporating the required changes.. @marijnh Sure! I will update the master and start testing.. @marijnh I have updated the master branch on my system and I see that all issues are resolved except for one. On line 71, when I am trying to select the entire block inside <p>, I am not able to select the text between <p> and COMPANY. Please see the video below.\n\nAlso I cross checked the behavior with textarea and barring the above issue, everything is working on par. \ud83d\udc4d . Thanks @marijnh for fixing this! I checked all the scenarios and I am happy to say that all of them seem to be fixed now \ud83d\udc4d  I will run them through our team again to see if anything comes up.\nAppreciate all your efforts in addressing these issues!\nI have some queries regarding how I would want to integrate these changes to Brackets repo. Would be great if you can help me out with these.\n1) Brackets was linking CodeMirror as submodule earlier.  So if I had to integrate specific changes I could cherry pick few commits and update the SHA of the submodule in our repo. Recently we have gone the npm way to integrate cm to with Brackets. Since there are no git references in npm distributable, I have to recreate the distributable by cherry picking commits, that fix specific issues addressed in this thread on top of what we currently at (We might not want to be on master yet as we are already on the verge of our next release). Could you tell me what is the process for creating a distributable zip for posting cm updates to npm?\n2) I am trying to see the testing impact. Could you tell me if these changes are very specific to RTL text? . Thanks @marijnh that helps!. Apologies for late reply. \nI will log a bug with the Chrome team for this. Thanks!. FYI: I have logged a bug with the chromium team for this. \nhttps://bugs.chromium.org/p/chromium/issues/detail?id=740937. @marijnh It is about recognizing multiple types of block comments. In JSP, a comment could be <!-- --> or <%-- --%>. Please refer to the example below. There are two types of comments used.\n```\n<%@ taglib uri=\"/WEB-INF/tld/org.tld\" prefix=\"TheOrg\" %>\n<%@ taglib uri=\"/WEB-INF/tld/portal.tld\" prefix=\"wps\" %>\n<%@ taglib uri=\"/WEB-INF/tld/portal-content-ext.tld\"  prefix=\"content\" %>\n<%@ taglib uri=\"/WEB-INF/tld/engine.tld\" prefix=\"wp\" %>\n\n\n\nLorem ipsum dolor sit amet, consectetur adipisicing elit. Quas maiores, in aliquid provident ab cupiditate laudantium. Voluptas, numquam voluptates error minus dolorem hic nemo? Reprehenderit veniam ratione magnam beatae id.\nLorem ipsum dolor sit amet, consectetur adipisicing elit. Sed quibusdam accusamus sunt alias facilis earum voluptate enim, quia sint facere deserunt hic, culpa nam odio. Accusantium et repudiandae amet dolor.\n The below <p></p> should be greyed out similar to this comment  \n<%--Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repellat, odit, nulla. Et similique fugit vero, enim minima laborum accusamus, obcaecati atque magni illum reiciendis optio, consequatur nihil fuga sed numquam.--%>\n\n                \n\n\n```. Thanks @marijnh I will validate the fix.. Awesome! I just validated the fix it is working. Thanks for the quick turnaround. Can you tell us when is the next release of CodeMirror planned, so that we can update our dependencies to be pointing to the new release?. Thanks @adrianheine for the information. We will plan our integration accordingly.. ",
    "kasperpeulen": "@marijnh thanks for your response :)\nI didn't think about that case. I've been trying to play around with your example, at dartpad, but this issue seems to also exist at dartpad without removing that line:\n\nTo reproduce, here is the screenshot taken: http://dev.dart-pad.appspot.com/9126d5d48ebabf5bf547\nEdit: This seems to be caused by something different, I can now reproduce what you mean if I remove the line:\n\nThis doesn't happen when I don't remove the line.\n. @marijnh I I change this line\nif (completion.widget) completion.widget.close();\n for (as you suggested)\ncompletion.cm.removeKeyMap(completion.widget.keyMap);\nboth problems seem to be solved.\nOnly now you have that if type to fast and press enter, you really will press enter, which may not be what you expect in a completion popup. It may be nice to prevent the default behaviour of tab and enter in this case. Something like this seems to work.\njavascript\nfunction activity() {\n  clearDebounce();\n  var pos = completion.cm.getCursor(),\n    line = completion.cm.getLine(pos.line);\n  if (pos.line != startPos.line || line.length - pos.ch != startLen - startPos.ch ||\n    pos.ch < startPos.ch || completion.cm.somethingSelected() ||\n    (pos.ch && closeOn.test(line.charAt(pos.ch - 1)))) {\n    completion.close();\n  } else {\n    debounce = requestAnimationFrame(update);\n    completion.cm.removeKeyMap(completion.widget.keyMap);\n    completion.cm.addKeyMap(completion.widget.keyMap = buildKeyMap(completion, {\n      pick: function() {}\n    }));\n  }\n}\n. @marijnh thanks, that patch solves it for me :)\n. ",
    "jonty-comp": "I minified codemirror + css.js + javascript.js + xml.js + htmlmixed.js and I get this issue.  It doesn't happen if I omit xml.js.  My tabs are tooltipped as \\u9 and spaces as \\u20.  \nIf I cut and paste all the above files into an unminified JS file, then it works fine with my database-driven fields. Therefore, I can only assume that xml.js is being minified incorrectly somehow!\nEDIT: if I paste my unminified concatenated file into jscompress.com and try the output from that the problem returns!\n. ",
    "cassareh": "Yes good point, it is a poor fix as your example illustrates, however that aside, do you see an issue with match as it is implemented today or am I thinking about it incorrectly?  As I currently understand the match function, it would still perform incorrectly in some cases even if the regexp starts with ^.  \nConsider this simplified example mode object with token function defined as follows.  The intended behavior is to find all matches on this line that satisfies the regexp.\njavascript\nvar modeObject = ({\n  token: function(stream) {\n    var pattern = /^test/;\n    while(!stream.eol()) {\n      if (stream.match(pattern, /* consume */ true)) {\n        return 'my-style';\n      }\n      stream.next();\n    }\n  }\n});\nIf pattern is set to /^test/ (what should be valid) and the underlying string in stream were \"test test test\", than this function would find three matches where only one is expected. match would find three  matches because it does a pattern match from stream.pos forward.  As the stream object is incremented, each call to match is handled as if it is the start of line and this behavior is what causes a regexp that starts with ^ to find additional matches. I am hitting this exact issue but with \\b.  Can you help clarify, am I using match incorrectly or is this an issue with the match function?\nThanks for your time! \n. Thanks, I follow your reasoning as I have also come across this limitation in javascript.  However I don't understand how a leading ^ in the regexp is any different from the leading \\b.  As far as I understand it, they are both meaningless as they will both always match.  It seems to me that a regexp should not be allowed to start with a [^\\b\\B] characters when using the StringStream.match() function.\nThat aside, I found a workaround for this limitation which could be used to make the StringStream.match() more general.  The String.prototype.replace() function allows passing a function instead of replace text.  It is possible to piece this together such that you can use str.replace() to find the offsets of all matches on a given line.  Here is a quick example:\n``` javascript\nfunction finder(match) { \n  console.log( 'Found match:' + match + ' at offset:' + arguments[arguments.length-2]);\n  return match;\n}\n\"hellohellohello hello Hello\".replace(/\\bhello\\b/gi, finder)\n```\n2015-04-06 10:51:58.375 Found match:hello at offset:16\n2015-04-06 10:51:58.375 Found match:Hello at offset:22\n\"hellohellohello hello Hello\"\nI am proposing that I can build a function which will use str.replace() to find the offsets of all matches on a line.  StringStream.match() can then use this function and its current position in the stream to determine if the current position is a match.  What do you think about this solution?  Should I continue forward with this?\n. Yeah, unfortunately as you know, index doesn't help in the case of a leading \\b in the regexp because it only returns the first match.  To use to find all matches on a line would require parsing the string as a stream which has the issues we already discussed, hence the work around I proposed above.\nHaving said that, I agree with you that the /y flag is the only clean solution and I can understand the reasoning behind waiting until it is available instead of introducing hacks or workarounds.  \nAlso I finally understand the reasoning behind the leading ^, thanks for explaining it.  It was confusing to me since the leading ^ doesn't affect the matches found as it normally would in a regexp. Instead the leading ^ is used only as a performance optimization, which wasn't clear to me until now.\nThanks again for taking the time!\n. ",
    "LloydMilligan": "I agree Marijn.  After uploading I realized the only reason for changing the color scheme was to make the editor look more like an accustomed one, which is pointless.\nAgain, thanks for  your time.\nBest wishes,\nLloyd\nFrom: Marijn Haverbeke \nSent: Sunday, April 05, 2015 6:46 AM\nTo: codemirror/CodeMirror \nCc: LloydMilligan \nSubject: Re: [CodeMirror] Create mumps.css (#3176)\nThis time it worked! But as I said in the other discussion, this is too specialized for the distribution.\n\u2014\nReply to this email directly or view it on GitHub.\n. ",
    "dunets": "@marijnh Hello, now i'm making an markdown editor based on codemirror and marked.js edited by me.\nI identify every image automatically, for example when someone write  it is replaced with editor.setValue(x) to {>ID OF IMAGE<}, but I don't want to see {>x<}. is possible to replace the text but placing {>x<} on span with specific class? or configure codemirror to put this : {><} on span automatically?\n. @marijnh Hello, yes, I will use markText, it's perfect  to what I want, and yes replaceRange is better,\nbut how I can localize {><}![]() on text and get number of line & char ? ex:\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce rhoncus non dui eu ullamcorper. In consectetur metus lorem, {><}![]() nec dapibus mauris tristique maximus. \n. Sure!\nThank you a lot!\n. ",
    "peebeebee": "This happens on Edge Mobile too. \n. I have the same issue on Edge [Windows 10 Mobile].\nAlso have the following issue: https://github.com/codemirror/CodeMirror/issues/4253\nSo these bugs might be related.\n. @marijnh : are you sure this solves the bug? \nI haven't checked myself, but I know the following JsBin does not alert while pressing backspace on Edge Mobile: http://jsbin.com/tomoyeliwu/\nSo it's not really a matter of the browser sending a backspace KeyPress on first sight. \n. Just checked it out, and it fixes the bug above. but as a whole it is still a buggy experience.\nI'll try to do some work on it when I have the time.\n. ",
    "libo": "I think we reach a mature support for the Handlebars language. \nPlease feel free to review.\n. @marijnh thanks a lot for feedback!\nI have applied all of them.\nTo answer your question, yes I believe that the best case scenario is to go in overlay with XML or so.\nShall we add it to the HTML demo? I felt like it was better to leave it isolated...\n. Awesome thanks!\nOverlay works and I am using it on a project, there is a small glitch with stuff like \nhtml\n<img src=\"{{ user.avatar.url size=\"small\" }}\">\nThat actually is valid Handlebars+HTML but the code linter report as error since the double quotes confuse it. \nThe issue is that the XML lexer swallow the entire content between \" \" and hence doesn't detect the opening of Handlebars mode's token \"{\". \n@ilkkao and me ended up patching the xml.js in our project to handle this, I was wondering if we could think of more flexible way to handle overlay in case like these or I misunderstanding something. \n. Thanks a ton @marijnh ! This is awesome!\nIs this going to be released in 5.1? How often do you release CodeMirror btw?\n. ",
    "ilkkao": "Like Libo said, XML mode treats quoted string as a single token and eats it. Could there be a \"escape sequence'\" option in XML mode (in this case '{{' that would stop eating the input and return a token immediately. That way the top level mode would get a chance to switch to an another submode. \n. ",
    "marcguyer": "That works for me. Thanks.\n. I wouldn't want that in mine. If you want that, why don't you just add it to your CSS? \n. ",
    "JasonBarnabe": "It's seems reasonable to me that the focus effect should match that of textareas, as CodeMirror looks like a big old textarea.\n. Ah, I was reading the manual and I thought that's what it was telling me to do. Thanks.\n. ",
    "Flimm": "BTW, for anybody stumbling upon this issue in Google, it seems that CodeMirror does now support bi-directional text:\nhttps://codemirror.net/demo/bidi.html\n. ",
    "noragrossman": "No, I should have, and researching multiplexing mode actually revealed that there is actually already support for JSP within the HtmlEmbedded mode, it was just not obvious at first. I am closing the pull request!\n. ",
    "satyapendem": "use editor.setSize(1000,1000);. Hiii, \nI have a codemirror div I used `$(code_div).each(function() {\n  var $this = $(this),\n  $code = $this.html(),\n  $unescaped = $('<div/>').html($code).text();\n  $this.empty();\n  CodeMirror(this, {\n    value: $unescaped,\n    lineNumbers: true,\n    theme: \"neo\",\n    readOnly: \"nocursor\"\n  });\n});` for syntax highlight. But I want a the text in that div in a arranged format I'm getting in a single. So how i can arrange that.\n",
    "petetnt": "@marijnh should the keybindings for Ctrl-Up and Ctrl-Down be consistent between the PC and MAC keybindings too? The current PC bindings for those serve no purpose what-so-ever.\nOtherwise thanks :+1: \n. Ah okay, that's what I though. \n. @marijnh oh okay, I see. Thanks for the prompt reply and especially for the control option!\n. Ugh, it's a browser bug: works on Firefox, doesn't on Chromium. \nRemember that old Chromium bug where this thing would happen with single lines? Something similar to codemirror/CodeMirror/issues/1474\n. In that Brackets issue I said the same, that => was correctly highlighted as .cm-operator but now that I think about it, it's never referenced to as operator but as arrow function (or similar) so it might make sense to highlight it as keyword instead (just like function is). \n. In my opinion @parisk is correct: An JSX mode should\n- Highlight all the known HTML elements\n- Highlight all the custom HTML elements\n- Highlight all declared JSX-elements\nConsider something along these lines:\n```\nimport FooComponent from \"./foo\";\nconst BarComponent => (props) => {\n  return Bar {props.bar};\n}\nclass Biz extends React.Component {\n  render() {\n  return (\n    \nThis is a foo component\n\n\n\n\n\n\n   )\n  }\n}\n```\nIn that example:\n1. h1 and div should be highlighted as XML-tags as they are known HTML elements\n2. x-my-component should be highlighted as it's a custom element (see JSX gotchas @ facebook.github.io)\n3. FooComponent and BarComponent should be highlighted as XML-tags as they:\n   - Are wrapped in a <\n   - Are declared in the file (one as a stateless component, one as imported component)\n4. ~~BazComponent should not be highlighted as it's not declared anywhere~~\nThis is a reason why I tried to go with a mixed mode approach initially, similar to http://codemirror.net/mode/htmlmixed/ -mode: this however is a dead end because JSX-attributes can be nested with pretty much anything (JSX-elements, JavaScript, XML...) infinitely. Similarly an overlay mode is a dead end of the same exact reason. \n. @marijnh Actually you are correct, I remembered that React would throw went it didn't understand the element but this doesn't seem to be the case, at least anymore. \n. This PR seems to support nested JSX/JSX as props  too right? Pretty impressive if so, especially as this is added to the JavaScript mode instead of new mode.\n@lkcampbell check this out\n. @dabbott Very cool, can't wait to get out of this bus I am in to test this out. We have been working on a JSX mode on and off for months but the nesting has usually been the Achilles knee in all of my implementations and @lkcampbell ran into it too just recently\n. Like discussed in #3742, I think this would need the XML-highlighting from #3742.\nFor this PR itself, template strings break the parser when used in props\nclass Foo extends React.Component {\n  render() {\n    const amount = 10;\n    return (\n       <Baz biz={`${amount} little piggies went to jail`} />\n    )\n  }\n}\n. I agree that direct JSXElements as props (such as <Foo bar=<Biz /> />) is a very low priority use case: like @dabbott, I have pretty much never seen them used like that, actually I didn't even know about it until I brainstormed with @lkcampbell about how CodeMirror could handle the props.\n. Thanks a lot @marijnh!. Thanks once again @marijnh! . ",
    "WulleBulle": "Please forget about my comment. It was a code error. Me stupid. Thank you very much again.\n. ",
    "JonasDoebertin": "Dang! Forgot about the tests...\n. ",
    "oswcab": "Done. Thanks for guidance. \n. Thanks and kudos for a great project!\n. That's right, thanks for noticing. I'll made a new pull request with this change.\n. Just a question... are you planning a 5.3.1 release? Or are you waiting to include this in 5.4?\nThanks\n. ",
    "stonefly": "the dialog will not disappear if it's in 'replace' mode, thus if the 1st line contains a matching it will never appear, i think amshali was right here\n. ",
    "amshali": "Uncaught TypeError: Cannot read property 'state' of undefined\n  function getSearchState(cm) {\n    return cm.state.search || (cm.state.search = new SearchState());\n  }\nI figured what's going on. Preparing a patch.\n. It still not working for me. I checked the modeUrl. It is correct. I mean it works for everything else. \nHere is a snapshot of variables. Seems like it does not like setting mode option set to \"text/x-gfm\". If I set that to \"gfm\" it will work. But then I cannot change my logic because it will break the clike mode.\njavascript\nCodeMirror.autoLoadMode(this.editor, mode); // mode = \"gfm\"\nthis.editor.setOption('mode', spec); // spec = \"text/x-gfm\"\n. Yayy! Awesome! Thanks a bunch.\n. I have to figure out a solid way of reproducing it. It might have nothing to do with CodeMirror, but I am not sure yet.\n. I was hoping we could continue doing those async jobs and hopefully get the results in the right place. \nI can add logic to my code to stop those async lints (or ignore their results) if the doc has changed.\n. Is it possible to trigger a lint event? I want to have control over when we lint or at least I would like to initiate it when I want.\n. OK, I will send a patch.\n. Thanks a lot!\n. @NessBird I am using this lint option and it works fine for me. I think I see what is wrong in your situation.\nYou should use it like this:\nlint: {\n        lintOnChange: false\n      },\n. @marijnh Thanks.\n. Define save. Define autosave.\n. I don't think there is any issue with CM here. \nThe issue is that when you run editor.focus();, the focus is actually on web console and not on the page.\nTry this for a change:\nsetTimeout(function() {editor.focus();}, 5000);\nImmediately, mouse click somewhere inside the page. You should see your log statement appearing after 5 seconds. \n. Using Chrome 53. This is a very bizarre behavior. I opened an incognito tab just to make sure it's not any of my settings and still doesn't work. That is on my laptop. On my desktop machine it works fine.\nI am gonna close this issue since it seems like something specific to my laptop. Sorry.\n. COND = !state.options.lintOnChange !== false\ntruth table:\nlintOnChange: undefined. Should lint on change? YES. COND is true. OK.\nlintOnChange: true. Should lint on change? YES. COND is false. ERR.\nlintOnChange: false. Should lint on change? NO. COND is true. ERR.\nAm I right?\n. OK, I'll fix that. Although this is meant to present the use of performLint in the following lines which performs lint every 5 seconds. Do you still think I should remove it?\n. I was very confused as a programmer so I wrote this program:\njavascript\na = {};\n// lintOnChange undefined\nconsole.log(!a.lintOnChange !== false);\na.lintOnChange = true;\nconsole.log(!a.lintOnChange !== false);\na.lintOnChange = false;\nconsole.log(!a.lintOnChange !== false);\nwhich generates this:\ntrue\nfalse\ntrue\nAm I missing anything?\n. I am not making this up. The (current) following code does not do what it is supposed to do. You can try it yourself. \nif (!state.options.lintOnChange !== false)\n        cm.on(\"change\", onChange);\nI know about precedence of operators. The correct condition is really:\ncm.state.lint.options.lintOnChange === undefined || cm.state.lint.options.lintOnChange === true\n. Or that. Thank you.\n. ",
    "flehoux": "My bad, app wasn't fetching the latest .css file from node_modules. Who knows which css version we we're running with^^\n. ",
    "vmx": "I've updated the original comment to contain the correct link.\n. ",
    "oscarotero": "Well, I've found the issue.\nSeems that there is a conflict on configure the path of codemirror in requirejs and the mode scripts, and this causes that codemirror is loaded two times. \n``` js\nrequire.config({\n    paths: {\n        \"codemirror\": \"../bower_components/codemirror/lib/codemirror\"\n    }\n});\nrequire(['codemirror', '../bower_components/codemirror/mode/htmlmixed'], function (codemirror) {\n    //this instance of codemirror is not the same than the one loaded by htmlmixed.\n});\n```\nI don't know if it's an issue of codemirror or requirejs (I've found some issues related with relative urls, for example https://github.com/jrburke/requirejs/pull/1263)\n. I think it can fixed loading codemirror as a module id, instead relative path. This is something that do all jquery plugins, for example: https://github.com/MiniPlugins/minitabs/blob/master/src/minitabs.js#L10\nSo, in this code: https://github.com/codemirror/CodeMirror/blob/master/mode/javascript/javascript.js#L10\na possible solution should be:\njavascript\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(...)\nSo the user only have to define the path of codemirror module.\n. Yes, I'm agree it's not a perfect solution :smiley: . I hope requirejs fixes this soon.\nThanks anyway.\n. Hi again. I finally resolved this issue in a more elegant way. Requirejs has a package config for this things. More info here: https://github.com/jrburke/requirejs/issues/1345#issuecomment-105609735\nIt should be great add this to the documentation.\n. Currently in the documentation there is this code:\njs\nrequire([\n    \"cm/lib/codemirror\",\n    \"cm/mode/htmlmixed/htmlmixed\"\n], function(CodeMirror) {\n    CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n        lineNumbers: true,\n        mode: \"htmlmixed\"\n    });\n});\nThis works fine in cases where codemirror is placed in the same folder than the main js file (in this case, in \"cm\" subdirectory).\nIf it's placed outside, for example in bower_components, the path to use must be relative:\njs\nrequire([\n    \"../bower_components/codemirror/lib/codemirror\",\n    \"../bower_components/codemirror/mode/htmlmixed/htmlmixed\"\n], function(CodeMirror) {\n    CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n        lineNumbers: true,\n        mode: \"htmlmixed\"\n    });\n});\nThe problems begin when we need configure the location of the used modules. Requirejs has \"paths\" config for individual cases, but for packages like codemirror, there is the \"packages\" config:\njs\nrequire.config({\n    packages: [{\n        name: \"codemirror\",\n        location: \"../bower_components/codemirror\",\n        main: \"lib/codemirror\"\n    }]\n});\nNow we don't have to put the full url, just the package name:\njs\nrequire([\n    \"codemirror\",\n    \"codemirror/mode/htmlmixed/htmlmixed\"\n], function(CodeMirror) {\n    CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n        lineNumbers: true,\n        mode: \"htmlmixed\"\n    });\n});\nAnd this works fine in all cases, so I think this is the better way to use it. I'll put the packages config example in the documentation as the best way to use it with requirejs.\n. yes, exactly :)\n. ",
    "theclapp": "Thank you for your quick attention to this issue.  I think your solution is suboptimal, at least with respect to the documentation of defineEx():\n\ndefineEx(name: string, ?prefix: string, fn: function(cm: CodeMirror, ?params: object))\nDefines an Ex command, and maps it to :name. If a prefix is provided, it, and any prefixed substring of the name beginning with the prefix can be used to invoke the command.\n\nEverywhere else in the documentation, an optional parameter could just be omitted, not set to undefined.  I think the check of arguments.length that I mentioned earlier would be a better solution.  That said, there certainly may be other constraints of which I am not aware, so certainly please do as you see fit.\nI also note that functions in the CM documentation with optional arguments in the middle of the arglist are rare; the few I could find are all in the Vim API.\nThanks again for your time!\n. > That's not entirely true. If there is more than 1 optional parameter, and you want to set the second optional parameter, the first can't be omitted.\nThat's a good point, and not one I'd considered.  Sorry about that.\n\nI only recently managed to document them.\n\nThank you for doing that, by the way!\n\nI can, however, revert my last commit and instead update the documentation to say that the prefix is required, if you prefer.\n\nThank you for the offer.  You're the maintainer, you should do as you think best.  But if you're asking me, and apparently you are :) , I'd say keep your last commit and update the documentation to say you can pass any falsy value (or whatever's actually appropriate; I know in documentation you have to consider all the angles, which might not be apparent to me (like in your point above :)) for the prefix to default it to being the same as the command name.\n. Awesome.  Thanks!\n. ",
    "yelvert": "Well, yes, the demos work, and after some digging I realized that the fix I did here https://github.com/yelvert/CodeMirror/commit/714cf11e6cc7d2aea96f51b6dbb0d9ccf178f689 to fix  is what caused the context menu yo stop working correctly. So my real issue is the text box showing up when right clicking and never going away. If I need to create a new ticket I will.\n. It seems like Chrome doesn't respect the position: absolute when it gets changed back in the rehide function.\n. I have added opacity: 0 to the textarea and everything seems to work. Anyone know of any issues it might could cause?\n. I haven't been able to figure out what causes this bug to manifest. I can tell you that where this bug shows up for me, that the screen shot above is from, is deeply nested inside several absolute positioned elements several of which are animated. I can actually cause this bug just by setting the textarea's position to fixed, then changing it back to absolute, with 0 right clicks.\n. ",
    "Veejay": "I'm experiencing the same issue. The demos on CodeMirror's website are fine (I have copy/cut/paste in the context menu), but in the editor we use in our application, no dice in any browser. Is there a workaround I could use to work around this issue? Thank you.\n. ",
    "roelvanduijnhoven": "I can reproduce this in Chrome using the example given in #2154 (http://output.jsbin.com/ihunin/328/). Thus that is not only a FF bug.\nThe editor is in my case in a modal screen which has transform CSS options. When I move the editor out of the modal screen it does work.\nAny clue? I guess using a CSS transform should not remove copy/paste functionallity.\n. Mm that sucks :/. Thanks for helping me out here!\nThe thing is: my use case is pretty normal (I guess) as I am rendering Codemirror inside of a Bootstrap modal. The modal-dialog class uses a transform of translate3d(0, 0, 0) (new versions use a 2d transform; but they fail as well).\n. And.. it's gone! That totally fixes the problem. Thank you very much for helping out. Once new release lands I'll update.\nPS. also thank you for your awesome book that I'll pass around to new faces at our company ;)\n. ",
    "ryandemmer": "I have had to revert this fix - https://github.com/codemirror/CodeMirror/commit/dfeafe0c14478404288dc1f188a0b54baf0f40d5 - when loading CodeMirror inside an iframe.\nDoes anyone else experience this?. ",
    "jerivemo": "Hi, I have the same problem!! Any have a good solution!!!\n. ",
    "chrisyip": "Same issue here, we're using CodeMirror with ui-codemirror.\nDon't know how to reproduce, but will submit a test HTML when I can reproduce it.\n. ",
    "rathboma": "Yeah sorry, sloppy habits :-/\nMatthew\nplease excuse typos - sent from my phone.\nOn May 11, 2015 1:42 AM, \"Marijn Haverbeke\" notifications@github.com\nwrote:\n\nClosed #3250 https://github.com/codemirror/CodeMirror/pull/3250.\n\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3250#event-301443096.\n. Yes I found the suspect, it was vimium\n\nMatthew\nplease excuse typos - sent from my phone.\nOn May 14, 2015 09:55, \"Marijn Haverbeke\" notifications@github.com wrote:\n\nThis does not happen in the demos (at least, not on Chrome), so I suspect\nit is some other local code you have that is doing this, or it only happens\non a specific browser and you didn't give away which one you are using.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3260#issuecomment-102061841\n.\n. \n",
    "bedney": "Yea, this is how I used CM for years and it worked well. Multiple editors, each in their own iframe, no problem.\nUnfortunately, the app I'm currently building is more sophisticated and requires me to be able to move the editor around in the DOM (not visually move it - reparent it within the hierarchy). Whereupon I ran smack into these bugs:\nFirefox: https://bugzilla.mozilla.org/show_bug.cgi?id=254144\nWebkit: https://bugs.webkit.org/show_bug.cgi?id=13574\nAs you can see, these are old bugs and are marked as invalid/wontfix. So I don't forsee a future where the browser vendors are going to support moving an  around in the DOM.\nThis does bring up an interesting point, though: does CM have other shared/global state that it is counting on such that it only anticipates having one instance per window? I've actually have multiple instances running in the same window with this patch and it seems to work ok - I haven't run into any issues so far, but maybe I'm getting myself into trouble here and don't know it yet :-).\nThanks for taking a look at this and thanks so much for CodeMirror. I have worked in browsers for 15+ years and I can tell you that it is a most impressive piece of software.\n. Marjin -\nSorry, I actually am conflating two scenarios here. Before I explain, let me state that both of these are Single Page App scenarios.\nThe first scenario, which I no longer do, is I would use an  just to hold one CodeMirror instance - all of the other GUI itself would be drawn in the main window around it. This was done to isolate CodeMirror from the code executing in the main window, since I was unsure about its effect on CodeMirror.\nAs it turns out, that was unnecessary. Both CodeMirror and that body of code were well behaved enough to share the same JavaScript context.\nThe second scenario is that recently I inherited a codebase wherein the code executes in the main window, but the GUI is drawn into a second window (an  that is stretched across the main window at width: 100%, height: 100%;)\nThis is done so that the 'GUI window' (the ) can be completely flushed without affecting the JavaScript 'state' of the running application. Therefore, if you look through the code for this app, there are almost no references to the window and document globals (since that wouldn't make sense - those are not where the GUI is being drawn). The window and document references are always derived from the element reference.\nMy version of CodeMirror is running fine in that environment (code loaded into main window, GUI drawn in GUI iframe) with these patches that I have made (which simply derive the window/document from the element rather than using window & document).\nI hope that clarifies things. Any thoughts on this?\nThanks again!\n. That sound excellent, @marijnh! Thanks! And thank you for CodeMirror!\n. @marijnh - I've attached a bounty to this issue, partly because I need it soon and partly because I've been using CodeMirror for so long and haven't contributed to it's development.\nThank you and thank you for CodeMirror.\n. @marijnh -\nIt meets my needs for now while awaiting the official patch and communicates my needs.\nIt's curious that that the tests seem fail on the statement of obtaining the window reference via place.ownerDocument.defaultView, which is a standard DOM way of obtaining the window from a supplied Element.\nCheers,\n- Bill\n. ",
    "cithukyaw": "There is another proof of this with HTML in a Ruby file. As I said in the referenced issue, back-indents are happening not only in switch.\n\nYou might notice that the first paste of the line 29 and 30 is no problem, but the line 31 to 34 got the problem of auto back-indents.\n. ",
    "tjanson": "Thanks for the bookmarklet tip!\n. ",
    "k0nserv": "I have this problem with Jupyter, is there a way to persist the changes so that they don't have to be redone on load?\n. ",
    "mercutiodesign": "@k0nserv Not sure if you're still looking for a solution but I just had the same problem as you. After researching I found out that you can create a jupyter custom.js file in your jupyter custom config location (for me it's at ~/.jupyter/custom/custom.js).\nI also deleted the Alt-B key-binding (for the + sign):\ndelete CodeMirror.keyMap.emacsy[\"Alt-F\"]; \ndelete CodeMirror.keyMap.emacsy[\"Alt-D\"]; \ndelete CodeMirror.keyMap.emacsy[\"Alt-B\"];. ",
    "DelightRun": "Of course, the page is on http://changxu.wang/test.html.\nOh, by the way, my browser is Safari with Mac OS X 10.10, and when I use Chrome, the problem disappear.\nBut the offical demo is OK with my Safari\n. Thank you for your solution, it works! Thank you very much..\nAnd, I\u2019m agree with @Marijn Haverbeke: we can set font-family of .CodeMirror in codemirror.css to a specific monospace font like Source Pro or Courier.\nShould I submit a Pull Request for that?\n\n\u5728 2015\u5e745\u670813\u65e5\uff0c\u4e0b\u53489:32\uff0cMarijn Haverbeke notifications@github.com \u5199\u9053\uff1a\n@mightyguava https://github.com/mightyguava We could set up the vim mode to force the width of the cursor(s) to be the actual width of the character they are on top of after every selection update. It's more expensive, but should give better results.\n\u2014\nReply to this email directly or view it on GitHub https://github.com/codemirror/CodeMirror/issues/3256#issuecomment-101664401.\n. @marijinh OK, I just didn\u2019t realize that it\u2019s a Safari's Bug. Thanks for your help again.\n\n@Yunchi Luo Is there a possible to let CodeMirror\u2019s Vim Mode support some font\u2019s, i.e. Chinese characters?\n\n\u5728 2015\u5e745\u670813\u65e5\uff0c\u4e0b\u53489:49\uff0cYunchi Luo notifications@github.com \u5199\u9053\uff1a\n@DelightRun https://github.com/DelightRun I believe @marijnh https://github.com/marijnh means to have vim mode use the actual width of the character the cursor is on top of instead of relying on the monospace font. Different browsers and OS use different fonts and we don't want to interfere with those.\n@marijnh https://github.com/marijnh how do I go about doing this? Using charCoords() to get the size, compute the width, and then setting it directly on the cursor div?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/codemirror/CodeMirror/issues/3256#issuecomment-101669361.\n. \n",
    "kyuwoo-choi": "I think it's fixed. I can't reproduce it tested on Win8 IE11. @marijnh I've looked into it.\nIt seems that resetting textinput failed.\nThe TextareaInput.reset() is called on the step 4 above.\nAnd cm.somethingSelected() returns false on IE while it does true on Chrome\nhttps://github.com/codemirror/CodeMirror/blob/2c741bd6742678f67e812307b2f78db4f4566d9d/src/input/TextareaInput.js#L138-L151\nEnd up with passing condition below\nhttps://github.com/codemirror/CodeMirror/blob/2c741bd6742678f67e812307b2f78db4f4566d9d/src/input/TextareaInput.js#L215\nand executing code below with wrong values.\nhttps://github.com/codemirror/CodeMirror/blob/2c741bd6742678f67e812307b2f78db4f4566d9d/src/input/TextareaInput.js#L234-L247 \nBut I have no idea how to fix. may be similar to how you fix for #1730\nI need you to guide me.. ",
    "cbarbat": "@marijnh I managed to reduce the size of mathematica.js to about 5.5 kbytes.\n. ",
    "puppeteer701": "No I am resizing a dialog, so textare is also resizing.\n. thx, it works, awesome. \n. yes just saw it, really sorry for the scrollTo\n. $el.off('keydown').on('keydown', function (e) {\n        if ((e.ctrlKey || e.metaKey) && (e.keyCode == 65)) {\n            if (!$(e.target).is('textarea')) {\n                e.preventDefault();\n                self.codeMirror.execCommand('selectAll');\n            }\n        }\n    });\n. sorry, wrong css version file.\n. ",
    "madhuracj": "I went through the tests, but all of them seems to test what hints are shown rather than what is being added to the editor. I'm sorry, i'm not very familiar with the code base, so I decided to describe the issue in detail in https://github.com/codemirror/CodeMirror/issues/3281 referring this as a potential fix.\n. Great. Thanks!\n. ",
    "markhillard": "@chriscoyier, I know this is an old issue, but I came across the following code via this Stack Overflow question / example: http://jsfiddle.net/nktvt8vf/12/\njs\nextraKeys: {\n    'Tab': 'indentMore'\n}\nThis maintains normal tab behavior (spaces/tabs depending on your settings) on an empty line as well as multi-line indenting, but also indents the beginning of a line of code. It also plays nice with Emmet.\nI could see how this might be useful in CodePen... thought I'd give you a shout.. ",
    "PullJosh": "This remains an issue that has nothing to do with the CodeMirror core, but I found this page when I had the same problem with emmet and eventually came to a solution that I thought would be valuable to share.\n\nPreviously, I had the following settings:\njs\nextraKeys: {\n  Tab: 'emmetExpandAbbreviation',\n  Enter: 'emmetInsertLineBreak'\n}\nThis wasn't working because emmet would sometimes choose to indent automatically using two spaces, but whenever there was nothing to expand, emmet would pass off the tab key event to the default CodeMirror handler, which indented using a tab character.\nThe solution for this was to handle the pass-off action manually:\n```js\nextraKeys: {\n  Tab: cm => {\n    // Default emmet behavior\n    if (cm.execCommand('emmetExpandAbbreviation') === true) return\n// Otherwise indent with spaces, not tabs\nconst spaces = Array(cm.getOption('indentUnit') + 1).join(' ')\ncm.replaceSelection(spaces)\n\n},\n  Enter: 'emmetInsertLineBreak'\n}\n```\n\nAgain, sorry for continuing an issue that's not a problem with CodeMirror directly, but I think it's valuable to have this answer here to save others time in the future.. ",
    "daniel-zahariev": "Until it's properly done, here's a walk-around:\nCodeMirror.defineMode(\"htmltwig\", function(config, parserConfig) {\n  return CodeMirror.overlayMode(CodeMirror.getMode(config, parserConfig.backdrop || \"text/html\"), CodeMirror.getMode(config, \"twig\"));\n});\n. ",
    "eman1986": "+1 I'd love this myself\n. ",
    "alex94040": "+1. ",
    "bastos71": "+1. ",
    "curruwilla": "@daniel-zahariev how to use?. ",
    "grekpg": "When i add \nCodeMirror.defineMode(\"htmltwig\", function(config, parserConfig) {\n  return CodeMirror.overlayMode(CodeMirror.getMode(config, parserConfig.backdrop || \"text/html\"), CodeMirror.getMode(config, \"twig\"));\n});\n CKEDITOR.config.codemirror = {}\nget editor?id=181:743 Uncaught ReferenceError: CodeMirror is not defined. ",
    "bobrocke": "Does this TextMate grammar (which looks OK to me) help any?\nhttps://github.com/textmate/yaml.tmbundle\n. @anthonydugois Wonderful! I had been hoping someone would write one.\nWill it do multiple-modes like Twig together with HTML and JavaScript?\n. Should there be a scope for URLs, separate from the scope for strings? Maybe cm-url?\nSo, so in the case of quotes, it could be cm-url.cm-quote.\nThe theme is my own adaption of the Tomorrow Night theme. I'll look there for the problem with quote link coloring.\n. Are you saying it shouldn't be a problem to add a cm-url style? Or that overloading the cm-string style for Markdown mode isn't a problem.\nI can see an argument for a cm-url style, as that would be a pretty specific semantic case.\nOff the top of your head, can you think of a theme using mode overloading that I could use as an example?\n. OK, so the intent of the Markdown mode is that URLs should use the same styling as strings. Could it at least use cm-stings-2, so that my theme can show URLs in Markdown differently than strings in JavaScript?\n. Thank you!\n. I don't see that it gets a quote style from anything:\n\n. ",
    "TravisTheTechie": "No, though code folding is an awesome feature, I want the entire editor to collapse/expand. Line down to one line/header/bit that shows there could code there. \n. ",
    "mrdoob": "Just a suggestion. Maybe caseSensitive true by default would be more clear.\n. ",
    "Cagiva-Raptor": "Ok thx, I'll see If I can get it working :D\nYunchi Luo schreef op 7/06/2015 om 18:25:\n\n|:d| is not supported. I'm happy to merge if anyone wants to submit an \nimplementation\n\u2014\nReply to this email directly or view it on GitHub \nhttps://github.com/codemirror/CodeMirror/issues/3311#issuecomment-109768392.\n. \n",
    "kamdjouduplex": "Hello everyone ,\nplease can some one unsubscribe me form this mailing list i subscribe by\nmistake\nthanks in advance\nOn Sun, Jun 7, 2015 at 5:24 PM, Yunchi Luo notifications@github.com wrote:\n\nMerged #3314 https://github.com/codemirror/CodeMirror/pull/3314.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3314#event-324696614.\n\n\n\ntony14pro@gmail.com237 70274538\n  Univertity of Buea Cameroon\n  https://kamdjou-resume.firebaseapp.com/\n. \n",
    "j13z": "@marijnh Works as expected now. Thanks a lot!\n. ",
    "dhenson02": ":+1:\n. Actually @vincentwoo I don't think it does - try doing a block comment on the demo page http://codemirror.net/demo/sublime.html.  Select a few lines and hit Ctrl+/.  On my browser it line comments everything.  And Ctrl+Shift+/ does nothing at all (expected to be block commenting keystroke).  Am I overlooking something here?\nI'm on Chrome in Linux but I don't think that'll help much here.\n. ",
    "myzinsky": "I think its already enough if it just breaks. For example I use this functionality in LaTeX and it would make sense IMHO because tools like Overleaf could benefit from it!. ",
    "cha55son": "Interesting I wasn't aware we could replace the DOM element entirely. Would that be the replacedWith option?\n. Thanks Marjin, that looks useful as well. I'll check it out when I get the\nchance.\nOn Thursday, June 18, 2015, Marijn Haverbeke notifications@github.com\nwrote:\n\nYou won't be able to actually edit the text if you replace it with another\nDOM node, though. In this case, I think the easiest approach is to use\nzero-height line widgets that you place above the lines. See\nhttp://codemirror.net/doc/manual.html#addLineWidget\nOn Wed, Jun 17, 2015 at 8:35 PM, Vincent Woo notifications@github.com\n<javascript:_e(%7B%7D,'cvml','notifications@github.com');>\nwrote:\n\nYup\n\u2014\nReply to this email directly or view it on GitHub\n<\nhttps://github.com/codemirror/CodeMirror/issues/3333#issuecomment-112908277\n.\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3333#issuecomment-113068899\n.\n\n\nThanks,\nChason Choate\n. Thanks, I believe the lineWidgets will be able to accomplish my task. Thanks everyone!\n. I did. You can find my initial work here. https://github.com/digitalreasoning/AnnoMirror We pulled newer changes into our product but you can get the basic idea from the repo. . Posting here for others who care to do something similar. Everything works great, thanks @marijnh!\ncm.getWrapperElement().onmousedown = function(e) {\n    var lineCh = _cm.coordsChar({ left: e.clientX, top: e.clientY });\n    var markers = _cm.findMarksAt(lineCh);\n    if (markers.length === 0) { return; }\n    ... do stuff with markers ...\n. I'm seeing the same issue (Mac Sierra/Chrome 53.0.2785.116 (64-bit) freezing when viewing CodeMirror). My app does not use absolute positioning though. Strangely some of my co-workers are not observing the behavior with the same hardware/software.\nI do believe this to be a chrome bug as there is no indication via the console/debugger that it's a library issue. Sadly I couldn't find any references to this bug with google searches.\nMy debugger makes it to this line before everything starts falling apart. https://github.com/codemirror/CodeMirror/blob/master/lib/codemirror.js#L188\nIt may be related to the code inside the if above if (place) { as everything after the conditional block no longer functions in the debugger. (viewing variables, etc)\nRemoving CodeMirror from the webpage allows the page to load properly. I'm not implying this is a CodeMirror bug but CodeMirror is triggering something in Chrome to lock up.\n. ",
    "theronic": "@cha55son did you manage to do this?. ",
    "jeff-blaisdell": "@marijnh As for the functionality, the request I'm being asked to do is make the search like Google Chrome's search.\nAs for the strange implementation, I wasn't particularly happy with it myself - this is my first real look at CodeMirror source and getting an understanding of what's going on.\nI'll take another look and see if I can encapsulate in a single command.  I'm not sure if the \"input\" event would work for my use case, without additional changes.  The request was to leave the dialog open through out the search - and the dialog internals auto close the dialog on the \"keydown\" event.\nHere's the relevant code from dialog.js:\n```\n      if (options.onInput)\n        CodeMirror.on(inp, \"input\", function(e) { options.onInput(e, inp.value, close);});\n      if (options.onKeyUp)\n        CodeMirror.on(inp, \"keyup\", function(e) {options.onKeyUp(e, inp.value, close);});\n  CodeMirror.on(inp, \"keydown\", function(e) {\n    if (options && options.onKeyDown && options.onKeyDown(e, inp.value, close)) { return; }\n    if (e.keyCode == 27 || (options.closeOnEnter !== false && e.keyCode == 13)) {\n      inp.blur();\n      CodeMirror.e_stop(e);\n      close();\n    }\n    if (e.keyCode == 13) callback(inp.value, e);\n  });\n\n```\n. @marijnh I completed a second pass based on your comments.  I removed the usage of keydown events, in favor of the input event.  Also - simplified the usage to just an incrementalSearch flag.  \nI'm struggling a bit to find the best place to override the dialog's keybindings.  As mentioned above, I'm trying to implement a Google Chrome like search - which means using Enter / Shift-Enter for search navigation.  Those bindings collide with existing CodeMirror default bindings, and really only make sense in the context of the search dialog.  \nI managed to make things work based on the dialog input event, but this implementation depends on the fact that the dialog internally binds Enter to executing the callback.  Maybe this is fine, but to me it feels more appropriate to override the dialog's keydown handler.\nThoughts?\n. It looks good.  Looks like your patch had a couple of bugs that I had accounted for in this pr.  I made a PR against that patch w/ fixes.\nhttps://github.com/codemirror/CodeMirror/pull/3389/files\n. EditorConfig works across IDEs / Text Editors to maintain some basic code styles.  I believe the above matches the style requirements articulated in CodeMirror's contribution style guide.\n. I wanted to do some tests for functions, and didn't see any existing utils provided to accomplish.  This is a copy/paste job from Lodash\n. Rather than providing custom keybindings for our search dialog, rely on the fact the dialog binds Enter to the execution of this callback.  I don't like this.\nAnother option is to override the dialog's keydown event and specify search specific bindings.\nOther thoughts or opinions?\n. reverted. done.\n. removed.\n. removed.\n. That's not quite right.\nSo in both the original and this PR version, the dialog executes the search callback once it detects an Enter keydown event.  This is where they start to diverge:\nIn original:\nThe search callback executes and parses the query into SearchState.  Then the global keybindings, i.e. Cmd-G / Shift-Cmd-G are bound to the search commands to move next / prev.\nIn PR:\nThe search callback executes and will only parse the query into SearchState if the query string has changed from the previous execution.  This was necessary because the dialog remains on screen, and the user may/may not choose to modify the search.  Because the dialog is still on screen, the dialog's local keybindings are still active and every keydown of Enter will trigger the search callback which will move to next Search term.\nBoth versions behave pretty much the same.  The new one just uses Enter/Shift-Enter to search next/previous and it also keeps dialog visible.  All other behavior should be the same.\nAbout packaging this into a command...  How would you see this command used?  I see the search's findNext / findPrev commands being bound to the global keybindings Cmd-G / Shift-Cmd-G.  Because Enter is an already bound key in the global context, I don't see how we could leverage it for search.  Also - because the Dialog is still open - it is overriding the global keybindings.  Is there another usage of a command that would help us out here?\n. See above.  I can retry a command method implementation if you still think it makes sense.  I'm not sure if this is really an incremental vs non-incremental search thing.  It is pretty much the same search with different keybindings and the dialog stays open rather than closing.\n. queryText needs to be reset as well.  otherwise on a second search by user the following JS error is thrown\nUncaught TypeError: Cannot read property 'global' of nullSearchCursor \n@ searchcursor.js:27(anonymous function) \n@ searchcursor.js:173getSearchCursor \n@ search.js:57(anonymous function) \n@ search.js:129runInOp \n@ codemirror.js:3126CodeMirror.operation \n@ codemirror.js:5209findNext \n@ search.js:127(anonymous function) \n@ search.js:114(anonymous function) \n@ dialog.js:78\n. Without the margin, if a search term is on an early row i.e. Line 2, after the search cycles back up to the top from the bottom, the highlighted term is off the screen.  Here's a screenshot:\nWithout margin:\n\nWith margin:\n\n. ",
    "Tedko": "I'm with the latest release\n. @vincentwoo  The read-only tab is the one(the second tab) will be delete in this situation. Readonly means that certain text in this block should not be modified by our user (such as #includein C)\nbut if we locked the tab in such case (tab) static void abc() in order to make a readable indent, the user may insert a tab before the read-only tab by mistake. In such case, the user cannot delete that tab by hit delete.\nCould you offer a switch for this  \"smart backspace\"  function? it's definitely useful in some case, but if we want to limited the action of users, a switch will be helpful.\n. @JasinYip\n. I just realized that iOS provided Japanese/Chinese keyboard will also not work. Only the auto correction in English keyboard works. Thx for reply.\n. @JasinYip\n. \ud83d\ude2d\n. \ud83d\ude2d\n2016\u5e744\u670822\u65e5(\u91d1) 16:23 Joy Neop notifications@github.com:\n\n\ud83d\ude2d\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3690#issuecomment-213300476\n. how about simulate an right click event? (a dirty fix but might work)\n. \n",
    "rohitkandhal": "I needed to reset the text selection color to browser default and ended up using:\n\nmark-selection add on\nDefine background-color: highlight; it will pick the system default highlight color.. \n",
    "justin8": "@mightyguava if you use y or Y when selecting a block in vim it will only copy the selected block of text; if you do Y with codemirror it copies all lines your block mode has highlighted, instead of only the selection. I can try and get some screenshots if that isn't clear enough.\n. ",
    "cgrushko": "Ah, cool! \nLet's reopen the bug, to track the fix to the documentation? (it doesn't mention selectedHint)\n. I want to know when a completion is abandoned (user hit the Escape key).\n. This relies on the fact that the pick event is sent before the close event does. Moreover, it depends on the order they arrive. \nIs it guaranteed they arrive in this order?\nI think it's easier and more error-proof to explicitly send the reason for closing; something like\nCodeMirror.signal(this.data, \"close\", data);\n. ",
    "FabianCernota": "yes\ud83d\ude0a\n. ",
    "CharlyJazz": "i try use the php mode  and have this error\nphp.js:163 Uncaught TypeError: htmlMode.indent is not a function\n ....\nany idea?. ",
    "MaxSmith": "@marijnh hi! Can you please fix wrong regex:\nhttp://codemirror.net/mode/htmlmixed/\nWrong:\n/^text/(x-)?scss$/\nCorrect:\n/^text\\/(x-)?scss$/\n\n\nThanks!. ",
    "TeaWeb": "\ni try use the php mode and have this error\nphp.js:163 Uncaught TypeError: htmlMode.indent is not a function ....\nany idea?\n\n+1. ",
    "JonesXavi": "Hey thanks for the reply @marijnh !\nI fixed it. The problem was because of z-index set to zero in .CodeMirror-vscrollbar in codemirror.css Line : 180\n. ",
    "maniax89": "Looks great! Thanks for fixing this. Great plugin too.\nAny idea when the next release is that includes this patch?\n. ",
    "tiny-v": "@marijnh I also encountered the same problem, can you tell me how to solve\n. ",
    "jianle": "@tiny-v Something worked for me\uff1a \njavascript  \n    var editor = document.getElementById('editor');\n    myCodeMirror = CodeMirror.fromTextArea(editor, {\n      mode: \"text/x-hive\",\n      lineNumbers: true,\n      lineWrapping: true,\n      theme: 'monokai'\n    });\n    myCodeMirror.setSize('100%', '100%');\n    myCodeMirror.setValue(sqls);\n    var show = setInterval(function() {\n      myCodeMirror.refresh();\n    }, 10);\n    setTimeout(function() {\n      clearInterval(show);\n    }, 500);. ",
    "cpoyraz": "I think the codemirror should provide better highlighting code option since codemirror is not used only for editors.\n. ",
    "xiemaisi": "\n(Actually, looks like you used an automated tool to find these. Nice!)\n\nIndeed :smile_cat: \n. Makes sense, thanks.. Note that args.eatSpace() can never return true here, since there is another eatSpace() just a few lines above.\n. ",
    "belhaj": "The list of files/directories is in the PR. Directories like bin, demo, doc, test, ... etc are usually deemed as unnecessary when installing CodeMirror as a dependency through npm. But that doesn't mean they should be excluded from a Git repository either.\n. ",
    "mkarajohn": "Ok, I see. \nSo,  what would be the best way to enable and disable (toggle) the sublime keymap, for example?\n. ",
    "nodirt": "Thank you\n. ",
    "greaber": "OK, this is pretty small and shows some problems.\n``` html\n\n\n\n\n\n    body {\n        width: 200px;\n    }\n    \n\n\n<textarea id=\"myTextarea\">blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah</textarea>\n\n<script>\n(function () {\n    var myTextArea = document.getElementById('myTextarea')\n\n    var cm = CodeMirror.fromTextArea(myTextArea, {\n        lineWrapping: true\n    })\n\n    var marker = cm.markText({line: 0, ch: 495}, {line: 0, ch: 499})\n\n    cm.on('change', function (instance, changeObj) {\n        var fromTo = marker.find()\n        cm.cursorCoords(fromTo.from)\n    })\n})()\n</script>\n\n\n\n```\nIn Chrome, paste the following string at the beginning of the buffer: \"sdlfj sdlkf jsdlkfjsd lkfjsd flksdj flsd flsdf afa \".  This should result in the last line having one \"blah\" on it.  Click at the end of the buffer.  Then push the up arrow key.  The cursor should go up two lines instead of one.\nI have mainly been working in Chrome, but I tried in Firefox and got different behavior because  Firefox is only putting four \"blah\"s on a line instead of five like Chrome.  So with this exact recipe, the bug doesn't manifest in Firefox.  But there seems to be a different bug showing up in Firefox: after I paste the string, even when I scroll the editor all the way to the bottom, I only see the top of the last line.\nBy the way, I was setting \"height: auto\" on .CodeMirror originally, and I still saw the bug (in Chrome); I just took it out to be more minimal.\n. Thanks! This fix does solve the Chrome issue, but I want to experiment some more to see if all the problems I was having are fixed.\nI did notice that there is still a surprising behavior in Firefox, though I don't know if it qualifies as a bug.  Namely, as I said before, on my system (OS X), Firefox only fits four blahs on a line initially.  Yet it seems to leave room for a fifth blah in the sense that the scrollbar is a full blah away from the right side of the text, instead of abutting the right side of the text as in Chrome.  Furthermore, after I paste the string at the beginning, I actually see five blahs on the last line!\nPossibly related is a Chrome/Firefox difference I observed in the rendering of textareas.  In Chrome, if you have one word at the end of a line and another at the beginning of the following line, with a single space separating them, pressing the right cursor key at the end of the first line takes you directly to the beginning of the second line.  More generally, if n spaces separate separate the two words, there are n-1 spaces at the end of the first line.  In other words, the linebreak is treated as logically equivalent to a single space.  Firefox, on the other hand, treats linebreak as logically equivalent to nothing at all; it displays n spaces at the end of the first line.  CodeMirror on both Chrome and Firefox seems to have the Chrome textarea behavior, which I think is superior, but could it be that the Firefox way of handling textareas is throwing off some calculation?\n. Load the following page, then insert an 'x' as the first character in the buffer.  In Chrome, inserting the 'x' pushes the start of line 1 down a line, so I believe the output should be two different numbers with the second larger than the first; but the output is \"313\\n313\\n\".  In Firefox, inserting the 'x' doesn't move the start of line 1, so I believe the output should be the same number twice; but the output is \"350.5\\n283\\n\".\n``` html\n\n\n\n\n\n\n    body {\n        width: 200px;\n    }\n    .CodeMirror {\n        height: auto;\n        border: 1px solid red;\n    }\n    \n\n\n<textarea id=\"myTextArea\">blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah\n\nblah\n<script>\n(function () {\n    var myTextArea = document.getElementById('myTextArea')\n\n    var cm = CodeMirror.fromTextArea(myTextArea, {\n        lineWrapping: true\n    })\n\n    console.log(cm.cursorCoords({line: 1, ch: 0}).top)\n\n    cm.on('change', function (instance, changeObj) {\n        console.log(cm.cursorCoords({line: 1, ch: 0}).top)\n    })\n})()\n</script>\n\n\n\n```\n. Thanks! I guess the Firefox weirdness around linewrapping is ultimately Firefox weirdness as I was speculating, and perhaps Firefox should fix it.  But I guess the Firefox philosophy is to treat spaces as first class citizens, and it does that even to the extent of letting you move the cursor between the position before and after a space when that space is at the end of a line and causing line wrapping.  CodeMirror goes halfway toward the Chrome behavior by removing this possibility, so the extra Firefox space appears totally mysterious and you don't really get the benefit of the Firefox way, if I am understanding correctly.\nOn the second point, thanks!!  Doing either of the things you recommend fixes the example I sent.  Hopefully it will fix all the issues I have been having with my real code too, but I still need to test that.  Your explanation makes good sense of why I was seeing stale values in Chrome, but do you understand why I was seeing weird transient line heights in Firefox when none of the line breaks in the whole editor were changing?\n. Also, it would be cool if the explanation of 'change' and 'changes' in the manual explained this issue.  The 'changes' explanation links to the explanation of cm.operation, which focuses on efficiency.   This gave me the impression that 'changes' was just for optimization.\n. ",
    "rrandom": "Oh! Really? I am just reading your source code of rust.js and trying to modify it to be adapted to current version of Rust. since It can rewrite with simple mode, it may be simpler. I will try to figure it out. btw, the grammar doc is at:  https://doc.rust-lang.org/grammar.html  ,but it's incomplete.\n. OK! I will do it later \n. Yes, I think I can finish it within the next week\n. Hi, @marijnh, you may review this file now. But I did not find any code folding option in defineSimpleMode. Is there one? \n. ",
    "shiren": "ok sorry about my english \nI'll show you with gif animation \nbelow is right situation \n\nwhen i type keyboard button \"\u3147\"\nwe need poll() \"\u3147\" and applyTextInput so editor should render \"\u3147\"\nthen i type keyboard button \"\u314f\"   \nwe need poll() \"\uc544\" and applyTextinput so editor should render \"\uc544\"\nthen i type keyboard button \"\u3134\"   \nwe need poll() \"\uc548\" and applyTextinput so editor should render \"\uc548\"\nso we can get complete one letter \"\uc548\"\nbut IE 11 / window7 dont show first letter so when we want to input \"\uc548\ub155\"\ncm dont render \"\uc548\" until \"\ub155\" composition start\nshow below\n\nthis because \njavascript\npoll: function() {\n      var cm = this.cm, input = this.textarea, prevInput = this.prevInput;\n      // Since this is called a *lot*, try to bail out as cheaply as\n      // possible when it is clear that nothing happened. hasSelection\n      // will be the case when there is a lot of text in the textarea,\n      // in which case reading its value would be expensive.\n      if (this.contextMenuPending || !cm.state.focused ||\n          (hasSelection(input) && !prevInput) ||\n          isReadOnly(cm) || cm.options.disableInput || cm.state.keySeq)\n        return false;\n(hasSelection(input) && !prevInput) \nthat condition cancel polling \"\u3147\" -> \"\uc544\" -> \"\uc548\"\nso we can't see \"\u3147\" -> \"\uc544\" -> \"\uc548\"\ni hope that this comment can help\n. ",
    "AnatoliyLitinskiy": "Hi, Marijn.\nYou shouldn't believe to value:\n\nvar innerW = test.firstChild.offsetWidth\n\nif it has default 1px val\n\nMath.max(innerW, display.lineGutter.offsetWidth - padding) + 1;\n\nin fact 0, but you have added 1;\nI can't found a method to recount linesWidth any more in your code.\nSo it looks like the single method that can update lineNumberWidth value finish his work before recounting this value, and doesn't check that lineNumberWidth has (bad) default value.\nThe condition to recount lineNumberWidth looks like:\n\nlast.length != display.lineNumChars\n\nAnd it will not occurs if we just enter new line by pressing 'Enter' key.\nAnd I can't found situation when this condition can occur at all.\nI just try to solve problem that is described on huge of sites in internet, when Codemirror have used default value 1px for lineWidth if editor was not visible and browser can't count width of \n\ntest = display.measure.appendChild(elt(\"div\", [elt(\"div\", last)]\n\nMy solution works, yes it is not the best architecture design solution, but architecture design have to take into account errors, that can occur, and it skips error with width in method 'maybeUpdateLineNumberWidth'\n\nvar test = display.measure.appendChild(elt(\"div\", [elt(\"div\", last)];\nvar innerW = test.firstChild.offsetWidth;\n\nThis fix allow CodeMirror to updates lineNumberWidth by calling refresh, it looks like solution of problem. You can use it as hint.\nf.e. You can mark, that width was count in bad way and add it to condition:\n\nlast.length != display.lineNumChars || lastLineWIdthCountError\n\nThanks, Anatoliy\n. Hm, in simple HTML refresh() solves this problem.\nhttp://jsfiddle.net/alitinskiy/3Lew35t0/\nEven more in my project now it work too! (may be after bower update) Sorry for that.\n. ",
    "matthias-vogt": "I would love to see Codemirror use Github's releases feature with actual release notes as I like to keep track of my project's dependencies' updates through RSS feeds which codemirror's project page doesn't feature. I also agree that it would be more user-friendly.\n. With the JSON approach, one could either\u2026\n1. make a .json for every theme\n1.1 have the theme name in the .json\n1.2 have the theme name in the file name\n2. make one .json for all themes\nI'd suggest 1.2 for modularity and little redundancy.\nFor instance the default color scheme\u2026\n.cm-s-default .cm-keyword {color: #708;}\n.cm-s-default .cm-atom {color: #219;}\n.cm-s-default .cm-number {color: #164;}\n.cm-s-default .cm-def {color: #00f;}\n\u2026\n\u2026could become\nthemes/default.json (using 1.2)\n{\n    \"keyword\": \"#708\",\n    \"atom\": \"#219\",\n    \"number\": \"#164\",\n    \"def\": \"#00f\",\n    \u2026\n}\nthemes/themes.json (using 2)\n{\n    \"default\": {\n        \"keyword\": \"#708\",\n        \"atom\": \"#219\",\n        \"number\": \"#164\",\n        \"def\": \"#00f\",\n        \u2026\n    },\n    \"other theme\": {\n        \"keyword\": \"red\",\n        \"atom\": \"green\",\n        \"number\": \"rgb(0,0,0)\",\n        \"def\": \"orange\",\n        \u2026\n    }\n    \u2026\n}\nIf a property isn't defined, it should not fall back to the default theme as the default theme is always included in the codemirror.css file and will provide a fallback for missing properties.\nSince the existing themes have very individual styling, we'll have to draw a line between what a theme should be able to customize and what not and make an API for allowed JSON properties accordingly.\n. I respect your opinion and I too want to reduce complexity and think that a build step would actually be a reasonable investment to do so.\nThe theme files really are a mess right now, they lack of convention and have very unpredictable effects.\nIf you prefer individuality over convention and predictability for themes, maybe we could separate the color scheming and layout components from each other? And make layout changing default and optional?\nThat way, we could have the best of both worlds, themes that can change the editor however they want to by default and, optionally, the dev being able to offer any color scheme to the user without having to fear of his page layout breaking.\nIf we had a sass partial, for example, we could do something like this:\nname.scss\n```\n@import 'interpreter';\n@include color-scheme((\n    keyword: #708,\n    atom: #219,\n    number: rgb(200, 141, 50),\n    def: #00f\n    //\u2026\n));\n@include layout(\"name\") {\n  .CodeMirror-linenumber {\n    padding: 0 .4em;\n  }\n}\n```\n_\u00ecnterpreter.scss\n```\n$use-layout: true !default;\n@mixin color-scheme($scheme) {\n  / Color Scheme /\n  @each $prop, $color in $scheme {\n    .cm-#{$prop} { color: $color; }\n  }\n}\n@mixin layout($theme-name) {\n  @if $use-layout {\n    / Layout /\n    .cm-s-#{$theme-name} {\n      @content;\n    }\n  }\n}\n```\nYou can see a working example here: http://www.sassmeister.com/gist/f28dc0b8aae5823f6302\n\nEdit:\nI just realized that, since a theme will probably want to change background colors and colors not belonging to syntax highlighting, the demo above isn't really a good approach.\nI've extended it to allow using background colors and added some custom tokens for changing colors beyond syntax highlighting.\nhttp://www.sassmeister.com/gist/ecb4964e10160914f2d5\n. That wouldn't solve the problem of making layout-changing CSS optional, though.\nThis is kinda the perfect fit for a build step as it's the only way to effectively build a layer of abstraction on top of theming (until CSS variables have support :pray:).\nI feel like building this layer is the most sustainable and empowering solution because it\u2026\n- makes it very easier to port color schemes from other editors to Codemirror themes\n- reduces redundancy among theme definitions\n- enforces a style guide\n  - makes themes more predictable\n  - will prevent future code cleanups\n- allows individuality among themes\n- still gives developers the option of standardizing them where necessary (use only color schemes)\n  - allows theme agnostic development\nIt's just a nicer system, easier to work with and from my point of view completely justifies the effort to introduce a build step. I can actually see this being a better API for theme creators than the current one\u2014even though it's not pure CSS.\nAs a side effect, the Sass technique would also give developers the option of using the theme's color variables independently of their theme. So, for example in the rest of their code to be able to customize their page toward the Codemirror theme. If you make a site where the Codemirror editor is centric, this is a super cool benefit.\n. The jsfiddle just has an SSL issue, except for that it works.\nYou included codemirror.css over http:// on jsfiddle, which uses https.\nUse // or https:// instead and you'll be fine.\nhttps://jsfiddle.net/mj8Lh59n/8/\n. ",
    "D-32": "That would make sense, but it stays in caps lock. So if I type A the next character is still upper case. Which is annoying, as the user manually has to get out of that mode.\nThis surely isn't an intended behavior.\n. Thanks :)\n. ",
    "boucher": "Seems related to this bug filed against WebKit:\nhttps://bugs.webkit.org/show_bug.cgi?id=148503\n. Switching to inputStyle: \"textarea\" resolves this issue, but produces the issue where the native cursor is displayed in addition to the codemirror cursor. I might be willing to live with that by disabling the codemirror cursor, but perhaps there are other problems I haven't discovered yet since textarea is not the default on mobile?\nedit: at least one thing that stops working correctly in mobile with \"textarea\" mode is text selection.\n. ",
    "denisoby": "I've met same issue. The problem is that if e.preventDefault is called - then iOS will skip internal callbacks and will NOT switch case to lower.\nFor CM4 I've made a workaround for CM keypress event like this\nonKeyPress: function(e) {\n      if (capitalizationHack.isPreventDefaultNeeded(e)){ // if uppercase -> not needed\n        e.preventDefault();\n      }\n      operation(....)\n    },\nAnd after this - we have two events of adding letter. The extra letter should be removed\n```\n  if (cm.capitalizationHack.isHackEnabled()) {\n    CodeMirror.on(cm.doc, 'change', function (instance, change) {\n      var capHack = this.editor.capitalizationHack;\n        if (capHack.isDuplicateChange() && (change.text.length == 1)) {\n          console.log(\"Line BF: \" + cm.getLine(change.from.line));\n      var realFrom = {\n        line: change.from.line,\n        ch: change.from.ch - 1\n      };\n      var realTo = {\n        line: change.from.line,\n        ch: change.from.ch + 1\n      };\n      cm.replaceRange(change.text[0], realFrom, realTo);\n\n      console.log(\"Line AF: \" + cm.getLine(change.from.line));\n }\n}.bind(this));\n\n}\n```\nThis is definitely ugly hack. But first seems to be working ok for user.\nI hope that CM authors will think how to process this situation in a more beautiful way.\nIf necessary - I can provide full code of workaround. Most likely in CM5 - the situation is the same.\n@boucher @marijnh @D-32 FYI\n. @sassywebgal it has changed a little. We removed preventing. But now always remove duplicate symbols:\nMain logic in codemirror.js\n```\nvar isSafariOrWebview = /(iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent);\nif (_isCapsHackEnabled) {\n    var capitalizationHack = (new function capitalizationHack() {\n      var changeNum = 0;\n      var eventPressed;\n  this.isHackEnabled = function () {return _isCapsHackEnabled;};\n\n  this.processKeyUp = function () {\n    changeNum = 0;\n    eventPressed = false;\n  };\n\n  this.isDuplicateChange = function () {\n    if (eventPressed) {\n      changeNum++;\n      return changeNum == 2;\n    }\n  };\n}());\n\n}\n  else{\n    var capitalizationHack = {\n      isHackEnabled: function () {return _isCapsHackEnabled;},\n      processKeyUp: function () {},\n      isDuplicateChange: function () {},\n      isPreventDefaultNeeded: function () {return true}\n    }\n  }\n```\nAlso you should fix onKeyUp:\nfunction onKeyUp(e) {\n    if (e.keyCode == 16) this.doc.sel.shift = false;\n    capitalizationHack.processKeyUp(e); //this line added\n    signalDOMEvent(this, e);\n  }\nAnd in client code, where you create CodeMirror instance, do:\n```\n    CodeMirror.on(cm.doc, 'beforeChange', function(instance, e) {\n    if (cm.capitalizationHack && cm.capitalizationHack.isHackEnabled()) {\n        var capHack = this.editor.capitalizationHack;\n\n        if (capHack.isDuplicateChange() && (e.text.length == 1)) {\n            e.update({\n                ch: e.from.ch - 1,\n                line: e.from.line\n            },{\n                ch: e.from.ch,\n                line: e.from.line\n            },'');\n        }\n    }\n});\n\n```\nTry it. I hope will help.\n. ",
    "sassywebgal": "@denis-aes  Would it be possible for you to provide the full code workaround for this issue? This has become a very problematic bug for a current project and we're attempting to patch. Any further code snippets/file would be much appreciated.\n. ",
    "facundomedica": "@denis-aes do you have any CodeMirror.js for me to take a look? I can't get it to work. Thanks!\n. ",
    "louisatome": "I have the same problem, i didn't find how to make the @denis-aes's patch work but I find another ugly way by re-focus the editor after the user type the first character on a line :\njavascript\neditor.on('change', function(instance, change) {\n  var line = editor.getLine(change.from.line);\n  if(line.length === 1 && change.text.length === 1 && (/^[A-Z]$/).test(change.text[0])){\n    var focused = $(':focus');\n    focused.blur();\n    focused.focus();\n  }\n});. I experience the same problem of the new lines removed when write some text. It seems to be linked to the commit 6019b13 . If I revert this commit, the problem doesn't occur anymore. . Now the composition is not erased anymore but the composed text is added to the previous line and the new line is not created. But i think this is linked to the commit 6019b13 as i said here : https://github.com/codemirror/CodeMirror/issues/4307#issuecomment-267339571\nWithout this commit it's better but there is still a problem : the composed text is append to the new line instead of the previous line.. I've experienced the issue with a Sony Xperia 3 tablet on android 6. The virtual Keyboard used is the Xperia keyboard and the browser is Chrome 55.. Thanks for the review @marijnh!\nOK i understand the problem with the synchronous call. I missed the ensurePolled but it doesn't work in my case, this is what happens : \n\nThe user press Enter key with a selected composition\nA compositionend  event is triggered\nThe handler on compositionend call the readFromDOMSoon and set this.composing to null\nThe keydown event is triggered\nThe handler on keydown call the ensurePolled which do nothing because this.composing is null\nThe new line is inserted and the previous is erased\nThe pollContent from step 2 is called but nothing has changed . \n",
    "firasdib": "This seems fixed now?. Status on this issue? Had multiple users report it to me.\n. You can test here: https://codemirror.net/demo/indentwrap.html\n. Thanks, that fixed it @marijnh \n. What about text markers? They are also affected.\n. If I mark { line: 0, ch: 0 } until { line: 0, ch: 5 } with the class foo the following happens:\n1. With a mode that has flattenSpans: false: each character in the pos 0-5 is given a span with the class foo.\n   \n2. Without a mode that has flattenSpans: false: a single span added around the characters at pos 0-5 with the class foo.\n   \n. Ah, I suppose returning null from a overlay (ie, I don't want to style it) makes it a \"token\" still?\n. Ah, that explains it. Thank you.\n. I think this issue is back.. This issue happens on regex101 and in common browsers: https://github.com/firasdib/Regex101/issues/1085. False alarm on my part. . ",
    "Jetski5822": "Yeah - been using this recently, and the ios experience is not great. Darn no - version 5. Is the dsl of 5 wildly different in 6?. ",
    "kimbtech": "Just checked the Demo on my iPhone and it seems to work fine.. ",
    "mg80": "Created a new pull request\n. ",
    "makfruit": "This is not a very common case \u2013 you're right. I've been always typing so, though, and it turns out some people are typing this way, too. Not sure how to check whether this is a frequent case \u2013 let's just see if anyone joins this report. \n. That was fast! \nThank you! \n. ",
    "Maruskakonst": "http://www.microsoft.com/sv-se/mobile/tillbehor/hd-500/\n. ",
    "ronaldohoch": "Thank you for the answer, but, there's a tutorial for it?\n. ",
    "NgYueHong": "What I mean is putting the minify version together with the uncompressed version of JS together. This way we can easily use with bower install and use the minified version directly. Not manually custom minify it every-time we want to use it in project.\n. ",
    "s100": "The compression helper link seems to be broken now. What did it say?. ",
    "melloware": "I just commented in the forums.  Is there anyway to provide an example script to combine everything into one script?  Maybe even put it on GitHub in the /examples folder?. Submitted this PR:  https://github.com/codemirror/CodeMirror/pull/4567. +1 I am trying the same thing while updating the Primefaces Extension CodeMirror JSF component.  I am having the exact issue as above\n. @mattpass that is exactly what I did I removed all simple.js languages and simple.js itself from my compression and now everything is compiling and happy in the browser.\n. I fixed this with this PR.  https://github.com/codemirror/CodeMirror/pull/4567. Understood.  If I fix all the issues with it and submit a PR would you consider adding it?. Understood for now I will keep it in my own GitHub fork and see if get around to an NPM in the future.  Great work on CodeMirror!. ",
    "vedanshujain": "I tried it out but I was having problem with VoiceOver in Mac. On NVDA it was usable though. \n. ",
    "ingro": "Thanks for the insight, I didn't understand that reading the docs.\n. ",
    "dcrousso": "I think I may have explained my use case somewhat poorly.  Let me try again.\nBasically, I have an autocomplete system implemented in my editor that shows a list of values that match the current word every time the user presses a key.  If the user has typed \"wi\", then a popup appears with the matches \"width\" and \"window\".  A key part of this system is that whenever the user hovers over one of the completions in the popup, the hovered item will replace what the user has currently typed (so if they hovered over \"window\" then the text in the editor will display \"window\" instead of \"wi\").  I am currently using replaceRange to accomplish this.  The issue arises if the user decides to move their mouse either out of the popup entirely (thus deselecting all of the completions) or to hover a different item (like \"width\" instead of \"window\").  When this happens, I am replacing the current text (which is \"window\" in this case since I already replaced the entered text) with the text of the new hovered item (which is \"width\").  This replacement causes an extra history state to be added and makes it such that if the user were to undo, they would see the text go from \"width\" to \"window\" to \"wi\", which is very weird.  What I am asking for is to give replaceRange another parameter to prevent it from adding to the history, similar to how some of the other commands have options to ignore history events (markText has addToHistory).  With this parameter, then I could make the completion replacements not add to the history (like when \"wi\" was replaced with \"window\" or when \"window\" was replaced with \"width\") until the user presses the enter key and commits the selected completion, ensuring that the undo history would show as \"window\" to \"wi\".  Please let me know if that makes more sense.  Thanks.\n. Here is a sample document that gives a preview of my issue.  If you start typing the word \"window\" into the CodeMirror area, hit enter before you type the letter \"d\", and then try to undo, the cursor will move around to the previous edit but will not remove the text that was added by replaceRange.\nhtml\n<script src=\"codemirror.js\"></script>\n<link rel=\"stylesheet\" href=\"codemirror.css\">\n<p>Type \"window\" in the editor</p>\n<style>\n.CodeMirror { border: 1px solid black; }\n.completion-hint {\n    color: red;\n    opacity: 0.5;\n}\n</style>\n<textarea id=\"code\"></textarea>\n<script>\n    var from = {line: 0, ch: 0};\n    var to = {line: 0};\n    var marker = null;\n    function hideCompletion() {\n        if (marker) {\n            var range = marker.find();\n            if (range) {\n                marker.clear();\n                cm.replaceRange(\"\", range.from, range.to, \"+removeCompletion\");\n            }\n            marker = null;\n        }\n    }\n    var cm = CodeMirror.fromTextArea(document.getElementById(\"code\"));\n    cm.addKeyMap({\n        \"Enter\": function() {\n            hideCompletion();\n            var cursor = cm.getCursor();\n            cm.replaceRange(\"window\", from, cursor);\n        }\n    });\n    cm.on(\"change\", function(cm, change) {\n        if (change.origin === \"+completion\" || change.origin === \"+removeCompletion\")\n            return;\n        if (!change.origin || change.origin.charAt(0) !== \"+\") {\n            hideCompletion();\n            return;\n        }\n        hideCompletion();\n        var cursor = cm.getCursor();\n        cm.replaceRange(\"window\", from, to, \"+completion\");\n        cm.setCursor(cursor);\n        marker = cm.markText(cursor, to, {className: \"completion-hint\"});\n    });\n</script>\nI haven't used changeGeneration before, but from what I can see in the docs I am not sure why I would want to prevent the state after undo from being merged with other events.  Could you possibly explain a bit more what the purpose of changeGeneration is with undo?  Thanks.\n. If it helps at all, I tried adding a parameter to replaceRange to prevent it from adding to the history.  I am not sure that I did it correctly or according to your conventions, but this is the general idea.  Thanks again for the quick responses and comments.  Sorry if I am being a bother.\n``` diff\n@@ -4253,19 +4253,21 @@\n       to: change.to,\n       text: change.text,\n       origin: change.origin,\n+      ignoreHistory: change.ignoreHistory,\n       cancel: function() { this.canceled = true; }\n     };\n-    if (update) obj.update = function(from, to, text, origin) {\n+    if (update) obj.update = function(from, to, text, origin, ignoreHistory) {\n       if (from) this.from = clipPos(doc, from);\n       if (to) this.to = clipPos(doc, to);\n       if (text) this.text = text;\n       if (origin !== undefined) this.origin = origin;\n+      if (ignoreHistory) this.ignoreHistory = ignoreHistory;\n     };\n     signal(doc, \"beforeChange\", doc, obj);\n     if (doc.cm) signal(doc.cm, \"beforeChange\", doc.cm, obj);\n if (obj.canceled) return null;\n\n\nreturn {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin};\nreturn {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin, ignoreHistory: obj.ignoreHistory};\n   }\n\n// Apply a change to a document, and add it to the document's\n@@ -4286,7 +4288,7 @@\n     var split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to);\n     if (split) {\n       for (var i = split.length - 1; i >= 0; --i)\n-        makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [\"\"] : change.text});\n+        makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [\"\"] : change.text, ignoreHistory: change.ignoreHistory});\n     } else {\n       makeChangeInner(doc, change);\n     }\n@@ -4295,7 +4297,8 @@\n   function makeChangeInner(doc, change) {\n     if (change.text.length == 1 && change.text[0] == \"\" && cmp(change.from, change.to) == 0) return;\n     var selAfter = computeSelAfterChange(doc, change);\n-    addChangeToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);\n+    if (!change.ignoreHistory)\n+      addChangeToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);\n makeChangeSingleDoc(doc, change, selAfter, stretchSpansOverChange(doc, change));\n var rebased = [];\n\n@@ -4484,11 +4487,11 @@\n     cm.display.selForContextMenu = null;\n   }\n\nfunction replaceRange(doc, code, from, to, origin) {\nfunction replaceRange(doc, code, from, to, origin, ignoreHistory) {\n     if (!to) to = from;\n     if (cmp(to, from) < 0) { var tmp = to; to = from; from = tmp; }\n     if (typeof code == \"string\") code = doc.splitLines(code);\nmakeChange(doc, {from: from, to: to, text: code, origin: origin});\nmakeChange(doc, {from: from, to: to, text: code, origin: origin, ignoreHistory: ignoreHistory});\n   }\n\n// SCROLLING THINGS INTO VIEW\n@@ -7321,10 +7324,10 @@\n                         text: this.splitLines(code), origin: \"setValue\", full: true}, true);\n       setSelection(this, simpleSelection(top));\n     }),\n-    replaceRange: function(code, from, to, origin) {\n+    replaceRange: function(code, from, to, origin, ignoreHistory) {\n       from = clipPos(this, from);\n       to = to ? clipPos(this, to) : from;\n-      replaceRange(this, code, from, to, origin);\n+      replaceRange(this, code, from, to, origin, ignoreHistory);\n     },\n     getRange: function(from, to, lineSep) {\n       var lines = getBetween(this, clipPos(this, from), clipPos(this, to));\n```\n. Hiya.  Just wanted to know if you have thought about this any more.  Thanks!\n. ",
    "stevemao": "Sample logs generated by the tool from your git history\nabcdef\n\ntheme Add\ntheme Integrate\n\nclosetag\n\naddon Don't include trailing > if it is already present\n\ncss\n\nmode Add inline option\nmode Add values for property flex-direction\nmode Missing some common media query features and values\n\nDockerfile\n\nmode Added lineComment\n\ngo\n\nmode Better handle raw strings\n\nlint\n\naddon Add option to disable automatic linting\naddon Fix broken implementation of lintOnChange\naddon Revise patch 536bba1\n\nmode/meta\n\naddon Include VHDL mode\n\nphp\n\nmode Allow double-quoted heredoc ids and space before the id\nmode Allow interpolation in double-quoted heredoc strings\n\nreal-world\n\nuses Add boson editor\nuses Rename uiCod->Refork\n\nrust\n\nmode A few small tweaks\nmode Rewrite on top of simple-mode\n\nstylus\n\nmode Add flexbox value\nmode Fix highlight class after a $var\n\ntern\n\naddon Add option for hint delay\naddon Fix patch bc026f1\naddon Use correct primary when selecting variables\n\nttcn\n\ntheme Fix leaky declarations\n\nyeti\n\ntheme Remove duplicate color hex sign\n. Or with links:\n\nabcdef\ntheme Add (7bba3a8)\ntheme Integrate (16b9bf7)\nclosetag\naddon Don't include trailing > if it is already present (bc0a644), closes #3409\ncss\nmode Add inline option (52ad899)\nmode Add values for property flex-direction (9f1b3a6)\nmode Missing some common media query features and values (3ef42f7), closes #3417\nDockerfile\nmode Added lineComment (ea3277b)\ngo\nmode Better handle raw strings (be20899), closes #3428\nlint\naddon Add option to disable automatic linting (536bba1)\naddon Fix broken implementation of lintOnChange (38c3e9c)\naddon Revise patch 536bba1 (3686816)\nmode/meta\naddon Include VHDL mode (091a0f6)\nphp\nmode Allow double-quoted heredoc ids and space before the id (e36dff2), closes #3421\nmode Allow interpolation in double-quoted heredoc strings (a2e51a6)\nreal-world\nuses Add boson editor (bd62685)\nuses Rename uiCod->Refork (8d989c5)\nrust\nmode A few small tweaks (d56b13a)\nmode Rewrite on top of simple-mode (d7dc8c3)\nstylus\nmode Add flexbox value (4ab7e90)\nmode Fix highlight class after a $var (7523531)\ntern\naddon Add option for hint delay (b6f9fd3)\naddon Fix patch bc026f1 (9e375f1)\naddon Use correct primary when selecting variables (bc026f1)\nttcn\ntheme Fix leaky declarations (ad47608)\nyeti\ntheme Remove duplicate color hex sign (d002b03)\n. Oh so how can I contact you? Should I send a PR instead? \n. ",
    "matt-mcdaniel": "@timbur Can you upload your implementation? It might be helpful for others to see a workaround.\n. ",
    "timbur": "It's been months since I've looked at this so I've forgotten what I did exactly, but @matt-mcdaniel I think this might be what you're looking for: https://github.com/loggur/branches/blob/master/config.codemirror.js\n. ",
    "clintmilner": "Thanks @marijnh - working great on my end too!\n. @ajinkyasurya I dumped Require.js about a year ago, and I can't find the commit where I had this + Require.js working. I do know that I was wasn't importing CodeMirror-related files vai a package.json file. Perhaps try importing manually?. ",
    "ajinkyasurya": "@marijnh Is that gist still valid? It does not render any view for me.\nAlso @clintmilner assuming you are using typescript, how did you declare a global variable? \nI added\n\"@types/diff-match-patch\": \"^1.0.32\",\n\"diff-match-patch\": \"^1.0.1\"\nto my package.json but I still get\nERROR ReferenceError: diff_match_patch is not defined\n    at getDiff (merge.js:649)\n    at DiffView.init (merge.js:52)\n    at new CodeMirror.MergeView (merge.js:570)\n    at Function.CodeMirror.MergeView (merge.js:536). ",
    "thecere": "Hacking the globals with webpack, works for me:\nnew webpack.ProvidePlugin({\n    diff_match_patch: 'diff-match-patch',\n    DIFF_EQUAL: ['diff-match-patch', 'DIFF_EQUAL'],\n    DIFF_INSERT: ['diff-match-patch', 'DIFF_INSERT'],\n    DIFF_DELETE: ['diff-match-patch', 'DIFF_DELETE'],\n}),. ",
    "huaoguo": "@marijnh \nThis mode implements all the CoffeeScript language specification, like:\n- and\u3001is\u3001or... keywords will be highlight\n- Class(capital word) will be highlight\n- method def will be highlight\n- properties will be highlight\n- module\u3001exports\u3001require (commonjs) will be highlight\n- and so on...\nIt make the highlight more comprehensive.\nYes, I want let it become part of the main distribution.\n. ",
    "gitter-badger": "Sorry @marijnh :(\n. ",
    "michaelsboost": "This is new for me contributing to another git repository. Hopefully this is better -\u00a0HTMLHint/lint integration by mikethedj4 \u00b7 Pull Request #3459 \u00b7 codemirror/CodeMirror\n| \u00a0 |\n| \u00a0 |  | \u00a0 | \u00a0 | \u00a0 | \u00a0 | \u00a0 |\n| HTMLHint/lint integration by mikethedj4 \u00b7 Pull Request #...Codemirror comes with css-lint, js-lint, and json-lint, and even coffeescript-lint. So I decided to integrate html-lint. Enjoy! |\n|  |\n| View on github.com | Preview by Yahoo |\n|  |\n| \u00a0 |\nOn Tuesday, August 18, 2015 5:30 AM, Marijn Haverbeke <notifications@github.com> wrote:\nThis pull request contains 250 commits. I haven't even been able to find the relevant commit in it. Please try again (start from our master branch, and add only your commit to it).\u2014\nReply to this email directly or view it on GitHub.\n. I was having trouble making selections work on my phone and tablet. I spent hours working on a solution, looking for solutions, and nothing worked. I just found that there's a mobile branch for Codemirror ( mentioned in this article ) I think it will help people with this problem. I know it helped me; just thought I'd share.\n. Guess I'm using an older version of Codemirror. That's good to know. Thanks for the insight\n. Problem is still existent with android phonegap compiled application. Running CodeMirror 5.19.0\n. ",
    "ficristo": "The simplest, and maybe silliest thing that comes to my mind, is to detect only the \\r and \\n and replace them with the CR and LF characters respectively.\nIf the user writes \\\\r or \\\\n (two backslash) it will be inserted \\r or \\n (one backslash).\nI don't think I can help, however where is the code used for this operation?\n(I know almost nothing about CodeMirror apart is used in Brackets)\n. Thanks for patch!\nOne question though: the replacement with new lines should work only with the regular expression otherwise should work normally, for example inserting exactly the char \\ followed by n.\nCan you confirm?\n. IMHO there are two way in which find and replace should work:\nnormal: I search some string and replace them with the one wanted exactly as they are. So if I searched foo and replaced with \\n, I expect to see the char \\ followed by n instead of foo.\nregex: in this case if I searched foo and replaced with \\n, I expect to see a new line instead of foo.\nBut if I replaced with \\\\n, I expect to see the char \\ followed by n instead of foo.\n(My english isn't very good, I hope I have been clearer than before)\n. As far as I can tell It is the same behaviour of Netepad++, Sublime Text 2 and Netbeans.\n. If you really disagree in the behaviour I asked, I think the patch should be reverted: it adds an unexpected behaviour in the \"normal\" case.\nInstead, an help on how to implemented the behaviour I asked using the CodeMirror API would be really appreciated.\nLet's say for example I have called this cm.replaceSelection(replaceText), how could I insert the new line?\nThanks for the patience.\n. Because most of code editor work as I said, while as far as can i understand now codemirror has an odd behaviour: that is why I think is unexpected.\nBesides \\n has a special meaning only with regular expression, in normal find and replace are simply a slash and an en.\n. Sorry, I should have been clearer.\nI do not want to replace all the selection.\nIf I select some code, and then I search something, I want the search, and therefore the replace, work only in the selected code.\n. It would be nice to have a fix here.. @marijnh This seems a theme and not a mode. Do you are going to split themes too?\n. Thank you.\nYou are too fast!\n. I cannot find the documentation for autoSelfClosers but doesn't seems what I want.\nFor example If I have \"dontCloseTags\": [\"cfset\"] and \"whenOpening\": true when I write <cfset> will  correctly not be closed: I'll end up with <cfset> without closing tag.\nBut if I have \"whenOpening\": false, \"whenClosing\": true the tag will be closed: <cfset></cfset>.\nI was expecting to have <cfset> only.\n. I'm cross filing from https://github.com/adobe/brackets/issues/12670. /cc @jGeek314.\nI think it is ColdFusion Markup Language (CFML) and I suppose the mode is html.\nCould you clarify the purpose of dontCloseTags attribute and it's relation with autoSelfClosers?\nMaybe I misunderstood it's purpose.\n. @marijnh thank you.\n. Yes, it should be highlighted as a keyword.\n. So fast! Thank you. I tryed to uniform the Sass mode to the CSS one, but there are a lot of edge cases, so tests still fail.\nIs there a way to reuse the CSS mode even for a braceless language?\nIf not is there a way to at least reuse its variables somehow, like propertyKeywords for example?\nNote to self: check how the indentation works, some tests fail bacause of it.\n. I disabled the indentation on tests. While probably it could be improved, some test will never pass.\nThere are still some cases that do not corrispond to css style but for now it's good for me.. Simply rebased and squashed the commits.. Thank you for the guidance. Now depends on CSS mode and indeed I'm happier with it.. Thank you!\nI suppose I have to wait next month for a release, right? I'm not in a hurry, I would like to only have an idea for when will be released.. If you add a single quote before test and one after it the end result is:\nphp\n$foo = \"'test' $bar\"\nwhich is expected.\nIf you add a single quote before $bar and one after it the end result is:\nphp\n$foo = \"test '$bar''\"\nwhich is not expected.\nIt seems codemirror doesn't understand it is inside a string in this case.. Thank you.. Including the meta.js file fixed the demo.\nBefore I fix the lint error, could you verify if the approach is correct?. I didn't save the curMode in the new object because it is used for other things.\nActually I'm also not sure if setting to null is correct...\nI have the same doubt for curState. I thought the copyState function would have been called and so the curMode attribute would be copied. My bad.\nI moved curMode in the new object as asked before, but I left the change to copyState.\nNow I'm not sure if I also need to undo that change.. Thank you.. Thank you.. Thank you.. Thank you.. Nevermind, enclosing the code with export class CharMeasure it works.. Thanks!. Thank you!. In the code example above I still see some issues with the interface with comma delimiters and the last type when preceded with the interface without delimiters.. The interface with comma delimiters has still some problems.. Issue 7:\nts\ninterface HTMLAttributes<T> extends DOMAttributes<T> {\n        /** Identifies the currently active element when DOM focus is on a composite widget, textbox, group, or application. */\n        'aria-activedescendant'?: string;\n        /** Indicates whether assistive technologies will present all, or only parts of, the changed region based on the change notifications defined by the aria-relevant attribute. */\n    'aria-atomic'?: boolean | 'false' | 'true';\n}\ninterface IntrinsicElements {\n  \"var\": React.DetailedHTMLProps<React.HTMLAttributes<HTMLElement>, HTMLElement>;\n  switch: React.SVGProps<SVGSwitchElement>;\n}\nTypes after quoted properties in interfaces aren't handled correctly.. Thank you!. Ideally they should be highlighted as xml as done by VSCode.\n\n. ~~I tryed the snippet above on https://codemirror.net/mode/javascript/typescript.html and I don't see any changes. Do I need to wait? (From what I remember the changes are immediately available on the website)~~\nNevermind some caching issue.\nThank you!. Ops, I missed the obvious... Thank you.. I fixed it and added a testcase.. Done.. It seemed more consitent with the other instructions but I can change it back. Let me know.. ",
    "rmullins9": "Hey melbourne2991 - I just came across this today when I updated the CSS for only the Monokai theme. It appears that the css that's on the codemirror site now no longer has !important on the class selector for .CodeMirror-cursor, which is probably what marijnh is referring to. This fixed it for me:\n.cm-s-monokai .CodeMirror-cursor {border-left: 1px solid #f8f8f0 !important;}\n(I'm using version 5.2)\n. ",
    "karevn": "I think this code is ready to replace htmlmixed (after some adjustments). Ideas?\n. @marijnh can you please review my merge for Vue and htmlmixed? Even if you don't like an idea of .vue,  I think new htmlmixed mode code is much better structured and flexible (and may be a little bit faster).\n. @marijnh whatever, man, if it will make this software better :) I'm a newbie in CodeMirror world.\n. Actually, base Vue templates are in just its own format, and the closest one is handlebars (that's why I copy-pasted it from the example). But it's still a different format.\n. You're right, there's some space for improvement :)\n. @marijnh the question is just if .vue files will be highlighted correctly. But... After your comment I started to think that vue mode should be just some wrapper over a refactored htmlmixed. What do you think?\n. ",
    "redraw": "I'll take a look at it, thanks\nand thanks for making this great lib :)\n. well, it's not as easy to integrate CodeMirror into a Shadow DOM as I thought, I'll keep finding a way\n. ",
    "michael-gollmick": "great, thank you.\n. Support seems to be partly implemented. So, specifically background-position-x and background-position-y properties are supported by some browsers and not supported by others. When I saw this, I was just wondering if there's a certain level that is supported.\nIt clearly makes not much sense to support a CSS level that will not have an effect on most browsers - i was just curious.\n. ",
    "li8": "Thank you @marijnh . I just figured out the same thing- the extra parentheses. \n. ",
    "MojoDK": "Sry for not being clear...\nIf I have this code...\nmyEditor.addLineClass(23, \"background\", \"error\");\nmyEditor.addLineClass(25, \"background\", \"error\");\nmyEditor.addLineClass(29, \"background\", \"error\");\n... how can I without knowing the linenumbers, clear all the addLineClass above?\nThanks\n. ",
    "chrisbaldwinj": "Issue happens here as well. Not sure why, It happens when I switch the mode to JavaScript and try to write var a = freezes once I press shift+' to make a double quote.\nAfter more testing it freezes on ~, \", ', / these are the only keys I have found that it does it to. And it only does in when switching mode to Javascript and CSS so far. I have the following languages automatically loaded into the head in order as they appear.\n- xml\n- javascript\n- css\n- vbscript\n- htmlmixed\n- clike\n- php\n- sql\nI kind of would like to know what would cause this. Maybe all the files included together, or the order, or some function overwriting each other. This has become a very big nuisance for me.\n. For some reason after using the minification helper it works. I'll do further testing and see what I can find, until then I guess close this. I tried making a fiddle and it didn't do the expected results. Cancelled all my external libraries I wrote all together and only had CodeMirror on and it still did it while not minified. So I guess back to square one on this.\n. ",
    "Pointy": "Yes, that works, darn it :) (Of course I wish it wouldn't, because I completely understand that I'm like some kind of special snowflake here.)\nI'm trying everything I can think of to diagnose what's going on; I apologize for burdening this project with this issue, so if it seems bogus or impossible then feel free to close it with extreme prejudice. I've been having this problem only for a short while - I have used jsbeautifier quite extensively for many years with essentially the identical setup I've got now. Thank you for paying enough attention to ask these questions in fact.\n. You're probably right. Thanks for your time; I assure you that I completely understand.\n. For whatever it's worth: I'm finding that I can successfully copy out of the CodeMirror buffer on the jsbeautifier site, but only up to exactly 1000 characters worth. If I select 1001 characters or more, all I get when I try to paste elsewhere (into any other application) is a single \"-\" character.\nNote that to get more than 1000 characters into the jsbeautifier site in the first place, I successfully cut-and-pasted that much text out of a StackOverflow page and into the jsbeautifier page, without incident. It's only copying back out, and only from jsbeautifier, that I'm seeing the problem.\nOf course I realize that this may have absolutely nothing to do with CodeMirror. However, when I use the \"plain textarea\" version of jsbeautifier, everything works fine.\n. I'm using Ctrl-C to copy out of the page, so not the simple X selection buffer. (I haven't tried using the Firefox right-mouse menu to copy, I don't think, but I can do that.)\n. Oh wait, sorry, you asked how I was pasting the clipboard. I'm using Ctrl-V or the right-mouse \"Paste\" button. I've tried a variety of X applications in addition to Firefox and all behave exactly the same way.\n. Completely understand. I'll update the ticket with the js-beautify project.\nThanks for your time spent thinking about this.\n. ",
    "megaspy": "I know it is old but\nI have absolutely the same problem with sites: \nhttps://codepen.io\nhttp://www.cssportal.com\non Kubuntu 17.04 \n. ",
    "AnnanFay": "I am having this exact problem trying to copy source code from the Greasemonkey internal editor. I have no idea if this uses CodeMirror, but it's the only reference to a bug like this I could find.\nI am running Firefox on base Debian.. ",
    "Chess13234": "Same exact problem here, Greasemonkey copying stops at 1001 characters. Ubuntu 16. The offending code is this selection function:\n// Reset the input to correspond to the selection (or to be empty,\n// when not typing and nothing is selected)\nTextareaInput.prototype.reset = function (typing) {\n  if (this.contextMenuPending) { return }\n  var minimal, selected, cm = this.cm, doc = cm.doc\n  if (cm.somethingSelected()) {\n    this.prevInput = \"\"\n    var range = doc.sel.primary()\n    minimal = hasCopyEvent &&\n      (range.to().line - range.from().line > 100 || (selected = cm.getSelection()).length > 1000)\n    var content = minimal ? \"-\" : selected || cm.getSelection()\n    this.textarea.value = content\n    if (cm.state.focused) { selectInput(this.textarea) }\n    if (ie && ie_version >= 9) { this.hasSelection = content }\n  } else if (!typing) {\n    this.prevInput = this.textarea.value = \"\"\n    if (ie && ie_version >= 9) { this.hasSelection = null }\n  }\n  this.inaccurateSelection = minimal\n};. ",
    "Netman82": "Where do i paste that piece of code?\nI pasted it after  - and next time at the end of markup - and it brought up some none-scence texts:\n\ncodemirror: http://cloud-ide.com \u2014 they're springing up like mushrooms. This one uses CodeMirror as its editor. Thu, 17 Mar 2011 23:34:47 +0000 http://twitter.com/codemirror/statuses/48527733722058752 http://twitter.com/codemirror/statuses/48527733722058752 web codemirror: Posted a description of the CodeMirror 2 internals at http://codemirror.net/2/internals.html Wed, 02 Mar 2011 12:15:09 +0000 http://twitter.com/codemirror/statuses/42920879788789760 http://twitter.com/codemirror/statuses/42920879788789760 web\n\nBeside twitter is censored in my country so it's no gonna be useful.\nDon't guys in Brackets decide to solve this? I've seen many other Iranians and Arabs complained already.\n. That won't work for me, I need a solution INSIDE brackets not in that link. thanks for trying tho.\n. ",
    "increpare": "using this http://codemirror.net/mode/haxe/\ntyping in code that should look like this in the body of a function of the example:\nvar a = [];\n    for (i in a)\n    {\n    }\ni instead get this:\nvar a = [];\n    for (i in a)\n        {\n         }\n(not sure if the var bit is necessary, probably not)\n. Thanks :) I understand it's a bit hairy keeping mental track of things like this.\nI'll keep a close eye on it, and report bugs back (with fixes where possible).\n. (also, until I say otherwise, feel free to @ mention me if anyone finds 'orrible bugs haxe.js )\n. Not sure what to do about the Travis CI error. Haven't had a CI error before, not sure how to read the logs, but this looks like the error line:\n\"mode/haxe/haxe.js: Access to global variable state. (405:8)\"\nI don't believe the code I added is any different from the javascript one, and the code is precisely to modify the global variable state.  I don't know if there's somewhere I was supposed to add an exception to this or not, or if I've messed up in some other way.\n. ah, cool! missed that. thanks! :)\n. That works just as well for me :+1: \n. (I'm looking into this one myself, but haven't figured it out yet - it's medium-spooky at least, just reporting it for the record (cf https://github.com/increpare/zeedonk/issues/413 / https://github.com/increpare/zeedonk/issues/414) )\n. ",
    "xperseguers": "Thanks for the hint, will try and report back.\n. Could not reproduce anymore but the original reporter tried my fix and it works. Thanks a lot for your hint.\n. ",
    "elijahz": "I think this is related:\nChrome 45 android 4.4 (kindle fireos)\n\nOpen https://codemirror.net/demo/theme.html\nGo to end of file (end of line 12)\nPress 'Enter', 'F', 'Enter\n\nResult: Keyboard disappears\nUPDATE: If you type 'F ' (auto-capitalized f and a space) in step 3, they keyboard doesnt disappear. Looks to be a conflict with cursor regressing over the previous word. \n. ",
    "NessBird": "Oh -- this is appears to be version 5.4, based on CodeMirror/doc/releases.html.  I'm using the copy of the lint files in CodeMirror/demo/lint_files, because it appears to be more up-to-date than the one in CodeMirror/addon/lint.  The addon one doesn't include performLint().\n. Hm.  Looks like I'm not on the most recent version!  I'll check if it works now.\n. Same problem, at least in Chrome.\n. Thank you!  I'm sure that will fix my problem.\nMay I suggest a change in the docs?  My JavaScript experience is pretty limited...so I'm learning JS terminology and ways of thinking while I'm configuring CM.  It would help if the docs were explicit about what is meant by things like: \"Linting on every change can be disabled by setting the lintOnChange option to false.\"\nI would be happy to submit changes to docs if that would be appreciated.  Do you think it would be?\n. I'm not looking for a particular change, just seeing if any change has been made by the user.  I am using onChanges instead of onChange so changes will be batched and it doesn't call the function multiple times when a user action triggers multiple changes.\nWhy would it be possible to have multiple changes in the changes[] array that have different origins when I'm not using cm.operation()?  The manual says changes are batched by operation...and presumably the operation is triggered by a single event...?\nMaybe I'm not understanding the docs?\n. ",
    "weaverryan": "The only addition was file_put_contents - it's a valid PHP function, so it looks like this might have just been an oversight. :+1: \n. ",
    "BrianOtto": "I would like to see this implemented too.\n. Oh I see, my mistake. I am using UI Kit and they have a component that implements your editor. I thought the live preview was a part of your codebase, but I guess it's something on their end.\nhttp://getuikit.com/docs/htmleditor.html\nI will look into the issue there. Thanks, and sorry for the mistaken bug report.\n. ",
    "danvim": "Is this issue going anywhere?. ",
    "EvHaus": "This issue is not specific to JSX. Regular Javascript code also suffers from issues when processing template strings. See:\n\n. Yes, I can reproduce this if you use a spread operator before the template string. Try this:\nclass MyClass {\n  render () {\n    const {test, ...other} = this.props;\n    const templateString = something(`${test}another_test`);\n    let thisLineIsNotColouredRight = true;\n  }\n}\n- Removing the ...other fixes the issue.\n- Removing the {test} variable from the template string fixes the issue.\n. ",
    "jmuharsky": "I am seeing this issue as well; it's not clear what the \"demo\" is supposed to be doing in this case, so I can't say if it's working.  I've created a jsfiddle that demonstrates buggy behavior (option #1) with height: auto, and \"working\" behavior (option #2) with an explicit height set.\nhttps://jsfiddle.net/jmuharsky/kpza6wuu/\n. Repro'ed here:\nhttps://jsfiddle.net/jmuharsky/kpza6wuu/2/\n. ",
    "bdedardel": "Hi,\nI succeeded in customizing touch behaviour by capturing event before codemirror does.\nHere is an example:\n```\nvar captureHold = function(e) {\n    // custom code\n    // [...]\n// stop event propagation\ne.stopPropagation();\n\n}\nvar myParentElement = document.getElementById('parent-codemirror-form');\nmyParentElement.addEventListener('hold',captureHold,true); // true => capturing event before codemirror (bubbling vs capturing)\n```\nNote: the same subject was discussed some years ago, see :\n```\nmarijnh commented on 15 Feb 2013\nYou are talking about how signal is being called for \"mousedown\", but it never is. Doing instance.on(\"mousedown\", ...) will result in the handler never being called. So I'm really not sure what you're doing here.\nYou can capture dom events after they bubble out of the editor, but you can't (currently) prevent the editor from handling them (unless you use capture-phase handling, which old IEs don't support).\n```\n. ",
    "Delapouite": "That would be handy. In the meantime do you use some kind of preprocessor like Sass or Stylus to dynamically generate these classes in a loop?\n. ",
    "kmctown": "Thanks for looking into this. I'm using typo.js for spellchecking and was using this to display a context menu of spellcheck suggestions when applicable.\n. Confirmed that the patch restores the event. Thank you!\n. ",
    "twpol": "Example: http://jsbin.com/zacajegijo/edit?js,output (gist: https://gist.github.com/anonymous/332dcfe46dc574029c80)\nIf you change the markText to start from ch: 1 the alert will show both span-a and span-b, but with them both starting from ch: 0 you only get span-a.\n. ",
    "quintesse": "That's quick, thanks!\n. Thank you!\n. ",
    "brennie": "Thanks for merging this, @marijnh! I know now for next time :)\n. ",
    "nathanpitman": "Gnrghh... sorry - have posted this to the forums. Please delete.\n. ",
    "justbittin": "This is a very tricky situation on mobile devices since the onscroll event is normally updated until the scroll is finished, or if a momentum scroll is used, til it stops.\nhttp://cubiq.org/iscroll-5\nThat would be an interesting place to start, maybe the underlying engine will help.  The idea is to manage the scrolling without default behavior.\nI think you could incorporate this into codemirror.\n. @marijnh, any progress with a solution?\n. How about adding 'touchstart', 'touchmove', 'touchend', 'touchtap', 'touchdbltap' event handlers for Codemirror.  This way on updating codemirror there is no reason to modify the core.  Since mobile devices are supported a:\ncm.on('touchtap', function() {\n// handle the touch\n});\nWould be a simple solution for handling touch events -- and from your code, you would just need to signal these events.\nJust looking for a solution you can adopt as part of the core to stop the need to modify codemirror.js on every update.\nThank you for your consideration.\n. This is confirmed.  Our mobile site has broken on android.\nCodemirror becomes unstable.\n. Has anyone found a work around for this?  This is a critical bug for android at the moment.\n. The problem isn't Google Keyboard.  Any keyboard on chrome 53 fails.  This is a contenteditable problem - and codemirror throws a bunch of errors (as described above) then fails to work anymore.\nI think it is fair to say that desktops are slowly becoming second to mobiles.\n. ",
    "aviraldg": "That's something only you can fix :sweat_smile: \n. ",
    "idleberg": "@aviraldg Protocol-relative URLs are now an anti-pattern\n. Oh, right. That's a remainder from base16-builder, removed it from the file classes!\n. \ud83d\udc4d\n. > But then, shouldn't we also include all other SVG tags (<defs>, <ellipse>, etc)?\nFor the record: SVG elements\n. You're right, the makers of Yarn actually recommend checking the lock file into source control\n. ",
    "bradx954": "You are absolutely right I forgot to include clike. Thanks for the quick response btw. \n. ",
    "kevjames3": "Example: https://codemirror.net/demo/merge.html. In the paragraph beneath the example, click \"three-way\"\nNow, open up a developer console with an immediate window/console/watch variables in your browser of choice and inspect the variable \"dv\".\n\"dv\" has access to the following variables\n- dv.leftChunks (returns an array of 8 Objects)\n- dv.rightChunks (returns an array 3 Objects)\nThese objects represent the highlight \"chunks\" of modified text in the corresponding view (Example: the 8 objects of leftChunks represent the 8 highlighted blocks in the left view).  What I am looking for is a way to access the merged chunks in the center pane of the 3-way view (there is no way to access them).  \nDoes that make sense?  I read through the source code of Merge.js and see no way of accessing the center highlighted blocks (aka chunks). \n. Ah, you are most correct.  Nope, it is not a full solution and was only tested against IE11. :(  I will withdraw the patch as it was not fully test given the breadth of use cases.\n. This pull request addresses #3633\n. ",
    "jengler": "Sounds good to me :) I will update PR. Thank you\n. ",
    "mattbell87": "I've also noticed a few other things about this bug:\n- The bug specifically happens when you press the enter key (see the issue), it has already indented the line to the wrong spot before you start to type anything else\n- In Brackets, if the file is saved as plain text (ie. no js extension) it works as it should, the bug doesn't occur\n- It also happens when coding in most other programming languages\n. I've personally never encountered that issue as I have never returned an object literal that way. There are workarounds and alternate coding methods if you needed to do something like that. But hey if you're working on a project with others the general rule is to respect the code formatting that the rest of the project uses, whether Allman or K&R (or other styles).\nThis isn't just JavaScript though. I tried coding a delegate in a C# file and it appears to happen in C# as well:\nc#\nvoid Test()\n{\n    Action x = new Action(delegate()\n                          {}\n}\n. Looking at the source code it appears to be a problem with how it handles the Lexical smart indentation. When you perform the steps it returns at Line 680 on javascript.js, but I'm not sure if it should be returning there. I might be wrong but I think it should be treating it as though it were a plain text line so that it sets the column at the right place. \nI commented out line 680 and it's closer to working (it would now be returning at 681). I performed the same steps as in the original post, but it's still off a bit. (Instead of indenting to the \" ( \" it now indents to the first \" ' \").\n``` javascript\n  $('test').click(function()\n    {\n});\n```\nObviously commenting out code is not the way to fix this and I'd need a much clearer understanding of the code, but hopefully this makes it easier for someone to find where the problem might be.\n. Auto/smart indentation is definitely not a bug, I actually really like it and I would like to leave it on. This only happens when coding anonymous function parameters. I don't see this action as a desired effect, thats why I'm calling this particular action a bug.  :)\nIf you'd like, you could reproduce the steps in my original post on CodeMirror, then reproduce those same steps on ACE (which also auto-indents) and see the difference.\n. I added a JS Bin to simulate this. It could potentially be turned in to a unit test if desired. http://jsbin.com/sojiqo/edit?html,js,output\n. Hey @marijnh,\nIf we are to say the formats for their respective styles are:\nAllman:\njavascript\nfoo(bar,\n{\n    baz: 10\n});\n1TBS / K&R:\njavascript\nfoo(bar, {\n    baz: 10\n}\nI think what should happen in the mode should be:\n1. If you've just typed anything other than an opening bracket ( { [ and you hit enter, then type an opening bracket we assume Allman style and match the indentation from the previous line.\n2. If you've just typed an opening bracket ( { [ and you hit enter, then we assume 1TBS style and we match the indentation from the previous line plus one extra tab (which is how it behaves already).\nAlso for a more compact style like the one you used:\njavascript\nfoo(bar,\n{baz: 10})\nYou could say: if all the brackets were closed on the second line, then indent one. So when you type the last ) it becomes:\njavascript\nfoo(bar,\n   {baz: 10})\nI assume you'd want it to look like that.\nI added a fourth test to the JS Bin based on this code :).\n. I admit I prefer the look of Allman style braces because they look more clear to me, but I accept that 1TBS is used more than Allman in the JavaScript community and I'm fine with using it in other projects. I accept both styles have advantages and disadvantages and I always use the style that the project I'm coding on uses.\nBut this is not a JavaScript issue only, it does affect other languages as I demonstrated in C# in Brackets. Allman is more popular in the C# and Java communities. Because CodeMirror is being used in editors such as Brackets and potentially many more IDE's in the future, you'd want the project to support all different styles of coding to cater to different communities and personal preferences.\nI think adding a configuration parameter is a great step :)\n. ",
    "almibe": "http://codemirror.net/mode/clike/index.html\n. Do these help?\nhttps://github.com/codemirror/CodeMirror/wiki/CodeMirror-addons\nhttps://github.com/optick/codemirror-mode-elixir. ",
    "mangstadt": "o.o  Nevermind! xD\n. ",
    "rdiehl": "The demo page does work.  As a test, I removed the calls to setOption('readonly'), and the problem still happens for me.  This is in a jQuery environment, so my code looks like this:\njavascript\nthis.editor = CodeMirror.fromTextArea($(\"#importers_coldScripts_coldNarrative\")[0], {\n        tabindex: 10\n});\nI tried changing the jQuery selector to just use document.getElementById, but still no Cut/Copy in IE.  What can I do to continue debugging this?\n. ",
    "smlombardi": "This also is the case with Safari 9.1 Even on the demo page.\n. ",
    "shw6rn": "@marijnh I'm able to reproduce this issue on v5.30.0, IE11. I used the active-line demo with some small changes: https://github.com/codemirror/CodeMirror/compare/master...shw6rn:IE-context-menu-issue\n. Fix was merged in #4048\n. Yeah I could use findMarks instead\n. @marijnh I made the fix using findMarks instead. Could you take a look?\n. ",
    "wbinnssmith": "@marijnh do you have any thoughts on this? Much appreciated.\n. @ForbesLindesay is right. diff-match-patch is dependency-free and quite\nsmall. But that size only matters in \"npm install\". Whether or not this\ngets downloaded to the browser is up to the bundler, and browserify and\nwebpack will only do so if the require call is in the AST, which it would\nonly be if the merge addon is itself required.\nThe merge addon simply doesn't work in its current state with CJS bundlers\nlike browserify since it requires a module that isn't listed as a\ndependency. Even then, the result of that module require is unused and a\nglobal (many globals in this case) is assumed to exist anyway.\nOn Fri, Oct 16, 2015 at 2:12 AM Forbes Lindesay notifications@github.com\nwrote:\n\nDownloading the module is cheap, practically free. What does matter is\nwhether end users need to download it to their browser as part of the\nbundle, but this doesn't change that.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/3593#issuecomment-148662420\n.\n. @maijnh will you please reconsider? As @ForbesLindesay and I explain above, it is far more difficult for browserify or webpack users to use the merge addon than a small inconvenience.  \n\nIf you'd rather leave the dependency implicit (which I would still strongly\nrecommend against), those who do use the module from npm will receive one\nthat doesn't leak globals.\nEither that or the require call should be removed and users will be\nexpected to actively leak these globals themselves.\nI feel both of these options are less ideal though, and feel like a step\nback for browserify and webpack users. Of course, users who don't require\nthe merge addon will not receive this library in their bundle, nor will\nusers of script tags or the like.\n. Thanks for your understanding. I'd love to help with the continued modularization of CodeMirror. Is that work somewhere at the moment?\n. ugh yes. thanks.\nAlso noticed that these enum values are simple ints, where DIFF_EQUAL is\n0 in the original implementation, so the || shortcircuiting will fail in\nthe last case, where diff_match_patch.DIFF_EQUAL is 0 and DIFF_EQUAL is either undefined (as in this case) or just throws.\n. ",
    "bgrins": "Alright, thanks.  Looks good to me.\n. I also considered using Array.isArray, but IE8 doesn't support that.  I took this from the polyfill at https://developer.mozilla.org/ro/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray.\n. ",
    "goderbauer": "Closing this in favor of the more advanced PR #3601.\n. ",
    "nthienan": "When I try to reproduce this problem I notice that it occur when we have more text with few the differences. One html page was prepared but I cannot attach in here. How to I provide it for you?\n. It is available at: https://gist.github.com/thienan93/b6ea740ad7a89d014f3d. Hope that it will help you find the root cause for the problem. Thanks\n. ",
    "samccone": "cc @paulirish -- could this be related to the issue around the browser not fetching the font until a recalc is tripped?\nI wonder if a force recalc and an explicit wait for the font to be downloaded until the cursor position is calculated in codemirror could be a fix... \n. ",
    "caitp": "Eh, there's a bit more work needed on this, as seen in https://twitter.com/caitp88/status/656351079358054400 (and some more work needed on template literals, too). I guess I'll make an attempt to fix it.\n. ",
    "Tymek": "ok\n. ",
    "srawlins": "Good idea. In fact, most of the templating languages are incredibly similar to Mustache (Django, vue?).\nI don't know what the base should be. Mustache is the simplest, so maybe Mustachelike?\nIn any case, I think this PR with the backdrop: functionality makes it the most powerful, and correct for Mustache. In the next PR, should I change Handlebars to be a configuration of Mustachelike?\n. Thanks for the suggestions, @marijnh. I've created an alternative PR, #3624, to compare with this one. What do you think?\n. @marijnh implemented a different feature, and commented about it over at #3624. Thanks!\n. Handlebars does appear to be essentially a superset of Mustache (Handlebars does not feature Mustache's Set Delimiter syntax, which my PR also does not include).\n\nSo why, precisely, aren't you simply using the existing Handlebars mode and leaving it at that?\n\nThe handlebars mode does not support overlaying highlighting onto another language. Instead, every user who wants to overlay handlebars (or mustache) onto another language must copy and paste 7 lines and then make configurable per backdrop language. The goal was to have a mode that highlights Mustache syntax and accepts a backdrop language, the concept taken from vue.js.\n. Should we instead apply the overlay configurability to the Handlebars syntax and be done with the Mustache parser?\n. @marijnh Thanks much this is perfect! Thanks for your work!\n. > It works either way in modern shells but using this \\ form is more syntax correct I think\n@tcederquist This is wrong.\n```bash\n$ echo 'hello \\\n\nthere'\nhello \\\nthere\n$ echo 'hello\nthere'\nhello\nthere\n```\n\nThe two forms produce different results, and both are valid bash.\n@marijnh Re-open?. @marijnh Oh, lol, you fixed. Thank you!. ",
    "AdriVanHoudt": "hmm do you by any change now if Brackets already takes this into account? because if this is already the case I will open an issue on brackets to see if they can incorporate a fix\n. by brackets I mean http://brackets.io/ \n. ok then I am not sure what you mean with the javascript mode, let me open an issue on the brackets repo for this\n. So codemirror is not marking it correct?\n. I am not familiar with codemirror itself, just know it is used by brackets, but as @abose pointed out shouldn't it be tagged as arrow function instead of operator? (or am I understanding this wrong?)\n. ",
    "abose": "I do not see that => is colored differently in http://codemirror.net/mode/javascript/ \n. Now I see why that coloring makes sense. \nThanks. \n. http://www.ecma-international.org/ecma-262/6.0/ does not define => as an operator. It is identified as Arrow Function Definitions .\n. ",
    "raveren": "woah it works on chrome, firefox is broken though\n. Also, the steps are:\n1. Click compress\n2. Get bad output :)\n. No, strangely I do not. Ah if it works for everyone else, I'll just drop it\n:)\nOn Tue, Oct 27, 2015 at 5:47 PM, Marijn Haverbeke notifications@github.com\nwrote:\n\nI tested Firefox 40 and 41 on Linux, but neither show the problem (the\ndownloaded file is a compressed CodeMirror script). Do you have any strange\nproxy or caching setup?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3615#issuecomment-151546718\n.\n. \n",
    "oksayt": "Thanks for the quick fix!\n. ",
    "JobJob": "Thank you! :+1: \n. ",
    "toni07": "Hi, how can I see the test runner results? You may be right for CSS, actually I just use this lib as a readonly component, so I don't need to support the redraw.\nMaybe I should keep my own changes, sorry for disturbing.\nThanks\n. Great, thanks!\n. ",
    "continuata": "We were using .CodeMirror-hint:hover.\nThe problem isn't styling the hover, it's the fact that both the hover and the active element are highlighted, which is confusing for the user.\nI don't see any CSS way around that.\n\n. ah yes ... sorry we use single click, so I hadn't considered the double-click use-case. \nThat seems like a good solution to me now.\n. Will do\n. seems to be caused by the fact your pointer is hovering over the hint pane when it scrolls, which is triggering a mouse-move event (as the window is moving behind the static pointer)  ... which then initiates another select event.\nI may be able to get it to ignore mouse move events whilst scrolling ... I'll take a proper look soon.\n. Yes that should work\n. ",
    "guptvaibhav": "Hello guys,\nI am facing the same issue. Could you please advice what I should do.\n\nI am using version : 5.17.0\n. Hi guys , still waiting for a reply from you.Please have a look at this\n. The issue I am facing is while using codemirror hint , I am able to browse through the suggestions using keyboard cursor, but not using mouse. Please have a look at the gif which I have attached. \nSo basically the mouse selection is not working for me.\nIn issue #3636 I could see that there was an exact same problem. \n. yes and the mouse hover doesn't work as well. Please have a look the the gif file above. \n. I am using npm codemirror version - 5.17.0\n. So you mean that hover doesn't work but the clicking is alright?\nIn my case clicking is also not working , what could be the reason ?\n. ",
    "Karthiindia90": "summernote have default value  \nYou can use striphtml to remove html tags  while storing in database \nusing System.Text.RegularExpressions; // for striphtml regex \npublic partial class XXX : System.Web.UI.Page\n{\n```\nstatic string StripHTML(string inputString)\n{\n    inputString = Regex.Replace(inputString, @\"<(.|\\n)*?>\", string.Empty);\n    inputString = inputString.Replace(\"\u00a0\", \"\");\n    return inputString;\n}\n```\nand then  use this \nstring summaryhtml = StripHTML(txtsummary.Text);\n   summary = summaryhtml;\nI dnt know your purpose, Many of them searching for summernote validation  so i attach this also it will help anyone\nyou can validate summernote by using custom validator  like\n<asp:CustomValidator ID=\"cvsummary\" runat=\"server\" ValidationGroup=\"submit\" ValidateEmptyText=\"true\" ControlToValidate=\"txtsummary\" ForeColor=\"Red\" Text=\"*\" Display=\"Dynamic\" ErrorMessage=\"Summary Required\" OnServerValidate=\"CustomValidator1_ServerValidate\"></asp:CustomValidator>\nyou need to check validate function in the required button to fire custom validation\n```\nprotected void BtnSaveNew_Click(object sender, EventArgs e)\n{\n   // Page.Validate();         // i used when custom validator not fired for the first time\nif (IsValid) { \n//code here     \n string summaryhtml = StripHTML(txtsummary.Text);\n   summary = summaryhtml;\n //\n     }\n    }\nprotected void CustomValidator1_ServerValidate(object source, ServerValidateEventArgs e)\n{\nif (e.Value.Equals(\"<p><br></p>\"))\n{\n    e.IsValid = false;\n\n    ScriptManager.RegisterStartupScript(this, this.GetType(), \"Popup\", \"alert('Please Enter all Details');\", true);\n\n}\nelse\n{\n    e.IsValid = true;\n}\n\n}\n```\n}\n. ",
    "joshco": "cool. thanks!\n. ",
    "burdiuz": "Experienced same behavior, were there no solution for this? I've found these issues with unexpected newlines when entering text(if you pause and enter new symbol. newline appears before new input), but second was \"fixed\" by disabling \"active-line\" addon.. ",
    "swill": "I was trying to find the source of a problem that made editing on Android (in Chrome) completely impossible.  Newlines added all the time, the keyboard closing as I type, backspace not working as expected, really, it was too many issues to count.  I removed all of the options other than mode and theme and then systematically added back one option at a time and redeployed my application and tested.  It turns out that the active-line addon was the source of all my pain.\nI am using the mode: 'javascript'.  I am not seeing all of the strange behavior I was seeing in my environment in the active-line demo (https://codemirror.net/demo/activeline.html), but there is some strange behavior in that demo on Android as it is.\nHope this helps others.... If nothing else, please consider adding documentation to guide that the compression or minification must be done outside of what you guys offer and what files need to be added to the minification.  I spent like two hours yesterday trying to find the old compress.html file to figure out how to get the code in a minified state.  I did not upgrade from 5.12 for months simply because it was not clear how to produce the minified version. \nThe current documentation is not clear how to upgrade from previously minified code to a new process.  I think this is a major problem.  AT LEAST call out that you have to minify on your own since you dropped the feature.  That alone would have saved me like 2 hours of searching yesterday.... ",
    "chinchang": "I see exactly all the issues mentioned by @swill on Android Chrome. But even removing active-line plugin doesn't fix it. Infact the issue is same on this CodeMirror demo -> https://codemirror.net/demo/theme.html. Thanks for updating @adrianheine \ud83d\udc4d . Yes. I wanted hint to show up automatically instead of a manual keyboard shortcut. So I have this:\ncm.on('inputRead', function onChange(editor, input) {\n if (input.text[0] === ';' || input.text[0] === ' ') { return; }\n CodeMirror.commands.autocomplete(cm, null, { completeSingle: false })\n});\nIs this the right way to show automatic completion hints?. I get it. Thanks @marijnh . Thanks @hacdias \ud83d\udc4d . ",
    "0joshuaolson1": "Yay, I found the issue GitHub's having?. ",
    "alur": "I just added pointer-events: all to the css class for the individual markers.\nGood point about using a single handler. I would still like a way to get the original annotation object from the click though. Would just setting elt.annotation = ann; be acceptable?\nAlternatively, I could set elt.annotation = ann; and move the listener to this.div, to keep the interface a little cleaner while only having one event handler per annotation type.\n. That should work great. I updated the push request.\n. Added a couple of tests.\n. Fixed the whitespace in the tests.\n. Actually, it looks like the scala demo page is throwing the same exception https://codemirror.net/mode/clike/scala.html\n. Fair enough.\n. This seems to have broken backspace in insert mode.\n. Sounds fine to me.. Actually, wait, I need to fix that code.. There, should be good now.. That does seem to fix it. Thank you!\nUnfortunately, no, it's not open source. Though I'm not sure there is any reason it couldn't be. I'll look into it.. That's fair.  Let me explain what I'm actually trying to solve.\nWe have some contenteditable divs inside linewidgets. Right now we do this storing/restoring of the selection in response to blur & focus events on the divs. It has worked fine in the past, but now (and I think this is something new in Chrome 58) it seems like the selection offsets get set to 0 prior to the blur event firing. Unfortunately, the .focus() call just places the cursor at the beginning of the text area.\nWould you be open to something like adding an event instead, so that we can store the selection before the element gets removed from the DOM?. Yes, that works great. Thank you!. The latest TypeScript spec is a little outdated, but it does include type parameters for new.\nhttps://github.com/Microsoft/TypeScript/blob/master/doc/spec.md#389-constructor-type-literals\nhttps://github.com/Microsoft/TypeScript/blob/master/doc/spec.md#414-the-new-operator. Duplicate of #4917. No, it's alright.\nI see you added a typescript mode to the google-modes repo now, where this does work :). We will end up switching to that anyways.. ",
    "maryrosecook": "Thanks a lot for your response!\nFor your first question: I'm pressing the key Dvorak maps to z (on a keyboard with US QWERTY keycap markings, this is marked as /).\nI can't answer your second question, I'm afraid.  See below for why!\nI went to the CodeMirror homepage in Chrome and executed the following code in the console:\nwindow.onkeydown = function(e) {\n  console.log(e)\n};\nI then put the caret into the CodeMirror textarea near the top of the page and pressed the key combos below.\nIf I press the key bound to z on its own (on a keyboard with US Qwerty keycap markings this is marked with /), a KeyboardEvent is logged that has a keyCode attribute of 90 (which is reported by http://keycode.info to be the keyCode for z.  All as expected.\nHowever, if I press Shift-Command-Z I get two events (not the expected three):\nKeyboardEvent 1: keyCode of 16 (keycode.info reports this as the shift key).\nKeyboardEvent 2: keyCode of 91 (keycode.info reports this an the left command key).\nNote that no event for the z key being pressed was emitted.\nAs an experiment, I pressed Shift-Command-V and got the expected three events:\nKeyboardEvent 1: keyCode of 16 (keycode.info reports this as the shift key).\nKeyboardEvent 2: keyCode of 91 (keycode.info reports this as the left command key).\nKeyboardEvent 3: keyCode of 86 (keycode.info reports this as v).\nIs this helpful?\n. I switched from Dvorak to a US QWERTY keyboard mapping and tried the key combos.\n- For Shift-Command-Z, the expected three events get fired.\n- For Shift-Command-/, a event gets fired for Shift and an event gets fired for command, but no event gets fired for the /.  Instead, the Chrome Help menu appears!\nFurther, I think you're right that no key event gets fired for the z in Shift-Command-Z in Dvorak. I made a test textarea (without CodeMirror) here: http://maryrosecook.com/textareaexample.html It includes code that binds to keydown events on the textarea.  In Dvorak mode, when I press Shift-Command-Z, only the events for shift and command get fired.\nShould I file a bug on Chrome?\n. Yes I tested in Safari and it works fine.  It may just be Chrome.  Thanks a lot for looking into it!\n. ",
    "yukulele": "I think global variable should be colored in blue (on line 4&12) like local variable\n. opacity: 0 fix it\n. ",
    "stsievert": "Hm, no luck here. Is a restart is required?\n. Confirm, restart fixed it.\n. ",
    "abhishiv": "Just spent a couple of hours trying to fix it. In case it helps anyone, one way is to set parent as position=absolute and height=100%. And then apply display=flex and position=relative to grandparent.\n. ",
    "neruthes": "\ud83d\ude2d\n. ",
    "fwchen": "\ud83d\ude22 anyone fix?. ",
    "Himself65": "\u6240\u4ee5\u8bf4\u4ec0\u4e48\u65f6\u5019\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff1f\nso...when can fix this bug?. ",
    "olpoco": "@coodoo  how did you work around this?. ",
    "snrztrk": "Slider b\u00f6le olur aga\n. ",
    "kevinSuttle": "What I'm saying is that it would be great to embed a Codemirror into a GitBook. https://ymcatar.gitbooks.io/gitbook-test/content/testing_ace.html\n. ",
    "StellarDoor5319": " \nEverything looks good to me. All coding styles are the same as surrounding code, there are no obvious errors.\n\nReviewed 2 of 2 files at r1.\nReview status: all files reviewed at latest revision, all discussions resolved, some commit checks failed.\n\nComments from Reviewable\n Sent from Reviewable.io \n. \nReviewed 1 of 1 files at r1.\nReview status: all files reviewed at latest revision, 1 unresolved discussion.\n\nmode/htmlmixed/htmlmixed.js, line 79 at r1 (raw file):\n\nJavaScript\n      multilineTagIndentPastTag: parserConfig.multilineTagIndentPastTag\n    });\n\nWhy has this blank line been removed?  I think it makes the code easier to read.\n\nComments from Reviewable\n Sent from Reviewable.io \n. \nReview status: all files reviewed at latest revision, 3 unresolved discussions.\n\nmode/htmlmixed/htmlmixed.js, line 137 at r1 (raw file):\n\nJavaScript\n      }\n      else if (state.isDefault && state.inTag && tag && />$/.test(stream.current())) {\n          var inTag = /^([\\S]+) (.*)/.exec(state.inTag);\n\nBTW these few lines have the incorrect indent.\n\nmode/htmlmixed/htmlmixed.js, line 140 at r1 (raw file):\n\nJavaScript\n          state.inTag = null;\n          state.isDefault = null;\n          var modeSpec = stream.current() == \">\" && findMatchingMode(tags[inTag[1]], inTag[2])\n\nBTW these three lines are indented incorrectly too\n\nComments from Reviewable\n Sent from Reviewable.io \n. \nReviewed 2 of 2 files at r1, 2 of 2 files at r2.\nReview status: all files reviewed at latest revision, 1 unresolved discussion, some commit checks failed.\n\nsrc/edit/mouse_events.js, line 329 at r2 (raw file):\n\nJavaScript\nfunction gutterEvent(cm, e, type, prevent) {\n  let mX, mY\n  if (e.type == \"touchstart\"){\n\nShouldn't there be a space between the bracket and curly brace? This makes it follow the coding style in other CodeMirror scripts.\nJavaScript\nif (e.type == \"touchstart\") {\n\nComments from Reviewable\n Sent from Reviewable.io \n. I can use it, but connecting the repo means that it syncs automatically (notifying me and other reviewers of new commits), and adds a few other features. Just recommending that you connect it \ud83d\ude00. Ok. I can still review with it though. Just a reccomendation. Thanks \ud83d\ude00. ",
    "theres-waldo": "\nif you know of some API that would help the editor predict what is going to be scrolled into view, or are in a position to promote the introduction of such an API, let me know\n\nCoincidentally, we were just talking about introducing such an API last week. https://bugzilla.mozilla.org/show_bug.cgi?id=1232491 is tracking this work.\n. ",
    "staktrace": "Note that the way the gutter is rendered causes pretty poor performance because Gecko ends up creating separate layers for each line number. It has no way to know that they will always move in sync and so it can't coalesce them on to the same layer, which would be much better. See https://bugzilla.mozilla.org/show_bug.cgi?id=1239615#c11 and nearby comments.\n. Yeah that's fair. There's no reliable way to do it from CSS because it's up to the browser implementation, which can change over time. Even my prototype with position:sticky suffers from the same problem, although I think that in that case we can modify Gecko a little to combine them into a single layer.\n. @adrianheine consider applying for a MOSS grant. The Firefox devtools use codemirror too so that should qualify under the foundational technology section.. ",
    "Petergatsby": "Have there been any updates to this issue? I'm experiencing this in Chrome.. ",
    "gcziprusz": "More specifically -> other libraries may declare strict mode and in ES5 strict this in an annonymus IIFE is undefined instead of referring to the global window.\n. :+1:  works for us\n. ",
    "acornejo": "this works for me too, I tested on OSX and Linux, and with chrome and firefox. I think this is not a bug with codemirror\n. FWIW you can use the c key for the same effect, and that one does work in codemirror (and vim).\n. ",
    "den1k": "Thank you @marijnh !!\n. @marijnh Thanks for the patch!\nI've come around to understanding your point about origin. My use case is meta in that I need more granular event information. Imagine you are recording all the actions incl. their attributes a user and editor perform that lead to a change in the text. Using that, one should be able to replay all the changes by sending events to some dispatching function. Whether these events are triggered by the user or programmatically should not matter to their effect.\n. The problem was that the Codemirror editor instance's height css property was set to inherit. Once we set a fixed height, we got back to FAST speed. A 600 ms slowdown still seems out of the ordinary, so I'm leaving this issue open.\n. @marijnh Resizing is not the issue. It seems that if none of the editor-wrapping instance have a fixed height, i.e. when using flexbox everywhere, codemirror performs different operations than with fixed styles. (I'm putting a note down to prepare and example with the issue this weekend.)\n. Use fixed width and height on the container of the editor element.\nOn Thu, May 4, 2017 at 5:07 AM redlolgeerf notifications@github.com wrote:\n\ni've encountered the same problem with very slow updateHeightsInViewport.\nare there any workarounds?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/4076#issuecomment-299132652,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AEb7Ij5V17NbWz3XNFsi5pJRbhLdoj0Tks5r2ZU3gaJpZM4I48pD\n.\n. \n",
    "grzegorzmazur": "Right, thanks for the hint and sorry for the noise, still learning how to use git(hub).\n. That's right, the language is very flexible and the notion of keyword doesn't really make sense in it. Yacas  is quite similar to mathematica and that's why I followed the mathematica mode, even though I didn't actaully like it very much. Anyway, I'd rather avoid defining a list of keywords, although such a list would actually work quite well in most cases. Still, things can be improved - in the current version I've made a difference between thing that look like function call (it's either a function call or a rule defining transformation for function calls) and all other identifiers; the former are recognized as keywords and the latter as variables.\n. Ups, ok, I wasn't aware of that. Anyway, I've cleaned up the history (thanks for the instructions on how to do that), so hopefully it's in good enough shape now.\n. ",
    "RAHMANINkolesi": "It is also really important for me... I want to help for this.... ",
    "Gatunox": "Yes, it sounds good to have the number of items found, either on search of replace funtions. ",
    "radek-holy": "Well, speaking of obviousness... Is this behaviour (moving the cursor to the beginning) documented somewhere? I failed to find the reason why the cursor is moved to the beginning rather than to the end (like regular HTML fields) of the document (or let's say to the beginning of the first difference or to the end of the last difference).\n. ",
    "LeonStaufer": "I do not believe this is an issue that \"concerns precisely only [@radek-holy]\". \nI am working on a live editor and I believe this is an issue that would affect anyone replacing the content of the editor with other content (which I imagine is quite a number of people).\n@marijnh explains why using setValue causes this behavior. However, maybe another function could be implemented that updates the content and maintains the cursor position.. Okay fair enough. If I may ask, what's the harm of adding this functionality?\nIf it's a question of prioritization, I would gladly add the function and submit a PR.. That is very reasonable. \nWould it be open to adding it as a note to the manual, for future users who might encounter the problem and not discover this issue?. ",
    "dabbott": "Hi guys. I had an unfortunate mid-air collision with this PR... but I'm putting my PR up as well. It's not 100% finished, but in terms of correctness I think it's very accurate. I originally attempted something like this approach, but found it drastically simpler and less error-prone to add a jsx flag to javascript mode and extend javascript mode directly. I think the closely-coupled-with-js approach will be easier to maintain... but would also understand if you guys don't want to go that route, since it's code that most JS users won't need. Lemme know what you think @marijnh!\nI put more notes in the PR.\nHave a look here: https://github.com/codemirror/CodeMirror/pull/3744\n. @parisk For sure! Actually, I haven't looked into how to do that stuff at all yet, so that would be great.\nAlso, bracket matching. And possibly tagname matching. I'm probably styling some stuff with the wrong styles too.\n. Can you clarify what you mean by XML highlighting?\n. Hmmm, yeah, I see what you mean. Logically I think they should be highlighted as JS variables/properties... but at the same time, they give the impression of not being highlighted, since it's relatively uncommon to have locally defined JSX element names or property access in element names.\n. Great! Glad to have this in. We sent you an email re: donation and buying a support plan.\n. Yup :). By using the very powerful JS parser, most of the bookkeeping for the complicated stuff is free.\n. Awesome, thanks for fixing these so quickly! I'll test and confirm they're fixed. As far as style goes, I'm trusting what facebook shows on the reactjs site as the \"proper\" way to indent.\nYeah, I dunno, I've never seen anyone write elements as attributes in any JSX code I've ever seen in the wild over the past year... I believe it's exactly the same as writing foo={<Foo />}, except without the {}, for convenience. I don't personally find this case to be valuable or relevant, other than to properly adhere to the spec (which is not adhered to by Babel in a few places, as far as I can tell -- although Babel does transpile this case here).\nIt's in the spec as:\n```\nJSXAttributeValue :\n\" JSXDoubleStringCharactersopt \"\n' JSXSingleStringCharactersopt '\n{ AssignmentExpression }\nJSXElement\n```\nIMO, not worth the effort.\n. 1: Boolean attributes :white_check_mark: \n2 & 3: Comments are correct for the list of attributes <foo /*comment*/>, but in between an open and close tag they should be colored as regular text instead of comments <foo>/*not a comment*/</foo>. Transpiled correctly here (though colored wrong).\n4: Won't fix, IMO.\n5: Much much better. Still a few weird points. I'm not really sure how to systematically describe these other than as random one-offs of how they do/don't behave like I expect... \nFixed (although, should the closing } be electric?)\n\nBetter, but indents one spot too far, I think.\n\nGood (also, closing } should be electric?)\n\nHere I expect the closing } to align with showFooter.\n\nThree more things I found!\n6: Attribute indentation doesn't behave as I would expect. I would set multilineTagIndentPastTag: false on xml by default when jsx is used. This matches the attribute indentation style Facebook uses.\n7: Fat arrow => expression doesn't parse correctly. If surrounded by () it's ok. Fat array => {statements} is also ok.\n\n8: Very minor, but something's a little off about the demo page https://codemirror.net/mode/jsx/index.html. The tab character inserts the equivalent of 4 spaces, but adding a newline after a { or elsewhere only indents 2 spaces. I would be screenshotting the demo page instead of my own app, but I can't quite tell what's correct and what's not.\n. 1: :white_check_mark: Boolean attributes \n2: :white_check_mark: Line comments \n3: :white_check_mark: Block comments \n4: :white_check_mark: Attr=<Element />. Great! Glad not to have to restrict what users can do.\n5: JS {} indentation\n6: :white_check_mark: Attr indentation \n7: :white_check_mark: Fat arrow expressions \n8: :white_check_mark: Not an issue, my bad \n. This one's just a general javascript mode issue I found while testing jsx mode. Object destructuring with a trailing comma was throwing off the rest of the parsing:\n\nFixed in #3748:\n\nIt's here in the spec. (I thought maybe I was just writing weird code!)\n```\n13.3.3 Destructuring Binding Patterns\n...\nObjectBindingPattern[Yield] :\n{ }\n{ BindingPropertyList[?Yield] }\n{ BindingPropertyList[?Yield] , }\n``\n. I wonder if indentation is off because the open and close brackets are getting parsed in different modes? The{is styled ascm-m-xml, while the}is styled ascm-m-javascript`. I only noticed this when I tried turning on some addons.\nThey don't quite match up with the edit/matchbrackets addon.\n\nThey sometimes get automatically closed with edit/closebrackets and sometimes don't.\n\n. I tweaked the indentation within {} for the common cases. Indentation will look like this now:\n\nI'm pretty much handling each case specially. I don't know if there's a better overarching rule that these follow that I haven't noticed. \nOne thing I wasn't sure how to handle:\n\nI want to indent differently, depending on whether a <tag> is on the same line (and the start of the line) or not. I naively look at the previous token on this line for a > (here), but that's not quite right (since there can be junk in the way). Is there a better way to do this?\n. One last thing I found: currently the JS within the { } is getting parsed as a statement, when it should be parsed as an expression. \nE.g. each property in this object is parsed as variable, and it's one long continued statement\n\nShould look like this:\n\nI took a stab at fixing by adding a hook\njavascript\nexpectExpression: function(state) {\n    state.cc.push(expressionNoComma)\n}\nto JS mode. Which mostly works, except that the curly braces are getting parsed by the JS mode also. So I tried:\n1) Parsing the curly braces manually in JSX mode (and they end up cm-m-xml), so that expecting an expression works correctly. Which does work, but the logic is a little ugly, and I will have to mess with indentation a bit more, since now using the JS lexical.indented isn't quite right. https://github.com/codemirror/CodeMirror/compare/master...dabbott:parse-braces-in-jsx?expand=1\nor\n2) Do it all as a hook to JS mode, but the hook will be very specific to JSX. And I will probably have to pass in indent param and assign it to lexical.indented, or something, since this breaks indentation in an edge case. https://github.com/codemirror/CodeMirror/compare/master...dabbott:expect-expression-block?expand=1\nIn both cases I would still need to tweak indentation a bit more. Or maybe theres a better way entirely. What do you think?\n. ",
    "julienw": "I can add another slightly broken example here:\njavascript\n  render() {\n    this._scheduleDraw();\n    return (\n      <div className={this.props.className}>\n        <canvas\n          className={classNames(\n            `${this.props.className}Canvas`,\n            'threadStackGraphCanvas'\n          )}\n          ref={ref => (this._canvas = ref)}\n          onMouseUp={this._onMouseUp}\n        />\n      </div>\n    );\n  }\nAnd the result in current CodeMirror:\n\nYou can see some of the colors are still wrong: see the angle bracket in the ref's arrow function, or onMouseUp not having the right color, or the closing div tag.. Ah right, I just used Codemirror's home page's demo, so likely was in HTML mode... Sorry about the disturbance...\nIs there any drawback using JSX mode for all JS code ?. Thanks ! Maybe it's not the right location to ask this, but why don't you merge JS and JSX modes, then ?. I don't really understand why, if there's already all this. I'm not saying the code should be physically copied, but enabling the Javascript syntax should IMO also enable JSX... especially if TypeScript and others are also already enabled.. ",
    "henryw374": "that was quick! thanks\n. ",
    "ryantrem": "In the case where I paste 130381 lines (the sample file I am using for testing) of text into the editor at http://codemirror.net/index.html, editor.display.sizer.style.minHeight returns \"2607628px\". If I remove a handful of lines, it returns \"2607228px\". If I add a few lines, it returns \"2607708px\". So it seems like this is a different problem from the one you describe above.\n. ",
    "hirak99": "Here's how it looks like.\n\n. ",
    "jgerlach93": "and how exactly would this work?\n. ",
    "dperetti": "While I'm at it, would it possible to break the analyse and display non-colored code instead of throwing an error (I don't see a way to catch it, is there any ?).\nThanks.\n. The fix is here : https://github.com/dperetti/CodeMirror/commit/5201a7003aa8c41adc98bf128cbb28332dfb643c\n. Sorry I just meant to pull request for https://github.com/dperetti/CodeMirror/commit/5201a7003aa8c41adc98bf128cbb28332dfb643c .\nNot sure if you can selectively merge this one. Let me know.\n. This one is weird :\nIt still breaks the same way with the following, now only because of the click: () => app.quit() line !\n``` javascript\nconst appMenuItem = {\n  submenu: [\n    {\n      label: 'Quit',\n      accelerator: 'Command+Q',\n      click: () => app.quit(),\n    },\n  ],\n}\nconst projectTemplate = [\n  {\n    label: 'Project',\n    submenu: [\n      {\n        label: Reveal in ${'File Explorer'}, \n        accelerator: 'CmdOrCtrl+Shift+R',\n        click: (item, focusedWindow) => { focusedWindow.webContents.send('onRevealInFinder') },\n      },\n    ],\n  },\n]\n```\n. ",
    "arni2033": "Hello, marijnh!\nI already did that in https://bugzilla.mozilla.org/show_bug.cgi?id=1239534#c2\nThis is not edge case of any kind. This is my default install, and I have this issue for 2+ years on Firefox. I think it's more firefox developers' fault than yours, because (A) they should've tested codeMirror better (B) they spread bad tutorials on handling mouse scroll, which caused many bugs.\n. ",
    "andrew-vandenbrink": "No workaround\n\nWith workaround\n\nWith workaround, change one line\n\nOf course I can change codemirror.css\n.CodeMirror pre {\n  z-index: 2; /*Change this to 0*/\n}\nBut what will be the consequence of changing it?\n. The other way around is to change the z-index overlay, that will also fix the issue, I assume z-index:10 is sufficient?\n. ",
    "paulsputer": "@marijnh setting a gutter marker across a range of lines along with an alignment option for placing the passed element either to each line, or align within the group i.e top, middle, bottom line.\ncm.setGutterMarker(from: {line}, to: {line}, gutterID: string, value: Element, align: string (each|top|middle|bottom) )  \u2192 LineHandle[]\nThe lineInfo function would then include all gutters which are defined on or that cross over the given line.\ncm.lineInfo(line: integer|LineHandle) \u2192 object\nFor example building upon the v3 gutter sample, a note relevant to lines 1 through 5 could be placed with align:middle, so only one note is shown.  However, if lineinfo is called on any line between 1 and 5 it will return the associated note.\nIn-addition multiple markers could be placed on the same line in the same gutter, allowing support of multiline markers whose ranges cross.  Currently it appears only one item per line and gutter type pair is supported.\nPerhaps this is an application specific use case better handled outside the core codemirror source.  What do you reccommend?\n. ",
    "vanderlee": "I've created a pull request for a simple implementation: https://github.com/codemirror/CodeMirror/pull/3782\n. I'll run a conversion. What kind of line endings did you use?\nEither way travis-ci is complaining about a license blob I didn't even touch.\n. Done\n. Overwrite mode doesn't work at all in RTL mode, it just inserts (or atleast that's how it works in the bidi demo). This basically makes the RTL point moot at the moment. Regardless, Bidi support is quite doable; I've added basic support to show the character on the left when RTL.\nNo event for overwrite mode switching is a problem, Without a way to hook into that, it'll be practically impossible. Is there any way to get around this?\nThe difficult problem actually seems to be the CSS; line-height is not predictable.\nDo you have any good documentation on how to make addons and/or perhaps a good example of a small one that I can use as a template?\nBtw. is any of the Bidi information exposed to addons?\n. ",
    "wissamsaikali": "Hey, i am using Version 47.0.2526.111 (64-bit) on ubuntu\nOn Wed, Jan 20, 2016 at 11:54 AM, Marijn Haverbeke <notifications@github.com\n\nwrote:\nHi. This does not happen for me on Chrome. Which browser / version are you\nusing?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3781#issuecomment-173150169\n.\n. 1. Go the merge demo page\n2. Keep adding additional characters at the end of any line till the\n   scrollbar on the left editor becomes clearly smaller than the one on the\n   right\n3. Now when you scroll left and right on the left editor you will notice\n   that the gutter will shift to the right\n\nPS: this issue appears on Chrome Windows as well.\nThank you\nOn Wed, Jan 20, 2016 at 12:03 PM, Marijn Haverbeke <notifications@github.com\n\nwrote:\nHm, that's exactly what I'm using. Could you describe your steps in more\ndetail? When I go to the merge demo page, and scroll either of the editors\nright and then left, the gutter stays in place.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3781#issuecomment-173151848\n.\n. Hi, \ni have upgraded code mirror to the latest but same error appears.\n. Hi,\n\ni've tried the same scenario in the latest code of codemirror but the issue\nis still appearing.\nPlease check the attached image.\nThank you\nwissam\nOn Wed, Mar 2, 2016 at 2:17 PM, Marijn Haverbeke notifications@github.com\nwrote:\n\nClosed #3858 https://github.com/codemirror/CodeMirror/issues/3858.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3858#event-574574090.\n. Fixed.\n\nThank you\nOn Wed, Mar 2, 2016 at 3:00 PM, Marijn Haverbeke notifications@github.com\nwrote:\n\nIt works for me now. Did you pull patch 11f3d96\nhttps://github.com/codemirror/CodeMirror/commit/11f3d9694d74d60328234756cc670f9c1e78f9d3\n?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3858#issuecomment-191229904\n.\n. \n",
    "kepta": "+1, I was able to reproduce it on\nBrowser Firefox \nMac \n. ",
    "rtparsons": "Pull request to fix this #3788 \n. ",
    "caub": "Thanks marijnh, yes I can get innerHTML, but \n- how do you create the editor from that string? this I guess?\n- ~~how do you position the editor for example as an overlay on top of the element (well I guess i can find the element .CodeMirror and position it myself)?~~\n- how do you retrieve that content before destroying it? this seems awkward\nmany questions sorry but that's exactly what I'd like\n. ",
    "antimatter15": "I agree that among the screenshots the former is aesthetically nicer, but I think that's just an argument for keeping the default setting singleCursorHeightPerLine: true. \nCurrently, when singleCursorHeightPerLine: false is set, the selection bands are taller than the height of the cursor. It feels a bit like walking on a beach, looking behind and seeing meter-wide elephant tracks where your own footsteps ought to have been. \n\nThe proposed behavior seems consistent with what typical user agents do when rendering text with higher line heights (actually, Chrome hugs the text even more tightly, leaving that oddly asymmetric vertical gap on the lower right of the selection band). \n\nMy particular use-case involves sticking interlinear widgets in between lines to preview values of expressions or to hint names of method arguments. \n\nThe current selection band placement seems to clash rather tragically:\n\n. I was inserting line widgets between every line in an earlier prototype, but decided to switch to the extended line height exactly because I was using line-wrapping. \nI would really appreciate it if you added a singleSelectionHeightPerLine option. Thank you for such a fantastic library!\n. This change affects lineComment as consumed by the official comment plugin. \nRight now, hitting \"Cmd+/\" toggles a block comment (even on languages which support -- line comments). This pull request toggles the line comment. . ",
    "cyrbon": "I've tried several things before submitting an issue and none of them were bug free (since it's my first time looking at codemirror code). \"key: | \" means that everything below which has indentation of at least 2 plus spaces should be treated as a string (preserving newlines).  \"key:  > \" means the same essentially (it just deletes newlines so that the multiline string is ends up as a one lined string in json). So, it is purely based on indentation in this case, because that string can have any special character and it will be ignored. Ace-editor does not have the problem in this issue, but it still uses a hack (using \":\" to find where next key starts vs using identation) and it fails as well when its fed something like this (special characters inside a string):\n``` yaml\n- key: value \n  anotherkey: another value\n\nkey: |\n    Some multiline string...\n    which continues here\n  anotherkey: |\n    Another multi-line string\n    with any character including # this and ':' this \n    and this: this\n  another_key: above is parsed incorrectly as well :( \n```\n\n\nHow it should be parsed can be checked with js-yaml live (which parses to json): http://yaml-online-parser.appspot.com/\nGithub also highlighted it right. \n. ",
    "ienzam": "Thanks for a quick fix.\nI tested the code. It improved the situation did not fix the problem completely.\nExample:\n1. Go to https://rawgit.com/codemirror/CodeMirror/master/mode/python/index.html\n2. Write code:\na = [[\n    [|]\n]]\n3a. Pressing enter turns the code to \na = [[\n    [\n]\n]]\n3b. Expected\na = [[\n    [\n    ]\n]]\nPS: https://rawgit.com/ienzam/CodeMirror/issues/py_indentation/mode/python/index.html shows correct behaviour (at least for this case).\n. Great, thanks for fixing these two issues quickly.\n. ",
    "Victorystick": "@dbarnett Highlighting was extended to support this in 2bed274. Can this issue be closed?\n\nJust noticed another worrying issue; filed #4468. :wink: . @JosephPecoraro Your second example is invalid syntax, although I understand that you might want the regex to be highlighted regardless. :smiley: \njs\nexport /regex/;               // This is a syntax error. What is exported?\nexport const regex = /regex/; // Valid\nexport default /regex/;       // Valid. @dbarnett Right you are.. ",
    "pabloferz": "No problem.\n. @marijnh This should fix #4356\n. All right, I believe this is ready. Feel free to review it.\n. The particular example works since version 5.12.0 of CodeMirror, for me it gives\njulia\nx = f(1,\n    2,\n    3)\nGranted, it could be better, but it''s better than reported in this issue and in https://github.com/JuliaLang/IJulia.jl/issues/119. Part of the problem is that the latest version of jupyter uses an older version of CodeMirror.\n. The julia mode was originally written based on the python one, and has never been really properly adapted. I plan on fixing this eventually, but right now I can't commit on doing so. If anyone does not feel like waiting, I'd say go ahead by all means.\n. @ianshmean Did you try typing you code over http://codemirror.net/mode/julia/? If you see the problem over there could you describe exactly how you are typing? Or are you pasting it and trying to format it?\nOn my end, if I type your code character by character over the demo site, I see no problems.. Oh, right. Thanks of that @marijnh . Fix at #4684. No problem. Cheers!. C.c. @marijnh. It is not included as a keyword but it is treated as an operator (in the example page over the codemirror site operators are not highlighted, but they are for example in jupyter notebooks).\nEDIT: Thinking more about it, in your example it is actually acting as a keyword and not as an operator, I'd have to think a way of treating it differently depending on the context (in can also be used as a function).. I'll try to look into this next week.. > (You have some linter errors due to using undefined variables.)\nFixed. ",
    "keski": "I created a quick fix where I execute popContext(state) again when a closing } bracket is found:\n...\nelse if (/[\\]\\}\\)]/.test(curPunc)) {\n   while (state.context && state.context.type == \"pattern\") popContext(state);\n      if (state.context && curPunc == state.context.type) popContext(state);\n      if (curPunc == \"}\" && state.context) popContext(state);\n   }\n...\nHowever, I'm not sure if this is the proper way to do it so I'll leave it to more experienced eyes to verify.\n. Yes, it's missing from the 2008 version but it is defined in the later published SPARQL 1.1 specification.\n. I couldn't really see anything else that was missing but I didn't have time to put in much effort. If I stumble across anything I'll make sure to provide feedback.\n. ",
    "tomerep": "I would also expect highlight of the active difference functionality.. ",
    "andersevenrud": "@Tedko I tried to emit a contextmenu event on the \"input field\", but that did not work :( I'm going to try hacking around some more\n. Looks like I'm affected by #2127 in this case\n. @marijnh \ndocument.body.contentEditable returns inherit.\nThe text is inserted into the body element itself.\n\nIf not, the only explanation for this that I can think of is a CSS problem causing the content of the editor to show up in the body\n\nIt's definately not a positioning problem. The weird thing is that a right-click fixes the problem (but not when simulated).\n. Leaving this here for others to see:\nA very kind stranger contacted me with this exact same problem and it seems that the -webkit-user-select CSS property is the cause of this.. ",
    "ChristosKon": "I close this issue as codemirror actually uses HTMLHint linting. So it is an HTMLHint issue.\n. ",
    "SusanDoan": "Thanks for getting back to me!\nI see this on Firefox 43.0.1, Windows 7 and Firefox 41.0.2, Mac OSX Yosemite.\nI think you went wrong on step 4 - you should spam letter keys until the Vertical scrollbar appears.\n. ",
    "yannickglt": "Thank you! I'll try :wink: \n. ",
    "pseyfert": "Thanks for the pointer!\n. ",
    "rokyed": "fixed  , it was from my side \n. ",
    "yutuo": "It's not scrollbar.\nWhen CodeMirror has only a single line, The text in CodeMirror will up and down when the mouse are scrolling\n\n.\nI'am sorry, My English is poor.\n. I'm sorry. I made a stupid mistake.\nThe title is \"CodeMirror can be scroll to up when scroll bar is hided\".\n. ",
    "SamyPesse": "More investigation:\n- Fast and fluid on Safari and Electron (weird since it's using Chrome)\n- Fluid on Firefox while not editing\n- Slow on Chrome (Version 48.0.2564.116) on 2 different macs:\n  - Mac mini 3Ghz\n  - Macbook Pro 2.7Ghz\n. ",
    "mron": "I\u2019m sorry, I must have missed a link.\n\nOn Feb 29, 2016, at 2:19 AM, Marijn Haverbeke notifications@github.com wrote:\nI can't interpret any of this, but it sounds a lot like you're working with music software. CodeMirror isn't, so this appears to be filed in the wrong repository.\n\u2014\nReply to this email directly or view it on GitHub https://github.com/codemirror/CodeMirror/issues/3854#issuecomment-190141084.\n. \n",
    "djwhitt": "Thanks!\nIn regard to parsing edn differently, afaik edn syntax is a strict subset of Clojure syntax, so the Clojure mode works as is. However, edn is stricter than Clojure in what it allows, so I could easily imagine adding an edn mode option to the Clojure parser at some point in the future.\nBy the way, the motivation behind this change (which I neglected to mention originally, but should have) was getting edn code block highlighting working in Markdown mode since it relies on findModeByName.\n. ",
    "TDaglis": "Even though HTML would be the typical use case, it would make sense to use Twig with a non-HTML base. I updated the PR accordingly to support a base option as you suggested :+1: \n. Yes. For backwards compatibility mostly and in order to make the mode more generic.\nI also just fixed the delimiters of the last commit since they did not work properly. I replaced them with regexes.\n. ",
    "alexanderdickson": "It fails for any ES6 template string in real JavaScript too. Discovered with Gerrit.\n. Sorry, you're right I should have provided some more info.\nIt definitely does seem to go funny in a file with extension js.\n\nAccording to CodeMirror.version, it's at 3.20.1. I can see it works here, so I can only assume it's because the Gerrit I am using is using such an older version of CodeMirror.\nIn that case I will upgrade the Gerrit I am using. Apologies for my laziness.\n. I tried that and it worked fine, so I put it down to the version of Gerrit I am using is using a much older version of CodeMirror. \n. ",
    "SabareeshDivakaran": "No. We didn't check this in Edge.\n. ",
    "woshilapin": "Thanks, very fast :smile:\n. ",
    "kirstywilliams": "Browser: Chrome 48.0.2564.116 (64-bit)\nOS: Mac OS X El Capitan - 10.11.2\nCodeMirror version: ^5.10.0\nUsing react-codemirror wrapper, it's possible the issue could be the way they're passing things down.\nBreakpoint state:\ncallbacks: Array[0]\n  length: 0\n  __proto__: Array[0]\ngroup: Object\n  delayedCallbacks: Array[0]\n    length: 0\n    __proto__: Array[0]\n  ops: Array[1]\n    0: Object\n      changeObjs: null\n      cm: CodeMirror\n      cursorActivityCalled: 0\n      cursorActivityHandlers: Array[1]\n        0: undefined\n        length: 1\n        __proto__: Array[0]\n      focus: textarea\n      forceUpdate: false\n      id: 17\n      ownsGroup: Object\n      scrollLeft: null\n      scrollToPos: Object\n      scrollTop: null\n      selectionChanged: true\n      startHeight: 242\n      typing: false\n      updateInput: true\n      updateMaxLine: false\n      viewChanged: false\n      __proto__: Object\n    length: 1\n    __proto__: Array[0]\n  __proto__: Object\ni: 0\nj: 0\nop: Object\n  changeObjs: null\n  cm: CodeMirror\n  cursorActivityCalled: 0\n  cursorActivityHandlers: Array[1]\n    0: undefined\n    length: 1\n    __proto__: Array[0]\n  focus: textarea\n  forceUpdate: false\n  id: 17\n  ownsGroup: Object\n  scrollLeft: null\n  scrollToPos: Object\n  scrollTop: null\n  selectionChanged: true\n  startHeight: 242\n  typing: false\n  updateInput: true\n  updateMaxLine: false\n  viewChanged: false\n  __proto__: Object\n. ",
    "parleur": "Well ... it bugs used with combination with 'd' at the end of a document. I am not sure why.\n. Works. I should notice it is not exactly the vim behavior. Vim behavior is skipping 'down'/'j' event when at last line in insert and command mode. \nBut this behavior establish coherence between edit-mode (hanled by core cm module) and the vim.js, a simpler way.\n. ",
    "MakeNowJust": "Yes. I am considering this now. if is not only suffix keyword but expression.\nExample:\n```\nbelow if is suffix\nfoo = 42 if 1 == 2\nbelow if is expression\nbar = if foo\n\u00a0 1\nelse\n\u00a0 2\nend\n```\nHow do I support it?\nAnd, I am in busy now. Please wait for some days;)\n. ",
    "whitelynx": "This isn't a new language, though... it's part of PostgreSQL's dialect of SQL. (which is theoretically supported by the existing SQL mode)\nI think the issue is that the # character should not start a comment in this SQL dialect; see https://www.postgresql.org/docs/9.5/static/sql-syntax-lexical.html#SQL-SYNTAX-COMMENTS. (probably not in most SQL dialects, though I'd have to go digging through their docs to verify that)\nCould this be reopened, since it is a bug in a currently-supported dialect?\n. ",
    "pathob": "You're right... I didn't checked the newer versions precisely enough. Sorry and thank you.\n. ",
    "zaggino": "@marijnh Can you please create MIME definition for jsx with typescript ? Didn't find one in the jsx.js file. Similar to: https://github.com/codemirror/CodeMirror/blob/1de61c6a2031b06045d0c867c7c27b5b9bbb7e3a/mode/javascript/javascript.js#L739\nThanks\n. That was fast, Thanks @marijnh !\n. Can you let me know how to run tests? I tried running it for latest master so I could fix this one myself (with tests) but it failed quite early:\n```\n$ npm test\n\ncodemirror@5.17.1 test C:\\dev\\CodeMirror\nnode ./test/run.js\n\ncore_measureEndOfLine\nassertion failed (not at right)\n1 failure\n{ Error: Command failed: C:\\dev\\CodeMirror\\node_modules\\phantomjs\\lib\\phantom\\phantomjs.exe C:\\dev\\CodeMirror\\test\\phantom_driver.js\nat ChildProcess.exithandler (child_process.js:202:12)\nat emitTwo (events.js:106:13)\nat ChildProcess.emit (events.js:191:7)\nat maybeClose (internal/child_process.js:852:16)\nat Process.ChildProcess._handle.onexit (internal/child_process.js:215:5)\n\nkilled: false,\n  code: 1,\n  signal: null,\n  cmd: 'C:\\dev\\CodeMirror\\node_modules\\phantomjs\\lib\\phantom\\phantomjs.exe C:\\dev\\CodeMirror\\test\\phantom_driver.js' }\nnpm ERR! Test failed.  See above for more details.\n```\nhttps://github.com/codemirror/CodeMirror/blob/master/CONTRIBUTING.md#contributing-code doesn't say how to run tests, for example if I wanted to run /mode/javascript/test.js.\n. @marijnh I'd try to implement the solution if you're busy, but please hint me how the test case should look like. I'm not sure about the variable vs variable-3 thing and how they differ.. Thanks @adrianheine , that makes sense. Sadly I doesn't seem to be able to use commasep(typeexpr) in the classNameAfter without breaking other stuff I'm not sure how to fix ... :-/. Probably it'd be best to define something like typeReference because not everything from typeexpr is allowed in this place, is there some hint that explains how cont, pass, pushlex and poplex things work? I seem to be very much confused in usage of these.. @marijnh found a solution to my testcase finally, please review. @marijnh I've added code to make the test-case pass. Can you please have a look at this?\nAll JavaScript and TypeScript tests are passing for me. Thanks!. Thanks!. Thanks for the quick fix!. ",
    "hanspeter1": "That's bad .... \nWho among you needs this:\n```\n    this.instance.on(\"beforeChange\", function (cm, change) {\n        console.log(change);\n    var oldContent = cm.getValue();\n    var newContent = \"\";\n\n    // Split lines\n    var lines = oldContent.split('\\n');\n\n        if (change.origin == \"+delete\") {\n\n            // Change is only inline\n            if (change.from.line == change.to.line) {\n\n                // Modify the line\n                lines[change.from.line] = lines[change.from.line].substr(0, change.from.ch) + lines[change.from.line].substr(change.to.ch + 1, lines[change.from.line].length);\n\n                // Concat new content\n                lines.map(function (line) {\n                    newContent += line + \"\\n\";\n                });\n            }\n            // Change over min. 2 lines\n            else {\n                var newLines = [];\n                for (var i = 0; i < lines.length; i++) {\n\n                    if (i < change.from.line || i > change.to.line) {\n                        newLines.push(lines[i]);\n                    }\n                    else if (i == change.from.line) {\n                        newLines.push(lines[i].substr(0, change.from.ch));\n                    }\n                    else if (i == change.to.line) {\n                        newLines.push(lines[i].substr(change.to.ch, lines[i].length));\n                    }\n                }\n\n                // Concat new content\n                newLines.map(function (line) {\n                    newContent += line + \"\\n\";\n                });\n            }\n        }\n        else if (change.origin == \"+input\") {\n\n            // Modify the line\n            lines[change.from.line] = [lines[change.from.line].slice(0, change.from.ch), change.text[0], lines[change.from.line].slice(change.to.ch)].join('');\n\n            // Concat new content\n            lines.map(function (line) {\n                newContent += line + \"\\n\";\n            });\n\n        }\n        else if (change.origin == \"paste\") {\n            // Create content to paste\n            var pasteContent = \"\";\n            change.text.map(function (line) {\n                pasteContent += line + \"\\n\"\n            });\n\n            // Modify the line\n            lines[change.from.line] = [lines[change.from.line].slice(0, change.from.ch), pasteContent, lines[change.from.line].slice(change.to.ch)].join('');\n\n            // Concat new content\n            lines.map(function (line) {\n                newContent += line + \"\\n\";\n            });\n        }\n\n        console.log(\"***************************************\");\n        console.log(oldContent);\n        console.log(\"***************************************\");\n        console.log(newContent);\n        console.log(\"***************************************\");\n});\n\n```\n. ",
    "geordieF": "Ligatures seem to work fine now, so maybe enabling again would be good. ",
    "marcelklehr": "Thanks! :)\n. ",
    "ashmind": "@Dominator008 I thought about squashing them, but wouldn't that eliminate @benpmiller and @VapidWorx from the history?\n. @Dominator008 OK I'll try that.\n. @Dominator008 Please see #3911.\n. @marijnh Thanks, that was my backup plan.. @marijnh Yes -- seems to fix it, thanks.. ",
    "ttyrueiwoqp": "Thanks a lot Marijnh, you are always so responsive ^^\n. ",
    "jsoref": "@marijnh : it's a tool I've written myself. basically it converts:\ntokens_like_this OrTokennsLiikeTihs Inot \nTokensNotLike::Whatever OR KairoFiber kairo\ninto:\nInot\nkairo (Kairo, kairo)\nLiike\nTihs\nTokenns\nAll I have to do is scan through the list determine if something is a real token or a misspelling (in this example, I'd decide that Kairo is probably a name and thus not a misspelling).\nI'm not sure I have a copy on bitbucket/github for people to use.\n. ",
    "developit": "Actually it looks like someone did a far nicer job in PR #3479. Curiously, it was reverted after merging. Perhaps now the two keywords are just missing?\n. ",
    "jld23": "I've squashed all the commits since my first one. If you need anything else please let me know.\nJared\n. I'll open a new pull request that is cleaner instead of pulling in all those changes.\n. I've pushed an index.html file\nThanks!\nJared\n. ",
    "RNKushwaha022": "No I just commented out because it didn't work. So I added code  for basic highlighting and commented out codes for sublime text features. Below code is working\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"editor\"), {\n                      lineNumbers: true,\n                      //mode: \"text/html\",\n                      matchBrackets: true\n                    });\nwhile this code is not working that's why I commented out-\nvar value = \" The bindings defined specifically in the Sublime Text mode\\nvar bindings = {\\n\";\n                   var map = CodeMirror.keyMap.sublime;\n                   for (var key in map) {\n                     var val = map[key];\n                     if (key != \"fallthrough\" && val != \"...\" && (!/find/.test(val) || /findUnder/.test(val)))\n                       value += \"  \\\"\" + key + \"\\\": \\\"\" + val + \"\\\",\\n\";\n                   }\n                   value += \"}\\n\\n// The implementation of joinLines\\n\";\n                   value += CodeMirror.commands.joinLines.toString().replace(/^function\\s*\\(/, \"function joinLines(\").replace(/\\n  /g, \"\\n\") + \"\\n\";\n                   var editor = CodeMirror(document.getElementById(\"editor\"), {\n                     value: value,\n                     lineNumbers: true,\n                     mode: \"javascript\",\n                     keyMap: \"sublime\",\n                     autoCloseBrackets: true,\n                     matchBrackets: true,\n                     showCursorWhenSelecting: true,\n                     theme: \"monokai\",\n                     tabSize: 2\n                  });\n. Hi,\nI've created a jsfiddle for this.\nhttps://jsfiddle.net/rnkushwaha022/mj8Lh59n/5/\nPlease see why its not working.\nOn Mon, Apr 4, 2016 at 3:28 PM, R.N. Kushwaha rn.kushwaha022@gmail.com\nwrote:\n\nHi,\nI've created a jsfiddle for this.\nhttps://jsfiddle.net/rnkushwaha022/mj8Lh59n/5/\nPlease see how its not working.\nOn Sat, Apr 2, 2016 at 3:03 AM, Vincent Woo notifications@github.com\nwrote:\n\nYou probably did something else wrong. Can you make a jsfiddle or\ncodepen? Literally all you have to do is include the extra sublime.js file\nand specify the keyMap option.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3930#issuecomment-204571517\n. Its not random data pasted. Its from demo of codemirror site. I have\nincluded all required libraries in external Resources section. Here is the\nscreenshot http://prntscr.com/anyb38.\n\n\nI know html/js very well and I am also a jQuery plugin developer.\nHowever my actual code is here-\nHTML   Files on Localhost   .command {font-size: 15px;}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  Editing File:\nvar/www/html/commloan/components/com_lender/lender.php \n\n<?php\n//--No direct access\ndefined('_JEXEC') or die('=;)');\nif (!defined( 'DS' )) define('DS',DIRECTORY_SEPARATOR);\n// Require the base controller\nrequire_once( JPATH_COMPONENT.DS.'controller.php' );\njimport('joomla.application.component.model');\njimport( 'joomla.application.component.view' );\njimport('joomla.application.component.helper');\nJHTML::addIncludePath(JPATH_COMPONENT_ADMINISTRATOR.DS.'helpers' );\n$jsFIleURl       = $component_apath.'assets/js/';\n$cssFIleURl      = $component_apath.'assets/css/';\n$limit             = 20;\n// Create the controller\n$classname    = 'TestController'.$controller;\n$controller   = new $classname($ControllerConfig );\n// Perform the Request task\n$controller->execute( JRequest::getVar( 'task' ) );\n// Redirect if set by the controller\n$controller->redirect();\n\n\n\n.CodeMirror {border-top: 1px solid #eee; border-bottom: 1px solid #eee;\nline-height: 1.3; height: 500px} .CodeMirror-linenumbers { padding: 0 8px; }\n\n\n  var value = \"// The bindings defined specifically in the Sublime Text\nmode\\nvar bindings = {\\n\";\n  var map = CodeMirror.keyMap.sublime;\n  for (var key in map) {\n    var val = map[key];\n    if (key != \"fallthrough\" && val != \"...\" && (!/find/.test(val) ||\n/findUnder/.test(val)))\n      value += \"  \\\"\" + key + \"\\\": \\\"\" + val + \"\\\",\\n\";\n  }\n  value += \"}\\n\\n// The implementation of joinLines\\n\";\n  value +=\nCodeMirror.commands.joinLines.toString().replace(/^function\\s*(/,\n\"function joinLines(\").replace(/\\n  /g, \"\\n\") + \"\\n\";\n  var editor = CodeMirror(document.getElementById(\"editor\"), {\n    value: value,\n    lineNumbers: true,\n    mode: \"javascript\",\n    keyMap: \"sublime\",\n    autoCloseBrackets: true,\n    matchBrackets: true,\n    showCursorWhenSelecting: true,\n    theme: \"monokai\",\n    tabSize: 2\n  });\n\n\nOn Mon, Apr 4, 2016 at 4:13 PM, Vincent Woo notifications@github.com\nwrote:\n\nYou just randomly pasted some stuff in a codepen. You need to actually\ninclude JS libraries, etc. I recommend you learn basic HTML/JS before\nattempting to use a third party library like CodeMirror.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/3930#issuecomment-205237386\n. \n",
    "xiangzhimeng": "Hi there seems an issue with the sad mode. When I type empty string or string only with space in a quote, the sas mode will treat everything after the quote as sting too. You can try this with mode demo on the codemirror website.\n. Sure, sorry I won't post in two places anymore.\n. Thank you for updating the sas mode, after the commit '', \"\", ' ', \" \" are fine but \"'\" causes problems.\n. Promoting a fix,\nElse if (ch === '\"'){\nstate.continueString = state.continueString == ch? Null : (state.continueString == \"'\" ? state.continueString : ch)\nReturn \"string\"}\nDo the same for \"'\"\n. However i noticed other problems where some words are colored has numbers\n. Thank you marijnh that was quick!\n. ",
    "dgolds": "This doesn't seem to be available yet? the npm package@5.13.4 did not include the fix, so I assume we are still waiting for @5.13.5 to be published?\n. ",
    "codyc4321": "when feeding from django views to the template, codemirror does not handle quotes. I tried feeding it a normal python string, a raw string, and a string with html elements like \"&  # 39;\", no dice. Does anyone know the standard path using django/python to feed your HTML template a correct string for codemirror, or is it just a flag within codemirror?\n. ",
    "scottschiller": "Hi @marijnh,\nThanks; from what I'm seeing, we are nulling the sole CodeMirror reference ourselves when canceling our snippet creation / editing dialog - but CodeMirror is still hanging onto part of the DOM, possibly the form reference which you mentioned. It's hard to tell in these profile snapshots, exactly what the top-level reference is that is responsible for leaking the whole tree.\n\nFrom what I can see, we are destroying the form element being leaked from within Slack when the user cancels the snippet dialog, for example, followed by nulling the reference to the codeMirror.fromTextArea() instance - but because CodeMirror has a reference to the form, it doesn't get cleaned up.\nI'd prefer not to have to call a method for clean-up either, but found that pattern did work for our use case. I probably went overboard in nulling out internal references, but it would be lovely to be able to have CodeMirror be able to clean up any dangling references when we \"cancel\" it.\nMaybe a cancel-style DOM event (if not a new method altogether) would be the sort of thing that could be useful here, in terms of folks being able to signal that they're finished with the CM instance for whatever reason.\nLet me know what you think!\n. @marijnh: Good idea; I'll see if I can get a minimal repro. Thanks!\n. ",
    "renlok": "Not sure if related to this bug but now with 5.22 on moblie line breaks will move current line to the line above. I have found this problem as well it only seems to be an issue in android chrome, my other browser functions fine and if you manually disable autocorrect on your keyboard the problem seems to go away. So my guess is that chrome is ignoring autocorrect=\"off\" for some reason\n. I think this is the same issue as #3947 seems to help by setting lineWrapping: false\n. Still broken in 5.34. ",
    "ivorobkalo": "Just add a param, so instead of\njavascript\nif (typeof define == \"function\" && define.amd) // AMD\n    return define([], mod);\nwrite something like\njavascript\nif (typeof define == \"function\" && define.amd) // AMD\n    return define(\"code-mirror\", [], mod);\n. It throws exception like the following in some cases (use it as a bower dependency and register it via js, not html)\n```\nrequire.js:165 Uncaught Error: Mismatched anonymous define() module: function () {\n ...\nwhole file content\n...\n  CodeMirror.version = \"5.13.4\";\nreturn CodeMirror;\n}\nhttp://requirejs.org/docs/errors.html#mismatch\n```\n. However does influence code behaviour only in rare cases but those error in console is annoying\n. ",
    "manideepami": "using codemirror editor, we have made all the text edits from the backend. The very best text editor i've found so far. Realworld use !!\n. ",
    "glixlur": "Sorry, clicked the wrong button.\n. ",
    "jankatins": "Thanks!\n. ",
    "matthew-hayes": "Broken by 28abd453ff7f6cf9b3ca35f74a2de6ff4e00d339 @marijnh\n. I am very sorry my issue report came across as \"whiny\".  For future\nreference, are you mostly referring to the first line, which I could\nunderstand may have come across that way?  I realize that I was a bit\nfrustrated at the moment, and was trying to express that to some extent as\na user to justify the issue report -- I imagine there are others that have\nused the feature have had similar experiences.  Prior to familiarizing\nmyself with this code I had no real experience with text editor code, so I\nwas just trying to explain my experience as a user in as much detail as\npossible.  Someone had suggested to me that this may not be possible in a\nbrowser environment so I tried to do a little research (without\nfamiliarizing myself with all the code) to ensure it was possible.  I'm not\nsure why exactly the rest of the report besides that first line would come\noff as \"rude and entitled\", as I am pleasantly asking and thanking for any\nhelp received?  I just had a feeling that this would have taken ~5 minutes\nto fix for anyone that was already familiar with the code.\nSorry, again, I did not mean to offend anyone.  Thank you so much for all\nyour help with the pull request and cleanup!\nMatt\nOn Tue, May 17, 2016 at 7:03 AM, Marijn Haverbeke notifications@github.com\nwrote:\n\nThanks. Merged as 9812173\nhttps://github.com/codemirror/CodeMirror/commit/981217306a2a1250a95d5ca8a829b5380f7a618b,\nslightly updated in 889098f\nhttps://github.com/codemirror/CodeMirror/commit/889098f1232a1223c52d5f0bbf1631b24b66e79f\nPro tip: Next time, don't complain and whine in issue reports. You didn't\npay for this software, and being rude and entitled about it does not put me\ninto a mood where I want to collaborate with you.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/4028#issuecomment-219727152\n. I can't assign myself, but I will fix this and create a pull request -- we just need to fix the initialization of the new variable in https://github.com/codemirror/CodeMirror/commit/889098f1232a1223c52d5f0bbf1631b24b66e79f\n. Pull request: https://github.com/codemirror/CodeMirror/pull/4031\n. It looks like your fix breaks my feature though.\n\nWe could do my solution and change line 1113 to:\nlastCopied.text && lastCopied.text.join(\"\\n\") == inserted\nOn Thu, May 19, 2016 at 12:37 AM, Marijn Haverbeke <notifications@github.com\n\nwrote:\nThat would just cause a different problem when line 1113 tries to run lastCopied\n&& lastCopied.text.join(\"\\n\") == inserted. I've pushed an alternative\npatch.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/4031#issuecomment-220249641\n. \n",
    "phuongtailtranminh": "All I want is just how to execute keyCode in Code Mirror. Is there anyway to send \"Backspace\" keyCode or any keyCode to Code Mirror?\n. ",
    "slonoed": "Safari 9.1.1 (11601.6.17) OSX 10.11.5 (15F34)\nEsc and Ctrl+c work fine\n. ",
    "ElDeveloper": "My apologies, I just realized this was being caused by a third party plugin, thanks @marijnh & @slonoed.\n. ",
    "jaredleechn": "\ud83d\udc4c\nWaiting for the release \ud83d\ude0a\n. very appreciate \ud83d\udc4d\nsuccess with ![image](http://abcde.png()xyz) \nbut fail with ![image](http://abcde.png)))xyz)\n\ngiving a most complex case:\n![aaaa](http://services.puml.net/g?\n  @startuml\n  start\n    skinparam shadowing false\n  if (multiprocessor?) then (yes)\n    fork\n      :Treatment 1;\n    fork again\n      :Treatment 2;\n    end fork\n  else (monoproc)\n    :Treatment 1;\n    :Treatment 2;\n  endif\n  stop\n@enduml)\n. ",
    "linlexing": "i modify the previous post,i see the textarea represented correct.\n\n.  The last part of an endeavor is the hardest to finish.\n. ",
    "themrmax": "If you use a fixed-width Chinese font like font-family: MingLiU, it seems like the chinese characters always take up 2 spaces and the roman characters always take up one space:\n\nI wonder if there is a way in the code to check if a letter is a chinese or roman letter, and in that case reduce the number of spaces to indent accordingly?\n. cool thanks for this :)\n. @marijnh interesting, this isn't how native selections work on Mac, is it how it works on Linux/Windows? Or is it just a specific design choice for Codemirror?\n. ",
    "brrd": "@marijnh Thank you for your very quick reply.\nMaybe I am missing something but in this example the two markers are separated by a character \"-\" (it could have been a longer string, the behaviour remains the same).\nDoes this mean that we can not render multiple markers on a single line if all of them are {inclusiveRight: true, inclusiveLeft: true}?\n. @marijnh thank you\n. ",
    "kireerik": "Thank you for your feedback!\nI thought this is a code editor based on HTML textarea elements. Textareas have resizable feature. So why not this library aims to support this?\nAlso why works this in Firefox, but not in other browsers. I think this is inconsistent. What is your opinion about this?\nThank you for your reply in advance!\n. ",
    "criso": "Whelp... that was awful. Sorry to have wasted your time. \nAdjusted links and things work. \nSo, I'm probably in the middle of some kind of reactjs drama. Thanks for looking into this so quickly! \n. ",
    "DrParanoia": "Hi guys! I was just wondering are there any improvements for bidi? Feels a bit messy right now :(. @danielgindi Could you please give a bit more information about disabling the bidiOrdering function? For me it seems that returning false inside only messes things up even more.. ",
    "danielgindi": "For me the following css fixes how it looks in all cases:\ncss\n  .cm-string {\n    &::after {\n      content: '\\200e';\n    }\n  }\n  .cm-number, .cm-operator {\n    &::before {\n      content: '\\200e';\n    }\n  }\nBut then the cursor/selection is acting weird. The bidi algorithm is implemented to mimic how the browser is doing it, so it's not matching.\n\nDisabling the bidiOrdering function by always returning false - combined with the CSS fix - actually fixes the issue.\nWe might want to add the \\200e (LRM markers) in code instead of in CSS in the appropriate places, as a sequence of two strings might be in one span which causes issues.\nSo temporary solution of adding that in the CSS and disabling bidi - is a great fix for me.. That's when the editor is ltr of course, I did not have any use for an rtl editor. ",
    "barelyfitz": "According to the CodeMirror documentation, under \"Events\" it shows a \"dblclick\" event, so I assume this means that event is not actually supported (reliably)?\nIn any case I have tried to work around this by implementing my own double click detection using the mousedown event. Perhaps something similar can be done within CodeMirror itself to provide a reliable dblclick event.\n// CodeMirror's dblclick event doesn't work reliably,\n// so have to provide our own double click detection\nclicks = 0;\ncm.on('mousedown', function(instance, event) {\n    clicks++;\n    if (clicks == 1) {\n        setTimeout(function(){\n            if (clicks > 1) {\n                // Trigger double click now!\n            }\n            clicks = 0;\n        }, 300);\n    }\n});\n. ",
    "YouriTc": "Ok, the problem was from angular2: it doesn't seem to load the css files. Sorry for the inconvenience, I had to manually add them in the index.html, my bad.\n. ",
    "Gvx-": "It must be added the addon \"matchtags.js\" to reproduce the defect\nThe following code to reproduce the error.\n1 / Change textarea\n2 / Click the \"reset\"\nresult: error\n```\n\n\n\ncodemirror\n\n\n\n\n\n\n\n\n\n\n\n            var cm_options = {                      // codemirror options\n                mode: 'text/html',\n                tabSize: 2,\n                tabMode: 'indent',\n                matchTags: { bothTags: true }\n            },\n            el= document.getElementById('code'),\n            reset = document.getElementById('reset'),\n            cm = CodeMirror.fromTextArea(el, cm_options);\n            cm.focus();\n            cm.doc.setValue('<!-- anything -->');   // OK\n            reset.onclick = function() {\n                cm.doc.setValue('<!-- anything -->');       // Fail\n            }\n        \n\n\n```\nindex.zip\n. I use the 5.14.2 release.\nAdding xml.js does not solve the problem.\nSee attached capture.\n\nThe problem appears at the 4th iteration\nSee the context in the attached capture\n\n. ",
    "alexwerser": "A year ago, I faced with this. I decided very simply\nreplace var gt = iter.text.indexOf(\">\", iter.ch);\nto var gt = iter.text ? iter.text.indexOf(\">\", iter.ch) : -1;\nSince it is made in the following function \"toTagStart\"\n. ",
    "dragon-dreamer": "I can reproduce the issue. You need tag matching be turned on to reproduce it. Take a look at this example, I've added just a single line editor.setValue(\"<!--\"); to default matchtags.html demo:\n```\n<!doctype html>\nCodeMirror: Tag Matcher Demo\n\n\n\n\n\n\n\n\n      .CodeMirror {border-top: 1px solid black; border-bottom: 1px solid black;}\n    \n\nCodeMirror\n\nHome\nManual\nCode\n\n\nTag Matcher\n\n\n\nTag Matcher Demo\n\n\nwindow.onload = function() {\n  editor = CodeMirror(document.getElementById(\"editor\"), {\n    value: \"<html>\\n  \" + document.documentElement.innerHTML + \"\\n</html>\",\n    mode: \"text/html\",\n    matchTags: {bothTags: true},\n    extraKeys: {\"Ctrl-J\": \"toMatchingTag\"}\n  });\n\n  editor.setValue(\"<!--\");\n};\n    \nPut the cursor on or inside a pair of tags to highlight them.\n    Press Ctrl-J to jump to the tag that matches the one under the\n    cursor.\n\n```\n. ",
    "2is10": "Here are fiddles without the fix and with the fix.\nSee the console log for running times. Here\u2019s what I see:\nOriginal    With Fix\n           ========    ========\nChrome      14.941s      1.824s\nFirefox     19.440s      1.736s\nSafari       6.101s      0.862s\n. Thanks for promptly evaluating and accepting the patch, and for the fix and improvements.\nMy company\u2019s a prelaunch startup without a revenue stream yet, but I\u2019ll see if I can get you a recurring contribution of some size. We appreciate all of your fantastic work on CodeMirror.\n. Yikes! I thought the new code was functionally equivalent. My patch touched both functions b/c the first calls the second, and both were doing repeated splicing of large arrays. I\u2019m sorry for the trouble.\n. ",
    "karuppiah7890": "Okay! \n. I just noticed that you are the author of the book \"Eloquent JavaScript\" that I have just started reading! Great to see you! :)\n. Hehe :P \n. ",
    "littledan": "Thanks!\n. ",
    "arniebradfo": "That makes sense.\nIll wait till you split the modes out so I can copy their file structure and formatting faster.\nCheers,\n-James\nPS your profile pic makes me feel sad \n. ",
    "captainbrosset": "Closing as this is indeed a Firefox 48 issue. Sorry for the noise.\nhttps://bugzilla.mozilla.org/show_bug.cgi?id=1276467\n. ",
    "axil": "Hi @marijnh,\nAfter applying this patch the ruler got shifted and now it strikes a letter instead of separating the letters:\n\nBefore the patch it was like that:\n\nI looked into the html and saw that before the patch the .CodeMirror-rulers div was inserted inside the <div style=\"position: relative; top: 0px;\"> tag while now it is inserted right before it. That's why now the ruler is shown 0.4em to the left of the expected position (0.4em is the padding of the .CodeMirror-lines div).\nI've checked with two different setups on Chrome 61.0.3163.100 (Official Build) (64-bit) (latest as of today), on Windows 7 x64.\nDo you observe the same symptoms? Is it possible to get the ruler back where it was before the patch?. Here's a patch that reverts the shift. Not sure if it still fixes the original issue of the unnecessary scrollbar though.. This is notebook==4.2.3:\n\nHere div.CodeMirror-ruler is inside '<div style=\"position:relative; outline:none\">' so its position is counted relative to the inside of .CodeMirror-lines i.e. 0.4em from its start.\nNow this is notebook==5.1.0:\n\nHere div.CoreMirror-ruler is outside of the  '<div style=\"position:relative; outline:none\">' so its position is counter relative to the start of the div.CodeMirror-lines without taking its padding into account which results in being 0.4em to the left of the proper position.. Concerning the demo page.\nThe layout structure of the http://codemirror.net/demo/rulers.html is slightly different from jupyter-notebook.\nNamely, element responsible for this padding \n\nis different.\nIn jupyter it is \n\nand in your demo it is \n\nThat's why the shift is not visible in the demo page.\n. Emm, by 'you' you mean me as a jupyter developer or me as an end user? I'm afraid I'm the second, not the first :) I was sort of reporting an issue that broke the 'ruler' plugin from working in jupyter-notebook. And I've traced back the problem to the fix of this ticket. What's your suggestion on whom should I address with bugreport?. ",
    "thurt": "I haven't looked at what DOM event CodeMirror is registering to listen to, but the first thing I found out is that \"keypress\" is deprecated. The suggestion is to use \"keydown\" and \"keyup\" instead. ref: http://stackoverflow.com/questions/21055270/javascript-keypress-event-not-raised-on-android-browser. (I can confirm that \"keypress\" event was not fired when on my smartphone.)\nHere is a little html page I made for testing \"keydown\" on pc vs mobile: https://rawgit.com/thurt/mobile-keydown/master/keydown.html\nI made it output all the properties that are relevant to determining which key is pressed in a \"keydown\" event. I added an input element because I can only get the smartphone keyboard to pop up if I am selecting an input element.\nOn the smartphone, I do get events fired for \"keydown\", but all alphabet keys appear the same\n{\n  which: 229,\n  keyCode: 229,\n  code:  ,\n  key: undefined\n}\nHowever, the backspace and enter keys are different\n```\nbackspace is\n{\n  which: 8,\n  keyCode: 8,\n  code:  ,\n  key: undefined\n}\nenter is \n{\n  which: 13,\n  keyCode: 13,\n  code:  ,\n  key: undefined\n}\n```\nI am using Moto G, Android v5.1\n. Using chrome v50 on the moto g\n. ",
    "40thieves": "Hmm, yes I can how that would be the better approach.\nHowever I've just tested this out and there's a problem when calling the command for the first time. So for example: \nfind command -> type \"Hello\" -> findNext command\nHere, the search state has not been set to \"Hello\", and so the search is not run correctly. I suppose it could check if the search state is set and if not, trigger a find command.\n. I just realised I could call the callback instead of the find command - as this handles checking the search state\n. Updated to use the callback instead of custom logic. This doesn't necessarily solve the original problem, but it does clean up the original implementation.\n. Updated again. Now findNext and findPrev commands will be executed (after setting the search state), whereas find and findPersistent will act as if enter was pressed.\nI think this is a good heuristic?\n. Great! Thanks for the help in working out the implementation\n. Yep, you're totally right. Thanks for the feedback \ud83d\ude04 . I've updated to remove the callback and perform the immediate search in doSearch instead.\n. Thanks \ud83d\udc4d . Do you have a timeline for a release?\n. Awesome, thanks\n. Great, thanks!\n. We are also experiencing the Uncaught TypeError: Cannot read property 'nodeType' of null issue. Our error reporting leads me to believe that it has existed since at least 5.11.\nOur error reporting does not have either of the other issues so I believe they might be regressions in 5.20 (we have been running 5.19 for about a week now).\nI've done a little bit of digging and I believe the nodeType error might be a race condition. When deleting the last letter on a line, content is polled here. When determining the fromNode here, it attempts to find the nextSibling of the previous line. However, by this time the DOM has been updated and this node does not exist. Therefore when node.nodeType is checked in domTextBetween here it throws. It is perhaps noteworthy that display.view does contain the deleted node, although it is detached from the DOM.\nI'm afraid I'm not familiar enough with the code to figure out where the DOM update might be happening but hopefully this will help someone who is. (I should say that the module splitting done in 5.20 helped tremendously when figuring this much out, so thanks!)\n. Thanks @marijnh. I don't think I have time to have a look today, but hopefully tomorrow\n. Those patches do seem to prevent the error and make it quite a lot smoother to use.\nI am getting an CM invalid character inserted when I delete a line though:\n\nI tested on my Nexus 5 with both the Google Keyboard (UK) and Swiftkey. I'm afraid I don't have much more data until we push this out to production to track in error reporting (which we likely won't do until a release).\nHope that helps. Thanks!\n. Testing an upgrade 5.21 today and confirmed that the error is fixed, and it feels a little smoother to use. However I'm seeing a couple of bugs that I can replicate on the examples.\nEmpty newlines are removed when new words are typed:\nGIF\nTyping a word then hitting return will delete the last word:\nGIF\n(Although I'm not sure if that's exactly the steps to replicate. There's definitely some weirdness around hitting return)\nI think we're going to ship 5.21 soon, as it does seem to be a bit more stable. Hopefully that will get us a bit more data on devices affected.. Sorry, that wasn't a good PR description was it.\nA keyboard trap is where you are unable to \"tab out\" of the input, i.e. pressing the Tab key to move focus to another input. As I understand it, the nocursor option allows this by preventing focus on the CM textarea. As far as I can tell, this is broken on master because the hidden textarea still receives focus. Here's a small repro. Great! Thanks a lot. Right ok. Your suggestion makes sense I'll adjust the patch. Great. Thanks!. ",
    "nanchen": "@anton-aleksandrov   I had the same problem, I created another npm package, https://www.npmjs.com/package/diff-match-patch-js-browser-and-nodejs  you can use it.. ",
    "pynej": "Him, I had the brace-fold and fold-gutter.  Maybe the documentation(demo/folding.html) just needs a sample added for css.\n. Him, I had the brace-fold and fold-gutter.  Maybe the documentation(demo/folding.html) just needs a sample added for css.\n. ",
    "Leandros": "My investigations lead me to the emacs.js keybindings, which define the keybind ALT+F and ALT+B for moving a word forward and backwards. I'm assuming disabling the former of these binds will fix the issue.\n. ",
    "nlight-jdev": "@marijnh, thanks for the patch, it seems to work better as it doesn't add prefix spaces anymore.\nOne other issue is that it doesn't preserve spaces and enters. Could you take a look at that as well?\nFor example:\n123\n456\nwill become:\n123 456 - when wrap is applied, it removes the enters and brings everything on same line\nAlso the spaces are not preserved. I'm hoping for a behavior closer to native text areas with hard wrap enabled.\nThank you!\n. yes, even in hard wrapping demo, undo will incorrectly unwrap the line(and join with previous line). \nThen the wrap timer kicks in and it's rewrapped back to next line, getting back to the state before undoing.\nBut ideally is to support both hard and soft wrapping with wrap at fixed number of characters.. Or is there any quick workaround for reserving that space? via some css or similar?. Thanks a lot!\nAnd regarding the update, can this be implemented in a plugin instead?. ",
    "Jolg42": "Thanks for your response & link!\n. ",
    "dapatil": "@marijnh , \nI should have been clearer in my comment.\nLook at: https://github.com/codemirror/CodeMirror/blob/master/keymap/vim.js#L4771\nYou'll see that the keymap defines a separate \"vim-insert\" keymap and explicitly defines what \"Ctrl-N\", \"Ctrl-P\" and \"enter\" do. I believe the assumption there was that keys defined explicitly there would be handled without going through the \"call\" handler. This change makes vim keymap work in vim's insert and replace modes. \n. ",
    "jeffjenkins": "Oops, that was a typo. The non-mac controls were supposed to stay the same as before. I'll make another PR with a fix\n. I'll see what I can find. Worst case I might be able to bring VMs up to check manually since the changes aren't that complicated.\n. windows: https://gist.github.com/jeffjenkins/092d5df2baf5c7e384bca23061b6a96f\nctrl+alt+{up,down}\nlinux: https://gist.github.com/jeffjenkins/5c53c90c897d3796f9a150abc42c01a2\nalt+shift+{up,down}\nosx: https://gist.github.com/jeffjenkins/1900171a7801432d6a91903f5497abab\nctrl+shift+{up,down}\n\nI had (naively, it seems) assumed that linux and windows would be the same.  I can make a fix for this, but I need to know two things:\n- What's the most official way to check for linux vs mac vs windows?\n- should I amend the existing commit and overwrite my branch so this is a single commit or add another commit with the next changes? This is the first time I've made changes to a pull request, so I'm not sure what the preferred flow is\n. Great, thanks! I'll get this together and update later in the week\n. ",
    "edg2s": "Even with height:auto you can work out which parts of the DOM are visible using viewport dimensions and scroll offset. Where in the code is this computed for fixed height editors?. > If you make it resize with its content, the whole document will end up visible, and that is going to be a lot more expensive. That's not something that can be helped.\nThis is the part I was replying to - for very long documents only the part of the document in the viewport needs to be rendered. We are integrating CodeMirror highlighting on Wikipedia pages (https://phabricator.wikimedia.org/T161054). Our new editor doesn't use a fixed height text input, but an autosized one with a floating toolbar. It should be fairly easy to modify the code to use the viewport height/scroll offsets for computing which part is visible, instead of the CodeMirror container? We'd be glad to help if you have any pointers.. > To ensure that things are drawn before they are scrolled into view\nCould it work if you allowed users to drop that requirement?. ",
    "redlolgeerf": "i've encountered the same problem with very slow updateHeightsInViewport. are there any workarounds?. I've tried to set fixed width and height on the parent of the div with class \"CodeMirror\", but nothing changed. \"updateHeightsInViewport\" and \"displayWidth\" are still very slow.. I have not set vierportMargin.. ",
    "HoverBaum": "Ahh looks like I didn't fully think this through, you are absolutely right.\n. After some more consideration I would adjust the expected render to:\nhtml\n<span style=\"padding-right: 0.1px;\">\n    <span class=\"cm-formatting cm-formatting-image cm-image cm-image-marker\">!</span>\n    <span class=\"cm-formatting cm-formatting-image cm-image cm-image-alt-text\">[</span>\n    <span class=\"cm-image cm-image-alt-text\">alt text</span>\n    <span class=\"cm-formatting cm-formatting-image cm-image cm-image-alt-text\">]</span>\n    <span class=\"cm-formatting cm-formatting-link-string cm-string cm-url\">(</span>\n    <span class=\"cm-string cm-url\">http://link.to/image.jpg</span>\n    <span class=\"cm-formatting cm-formatting-link-string cm-string cm-url\">)</span>\n</span>\nThis just adds even more possibilities for styling and also differentiates images from links.\n. @marijnh ahh yes I was thinking about the styling issues but was unsure about the best approach.\nAfter looking at it for a bit. Wouldn't it make more sense to use the link tag? As images are so very similar to links in markdown. I think people would rather tend to style them like links then tags and could think of images as a special kind of link.\n. Added link and adopted the tests accordingly.\n. ",
    "nickbrowne": "Great! I can confirm this fixes the issue. Thanks very much for taking care of it so quickly.\n. ",
    "siamak": "Thanks ;) @marijnh \n. @marijnh I fixed it. https://github.com/codemirror/CodeMirror/pull/4243/commits/99dd6f1f6c7b0e1678f5634b101747e72548087d\n. ",
    "MickMonaghan": "Excellent @marijnh - thank you. Looks good to me also.\n. ",
    "psybuzz": "Wow, thank you @marijnh  for the fast response! :)\n. That makes sense.  Thank you for the quick fix!. ",
    "hungys": "Same issue on Chinese IME (Bopomofo)\nI initially reported this issue on Ghost's repo (https://github.com/TryGhost/Ghost/issues/9012) but it seemed to be CodeMirror's issue.. ",
    "eitty": "and it happens mostly on linux, but little when windows 7\n. it seems work fine by refresh while scroll. Is there any better  proposal?\neditor.on('scroll', function() {\n        editor.refresh();\n    });\n. Okay, let me prepare and provide lately. Maybe next Monday.\nThanks for attention.\n. Sorry for late response. \nIt is kind of cannot reproduce this in minimal demo. But I think it maybe due to our using method.\nWe didn't have content while init codemirror for textarea, but use setValue while different grid row being clicked.\nAnd now, it can work fine by refresh while scroll, so I think can close it.\n. ",
    "RobertDiebels": "@marijnh Sorry for the late reply. It appears I missed your comment. I've tested this for all modes, (\"page\"/\"window\", \"div\", \"local\"/undefined) and the coords are consistently off.\nI did some debugging and it appears that the browsers I've tested already correct the coords from the event by subtracting the scrollOffset. The code for coordsChar also does this so the offSet is subtracted twice. This causes codeMirror to conclude that I'm a few lines above where I'm clicking.\nBrowsers I've tested: Chrome (51.0.2704.103 m), Edge (25.10586.0.0, EdgeHTML 13.10586), FireFox (47.0.1), IE11 (11.212.10586.0).\nThe hotfix I implemented was adding the offset Codemirror uses to the \"top:\" property of the object passed to coordsChar. Like so:\nthis.codeMirror.getWrapperElement().onmousedown = function ( e ) {\n            var coords = {\n                left: e.clientX,\n                top:  e.clientY +  window.pageYOffset || (document.documentElement || document.body).scrollTop\n            };\n            var lineCh = self.codeMirror.coordsChar(coords);\n};\nIf I need to make a jsfiddle or anything please tell me. But I haven't found a website where I can provide an example bit of code which allows me to use  the whole page and make sure I have enough height to get a scrollbar.\n. @marijnh I see what you mean now :). I though \"window\" was explicitly handled but it's just a fall through. Hence the mistake.\n. ",
    "writemonkey": "This will disable editor's subpixel anti aliasing. \n. ",
    "thomcom": "Thanks! You showed me something really important. :). ",
    "tonytlwu": "I've created a PR so that CodeMirror.fromTextArea doesn't override user's options.finishInit configuration.. I'm using it to ensure I have a reliable callback for when the CodeMirror UI has finished initializing. I have several instances on a page and I'm using Promises to ensure they're all initialized before running further operations.. Like this?\n```js\nfunction initializeCodeMirror(callback) {\n  var instance = CodeMirror.fromTextArea(textarea, options);\n  if (typeof callback === 'function') {\n    callback(instance);\n  }\n}\ninitializeCodeMirror(function(){\n  console.log('CodeMirror UI initialized!');\n});\n```. Are you suggesting A or B from below? A, I assume?\nA\n```js\nfunction initializeCodeMirror(callback) {\n  var instance = CodeMirror.fromTextArea(textarea, options);\n  console.log('CodeMirror UI initialized!');\n}\ninitializeCodeMirror();\n```\nB\n```js\nfunction initializeCodeMirror(callback) {\n  var instance = CodeMirror.fromTextArea(textarea, {\n    finishInit: function () {\n      console.log('CodeMirror UI initialized!');\n    }\n  });\n}\ninitializeCodeMirror();\n```\n. I wanted to understand what you had in mind and compare my understanding of it.\nCase A calls the function too early because the UI has not been fully initialized yet. The instance object is created, but the UI initialization hasn't completed.\noptions.finishInit helps in calling back at the correct time, after the UI initialization is complete. However,  in Case B above, the callback doesn't work because CodeMirror.fromTextArea overrides the configured callback.. Thanks for clarifying. This let me look at my code in a different perspective and I've been able to find the culprit to a bug I was experience. Indeed it's not related to CodeMirror.. ",
    "Garito": "Ok, sure, what do you recommend to do?\n. How can I clean up it?\n. Hi!\nI've changed the bootstrap event to launch the toTextArea and I noticed that it works as expected by changing the editor to the textarea\nBut the duplication persist\nis there any place where the object is stored or something that needs to be removed?\nI've tryed this code now:\njavascript\n$(\".modal-body\").html('<div class=\"text-center\"><i class=\"fa fa-spinner fa-pulse fa-3x fa-fw\"></i></div>').load(url, function(e) {\n    $(\"#modal\").modal().on(\"shown.bs.modal\", function() {\n      $(\"[data-editor]\").each(function() {\n        var $this = $(this);\n        this.cmObj = CodeMirror.fromTextArea($this.find(\"textarea\").get(0), {lineNumbers: true, styleActiveLine: true, theme: $this.data(\"editor_theme\")});\n      });\n    }).on(\"hide.bs.modal\", function() {\n      $(\".modal-dialog\").removeClass(\"modal-full\");\n      $(\"[data-editor]\").each(function() {\n        this.cmObj.toTextArea();\n        delete this.cmObj;\n      });\n    });\n  });\nThe issue persist but I can see how the editor is replaced again by the textarea\nWhat am I losing?\nThanks!\n. ",
    "micahstubbs": "\ud83d\udcaf this.  would be super useful.\n. ",
    "viebel": "I would expect the python mode to conserve the original identation.\n. Do you mean that there is no solution?\n. Thanks.\nBut my problem is with the less trivial css than text-align.\nAs I mentioned above:\n1. When trying to navigate the code with the keyboard arrows, it feels very weird\n2. The cursor is not visible when editing the code\nWhat css should I override to fix that?\n. Per @marijnh suggestion, I've tried to put my editor instance inside a web component but still some CSS is bleeding into the editor: \n\nCodeMirror with reveal: you cannot move with arrows until the end of the line and you cannot insert a space.\nCodeMirror without reveal: it works fine.\n\nI know that it is probably an issue with reveal so I am reporting also in reveal repo.\nMaybe you guys at CodeMirror can think of a workaround?. @RopoMen Here is a version with a code mirror editor on slide 1 and a textarea on slide 2.\nAs you can see, inside the textarea, arrows and space work fine.. Thanks a lot @RopoMen \nIt looks much better now.\nBut I'm still having weird issues. For instance, if you put the cursor at the beginning of (map inc [1 2 3]) and press the right arrow 8 times, the cursor will be at the beginning of the c - see screnshot below. And if you press space, a backspace will be added after the c.\n\nIn general, if you play a bit with arrows and spaces, you will feel that something is really not working well.\nDo you know why it happens and how coud I solve it?\n. I have handled the keyboard binding issue by adding contenteditable=\"true\". See https://github.com/viebel/klipse/commit/67b9abc2284aafb70057274c3cdc68e33c893968. @marijnh maybe you can help with this part of the problem that I mentioned above: https://github.com/codemirror/CodeMirror/issues/4189#issuecomment-271863685. @RopoMen so why doesn't it work properly yet ?. I mean why do we still have this issue https://github.com/codemirror/CodeMirror/issues/4189#issuecomment-271863685 \nI'm so frustrated: we are so close but still not there!. Thanks for the tip @marijnh.\nI tried to delay the whole computation using setTimeout but it doesn't work inside CodeMirror.\nAlthough it works with a regular textarea.\nHere is  a jsfiddle for the repro: https://jsfiddle.net/viebel/9f1hojuq/12/\nAny help will be much appreciated.\n. I know. But in some cases, page scroll is not blocked. Take a look at the\njsfiddle with the textarea.\nOn Mon, Oct 10, 2016, 10:56 Marijn Haverbeke notifications@github.com\nwrote:\n\nAn infinite loop is always going to break your page. That's how JavaScript\nworks -- non-web-worker scripts are run on a single thread and block the\npage.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/4292#issuecomment-252554972,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AA6VPskVI3WI3UgxbCs-ewU6OVJcdKw4ks5qye-_gaJpZM4KR7iR\n.\n. My use case is for a blog post with code snippets so the experience would\nnot so terrible if for 10 seconds the browser is stuck - providing that the\nscroll works.\n\nAnyway, why does CodeMirror need a scroll listener?\nIs there a hack to disable this scroll listener?\nOn Mon, 10 Oct 2016 at 11:03 Marijn Haverbeke notifications@github.com\nwrote:\n\nI guess if you don't register an active scroll listener you can still\nscroll a stuck page. (I'm not sure why, since scroll events only fire after\nthe actual scrolling happens anyway). But CodeMirror needs a scroll\nlistener, so that's just not going to work with CodeMirror. (And your user\nexperience will still be terrible if your script is working for long\nperiods of time, even if scrolling continues to work.)\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/4292#issuecomment-252556023,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AA6VPsQfJgPmQZ1OEabt_zV8msY4-lGoks5qyfFogaJpZM4KR7iR\n.\n. \n",
    "orionlee": "@marijnh The lastest csslint (v1.0.3) has the issue resolved.\nhttps://github.com/CSSLint/csslint/pull/672\n. I have a patch in my repository by using Object.getOwnPropertyNames() , supported by most modern browsers. I could create a pull request with the patch. Let me know.\n. Thanks for the reply. I do agree with your sentiment that the current search addon is a bit too difficult to maintain.  For now I will keep my patch private. \nIf I can refactor the addon and supply good unit tests, thereby reducing maintenance budern, would you consider accept it?\n. @marijnh  I end up doing a fork that provides hooks to support history. The fork emits a few events so that I can implement history. \n- forked search.js\n- history/autocomplete that uses the events\nDiffs with base (temporary link for a month):\nhttps://www.diffchecker.com/t81p8uNw\nIt might still be help to incorporate the changes back to official. While it creates some complexity, the events it produces could be useful to serve as an public API for the addon that can be tested against when further refactoring is done.\n. @marijnh  Ah, in that case:\n- in the example above, when lint only has lint-addon option (onUpdateLinting), but no options propterty, the current lint.js behavior is to pass the lint-addon option object to javascript-hint helper, and ultimately to jshint.\nIn example code:\nlint: { onUpdateLinting:  function onUpdateLinting(annotationsNotSorted, annotations, cm) {\n      console.log(annotationsNotSorted);\n    } }\nIn lint.js:137\nvar passOptions = options.options || options; // Support deprecated passing of `options` property in options\n-  The comment in lint.js:137  is outdated. It states passing of options property is deprecated. From what you stated, it is the other wary around.\n. @marijnh If I keep the new mode separate, please advise on how to use the new mode along with auto load mode? \nSpecifically, autoload mode requires all modes are stored in a single directory, e.g, CodeMirror.modeURL = \"node_modules/codemirror/mode/%N/%N.js\"; . If the new mode is kept in a separate npm, it will be in a directory different from core codemirror.\nThanks.\n. How about changing auto loading addon slightly to allow user-defined modeURL resolution? It'd be something like this in CodeMirror.requireMode(), of loadmode.js\n// accept optional user-defined function CodeMirror.resolveModeURL(modeName)\n  var file = CodeMirror.resolveModeURL ? CodeMirror.resolveModeURL(mode) :  CodeMirror.modeURL.replace(/%N/g, mode);\nLet me know what you think. Thanks.\n. @marijnh  Thanks - along with 'cursorActivity' event the issue is resolved. \n. ",
    "micwallace": "Observations:\n- It only happens when using contenteditable inputStyle.\n- The issue stems from the \"compositionend\" event listener. The space gets inserted by an input event but then removed when the composition end event fires.\nI have been able to prevent this issue by using the below code, which checks for the presence of space or return character after the current cursor position. If the check fails then a space is appended to the end of the composition data.\nhttps://github.com/codemirror/CodeMirror/blob/master/lib/codemirror.js#L1600\n```\nvar cursorPos = cm.getCursor();\nvar lastChar = cm.getDoc().getRange({line: cursorPos.line, ch: cursorPos.ch-1}, cursorPos);\nvar addSpace = (cursorPos.ch==0 || lastChar==\" \") && (e.data.length>1 && e.data.charAt(e.data.length-1)!=\" \");\nif (e.data != ours.startData && !/\\u200b/.test(e.data))\n      ours.data = e.data + (addSpace?\" \":\"\");\n```\nI'm not sure if this is the best way to fix, but the events in question contain no unique data and therefore cannot be filtered without disabling auto-suggest functionality. Let me know if you find any other solutions.\nUPDATE: Unfortunately the solution above causes more issues than it fixes.\n. I was unable to come up with a working solution.......very frustrating.\nOnly workaround at the moment is to force textarea inputStyle.\n. ",
    "dehypnosis": "still no progress?. ",
    "TheNeuralBit": "I admit my use case is a bit specialized - I'm not actually using codemirror as a code editor.\nThis is just a feature I needed for my application, and I couldn't figure out a way to do it without touching the codemirror internals. I figured I might as well contribute back the result.\nBut if I'm the only person interested in this feature I don'd mind working off of my own fork.\n. ",
    "KnightYoshi": "Adding a max width or overflow to the .column also seems to fix the scrolling issue.\n. That's interesting, I hadn't checked Chrome. View it in Firefox 47+ (not sure about earlier versions or other browsers). I removed a bunch of CSS - I just grabbed all of the grid CSS when I initially created it.\nRemoving the flexbox properties it behaves as expected in Firefox; the editor scrolls, not the page. Which isn't really an option for me. So uncommenting either one of the commented out blocks also fixes it so that the editor scrolls and not the page.\n. ",
    "kurtfunai": "Having this same issue when using with Bulma.. ",
    "ilyazolotarov": "Yes, it's all right with the new mode/javascript.js from master brunch. Thank you.\n. ",
    "ekohilas": "Oh I see\nOh well...\n. ",
    "ryancui-": "Also have a wrong syntax highlight when typing this:\n```\nTitle\ntitle 1\n\n\naaa\n\n\ntitle 2\n```\nusing list in quote cause a mistake. Thanks for fixing this.. ",
    "alinnert": "One example would be the following CSS:\n``` css\n.cm-header-1 {\n    margin-left: -2ch;\n}\n.cm-header-2 {\n    margin-left: -3ch;\n}\n/ etc. /\n```\nI'm not yet sure if this is the best solution but at least it works.\nThe unit ch means \"character\". It's the width of the 0 (zero) character.\nIt's very rarely used but very useful in this case.\n. ",
    "vandenoever": "Here is a workaround:\njson\nhintOptions: {schemaInfo: schemaInfo, closeCharacters: /\\ \\/>/}\nThe value for closeCharacters in xml-hint.js could be set to this value as a default.\n. ",
    "Zalewa": "I confirm. For my case I have settled for displaying max 100 000 lines - it should be a safe limit, considering line wrapping and user-customizable font sizes.\nWell, it's good to know the reason of the problem, at least.\n. Thanks!\n. ",
    "jgstratton": "@marijnh could you point me in the direction of where you put the code: mode: {name: \"xml\", autoSelfClosers: {\"cfset\": true}} to make this work in brackets? I can't seem to find any documentation on it anywhere.\n. ",
    "emresaracoglu": "Can you help me? \nHow do I need to change in code?\n. ",
    "mcmartins": "Did I forget to add something for the lint mode to pass the tests?\n. Cheers, will be doing it. \nAre you keep track of these new mode modules? Or just following that naming convention will allow someone to find new modes easily? Or you keep a list updated in this repo?\nThanks!\n. I guess that would work. I'll let you know when everything is sorted out for this mode.\nCheers.\n. ",
    "myyc": "My bad. This does happen in the website demo but not in another Jupyter notebook I checked. Feel free to close it if you think it's not an issue, or keep in case you want a reference to possible enhancements (e.g. highlighting operators in things like f\"{a+2}\")\n. ",
    "joubertredrat": "@marijnh I tested here and really ctrl + [ remove tabulation one by one and shift + tab auto-indents the selection.\nBut this is very strange, because Github, GitLab, Netbeans, Atom, Sublime Text, Brackets, PHPStorm, Visual Studio Code and others, all use shift + tab for remove tabulation one by one, not for auto-indents the selection.\nThen I have a question, CodeMirror supports customize what keys will dispatch actions or override actions commands?\n. @marijnh worked fine here, thanks.\n. ",
    "joshfriend": "That was quick! Now I just have to wait for Atlassian to update CodeMirror in Bitbucket Server \ud83d\ude1e \n. Hmm, that's too bad, I don't have control over the render mode on Bitbucket Server.. ",
    "rcgoncalves": "I just selected the library, a dozen of modes, and three add-ons.  The page would take about 60s processing, after which it would return a \"502 Bad Gateway\" error.\nI just tried it again, and it now returns a \"504 Gateway Time-out\" instead.  Considering the 60s it was taking to process before, I guess it was also a timeout problem.\n. ",
    "meglio": "So, it seems as if the compression helper now gone. What should we do if we don't have any build steps?. ",
    "DanielRosenwasser": "The parser needs to understand class field definitions (and that TypeScript may have an accessibility modifier preceding them). I might be willing to help out with this.\n. @marijnh @zaggino I think I got it working, though I'm not sure about how to write tests.\n\n. Nice - we have a similar approach  for our testing harness as well, but I mostly wasn't sure what MT and other functions were. Thanks for setting things up for me.\n. Yup, it's allowed and basically like that.\n. Whoops, I now see the logic you have below for that. But doesn't static have the same issue as well?\n. ",
    "tan31989": "You would have to override the css for CodeMirror, because reveal css will change/modify the properties of div's and so on.\nWhat you would have to alter is as follows:\ncss\n.reveal .CodeMirror-lines {\n    text-align: left !important;\n    ......\n    ......\n}\nAlter the CSS for getting the result, because, your CodeMirror is inside a reveal div and that will obviously add it's own css, like:\ncss\n.reveal .slides {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    margin: auto;\n    overflow: visible;\n    z-index: 1;\n    text-align: center;  /* Culprit -- changing the alignment */\n    -webkit-perspective: 600px;\n    perspective: 600px;\n    -webkit-perspective-origin: 50% 40%;\n    perspective-origin: 50% 40%;\n}\n. ",
    "RopoMen": "Moving with arrows or using space is related in to Reveal.js keyboard bindings.\nhttps://github.com/hakimel/reveal.js/#keyboard-bindings\nhttps://github.com/hakimel/reveal.js/blob/master/js/reveal.js#L4201\nYou need to be able to stop event propagation from CodeMirror editor in to Reveal.js handler. . It's because\nhttps://github.com/hakimel/reveal.js/blob/master/js/reveal.js#L4144\n// Check if there's a focused element that could be using\n// the keyboard\nvar activeElementIsCE = document.activeElement && document.activeElement.contentEditable !== 'inherit';\nvar activeElementIsInput = document.activeElement && document.activeElement.tagName && /input|textarea/i.test( document.activeElement.tagName );\nvar activeElementIsNotes = document.activeElement && document.activeElement.className && /speaker-notes/i.test( document.activeElement.className);\nIf you inspect DOM in first slide you can see that CodeMirror editor is not directly using input/textarea when content is edited. (if I'm correct). I think that reveal.js should have attribute 'reveal-keyboard-off' and code should also check whether the element has that attribute. If it has, keyboard event handler should not do anything on those events.. I checked and couldn't see any extra characters in DOM after 'c'. That kind of bug sounds like more CodeMirror issue. (Using Chrome)\nps. How did you handled those keyboard bindings? Quickly looked in to your example and couldn't find \"obvious\" solution :). I did see that on Reveal rules but I thought that it would not work because contenteditable would make the element editable, like <div> or <p> but it actually does not work like that with custom elements :) nice.\nI have looked in to web components / custom html elements because to major benefit is the style isolation.. @viebel \nthis works fine.\n<klipse-snippet id=\"code\" contenteditable=\"true\"></klipse-snippet>\nWhat I meant was that if you add contenteditable for example:\n<p contenteditable=\"true\">Edit me</p>\nBrowser is making <p> tag editable and browser is not making <klipse-snippet> editable in a same way. What I thought initially was that if you add contenteditable for the custom element, browser would make it editable in a same way as it was <p> -tag.. ",
    "timothypratley": "@viebel I think I found something!\nI get the problem you describe when I have the chrome inspector open.\nBut when I close the inspector/console... it works perfectly.\nI think that CodeMirror calculates cursor/selection related things in a way that is affected by the changed size of the HTML area when the inspector is open????. Actually, it's a little more complicated than what I described above.\nThe cursor behavior is affected by the dimensions of the page.\nHaving the inspector open or closed affects the dimensions of the page... but any kind of resizing does as well. If the page is too narrow, the selection area is smaller than the real text. If the page is too wide, you cannot click on the text. I'll dig a bit deeper.. @viebel O.K. I got it to work...\nI set these in the .adoc file\n:revealjs_minScale: 1.0\n:revealjs_maxScale: 1.0\nThis prevents the scaling when the screen is narrow or wide. The scaling does not play well with codemirror.. ",
    "blink1073": "Code (using asynchronous-style WebPack import):\nrequire([`codemirror/mode/${mode}/${mode}`], () => {\nError:\nModuleNotFoundError: Module not found: Error: Cannot resolve 'file' or 'directory' ../jade/jade in /Users/ssilvester/workspace/jupyter/lab/jupyterlab/node_modules/codemirror/mode/vue\n. Confirmed that replacing all occurrences of jade with pug in vue.js fixes the issue.\n. Thank you for the quick fix, and for CodeMirror in general!\n. Thanks @jasongrout and @marijnh!  :heart:. ",
    "jaypeedevlin": "@marijnh I have used browserstack's ipad emulator as a stand-in for these sort of things.\nInterestingly when I load https://codemirror.net/demo/activeline.html in their iPad Pro emulator I can get all arrow keys to work except up, except where the cursor is on the left hand end of the line, where the left arrow key would move the up to the line above anyway.\n. ",
    "Vercantez": "The up arrow seems to work for me, however the back arrow doesn't go to the previous line when you are at the beginning of the next line.. ",
    "twisted1919": "Seems that any code that also has html in it then some php mixed inside, i.e:\n``` php\n<?php\nuse \\some\\namespaced\\Library;\n?>\n\n= Library::staticMethodCall(); ?\n\n```\n. Can you try this code please:\n``` php\n<?php\nuse yii\\helpers\\Html;\nuse yii\\widgets\\ActiveForm;\n/ @var $this yii\\web\\View /\n/ @var $model app\\models\\User /\n/ @var $form yii\\widgets\\ActiveForm /\n?>\n\nphp $form = ActiveForm::begin(); ?\n= $form-field($model, 'id')->textInput() ?>\n\n    = $form-field($model, 'first_name')->textInput(['maxlength' => true]) ?>\n\n    = $form-field($model, 'last_name')->textInput(['maxlength' => true]) ?>\n\n    = $form-field($model, 'email')->textInput(['maxlength' => true]) ?>\n\n    = $form-field($model, 'password')->passwordInput(['maxlength' => true]) ?>\n\n    = $form-field($model, 'auth_key')->textInput(['maxlength' => true]) ?>\n\n    = $form-field($model, 'access_token')->textInput(['maxlength' => true]) ?>\n\n    = $form-field($model, 'status')->textInput(['maxlength' => true]) ?>\n\n    = $form-field($model, 'created_at')->textInput() ?>\n\n    = $form-field($model, 'updated_at')->textInput() ?>\n\n    \n= Html::submitButton($model-isNewRecord ? Yii::t('app', 'Create') : Yii::t('app', 'Update'), ['class' => $model->isNewRecord ? 'btn btn-success' : 'btn btn-primary']) ?>\n    \nphp ActiveForm::end(); ?\n\n```\nAs this causes the issues for me instantly. \nI am using latest version, just updated today before pasting you this.\nHope it helps.\nThanks.\n. Yeah, basically what i am doing is i have a file manager, and when i click on any file, i make an ajax request to the server to get the file contents and detect the file mode for codemirror. \nWhen the ajax call returns, i open a modal popup that has a textarea in it where codemirror is instantiated and i set the right mode and contents for codemirror.\nThis works just fine for any other file type and even for php if i disable the php mode and use htmlmixed instead.\n. Sure, there you go: http://mygd.im/cmphp/\n. Well, i don't think i can do more than this, the issue is there, i'll be removing php mode and will be using html mixed instead. I also attached the above code in an archive for you to look at if you need to.\ncmphp.zip\nSorry for not being able to do more.\nThank you.\n. ",
    "caphodel": "Adding clike mode will remove this error, i don't know why but it's work.. ",
    "LaKing": "I had the same problem. PHP code crashes codemirror, unless the clike mode is included.. Actually a newline after <?php crashed it, giving two errors, this was the second one.\nThe first time I saw this error was while pasting the following code:\n<?php\necho \"<h2>PHP is Fun!</h2>\";\necho \"Hello world!<br>\";\necho \"I'm about to learn PHP!<br>\";\necho \"This \", \"string \", \"was \", \"made \", \"with multiple parameters.\";\n?>\nSo the code triggering the crash itself seems to be irrelevant\nI think we should take a look at included libs. (ejs)\n```html\n<!doctype html>\n\n    <%- file %>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n optional codemirror addons \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n other libs \n\n\n\n\n\n\n\n\n\n\n\n    // get url query parameters\n    function getParameterByName(name, url) {\n        if (!url) url = window.location.href;\n        name = name.replace(/[[]]/g, \"\\$&amp;\");\n        var regex = new RegExp(\"[?&amp;]\" + name + \"(=([^&amp;#]*)|&amp;|#|$)\"),\n            results = regex.exec(url);\n        if (!results) return null;\n        if (!results[2]) return '';\n        return decodeURIComponent(results[2].replace(/+/g, \" \"));\n    }</p>\n<pre><code>var line = getParameterByName('line');\nvar char = getParameterByName('char');\n\nvar socket = io();\nvar pad = '?';\n\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n    lineNumbers: true,\n    lineWrapping: true,\n    theme: \"&lt;%- theme %&gt;\",\n    fullScreen: true,\n    mode: \"&lt;%- mode %&gt;\",\n    // optional addons\n    matchBrackets: true,\n    styleActiveLine: true,\n    extraKeys: {\n        \"Ctrl-Space\": \"autocomplete\"\n    },\n    gutters: [\"CodeMirror-lint-markers\"],\n    lint: true\n\n});\n\n\neditor.setOption(\"extraKeys\", {\n    F2: function(cm) {\n        console.log(\"F2 handler\", pad);\n        socket.emit('beautify', pad);\n    }\n});\n\n\nsocket.on('doc', function(data) {\n    console.log('doc');\n    pad = data.pad;\n    editor.setValue(data.str);\n    const serverAdapter = new ot.SocketIOAdapter(socket);\n    const editorAdapter = new ot.CodeMirrorAdapter(editor);\n    const client = new ot.EditorClient(data.revision, data.clients, serverAdapter, editorAdapter);\n\n    editor.focus();\n    editor.setCursor({\n        line: line - 1,\n        ch: char\n    })\n\n});\n\nsocket.on('getCursor', function(callback) {\n    editor.focus();\n    callback(editor.getCursor());\n});\n\nsocket.on('setCursor', function(data) {\n    editor.focus();\n    editor.setCursor(data);\n});\n\nsocket.on('disconnect', function() {\n    location.reload();\n});\n</code></pre>\n<p>\n```\nThe mode clike was included afterwards - and fixed the issue.\n<script src=\"/codemirror/mode/clike/clike.js\"></script>. Fixing in #5683. ",
    "gera2ld": "Finally found the problem, it was caused by an injected script. Sorry for bothering.\n. Thanks for the explanation.\nIt's totally acceptable to determine line length based on characters, but I thought it should be mentioned somewhere in the document.. ",
    "sedwards2009": "Just stick grab the keyboard events on your Div in the event capture phase. There you can prevent any PageUp or PageDowns from reaching codemirror and manually scroll your div.\n. The problem I have with that is that I may potentially go hundreds deep in the call stack. And it is rather awkward.\n. (Correct me if I'm wrong.)  To refresh() (for example) multiple CM instances and group the DOM updates you need to effectively do:\n```\ncm1.operation( () => {\n    cm1.refresh();\ncm2.operation( () => {\n  cm2.refresh();\n\n  cm3.operation( () => {\n    cm3.refresh();\n    ...// now cm4, cm5 etc\n  });\n});\n\n});\n```\nor is it just:\ncm1.operation( () => {\n    cm1.refresh();\n    cm2.refresh();\n    cm3.refresh();\n});\n. So, that sounds like my second example above.\nI'll try that out. Thanks for your time.\n. ",
    "nvyush": "Do browsers understand not valid css as required?\n. ",
    "JoelEinbinder": "If it clipped to 0, a page up would have no effect. I was clipping to 1, but I noticed you used 3 below so I switched to that. I added a test.\n. Let me know if there's anything else you'd like me to tweak.\n. Thanks!\n. The size doesn't change, but I have no way of knowing when alignHorizontally gets called so a race condition forms.. I looked into fixing this, but I am having trouble understanding why alignHorizontally needs to be called in setTimeout. I can't reproduce the original bug.. I can't reproduce this with Firefox 52, Windows 10, with contentEditable mode on my local CodeMirror nor with GitHub's editor. Maybe there is another factor?. Sorry I pasted the wrong hash. It was 864a681b4d57823687c2. I tried to wrap my head around more of the surrounding code. I think we can use the same logic for lines with and without bidi by converting between \"visual\" character locations, and internal character locations. \nAdded a test for lineWrapping.. The selection is disabled on mousedown because the internal textarea loses focus. Then on mouseup the selection is removed.. Can the focus class be wrong for 1 frame so that it doesn't flicker? Depending on the highlight colors used it is pretty pronounced. I feel like CodeMirror shouldn't expose that it has multiple focus locations.. Mine has a test :). Yay. I understand why things are how they are, but it is unfortunate that syntax highlighting isn't deterministic.. Thanks!. ",
    "dino-absoluto": "This is probably caused by read-only texts.\nI found a problem in src/model/changes.js.\njavascript\n  // Possibly split or suppress the update based on the presence\n  // of read-only spans in its range.\n  let split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to)\n  if (split) {\n    for (let i = split.length - 1; i >= 0; --i)\n      makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [\"\"] : change.text})\n  } else {\n    makeChangeInner(doc, change)\n  }\nAs you can see, the makeChangeInner call in the for loop here was done without copying over change.origin property so it ended up as undefined.\nThis also seem to prevent changes grouping in undo history as well.. ",
    "jc275": "Ok, from #3660 the problem goes away if a \"string\" state is used, as per the \"factor\" mode. Maybe overkill for the \"simplemode\" example definition.\n. ",
    "paladox": "Strange it seems using spaces and not tabs works.\nhttp://gerrit-old.wmflabs.org/gerrit/#/c/5/2/layout-cloner.yaml\nSo there seems to be a problem that codemirror dosent work correctly with tabs.\n. Oh tabs arnt the problem.\nLook at http://gerrit-test.wmflabs.org/gerrit/#/c/62/3/tests/fixtures/layout-cloner.yaml\nit seems that me adding the extra stuff fixes it. So it seems there is a limit for the width before it gets pushed out.\n. Nope, dosen't look like it is. I see indentUnit set at 2 and tabSize at 8.. Thanks.. Oh. Yep probaly. Thanks. Will update. Thanks. Not sure about doing it all yet, i will just update this line for now.. thank you :).. same for 5.29.0 release.. It shows lib/codemirror.js here https://codemirror.net/doc/manual.html. https://github.com/codemirror/CodeMirror/commit/aa6e9903a786477a789f431c39a8fd030b8046d5#diff-e8acc63b1e238f3255c900eed37254b8 shows a lib/codemirror.js should be generated.. and here https://github.com/codemirror/CodeMirror/blob/master/package.json#L4. thanks.. Ah ok. I was trying to make it consistent with how the other modes do it.. @marijnh hi, does codemirror also support a way to look ahead ie if you highlight per line it needs a way to know if your using HTML but also using javascript \nIe doing\n```\n\n\n  function(e) {}\n\n```\nWhen highlighting per line will it also highlight within ?</p>\n<p>(This is what highlight.js does). @marijnh is there a way to use codemirror.runmode so that it's return is a string, so something like</p>\n<p>var results;\nresults = CodeMirror.runMode(document.getElementById('var = test', \"application/javascript\");\nthis.push('_baseRanges', results); (results returning a string)\n. if callback is empty (which is used to highlight the code by id or class name) then it throws an error.. soemthing like https://github.com/curvedmark/codemirror-highlight/blob/master/lib/highlight.js#L30 but that's too old to use (on npm under codemirror-highlight).</p>\n<p>And could we support highlight.js .top to please?</p>\n<p>so ie it's used like this in highlight.js</p>\n<pre><code>    result = window.hljs.highlight(this._baseLanguage, baseLine, true,\n        state.baseContext);\n    this.push('_baseRanges', result.value);\n    state.baseContext = result.top;\n</code></pre>\n<p>notice result.top and state.baseContext . state.baseContext  pushes up what it reads from result.top, then highlight.js read from state.baseContext and returns it again as result.top.</p>\n<p>This is so it can read each string ie if you have something like</p>\n<p>```\n<element></element></p>\n<script>\nfunction(e) {\n  return e;\n}\n\n```\nit will parse ",
    "bilaltas": "Dev tools also weren't working to get a stack trace. Are you able to test giving position absolute with the latest version of the Chrome?\n. Was the version exactly 53.0.2785.89 or upper? Because it was fine on the other 53. versions before that one. And, what's your OS?\nThis link breaks my Chrome: :)\nhttp://codepen.io/bilaltas/pen/ozXxLN\n. The problem is still present on Mac OS Google Chrome Version 53.0.2785.101 (64-bit). I think the problem occurs only on macs.\n. Now I just found out that if I don't add left and right values with position: absolute, that breaks the browser.\nhttp://codepen.io/bilaltas/pen/ozXxLN This doesn't break.\n. ",
    "finger563": "I'm not getting a freeze, but codeMirror definitely behaves oddly with absolute positioning; it doesn't fully load the code, the gutters don't work, and scrolling messes up (scrollbars don't even show). ",
    "bhattkishan009": "I am sorry for the improper details marijnh.\nNo this problem does not occur on full screen demo and not even on normal page on internet explorer.\nI will write steps to regenerate issues\n1. Use codemirror editor in jquery ui dialog\n2. Open modal popup using a button so the editor gets loaded in dialog.\n3. Go full screen in editor\nThis will set a transparent layer instead of white background in default theme.\nText will be visible but on top of webpage beneath dialog.\nI hope this helps.\n. No problem\nThanks for your reply.\nI will close the issue.\nKind regards\n. ",
    "WebVeteran": "Have you tried &amp;#039;?\n. ",
    "JanWielemaker": "Thanks.  You are right.  The editor is displayed inside a <td> with height 100%.  In the end I couldn't find a pure CSS way to get everything right and now use some JavaScript intervention that sets the explicit height of CodeMirror and calls a refresh() on it.   Not so nice, but not your fault.\n. ",
    "reminyborg": "Right now i am using it for relatedTarget to know what got focus on blur.\n. ",
    "swmitra": "@marijnh Thanks for the quick response :+1: \nIf you think it's a valid behavior what I have proposed, then yes, I will try to implement the new behavior and raise a PR. \n. Just tried the patch in SCSS mode, I could still see the same issue where : and the trailing space along with the { is captured in a single token. . I was excited to see the commit and the issue getting closed. It's not exactly fixed the problem here. The token string is : though by stopping the wraparound, but token state has not changed. . Thanks a lot @marijnh . I got it to work now \ud83d\udc4d . ",
    "Cr4xy": "Yes, I uploaded it to http://cr4xy.square7.ch\nThanks for your fast response!\n. Any idea?\n. ",
    "gnblizz": "Well, I am just used to do it that way.\nThing is, the user moves the mouse, and sees how the dropeffect changes, depending from what is possible at the actual mouse position.\n(intuitive usability)\nEdit:\nWhen the user discovers the missing plus sign he will press the modifier key then.\nThe opposite is possible also: When the user drags something between different text windows it is usually better to leave the source intact. The default action is 'copy' here. The user sees the plus sign and presses SHIFT, when he intents to remove the selected text from the source.\nsee also:\nhttps://msdn.microsoft.com/en-us/library/ms742859(v=vs.110).aspx\n. Well, I am just used to do it that way.\nThing is, the user moves the mouse, and sees how the dropeffect changes, depending from what is possible at the actual mouse position.\n(intuitive usability)\nEdit:\nWhen the user discovers the missing plus sign he will press the modifier key then.\nThe opposite is possible also: When the user drags something between different text windows it is usually better to leave the source intact. The default action is 'copy' here. The user sees the plus sign and presses SHIFT, when he intents to remove the selected text from the source.\nsee also:\nhttps://msdn.microsoft.com/en-us/library/ms742859(v=vs.110).aspx\n. ",
    "sawo": "I have the same issue, but not on mobile, but on desktop. My dev. env is: OSX El Captain, Firefox ESR 45.4\n. @marijnh The demos were working fine, i ve experienced this double-new line begavior only in my app, but now it disappeared there as well, works fine. It is good news for me, but does not help for you to figure out :(\nAs soon as i find the change that solved for me, i will let you know. I remember one thing that might help: if i pressed enter: two new lines were created, but if i was pressing shift+enter, only one new line was created. The first time i've seen it, i tought it is a feature, not a bug\n. ",
    "zhanglun": "I have the same issue, when I pressing the Enter\uff0ctwo lines added. My dev: OS Sierra 10.12.1, Chrome Version 54.0.2840.98 (64-bit)\ndemos in here has the same problem in Chrome, but works fine in my Safari\n. ",
    "lyquichung": "I have the same issue, I don't know why this works too, but including XML mode before creating editor make it works fine.\n<script src='../js/codemirror/mode/xml/xml.js'></script>\n. @gfvcastro  see my previous comment. It solved my problem.. ",
    "gfvcastro": "I have the same issue. Is there any news about this issue?. ",
    "randomnum": "EDIT:\nHi I find this plugin here ... But I did not knew How I can change displayText and text for my own language \nI used this code for autocomplete my language :\nvar orig = CodeMirror.hint.anyword;\nvar inner;\nCodeMirror.hint.anyword = function(cm) {\n    inner = orig(cm) || { from: cm.getCursor(), to: cm.getCursor()};\ninner.list.length = 0; \ninner.list.push(\"fun1\");\ninner.list.push(\"fun2\");\n  return inner;\n}\nextraKeys: {\n        \"Ctrl-Space\": \"autocomplete\",\n        \"Ctrl-Space\":function(cm){  CodeMirror.showHint(cm, CodeMirror.hint.anyword); },\n        \"'.'\": \"autocomplete\",\n        \"'.'\" : function(cm) { \n            setTimeout(function(){cm.execCommand(\"autocomplete\");}, 10);\n            CodeMirror.showHint(cm, CodeMirror.hint.anyword);\n         },\ncan any body help me How to change displayText and text for my  CodeMirror.showHint .... plz help \n. ",
    "vtnorton": "Same here, only on mobile. \n. ",
    "MattQlik": "\nI've also reproduced this on v49 of Firefox and would also add that IME suggestion box is partially obscuring the input text when it's in the 'right' place. \nThis is the issue that was patched in https://github.com/codemirror/CodeMirror/commit/51a1e7da60a99e019f026a118dc7c98c2b1f9d62 but it seems the patch works in most browser OS combinations but not FF in Win7.\n. ",
    "cstjean": "\nSeems to work fine on https://codemirror.net/mode/julia/index.html. Please re-open if there are issues with current CodeMirror.\n\nUsing that link, I'm getting this indentation:\njulia\na.signals = [Dict{Any, Any}(\"name\" => \"tooltip\", \n        \"tom\"=>f(x, \n            3)]\nwhich is pretty significantly broken IMO, although it's different from what I'm getting in Jupyter. It should be\njulia\na.signals = [Dict{Any, Any}(\"name\" => \"tooltip\", \n                            \"tom\"=>f(x, \n                                     3)]\n. ",
    "jtackm": "Any news on this? I'm having indentation trouble with simple if-else statements (after the else or elseif, the indentation level is one higher than expected). Example:\nx = 1\ny = 0\nif x == 1\n    y = 5\nelse\n        # auto-indent is here\n    y = -5\nend\nThis is quite annoying as everything that follows an if-else needs to repeatedly by re-indented by hand :(. ",
    "Eward-Wang": "win10 ?. ",
    "aanari": "Also not working for me in Chrome 63 :(. ",
    "amochohan": "Is there something like specialChars that can match a phrase or anything longer than a single character?\nThe code I have has placeholders, which i'd like to apply some CSS to or add a class. Such a placeholder would be any text between the (bespoke) [[ ]] tags.\n. Could you provide a small code sample to get me started?\n. ",
    "jonnybradley": "Sorry, found another one, mode/swift/swift.js has hardly any semicolons in at all :(\nP.S. We just updated from version 4.x where everything minified ok, thanks\n. Hmm, were still using https://github.com/rgrove/jsmin-php/ and that's really out of date and unmaintained now, guess we need to rebuild our minify system (but not for the current release now, sadly)\nThanks for your reply :)\n. ",
    "tberman": "Yeah, the name is not optimal at all.\nI am using it to customize the line classes that get added for merge-l/merge-r to include the gutter as well so we can style that. I made it also support an array to let people get complete customization as wrap and gutter + background do very different things, which could be useful depending on what you need.\nWhat about lineClassLocation instead since the editor API is [add|remove]LineClass?\n. cm.lineInfo and maybe cm.addWidget (although the scrollIntoView bit only makes sense on the editor)\n. Alright, @marijnh, should be fixed.. Good catch. Will update when I get back to my computer. . ",
    "TWiStErRob": "I suspected they officially don't support mobile based on the no-response so far and found this:\n\nSupport for modern mobile browsers is experimental. Recent versions of the iOS browser and Chrome on Android should work pretty well.\n. The thing I don't understand is how HackerRank made it work. I'm doing https://www.hackerrank.com/domains/tutorials/30-days-of-code for fun, and every morning when I wake up I start by solving the problem presented in bed on my phone. I'm at Day 5 and experienced no issues so far. Editing works perfectly fine, apart from a very little jump on focus, but no functionality is broken like on your demo and other uses of CM. On desktop they surely use CM, just checked again, and there's no mobile view/styles as far as I can tell, so it should be the same DOM in my phone.\n. \n",
    "bitmvr": "If the _ is within a URL, I'd think the engine should be smart enough to know we (as end-users) are not declaring an initialization for italics. This is also just visible in the editor, which apparently is being used by Gist for GitHub. However, when a Gist is saved, the italics are not rendered.\nA simple way might be to determine if the string starts with http(s):// and everything up to the white space is considered part of the URL. \nLikely need more work to get right, but something similar to this... \ud83e\udd14 \ud83e\udd37\u200d\u2642\ufe0f \n\n. ",
    "takamori": "By annotating .CodeMirror-gutter-wrapper.CodeMirror-activeline-gutter with background-color, and then setting background-color: inherit on .CodeMirror-activeline-gutter > .CodeMirror-gutter-elt, one can cover areas where there is a gutter element, but not the cases where the gutter element is omitted.\nFor instance, if some but not all rows have an annotation, or if some but not all rows have a fold indicator, this will only cover the portion that has the line number and the annotation or fold indicator that may or may not exist on the line, but not the empty spaces in the cases where there is none.\nThe CodeMirror-gutter-wrapper.CodeMirror-activeline-gutter itself does not have a size that corresponds to the size of the gutter.\n. (also, the impact is worse with a large diff chunk)\n. ah, you're right. I should have checked on convention first, thanks.\n. The same issue also occurs for the center if you swap left and center in the examples above. The issue does not occur if you swap the left and right, however.\n. Thanks, but unfortunately, this still repros after the above commits with the following attached files (sorry, but these are obfuscated and rather large). \nLeft line 104, Center line 169, and Right line 168 have the same content, but are\n1) placed separately, and\n2) have a large gap inserted in the middle spanning all three panes, weirdly.\nOddly, adding a single line of diff to the top (e.g. LEFT, CENTER, RIGHT) makes the gap go away, so unfortunately it seems pretty hard to create a simple repro (I wasn't able to create one based on my prior example, but maybe I missed the key factors that made a difference).\nleft.txt\ncenter.txt\nright.txt\n. Looks like I managed to create a case where it's not aligned while working on creating a test case for my other bug: https://jsfiddle.net/Lyeykf0w/\nSee where Elk and Frog are located on the right side compared to the left and center.\n. Yep, it looks fixed now.\n. I forgot to note that if you further click on the bottom left revert arrow, the arrow's new position also seems odd.\n. As far as I can tell, it looks much better, thanks!\n. I left a comment on the patch; reversing the comparison makes it look correct.\n. thx for the fix!. See the gutter annotations in https://jsfiddle.net/xzjrywLk/4/ and the CSS calc() hack I have on highlight-diff-end::after\nwhich it turns out is insufficient- if lineWrapping is enabled, the hack doesn't work see line 29 in the center of: https://jsfiddle.net/xzjrywLk/5/\nAlso, it would be difficult to make the borders (see line 9 in the left, for instance) look right, so currently we just disable them, but it would better if we could make them just work.\n. Sorry for the late response. So- we had a slightly different diff algorithm going on that we wanted to render results for as well, which we were rendering w/ the gutter annotations. But it looks like we can avoid needing to have the separate rendering in the gutter vs the background highlighting, and coloring the merge spacer itself should be an easier task, so I believe we can go w/ that instead.. This was CrOS 56 beta using touchpad. We've seen this issue on other\nmachines before for some time but this was the first simple repro I've\nseen. I'll check on the behavior of this example on Mac and Linux.\nOn Feb 5, 2017 12:50 PM, \"Marijn Haverbeke\" notifications@github.com\nwrote:\n\nWhich browser, which platform, and how are you scrolling? (Using touch pad\nscroll on Chrome 55 Linux, I couldn't get this to happen.)\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/4546#issuecomment-277548132,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AADV0gLMRt4qKgcXD2CXuGuY68zK_alsks5rZjYLgaJpZM4L3jT7\n.\n. Hmm, the issue doesn't repro w/ this example on my Mac w/ Chrome 56 stable or 58 canary, or Linux w/ Chrome 56 stable, 57 beta, or 58 dev. I'll come up w/ a better repro.. Sorry, I didn't clarify that the left pane has the bad gap in the jsfiddle. The problem is seen user-visible via the gap above \"BAD GAP ABOVE\" in the left pane. The MISALIGNED GAP in the center highlights the origin of the bad gap, which is why I pointed out the code block I mentioned as being the source of the error.\n. Here's a simplified version: https://jsfiddle.net/c3rjpdxg/2/\n\n\nWhere I've marked the two lines in between which no gap is expected. The origin of the gap is the line below \"Frog\" in the center; it doesn't account for that there is no alignment needed since there's already a gap next to the gap, and instead offsets from the bottom of the left gap, which is why it's 6 lines below.\n. sorry, I forgot to update this bug; yes, that fixes it.. This still repros with the following:\nclass Greeter {\n  greeting: string;\n  constructor (message: string) {\n    this.greeting = message;\n  }\n  greet<T>(): Message<T> {\n    this.greeting = `Hello, ${this.greeting}`;\n    throw new Error('just because');\n  }\n}\n. Repro's if you have the text \"y\u0131lba\u015f\u0131\" in the doc. Filed https://github.com/codemirror/CodeMirror/issues/4839 since I can't reopen the issue. Also repros with text \"\uc218 \uc788\uc744\uae4c\" and searching for '\uc774'.. hmm, this can still repro with \"Le taux d'humidit\u00e9 \u00e0 London\" and searching for \"a\". Still occurs if you type Ctrl-S twice, click in the editor, and then type Ctrl-S. (tested on http://codemirror.net/demo/emacs.html )\n. hmm, you're right. It looks fine now.. Ah... yes, this was in regard to the solarized light theme. Interesting; in the dark version, it seems that removing the line could theoretically make it hard to tell the difference between bold and not bold.\nBut it's worth noting that the dark theme example in http://ethanschoonover.com/solarized for markdown (http://ethanschoonover.com/solarized/img/screen-pandoc-dark.png) does seem to suggest that it should be possible to make a dark variant that doesn't require a color change. IIUC, the philosophy for solarized is that the foreground colors shouldn't need to change when switching between light and dark variants. It doesn't look like #eee is part of the solarized palette, though.\n. Actually, after playing with it more I'd argue it should be fine to simply remove the line.. Yep, that behaves better. Thanks!. I just noticed that this commit makes the result worse, actually. Currently the result is that no fold appears at all when there's a line break; I compared the behavior if I revert the change using DevTools to modify the code. . Uh... now it has the originally-filed behavior where two arrows show up, but that's better than the behavior after the first patch.\nTo be clear, the originally-filed issue is that the following content:\n<div title=\"foo\"\n         id=\"bar\">\n   <span>some content</span>\n</div>\ngets collapsed into the following appearance:\n35\u25be   <div title=\"foo\"\n36\u25b8         id=\"bar\">\u2194</div>\nrather than the following (note that there is no extra arrow at line 35):\n35    <div title=\"foo\"\n36\u25b8         id=\"bar\">\u2194</div>\n. I've tried using DevTools to \"Empty cache and hard reload\" the folding demo page, and it repros. Not when you immediately paste the snippet- but when you click the arrow in the gutter to collapse the item, the two arrows appear. And clicking on either of those two arrows results in expanding only the div element.\n. I'd like to note the following:\n- the ^ works for other patterns. For instance, /^</ and /^ / and /^ +</ works, as does /^[ \\t]+</.\n- the highlighted result looks just fine, from what I can tell. \nWhy is it any different for the search cursor?\n. Btw that pattern that line-wrapped should have been /^[ \\t]+</ (a space and tab). I meant that in combination with how endOperation wipes the curOp value from all CM instances referenced by the group is what can cause this: https://github.com/codemirror/CodeMirror/blob/master/src/display/operations.js#L49\n. Yes, it is asynchronous right now, as noted as a potential use case in the description of startOperation/endOperation (\"if you want to buffer operations happening asynchronously...\"). The intent in this case was to reduce the number of paints when doing a lot of rapid updates. Making endOperation a no-op would be harmless for our use case (at least, compared to having an error thrown... :) ).\nBut given the overall behavior, we're looking into whether we can avoid the asynchronous ordering and perform updates synchronously instead.\n. Sorry for the late response. I believe it would have, but it looks like we've already made the change I mentioned earlier as being investigated.. thanks!. ",
    "Rokt33r": "Okay. \ud83e\udd15  I left my snippet for someone who want to tackle this.\njs\nCodeMirror(el, {\n  extraKeys: {\n    Tab: function (cm) {\n      if (cm.somethingSelected()) cm.indentSelection('add')\n      else {\n        if (cm.getOption('indentWithTabs')) {\n          cm.execCommand('insertTab')\n        } else {\n          cm.execCommand('insertSoftTab')\n        }\n      }\n    }\n  }\n})\n. ",
    "Thristhart": "Ah, right. It works in my use case because I transpile afterwards. Do you think it's worth it to set up a transpile step that keeps the module loading? I'm not really sure what that would look like.\n. ",
    "atelierbram": "Thanks!\n. ",
    "akosyakov": "@marijnh maybe i misunderstood you, but I did not mean to serve Tern as a language server but rather let CodeMirror make use of other language servers.\n. Could we have it opened and see whether somebody will step forward to implement such plugin?\n. @vincentwoo nope, if you are building a complex system and plugins can change a mime type and you should react on it\ngenerally it would be nice to have an event that options changed. ",
    "thorade": "@akosyakov do you know whether a LSP plugin is by now available somewhere?. ",
    "ManishAgrawal1410": "Is Codemirror planning to integrate with LSP server near future ? Can anyone update?. ",
    "bogdanalexe90": "Agree with you about the broken mechanism. \nBut you should at least mark this change as a breaking change since it will break apps that rely on bower.\n. ",
    "darkmavis1980": "I can't move to something different than bower as is part of a big project and we can easily swap package manager.\n. I think I'll be stuck to 5.19.0 for a while\n. It is really that hard to put back that js file? I understand your point, but at the same time you can't force people that use a specific technology, and like my case that we cannot change it to anything more modern easily, just because you believe is the right thing to do.\n. Sorry but in the docs you write that you have to use the files in the lib/ folder, but since now you removed the javascript file this no longer apply.\nYou don't like bower, fine, but at least you should realise that your doc is out of date and you actually don't explain how to implement codemirror on a project now.\n\nThe easiest way to use CodeMirror is to simply load the script and style sheet found under lib/ in the distribution, plus a mode script from one of the mode/ directories. For example:\n<script src=\"lib/codemirror.js\"></script>\n<link rel=\"stylesheet\" href=\"lib/codemirror.css\">\n<script src=\"mode/javascript/javascript.js\"></script>\n. \n",
    "roparz": "\nI can't move to something different than bower.\n\n+1\n. It is not hardcoded, codemirror is in the bower registry: https://bower.io/search/?q=codemirror\nWe just have to type bower install --save codemirror to get it.\n. For people who'd like to take this opportunity to get rid of bower, here are some explanation ;-)\nhttps://gofore.com/stop-using-bower/\n. Maybe you should create a major version (v6) since this is a breaking change.\nSome libraries declare a ^5.0 version, like angular-ui/ui-codemirror.\n. ",
    "mattgodbolt": "+1 here too; I understand (and sympathise with) the awkwardness of supporting bower with a build step, but it was a bit of a shock. I read the release announcement, but it wasn't clear to me that this broke bower installs!\n. ",
    "jtheoof": "I second @roparz comment. I understand your point in removing a bundled file from the repo but this is breaking change for a lot of us.\n. I forgot to mention, here is my bower.json:\n{\n  \"name\": \"xxx\",\n  \"version\": \"0.0.1\",\n  \"dependencies\": {\n    \"codemirror\": \"CodeMirror#^5.14.2\",\n   ...\n  }\n}\nContent of codemirror:\n```\n.\n\u251c\u2500\u2500 AUTHORS\n\u251c\u2500\u2500 CHANGELOG.md\n\u251c\u2500\u2500 CONTRIBUTING.md\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 addon\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 comment\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 comment.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 continuecomment.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dialog\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 dialog.css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 dialog.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 display\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 autorefresh.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 fullscreen.css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 fullscreen.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 panel.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 placeholder.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 rulers.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 edit\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 closebrackets.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 closetag.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 continuelist.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 matchbrackets.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 matchtags.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 trailingspace.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 fold\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 brace-fold.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 comment-fold.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 foldcode.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 foldgutter.css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 foldgutter.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 indent-fold.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 markdown-fold.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 xml-fold.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 hint\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 anyword-hint.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 css-hint.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 html-hint.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 javascript-hint.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 show-hint.css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 show-hint.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 sql-hint.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 xml-hint.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lint\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 coffeescript-lint.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 css-lint.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 html-lint.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 javascript-lint.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 json-lint.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 lint.css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 lint.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 yaml-lint.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 merge\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 merge.css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 merge.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 mode\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 loadmode.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 multiplex.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 multiplex_test.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 overlay.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 simple.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 runmode\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 colorize.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 runmode-standalone.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 runmode.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 runmode.node.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 scroll\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 annotatescrollbar.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 scrollpastend.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 simplescrollbars.css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 simplescrollbars.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 search\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 jump-to-line.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 match-highlighter.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 matchesonscrollbar.css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 matchesonscrollbar.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 search.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 searchcursor.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 selection\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 active-line.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 mark-selection.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 selection-pointer.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 tern\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 tern.css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 tern.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 worker.js\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 wrap\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 hardwrap.js\n\u251c\u2500\u2500 bower.json\n\u251c\u2500\u2500 keymap\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 emacs.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 sublime.js\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 vim.js\n\u251c\u2500\u2500 lib\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 codemirror.css\n\u251c\u2500\u2500 mode\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 apl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 apl.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 asciiarmor\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 asciiarmor.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 asn.1\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 asn.1.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 asterisk\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 asterisk.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 brainfuck\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 brainfuck.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 clike\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 clike.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 clojure\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 clojure.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 cmake\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 cmake.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 cobol\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 cobol.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 coffeescript\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 coffeescript.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 commonlisp\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 commonlisp.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 crystal\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 crystal.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 css.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 cypher\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 cypher.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 d\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 d.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dart\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 dart.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 diff\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 diff.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 django\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 django.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dockerfile\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 dockerfile.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dtd\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 dtd.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dylan\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 dylan.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ebnf\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ebnf.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ecl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ecl.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 eiffel\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 eiffel.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 elm\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 elm.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 erlang\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 erlang.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 factor\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 factor.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 fcl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 fcl.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 forth\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 forth.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 fortran\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 fortran.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 gas\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gas.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 gfm\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gfm.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 gherkin\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gherkin.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 go.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 groovy\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 groovy.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 haml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 haml.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 handlebars\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 handlebars.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 haskell\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 haskell.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 haskell-literate\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 haskell-literate.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 haxe\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 haxe.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 htmlembedded\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 htmlembedded.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 htmlmixed\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 htmlmixed.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 http\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 http.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 idl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 idl.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 javascript\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 javascript.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 jinja2\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 jinja2.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 jsx\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 jsx.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 julia\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 julia.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 livescript\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 livescript.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lua\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 lua.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 markdown\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 markdown.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 mathematica\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 mathematica.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 mbox\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 mbox.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 meta.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 mirc\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 mirc.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 mllike\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 mllike.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 modelica\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 modelica.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 mscgen\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 mscgen.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 mumps\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 mumps.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 nginx\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 nginx.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 nsis\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 nsis.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ntriples\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ntriples.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 octave\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 octave.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 oz\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 oz.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 pascal\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 pascal.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 pegjs\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 pegjs.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 perl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 perl.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 php\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 php.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 pig\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 pig.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 powershell\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 powershell.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 properties\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 properties.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 protobuf\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 protobuf.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 pug\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 pug.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 puppet\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 puppet.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 python\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 python.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 q\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 q.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 r\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 r.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 rpm\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 changes\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 rpm.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 rst\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 rst.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ruby\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ruby.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 rust\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 rust.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 sas\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 sas.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 sass\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 sass.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 scheme\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 scheme.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 shell\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 shell.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 sieve\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 sieve.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 slim\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 slim.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 smalltalk\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 smalltalk.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 smarty\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 smarty.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 solr\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 solr.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 soy\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 soy.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 sparql\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 sparql.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 spreadsheet\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 spreadsheet.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 sql\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 sql.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 stex\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 stex.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 stylus\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 stylus.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 swift\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 swift.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 tcl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 tcl.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 textile\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 textile.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 tiddlywiki\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 tiddlywiki.css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 tiddlywiki.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 tiki\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 tiki.css\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 tiki.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 toml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 toml.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 tornado\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 tornado.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 troff\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 troff.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ttcn\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ttcn.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ttcn-cfg\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ttcn-cfg.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 turtle\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 turtle.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 twig\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 twig.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 vb\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 vb.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 vbscript\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 vbscript.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 velocity\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 velocity.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 verilog\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 verilog.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 vhdl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 vhdl.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 vue\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 vue.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 webidl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 webidl.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 xml.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 xquery\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 xquery.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 yacas\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 yacas.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 yaml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 yaml.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 yaml-frontmatter\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 yaml-frontmatter.js\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 z80\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 z80.js\n\u251c\u2500\u2500 rollup.config.js\n\u251c\u2500\u2500 src\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 codemirror.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 display\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 Display.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 focus.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 gutters.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 highlight_worker.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 line_numbers.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 mode_state.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 operations.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 scroll_events.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 scrollbars.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 scrolling.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 selection.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 update_display.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 update_line.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 update_lines.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 view_tracking.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 edit\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 CodeMirror.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 commands.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 deleteNearSelection.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 drop_events.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 fromTextArea.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 global_events.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 key_events.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 legacy.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 main.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 methods.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 mouse_events.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 options.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 utils.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 input\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ContentEditableInput.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 TextareaInput.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 indent.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 input.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 keymap.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 keynames.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 line\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 highlight.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 line_data.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pos.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 saw_special_spans.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 spans.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 utils_line.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 measurement\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 position_measurement.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 widgets.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 model\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 Doc.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 change_measurement.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 changes.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 chunk.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 document_data.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 history.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 line_widget.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 mark_text.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 selection.js\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 selection_updates.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 modes.js\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 util\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 StringStream.js\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 bidi.js\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 browser.js\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 dom.js\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 event.js\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 feature_detection.js\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 misc.js\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 operation_group.js\n\u2514\u2500\u2500 theme\n    \u251c\u2500\u2500 3024-day.css\n    \u251c\u2500\u2500 3024-night.css\n    \u251c\u2500\u2500 abcdef.css\n    \u251c\u2500\u2500 ambiance-mobile.css\n    \u251c\u2500\u2500 ambiance.css\n    \u251c\u2500\u2500 base16-dark.css\n    \u251c\u2500\u2500 base16-light.css\n    \u251c\u2500\u2500 bespin.css\n    \u251c\u2500\u2500 blackboard.css\n    \u251c\u2500\u2500 cobalt.css\n    \u251c\u2500\u2500 colorforth.css\n    \u251c\u2500\u2500 dracula.css\n    \u251c\u2500\u2500 duotone-dark.css\n    \u251c\u2500\u2500 duotone-light.css\n    \u251c\u2500\u2500 eclipse.css\n    \u251c\u2500\u2500 elegant.css\n    \u251c\u2500\u2500 erlang-dark.css\n    \u251c\u2500\u2500 hopscotch.css\n    \u251c\u2500\u2500 icecoder.css\n    \u251c\u2500\u2500 isotope.css\n    \u251c\u2500\u2500 lesser-dark.css\n    \u251c\u2500\u2500 liquibyte.css\n    \u251c\u2500\u2500 material.css\n    \u251c\u2500\u2500 mbo.css\n    \u251c\u2500\u2500 mdn-like.css\n    \u251c\u2500\u2500 midnight.css\n    \u251c\u2500\u2500 monokai.css\n    \u251c\u2500\u2500 neat.css\n    \u251c\u2500\u2500 neo.css\n    \u251c\u2500\u2500 night.css\n    \u251c\u2500\u2500 panda-syntax.css\n    \u251c\u2500\u2500 paraiso-dark.css\n    \u251c\u2500\u2500 paraiso-light.css\n    \u251c\u2500\u2500 pastel-on-dark.css\n    \u251c\u2500\u2500 railscasts.css\n    \u251c\u2500\u2500 rubyblue.css\n    \u251c\u2500\u2500 seti.css\n    \u251c\u2500\u2500 solarized.css\n    \u251c\u2500\u2500 the-matrix.css\n    \u251c\u2500\u2500 tomorrow-night-bright.css\n    \u251c\u2500\u2500 tomorrow-night-eighties.css\n    \u251c\u2500\u2500 ttcn.css\n    \u251c\u2500\u2500 twilight.css\n    \u251c\u2500\u2500 vibrant-ink.css\n    \u251c\u2500\u2500 xq-dark.css\n    \u251c\u2500\u2500 xq-light.css\n    \u251c\u2500\u2500 yeti.css\n    \u2514\u2500\u2500 zenburn.css\n149 directories, 312 files\n```\n. ",
    "tomsommer": "Add \"CodeMirror\": \"~5.19\", to bower.json to keep the 5.19 version - although this will prevent future updates and fixes, obviously.\n. ",
    "jrockowitz": "For an immediate workaround/solution, I am using Drush, which is a Drupal specific build tool, to download the single missing file from\nhttps://cdnjs.cloudflare.com/ajax/libs/codemirror/5.20.2/codemirror.js\nand placing it in the already downloaded 'codemirror/lib' directory.\n. ",
    "PixellUp": "Why not update http://codemirror.net/doc/manual.html? People like my get confused, that codemirror.js from lib folder is removed.\n. ",
    "MaxKot": "\nYou just have to do so in a properly built version of the code. I.e. download the zip from the website\n\nPlease remove .gitignore from the properly built version. When I extract the library to my source tree lib/codemirror.js has to be added manually because of the .gitignore file.\nI use CodeMirror in an ASP.NET project and I don't have npm or node.js in my project. Building codemirror.js as a part of my project would require me to add new tools which I don't really need in my project.\n. ",
    "madhukard": "bower install now failing with below error:\n\u279c  datacollector-ui git:(master) bower install\nbower codemirror#5.19.0         cached https://github.com/codemirror/bower.git#5.19.0\nbower codemirror#5.19.0       validate 5.19.0 against https://github.com/codemirror/bower.git#5.19.0\nbower codemirror#5.19.0        ECMDERR Failed to execute \"git ls-remote --tags --heads https://github.com/codemirror/bower.git\", exit code of #128 remote: Repository not found. fatal: repository 'https://github.com/codemirror/bower.git/' not found\nAdditional error details:\nremote: Repository not found.\nfatal: repository 'https://github.com/codemirror/bower.git/' not found\n. Thanks, it is working fine now. ",
    "Fluotonic": "The best option remains npm here: https://www.npmjs.com/package/codemirror\nThis way, you get the package properly built for you and there's no more problem with /lib/codemirror.js.\nHonestly, I love Bower but NPM is more powerful. . ",
    "gplcart": "Many people using Composer for assets. It's handy to use only one tool instead of several. The package from http://codemirror.net/codemirror.zip contains all files but there's no version control plus Composer complains about unsecure connection. Very confusing situation. It should be noted in readme. ",
    "BorisTB": "Oh I'm sorry I've missed that. Our build failed on it so I guess we'll have to use 5.19 until we change our build code.\nThanks for fast response :)\n. ",
    "GuillaumeUnice": "Yes it's a problem because I use this link in lot of application :s\n. ",
    "bvs90": "We use Angular-UI-Codemirror and the codemirror.js file is not being created and hence breaking our builds. \n. ",
    "pselden": "https://github.com/codemirror/CodeMirror/issues/4333#issuecomment-255184832: I think it has to do with #4334 \n. @michael-ts -- if you install via npm -- \"npm install codemirror\" it will install the pre-built version into your node_modules folder (should have a file at lib/codemirror.js).\nIt's only if you install via the url directly (or clone from git) that you need to run the build process.\nIf you do want to run the build process, you'll have to change directories to be inside of codemirror and then run \"npm install && npm run build\"\n(the npm install without an argument tells npm to look at the package.json for dependencies).\nHowever, in your case just run npm install codemirror and see that it's prebuilt\n. I see that this is partially a duplicate of #4328\n. ",
    "michael-ts": "@pselden Is the documented build method making some assumptions about what build process you are using?  I'm not using anything like bower (that I'm aware of), only npm - I'm just literally (trying) following the directions on the main page.\n. @pselden thanks, the part of having to run it directly in the node_modules/codemirror directory was the big one I wasn't aware of.\n. ",
    "ultrablue": "Confirmed, thank you!!!!!!!!!\n. ",
    "Manishearth": "Nah, just the one it seems.\n. ",
    "bucweat": "Roger copy. I downloaded code from main page link originally and had same problem, so I went to github. Since older revisions had it I assumed there was a problem. Seems the zip file from main page is good now. Thanks. \n. ",
    "Foolyou": "https://github.com/codemirror/CodeMirror/blob/master/mode/ruby/ruby.js#L278\nIt seems there should be some elsif, when things here.\n. ",
    "pirtleshell": "Thanks! That's much easier. I was too focused on the gutter-specific docs... I should have recognized general option setting was what I needed.\nAwesome codebase, BTW! Thank you!\n. ",
    "juliohm": "BTW, this issue is affecting everyone that is using Jupyter notebooks with Julia v0.5, which is the current release of the language.\n. Can this issue be closed?\n. ",
    "zhengweijia": "any suggestion\uff1f\nthanks.\n. ",
    "stevehoover": "Thanks!\n. ",
    "shunjikonishi": "54.0.2840.71 (64-bit) on Mac\n. ",
    "icarito": "I'm also seeing this, or something very similar. It is much worse with fixedGutter set to False. Alas, it doesn't show on the demo. Sorry for the noise.... ",
    "Alidad3250": "sorry fro confusing...I reported to the stackoverflow.com please see that page...\nhttp://stackoverflow.com/questions/40493728/how-to-load-code-using-codemirror\nWhat I'm trying to say is that let say that I have .css file name shopping.css, and I want .css text area from codemirror to load the code from shopping.css for me to see or change. \nsomewhere where I need to put file path name to link to another page ...\nhope is clear what I'm trying to say!\nAM\n. ",
    "TheSoundDefense": "Wow, I'm not sure what happened. I was running the tests constantly, I must have missed them after I made some last-minute changes. Sorry!\n. Will do, thanks!. ",
    "hokaccha": "@marijnh It worked on the Mac, but it did not work on the window. thanks.\n. ",
    "simonlast": "Ah, great thank you. That worked.\n. ",
    "tamakisquare": "https://github.com/atom/atom/issues/1669\n@marijnh, you are right it's an os-level thing. Thanks for clarifying that.\n. ",
    "riklomas": "Sure, I just wanted to flag this up as an issue when the round brackets are empty and that it can be inconsistent with valid conditions. Just something I noticed when my students are using Javascript and getting weirdly indented code. \ud83d\udc4d\n. ",
    "BernardZhang": "Hi marijnh,\nDo npm install && npm run build also occur the error(404). I think it's not the reason cause the issue.\n. Sorry~~, demo/lint.html  just for an example page, others pages under demo folder also occur the issue. Actually i also can show the page normally but after visit the page the node server throws the  404 error which make the node server crashed...\n\nNode version: v7.0.0\n. Oh~~~ What a foolish issue I asked. Sorry for wasting your time and thanks for your patient reply.\n. ",
    "leftaroundabout": "You can also escape with ctrl-[. Alternatively, in Vimperator, you can press shift+esc to disable all Vimperator keys, then esc to escape the codemirror-vim input mode, then (optional) shift+esc again do activate vimperator. Not optimal and not sure if it also works in Pentadactyl.. ",
    "jdalton": "Moved to #4393.\n. @marijnh\nOk I found the issue.\nBy whatwg spec document.activeElement will be the current focusable element. If non is active it will be document.body. If document.body isn't available then it should be document.documentElement or null (all browsers just return null).\nHowever, in Edge in an iframe, if activeElement is supposed to be document.body and it's not available it will throw Unspecified Error. Out of the iframe it will result in null.\nUpdate:\nOh snao! It turns out it will do that in Edge, IE 11, IE 10, IE9, IE8... I've updated the code comment to describe the issue better.\n. > Could it be that these are actually the same case? It was observed 'during loading' before, but most likely that was just because no body was available.\nThey could be similar.\nI wasn't sure if IE < 10 may also error out of an iframe while the page is loaded so I left that bit in.\n. I removed the function forking because it seemed like overkill.\n. I'll check it out. What's interesting is the old fallback for IE9 didn't have the loop logic.\n. @marijnh\nDo you know if any of the documents are created with DOMParser or the result of an XHR?\nI'm triaging the bug from the MS Edge side and trying to narrow down the Unspecified Error which is a fallback error for when things go totally wonky.\n. @marijnh\nSorry for more q's, but when is there a root property on an element?\nIs this something CodeMirror adds?\n. ",
    "serbyy": "Answered...\nhttp://stackoverflow.com/questions/40713569/can-not-get-codemirror-textarea-values-on-multiple-elements-using-js-jquery/40713680?noredirect=1#comment68655261_40713680\nIssue Closed. ",
    "brandonbloom": "Note sure, but for what it's worth, this is from :help paragraph:\n*paragraph*\nA paragraph begins after each empty line, and also at each of a set of\nparagraph macros, specified by the pairs of characters in the 'paragraphs'\noption.  The default is \"IPLPPPQPP TPHPLIPpLpItpplpipbp\", which corresponds to\nthe macros \".IP\", \".LP\", etc.  (These are nroff macros, so the dot must be in\nthe first column).  A section boundary is also a paragraph boundary.\nNote that a blank line (only containing white space) is NOT a paragraph\nboundary.\nAlso note that this does not include a '{' or '}' in the first column.  When\nthe '{' flag is in 'cpoptions' then '{' in the first column is used as a\nparagraph boundary |posix|.\nAnd this is a little down from :help text-objects:\n*v_ap* *ap*\nap          \"a paragraph\", select [count] paragraphs (see\n            |paragraph|).\n            Exception: a blank line (only containing white space)\n            is also a paragraph boundary.\n            When used in Visual mode it is made linewise.. ",
    "alexkieling": "Then the Bower registry is misconfigured. It's currently pointing to git://github.com/marijnh/CodeMirror.git, which does not have a bower.json. There was a bower.json on version 5.20.0 of that repository. It's been removed in version 5.20.2. Something is not right.. I'm looking at the Bower website. Using bower info codemirror is a better way to check the repository's URL.\nDid you notice that bower.json has been removed in version 5.20.2?. I have an app that imports codemirror using Bower at the moment. What do you suggest I should do?. ",
    "ex37": "@marijnh my app was using bower as well, it's very handy using the main field of bower.json to automatically including main files. And it was working very well, till the file was not removed from the repo.. ",
    "enemijs1": "Solution for this, is to add lineWrapping: true, param for CodeMirror ;) . ",
    "tklancer": "@marijnh Thanks for the quick response! We've updated to add a new property 'styleActiveSelected', along with documentation and a button in the demo. Let me know what you think.. Thanks very much, @marijnh ! \ud83d\udcaf . ",
    "mdeng123": "@marijnh I just wanted to quickly follow up and get your thoughts on this pull request. I am working with @tklancer on this.. ",
    "bigopon": "Thanks, what a bout both different height and color for certain block of text ?. ",
    "spaider88": "My fault, I didn't check it correctly. Of course CM returns line correctly but HTML was wrongly displayed (because of trying to interpret <...> as HTML tag). Sorry for troubles.. Underscore literals were introduced in Python version 3.6. Before there was no such construction. At least 'py3' should be check before '// Handle Number Literals'. https://www.python.org/dev/peps/pep-0515/. ",
    "neu1886": "I would love, but how can i integrate it by myself?. I work with the Typora Markdown-Editor. And they use CodeMirror for syntax highlight. Here is a list of supported Languages http://support.typora.io/Code-Fences-Language-Support/. At the end of the page, they wrote\n\nIf the language is not supported on http://codemirror.net/mode/, please check https://github.com/codemirror/CodeMirror/wiki/Mode-wish-list for adding syntax highlight on CodeMirror. After it is supported by CodeMirror, Typora will follow.\n\nAnd it would be very nice, if i can highlight Xojo-Sourcecode.. ",
    "mlschechter": "I'm also seeing this. The (admittedly minor) issue for us is that CodeMirror is using the same syntax highlighting for both the list syntax (when a collection of string data is passed to the step) and an example table for a scenario outline. In the example above, the first list element is unfortunate, as it looks like a column header even though it will be passed explicitly to the step.\nWe'd like to see these two modes differentiated, as the Gherkin consumption and scope of the two is markedly different - the example table is substituted into the steps in the scenario, and the list is always provided to the same step.\nThanks!. ",
    "evrial": "Trivial \u2014 disconnecting mouse and inputs look like this: http://take.ms/6h5Kd\nIf you sure that it'll break editor, maybe fix in correct place.. ",
    "connor4312": "I apologize for introducing the dreaded scourge, the Semicolon, into this pristine codebase. I have exorcised it, lint should now pass.. I may have been on 5.20.x still, I'll check when I get into the office. Yep, sorry for not getting back to you. This appears to be fixed in recent versions of CodeMirror.. ",
    "MattJustMatt": "@marijnh apologize for the tag/pressure here, although this PR is a blocker for us. Would love to get a review when you get a moment! . ",
    "rodrigomb81": "In case someone (like me a few minutes ago) ends up here with the same problem, here's a fix:\nTo make the addons you imported work you have to \"extend\" CodeMirror's type definitions. You can do this in the same file where you imported CodeMirror and its addons:\n```ts\nimport * as CodeMirror from 'codemirror'\nimport 'codemirror/addon/selection/active-line'\n// add styleActiveLine to CodeMirror.EditorConfiguration:\ndeclare module \"codemirror\" {\n    interface EditorConfiguration {\n        //  when set to true, adds 'CodeMirror-activeline' and \n        // 'CodeMirror-activeline-background' to the current line\n        styleActiveLine?: boolean;\n    }\n}\n// this doesn't cause compilation errors anymore\nconst cm = CodeMirror.fromTextArea(..., { styleActiveLine: true })\n```. ",
    "KaneGF": "```javascript\nimport * as CodeMirror from 'codemirror';\n//I've got an error:\nERROR in D:/demo/mytools/src/app/codemirror/codemirror.component.ts (2,29): Cannot find module 'codemirror'.\nBut the file is existence.  The tsconfig:javascript\n{\n  \"compilerOptions\": {\n    \"baseUrl\": \"\",\n    \"declaration\": false,\n    \"emitDecoratorMetadata\": true,\n    \"experimentalDecorators\": true,\n    \"lib\": [\"es6\", \"dom\"],\n    \"mapRoot\": \"./\",\n    \"module\": \"es6\",\n    \"moduleResolution\": \"node\",\n    \"outDir\": \"../dist/out-tsc\",\n    \"sourceMap\": true,\n    \"target\": \"es5\",\n    \"typeRoots\": [\n      \"../node_modules/@types\"\n    ]\n  }\n}\n```\n. ah, I'm back~\nI've go an idea to resolve the question of myself.\njavascript\nimport { Component, OnInit } from '@angular/core';\ndeclare var $: any;\ndeclare var CodeMirror: any; // instead of   import * as CodeMirror from 'codemirror';\ndone~. ",
    "jonhue": "This piece of css is causing it:\n* { transition: all .15s ease-in; }\nFiddle\nWhy does that impact the positioning of the linenumbers?. ",
    "farlock85": "@marijnh it's still an issue:\n\nTemplate literals are valid in ES6 not just TypeScript.\n. ",
    "zakhenry": "@yesman85 oddly the issue is somewhat more nuanced - in the example above, if you remove the return type declaration from the TS code, it is ok.\nThis does not work:\n```ts\nexport class Class2 {\n}\nexport class Class1 implements Class2 {\n    private test1(test: string): void {\n        return null;\n    }\npublic async test2(): Promise<void> {\n    console.log('destroying tables');\n\n    for (let i = 0; i < 1; i++) {\n\n        const assignment = i;\n\n        const line = `Test [${assignment}]`;\n\n        let a = 0;\n    }\n\n    console.log('another log');\n}\n\n}\n```\nBut this does:\n```js\nexport class Class2 {\n}\nexport class Class1 implements Class2 {\n    private test1(test: string): void {\n        return null;\n    }\npublic async test2() { // <------ : Promise<void> removed here\n    console.log('destroying tables');\n\n    for (let i = 0; i < 1; i++) {\n\n        const assignment = i;\n\n        const line = `Test [${assignment}]`;\n\n        let a = 0;\n    }\n\n    console.log('another log');\n}\n\n}\n```. This finding further suggests that Chrome is actually passing the wrong mode to CodeMirror. \nIn saying that, I suspect that there is still a bug with CodeMirror as removing one (but not all) of the typescript return types causes unexpected behaviour.\nIt may be that CodeMirror explicitly has undefined behaviour when displaying Typescript as Javascript though, which I suppose is ok too. ",
    "gnestor": "Thanks @minrk. Do you know of any tmpnb or jupyterhub instances that are running 4.3 that would allow @marijnh to reproduce this?. Nope, I can't reproduce in the CM examples. It's currently not affecting me in notebook 4.3 or master after downgrading CM to 5.16. 5.22.1 is not available via bower.... I just tested 5.22.2 and no luck.... I was able to isolate this bug to this commit: https://github.com/codemirror/CodeMirror/commit/e60f4b7dd88b71e227f79200932c028ca047d78e\n@marijnh Any idea why this commit would cause the insertion of single spaces to not move the cursor (and then the cursor jumps to the proper position on a subsequent space)?. @vincentwoo Does commenting out the changes in https://github.com/codemirror/CodeMirror/commit/e60f4b7dd88b71e227f79200932c028ca047d78e resolve the issue for you?. ",
    "schickling": "I see. Will there be some kind of contrib Github organization and a standartized way around using languages?. ",
    "valq7711": "It is easy to fix:\n```js\n// mode/python/python.js @379:\nindent: function(state, textAfter) {\n        if (state.tokenize != tokenBase)\n          return state.tokenize.isString ? CodeMirror.Pass : 0;\n    var scope = top(state), closing = scope.type == textAfter.charAt(0)\n    if (scope.align != null)\n     // original code is :\n     // return scope.align - (closing ? 1 : 0)\n\n     // to fix behaviour just assume that the user wants to continue typing\n     // items when lastToken is a comma:\n      return scope.align - (closing && state.lastToken !== ',' ? 1 : 0)\n    else\n      return scope.offset - (closing ? hangingIndent : 0)\n  },\n\n```\n. ",
    "mrego": "Actually it's already in a Candidate Recommendation: https://www.w3.org/TR/css-ui-3/#caret-color\nIt was marked as at-risk due to missing implementations but now both Chromium and Firefox will be shipping it very soon (~March 2017).. BTW, this has been shipped in Chrome 57 (Opera 44) and Firefox 53.. ",
    "teolag": "Yes I know that, but the functions findModeByExtension and findModeByFileName returns null with a filename ending with .svg\nOr am I doing something wrong?. Thank you for seeng my problem!\nYour commit looks great! Happy new year! . Hmm... You are right. This seems to be a thing in the browser. Can it be a bug in the implementation of flexbox or am I missing something? . Oh! Thank you @Galadirith!\nmin-width: 0 Works great!\n(0 is a unit less value and should not have px, em or any unit attached to it). ",
    "yonilerner": "Understood.. ",
    "Galadirith": "@teolag @marijnh I've also been experiencing this problem and found this\n\nBy default, flex items won\u2019t shrink below their minimum content size (the length of the longest word or fixed-size element). To change this, set the min-width or min-height property. (See \u00a74.5 Implied Minimum Size of Flex Items.)\n- www.w3.org (original source matharden)\n\nThis suggests setting min-width: 0px would fix this. However it still seems there may be an implementation bug (at least in Chrome) as setting min-width doesn't seem to work, however setting width does\ncss\n<nested-flexbox-element-selector> {\n  flex: 1 1 auto;\n  width: 0px;\n}\nHeres a couple of code pens, the first has a nested flexbox element that should scroll the overflow but doesn't (on Chrome) (http://codepen.io/Galadirith/pen/PpddBM) and heres a fix that does scroll the nested flexbox that overflows (http://codepen.io/Galadirith/pen/aJaaej). The change is on L24 of the css.\nI hope that helps.. @teolag Sorry I completely missed your fiddle. It seems in your case you can fix this with a min-width:0px on the #page element (https://jsfiddle.net/Ltcygnrt/) :D\nAnd if you apply a min-width to all parents with display: flex on the broken codepen it fixes it.. > 0 is a unit less value and should not have px, em or any unit attached to it\nThanks so much for the info @teolag I didn't know that. I'm glad the min-width worked.. ",
    "james-howard": "Thanks for the pointer. As a quick test, I disabled that CSS and can still reproduce the issue, so I suspect it's something else.. Some more investigation indicates that the issue is more complex than I initially imagined. These emoji are actually multiple emojis joined with a zero width joiner, u200d. u200d is treated as a special character by CodeMirror, so that explains why they are getting split into multiple parts. \nHowever, even if we don't treat this as a special character, it's still not enough as CodeMirror is using string length in a number of places as a proxy for editable characters, which is unfortunately a fallacy (I could be using the wrong terminology, by editable characters I mean characters that can be navigated amongst as atomic units). Even doing something like [...string].length isn't correct in the face of these zero width joined emojis, in terms of figuring out how many editable characters are in the document.\nI'm probably not going to try anymore to write a patch for this because it would be a very big change and I suspect it could have a pretty negative impact on performance even if I got it right. I've also learned that outside of Xcode, no code editors support these emojis properly, so at the least CodeMirror is in good company.. Well, at a minimum, there's a couple of places in buildToken in line/line-data.js. There may be others. I think to get it right, you'd have to get some facility for doing proper grapheme iteration in JS, and then use it religiously rather than ever using string length or iterating over characters or slicing strings directly. A lot of work, I think.. ",
    "Aloso": "I figured it out myself - the bug depends on the order in which the js files are included:\n<script type=\"text/javascript\" src=\"codemirror-5.22.0/mode/xml/xml.js\"></script>\n<script type=\"text/javascript\" src=\"codemirror-5.22.0/mode/htmlmixed/htmlmixed.js\"></script>\n\nIn this case, the editor renders XML instead of HTML. Since the difference is subtle, it's not that obvious.\nThis should be mentioned in the documentation!. Here's the code I used:\nvar myModeSpec = {\n    name: \"htmlmixed\",\n    indentUnit: 4,\n    tabSize: 4,\n    indentWithTabs: false,\n    lineNumbers: true,\n    autofocus: true\n};\n\nvar myCodeMirror = CodeMirror.fromTextArea(code, myModeSpec);.\n",
    "seth-priya": "@marijnh thanks for the response!\nI am getting the same issue on Ubuntu 14.04 (86_64), node version v7.4 and on RHEL 7.3 (ppc64le) with node version v6.2.1.\nI think I am missing something here but not sure what. I was wondering if there is a way I can debug this?\nFYI, I tried to do npm install -g node-static on one of the issues I found in their issue list and run the client (static). That seems to be coming up as expected.\nbash-4.2# static\nserving \".\" at http://127.0.0.1:8080\nThanks!. I re-confirmed that port 3000 was not in use. To re-verify, I also did a fresh install on a fresh Ubuntu 16.04 x86 VM and installed the latest npm version 7.4.0 using nvm. I still ran into the same issue.\nIn an attempt to trace this further, I tried tracing the 404 error message and added some log statements around that. Based on the analysis of the request URL from test.js, the initial issue seemed to be because codemirror.js was not being found under the lib folder. I copied it over from the src folder to the lib folder for trial purpose and the initial error was resolved. However, now the test command hangs at the following point:\nbash-4.2# npm test\n\ncodemirror@5.22.1 test /root/codemirror\nnode ./test/run.js\n\nlib/codemirror.js: The keyword 'import' is reserved (1:0)\n. Ok, thanks for the response!\nBased on this, I could figure out that I was missing something very trivial here. I was running inside a docker container, by default, as root user. The original issue was resolved after switching to a normal user and re-running npm install. Now, npm test leads to a phantomjs crash, but that at least at this point looks like an issue with phantomjs on ppc64le architecture.\nThanks again for your help. Closing this issue.\nRegards,\nPriya\n. Thanks for your response @adrianheine \nI am actually now seeing 2 failures with the current master (it was previously 1 failure for the master as well)\nThis is what I get\n\ncodemirror@5.23.0 test /home/jenkins/codemirror\nnode ./test/run.js\n\ncore_rtlMovement\nassertion failed (moved right)\ncore_move_bidi_\u00d6              \u00d2\u00d1\u00da\u00b3 \u00d3\u00a7\nassertion failed (In step 2, cursor didn't move right)\n2 failures\n{ Error: Command failed: /usr/bin/phantomjs /home/jenkins/codemirror/test/phantom_driver.js\nnpm ls is as follows\ncodemirror@5.23.0 /home/jenkins/codemirror\n+-- blint@0.5.1\n| +-- acorn@2.7.0\n| `-- nomnom@1.8.1\n|   +-- chalk@0.4.0\n|   | +-- ansi-styles@1.0.0\n|   | +-- has-color@0.1.7\n|   | `-- strip-ansi@0.1.1\n|   `-- underscore@1.6.0\n+-- node-static@0.6.0\n+-- phantomjs-prebuilt@2.1.14\n| +-- es6-promise@4.0.5\n| +-- extract-zip@1.5.0\n| | +-- concat-stream@1.5.0\n| | | +-- inherits@2.0.3\n| | | +-- readable-stream@2.0.6\n| | | | +-- core-util-is@1.0.2\n| | | | +-- isarray@1.0.0\n| | | | +-- process-nextick-args@1.0.7\n| | | | +-- string_decoder@0.10.31\n| | | | `-- util-deprecate@1.0.2\n| | | `-- typedarray@0.0.6\n| | +-- debug@0.7.4\n| | +-- mkdirp@0.5.0\n| | | `-- minimist@0.0.8\n| | `-- yauzl@2.4.1\n| |   `-- fd-slicer@1.0.1\n| |     `-- pend@1.2.0\n| +-- fs-extra@1.0.0\n| | +-- graceful-fs@4.1.11\n| | +-- jsonfile@2.4.0\n| | `-- klaw@1.3.1\n| +-- hasha@2.2.0\n| | +-- is-stream@1.1.0\n| | `-- pinkie-promise@2.0.1\n| |   `-- pinkie@2.0.4\n| +-- kew@0.7.0\n| +-- progress@1.1.8\n| +-- request@2.79.0\n| | +-- aws-sign2@0.6.0\n| | +-- aws4@1.5.0\n| | +-- caseless@0.11.0\n| | +-- combined-stream@1.0.5\n| | | `-- delayed-stream@1.0.0\n| | +-- extend@3.0.0\n| | +-- forever-agent@0.6.1\n| | +-- form-data@2.1.2\n| | | `-- asynckit@0.4.0\n| | +-- har-validator@2.0.6\n| | | +-- chalk@1.1.3\n| | | | +-- ansi-styles@2.2.1\n| | | | `-- strip-ansi@3.0.1\n| | | +-- commander@2.9.0\n| | | | `-- graceful-readlink@1.0.1\n| | | `-- is-my-json-valid@2.15.0\n| | |   +-- generate-function@2.0.0\n| | |   +-- generate-object-property@1.2.0\n| | |   | `-- is-property@1.0.2\n| | |   +-- jsonpointer@4.0.1\n| | |   `-- xtend@4.0.1\n| | +-- hawk@3.1.3\n| | | +-- boom@2.10.1\n| | | +-- cryptiles@2.0.5\n| | | +-- hoek@2.16.3\n| | | `-- sntp@1.0.9\n| | +-- http-signature@1.1.1\n| | | +-- assert-plus@0.2.0\n| | | +-- jsprim@1.3.1\n| | | | +-- extsprintf@1.0.2\n| | | | +-- json-schema@0.2.3\n| | | | `-- verror@1.3.6\n| | | `-- sshpk@1.10.2\n| | |   +-- asn1@0.2.3\n| | |   +-- assert-plus@1.0.0\n| | |   +-- bcrypt-pbkdf@1.0.1\n| | |   +-- dashdash@1.14.1\n| | |   | `-- assert-plus@1.0.0\n| | |   +-- ecc-jsbn@0.1.1\n| | |   +-- getpass@0.1.6\n| | |   | `-- assert-plus@1.0.0\n| | |   +-- jodid25519@1.0.2\n| | |   +-- jsbn@0.1.0\n| | |   `-- tweetnacl@0.14.5\n| | +-- is-typedarray@1.0.0\n| | +-- isstream@0.1.2\n| | +-- json-stringify-safe@5.0.1\n| | +-- mime-types@2.1.14\n| | | `-- mime-db@1.26.0\n| | +-- oauth-sign@0.8.2\n| | +-- qs@6.3.0\n| | +-- stringstream@0.0.5\n| | +-- tough-cookie@2.3.2\n| | | `-- punycode@1.4.1\n| | +-- tunnel-agent@0.4.3\n| | `-- uuid@3.0.1\n| +-- request-progress@2.0.1\n| | `-- throttleit@1.0.0\n| `-- which@1.2.12\n|   `-- isexe@1.1.2\n+-- rollup@0.34.13\n| `-- source-map-support@0.4.11\n|   `-- source-map@0.5.6\n+-- rollup-plugin-buble@0.15.0\n| +-- buble@0.15.2\n| | +-- acorn@3.3.0\n| | +-- acorn-jsx@3.0.1\n| | | `-- acorn@3.3.0\n| | +-- acorn-object-spread@1.0.0\n| | | `-- acorn@3.3.0\n| | +-- chalk@1.1.3\n| | | +-- ansi-styles@2.2.1\n| | | +-- escape-string-regexp@1.0.5\n| | | +-- has-ansi@2.0.0\n| | | +-- strip-ansi@3.0.1\n| | | | `-- ansi-regex@2.1.1\n| | | `-- supports-color@2.0.0\n| | +-- magic-string@0.14.0\n| | | `-- vlq@0.2.1\n| | +-- minimist@1.2.0\n| | `-- os-homedir@1.0.2\n| `-- rollup-pluginutils@1.5.2\n|   +-- estree-walker@0.2.1\n|   `-- minimatch@3.0.3\n|     `-- brace-expansion@1.1.6\n|       +-- balanced-match@0.4.2\n|       `-- concat-map@0.0.1\n`-- rollup-watch@2.5.0\n  `-- semver@5.3.0\nPlease let me know if you need any additional information. Thanks!\nPriya\n. ",
    "philipacrowe": "This causes the page to go into an infinite loop. Ive set it to 10000 and it does let the search work but there's a noticeable difference in page load speed.\n. ",
    "gaearon": "It probably doesn\u2019t help to pile on here, but here is an example of how this issue (if I understand correctly) affects GitHub editor usability.\nThis is browser search works. I press Enter and jump to the next result:\n\nThis is how CodeMirror search works inside GitHub UI. I press Enter, don\u2019t see the match, press Enter again, and now screw up the code:\n\nThe problem is that when CodeMirror scrolls to the next match, it doesn\u2019t take the editor position in the viewport into account. So the highlighted match is actually below the cut, and I don\u2019t see it.\nI also use Enter for skipping to the next result, but CodeMirror moves my selection to the match on Enter. So pressing Enter deletes the match. And since it\u2019s out of viewport, I don\u2019t even see the broken code until I further scroll down.\nSorry if this isn\u2019t helpful, or if I\u2019m barking up the wrong tree. Cheers!. >Can you reproduce that in http://codemirror.net/demo/search.html ?\nYes, if I make the window small enough so that CodeMirror div doesn't fully fit in the viewport. From CodeMirror's own point of view, it scrolls to where it needs to, but it doesn't compensate for the fact that only part of CodeMirror div is visible. \n\n\nThe CodeMirror search UI is not the browser's search UI. \n\nI understand this. Is there any reason why keyboard shortcuts don\u2019t follow browser behavior though? I can consistently navigate search results with Enter in Chrome, Firefox, and Safari. I understand these are not the same, but since it overrides a browser shortcut, it would make sense to me for it to behave consistently with another shortcut that all browsers support in the same fashion.. >Attached patch should address the scrolling issue.\nThank you for tackling this!\n\nit doesn't keep the search field focused, but puts the focus back into the editor when you search, as is often done in editors\n\nThanks for explaining the rationale. I just tried this in Sublime, Atom, and VS Code, and neither of them switched the focus to the editor on Enter in search:\n\n\n\nI respect that you might be using different editors and we might disagree on this, and won\u2019t press you further. Thank you for your work on CodeMirror!. Fair enough. It\u2019s hard to work both on the core and addons at the same time.. ",
    "kaldari": "Would it be possible to have CodeMirror render all the content, but only syntax highlight the content in view? That would enable searching, but not negatively affect performance.. @marijnh: Could you elaborate on that any? Would it not be possible to make all the dynamic features of CodeMirror optional and implement a \"highlight-only\" mode that does nothing but simple syntax highlighting?. @adrianheine: Sorry, I forgot to mention that after you go to http://commtech.wmflabs.org/w/index.php?title=Sample_page&action=edit, you have to turn CodeMirror on by clicking the highlighter button in the menubar, then insert the cursor into the editing area and hit Shift-Alt-<. That should add a '<' character into the editing window. I can reproduce in Firefox 58.0.1 on Ubuntu Linux.. Not sure, is there a generic demo anywhere that uses contenteditable? Unfortunately, I don't have time to set one up at the moment.. I can reproduce in the vim demo if I'm in insert mode (type 'i'). In Linux (shift-alt-<) it inserts a '<', on Mac (control-option-<) it word-jumps to the left. But this isn't a very good test since there aren't any inputs on that page with accesskey shortcuts, and the vim demo has its own keybindings that could be interfering with things.. ",
    "edemaine": "Unfortunately, I can confirm that this issue remains on 5.22.0.  Pressing enter goes to the next line, but then typing seems to have the effect of hitting backspace first, erasing that newline character.  This behavior didn't occur on 5.14.2 (testing on the same Android device, same setup, one day apart).  Pressing enter twice and then typing has the desired effect of entering a single newline.\nFor what it's worth, with Enter bound to newlineAndIndentContinueMarkdownList, the same error occurs, except when actually continuing a Markdown list; then enter and typing behaves as expected.. I'm pretty sure that the latest patch (bad02ce6ea740b8415955ab21301dd5a4af5260f) fixed this issue.  At least, I don't seem to be able to reproduce it on Android, on master in say demo/marker.html.. OK.  Do you have a suggested naming for the NPM package, e.g. codemirror-stex-folding?  Or would you prefer a more \"contributed\" namespace?. Ah yes, that is better.  FWIW, markdown-it could be a good model here, which has several self-owned plug-ins and several contributed plug-ins, including links to the latter.  In any case, I'll keep you posted about an NPM module in case you want to assemble a list of links somewhere.. Cool, thanks!  I'll just add to that Wiki once I get around to packaging (maybe making a section for fold-related plugins).. styleActiveLine has definitely improved on Android!  However, it still fails in this case: if I go to the end of a line (except the first, at least in demo/activeline.html), and type a character, then the character gets inserted where it should, but the cursor also gets moved to the next line (so if you kept typing, it goes on the next line).  This seems to be some kind of \"temporary\" issue, though, because repeating the process, or trying it on a different line, doesn't reproduce the error; I need to reload to get it to happen again.\nThis behavior seems localized to styleActiveLine, because it doesn't happen with e.g. demo/marker.html.. Given your failure to reproduce, I investigated further.  Looks like this behavior is localized to the SwiftKey keyboard entry.  (Both Samsung keyboard and Hacker's Keyboard didn't have this behavior.)  Not sure how to figure out what keystrokes SwiftKey is actually sending when typing a single character...\nHere are screenshots when, with SwiftKey, I click on the end of the second line, then type the letter \"x\".  (The second and third screenshots would normally have a keyboard up, but I couldn't easily take a screenshot with the keyboard up.  I also tested on trunk, which had the same behavior.)\n\n\n\n. For what it's worth, this issue remains unfixed with the popular SwiftKey Android keyboard.  You do seem to have fixed it on e.g. Samsung's keyboard though -- thanks!. Hmm, I just tested again on the codemirror.net demos, and I concur: it seems to work fine now.  Specifically, when backspacing at the beginning of a line, the keyboard disappears briefly, but comes back.\nThere may have been a SwiftKey update recently that fixed this.  Anyway, I think you can close the issue again.  Sorry for the hassle!. @hesamat Which keyboard are you using?  I just tested on SwiftKey and Gboard, and it worked fine.  Or are you talking about an actual physical/emulated keyboard?. @Elvincth Do you encounter the same issue on other keyboards, such as SwiftKey?. ",
    "RemkoNolten": "For future reference:\nI suspect I got a similar issue, but in my case it was easily fixed by using inputStyle 'textearea' instead of 'contenteditable'. \n\n. ",
    "Shade-": "If anyone's interested into live searching, here's what I've got by editing the current search addon:\nFind:\njavascript\n       persistentDialog(cm, queryDialog, q, searchNext, function(event, query) {\n        var keyName = CodeMirror.keyName(event)\n        var extra = cm.getOption('extraKeys'), cmd = (extra && extra[keyName]) || CodeMirror.keyMap[cm.getOption(\"keyMap\")][keyName]\n        if (cmd == \"findNext\" || cmd == \"findPrev\" ||\n          cmd == \"findPersistentNext\" || cmd == \"findPersistentPrev\") {\n          CodeMirror.e_stop(event);\n          startSearch(cm, getSearchState(cm), query);\n          cm.execCommand(cmd);\n        } else if (cmd == \"find\" || cmd == \"findPersistent\") {\n          CodeMirror.e_stop(event);\n          searchNext(query, event);\n        }\n      });\nReplace with:\njavascript\n      persistentDialog(cm, queryDialog, q, searchNext, function(event, query) {\n        var keyName = CodeMirror.keyName(event)\n        if (keyName != 'Enter' && query != state.queryText) {\n          startSearch(cm, state, query);\n          cm.execCommand('goLineUp');\n          state.posFrom = state.posTo = cm.getCursor();\n          findNext(cm, event.shiftKey);\n        }\n        var extra = cm.getOption('extraKeys'), cmd = (extra && extra[keyName]) || CodeMirror.keyMap[cm.getOption(\"keyMap\")][keyName]\n        if (cmd == \"findNext\" || cmd == \"findPrev\" ||\n          cmd == \"findPersistentNext\" || cmd == \"findPersistentPrev\") {\n          CodeMirror.e_stop(event);\n          startSearch(cm, getSearchState(cm), query);\n          cm.execCommand(cmd);\n        } else if (cmd == \"find\" || cmd == \"findPersistent\") {\n          CodeMirror.e_stop(event);\n          searchNext(query, event);\n        }\n      });\nFind:\njavascript\n  function persistentDialog(cm, text, deflt, onEnter, onKeyDown) {\n    cm.openDialog(text, onEnter, {\n      value: deflt,\n      selectValueOnOpen: true,\n      closeOnEnter: false,\n      onClose: function() { clearSearch(cm); },\n      onKeyDown: onKeyDown\n    });\n  }\nReplace with:\njavascript\n  function persistentDialog(cm, text, deflt, onEnter, onKeyUp) {\n    cm.openDialog(text, onEnter, {\n      value: deflt,\n      selectValueOnOpen: true,\n      closeOnEnter: false,\n      onClose: function() { clearSearch(cm); },\n      onKeyUp: onKeyUp\n    });\n  }\nIt simply changes the bound event to keyUp (so we have the actual input value) and starts searching every time a char is entered (except when clicking on the enter char \u2013 which triggers the searchNext function.. ",
    "novemember1985": "none of my sites r showing up for Android but for computer . ",
    "etamponi": "I had the same problem. The only way I could fix it is to use cm.setOption(\"inputStyle\", \"textarea\"). Unfortunately this breaks other things (like selection). My current solution is to use the input style option and a custom keyboard with arrow keys and the other special keys.. ",
    "zenorocha": "Thanks @marijnh!. Any idea when the next release will be?. Awesome!. ",
    "tolmasky": "Latest version, Safari. Sorry, 0.23.0. ",
    "geordiemhall": "No problem, have made a PR. Let me know if changes required :). Yeah if you don't need the base mode to output the property then agree that'd be better, I just wasn't familiar enough with how the modes worked to know if it was extended over the base or just a set of options passed to the base.. Either works \u2013 thanks for the quick responses too :) . ",
    "BigBlueHat": "@marijnh apologies. It is probably a better fit for the forums than this issue tracker. My bad. Thanks for the reply!. I'd also be happy to provide a similar PR for adding text/n3 and application/trig as available formats for the current text/turtle mode--as both of those formats are compatible with Turtle document highlighting and have registered media types.\nI'll make sure I'm doing it right via this commit first, though. \ud83d\ude04 Thanks!. Happy to help! Thanks for all you're building. :heart:. ",
    "calmdev": "Do you have an example repo of how that should be done? It's not clear to me, because mode files have relative paths to other modes. If I was to place the mode into a standalone repo and require it those relative paths wouldn't resolve properly. I am seeing packages on NPM with new modes that appear to be entire forks of code mirror. Ideally the mode repos would only contain source files for the actual mode, right?. Thanks guys. I'll work on setting up a repo and getting the mode published.. https://github.com/nodewrite/codemirror-mode-dust\nhttps://www.npmjs.com/package/codemirror-mode-dust. ",
    "linocatucci": "sorry, my bad.. ",
    "ianshmean": "I'm very puzzled by this bug.. Using the codemirror example, while manually typing this out the indentation is correct, but once I complete the structure, if I go back and re-format the elseif doesn't indent properly. Can you confirm that behavior?\nThe thing that puzzles me is that sometimes I get that behavior during typing the structure.. But perhaps that's linked to times when it's encapsulated in a non-complete structure . Great thanks @marijnh @pabloferz . ",
    "riverdusty": "freekin lint and stuff.. That should be easier. Not terrible for my first pull request using github, but I've learned and will try to remember. Thanks!. Could probably be better represented like,\n} else if (/[\\w_]/.test(aChar)) {\n      stream.eatWhile(/[\\w\\d_]/);\n      if(keywords.test(stream.current()){ \n      token.name = 'keyword'\n      } else if(variables.test(stream.current){\n          token.name = 'variable-2'\n      } else { token.name = 'variable' }. I'm not a JS developer by trade, but I am learning. I'll give the RegEx a shot. Basically I'm trying to find whether or not there are additional variables in a block, so [:var1 | |var2 var3| ...]. I feel like I'm in a lecture! heh. I will make a note of this and a) fix and b) not do it again!. ",
    "amller": "Mh. Something derpy happened before, wasn't able to see the License in the repo info, thus I added the headline. Seems like it was a derp on my side. Closing Pull Request again.. Seems like Github managed to handle this. Probably I was just derping when I said I derped and the merge already happened, so I could see the License in the info.\nHowever license info is now visible in repo info and sorry for the confusion. . ",
    "mafar": "I hope this helps some one who runs in similar situation.\nAs per my findings, \n\nbuilt in cm.setOption(\"fullScreen\", !cm.getOption(\"fullScreen\")); will not work when codemirror is inside jquery layout. \nHowever with jquery-fullscreen-plugin , there is a way (see the solution below). \n\nTrick is set different cm.showHint->container before and after fullscreen event.\nand thankfully cm.showHint supports it very well.\njs\nvar showHintContainer = document.body;\n  // setupCodeMirror\n  function setupCodeMirror() {\n    CodeMirror.commands.autocomplete = function(cm) {\n      cm.showHint({\n        hint: CodeMirror.hint.anyword,\n        container: showHintContainer\n      });\n    };\n    //\n    var editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n      mode: 'shell',\n      theme: 'default',\n      lineWrapping: true,\n      lineNumbers: true,\n      extraKeys: {\n        \"Ctrl-Space\": \"autocomplete\"\n      }\n    });\n    $(\"#fullscreenButton\").click(function(event) {\n      $(\"#main-container\").toggleFullScreen();\n    });\n    $(document).bind(\"fullscreenchange\", function() {\n      var fullScreenState = $(document).fullScreen() ? 'on' : 'off';\n      if (fullScreenState === 'on') {\n        showHintContainer = $(\"#main-container\").get(0);\n      } else {\n        showHintContainer = document.body;\n      }\n    });\n  }\n  // init layout\n  $('.myDiv').layout({\n    resizeWhileDragging: true,\n    resizable: true,\n    east: {\n      size: 800\n    },\n    onload_end: function() {\n      setupCodeMirror();\n    }\n  });. Great idea thanx. ",
    "ebraminio": "Do you see any other way for CM be able to implement someway for isolating bidi of cm-string and/or any other chosen elements? If so the improvement can help many different project. For example on Chrome DevTools, this is correct while viewing:\n\n(which here is its related patch)\nbut incorrect on editing, which uses CM:\n\n(original testcase is <h1 title=\"\u0645\u062a\u0646\">\u0645\u062a\u0646</h1> which is also broken on plain text but I hope we could do better on CM). No problem. Just wanted to know about the possibility. Thanks.. I think also that can be resolved if unicode-bidi is taken into consideration.. ",
    "lycifer3": "Thank you help me archive. ",
    "alexplusde": "it happens if codemirror has to display a single text line in more than one editor line, e.g.\n1 this line is not a problem\n2 this one is, because it uses more than one\n  line to display\n3 this line is not a problem, too.\nThe more lines which break, the more likely you see CodeMirror \"jumping back\" to a prior line while scrolling.. ",
    "Naereen": "Marp uses pure the gfm mode, (cf. here).\n\nDisclaimer: I am not Marp's developer, just a happy user of Marp (and CodeMirror)!. I don't see any special handling of \\$ or \\( or \\[ in gfm.js, nor in markdown.js.\n\nDoes any one know if this feature has already been added? or if this bug was already known?. I agree, but the goal of GFM mode is, as its name suggests, to mimic GitHub way of showing Markdown code, and Markdown markup inside TeX blocks are correctly escaped by GitHub.. It seems that the other thread also reached the conclusion that CodeMirror's maintainers do not care about this possible improvement of the GFM mode, that's unfortunate. :sad:. OK.. ",
    "abdonrd": "Thanks for the fix, @marijnh! When a new release? \ud83d\ude44. Thanks @adrianheine!. ",
    "samuelli": "Requesting that 81b7760 be reverted. The regex is an inverted character set match. Code mirror was actually functioning correctly. The fix actually breaks it instead.. Sorry and thanks @marijnh!. ",
    "TimvdLippe": "@marijnh Sorry for the confusion. I am a user of webcomponents.org and I was following the comment of @samuelli : https://github.com/webcomponents/webcomponents.org/issues/859#issuecomment-278497307 Therefore I encountered this issue on the website and thought that CodeMirror was the culprit. However after updating, @samuelli discovered it was not CodeMirror that was the problem, but the GitHub markdown highlighter which is ALSO used in the project. The usage of the two syntax highlighters confused us. I am very sorry for the trouble we caused you!. ",
    "reecer": "LGTM. Thanks for your efforts!. ",
    "m0sa": "You're right, I forgot to update the javascript mode file when updating CodeMirror, and I didn't know about the codemirror.net/mode/ sites to test it there.. ",
    "Enigma10": "sorry !!! .. for.my bad code. due copy and paste , i massed it up. Now edit the code. please check it again...\nall my code is working except getValue and set default of editor\nBut getValue is not working..  i am giving default value to my editor like this for above code\n```\nvar test = CodeMirror.fromTextArea(newid, {\n      mode: \"demo\",\n      lineNumbers: false,\n      lineWrapping: true,\n      value:  \"Testing value\",\n      matchBrackets:true,\n      autoCloseBrackets:true,\n    });\nconsole.log(test.getValue())\n\n}\n```\nBut Neither value showing in editor Nor in console. \n. Hi marijnh,\nI am having syntax Json file syntex.json. which i want to include in my mode js file.\nI tried to do like this.\n```\nCodeMirror.defineMode(\"mingo\", function(config, parserConfig) {\n. . . . \nvar syntex = require(syntex.json);\n. . . .\n```\nBut i am getting error that :\nrequire is not function\ni am using require.js to do this.\n. ",
    "bmass02": "After further looking into it, this is only the case when both marked texts have \"readOnly\" set to true. . Here is a gist(https://gist.github.com/bmass02/0f40a6ee3dea2236b7214bd1abedfc94) I created using CodeMirror v5.23.0 with only codemirror.js and codemirror.css. It still behaves the same. Although I did notice that the inner text does not get deleted. So maybe creating the outer marked text failed silently? Thanks for the quick response!. Alright, I did some more digging and the problem seems to come from the \"removeReadOnlyChanges\" function. When attempting to remove a section of text that starts inside an editable range but finishes past the inner marked text, there are 2 part objects returned for the failing setup and only 1 for the solution setup. I'll continue to look into exactly where the problem is.. ",
    "JensLincke": "I used your example to reproduce the issue in our context. I could track down the issue, that our component did not store the shadowRoot as root as in the line \nthis.root = this.createShadowRoot();\nthe property seemed is used by activeElt... \nJS\nfunction activeElt() {\n  var activeElement\n  try {\n    activeElement = document.activeElement\n  } catch(e) {\n    activeElement = document.body || null\n  }\n  while (activeElement && activeElement.root && activeElement.root.activeElement)\n    { activeElement = activeElement.root.activeElement }\n  return activeElement\n}\nwhich let to confusion who should has the focus when the operation ended. Maybe it would be good to also look for \"shadowRoot\", because this was very hard to track down. \n. ",
    "tscislo": "Only the newest version is affected by this? Is there any version which is\nnot affected by this issue? Thanks!\nKind regards / Pozdrawiam\nTomasz Scislo\nscislot@gmail.com\nhttp://scislo.eu\nhttp://mobilenext.scislo.eu\nOn Feb 20, 2017 20:02, \"Marijn Haverbeke\" notifications@github.com wrote:\n\nThe SASS mode started depending on the CSS mode (to get a full list of\nproperty and keyword names), so you have to make sure mode/css/css.js is\nloaded if you want to use the SASS mode.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/4592#issuecomment-281158563,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ACAvzgCx-QHBGwcyGuOBr7Icb2AVUsdJks5reeNDgaJpZM4MGfNC\n.\n. \n",
    "FeeiCN": "Thanks a lot!. ",
    "niallc": "(Who do you want to take a look? I don't know how to patch the system. I've actually never used it directly). I agree, this looks great.\nThanks!\nOn Mon, Feb 27, 2017 at 6:57 AM, mtaran-google notifications@github.com\nwrote:\n\nthe patches are generally immediately visible on the codemirror site, so\nin this case it would be at http://codemirror.net/mode/r/\nseems to work well there :)\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/4603#issuecomment-282743185,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ACQOxHaVFnIGYTUy-gEErY3xxbUhSoEBks5rguRPgaJpZM4MLgyy\n.\n. \n",
    "mjanusauskas": "The severe issue is that screen readers report the contents of the \neditor to be blank and no cursor navigation or reading of the contents \nis possible. The only thing that currently works is pressing CTRL+a to \nselect all to hear the editor contents which is not really useful.\nIt does sound like making the default contenteditable would be a major \nimprovement and step in the right direction.\nCurrently CodeMirror is simply unusable by an unfortunately large number \nof people who depend on accessibility.\nHopefully the contenteditable change will be done soon.\nOn 2/25/2017 4:09 AM, Adrian Heine n\u00e9 Lang wrote:\n\nI think @marijnh https://github.com/marijnh and I are very \ninterested in CodeMirror being accessible and useful to a broad range \nof people \u2013 supporting |contentEditable| is part of this \nhttps://bugzilla.mozilla.org/show_bug.cgi?id=919711 as far as I \nknow. Without specific funding we will not be able to address broad \nsuggestions such as this, though. If there are specific, easy-to-solve \nissues, we might be able to fix them on the go.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub \nhttps://github.com/codemirror/CodeMirror/issues/4604#issuecomment-282474334, \nor mute the thread \nhttps://github.com/notifications/unsubscribe-auth/APDp4pASGsBGoRzBtunrmoQQ9jfcQyWLks5rf_3sgaJpZM4MLxEz.\n\n\n. @schanzer Thank you for the work you have been doing and for contributing back so many more can benefit from your work. While perhaps not easy, it is certain that incorporating accessibility from the beginning of a design is the best solution to avoiding the far more difficult work of trying to add it in later.. ",
    "Neurrone": "Any estimates on roughly how much funding would be required to fund resolution of this issue?. ",
    "westonruter": "@adrianheine The WordPress project is looking at integrating CodeMirror into core (see https://github.com/WordPress/codemirror-wp). Given that WordPress puts a high importance on accessibility, there must be interest among the community in funding any needed accessibility improvements as well as funding ongoing maintenance.. I believe this is advised in https://github.com/codemirror/CodeMirror/issues/4198#issuecomment-242700776. Should this be aria-owns or aria-controls or aria-labelledby instead of aria-label? . Then in the case of an extension wanting to add a custom rule to HTMLHint or other linters that get imported, the two other options I see would be:\n1) Include extensions in the build, keeping everything private. This won't be feasible for 3rd-party plugins.\n2) Expose the HTMLHint the object on CodeMirror for plugins to extend.\nIn the second case, it could look like doing the following after calling CodeMirror.registerHelper(\"lint\", \"html\", \u2026 ):\njs\nCodeMirror.lint.html.HTMLHint = HTMLHint;\nThen in WordPress, for example, a plugin could do:\njs\nCodeMirror.lint.html.HTMLHint.addRule( /* \u2026 */ );\nThoughts?. I just found something that may add weight for opting for a global window.HTMLHint: the HTMLHint library itself will require('jshint') and require('csslint'). Because of this, private copies of both JSHint and CSSLint will be present in the browserified CodeMirror bundle and will be used by the HTMLHint rules for jshint and csslint, whereas CodeMirror's lint addons for JS and CSS will use the separate copies on the window object. \nNevertheless, I've found a solution to continue opting for window.HTMLHint even when bundling via the browserify-shim module.\n\nMany of the linters aren't distributed as CommonJS, so they use globals because they have no choice.\n\nIt seems that for JSHint, CSSLint, and JSONLint that these available on NPM as CommonJS modules and could be updated to use what CodeMirror is doing for HTMLHint if that is the desired path instead of relying on globals.. > Couldn't those plugins simply also require it?\nNot really, because the CodeMirror bundle would be shipping with core. A plugin would ship with its own assets and it would not be able to rebuild the bundle that is in core. If a plugin were to require the codemirror assets as part of its own build process and then replace the bundle that is enqueued in core, this is a possibility. However, it would mean only one plugin at a time would be able to extend CodeMirror in this way, since each plugin would be competing to override the core bundle of CodeMirror with their own extended bundles.\n\nI agree. Want to submit a pull request?\n\nI would, but I won't be able to for some time. If someone else wants to contribute this I'm happy if they do.. @adrianheine I'm not seeing any improvement. The same issue still happens in Chrome and Firefox.\nI've spun up a test WordPress site with the latest master for CodeMirror (8f35a1a). I've created WP admin user accounts for both you and @marijnh to be able to see the issue firsthand. You should have received credentials via Git commit author details; your WordPress usernames same as on GitHub.\nDirect URL to the WordPress core CSS editor which shows the issue: http://trac-41900-xwp-testbed.pantheonsite.io/wp-admin/customize.php?autofocus[section]=custom_css\nIn both Chrome and Firefox, the initial click into the editor causes the cursor to be set as active outside the viewport. A second click after the editor is already focuses causes the cursor to appear in the expected spot. In Firefox the initial editor focus click is causing the cursor to go to line 51, whereas in Chrome the initial click is causing the cursor to go to line 49.\nUnminified JavaScript bundle for CodeMirror: http://trac-41900-xwp-testbed.pantheonsite.io/wp-includes/js/codemirror/codemirror.js?ver=5.29.1-alpha-8f35a1a. @adrianheine yes, I suspect it might have something to do with how CodeMirror is embedded in an element that has absolute positioning that was animated into place. But even if I have it defer initialization until after the container element has been fully animated into place, the problem persists.. @adrianheine We found the problematic code (props @afercia):\njs\neditor.on( 'focus', function() {\n  editor.refresh();\n});\nNow, first of all we probably are going to remove this from WordPress (update: I removed in r41582), so we may not need to fix this issue for the sake of core, but nevertheless there would seem to be a bug in CodeMirror with calling the refresh() method when focusing on an editor that has a inputStyle=contenteditable.\nHere is a minimal example: https://jsfiddle.net/westonruter/enf71znt/. ",
    "jasonday": "\nWithout specific funding we will not be able to address broad suggestions such as this, though.\n\nI understand that it will take some work, but choosing to do nothing is actively excluding an entire group of people. The accessibility dev community would likely get involved if an effort was identified. \n. @marijnh & @adrianheine - \nPotential approach to establish a baseline level of accessibility for CodeMirror:\nNotes:\n- I haven't fully tested these approaches, as there are some complex things happening with the textarea within the CodeMirror js\n- Screenreader only content approach\nApproach:\n- Create option for including checkbox to toggle CodeMirror instance for the textarea (formatting only - keeping apis, etc. intact) \n- Or include the checkbox (non-configurable) and hide it offscreen making it available for screenreader users, but not sighted ( I would argue that the option is beneficial for all, not just screenreader users)\n-Any edit to the textarea or CodeMirror instance should update the other\ndemo: https://codepen.io/jasonday/pen/gXdeLm\n(checkbox could live in a little settings drop in the upper right)\n. ",
    "QuincyLarson": "@marijnh This issue is really important to the freeCodeCamp.org community, which has many members who have visual impairments or are completely blind. Is there anything we can do to help with this?. Sorry - I created this on the entirely wrong repository accidentally. Please disregard.. ",
    "sfbayhacker": "Appreciate your comment @adrianheine. Would you be able to point out the common use case(s) for a broader regular expression based approach? This is only to educate myself.. @adrianheine Ah, OK. Thanks. Appreciate you letting me know.. ",
    "legion80": "They could be included, but I'm unsure about how wide support there is across browsers for those values at the moment. system-ui I know is available in Chrome and Safari.. ",
    "microkof": "Thank you, I had post a question, but nobody help me. May I request you to answer this question? Or motify the manual to detail that code about RequireJS? e.g.: Assume the project restores at '/codemirror/', the directory structure according to the zip file http://codemirror.net/codemirror.zip , and then how to use RequireJS to load CodeMirror? Please detail that code, thankyou very much!. ",
    "crazy4chrissi": "Ok sorry, I will fix these.. Thanks for your review. I will try to do a test case and add it to meta.js. Regarding getting the mode: I did it the same way as  function getKeywords(editor) in the same file does. So then this should be adjusted there as well I think?\nfunction getKeywords(editor) {\n    var mode = editor.doc.modeOption;\n    if (mode === \"sql\") mode = \"text/x-sql\";\n    return CodeMirror.resolveMode(mode).keywords;\n  }\n. Thank you. I will do like this. I am currently looking at the sql-hint-tests.js and if I am not mistaken it has some problems. This test does not fail:\ntest(\"keywords2\", {\n    value: \"SEA\",\n    cursor: Pos(0, 3),\n    list: [\"SELECT\"],\n    from: Pos(0, 0),\n    to: Pos(0, 3)\n  });\nThe only change I did from the original keywords test is to change SEL to SEA. Shouldn't this complain that \"SELECT\" is not in the list of autocompletion as required by the test keywords2?. Thank you. I will do like this. I am currently looking at the sql-hint-tests.js and if I am not mistaken it has some problems. This test does not fail:\ntest(\"keywords2\", {\n    value: \"SEA\",\n    cursor: Pos(0, 3),\n    list: [\"SELECT\"],\n    from: Pos(0, 0),\n    to: Pos(0, 3)\n  });\nThe only change I did from the original keywords test is to change SEL to SEA. Shouldn't this complain that \"SELECT\" is not in the list of autocompletion as required by the test keywords2?. Ok all done, anything else?. I am sorry. I cannot reproduce this. I just did a fresh clone and only exchanged the test/sql-hint-test.js.\n- ran bin/lint without problems\n- continuous-integration does not report any problem\n- npm test says \"All passed\", but this was also the case when tests should fail!?\n- test/index.html reports that 1 test called core_lineWidgetsfails, but this is the same with a fresh clone and seems to be unrelated to my tests\nCan you please explain where you found syntax errors and which test is failing for you?. Okay you are right, but I still don't get it why nothing on my side nor the continuous-integration check complained about the syntax error.  Attached you will find exactly what I did:\ntest.txt\nI just saw that Firefox complains about the syntax error in the console when running the test/index.html. So next time I should look there as well....\nAnyway. I will soon commit a fix of the tests. . Great thank you for all your great work. I am going to integrate CodeMirror into phpLiteAdmin, a web-based GUI to manage SQLite databases. Therefore, I need good highlighting of SQLite in CodeMirror.. (continuous-integration fails because this pull request introduces two new tests regarding bugs that it does not fix yet). Haha, okay. I can't believe the phpMyAdmin developers use codemirror with sql-hint and don't bother about such issues. Anyway, I will try to fix the other two issues. But it will take more time I guess because I need to better understand the way the hinter works to find where the problem is.\nMaybe you can already merge the fixes provided in this pull request without the failing tests. Then I will create a new pull request once the other 2 are fixed.. ",
    "mce2": "Unfortunately this fix does not solve the problem completely. I faced the same problem, and it appears that in contenteditable mode selection cannot be longer than approximately 40 lines (with default viewportMargin). When I press Ctrl-A with a long text, the whole text gets selected (I can copy it and paste elsewhere), but only first lines can be higlighted, and if initial scroll position is not in the beginning of the document, selection is invisible.. Yes, my test case works fine now! Thanks!. Sorry, I'm new to git and GitHub. Here it is: https://github.com/codemirror/CodeMirror/pull/4670. ",
    "diegogvieira": "Please, consider this issue:\nhttps://github.com/codemirror/CodeMirror/issues/4712\nI already have a working code, I just do not know how to submit my changes.\nThanks. You also needs to replace the previousWord logics. Because It was being updated with space, \\n caracters and tabs. Here:\nif (wordUpperCase !== CONS.ALIAS_KEYWORD\n&& word !== ''\n&& word !== ' '\n&& word !== '\\n'\n&& word !== '\\r\\n')\npreviousWord = word;\nprevious word should ignore anything like spaces, tabs and newlines.\nI also intend to modify the autocomplete which show columns from tables. When you press some key, it does not filter. When done, I will post changes.. I will do more tests until tomorrow, sorry for the delay.. Code above Works better. \nI found a situation where we may improve: \nsql\nselect a.col_A, b.\nfrom    table1 a\n            inner join\n        (select table2.other_columns1 as outterColumn from table2) as b\nIn the situation above, pressing dot after b does not bring autocomplete. it should show b.outterColumn. ",
    "axellew": "I have now reverted all changes to StringStream.js and addressed the indentation problems in the soy mode instead.. It's just not visible in the diff, there is still one line left using lineStart:\nsol() {return this.pos == this.lineStart}\nThere is only one more mode using hideFirstChars, but it doesn't have any test cases so I'm not quite sure how just changing \"sol() {return this.pos == this.lineStart}\" to \"sol() {return this.pos == 0}\" would impact that mode, so I added hideIndentation.. I can't see any difference in the pug mode when changing sol() to \"sol() {return this.pos == 0}\" and looking through the code I can't see anything which should be affected, but I can't say I'm very familiar with the pug syntax or how which test cases would a be a good fit. \nAnother solution is adding this to the soy mode, where it eats indentation before entering the inner mode to set it to the correct stream position:\n  if (stream.sol()) {\n    for (var indentEaten = 0; indentEaten < state.indent; indentEaten++) {\n      if (!stream.eat(/\\s/)) break;\n    }\n    if (indentEaten > 0) return null;\n  }\n\n. ",
    "shawnajean": "\nCan you reproduce the issue in the demos on http://codemirror.net ?\n\nWe were not able to repro on codemirror.net, but checking in with our developers led us to file here. We do use the contentEditable inputStyle on GitHub, which I forgot to mention in my initial comment.\n\nDo you know the precise text that Nodepad++ puts on the clipboard?\n\nI don't, so I've asked my teammate who was able to repro this to chime in here, as I personally don't have Windows.. Thanks for the bump! We recently updated the version of CodeMirror on GitHub and we haven't been able to repro since. We've asked the reporting user to let us know if this is still an issue for them, but haven't heard back yet.\nI'll close this out since it seems to be resolved!. ",
    "coolziroonezero": "\n]( #http://coolziro.com). coolziro. [. \n",
    "afercia": "Thanks @marijnh !. Sorry to bother but this should be reverted. The aria-label property takes a string (not an ID) that should be the name of the textarea. It basically works like a <label> element, and gives the textarea a name.\nInstead, aria-labelledby takes an ID and it's handy when a visible element already present in the page can be referenced as \"name\" of a form control.\nThus, aria-label should be a name that identifies the purpose of the textarea. Since the textarea can be used for anything, I'm afraid there isn't a name that covers all the possible uses. Maybe, consider to pass the aria-label value from the config so users can set a meaningful name that fits their use case.\nFor reference, making screen readers announce the textarea ID is not so useful:\n\n. Worth noting, authors can always use a standard <label> element to give the textarea a name:\n<label for=\"demotext\">Edit your code</label>. ",
    "ZhennanWu": "Just here to confirm the state of this issue. As @edemaine has pointed out, if you delete across lines, then the keyboard will disappear and reopen.\nSuch behavior has been confirmed with\nAndroid P + Chrome 71.0.3578.99 (latest as of Dec/25/2018) + Gboard/Swiftkey\nGboard version: 7.8.7.224352916 Updated on Dec 10 2018\nSwiftKey version: 7.1.9.24 Updated on Dec 5 2018\n(Strangely enough, Hacker's Keyboard works fine.)\nThe impact of this behavior: makes continuous backspacing across multiple lines impossible, because it always will be interrupted at every line break. After each interruption, you have to release and re-press the button, otherwise the closed-and-reopened keyboard won't react anymore.\nIs such behavior going to be fixed or a wontfix?. ",
    "GreatEarl": "Ok, thank you. Now it is clear. Actually, I need to select all editor content and auto-indent it programmatically. Is it mentioned in Programming API? \nupd. I found it.. ",
    "nunos7": "I use codemirror to show and copy blocks of html and javascript code.\nIn this case i need to load that block of html from a file...\nIn my other cases i use this:\n<form><textarea><div class=\"demo\">hello world!</div></textarea></form>\nBut here i need to load the code from a template page.\nhttp://codemirror.net/doc/manual.html#fromTextArea\n$('.demo-codemirror-textarea').each(function () {\n                            CodeMirror.fromTextArea(this, {\n                                mode: mixedMode,\n                                lineNumbers: false,\n                                readOnly: true\n                            });\n                        });\n. Problem solved... \nMy template was saved with Unicode (UTF-8 with signature) - Codepage 65001, i changed to Unicode (UTF-8 without signature) - Codepage 65001 and that's it.. ",
    "dev-talha-akbar": "Ah, sorry for the code indentation e.t.c.\nIf we are in any HTML tag,\nset isDefault to false, set inTag to true.\nisDefault is boolean & false because, I want to run my added behavior which further checks the attributes for a specific attribute and switch the mode.\ninTag is boolean because, I don't wanna know what tag it is (we need any truth value).\nIf we are in an HTML tag but it is that specific tag which was provided in tags option from CodeMirror instance,\nset isDefault to true, set inTag to the tag we're in (a string, again, truth value, valuable for conditions)\nisDefaultis boolean & true because, this time, we will run the code that was originally written by you to switch mode.\ninTag is a string so, we can find associated mode to switch to from tags option.\nI came across this problem for Codemirror because where I work at, the developers used to work alot in the style attribute tweaking styles. I thought it might help. I ain't good and it's posted so, someone can improve on this and integrate it into CM.. ",
    "phuongkt": ".. Let me take experence. .. ",
    "htank-wang": "I have need blur disabled editor scroll event and  focus enable scroll event\nDo you have a good solution\uff1f. ",
    "thehogfather": "The issue was mine. The ch: property of Pos that I passed into cm.getModeAt was undefined. Consequently, the mode returned for the given lines were not what I expected (i.e., line 3 in the example above returned mode css instead of xml.\nClosing. Thanks for the quick feedback.. ",
    "chemseddineZ": "editor is bound to CodeMirror.fromTextArea as in the code \nvar editor = CodeMirror.fromTextArea(document.getElementById('editor'), { lineNumbers :true, indentUnit: 4, matchBrackets: true });\n. even when i try editor.setValue() it fails with error saying \n\nTypeError: editor.setValue is not a function. \n",
    "Jiaojunjun": "but null is not effective. @marijnh I search the codemirror 5.13.2 library, there is no null or native file. resolved, change the .CodeMirror-scroll overflow to hidden.. ",
    "MariasStory": "Hi,\nMaybe someone else is interested in this feature?\nGreetings.. ",
    "blgm": "Thanks @marijnh.  I've created a fiddle with the fix: https://jsfiddle.net/xgh9dwoo/1/, and can confirm that the expected behavior now occurs.. ",
    "cb-hari": "I have specified mode options for both instances seperately rite?. ",
    "rsz2040": "The one right here on github\nhttps://github.com/codemirror/CodeMirror\nGreen button on the upper right \"Clone or download\",  click on it, then at the bottom of the little dropdown \"Download Zip\"  link.\n\n. ",
    "mkobit": "My fault! @marijnh where would I find that? Would it make sense to add an issue template so others don't make the same mistake I did?. ",
    "zhaoyi0113": "I am reading the manual from here: https://codemirror.net/doc/manual.html#addon_lint. And whether there is an example on how to use it? . The from and to don't work as expected. For example, if I type db and trigger the auto-completion popup, it will show the popup after the cursor. When I select one item from the popup list, the selected text will be inserted at the cursor. When i need is to replace the db word with the selected text. If I change the from to be 2 positions ahead of the current cursor, the popup doesn't show at all and the db characters are removed immediately.. Yes I didn't change to. I just minus the from.ch by 2. Below is the code I am using. You can see that the curWord is the one I need to replace. I minus the from.ch by the length of curWord. But after doing this, the popup doesn't show and the curWord is removed from editor.\nconst cursor = cm.getDoc().getCursor();\n          cursor.ch -= curWord.length;\n          const options = {\n            hint() {\n              return {\n                to: cm.getDoc().getCursor(),\n                from: cursor,\n                list: res\n              };\n            },\n          };\n          cm.showHint(options);. what is the correct way to do that?. Thanks it works. Regarding to your first reply, The render method (as well as displayText) goes into the individual items. Could you give me an example to explain what does go into the individual items mean? I have a lot requirements on auto-complete and want to understand how to make use of all code mirror features. But the manual only gives an API explanation doesn't give an example on that.  . ",
    "Maloric": "In my case I have restyled the dialog with position:fixed so that it is attached to the top of the view port rather than the top of the editor.  This was mainly because if the search matched something on line 1, the dialog would obscure it.\nSurely the use case I mentioned merits consideration?  Our users will often want to copy/paste from a separate window.  While I recognise that it is possible to copy the text beforehand, it still leads to a frustrating user experience that is easily remedied by a config setting that is entirely optional.\nAt the end of the day it's your product and if I need to maintain my own copy then so be it.. ",
    "chaopeng": "Also we will use this 2 flags to enable overlay scrollbar. --enable-overlay-scrollbar --enable-prefer-compositing-to-lcd-text. What is wrong with zeroWidth?\nIt set pointer-events none when we enabled overlay scrollbar. That makes scrollbar not draggable.. Yes, we have some different with Mac-Overlay-Scrollbar. Mouse near or hover will not fade out the scrollbar. It only fade out when mouse move far from scrollbar.. Do they handle pointer events on the whole bar, or only the handle? \nThe whole bar.\nWhat if the user wants to interact with the content under it?\nNeed to move mouse far from scrollbar.. move mouse far away then scrollbar fade out then you can interact with it.. No. we don't.. 1. Maybe we can enable custom scrollbar on ChromeOS since we will only make overlay scrollbar by default on CrOS soon.\n2. I think the fake scrollbar not really improve the scroll proformance. At least on Chrome, the fake scrollbar will make the scroll happends on main thread not cc thread.. There is a spec for scrollbar gutter. But no browser support it at this time. https://drafts.csswg.org/css-overflow/#scollbar-gutter-property. Yes, The Linux with flag \"--enable-overlay-scrollbar --enable-prefer-compositing-to-lcd-text\" will have same behavious with ChromeOS. It works better now. Still have some issue, I'll work on it. Thank you.. ",
    "AasmaGarg": "While debugging I found that, in CodeMirror.js SetSelection was not getting called. And the reason was the time difference between dragEnd and dragStart is more than 200 ms in leftButtonStartDrag function.. ",
    "kultuk": "is there a way for it to be supported?. ",
    "andreasciamanna": "If I'm seeing right, this commit is included in 5.25.2, but the issue is still present.. ",
    "t-mullen": "Moving to the help forum, my bad.. ",
    "NickMcNutt": "I would just like to point out that I'm pretty sure you're the fastest bug responder ever.  Thanks!. ",
    "JanOonk": "There are special testcases to be tested for example:\n\"SELECT o. FROM Plant p,offerte o\"\n\"SELECT p. FROM Plant \np,offerte o\"\n\"SELECT p. FROM Plant \np,offerte o\"\nAfter the point use ctrl-space.\nIn my test findings below code works best:\n``javascript\nfunction eachWord(lineText, f) {    \n    if (!lineText) return;    \n    var excepted = /[,;]/g;    \n    lineText=lineText.replace(excepted, ' ');    \n    var words = lineText.split(/\\s+/);    \n    for (var i = 0; i < words.length; i++) {     \n      if (words[i]) f(words[i]);    \n    }  \n  }. Second thought, I guess this function behaves likes this for a reason. Never mind this \"issue\". Don't know how to delete this issue so closing it. Back to the discussion forum.. I found a workaround. If you change the inputStyle to \"textarea\" it works (even without the workaround code above)!\nThis bug is maybe related to #5415, #5405\nBy the way I could not find any information on inputStyle and the differences between textarea and contenteditable besides:\n\ninputStyle: string\n    Selects the way CodeMirror handles input and focus. The core library defines the \"textarea\" and \"contenteditable\" input models. On mobile browsers, the default is \"contenteditable\". On desktop browsers, the default is \"textarea\". Support for IME and screen readers is better in the \"contenteditable\" model. The intention is to make it the default on modern desktop browsers in the future.\"\n. \n",
    "joel-porquet": "FYI, just submitted https://www.npmjs.com/package/codemirror-markdown-list-autoindent for those who would be interested in using this patch ;). ",
    "PatrickMevia": "well coud be, blinking is also there, i dont see any patch, i am connected to latest github repo and problem is still there, and not just for me.. ",
    "nomad5": "@HelgeSverre When I use this it only works when the page's scroll is at the top. When the page is scrolled down even just a little the drop location is incorrect, it goes some lines above where the drop was intended. It seems to drop further upwards the more the page is scrolled down. . ",
    "eshvedai": "I'm thinking about using https://github.com/github/linguist as a backend service for language detection. It allows us to parse the string, split it into tokens and classify the languages. I wonder if there is a similar functionality in CodeMirror that I could use to detect the language on client side.. ",
    "gaokunbuaa": "Great. This patch works very well for me.\nThanks a lot.. ",
    "flouc001": "Hmm I wonder what could be setting the update to be forced. Yes that's how I have hacked around it for the time being.. ",
    "LetItRock": "Hello @marijnh, \nYeah I thought about that and I did console.log inside that \"simplescrollbars.js\" addon and also inside \"codemirror.js\", so everything was called. . Yes, you was right, it is somehow called twice, one time from \"webpack\" and second from \"node_modules\". \nI will investigate what is going on. Thanks a lot for your help.\n\n. ",
    "will-russell": "@LetItRock Did you find a resolution for this when using in webpack (2.0)?. ",
    "jesusvimlet": "Same issue for me.\n. ",
    "danostrowski": "Thanks for the reply!\nOK, so you would do something like CodeMirror.on(result, 'signal', function(...)) ?\nI can definitely do this, but this seems different than how other .on signal handling is for most of CodeMirror? At least it's not very obvious and I'm wondering if this needs to be in the documentation somewhere? . Ah, OK, you're right it is, apologies. It says...\n\nThe following events will be fired on the completions object during completion\n\nIt's just very quickly mentioned and \"completions object\" is what's referenced above as:\n\nand return a {list, from, to} object, \n\nThis all makes sense if you understand how the plugin works, but the documentation is pretty spartan and the \"example\" demo isn't very informative.\nI got confused because the mention was so brief and the documentation for signals for CM is all referencing events from the editor.. ",
    "grg2rsr": "Experiencing the same, Dell XPS 13 with Ubuntu 17.04. The bug is visible in the official demo, chromium 60.0.3112.113. Firefox 55.0.2 runs fine. @xlambein , do you by any chance have the same laptop (or same touchpad)?\nxinput --list gives\n\u23a1 Virtual core pointer                      id=2    [master pointer  (3)]\n\u239c   \u21b3 Virtual core XTEST pointer                id=4    [slave  pointer  (2)]\n\u239c   \u21b3 ELAN Touchscreen                          id=10   [slave  pointer  (2)]\n\u239c   \u21b3 DLL0704:01 06CB:76AE Touchpad             id=12   [slave  pointer  (2)]. I can confirm that this is related to horizontal two finger scroll. Deactivating it via synclient HorizTwoFingerScroll=0 leads to smooth scrolling in the codemirror demo. ",
    "xlambein": "Yup I have that one exactly.. ",
    "dhrubomoy": "@marijnh The issue also occurs in Chrome (on iPad).. ",
    "FAIG2014": "I am not sure I understand how this project is structured.\neach new languages will be in a different repo?\n. ",
    "NetworkNode": "Done.\nI'm not that familiar with this test framework, so please tell me if I did anything wrong or un-idiomatic.. ",
    "amcdnl": "@marijnh - this is what i was looking for. thank you!. ",
    "zTree": "Sorry, I'm not exactly describing it.\nif set readOnly = \u2018nocursor',  the issue in my Android is:\n\n\nyou can copy the highlight line.\n\n\nyou can't copy multiple lines.\n\n\nIf there is hightlight line in codemirror, you only copy this line, even you select the other line by long-press.\n\n\ntest html:\n```\n<!DOCTYPE HTML>\n\nCodeMirror: Theme Demo\n\n\n\n\n\n\n\n\n        .CodeMirror {\n            border: 1px solid black;\n            font-size: 13px\n        }\n    \n\n\n\nDemo\n\nfunction findSequence(goal) {\n  function find(start, history) {\n    if (start == goal)\n      return history;\n    else if (start > goal)\n      return null;\n    else\n      return find(start + 5, \"(\" + history + \" + 5)\") ||\n             find(start * 3, \"(\" + history + \" * 3)\");\n  }\n  return find(1, \"1\");\n}\n\n\n        var editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n            lineNumbers: true,\n            styleActiveLine: true,\n            matchBrackets: true,\n            readOnly: 'nocursor'\n        });\n    \n\n\n\n```. @lee2seek \nI solve this issue by this method:\n\nset readOnly = 'nocursor'\ncm.on('copy', (cm, e) => {\n    // ignore copy by codemirror.  and will copy by browser\n    e.codemirrorIgnore = true;\n});. @Heanes  Thanks.\n\nI'm so sorry.  I later modified it several times to solve the problem. But forgot to submit a solution.\nIn my project:\n\n\nif client is phone, I set  readOnly = 'nocursor';\n\n\nif client is pc, I set  readOnly = true;\n\n\nAfter init CodeMirror, add this code :\n```\ncm.on('copy', (cm, e) => {\n    // ignore copy by codemirror.  and will copy by browser\n    e.codemirrorIgnore = true;\n});\n\n\n// if you don't need to show the cursor, please add css:\n.CodeMirror-cursors {\n    visibility: hidden !important;\n}\n```\n. ",
    "Heanes": "@zTree \nI tried your method, but it doesn't seem to work\n\nset readOnly = 'nocursor'\ncm.on('copy', (cm, e) => {\n    // ignore copy by codemirror.  and will copy by browser\n    e.codemirrorIgnore = true;\n});\n\nbecause when you set readOnly = 'nocursor', the copy event will not fire when type ctrl + C or Command + C. . @zTree Thanks a lot, it's helpful.\nNow I think it's wrong logic on codemirror as the copy event would not fire when set readOnly = 'nocursor'. So I decided to write a bit of code and ask for a pull request.\ud83d\ude02\ud83d\ude02\n. ",
    "KyleMcNutt": "@marijnh I mean, that it would be nice to have hg be a highlighted command in the shell.js mode. @marijnh Opened PR #4764 to address this. ",
    "IrinaGlushanok": "Ok. Thank you for your reply!. Hi! I've tried it in Chrome 59 and it works well.. ",
    "shantamg": "I haven't tried a contenteditable HTML input, but if I paste into VIM, everything looks like plain text except for the empty lines which VIM shows as <200b>. And, for what it's worth, if I paste it into this very text field everything looks fine but I can tell that the zero width space is there because when I move the cursor with the arrow keys it takes an extra keystroke to get past that point.. ",
    "mattheworiordan": "\nUpdate: Are these snippets rendered on the client or pre-rendered? @mattheworiordan\n\n@adrianheine sorry for my lack of response, I had an email rule some time back that mistakenly deleted notifications :(\nThe snippets are rendered on the client.\n\nIt seems this issue is still affecting people, and not just people who use Xcode sadly. See https://twitter.com/PutMionyourteam/status/1023223425165352960.  When copying and pasting this code into vue.js templates, the zero-width space is causing vue.js to bomb out.  \nDoes anyone know what the motivation for using a zero-width space as opposed to say a non-breaking space is within CodeMirror?\nFor reference, when looking at the hex translation of a unicode zero-width space, it's:\n0xe2 0x80 0x8b\nFor a non-breaking space, it's just a space:\n0x20. Thanks for your response @marijnh \n\nIt has zero width.\n\nWell sure, I realise that is what it is technically called.  However, why the need for a zero-width character when it does not render as zero-width when selected anyway.  See below example with the zero-width &#8203; character compared with a &nbsp; character.  Clearly the non breaking char is wider, but the zero-width one is definitely not zero-width.\n\n\nAs I mentioned before, these are in the DOM, but there should be a clear separation between what's in the DOM and what you get when you copy the text (where CodeMirror's copy handler gives you a nice, clean textual representation of the selected content).\n\nOk, certainly sounds like that's the right approach.\n\nAre you doing something like setting the editor to readOnly: \"nocursor\"\n\nYes, would you mind explaining why that is an issue?  In the docs it states:\n\n\nIf the special value \"nocursor\" is given (instead of simply true), focusing of the editor is also disallowed.'\n\n\nI did a git blame to work out when this was introduced, and it seems our devs used this setting from the start in 2015.  I'd love to understand why this setting is an issue if you wouldn't mind explaining.\nI tried changing it on a local dev version of the rendered Code, and it made no difference.\n\nor selecting across it when copying?\n\nWell no, I don't think people are copying across, but they are selecting part of the content.  They are copying & pasting the code they require, not the entire code block.  See example below with readOnly: true.\n\n\nIf so, yes, you will likely get an effect like this, but there's unfortunately no good way to override the copied text for some DOM content\n\nWell we could just &nbsp; in place of zero-width characters in the rendered DOM, and the problem would be solved.  This could just be a setting perhaps to enabled / disable this feature.\n\nyou can only override the entire copy event, and CodeMirror only does that when it is focused.\n\nOk, not really sure what can be done then on our side :(\nFYI. In the mean time, I am now running a selector to find these offending spans and manually replace them with non-breaking space spans.  Not ideal, but I believe this will work in the short term.  I'll get the affected user to confirm.\n. Thanks again @marijnh \n\nIf you go to the online demos on codemirror.net, you'll see that the problem doesn't occur there.\n\nI have, and I don't see any read-only demos.  We use codemirror exclusively to render code as part of our page, not for editing, so our use case is perhaps not \"standard\".  \n\n\nNot ideal, but I believe this will work in the short term.\n\nUnlikely. This'll cause all kinds of problems\u2014the editor does not support random DOM mutations in the content it rendered.\n\nWell it does work for us, because as above, we only use CodeMirror for rendering and styling code, not for editing, so the obvious complications related to modifying the DOM for editable code is not a problem.. Oooh, that looks interesting.  I'll raise an issue in our backlog and see if we can do a spike to see if we can swap that out.\nThanks!. ",
    "viridium": "I'm starting to see a pattern of quick rejection of my tickets. That is not constructive. If you don't like my suggestions, I'm going to stop making them.\nThe question was the wrong way to go. A bug is the better way, because this is a feature request. I realized this after writing the suggestions; I'm sorry the world isn't perfect\u2026. Except that:\n- readOnly acts on the whole text\n- readOnly doesn't allow you to edit any of the text\n. I see. I've just tested it, and, with readOnly, the marked text cannot be removed.. How so? If I double-click any word in any browser or OS, the prevailing intuition is that it gets selected. Why would it not make sense for a lot of the markers? Why would marked text get in the way of that? Aren't atomic markings words for all practical purposes?. What is an example such a context where putting the cursor at the end of the marker instead of selecting the marker is the better approach? I'd like to leave this bug behind convinced. :). A few remarks and questions:\n\n\nIs moving the cursor to the end of the placeholder, versus hiding the cursor or extending a selection over the item, really the better choice in that case?\n\n\nIs that really the more common situation, or is it a fringe situation?\n\n\nThe current behavior needn't be removed: both behaviors can be supported, with one the default and one hidden behind an option.\n\n\n. I'm not stuck on changing the default. But the requested behavior is also general enough, so providing it out of the box hidden behind an option sounds reasonable to me.. ",
    "Ashamandi": "Yes, right that`s what I meant. Yes, you are right. we should add a custom normalization function for that I will try to implement it as npm package, is it will be ok?. No, It will work for one char no need for its context and about your second question yes we need to apply normalization on both regexp and plain strings.. > I don't understand this question\u2014why do you need to normalize before you start searching?\nwhat I think about is normalizing both search input and the whole doc to put them into same char shaping before start searching so the searching can detect all matches \nas an example :\n\nWhat I imagine solving that is \n1- Normalize search input \u0623\u064a\u0647 to \"\u0627\u064a\u0647\"\n2- Normalize the whole doc so all its 4 words will be converted to \"\u0627\u064a\u0647\" as well\n3- Run searching function \nthe output will be as shown before.\nbut when I applied it on noFold and doFold only this didn`t solve the problem, the normalization done but not all matches detected\n. > Can we start by landing this change just for the search cursor, and then look into the highlighting issue separately?\nSure ... no problem for that.\n\nThe code looks good except that you're turning off case- and unicode-normalization when there's Arabic in the string. \n\nSorry didn`t get what you mean here, Do you mean that you prefer chars instead of its unicodes like that \n```\n//Normalization for Arabic\n  var normalizeArabicChars = function (s) {\n    function filter(c) {\n      switch (c) {\n      // ALEF Chars\n      case '\u0625' :\n      case '\u0623' :\n      case '\u0622' :\n      case '\u0675' :\n      case '\u0673' :\n      case '\u0672' :\n      case '\u0671' :\n        return '\u0627'\n           .\n           .\n      default :\n        return c\n    }\n. ooooh ... I got what you mean, so I think there is no need to check isArabic before applying the normalization\nif (String.prototype.normalize) {\n    doFold = function(str) { return normalizeArabicChars(str.normalize(\"NFD\").toLowerCase()) }\n    noFold = function(str) { return normalizeArabicChars(str.normalize(\"NFD\")) }\n```\nWill it be okey?. > Does the problem you are trying to solve also occur with diacritics encoded as separate characters (for example \\u0654 \"hamza above\")? \nNo, my problem is limited to some chars that are considered equaled but has different Unicode chars\nand these chars are AL-ALEF, AL-TAA AL-MARBOTA and AL-YAA.\nand if we talk about Al-ALEF as an example:   \u0627, \u0623 , \u0622, \u0625 ,.. we found that all the previous ALEF shapes should be detected when searching for any one of them. \nin the same way when we take about TAAA MARBOTA and YAA different shapes.\n. Thanks for comment .... yes, you are right, it seems that when I converted each Unicode into its char I added a space by mistake .... sorry for that.\nAbout normalize(\"NFD\"), Actually I tested it but it didn`t work , but for sure if you test it, I can remove this case to reduce checks.. ",
    "activeperception": "```javascript\nCodeMirror.defineSimpleMode(\"simplemode\", {\n  start: [\n     // highlight numbers divisible by 7 \n    {regex: /\\d+/, token: (match) => match[0]%7==0 ? 'divisible-by-seven'},\n     // highlight plural and singular words differently \n    {regex: /\\w+/, token: (match) => {\n        if (externalLib.isWordPlural(match[0]))\n             return 'plural'; \n        return 'singular'\n        }\n    },\n]})\n```\nThe example is a bit lame but it should give you the idea.\nOne further improvement would be for the function to return the tuple [match, list-of-token-string], instead of token-string only, so that you can modify the match found by stream.match. \nIt could be very useful for example to split the match further and return multiple tokens, one for each new part. (a bit like you do now when you have regex with multiple capturing groups)\nFor example\n```javascript\n     // highlight word stems and rest of word differently\n     {regex: /\\w+/, token: (match) => {\n        var [stem, rest] = externalLibrary.stemWord(match[0]);\n        // not sure if just pushing is enough, maybe we have to add more info like starting indexes and length of matches like an regexp.match would do\n        match[0] = stem;\n        match.push(rest);\n        return [match, ['stem', 'rest-of-word']];\n        }\n    },\n````\n. Yes! \ud83d\udc4d . ",
    "alzuniga": "I've tested it in both Google Chrome and Firefox on both Mac and Windows.\nThe square character(s) appear for a brief moment when minimizing or maximizing the editors, after which everything displays normal again.\nSteps to reproduce:\n1.  Enter some HTML markup in the HTML editor.\n2. Minimize the panel using the yellow minimize button.\n  - for a brief moment the square character(s) will appear in the editor.\n3. Maximize the HTML panel using the green maximize button. \n  -  for a brief moment the square character(s) will appear in the editor along with the markup,  then disappears.. ",
    "llamerr": "From what I can see it's \\f066 from \n.fa-compress:before {\n    content: \"\\f066\";\n}. ",
    "saadataz": "Hey @marijnh. Thanks for the response.\nI am using Angular2 (using Zonejs) with webpack. Looking at the heap snapshot, I am seeing detached DOM nodes appended to memoryText eventually referenced by window resize callback even though code mirror has been removed from DOM. I was hoping if there is a destroy method to clean up these global listeners\n\n. \n@marijnh Looks like its the callback arrow function keeping the reference of its context.\n@vincentwoo I cannot remove the eventlistener unless I have reference of the callback (which is anonymous). Wont this chain of calls keep the reference of CodeMirror instance?\nCodeMirror -> ensureGlobalHandlers -> registerGlobalHandlers -> on resize event handler (arrow function). ",
    "ZhangPingFan": "@saadataz How did you solve this problem finally\uff1fI found the same problem when I use vue with webpack and I can see the heap grows everytime I refresh the Chrome.It seems to be related to module in es6 or using as components?Cuz I find it would not happen when I use codemirror by including it in the page.. ",
    "fwielstra": "That makes sense now you mention it; I had the same problem with Angular. In my situation I have an app which depends on a library (my codemirror component) via a symlink. I can fix that. I've removed the codemirror dependency from the 'app'. I really need to figure out how to properly develop an includeable TS / Angular module. Thanks!. ",
    "gfredericks": "@mickael-kerjean did you ever publish this? I would like to use it.. ",
    "ryanpcmcquen": "Could one of these libraries help?\nhttps://github.com/daitangio/org-mode-parser\nhttps://github.com/mooz/org-js. @gfredericks it is here: https://github.com/mickael-kerjean/nuage. ",
    "Announcement": "Oh. \n~~~ html\n<!doctype html>\n~~~\nSorry for the troubles!. ",
    "mzabuawala": "Yes, I am using 'pgsql' only, Please refer my CodeMirror definition,\nhttp://imgur.com/a/z7ED0. Github is redirecting on wrong URL, Please check: http://imgur.com/a/z7ED0. It has been fixed with latest pull.. We are using our python web app on Qt WebEngine 5.8.. Okay, Thanks.. Hi,\nI am able to open link in previous post,\nI have uploaded it on another website as well, check https://imgur.com/a/Nmvsb \nI also checked indentUnit and tabSize both are set to 4.. Thanks a lot for your time that solved my issue,  I was missing indentWithTabs option.\nAnd Sorry for the noise.. Ok, found the issue.\nCulprit code:\n```\nindentUnit: \"4\",\ntabSize: \"4\",\n```\nCorrect code:\n```\nindentUnit: 4,\ntabSize: 4,\n```\n. ",
    "tynopet": "I try to replace HTML regex in handlePhraseModifier function:\n/(:?\\/)?(\\w+)(?:[^>]+)?>(?:[^<]+<\\/\\1>)?/,\nbut textile tests failed, because with my regex codemirror wrapped each tag to span with cm-comment tag. \nPlease tell me this is the correct behavior, or not?. ",
    "carueda": "No worries at all!  --- thanks for the super quick fix  (... and for this awesome lib, btw!). ",
    "Pantalaim0n": "Just tested this, and yes, it also occurs on dragging a selection of text.. Only for CodeMirror text. Dragging text from outside CodeMirror into its container, the clipboard is not affected.\n. ",
    "toddself": "\nCaught me by surprise for a second!. ",
    "ageback": "Yes I did. But npm install did not generate \\lib\\CodeMirror.js.. node-v6.11.0-x64.msi\nnpm -version get 3.10.10. Well, I upgrade to node-v8.1.3-x64.msi instead. And now npm install can build the target file. Also npm test runs OK.. ",
    "kasperfred": "I expected it not to change scroll position if the cursor will be visible with current view region on focus. . 1. User is focused on the editor, and writes something. \n2. User unfocuses editor by clicking off and explores the surrounding UI.\n3. User begins to read what they have written, and scrolls down. \n4. User spots a mistake, and want to correct it.\n5. User clicks on the text where they want to edit expecting the cursor to move into view.\n6. User is confused because the scroll position is updated when they click even though it didn't have to.\nExplanatory GIF:\n\n(The selection is because I was clicking too slow, so it moved the viewport while I was holding down the left mouse button)\nNote: This only happens when the previous cursor position (at the time user defocused) is outside the current view region.\n. No. I think it's because it uses its own scroll system. \nI don't know if it makes a difference, but I have set the scrollbar option to \"native\".. ",
    "jacargentina": "Sorry, it works; sure was not binding the handler right.. ",
    "hacdias": "Hi @marijnh! Thanks, anyway. If I manage to make it work, I'll just leave a post here and explain how.. So I created something like a wrapper around CodeMirror and instead of importing CodeMirror directly, I import this file:\n```javascript\n// Most of the code from this file comes from:\n// https://github.com/codemirror/CodeMirror/blob/master/addon/mode/loadmode.js\nimport * as CodeMirror from 'codemirror'\n// Make CodeMirror available globally so the modes' can register themselves.\nwindow.CodeMirror = CodeMirror\nif (!CodeMirror.modeURL) CodeMirror.modeURL = '../mode/%N/%N.js'\nvar loading = {}\nfunction splitCallback (cont, n) {\n  var countDown = n\n  return function () {\n    if (--countDown === 0) cont()\n  }\n}\nfunction ensureDeps (mode, cont) {\n  var deps = CodeMirror.modes[mode].dependencies\n  if (!deps) return cont()\n  var missing = []\n  for (var i = 0; i < deps.length; ++i) {\n    if (!CodeMirror.modes.hasOwnProperty(deps[i])) missing.push(deps[i])\n  }\n  if (!missing.length) return cont()\n  var split = splitCallback(cont, missing.length)\n  for (i = 0; i < missing.length; ++i) CodeMirror.requireMode(missing[i], split)\n}\nCodeMirror.requireMode = function (mode, cont) {\n  if (typeof mode !== 'string') mode = mode.name\n  if (CodeMirror.modes.hasOwnProperty(mode)) return ensureDeps(mode, cont)\n  if (loading.hasOwnProperty(mode)) return loading[mode].push(cont)\nvar file = CodeMirror.modeURL.replace(/%N/g, mode)\nvar script = document.createElement('script')\n  script.src = file\n  var others = document.getElementsByTagName('script')[0]\n  var list = loading[mode] = [cont]\nCodeMirror.on(script, 'load', function () {\n    ensureDeps(mode, function () {\n      for (var i = 0; i < list.length; ++i) listi\n    })\n  })\nothers.parentNode.insertBefore(script, others)\n}\nCodeMirror.autoLoadMode = function (instance, mode) {\n  if (CodeMirror.modes.hasOwnProperty(mode)) return\nCodeMirror.requireMode(mode, function () {\n    instance.setOption('mode', instance.getOption('mode'))\n  })\n}\nexport default CodeMirror\n```. Hey @tony! I'm using it on this project. It's all open source.. Hey @Jocs! I used the function above ^^ . ",
    "tony": "@hacdias I'm interested in seeing what the entirety (to the extent possible) of what your webpack looks like when it loads codemirror / dependencies. Is that something you're willing to share?\nI've even looked through GH search, Having quite the struggle finding an up to date webpack config example with CodeMirror.\nBest. Way to go posting that \ud83d\udc4d @hacdias . ",
    "Jocs": "@hacdias Have you solved this problem? i also run into this issue.. @hacdias 3q\n\ud83d\ude04 . @asethiya Do you solve this problem?. ",
    "Niharika29": "I'm facing a similar issue and wondering if there's a config option to allow CodeMirror to leave the cursor movement up to the browser? . Oh, thanks for that. I'll npm build it then. . I noticed there is a ~3 years old 'direction' branch of code. Do you think it'll work better? I can try to rebase, if so.. That'd be great, @adrianheine. Thank you. \n. ",
    "danilaml": "@pabloferz Btw, is there a reason for in not to be included in keywords? (for i in 1:42 ...). @pabloferz thanks for answering! Was confused since here it's referred as the alternative (but fully equivalent) keyword in or \u2208. ",
    "jasonsun0310": "I think so, too. struct is a recently added keyword to Julia to replace type. Perhaps code mirror didn't update this change in time.. ",
    "PradeepPsudo": "Hi, \nI am working with object oriented JavaScript.\nIs it possible to pass Object to server.addDoc(fileName,fileContent) function instead of String in the place of fileContent parameter.\nKindly help me with this.\n. ",
    "jishi9": "Actually Sublime text has different shortcuts for different OS'es.\nThe following documentation pages:\nhttps://www.sublimetext.com/docs/2/multiple_selection_with_the_keyboard.html\nhttps://www.sublimetext.com/docs/3/multiple_selection_with_the_keyboard.html\nclaim that the shortcuts are:\nWindows/Linux: Ctrl+Alt+\u2b06 and Ctrl+Alt+\u2b07\nMac: \u2303+\u21e7+\u2b06 and \u2303+\u21e7+\u2b07\nBut this is actually incorrect for linux. If you download a copy of sublime from https://www.sublimetext.com/3  (e.g. 64 bit tarball for linux), and unzip the file ./Packages/Default.sublime-package , you will find the following default shortcuts:\n./Default (Linux).sublime-keymap:   { \"keys\": [\"alt+shift+up\"], \"command\": \"select_lines\", \"args\": {\"forward\": false} },\n./Default (Linux).sublime-keymap:   { \"keys\": [\"alt+shift+down\"], \"command\": \"select_lines\", \"args\": {\"forward\": true} },\n./Default (Windows).sublime-keymap: { \"keys\": [\"ctrl+alt+up\"], \"command\": \"select_lines\", \"args\": {\"forward\": false} },\n./Default (Windows).sublime-keymap: { \"keys\": [\"ctrl+alt+down\"], \"command\": \"select_lines\", \"args\": {\"forward\": true} },\n./Default (OSX).sublime-keymap: { \"keys\": [\"ctrl+shift+up\"], \"command\": \"select_lines\", \"args\": {\"forward\": false} },\n./Default (OSX).sublime-keymap: { \"keys\": [\"ctrl+shift+down\"], \"command\": \"select_lines\", \"args\": {\"forward\": true} },\n. ",
    "tylerlong": "Dual scroll bar issue:\n\nOther themes don't have this issue. . ",
    "javisperez": "Hey @dwelle ! \ud83d\udc4bThanks for this update, I'm trying to implement the replace-emoji-markup-with-actual-emoji part, do you have any help on how to replace the text on the mode itself? my idea so far is to read all lines on the content, match everything between : (e.g. :thinking_face:) and replace it with the proper unicode character, but that sounds slow.\nIs there anyway to replace the text when the token is matched? like, token by token?. Thanks @dwelle yeah, i imagined the mode limitations but I didn't know you could actually scan only what's been written from the change event, will dig a bit more into that as my first idea was to use regexp to match emoji \"names\" and replace the whole content, which sounds like not ideal for me. \nThank you for the tip, any other tip is more than welcome :)\nHave a great day!. Have the same problem. Also happens withequal characters (=). Did you find any fix @michaelgmcd ?\neg.\n**I'm bold**\n===\nNot header. ",
    "anjaliwalke11": "@marijnh : Thank you so much Marijn!! It is working for me. +1. \nHence closing this issue. \nThanks.. ",
    "684sigma": "\nIf you want control over the place of the line number gutter\n\nI don't want to have any customization of that kind, I want it to work exactly as you intended, but it seems there's still a misunderstanding. Example.\n1 Open https://codemirror.net/demo/folding.html\n2 Execute editor.setOption(\"lineNumbers\",false); //disable line numbers in web console\n3 Execute editor.setOption(\"lineNumbers\",true); //enable line numbers in web console\nSo, before I changed line numbers option, line numbers were placed before dropmarkers, but then the order changed.\nPlease confirm that after toggling line numbers twice gutters should change their order.\nAlso, if codemirror instance initially created without line numbers, and later they were enabled, line numbers appear after dropmarker. Please confirm that it is intended order of gutters.. I see, it works as intended. Bug 1381523 is completely on Firefox side.\nIt seems that codemirror doesn't have or care about any \"default\" order of gutters. Just saying, to avoid mistakes of codemirror users (like Bug 1381523), it would be nice to have a warning about the actual behavior in the manual:\nhttps://codemirror.net/doc/manual.html#option_lineNumbers\nFor example:\n\nBefore enabling line numbers, make sure that you specified correct order of gutters, using gutters option. (If \"CodeMirror-linenumbers\" isn't listed, it will default to be to the right of all other gutters). \n",
    "nijel": "Good point, changed to messageHTML.. Thanks, that was fast!. ",
    "dev-drprasad": "Sorry my mistake :disappointed: . Thanks for pointing it out.. ",
    "b32": "Perhaps I used a bad example and I should have included the exact snippet we are having issues with, as it is part of a multiplexor mode that we wrote.  In our template language, we use {{ for opening tags  and  }} for closing tags.  Within these tags we allow the closing tag as long as it is part of a string.  Would it be possible for us to ignore quoted or nested closing tags?\nOur snippet:\n{{ out(\u2018{{=price_usd}}\u2019)\n\nOn Jul 21, 2017, at 5:25 PM, Marijn Haverbeke notifications@github.com wrote:\nHave you tried running that script in a browser? The browser will also end the  tag at the first  it sees, regardless of whether that's in a string or comment or whatever, so at least in the case of script tags, the behavior you are reporting is the correct behavior.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub https://github.com/codemirror/CodeMirror/issues/4867#issuecomment-317116219, or mute the thread https://github.com/notifications/unsubscribe-auth/AGLKCGq6aPDTBgokcd4FauA77WqKo86zks5sQRdXgaJpZM4Ofmzf.\n\n\n. ",
    "EverNewJoy": "Forum:\nhttps://discuss.codemirror.net/t/thank-you-for-code-mirror/1319\n\u2665\nRama. ",
    "wilzbach": "\nI also added a test in 5ed2e78\n\nNice. Thanks a lot!\nPretty impressive response time. Keep up the good work!. ",
    "barrucadu": "Ok, that's a good point.  We'll just set !important then.. ",
    "0x4c6565": "After stripping this down, I've managed to find the issue - my bad! Apologies for wasting your time.. ",
    "yesnault": "\".v\" is attached to two mime, but one mode only: verilog. PR updated, I add sv and svh only for SystemVerilog. ",
    "tomerm": "@amirbrans FYI.. @wajnberg thanks for fixing. Based on the comments in PR it looks like the fix for this issue will be available with CodeMirror 5.29.0 (expected to be released in Aug 2017). . Thanks, @wajnberg.  @amirbrans FYI.. ",
    "wajnberg": "@TOMERM FYI. Hello @marijnh \nI removed the rtl class following your advice.\nCould you please review ?\nThank  you. Hello @marijnh ,\nYou are right. Sorry I didn't notice that. I made the change you requested.\nCould you please review ?\nThank you. Hello @marijnh ,\nThank you very much for having merged this change\nCould you please tell me in which CodeMirror release this fix would be available?\nThank you. ",
    "tovic": "So the problem was on the overlay mode. Sorry \ud83d\ude2d\n. ",
    "tcederquist": "I think better form might be to have a \\ to trail the line indicating line continuation. It works either way in modern shells but using this \\ form is more syntax correct I think - and the the shell mode works as expected in codemirror.\n echo 'hello \\\n there' > file.txt. I'm switching the ng-show/ng-hide back on and refreshing the contents since it was a linked doc that may have changed. However, when I switch back into diff mode, it calls the same MergeView constructor shown in my code again which after tracing the code creates a 'new MergeView' on the first line in the constructor. As such it appears, none of the events are recycled, new ones are created. I've tried to recycle the old MergeView assigned to 'dv' by apply a new option set but it does not redraw correctly (might just need to use a similar repaint if I can get a reference to the codemirror instances) but not able to make that work yet.\n\nThe removal of the elements in the dom with the innerHTML call may remove the dom objects but not the event hooks so the code stays in memory and continues to get called. Such are the woes of the spa I think.. ng-show/hide is angular translation of hidden css. \nTo try out your thoughts on gc I added logic to set the innerhtml to empty when it switches back to normal view instead of just hiding. I also confirmed the dom elements are deleted (chrome inspect on the dom node for split window). Unfortunately, the hooks stay in place even after the dom segment is destroyed. Here is the best reference I can find at the moment for the issue, I suspect 2 or 4 might be involved after a quick review of the merge.js logic (or I've done something very wrong in my own code which I keep reviewing). https://auth0.com/blog/four-types-of-leaks-in-your-javascript-code-and-how-to-get-rid-of-them/\nThe web reference isn't meant negatively, I just didn't trust my interpretation of issues I've had with my own code, I find I'm constantly struggling with leaks, spa probably still not being too common. The issue may still be in my logic so I'm still digging looking for any references I may have to anything inside the merge view. However, I pretty much just turn it on and link the codeviewer doc and nothing else (this is my next theory and looking for ways to destroy the codeview doc as I keep it and just reset the generation, maybe I need to delete the doc and start over for each load of new code). I can use the ide I've built for hours without issue, as soon as I invoke the merge view it starts adding merge.js hooks for nearly each occurrence. I think its trying to diff unrelated docs which is why I found it as it takes a while to determine two large documents have nothing in common * x instances.\nI'll try to break away later today, another large deliverable to knock out, and then I'll try to put together an online sample to try to isolate this further as I really don't want to waste your time if this is my issue. I love the features and support! Best editor out there imho. Once I get an actual customer, I'll be sharing some dosh.. Yes, running the chrome's application rendering profiler I can see the long delay in releasing the main codemirror editor to use when loading new code into the main codemirror doc are due to the merge.js events listed at the opening comment ('call stack of the issue' comment). It can have as many as 6 or 7 separate identical hooks fire in series if I've opened diff a number of times (each typically slows it down a little more). At this point the page is too sluggish and I just refresh the page and start again. These don't show up again until I start using the diff view.\nhttps://developers.google.com/web/tools/chrome-devtools/rendering-tools/\n. \nA quick snapshot of a single instance I tested after the dom was deleted.. \nA quick one after opening a few code items with diff and then closing them. This is the record of loading a new document (without diff active) into the main codemirror editor.. Agreed, that's why I'm guessing now perhaps it might be the shared doc? I can't think of anything else at this point.\n  value: $scope.codeEditor.linkedDoc({sharedHist:true}),\n\nSince I keep this linked doc inside the main codemirror editor and just clean it up when I load a new document, perhaps merge won't let go as this doc object survives all the updates (cleaned out and reset generations to clean up undo history). An unload method or at least a way to break the link to the doc in merge might solve this kind of issue? Is there a better way to load a new document into a codemirror instance? (I use one main and one diff two panel set, neither are shown at the same time, the doc is actually part of the main instance, mapped into the diff panel set when needed). In case someone stumbles on this from google, here is a code extract of the solution @marijnh pointed me at:\nvar ed = $scope.diffDv.editor();    // Stored from the call $scope.diffDv = CodeMirror.MergeView(target, {...\nvar doc = ed.getDoc();\ndoc.iterLinkedDocs((ldoc, shared)=>{ // Iterate over all the linked docs to remove and cleanup the event hooks\n    console.log(\"unlinking doc:\", ldoc);\n    doc.unlinkDoc(ldoc);\n});.\n",
    "fabiospampinato": "Looks good, but I'm also using the search addon, which uses dialogs, not panels. I still need to edit it if I always want to use a panel. \nI wish there was an easier way of doing this.. I actually haven't found any issue of that sort with my setup, I'm positioning the dialog with position: fixed and moving .CodeMirror-scroll down a bit with CSS, this is feasible only because the dialogs I'm using always have the same height.\nYou're right, shifting the content down might look like an annoyance, but what if a match for something I'm searching is in that first line currently hidden below the dialog? IMHO that would be more annoying.. ",
    "ChristianGruen": "Thanks for both merging the code and hinting me at the CI tests.. There are actually no such keywords in XQuery. In XQuery 3.1, annotations exist (%private, %public, %updating), but I think these are not considered so far in the highlighter.. ",
    "cjiang": "Sorry, the above examples had a misplaced 'const' and were thus invalid typescript. Replacing them with 'readonly' fixes the issue.. ",
    "droidenator": "@marijnh thanks! I'll start looking into that. . I managed to resolve this issue and just wanted to post a quick update to help anyone else who may be struggling with something similar.\nLike @marijnh suggested, it was a result of my mode scripts not being fully loaded. I was able to find out what modes had loaded by inspecting CodeMirror.modes. In my case, htmlmixed had three dependencies which had not finished loading. \nMy solution was to get a list of dependencies for htmlmixed and then use setInterval to check for their presence in CodeMirror.modes. . ",
    "strongrex2001": "It seemed that the IME on the phone doesn't Fire an Backspace Event.\nI overrided dispatchKeyEvent in my Activity, and it just didn't catch the Backspace..... What's the solution..? Maybe it works for me too... I overrided the onCreateInputConnection function in the WebView now and it works... but when I call the function the soft keyboard disappears... I'm trying some other methods to avoid this. I use a variable in Java to record how many times backspace pressed but haven't been processed, and every 50milliseconds in Javascript fetch the variable and process the backspace event.\nNow All Right! Thanks!. I'm sorry to reopen this... But I've met an unbelievable bug... Today every time I pressed backspace it deleted two characters... I've overrided createinputconnection... I don't know how this could happen. emm\u2026\u2026Okay\u2026\u2026. InputConnectionWrapper works strangely on Android 7+ Devices\u2026\u2026 I'm using an virtual Backspace Button on the page now\u2026\u2026. ",
    "scipper": "Yes, of course bundling diff_match_patch makes sense. That's what I did. But merge.js is expecting diff_match_patch to be global, and the expose of it is done after every requirement is resolved. \nan alternative to my pull request might be to call:\nedit\nvar diff_match_patch = require('diff-match-patch'); var dmp = new diff_match_patch();\nThat would be the proper way of handling bundles libs, IMO.. that sounds like a good solution for now. I will fix this.. Thanks! . Can you tell, when I might expect a new release? :). ",
    "saulcosta": "Unfortunately it's a customer reported issue and video. However, our customers are reporting that the issue appears to be resolved, so I'll close this ticket for now, and update with a non-Flash based video if it reoccurs.. ",
    "Aaronius": "Thank you so much for this! I just ran into this and am so glad to see support has been added.. ",
    "glittle": "Thanks for the ZIP file. Where would I find that? I've looked over the website and could not find any link to download the zip.\nAhh, finally found it: \"Get the current version: 5.29.0.\" \nMight be nice to tweak that wording. Somehow include the word \"distribution\" or \"download\"!  It would be fine split the two functions of that line into two locations... a link to download and a display of the version number. \nI also totally missed the word \"Download\" in the graphic... didn't know it was clickable, and wondered what \"Download Fund\" meant!. ",
    "chocholand": "@marijnh I want to remove scrollbar, so I add style.\n.CodeMirror-scroll {\n    height: auto;\n    position: static;\n    padding: 0;\n    margin: 0;\n    overflow-y: hidden !important;\n    overflow-x: hidden !important;\n  }\nIs there another anything to remove scrollbar?. ",
    "blittle": "@marijnh sure, I'll work out a PR in the next few days.. Fixed with https://github.com/codemirror/CodeMirror/commit/e716c17e3bdfd10da477d92bd3fa2fb66cabbaa1. LGTM, Thank you!. @adrianheine thank you for the response, I'll make the change.. @adrianheine the PR is updated. I thought that already happens here: https://github.com/blittle/CodeMirror/blob/2f4ba2ea190b6994be98e35b00e5b9dd7fbb7521/addon/edit/matchbrackets.js#L124. Also note, we have tested this code and are running a fork in prod until CodeMirror is fixed.. I might need to be doing a this.removeKeyMap before this.addKeyMap. ",
    "ssanaul": "@westonruter The label is derived from the id of the old textarea, which is hidden by CodeMirror. \naria-labelledby is meant for indicating a visual relationship between a label and form component, so it doesn't apply in this case. \naria-controls would indicate to a screen reader that keyboard focus could be moved to the hidden textarea, but input should really go into the newly generated textarea. \nSimilarly, aria-owns would indicate that the new textarea is a parent of the old textarea, when really, it replaces it (visually, at least, which is what we're concerned with).. @marjinh Ah, yes- that's much cleaner.. ",
    "jongund": "I would like to see three labeling options supported by codemirror.  Note only one of these options should be used for a form control, they are not all needed and using more than one labeling technique for the same form control is considered an authoring error.\n\nAdd an explicit label using by passing in a string to generate aria-label=\"label text\" on the visible textarea.\nAdd a reference from a <label for=\"id_label1\">label text</label> and the visible textarea now has id=\"id_label1\"\nAdd a reference to some text on the page using that has a ID and the visible textarea would have aria-labelledby=\"id_text1\". \n",
    "gbui": "Should this line be changed as well?\nhttps://github.com/codemirror/CodeMirror/blob/2cff704fd44f418eae599ae05ac1547cc8c5e3fa/mode/markdown/markdown.js#L406\nPerhaps to this:\n````javascript\nvar taskOpen = stream.match(taskListRE, true)[1].toUpperCase() !== \"X\"; \n````\n(Sorry, I know I said \"should only require RegEx changes\"). ",
    "ThomasAtome": "On browser there is no stack trace, and it close the browser inspector..\nI have some stacktrace from the app, if it can help you :\n```\nSep 12 12:10:00 iPad rhorunner(UIKit)[1108] : Unable to simultaneously satisfy constraints.\n    Probably at least one of the constraints in the following list is one you don't want. \n    Try this: \n        (1) look at each constraint and try to figure out which you don't expect; \n        (2) find the code that added the unwanted constraint or constraints and fix it. \n(\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"UILayoutGuide:0x170193180'UIViewLayoutMarginsGuide'   (active, names: '|':_UIButtonBarStackView:0x12fa099d0 )>\",\n    \"\"\n)\nWill attempt to recover by breaking constraint \n= 34   (active)>\nMake a symbolic breakpoint at UIViewAlertForUnsatisfiableConstraints to catch this in the debugger.\nThe methods in the UIConstraintBasedLayoutDebugging category on UIView listed in  may also be helpful.\nSep 12 12:10:00 iPad rhorunner(UIKit)[1108] : Unable to simultaneously satisfy constraints.\n    Probably at least one of the constraints in the following list is one you don't want. \n    Try this: \n        (1) look at each constraint and try to figure out which you don't expect; \n        (2) find the code that added the unwanted constraint or constraints and fix it. \n(\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"UILayoutGuide:0x170193180'UIViewLayoutMarginsGuide'   (active, names: '|':_UIButtonBarStackView:0x12fa099d0 )>\",\n    \"\"\n)\nWill attempt to recover by breaking constraint \n= 34   (active)>\nMake a symbolic breakpoint at UIViewAlertForUnsatisfiableConstraints to catch this in the debugger.\nThe methods in the UIConstraintBasedLayoutDebugging category on UIView listed in  may also be helpful.\nSep 12 12:10:00 iPad rhorunner(UIKit)[1108] : Unable to simultaneously satisfy constraints.\n    Probably at least one of the constraints in the following list is one you don't want. \n    Try this: \n        (1) look at each constraint and try to figure out which you don't expect; \n        (2) find the code that added the unwanted constraint or constraints and fix it. \n(\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"= 34   (active)>\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"UILayoutGuide:0x170193180'UIViewLayoutMarginsGuide'   (active, names: '|':_UIButtonBarStackView:0x12fa099d0 )>\",\n    \"\"\n)\nWill attempt to recover by breaking constraint \n= 34   (active)>\nMake a symbolic breakpoint at UIViewAlertForUnsatisfiableConstraints to catch this in the debugger.\nThe methods in the UIConstraintBasedLayoutDebugging category on UIView listed in  may also be helpful.\nSep 12 12:10:00 iPad rhorunner[1108] : I 09/12/2017 12:10:00:161 6e89f000            EVE DEBUG| Ruby Stats - travel duration = 14ms, processing = 0ms\nSep 12 12:10:00 iPad rhorunner[1108] : I 09/12/2017 12:10:00:163 6e89f000            EVE DEBUG| Wait for messages\nSep 12 12:10:00 iPad rhorunner(UIKit)[1108] : Unable to simultaneously satisfy constraints.\n    Probably at least one of the constraints in the following list is one you don't want. \n    Try this: \n        (1) look at each constraint and try to figure out which you don't expect; \n        (2) find the code that added the unwanted constraint or constraints and fix it. \n(\n    \"\",\n    \"UILayoutGuide:0x170192b00'UIViewLayoutMarginsGuide'   (active, names: '|':_UIButtonBarStackView:0x12ddf1c60 )>\",\n    \"\"\n)\nWill attempt to recover by breaking constraint \n\nMake a symbolic breakpoint at UIViewAlertForUnsatisfiableConstraints to catch this in the debugger.\nThe methods in the UIConstraintBasedLayoutDebugging category on UIView listed in  may also be helpful.\nSep 12 12:10:00 iPad rhorunner[1108] : I 09/12/2017 12:10:00:167 6e28b000            EVE DEBUG| Compute state duration for 1 objects : 0ms\nSep 12 12:10:00 iPad rhorunner(UIKit)[1108] : Unable to simultaneously satisfy constraints.\n    Probably at least one of the constraints in the following list is one you don't want. \n    Try this: \n        (1) look at each constraint and try to figure out which you don't expect; \n        (2) find the code that added the unwanted constraint or constraints and fix it. \n(\n    \"\",\n    \"UILayoutGuide:0x170193180'UIViewLayoutMarginsGuide'   (active, names: '|':_UIButtonBarStackView:0x12fa099d0 )>\",\n    \"\"\n)\nWill attempt to recover by breaking constraint \n\nMake a symbolic breakpoint at UIViewAlertForUnsatisfiableConstraints to catch this in the debugger.\nThe methods in the UIConstraintBasedLayoutDebugging category on UIView listed in  may also be helpful.\n```. Well, i try to remove code mirror of my app and just use a simple text area, and there is no problem, but when I add code mirror in my app, the app crash..\nBut in all case, in codemirror demo, back quote and ^ char, reload the page of the browser with a bad message. ",
    "ParthKolekar": "4967 Fixes this issue. . This issue is incorrect. Please feel free to close this issue.\nOn Thu, Sep 14, 2017, 02:02 Marijn Haverbeke notifications@github.com\nwrote:\n\nI don't think the PR is correct (see comment there), but maybe we can\napproximate this by requiring at least one number in the hash? (Letter-only\nhashes exist, of course, but are relatively rare -- 0.1% of\nseven-character-hashes)\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/4966#issuecomment-329392363,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AGFgDkQSPTbFKfJbRET_jY0mPDkKwhnMks5siM9_gaJpZM4PW_hc\n.\n. Oh. Apparently github has this issue too where it marks anything with [a-f0-9]{7,40} as special.. Github uses CodeMirror. So it will obviously exhibit this behaviour. That was stupid. . Agreed. This pull request is incorrect.\n\nI didn't know about this feature that allows commit messages to become\nvalid links.\nOn Thu, Sep 14, 2017, 02:00 Marijn Haverbeke notifications@github.com\nwrote:\n\nGitHub does allow linking of stand-alone hashes (as in 67379b8\nhttps://github.com/codemirror/CodeMirror/commit/67379b827d111c97aaeebfca96f454b6ce0d3b23),\nso I don't think this is correct.\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/4967#issuecomment-329392009,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AGFgDn3ZgTOf_hL5R-m8WJZdIZrgfqCwks5siM8WgaJpZM4PW_w0\n.\n. \n",
    "Robinlight": "thanks. ",
    "zhangzhike": "I'm using formatting.js from https://codemirror.net/2/demo/formatting.html. ",
    "badbrainz": "Have you tried calling the refresh method? In your vue instance you can call it after setting the CodeMirror value and during a resize event. e.g. this.$nextTick(() => cmInstance.refresh()). ",
    "JackieLs": "I try to add the options{inputStyle: 'contenteditable'},and it works well.\nI think just because I render the CodeMirror with a <div>, but the inputStyle still textarea, the cursor rendered for the textarea.So Is this a little bug or I use it in wrong way?. ",
    "robinwalterfit": "Sorry, just saw now, that I still have to build the project with npm install :sweat_smile:. ",
    "jayfoad": "\nYou could look at the (currently undocumented but unlikely to go away) xRel property on the position returned to adjust, if you want.\n\nWill do. Thanks.. ",
    "Janpot": "Thanks, Seems like I didn't read the contributing guidelines thoroughly enough. That is a great idea, it already seemed an unmaintainable practice to me to keep it in the main repo. And it will allow me to keep a coding style that is more comfortable to me.. @marijnh Would love to be able to use test/mode_test.js in my own package. Any way this can be exported somehow, or be unignored, or published as a separate module?\n. I was talking about the addon, but looks like I could work with addOverlay too.\nMore specific to my use case, I'm making a visible whitespace mode, but I want it to apply only on string and string-2 of the base mode. (in retrospect, it seems like addOverlay is actually a better fit than the addon here)\nLooking at the code in the branch you posted, it seems like I could use it.. So just so I understand you correctly, imagine I'm creating an editor with a select box that selects mode and checkbox 'visible whitespace'. Anytime these change I'd do something like\njs\nfunction onChange () {\n  if (isVisibleWhiteSpaceChecked) {\n    cm.setOption('mode', visibleWhiteSpace(mode, { restrictTo: ['string'] }));\n  } else {\n    cm.setOption('mode', mode);\n  }\n}\nBut I had more something like this in mind:\njs\nfunction onSelect (mode) {\n  cm.setOption('mode', mode);\n}\nfunction onCheck (visibleWhiteSpace) {\n  if (visibleWhiteSpace) {\n    // this mode could be made with the baseToken branch\n    cm.addOverlay({ name: 'visible-whitespace', restrictTo: ['string'] });\n  } else {\n    cm.removeOverlay('visible-whitespace');\n  }\n}\nWhich, to me, has the benefit that I can distribute it as just any other mode, and it could also be used as a base mode.\nAnyway, it's not that big of a deal, just thought it was a nicer use of API.\n. Ok, very cool. ~~Will have to dig a bit deeper later but I have a hunch there's an off-by-one in there somewhere, I seem to get some tokens with size 0 and type of the previous token where I expect a token of a single character.\nWill see if I can cook up a reproduction when I have some more time.~~\nEdit: scratch that, I get how it works now. ",
    "applibs": "This addon is loaded well and in browser i see:\n// Clumsy backwards-compatible interface\n  CodeMirror.newFoldFunction = function(rangeFinder, widget) {\n    return function(cm, pos) { doFold(cm, pos, {rangeFinder: rangeFinder, widget: widget}); };\n  };. I dont using node.js. Why it worked well in 5.19.1 version?\n. Where is defined exports, because I can not find it in /src? Exports is also in other addons!\n. And in other words: I can not use require.js, because it will broken my javascripts loading flow.\n. 1.\nIt means that method described here:\nhttp://codemirror.net/demo/html5complete.html\ndoes not work anymore? \n2.\nI want to manage myself what JS files are loaded.\n3.\nI compiled codemirror from latest GIT zip file and \"exports\" is not compiled with it. How to do it?. Dont forget that on many sites and systems is impossible use require.js, it works total differently.. So tell me what is different between 5.19 and 5.30. I just updated your code, nothing else. So problem is not at my using but at your changes. Are you agree?\nAnd other thing is that some your \"addons\" working well and some not.. Now I made some tests:\ncodemirror.js v.5.30\ntogether with modes v.5.30\ntogether with addons v.5.19\nand it works as expected.. OK, so big sorry to you, because before on 5.19 I never used node addon. I removed it and it works as expected.. ",
    "vtripolitakis": "Thanks \ud83c\udf89. ",
    "marcins": "Thanks for the quick turnaround!. ",
    "PiDelport": "Ah, I didn't see the generation script; thank you for updating that too!. ",
    "xuhdev": "Hah, I found the reason is that I installed Vimium for Firefox... Thanks!. ",
    "lansana": "Thanks, calling refresh on the editor instance solves the problem.. ",
    "junkbot": "It's also listed incorrectly on the website here https://codemirror.net/doc/manual.html#config and isn't listed at all for simpleMode, which is a rather common use case (that's how this bug was discovered). It would be super-helpful if this was updated!. ",
    "evmar": "This is the syntax for specifying a generic parameter to a function.  It can be useful in cases where the type cannot be inferred.  Here's a mini example (hover 'unknown' and 'maybeNumber' to see how they have different types).\nhttps://www.typescriptlang.org/play/#src=function%20genericFirst%3CT%3E(x%3A%20T%5B%5D)%3A%20T%7Cnull%20%7B%0D%0A%20%20return%20x.length%20%3E%200%20%3F%20x%5B0%5D%20%3A%20null%3B%0D%0A%7D%0D%0A%0D%0Alet%20unknown%20%3D%20genericFirst(%5B%5D)%3B%0D%0Alet%20maybeNumber%20%3D%20genericFirst%3Cnumber%3E(%5B%5D)%3B%0D%0A. ",
    "jayaprabhakar": "Thank you. I think I have fixed it correctly, this time.  . Thanks. On this list, I see a number of broken links. I am not sure what the policy is, whether to keep or delete the dead links. I can send another Pull Request deleting dead links, if you think it will be useful.. I have changed it. Thanks. PTAL\nhttps://github.com/codemirror/CodeMirror/pull/5049/commits/24887fe8ad528e1aae7070526da4edeba2fe3451\n. Thanks. I think I have fixed it correctly this time. . ",
    "nchen63": "that was quick! thanks. ",
    "whxru": "Thanks for your reply, that's exactly what the problem is! I end up inputting line number while the key Enter pressed so that the editor will create a new blank line after executing the keydown event handler. So I added evt.preventDefault(); at the first line of event handler and everything goes well. . ",
    "kay999": "Yes, also on demos on the website. But only seem to happen on OS X for certain page-zoom factors < 1 (for example page zoom 80%).\n. ",
    "davidroman0O": "I had the same problem with my cursor at the beginning of a line, the css code of @kay999 fixed it!\nthx!. ",
    "ferrao": "@adrianheine, I confirm this issue on Version 67.0.3396.99 (Official Build) (64-bit). ",
    "Kelier": "i just want to create another variable ,like \"var context\"?. i used \u201ccompleteSingle\u201d ,but it didnt work. ",
    "BinaryBrain": "I think it's not a bug, because when you type comments in English for instance, you want to close your parentheses but not apostrophes. If you write // Don't break my code, you don't want it to become // Don''t break my code.. ",
    "otramony": "Thank you.. ",
    "dlukes": "Thanks for getting back to me! #0b0 is already much better on a monitor :) It might still be a bit too light for the projector in the classroom where I teach, but that projector is really crappy, so it probably shouldn't be a target for optimization.\nIf you don't like outlines or background changes, I've found that font-weight: bolder; also works pretty well and has the added benefit that the parens remain visually distinct from other syntax elements highlighted in shades of green. Just a suggestion though -- #0b0 helps alleviate the immediate issue and if it's the best fit for you aesthetically, then great.\nOn an unrelated subject, I had no idea it was you behind CodeMirror -- thanks a lot for Eloquent JavaScript, and for reminding me that I need to contribute towards the 3rd edition :). ",
    "alfrye": "thanks for the quick response! Do you have examples using code mirror with require. ",
    "ericcirone": "Interested in this as well. Seems like add that back in fixes the issue. \n. ",
    "jordanffs": "Also interested in this fix.. ",
    "klebba": "Thanks for merging \ud83d\udc4d . @marijnh -- are the mode/* and addon/* files generated from some other original source which uses import syntax? I would be happy to change them if so; otherwise I am forced to copy them to my project and remove this boilerplate by hand:\n```\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n\"use strict\";\n//...\n});\n```. Ok, understood. So if I were to attempt any kind of refactoring for modes and addons it would need to be completely transparent to current users. Would you be open to a PR of this nature?. ",
    "themre": "i noticed that I got old version od JSHint that didn't had this support. But I enabled it with this:\nlint: {\n    esversion: 6\n}\nThanks for help!. ",
    "hypersoft": "No, it is not. Quite simply, we do not have the same setup.\nI suppose you cannot read because ../acorn/bin/acorn DOES NOT EXIST.\nFurthermore:\n\n[you are an asshole] Please provide links to the pre-built-version, or KINDLY, build one for me.. ",
    "dwaltrip": "\nI suppose you cannot read...\n[you are an asshole]\n\nPlease don't do this... Would you want to help someone who makes comments like this to a project you've spent thousands of hours on?\nJust because you can't see the other person through your computer screen doesn't mean that they aren't there.. ",
    "justinfagnani": "@marijnh I probably don't have the time for this anytime soon, I was just investigating different code editing options and noticed how CodeMirror could likely benefit from containment.\nWhen I get back around to my project that requires editing, I'll loop back on this and see if I can contribute.\n\nI think paint containment might cause some problems for people \u2014 absolutely positioned bookmark widgets sticking out of their containing lines can be useful, but if there's a big performance win, it might be worth making that harder anyway.\n\nIt would be easy to temporarily opt a line out of paint containment by applying a class. I'm not sure how the extension API works, but if an extension can apply classes to lines and spans, this won't be difficult at all. A slightly more pure alternative would be to put widgets on a different layer, not container by lines at all.. @alangdm there's a workaround for some modes at least. You can define a module that imports CodeMirror then writes it to a global, and import that before any mode:\ncodemirror-global.js:\njs\nimport CodeMirror from \"codemirror/src/codemirror.js\";\nwindow.CodeMirror = CodeMirror;\napp.js:\njs\nimport './codemirror-global.js';\nimport CodeMirror from \"codemirror/src/codemirror.js\";\nimport \"codemirror/mode/javascript/javascript.js\";\n@marijnh \n\nfurther complexity and indirection\n\nWouldn't this reduce complexity and indirection by directly using the web native module system, rather than relying on user-land loaders?\nWe're getting a lot of demand for libraries like CodeMirror to be loadable as modules. What can we do to help?. Oops, I meant to open this on codemirror.next!. ",
    "owenmli": "Oh, sorry! I should mention this is with Gerrit 2.14.\nWe are using CodeMirror 5.30.0. ",
    "TJonesy": "Npm install showed some output about installing phantomjs but no errors.\nnpm build didn't give any output.  If I run then again they dont give any\noutput.\nOn Sat, Nov 18, 2017, 02:31 Adrian Heine n\u00e9 Lang notifications@github.com\nwrote:\n\nWhat was the output of running npm install and npm run build? Note that\nyou have to run them in that order.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/5091#issuecomment-345430409,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AB3F9wrl2X1c2qxb0J6qAfcDDrQtdIGHks5s3qQOgaJpZM4Qi26R\n.\n. Running npm run build did work.  It would be good if you added that to the readme.. \n",
    "zhaojq-github": "run npm install and npm run build, not npm build. ",
    "1valdis": "Any updates on this? Should I just remove the required attribute?. ",
    "parraman": "Yes, I was talking about wheel scrolling. I was wondering if there was some\nsort of option or setup that prevented the event from being propagated if\nthe editor was scrolled to the end.\nOn Mon, 27 Nov 2017 at 17:34, Marijn Haverbeke notifications@github.com\nwrote:\n\nWhat kind of scrolling are you talking about? If this is about wheel\nscrolling, that's just how browsers act\u2014if the pointer is over a scrollable\ncontainer that's scrolled to the very end, its next scrollable parent is\nscrolled.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/5097#issuecomment-347239520,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AFwrS_nrs9bCnFcoTirkLhOtY1WGlku6ks5s6uSwgaJpZM4Qr3aa\n.\n. \n",
    "vinklein": "I am by no mean an expert in css syntax.\nBut the style is not applied on \"type\" tokens with this css (on Opera) . If i write \".cm-s-default, .cm-type\" instead the style is applied. Other style i ve test \"keywords comment ...\" works perfectly.\nOpera Version\u00a0: 48.0.2685.52\nOS : Ubuntu 16.04.3 LTS. ",
    "eveningkid": "I ran into the exact same issue. Hope this could be somehow fixed. . ",
    "craftzdog": "That's way better. Thanks!. ",
    "tbertelsen": "@dwelle: You are correct. This is not about visual vs. logical lines, but about the keymap.\nTo recap. Please confirm, that this is what we want to do.\nMac\nWe currently have this:\n\"Ctrl-Shift-Up\": \"selectLinesUpward\",\n    \"Ctrl-Shift-Down\": \"selectLinesDownward\",\n    \"Shift-Cmd-Up\": \"addCursorToPrevLine\",\n    \"Shift-Cmd-Down\": \"addCursorToNextLine\",\n\nFirst two use logical lines\nLast two use visual lines\n\nWe want this (which matches sublime text)\n\"Ctrl-Shift-Up\": \"addCursorToPrevLine\",\n    \"Ctrl-Shift-Down\": \"addCursorToNextLine\",\nWindows\nWe currently have this\n\"Alt-CtrlUp\": \"addCursorToPrevLine\", \n    \"Alt-CtrlDown\": \"addCursorToNextLine\",\n    \"Ctrl-Alt-Up\": \"selectLinesUpward\",\n    \"Ctrl-Alt-Down\": \"selectLinesDownward\",\n\nI assume the first two are broken, since it is missing - after Ctrl.\n\nWe want \n\"Ctrl-Alt-Up\": \"addCursorToPrevLine\",\n    \"Ctrl-Alt-Down\": \"addCursorToNextLine\",\nCross-platform\nWe want to \n\nDelete selectLinesUpward selectLinesdownward. I created https://github.com/codemirror/CodeMirror/pull/5117\nI just edited the file in the browser, since I don't know how you do testing/QA. Someone who knows should probably verify that it works and don't break things.. Thanks @mtaran-google for helping. I've been quite busy the last couple of days.\nI believe the cmd+shift+up will be caught be the fall through. It is a standard OS X keybinding.. Yeah, Thank you everyone for your help :). \n",
    "cprieto": "Sure, I am already on it.. I had been refactoring the ML mode (for both F# and OCaml), I can take care and add SML to the ML like languages (and define x-sml as a type).\nWhat do you reckon @marijnh ?\n(take a look at #5172, it won't take me long to add SML to the list)\n  . I will be opening a new PR to avoid conflicts, I think I botched something in my fork.. This relates to #5166 and #5172. thanks @marijnh \nutop is the REPL for OCaml (https://i.stack.imgur.com/xnQjZ.png)\nSure, I always forget to rebase, sorry, it was my fault.\nI didn't think about using the type annotation, I basically took the tokens from what I could figure out from the source code of other parsers in CodeMirror...\nI am doing the changes right now, I will probably close this branch and reopen it when it looks better, is that ok?. I have no idea what you meant.\nif it is about the case with 1e-10 that is already covered in line 53 with the patch. Now, with the f case I have no idea what is that, OCaml doesn't have a 1f notation (that I know).\nPlease, if I am misunderstanding what you are pointing out I will appreciate it.\nNow that you point that out, I notice I forgot Octal Integer Literals (0o1234), I am adding them now.. Oh thanks mate!\nI really missed that one! thanks man!\nThanks to you I got as well the long integer literals and octal \ud83d\ude04 \nThanks again \ud83d\udc4d . ",
    "FedeHerrera10": "// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n/*\n * Author: Federico Herrera\n * \n /\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n\"use strict\";\nCodeMirror.defineMode(\"rpg\", function () {\n  var BUILTIN = \"builtin\", COMMENT = \"comment\", STRING = \"string\",\n      ATOM = \"atom\", NUMBER = \"number\", KEYWORD = \"keyword\", MODTAG = \"header\",\n      COBOLLINENUM = \"def\", PERIOD = \"link\";\n  function makeKeywords(str) {\n    var obj = {}, words = str.split(\" \");\n    for (var i = 0; i < words.length; ++i) obj[words[i]] = true;\n    return obj;\n  }\n  var atoms = makeKeywords(\"TRUE FALSE ZERO \");\n  var keywords = makeKeywords(\n      \"\\/ COPY \\/ FREE \\/ END-FREE \" +\n      \"\\% ABS \\% ADDR \\% ALLOC \\% BITAND \\% BITNOT \\% BITOR \\% BITXOR \\% CHAR \\% CHECK \\% CHECKR \\% DATE \\% DAYS \\% DEC \" +\n      \"\\% DECH \\% DECPOS \" +\n      \"\\% DIFF \\% DIV \\% EDITC \\% EDITFLT \\% EDITW \\% ELEM \\% EOF \\% EQUAL \\% ERROR \\% FIELDS \\%FLOAT  \" +\n      \"\\% FOUND \\% GRAPH \\% HANDLER \\% HOURS \\% INT \\% INTH \\% KDS \\% LEN \\% LOOKUP \\% MINUTES \\% MONTHS \"+\n      \"\\% MSECONDS \\% NULLIND \\% OCCUR \\% OPEN \\% PADDR \\% PARMS \\% REALLOC \\% REM \\% REPLACE \\% SCAN \" +\n      \"\\% SECONDS \\% SHTDN \\% SIZE \\% SQRT \\% STATUS \\% STR \\% SUBARR \\% SUBDT \\% SUBST \\% THIS \\% TIME \" +\n      \"\\% TIMESTAMP \\% TLOOKUP \\% TRIM \\% TRIML \\% TRIMR \\% UCS2 \\% UNS \\% UNSH \\% XFOOT \\% XLATE \\% XML \\% YEARS \" +\n      \"ACQ ADD ADDDUR ALLOC AND BEGSR BITOFF BITON CALL CALLB CALLP CAT CHAIN CHECK CHECKR CLEAR CLOSE COMMIT \" +\n      \"COMP DEALLOC DEFINE DELETE DIV DO DOU DOW DSPLY DUMP ELSE ELSEIF ENDyy ENDSR EVAL EVALR EVAL-CORR EXCEPT\" +\n      \"EXFMT EXSR EXTRCT FEOD FOR FORCE GOTO IF IN ITER KFLD KLIST LEAVE LEAVESR LOOKUP MAIN MHHZO MHLZO MLHZO MLLZO \" +\n      \"MOVE MOVEA MOVEL MULT MVR NEXT OCCUR ON-ERROR OPEN OR OPTION OTHER OUT PARM PLIST POST READ READC READE READP READPE \"+\n      \"REALLOC REL RESET RETURN ROLBK SCAN SELECT SETGT SETLL SETOFF SETON SHTDN SORTA SQRT SUB SUBDUR SUBST TAG TEST \"+\n      \"TESTB TESTN TESTZ TIME UNLOCK UPDATE WHEN WRITE XFOOT XLATE XML-INTO XML-SAX Z-ADD Z-SUB CHAR VARCHAR BINDEC FLOAT \"+\n      \"INT PACKED UNS ZONED GRAPH UCS2 DATE TIME TIMESTAMP OBJECT POINTER IND DCL-S DCL-C DCL-DS DCL-F DCL-PI DCL-PR CTL-OPT END-DS \"+\n      \"DCL-PROC END-PROC EXEC SQL ENDIF ENDDO NOT BNDDIR USAGE\"\n       );\nvar builtins = makeKeywords(\"- * * / + < <= = > >= \");\n  var tests = {\n    digit: /\\d/,\n    digit_or_colon: /[\\d:]/,\n    hex: /[0-9a-f]/i,\n    sign: /[+-]/,\n    exponent: /e/i,\n    keyword_char: /[^\\s([\\;)]]/,\n    symbol: /[\\w+-]/\n  };\n  function isNumber(ch, stream){\n    // hex\n    if ( ch === '0' && stream.eat(/x/i) ) {\n      stream.eatWhile(tests.hex);\n      return true;\n    }\n    // leading sign\n    if ( ( ch == '+' || ch == '-' ) && ( tests.digit.test(stream.peek()) ) ) {\n      stream.eat(tests.sign);\n      ch = stream.next();\n    }\n    if ( tests.digit.test(ch) ) {\n      stream.eat(ch);\n      stream.eatWhile(tests.digit);\n      if ( '.' == stream.peek()) {\n        stream.eat('.');\n        stream.eatWhile(tests.digit);\n      }\n      if ( stream.eat(tests.exponent) ) {\n        stream.eat(tests.sign);\n        stream.eatWhile(tests.digit);\n      }\n      return true;\n    }\n    return false;\n  }\n  return {\n    startState: function () {\n      return {\n        indentStack: null,\n        indentation: 0,\n        mode: false\n      };\n    },\n    token: function (stream, state) {\n      if (state.indentStack == null && stream.sol()) {\n        // update indentation, but only if indentStack is empty\n        state.indentation = 6 ; //stream.indentation();\n      }\n      // skip spaces\n      if (stream.eatSpace()) {\n        return null;\n      }\n      var returnType = null;\n      switch(state.mode){\n      case \"string\": // multi-line string parsing mode\n        var next = false;\n        while ((next = stream.next()) != null) {\n          if (next == \"\\\"\" || next == \"\\'\") {\n            state.mode = false;\n            break;\n          }\n        }\n        returnType = STRING; // continue on in string mode\n        break;\n      default: // default parsing mode\n        var ch = stream.next();\n        var col = stream.column();\n        if (ch == \"/\") {            // comment\n          if(stream.eat(\"/\"))\n          {\n           stream.skipToEnd(); // rest of the line is a comment\n           returnType = COMMENT; \n          }\n          else returnType=KEYWORD;\n        } else if (ch == \"\\\"\" || ch == \"\\'\") {\n          state.mode = \"string\";\n          returnType = STRING;\n        } else if (ch == \"'\" && !( tests.digit_or_colon.test(stream.peek()) )) {\n          returnType = ATOM;\n        } else if (ch == \".\") {\n          returnType = PERIOD;\n        } else if (isNumber(ch,stream)){\n          returnType = NUMBER;\n        } else {\n          if (stream.current().match(tests.symbol)) {\n            while (col < 76) {\n              if (stream.eat(tests.symbol) === undefined) {\n                break;\n              } else {\n                col++;\n              }\n            }\n          }\n          if (keywords && keywords.propertyIsEnumerable(stream.current().toUpperCase())) {\n            returnType = KEYWORD;\n          } else if (builtins && builtins.propertyIsEnumerable(stream.current().toUpperCase())) {\n            returnType = BUILTIN;\n          } else if (atoms && atoms.propertyIsEnumerable(stream.current().toUpperCase())) {\n            returnType = ATOM;\n          } else returnType = null;\n        }\n      }\n      return returnType;\n    },\n    indent: function (state) {\n      if (state.indentStack == null) return state.indentation;\n      return state.indentStack.indent;\n    }\n  };\n});\nCodeMirror.defineMIME(\"text/x-rpg\", \"rpg\");\n});\n. this is the js code for the rpg mode. ",
    "sparkprime": "Thanks for the tip.  It now lives here: https://github.com/google/codemirror-mode-jsonnet. ",
    "weary-adventurer": "Native selection works, but it selects the whole line:\n\n. Clarification: [contenteditable] elements allow any characters inside, while <textarea> will replace and discard any carriage return symbols.. ",
    "liorgol1": "Note that the current implemented behavior is simpler than sublime's behavior (don't select the brackets). If you prefer I can try to implement something more similar to sublime but it will require a larger change to the code.\nAlso, the fact that sublime selects the condition of the if after the body (item 3 in the comment you referred to) seems like a bug more than intended behavior (e.g., if there is a line break after the condition  and before the \"{\" it will not do this).. That's true. On the other hand:\n1. I think this fix is an improvement of the current behavior.\n2. In my opinion this can be more useful than sublime's behavior as many times you do want to skip empty lines (and if you do want to select all lines, you can still do it - just press home first).\n3. Sublime's behavior on this issue is very buggy (build 3126): for example, pressing Alt+Shift+Down 3 times gives:\n```\nint main() {\n    #int x = 0;  // <--- Start with a cursor here.\n\n#return x;  // <--- Note the two cursors on this line.\n}#\n```. ",
    "sobisht": "I have added gifs of behaviour of VS Code, Sublime Text and CodeMirror.\nVS Code:\n\nSublime Text:\n\nCodeMirror:\n\nAs can be seen, while auto indenting, VS Code and Sublime Text also uses the previous indentation for indentation in new line.\nWhile in case of Codemirror, it considers the indenation of parent tag for indentation in new line.\n. Thanks for suggestion. I have moved the option from src to addon. \nautoCloseGT is called when tags are auto closed based on opening tag (i.e. '>' in case of html tags). I have added this option specific to auto close based on slash.. Correct. Making the option general to auto close tags.\nPlease review.. ",
    "AlexCzar": "groovy\n@Component\npublic class SomeComponent {\n    @RequestMapping(method = GET)\n    def getRequest(@Valid @RequestParam(\"getParam\") String getParam, @RequestParam(name=\"otherParam\", defaultValue=\"10\" int someInteger)) {\n    }\n}\n@Component, @RequestMapping, @Valid, @RequestParam here are examples of annotation is an annotation (meta-programming feature). CodeMirror does not highlight it in any way.\nIn the example @Component and @Valid do not have parameters, @RequestMapping has one named parameter (method), 1st request param has one unnamed param (default parm name is value) @RequestMapping, second request param has two named parameters.\nParameters' values can be any language variables, types and literals. There can be any number of annotation on declarations of classes, fields, methods and parameters . @marijnh hm... you're right, seems like it was some misconfiguration on my side.\nFeel free to close this issue. I can't debug it at the moment anyway, we've had to abandon codemirror anyway due to some other out-of-scope considerations.. @adrianheine it is not codemirror's fault, or else I would've filed an issue :) So don't be :). ",
    "ronyland": "I know why.because of your tag is not \"textarea\". ",
    "turbo": "For reference, the LiveScript site uses Google Prettify with a custom mode (I guess) from here. \nWho was the contributing GitHub user? . Thanks, though they seem to be completely inactive. Let's see if I can fix this.. ",
    "jdbruxelles": "In fact, It's just highlight text which doesn't work when I try to swipe to the latest version of codemirror.js. Note that all widgets are already up to date.\nI tried CodeMirror.colorize() but no change.. For the editor, I have : \nAnd when I type CodeMirror.modes in the console, it return \nAll needed dependencies (HTML, XML, JS, CSS) are loaded.\nAnd editor.getMode().name returns \"htmlmixed\". I have {null: \u0192, htmlmixed: \u0192, javascript: \u0192, xml: \u0192, css: \u0192,\u00a0markdown: \u0192} for the latest version.\nIt work now and markdown  work too.\nYou're the best.\nMuch thanks.. @marijnh It's just the //csslint.net/js/csslint.js which isn't served over the HTTPS. The correct link is http://csslint.net/js/csslint.js And the https://codemirror.net/addon/lint/css-lint.js file hosted on codemirror.net works as good.\nIt causes an issue with the css linter.. Well seen! Ctrl-Alt-Down (Up/Left/Right) is reserved on Windows too (for screen rotation).. @goldsmcb here is all release notes and version history.. Hi,\nWith your two editors on the same page, you must have something like this:\nhtml\n<textarea id=\"code\" name=\"code\" rows=\"5\"></textarea>\n<textarea id=\"code2\" name=\"code2\" rows=\"5\"></textarea>\n```javascript\n// Editor in readOnly.\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n  lineNumbers: true,\n  readOnly: \"nocursor\"\n});\n// Editor with content editable.\nvar editor2 = CodeMirror.fromTextArea(document.getElementById(\"code2\"), {\n  lineNumbers: true,\n  extraKeys: {\n    F11: function (cm) {\n      cm.setOption(\"fullScreen\", !cm.getOption(\"fullScreen\"));\n    },\n    Esc: function (cm) {\n      if (cm.getOption(\"fullScreen\")) cm.setOption(\"fullScreen\", false);\n    }\n  }\n});\n```\nNote that trigger the full-screen edition with the readOnly option with true as the value using keyboard shortcuts work very good. It's just that since the cursor is disabled in the editor with the \"nocursor\", you have to trigger the full-screen using an event such as the click. See the following code, for example, to display the editor in full-screen mode.\nhtml\n<!-- HTML Example -->\n<button id=\"fs-btn\">Full-screen</button>\njavascript\n// Editor in readOnly.\nvar fullScreen_firer = document.getElementById(\"fs-btn\");\nfullScreen_firer.addEventListenner(\"click\", function() {\n  editor.setOption(\"fullScreen\", true);\n});. Yes for readOnly: true and no for readOnly: 'nocursor'.. If the readOnly has \"nocursor\" as value (instead of true), focusing on the editor is also disallowed. But since the focus is disallowed, you can't have the cursor | in your editor and CodeMirror extra keys work with a focus in the editor.. Hi @marijnh,\nYou might put this message, \"We're not accepting new modes...\" in your website and in GitHub README.md \ud83d\ude09. Ok. Too bad that CONTRIBUTING.md is not read in its entirety. \ud83d\ude10. I think the issue is somewhere in the update.. I have loaded the show invisible code after codemirror.js. Then I set the option show invisibles by editor.setOption(\"showInvisibles\", true) and keep maxInvisibles: 16 as default.. Can you see that? I restored codemirror.js to version 5.36.0 while keeping the other files on 5.39.0 and oddly, it seems that the problem has disappeared only on a private browser.. There was a cache issue. Sorry and thanks ;-). Hi,\nI don't know why but the issue persists :-/. The issue is solved. I was just getting the tabSize and indentUnit as a string from cookies. It looks like they must be numbers, so I use Number().. My extra shortcuts are not in CodeMirror extraKeys, they are in window key event.\nYet that's what I did. But it's as if CodeMirror forces window shortcuts events to go through it. Then I have to focus on the textarea.. Yes, they trigger when I focus another textarea.. It's Ok. I've attached the keydown event to the document and shortcuts work inside and outside of textarea. Thank you.. @kunam1 are you a bot ?. Hi @Cloudzp and Happy new year.\nit's not going to be on a new line. You must make a new line manually.\nThe new line would work if you did editor.setValue(\"dev\\nautorender\");\nSo executing of app.conf could add a new line.. ",
    "johnsoncheg": "it's work, thks. ",
    "q2apro": "\nnon-standard functionality\n\nMeanwhile this is a standard functionality in all editors I know, only codemirror is the exception.\nUsing the proposed CTRL SHIFT D marks all the li blocks when inside the ul element. Such a shortcut is standard then? And duplicating is not?. ",
    "thipages": "Thank you. I will post in the forum next time for such questions.. ",
    "cailongl": "first of all,thanks! \nI want the indentation of a new line to copy the indentation style of the previous line.. ",
    "4oo4": "@marijnh Got it, added the extension under C.. ",
    "sjml": "Updated to clear the styles at a more appropriate place, but in my updated example you can see that it still has a problem with not being able to detect when the formatting isn't closed, and the rest of the line or paragraph still has it applied. \nI'm guessing this is a tough thing to work around given how CodeMirror does the tokenizing, but it would be a good thing to fix if possible. If someone can point me in the right direction I can keep pushing that way. . I added one more fix to keep links from staying on across paragraph breaks.. ",
    "asashour": "May be I wasn't clear enough.\nThe second argument is always undefined, please check this JSFiddle.\n. ",
    "mohammadRehaan": "Hi, thanks for quick reply, I really appreciate that.\nActually we have our own language so I think what you said makes sense. I can try fixing our parsers maybe, are you sure that's the correct behavior?\n  . ",
    "Ndolam": "Thanks for the quick response.\nIt doesn't bother me enough to go through the effort of creating a pull request.\nCheers.. ",
    "Sjoerrdd": "Thanks!. ",
    "overdodactyl": "Thanks @marijnh! Just changed the name. ",
    "neon-dev": "I know there's no guarantee for that, that's not what I was after. For example {{ or {{}} will be merged into single tokens, but with text in between it starts to split into that strange pattern. Just thought that this could be wrong, since these braces have the same token type and aren't special syntax chars.\nRegarding my problem, I think I'll keep the workaround I have. Changing the mode on the fly seems to be the worse solution if it introduces more overhead than iterating and replacing a few array values.\nIf hint.fromList would consider word boundaries instead of tokens, that'd be prettier. It takes \"words\" as an argument, so word boundaries seem reasonable, but I don't know how you intended that function to work.\n  . I guess enabling overlay.js in my sql editor like in that example should be an adequate solution. Plus we get the option for nice highlighting.\nIf I understand it correctly, it will override tokenizing and thus the the token type, if returned.\nSo if I want to properly detect and set different token types for braces and variables, I must call match() with a lookahead/-behind regex for opening/closing braces? And eat() controls what chars will get the token type we return.\nI also found cm.addOverlay() which seems very similar, but it seems like it's only for styles and doesn't influence token types so I didn't look into it.. I was mistaken, overlay.js is really only display logic, it doesn't affect tokenizing (makes sense).\nInstead I used multplex.js and defined Mustache as a simple mode via simple.js, which works just fine.\nThis is, until you want hints to work, but I found a (hopefully temporary) workaround (see #5249). I also found that the ominous isBogus() function seems to be obsolete. \"Dangerous comment\" should never occur in error.description, at least it can not come not from jshint.js. Maybe it can be removed?. Thank you :D I really appreciate your great work.\nWhat do you think about my suggestion removing some forced errors? I'm pretty sure about W033 and W084, but don't know about the others mentioned. It almost looks like JSHint didn't differentiate between errors and warnings at the time you implemented the addon so, maybe now they're not needed anymore.. Ok I dug a little and found that when it got implemented, JSHint was pretty different. It indeed didn't differentiate between warnings and errors, yet.\nYour doc pages still include such an old version: http://ajax.aspnetcdn.com/ajax/jshint/r07/jshint.js\nThere are warningAt and errorAt functions, but they both lead to the same method without any distinct parameters, so it was planned but not fully implemented. Error codes were introduced in https://github.com/jshint/jshint/releases/tag/1.0.0-rc1\nSo my commit not only broke your doc pages (I'll fix that in a moment) but also breaks backwards compatibility to JSHint versions older than 1.0.0-rc1 (31 Dec 2012).\n_\nBack to topic:\nI get why you may would want to mark W070 as an error, although it's the developers decision how far back he wants to support browser versions, especially IE. W112 and W117 sound pretty reasonable also, but the JSHint devs should know why they designated them as warnings. Same goes for the rest of \" and instead saw\" warnings. Since we don't know in which cases exactly you trigger each of these problems, all's just guessing.\nSo I would at least remove W033 and W084, but if you think there's no need for special overrides, I could remove the error code override entirely. I'm also not sure about the replacements array, maybe the message was unclear back then and now it could be just fine.. Great!. You're welcome :). Minimalism is my second name. Chopping line by line to remove clutter, improve readability as well as performance :D\nThanks again and sorry for the pull request spam lately.. I didn't update the docs in my commits, that'd be up to you :x. Oops, you're right. Sorry, will fix that later.. Thanks!. I've updated from FF 63.0 to 63.0.1 today. Just tried the safe mode to see if any addon was responsible, but no change.\nHere's a demonstration how it looks on my side:\n\nNow that I'm looking more closely, every part of the code gets slightly distorted, not only the keywords.. Do you have an example? I'm not quite getting what you mean :D. I saw the line, but didn't understand why you'd want to check for the character in front of the cursor.\nSo effectively, that would skip completions for tokens containing non-word characters, if the cursor is right after one?\nActually, I'd even remove the current regex test and let the word check loop handle everything. As you said once here, being able to put anything into the word list may be useful. For example if you work with AngularJS, var and function names starting with $ could be completed right at the first character.. Ah I see, you mean something like completions after a dot for example. Since the dot would be considered as a valid token, the completion list would be empty.\nIn that case maybe this could solve the problem if (token.string && (token.type == 'variable' || token.type == 'property')). A third OR condition would be needed if the current mode doesn't support these token types. Also this would make the addon complete in less situations, which may be good or bad, depending on your situation.\nNow that I think about it, we maybe should make this configurable (array of valid token types), then the power lies in the users hand and the addon can be fine tuned for each use case which would make it way more practical.\nBut that's just an idea and out of scope for this pull request.\nIf you still want the word check you suggested initially, I can implement that for now, even though I don't think it would add anything because we are inside one token which ends with a word character. It artificially limits the completion capability depending on where the cursor is, even though the word may be completable.. ",
    "everywan": "Change the browser UA to \"desktop\".\n\u6539\u53d8\u624b\u673a\u6d4f\u89c8\u5668\u7684UA\u4e3a\u684c\u9762.\u76ee\u524d\u6b63\u5728\u67e5\u627e\u5176\u4ed6\u7684\u65b9\u6cd5. ",
    "abumalick": "Cool, very quick response, thanks. Thank you very much, your fix worked very well. ",
    "domharrington": "Do you have any tips as to how I might achieve that? The main problem I have with including the regular core lib is bundle size, it adds around 300kb and I suspect adding just runmode-standalone would reduce that significantly.\nI've had some success writing my own build script which recompiles the bundles that i need to be simple module.exports = modules:\n```js\nconst fs = require('fs');\nconst path = require('path');\nconst CodeMirror = require('codemirror/addon/runmode/runmode.node');\nconst modes = require('../codemirror-modes/modes.json');\nmodes.forEach((mode) => {\n  require(codemirror/mode/${mode}/${mode});\nfs.writeFileSync(path.join(__dirname, '../codemirror-modes/', ${mode}.js), // Auto-generated from build-codemirror-modes.js\n    module.exports = ${CodeMirror.modes[mode].toString()});\n});\n```\nThen using it like this:\n```js\nrequire('codemirror/addon/runmode/runmode-standalone');\nconst CodeMirror = global.CodeMirror;\nconst modes = require('./codemirror-modes/modes.json');\nrequire('codemirror/mode/meta.js');\nmodes.forEach(mode => {\n  CodeMirror.defineMode(mode, require('./codemirror-modes/' + mode))\n});\n```\nBut this fails because it only fetches the function inside of the defineMode call: https://github.com/codemirror/CodeMirror/blob/e9e5f23b81ec86f84680d8b13ff422408e1a9428/mode/javascript/javascript.js#L14\nThis misses out all of the defineMIME stuff below that, which is required for runMode: https://github.com/codemirror/CodeMirror/blob/e9e5f23b81ec86f84680d8b13ff422408e1a9428/mode/javascript/javascript.js#L846-L855 So it fails.\nHave you ever considered having the modes in the repo as common js exports, then bundling them up as UMD modules during the build process?. ",
    "MaxwellK": "Thanks @marijnh - it's frustrating Android chrome doesn't behave normally, but that gives me some idea of where to go!\nJust in case, I've verified the autocomplete itself is working in Android Chrome, as it can be triggered by the normal cm.showHint() - it seems to be definitely just the keyboard bindings that are not firing.\nI did try inputRead to replace the keyMaps, code below. It also doesn't appear to fire on Android Chrome (though it does of course in desktop Chrome). I'll try a few more things out and update if I find anything.\njavascript\n//inputRead functions replacing keyMaps, still not fired in Android Chrome\neditor.on('inputRead', function(cm, changeObj){\n    // Alert does not fire in Android Chrome\n    alert('inputRead');\n});. ",
    "sslotsky": "Spent more time with the docs and it looks like electricInput is required for this to work? Are there plans to support that for the simple mode? I currently have something working directly against the lower level mode API and using electricInput so I will close this, but I think simple mode shows a lot of promise and it would be really great to have this supported. \nThanks so much for this amazing code editor!. ",
    "zadam": "So finally I found the download link. But still I think it would be nice to include it also in the manual and / or mention the npm as well. I think I can't be the only one who had trouble figuring out how to download \"built\" code mirror.. This seems to happen with all my keyboard shortcuts - examples are ALT-A, ALT-Q, CTRL+. (dot)\nThere's an interesting effect with browser \"standard\" keyboard shortcuts - e.g. CTRL-J in FF normally jumps into google search input, but in my app I have this overriden to do something different (bind to the CTRL+J and ev.preventDefault()). But when I have focus inside CodeMirror, CTRL-J will jump into google search input as if the keyboard binding wasn't overriden by the app - so obviously it's not CodeMirror's own binding, but it somehow executes the default browser behavior.. So finally I found the issue - problem was with used plugin - jquery.hotkeys.js which ignored keyboard events from textarea (even though filtering of form input events was disabled). Thanks for help.. ",
    "NeekSandhu": "Ultimately linkedDoc can be reduced to:\njavascript\n  linkedDoc: function(options) {\n    return new Doc(this, options)\n  }. > Extending Doc isn't really something that is supported\nI'm doing it in my fork. Is there any side effect I should consider?\n\nI recommend you use composition\n\nYou mean defineDocExtension?. Awesome! Thanks, Marijn\nhttps://twitter.com/neek_sandhu/status/1067104901665177601\nAlso I just discovered about CodeMirror 6 in the works. Don't you agree it'd be nice to keep this package in mind while making it's API and architecture?\nIf you agree, I'm happy to list all the things I think would be necessary/nice-to-have in CM6 for optimal operation.. Good. In the context of what I'm envisioning and what #5648 brings up. I think it'd be super awesome if CodeMirror (6+) also moves towards Textmate theme format (being followed by Sublime, Atom, VSCode (monaco), Ace editor etc.) where tokenizers are welcome to return \"scopes\" besides cm-property, cm-string etc.\nA lot more information is conveyed with support.variable.property and variable.other.property than just cm-property.\nShould we proceed that direction, I'm happy to say that mechanism for that is already been made and is what drives codemirror-textmate. Taking in a TM scope and generating a CSS class that will be applied to the token. And on top of that, it is backwards compatible with \"traditional\" codemirror tokens. Pretty neat IMO.. ",
    "DavidBabel": "Actually yes, i did not look close enought. Thanks for the work ;). ",
    "AlexanderPrendota": "And what about digitals after the decimal dot? \nI guess [^\\.\\D]+ it's very simple way\nBTW.\nI use https://regex101.com/ to check regex.. If you mean var a = 1. + 1.1 - doesn't allow.\n\\D - It's like a!\\d:) We do not allow any characters(like dots, commas, letters) except numbers [0-9]\n. I like regex discussions \u2764\ufe0f\ud83d\ude04. Exactly! [^\\.\\D]+can simplify to [\\d]+. My mistake! Thanks!. @marijnh Thanks \ud83d\udc4d . Yes, sure. I can but I guess it doesn't help you :disappointed: \nval cmDocument = CodeMirror.Doc(file.userText, type)\nval helpWrapper = document.create.div(\"task-help-wrapper\") \nhelpWidget = cmDocument.addLineWidget(0, helpWrapper, json(\"above\" to true, \"noHScroll\" to true))\nAnd I get exception in the third string.\nActually, I think, it's possible to add the condition on undefine or throw a pretty exception like \"only with editor\", but I prefer the first solution: may be somebody else has the same problem. \nPS.This condition will fix my problem and btw the old codemirror version haven't the signalLater function\nThanks. @marijnh When you have a plan to publish a patch for 5.34.0? . @marijnh so sad  :( . @marijnh Oh, Sorry. I merged changes from console I did not notice old changes. Okay, I will :) . @marijnh Hmm, If I use incognito window It renders about 3 seconds. Looks strange. (+) - button just cut the code before and after special markers.\nLook at:\n```js\nthis.codemirror.setOption(\"lineNumbers\", true);\nthis.codemirror.setValue(this.prefix + sample + this.suffix);\nthis.codemirror.markText(\n        {line: 0, ch: 0},\n        {line: countLines(this.prefix), ch: 0},\n        {\n          readOnly: true,\n          inclusiveLeft: true,\n          inclusiveRight: false\n        }\n);\nthis.codemirror.markText(\n        {line: this.codemirror.lineCount() - countLines(this.suffix) - 1, ch: null},\n        {line: this.codemirror.lineCount() - 1, ch: null},\n        {\n          readOnly: true,\n          inclusiveLeft: false,\n          inclusiveRight: true\n        }\n);\nfor (let i = 0; i < countLines(this.prefix); i++) {\n        this.codemirror.addLineClass(i, \"background\", 'unmodifiable-line')\n}\nfor (let i = this.codemirror.lineCount() - countLines(this.suffix); i < this.codemirror.lineCount(); i++) {\n        this.codemirror.addLineClass(i, \"background\", 'unmodifiable-line')\n}\n```\nprefix and suffix \u2014 just a text.\nAnd the main problem in 2 last loop. Probably it's a no good way co set the line color in loop.\nCould you give some advice? \nI guess you are right. It's client side issue. . @marijnh Perfect! Thank you so much \ud83d\udc4d . So, if CodeMirror can not support \"\" I can replace to ```var theme = \"CodeMirror-Hints \" + theme;```. @marijnh Element.classList is not supported some browsers that's why I use plain string concatenation.. @marijnh Yes. Exactly. Right now all is fine. I tested it. =) Thanks! . Hello! I took a look to other languages and I guess this changes don't effect any languages in clike mode.. Hm. I think in this changes also need to add double indent for streams in Java and etc. It's dot after). @marijnh You mean hooks indef(\"text/x-kotlin\")right? . Okay! Thanks I will take a look =)\n. @marijnh Tell me please how I can getindentUnitvariable in an indent hook? . Also add conditionsstate.prevToken == \"operator\" && textAfter != \"}\" ` to fix cases like that:\nkotlin\ninline fun <reified T> TreeNode.findParentOfType(): T? {\n    var p = parent\n    while (p != null && p !is T) {\n        p = p.parent\n    }\n    return p as T?\n}\nif ((state.prevToken == \"}\" || state.prevToken == \")\") && textAfter == \"\") - keep writing stream after enter\n. @marijnh Thank you for your help.\nCould you give some advice to fix 5371.\nJust use some regex in indent hook? . Hm! I saw same issue in 2 modes: groovy and shell. So I implemented like in groovy mode but I can't find the mistake I did.\nOkay! I will try again. I thought you could take a look on my solution.\nThanks!\n. The case \nkotlin\nval a = (2 + 2) * \n     6\nworks fine.\nBut the operator * in the top level should have the 0 indent.\nBut also we have the case like\nkotlin\nval x: String? = y as String?\nthe line after operator ? should have the 0 indent in block.\nNow It works wrong -> \nkotlin\nval x: String? = y as String?\n    val a= \"some\"\nBut this PR only fix the indent on top level.\n. Hm...\nthe case \nkotlin\n(someValue + x) *\n  aBigCoefficient\nreally will not work in the top level.  You are right.\nSo. But I guess it's really strange to analyze the import word in the start of the string in the second line. I added some logic in a hook. Please take a look please. Thanks! . @marijnh updated. Okay. I'll try to add area-label attribute. @marijnh Hello! Support all attributes instead of title, area-label and etc. =) legacy code.\nI will but you can mark new release with BREAKING CHANGES notice . shouldn't. I just added \njs\nattributes = {}\n...\n// support for the old title property\n// https://github.com/codemirror/CodeMirror/pull/5673\nif (m.title) {attributes.title = m.title}\n``. We can disallow the `class` and `style` attributes. I think. For docs:\nattributes: object\nWhen given, will give the nodes created for this span a HTML attributes with the given value.\n```. @marijnh Please check. Hm...I have no idea what's going wrong. How my patch can affects this tests? Could you take a look please?\n\n. Hm..I still have no idea \ud83d\ude14\n```\n\nnode ./test/run.js\nmode/kotlin/kotlin.js: Trailing whitespace (106:7)\nmode/kotlin/kotlin.js: The keyword 'let' is reserved (35:2)\nsrc/line/line_data.js: Semicolon found (189:53)\nsrc/line/line_data.js: Semicolon found (226:100)\nsrc/line/line_data.js: Semicolon found (227:95)\nsrc/line/line_data.js: Semicolon found (261:66)\nsrc/line/line_data.js: Semicolon found (262:85)\nsrc/line/line_data.js: Semicolon found (265:59)\nsrc/line/line_data.js: Semicolon found (266:22)\n\nAll passed\nnpm ERR! Test failed.  See above for more details.\n```\nno details \ud83d\ude14\n. Please don't create a new version without this feature =) . please check. Awesome thanks!. @marijnh okay. I'll change to \nvar theme = \"CodeMirror-Hints \" + theme;. ",
    "qiueer": "I use the tag 3.12 is OK.. $(\"textarea\"). ",
    "shahinkl": "Please try to use\n$(\"#textarea\")[0]. ",
    "AnshulMalik": "Hey @SeanJM, you can download it from http://codemirror.net/codemirror.zip. ",
    "fdemello": "@marijnh What are your thoughts on changing the CMD+L behavior to be like PyCharm and Visual Studio Code (# gets added at the same indentation level)? . ",
    "brioconnor": "Thanks for getting back to me marijnh. So it\u2019s just not possible to use a backslash as an escape character in SQL?. marijnh, the sql still runs. It\u2019s only a problem with the syntax highlighting. ANSI SQL doesn\u2019t have an escape character by default. . ",
    "aharpervc": "This is definitely a flaw for text/x-mssql, which does not use \\ for escaping. ",
    "vaibhavsagar": "Thanks!. Thanks!. Thanks!. ",
    "hesamat": "Sure. I will give it a shot sometime next week.. @dmortimer No it wasn't resolved. I ended up using a hack to address the issue back then. . @marijnh  Any hints/ideas?. @edemaine  I was using Gboard I believe. It was happening sporadically for me.. ",
    "dmortimer": "@marijnh @hesamat was this issue ever resolved? I am not able to get the on change event to trigger on an ANDROID device unless a space or special character has been entered.. I was able to trigger the necessary event listener by appending a space to the value of the editor before trying to access that value.\neditor.codemirror.replaceRange(\" \", {line: Infinity});\nEdit: this fix doesn't work in every case, it will cut off parts of words and not recognize all typed characters still. @martinschilliger what element are you applying that CSS to? Along with the cursor position jumping to the beginning, I am also having an issue where codemirror.hasFocus() returns false on IOS when it should return true.. @martinschilliger what element are you applying that CSS to? Along with the cursor position jumping to the beginning, I am also having an issue where codemirror.hasFocus() returns false on IOS when it should return true.. ",
    "skMun": "marijnh oh. I'm sorry. I was mistaken.\nThank you. Have a nice day. :). ",
    "shabbir1995": "Did You find a solution for this error?. I am stuck really bad with this error! any help appreciated.\nThanks. ",
    "liorbentov": "Well... you were super fast with that!\nAwesome!\nThanks!. ",
    "tmcw": "\ud83d\udc4d Test cases added.. Okay, refactored to use a single chain of scopes. Still pretty baffled by what's going wrong with the indentation failures, though - I can see that it's now setting align=true when re-entering the mode, and that's aligning certain blocks incorrectly, but how that connects to the very minimal code change is a mystery.. It works! May also want to implement for scopes.. ",
    "mkapiczy": "Yes. I've been using old jshint version. I have a problem with updating it, as it causes new errors, so I will get back to you when I manage to do that.. I still didn't manage to upgrade my JSHINT version, but I will still work on that and this is codemirror unreletaed issue.\nAnyway, wouldn't it be better to provide a backward functionality if there was one previously? E.g. check for a code property if not there make severity 'error' by default?. ",
    "bspsz": "Well, I guess that CodeMirror alone is running great, but unfortunately I'm forced to use CKEditor. And v5 is not an option, it's still in alpha so I can't use it in producation env.. ",
    "tsznuk": "The fix replaces the whole regex construction by matching the raw pattern without any boundaries and then filtering matches by checking for boundaries.\nEscaping the string would solve the issue too, but it would be hard to match boundaries correctly (I guess that is technically a separate issue) - We'd need to negate a regex somehow.. ",
    "AMAISGOD": "When I use codeMirror.getValue()  for This Text\nSELECT a FROM Main\\nWHERE  a > 1\nQuery dont work and sql Library (mssql npm) Send Error :\nIncorrect Syntax Near 'WHERE'. ",
    "boljen": "Aight, thanks!. ",
    "digwuren": "No, Materialize defines the exemption via input...:not(.browser-default), so a container would not work.  However, if the <input ...> generated by makePrompt() had, say, a CodeMirror-prompt class attached to it, it would be trivial to override what Materialize does in the app's local CSS.. Actually, I think I can hang these overrides on .CodeMirror input.  So, a container might work, after all.. ",
    "dhib-dy": "thanx , i have been see that link, but in the repo https://github.com/codemirror/CodeMirror/tree/master/mode the java mode is absent . thanx you it's working . ",
    "x5engine": "please a note in the docs or something thank you :). ",
    "cmglez10": "Sorry, Regexp and me are not best friends... :(. Done! Sorry about the delay.\nThanks!. ",
    "mohit94614": "Thanks I'll fix it\nOn Fri, Mar 2, 2018, 12:26 AM Adrian Heine n\u00e9 Lang notifications@github.com\nwrote:\n\nRight, you have to build the file if you clone the git repository. Run npm\ninstall for that.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/5289#issuecomment-369693425,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AQ2qynJUqW7IcWxGkqHSkLo8yooH5SpQks5taERtgaJpZM4SYxhY\n.\n. \n",
    "pvzzombs": "Heres the link for better testing:\nHTML: https://github.com/pvzzombs/hello-world/blob/master/Sample.html\nJS: https://cdn.rawgit.com/pvzzombs/hello-world/0f539409/m.js. The direction of text is fixed, but when I try to type the cursor, it freezes. Then the browser crashes.\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar timeout;\nvar edit = CodeMirror.fromTextArea(document.getElementById(\"textBox\"),\n{\nlineNumbers: true,\nmode: \"javascript\"\n});\nedit.on(\"change\",function(cm){\n    var a = m.getKey(edit.getValue()),b = a[0],c = a[1],arr;\n    if(b == \"{\"){\n        arr = m.New.split(\"\");\n        arr[c] = \"{}\";\n        cm.replaceRange(arr.join(\"\"),{line : 1,ch : 1},{line : arr.join(\"\").split(\"\\n\").length , ch : arr.join(\"\").length});\n        m.New = arr.join(\"\");</p>\n<pre><code>}else if(b == \"(\"){\n    arr = m.New.split(\"\");\n    arr[c] = \"()\";\n    cm.replaceRange(arr.join(\"\"),{line : 1,ch : 1},{line : arr.join(\"\").split(\"\\n\").length , ch : arr.join(\"\").length});\n    m.New = arr.join(\"\");\n\n}else if(b == \"[\"){\n    arr = m.New.split(\"\");\n    arr[c] = \"[]\";\n    cm.replaceRange(arr.join(\"\"),{line : 1,ch : 1},{line : arr.join(\"\").split(\"\\n\").length , ch : arr.join(\"\").length});\n    m.New = arr.join(\"\");\n}else{\n    cm.replaceRange(m.New,{line : 1,ch : 1},{line : m.New.split(\"\\n\").length , ch : m.New.length})\n}\n</code></pre>\n<p>});\n\n\n\n\n```. @marijnh Is there any problem in my code?. ",
    "polterguy": "BTW, thx for a spectacular piece of work! It's an amazingly nice tool :). Thx mate, I might look into it ... :). ",
    "raphamorim": "what do you think @marijnh :octocat: ? \nany suggestions?. Thanks @marijnh :). ",
    "mu-yu": "The build script is generated by vue-cli, and it doesn't do anything with  .html file. \nhow to reproduce the compile error:\n1. vue init webpack\n2. add CodeMirror.vue into components folder\n3. add <code-mirror :options=\"{mode: 'javascript', theme: 'mbo'}\"></code-mirror> into App.vue\n4. run npm run dev\nCodeMirror.vue:\n```vue.js\n\n\n\n\nimport CodeMirror from 'codemirror'\nimport 'codemirror/lib/codemirror.css'\n\nexport default {\n  name: 'EvCodeMirror',\n  props: { options: { type: Object } },\n  data() {\n    return { codeMirror: null, id: `CodeMirror_${+new Date()}` }\n  },\n  mounted() {\n    import(`codemirror/theme/${this.options.theme}.css`)\n    import(`codemirror/mode/${this.options.mode}/${this.options.mode}`).then(() => {\n      this.codeMirror = CodeMirror(document.getElementById(this.id), this.options)\n    })\n  },\n}\n\n```. ",
    "ebogard": "Hi I'm a new contributor, do you think I could take this as a first issue?\nIt looks like there are no motions defined for '(' and ')' in /keymap/vim.js. Great! I submitted a pull request. Any feedback is greatly appreciated since I'm new to contributing.. ",
    "thomasjm": "Done. Thanks for the quick response! A few thoughts:\n-- I looked at the performance monitor in the Chrome devtools console, and the CPU usage hardly increases at all when scrolling. This is a fast laptop also.\n-- I tried increasing the viewportMargin significantly, and it doesn't seem to have any effect on the jitter, even for small scrolls. (That should cause the surrounding lines to be pre-rendered, right?)\n-- If I use a USB mouse scroll button instead of a trackpad, scrolling seems to be smooth, even if I scroll the wheel as fast as I can.\n-- Again, it works much better on Firefox.\nSo, it seems to be something that uniquely affects Chrome scrolling with a trackpad, which makes me think it's not related to rendering slowdown. Any other ideas? I'm happy to instrument my editor and measure stuff if you can suggest where I might poke around.. Now that you mention it, it does seem as if my trackpad can sometimes move the horizontal scrollbar slightly even when I'm scrolling vertically.\nI did\nwindow.addEventListener(\"scroll\", function() { console.log(\"scroll: \", arguments); })\nwindow.addEventListener(\"wheel\", function() { console.log(\"wheel: \", arguments); })\nin the console to look at the events. It appears that the X and Y deltas come across in different events, i.e. one event might have a nonzero deltaY while another has a nonzero deltaX but they don't ever seem to both be nonzero at the same time.\nI don't quite follow how that would cause the observed behavior, would horizontal events make the vertical scrolling logic get interrupted/confused? Also, my trackpad seems to behave the same way in Firefox.... That sounds great, thanks! I've been using CSS to hide the line numbers on such collapsed lines so that isn't a problem. Maybe auto-hiding the line number or something could be a separate issue but I'll close this one.. Fixed by #5761 . Possible solution: reach into the marker and temporarily change its inclusiveLeft/inclusiveRight setting. How bad an idea is this? https://codepen.io/anon/pen/VgbgKY. You're right that I don't want inclusive behavior. What I want is for the line to be collapsed, so it's impossible to put the cursor on the line with the marker. But as the manual says, \"In atomic ranges, inclusiveLeft and inclusiveRight have a different meaning\u2014they will prevent the cursor from being placed respectively directly before and directly after the range.\" So I'm forced to use the inclusive options to get the effect I want. Perhaps the real source of the trouble is how the meaning of inclusiveLeft/inclusiveRight is overloaded this way.\nMaybe it would be good to separate the \"no cursoring before or after\" meaning into a separate option called preventCursorLeft/preventCursorRight (which has no effect on non-atomic ranges)?. Thanks for the review! I'll make those changes.\nCan you give me a hint on how to run the tests? I've tried npm install && npm run build && npm run test and gotten the exact same failures as Travis (which doesn't include a core_atomicMarker failure). I also just tried rebasing on the latest master and got the same result.. Ah okay, fixed. ",
    "asethiya": "search addon has additional features like overlay and matches on scrollbar that I would like to use.. ",
    "evs-chris": "Quick followup:\n\n\nInterestingly, mobile Firefox for Android works nicely in the xmlautocomplete demo with this.\n\n\nI have no experience with the less Latin charsets, but Belarusian seems to work nicely.. Thanks for looking at this.\n\n\nIt would be nice to be able to author an add-on targeting the official distribution. Would you be open to a blessed extension name, that if present, would allow external creation of the backing input? Something like let div = this.wrapper = (cm.createHiddenInput || hiddenTextarea)()?. Oh wow, I completely missed that that is exposed statically. In that case, would the internal method on the TextareaInput to generate the wrapper be acceptable?. ",
    "alexa-griffin": "This is an issue with my code and not codemirror as a whole. Apologies for the unneeded issue. ",
    "tugrulelmas": "Hi @marijnh,\nIs there anything to be improved?. I replaced client keywords with these keywords.. You are right. I should've use different variables for brackets and punctuation.. ",
    "mtaran": "Makes sense, thanks.. ",
    "lukewatts": "Thanks!. ",
    "zwz": "This is weird. \nI just re-checked. I find that every input/textarea of any web page has this problem.\nSo there must be something wrong with my system, not codemirror.. ",
    "dcooney": "@osworx You need to cd to the repository and run npm install.\nAfter that, codemirrors.js will be added to the lib directory.. > Such a way to add codemirror to a system should be also possible - thanks in advance.\nYea, I'm not sure why they didn't include the bundled script in the downloaded repository.. Nice, thanks for the link @marijnh.\nFWIW - I'm still unable to locate the .zip download link on the website. . ",
    "osworx": "Thx, but what if I add the script the 'normal' way, not using any installer?\nSuch a way to add codemirror to a system should be also possible - thanks in advance.\nIn the meantime I copied the script manually.. @marijnh That this is a 'source repository' is known!\n\nget the zip on this website\n\nYou're joking, there is no script inside the zip  that's why i am asking.. > Not sure if you're trolling or are unable to open a zip file, but for other people passing by here, yes, http://codemirror.net/codemirror.zip does have all the scripts you need.\nNo, and I know how to handle github!\nNot under https://github.com/codemirror/CodeMirror/releases\nAnd there it should be included - as at so many other projects.\nI do not want to waste my time here and to search where I can find a complete package.. ",
    "misterbeebee": "Indeed, SublimeText matches CodeMirror in this regard.\nSome people find this SublimeText behavior annoying, and there is a way to disable it with user config: \nhttps://stackoverflow.com/questions/14032041/how-to-prevent-sublime-text-2-from-swallowing-closing-brackets-quotes-and-paren\nI tested IntelliJ (CLion) and Eclipse 4.7 for comparison:\nIntelliJ is very clever: It will check to see if parens are balanced, and will treat ) as \"move right\" if and only if parens are already balanced. IMO this is the ideal behavior, but takes a lot more static syntax analysis than CodeMirror currently performs (right?).\nEclipse is moderately clever: It will will treat ) as \"move right\" only while in a special \"auto-close fill-in\" mode while filling in content inside of autoclosed brackets. There's some threshold (I'm not sure what, something like moving the cursor outside of the brackets, or inserting more brackets inside the  auto-brackets) after which it it stops skipping over \")\". This is a better and worse than SublimeText: it won't ignore necessary brackets, but it also adds extra brackets sometimes.\nI think Eclipse's behavior is better than SublimeText's behavior, since I'd rather the tool bias toward respecting user input over being more magically helpful, if it can't be perfectly magical. But I can see how user opinions would vary based on how often they need one behavior vs the other.\nSince getting this behavior right for all the edge cases (InelliJ-style) takes a bunch of work:\nUntil/Unless CodeMirror can count parens to determine when a paren should be skipped, I think that a good cheap compromise would be providing an option to disable the paren-skipping would be a small amount of work that would make many users happy. I think that would require adding a preference setting, and checking it in the one if block that decides to paren-skip.\n. ",
    "BoPeng": "fstr_state is primarily used by line 211\ntokenBaseInner(stream, state.fstr_state)\nto parse expressions inside f-string. It is also used outside of formatStringFactory to detect nested fstr (therefore has to be global in state) to treat nested f-string f\"nsted f-str with {100}\" in\nf' { f\"nested f-str with { 100 }\"  + \" hello\"}'\nas a regular string. Moving fstr_state to the closure will cause an error in this case, unless we set a flag in tokernize (e.g. set tokenString.isFormatString=True here) and use a stack to push/pop fstr_state to handle nested f-string properly. Do you think it is worth the trouble to do this?. OK, I have merged formatStringFactory to tokenStringFactory with a isFmtString flag and used an enclosure state to maintain states of expressions.\nThe trick to get around of nested f-string problem is to explicitly handle nested f-strings as regular strings in this line so that tokenBaseInner would not see them. It is possible to dig into nested f-strings but it is very troublesome and there is no real need to do it.. I am sorry but I am afraid that I do not know CodeMirror/JS well enough to do that. I was surprised that there is no copyState function in the Python mode as others do but I still put fstr_state in global python state as recommended by the documentation.  Putting fstr_state in a closure as you suggested was already a bit of stretch for me and I do not really know what you meant by a new closure. I have invited @marijnh to my fork, perhaps you can make the change by yourself?. Allow me to write down in detail what is going on here after more reading.\nIf I understand correctly, you are referring to this line of code\nreturn tokenBaseInner(stream, fstr_state);\nwhich, in case of f-string, resort to a basic tokenBaseInner tokernizer to parse the expression inside f-strings. It would work very well without copyState because tokenBaseInner would parse the entire expression and return the correct tokens with state saved in fstr_state. The key point here is that the global python state and tokenize are not changed (still tokenStringFactory) so CM would return to this line for the next token until the expression is terminated by tokenStringFactory(), not by tokenBaseInner.\nI do not know when copyState will be called but during the parsing of nested expressions, if the state is copied, the tokenStringFactory() would be copied, with fstr_state copied by reference, which is considered unsafe because restoring fstr_state is unpredictable. Putting fstr_state in the global state as the original patch did would prevent us from this problem because fstr_state would be copied and restored correctly, but let us focus on the problem of closure state.\nWhat you suggested was to \n\nupdate state.tokenize to a new closure that closes over the updated fstr_state value\n\nI first thought you meant to do\nstate.tokenize = tokenBaseInner\nbut that would totally mess up the parsing logic. I suppose what you really meant was to create a new fstr_state for each new copy of state.tokenize (currently tokenStringFactory) so I have submitted a patch just for that. Note that the clone function is basically CodeMirror.copyState(??, state) but I do not know what to put as ?? here.. I have tried, but it is very difficult to determine the height of the textarea. I used\n$('textarea').each(function() {\n     $(this).height($(this).prop('scrollHeight'));\n     });\nbut scrollHeight does not equal to the height of codemirror rendered areas in some cases.. For example,\n\nI can duplicate the height of textarea, in the above example, to be 143.768 which is identical to Codemirror-lines as shown in the figure. However, a Codemirror-sizer div for whatever reason decides the min-height should be 144. Without duplicating the sizer behavior, my textarea will be slightly smaller than codemirror. It is a small difference but in a long document like what I have, the accumulative effect is quite visible at the end.\nEdit: In the end, I have to use a wrapper with a min-height that a bit larger than each textarea to make sure the page will not move when textareas are rendered.. ",
    "GregorioCunha007": "@marijnh Please provide your insight thanks !!!!. It's not any specific language. They're just keys and values. It's not any specific language. They're just keys and values. The mode i selected was => \"text/html\". Using text/plain did the trick. What mode do you recommend for bash script \".sh\" files ? Thanks for your fast response man. @marijnh Tried using both of these possibilities inside http://codemirror.net/mode/shell/index.html, but it keeps showing it in plain text. My files start with \"#!/bin/sh\" this annotation. Is it still considered a shell file right ?. @marijnh  This is just a snippet of a file .. Anything wrong with it ? Since CodeMirror seems not able to recognize it as a .sh ?\n`if [ -x /bin/test ]; then\n    TEST_BIN=/bin/test\nelif [ -x /usr/bin/test ]; then\n    TEST_BIN=/usr/bin/test\nelse\n    TEST_BIN=test\nfi\nDIRNAME=`dirname $0``. Sure and If you put\n   `if = 0\n     echo fox\n\n    x\n    xxxx = {}`\n\nIt will still show as highlighted aswell. So what's up with that ? That's not valid .SH code either. I'm creating the merge with that mode and with both files correctly. So yes I think I'm right coming here to get some insight on what's happening with code mirror\n. ",
    "jordyvandomselaar": "@marijnh Fair point, thanks for the explanation, and for the tip about the forums!. ",
    "mbaev": "@marijnh maybe need to add this in manual?\nhttp://codemirror.net/doc/manual.html\nor, by your think, for first try we need to find and read all related documentation?. ",
    "ischas": "Since the code posted by @ConiKost is shown correctly here at GitHub, I changed the font-family in our CodeMirror instance from \"monospace\" to \"Consolas\", which is the font used by my machine (Win 10, Firefox DE 60) to display code at GitHub. With this done, the cyrillic letters are displayed correctly.\nSo the codemirror.css seems to be problematic for cyrillic letters on Windows.. You're right, it seems to be a problem with the monospace font of Firefox, since the problem is not reproducable with Edge and Chrome.. ",
    "bradgentry": "I edited my original issue to elaborate that Checkmarx indicates the values \"flow through the code without being properly sanitized or validated\". ",
    "beneboy": "I am also having this issue, works fine on Desktop with Safari but not iPad.\nIt appears that Space will scroll the window, so it is as if the space input it not being captured by CodeMirror.\nAlso the cursor does not appear.\nThe CodeMirror instance is being displayed inside a BootStrap modal on an Angular 1 SPA.. ",
    "marvindanig": "\nIt appears that Space will scroll the window, so it is as if the space input it not being captured by CodeMirror.\n\nTrue that. It is my guess but with {passive: false} passed as options inside addEventListener on the iPad, it might just work. . This is it! @kimyLee you found the mojo for this one, great job! :+ . ",
    "kimyLee": "I also meet this problem, it seems caused by the \"contenteditable\", try to add the following css style\ntextarea,\n[contenteditable] {\n    -webkit-user-select: text;\n    user-select: text;\n}\nI just make it work by doing this. all right, thanks, I will do some more search and coding to try to solve this, thanks for your quick reply and help . ",
    "AlbertHilb": "Is there any chance this will be merged or #5368 will be fixed in some other way?\nI'll be glad if I can help you to make this happening.. ",
    "DreamLi1314": "Thanks, I really should be so.. I found this problem. because in CodeMirror/src/util/event.js, the e_button method tries to get the current mouse button using e.which, but when the mouse is not pressed the which property gets 1 in Firefox, get in Chrome is 0, so firefox browsers will think that the left mouse button was pressed.\nI think this method seems to return e.buttons directly.\nI reproduce this issue at least on firefox and edge, please check this issue and other browsers.. I temporarily choose to listen for the MouseMove event and filter it to avoid this problem.\nas follows:\nmouseMove(event: MouseEvent): void {\n      if(event.buttons != 1) { \n         event.stopPropagation(); \n         event.preventDefault(); \n      }\n   }.  My problem is caused by mouseEvent.which is 1 on firefox when the mouse is moved without pressing the left key.\nI successfully solved my problem using attached patch.. ",
    "mickael-kerjean": "I've update the code to be:\nif (matches.length > 2 && rule.token && typeof rule.token != \"string\") {\n            for (var j = 2; j < matches.length; j++)\n              if (matches[j]){\n                  if(state.pending === null) state.pending = [];\n                  state.pending.push({text: matches[j], token: rule.token[j - 1]});\n              }\nand the problem is gone but I'm not 100% sure if it's a bug in the simplemode thinghy or an issue on my mode. > you have to make sure your regexp's captured groups always match something\nThat's the thing, I am trying to match multiple token in one line and the error is thrown while typing something in codemirror (not all the token can match something out of the empty string yet)\nThat's the extract from the mode:\nstart: [\n{regex: /^(\\*{1,}\\s)(TODO|DOING|WAITING|NEXT){0,1}(CANCELLED|CANCEL|DEFERRED|DONE|REJECTED|STOP|STOPPED){0,1}(.*)$/, token: [\"header org-level-star\",\"header org-todo\",\"header org-done\",\"header\"]},\n...\n...\n]\nI'm not sure how to manage this \"properly\" without the hack above and without copying and pasting part of the regex to manage all the different scenarios.. You rock :)\nMany thanks for your support and for all the work you've put together to create such an awesome project. ",
    "ckeyer": "I use this project to show some build logs, but some are not friendly\n\n. ",
    "cone56": "Looks like your reverted commit was enabling the feature by default. This PR has it disabled by default which should make it safe to include. Additionally, I've not been able to reproduce #3698 with the latest codebase.. ",
    "yz4": "Has there been any update about this? The mouseover behavior seems reasonable in many use cases and not having the active hint on highlight is actually highly unintuitive if the feature work flow relies more heavily on mouse movements than keyboard cursor. I think having a boolean toggle for the mouseover behavior is a reasonable solution if it was causing problems for some people but not for others.. ",
    "Nagendra080389": "This was a css issue from my project.. This is Apex Language used in Salesforce, Similar to Java.\nSo I have created Apex.js\nWhich when initialized , pushes all the method names and class names to the words list:\n`\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n// codemirror-mode-apex by Maura C. Warner (lines 285-EOF)\n// the rest of this code is from CodeMirror's clike.js\n(function(mod) {\n    mod(CodeMirror);\n})(function(CodeMirror) {\n    \"use strict\";\nfunction Context(indented, column, type, info, align, prev) {\n    this.indented = indented;\n    this.column = column;\n    this.type = type;\n    this.info = info;\n    this.align = align;\n    this.prev = prev;\n}\n\nfunction pushContext(state, col, type, info) {\n    var indent = state.indented;\n    if (state.context && state.context.type == \"statement\" && type != \"statement\") indent = state.context.indented;\n    return state.context = new Context(indent, col, type, info, null, state.context);\n}\n\nfunction popContext(state) {\n    var t = state.context.type;\n    if (t == \")\" || t == \"]\" || t == \"}\") state.indented = state.context.indented;\n    return state.context = state.context.prev;\n}\n\nfunction typeBefore(stream, state, pos) {\n    if (state.prevToken == \"variable\" || state.prevToken == \"variable-3\") return true;\n    if (/\\S(?:[^- ]>|[*\\]])\\s*$|\\*$/.test(stream.string.slice(0, pos))) return true;\n    if (state.typeAtEndOfLine && stream.column() == stream.indentation()) return true;\n}\n\nfunction isTopScope(context) {\n    for (;;) {\n        if (!context || context.type == \"top\") return true;\n        if (context.type == \"}\" && context.prev.info != \"namespace\") return false;\n        context = context.prev;\n    }\n}\nCodeMirror.defineMode(\"apex\", function(config, parserConfig) {\n    var indentUnit = config.indentUnit,\n        statementIndentUnit = parserConfig.statementIndentUnit || indentUnit,\n        dontAlignCalls = parserConfig.dontAlignCalls,\n        keywords = parserConfig.keywords || {},\n        types = parserConfig.types || {},\n        builtin = parserConfig.builtin || {},\n        blockKeywords = parserConfig.blockKeywords || {},\n        defKeywords = parserConfig.defKeywords || {},\n        atoms = parserConfig.atoms || {},\n        hooks = parserConfig.hooks || {},\n        multiLineStrings = parserConfig.multiLineStrings,\n        indentStatements = parserConfig.indentStatements !== false,\n        indentSwitch = parserConfig.indentSwitch !== false,\n        namespaceSeparator = parserConfig.namespaceSeparator,\n        isPunctuationChar = parserConfig.isPunctuationChar || /[\\[\\]{}\\(\\),;\\:\\.]/,\n        numberStart = parserConfig.numberStart || /[\\d\\.]/,\n        number = parserConfig.number || /^(?:0x[a-f\\d]+|0b[01]+|(?:\\d+\\.?\\d*|\\.\\d+)(?:e[-+]?\\d+)?)(u|ll?|l|f)?/i,\n        isOperatorChar = parserConfig.isOperatorChar || /[+\\-*&%=<>!?|\\/]/,\n        isIdentifierChar = parserConfig.isIdentifierChar || /[\\w\\$_\\xa1-\\uffff]/;\n    var curPunc, isDefKeyword;\n\n    function tokenBase(stream, state) {\n        var ch = stream.next();\n        if (hooks[ch]) {\n            var result = hooks[ch](stream, state);\n            if (result !== false) return result;\n        }\n        if (ch == '\"' || ch == \"'\") {\n            state.tokenize = tokenString(ch);\n            return state.tokenize(stream, state);\n        }\n        if (isPunctuationChar.test(ch)) {\n            curPunc = ch;\n            return null;\n        }\n        if (numberStart.test(ch)) {\n            stream.backUp(1);\n            if (stream.match(number)) return \"number\";\n            stream.next();\n        }\n        if (ch == \"/\") {\n            if (stream.eat(\"*\")) {\n                state.tokenize = tokenComment;\n                return tokenComment(stream, state);\n            }\n            if (stream.eat(\"/\")) {\n                stream.skipToEnd();\n                return \"comment\";\n            }\n        }\n        if (isOperatorChar.test(ch)) {\n            while (!stream.match(/^\\/[\\/*]/, false) && stream.eat(isOperatorChar)) {}\n            return \"operator\";\n        }\n        stream.eatWhile(isIdentifierChar);\n        if (namespaceSeparator) while (stream.match(namespaceSeparator)) {\n            stream.eatWhile(isIdentifierChar);\n        }\n        var cur = stream.current();\n        if (contains(keywords, cur)) {\n            if (contains(blockKeywords, cur)) curPunc = \"newstatement\";\n            if (contains(defKeywords, cur)) isDefKeyword = true;\n            return \"keyword\";\n        }\n        if (contains(types, cur)) return \"variable-3\";\n        if (contains(builtin, cur)) {\n            if (contains(blockKeywords, cur)) curPunc = \"newstatement\";\n            return \"builtin\";\n        }\n        if (contains(atoms, cur)) return \"atom\";\n        return \"variable\";\n    }\n\n    function tokenString(quote) {\n        return function(stream, state) {\n            var escaped = false,\n                next, end = false;\n            while ((next = stream.next()) != null) {\n                if (next == quote && !escaped) {\n                    end = true;\n                    break;\n                }\n                escaped = !escaped && next == \"\\\\\";\n            }\n            if (end || !(escaped || multiLineStrings)) state.tokenize = null;\n            return \"string\";\n        };\n    }\n\n    function tokenComment(stream, state) {\n        var maybeEnd = false,\n            ch;\n        while (ch = stream.next()) {\n            if (ch == \"/\" && maybeEnd) {\n                state.tokenize = null;\n                break;\n            }\n            maybeEnd = ch == \"*\";\n        }\n        return \"comment\";\n    }\n\n    function maybeEOL(stream, state) {\n        if (parserConfig.typeFirstDefinitions && stream.eol() && isTopScope(state.context)) state.typeAtEndOfLine = typeBefore(stream, state, stream.pos);\n    }\n    // Interface\n    return {\n        startState: function startState(basecolumn) {\n            return {\n                tokenize: null,\n                context: new Context((basecolumn || 0) - indentUnit, 0, \"top\", null, false),\n                indented: 0,\n                startOfLine: true,\n                prevToken: null\n            };\n        },\n        token: function token(stream, state) {\n            var ctx = state.context;\n            if (stream.sol()) {\n                if (ctx.align == null) ctx.align = false;\n                state.indented = stream.indentation();\n                state.startOfLine = true;\n            }\n            if (stream.eatSpace()) {\n                maybeEOL(stream, state);\n                return null;\n            }\n            curPunc = isDefKeyword = null;\n            var style = (state.tokenize || tokenBase)(stream, state);\n            if (style == \"comment\" || style == \"meta\") return style;\n            if (ctx.align == null) ctx.align = true;\n            if (curPunc == \";\" || curPunc == \":\" || curPunc == \",\" && stream.match(/^\\s*(?:\\/\\/.*)?$/, false)) while (state.context.type == \"statement\") {\n                popContext(state);\n            } else if (curPunc == \"{\") pushContext(state, stream.column(), \"}\");\n            else if (curPunc == \"[\") pushContext(state, stream.column(), \"]\");\n            else if (curPunc == \"(\") pushContext(state, stream.column(), \")\");\n            else if (curPunc == \"}\") {\n                while (ctx.type == \"statement\") {\n                    ctx = popContext(state);\n                }\n                if (ctx.type == \"}\") ctx = popContext(state);\n                while (ctx.type == \"statement\") {\n                    ctx = popContext(state);\n                }\n            } else if (curPunc == ctx.type) popContext(state);\n            else if (indentStatements && ((ctx.type == \"}\" || ctx.type == \"top\") && curPunc != \";\" || ctx.type == \"statement\" && curPunc == \"newstatement\")) {\n                pushContext(state, stream.column(), \"statement\", stream.current());\n            }\n            if (style == \"variable\" && (state.prevToken == \"def\" || parserConfig.typeFirstDefinitions && typeBefore(stream, state, stream.start) && isTopScope(state.context) && stream.match(/^\\s*\\(/, false))) style = \"def\";\n            if (hooks.token) {\n                var result = hooks.token(stream, state, style);\n                if (result !== undefined) style = result;\n            }\n            if (style == \"def\" && parserConfig.styleDefs === false) style = \"variable\";\n            state.startOfLine = false;\n            state.prevToken = isDefKeyword ? \"def\" : style || curPunc;\n            maybeEOL(stream, state);\n            return style;\n        },\n        indent: function indent(state, textAfter) {\n            if (state.tokenize != tokenBase && state.tokenize != null || state.typeAtEndOfLine) return CodeMirror.Pass;\n            var ctx = state.context,\n                firstChar = textAfter && textAfter.charAt(0);\n            if (ctx.type == \"statement\" && firstChar == \"}\") ctx = ctx.prev;\n            if (parserConfig.dontIndentStatements) while (ctx.type == \"statement\" && parserConfig.dontIndentStatements.test(ctx.info)) {\n                ctx = ctx.prev;\n            }\n            if (hooks.indent) {\n                var hook = hooks.indent(state, ctx, textAfter);\n                if (typeof hook == \"number\") return hook;\n            }\n            var closing = firstChar == ctx.type;\n            var switchBlock = ctx.prev && ctx.prev.info == \"switch\";\n            if (parserConfig.allmanIndentation && /[{(]/.test(firstChar)) {\n                while (ctx.type != \"top\" && ctx.type != \"}\") {\n                    ctx = ctx.prev;\n                }\n                return ctx.indented;\n            }\n            if (ctx.type == \"statement\") return ctx.indented + (firstChar == \"{\" ? 0 : statementIndentUnit);\n            if (ctx.align && (!dontAlignCalls || ctx.type != \")\")) return ctx.column + (closing ? 0 : 1);\n            if (ctx.type == \")\" && !closing) return ctx.indented + statementIndentUnit;\n            return ctx.indented + (closing ? 0 : indentUnit) + (!closing && switchBlock && !/^(?:case|default)\\b/.test(textAfter) ? indentUnit : 0);\n        },\n        electricInput: indentSwitch ? /^\\s*(?:case .*?:|default:|\\{\\}?|\\})$/ : /^\\s*[{}]$/,\n        blockCommentStart: \"/*\",\n        blockCommentEnd: \"*/\",\n        lineComment: \"//\",\n        fold: \"brace\"\n    };\n});\n\nfunction words(str) {\n    var obj = {},\n        words = str.split(\" \");\n    for (var i = 0; i < words.length; ++i) {\n        obj[words[i]] = true;\n    }\n    return obj;\n}\n\nfunction contains(words, word) {\n    if (typeof words === \"function\") {\n        return words(word);\n    } else {\n        return words.propertyIsEnumerable(word);\n    }\n}\n\nfunction def(mimes, mode) {\n    if (typeof mimes == \"string\") mimes = [mimes];\n    var words = [];\n\n    function add(obj) {\n        if (obj) for (var prop in obj) {\n            if (obj.hasOwnProperty(prop)) words.push(prop);\n        }\n    }\n\n    function addServerSideHints() {\n        $('#loaderImage').show();\n        oboe('/getAllApexClassesNames').done(function(data) {\n            var arrayLength = data.length;\n            for (var i = 0; i < arrayLength; i++) {\n                words.push(data[i].name);\n            }\n        }).fail(function() {\n            console.log('error getAllApexClasses');\n        });\n        oboe('/utilities/longProcessStream').done(function(data) {\n            if (data) {\n                words.push(data);\n            }\n        }).fail(function(errorReport) {\n            console.log(errorReport);\n        });\n        $('#loaderImage').hide();\n    }\n    add(mode.keywords);\n    add(mode.types);\n    add(mode.builtin);\n    add(mode.atoms);\n    addServerSideHints();\n    console.log(words);\n    if (words.length) {\n        mode.helperType = mimes[0];\n        CodeMirror.registerHelper(\"hintWords\", mimes[0], words);\n    }\n    for (var i = 0; i < mimes.length; ++i) {\n        CodeMirror.defineMIME(mimes[i], mode);\n    }\n}\ndef(\"text/x-apex\", {\n    name: \"apex\",\n    keywords: words( // From Java\n    \"abstract assert break catch class const continue default \" + \"do else enum extends final finally float for if implements \" + \"instanceof interface new package private protected public \" + \"return static super this throw try while \" +\n    // Apex only\n    \"global continue decimal default future tolabel webservice \" + \"virtual with sharing test \" +\n    // SOQL\n    \"and AND as AS asc ASC bulk BULK by BY commit COMMIT delete \" + \"DELETE from FROM insert INSERT last_90_days last_month \" + \"last_n_days last_week LAST_90_DAYS LAST_MONTH LAST_N_DAYS \" + \"LAST_WEEK like LIKE limit LIMIT merge MERGE not NOT on ON \" + \"or OR rollback ROLLBACK select SELECT set SET sort SORT \" + \"this_week THIS_WEEK today TODAY tomorrow TOMORROW undelete \" + \"UNDELETE update UPDATE upsert UPSERT where WHERE yesterday \" + \"YESTERDAY using USING convertcurrency CONVERTCURRENCY after \" + \"AFTER before BEFORE count COUNT excludes EXCLUDES first FIRST \" + \"includes INCLUDES last LAST order ORDER\"),\n    types: words(\"byte short int long float double boolean void Boolean Byte \" + \"Character Double Float Integer Long Number Object Short String \" + \"Void blob Blob RestContext System system\"),\n    blockKeywords: words(\"catch class do else finally for if try while\"),\n    defKeywords: words(\"class interface package enum\"),\n    typeFirstDefinitions: true,\n    atoms: words(\"true false null nulls TRUE FALSE NULL NULLS\"),\n    hooks: {\n        \"@\": function _(stream) {\n            stream.eatWhile(/[\\w\\$_]/);\n            return \"meta\";\n        }\n    },\n    modeProps: {\n        fold: [\"brace\"]\n    }\n});\n\n});`\nThen modified fromList a bit to work for \".\"\n`\nCodeMirror.registerHelper(\"hint\", \"fromList\", function(cm, options) {\n        var cur = cm.getCursor();\n        var token = cm.getTokenAt(cur);\n        var orgch = cur.ch;\n        if (token.string == '.') {\n            cur.ch = cur.ch - 1;\n            token = cm.getTokenAt(cur);\n            token.end = orgch;\n            cur.ch = orgch;\n            var to = CodeMirror.Pos(cur.line, token.end);\n            if (token.string && /\\w/.test(token.string[token.string.length - 1])) {\n                var term = token.string,\n                    from = CodeMirror.Pos(cur.line, token.end);\n            } else {\n                var term = \"\",\n                    from = to;\n            }\n            var found = [];\n            for (var i = 0; i < options.words.length; i++) {\n                var word = options.words[i];\n                if (word) {\n                    if (!(typeof word === 'string' || word instanceof String)) {\n                        if (word.className && word.className.toLowerCase() == term.toLowerCase()) {\n                            for (var j = 0; j < word.methodsNames.length; j++) {\n                                found.push(word.methodsNames[j]);\n                            }\n                        }\n                    }\n                }\n            }\n            if (found.length) return {\n                list: found,\n                from: from,\n                to: to\n            };\n        } else {\n            var term, from = CodeMirror.Pos(cur.line, token.start),\n                to = cur\n            if (token.start < cur.ch && /\\w/.test(token.string.charAt(cur.ch - token.start - 1))) {\n                term = token.string.substr(0, cur.ch - token.start)\n            } else {\n                term = \"\"\n                from = cur\n            }\n            var found = [];\n            var methodCompletion = false;\n            var methodFound = [];\n            for (var i = 0; i < options.words.length; i++) {\n                var word = options.words[i];\n                if (word && (typeof word === 'string' || word instanceof String) && word.toLowerCase().slice(0, term.length) == term.toLowerCase()) {\n                    if (!(word.toLowerCase().indexOf('+') > -1)) {\n                        found.push(word);\n                    }\n                } else if (!(typeof word === 'string' || word instanceof String)) {\n                    if (token.state.context.info && token.state.context.info.toLowerCase() == word.className.toLowerCase()) {\n                        for (var j = 0; j < word.methodsNames.length; j++) {\n                            if (word.methodsNames[j].toLowerCase().slice(0, term.length) == term.toLowerCase()) {\n                                methodCompletion = true;\n                                methodFound.push(word.methodsNames[j]);\n                            }\n                        }\n                    }\n                }\n            }\n            if (methodCompletion) {\n                return {\n                    list: methodFound,\n                    from: from,\n                    to: to\n                };\n            }\n            if (found.length) return {\n                list: found,\n                from: from,\n                to: to\n            };\n        }\n    });`. Yep, understood the issue, thanks.. @marijnh \nBut how to detect inside codemirror that the sentence is a String? So that I can pull that out and pass it through my code while running indentation from CodeMirror?. ",
    "advanceddeveloper": "@marijnh \n\nCorner cases like this which are unlikely to show up in real code don't interest me too much\n\nI agree that some of these are very unlikely to appear in a real code (like anonymous class as the first operand of a division operator), but some of them are actually found in real scripts (modules from node package manager, which are considered as a real code (I think)).\nSo, I guess my question is why do you consider ~{async a(){}} as an \"unreal\" code? Forget about bitwise negation operator, what we have here is an object with asynchronous method a. It is pretty common to define a method in anonymous object and it is common to declare some methods asynchronous. Like you would declare asycnhronous methods in a class, but here we don't need to instantiate it, we just have such method of the object literal (which is useful when we use some object only once (no need to declare whole class in order to instantiate it)).\nHere is my opinion about these cases:\n\n~{async a(){}} - As I explained above, it is found in a real script\n/a/s - Thanks for the fix\n~class{}/a - I agree this one is probably not worth fixing, since it is useless unless someone modify Function.prototype[Symbol.toPrimitive], which is considered as a bad practice in general, so I think this edge case can be considered as a code which doesn't appear in real scripts\na+ ++/a/[a] - I don't see why you don't consider this as a real code. Funstions and regex objects (unlike numbers, strings and booleans) may contain arbitrary number of properties. Therefore, storing (and uptading) a property in a regex object is something common. Here is an example how it can be used:\n\n\nExample (click to expand)\n\n```js\n'use strict';\n\nvar prop = 'count';\nvar regex = /a{2}/;\nvar string = 'a'.repeat(5);\n\nregex[prop] = 0;\n\ndo{\n  var match = string.match(regex);\n  if(match === null) break;\n  console.log('Count: ' + ++regex[prop]);\n  string = string.substring(match.index + match[0].length);\n}while(1);\n```\n\n\n\nfor(a of /a/) - Similar to the third example, I think this one may be considered as a bad code. It is useless unless someone defines RegExp.prototype[Symbol.iterator], which is again bad practice, so I think this may be considered as wontfix.\n\n\nTo summarize, here are my thoughts:\n\nExample 1: worth fixing\nExample 2: fixed\nExample 3: not worth fixing\nExample 4: debatable\nExample 5: not worth fixing\n\nExample 4 is actually debatable, since the syntax breaks only with regex literal, not when identifier is there (which has a reference to a regex), but modifying (incrementing) properties of regex literal doesn't make sense, so I think this one may be considered not worth fixing, but I'm not sure.\nI would like to submit pull requests for these examples, but I would like to hear from you which of these are worth fixing (according to all the explanations and example use cases I posted above), because I don't think it is worth spending time on fixing something which will never be used in real code.\nAlso, don't let single-char variable names confuse you, if I posted it as a larger code with larger variable names and proper indent levels, maybe it would affect the way someone judges the code. These example are reduced as much as possible, but it doesn't mean they would appear in that exact form in a real code.\nMy idea is me to submit fixes for example 2 and 4 (if it is worth fixing), but I would like firstly to hear what you think about it.\n\nWhat is the definition of a \"real\" code\nI found a lot more JavaScript syntax highlighting issues, so I would like to know what is the criterion for distinguishing between \"real\" and \"unreal\" code. Therefore, I would suggest the following definition:\nA code is considered as a \"real\" code (and thus if the highlighting is broken, it should be fixed) if all the following conditions are satisfied:\n\nIt is a valid JavaScript syntax according to the latest official EcmaScript standard specification\nThe code itself is deterministic and produces the exact same output independedtly of the environment it runs in\nThe code doesn't throw SynaxErrors or any other type of throwable values\nThe code uses the core part of the syntax provided to exploit JavaScript capabilities in order to store, modify or obtain non-trivial properties of some native JavaScript objects\nIt doesn't modify (redefine, override, delete, or add) properties or functionalities to JavaScript native prototypes\nThe code can be found in at least one widely used JavaScript source file (debatable, see below)\nThe code works properly in strict mode\n\nAccording to these requirements, the examples I reported satisfy:\n\n~{async a(){}} - Satisfies all the conditions\n/a/s - Same, but it is already fixed\n~class{}/a - Doesn't satisfy conditions 5 and 6\na+ ++/a/[a] - Doesn't satisfy 2 and 6 (violates 2 because it needs to be run in exatly the same form (regex should not be stored to a variable) in order to produce useful results, otherwise violates 4)\nfor(a of /a/) - Doesn't satisfy 5 and 6\n\nCondition 6 is indeed debatable, since the fact that some syntax structure doesn't appear in a widely used script (the definition of \"widely used\" is debatable itself) doesn't mean it would not be used in a near future.\nMy question is what do you think about these reuirements. Do you follow them when you determine which script is worth and which isn't worth fixing, or do you have some other rules to apply here? I would like to work on improving CodeMirror's JavaScript mode script in order to fix a lot of new highlighting issues (which are also brought by new ES standard), but I'm not sure which ones are worth and which aren't worth fixing.\nThanks.. @marijnh\nAny thoughts about that?. ",
    "goldsmcb": "Nice I didn't know about the addClass and rmClass utilities, hows this new commit looking?. Awesome! Any chance you could tell me when the next release would be?. ",
    "paddya": "@marijnh Yes! And it is so much simpler. I will change it.. Thank you!. ",
    "vgavro": "'\ud83d\udc7d'.length === 2 well, token parser works the same. Looks like not codemirror, but javascript unicode problem... https://mathiasbynens.be/notes/javascript-unicode Also found related ticket https://github.com/codemirror/CodeMirror/issues/1578 and i'm going to resolve this issue in other way, so this can be closed I guess.... ",
    "Pahkis": "Hi marijnh,\nThanks for the pointer :)\nInstallation Readme file sais:\nEither get the zip file with\nthe latest version, or make sure you have Node\ninstalled and run:    npm install codemirror\nThe zip file is what I had before and is not detected even though the codemirror.js file is in the lib directory. That is why I went looking for it on git and found the codemirror-master.\nNever used npm before - leaves me confused!\nI downloaded node.js and placed/extracted it in a holding directory just above the Drupal root directory.\nWhat then? Do I just run the install command from the cli or browser whilst in the node.js app directory? Then where does it go?\nKr,\nChris\n. ",
    "guidorice": "A puzzler because the warning does not make sense in the context of the line of source shown.. ",
    "dsandstrom": "For what it's worth, Chrome is calling out this line for me: https://github.com/codemirror/CodeMirror/blob/2c741bd6742678f67e812307b2f78db4f4566d9d/src/display/update_display.js#L259\nError message: \n\nUsing unescaped '#' characters in a data URI body is deprecated and will be removed in M68, around July 2018. Please use '%23' instead. See https://www.chromestatus.com/features/5656049583390720 for more details.\n\nDigging deeper, it happens because measure is undefined.  \nmeasureForScrollbars is returning nil for me:\nhttps://github.com/codemirror/CodeMirror/blob/2c741bd6742678f67e812307b2f78db4f4566d9d/src/display/update_display.js#L178. ",
    "diparthshah": "Search works fine when using search dialog functionality. But it doesn't works when i use above RegExp and pass it to getSearchCursor() . Other RegExp except above one works fine too. . Sir,\nmy string is : to myword\nstring before to can vary.\nRegular expression:  searchq = new RegExp(\"^\\\\s*to myword\")\ncall:  cursor = getSearchCursor(searchq)\nAny clue where i am going wrong ? . coffeescript\n    searchQuery = new RegExp(\"^\\\\s*to setup\")\n    cursor = @_editor.getSearchCursor(searchQuery)\n    if !cursor.findNext()\n      cursor = @_editor.getSearchCursor(searchQuery)\n    @_editor.setSelection(cursor.from(), cursor.to()). @marijnh any issue with above code ? . ",
    "rxin": "Thanks @marijnh !\n. ",
    "krzysztof-miemiec": "It never happened with any other library I worked with, so I'd count it as a CodeMirror issue. \ud83d\ude15\nNevertheless, I'll be waiting for a rewrite!. ",
    "EmmanuelP": "Understood. Thanks.. ",
    "TrevorBurnham": "Ah, that makes sense. Thank you. I'm going to change the behavior in my app to something like \"Use {extraKeys: {Tab: false}} unless the user clicked into the CodeMirror instance.\" Maybe that should be the default behavior?. ",
    "alexisdoualle": "Thank you for the feedback. I understand that this implementation isn't really up to par; any ideas for improvement are greatly appreciated. What would be needed to have it included to CM?\nI will continue to work on it, even if it won't be merged into the code base, because it's the only way I found to work with HTML tags in bidi text.\nGood news about that redesign, is there a way to monitor its progress?. Yes, I only saw the need to clear the cache for the current line. Why should all caches be cleared? Isn't the order specific to a single line?. You're right, I'll try to find a solution to that. Is there an option to prevent certain markers from overlapping each other?. The \"atomic\" parameter was first called \"isolate\" (I probably should have left it that way), because I only added it for the new option I'm working on. I renamed it to \"atomic\" because it was only needed when an isolate segment is also atomic, to prevent the cursor from appearing within the atomic isolate segment, and instead make it appear on the far side of it.. I added a function to check that isolate ranges do not overlap, in the same style as conflictingCollapsedRange() 3b6c52cffe13be95725de9ab02d87cdcf1312a27. ",
    "Anu1601CS": "Thanks for replying :)\nIs this possible using the keyboard buttons ?\n. What is difference between readOnly: true and readOnly: 'nocursor'. I think both are same?. @jdbruxelles Thanks, I got my answer :). ",
    "laobubu": "Tested. Both tagName and context are null.. - [x] Added test cases\n- [x] Fix: compatibility with htmlmixed mode (previously only tested with xml mode). ",
    "rinu": "I found the extraKeys option hidden in the demo. Works perfectly now, thanks.. ",
    "atavory": "OK, thanks for the useful link, and sorry for missing this in the guidelines.. ",
    "ehhc": "Okay. Thanks :). ",
    "sanatankc": "Is there any way I can temporarily hack it to work for android?. ",
    "defcc": "You could check the latest version here https://codemirror.net/demo/vim.html. I test your case with Chrome/Mac, it works as expected.. navigator exists in browser environment. Are you trying to run codemirror in Node environment? \nCould you please provide a reproduction repository with your code?. The same issue as https://github.com/codemirror/CodeMirror/issues/5470\nYou need to run Codemirror in the client side.. IMHO this should be an expected behavior, as Codemirror markdown mode is live preview.. ",
    "swframe": "You are correct; it is working correctly at the demo site. Thanks for test it. I can close the issue. \n. ",
    "lorenzosim": "Thanks!. ",
    "kkimdev": "I see. Yeah, I totally agree and understand that it's a bit too early to tell if custom elements is the way to go, and we should be conservative about that.\nThough I want to comment regarding the compatibility.  Currently, Edge browser is only the major browser that doesn't support custom elements yet, and on their feature status dashboard, custom elements is the top voted feature https://developer.microsoft.com/en-us/microsoft-edge/platform/status/customelements/?q=sort%3AVotes .\nAlso, I think this should be treated as like any other new js features regarding the compatibility.  It will take quite many years for all the target browser&versions to support new js features like const, generators, es6 module, etc, but we can still take advantage of them today since we transpile and poyfills are available.  So I think compatibility on target platforms should not a blocker.. ",
    "MichaelBelgium": "The parameters worked as hints next to the tables, if I did ctrl+space it showed the tables and the parameters. But the parameters part doesn't work anymore. Either I missed something or this worked before but wasn't intend to do - or this could be a suggestion in that way. Well, is there any other alternative to add custom hints to sql-hint otherwise?. ",
    "Sophia-nguyen": "Thanks @marijnh, and could you please help me for example:\nThis is my code \nthis.cssEditor = CodeMirror.fromTextArea(this.element.find(\"#cssEditor\")[0], {\n     lineNumbers: true,\n     mode: \"css\",\n     gutters: [\"CodeMirror-lint-markers\"],\n     lint: true\n});\nHow can I add options?. Thanks @marijnh, I'm using an old version, I will update and try that.. ",
    "futurist": "Ah, noticed replaceRange is a good wrapper for makeChange, thank you very much!\n. After tested with the patch, the performance is improved, but still have noticeable lag.\nCan it be better for below?\n\n\nfor old browsers, keep it as is\n\n\nfor modern browsers, use modern way\n\n\nBefore resize, check cell visibility, e.g. using \nhttps://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n\n\nOnly resize visible cells, keep others untouched\n\n\nWhen cell scroll into viewport, trigger a resize event to itself\n\n\nJust a note for this issue, priority is very low....\n. The problem maybe the invalid char, when open a big one line JS file (also 5M), CM seems right. When reduce the file size to 200B, CM opened but shows too many cm-invalidchar element.\n\n. ",
    "vsaranea": "How do I get access to the second document?\nThe MergeView documentation is quite lacking.... Thanks.\nIs there any way to have a simple diff view, without having to pass in a value or orig (i.e. how to I just pass in an old and new?). It is non-editable (allowEditingOriginals: false), and I just want to deal with it in the simplest way possible.\nCurrently I am using origLeft and value together, but then I can't access .right.chunks?\nOr is there a way to get a .value.chunks equivalent?. I got it working:\n```\nfunction AnnotateDiffBar(diffView: CodeMirror.MergeView.MergeViewEditor) {\n    var chunks = diffView.leftChunks();\nvar leftAnnotations = (diffView.leftOriginal() as any).annotateScrollbar('marker');\nvar rightAnnotations = (diffView.editor() as any).annotateScrollbar('marker');\n\nvar ranges = [];\nfor (var i = 0; i < chunks.length; i++) {\n    var rangeEnd = chunks[i].editTo - 1;\n    if (chunks[i].editTo < diffView.editor().getDoc().lineCount() && i < 4) {\n        rangeEnd = rangeEnd + 1;\n    }\n    ranges.push({ from: { line: chunks[i].editFrom }, to: { line: rangeEnd } });\n}\n\nleftAnnotations.update(ranges);\nrightAnnotations.update(ranges);\n\n}\n```\nThanks for the assistance!. Unfortunately no, there's no flex directly involved. \nBased on your suggestions, I've tried adding a div wrapper, as well as setting that div (and even the  parent) to display:block/table-layout:fixed. Still no luck :(\n(I did get the merge view vertical height business sorted out, I was just settings things a bit too deep - adding a css rule for .CoreMirror-merge worked). Could this be because it's in a table?. Got it working by setting the parent's parent's div container's width directly (and not relying on flex-xxx, especially flex-basis). I suspect it has to do with LineWidget interactions. I did play around with setting the scrollButtonHeight option as shown, but it made no difference. When I instead set the option directly on the diffView variable, the annotations stopped appearing at all.. Here we go, minimum to reproduce.\nHow it renders with CodeMirror:\n\nFor comparison, see the diff view in BeyondCompare:\n\nAnd in case jsfiddle eats this up:\n```typescript\nfunction MarkDiffScrollBar(diffView: CodeMirror.MergeView.MergeViewEditor) {\n    try {\n        (diffView.leftOriginal() as any).setOption(\"scrollButtonHeight\", 18);\n        (diffView.editor() as any).setOption(\"scrollButtonHeight\", 18);\n    // Uncommenting this line causes the annotations to break\n    //(diffView).setOption(\"scrollButtonHeight\", 18);\n\n    var leftAnnotations = (diffView.leftOriginal() as any).annotateScrollbar('marker');\n    var rightAnnotations = (diffView.editor() as any).annotateScrollbar('marker');\n\n    var leftchunks = diffView.leftChunks();\n    var leftranges = [];\n    for (var i = 0; i < leftchunks.length; i++) {\n        var rangeEnd = leftchunks[i].editTo - 1;\n        if (leftchunks[i].editTo < diffView.leftOriginal().getDoc().lineCount() && i < 4) {\n            rangeEnd = rangeEnd + 1;\n        }\n        leftranges.push({ from: { line: leftchunks[i].editFrom }, to: { line: rangeEnd } });\n    }\n    leftAnnotations.update(leftranges);\n\n    var rightchunks = diffView.leftChunks(); // diffView.rightChunks(); // doesn't work??\n    var rightranges = [];\n    for (var i = 0; i < rightchunks.length; i++) {\n        var rangeEnd = rightchunks[i].editTo - 1;\n        if (rightchunks[i].editTo < diffView.editor().getDoc().lineCount() && i < 4) {\n            rangeEnd = rangeEnd + 1;\n        }\n        rightranges.push({ from: { line: rightchunks[i].editFrom }, to: { line: rangeEnd } });\n    }\n    rightAnnotations.update(rightranges);\n}\ncatch (error) {\n    console.error(\"Some kind of error internally in codemirror - caught to prevent script freeze\");\n    console.log(\"Caught inside MarkDiffScrollBar\");\n    console.error(error);\n}\n\n}\nfunction DoDiff(diffDiv: HTMLElement, oldText: string, newText: string) {\nif (typeof CodeMirror != \"undefined\") {\n    mode = {\n        mode: null,\n        mime: \"c-like\" // just use c-like highlighting if we can't figure out what it is\n    }\n\n    var diffOptions: CodeMirror.MergeView.MergeViewEditorConfiguration = {\n        origLeft: oldText,\n        //origRight: newText,\n        value: newText,\n\n        lineNumbers: true,\n        mode: mode.mime,\n        showDifferences: true,\n        collapseIdentical: false,\n        allowEditingOriginals: false,\n        foldGutter: false,\n        flattenSpans: true,\n        gutters: [\"CodeMirror-linenumbers\"],\n        revertButtons: false,\n        readOnly: true,\n        tabSize: 4,\n        lineWrapping: true\n    };\n\n    var diffView = CodeMirror.MergeView(diffDiv, diffOptions);\n\n    MarkDiffScrollBar(diffView);\n}\nelse\n{\n        console.error(\"Couldn't load codemirror?\");\n}\n\n}\njQuery.get(\"https://gist.githubusercontent.com/vsaranea/e520af2b0c8f2bf8cd5f5641dd8c2dde/raw/56a2b4e3c8885933d7a37e2ff78b1b985118f07a/lorem-1.txt\", function( oldtext ) {\n    jQuery.get(\"https://gist.githubusercontent.com/vsaranea/1052323d4fdcabae485cc1b04c997746/raw/e3d65d24400f027e9358e696d01a20e8e8a71021/lorem-2.txt\", function( newtext ) {\n                var target = document.getElementById(\"view\");\n        DoDiff(target, oldtext, newtext);\n    });\n});\n```\n```html\n<!doctype html>\nCodeMirror: merge scrollbar issue\n\n\n\n\n\n\n\n\n\n\nmerge issue\n\n\n```\ncss\n.marker {\n    background: rgba(0,0,255,100);\n}. I've tried updating it as per your recommendations, but the diff is still very off (also this particular example seems exceptionally bad at doing the diff, there are literally 3 lines different but it seems to calculate many spans)\n. I think the issue is likely tied to the interaction between annotate and merge view.. ",
    "correnson": "Great!. Fair enough \ud83d\udc4d . ",
    "AdamZaczek": "Thanks @correnson, works like a charm !. ",
    "onfuns": "Thanks,Solved my problem.. ",
    "MatzYang": "I were solve this issue by call refresh method after setValue method.. ",
    "bgadrian": "Thank you! Can you pinpoint to the code that gets the element height? Maybe it helps me to find the problem.\nThe first refresh is done after the Document.load so the CSS should be stable at that time.. I can confirm that it is a layout issue, the clientHeight in visibleLines was the source of the bug, so it was not the fault of CodeMirror. \nThanks for the assistance!. ",
    "yuki-takei": "@marijnh \nThank you for your reply.\nI do not know details about what conditions trigger such a situation. The following are guesses.\nCase A\n\nCodeMirror.defineOption(\"autoRefresh\", ... is invoked first\nCodeMirror.fromTextArea is invoked\n\nIt's simple and works fine.\nCase B\nBut we ( scniro/react-codemirror2 users including me ) are using webpack and babel, confronted with unfamiliar situation.\nMaybe..\n\nA react-codemirror2 instance is initialized\nCodeMirror DOM is visible\ncm.display.wrapper.offsetHeight set\n\n\nCodeMirror.defineOption(\"autoRefresh\", ... is invoked\nstartListening is NOT invoked\n\n\n\nI found this situation by debugging with browser. Perhaps, 1 and 2 may be processed at the same time.\nOne thing I can say for sure is that this option will help us and doesn't be evil for others.\n. # Why do you have the confirmation?\n@marijnh \n\nyou can just call .refresh() on your editor directly\n\nWe want to do it if it is easy.\n\nmake the autorefresh addon a dependency of the module that initializes the editor, to make sure it's loaded first\n\nWe really want to do it if it is easy. Please see scniro/react-codemirror2#83 .\n\nThis option seems like a confusing kludge\n\nExactly. The current uncertain and defective code has produced this PR.\nConversely, how about it?\nBefore (Current)\nif (val && cm.display.wrapper.offsetHeight == 0)\n  startListening(cm, cm.state.autoRefresh = {delay: val.delay || 250})\nAfter (New proposal)\nif (val && cm.display.wrapper.offsetHeight == 0 && cm.display.lastWrapHeight != cm.display.wrapper.clientHeight)\n  startListening(cm, cm.state.autoRefresh = {delay: val.delay || 250})\nThe defect of current code\n\nI consider that the instance might be already refreshed if cm.display.lastWrapHeight equals cm.display.wrapper.clientHeight\nIt is checked in check() function\n\n\nWhy do you have the confirmation that cm.display.lastWrapHeight ALWAYS EQUALS cm.display.wrapper.clientHeight when cm.display.wrapper.offsetHeight == 0?\nIt is possible that the relationship does not hold.\nIt is possible that cm.display.wrapper.offsetHeight changes multiple times in initializing process in complex environments\ne.g. using with react, angular, splitting chanks with webpack, packing DLLs with webpack, lazy loading some modules ...\n\n\n\n\n\nPros of the new proposal\n\nCertainly refreshed even if under the situation that cm.display.wrapper.offsetHeight is not zero and the instance is not refreshed yet\nYou need not to add 'force' option\n\nCons of the new proposal\n\nNothing\nHow much processing costs are increased?. \n\n\n",
    "atteeela": "@marijnh We are trying to pre-render with Server Side Rendering and then shown to the user ahead of time.\nDo you have any suggestions on the best way we can overcome this problem?  Perhaps we can detect navigator or just node load Code Mirror when we are rendering via SSR.\nThanks,. ",
    "alistaircolling": "Thanks for your detailed response\n. ",
    "Ly-lns": "ok,thanks.. ",
    "martinschilliger": "Found the solution here:\njavascript\n[contenteditable=\"true\"] {\n    -webkit-user-select: text;\n    user-select: text;\n}. Just:\nCSS\n[contenteditable=\"true\"] {\n  user-select: text;\n}\ncodemirror.hasFocus() is working that way also. \ud83d\udc4d. ",
    "The-Peppester": "(P.S. I am the same guy as AnonyCo, but on a different P.C.)\nMarinjh, let me first answer your question about the fall back. As seen here, direct native setImmediate has unfortunately been removed from the standard. and very few browsers support it (neitor Chrome, Firefox, nor Safari support it). Thus, a polyfill/alternative is required since the browsers that do not support setImmediate carry the majority of internet users. However, I can assure you that this alternative setImmediate I have put in is just as good as the real thing. To prove this, open up a new tab in your browser at example.com. Then, run the below code in the console.\nJavascript\n(() => {\n  \"use strict\";\n    const setImmediateOrFallBack = (() => {\n      if (typeof setImmediate !== \"undefined\") return setImmediate // for IE10+\n      if (typeof MessageChannel === \"undefined\") return setTimeout // for IE9 and below\n      const msgChannel = new MessageChannel\n      const port1 = msgChannel.port1\n      const port2 = msgChannel.port2\n      const postMessage = port2.postMessage.bind(port2)\n      var waitingImmediates = null\n      var immediatesLen = 0\n      port1.onmessage = () => {\n        var curImmediates = waitingImmediates\n        waitingImmediates = null\n        for (var i = 0; i !== immediatesLen; i++) {\n          curImmediates[i]( /*no arguments*/ )\n        }\n      }\n      return f => {\n        if (waitingImmediates === null) {\n          waitingImmediates = [ f ]\n          postMessage( undefined )\n          immediatesLen = 1\n        } else {\n          waitingImmediates.push( f )\n          immediatesLen += 1\n        }\n      }\n    })()\n    var i = 1000000\n    console.log(\"starting!\");\n    setImmediateOrFallBack(function doNext(){\n    if (i--) {\n      setImmediateOrFallBack(doNext)\n        } else {\n      console.log(\"All Done!\")\n        }\n    })\n})()\nAfter running the above code in the console, try interacting with the page (selecting text and what-not). Then, open up a task manager and observe that the page is using up 100% of the CPU power for its thread (100/#virtual_threads% of the total CPU power). Now, try closing the page and observe that even page close events are not blocked. As you can see, this polyfill for setImmediate is non-blocking which is incredibly good for the UI while at the same tie saving power because there is only a minimal delay. As for browsers that natively support a setImmediate like this, which are IE10+ and Edge, I think that it would be a shame if we did not take advantage of native support in those browsers. \nAs for your second question about the second argument to setTimeout, I am pretty certain that the second argument to setTimeout is coerced to an integer. Thus, when the second argument is undefined, that undefined is coerced to an integer, resulting in 0 like so.\nJavascript\nundefined | 0 === 0 // is true\nTo prove this for absolute certain, I did tests in the two browsers that will use the setTimeout fallback: IE8 and IE9. I used IETester and the result (shown below in images) conclusively prove that when there is no second argument to setTimeout, setTimeout behaves as if the second argument is 0. Please open the images in a new tab for a better view of them.\nInternet Explorer 8:\n\nInternet Explorer 9:\n\n. ",
    "anonyco": "marijnh, for the issue of the polyfill size, I have run my code through the closure compiler and, as seen below, there will only be a 367 byte increase (before gzip is applied).\nJavascript\nvar setImmediateOrFallBack=function(){if(\"undefined\"!==typeof setImmediate)return setImmediate;if(\"undefined\"===typeof MessageChannel)return setTimeout;var e=new MessageChannel,f=e.port2,g=f.postMessage.bind(f),a=null,c=0;e.port1.onmessage=function(){var b=a;a=null;for(var d=0;d!==c;d++)b[d]()};return function(b){null===a?(a=[b],g(void 0),c=1):(a.push(b),c+=1)}}();\nIf you want to sacrifice a little performance for a smaller size, then we can even make that 237 bytes before gzipped.\nSource Code (564 bytes):\nJavascript\nconst setImmediateOrFallBack = self.setImmediate /*IE10+*/ || (MessageChannel => { // for all others\n  if (!MessageChannel) return setTimeout; // for IE9 and below\n  const msgChannel = new MessageChannel\n  const waitingImmediates = []\n  var immediatesLen = 0;\n  msgChannel.port1.onmessage = () => {\n    while (immediatesLen) {\n      waitingImmediates.shift()( /*no arguments*/ )\n      immediatesLen--\n    }\n  }\n  return f => {\n    if (!immediatesLen) msgChannel.port2.postMessage( 0 )\n    immediatesLen = waitingImmediates.push( f )\n  }\n})(self.MessageChannel)\nCompressed (237 bytes without gzip):\nJavascript\nvar setImmediateOrFallBack=self.setImmediate||function(a){if(!a)return setTimeout;var c=new a,d=[],b=0;c.port1.onmessage=function(){for(;b;)d.shift()(),b--};return function(a){b||c.port2.postMessage(0);b=d.push(a)}}(self.MessageChannel);\nNext, for the issue of how this could be practical, please see my code. This setImmediate function will be used in every single signalLater call. I have often seen signalLater used quite frequently in the CodeMirror source code. With this change that I am proposing, every single place in the entire CodeMirror code that uses signalLater will receive a major power-saving performance benefit that will make CodeMirror a lot more appealing and practical to many more people. For me personally, I would consider 237 un-gzipped bytes of code to be negligible sacrifice for the tremendous power savings that it would bring.\nLastly, there is no issue. This proposal does not fix any code since the code was already working before. Rather, this proposal simply makes the existing code better.\n. Marijn, thank you for clarifying that. I now understand. I am very glad that you have reached the best decision for the future of CodeMirror. Thank you for your time.. ",
    "michaelgmcd": "I accepted this as the expected behavior. I haven't thought much about workarounds.. ",
    "the-j0k3r": "Thanks to both of you ;). CC @Mottie . ",
    "Elvincth": "Tested , yes same issue!. Fixed 229 is the backspace key code of Swift Key ,G-Keyboard isn't the key code 8 like PC ,  so I prevent the default backspace trigger , programmatically by \"document.execCommand(\"delete\");\"  \n$(document).on(\"keydown\", function(e) {\n      var $target = $(e.target || e.srcElement);\n      if (e.keyCode == 229) {\n event.preventDefault(); \n  document.execCommand(\"delete\");\n      }\n    });. @marijnh . $(document).on(\"keydown\", function(e) { var $target = $(e.target || e.srcElement); if (e.keyCode == 229) {  document.execCommand(\"delete\"); } });\nThis better. But key code 8 didn't work. Just tested with Swift key , Google key board same issues , hackers keyboard worked.. ",
    "Xatenev": "Quote from https://codemirror.net/1/manual.html\n\ngetSearchCursor(pattern, startPos, caseFold) \u2192 cursor\nReturns an object that provides an interface for searching. Call its findNext() and findPrevious() methods to search for an occurrence. This returns true if something is found, or false if the end or start of the document was reached. When an occurrence has been found, you can call select() to select it, or replace(string) to replace it with a given string (you can use \\1 placeholders in this string if you matched a regular expression). \n\nI don't seem to have a function called select, only replace.\nTheres no selectfunction in the src here either https://codemirror.net/addon/search/searchcursor.js\nI expect the code to be something like this:\nlet cursor = codeMirrorInstance.getSearchCursor('test');\nwhile(cursor.findNext()) {\n    cursor.select();\n}\nEDIT: I tried to use selectMatches too but it didn't work - nothing happened.\ncodeMirrorInstance.selectMatches(\"test\");. @marijnh Thanks for the response. I then get:\n\nvue.esm.js?efeb:1741 TypeError: Cannot read property 'line' of undefined\n    at clipPos (codemirror.js?f14e:508)\n    at Doc.eval (codemirror.js?f14e:6131)\n    at Doc.eval [as setSelection] (codemirror.js?f14e:3903)\n    at CodeMirror$1.eval [as setSelection] (codemirror.js?f14e:9654)\n    at VueComponent.search (Detail.vue?5e21:64)\n\nMy code is:\nsearch(val) {    \n    //val being something like \"test\"\n    let cursor = this.cm.getSearchCursor(val);\n    this.cm.setSelection(cursor.from(), cursor.to());            // line 64\n}. Thanks your right. It works now. I think a doc entry for this might be helpful. \nFWIW the full working code is:\nlet cursor = this.cm.getSearchCursor(val);\n cursor.findNext();\n this.cm.setSelection(cursor.from(), cursor.to());. ",
    "syropian": "My apologies, I had to step through a little further and found a rogue object (on my end) getting passed to this function!. ",
    "cybaek": "If a user invokes '[' on the middle of document, \"the rest of document\" will have a blue line. It's awkward for users. \n\n. ",
    "Kier": "Implemented.\nAs noted in my most recent commit message, it would be great to be able to defer evaluation of text in addon/*.js until initialisation, so that we could pass phrases as a property of options when calling CodeMirror.fromTextArea(..., options), such that it would be possible to override the phrases even after the addon scripts have been included.. A complete change of approach, following my previous comments.\nBy changing (almost) all instances of the .phrase() call to exist within functions, we can defer evaluation of the text until init.\nTherefore, phrases can now be passed as a property of the options object passed to functions like CodeMirror.fromTextArea(..., options), and an option handler does the work of adding them to the CodeMirror.phrases collection.\nFor example:\njavascript\nthis.editor = CodeMirror.fromTextArea(myTextarea, {\n    phrases: {\n        \"Jump to line:\": \"Hop to line number:\",\n        \"No\": \"Nope\",\n        \"Push to left\": \"\u2b05\ufe0e\",\n    }\n});\nThere is one issue - in addons/merge.js->buildGap() we have lock.title = \"Toggle locked scrolling\";, which at this point can not make use of the phrase system, because it is called prior to an editor being instantiated, so CodeMirror.phrase() (or in this case, dv.mv.editor().phrase() is not available for use. I'm stuck on this one, and so have simply added a comment in the code to reflect the problem and left the text hard-coded.. That\u2019s a nice idea, I\u2019m away until Sept 4th but if nobody has implemented\nit before then I will do so.\nOn Tue, 28 Aug 2018 at 15:55, vasanthv16 notifications@github.com wrote:\n\nThis is a nice feature. Thanks for implementing it.\nI do have a suggestion. The phrase(phraseText) function looks for a phrase\nin the phrases variable.\nlet phrases = this.options.phrases\nreturn phrases && Object.prototype.hasOwnProperty.call(phrases,\nphraseText) ? phrases[phraseText] : phraseText\nIn addition to that, can you also provide a more dynamic way to look up a\nphrase? In other words, can phrase(phraseText) look to see if\nthis.options.phrases is a function and call it if it is a function, instead\nof assuming that it will be an array?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/pull/5531#issuecomment-416592904,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AASsQqUrQ_B4u6lViLmg1-q3vmhgjp3vks5uVUvVgaJpZM4V-by5\n.\n. \n",
    "vasanthv16": "This is a nice feature. Thanks for implementing it.\nI do have a suggestion. The phrase(phraseText) function looks for a phrase in the phrases variable.\nlet phrases = this.options.phrases\nreturn phrases && Object.prototype.hasOwnProperty.call(phrases, phraseText) ? phrases[phraseText] : phraseText\nIn addition to that, can you also provide a more dynamic way to look up a phrase? In other words, can phrase(phraseText) look to see if this.options.phrases is a function and call it if it is a function, instead of assuming that it will be an array?. ",
    "KiddoKenshin": "Hello, is there any progress on this matter?\nI found that any MultiByte-based Gboard, on both iOS and Android, performs weirdly due to it's word conversion. \nExample, normallly \u306f\u306a\u3057 -> \u8a71, however upon inputing \u306a after \u306f , the cursor resets in front of \u306f , making it hard to input text.\nNo issue on PC though.\nEdit: Happends on Mobile Chrome too. @adrianheine \nThank you for introducing version 6 :)\nIt solved word conversion issue, however the 1st multibyte letter on the line will reset the gboard input.\nI understand is still far from completion, heres my experience at the moment.\nBy using the the \u306f\u306a\u3057 -> \u8a71 example again,\nI will need to type \u306f, \u306a, \u3057 in order to convert it to \u8a71.\nThe current symptom is, if I try to input it on the beginning on the line, after inputing \u306f,\ngboard resets as it starts to input another word. (This do not happen in the middle of the line). ",
    "Pengxy0917": "I  wanted to use codemirror in a vue application, while I wanted to to listen to keyboard event to disable carriage return when the content of this line doesn't exist. But it didn't work to disable carriage return. I can't see any reason. \nThank you.. ",
    "goofiw": "Update:  previous fix failed some tests (mainly replaying macros didn't work quite right) new pr:\nhttps://github.com/codemirror/CodeMirror/pull/5547\nI don't love the solution of moving the 'go to insert mode' into a timeout to push it off to the next run loop, but it works.. @marijnh honestly I don't remember what it was.  I think it had to do with the way operations (src/display/operations.js) were getting batched, events were happening out of order and the  that is the thick curser wasn't getting removed properly.\nIt was 6 weeks ago, but I think another issue of using the operations module was the operation functionality wasn't exported.\nSetting the timeout is just a hack for putting off the new line command to the next pass of the run loop so it happens after the current reconciliation of the render steps (and, yea, does another pass through the render steps).\nThe . uses a time out to push off going into insert mode so all the CodeMirror operations from adding the new line have finished.\nI didn't see the CodeMirror operations exposed anywhere.. ",
    "AsixJin": "How would I go about making a language mode into a module so someone like the people at Boostsnotes could implement it into their projects?. ",
    "thangngoc89": "\nlike seeing if the text ahead is a valid character expression, and if not, just treat the quote as part of an identifier name.\n\nThis sounds good to me. Could you show me an example or something? Because I don't quite get this part. @marijnh so only match char , anything else is a identifier. thank you very much. \nSidenote: Do you accept an PR to this repo once I have figure this out? . Thank you for the information. ",
    "kunam1": "Ibet. Haha. Hi app hay. Hu. Hu. Lololo. Hsjs. Hsjs. Ho. Hahaha. Hahaha. Bababa. ",
    "kiasta": "Well, it's hard to explain, thus the fiddle. When I'm focused onto the Codemirror div and then try to scroll with the horizontal scroll bar to the right, it seems to be glitchy and fighting with the blur event. The scrolling just does not work at all and the right div flickers in and out. It happens only when the Codemirror div is focused. When not in focus and trying to scroll, it works as intended. I'll try to make a short video snippet when I get home.. ",
    "finalfantasia": "Oh, my bad. I should have articulated my thoughts more clearly.\nMy focus for this round of refactoring is on special forms and core symbols and the goal is to make syntax highlighting more consistent (by using the same style) and indentation as complete as possible (by covering the remaining core symbols). I expect this to take a little while given the number of remaining symbols in the core namespace and therefore I would like to be \"laser-focued\" and not distracted by other concerns (i.e., one namespace at a time).\nThe next step will be thinking about covering symbols from non-core namespaces. I don't know if we should yet since both the Common Lisp mode and the Scheme mode don't seem to do so. If we somehow decide to cover these namespaces, I would like to apply the same approach and do it one namespace at a time while maintaining the same level of consistency and completeness.\nSo that's the plan and that's why I removed those symbols for now in order to add them back later (maybe) with better quality of coverage.\n. > The CL mode has a heuristic for (see assumeBody) for when to use body-style indentation versus argument-style indentation. Maybe something like that would be appropriate here too?\nYes and that's exactly what I've been thinking about doing (instead of completely relying on a static list of symbols). The Common Lisp mode is a very good example and starting point for this. I've been experimenting with tweaking it to syntax highlight Clojure code and it feels very promising. I might end up re-writing the Clojure mode based on the code of the Common Lisp mode since it is relatively easier to reason about than the current Clojure mode code (hence the tests to capture the current behavior as much as possible :) ).. Before:\n\nAfter:\n\n. Thank you for creating and actively maintaining CodeMirror and making it a pleasure to contribute code to it! \ud83d\ude42. Yeah, that was the only part I felt I had gone too far with and was not 100% certain either. I suppose I can limit the usage of is to the scope of the tokenizers only. But please feel free to point out anything that doesn\u2019t feel right. I\u2019m open to any idea that helps improve code quality, readability, and maintainability. . whoopsie... Node.js doesn't seem to support the u flag yet.\nmode/clojure/clojure.js: Invalid regular expression flag (161:26)\nSyntaxError: Invalid flag supplied to RegExp constructor.\nI'll push another commit with a fix tonight.. It\u2019s alright. \ud83d\ude42\nIt was my fault that I had run the tests only in Firefox before I pushed the offending code. I removed it in the last commit and all tests are now passing in Node.js. Is there anything else in this PR that I should downgrade to ES 3?. Good point! I\u2019ll take care of that later today. Thanks!. Welp, it turned out this is not as easy as I originally thought. I need to spend more time to think about how to do this right. I'll close this PR for now. Thanks!. ",
    "dsblank": "Ok, I fixed this (and a couple of other issues) in https://github.com/codemirror/CodeMirror/pull/5585\nBefore:\n\nAfter:\n\n. Will do!. By \"commented atom\", do you mean that you would like to properly handle:\n```scheme\n; '(this is an sexp marked as an atom) but this is not\n```. Ah, I see. I think you are right. I'll see if I can fix this. (I have some other fixes, but I'll save those for another PR).. Ok, it should address those issues.. ",
    "JakeXu": "\nAdded in 50e5183\n\n3Q, and when I can use npm to get the latest code?. ",
    "ninjanails": "Turns out there was CSS overwriting the brown to make it grey. The original brown passes colour contrast checkers so I will close this pr :) . ",
    "centurianii": "...but I can see on lines 9229-9230\non(te, \"cut\", prepareCopyCut)\n  on(te, \"copy\", prepareCopyCut)\nthese are inside TextareaInput.prototype.init = function (display).\nAt 9630 there is a CodeMirror.inputStyles = {\"textarea\": TextareaInput, \"contenteditable\": ContentEditableInput}.\nJust expose prepareCopyCut...?. ...or create a Ctrl-X or Ctrl-C event...?. Ok, the idea is to replace keystrokes with a button so useful in a touch screen device.... If I use Document.execCommand('copy') and make a range from the editor's selection?. like this https://developers.google.com/web/updates/2015/04/cut-and-copy-commands. Ok, it's possible - at least inside the editor! Just create a global buffer and when user selects sth & clicks \n\n\ncut write sth like:\ntext = editor.getSelection(); buffer.set(text); editor.replaceSelection('');\n\n\ncopy write sth like:\ntext = editor.getSelection(); buffer.set(text);\n\n\npaste write sth like:\ntext = buffer.get(); editor.replaceSelection(text);\n\n\nI decided to create a multi-level buffer so user can do things like: \n1. copy to buffer 1, \n\n\ncut to buffer 2,\n\n\npaste from buffer 1.\n\n\nWhat about transferring our buffer to clipboard? I'll see that too.... A buffer implementation. It's possible to connect our private buffer with the system's clipboard when user clicks\n1. cut add sth (continuing from my previous reply): on construction add a textarea $('<div class=\"buffer\"><textarea></textarea></div>').appendTo('#' + editorId + ' > .panel-footer') and on event handler $('#' + editorId + ' > .panel-footer > .buffer > textarea').val(text).get(0).select(); document.execCommand(\"copy\");\nI use jquery here. editorId comes from your program/class/object. I also used a bootstrap 3 panel with panel footer and there I hide my buffer.\nStyles for class .buffer:\n`/ Panel footer /\neditorId > .panel-footer > .buffer {\noverflow: hidden;\n   outline: none;\n   height: 0;\n   border: 0;\n   margin: 0;\n   padding: 0;\n}`\n\n\ncopy: like cut on event handler $('#' + editorId + ' > .panel-footer > .buffer > textarea').val(text).get(0).select(); document.execCommand(\"copy\");\n\n\npaste: comes at no cost!\n\n\nNow you can add events that simulate the missing and infamous key bindings from the source: Ctrl-X, Ctrl-C and Ctrl-V.\n How difficult was that?. My solution populates visual copy/cut from the interface to clipboard.\nIn order to populate copy/cut from the keyboard to the buffer which is used by the visual copy/cut we need a patch at the CodeMirror code.\nAn example that supports the above:\n\n\nuser selects sth,\n\n\npresses Ctrl+C,\n\n\ngo to another place in the editor,\n\n\nclicks button Paste,\n\n\nError as the buffer hasn't been populated from the keyboard copy! (see the hidden textarea).\n\n\nOn the other hand, if we replace step 2 with a click at button Copy and use as step 4 Ctrl+V everything is OK!\nWith the patches now we can update the textarea and we have 2-way communication, a synchronized copy/cut wherever it comes from!. ",
    "gloony": "For paste, your need something like this for make it work with multiple selection :\nif(text.indexOf(\"\\n\")!=-1){\n    var a = text.split(\"\\n\");\n    editor.replaceSelections(a);\n}else editor.replaceSelection(text);. editor.getOption('readOnly'). ",
    "mjain1994": "I am using Chrome, cant really produce a webpage, but files I added were \ncodemirror.css\ncodemirror.js\nmatchbrackets.js (addons)\nsql.js (mode)\nshow-hint.css (addons)\nshow-hint.js (addons)\nsql-hint.js (addons)\nAll taken from the here\nAdditional css files are Bootstrap.min.js along with JQuery\n<div class=\"form-group row\">\n              <label for=\"query\" class=\"col-sm-2 col-form-label\">Query</label>\n              <div class=\"col-sm-9\">\n                <textarea type=\"textarea\" id=\"query\" name=\"query\" placeholder=\"Enter your query here\"required></textarea>\n              </div>\n            </div>\n. ",
    "demirdoven": "\nIs it possible that the editor was initialized in a hidden state, and then shown? It needs to have a proper layout to initialize itself, so if the editor starts out hidden, you should call the refresh method when you unhide it.\n\nHi, i used refreshmethod but nothing changed.. Thanks. \nI've added this option and it's done :)\nautoRefresh: true. ",
    "mbostock": "\n. ",
    "hackerwins": "@marijnh Thank you for your kind feedback. I will try it as you suggest. \ud83d\udc4d . ",
    "allowing": "This problem occurs when using the laravel framework's mix system.. I have tested it many times and tried to load only codemirror.js, or this problem will occur. Estimated when mix is affected.\nSince it is more troublesome to reproduce this problem, I uploaded some pictures for you to see. The Chinese network is too fuck. Waiting for half a day to visit github.\n\n\n\n\n. ",
    "EmidioStani": "I will need to double check as soon as I have more time. I have used Chrome as browser.. ",
    "kylebarron": "\nit is possible to write language modes as separate modules\n\nWhat's the proper way to distribute language modes as separate modules? As an npm package?\nEdit:\n\nWe aren't going to add any more language modes to the main distribution.\n\nDoes this mean that you won't accept a PR to add another mode, or that you won't expend any work to create one yourself?. ",
    "dmaclach": "Fixed issues. Thanks for the review. Please take a look.. Commits squashed. Thanks!. Done.. Added fix for breakage.  Can someone trigger a rebuild to verify?. Ah.. Travis turned the code around so fast that I thought it hadn't run. Thanks!. For some reason this PR got messed up (yay git!...) I'll open a new PR with updated changes.. Feel free to assign me to this.. Arrggh.. you are correct I meant fold instead of indent. Thank you. I was referring to this:\nhttps://github.com/codemirror/CodeMirror/blob/41e7ff5d04825c94703b2153aa72466546f2d5ab/mode/clike/clike.js#L725\nand was using it when testing my folding changes for disabling single line folds and seeing how it looked in the various languages.. No worries. Totally understand. Thanks!. Was #5634. I screwed up git somehow in a way that github didn't like. I closed #5634 and have restarted here. Apologies.. Done.. Check out the latest revision. A little more flexible and \"proper\" IMHO.. ",
    "monsterLHZ": "You can use this function to calculate the length of a string.\nfunction abslength( str ) {\n   return str.replace(/[^\\x00-\\xff]/ig, '**').length;\n}. ",
    "JeanMarcZimmer": "I have to admit I've let it down. After two consecutive days of searching, (and because I have a deadline), I changed strategies.\nUntil now I couldn't manage to get it right, sorry for not being able to help. :-/. ",
    "ischolten": "@marijnh I'll try that out. Thanks!. ",
    "PerryRylance": "Thanks. ",
    "ywww": "yes , thankyou. ",
    "nkappler": "@marijnh . ",
    "ChinmayeePDas": "I have added it as seen above.\nif i just have  'lint: true', i see the gutter getting updated, but with the above code it is not being shown. yes that is correct, but i want to use some property on the DOM to check this.. ",
    "yuzhounanhai": "I will try this solution, thank you for your reply.. ",
    "aldanor": "Thanks! That was very fast :). ",
    "jotakar": "Thanks for your answer, so I read again about mode option, and I understand that if I do\nvar editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), {\n        mode: {name:'javascript', closeBrackets: \"()[]{}<>''\\\"\\\"``\"},\n        autoCloseBrackets: true\n          });\ncloseBrackets should be set to ()[]{}<>''\\\"\\\"``, but It doesn't happen so. It keeps their default value. Why?\n. Why closed?. Now I understand my error.\nSorry, and thanks for your answers.\nBye. ",
    "detly": "\nAre the !mportant annotations necessary here?\n\nNot sure, the original CSS had it so I left it in. My guess (and it's only a guess) would be that it means it avoids a dependency on the order in which the final CSS is constructed, but maybe that's taken care of by using more specific selectors?. ",
    "atomiks": "Oh damn thank you for this, sad I didn't see this earlier! It's exactly what I needed. Accurate & colorful syntax highlighting is something I was desperately wanting for a project. I've been extending Prism for regular code blcoks on my docs for a while to imitate my VS Code theme and can't live without all the granular scopes.. ",
    "adityatoshniwal": "Same for code fold marker - https://codemirror.net/demo/folding.html. ",
    "wylieconlon": "Yes, I think that solves the testing case nicely.\nOn Fri, Dec 21, 2018 at 11:06 Marijn Haverbeke notifications@github.com\nwrote:\n\nSince there's only ever a single hint dialog open, this can be a method.\nDoes attached patch work for you?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/5682#issuecomment-449342652,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAora6gnqJNT3qpJncDAcggu2Em_CVLMks5u7LKJgaJpZM4Y4go-\n.\n. \n",
    "Nevsor": "Wow that was fast! Thank you.. ",
    "z-song": "Sorry, my mistake.. ",
    "petrovalex": "Understand this, unfortunately there is some miscalculation happening sometimes and textarea is positioned not under cursor but aside and then not getting moved away, so can end up in situation when there are 2 cursors even if context menu is not opened.\nWhat are you going to use in version 6? Is it possible to implement as plugin for version 5?\nIf I am to accept the fact that context menu wont work properly, any ideas how can prevent textarea from showing up in IE 11?. ",
    "keul": "Seems fair, thanks!. ",
    "vedadkajtaz": "I was expecting this to behave identically on all platforms, but it appears Firefox PC and IE11 PC behave correctly. The above issue is reproducible on Chrome PC and Mac.. The outcome is even worse on Safari - the whole content gets (visually) wiped out, making the editor unusable.. @marijnh Thanks for the quick reply.\nI expected the emoji character to have the length of 1 in javascript (both the content and markup indexes are generated by a server search in my case), but that's not true.\nThis link explains it well, and how to workaround the issue:\nhttps://mathiasbynens.be/notes/javascript-unicode#counting-symbols\n. I was also mistaken by the fact the editor status displayed the correct length (counting the emoji as one character) - but that's because I used a strlen() implementation coined long ago, that did take the surrogate pairs into account.. ",
    "fraxx001": "Chrome allows you to overwrite this shortcut, You can patch firefox to allow you this. On MacOSX the tab-closing operation is mapped to cmd-w not ctrl-w. And the shortcut is already defined for insert mode and works for me. I just asked to add one line more to the vim.js bindings where the the shortcuts idles in normal mode like vim does.. ",
    "mwadman": "Thanks for taking a look at the PR, much appreciated.\nWould you be okay with a submission of \"text/jinja2\" as the mime?. Hi, just coming back to this after the holiday break. (Happy new year!)\nWould you prefer that I submit a new PR, or re-open this one?. ",
    "NoFishLikeIan": "It is a bit late but a potential solution is to use the documents fonts api and then call refresh as suggested by @marijnh . ",
    "Hugo-Hache": "I tried adding a test, but I faced errors with indentation.\nMT(\"indented_heredoc\",\n    \"[keyword def] [string method]\",\n    \"  [variable multiline_string] [operator =] [string <<-HEREDOC]\",\n    \"    [string First line]\",\n    \"  [string HEREDOC]\",\n    \"  [keyword return] [variable multiline_sttring]\",\n    \"[keyword end]\");\nResult : \nruby_indented_heredoc\ndef method\n  multiline_string = <<-HEREDOC\n    First line\n  HEREDOC\n  return multiline_sttring\nend\nexpected:\ndef \u00b7   method  \u00b7\u00b7  multiline_string    \u00b7   =   \u00b7   <<-HEREDOC  \u00b7\u00b7\u00b7\u00b7    First\u00b7line  \u00b7\u00b7  HEREDOC \u00b7\u00b7  return  \u00b7   multiline_sttring   end\nkeyword null    string  null    variable    null    operator    null    string  null    string  null    string  null    keyword null    variable    keyword\nobserved: [display states]\ndef \u00b7   method  \u00b7\u00b7  multiline_string    \u00b7   =   \u00b7   <<-HEREDOC  \u00b7\u00b7\u00b7\u00b7First\u00b7line  \u00b7\u00b7HEREDOC   \u00b7\u00b7  return  \u00b7   multiline_sttring   end\nkeyword null    def null    variable    null    operator    null    string  string  string  null    keyword null    variable    keyword\nIndentation of line 3 is 0 (expected 4)\nIndentation of line 4 is 0 (expected 2). @marijnh Indeed much simpler than the regex \ud83d\udc4f However based on the specification we should only allow eating space when opening tag is prefixed with '-'. Would it be ok for you if I remove the regexp part from my PR and keeps the '-' detection ?. Perfect! Thanks for you reactivity @marijnh . ",
    "Cloudzp": "thank you very much and Happy new year\uff0cbut I can't understand what you said.. ",
    "joewalsh": "@marijnh thanks for the quick response! I've updated the PR with the changes you requested. @marijnh thanks for the quick feedback! The initial change I made cut out operation(this.cm, applyTextInput) entirely. I thought maybe that was too invasive, but there weren't any observable ill effects in our use case (syntax highlighting and undo continue to work as normal). I've reverted to that version of the change. \nI'm not sure what you mean by making sure that the DOM change caused by the key press is somehow handled - ~~would calling readFromDOMSoon() on keypress when preventDefault is disabled suffice or is there something else I'm missing?~~ [edit] nevermind, it looks like that's called on keypress currently anyway . ",
    "awunnenb": "thank you very much. Where can i set the mime-type? In markup or by Code/Config? I can't find any code-example to set mime-type-string for special sql syntax highlighting. . ",
    "chandu89": "Can you please tell me how i can use extrakeys in Codemirror..It would be helpful.. I have tried with below code but not working ...\n  editor.setOption(\"extraKeys\", {\n      Enter: function(cm) {\n        if (cm.state.completionActive){\n          return CodeMirror.Pass;\n        }\n      }\n    });. extraKeys: {\n            'Enter': function(){\n              if (!editor.state.completionActive){ return CodeMirror.Pass; }\n            }\n        }\nExtra key is not working for me... Actually the block is not executing.\nI have tried here its working.\nWorking URL. I have tried here, Its working but its not working for my project.. Is there anyway to pass next line with editor instance.?. ",
    "Jonathan435": "Hi,\nLook at this link: https://codemirror.net/2/demo/formatting.html\n\u202b\u05d1\u05ea\u05d0\u05e8\u05d9\u05da \u05d9\u05d5\u05dd \u05d1\u05f3, 21 \u05d1\u05d9\u05e0\u05d5\u05f3 2019 \u05d1-17:35 \u05de\u05d0\u05ea \u202aMarijn Haverbeke\u202c\u200f \u202a\nnotifications@github.com\u202c\u200f:\u202c\n\nWhat is this commentRange method and where is it coming from? It doesn't\nappear in this repository.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/codemirror/CodeMirror/issues/5744#issuecomment-456113860,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AHL2uBa7Dp4Gzr4KJCAvMieYWrQrVAbXks5vFd5LgaJpZM4Z8qOR\n.\n. \n",
    "danijel202": "Help brooo. ",
    "LakshSingla": "It fails to detect the end of template string when string interpolation is used and a p5-function(e.g random(..), round(..) is called upon to evaluate a result.\nMinimalist case would be : \nlet x;\nx = `${round(2.1)}` //Would fail to evaluate the end of string correctly and parse this comment\n\nMinimal case where it doesn't work\n\nExtensive list of cases where it works and where it doesn't \n\n. Try using it here https://editor.p5js.org/ . The code is slightly modified in order to support special highlighting for the p5's functions and variables (which is the main cause of trouble). The modified version can be found here. Changes made are from Line#50. \n",
    "dmitry-at-publons": "I've just tried https://codemirror-firefox-middle-click.glitch.me/:\nFirefox 64.0 at Ubuntu 18.04: pasting works, but copying text from a form (selecting with a mouse or double-clicking) does not.\nChromium 71 at Ubuntu 18.04: everything works\n. ",
    "JPustkuchen": "Thank you very much for your super fast reply @marijnh  :). ",
    "sohee-lee7": "@marijnh Thank you for quick response. I will accept your opinion that it is not good to call refresh on focus events. Thank you :). ",
    "fangqiao": "Just found out it might be my keyboard's problem. shift-control dosn't work.. ",
    "nathanlesage": "Thank you very much for your quick response! :)\nI\u2018m looking forward to the release!. ",
    "rosano": "Okay, I'm on macOS and it looks like only Safari is doing this - works fine on Firefox, Chrome, and two other Chromium browsers I tested. It looks like there might be some OS-level commands (see below) bound to Ctrl-Alt-\u2026 only in Safari.\nI have another project that uses CodeMirror and the access key 1 works fine, so if you ever have a hunch on why certain keys do this please let me know.\n\nSlight tangent that might be related, but when I try Ctrl-Alt-N, these bright red dots get inserted in the editor:\n\nWhen I copy and paste them into a plaintext editor, they appear as some kind of special invisible byte character \u000e or <0x0e>. The shortcut creates the same character in the native RTF editor TextEdit, and this other web-based code editor (only in Safari) https://ace.c9.io .. I wrote a workaround in 857b105 to preventDefault and focus if there is a matching accesskey on the page and it works on the demo page \nhttps://rosano.github.io/CodeMirror/ .\n```javascript\neditor.on('keydown', function (instance, event) {\n  if (!navigator.platform.match(/mac/i)) {\n    return;\n  }\nif (!navigator.userAgent.match(/^((?!chrome|android).)*safari/i)) {\n    return;\n  }\nif (!event.altKey || !event.ctrlKey) {\n    return;\n  }\nlet elements = document.querySelectorAll('[accesskey]');\nif (!elements.length) {\n    return;\n  }\nlet match = [].slice.call(elements).filter(function (e) {\n    return e.getAttribute('accesskey') === event.key;\n  }).shift();\nif (!match) {\n    return;\n  }\nevent.preventDefault();\nsetTimeout(function () {\n    match.focus();\n  });\n});\n```. ",
    "ckkoch": "Please delete. Had the wrong window active. ",
    "cdsmith": "(This is https://github.com/google/codeworld/issues/819 on my side.). The changelog for 5.39.0 suggests this may be fixed.  I'll update the editor on a test server and see if that fixes it.. Nope, I've updated to 5.43.0 and this is still happening.. ",
    "applecool": "@marijnh . I actually fixed the issue by handling the paste event at document level and calling cm.refresh() on it. Thanks. . ",
    "bobbydavid": "Possibly the fix is as simple as adding a mapping in command mode from \\<Del> to 'x' ?. ",
    "reactma": "Yes you are right. I have an IME that uses Ctrl-Shift-F to do certain thing. After I disable the combo the demo worked.\nThanks for the quick response.. Ok I have created a git repo codemirror-frontmatters and a npm package as well npm codemirror-frontmatters. ",
    "obendev": "Can you give me quick detailed information on what needs to be changed?. ",
    "CodeMyst": "Yeah, most likely. I tried using the modes from the source directly and those have the same result. I am making a Vue.js app and creating the editor like so:\nts\nimport Vue, { VNode } from 'vue';\nimport * as cm from 'codemirror';\nimport 'codemirror/mode/pug/pug';\nexport default Vue.extend\n({\n    mounted () : void\n    {\n        this.$nextTick (function ()\n        {\n            const textArea: HTMLTextAreaElement = this.$el.getElementsByClassName ('editor') [0] as HTMLTextAreaElement;\n            const editor: cm.Editor = cm.fromTextArea (textArea, { mode: 'pug', theme: 'base16-dark', indentUnit: 4, lineNumbers: true });\n        });\n    }\n});\nAnd other modes seem to work fine.. I tried making an empty project with CodeMirror, got the same results: https://jsfiddle.net/mpzo0s5q/\nOnly strings, numbers and comments are highlighted.. Ah! Thank you! \ud83d\ude04 . ",
    "llpamies": "Thanks for the explanation.. ",
    "krishnadey30": "Hey @marijnh Please find the link to chapel mode.\n. ",
    "torgeir": "Yep, that was my conclusion as well, after som further investigation. Well, it works for scanForBracket, but probably not for findMatchingBracket et.al.. Agreed.. ",
    "kdekooter": "Will do!. That's too bad. It would be a real selling point to support the most popular key mappings. \nAre there any examples of a separate keymap library?. ",
    "angerlover2": "\nWhat kind of autocomplete do you want? HTML, CSS, JavaScript? Have you loaded show-hint.js and the module that provides completions for the language you want?\n\nI want to three autocomplete together.\nlike this :\n\n. > You still didn't tell me what modules you've loaded, and your screenshot shows an editor with only JavaScript, which isn't what the htmlmixed mode provides.\nthank you for reply!\nloaded this:\n\nhtml code :\n\njs code:\nvar editor2 = CodeMirror.fromTextArea(document.getElementById(\"sourceCode2\"), {\nextraKeys: { \"Ctrl\": \"autocomplete\" },\nmode: \"htmlmixed\",\nindentUnit: 2,\nlineNumbers: true,\ntheme: \"panda-syntax\",\nlineWrapping: true,\nfoldGutter: true,\nmatchBrackets: true,\n});\nbut it's don't work . > Could it be that addon/hint/show-hint.css isn't loaded?\nit's loaded ,and i replace mode 'htmlmixed to 'javascript' ,autocomplete is worked . ",
    "JavierSegoviaCordoba": "Really I don't know JS @marijnh, I was checking other languages and they have more properties (in the main web example there are two variables, cm-variable, and cm-variable-2).\nSomeone is going to fix this issue someday?. ",
    "hanzhaodeng": "Added a commit. Thanks \ud83d\udc4d . ",
    "williamdes": "Fixed by: #5819. You can see in https://travis-ci.org/codemirror/CodeMirror/builds/508598677#L491 that the object is wraped in an object, this is the issue #5819 \njson\n{\n    \"text\": {\n        \"text\": \"alias\",\n        \"displayText\": \"alias | varchar(255) | Primary\",\n        \"columnName\": \"alias\",\n        \"columnHint\": \"varchar(255) | Primary\"\n    },\n    \"className\": \"CodeMirror-hint-table CodeMirror-hint-default-table\"\n}\nMUST be\njson\n{\n  \"text\": \"alias\",\n  \"displayText\": \"alias | varchar(255) | Primary\",\n  \"columnName\": \"alias\",\n  \"columnHint\": \"varchar(255) | Primary\",\n  \"className\": \"CodeMirror-hint-table CodeMirror-hint-default-table\"\n}. ",
    "janodvarko": "Ah sorry (a typo), fixed!\nHonza\n. ",
    "admin-user": "text\n. javascript\n. js\n. ",
    "vidma": ":ok: \n. > This'll disable all highlighting for the parameters. That seems undesirable.\nsure, I'd be more than happy to keep it. but it's much better as is, than this annoying indentation we had before.\n\nAlso, I believe Scala allows default values for parameters\n\nnot for anonymous fns, this is too weird / wouldn't compile:\nscala\nscala> Option(1).map {x: Int = 1 => 1}\n<console>:1: error: ';' expected but '=' found.\n       Option(1).map {x: Int = 1 => 1}\n                             ^\n\nWould it make more sense to delay the context manipulation until reaching the =>?\n\nI had this in mind (but I'm not codemirror guru either). so what is needed to preserve the indentation, is to delay the pushContext until whole line was eaten (into highlighted parameters), right? but then, how to conveniently request tokening of the rest of the current line?\nthanks for looking into btw ;)\n. > when it sees a \">\" ahead, it changes the current context to not try and align its body.\nhow would I change the current context ?\nalso, need to be rather cautious for this not to conflict with other syntax, e.g. if { was not present earlier on the same line before =>:\nscala\nx match {\n  case y =>\n    khdjhsjdh\n}\n//or inside fn definition:\ndef callByReference(argFn: => Unit) = {\n  ...\n}\n. ",
    "baygeldin": "Shouldn't it be var registers = vimGlobalState.registerController.registers[name];? I can't define a register because it throws \"Can't read property  of underfined\" later in the code (957 line).. @marijnh oops, sorry. I meant var registers = vimGlobalState.registerController.registers;, of course. . Great, thank you!. ",
    "prathik457": "Shouldn't this be item.displayText?\nLet's suppose I have a table object {columns:{....}, text: '{{table1}}', displayText:'table1'}\nThen when I type 'ta' it does not return me anything. Am I missing something?. ",
    "notoriousb1t": "Done. . You are right.  I am not sure why I used [=] and to be honest, I figured out some of these expressions 2 months ago so I am not sure what I was thinking at the time. . "
}