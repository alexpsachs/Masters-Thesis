{
    "elieandraos": "just as a test, i set the extension to 'jpg' hard coded in your repos createMediaForFile() function.\nthe file is uploaded and a record is saved to the media table with no errors, but the file uploaded is the tmp file (phpPPGBy5 for example), and not the original client name with the extension, and i think by that, the image profiles are not taken into place. \ni think i am missing something here... \n. Works perfectly well \nMany thanks , keep it up :)\n. @welcoMattic here is an example of implementation within a controller \nhttps://github.com/elieandraos/gaia-news/blob/master/src/Gaia/News/NewsController.php \nI inject a service class to handle the upload \nhttps://github.com/elieandraos/gaia-news/blob/master/src/PSR4/Gaia/Services/NewsService.php \njust follow the store() method inside the controller\n. @freekmurze awesome thanks :)\n. ",
    "freekmurze": "Hi,\nyou should pass a properly named file to the addMedia-method. To get the filename of the uploaded file (and not the tempfile) you can do something like this:\n``` php\n$file = Input::file('file');\n$tempDirectory = storage_path('temp');\n$fileName = $file->getClientOriginalName();\n$file->move($tempDirectory, $fileName);\n$collectionName = $news->getMediaCollectionName();\n$news->addMedia($tempDirectory . '/' . $fileName, $collectionName);\n```\n. @rashid-ali4u did you prepare your model correctly?\n. I've taken a look at the code and there are indeed some problems with the image profile properties.\n. The problems you described have been fixed in version 1.1.4\n. Thanks!\n. Png's are supported. Could you please clarify your question? Are you getting an error?\n. I've made it a bit more clear in the readme that you can use Glide's fm-option.\nBy default the derived images will be stored as jpg's. If you want another image format you can specify pngor gif using the fm-key in an an imageprofile. For example:\nphp\n//in your news model\npublic static function getImageProfileProperties()\n{\n    return [\n        'list'=> ['w'=>200, 'h'=>200, 'shouldBeQueued' => false, 'fm' => 'png'],\n        'detail'=> ['w'=>1600, 'h'=>800, 'shouldBeQueued' => false, 'fm' => 'gif'],\n    ];\n}\n. The getMedia-method has second, yet undocumented, parameter with which you can filter the results.\nYou can use it in this way:\n$images = $subject->getMedia('images, ['id' => $mediaId]);\nKeep in mind that when filtering on id the result is a collection with one or zero elements. If you need a more convenient way to get a media object from a collection by it's id feel free to submit a pull request.\nI'll probably add some better filtering methods (use a callable instead of an array) in a future version of the package.\n. Yep, that for filtering on custom properties. Here is the code that does the actual filtering.\n. I'd accept a good PR that adds a function to retrieve a specific media item to the package.\n. I'm sorry that you lost a bit of time. I've made a note of this in the docs. \nI'll make necessary changes to allow underscores in de profilename in a future version of the package.\n. There's no need to add that method in your model file: I corrected the problem in version 1.5.5 of the package. \n. Those calls look really nice. I'll look into this soon.\n. I decided against adding this functionality as it would require to use a magic method. In the newly tagged version 2.0.0 there is a new short syntax to get a media collection.\n. This would break backwards compatibility. What problem are you trying to solve?\n. I can image that some people would like the original name of the file in the db. If you want to use a slug as a name, I think it's perfectly fine how you do it now.\n. Thanks for your pr. Of which functionality would you like to see some more examples?\n. Sure, I'll gladly accept pull requests that makes the documentation better. \n. We're currently rewriting the package and we'll rework the documentation as well.\n. Thanks!\n. getFirstMediaURL expects two parameters. The first parameter should be a collection name, the second a name of an image profile.\nThe documentation was wrong. I've now corrected it.\nThanks for bringing this to my attention. \n. We are currently refactoring the package.  There will be breaking changes but the general principles will stay the same. We'll support media libraries that aren't stored in the public path.\n. Don't hold me to it, but I guess somewhere late July.\n. The next-gen version is coming along quite nicely. We are still testing it internally but you can read the documentation and code here: https://github.com/spatie/laravel-medialibrary/tree/next-gen\nIn that version there is an easy way to generate your own urls: https://github.com/spatie/laravel-medialibrary/tree/next-gen#generating-custom-urls\n. v2.0.0 has been tagged. In that version there is an easy way to generate your own urls: https://github.com/spatie/laravel-medialibrary/tree/master#generating-custom-urls\n. This is fixed in 1.6.2\n. This package is build for managing your own files and generating thumbnails and other derived images from them.  Storing url's to external would make the package more complex than it needs to be. \nYou could create a seperate table to store url's to external sites.\n. We're currently creating a new version of this package. You can look at it in the \"next-gen\" branch. I'll see if we can add storing external url's elegantly there.\nETA for the next-gen branch to be released: somewhere  at the end of July.\n. Hi, unfortunately storing URL's will not be support in the next version of this package. Developing and supporting this would take us too much time.\n. Thanks for letting me now. I'll be sure to check and fix this issue before the new version gets released.\n. This has been fixed. v2.0.0 has been tagged.\nIf you have a next-gen version installed, please step through the installation instructions again, we've moved some classes.\n. This will be fix in the next release of laravel-paginateroute which will be released later today.\n. I'll fix this in the next release, probably somewhere end of this week.\n. Version 2.2.0 adds a hasMediaWithoutConversions-interface\n. This package is built around adding files, there are currently no plans to add url's. But I'll take a look in the next weeks if this can be elegantly added to the package.\n. As we do not need this functionality ourselves adding it is low priority. If you need this, feel free to submit a pull request.\n. I think it would be nice to have this. It's still low priority for us, but we'd happily accept a good PR that adds this to the package.\n. Thanks to @cviebrock this feature is now available in v3.8.0\n. This is fixed in the newly tagged version 2.1.3\n. Thanks!\n. I welcome all contributions regardless of size :+1: \n. That's not so good. I'll investigate this in the coming days. If the problem is caused by the medialibrary, rest assured that it will be fixed soon.\n. I tried to reproduce your problem, but I wasn't able to do so.\nThis piece of code\n``` php\n$this->testModelWithConversion->addMedia($this->getTestFilesDirectory('test.jpg'));\n\\DB::connection()->enableQueryLog();\n$testModels = $this->testModelWithConversion->with('media')->get();\n$testModels[0]->getFirstMediaUrl();\n$testModels[0]->getFirstMediaUrl();\n$testModels[0]->getFirstMediaUrl();\n$testModels[0]->getFirstMediaUrl();\ndd(\\DB::getQueryLog());\n```\nresults in only two queries being logged. This looks fine to me.\nIf also added an alternative version of this test to the package. Take a look at it here.\nCould you please give some more instructions on how to recreate the problem?\n. I found the problem and fixed in dev-master. Could you try it out before I tag a new version?\n. A new version of the solution is now available in dev-master. Internally the package will now not go to the db to fetch the conversions of the parent model. \nCould you update to the latest master version and try again?\n. Thanks for reporting the issue! The newly tagged version 2.2.1 includes the fix.\n:smiley: If you are going to Laracon this year I might take you up on that :beer: \n. Hi, \nLots of L5 specific functions are being used. Porting this package would take a considerable amount of time. Support for L4 would make the codebase more complicated than it needs to be.\nBecause we don't need it ourselves, building and maintaining a L4 specific version isn't a priority for us. So don't hold your breath for L4 support.\n. Yeah sure! I think people on L4.2 will be very grateful for your work.\n. Theoretically yes, but we aren't going to do that soon... See #23 \n. Hi,\nby default the name of a media object is indeed the name of the file without the extension. \nIf you want to change the name you can to this:\nphp\n$media = $yourModel->addMedia($file);\n$media->name = 'This is a new file name';\n$media->save();\nIf you want to get the filename do this:\nphp\n$media->file_name;\nOnce added to the medialibrary the name of the file itself cannot be changed. So, if needed, you'll have to change the name of the file before adding it the medialibrary.\n. The package will not generate a random name. Probably you are just using the temporary name of the upload. You can get the original name of the file with the clientGetOriginalName-function.\nphp\n$file = Input::file('file');\n$fileName = $file->getClientOriginalName();\nIf you want to add some sort of security you should move the medialibrary out of the public folder. A great place to store the files would be the storage folder. Next, you should write a custom url generator. The generated url should point to a controller that determines if the user can access the file.\nThat's how I would go about it.\n. If your UrlGenerator extends the BaseUrlGenerator then you can access the id of the requested media with $this->media->id\n. Thanks!\n. This fix is included in the newly tagged version 2.1.5\n. Thanks for bringing this to my attention. I've corrected these errors throughout the readme. If you find any more error let me know or feel free to submit a PR.\n. Thanks!\n. As mentioned in the documentation calling getMedia() without a collection name will return all items in a collection named 'default'. I'll add a method to get all media in a future version. If you need this quick, feel free to make a PR.\n. The name getAllMedia sounds good to me. \n. I'm releasing v3 of the package this week. The getMedia-function in that version will return all media regardless of collection name.\n. Thanks! Your changes are included in the newly tagged version 2.2.2\n. You should get the client original name. Here's an example.\nIn a next version of the package I'll make this easier.\n. You could also rename the media after adding the file:\nphp\n$media = $model->addMedia($request->file('file'));\n$media->name = $file->getClientOriginalName();\n$media->save();\n. @ziming that's true... \nI'll add method for renaming the file soon...\n. New in version 2.2.3: when renaming file_name on a media object, the underlying file will be renamed as well.\nphp\n$mediaObject->file_name = 'newFileName.jpg'\n$mediaObject->save(); // This will also rename the file on the filesystem.\n. Fyi, working on allowing uploads to be passed directly to the addMedia-function: https://github.com/spatie/laravel-medialibrary/commit/c43e5774c46689734e4e419952ba430047c61bb5\nStill have to test it properly, ...\n. Hi, what you described isn't the use case I had in mind while creating the package. As I have no need for this in my projects, I won't add this anytime soon.\nYou could however make your idea work by\n-  when adding a file saving it against some kind of dummy eloquent model\n-  creating a many-to-many-polymorphic relation between the media table and your content tables.\nIf you're up to it, you could creating your own package for this specific use case.\n. I don't know what you are trying to say. Could you please describe the problem or feature request?\n. I believe this is a very specific use case that many users of the package don't need. Adding it would make the code more complicated than it needs to be. I'm not going to included this.\nI'm assuming you are asking for this because you want to use an url like \"http://yourdomain.com/media/customer/2014/jpg\". You could make a controller that responds to such urls and queries the media table directly.\n. Could you tell me what sort of images you are trying to process and which conversionProfiles you are using. Tell me anything that helps me recreate the problem.\nIf you can spot a problem in the code, you're welcome to submit a PR to fix it.\n. Thanks for bringing this to my attention. Like mentioned in your PR, this issue was caused by a memory leak in the underlying spatie/laravel-glide package. It has been solved there. Just make sure you have version 2.2.5 of that package installed.\n. I'm having no problem converting an entire large medialibrary with this command. Behind the scenes gd or imagick is used so maybe the high memory usage happens there. Changing PHP's memory limit will not help in that case.\nAre you running this by any chance on a droplet with only 512MB of RAM. In that case, try adding a little bit of swap to see if that helps.\n. It's possible that there is a memory leak with GD / Imagick. I'll try to debug this soon.\nIn the meantime you could try performing all conversions seperately on a queue. This will convert each image in their seperate PHP process and avoid memory leaks.\n. Have you tested this yourself? In my tests this change doesn't solve the problem. There's still a memory leak. \n. Mmm, on my machine the leak remained even after your fix. I\nI've updated the underly Glide package to resolve the memory issue. Could you, in your project, run a composer update to get the latest version of the medialibrary and version 2.2.5 of spatie/laravel-glide (that one has been released a few minutes ago). Run your tests again and let me know if it is fixed.\n. Nice! Thanks for testing!\n. I haven't used that package myself, but I guess it'll work. Try it out, and let me know.\n. Unfortunately no, I haven't got any experience with Mongo. I hope another user of the package can help you out.\n. I'm going to close this for now. If you ever find a good way to solve these issues or find another way to integrate mongo, feel free to reopen this issue. \n. This package requires version 2.2.4 of spatie/laravel-glide. That package requires version 0.3.* of Glide. So I think you could already use fill.\n. No problem! Have fun using the package.\n. If you see functionality in master-branch that isn't available in latest released version, than probably the maintainer is still working on the code. You'll have to wait for the stable release (or use dev-master packages in your project, which I personally don't recommend)\n. Could you give an example of what your want to accomplish? \nCould a medialibrary conversion help you?\n. The Glide documentation states that 1.0 in still being developed. Once it gets released, I'll make sure to update my package. Meanwhile, you could perform your resize before adding the image to the medialibrary.\n. A possible strategy is to put those files in their own collection:\nphp\n$yourModel->setMedia($pathToPreConvertedImage)->toCollection('thumbs');\n. I'm planning on releasing a new major version of the medialibrary that'll make use of Glide 1.0 in the coming months\n. Detecting changes inside the directory is not the responsability of this package. \nTo solve your problem you could build a script that compares the contents of your ftp against the file_name in the media table. If a change is detected you can update the media object with the new file name:\nphp\n$media->file_name = $newFileName\n$media->save() //image conversions run again for that media object\n. That's an excellent answer @brunogaspar. :+1: \n. Hi, thanks for your input.\nIn the newly released v3.1.0 of the package there is a new method usingFileName() to choose the filename with which it gets added to the medialibrary. \nphp\n$newsItem->addMedia('test.txt')->usingFileName('othertext.txt')->toMediaLibrary();\nThe above method only changes the name of the underlying file. If you want to change the name of the media object as well you can do this:\nphp\n$newsItem\n   ->addMedia('test.txt')\n   ->usingName('some other name')\n   ->usingFileName('othertext.txt')\n   ->toMediaLibrary();\nThere is currently no support for using subdirectories. The copyToMediaLibrary-function is used internally by the package. There is an extra parameter there so the package can handle storing conversions.\nI haven't tested using slashes in the filename, it might work for now, but I don't recommend it.\n. These are the right use statements:\nphp\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nI've corrected it in the docs.\n. When using the hasMediaConversions-interface your model must implement the registerMediaConversions-function. See the example in the docs.\n. Np, have fun using the package.\n. Hi,\nthanks for your proposal. Here are my thoughts on it.\nThe package was designed to make users don't care about where an how files are stored. The current folder structure with every media having its own directory has lots of benefits:\n- different media objects can store files with the same file name\n- conversions are stored closely to the original file\n- when a media gets deleted the cleanup is very easy: we just have to delete the folder belonging to the media\n- there's no way a user can overwrite the conversion folder\n- by not allowing any exceptions, the code to maintain this organization is very slim and clean\nUnless you can suggest a good alternative while preserving these benefits, I'm not inclined to add support for other directory structures.\n. That's a nice idea, but I'm still a bit skeptical. When a media object gets deleted we simply delete it's directory. If custom directories are allow there should be precautions that two media objects do not use the same custom directory. A media object should also not be allowed to store it's contents inside the directory of another media object. \nIf you want to go through with this idea, feel free to submit a PR. Be sure to add tests. If the changes are elegant enough, I'll merge it (but I'm making no guaranties). If you have further question or want my opinion on something, let me know.\n. Ok, let me know when you have finished your work. I'm curious how you're going to tackle this.\nHave fun coding it up!\n. I've taken a look at your changes: https://github.com/canvural/laravel-medialibrary/commit/bbf0ea2a8bccb471fa9cf6e3a14ced53453ba2bc\nNice work!\nTo prove these changes work you should write automated tests. :smile: \nI don't see precautions to prevent the deleting of files if the directory of one media item is inside the directory of another.\n. In the coming weeks I'll be reviewing this pull request that add this feature: https://github.com/spatie/laravel-medialibrary/pull/50\n. I have decided not to put this feature in for now. I'll keep it in mind when working on a next major version.\n. Thanks for the kind words.\nThis bug has been fixed in the newly tagged version 3.1.4.\n. Hi, I appreciate your efforts. Currently i'm having a week's holiday and\nLaracon EU after that. I'll take a look at this PR at the end of next week.\nOn Tuesday, August 18, 2015, Chris White notifications@github.com wrote:\n\nHi, me again :)\nI came across a need to not only retrieve the public-facing URL to a media\nitem, but also to retrieve the full path on disk to it. I thought the\neasiest way to do that would be to create a getPath() method on the Media\nmodel, like the already existing getUrl() method.\nThere are a couple of concerns I have about this PR:\n- The responsibilities of LocalUrlGenerator and S3UrlGenerator is now\n  mixed between generating URLs and generating paths to the file. Separating\n  concerns into a LocalUrlGenerator and LocalPathGenerator seems really\n  redundant, though.\n- I wasn't quite sure what to return in the getPath() method of\n  S3UrlGenerator. In the end I settled on just returning the relative\n  path, as that's how you would usually access an object stored on S3.\n- The it_can_get_the_default_collection test on GetPathTest.php seems\n  to be a duplicate of the same method in GetUrlTestphp, I'm not 100%\n  sure what this method does as it doesn't seem to be relevant to the\n  getPath() or getUrl() methods.\nI'm happy to discuss the above issues and if you think they require action\nI'll work on the PR some more.\nThanks,\nChris\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/spatie/laravel-medialibrary/pull/47\nCommit Summary\n- Add getPath() method to Media model and LocalUrlGenerator, create\n  GetPathTest\n- Add getPath() method to S3UrlGenerator\nFile Changes\n- M src/Media.php\n  https://github.com/spatie/laravel-medialibrary/pull/47/files#diff-0\n  (20)\n- M src/UrlGenerator/LocalUrlGenerator.php\n  https://github.com/spatie/laravel-medialibrary/pull/47/files#diff-1\n  (10)\n- M src/UrlGenerator/S3UrlGenerator.php\n  https://github.com/spatie/laravel-medialibrary/pull/47/files#diff-2\n  (10)\n- A tests/Media/GetPathTest.php\n  https://github.com/spatie/laravel-medialibrary/pull/47/files#diff-3\n  (52)\nPatch Links:\n- https://github.com/spatie/laravel-medialibrary/pull/47.patch\n- https://github.com/spatie/laravel-medialibrary/pull/47.diff\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/pull/47.\n\n\nFreek Van der Herten\nhttps://spatie.be\n+32 495 84 27 91\n. Hi, \nI've reviewed your PR and decided that I'll pull it.  I greatly appreciate that you added tests and clearly explained your concerns.\nAbout those concerns:\n- it's indeed a bit strange that an Url generator is responsible for determining paths. On the other hand the functionality of determing the path and generating an url is tied closely together. I believe this issue can be resolved by just renaming the Url generator to something else. I'm thinking of something in the lines of Path generator. Such a rename is a breaking change. I'm not willing of tagging another major version of the package right now. So we'll keep determining the path in the Url generator for now. In a new major version I'll rename the url generator to something better.\n- I think the S3UrlGenerator is fine now\n- that test does not belong there, I'll remove it\nThanks! :+1: \n. These changes are available in the newly tagged v3.2.0\n. Fixed in v3.1.5\n. Because I don't need this myself, it's not high on my priority list. If you need this feel free to submit a PR.\n. Thanks for posting your solution!\n. Thanks for all this work. I greatly appreciate that you added some tests. At first glance it technically seems ok. In the coming weeks I'll review it more thoroughly at let you know my thoughts on it.\n. Hi, I'll be reviewing this PR soon. Could you rebase it to the current master branch?\n. @canvural great thanks!\n. I've got two remarks on this PR:\n1. The getDirectory-function in the trait is kinda weird. It's  not that intuitive. Specify the custom directory via the model also isn't very flexible. I think ik would be better to define a method to specify the directory on the FileAdder class. Such a method could be named usingDirectory (maybe you could come up with something better). In that way a custom directory can be specified per file.\n2. As it stands now there is no protection against a media object saving it's files inside the directory of another media object. This could result in data loss when a media object with the parent folder gets deleted. I don't think this can be easily solved. I'm thinking of added a big warning in the documentation that this could happend. It's up to the user of the package to don't make any mistakes.\nWhat are your thoughts on this? \n. Hi,\nThough your implementation is technically sound, I have decided not to merge this PR in.\nI believe only a small amount of users will need to use custom directories. Supporting this feature adds a lot of code complexity that I'm not willing to maintain. The main thought behind this package is that a user should not worry about the directories that the media library uses.\nThat being said, I want to thank you for the work you've put into this. If you want to use custom directories in your own project you could use something like Satis to use your own branched off version.\n. Can you an error message or trace in your logs?\n. Nice! Thanks for letting me know the solution.\n. In the defining conversions section of the readme it is mentioned that you should specify the hasMediaConversions-interface.\n. No prob!\nI'd put them in different collections. I wouldn't really mind that there is only one image in it.\n. Thanks!\n. Nice, I didn't know that function. Thanks!\n. Hi, could you check which version you have pulled in? Version 3.2.1 has a bug that causes this problem. It is fixed in 3.2.2.\nI you just started out using this package you should:\n- delete the media table in your db\n- remove the media table migration\n- update the package to 3.2.2\n- publish the migration\n- run the migration\nIf you already have contents in your media table and it's not possible to start over you should make the model_id and model_type nullable.\nI'm sorry for this hassle. It's my mistake and I'll make sure it won't happen again.\nLet me know if this fixes your problem.\n. Yeah, I'll check it in the coming days and put your contributions back in the code.\n(no excuses from you necessary, I should have checked it more thoroughly when merging your PR.)\n. @uyab I've added your contribution back in. You were correct regarding the root problem. Thanks!\n. Thanks for the kind words. I'm glad you like the spatie-packages :)\nThe media table or the relationship with the model isn't anything special.  So I think the nested eager loading could help avoiding the extra queries.\nTry changing:\nphp\n$user = $this->user->where('username', $username)->first();\nto \nphp\n$user = $this->user->with(['jobs', 'jobs.media'])->where('username', $username)->first();\nLet me know if that works for you.\n. I'll fix this in the near future by removing the dependency alltogheter.\n. The dependency on spatie/eloquent-sortable is removed in version 3.2.4\n. I'm gonna close this for now. When your feature is ready, we'll discuss it further on your pr.\n. I'm glad you found the solution quickly :+1: \n. I'm by no means an expert on how to test this (and haven't seen the lesson yet you are referring to). I'm guessing that in the AddPhotoToJob does a call to the medialib somewhere. I think you should send that call to a mock instead of sending in to the real medialib. Your tests should only test your own code and not the medialib's.\nI don't think that how to mock the medialib should be in the readme of this package. But I'm interested in how you are going to make your test work. Let me know when you've figured it out.\n. Did you install the service provider? Does config('laravel-medialibrary.custom_url_generator_class') point to a valid class?\n. Have you added a disk named \"media\" in app/config/filesystems.php?\nMore info in the installation instructions.\n. Can you check what is the value of $urlGeneratorClass on this line: https://github.com/spatie/laravel-medialibrary/blob/master/src/UrlGenerator/UrlGeneratorFactory.php#L19 ?\n. Did you find a solution for this issue?\n. I'm going to close this for now. If you have any further problems let me know. I'd appreciate if you could add your solution to this issue. It might be helpful for others.\n. Unless you present a convincing use case, I'm not going to merge this PR. Are you missing certains methods on Media?\n. That's a good example. I've decided to accept your PR. Could you rebase it first? Then I'll merge your changes, do a little bit of housekeeping and tag a new version.\nThanks!\n. @pascalbaljet I found a bit of time to review your changes and solved the merge conflicts myself. All changes are available in the newly tagged version 3.4.0. Thank you very much for your contribution.\n@uyab If you're going to use a custom model and want to use extra field, you should write a migration to add fields (given that you're using the media table provided by this package as a base)\n. Are you referring to the Media type hints in the closures?\n. I've removed the typehints. Unless you need this quickly, these change will get tagged the next time I'll update the package in a more meaningful way.\n. This is fixed in version 3.3.1\n. Hi,\nI can't see the immediate cause or solution, but suspect the problem isn't releated to this package.\nTry asking your question on of these excellent places:\n- laracasts forum\n- larachat\n- laravel.io forums\n. Could you describe the problem with a bit more detail?\n. This package does not have a delete()-method in it's trait and already listens to a delete event. It seems to me this problem must be solved at Cartalyst's end.\n. My bad, forgot that we had that. Like stated in the comments, we still have to figured out why the model event isn't working properly. As soon as we have figured that out we can drop the delete-method. \n. Will fix in a future major version.\n. You can solve this in your application by listening to eloquent delete events and checking if the deleted model implements the hasMediaConversions-interface.\nIt won't be fixed in v3, but I'll try to make it better in the next major version which 'll be released somewhere this year.\n. I've decided not to pull in that solution. I'll solve this problem in the next major version of the package. \nIf you are having problems with the EntityTrait from Cartalyst be sure to take a look at the code in #182.\n. This issue is fixed in v3.16.1\n. The behaviour you're describing lies beyond the scope of this package. Your application should handle this. Here's how I do it in my projects (simplified version):\n1. Add a field temp to the model.\n2. When adding a new entity already persist it with the temp value of 1\n3. Now you model can already have media\n4. When succesfully having stored the entity for the first time set it's temp flag to false.\nI've got a daily job running that cleans up the temp records.\nThere are multiple ways to do it, this is only how I do it. See if that fits your project.\n. Media is always attached to a model. But you can mark uploaded media as tempory as wel by using a custom property.\n. Yeah, it's a bit of a hassle. So I always created a model first, mark it as temporary. If the user finishes the flow, remove the temporary flag for the model/media.\n. Np!\nIn my projects almost every table has a draft (aka temp) field with a default value of 1. All models have a draftable trait which sets the temp field to false when a record is updated for the first time.\n. The tests are failing. Could you give me an example of the problem (or even better add a test)? \n. Morphmap was introduced in Laravel 5.1.16. Using this would break compatibility with older versions.\n. Hi,\ncurrently there is no way to perform an initial conversion. In our projects we got plenty of diskspace and storing a big image isn't really a problem. In the public section of our sites we never show the original image, but use a profile name something like bigImage which is max 2000x2000.\nI think that resizing the original image before adding it to the medialibrary is a responsability of the application. However, it would be a nice to have for this package. So if you would submit a PR (with tests) that adds this functionality to the package, I'd likely merge it.\n. Generating an optimized image is more a responsibility for Glide imho. You should propose this feature there. \n. I don't think returning a value is necessary. What should it return according to you? Do you have a specific use case in mind?\n. In your case you could do:\nphp\n$media = Media::findOrFail($request->id_media);\n$media->delete();\n. The tests are failing. Could you fix that?\n. I'm going to leave this for now. Upping the dependancies is considered a breaking change and I'm not ready for a new major version. I'll fix this when tagging a new major version in future.\n. Here is some background info: http://evertpot.com/testing-composer-prefer-lowest/\n. If you just want to add a custom property to an uploaded media file it's best to use custom properties.\nIf you really want to use your own model, the documentation provides some starting points on how to do that.\n. \n. https://docs.spatie.be/laravel-medialibrary/v5/advanced-usage/using-your-own-model. Did you register the service provider?\nphp\n// config/app.php\n'providers' => [\n    ...\n    Spatie\\MediaLibrary\\MediaLibraryServiceProvider::class,\n];\n. This package is build entirely on the idea of files being associated with models. \nTo create the behaviour that you want I'd create a table called MediaGroups or something similar. A MediaGroup has a name and can contain one or more Media-items. Think of it as a sort of directory. All uploaded media must be related to a MediaGroup. \nTo associate the media items with the real content you could use your own media model and use a polymorphic relation.\nI think providing MediaGroups (or MediaTree would be a more appropriate name if nested set would be used) isn't a responsability of the package. But it could be a package in its own right.\n. Well, apart from the proposed directory structure, everything you described can be handled by the medialibrary.\nYou could pass your upload request to the media library like this:\nphp\n$user->addMedia($request->file('image'))->toCollection('avatars');\nAnd you can retrieve an url to the image with this piece of code:\nphp\n$user->getCollection('avatars')->first()->getUrl('thumb');\nI'm assuming that you prepared your model and set up a conversion named \"thumb\".\nYou really shouldn't worry about directory structure, the medialibrary handles this behind the scenes for you.\n. Files will be uploaded in seperate directories. No need to make the file names unique. Creating routes / controllers isn't a responsability of this package. If you want to know how to do that, checkout out this awesome lesson on Laracasts.\n. Np! Have fun using the package. If you have a question about it, don't hesitate to open another issue.\n. Ah, I gave you an example with the old syntax. Sorry about that\nYou should use getMedia instead of getCollection.\nThe largest library I have is a few thousand files. If you run into problem when using 100k+ images, let me know.\n. The package can use multiple disks, but your application logic should determine which file should go to which disk.\n. seems good\n. The documentation mentions on how to do this.\n. The idea behind the medialibrary is that you don't have to manage the media folder. You can specify were the media folder should reside by configuring a filesystem in app/config/filesystems.php and let the package use that filesystem.\n. I suggest that you delete the old picture right before adding the new picture.\n. A media object is just a normal eloquent model. You can call delete on it:\n```\npublic function avatarUpload(Request $request, $slug)\n    {\n        $user = User::findBySlug($slug);\n    $user->getMedia('avatars')->first()->delete();\n\n    $user->addMedia($request->file('file'))->toCollection('avatars');\n\n    return 'working on it';\n}\n\n```\nOr, instead of deleting the model, you could clear the entire collection for that user:\n$user->clearMediaCollection('avatars');\n. That error is thrown when generating an url. Could you show the code where\nyou call getUrl()?\nOn 30 October 2015 at 14:51, kickthemooon notifications@github.com wrote:\n\nmy disks:\n...\n'media' => [\n            'driver' => 'local',\n            'root'   => public_path().'/media',\n        ],\n'avatars' => [\n        'driver' => 'local',\n        'root'   => public_path().'/media/avatars',\n    ],\n...\nmy edit and update method:\npublic function edit($slug)\n    {\n        if($slug != Auth::user()->slug) {\n```\n        abort(403);\n}else {\n\n$user = User::findBySlug($slug);\n$avatarthumb = $user->getMedia('avatars')->first()->getUrl('thumb');\n$cities = ['0'=>'Select country first'] + City::lists('city', 'id')->all();\n$countries = ['0'=>'Select user country'] + Country::lists('country', 'id')->all();\n\nreturn view('front.users.edit', compact('user', 'cities', 'countries', 'avatarthumb'));\n\n}\n\n}\n/\n * Update the specified resource in storage.\n \n * @param  int  $id\n * @return Response\n /\npublic function update(Request $request, $slug)\n{\n    if($slug != Auth::user()->slug) {\n        abort(403);\n    }else {\n        $user = User::findBySlug($slug);\n        $user->update($request->all());\n    }\nreturn redirect('/');\n\n}\n```\nmy photo upload method:\npublic function avatarUpload(Request $request, $slug)\n    {\n        $user = User::findBySlug($slug);\n```\n    $user->clearMediaCollection('avatars');\n$user->addMedia($request->file('file'))->toCollectionOnDisk('avatars', 'avatars');\n\nreturn 'working on it';\n\n}\n```\nthe error:\nUrlCouldNotBeDetermined in LocalUrlGenerator.php line 19:\nThe storage path is not part of the public path\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/84.\n. You can pass any parameter from the Glide API to the setManipulations-method.\n\nMore info in the documentation.\n. I can't see anything wrong except that \\media\\avatars/30/conversions/medium.jpg is not a valid url.\n. Could you look up what these functions return\nphp\n$this->getStoragePath()\npublic_path()\n$this->getBaseMediaDirectory()\n$this->getPathRelativeToRoot()\nin\nhttps://github.com/spatie/laravel-medialibrary/blob/3.7.0/src/UrlGenerator/LocalUrlGenerator.php#L18-L22\n. You can do this quick and dirty by adding some echo statements that that\nfunction.\nI'm pretty sure something in hour configuration is not right and getting\nthe output of those functions might ging us a clue\nOn Sunday, 1 November 2015, kickthemooon notifications@github.com wrote:\n\nhow would i look that up? not sure :(\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/86#issuecomment-152860827\n.\n\n\nFreek Van der Herten\nhttps://spatie.be\n+32 495 84 27 91\n. What is the output of getStoragePath in that file?\n. I think you might have discovered a bug in the package when working in Windows. The directory delimiter is different from the one used on linux-like hosts.  I'll investigate this further and add a solution soon.\n. It's a bit dirty yes, but if I don't find a better way to fix this, that code 'll probably end up in the package.\n. This is fixed in v3.7.1 of the package.\n. The collection holds Media objects which are regular Eloquent models. You can use those to update properties.\nTo get a specific media object you either have to loop a collection or manually query the media table.\n. 1. \nphp\n$media = Media::find($idOfMedia)->name = 'new name';\n$media->save();\n1. You could use the a custom property or id.\n2. Just use regular eloquent methods on the Media class.\n. Np, the id i'm referring to is the regular id of the eloquent model.\nphp\nMedia::first()->id;\n. Reopen this if you want to continue the conversation.\n. This has been added to v3.7.2\n. Yep, that's expected behaviour. Doing it like this will make sure that you can upload files with the same name. If you would use the image conversions you'd see that the conversions of an image also will get stored into that directory.\n. Np, have fun using the package!\n. Media models are regular Eloquent models, so you can call delete() on them. When you delete them the associated files will be deleted from the filesystem.\n. Did you install the service provider before trying to publish the migration?\nAlso: the migration only gets published if there is not already a class named CreateMediaTable.\n. This can be done with usingFileName.\nphp\n$user->addMedia($request->file('image'))->usingFileName($yourCustomFileName)->toCollection('images');\n. These seem like things that are specific to your application. You could make it readable by adding some helper methods to your own application.\n. This seems to work at my end.\n\nWhich version of php are you using?\n. Hi, thank you for your interest in our package.\nHere are some answers to your questions:\n- I've explained the reasoning for creating a folder per file in #89.\n- I don't see why it would be dangerous to generate directory name for storing and getUrl() separately. Can you elaborate on that?\n- I don't think it's bad to automatically put a .gitignore in the directory. The idea behind this package is that you shouldn't mind what the contents of that directory is.  If you' re going to store media on a disk, surely there's room for one .gitignore file. It think for the majority of users this is ok and helpful. You're quite right however that for Subversion users are being left out in the cold. I'll add an instruction in the readme so that they are aware they should ignore that directory themselves.\nWe create the packages for our own projects and try to make them extendable and general as possible so other users can enjoy them too.  You should be aware that this package, along with the others ones we make, is quite opinionated. If you feel that we are doing dangerous things, feel free to fork our code.\n. Hi,\nyou're right the performance may be an issue when storing a large amount of files.  We've touched on this in #45.\nThis could be solved by adding an extra directory layer with a folders that hold 10000 items.\nI'm thinking of a structure like this:\n-medialib\n---0\n------1\n------2\n------3\n...\n----9999\n---1\n------10001\n------10002\n------10003\n...\nThis isn't yet implemented because we haven't had to deal which such big medialibraries ourselves.\nI'd accept a PR that adds this functionality and provides tests to prove that it works.\n. PR #97 has been merged. Changes are available in v.3.9.0\nI found it solved this issue in a very elegant way. Thank you very much for your contribution. \n. Which error message are you getting?\n. Could you paste entire error from the log? That'll give more clues to what is happening.\n. Than put a try catch block around the not working code and try to display / log the error and the trace manually.\n. What is the error message you're currently getting?\n. Does your class implement HasMediaConversions ?\n. Seems all ok, could you give some extra info on the 500 internal error. An exception message or trace would be handy.\n. The error message points out that there is something wrong with your\nconversion profile. Could you check that you are using valid parameters\nfrom the Glide Api?\nOn Saturday, 7 November 2015, kickthemooon notifications@github.com wrote:\n\nso i did this:\npublic function avatarUpload(Request $request, $slug)\n    {\n        try {\n        $user = User::findBySlug($slug);\n```\n    $user->clearMediaCollection('avatars');\n$user->addMedia($request->file('file'))->toCollectionOnDisk('avatars', 'avatars');\n} catch (Exception $e) {\n    echo $e->getMessage();\n}\n\nreturn 'Working on it';\n\n}\n```\nand got this:\nWhoops, looks like something went wrong.\n1/1\nInvalidArgumentException in Api.php line 60:\nNot a valid manipulator.\nin Api.php line 60\nat Api->setManipulators(array(object(Orientation), object(Rectangle), object(Size), object(Brightness), object(Contrast), object(Gamma), object(Sharpen), object(Filter), object(Blur), object(Pixelate), object(Output))) in Api.php line 31\nat Api->__construct(object(ImageManager), array(object(Orientation), object(Rectangle), object(Size), object(Brightness), object(Contrast), object(Gamma), object(Sharpen), object(Filter), object(Blur), object(Pixelate), object(Output))) in GlideApiFactory.php line 43\nat GlideApiFactory::create() in GlideImage.php line 99\nat GlideImage->save('C:\\wamp\\www\\baseapp\\storage\\medialibrary/temp/0oj6DPZaRxmdnbmZ/oKIX5wjtxnw4srNzthumb.jpg') in FileManipulator.php line 96\nat FileManipulator->performConversion(object(Media), object(Conversion), 'C:\\wamp\\www\\baseapp\\storage\\medialibrary/temp/0oj6DPZaRxmdnbmZ/a13fqEIQjJd4yhEq.jpg') in FileManipulator.php line 65\nat FileManipulator->performConversions(object(ConversionCollection), object(Media)) in PerformConversions.php line 38\nat PerformConversions->handle()\nat call_user_func_array(array(object(PerformConversions), 'handle'), array()) in Container.php line 503\nat Container->call(array(object(PerformConversions), 'handle')) in Dispatcher.php line 193\nat Dispatcher->Illuminate\\Bus{closure}(object(PerformConversions))\nat call_user_func(object(Closure), object(PerformConversions)) in Pipeline.php line 139\nat Pipeline->Illuminate\\Pipeline{closure}(object(PerformConversions))\nat call_user_func(object(Closure), object(PerformConversions)) in Pipeline.php line 103\nat Pipeline->then(object(Closure)) in Dispatcher.php line 205\nat Dispatcher->dispatchNow(object(PerformConversions), object(Closure)) in CallQueuedHandler.php line 43\nat CallQueuedHandler->call(object(SyncJob), array('command' => 'O:43:\"Spatie\\MediaLibrary\\Jobs\\PerformConversions\":5:{s:14:\"_conversions\";O:51:\"Spatie\\MediaLibrary\\Conversion\\ConversionCollection\":1:{s:8:\"_items\";a:2:{i:0;O:41:\"Spatie\\MediaLibrary\\Conversion\\Conversion\":4:{s:7:\"_name\";s:5:\"thumb\";s:16:\"_manipulations\";a:1:{i:0;a:2:{s:1:\"w\";i:60;s:1:\"h\";i:60;}}s:23:\"_performOnCollections\";a:1:{i:0;s:7:\"avatars\";}s:17:\"_performOnQueue\";b:1;}i:1;O:41:\"Spatie\\MediaLibrary\\Conversion\\Conversion\":4:{s:7:\"_name\";s:6:\"medium\";s:16:\"_manipulations\";a:1:{i:0;a:3:{s:1:\"w\";i:350;s:1:\"h\";i:250;s:3:\"fit\";s:4:\"crop\";}}s:23:\"_performOnCollections\";a:1:{i:0;s:7:\"avatars\";}s:17:\"_performOnQueue\";b:1;}}}s:8:\"_media\";O:45:\"Illuminate\\Contracts\\Database\\ModelIdentifier\":2:{s:5:\"class\";s:25:\"Spatie\\MediaLibrary\\Media\";s:2:\"id\";i:58;}s:5:\"queue\";N;s:5:\"delay\";N;s:6:\"_job\";N;}')) in Job.php line 129\nat Job->resolveAndFire(array('job' => 'Illuminate\\Queue\\CallQueuedHandler@call', 'data' => array('command' => 'O:43:\"Spatie\\MediaLibrary\\Jobs\\PerformConversions\":5:{s:14:\"_conversions\";O:51:\"Spatie\\MediaLibrary\\Conversion\\ConversionCollection\":1:{s:8:\"_items\";a:2:{i:0;O:41:\"Spatie\\MediaLibrary\\Conversion\\Conversion\":4:{s:7:\"_name\";s:5:\"thumb\";s:16:\"_manipulations\";a:1:{i:0;a:2:{s:1:\"w\";i:60;s:1:\"h\";i:60;}}s:23:\"_performOnCollections\";a:1:{i:0;s:7:\"avatars\";}s:17:\"_performOnQueue\";b:1;}i:1;O:41:\"Spatie\\MediaLibrary\\Conversion\\Conversion\":4:{s:7:\"_name\";s:6:\"medium\";s:16:\"_manipulations\";a:1:{i:0;a:3:{s:1:\"w\";i:350;s:1:\"h\";i:250;s:3:\"fit\";s:4:\"crop\";}}s:23:\"_performOnCollections\";a:1:{i:0;s:7:\"avatars\";}s:17:\"_performOnQueue\";b:1;}}}s:8:\"_media\";O:45:\"Illuminate\\Contracts\\Database\\ModelIdentifier\":2:{s:5:\"class\";s:25:\"Spatie\\MediaLibrary\\Media\";s:2:\"id\";i:58;}s:5:\"queue\";N;s:5:\"delay\";N;s:6:\"_job\";N;}'))) in SyncJob.php line 44\nat SyncJob->fire() in SyncQueue.php line 27\nat SyncQueue->push(object(PerformConversions)) in Dispatcher.php line 269\nat Dispatcher->pushCommandToQueue(object(SyncQueue), object(PerformConversions)) in Dispatcher.php line 244\nat Dispatcher->dispatchToQueue(object(PerformConversions)) in Dispatcher.php line 176\nat Dispatcher->dispatch(object(PerformConversions)) in DispatchesJobs.php line 18\nat FileManipulator->dispatch(object(PerformConversions)) in FileManipulator.php line 148\nat FileManipulator->dispatchQueuedConversions(object(Media), object(ConversionCollection)) in FileManipulator.php line 42\nat FileManipulator->createDerivedFiles(object(Media)) in Filesystem.php line 41\nat Filesystem->add('C:\\wamp\\tmp/php8513.tmp', object(Media), '_downloadfiles_wallpapers_1920_1200_widescreen_color_pulse_wallpaper_abstract_3d_wallpaper_1920_1200_widescreen_75.jpg') in FileAdder.php line 306\nat FileAdder->toCollectionOnDisk('avatars', 'avatars') in UsersController.php line 28\nat UsersController->avatarUpload(object(Request), 'admin')\nat call_user_func_array(array(object(UsersController), 'avatarUpload'), array(object(Request), 'slug' => 'admin')) in Controller.php line 76\nat Controller->callAction('avatarUpload', array(object(Request), 'slug' => 'admin')) in ControllerDispatcher.php line 145\nat ControllerDispatcher->call(object(UsersController), object(Route), 'avatarUpload') in ControllerDispatcher.php line 93\nat ControllerDispatcher->Illuminate\\Routing{closure}(object(Request))\nat call_user_func(object(Closure), object(Request)) in Pipeline.php line 139\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request))\nat call_user_func(object(Closure), object(Request)) in Pipeline.php line 103\nat Pipeline->then(object(Closure)) in ControllerDispatcher.php line 95\nat ControllerDispatcher->callWithinStack(object(UsersController), object(Route), object(Request), 'avatarUpload') in ControllerDispatcher.php line 54\nat ControllerDispatcher->dispatch(object(Route), object(Request), 'App\\Http\\Controllers\\Front\\UsersController', 'avatarUpload') in Route.php line 204\nat Route->runWithCustomDispatcher(object(Request)) in Route.php line 135\nat Route->run(object(Request)) in Router.php line 685\nat Router->Illuminate\\Routing{closure}(object(Request))\nat call_user_func(object(Closure), object(Request)) in Pipeline.php line 139\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in AuthorizeMiddleware.php line 38\nat AuthorizeMiddleware->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(AuthorizeMiddleware), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in Authenticate.php line 45\nat Authenticate->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(Authenticate), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request))\nat call_user_func(object(Closure), object(Request)) in Pipeline.php line 103\nat Pipeline->then(object(Closure)) in Router.php line 687\nat Router->runRouteWithinStack(object(Route), object(Request)) in Router.php line 660\nat Router->dispatchToRoute(object(Request)) in Router.php line 636\nat Router->dispatch(object(Request)) in Kernel.php line 236\nat Kernel->Illuminate\\Foundation\\Http{closure}(object(Request))\nat call_user_func(object(Closure), object(Request)) in Pipeline.php line 139\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in VerifyCsrfToken.php line 64\nat VerifyCsrfToken->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(VerifyCsrfToken), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in ShareErrorsFromSession.php line 49\nat ShareErrorsFromSession->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(ShareErrorsFromSession), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in StartSession.php line 62\nat StartSession->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(StartSession), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in AddQueuedCookiesToResponse.php line 37\nat AddQueuedCookiesToResponse->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(AddQueuedCookiesToResponse), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in EncryptCookies.php line 59\nat EncryptCookies->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(EncryptCookies), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in CheckForMaintenanceMode.php line 42\nat CheckForMaintenanceMode->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(CheckForMaintenanceMode), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request))\nat call_user_func(object(Closure), object(Request)) in Pipeline.php line 103\nat Pipeline->then(object(Closure)) in Kernel.php line 122\nat Kernel->sendRequestThroughRouter(object(Request)) in Kernel.php line 87\nat Kernel->handle(object(Request)) in index.php line 54\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/95#issuecomment-154690775\n.\n\n\nFreek Van der Herten\nhttps://spatie.be\n+32 495 84 27 91\n. Unfortunately, on first glance it don't see what's wrong either.\n. In the code posted above I don't see any usage of the orientation. Could you post the conversionProfile that is causing you problems?\n. I can't seem to reproduce this. What version of Glide are you using?\n. Thank you very much. I'll tag a new version containing these changes soon.\n. Epic pull request, thanks! \nOn first glance, there aren't any breaking changes. I'll tag a new version containing these changes soon.\n. Take a look at this example in the tests.\n. These changes are available in v3.9.0\n. You can set the name the original file that is stored on disk with the usingFileName-function.\nSee http://medialibrary.spatie.be/v3/api/adding-files/\n. If you don't use a custom path generator the medialibrary guaranties that there are no filename collisions \nif you do using a custom path generator it's your responsibility to make sure a media item gets it's own unique directory. This is mentioned in the docs\n. Do conversions in general work in your app?\n. Is the image from the url being added to the medialibrary? What is it's\nextension?\nOn Saturday, 7 November 2015, ato10 notifications@github.com wrote:\n\n$item->addMedia(...)->preservingOriginal()->toCollection('images');\nworks great\n$item->addMediaFromUrl(...)->toCollection('images');\ndoesn't work using the same conversion definition\npublic function registerMediaConversions()\n{\n    $this->addMediaConversion('thumb')\n         ->setManipulations(['w' => 78, 'h' => 78])\n         ->performOnCollections('images');\n}\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/98#issuecomment-154744340\n.\n\n\nFreek Van der Herten\nhttps://spatie.be\n+32 495 84 27 91\n. This package uses Laravel's built in Cloud Filesystem. To use S3 you'll have to require league/flysystem-aws-s3-v3. It's mentioned in the Laravel docs.\nFor clarity I'll mention this optional requirement in our docs.\n. The original file will have been added to the medialibrary after toCollectionOnDisk has done its work. The converted files will be created later (if they are queued).\nYou could use a custom Media model. Let your custom one extend the Media class provided by this package. Then override the toCollectionOnDisk-method. Add your own logic after calling the parent method.\nThoughts?\n. I'm ok with events being added to the package. On first thought, I think these would be handy to have:\n- MediaHasBeenStored(Media)\n- ConversionHasFinished(Media, conversionName)\n- MediaHasBeenDeleted(mediaId)\n- CollectionHasBeenCleared(Media, collectionname)\nI'll try to add these to the package soon, but if you need this quick, I'd welcome a PR that adds this.\n. CollectionClearedEvent, ConverionCompleteEvent, MediaAddedEvent are available in v3.10.0\n. Yeah you're right, that was a typo.\nSeeing that made me think about the names of all events. I renamed them all in v3.10.1 to make them more readable:  CollectionHasBeenCleared, ConversionHasBeenCompleted, MediaHasBeenAdded\nNormally this would be a breaking change, but as not many people will have starting using these events, I'm treating it as a bugfix release.\n. Whoops, sorry about that\n. Thanks!\n. Thanks again. \nOn first glance your changes look good. I'll review them in detail in the coming days.\n. These changes are present in v3.10.0 of the package. Thanks :+1: \n. I'll take a look at this and fix it soon.\nOn Sunday, 15 November 2015, pascalbaljet notifications@github.com wrote:\n\nThis problem occurs when using 3.7.2 or later, 3.7.1 is fine.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/104#issuecomment-156814848\n.\n\n\nFreek Van der Herten\nhttps://spatie.be\n+32 495 84 27 91\n. This is fixed in v3.10.2 of the package.\n. Compression functionality is not provided by this package. You should compress your files before adding them to the medialibrary.\nI don't have any suggestion on which package you could use, but Google a bit and I'm pretty sure you'll find a good one.\nCreating optimized images is a responsibility of Glide. If you have suggestions have Glide could create better output, it's best to add an issue there.\n. Will take some time to improve on this soon.\n. The current plan is to add fire off an event right after an image is created via a conversion.  The compression will indeed be handled in a seperate package. \nI still have to research a lot before creating that new package. Maybe another one that does this already exists.\nI'll work on this whenever I got a little bit of time.\n. This should be fixed in v3.10.2. If you still are having problems while using that version, reopen this issue.\n. You could use the id of the media objects to make sure every media gets it's own unique directory.\n. There are multiple ways of achieving this. It all comes down on preference.I suggest you take a look at the excellent Project Flyer series on Laracasts. Replace the upload and thumbnail generation code but the functions provided by this package. \n. It all depends on what you want to build. \n. You must have a saved eloquent model in order to attach media to it.\nIn our projects we save an eloquent model with a draft flag. We set the draft flag to zero after the user has successfully saved for the first time.\n. It should all work on Windows machines. Did you implement the hasMediaConversions-interface? Are you getting an error message? Please make sure you followed all steps described in the documentation.\n. The medialibrary delegates image conversions to Glide. Glide uses to Imagine to create the actual images. Do those packages work on your Windows machine?\n. Currently no. You're restricted to what Glide is offering.\n. Hi, are you using the latest version of this package? Or you by any chance using S3?\n. I've made a fix for a related problem in 3.10.2. Could you upgrade to that version?\n. The problem seems indeed to be related with the latest version of the Intervention package. Investigating...\n. I have temporary put a constraint on the Intervention package inside our own Laravel Glide package. If you run composer update again Laravel Glide should upgrade to 2.2.6, the intervention package should downgrade to 2.3.2. \nI'll remove the constraint on the Intervention package as soon as wel have a proper fix.\n. Meanwhile Oliver, the creator/maintainer of the Intervention package, has fixed the issue. Run composer update again to get the latests version of the Laravel Glide and Intervention Image packages.\n. Great, thanks!\n. Hi,\nthere is no support for directly adding streams to the medialibrary. You'll have to download your file entirely first and than add it to the medialibrary. Internally the medialibrary will use a stream to copy a file to a remote filesystem.\nI'm not aware of any performance issues with the package. A requesttime of 6.38s sounds a bit too high. Are you letting the package generate a thumbnail by any chance? Could you use a service such as Blackfire.io to pinpoint the source of the performance problem?\n. Could you measure the performance of the file_put_contents statement?  I suppose it's the one in HasMediaTrait?\nYou could wrap the solution to this SO question in a function  and place it right before and right after the statement. \n. I've decided to remove that automatic adding of a .gitignore file alltogheter. I'll add some clear instructions in the documentation how to manually add the right directory to a project specific .gitigore file. I'll tag a new version with these changes in the near future.\n. I'd gladly accept a PR that removes all functionality to create gitignores. :+1: \n. This issue is fixed by not creating a gitignore file.\n. I'm looking at your original code snippet. Could you please try again clearing both mediacollections first and without the first call $prod->save();?\n. I'm not sure if I understand you correctly.\nCould you try adding:\n$prod = Prodocuts::findOrFail($id);\nafter the first save?\nI'm thinking maybe your problem has something to do with the relations that eloquent is keeping on the model.\n. I'm going to close this for now as:\n-  we couldn't reproduce this\n- no other users have run into this problems\n- you found a workaround\nIf this problem bites any other user, please reopen.\n. We probably should pay some extra attention to special characters. I'll improve this the next time I'm working on the package. I'd be happy to accept a PR that does some extra validation.\n. A first stab at fixing this is included in v3.11.2 of the package. Reopen this if this problems reoccurs.\n. I did not come across this error before. I've only used the local and S3 drivers myself. Are you using the latest adapter?\n. I'm having troubles recreating this error. Are you using the latest version of all packages involved?\n. When you delete a Media model, the associated file will be deleted as well.\n. Thanks!\n. Thanks!\n. Tagged!\n. When running composer require spatie/laravel-medialibrary on a fresh Laravel 5.2 the package installs perfectly. \nWhat is the contents of your composer.json file?\n. @binalfew could you try the solution by @danieljaniga \n. The should be none difference. I could upgrade existing projects and create new ones without problem. \nPlease reopen this if the problem pops up again.\n. There are many ways to go about this. Because the medialibrary doesn't allow for conditional resizen, I'd resize them before adding them to the medialibrary. \nAnother way could be to detect the orientation first and depending on the result add them to a collection with the conversion parameters you need.\nIt all depends on your specific needs.\n. You can use collection's each method for this.\nphp\n$images->each(function(Image $image) {\n    $image->getMedia('thumb')->each(Media $media) {\n          ...\n    });\n});\n. Replace the three dots by the specific code that you want to be executed for every Media item that is related to $images.\n. No this isn't possible. Retrieving an url to a converted media item depends on the name of the file. \nThere are currently no plans to assign a custom file name.\n. I'd consider merging in a PR if it's simple, well documented and well tested.. Take a look at the documentation regarding custom properties. There's also a setCustomProperty-method that I'll add to the documentation soon.\n. You can use this function on media\n$media->setCustomProperty('title', '...');\n$media->setCustomProperty('subtitle', '...');\n. Try adding $image->save(); before redirecting\n. Hi Maltese Rockstar,\nthank you very much for this quality explanation of the problem. I also appreciate that you suggest some quality solutions. Good job. :+1: \nI'm all for the pragmatic solution. Maybe we could introduce a extra_headers key in the config file that contains an array of options that would be merge into the second parameters of the put-function. In that way people can set all the extra headers that they want. A sane default could be ['CacheControl' => 'max-age=604800']`.\nThoughts?\n. This is implemented in v3.12.0 of the package.\n. I haven't tested it out. I assume it wouldn't work out of the box. If have no need for Lumen support myself. If you need this, I'd glady accept a PR. \n. This PR seems ok. \nYeah, there currently are no tests for those extra headers. I'll test it manually as well. When I have a little them I'll figure out the best way to automate this.\nThank you very much for your contribution.\n. I did a small refactor on your changes that made it possible to write a little pragmatic test.\n. Although your code is technically sound, I'm not willing to maintain this code as I haven't needed such functionality. I also think most package users will not need this. \nThanks for your contribution anyways!\n. Change seems good. Could you also add a test here to make sure your change works?\n. Still waiting on that test :smile: \n. I'm not sure what you're asking. Could you give a more concrete code example of what you want?\nYou can get an url to a media object with $media->getUrl(), path: $media->getPath().\n. :+1: \n. On first thought, this will make the package incompatible with previous L5 versions. Reopen if I'm wrong.\n. On your User-model you could use an accessor to retrieve the first image of a collection:\nphp\npublic function getAvatarAttribute()\n{\n    return $this->getFirstMediaUrl($collectionName, $conversionName);\n}\n. Generating a video thumbnail is out of scope for this package. You'll have research the subject a bit to find the best way. Looking at the code example above it looks like you've started your research already. :smile: \nWhen you create an image of the video, you can of course just add that image to the media library.\n. I think you want to manually add a file to the conversion folder? The package doesn't support this out of the box. That beging said, there's nothing that stops you from adding files to a conversion folder yourself. Be aware that deleting a media object will deleted the entire conversion folder as well. But that's probably good in this case.\n. Hi Michael,\nthank you for your detailed explanation. Using laravel-glide v3 isn't an option right now. Like you've already noticed it requires PHP 7 and has a tweaked API. Using that as a dependency would require a new major version for the medialibrary and I'm not yet willing to make that change.\nI believe the medialibrary can't be installed into L5.2 because Glide v.0.3.X only allows symfony 2.X components. I've asked the maintainer of Glide to tag a new 0.3.X version where symfony 3 components are allowed. Hopefully he agrees (though I would understand it if he only wants to go forward on his 1.X version).\n. The maintainer of Glide was so kind to tag V.0.3.6 that allows Symfony 3 components.\nThe medialibrary package can now be installed into a Laravel 5.2 app. \n\nLet me know if this works for you.\n. On first glance I don't think the problem is caused by the middleware. Uninstall the middleware if you want to be 100% sure.\nDid you publish the laravel glide config? If so, check the baseURL setting.\n. This is fixed. Try installing the package again.\n. There was a problem with one of the dependencies. This has been solved. \nYou should be able to install the package in L5.2 without any problems.\n\n. @I fixed this in the newly tagged version 3.14.1\n. Thanks!\n. Hi, excellent suggestion!\nI prefer a function over adding extra configuration.  delete() should not be changed. That would be a breaking change.  I think it's better to introduce function like deletePreservingFiles() (maybe the name could be a bit better).\nYet another option would be to introduce an event called MediaWillBeDeleted. It could be consumed like this (when hooked up in the Kernel):\n``` php\nnamespace App\\Listeners;\nuse Log;\nuse Spatie\\MediaLibrary\\Events\\MediaAddedEvent;\nclass MediaDeletionHandler\n{\n    /*\n     * @param \\Spatie\\MediaLibrary\\Events\\MediaWillBeDeleted $event\n     /\n    public function handle(MediaWillBeDeleted $event)\n    {\n        $media = $event->getMedia();\n       //do whatever you want here\n    }\n}\n```\nThis would allow a user to add custom logic, such as copying/moving files that will be deleted  to some archive directory.\nI'd accept a PR that adds such a function and/or event.\n. Thanks, on first glance your PR looks good. I'll go over it in detail tonight. \nFyi: I'm planning a new major version of the medialibrary package somewhere in the first half of this year.  It'll require PHP 7. New features can be introduced in the new version without worrying about breaking changes. If you have some more ideas let me know.\n. The changes of your PR are present in the newly tagged version 3.14.0\n. Thanks again!\n. On first glance the package doesn't seem able to figure out to which model the media should be related. Did you perform the migrations the package provides? Can you verify that the media table has a model_type column?\n. In the latest and greatest version of the medialibrary a function called deletePreservingMedia was added that deletes only the media and leaves the files alone. It's not yet added to the documentation (I'll do that in the coming week).\nIn the next major version of the package (ETA somewhere in 2016) we'll add better support for soft deletes.\n. Sorry, because I don't use soft deletes myself, support for it hasn't been added.. The file types are indeed uses by the package to determine which manipulations can be performed on it. \nIf you need to add your own file types you could just save a custom property on an instance of App\\Models\\Media.\n. Take a look at the documentation about using a custom directory structure.\n. Although it's a cool idea, I don't think many users of the package will need this functionality.\nIf you want this, implement it in your own application.\n. Are you using queuesto generate converions? And if so, are your queues running?\n. Media conversions will only be registered once. \nThe easiest way to achieve what I think you're trying to achieve is to register conversions for each type of widget. The performOnCollectionsmight also be helpful.\nhttp://medialibrary.spatie.be/v3/converting-images/defining-conversions/\n. I just tested this and it works perfectly here in a vanilla Laravel 5.2 installation. \nWhich version of Laravel are you using? Could you post your composer.json file?\n. You don't need to separately require spatie/laravel-glide and intervention/image. Requiring the medialibrary will automatically pull in the right versions of those packages.\n. Np! Have fun using the package.\n. The medialibrary can store images of any kind.\n. Sorry, I mistyped my previous answer. The medialibrary can store files of any kind.  Thumbnails can be generated for images and pdf's.\n. Thanks for contributing!\nI like the new functionality and will review the code in detail in the coming days.\n. I only got one big remark: The delete_model_and_collection_medias should also prove that media in other collections will still exist after calling the command.\n. Ah I see, didn't read it right the first time. All ok then!\n. I'll fix some very small nitpicks later tonight (at the latest tomorrow) and tag a new version.\n. I refactored the command and the tests a bit an tagged a new version 3.15. \ud83c\udf89\nIn your changes there was a bug present that could lead to data loss. If only collectionName was specified when running the command, all media would be deleted.\n. Your fix will not clean up the media folder itself but only the files inside it. This behaviour is probably what you want, but most users of the package won't want this.\nIf you need some custom deletion behaviour you can use your own model and overriding the delete function.\n. Maybe I'm missing something but I guess you could just retrieve the value of the custom property and use that in your mapping.\n. Easiest way would be to just get all media and filtering out the records you need.\n. Can you post the entire trace of the error? Are you only having a problem with uploading pdf's? Or are you getting the same problem with any type of file?\n. Watermarks are not supported in the version of Glide (0.3) that the media library is requiring.\nSomewhere this year we'll create a new major version of the medialibrary where Glide 1.0 is supported.\n. There are no guaranties the medialibrary will work with hhvm. I know there's a little subtle differences between php en hhvm that might get in the way.\nAre you using hhvm on your local machine as well?\n. This is the line of code that figures what extension the url should have. \nTry to strategically place some var_dump statements to see where it goes wrong. You're also welcome to submit a failing test.\n. Yup, you're right: there is a problem if some conversions have the same name. In my mind conversion names should always been unique, but the code does not enforce that. \nI'm quite hesitant on adding an exception when a collection name is not unique because that would be a breaking change. So you're best option now would indeed to use unique names.\nIn any case, thanks for bringing this to my attention. I'll address it when creating a next major version.\n. Probably you forgot to call get() at the end of your query.\n. Thank you very much for this. I got a few nitpicks with the naming of some stuff, but I'll fix that myself real quick.\n. Probably your error is caused by server configuration and not by this package. I suspect you'll find an error in the nginx logs of your server.\n. Does your Post class use the HasMediaTrait ?\nhttp://medialibrary.spatie.be/v3/converting-images/defining-conversions/\n. Found it!\nThis will return al collection of posts:\n$posts = Post::latest('published_at')->published()->get();\nYou should call the getMedia-method on a single Post model.\n. Currently there isn't a way to do this I think. It would be nice feature for the package. When I have time I'll add it to v3 (upgrading from v2 to v3 is very easy). \nIf you need this quick, I'd be happy to accept a PR on v3.\n. Did you save the model where you want to attach media to?\n. Try to make sure if the model your attaching media to has an id :-)\n. That's a good suggestion. I'll keep this in mind when creating the next major version of the package. (ETA: in next half year).\nIf you need this quick, I'd accept a non-breaking PR.\n. You all will be happy to know that this is now implemented in v7 of the medialibrary, which will be released early next year.\nIf you have a file named my-awesome-picture.jpg and a conversion on in named thumb the derived image will be named my-awesome-picture-thumb.jpg\n. This will be the only available option.. See #67 for incompatibilities with Cartalyst.\n. Thank you for taking the time to put this together.\nCurrently there's a delete-method on hasMediaTrait that handles the deletion of the media models. It works most of the time, but is incompatible with some other packages. I'll make this better when working on a new major version of the medialibrary. ETA: somewhere this year.\nMeanwhile, I'm going to leave things as they are.\n. Adding a boot method an listening to model events there seems like a good solutions indeed. I'd probably  accept a PR that adds that.\n. Looks good to me! Thanks for solving this issue!\n. This fix included in v3.16.1\n. I'm going to change my stance on this. \nAfter talking it through with @sebastiandedeyne there's really nothing wrong with upping the required versions of the illuminate components to 5.1.16. According to the semver rules this is not a breaking change so we can do this without creating a new major version of the medialibrary. \nSo, in hindsight #70 was ok.  Could you adapt this PR so it doesn't check on the existance of MorphMap and up the requirements of the illuminate components to 5.1.16. If Travis confirms that all is ok, I'll pull. \nSorry for the extra hassle, your work on this is greatly appreciated.\n. Nice, thanks!\n. I didn't need that function myself and nobody was really missing it, that's why it isn't included in the package.\nYour implementation seems ok. I'd accept that if you choose to create a PR for it (please add also add a test to ensure that it works correctly).\n. This is included in v4 which will be released somewhere this month.\n. Nice catch. You're right the type of file without an extension isn't detected properly. It would be better if the medialibrary should use File::getMimeType() first before relying on the extension to detect the type.\nI'll try to look into this soon, but if you need this soon create a PR. It'll have a high probability of being pulled :smile: \n. Makes perfect sense. Looking forward to that PR.\n. This is fixed in v3.17.1\n. If i understand correctly you're trying to rename the public directory to public_html right?\nThe cleanest way of doing this is probably by making sure public_path() returns \"public_html\". You can learn how do that on this thread on the Laracasts forum\n. Please check the path to the root of your disk in config/filesystems.php. That should be a directory inside the directory returned by public_path. \n. what is the content of config/filesystems.php \nand does public_path return the right path when running unit tests?\n. Perfect! \ud83d\udc4f\n. Your changes are included in the newly tagged v3.17.1\n. Currently, image regeneration is only supported on local disks. I'll add a little note on that in the docs.\n. Currently the medialibrary only has support for laravel-glide v2.\nI'm currently working on the next major release of the medialib which will\nhave support for laravel-glide v3 / Glide v1\nETA: end of may.\nFreek Van der Herten\nSamberstraat 69 D\n2060 Antwerpen\nT:  +32 3 292 56 79\nM: +32 495 84 27 91\nhttps://spatie.be\nOn 4 April 2016 at 19:04, Marc notifications@github.com wrote:\n\nAbout your solution,\nGlideImage::create($image) is only available in Glide v3 (I am using v2\nat the moment)\nWhen I try to require the latest Glide v3, I get the following error:\nspatie/laravel-medialibrary 3.17.3 requires spatie/laravel-glide ^2.2.4 ->\nno matching package found.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/193#issuecomment-205422506\n. You should save your pin model before adding media to it.\n\nOn Tuesday, 5 April 2016, Deejavu notifications@github.com wrote:\n\nhello, im new in php and im trying to upload a file but im getting this\nerror\nSQLSTATE[23000]: Integrity constraint violation: 1048 Column 'model_id'\ncannot be null (SQL: insert intomedia(name,file_name,disk,collection_name,\nsize,custom_properties,manipulations,model_type,model_id,order_column,\nupdated_at,created_at) values (ssss, ssss.jpg, media, default, 81741, [],\n[], App\\Pin, , 1, 2016-04-05 02:28:57, 2016-04-05 02:28:57))\nmy post request looks like this\npublic function store(Request $request) {        $this->validate($request, [            'file' => 'required|mimes:jpg,jpeg,png,bmp,gif,svg,mp4,webm',        ]);        $file = $request->file('file');        $pin = new Pin;        $pin->title = $request->title;        $pin->description = $request->description;        $pin->user_id = $request->user()->id;        $pin->image = $file;        $pin->addMedia($file)            ->preservingOriginal()            ->toMediaLibrary();        $pin->save();        return redirect('pin/' . $pin->id)            ->with('notice', 'Successfully created new Pin');    }\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/195\n\n\nFreek Van der Herten\nhttps://spatie.be\n+32 495 84 27 91\n. Yeah, this cannot be solved in this package. The event will only be fire when deleting a model. When the query builder is used, no events will be fired.\n. Thank you for your contribution. \nWe are currently prepping v4 of this package for release. We were not planning to add any more features to v3. v4 has support for Glide v1 and uses PHP 7 features. \nCould you recreate this PR for v4 (branch v4)?\n. I think it'll be best to create a fresh PR.\n. Thanks!\n. I have reverted this PR because there were failing tests. I did keep the fixes you did on the naming of the exception / docblocks\n. The order_column handling is not that sophisticated :smile: When adding a new row, it will just get the highest order number + 1. \nSo the ordering of the items is correct, but be aware that there are gaps in the numbering.\n. When calling getMedia() the returned Media objects are sorted by the value in order_column.\n. imho it isn't really necessary. When using updateMedia the values of order_column will be recalculated.\nWhat problem are you facing?\n. All the media not present in the passed array that are in the specified collection name will indeed be deleted. \nIn hindsight, the method could have been named better (syncMedia or something better).. That is correct.. I fixed this is in the newly tagged version 3.17.4\n. \ud83d\udc4d\n. Nope, we don't use Lumen in our company. But we'd accept a PR that adds\nLumen compatibility.\nOn Thursday, 14 April 2016, Ajay Patel notifications@github.com wrote:\n\nIs there any plan for integrating this packages with lumen micro framework?\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/204\n\n\nFreek Van der Herten\nhttps://spatie.be\n+32 495 84 27 91\n. Fixed in v4.0.1 of this package.\n. Thank you for your contribution.\nThe namespace import for SelfHandling seems to missing.\n. Thanks!\n. Take a look at the current medialibrary:regenerate command. If you run that all the derived images will be regenerated. So you can run that after you've added a conversion.\nYou can let the command regenerate all media tied to a certain model class or for a specific media id.\n. Another approach is to manipulate your image (using laravel-glide) before adding it to the medialibrary. Would that work for your use case?\n. You can store media specific manipulations in the database. Could that be of use to you?\n. We could introduce a special conversionName like *. If that's used in a stored manipulation on a Media object we could use that for every conversion. \nThoughts?\n. Closing this for now.. Having a media deleted event is a good idea. But as it stands your code will only raise events when clearing a collection. Users will expect the event to fire any time a media object is deleted. I think the MediaObserver would be a better place to raise this event. In that way calling $media->delete() would also raise that event.\nName of the event could be MediaHasBeenDeleted if called after $media->delete() or  MediaWillBeDeleted if called before $media->delete(). \nThoughts?\n. Closing this one temporarly. Reopen if you have some time to work on the PR.\n. What could be done to make is happen is allow multiple manipulations be stored in the db for the same conversion.\nSomething like this:\n$media->manipulations = [\n    'thumb' => [\n           ['rect' => '220,220,89,40',],\n           [\n                'fit' => 'contain',\n                'w' => 520,\n                'h' => 260,\n           ]\n    ],\n];\nIt's a bit of work to integrate this in the medialib, but I'd accept a PR that adds this to the package in an non-breaking way.\nWhat you could do in the short term is using laravel-glide to manipulate your image before adding it to the medialibrary. You could storge the orginal in a collection orginals and your crops in a collection crops. It's a bit of a workaround, but it'll work.\n. There should be feature parity between v3 and v4.\nIf features get added to v3, I'd like a PR that adds them to v4 as well. \n. Closing this for now. Like mentioned before, I'd accept a PR that adds this to the package.\n. I don't think there is a big rewrite necessary, but the change isn't light as well. I'll work on it when I have some time on my hands.\n. Does your Reference model implement the HasMedia-interface?\n. You're right, this isn't 100% correct. Is this causing you problems?\n. I will improve this in a next major version of the package.\n. To get a media object by it's id, just use the model.\nSpatie\\MediaLibrary\\Media::find($id);\n. That realpath call is indeed problematic when symlinking dirs.\nYou can solve this by pointing the disk where the media is on to the real directory and use a custom url generator to generate urls. In my projects I use this one:\n```\nnamespace App\\Services;\nuse Spatie\\MediaLibrary\\UrlGenerator\\LocalUrlGenerator;\nclass MediaLibraryUrlGenerator extends LocalUrlGenerator\n{\n    /\n     * Get the url for the profile of a media item.\n     \n     * @throws \\Spatie\\MediaLibrary\\Exceptions\\UrlCouldNotBeDetermined\n     /\n    public function getUrl() :  string\n    {\n        return '/media/'.$this->getPathRelativeToRoot();\n    }\n}\n```\nBut I'm thinking we could also ditch the call to realpath. If you can confirm it works and if all the tests on travis return green I'd accept a PR that removes that call.\n. Updating the file isn't possible out of the package. You'll have to get your old file and re-add it.\n. You can use your own media model to add any function you like to Media-objects.\n. You can solve this in multiple ways.\nIf you want a syntax like use $media->setAsMainImage() you can add a function to your custom media model that marks that media object as the default (you can use custom properties for marking). The function should also unmark all Media object that have a relation to the same model.\nTo retrieve the default object you could use the getFirstMedia function. It accepts a filter as the second parameter:\nphp\n $yourModel->getFirstMedia('your-collection-name', ['default' => 'yes']);\nOn your model class you could introduce a function named getDefaultImage\n``` php\n// in a model class\npublic function getDefaultImage()\n{\n   return $this->getFirstMedia('your-collection-name', ['default' => 'yes']);\n}\npublic function getOtherImages()\n{\n   return $this->getMedia('your-collection-name', ['default' => 'no']);\n}\n``\n. Thanks for reporting this. To me this doesn't seem a big problem. It's also a bit unsafe to remove the directory after the conversion, as queued conversions may also be busy using the folder.\n. Ah sorry, I didn't read your original issue correctly. Your issue is with subfolders within temp not with temp itself. I'll take a look at the deletion of the subfolders, they should be cleaned up.\n. I can't seem to replicate this issue. Deleting the temp directory removes the all files including the directory itself.\n. I'll reopen this issue. I'm not able to recreate the issue myself. I'd greatly appreciate if anyone post some code / any info on how to reliably replicate this issue.. Kinda curious when the tests in that file fail on your machine. On my local machine and [on Travis](https://travis-ci.org/spatie/laravel-medialibrary/jobs/196008416) the tests regarding S3 are just running fine.. This problem should be solved inv5. Reopen if the problem still persists in that version.. ThereorderMediadoes not exists. But there is anupdateMediafunction that does some reordering.\n. Currently not. #211 will add this to the package.\n. Please check if$reportcontains an Eloquent model\n. Strange, is thetmfilefunction correctly on your server? http://php.net/manual/en/function.tmpfile.php\n. I'm guessing it had something to do with your specific setup and/or Windows. I cannot replicate this issue.\n. Currently there is no option to keep the source image format. By default it'll convert images tojpgandfm` can be used to convert all images of that profile to a specific format.\nI'll add an option to keep to original format in the future. If you need this quick, I'd accept a PR.\n. I'll try to make some time for this soon. If you need it quick, create a PR and be sure to add some tests.\n. I see that @marsd committed some code to his own repo. There currently is no PR.\n. Cool, thanks!\n. The PR has been merged. Changes are present in v4.2\n. @AlexVanderbist is investigating this.. In our primary use case for this package (displaying images and their conversion on a webpage) it does make sense to convert every image to a jpg by default.\nHowever I get that there is a need to keep the original format. \n@AlexVanderbist please add that keepOriginalImageFormat function.. Can you add tests to this PR to make sure that these changes do work? Make sure that you verify if url generation is ok for profiles with 'fm' => 'src'.\n. When uploading multiple files with the same name in the request, do not use addMediaFromRequest\nGet the files of the request and add them manually.\nTry this:\nphp\nforeach($request->file('images') as $image) {\n   $report->addMedia($image)->toCollection('medical-reports');\n}\nReopen if you are still having problems.\n. Could not reproduce this. Please reopen if the problem still persists.. Thinking the same as @canvural: please check that /home/vagrant/Code/llaravel5/storage/medialibrary/temp/ exists and that your php process is allowed to write there.\n. The current test seem to be working fine on my machine / travis. Are they giving an error at your end?\n. I solved this by refreshing the model in the tests.\n. Thanks!\n. Are you using queues to generate the conversions? If so are the queues running?\nAre the conversions creating if you remove your custom path generator class?\n. Please check the permissions on the directory where you are creating these files. PHP should be allow to create directories/files there.\n. The tests seem to fail. Can you take a look and fix them?\n. Yup, test failures were caused by something else. Meanwhile I've fixed them.\nYour changes are present in v4.2.\nThanks again!\n. Please provide some info on what you'd expect the medialibrary to do. If possible add some code that you'd like to work and state why you need this.\n. I'd accept a PR that adds a addMediaFromBase64 to the package. You can some cues from the addMediaFromUrl method. Please make sure you include a test \ud83d\ude04 \n. I'll close this for now. Reopen if somebody would like to work on a PR for this.\n. Yup, functionality was added to v5.2. Take a look at the docs on storing media specific manipulations.\n. You can use usingFileName to set the filename to anything you want:\nphp\n$yourModel\n   ->addMedia($pathToFile)\n   ->usingFileName($normalizedFileName)\n   ->toMediaLibrary();\n. Thanks for the kind words on the package. \nI don't know the exact setting by heart, but I'm pretty sure that in S3 you can specify somewhere (via a policy  I believe) that all uploaded files should be public.\n. Thanks for giving the right answer @joaosalless \n. A medialibrary:clean command has been added in version 4.5.0. Thanks again @nicolasbeauvais \n. Thank you very much for this! Excellent job.\n. You could use the relation. Here's how that would look like.\nphp\n$post->media->filter(function(Media $media) {\n    return in_array($media->collection_name, ['images', 'videos']);\n});\n. Hi,\nthanks for bringing this to my attention.\nI'll clean up the UrlGenerators and PathGenerators in the next major version of the package. Though the code around them is indeed a bit messy, it seems to work for most people.\n. I'm planning on writing a tutorial on how to use the medialibrary on my blog https://murze.be soon.\n. Thanks!\n. Thanks!\n. Hi, this PR seems great. Thanks for take the time to put this together.\nThe only thing I don't like it that continue 2; statement. Could you rewrite this so using continue isn't needed. It may be better to use a couple of functions and an early return. \n. After thinking this a bit through I'd rather have this functionality as a separate command called medialibrary:clean. Running that will delete any files that do not have conversions defined. In addition it would also delete files of which the Media model has been deleted. \nAn handy option would be --dry-run which would just report which files would be deleted if the command is run without that option.\nThe benefit of a having a separate command is that the medialibrary can be cleaned without regenerating every file. The cleaning proces will be a lot faster and code probably a lot cleaner.\nCould you modify the code of this PR? If you have any thoughts or comments on this approach, I'd be glad to hear them.\n. Looking very good. I'll fix some nitpicks of mine later today and tag a new release.\nThank you again!\n. A new version 4.5.0 containing the changes by this PR has been tagged.\nFor future PR's: I generally prefer using filter and each on a collection over a foreach loop with a nested if statement.\n. Agreed! Thanks!\n. This looks like a great PR, thank you!\nI've added some notes in the code. Could you address them?\n. \ud83d\udc4d \n. Changes have tagged as 4.4.0\n. Discussion continues in #259 \n. Thanks for your contribution, but I'm not going to merge this.\nIn general a switch is certainly a good option to structure this kind of code. But in this situation I prefer if's and early returns. \n. There's no real right on wrong here. To my eyes early returns just \"feels\" lighter.  Imo a switch is slightly more error prone, you could forget that \"break\" keyword. \nIt just comes down to programmer preference I think.\n. Hi, \nThank you for the work you've put into this.\nI'm probably not going to merge this in. I don't feel that this functionality is needed for most users of this package.\nDerived images should always exists. If not, because a new conversion is defined on a model later on, users can use the medialibrary:regenerate command. Currently @nicolasbeauvais is working on a medialibrary:clean command that will remove any files that were produced for a conversion that has been removed (#254). \nSo I think users have enough options to keep their medialibrary healthy.\n. You're of course free to fork the package to mold it to your needs.\nI've made some changes in the master branch so that the regenerate command won't fail if there are any missing files. I'll tag these changes soon.\n. For the projects I've used the package on the package is fully responsible for the directories and files it is managing. There are no external processes / users messing with the files. \nIf you are not in that situation you certainly fork this package to customize it to fit your needs.\n. I don't agree with your assertion that open source is about helping everybody out. \nWhenever my colleagues or myself encounter a problem in one of our projects we take the time to create a package. The primary reason for doing so is so we can reuse the code ourselves. For everything we put out we write tests, follow semver, write docs and follow most best practices. Those packages show of our expertise to external parties so there's certainly a commercial aspect to it as well.\nLike I've stated multiple times in the past the popularity of our packages is not our main concern. Others are free to use our solutions and we're grateful for all the feedback we're getting. If you take a look at the PR's submitted to our organisation you'll see that we generally are very willing to accept PRs.\nThink about this: if we accept your PR we are responsible for maintaining your code forever. We rather would maintain things we need ourselves than things we don't need. Simple things we don't really need ourselves generally will get merged, but big complex pieces of code (like the one in this PR) would just take too much time to maintain.\nYou are entirely free to fork our package (hurray open-source \ud83d\ude04) and build a solution for your needs on top of our package in which we already invested countless hours. You're getting al of our current work for free! You only need to add your custom bits. If you don't want to do this, you're of course free to look for another solution or to built something from scratch yourself.\nIf you want us to work on your specific use case and your specific code, we're available for hire.\n. The functionality just isn't needed for us and most users of this package.\n\"Some of these fail creating files for who-knows-why, yet the DB is still updated.\" --> I'd look more into this and try to assert the media is ok when creating it.\nLike stated before I think you're better off forking this package and adjusting it to your needs. Problem solved for you? No?\nIf more people report the same issue, I'll reconsider this decision.\n. Thanks for investigating this @nicolasbeauvais \nFixed (with the proposed workaround) in version 4.4.1.\n. Hi, you don't need to create a separate table for storing the relations between products and images. This is done by the package in the media table.\nYou'll find good examples on how to associate and retrieve media in the docs.\n. Mmm, strange, are you by any chance using a custom property called manipulations?\n. Thanks\n. The package can handle any type of file. So you should be able to add doc-files to the medialibrary.\n. You can use your own model and specify a connection on that model (look for \"database connection\" on that page).\n. If you define a conversion on a model and add a file you should be generate a derived file and retrieve a path to the generated file. \nI'm planning on writing an extensive blogpost that introduces the package. Might be a while until it gets published. \n. Take a look at \"Using a custom directory structure\" in the docs. \nOnly do this if you have a good reason to do so. The default directory structure should work ok for most projects.\n. The getPath function of your own PathGenerator should determine the type of the media and return in which directory the medialibrary should store that file.\nIs this the info you're looking for?\n. Composer has an --ignore-platform-reqs option to skip those requirements.\nhttps://getcomposer.org/doc/03-cli.md\n. It seems that we use that class to determine the mime type of a file. Most hosts do provide that extension, so I'm probably not going to remove / replace that.\nYou're free to fork this package to add your own mimetype detection. (or you could move to hosting that does provide that extension).\n. There's actually an undocumented method that can update media. \n. I'll make that function a first class citizen one day and document it properly. \ud83d\ude04 \n. There currently isn't. You could set the property to null.\nI'd accept a PR that adds a removeCustomProperty method to the Media class.\n. Added removeCustomProperty in version 4.6.0\nYou can update a custom property by just setting it again.\n. Hi, thanks for contributing.\nCould you also add a test to make sure your change works?\n. Yup, thanks. For future reference you can push extra commits to a PR so you don't have to create a second PR.\n. After reviewing the PR in more detail it turned out that it did not work. $name was passed in, but $key was used in the function. Also $this->custom_properties cannot be modified directly.\nWhen you're submitting a PR it always good to test the changes yourself, either by using it manually in a project or an automatic test.\nBecause it might come across as if I'm mad at you, please rest assured that I am not. We're all learning. I just want to give you some friendly advice for a future PR you're making either at this repo or some else's.\n. I haven't worked with webp myself and there was nobody asking to support it, that's why it's currently not in the package. \nI'd accept a PR that adds webp compatibilty to the package (if it's not too complex). Of course everything should keep working the way it is if the webp extension is not present on the system. \n. Closing this for now, reopen if you want to work on the PR and want to discuss it further.\n. I cannot reproduce this. Could you try using the latest version of the package in a fresh copy of Laravel?\n. Hi, \nthanks for spending some time on this.\nI do like the proposed functionality and the way you want to implement it.  The only thing that I want to do in another way is the generation of the thumbnails. In my mind this should be done in another package, much like how the thumb generation of pdf's and images is delegated to other packages. In this way the medialibrary just manages the file and isn't responsible for creating the manipulations.\nHowever, the package mentioned by LN isn't really good enough imho. I'd like such a package to have a fluent interface to work with, be framework agnostic, a license file, more tests etc, ... I'm thinking of just creating that package myself. Like you said, there isn't too much code involved, so it isn't a lot of work. I'll try to make some time in the coming weeks for this. I've already created a repo.\nI'll let you know as soon as I am done with that package. So you can continue with this PR.\n. Seems like a good package. But what I don't like is that it pulls in some other dependencies for things we don't need. \nAfter giving it some thought, I'm ok with using it if we use it as an optional dependancy.  If it is installed, the medialibrary should create thumbnails for video's. If not, things should continue to work as they do now.\n. I'm back at the point were I think that I'll just whip up my own small package. \ud83d\ude04 \n. Ok, here's the final decision, use php-ffmpeg to convert the video's. It should be a optional installed. If it is present, generate thumbs for video's, if not, don't try to convert video's. Go go go \ud83d\ude04 \n. Awesome! I'm enjoying a little holiday atm. Will review as soon as I get\nback.\nOn Saturday, 30 July 2016, Nicolas Beauvais notifications@github.com\nwrote:\n\nDone \ud83d\ude03\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/pull/276#issuecomment-236331788,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAdiDewurAsa0JIJerdHvgsIsCc3ufpbks5qaqwRgaJpZM4JN4-_\n.\n\n\nFreek Van der Herten\nhttps://spatie.be\n+32 495 84 27 91\n. Looks pretty good, just a few simple remarks added in the code.\n. Waiting on Travis...\n. Thanks!!\n. Changes have been tagged: 4.8.0\n. Thanks!\n. see #279 \n. Not sure if putStream is available on all drivers. I'll check when I have a bit of time on my hands.\n. Turns out that putStream isn't available for all drivers.\n. This package will read out exif data. Probably your PHP installation doesn't have the right extension installed. \n. You need the exit extension: http://php.net/manual/en/exif.installation.php. Added a note to the docs.. Option 1: modifying the db at this point. So I'd rather not do that now.\nOption 2: I don't want to maintain such a table of correspondence.\nMaybe we should leave things as they are for now. I'll address this is the next major version of the package. \nIf you want to store mime types, you can use custom properties for that in your own project.\n. Hi,\nthanks for contribution again to the medialibrary \ud83d\udc4d\nmost importantly: yes, you are required to send a postcard \ud83d\udcee  \nI like the addition of the --force flag, but I see a few issues.\n- the tests are failing due to the fact that dry-run is removed. Is this an error on your part or do you have a specific reason?\n- the regenerate does not use the confirmableTrait yet. Could you add that?\n. Added a little comment in the code. Will pull after that's fixed.\n. Thank you very much for this!\n. Changes have been tagged: 4.8.0\n. Haha, epic comment! \ud83d\ude02 \n. We will must certainly add L5.3 compatibility. I'll do it right after L5.3 is publicly released.\n. Hi, \nthank you. Will pull right after L5.3 becomes available.\n. Yup, I have created a branch at the repo where I will make the package\ncompatible. I will be quite busy the coming days, but I'll try to get this\ndone asap. If you need this real quick, I'd accept a PR at that branch that\nmakes all the tests pass in a non breaking and L5.1 to .3 compatible way.\nOn Tuesday, 23 August 2016, Peter Frank Johnson notifications@github.com\nwrote:\n\nLaravel 5.3 is now officially available. https://laravel-news.com/2016/\n08/laravel-5-3-is-now-released/\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/pull/291#issuecomment-241740084,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAdiDRUhRH-qvVL4OV8xOn9iBBhE0-lBks5qivzOgaJpZM4Jf-Ug\n.\n\n\nFreek Van der Herten\nhttps://spatie.be\n+32 495 84 27 91\n. There were some more changes needed then the ones included in this PR. I've cooked up my own PR to add compatibility with L5.3\nAlthough it won't get pulled, I appreciate your work on this PR.\n. You can use manipulations to add some media specific conversions. More info:  https://docs.spatie.be/laravel-medialibrary/v4/advanced-usage/storing-media-specific-manipulations\nFor you second question I assume that you want to perform some media manipulations without them being stored in the media library. Take a look at the underlying Glide package for that.\n. Which version of the medialibrary / PHP are you using?\nWhat does $request->file('image') contain?\n. I'm assuming that your upload form hasn't got the right field (like @DotFreelance said).\nReopen this issue if you're still having troubles.\n. v5 of the medialibrary has a new method createAllFromRequest(). Docs: https://docs.spatie.be/laravel-medialibrary/v5/api/adding-files#addallmediafromrequest\nReopen this issue if that method doesn't work for you.\n. We'll update the package when L5.3 is available officially.\nAlso see #291 \n. Perhaps a PathGenerator can help you here.\n. Hi,\nwe probably won't have time to investigate how to do this properly before the release next week at Laracon. Rest assured that this package will be one of the first that we will make L5.3 compatible as soon as L5.3 gets released officially.\n. Thanks @nicolasbeauvais for providing a PR. It has been merged. You can now just upgrade to 4.8.3 to fix the error.\n. I think so, via Glide\nYou should be able to use mark, markh, markw and markfit in a conversion.\n. Thanks for providing an example @timgavin \n@threeel Reopen this issue if you can't get it to work.\n. \u2764\ufe0f \n. Thank you very much for having taken care of this.\nI should probably add some tests for this in the future to make sure I doesn't break again.\n. On first though, I wouldn't mind making that convertPdfToImage and other functions public so that they are easily testable.\n. Thank you for this, I'll probably pull your PR if you provide some tests to make sure it works.\n. Closing this for now. Reopen when you're adding some tests.\n. Perfect, thanks yet again for making medialibrary better.\n. I think you should do this in your own application.\nBefore adding a file, just retrieve all the current associated media and verify if any of their hashes don't not match the hash of the file you're trying to add.\n. Np, thanks for taking the time to post your solution! This will be helpfull\nto others.\nOn Friday, 26 August 2016, Laurent Goussard notifications@github.com\nwrote:\n\nOk, I found\n$newsItem = News::find(1);$collections = $newsItem->media->pluck('collection_name')->unique();\nSorry for the noise\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/312#issuecomment-242761936,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAdiDW0OCVIP9M79juGkazlGoh6fhjr4ks5qjwFNgaJpZM4JuKFy\n.\n\n\nFreek Van der Herten\nhttps://spatie.be\n+32 495 84 27 91\n. What's your use case for this change?\n. Imo a Media object should always have a valid file.\nTo avoid the usage Finfo in your project you could use a custom Media model overriding any function that are causing your troubles.\n. Under normal circumstances you shouldn't care about the id of a  Media item. If you want to replace an item and insert a new in it's place you can do this:\n1. Before deleting it keep the order_column value in a variable.\n2. Delete the item\n3. Upload a new item\n4. Set the order_column of the new Media object to the one from step 1.\n. Could you add a failing test to prove that this does not work properly?\n. Thank you for all your hard work on this. I'll review this in detail soon.\n. A little heads up, I'm working on v4 of laravel-backup for the coming weeks. I'll turn my attention back to medialibrary once that's done.\n. Yup, that's a good idea. Move spatie/pdf-to-image to the suggestions \ud83d\udc4d \n. Merged this to the new v5 branch. I'll review it soon.\n. Hi Nicolas,\nI've looked at the driver system. Though the core functionality was pretty good, I felt that the naming of the classes could be improved. I started refactoring some of your code so that it is easier to understand what is going on.\nIt's not ready for prime time yet (still have to fix some tests), but if you got the time, you can already take a look in which direction it's going.\nLet me know what you think of these changes.\n. I'm thinking that the code changes are non-breaking, so maybe I could just tag a feature version here. \nThe only thing that needs to change is that spatie/pdf-to-image should be a required again.\nWhat do you think?\nIf you want to contribute again to medialib I'd appreciate some documentation on the new ImageGenerators in the documentation (with the general concept explained and an example how to add your own generator)\n. I'll made the change, spatie/pdf-to-image is required again.\nExcellent suggestion on using the new project feature. Done!\n. fyi renamed the v5 branch to feature-image-generators\n@sebastiandedeyne will do a review next week before I'll merge this in.\n. The changes have been merged into master and tagged as 4.9.0. Thank you again for your work on this.\nIf you feel up to it, explaining this feature in docs would make for a nice PR \ud83d\ude04 \n. Have you increased the default values for upload_max_filesize and post_max_size in your php.ini?\n. Or use php --ini \ud83d\ude04 \n. The second option is slightly cleaner yes. I'd accept PRs on the docs that change this. \n(There's an edit button on every page of the docs to easily send in a PR)\n. Thanks @nicolasbeauvais \nFix is available in v4.9.3.\n. Thanks\n. Could you rebase this against the current master?\n. The current version is L5.3 compatible.\n. Indeed, you need PHP 7 to use this package.\n. https://murze.be/2016/01/why-we-are-requiring-php-7-for-our-new-packages/\n. Nope, we support only the latest major version\nOn Tuesday, 13 September 2016, SavKS notifications@github.com wrote:\n\nThe branch, v3 (3.*) is no longer supported?\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/331#issuecomment-246662177,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAdiDS_tsP0XgersiFZWDFjsWHYdbBHrks5qppNegaJpZM4J7klM\n.\n\n\nFreek Van der Herten\nhttps://spatie.be\n+32 495 84 27 91\n. I'll make this the default in the next major version of the package.\n. @nicolasbeauvais the video test seems to fail: https://travis-ci.org/spatie/laravel-medialibrary/jobs/161723143 \nDo you know a good solution to make this pass?\n. You should manually ignore the directory where the media is stored. I'll put a little note on this in the docs.\n. In normal circumstances you should have to manually create an instance of Media.\nYou must first instanciate and save a model of your own, eg BlogPost.\n``` php\n$blogPost = new Blogpost();\n$blogPost->save();\n// or you could have done BlogPost::create();\n$blogPost\n   ->addMedia($pathToFile) \n   ->toMediaLibrary();\n```\n. Hi, my apologies for this breaking change. We try to avoid this kind of trouble.\nI'll try to look at this very soon.\npinging @nicolasbeauvais for any ideas how this might have been caused.\n. @marsd in the config file laravel-medialibrary.php what did you specify in the custom_url_generator_class key?\n. A fix has been made by @nicolasbeauvais in the master branch. Could you require dev-master of this package in your composer.json and let us know if your issue is resolved?\n. Fix has been tagged as v4.9.2.\nReopen this issue if you're still having problems after upgrading to that version.\n. @andaril take a look at this issue for a possible solution.\n. Closed the old PR, create a new PR to fix this\n. You could create your own UrlGenerator by extending the provided LocalUrlGenerator and overriding the getStoragePath function.\nDon't forget to specify your that custom UrlGenerator in the config.\nMore info: https://docs.spatie.be/laravel-medialibrary/v4/advanced-usage/generating-custom-urls#generating-custom-urls\n. Thank you! I'll review this soon!\n. I'm not a big fan of copying the file back over to the local filesystem. Image you're processing a 500 MB file, ... that'll be slowwwww. \nFor external filesystem we could just use the file_name (stored in the db) to determine the image generator. We could add a method shouldCheckMime on the BaseGenerator.\nIn FileManipulator we could check if we're working with a local filesystem. If we are, we pass false to shouldCheckMime\nThoughts?\n. Much better. But after seeing your solution (which would work) and giving it some thought I think we can even go for a more simpler solution.\nInstead of adding shouldCheckMime all over the place we could just replace this check:\nphp\n$this->shouldCheckMime && file_exists($media->getPath()\nby \nmethod_exists($media, 'getPath') && file_exists($media->getPath())\nIf I'm right the right condition won't be executed if the left one is false. \nCould you make these changes?\n. fyi: changing the type of what gets passed in canConvert is a breaking change. But I'll allow it this time, because probably not many users will have built a custom converter.\n. Hi,\nbecause I think the majority of users of this package (myself included) do not need this functionality, I'd probably not implement this functionality.  I don't want to add complexity to the package caused by less common use cases. I hope you understand this.\nIf you need this, fork the package and make your modifications there.\n. Thank you very much! \ud83d\udc4d \n. When looking at this piece of code it seems that an UrlGenerator should have a getPath method.\nThis is obviously something that is not coded well. I'll have to put in some thought on how to fix this well without breaking changes.\nThe quickest solution for your problem is to just add that getPath method yourself. It should return the full path to the file.\n. @timgavin corrected all the typos. I meant: \"The quickest solution for your problem is to just add that getPath method yourself. It should return the full path to the file.\"\n. Nice! Thank you! \nLooking forward to those docs.\n. Thank you again! \ud83d\udc4d \nBecause you're doing so much I've added your name in the credits section of the readme.\n. Good idea, but we'll indeed hold this off until the next major version.\n. I started work on v5, so breaking changes are allowed. I foresee no major new features, just a good clean up of the code and we'll drop support for anything lower than Laravel 5.4.\nIf you have any more suggestions for the package, let me know.. I'm not sure that I understand what you want to do. Could you post some code that you're using with some comments explaining your issue?\n. What do you mean with \"I need to push image to collection in HasMedia object\"? Can you post some code that you would expect to work?\n. I don't think there are a lot of users that need this. Holding off on this for now.\n. Merge conflicts with this PR, I'll make the necessary changes for the current version myself. You can expect a new version later today.. No problem @luceos, changes are now available in v7.4.0.. The users of this package and myself thank you for this PR. \ud83d\udc4d \nSadly, I haven't good a good way to automatically test S3 functionality. Most of the time I do it the same way as you did: just try it in a real project. I'll give this some thought. I'll let you know if I come up with a good idea\n. Putting AWS keys in Travis ci seems like a good solution. \ud83d\udc4d \nI'll take care of this is the coming days.\n. That certainly is ok! \ud83d\ude04 \n. We'll handle this further in #381 \n. I don't think a return value for deleteMedia is necessary. If it fails it'll throw an exception which is the right behaviour in my book. \nIn which other calls would you add a return value?\n. I've added S3_BUCKET_REGION with the right region value.\nYou may just remove scrutinizer/ocular. I believe it isn't needed anymore.\n. I've added you as a collaborator on this repo. I hope in this way your PRs will have access to the travis environment variables as well.\nBecause you're now a collaborator (you're the first one ever on any of our public repo's, congrats \ud83d\ude04 ) you can now approve PRs and tag releases as well. Unless it's a simple bugfix could you always consult me or @sebastiandedeyne  before merging changes or tagging releases?\n. I've pushed a fix for the S3 test. It's running now. Fingers crossed! \ud83d\ude2c \n. It seems to work \ud83c\udf89 \nBut maybe we should try to make the files uniquely named per run. Travis runs the testsuite multiple times at the same time (php 7.0, 71, ...). Right now I think we're getting lucky that those test are not performed at exactly the right time.\n. The functionality around  order_column should be indeed be documented. @nicolasbeauvais correctly described what it does. In short this allows you to get all media in the same order as it was added to the medialibrary. You can set a new order manually by using Media::setNewOrder or by manually setting the value of order_column.\n@nicolasbeauvais I'd certainly accept some documentation around this small feature.\n. I don't think generating separate values per model and collection are needed. Just using the maximum value or the order column + 1 seems fine to me. I don't mind gaps in the order column when retrieve media.\nCould you describe an specific use case where you think the values of the order column are causing problems?. Rest assured that I don't take any of what you're saying personally. Hearing a different viewpoint is always interesting. Even though I don't necessarily agree with everything,  I genuinely appreciate any feedback \ud83d\udc4d \nIn our projects we never present our users with the values inside order_column. We simply provide a draggable list where they can drag items in the right order. All the ids are passed to the server in the right order. We pass those id's to the updateMedia function. \nI agree with you on the fact that presenting the end user with the raw values inside order_column is confusing. But in my mind adding extra logic to make sure there are no gaps will make managing order_column in the package more complex. For example: when a media is deleted we would needs to recalculate all order_column values of the same collection. Right now this isn't necessary.\nWould you could do in your UI is not displaying the raw values or order_column but just add a little incremented value so you don't display any gaps.. @timgavin could you post the entire debug trace so we can see where the error is originating exactly?\n. The open policy has been set, all stored objects are now publicly accessible.\n. I'll try out the test by merging your PR!\n. Normally we don't offer support for an old major version. But as the code changes are easy I'm willing to make an exception.\nUnfortunately this PR breaks compatiblity with L5.1 and L5.2. Please make it so that the package can run in all versions from Laravel 5.1 up.\nI think the first collection call should be replaced by a regular loop. I'm a bit unsure what the effect of removing SelfHandling is in L5.1 and L5.2.\n. This package assumes that it has full control over the directory where all the media is residing.\nIf you're manually putting in the files then I suggest your use this method to preserve all the files. Of course you should write your own logic to only remove the files created by the medialibrary and leaving your manually added files untouched.\n. You're right that return false is not the correct type. However, the string return typehint will convert it to an empty string, so strictly speaking this isn't a bug.\nBut I understand this can lead to confusion, so I've tagged a new version 4.9.5 where an empty string is returned in the code.\n. It seems that this problem is caused by your specific setup.  I'm guessing it must have some to do with how the permissions on your system are set up.\nFeel free to submit a failing test if you feel the package is doing something wrong.\n. Thanks, if you pass along your e-mailadress I'll just mail you the credentials of the bucket so you can run the tests locally on your computer. Of course take care that you don't commit the values to the repo.\n. \ud83d\udc4d \n. There's a deleteMedia function.\nIn our projects we handle this case a bit differently. We get a response back with mediaIds that should be kept. We pass those ids to the updateMedia function.\n. @amosmos We use the updateMedia function. Our front end will send the media ids of all the media that should remain. The back end will delete all media items of model that are not being passed through.. > Do you have a delete button next to each image?\nYes\n\nAnd if so, clicking it doesn't make a request?\n\nNo, clicking it will just remove that media item for the hidden json field that holds the id's of all the media associated with the model we're displaying.\n. We have a drag and drop interface where users can drop their files.\nUploaded files get processed immediately.\nhttps://github.com/spatie/blender/blob/b24a995/app/Http/Controllers/Back/Api/MediaLibraryController.php#L17-L40\nWe do put a draft custom property on those media and remove that property\nwhen a user saves the entire form\nFreek Van der Herten\nSamberstraat 69 D\n2060 Antwerpen\nT:  +32 3 292 56 79\nM: +32 495 84 27 91\nhttps://spatie.be\nOn 5 February 2017 at 14:42, amosmos notifications@github.com wrote:\n\nThat's such a nice way to do it, saving a refresh every time and allowing\nthe user to change and save all data at once - but how do you handle adding\nimages in such way? Let me know whenever I'm asking too much :-)\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/393#issuecomment-277520570,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAdiDV9YRJ7TP-yU4hOxk05sCvtLyH6iks5rZdHPgaJpZM4Kh2JW\n.\n. I don't think we can speed that up much. In order to manipulate the image PHP needs to load it in it's entirety and perform the manipulations on that loaded image. 4400x4400 equals a shitload of pixels \ud83d\ude04 \n\nYou can speed this up by upgrading the cpu. If your front most request hangs because of the generation of the image you could push the generation to a queue.\n. @nicolasbeauvais \ud83d\ude4c \n. Read the documentation on Defining conversions. It mentions how you can perform the manipulation in a queued or non-queued manner.\n. Hi,\nthank you for this. I'm not going to merge this in as the detailed instructions on how to use the package are available on our documentation site.\n. @nicolasbeauvais good suggestions. Done!\n. The tests seem to prove that clearing a media collection does remove the files.\nSo I'm thinking your issue is caused by the permission on your machine or with your custom pathgenerator.\n. When I have a little time on my hands, I'll add a test for this case to our testsuite (and fix it if that proves that there is indeed a problem)\n. This is fixed in the newly tagged version 4.10.2. Thanks\n. Thanks! I'll make sure #464 will be addressed in v5.. That behaviour is not supported. We only use Glide to make use of the easy passing of modifications via an array. The whole \"on the fly\" part of Glide is not used.. Media items to have a getPath method.\nOn the fly conversion would take a lot of logic to implement and imho this doesn't fit into the general idea behind the medialibrary. If you need on the fly conversions, just use Glide instead of this package. It'll work fine.. I'd accept a PR to improves S3 performance. copyToMediaLibrary seems like a good spot indeed.. Hi, thanks for that PR. On first sight it looks good, I'll review it later this week.. Hi, thanks for your work on this.\nSeems ok, I'll probably pull this in when you add some tests.\nCould you rename the method to addCustomRemoteHeaders. That sound a bit friendlier. What do you think?. Thank you very much for your work on this.. @nicolasbeauvais Seems fine to me, is this ok for you too?. @nicolasbeauvais no worries, though I appreciate all your work on this package, you have zero obligations here whatsoever.\nIf I find a little bit of time, I'll test it too.. Thanks!. You could override getImageGenerators in your own Media model and put a check on the model id there.\nBut honestly, I'd keep all the generators the same for all media.. Going to leave this as it is for now.. Hi, \nquestions on how to leverage Redis to speed up your app are a bit out of scope for this issue tracker. \nA possible implementation is to use Redis to cache the an array representation of a media object.. Currently, there is no easier way to catch that specific exception. FileTooBig is probably an exception that warrants it's own type. Unfortunately changing the behaviour now is a breaking change.\nI'll keep this in my when creating a new major version of the package.. You'll be happy to know that in the as of yet unreleased version  v5 each function in FileCannotBeAdded was refactored to it's own exception.. No, for this to work you have to extend the model and specify the classname in the config file.. By default media conversions are queued. What queue driver are you using?\nIf you don't want a media conversion being queued set the driver to sync or use nonQueued() in your media conversion.. This question is a bit out of scope for this package. Personally I've not used those editors, but I'm pretty sure their docs will contain some info on how to integrate your app with the editor.. Are you sure you're running PHP 7 on the command line? Run php -v to make sure.\nIf you are in fact running PHP 7, try installing the package in a fresh copy of Laravel. Maybe there's some other dependency in your project that gets in the way of medialibrary being installed.. Good catch, could you also update the tests?. GetMediaTest and HasMediaTest are still failing.. I've decided to hold this one off for now, as it will break existing installations. I'll revisit this when creating a new major version.. Thanks, I will take care of the tests.. This is how you get all media for a model: \nphp\n$media = News->find($news->id)->getMedia('images');\n$media is a Collection with Media models. Those are plain Eloquent models. You can just update them like you're used to\nphp\n$media->first()->$propertyName = $newValue;\n$media->first()->save();. You shouldn't manually create Media models. The package will do this under the hood. Media should always be associated with another model.\nHere's an example: \nphp\n(BlogPost::first)->addMedia($pathToFile)->toMediaLibrary();. It' just a path to a file. eg /home/forge/my-site.com/images/my-image.jpg.. When using your own directory structure you should take care that every media should have it's own unique directory.\nThis is mentioned in the docs:\n\nThere aren't any restrictions on how the directories can be named. When a Media-object gets deleted the package will delete its entire associated directory. So make sure that every media gets its own unique directory.. Thanks!. Does this fix your problem?\n\nphp\nreturn $news->getMedia('images');. Have you added media to the images collection for that $news?\nDoes your Media table contain any rows?. Try this.\n```php\n$news->addMedia($photo)\n  ->usingFileName(time(). $photo->getClientOriginalName())\n  ->toCollection('images');\n$news = $news->fresh():\n$media = $news->getMedia('images');\n``. Is the$newsbeing passed through a validNews` object?. Ok, I think the problems you are reporting are not caused by this package, but simply by how you've built up your controller.\nTo validate that the package is working correctly do this:\nphp\n$news = App\\Models\\Owna\\News::first();\n$media = $news->getMedia('images');\n$media should now hold the images of the first news item.. News::all() returns a Collection. getMedia only exists on models that use the HasMedia trait.\nIf you want to get all images for all newsItems I suggest this solution:\nphp\nNews::all()->map(function($news) {\n   return $news->getMedia('images');\n})->flatten();\nIf you want to know more about Eloquent I highly suggest your read through the entire docs on the subject: https://laravel.com/docs/5.3/eloquent\nIf you want to know more about Collections read through those docs as well: https://laravel.com/docs/5.3/eloquent-collections#available-methods . \ud83c\udf39 . Could you provide a snippet of code that is not working for you.\nWhen using the default collection you need to pass default as a parameter\nphp\n->clearMediaCollection('default');. Currently there is no way to rename the filenames of the converted images themselves.  You can however change the name of the directories they are stored in.\nWhen working on a next major version, I'll revisit this issue to see if we can support custom names for converted images.. src is not a valid image format. Try specifying jpg or png.. Ah sorry, totally forgot about the src option. I'll investigate your problem soon.. This test seems to prove that the adding a file from an upload does work. \nI toyed around with the test a bit. Calling getExtension() on $uploadedFile does output jpg.\nI'm guessing the problem isn't caused by the package but by how files are uploaded in your particular project or by some setting on your particular server. . This test seems to prove that the src value for the fm conversion is working correctly.\nAre you using the latest version of this package? Try to run the tests on your platform. Do they pass there?. 1. Clone the package somewhere on your server\n2. run composer install in that directory\n3. execute vendor/bin/phpunit to run the tests. Seems like the tests are running fine on your box. So still thinking that the problem must be caused specific to your project / server.. If you haven't specified an custom url generator in the config file, the package will try to find an url generator for the driver of the disk the media is stored upon. That happens here: https://github.com/spatie/laravel-medialibrary/blob/19b4d5c36b567926e14fdef591f8d7388933f035/src/UrlGenerator/UrlGeneratorFactory.php#L14\nWhich disk driver are you using? What the value of disk in the media table?. Nope, if you want that, you might take a look at this package which provides a many to many relation between models and media.\nhttps://github.com/plank/laravel-mediable. I don't understand why you want this change. Add a failing test to reproduce your bug.  . Hi,\nthis package does nothing regarding authorization. You should handle everything regarding authorization in your own app.. > when I use your package I could not decide what to do on image id since there are different conversions of the image. \nStill do not get what you're trying to do. Do you want to hide the image id? Do you want to show different conversions depending on a user is logged in or not?. Not sure what you mean or try to accomplish, but the package will can you use configured disk to store it's files. https://docs.spatie.be/laravel-medialibrary/v4/advanced-usage/working-with-multiple-filesystems. Thank you for kind works, I'm glad you like the package.\nCurrently using the cloud driver is not possible. But I'll make sure this'll work in the next major version of the package.. This has been added in the as of yet unreleased v5. In that version you can use toCollectionOnCloudDisk($collectionName)\nv5 will be released closely after L5.4 will be officialy available.. We'll discuss this further at #444 . Have you verified that this change does fix your problem?. Thanks. Thanks for bringing this to my attention.\nThis is fixed in 4.11.3. Does $mediaItem->getPath() generate a correct path?. Thank you!. Details like this matter. Thank you!. @canvural Great to have met you in person \ud83d\ude04 . Could you try setting this up in a vanilla Laravel app, so we're sure there's nothing specific to your project is failing?. New versions of v4 and v5 have been tagged containing a fix for this problem.. Thank you very much for this important bug fix.\nI've added your test to the test suite using Carbon::setTestNow() instead of sleep.. Thanks!. Lets go for\n\nStore the file mime type in the media table, either in a new column or in the custom_properties column as an optional feature.\n\nI'd accept a PR on the v5 branch. Creating a new column for this sounds fine to me.  Also make a note of this change in the CHANGELOG.md on that branch.. I'll take care of this myself.. Done!. Sounds good, what do you think about keeping only toMediaLibrary?. @vanbrabantf Fancy sending a PR for this on the v5 branch?. Done!. Thanks for your work on this.\nAlthough I wouldn't necessarily recommend to the users of the package to override the Filesystem methods, this seems like a good way to make the package more flexible for power users.\nThoughts @nicolasbeauvais ?. Awesome PR. Thanks again!. Thank @LKDevelopment \ud83d\udc4d . Thank you for this \ud83d\udc4d \nAnd automated rename isn't necessary, there will be lots of other breaking changes when going from v4 to v5.. Hi,\nthanks for the kind words!\nI accidentally broken the v4 docs earlier today. Meanwhile fixed my error, docs are back up.. Done!. The trait does nothing special regarding the naming of primary keys.  If it's not working, it has something to do with your specific model. Reopen if your further investigation leads to something our package is doing wrong.. In v4 of the package custom image generators were introduced. Is that what you are looking for?\nhttps://docs.spatie.be/laravel-medialibrary/v4/converting-other-file-types/creating-a-custom-image-generator. Thanks for that example, that made it more clear what you want to add.\nProbably I wouldn't accept a PR that adds this to the package. Reasons:\n- adding support for multiple kinds of conversions will undoubtedly add a good amount of complexity to the package\n- Generally speaking I only want to maintain code I use myself, unless the changes are very simple. I don't need support for custom conversions myself\n- Though I haven't performed a survey \ud83d\ude04 , I think most users of this package don't need this.\nYou could opt to perform the required conversions of your video before adding video files to the medialibrary. In that way you could just use the latest and greatest version of the package.\nIf that doesn't work for you, then you'll have to create and maintain your own fork.. Thanks for your suggestions!\n\nPossibility to use the same media multiple amounts of time but with only one upload/conversion.\n\nI think this should be handled in application logic. What we do in our project is to just use a presenter that tries to get avatar of a user. If the use has none an url to a generic image is returned. Imho there's no need to store a generic image for each user.\n\nNew \"URL\" media type\n\nI very much like this idea. Have you any thoughts on how to implement it best? If the implentation is simple, I'd like to add it.\n\nVuejs image loader\n\nYea, like you already mentioned, clearly something that should be handled outside of this package.. @sebastiandedeyne Although there is certainly value in having the functionality, we ourselves are probably not going to need it. I'll hold off on this for now because it'll add considerable complexity to the package and I'd like to keep things simple.\nMaybe the n:m functionality could live in it's own package.. @nicolasbeauvais for the url feature, I'm thinking this could be added in a non breaking way, so I'm not going to wait on it before releasing v5. I would most certainly accept a PR that adds that functionality in a simple way.. Boom, released! \ud83c\udf89  Thanks all for your valuable input. \nLooking forward on working on the improved codebase. Thanks!. Thanks, pulling this in, so I can fix the tests quickly myself.. Thank you very much!. We greatly improved how temporary files are handled in v5 of the package. Could you upgrade to that version?. Good catch!. You'll find a limited upgrade guide here: https://github.com/spatie/laravel-medialibrary/blob/master/UPGRADING.md\n. I don't use postgres, so I haven't needed or tried compatibility with postgres.\nI'm not 100 % sure if your changes will work. To get an indication wether the package works with jsonb fields, you could try running the testsuite on a postgres db. You can change the db configuration in TestCase.php and run the tests with vendor/bin/phpunit run.\nIf it all works for you, I'd accept a PR that adds a note in the readme.. Thank you for your work in making sure the package works on Sqlite and Postgresql. Great to hear the package works for both these db's.\nSee comment on the PR why I rejected that one.\n. Thank you for this, but I'm not going to pull it in.\nReasons:\n- I don't want commented code (not even in the tests)\n- all test should be able to run on Travis\n- I myself don't need Postgresql compatibility\nIf you do want to add tests for Postgresql, maybe put some dedictated tests in a seperate file. Make sure they can run on Travis (I don't know how to do this properly in conjunction with installing Mysql, so you'll have to research that on your own if you want this).. There's currently no version that supports Laravel 5.3 and PHP 5. \nThe easiest solution it to just upgrade your PHP installation. \nAlternatively you could fork this package and replace all usage of PHP 7 syntax to equivalent PHP 5 code.\n. I'd accept a fully test PR that adds support for this to the package.. createMultipleFromRequest and createAllFromRequest have been added on FileAdder by @AlexVanderbist in v5.5.0\nWe'll add those to the documentation soon.. Hi,\nI've made an alternative fix in dev-master. Could you let me know if the problem is fixed when you use dev-master?. Reopen if the problems persist in 5.1.0.. An alternative fix is present in 5.1.0. Let me know if your problem is solved by this.. Thank you for your PR.\nNo users have reported problems with the current implementation and it works pretty good for me as well.  As the current implementation is the most simple one, I'm going to leave it as it is for now.. Thanks! Could you add a test too?. Thanks, I'll polish it a bit myself. Released as 5.1.0. Out of the box this behaviour is not supported, but you could use a custom PathGenerator to modify the path names used by the package.. Yup, I just restarted the build and now it works fine.. Thank you very much for this PR.. Yea, the released on the v3 have much too open version requirements. Unfortunately there's no way to fix this properly outside of removing those releases (which is a nuclear option).\nI'll update the docs soon.. The fix by @AlexVanderbist is now tagged as 5.3.1. @sebastiandedeyne and I have discussed the problem. We think we have found a good solution for this. I'll code it up in the coming days and let you know when the fix is released.. This was added in v5.3.0: https://docs.spatie.be/laravel-medialibrary/v5/converting-images/defining-conversions#using-model-properties-in-a-conversion. The tests are failing for this PR.. This change has finally been made in the laravel-55 branch. \ud83c\udf89 \n. Thanks!. Try this:\nphp\nCustomer::with(['projects', 'projects.media'])->all();. Closing this for now. If there problem persist, please reopen and include some code or a file (or PR a failing test) that helps us to recreate the problem.. Cool thanks! Will pull and tag this as soon as Travis has finished.. I think the only change that needs to be done here is making the path of the temporary directory configurable.  You could then fill temp_file_path with an environment variable that's different for each box.\nThoughts?. What about suffixing the value of temp_file_path with the output of a call to microtime?. True, using microtime is a bit hacky/crappy \ud83d\ude04 \nIs there any other way that you can differentiate between different workings? Is there some other environment variable being set? Something like working_run_id ?. Ok, I'll pull in this PR and work a little on it myself. The newly tagged v5.4.0 should solve your problem.. Hi, \nthanks for your explaining your thoughts on this in detail.\nI'm going to leave the current folder naming (using the media id) as it currently is. I believe that most people have no problem with this. If you want to obfuscate the id, I think you should, like you mentioned, a custom path generator.  I don't think calls to md5 should pose a significant drop in performance.\nI'd take keep this package as simple as it can be, that's why I won't introduce and option that does this out of the box.\n@AlexVanderbist Could you take a look if the clean command correctly works when using a custom path generator?\n. This has been fixed in v5.3.3. Thanks!. The tests seem to be failing for this one. Can you fix them?\nCould you also add a test to make sure that the added functionality works?. You've started your PR from the wrong branch I think. The master branch is now at v5.. I already pulled the other PR, this one isn't needed anymore right?. Thank you for this, we'll add a test for this ourselves.. Thanks, will clean it up a little and release it. Could you also send a PR to the docs?. Great solution, thanks @AlexVanderbist . Thanks!. Thanks!. Thank you!. In the loop where you're importing all the media you could fake the current time. Carbon has a method for that.\nphp\nCarbon::setTestNow('2017', '1','1');\n. We'll add in this next couple of weeks to the underlying image package.\nSee https://github.com/spatie/image/issues/9. The underlying spatie/image package now has support for watermarks.\nhttps://docs.spatie.be/image/v1/image-manipulations/watermarks. Are you using MySQL 5.7? That requirement is mentioned in the docs\nI've not tested it but you could try to replace json by text in the migrations and see if that works.. I'm thinking there won't be any errors, but haven't tested it myself.. Thanks!. Like many functions that work on relations the effect of adding a media relation to a model is not immediately visible on the model on which it is performed.\nIf you get a fresh copy of the model you should see the changes.\n```php\n...\n$post = $post->fresh();\n$post->getMedia('upload')->count();\n```\nDoes this work for you?. Perfect!. \ud83d\udc4d . You're right, it's better if there is a DIRECTORY_SEPARATOR. I've made this change on dev-master. . Thanks! Tagged that revert commit\nWhat would be a good solution for #567 @AlexVanderbist ?. Image::FORMAT_PNG should be Spatie\\Image\\Manipulations::FORMAT_PNG. Please send a PR to the docs to correct this.. @fetzi cool. Also rename all usages of toMediaLibrary to toMediaLibraryCollection in the tests.\nAnd add one new simple test for toMediaLibrary.\nIf you want to continue being awesome, also send a PR to our docs.. Yup, I like toMediaCollection. I'll merge the changes from #577  and perform that rename myself.. It's already done and tagged \ud83d\ude04 . I'd go for a different method instead of tacking on extra arguments. clearMediaCollectionExcept sounds fine to me. \ud83d\udc4d . > Should the CollectionHasBeenCleared event still be fired if the collection was only partly cleared?\nIndeed no. Thank you very much!. Thanks!. I've you're using the latest version (which was tagged only minutes ago) there is a function called toMediaCollection that does what you need.. Thank you for your PR but not a fan of this. If you need this behaviour just create your own custom UrlGenerator.. Great work, thanks!. Well done, thank you!. I really like these kinds of PR's that dot the i's in the readme.\n\ud83d\udc4d \ud83d\udc4d \ud83d\udc4d \n. Thanks for letting us know your solution \ud83d\udc4d. The latest version of spatie/image uses copy and unlink instead of rename (thanks for the PR @spyrosk). That function is only present in the latest tagged version, not in 5.0.0.\n. I'd accept a PR that adds support for multiple media specific manipulationsSequences.\nFor the easy building of a manipulations array I'd accept PR on spatie/image that adds a static create method and an toArray method on Manipulations.\nSo when can do this:\n```php\n$resizedConversion = Manipulations::create()\n    ->width(123)\n    ->apply()\n    ->manualCrop(20, 20, 10, 10);\n$media->manipulations = [\n    'resized' => $resizedConversion->toArray()\n];\n``. Does this currently give an error?. Are you getting this error with the latest version of the package?. \ud83d\udc4d . Could you open up another PR that contains a failing test that demonstrates the bug?. This is fixed in the latest version of the package.. You can useusingFileName` to set a custom file name.\nphp\n$yourModel\n   ->addMediaFromBase64($base64Date)\n   ->usingFileName($yourFileName)\n   ->toMediaCollection();. Could you try setFileName? \nThere are many many differences between v5 and v3. If you encounter more problems please go through the docs on v3.\nhttps://docs.spatie.be/laravel-medialibrary/v3/. Great solution, thanks!. The package does not provide a vue.js integration, it's a bit out of scope for this package. . You may remove the Spatie\\Glide\\GlideServiceProvider. Go through all your defined conversions as well. Here are the docs on how you define conversions in v5: https://docs.spatie.be/laravel-medialibrary/v5/converting-images/defining-conversions. Cool, thanks for posting your solution. \nWouldn't it be much easier to do all the conversions first and only add the converted video to the medialibrary? Or is there a specific reason you want the original file to be in the medialibrary as well?.  If, in v5 of the package,  you do not provide a parameter to getMedia all media in the collection named default will be returned.. You can use collection names. What was changed in v5 that if you do not provide a collection name to the getMedia function only items from the collection named default will be returned. . You can get all media for a model by using the media property.\nphp\n$allMedia = $yourModel->media;\nIt'll return a Illuminate\\Support\\Collection which you can filter to your heart's content.. In an ideal world the medialibrary would fire off an event after all jobs that convert images for a model have been completed. Unfortunately it's not that easy to detect when all jobs have been completed.\nThere's a discussion going on at Laravel internals to make it easier to detect when certain jobs have been completed. It's a sort of promise.all for queued jobs. I'm hoping this feature will make it into Laravel 5.5. In that case the medialibrary will immediately implement a AllConversionHaveBeenCompleted-event.\nRight now the easiest way to index your model after conversion have been completed is to just dispatch a job that does the indexing with a delay of a couple of minutes. I know, it's a bit crappy, hopefully we can improve things in Laravel 5.5. Feel free to PR any events that you'd like added.\nIn our projects where we expect the result to be immediately there (such as avatars of users) we use nonQueued on the conversion. This will make sure the converted image is created is the request itself.. My train of thought was wrong. You're right, there's just nothing to clean. \ud83d\udc4d . Thank you very much for this! \ud83d\udc4d . Thank you for this code, but we're probably not going to add this feature to the package. If you want to replace a media item, just delete the old one and create a new one (with the newer files) and set its properties to the same values as the old media item.. This is covered in the docs: https://docs.spatie.be/laravel-medialibrary/v5/api/adding-files#addmultiplemediafromrequest. Great idea, I'd accept a PR that adds this to the package.. Closing this, we'll handle this further in the #612 . Thank you for this.\nCould you take care of the nitpicks I added and the remark of @Anahkiasen ?\nThen it'll be perfect.. Yeah, collecting them and displaying them at the end seems a good way to go about it.. Thank you very much!. Media by custom prop\ngetMedia returns a collection. You can perform any of the collection methods (such as filter)  in it.\nThe docs show how tho get a custom property: https://docs.spatie.be/laravel-medialibrary/v5/advanced-usage/adding-custom-properties\nYou can use that to filter the collection.\nBulk\nJust add your 10 images seperately to the medialibrary. Here are the docs on defining conversions. Watermarking is supported\nIf you change one of your conversion (eg changing the watermark file) you should regenerate the derived files. Here are the docs on that: https://docs.spatie.be/laravel-medialibrary/v5/converting-images/regenerating-images\nUpdates\nA media model is just an Eloquent model. You can use it to update any property you'd like. If you change the file name, the name of the file on disk will be changed as well. Replacing the files themselves isn't possible. Just delete the old media, add a new one, copy over properties manually.\n. getMedia only returns media in the collection named default.\nTo get media from the foo collection use $model->getMedia('foo');. It seems like you are using v4 in your project. The documentation you are linking to is on v5.\nHere are the docs on v4: https://docs.spatie.be/laravel-medialibrary/v4/introduction. Could you give an example in which $file would be a resource?. Closing due to inactivity.. It's breaking for people who have published their config file and upgrade their package. We'll fix this in the next major version.. This has been done in the laravel55 branch.. Are you sure touching a file without an extension on Windows fails? Seems odd that this isn't possible.\nIf it indeed fails, send a fully tested PR.. Our package already has test to make sure that this functionality works. \nI'm assuming your test doesn't work because behind the screens Storage::fake is a real disk and expect real files and UploadFile::fake() is not a real file.. Haven't worked with Storage::fake myself just yet, so can't advise you there.\nYou could take the same approach as we did in our package tests. Create a real disk and manually make asserts against the filesystem.. Hi,\nif you want to use another url generator you can create your own custom one and set that one as in the custom_url_generator_class key of the medialibrary.php config file.. In general is't best to safe a model before adding media to it. That being said we recently added some improvements for adding media to a model that hasn't been saved yet. Behind the scenes the media will be added behind the screens after the model get saved.\nExplicitly saving a media instance without a related model is asking for trouble, just don't do it \ud83d\ude04 \nIf without these pointers you can't fix your problem, could you please post some code for me to look at (or submit a failing test)?. Glad you could fixes the problem quick.\nThe error could indeed be a bit better. I'd accept a fully tested PR that improves this.. You got yourself a syntax error\nphp\nUser::->find(3)\nShould be \nphp\nUser::find(3)\nAre you sure you have a key called avatar in your request?. Did you put the HasMediaTrait on your model?. Can you add media to your model directly (without using request)?. Closing this because no activity on issue.. Thank you for this, but I'm not going to merge it.\nThe installation page clearly states that a media disk should be created when installing the package.\nhttps://docs.spatie.be/laravel-medialibrary/v5/installation-setup. Are you sure the request has the files you expect? Can you get the file(s) off the request manually? What code are you using to add the files?\nHere's the relevant documentation of the methods @canvural mentioned: https://docs.spatie.be/laravel-medialibrary/v5/api/adding-files#addmultiplemediafromrequest\nHere's a test where you can see those methods in action: https://github.com/spatie/laravel-medialibrary/blob/851441ffd1532083d8460b9446058dbee501853f/tests/FileAdder/IntegrationTest.php#L220\n. addMultipleMediaFromRequest expects an array of key names in the files part of your request like shown in the relevant test.\n. While checking the code I noticed that createMultipleFromRequest currently does not work with files that are uploaded as an array (when you form element uses brackets).\nI'd accept a PR that would add support for this.\nThe quick solution for you would be to manually loop through your upload files and add them to the medialibrary manually using addMedia and toMediaCollection.\n. Very nice, thank you!. Yea, I think that Ghostscript was available on Travis by default, but that they changes it. Need to research on how to re-enabled it.. Currently this package doesn't directly support soft deletes. If the code is simple and well tested I might accept a PR that adds support for them.. Currently these is no support for storing only the conversions. If you need this manually convert the image before adding it to the medialibrary.. All your problem regarding this problem would be solved if you use our image package\nhttps://docs.spatie.be/image/v1/introduction\nUnder the hood it uses Glide. We built an easy to use class on top of it.. There's nothing Laravel specific in the package. Just follow the examples mentioned in the docs. Thank you for this, could you add a test to make sure this change works properly?. Thanks, I'll fix this myself.. Mmm, after pulling this in and changin collapse to flatten the tests fail.\nReverting your change entirely makes all test pass (locally).\nCould you whip up a new PR?. I'm thinking you're looking for  FIT_CONTAIN.\nHere's an example image conversion definition:\nphp\npublic function registerMediaConversions()\n{\n   $this->addMediaConversion('yourMediaConversion')->fit();\n}\n. Thanks for bringing this to my attention.\nFixed it.. The current code seems ok to me.\nprocessMediaItem will not delete the file.. You're right. I've fixed this in the newly tagged version 5.11.1. Does your model implement HasMediaConversions and does it use HasMediaTrait?. It's true that IDE's won't be able to automatically give hints for the right type. But it's better than nothing. \nIf you really want type hinting for you specific model class you could add a phpdoc line inside your function\nphp\n/* @var $variableName TypeName */. Thanks for reporting this. The problem can by mitigated by adding a second parameter to addMediaFromUrl and addMediaFromBase64  to pass mimetypes.\nI'll take care of it soon, but if you have the time I'd accept a fully tested PR with no breaking changes.\n. Thanks for answering this one @bhulsman . Thank you very much!. Hi, thank you for this. Instead of rolling our own check, I'd prefer that Laravels own validation would be used.\nCould you rework this?. Thanks. It's a step in the right direction, but there's still room for some improvement (see code comment).. This looks much better. Thank you. I'll pull it in, take care of some minor nitpicks and tag a new version soon.. I think it 'd be overkill to add a dedicated method for this to the package. I think it's best to queue the clearing of a mediacollection in your application.. I'll pass this along to the nice folks at Algolia who provided this search for us.. This has been fixed.. \u2764\ufe0f\u2764\ufe0f\u2764\ufe0f. The default LocalUrlGenerator expects that you store media somewhere within the public path. If in your app media is handled differently you can write your own url generator.. Pretty sure this is not caused by upgrading the package but by the fact\nthat your model doesn't implement the HasMedia interface.\nAdd 'implements HasMedia' after your class declaration.\nOn Thu, 8 Jun 2017 at 18:45, Bruno Cavalcante Barbosa \nnotifications@github.com wrote:\n\nHi, i update to latest version of this package(5.12.0), but now, i can\u00b4t\nget/download uploaded files. The Upload part its ok, i can see the data in\ndatabase, its ok.\nBut if i try to download the files it gives this error:\nFatalThrowableError\nType error: Argument 1 passed to Spatie\\MediaLibrary\\MediaRepository::getCollection() must be an instance of Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia, instance of App\\Models\\Extras\\Curriculo given, called in /var/www/popmanager/backend/vendor/spatie/laravel-medialibrary/src/HasMedia/HasMediaTrait.php on line 201\nMy model:\n<?php\nnamespace App\\Models\\Extras;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia;\nclass Curriculo extends Model {\n    /\n     * The database table used by the model.\n     \n     * @var string\n     /\n    protected $table = 'curriculos';\nuse HasMediaTrait;\n\n}\nMy call:\npublic function getCurriculo($id) {\n    $curriculo = Curriculo::find($id);\n\n    $anexos = $curriculo->getMedia('curriculos');\n\n    $curriculo_url =  $anexos[0]->getPath();\n\n    return (new Response($curriculo_url, 200))->header('Content-Type', $anexos[0]->mime_type);\n}\n\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/654, or mute the\nthread\nhttps://github.com/notifications/unsubscribe-auth/AAdiDbDT4gJCJKy0yw_74975EFZjwqxVks5sCCUngaJpZM4N0Vbi\n.\n-- \nFreek Van der Herten https://spatie.be +32 495 84 27 91\n. > when I delete a media, model is empty\n\nI don't understand this part. Could you give a code example?. By default if you delete a model it's attached media will be deleted as well. And this should work even if you use a custom path generator. If you're still having troubles with this could you PR a failing test for me to fix?. Please PR a failing test. Closing this because the problem can't be reproduced.. Hi, \nthis whole package is been set up around a one to many relation between a model and media. If you need a many to many relation take a look at the laravel-mediable package.\n. Currently this is not possible. You could solve this by setting the right permission via a policy on S3 itself. If this can be solved in a simple non breaking way, I'd accept a fully tested PR that adds this to the package.. Thanks!. We don't support v4 anymore. Is it possible to upgrade your application so v5 can be used?.  > I thought the Spatie team was more responsible and dependable.\nWe've never made it a secret that we like developing with the latest versions of stuff and think that sticking to LTS releases is a very bad idea.\nIf you are disappointed in our decision to not support an older version of Laravel, please consider that we do most of this open source work in our spare time. It's kinda strange that you think we should work for free on stuff that we don't need ourselves anymore.\nWhen using open source always keep in mind that you should either know your requirements enough so you can fix bugs yourself or that it should be easy to switch to another package.\nFeel free to contribute a PR a fix to the old branch. If it's well tested, big change that I'll pull it in.\n. I don't really understand your question. \nMaybe this is what you need?\nhttps://docs.spatie.be/laravel-medialibrary/v5/converting-other-file-types/creating-a-custom-image-generator. You can just use the mime_type (or maybe just the extension of the original file) saved in a Media object to decide in your view which icon should be displayed.\nIf you need to generate something specific (eg a thumbnail of the contents). You can use the aforementioned custom image generator.. No problem, have fun using the package.. The Truth (aka the source code) says that toMediaCollectionis the right method name. Are you sure you're using v5?. You shouldn't pass collection names such as images, gallery to getFirstMediaUrl, but rather conversion names such as (in your case) thumb, small, medium and large.. Our tests (included in the package) indicate that this should be working as indented. \nTry installing the package in a vanilla Laravel app, define one conversion and try to get en url of that. If that works, try adding another conversion. . Currently cleaning orphaned files only works if you're not using custom paths. \nIf you need this to work for custom paths, I'd accept a fully tested, backwards compatible PR.. Conversation contiunes in #677 . It's medialibrary.php in the config folder. \nThe package can create the file for you. Take a look at the installation instructions in the docs: https://docs.spatie.be/laravel-medialibrary/v5/installation-setup. I'm not a Lumen user, so I'm probably not going to make any changes to support Lumen. It's best that you make the necessary changes in your own project. Writing your own service providers or manually write the missing functions would be a good solution. Our maybe you could just upgrade your project from Lumen to Laravel.. Does your model implement the HasMediaConversions trait mentioned in the docs?. Great that you're trying out medialibrary. I hope you like it.\nYou can access variables of a model from inside registerMediaConversion. The way you can achieve media specific conversions is by using the manipulations property on a Media model.\nMore info here: https://docs.spatie.be/laravel-medialibrary/v5/advanced-usage/storing-media-specific-manipulations\nDoes that answer your question?. Closing this. Conversion continues in #672 . Couldn't you introduce some caching layer in your app where you would only read an image once and cache it's dimension?\nAn alternative to adding your own caching storage, would be to use a media's custom properties to store the dimensions. More info on custom properties here: https://docs.spatie.be/laravel-medialibrary/v5/advanced-usage/adding-custom-properties. I'll revisit this issue when creating a new major release next year.. This has been added to our laravel55 branch.. Thanks for your suggestion, but I'm thinking that there's only a small minority of users that need this functionality. The ones who do can easily add this check in their own projects.. Could you PR a failing test that demonstrates the bug?. Testing is not that difficult. It's just basically writing some code that does the same as in a normal application.\nThis package includes this test that proves that the getMedia function is working properly when a collection name is passed through it: https://github.com/spatie/laravel-medialibrary/blob/master/tests/HasMediaTrait/GetMediaTest.php#L64-L71. > What exactly do you think we need to test?\nWe need an automated test that shows orphaned files are cleaned up correctly when using a custom path generator\n\nHow we can avoid the adding a method to an interface in this case?\n\nI think we shouldn't avoid it, it's a good solution. But breaking, .... Going to close this for now.. I believe you can achieve the watermarking by using custom image generators: https://docs.spatie.be/laravel-medialibrary/v5/converting-other-file-types/creating-a-custom-image-generator.\nFile systems per conversion are not supported. I'd accept a PR that adds that to the package if the code is not too complex, non-breaking and well tested.. This package cannot watermark a video, only images.\nIf you want to watermark a video you must do that yourself before adding the video to the medialibrary.. Your change causes the tests to fail. Could you take a look at that?. Closing due to inactivity. > The media conversions are not collection specific\nThey are collection specific. \n$this->addMediaConversion('large')`\n        ->width(1920)\n        ->height(1080)\n        ->performOnCollections('project-images-full-hd');\nThis conversion will only be performed on the project-images-full-hd collection. If want it on all collections, leave off ->performOnCollections('project-images-full-hd').\nYour second question regarding:\n$this->addMediaConversion('large')`\n        ->widthByPercentage(75)\n        ->heightByPercentage(75);\nThe underlying image package does not support percentages. You can make calculations of the desired with and height in your own project and then use media specific conversions: https://docs.spatie.be/laravel-medialibrary/v5/advanced-usage/storing-media-specific-manipulations \n. Ok, thanks for that extra explanation, I think we're on the same page now.\nWhat you could do to make your designers happy is to define your conversions like this:\nphp\n    $this->addMediaConversion('large-project-images-full-hd')\n        ->width(1920)\n        ->height(1080)\n        ->performOnCollections('project-images-full-hd');\nYou could use a custom Media model and start override methods such as getMediaUrl like this:\n(pseudo code, not tested)\nphp\n// in your custom media model that extends the media model shipped by this package\npublic function getUrl(string $conversionName = ''): string\n{\n   return parent::getUrl(\"{$conversionName}-{$this->collection_name}\");\n}\n. For unpacking a big image PHP just needs a lot of memory. There's no way around that. \nHere's a calculator that show how much memory you need: http://www.dotsamazing.com/en/labs/phpmemorylimit. Thank you for this. \nBecause I don't use them myself I don't want to maintain support for soft deletes. \nDo this in your own project.. > because you're not using it you won't accept it\nYeah, in general I only maintain what I use myself.\nMaybe I have been to harsh in my answer. If you PR some tests that makes sure this works, I might reconsider my opinion.. Please make sure that the clean command plays nice with SoftDeletes as well. Maybe add some tests there too.. I'll take care of this when I have some time.. Thank you very much for your work on this.. Could you PR a failing test for me to look at?. Modifying this behaviour now would be a breaking chance. I'll re-evaluate the use of realpath when creating a new major version of the package next year.\nIn the meantime you can create a custom url generator that works for you: https://docs.spatie.be/laravel-medialibrary/v5/advanced-usage/generating-custom-urls. The package is able to handle all kinds of files, including .doc and .docx files, out of the box.. That's not too good.\nCould you PR a failing test for me to work on?. The tests regarding custom paths are located here: https://github.com/spatie/laravel-medialibrary/blob/master/tests/PathGenerator.\nYou should add a test that mimics what you're doing in your real app.\nIf you don't have experience with testing, I'll do it whenever I have some time (might take a while though).\nYou can also already help by finding a fix in the code of the medialibrary that would solve your problem.\n. The deletion happens here: https://github.com/spatie/laravel-medialibrary/blob/master/src/Filesystem/DefaultFilesystem.php#L106. Yeah, this is a limitation of the package. It will always return the entire directory of a media item.The easiest solution would be to reorganise your media so a directory only contains the orginal and conversions of a unique media item.\n. \ud83d\udc4d . I'll create a L5.5 compatible version as soon as the L5.5 is publicly released. In the meantime, for the package and use your own copy.. If you dump your autoloader after you publish the migration the class_exists will return true and that line will prevent the migration from being published twice.. Do not try to delete media via that function that is not related to the model.\nYou could delete media directly instead\nphp\n$media->delete();. Got it, I'll take a look at this soon.. Great, thanks!. This is fixed in the latest version. Thanks!. What is a greedy download?. Here's an easy way to get the model where the media is attached to:\nphp\n$model = $media->model;. You can easily optimize any image you want by using the optimize method of our image package. More info here: https://docs.spatie.be/image/v1/image-manipulations/optimizing-images\n(Under the hood the same package is used by the medialibrary). I don't remember anymore why I removed getPath so I added it back now. Run composer update to pull that change in.. We don't support v4 anymore. Is it possible for you to upgrade to v6?. Use your own fork, v4 won't be maintained anymore so your fork will probably contain the latest version of v4 for a long time.. For us PHP 5 is dead for quite some time now and we are not going to invest anymore time in old releases.\nPlease fork the code and fix it there.. Thanks. Thanks!. Thanks for this, but I'll just remove the entire docblock. Function signature is clear enough.. I've done this myself in the new major version. Thanks though!. Could you send a PR?. Just set the root property of the disk to the path you want your files to be stored.. No, that medialibrary works best if you let it to take care of all the paths in the root directory of your app. If you do want to change the directory structure that medialibrary will use, take a look at this piece of documentation: https://docs.spatie.be/laravel-medialibrary/v6/advanced-usage/using-a-custom-directory-structure\n. This is not possible with the medialibrary.\nFrom the docs: \n\nWhen a Media-object gets deleted the package will delete its entire associated directory. To avoid tears or worse, make sure that every media gets stored its own unique directory.. That\u2019s an oversight. In the upgrade guide (in the repo) it\u2019s mentioned that that argument should be added.\n\nCould you send a PR to the docs that fixes this oversight?. That class check should prevent the migration from being published again (after you\u2019ve dumped the autoloader). Under the hood the medialibrary uses our image package. On it's turn it leverages gd and imagick. I believe they those libraries do support bmps.. You could opt to add [a custom property]\n(https://docs.spatie.be/laravel-medialibrary/v6/advanced-usage/adding-custom-properties) to your Media instance containing your specific seconds to take the tumbnail.\nIn the latest version of the medialibrary, an instance of Media is being passed to registerMediaConversions. You could read the custom property there to pass to the extractVideoFrameAtSecond function.. >  could you add the parameter to the package that support Laravel 5.4?\nNo, that would be a breaking change. You always have the option to fork the package and make the modification in your own copy.. see #737 . On all my projects I can use just the required mysql version, so I'm not going to invest any time in making the package compatible with things that don't support the json datatype.\nIf you need that, it's probably best to fork the package and make the necessary modifications in your own fork.. You should have opened this issue at the laravel-activitylog repo.\nv2 of activitylog is only installable in Laravel 5.5.\nTry installing v1 of the package.. Nope, that's not possible right now. I tried to make the medialibrary as easy as possible and that's why I opted for a 1-to-n relation between media and model. If you need n-to-n you could opt to use laravel-mediable.. The tests seem to prove that deleting a media object will deleted the folder and files\nhttps://github.com/spatie/laravel-medialibrary/blob/0491a18d95be3b8ef3e2e351cd14720d7484070a/tests/Media/DeleteTest.php#L13-L22\nCould you PR a failing test?. Closing to due to inactivity of OP.. Because when using a custom path using a PathGenerator FilesystemAdapter::getUrl() will produce wrong results.. It happens synchornously.. A query scope seems a nice way to go about this.. You can get the extension of any file with pathinfo($path, PATHINFO_EXTENSION). Does your MovieList model implement the interface and trait provided by this package?. Does $movies->first() return an instance of the model you're expecting?. You can clearly see here that if you apply the trait mentioned in the docs, your model should have a getMedia method.\nhttps://github.com/spatie/laravel-medialibrary/blob/0491a18d95be3b8ef3e2e351cd14720d7484070a/src/HasMedia/HasMediaTrait.php#L206. What does MovieList::first()->getMedia() return?\nOn Sat, 16 Sep 2017 at 17:15, Jeremy Aufderheide notifications@github.com\nwrote:\n\nThis is the top of my model.\nuse Spatie\\MediaLibrary\\Media;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nclass MovieList extends Model implements HasMediaConversions\n{\n    use HasMediaTrait;\nSo, it's got everything that the docs outline.\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/755#issuecomment-329974533,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAdiDUdTX2jcKoWbxr-DwhtcieeWBnRKks5si-YngaJpZM4PY3Wn\n.\n-- \nFreek Van der Herten https://spatie.be +32 495 84 27 91\n. Seems like it is working then no?\n\n$movies is a collection of Media objects. . What's the output of\nphp\necho count($movies);\necho $movies[1]->getUrl('large');. Could you try installing the package in a vanilla Laravel app and see if it works there?. So it works locally and not on the server?. \ud83d\udc4d \nProviding a description of the problem and your solution here might help future users who might have the same problem.. There is no setting to limit the max px.. Can you do the conversion using our image package (which get used under the hood) directly?\nhttps://docs.spatie.be/image\n. What is your php version and what is the composer command you\u2019re running?\nDid you try install it in an empty directory?. There's nothing implemented for temporary URLs now. Laravel has a nice method for it:\nhttps://laravel.com/docs/5.5/filesystem#file-urls\nI'd accept a PR that adds creating of temporary urls in a fully tested, easy to use way for urls to media and urls to converted media.. Thanks!. Were you able to solve the issue?. > I would like it to perform basically the same as $model->addMedia($path)->toMediaCollection($collection, $disk); does, but with updating an existing media model instead of saving it under a new one with a new id.\nThat currently is not possible. You could opt to use your own media model. You can then add a method replaceMedia or something similar to it that:\n- remember the id of the media you want to change the file of\n- deletes that media instance\n- creates a new media instance with a new file\n- change the id of the new media to the old media id. > This would create a hole in the id range\nYup, but like you said, it's not really a problem unless you're Ebay or something of that scale.. Thank you for this, but I'm probably not going to merge it.\nI'm thinking that the majority of users doesn't need this.\nCan't you just update the order_column value after the Media object has been created?. I'm going to pass on this, but thanks for your work on this.\nIf you need this add it to your own project. . That is not supported out of the box.\nYou can however create your own image generator: https://docs.spatie.be/laravel-medialibrary/v6/converting-other-file-types/creating-a-custom-image-generator. Thanks for the offer, but I only want to maintain what I use myself. I don't need RAW conversions. If you put your generator in a repo of your own, I'm more than happy to link to it in the documentation.. We accidentally made a breaking change by adding a method to an interface. We'll fix this soon.. This package needs JSON column support introduced in MySQL 5.7. Perhaps your version of MySQL is too low?. Thanks!. Closing for now, but the label will make me take a look at this issue again, when creating a new major version.. This method has been re-added on the v7 branch.. Try clearing the config with php artisan clear:config. Currently there are no plans to add this to the package.. The process has been signaled with signal \"6 signifies that some of the optimization tools are installed, but that they are missing some dependencies. It could be anything really. Try reinstalling them from scratch.\nWorkaround is indeed to disable optimizing images by chaining nonOptimized to the profile. . Thanks!. Try $item->media. You can solve this by letting your model extend Spatie\\MediaLibrary\\Media. Reopen this issue if that doesn't solve your problem.. Thank you, but I'm not going to merge this in. Follow @arubacao's advice to solve the problem in your own app.. For this to work we could introduce a new ConversionWillStart event much like the already implemented ConversionHasBeenCompleted event \nInside that ConversionWillStartEvent you could write the results of your Face detection to the manipulations attribute of a Media instance. More info on that here: https://docs.spatie.be/laravel-medialibrary/v6/advanced-usage/storing-media-specific-manipulations\nI'd accept a fully tested PR that adds the ConversionWillStart event to this package.. Closing for now, reopen if this is still a problem.. Thanks!. \ud83e\udd1d. Zipping files is out of scope of this package. \nYou could do everything regarding zipping in queued jobs and mail the use a link when a zip operation is complete.. Thanks!. Although it isn't a breaking change per s\u00e9, it might be unwanted behaviour for some users. I'll add this in the next major version of the package (ETA: early-mid 2017). That seems pretty nice. Send a PR with tests.. You'll be happy to know that these changes are now the v7 branches, which will be released early next year.. I've added a few more examples to the relevant page in the documentation.\nhttps://docs.spatie.be/laravel-medialibrary/v6/advanced-usage/using-custom-properties. Perfect, could you also send a PR to the documentation repo?. Storing media in two different tables is not supported. I guess the easiest way is to fork this package and try to adapt it manually to your needs.. Pretty cool stuff man!\nCould you also send a PR to the docs repo?. Create a new page \"Responding with media\" in the \"Advanced usage\" section.. Thanks a lot for this!. This indeed seems like the way to go:\n$model->media->keyBy('collection_name'). Probably your Topic model does not implement the HasMedia interface.\n. This test seems to indicate that adding from base 64 is working as expected.\nhttps://github.com/spatie/laravel-medialibrary/blob/7c56be0c76c2f6220df6f6d816feeaee3fbd0f34/tests/FileAdder/IntegrationTest.php#L451-L460\nWhat are you doing differently?. Could you post your Topic model?. Your model does not implement HasMedia. Add impements HasMedia on the line where you start defining your class.\nHere's an example from the docs: https://docs.spatie.be/laravel-medialibrary/v6/basic-usage/preparing-your-model. @brendt will take a look at this soon. > It seems to me that a full cleanup of related files of a model should happen on the deleting or deleted event of the model and not from within the media library, used by that model.\nWe all agree here. Ok, we'll handle this further in #808 . Seems good, thanks!. Makes sense, I'd accept a PR for that. Might be a good first issue for someone.. I'd accept a PR that adds an only option has well. It should accept the names of one or more conversions. Only those conversions will be run (regardless of if the file already exists).. Thanks @davidianbonner, much appreciated!. We'll handle this further in #811 . Hi, thanks for the offer, but we\u2019re currently implementing this feature ourselves. Should be ready in a couple of days in the v7 branch.. Implemented.. Could you also send a PR to the documentation? Just click the Edit button on the topright of this page: https://docs.spatie.be/laravel-medialibrary/v6/converting-images/regenerating-images. Thank you for this great PR.. Is this still a problem in the latest version of the package?. Closing because we can't reproduce it.. Seem you have a typo there. Method name is probably \"preservingOriginal\". The tests seem to indicate that updateMedia is working as intended. Could you PR a failing test to UpdateMediaTest.php?. Ideally it should accept a model instance, a collection of model instances and an array of model instances.. \ud83d\udc4d \nClosing this for now and looking forward to the PR.. This issue does not concern the medialibrary, but seems to be something specific to your project.. What is the output of $yourModel->media?\nAre there any records in the Media table?. What is the value of collection_name in the Media table. Try passing that value to getMedia().\n\nSay you can only have one avatar for a user. If the user then changes his avatar, the older picture gets deleted.\n\nNo, this is something you should handle in your own application.. The package doesn't do this for you, but you can manually delete the original file with \nphp\nunlink($media->getPath());. Currently there's no method for that but I'd accept a PR that adds getFirstTemporyUrl to the package. Internally it should call  getTemporaryUrl.. It was a perfect PR, thanks!. I've fixed the spelling of the method. It's available in v6.6.1. You can remove Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Video::class  from the image_generators in the config file.. Thanks Lalit! Could you also PR the docs with an example of the new function?. Under the hood this package leverages Glide. If they can do the manipulation you want, our package can do it. If not, changes are our package can't do it.\nTake a look at their docs for some examples: http://glide.thephpleague.com/. Thanks!. Could you add tests to make sure that this works?. Thanks!. Here are the docs on custom properties: https://docs.spatie.be/laravel-medialibrary/v6/advanced-usage/using-custom-properties. The package really doesn't concern itself with the upload. You should manage the upload to the server. And from there on you can use the methods this package provides such as:\nphp\n$yourModel->addMedia($yourFile)->toMediaCollection($collectionName, $diskName);. What is the output of $mediaItems->first()?. I've just tried it out and did not get that error.\nCould you PR a failing test for me to look at?. I'm thinking that somewhere you imported our Media (or used a Media alias) in a class where you already use another class named Media.\nIf you think the package has an error please submit a failing PR.. For some reason PHP think that your method signature is \nphp\nApp\\Product::registerMediaConversions(?App\\Media $media = NULL)\nIt should be \nSpatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions::registerMediaConversions(?Spatie\\MediaLibrary\\Media $media = NULL)\nIn your code the namespace seems to be imported correctly.\nAre you sure that class is being used?\nPretty sure this problem originates with your specific app and not this package.\n. This is a limitation of Laravel itself. \nMedialibrary leverages model events to detect when stuff gets deleted. In case you use a query to delete stuff Laravel will not fire off Model events (because the models are not retrieved, but directly deleted in the db).. @palypster you can already add extra info to a media object via custom properties. You can use those custom properties in your gate checks.. Good be nice as well: https://twitter.com/bmichotte/status/933621483770957824. @sebastiandedeyne I very much like that idea. We can now easily implement this via the new media collection definitions.\nphp\n$this\n   ->addMediaCollection('avatar')\n   ->singleFile()\n   -> ...\n. I'm afraid that use case is a bit too far away of the problem medialibrary is trying to solve. You can leverage custom properties to add version numbers to your media objects.. @vesper8 don't think we are going to support that. Under the hood this package uses our image package which in it's turn uses Glide. If Glide were to support your use case, image and media-library would support it too.. @ludo237 why do you want that? Feel free to submit a PR against the v7 branch.. @tjmartin69 feel free to send a pr for that. This package aims to be a simple, easy installable solution for media management. In that context requiring installing a PECL extension does not compute :-). @pixelpeter like you mentioned you already can do a lot with a custom PathGenerator. In v7 the names conversions files will start with the name of the original file.. v7 will have a copy method on Media, so you can easily implement the cloning you described yourself.. @divdax This could result in a lot of unwanted conversions if that behaviour is unwanted. Best to take care of that in your own app.. > this request might already be listed or supported. Would be great if one could e.g. give a default file/object per model or media-collection via a property or trait class e.g. defaultMedia = 'profile.jpg', whatever way.\ngood suggestion, I'll see if I can implement this in a clean way.. Many to many relations won't be added. Possibly we'll open source a demo project that shows you how you can build a WordPress like medialibrary with this package.. Probably somewhere between beginning of March, end of May.. @JorisDR we will implement your feature request in v6 soon: https://github.com/spatie/laravel-medialibrary/issues/942. I'm going to close this issue as v7 is coming along nicely and most new features already have been implemented or been decided on. Of course, feel free to suggest improvements / features by opening a new issue.\nThanks all!. @robjbrain I feel like this is functionality is not generic enough to warrant a place in this package. Add this functionality this in your project.. In the latest version of the package there is a move method to move media to another model.. @Okipa feel free to send a fully documented en tested PR for that.. We always create stuff we need ourselves. In the client projects we are working on now, we don't need those Vue components. \nIf you need them, feel free to published them in a repo of your own, i'll gladly add a link to them in the readme of this package.. Normally that shouldn't happen. Could you provide the code you're using?. What happens if you set the height and width to higher values?. This error is caused by running out of memory. The package can't really do anything about that.\nYou could try to register your own error handling function in register_shutdown_function. And handle the situation.\n. Let me know when this is done.. Thanks!. The package has no support for converting entire media libraries to new paths. You need the create your own bash / php / whatever script for that.. Looks good, apart from the typo getFirstMediaPathl should be getFirstMediaPath\nDid you specify a resized media conversion on your model? Does your model implement HasMediaConversions?. Ah indeed, getFirstMediaPath should be getFirstMediaUrl. getFirstMediaPath will return the full path on disk, getFirstMediaUrl only the relative part on the configured disk.. I\u2019ll try to take care of this soon.\nIf you need this fixed quickly, feel free to submit a PR.\nOn Tue, 5 Dec 2017 at 23:17, Heiko Klingele notifications@github.com\nwrote:\n\nHey @freekmurze https://github.com/freekmurze,\ni realized that the custom headers is used only for the main file but not\nfor the conversions.\nI want to set a file to public read on Amazon S3. This worked for the main\nfile, but the conversions are still private.\nExample code:\n$model->addMedia($file)    ->addCustomHeaders([        'ACL' => 'public-read'    ])    ->toMediaCollection($type);\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/868, or mute the\nthread\nhttps://github.com/notifications/unsubscribe-auth/AAdiDY9ag__kpEnoeGXtN-iY5uQ8LXLeks5s9cEUgaJpZM4Q3DY9\n.\n-- \nFreek Van der Herten https://spatie.be +32 495 84 27 91\n. Couldn't you set a policy on the bucket itself that fixes this?. Will be fixed in #971 . Implemented.. Code you share some code for us to look at?. Are you sure the problem is caused by the medialibrary? Does the problem occur when you store the file without the medialibrary? Could this problem be caused by the exif orientation flag in your image? . > Would you kindly welcome a PR for this?\n\nI suspect not many people need this feature, so I'm thinking the way you do it now, is the way to go.\n\nDoes that mean there would be a better (or maybe easier) way to do it providing we take care of the markup on the client?\n\nI'm not sure I understand your question correctly but the package will take care of the markup and you'll be able to easily customise that markup.. Try running\nphp artisan config:clear. Does running config('medialibrary') in an artisan tinker session return the correct values?. On second thought, couldn't this be achieved this using a custom UrlGenerator?. You can use usingFileName to set the name of file.. You can already use a custom PathGenerator to achieve this. Or you can use different disks.. Thanks for you detailed reports on this. \nI'm guessing that you can now just run composer update to resolve the issue.. Thank you for this, but I'm not going to pull it in. Because we don't use soft deletes on our projects I don't want to maintain support for this. \nIf you need soft deletes use your own model and override the default filesystem.. What does $post_trans->getMedia() return?. Are these paths correct? https://github.com/spatie/laravel-medialibrary/blob/ac8b8df1d2266260a20dc181b528050e09b1c9b4/config/medialibrary.php#L114-L115. I've tested it on my local installation and on a server and this is all working as expection.\nPretty sure the problem is caused by something specific to your server. \nIf you find out what the problem is, please report back here.. You can use the apply method to execute some image operations before executing the next ones.\nYou'll find more info on this in the docs of the image package: https://docs.spatie.be/image/v1/usage/advanced-manipulations. There isn't a method to update a media. Just simply deleted the old media and add a new file to the medialibrary.. Thanks!. Thanks for bringing this to my attention. I've tagged a new version that use the download response instead of the file response.. >  Is that\u2019s something you\u2019re willing to merge\nThat the depends on the things you want to clean up. Do you have some examples?\nBefore releasing my team will do some code reviews and I will go through it myself too to hopefully fix inconsistencies.. Could you try setting the temporary_directory_path key in the medialibrary config file to another value?. Feel free to PR a fix for this.\nI would think that just using this config variable to set the temp directory should work for most users: https://github.com/spatie/laravel-medialibrary/blob/f3d8c33/config/medialibrary.php#L107. I can't seem to reproduce this. Could it be that your issues are caused by permission settings on your servers?. I'll take a look soon, the desired behaviour is that:\n\nthe queue specified in the config file is used\nresponsive images generated for the original image are always queued\nresponsive images generated for a conversion are performed in the same job as the conversions themselves. If the conversion is not queued,  the responsive image generation shouldn't be queued.\n\nI welcome a PR with tests that correct bugs in the code towards this desired behaviour.. Thank you! \ud83d\udc4d. @brendt could you take a look at this?\nNext year is fine \ud83c\udf7e. Makes sense, thanks!. You can get the width and height of an image through our image package.\nHere's an example from the tests of that package.\nhttps://github.com/spatie/image/blob/d868b79d451046877c225af92a40114734eb4e5a/tests/ImageTest.php#L64-L70. I'll consider this for v7. Does your custom media model extend the one provided in this package?\nOn Sun, 7 Jan 2018 at 15:40, Karugi Gitau notifications@github.com wrote:\n\nHello,\nI am getting this error when I am using a custom Media Model which is set\nin the config('medialibrary.media_model') :-\nType error: Argument 1 passed to\nSpatie\\MediaLibrary\\FileAdder\\FileAdder::attachMedia() must be an instance\nof Spatie\\MediaLibrary\\Media, instance of App\\Models\\Media given, called in\nC:\\Users\\James\nGitau\\Documents\\Projects\\uza\\vendor\\spatie\\laravel-medialibrary\\src\\FileAdder\\FileAdder.php\non line 275\nit seems the attachMedia function is using the\n\\Spatie\\MediaLibrary\\Media::class instead of the Model set in\nconfig('medialibrary.media_model').\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/895, or mute the\nthread\nhttps://github.com/notifications/unsubscribe-auth/AAdiDZVBWqKTY2sLvnCNxHOI3Y7CfqGXks5tINdEgaJpZM4RVqzX\n.\n-- \nFreek Van der Herten https://spatie.be +32 495 84 27 91\n. Thank you for this but I'm not going to pull it in.We don't want to do the maintainance in making sure that the test keep working on Windows.. Could you give some examples on how this could can be used?. Because imho not so much users require this functionality and (even though the code is good) the solution feels a bit heavy, I'm going to pass on this for now.\n\nI might change my mind in the future.. Take a look at the fit operation to learn all the options: https://docs.spatie.be/image/v1/image-manipulations/resizing-images#fit. Thanks!. Thanks!. You can set another table name by using your own Media model and set the $table property on that model.. You don't have to manually upload the images. Just write a script or command to import the images with code.\nphp\nforeach($images as $image) {\n   $yourModel->addMedia($image)->toMediaCollection();\n}\nCheck out the docs to learn all the methods the medialibrary provides:\nhttps://docs.spatie.be/laravel-medialibrary/v7/introduction. Run php artisan config:clear and try again.. Thanks!. That >each(function ($fileAdder) { isn't possible, if it involves not too much code, I'd accept a PR that adds that (please include tests).. Thanks!. Nice one, thanks!. I'd accept a fully tested non breaking pr that add support for passing a callable to App\\School::getFirstMediaUrl(). If a callable is passed, the first media for which the callable returns true will be returned.. We'll handle this further in #912 . Thanks for your work on this but in it's current state I'm not going to merge this in. I don't like the fact that the callable is now set as the third parameter.\nThe functionality should be implemented so that this is possible:\n``php\n$myCustomFirstMedia = $model->getFirstMedia(function(Media $media) {\n     ... //  when returning true here, the given Media will be used and passed to$myCustomFirstMedia`\n});\nThe current behaviour should also work\n$myCustomFirstMedia = $model->getFirstMedia('images');\nSo the first argument should be either a callable or a string.  getFirstMediaUrl should work the same.\nCould you send a new PR for me to review? If you have any questions, do let me know!\n. This package is already L5.6 compatible. If you use a model observers on the Media class you'll be able to listen for any event your heart desires. . php\nMedia::latest()->first()->id;. You'll always need to do at least one query to get this info.. No, this package will only store a given media on one disk. \n\nIn essence I would like laravel-medialibrary to write to both local storage and s3, but only read from one\n\nYou'll need to take care of this yourself.\n. Thanks for the good suggestions, I'll try to improve on this in v7. If you already have a good view on how this could be implement easily, I'd highly appreciate a PR to the v7 branch. If you do, please make sure all tests pass.. This package doesn't handle anything regarding permissions, that's something you should handle yourself in your app.\nA pragmatic way to go about this is to let the medialibrary use unguessable urls. You could for example use a path generator to obfuscate all urls.\nHere are the docs on path generators: \nhttps://docs.spatie.be/laravel-medialibrary/v6/advanced-usage/using-a-custom-directory-structure\nAnd here's an example of a path generator from the tests:\nhttps://github.com/spatie/laravel-medialibrary/blob/5.0.0/tests/PathGenerator/CustomPathGenerator.php. I'm not sure how to solve this, but maybe it's an option to dynamically set a path and an url generator somewhere after you've determined which tenant your serving?. \ud83d\udc4d . I'm hoping the PR will get merged soon.. Could you also add a test for this?. Closing this due to inactivity and merge conflicts.. In the docs you can learn how to use your own model: https://docs.spatie.be/laravel-medialibrary/v6/advanced-usage/using-your-own-model\nIn your custom model you can set the connection property to the name of the connection this model should use\nprotected $connection = 'mysql2';. \ud83c\udf89  Thanks!. To determine when to delete files this package hooks into Laravel's model events. Those events won't get fired when mass deleting using the query builder.\nTo fix this you should delete models one by one:\nphp\nVideo::where('set_id', $request->set_id)->each->delete();\nKeep in mind that this will fire off multiple queries.. v7 will have dedicated copy and move methods for this. \nhttps://github.com/spatie/laravel-medialibrary/blob/dc977e3eee4e21707e021d4e7f356ae41c4429af/src/Models/Media.php#L330-L356\nUnder the hood they'll do the same as what you are doing now.\nJust regenerating the files is much easier to do codewise, it all just works. Moving files (potentially across filesystems) would be much harder.\nFeel free to send a PR to add those move and copy methods to v6. Of course, add tests.. Sorry, thought this was resolved.\nPretty sure the trait works on an Eloquent model. Could you PR a failing test?. I haven\u2019t tried using the trait on a Pivot class, but as it extends Model, I\u2019m thinking it should just work.\nTry it out and let me know. \nIn case it doesn\u2019t I\u2019d highly appreciate a PR with a failing test.. > Nope it doesn't. Do you want me to write my own test and show its failing?\nYes.. Open up an issue if you find that this is an actual problem. Or even better if that's the case: open up an PR with a failing test and/or fix.. Currently there is not.. I'm thinking this issue is not caused by this package.. Instead of opening an issue, could you PR a failing test?. A test would prove that this is an issue with the package (or Laravel) and not something caused by something in your own project.\nFor bonus points you could also PR a fix.. Thanks!. Thanks for reporting this.\nspatie/pdf-to-image should go in the suggested packages in composer.json to solve this. Unfortunately doing this is a breaking change. I'll do this in the upcoming v7 of the package.\nMeanwhile you can install the package by adding it to composer.json and then running \ncomposer install --ignore-platform-reqs\nPlease let me know if you have any better ideas on how to solve this without breaking BC.. Damn, forgot about this one. Tempted to move it to the suggestions right now, but I'm afraid this breaking change would cause a lot of havoc in production systems of current users of v7.. I promise I'll take a look at this in v8. \ud83d\ude4f. Is your APP_URL env variable set correctly?. Much better, thanks!. Thanks!. Thank you!. Implemented in #943 . Thanks!. I'd accept a PR that changes the return type. All current tests should pass.. I guess we'll leave things as they are for now.. What happens if you use composer require spatie/laravel-medialibrary (without the version restriction).. Could you add a dd statement to see the value of $directoryPath. Set the correct permissions for that directory.. Thank you very much for posting your solution \ud83d\udc4d . I'm having a hard time spotting the difference between the generated query and the one you manually made.\nPretty sure your problem is caused by something on your machine, otherwise issue reports would have flooded in, tests on travis seem to pass too.. Going to leave things as they are for now. If you need this, use your own model.. Probably your issue is not related to this package, but to permission blues on your staging env.. There are too many unrelated changes in this PR.. Could it be the case that you just have to run php artisan config:clear on your server?. The 6.0.0 is not compatible with Laravel 5.6.  The last point release is. Please install the package by running php artisan require spatie/laravel-medialibrary. Make sure the package is not in your composer.json before running this command.. Thanks for your contribution. Probably I won\u2019t accept this functionality as you can easily use your own media model and put the function on there.. You need to do this yourself, there's no artisan command available.. I don't use Voyager and don't now what BREAD is. Best to open up an issue at Voyager.. Our intern is currently working at a tool to accomplish this. Keep on eye on this repo: https://github.com/spatie/laravel-medialibrary-v6-to-v7-filesystem-upgrade. I didn't see this behaviour before. Seems like this is more a problem with your server setup (or maybe a bug deep in Laravel). Closing this because it's unlikely that the package is causing this issue.. Going to keep things like they are for now.. Thanks for bringing this to my attention. I've fixed this in the latest version.. I'll merge this when tests are provided.. Closing for the moment. Reopen when you've added tests.. I've fixed the docs so it now displays the right required version which is L5.5\n\nI'm just curious if you will continue to support Laravel 5.5 LTS throughout it's support cycle.\n\nAs soon there's a compelling reason in a future Laravel version, we'll drop L5.5 support.. This functionality isn't provided by the medialib. I don't see it coming to the package because presumed low usage does not warrant the extra complexity this change will bring.. I'd accept a PR (with tests) that adds this to the package.. Fixed. Yeah, I'll take care of changing that test soon.. > We should also do this for the responsive images that get uploaded to external filesystems.\nThis is already in order. Great PR, thanks!. Thanks!. Could you add a test for this?. Thanks!. Let's leave it in this issue for now.. Thanks!. Thanks!. Thanks!. I'm thinking this will be a problem caused by your specific project. Could you install the project in a vanilla Laravel app?. Forgot to push it, the fix is in the latest version now.. Our tests seem to indicate that everything is working properly.\nCould you PR a failing test?. Thank you!. Thanks!. Probably this error is caused because MariaDB doesn't support json columns. In order to use this package you'll need to use MySQL 5.7 or higher (as stated in the requirements: https://docs.spatie.be/laravel-medialibrary/v7/requirements). Thanks for your research on this. Send a PR with tests.. I had troubles with getting the 0.5.0 version to work, so I specifically targetted the 0.4.1 version.\nI'll try to look into this soon.. 0.5.* still gives problems... Closing this for now.. Right now the events by this package are not broadcasted.\nThe easiest way to achieve broadcasting events right now is to listen for the events of the package and then broadcast your own events. You should listen for those own events clientside.. There's no automated process to fix botched conversion processes.\nYou should manually clean up related files and try the conversion again.. It seems that your issue is not with our package, but with alchemy/binary-driver (which is used under the hood of the ffmpeg package).\nBinary driver needs to be updated so it can work with symfony/process v4. \nAs soon as they add symfony 4 support you'll be able to install ffmpeg.\nhttps://github.com/alchemy-fr/BinaryDriver/blob/master/composer.json#L28. Thanks!. We'll continue the conversations in #1007 . I don't know if I want this in the package. It seems like a lot of code for me to maintain for a feature that I don't need myself.\nWe'll see when you complete this.\nIf this doesn't get merged, it could be a nice separate package.. I'm also going to close this for now, as I don't like to have WIP requests open. Put feel free to make further commits to this PR and ping me when ready so I can reopen it.. Seems like you forgot to import the Manipulations namespace.. You should fine the converted image in the conversions directory in the medialibrary.\nIf you use queues make sure it's running.\nIf you can't get it to work, open up a new issue.. Which error are you getting?\nFeel free to PR a failing test.. Closing due to inactivity. Feel free to send a PR to the docs, there's an edit button on every page. \ud83d\udc4d . The tests seem to prove that there is no syntax error in the latests version of the package.\nTry running the tests at your end. Are you sure that you're running the right PHP version?. What is the output of php -v?. In case the image hasn't been generated yet, getUrl and getPath methods will return null. \nYou could do add a method like this to your model that handles the null case:\n```php\npublic function avatar() {\n   $pathToPlaceholder = '...';\nreturn $this->getFirstMediaUrl('avatar', 'thumb') ?? $pathToPlaceholder;\n}\n```. I'm thinking that we should avoid making http requests at all costs, so the check can't happen at runtime. For responsive images we're already working with the mapping @brendt described above, and  it seems like this is indeed the way to go to solve this problem.\nLet's indeed use the custom properties for now to store this information. In the next major version of the package\u2122 we'll introduce a dedicated field for this.. I'm thinking that a morph map should just work. If I'm not mistaken the testsuite contains a test with a morphmap.\nIf your SuperUser has a one on one relation with User you could add methods like this on  SuperUser:\n// not tested...\npublic function getMedia($collectionName = null) {\n   return $this->user->getMedia($collectionName);\n}\nBut yeah, that's a bit cumbersome.\n. maennchen/zipstream-php on 0.5 still produces corrupt zip files when streaming a zip that uses files from multiple filesystems.. Seems to be fixed in 0.5.2. I'll implement this myself.. Could you add tests to make sure this works correctly?. Closing due to inactivity. To my knowledge the functionality we mentioned was introduced in 7.0. Which commit are you referring to?. That commit is unrelated to the work that has been done around putting the original file name somewhere in the filename of a conversion.\nAre you 100% sure that you used 7.0 at some point on your production server?\nI'm pretty certain that if 7.1 does not work because of changed conversion names, 7.0 will also not work for you.\n. There's too little information here to help you.. Fixed. Fixed, thanks for reporting this!. does App\\Models\\Media extends the Media model provided by the package?. Perfect \ud83d\udc4d \nGo ahead and tag a bugfix release.. I'm going to leave things as they are for now, but I'll consider renaming the relation when creating a new major version of the package.. Thanks!. I guess it is normal, your original image is just too small.. getMedia will perform it's own queries to lookup the right data. \nIf you perform YourModel::with('media') the media will have all media loaded. If you go that route, you should take care of filtering the $yourModel->media collection yourself.\n. > What about the question about what to do when a conversion file is removed?\nThe only place where our code removes a conversion file is when the cleanup command is run. That command should also make sure the generated_conversions custom property is updated.. Is this one ready for a review?. Thanks you for your research. Please PR this.. Thanks!. This is probably a permission error. Please make sure you apply a policy on amazon that allows directory creation.. The medialibrary only stores files. There's no support for links.. The medialibrary doesn't support that image type out of the box. However you can easily create your own image generator. Here's some more info: https://docs.spatie.be/laravel-medialibrary/v7/converting-other-file-types/creating-a-custom-image-generator. Thanks!. You can actually attach media to unsaved entities\n```php\n$model = new Model();\n$model->addMedia(...);\n$model->save();\n$id = $model->media->first()->id;\n```. I'm working on a built in mechanism to help this. It's a mechanism where you can add media to temporary upload model and move that to a real model when the form is submitted.\nNot documented yet: work being done here:\nhttps://github.com/spatie/laravel-medialibrary/tree/temporary-uploads. I'm thinking it has something to do with your system, because the tests of this package run fine, both locally as on Travis.. 1. No, behind the scenes we don't create a zip file on your disk. All content is streamed from all filesystems (even remote ones like S3) to the client.\n2. I don't think so.\n3. Please check if you specified a domain value in the s3 part of the config file.. Right now only the the originals are downloadable. I don't think it's very common that people want to download the derived images. \nIf you want that, you should implement that yourself.. I'd accept a PR with tests that fixes this.. Thanks!. addMedia will return an instance of the Media model. \n```php\n$media = $this->yourModel->addMedia(...);\n$media->id; // returns the id of the added media\n``. You forgot to import theSpatie\\Image\\Manipulations` namespace.. There's too little info for me to go on.\nThe tests seem to indicate that this package is working fine and that the problem is caused by something specific to your project.\nCould you PR a failing test for us to fix?. Could you add a test to make sure it works correctly?. Here's an image with a space in its name: \nhttp://spatie.github.io/laravel-medialibrary/tests/Support/testfiles/test with space.jpg. Thank you for your work on this!. By default the conversions are queued. Is your queue running? Alternatively set the queue driver to sync.. Thanks for posting your solution \ud83d\udc4d \n. We'll continue the conversation in #1080 . I decided I'm going to leave things as they are for now. . Thanks for explaining two excellent options @bhulsman and @rachid804 \ud83d\udc4d . Thanks!. This is what the docs say:\n\nA collection can have any name you want. If you don't specify a name, the file will be added to a collection named default. You can clear out a specific collection by passing the name to clearMediaCollection\n\nThe spirit of the medialib is that if you don't specify a collection name explicitly, we'll use the default collection.\nclearMediaCollection() should only remove items from the default collection.\nThis is also what @dfoxxdfoxx seems to be proposing.\nSo make sure that clearMediaCollection() only removes stuff from the default collection. I consider this a bugfix.. If you want to customise how responsive images are rendered you'll need to publish the responsiveImage view and make your modifications in the published view.\nhttps://github.com/spatie/laravel-medialibrary/blob/master/resources/views/responsiveImage.blade.php. Make sure that the path used on the disk where you are storing media is under the public directory of your app.. You can tack on nonQueued to the conversion profile to make sure the conversion will be performed immediately.\nAlternatively you can use the hasGeneratedConversion function which was recently added to the package: https://github.com/spatie/laravel-medialibrary/pull/1048/files\n. Changing this now is a breaking change. I'll revisit this when creating a new major version.. Media is just a plain model. So like @chris-faulkner said, all media can be retrieved with Media::all() or Media::get().. If you can solve this in a simple, well tested way, I'd accept a PR for it.. For the vast majority of users the current table definition is fine. Your proposed structured would make the code more complex with no benefits for most users. That's why I'm going to leave things as they are for now. Simple and pretty usable for the proverbial 80%.\nFeel free to fork the code and modify it to your needs.\n. Thanks!. I'd also steer away from dummy media, that could become complicated real fast.\nWhat @sebastiandedeyne suggests I his code example seem pretty good. I'd slightly rename the methods\nphp\n$this\n    ->addMediaCollection('image')\n    ->withFallbackUrl('/url/to/image.jpg')\n    ->withFallbackPath('/path/to/image.jpg');\n. I don't want to add new methods on the model for now. Users can easily do that in their own app.\nLet's start with adding withFallbackUrl and withFallbackPath.. Closing this issue for now, we'll continue the conversation in the PR you'll potentially submit.. Nice catch!. Thanks!. There's too little information here for us to go on.. This package only support the built in conversion methods that the spatie/image package provides. Using image intervention directly is not supported.. post['image_id'] probably returns an integer. You can't call methods on that.\nTry this:\nMedia::find($yourId);. You can hide the ids by using a path generator\nhttps://docs.spatie.be/laravel-medialibrary/v7/advanced-usage/using-a-custom-directory-structure. Hi, your question is not really about our package, but more on how you would build up your app.\nPlease post your question on public fora where many kind people can give you more info:\n- https://laravel.io\n- https://larachat.co/\n- https://laracasts.com/discuss. I'm guessing that this error is caused by a misconfiguration in your app. All the tests around this are working. \nCould you submit a failing test for us to look at?. This is fixed in the latests version.. Let's go for scopeWithMedia and scopeWithoutMedia.\nWe'll continue the conversation in the PR.. My feeling is that the problem is somewhere in your app code and it's something not related to this package. Could you open up a new issue where you describe the issue in a more terse way?. That's currently not possible, but I'd accept a PR that adds this to the package.. Adding macroable to a model could result in troubles because there's already so much magic going on in Laravel's base models.\nYou can use your own model if you need to customize our Media model. More info: https://docs.spatie.be/laravel-medialibrary/v7/advanced-usage/using-your-own-model. Thanks!. Thanks!. Still have to look into that.. 7.3.10, which solves this issue, has been tagged.. @jorenvh could you PR a failing test for us to look at?. The package will only delete files when Eloquent fires the deleted event. Here is the relevant code: \nhttps://github.com/spatie/laravel-medialibrary/blob/6b2bf387958b443d4adeacd047dde5cdbafa2946/src/MediaObserver.php#L39-L47\nTry to find out why Eloquent is already firing that event.. > I went with different collection for each language.\nThat seems like a good way to go about this \ud83d\udc4d . Our tests seem to indicate that it should be working:\nhttps://github.com/spatie/laravel-medialibrary/blob/6b2bf387958b443d4adeacd047dde5cdbafa2946/src/MediaObserver.php#L39-L48\nCould you submit a failing test for us to look at?. If you're using SoftDeletes you must force delete a model for the medialibrary to remove all files.\nHere's the relevant code: https://github.com/spatie/laravel-medialibrary/blob/6b2bf387958b443d4adeacd047dde5cdbafa2946/src/MediaObserver.php#L39-L48. I'd accept fully tested PRs for this at this repo and the spatie/image one.\nGoal is to get this code to work:\nphp\n $this->addMediaConversion('large')\n        ->preserveColorSpace()\n        ->fit(Manipulations::FIT_CONTAIN, 960, 960)\n        ->nonQueued();\nInteresting response at Laracasts: https://laracasts.com/discuss/channels/general-discussion/spatie-media-library-image-changes-the-colourhue-of-converted-photos/replies/432794. I can't reproduce this error. I'm not a Windows user. Feel free to PR a fix.. Could you submit a failing test for us to look at?. Thanks!. Ask this question at the Laragon repo.. I'm thinking that in most cases a given conversion profile should always be queued or should never be queued. I don't think that many users will need  the proposed functionality. So unless the PR is very very simple (and well tested en documented), I'm going to keeping things as they are for now.. Try this:\nphp\nUser::query()->with('media')->orderBy(\"created_at\", \"DESC\")->limit(20)->get();\n. There isn't a optimized dedicated method for this but you could something in the lines of\nUntested code, but you'll get the idea.\nphp\n$model->media->pluck('collection_name')->unique();. Right now there is no easy way, but I'd accept a fully documented and tested method that adds this to the package.. Feel free to submit a fully tested PR for this.. This package does not perform backups or restores.... I've fixed this in the docs.. A different disk for conversion is currently not supported by the package.. This problem is probably not related to the medialibrary.  Judging from the error message the Flysystem driver for DO spaces expects that your system clock is set correctly. The error indicates that the time of your server is too far off from DO's clock. \nIf the problem still persist, open up an issue at the repo of the Flysystem driver you are using.. Thanks!. This should have been fixed in the latest version.. Take a look at this page in the docs: https://docs.spatie.be/laravel-medialibrary/v7/advanced-usage/storing-media-specific-manipulations\nphp\n$newsItem\n   ->addMedia($pathToFile)\n   ->withManipulations([\n      'thumb' => ['orientation' => '90'],\n   );. There currently isn't a way to force this, I'd accept a fully documented and fully tested PR that adds this to the package.. I don't understand why this is needed. Could you give a more comprehensive example?. Thanks!. This package cannot convert videos to other resolutions. Do this in your own app and add the converted videos to the medialibrary.. The package doesn't provide such a helper function. Code it up in your own project.. I'm glad you found the problem.. @IChris2698I feel free to send a PR. Could you PR a failing test for us to look at?. I like to keep this package light and have therefore decided not to merge this in. Add this to your own custom model: https://docs.spatie.be/laravel-medialibrary/v7/advanced-usage/using-your-own-model. Does your opening form tag contain the right enctype?\n<form action=\"/your-url\" method=\"post\" enctype=\"multipart/form-data\">. You need to import the correct namespace in order to use HasMediaConversions.\nPut use Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions; at the top of your class.\nMore info: https://docs.spatie.be/laravel-medialibrary/v6/converting-images/defining-conversions. Can you install the latest version of the package in a vanilla Laravel app?. I think the problem is something specific to your app. All tests of the\npackage are passing. With over 500k installs we would get more reports if\nthe package was not installable.\nTry following the install instructions to the letter. Sometimes it helps\ninstalling the package in a new project to more easily figure out what is\ngoing wrong in your old project.\nOn Sat, 28 Jul 2018 at 00:44, CriptoMex notifications@github.com wrote:\n\nI mean, i want to use the package on my project... and i don't have any\nidea why this is happening, basically this is not something i caused...\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/1190#issuecomment-408584810,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAdiDYvCd8aBcuq819xfmrB_6RPFc6zBks5uK_o9gaJpZM4Vj_KS\n.\n-- \nFreek Van der Herten https://spatie.be +32 495 84 27 91\n. Have you checked the contents of the request coming in to your app?. It seems to me that your problem is more related to your app and not to our package.\n\nFor general questions around Laravel and how to structure your app, please use a public forum like laravel.io or the laracasts forum.. Wouldn't it be easier to just always generate absolute urls?. Instead of concatenating I believe you can pass a string to the url function as an argument. Could you try to see if that works?. I'm thinking the url will not be correct if the images are hosted on an external filesystem like S3. Related issue #1220. Thanks!. Feel free to submit a PR for this.. Use your own model and add the methods you need there: https://docs.spatie.be/laravel-medialibrary/v7/advanced-usage/using-your-own-model. I don't understand the question.  The docs contains a lot of examples on how to generate URLs: https://docs.spatie.be/laravel-medialibrary/v6/basic-usage/retrieving-media. It's breaking in it's current status.\nI'll consider this PR again when creating a new major version of the package.. Thanks!. I'm sorry but I just don't have the time to look into app specific problems. Pretty sure this error is caused by your environment and not by the package.\nTry using MySQL instead of MariaDB.. Save the content to a file. Then add the file.. Thanks!. Media is just a plain model class. It has all methods to generate urls on it. The response of @kgenly seems correct \ud83d\udc4d . Thanks!. There's already a fix surround the url generation of responsive images (#1195). If you need a fix quickly, feel free to open up a new PR.. Seems like this one is solved.. Working on it, could take a while tough. We have some instructions here: https://github.com/spatie/laravel-medialibrary/blob/master/UPGRADING.md. This question does not concern the package, but is a more general Laravel forum. Please post your question on the laracasts forum, laravel.io, .... Video manipulation is out of scope for this package.. Feel free to submit a fully tested PR that adds this to the package. If the implementation is simple and I'll like the surround API I'll be sure to tag it.. Feel free to send a PR to fix this.. Tests seems to indicate that the function is working properly. https://github.com/spatie/laravel-medialibrary/blob/1e4fbaf0d439919b8e79605db65872a3b1aba8f1/tests/Feature/FileAdder/IntegrationTest.php#L210-L263\nIf you believe there is an error here, feel free to submit a PR that fixes this.. The tests around this prove that the functionality is working as intended. Could you PR a failing test?. There's an edit button on every page in the documentation, feel free to PR improvements.\n\ndeleteing a previous one and creating a NEW database entry\n\nThis currently is the way to go. Feel free to create a fully tested and documented PR if you need this. If the code is simple I'll consider adding it to the package.\n. Will do!. Thanks!. Thanks for your suggestion, but you can easily implement this in your own project.  I try to keep the package as light as it can be.. Thanks!. The latest version of the medialibrary is compatible with L5.7. I'd accept a PR that fixes this.. Change >toMediaCollection to ->toMediaCollection. Cannot reproduce this, feel free to submit a fix should you find that this problem is caused by our package.. The namespace of your class is `Bgprod\\Adaptor\\Classes``\nTry\n'path_generator' => Bgprod\\Adaptor\\Classes\\AdaptorMediaPathGenerator::class,\n. Feel free to submit a fully tested PR. if the code is simple enough for me to maintain I'll consider merging it \ud83d\udc4d . This problem is not caused by this package.\nUse prohibits to find out which package is the culprit of the problems: https://getcomposer.org/doc/03-cli.md#prohibits-why-not-. Going to leave this as it is for now.. Feel free to PR a fix with tests for this.. I'd accept a PR with tests that fixes this. Not 100% sure, but I think you can convert them to TEXT fields and use almost all of the features.. Thank you the suggestion, but leaving this as it is for now.. Seems good!. Probably your PHP process does not allow uploads bigger than the default, which is set to 2MB on most systems. Google a bit around on how to check this and allow for bigger uploads.. Thanks!. Closing due to inactivity. Thank you for your work, but I've decided not to add it to the package. Main reason is because we don't have a need for this ourselves and want to keep the package as simple as it can be.. Thanks!. Responsive images should look good on retina displays out of the box. Your browser will pick the right one for the screen used\nThe package does not do anything special for other images. Your browser will just try to display it as best as it can.\n. We'll continue the conversion in #1279 . Thanks!. @nicolasbeauvais Thanks for this! \ud83d\udc4d Could you add a test to make sure that these changes work?. Thank you so much for your work on this \ud83d\udc4d . @pedrofurtado https://docs.spatie.be/laravel-medialibrary/v7/introduction\nThere's an edit button on every page.. 6.9.2 has support for L5.7. For our projects Many-to-One makes much more sense. It's much lighter to work with. \nFeel free to fork our code and create a version that use the many-to-many.. Thanks!. I accept a PR that fixes this.. @Joucke @VincentKos thanks for your attempts to reproduce this, highly appreciated \ud83d\udc4d \nGoing to close this now because it can't be reproduced. If somebody can reproduce this please PR a failing test for me to fix.. My apologies for these errors, I seem to have added a tag to the wrong branch.\nI've unpublished 6.9.1 and made sure that 6.9.2 is tagged with the right branch as it's source.\nAvoid installing 6.9.1, if you're already on it, simply run composer update to install 6.9.2.. Make sure that the disk name you set in the config of this package matches one of the disks in the filesystems config file. Make sure that disk has the root path you want.. Thanks!. I believe there's already an issue for this on the spatie/image repo where the error originates.. Your code seems correct, so there's something wrong with the configuration.\nMake sure your model implements the right interface and uses the right trait: https://docs.spatie.be/laravel-medialibrary/v7/converting-images/defining-conversions. Closing due to inactivity.. When using the command without options it with loop over media items, and replace all generated files.\nTo generate only the missing files and not touch the existing fiiles use --only-missing\nhttps://github.com/spatie/laravel-medialibrary/blob/e1d8fe917eff9b4440978516d93bde65df8c2fea/src/Commands/RegenerateCommand.php#L19. Closing this because this is probably related to laradock / docker config and not this package.. We're not using Homestead, so we can't help you with this one.. Feel free to PR improvements in regards to transactions. Make sure to included tests.. The package doesn't do this out of the box. Please extract exif data manually and set it as custom properties on the media object.. Please make sure that your PHP has enough memory and time to run.\nIf the package does something wrong here, please send a PR.. We don't use Own Carrousel, so can't help you with this.. This is probably related with imagick permissions: https://alexvanderbist.com/posts/2018/fixing-imagick-error-unauthorized. I believe the docs on this are correct.. This is not in the scope of this package.. See reply on the other issue you posted.. > almost a month still no reply, so helpful...\nPlease keep in mind that everybody here is voluntarily and nobody is required to send responses. \nThe functionality you want is currently not available in the package, please send a well tested PR if you want this. . This is currently not possible. Feel free to fork our code and make the necessary changes in your own copy.. Thanks!. Is this something that can be fixed from within our package?. Those options can't be set from this package. Closing issue this because the issue does not originate nor can't be fixed here.. > Is there a way to generate conversion cache on demand only ?\nThis isn't supported. Glide is indeed an option worth your time to look into.. It depends on your application. Feel free to add them in a migration of your own.. Thanks!. I guess so. But that package doesn't handle this. Use you own media model and add the desired functionality there.. You probably forgot the restart horizon after having added that conversion. \nYou should restart horizon after every code change.. I'd accept a PR that fixes this.. Mmmm, that shouldn't happen, I'd accept a fully tested PR that fixes this.. @denitsa-cm Thank you and congrats on your code being merged and released.. That call to singleFile() signals the package that it should empty the collection when something is added to it. If you don't want this behaviour, remove that call.. Mmm, that's odd indeed. The tests of this package prove that the feature is working as intended. Could you PR a failing test for me to look at?. Duplicate of #1273 \nWe'll tackle it in that issue.. We can create thumbnails for some video types: https://github.com/spatie/laravel-medialibrary/blob/6e5e355ecb262875320904f57c06dbe332eb3d36/config/medialibrary.php#L128-L134\nBut we can't convert the files themselves. You need to convert them before adding them to the medialib.. Currently a conversion cannot be returned directly. I'd accept a PR with tests that adds this to the package.\nFYI: You can retrieve the path to the first media item with `getFirstMediaPath. Thank you for your work on this, but i've decided not to merge this in for name. There's some more code changes involved than I anticipated. I like to keep the package light.. Yeah sure, go ahead and create such a package. When you're done I'd accept a PR that adds a link to it in our readme. \ud83d\udc4d . Closing this one, because I highly suspect that error is not caused by this package. We don't do anything different in regards to morphmaps when on queues.. \ud83d\udc4d . Right now you can achieve this by creating a TemporaryUpload model from your own, add your upload to that one and afterwards move it to your real intended model.\nI'm working on adding this behaviour to the medialibrary. ETA somewhere 2019 \ud83d\ude04 \nSome work being done here:\nhttps://github.com/spatie/laravel-medialibrary/tree/temporary-uploads. 1. You could create your own generator that returns an empty string. Specify the class name in tiny_placeholder_generator in the config file\n\n\nPublishing the view seems like the way to go. You have to add logic yourself to determine when you want to render what, the package can't help you with that.\n\n\nFeel free to send a PR with tests for this\n\n\nThere are already being optimized under the hood: https://github.com/spatie/laravel-medialibrary/blob/6e5e355ecb262875320904f57c06dbe332eb3d36/src/ResponsiveImages/ResponsiveImageGenerator.php#L89\n\n\n\nCan I remove the \"medialibrary_original\"\n\n\n\nCurrently not, feel free to send a tested PR\n\nAlso is it possible to rename \"/responsive-images/\" folder to something to a shorter name like \"/resp/\"\n\nYes, using a custom path generator\n. In that case I'd welcome a fully tested PR that makes the tiny image generators optional \ud83d\ude04 . Our package can make a watermark too:\nhttps://docs.spatie.be/laravel-medialibrary/v7/converting-images/defining-conversions\nYou can use any manipulation listed on our image package docs, including watermarks: https://docs.spatie.be/image/v1/image-manipulations/watermarks\n. Could you update the required version of the package so the lower dependencies do not fail?. Thanks!. Thank you very much!. We aren't going to change this. Move to a provider that allows this function to be used.. Yup\n. @sebastiandedeyne Good point and you're certainly right that it isn't 100% clean. \nOn the other hand I don't think there will be many users testing the return value and calling the delete method after they've just called deletePreservingMedia.\nI do feel that when a deletePreservingMedia gets called on the object the user doesn't intend to use it any further. So that'll probably be just the last call that object will get.\nSo I'm ok with this code. Sounds logical?\n. $this->deletePreservingMedia = true; is indeed necessary.\nBut parent::delete() could be replaced by $this->delete().\n. one of the two TYPE_PDF should be TYPE_SVG \ud83d\ude04 \n. Nitpick: I don't like having extensions as capitals in function names. Could you make the function name camel case?\n. Same here.\n. The description of --force seems to have been copy pasted \ud83d\ude04 \nCould you improve the description?\n. Rename this variable to something that makes it clear it is only used when working with video. Something like extractVideoFrameAtSecond or something better.\n. See note above\n. It would be more readable to use pathinfo with the PATHINFO_FILENAME constant instead of popping.\n. much sadness here\n. \ud83d\udc4d \n. \ud83d\ude22 \n. Removed\n. This can just be $media->extension. Laravel magic \ud83d\ude04 \n. $isLocal can be removed\n. Thanks!\n. This notice may be removed.. This line may be removed.. The scalar type hint on this function will ensure that $data will always be a string. Remove this if block.. Rename $data to $base64data. Rename media-library to medialibrary (that's a bit more consistent with the reset of the code). Move this line to right before the line starting with $this->testModel. Let's go for $base64data. That feels slightly more natural to me.. call to array_values can be removed here. Is it necessary to remove files manually here? I'm think the MediaObserver should take care of that.. Test feels a bit brittle. It only asserts that the number of items is correct. It would be better to check if the ids of excluded items are still present after using clearMediaCollectionExcept. nice \ud83d\udc4d . Add an early return here, so we can get rid of the else statement.. Add a Media type hint here. Let's lose the docblock: we can typehint the parameter and the function name is clear enough.. rename this to unsavedMediaItems. Refactor this to bail out with a return statement if model->unsavedMedias is empty. The the actual process loses an indentation level.. These two lines appear twice in this function. Let's extract them to their own function. No sure on a good name here.. Could you add a testcase that proves this works when the model hasn't been saved yet?. Let's leave this in. Nitpick: rename $bar to $progressBar. Could you put this logic in it's own method? Name it guardAgainstInvalidMimeType. Then you can reuse the logic in addMediaFromBase64.\nUse early returns in that function instead of using &&. So in that function you could do:\n``php\nif (empty($allowedMimeTypes)) {\n   return;\n}\n. Do we really need that$mediasintermediate variable?. Do we really need that$mediaPaths` intermediate variable.\nI've got nothing against a long collection chain.. Do we really need that $diff intermediate variable?. Use trait_uses_recursive here and use the ::class constant.. Nice catch, thanks!. Bonus points for updating the changelog \ud83d\udc4d . @AlexVanderbist Did not spot this when reviewing, but adding a method to an interface is a breaking change (see #765).\nCould you tag a new bugfix release where this method is removed from the interface. Also add a new issue with a label revisit for next major version with a note that we should re-add that method to the interface.. Use protected. Use ::class syntax. Seems off, doesn't this cause an infinite loop? Instead of recalling the same funtion and returnning lets just pack that single item in a collection so the rest of the function can run.. That isset check isn't necessary because the default is false right?. The clearing of the media collection should go in process item. Otherwise the media collection could get cleared before a new item is added.. Can you change this in Set the manipulations.?. Compared to all, * has a lower change that it used as a collection name. \nLet's use * here.. Rename this to shouldAddPlaceholderSvg. That's more in line with similar functions in other packages.. Nice!. Can we use assertContains here?. Could you use assertContains here?. Would the test work with only Event::fake()?. This doesn't seem right. Files without extensions are allowed.  The mimetype is already checked on line 129.. There's no new functionality in this PR. Let's make this a minor release.. Sneaky! Nice!. rename to markAsConvertionGenerated. Renaming this function is a breaking change. Please add syncFileNames back. It should call this new syncFiles function.. The responsive image files should be moved as well.. Wouldn't renameMediaFiles be a better name?. Wouldn't it be easier to just move the entire contents of the conversions directory (and the responsive images directory)?. If we were to let getGeneratedConversions return a collection we could avoid those nasty continue and break statements by a filter and an each operation.. if getGeneratedConversions is a collection we could just use the has function on it.. Let's return a collection here.. Whoops, my bad \ud83d\udc4d . We could use array_get to make this a one liner. But unsure if that would be better.. Make this protected. Could your refactor this so we don't need an else statement? A dedicated method with an early return seems the way to go.. Rename expiration to expiresAt. Make sure this throws a proper exception when using it on non-s3-files systems. I'm not sure if we should throw an exception here. A more safe default is to get the first frame. If people want an exception instead that could use a custom ImageGenerator. ",
    "groenewege": "Hello,\nThank you for this great package !\nI struggled with the same issue.\nMaybe you should put this example in the README file.\n. Thank you.\nFor your information : each time I use the getFirstMediaURL method to see if an image is attached to the model object and then I use the getFirstMediaURL method again to display that image.\n. Thank you for taking the time to investigate this issue.\nI have been tinkering a bit and I noticed that I don't get the extra queries when I use the getFirstMediaUrl method without parameters : \n$this->getFirstMediaURL()\nBut I see the extra queries when I use parameters to target a specific collection and conversion :\n$this->getFirstMediaURL('hero_image', 'hero')\nI hope this helps. \n. Thank you for addressing this issue !\nI see less DB queries after updating to the latest version.\nAlthough, they have not all disappeared.\ni.e. in the example form my first comment I still see 2 from the 3 SELECT * FROM ... queries.\n- a query for all the information from the page when I display the hero image of the page : $this->getFirstMediaURL('hero_image', 'hero')\n- a query for all the information from the first gallery image when I display the first gallery image : $this->getFirstMediaURL('gallery_image', 'thumbnail')\n- the query for all the information of the second gallery image does no longer appear in the query log.\n\nIs it necessary to make at least one query for all information from a parent model of a media object ?\nIs it necessary to make this query a SELECT * FROM ... query ?\nI am sorry that I can't help more with finding  a solution, I really appreciate all your work.\n. :smiley: \nI think all the extra queries are gone. \nThe number of DB queries are divided by 2 on my pages.\nThank you very much. \nI owe you a :beer: if we run into each other at a conference or meetup.\n. ",
    "rashid-ali4u": "Hi , \nI am getting following error. \nCall to undefined method Illuminate\\Database\\Query\\Builder::addMedia()\n. ",
    "rawcreative": "Digging a little deeper it appears the GlideImageManipulator:: getModelImageProfiles() method, looks for the imageProfiles attribute on the model. So changing getImageProfileProperties to getImageProfilesAttribute returns the profiles properly, however it only appears to create one profile image unless shouldBeQueued is set to false. I've tried with both the sync queue driver and beanstalk, and it seems only the first profile is being queued.\n. ",
    "codybutz": "When I upload png's they are formatted to jpgs. Is there a flag I am missing to make sure it doesn't automatically save it out as a jpg?\n. ",
    "ajitbohra": "@freekmurze can you provide more details on the second parameter  ['id' => $mediaId] is it custom property ?\n. @kickthemooon thanks for the reply have checked the document but it returns collection. Need to access and update specific image have provided the e.g. above for more details .\n. - How can we update image name for particular image in collection\n- loop it would be array based how can we know which image unless we add custom property to filter\n- manually query media table ?\n. @freekmurze thanks for the example it gives more clarity :)\nLast doubt where can we find media Id ? i guess getMedia() will return the collection which will hold the id and other details ?\nSorry for being naive. Have just started playing around with the package :)\n. @freekmurze thanks for the prompt reply and solution. Will use the above details and reply back with few example based on our implementation so that others can ref.\n. ",
    "matijaboban": "This solution seams to only filter by custom_properties, Is there an easy way to retrieve by media ID or would you be open to a pull request?\n. True, that would regenerate given items, but it doesn't address my issue of trying to have independent named conversions done on a single media item (conversions that are not defined on the model itself, but rather at media creation).\n. @tomcoonen can you put up a sample code of your implementation as Im curious about the prefix usage.\nThanks\n. ",
    "bryanrscott": "Im not sure it is a good PR but it is here\nhttps://github.com/spatie/laravel-medialibrary/pull/419. Agree, simpler. Close.   My issue, I missed the existing setting in the config file. This post helped me out, so I wanted to share one possible improvement\n$model_type = class_basename($media->model_type);. ",
    "widlturk": "as a solution\nI add the following functions to the model file\n``` php\npublic static function boot()\n    {\n        parent::boot();\n    self::deleting(function (MediaLibraryModelInterface $subject) {\n\n        foreach ($subject->media()->get() as $media) {\n            MediaLibrary::remove($media->id);\n        }\n    });\n}\n\npublic function getImageProfileProperties()\n{\n    return [\n        'thumb' => ['w'=>200, 'h'=>200]\n    ];\n}\n\n```\n. thanks \n. sample \n\u011e\u00dc \u015e\u0130\u015fi\u00e7\u011f\u00fc filename.jpg => sisicgu-filename.jpg\nI think more readable files have names\nhtml\n<img src =\"\u011e\u00dc \u015e\u0130\u015fi\u00e7\u011f\u00fc filename.jpg\"> \ninstead\n<img src=\"sisicgu-filename.jpg\">\nI'm sorry to be done before this operation.\nI'm doing this\n``` php\n$page = $this->model->find($id);\n    $tempDirectory = storage_path('temp');\n\n    $fileName = str_slug(getFileName($file->getClientOriginalName())).'.'.$file->getClientOriginalExtension();\n\n    $file->move($tempDirectory, $fileName);\n\n    $collectionName = 'popup';\n\n    $page->addMedia($tempDirectory . '/' . $fileName, $collectionName);\n\n```\nI thought it would be better if we do automatically in this package\n. ",
    "welcoMattic": "Basically, examples with a real and complete Model and an use case in a Controller. May I will write it later if you want?\n. Ok, thank you.\n. Oh perfect! I'd not try to add a second parameter, my bad.\nThanks for updating documentation.\n. EDIT: I found a solution to my problem in Envoyer.io documentation :\n```\nManaging Uploaded Files\nWhen storing user uploaded files, you should store them in the storage directory of your application if you are using Laravel. Then, you may use the \"Manage Linked Folders\" feature of Envoyer to create a symbolic link from your public directory to the storage directory. The \"Manage Linked Folders\" button can be fonud on the \"Deployment Hooks\" tab of your project.\nIf you are not using Laravel, you will essentially follow the same process. However, you will need to manually create a storage directory in the deployment path of your application (the same directory level as the current symbolic \n```\n~~EDIT2: May laravel-medialibrary expose a parameter for a storage path, and for reading path.~~\n~~Like this:~~\n~~'publicWritePath' => storage_path().'/media',~~\n~~'publicReadPath' => public_path().'/media',~~\n. Hi @sebastiandedeyne!\nAs on Envoyer.io, on my Homestead local stack it doesn't work... Laravel seems resolve the public/media symlink.\nFor instance on my Homestead stack, when I var_dump(public_path().'/media');, Laravel display /home/vagrant/myproject/storage/media/.\nDo you have any idea if it's a Laravel issue ?\n. After hours of debugging, it looks like the real problem is in the imageProfileURLs generation.\nSettings : 'publicPath' => public_path() . '/app/media',\n- If I call getOriginal method, it returns -> /app/media/9/image.jpg\n- If I call 'getUrl('detail')' method, it returns -> /home/vagrant/project/storage/app/media/9/4-11.jpg\nI'm trying to fix it, but if you can help me, it will be pretty cool ;)\nEDIT: issue is located at : laravel-medialibrary/src/MediaLibraryRepository.php line 219.\npublic_path() is not good if you store your medias in storage dir, but storage_path() will not be a good solution if you store medias in public dir.\nSearching a universal solution ...\n. Yes, I understand, but getOriginalUrl() gives me the good url for my medias stored in storage dir. But not getUrl('detail') method.\nCf. my last EDIT (https://github.com/spatie/laravel-medialibrary/issues/13#issuecomment-114992701)\n. Thanks a lot! I'll continue to try debug it. See you tomorrow.\n(I'm in France, you?)\n. Ok, perfect ! I fix this issue in my own code for the moment.\nDo have any idea for the ETA of next-gen version?\n. Thanks a lot! I'm going to read it today.\nKeep going, ans thanks for your work :+1: \nIt's pretty cool to rewrite your module with built-in Filesystem.\n. @freekmurze Thank you very much! I'll test it this weekend. I'll give you my feedback soon ;)\n. ",
    "sebastiandedeyne": "Hi @welcoMattic \nNot really following, why can't you just create a symlink in the public folder like the Envoy docs recommend?\n. This is probably since the package assumes that the url's are relative to the public directory. If this is'nt the case you're using a non-standard server configuration for laravel, what do your url's look like if you're linking to files outside of the public directory?\nHere's the culprit, could get tricky to refactor though: https://github.com/spatie/laravel-medialibrary/blob/master/src/Models/Media.php#L44\n. Hmm, misunderstood. Sounds like a bug indeed, I'll try to look into it tomorrow.\n. Fixed in the latest paginateroute release.\nhttps://github.com/spatie/laravel-paginateroute/releases/tag/1.4.0\n. :+1: \n. :+1: \n. Sidenote: you can ignore the camel case warnings in in the tests.\n. Sounds good!\n. I'd say this is application logic and doesn't belong in the package. Maybe add a specific function for the operation to your model? E.g.:\npublic function avatar()\n{\n    return $this->hasMedia('foo') ? $this->getFirstMedia('foo')->getUrl() : 'somedefaulturl';\n}\n. Your user also needs to implement the Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia interface.\n. Not sure if it's the issue, but you're missing a capital H in hasMedia\n. You could query the media table and call delete on the resulting model.\nphp\n\\Spatie\\MediaLibrary\\Media::where('file_name', $fileName)->first()->delete();\nDeleting the actual file happens by listening to the Eloquent event that gets fired so you don't need to worry about that.\n. You can retrieve the images via the getUrl() function. If you need an array of URL's, you could use a map.\nphp\n$urls = $myModel->getMedia('images')->map(function (\\Spatie\\MediaLibrary\\Media $media) {\n    return $media->getUrl();\n});\n. You could do this on any instance of Illuminate\\Support\\Collection containing Media items.\n``` php\n\\Spatie\\MediaLibrary\\Media::all()->map(/.../);\n$myModel->media->map(/.../);\n// etc.\n. What do you mean by a collection 64? A collection named 64?\n. php\n$urls = $myModel->getMedia('64')->map(function (\\Spatie\\MediaLibrary\\Media $media) {\n    return $media->getUrl();\n});\n```\nThis would return an instance of Illuminate\\Support\\Collection containing all URL's. If you need them in an array, you can then call $urls->toArray().\nMore info on map: http://laravel.com/docs/5.1/collections#method-map\n. You could add a keyBy to the chain:\nphp\n$urls = $myModel->getMedia('64')\n    ->keyBy('id')\n    ->map(function (\\Spatie\\MediaLibrary\\Media $media) {\n        return $media->getUrl();\n    });\nhttp://laravel.com/docs/master/collections#method-keyby\n. Slight correction: you're going to have to use transform instead of map to preserve keys.\nphp\n$urls = $myModel->getMedia('64')\n    ->keyBy('id')\n    ->transform(function (\\Spatie\\MediaLibrary\\Media $media) {\n        return $media->getUrl();\n    });\n. Isn't that what you're after? Laravel automatically converts collections to json when they're returned as a response.\n. I'd go over them with Object.keys() and a forEach\njs\nObject.keys(myUrls).forEach(function(key) {\n    var id = key;\n    var url = myUrls[key];\n});\n. Well that subject's a bit too broad to discuss here :)\nI'd suggest you check out laracasts/PHP-Vars-To-Js-Transformer for a simple implementation:\nhttps://github.com/laracasts/PHP-Vars-To-Js-Transformer\nFor more info on the topic, here's a nice overview in a StackOverflow answer:\nhttp://stackoverflow.com/questions/23740548/how-to-pass-variables-and-data-from-php-to-javascript\n. So if I understand your issue, everything goes well in the database, but you're missing one of your media files on the filesystem?\nCould you post a snippet of your custom path generator?\n. Aren't you generating two identical paths that way? I'd think your second media file is overwriting your first one on the filesystem.\nBoth model_type and the slug custom property will be the same, so you're generating equal file paths.\n. Hmm no clearMediaCollection only deletes files for a certain model.\nSome more debugging ideas: \n- If you do images first and then tech, is it the same one that doesn't save?\n- Do you have the same issue using the default path generator?\n. You could have your custom class inherit from the default media model to get started. For your database table, you could just edit the migration that gets published by the package.\n. You're going to have to write your own query, the media library doesn't have such functionality out of the box.\nFirst you'd have to retrieve all the media items, then retrieve the relevant data.\n``` php\nuse \\Spatie\\Medialibrary\\Media;\nMedia::where('collection_name', 'galleryfrontimages')\n    ->get()\n    ->map(function (Media $media) {\n        return [\n            'frontthumb' => $media->getUrl('frontthumb'),\n            'frontlarge' => $media->getUrl('frontlarge'),\n        ];\n    });\n```\n. Tough one, we generally handle cases like this in our views or wherever we need them.\n@if($model->hasMedia('cover'))\n    <img src=\"{{ $this->getFirstMedia('cover')->getUrl() }}\">\n@else\n    <img src=\"defaultimage.jpg\">\n@endif\nAlternatively you could create a new Media instance there without saving it, but that would probably limit you in some cases.\n. If you want to use the sortable trait on other models, I'd recommend checking out our dedicated package for it.\nhttps://github.com/spatie/eloquent-sortable\n. Do the results need to be in a specific shape? You could just retrieve all Gallery models, and query the media item when you need it.\n``` php\n$galleries = Gallery::all();\nforeach ($galleries as $gallery) {\n    echo $gallery->getFirstMedia()->getUrl();\n}\n```\n. I think you should be able to symlink the folder in storage to public.\nhttps://laracasts.com/discuss/channels/general-discussion/handling-uploaded-local-files-with-envoy?page=1\n. Your driver should stil have the public path link as root. Your code doesn't have to know it's actually in storage instead of public, the symlink will take care of that for you.\n. This is what your driver should look like:\nphp\n'media' => [\n    'driver' => 'local',\n    'root'   => public_path('media'),\n],\nSince your media is currently in the storage directory, you'll need to create a symlink to the public folder.\nbash\nln -s /path/to/storage/media /path/to/public/media\nYou'll probably need to set this up as some sort of post-deploy hook with Envoyer. I've never used the service myself so can't really help there.\nNow the medialibrary will be able to access the storage folder via a path in the public folder.\n. Watermarks are only supported in Glide 1.0. Since the media library is currently still on 0.3, the feature isn't available at the moment (updating Glide would be a breaking change).\n. Odd, could you post the contents of your composer.json file?\n. Unfortunately this package isn't compatible with league/glide v1.0 yet (we can't just bump it up since it has some breaking changes). For now you'll have to use Glide v0.3.\nLater on this year we'll be releasing a v4.0 which will upgrade the Glide dependency.\n. If you want to apply conversions to the original, you'll have to do so before adding it to the media library. E.g.:\n``` php\n$toBeAddedToTheMediaLibrary = '/path/...';\nGlideImage::create($image)\n    ->modify(['or' => '90'])\n    ->save($toBeAddedToTheMediaLibrary);\n$post->addMedia($toBeAddedToTheMediaLibrary)->toMediaLibrary('images');\n``\n. Travis doesn't seem to like this, what's the motivation behind the change?\n. We use the current implementation oforder_columnfor the same use case in our CMS. We have an uploader component that creates a json string, which we in turn use to update the media through the (undocumented)updateMedia` method.\nhttps://github.com/spatie/laravel-medialibrary/blob/master/src/HasMedia/HasMediaTrait.php#L187\n\nit needs to be one more then the highest existing order value for the model's media collection\n\nWhy does it need to be exactly one higher than the existing value? Say you have collection A and B:\n$media1 = Add media to collection A => order_column = 1\n$media2 = Add media to collection B => order_column = 2\n$media3 = Add media to collection A => order_column = 3\nCollection A doesn't have any media with order_column = 2, but that doesn't really matter since 1 and 3 will still sort correctly.\n. Our uploader component creates a json string with an array of media per single collection, e.g.:\njson\n\"media\": [\n  { \"id\": 2, ... },\n  { \"id\": 1, ... },\n  { \"id\": 3, ... }\n]\nThe string gets parsed by the server, and sets the order_column property based on the order of the media in the array, so now media 1 would have order_column: 2, media 2 order_column: 1 and media 3 order_column: 3.\nThe order column is generated by a simple local variable: https://github.com/spatie/laravel-medialibrary/blob/master/src/HasMedia/HasMediaTrait.php#L210\nIf you're interested in the JavaScript side of things, our uploader is also open sourced (it's a medium-sized Vue project): https://github.com/spatie-custom/blender-media\n. Correct\u2014If this is an issue in your app you'll need to write a more complex method to determine the order_column value.\n. In this case I'd create an application specific media model, add the HasMedia trait to it, and ensure that only one file is associated with it. That model can then be in a one/many-to-many relationship with your applications models.\nIt sounds slightly hacky, but I think it would keep this library's code\u2014and more importantly api\u2014way cleaner achieving the same result.\nInterested in hearing thoughts on what would be limiting / suboptimal about this solution.\n. toCollectionOnDisk doesn't get called automatically but should be called manually in your own application's code, e.g.:\nphp\n$newsItem->addMedia($request->file('image'))->toCollection('images');\n(toCollection calls toCollectionOnDisk under the hood)\n. The event's name is Spatie\\MediaLibrary\\Events\\MediaHasBeenAdded, that's probably causing this issue. Please let me know if the docs still have the old names somewhere!\n. There currently aren't any scopes provided by the package, we'd accept PR's that add some though, as long as they're not too specific.\n. Don't think there's a short way to do it. I'd replicate the model without the media, then loop over all the media and use the new instance's addMedia method to make sure the files are added correctly.\nQuick sketch, not sure if this will all work as-is:\n``` php\n$newProduct = $product->replicate(['media']);\n$newProduct->push();\n$product->media->each(function (Media $media) {\n    $newProduct->addMedia($media->getPath())\n        ->preservingOriginal()\n        ->withProperties($media->toArray())\n        ->toCollection($media->collection_name);\n});\n```\n. If you're keeping your media files inside the storage directory, you won't be able to serve them as-is. There are two options:\na) Move the disk to public_path\nb) Create a symlink in the public folder to storage/files\nHow exactly are you protecting your private files? Alternatively, you could create a regular route, e.g. /files/{name}, have your application catch it, and return the contents of the file if the currently logged in user has permission for it, that way you can keep all your authorization logic in your application.\n. Just realised that was what you're doing already, whoops!\nLooks good to me at first sight, could it be a header issue?\n. Re: the symlink part, I misunderstood your issue first so you can ignore that.\nI just created this route as a test and it works, so you're definitely on the right track. I'm on Valet though, not Homestead, but I'd be surprised if that was causing issues.\nphp\nRoute::get('/image', function () {\n    return response()->file(\\Spatie\\MediaLibrary\\Media::first()->getPath());\n});\nhtml\n<img src=\"/image\">\nAre you getting a response when you go straight to the url? And what do the response headers look like in Chrome's network inspector?\n. content-length seems to be missing, so I assume the server isn't sending the data through. connection: close seems odd, shouldn't that be keep-alive too? I don't really know enough about networking to provide any meaningful hints on the cause though.\n. > the plugin forces me to put the media directory (or link) in public root\nYou can store your media anywhere you want, however, if it's not in the public path you'll need to implement the retrieval of the media yourself by writing your own UrlGenerator class.\nSome resources:\n- This issue is on a similar setup: #244 \n- Writing your own UrlGenerator: https://docs.spatie.be/laravel-medialibrary/v4/advanced-usage/generating-custom-urls\n. I'm in favor of not changing anything here. I'm a strong believer in keeping types as normalised as possible (like not mixing strings, integers and null values unless necessary), and using null as sparsely as possible.\nNull should only be used if it provides a different meaning than the empty state of the value's type. In this context, an empty collection name has the same meaning as 'no collection', so there's no need to introduce another type (null) since the type we're using already provides a way to convey that meaning.\nLess redundant types, means more predictability, means a smaller chance to introduce subtle type errors.\nFurther reading on the topic: https://www.ibuildings.nl/blog/2016/01/programming-guidelines-php-developers-part-2-getting-rid-null\n. Finally, @jamesinglis, the error you're receiving shouldn't generally happen. Feel free to post a snippet of your code so I can check out why it's being thrown.\n. Could you post the exact error you're getting?\n. Hmm sorry but I'm not really sure why it's acting that way. I'm pretty sure this isn't an issue with this package though.\n\nDefault value for parameters with a class type hint can only be NULL\n\nThe error is thrown on this line: \nphp\npublic function getUrl(string $conversionName = '') : string\nstring is not a class type hint, but a scalar type hint.\n. Here's an example of what the array looks like in our applications: \nphp\n[\n  [\n    \"id\" => 247,\n    \"name\" => \"025e4912b552287a\",\n    \"file_name\" => \"025e4912b552287a.jpg\",\n    \"custom_properties\" => [],\n    \"order_column\" => 247,\n  ],\n  [\n    \"id\" => 248,\n    \"name\" => \"837dfeec04a78a1c\",\n    \"file_name\" => \"837dfeec04a78a1c.jpg\",\n    \"custom_properties\" => [],\n    \"order_column\" => 248,\n  ],\n  [\n    \"id\" => 249,\n    \"name\" => \"837dfeec04a78a1c\",\n    \"file_name\" => \"837dfeec04a78a1c.jpg\",\n    \"custom_properties\" => [],\n    \"order_column\" => 249,\n  ],\n]\n. Looks like there was a little bug in the package (case sensitivity issues with namespaces). I just pushed a fix, I'll tag a new version in a few minutes, after Travis has passed \ud83d\udc4d \n. v4.8.1 has been tagged and should fix the issue!\n. Thanks, added in v4.7.1!\nhttps://github.com/spatie/laravel-medialibrary/releases/tag/4.7.1\n. I don't think there's a right answer between the two, and in this case I prefer one-to-many over many-to-many because it vastly reduces complexity (not just the queries, but also when determining what file to delete, which conversions should be available etc.)\nIn a previous issue, I recommended creating an application-specific pivot model between the media item and your own models if you want n:m relations.\nhttps://github.com/spatie/laravel-medialibrary/issues/205\n. Hmm sorry, don't think I'll be able to give too many useful insights.\nI'd write some sort of migration script (either in bash or in php) that would move the media accordingly. Depending on the size of your media folder, it shouldn't take too long since moving files on a local file system goes relatively fast.\n. getMedia already performs a query for you so pagination isn't possible with that method. You'd have to query the relation yourself:\nphp\n$model->media()->where('collection_name', 'foobar')->paginate(20);\n. Your namespace seems to be incorrect in the example.\nphp\nnamespace Spatie\\MediaLibrary\\UrlGenerator;\nShould be:\nphp\nnamespace App;\n(assuming the url generator lives in the app folder)\n. This seems to be related to upgrading Laravel 5.3, not this package.\nCheck out the \"Jobs Table\" section in \"Upgrading To 5.3.0 to 5.2\".\nhttps://laravel.com/docs/master/upgrade#upgrade-5.3.0\n. Hmm I don't really agree that this is the way to go. If the model would be nullable, you'd end up with a lot of useless media files that need to get cleaned up manually.\nIn our projects we handle this issue the other way around, by adding a 'draft' status to the project, so we're always dealing with an existing model.\n. Yeah, and we do a cleanup of draft models older than a certain amount of time with a scheduled command.\nThe main advantage of using draft models instead of allowing media that isn't attached to a model is that draft models work for any relationship you want to attach to the model, so you don't have to modify any other code.\n. The package doesn't provide anything specific here, but you could build your own query using the Eloquent query builder:\nphp\n$modelWithMedia->media()\n    ->where('collection', 'myCollection')\n    ->orderBy('created_at')\n    ->get();\n. How exactly are you trying to retrieve the url from the media item?. Since getUrl is a method\u2014not a property\u2014on the Media model, it won't automatically be appended when serializing the media model to json.\nTo solve this issue, you could either:\n\nUse an external package to handle your model serialization (which is what I'd recommend)\nExtend the Media model, and add the url to $appends\n\nExample of an extended Media model:\n```php\n// config/laravel-medialibrary.php\nreturn [\n    'media_model' => App\\Media::class,\n];\n```\n```php\n// app/Media.php\nnamespace App;\nuse Spatie\\MediaLibrary\\Media as BaseMedia;\nclass Media extends BaseMedia\n{\n    protected $appends = ['url'];\npublic function getUrlAttribute(): string\n{\n    return $this->getUrl();\n}\n\n}\n```\nIf you're interested in more advanced model serialization, check out our laravel-fractal package: https://github.com/spatie/laravel-fractal. > In MySQL filename saved without extension.\nI think this is where the issue's at. Could you post the data from the database row?\nThe extension is derived from the UploadedFile's originalName, which seems to check out (it doesn't matter that extension is empty there), so not sure why the extension wouldn't be present in the database.. File names MUST have an extension for this to work. Are you trimming the extensions yourself, or are they never coming through?. > Possibility to use the same media multiple amounts of time but with only one upload/conversion.\nIs now the time to look into removing the 1:n relationship in favor of an n:m?. One more thing. I disagree with this line:\nhttps://github.com/spatie/laravel-medialibrary/blob/master/src/Conversion/ConversionCollection.php#L74\nI'd expect it to be okay for me to conditionally add conversions to models since it's an instance method, and not a static method.. Please take a look at the upgrade guide. Version 5 requires a mime_type column in the table.\nhttps://github.com/spatie/laravel-medialibrary/blob/master/UPGRADING.md#from-v4-to-v5. Sorry, we don't provide a migration tool for this. Mime types aren't required though, so you can just keep the field empty for your old media.. In case you would want mime types anyway, here's a comprehensive of which type you need for what file type: https://www.sitepoint.com/mime-types-complete-list/. Yeah PHP doesn't seem to complain about that. https://3v4l.org/VZAog\nIf we'd go for a different method, clearMediaCollectionExcept sounds better since we already use the term preserving for \"don't delete the files\".. > Should the CollectionHasBeenCleared event still be fired if the collection was only partly cleared?\nMy gut feeling says no /cc @freekmurze \n\nAlso; doesn't the removeMediaItemsNotPresentInArray method do exactly what the issue describes?\n\nThis method is protected and tailored for updateMedia, which updates media based on a raw array, not an array of media items.\nSounds like clearMediaCollectionExcept is the way to go!. What version of this package are you using?. I assume you're using Laravel 5.3, which isn't compatible with this package at that version. Is upgrading to laravel-medialibrary v4 an option?. PHP7 is required for v4. We don't support v3 anymore since it's already two major versions old. It was never built with Laravel 5.3 in mind so I can't say what will and won't work. I'd recommend forking this repository or copying it into your project if you're stuck with a combination of PHP5 and Laravel 5.3+.\nThe issue at hand is that keys and values have been swapped in the closures of some collection methods. Here's the line that breaks in your sample:\nhttps://github.com/spatie/laravel-medialibrary/blob/v3/src/Conversion/ConversionCollection.php#L41. This is necessary at some point, but it's a breaking change so I'm afraid we can't pull this in yet :/. It would break the package for users that have published the config file and set a different value for defaultFilesystem. Their's would be ignored since we'd be using a different key.. We're already using mergeConfigFrom here. https://github.com/spatie/laravel-medialibrary/blob/master/src/MediaLibraryServiceProvider.php#L39\nAs for loadMigrationsFrom, we're not using it deliberately because users wouldn't be able to publish and edit the migration file.. Is media under disks in your config? What's the result when you run config('filesystems.disks.media.root')?. Thanks!. Could you share a snippet of the code you're working with?. Looks like it still had the old name. Updated the readme.. It should, what does your code look like?. It's been a while, but I think we opted to not use the sortable package because it would give issues when we want to bump a major version, and people (like us) are using both packages in their apps.. I'd love to pull this, but unfortunately it's a breaking change which we won't be able to introduce until the next major version.\nWe'll revisit this when we work on v6.. There was a bug regarding adding multiple media, it should be fixed in version 5.12.1.\nThis syntax should do the trick:\nphp\n$model->addMultipleMediaFromRequest([\"images\"])\n    ->each(function ($fileAdder) {\n        $fileAdder->toMediaCollection();\n    });\nI think you could use Collection's higher order methods too...\nphp\n$model->addMultipleMediaFromRequest([\"images\"])->each->toMediaCollection();. You could add a with call to your query.\nBlog::with('media')->where('active', 1)->paginate(5). You wouldn't want to do this either, since the optimizer might be able to do a better job with the converted image than the original. For example, if you're converting an image to jpeg, GD or Imagick will generate a new jpeg, full of cruft that can probably be optimized. The initial optimization will have been in vain. Optimization should happen as late as possible.. Hmm is the service provider registered correctly?\nMaybe add a dd here and see if it passes throught. This is the line that ensures that the Filesystem can be instantiated.\nhttps://github.com/spatie/laravel-medialibrary/blob/a3cdd12c96677bdfad3df1d1125bbfeb0f3f6863/src/MediaLibraryServiceProvider.php#L51. Thanks :D. Thanks!. The current model gets passed to the registerMediaConversions method.\npublic function registerMediaConversion(Media $media)\n{\n    if ($media->something) {\n        // ...\n    }\n}\nYou can do whatever you want there then. . Oh sorry, missed the version number. I'm afraid that isn't supported yet in older versions of the library :/\nIf diskspace isn't an issue, I'd recommend generating two separate conversions.... Hmm I don't think so. Might be nice to have though, what do you think @freekmurze? (or is it already possible?). Little idea: add the concept of a \"single-file\" collection that replaces the current media if there's already something uploaded for that model.. Looks like the slashes / double slashes differ, not sure why?. We're using MySQL with the local storage driver.. Use case: A thumbnail conversion for a collection containing different file types. This conversion would exist for a pdf file, but wouldn't for an xls file.. Laravel uses the app.url config value to generate urls. You probably need to specify APP_URL in your .env file.. When you Tinker/dump config('app.url'), what's the result?. This might be related to the way your storage is configured, but you'd need to dive into the LocalUrlGenerator class to find out what's missing.\nDid you try fullUrl as previously suggested? It's a public method on Media, I'd suggest doing that if you need a full path.\nhttps://github.com/spatie/laravel-medialibrary/blob/v7/src/Models/Media.php#L45-L51. hi @eichgi,\nNot sure what's going on here. You'll need to add some debug statements to see where it's going wrong.\nHere's a good place to get started, it's where we retrieve the disk's base url: https://github.com/spatie/laravel-medialibrary/blob/7e457f86b98943680dcea8ccb4a6e24c1de54739/src/UrlGenerator/LocalUrlGenerator.php#L49. We don't have any experience with encrypted files in the media library. Maybe the community has some answers.\nWhat @fridzema suggested would work for storage, but not sure about the retrieval part.. I assume Laravel's toHtml method, which is used by Blade to render the HTML isn't respected by the Twig package. I'd suggest calling img method which is used under the hood directly.\nhttps://github.com/spatie/laravel-medialibrary/blob/c85726e022316ecd20e63d045a4fabe3e8a7fb2f/src/Models/Media.php#L259-L262\nWould this solve your issue?. Anything public on Media won't break in a minor version, so no worries there :). Sounds like a solid request! Feel free to send a PR that implements this. \nThe fallback should be some sort of Media null object, could be tricky to pull through but we'll see what it looks like when implemented.. Maybe we should stick with URL's and paths instead of actual default media.\nphp\n$this\n    ->addMediaCollection('image')\n    ->defaultUrl('/url/to/image.jpg')\n    ->defaultPath('/path/to/image.jpg');\nI don't know, we could return a dummy Media object but that sounds complicated. Pinging @freekmurze \nI'd rather not add to the public API for this, if you're setting a default, it should be used in the existing methods.. Eloquent has a has method for this: https://laravel.com/docs/5.6/eloquent-relationships#querying-relationship-existence\nphp\npublic function scopeMedia($query)\n{\n    return $query->has('media');\n}. Note: Close https://github.com/spatie/docs.spatie.be/pull/288#issuecomment-381091546 when this is merged.. That's a long time ago, pinging @brendt or @freekmurze to see if we still want this. We generally use Laravel API resources to transform a model to the representation needed on the front end.\nhttps://laravel.com/docs/5.6/eloquent-resources\nSo kind of similar to your approach, just structured in a different way :)\nHope this helps!. Nevermind, the model is configurable. Does your user model implement the Spatie\\MediaLibrary\\HasMedia\\HasMedia interface?. Support will be added when Laravel 5.7 is released. We don't expect any / too many breaking changes.. Laravel 5.7 has already been supported for a while :) https://github.com/spatie/laravel-medialibrary/releases/tag/7.4.1. In edge cases where delete would return false, you'd now have a model with deletePreservingMedia true, even if you set it false before. Feels slightly off to me, but I don't know if I prefer this or added complexity in this method by keeping the old value. Pinging @freekmurze for this one.\n. This line could be replaced by $this->delete() now\n. This one isn't necessary\n. Will this clash with the 5.3 changes?\n. Rename to requirementsAreInstalled?\n. Add abstract methods for whatever gets used internally? E.g. supportedExtensions, supportedExtensions,...\n. CS: no space before : (StyleCI might/should handle this though)\n. I'd opt for plain arrays here since they're less noisy\n. L5.3 blues\n. Redundant?\n. The full namespace should be imported here, not the alias\n. Not aware of all the context, but can't we make addMediaFromRequest variadic and allow it to accept arrays instead? Or not allowed for semver?. Didn't notice the return type was different, so yeah makes sense to have a different method. And it would indeed be a breaking change since we'd have to change the signature.. ",
    "gabarba": "Thanks for the reply, I may fork your code and fiddle around with it in detail later. Right now I'm pretty much doing the same thing except instead of storing file paths i'm storing url for pretty much everything. It works but gets a little bit more complex when I start dealing with images in particular when I need to cache the image and generate and new url based on the cached size requested. The other problem I foresee in the future is not if but when I need to change the storage structure/path of locally stored files it becomes a pain to handle this. I like the concept of profiles to get different return types I may try to apply it to this package and say have a profile for urls to instead of doing some sort of transform I could just directly use the url that is stored.\n. ",
    "coding-sunshine": "I don't want to convert files still I have to add a blank registerMediaConversions function to the model.\nany solution.\n. thanks very much :)\n. Thanks, will submit a PR soon.\n. ",
    "cviebrock": "+1 on this.  Something like this would be nice to have:\nphp\n$model->addMediaFromUrl($remoteUrl)->toMediaLibrary();\n. I too would like to see some way to extract the subdirectory name generation out into one (overwriteable) method.  The default way of using just the ID of the Media object is okay, but (as was mentioned above) will get unwieldy when you have thousands and thousands of images.\nAlso, in our case, we'd like to obfuscate the path a bit so that those primary keys aren't visible, using some hashing algorithm or something.\nMaybe a method on the Media object itself that handles path generation?  That way it's easily extendable by just specifying your own Media object:\n``` php\n// Spatie/MediaLibrary/Media.php\nclass Media extends Model {\n    ....\n    public function getMediaPath() {\n        return $this->getKey();\n    }\n}\n// App/Media.php\nclass Media extends Spatie\\MediaLibrary\\Media {\n    ....\n    public function getMediaPath() {\n        return some_hashing_function( $this->getKey() );\n    }\n}\n```\nAnd \\Spatie\\MediaLibrary\\Filesystem::getMediaDirectory and \\Spatie\\MediaLibrary\\UrlGenerator\\BaseUrlGenerator::getPathRelativeToRoot would both reference that method instead of hard-coding the ID.\nDoes that make sense?\n. I think the PR I have in #97 above is a bit better than my original idea above for adding methods on the model.  It uses a PathGenerator class to do the work of coming up with unique path names, and those are used both for storage of files and for URL generation.\n. I was hoping not to extend the model (mostly to keep things simple).  What about adding a package-specific event, e.g.:\nphp\n$this->fireModelEvent('media.stored', false);\nafter the file is added?  Then I can hook into that event in my own code.\n. MediaHasBeenDeleted(mediaId) could just be handled using the built-in eloquent.deleted event on the Media model, I'd think.  But I have a PR almost ready for the other events ... as soon as I can figure out how to write tests for them.  :)\n. Hrm ... the Travis failures don't seem to have to do with failed tests.  They seem to be issues with composer not loading some packages, or the autoloader not being able to find files ...?\n. Another option would be to rename delete() to deleteIncludingMedia() or something, so that you have the explicit option of doing either.\n. In my opinion, the user should explicitly state what happens to attached media when a model is deleted ... which is why I was pushing for the configuration option.  I agree, though, that it makes things more bit complicated.\nThe deletePreservingMedia() method -- which I submitted a PR for -- is my second choice.  Only because it forces users to (possibly) choose between two different method calls in several places in their code.  To me, it would be cleaner to just call $model->delete() and (similar to soft deleting) just know that It Will Work\u2122.\n(I suppose another option, although again a breaking change, would be two new traits which can be applied to models: DeletesMediaOnDelete and PreservesMediaOnDelete.)\nI sort of get what you mean with the event, but the listener would be tied to the Eloquent model, not the Media model ... so I was a little confused about how best to set that up.\nSo .. hopefully my PR gives us both what we need. :)\n. I, and my project, thank you.  ;)\n. I'll probably have a PR for you tomorrow. However, I was going to suggest checking the extension first, since it doesn't need to touch the file system to do so. If it can't figure it out by extension (or maybe, more appropriately, if it doesn't have an extension) then it would try to check the MIME type by actually looking at the file.\nMake sense?\n. :bow: \n. Thanks @freekmurze.\nAny reason why something like this (for moving) wouldn't work?\n```php\n// the initial post and image\n$post = Post::find(1);\n$image = $post\n    ->addMedia($pathToFile)\n    ->toMediaCollection();\n// move the image to another post\n$post2 = Post::find(2);\n$image->model()->associate($post2);\n$image->save();\n``. I think you forgot to do this for v7.spatie/pdf-to-image` is still listed as a requirement, not a suggestion. \u2639\ufe0f . Maybe re-open this so you don't forget for v8? ;). ",
    "juanvillegas": "very very small contribution ha!\nOn 15 July 2015 at 12:35, Freek Van der Herten notifications@github.com\nwrote:\n\nThanks!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/pull/21#issuecomment-121654230\n.\n. \n",
    "folkevil": "Thank for your reply. i think i will port a 4.2 version of this package if you agree.\n. ",
    "ziming": "Hi,\nThanks for the response.\nI pretty like the part about the package randomly generating a file name. However I just want to retain the file extension.\nAlso hmm...are there any tips for putting and using it in storage folder? The files are supposed to only be accessible by the users allowed to it, not everyone. Currently I store them in the public folder though.\n. Ah I see, I will research on how to do that (custom url generator, and controller to link to storage folder). Yea I guess it was the temporary name of the upload, every file starts with the name php.\nThank you.\n. Hi @freekmurze I tried to write my own UrlGenerator and I run into a particular issue.\nMy getUrl function is something like this\npublic function getUrl()\n    {\n        return action('MediaController@show', $this->id); // get the media and initiate downloads\n    }\nWell $this->id didn't work and I'm wondering if you know how could I get the id to pass on to the controller if you happen to do something similar before.\n. Thank you.\n. Not in a hurry, thank you. Though if I do make a pull request, what do you like the method to be named?\n. Thanks. I thought it was already released :O\n. Hi @alexglue \nThe way I currently handle it is this\n// I can't find a rename method on UploadedFile class hence I used the move method to move on the \n// same directory while providing a new filename, then I add the media to the object.\n$file = $file->move('.', $file->getClientOriginalName());\n$object->addMedia($file);\nHope it helps for the moment!\n. Hi @freekmurze from my own attempt earlier doing that changes the name at the database row, but not the actual file name of the document.\n. That got me stuck for a little long previously hah. Thank you.\n. Do you mean ConversionCompleteEvent instead? @freekmurze \n. Hmm I tried force delete with the model cleanup package. But the files in S3 remains although the soft deleted record is force deleted. ",
    "brunogaspar": "Thank you :+1: \n. https://github.com/spatie/laravel-medialibrary#avoiding-an-empty-registration-function\n. Can't you use the media() relation for that?\n. It's Eloquent, if you know how Eloquent works you can do pretty much everything you want.\nphp\n$media = Collection::find(1)->media()->where('collection_name', 'default')->paginate();\nYou write a little more, yes, but it's way more flexible than using the getMedia() method.\nIt would be nice if we had a few query scopes defined on the Media model, so we could use stuff like ->onCollection(:collection-name-here).\nBut it is what it is.\n. ",
    "vedmant": "Thank you for your answer! I will try dummy model.\n. I'm for this feature as well! \nAlso it may be greate to split it into subfolders to make not more than 10000 subfolders in one folder. What I mean is something like\n      $dir = floor($id / 10000);\n      $path = $path.'/'.$dir;\nso the actual path will be like \"media/0/120/filename.jpg\" and if id is between 10000 and 19999 it will be \"media/1/12000/filename.jpg\".\nThe reason is that some filesystems slow down significantly where there are a lot of items in one folder, for example ext2 has performance issues after 10000 files in one folder.\n. It would be great to have some callback for model that generates any needed save path. In this case it may not need any change to database. Something like public function getMediaSavePath($media, $collection) for hasMedia interface and trait. So this callback will be used for saving file, getting url and path, removing file. \n. @canvural Why in one place, this callback will return any path you need, if you need for example to save some exact model with some exact collection you can just return this: return 'my_model_folder/'.$collection.'/'.$media->id; or use date folder like return 'my_model_folder/'.date('Y-m').'/'.$media->id;, so on, I suppose this package have to check if folder exists and create it.\n. Sorry, I don't have time now to dive into the code, from what I see it will be good to pass to getDirectory() media model item, also I think it doesn't need to cache directory, you can call function each time directory have to be got. Also it looks like you have to edit only one function: public function getMediaDirectory(Media $media) in src/Filesystem.php all other functions use it, just instead of $directory = $media->id; type $directory = $media->model->getMediaDirectory($media); and I think that's all is needed, also in hasMediaTrait make function getMediaDirectory($media) return $media->id by default.\n. Thanks, yeah I can utilize MediaHasBeenAdded and ConversionHasBeenCompleted events and add dimensions to custom properties, but I was thinking that it's something that good to have out of the box, most of media files have dimensions, all images and videos.. Is there any official docs how to do this correctly?. ",
    "PeterDeHaberkorn": "sorry, what I meant is that the currently mediafiles stores on a random location \n\" / media / { $id } / file\"\nbut what I would like to see is the option to set a fixed folder like:\nmedia/{Customer}/{year}/{filetype}\nwith this function from the model:\npublic function addMedia($file, $collectionName = 'default', $removeOriginal = true, $addAsTemporary = false, $subDirectory = '')\n. No. That was not my intention\nMy intention was to have a better overview and not for every file and his conversions a folder \n. ",
    "pamo85": "same issue when I bulkinsert many new images.\n. on my testsystem I only have jpegs. but on prod I will proceed all kind of images.\nthat's my conersion settings:\n```\n    $this->addMediaConversion('thumb')\n        ->setManipulations(['w' => 158, 'h' => 158, 'fit' => 'crop'])\n        ->performOnCollections('images');\n$this->addMediaConversion('thumb@2x')\n    ->setManipulations(['w' => 312, 'h' => 312, 'fit' => 'crop'])\n    ->performOnCollections('images');\n\n$this->addMediaConversion('header')\n    ->setManipulations(['w' => 400, 'h' => 800, 'fit' => 'crop'])\n    ->performOnCollections('images');\n\n$this->addMediaConversion('header@2x')\n    ->setManipulations(['w' => 800, 'h' => 1600, 'fit' => 'crop'])\n    ->performOnCollections('images');\n\n$this->addMediaConversion('square')\n    ->setManipulations(['w' => 800, 'h' => 800, 'fit' => 'crop'])\n    ->performOnCollections('images');\n\n$this->addMediaConversion('square@2x')\n    ->setManipulations(['w' => 1600, 'h' => 1600, 'fit' => 'crop'])\n    ->performOnCollections('images');\n\n```\nbut I don't think the type of images is a problem.\nI think it's in laravel-medialibrary/src/FileManipulator.php\n/**\n * Perform the conversion.\n *\n * @param \\Spatie\\MediaLibrary\\Media $media\n * @param Conversion                 $conversion\n * @param string                     $copiedOriginalFile\n *\n * @return string\n */\npublic function performConversion(Media $media, Conversion $conversion, $copiedOriginalFile)\n{\n    $conversionTempFile = pathinfo($copiedOriginalFile, PATHINFO_DIRNAME).'/'.string()->random(16).\n        $conversion->getName().'.'.$media->extension;\n    File::copy($copiedOriginalFile, $conversionTempFile);\n    foreach ($conversion->getManipulations() as $manipulation) {\n        (new GlideImage())\n            ->load($conversionTempFile, $manipulation)\n            ->useAbsoluteSourceFilePath()\n            ->save($conversionTempFile);\n    }\n    return $conversionTempFile;\n}\nIn this part you do conversions. It allocates memory for the GlideImage object but it never releases memory. usually it's not a problem because memory will released after script ends. but in case of bulkinserts or on regenerate you may have hundrets of images and they'll allocate a lot of memory before script ends.\nI think we should release memory after ->save(). I'll try something later today. I think there should be a solution in glide or with unset() in native php.\n. yes i tested it. it solves memory leak from ram allocated by image object in glide. there's still a memory leak left somewhere. but regenerating 300 images only leaks about 10mb instead of 3gb memory.\n. i tried it. calling the gc does the job. even better than my solution.\n. ",
    "mahony0": "I'm using v4.* and similar issue is still persist for me. My model has conversions:\n``` php\npublic function registerMediaConversions()\n    {\n        $this->addMediaConversion('default')\n            ->setManipulations([\n                'w' => 82, 'h' => 82,\n                'fit' => 'contain',\n                'q' => '90'\n            ])\n            ->performOnCollections('officelogo');\n    $this->addMediaConversion('default')\n        ->setManipulations([\n            'w' => 1140, 'h' => 318,\n            'fit' => 'contain',\n            'q' => '90'\n        ])\n        ->performOnCollections('officebanner');\n}\n\n```\nI changed memory limit temporarily to 128MB and when i run command medialibrary:regenerate Model, it gives me following error after 3rd conversion:\n\nMedia 1 regenerated\nMedia 2 regenerated\nMedia 6 regenerated\n[Symfony\\Component\\Debug\\Exception\\FatalErrorException]\nAllowed memory size of 134217728 bytes exhausted (tried to allocate 20480 bytes)\n\nWhat I should to do about this?\n. I have tested this on our production server which has enough space for swap and memory (32gb)\nIt seems we are getting problem with GD:\n\n[2016-05-25 08:52:57] production.ERROR: Symfony\\Component\\Debug\\Exception\\FatalErrorException: Allowed memory size of 134217728 bytes exhausted (tried to allocate 8192 bytes) in /PATH/vendor/intervention/image/src/Intervention/Image/Gd/Decoder.php:32\n. btw, next image after getting error is a little big like 5000x4000 and 900kb. Maybe it's the problem for conversions?\n. Sure, thanks for help. I made it with\n\nphp\n$media->getDiskDriverName()\nin my CustomPathGenerator\n. ",
    "t0n1zz": "hello i just now get this error too\nAllowed memory size of 134217728 bytes exhausted (tried to allocate 56819713 bytes)\njust running it on laravel valet with default configuration.\nand i enabled withResponsiveImages and also add this into my model\npublic function registerMediaCollections()\n    {\n        $this->addMediaCollection('admin_foto')\n            ->singleFile()\n            ->registerMediaConversions(function(Media $media){\n                $this->addMediaConversion('thumb')\n                    ->width(50)\n                    ->height(50);\n            });\n    }\ni tried to upload images taken from my iphone 5c with total size 1.2mb... any idea why? i am not testing it on production server yet since the overall development not done yet... ",
    "VictorOtavio": "This solved my issue. Thanks.\n. ",
    "spawn-guy": "I will use this package with MongoDB today.\nSo far, from looking through the code of it i don't like the 2 mongo-specific things:\n- $casts to Array - is not needed for this db, as i'd prefer to save manipulations/etc as json-object, and not json-serialized string.\n- provided migration doesn't have any indexes. \"Moloquent\" ignores the fields, but respects Indexes. As only \"indexes\" exist in schema-less db. (migration went fine, btw. i see a collection, but no indexes, as expected)\n. For now i need to override the Media model with different Model class, Jenssegers\\Mongodb\\Model not the Illuminate one. I get Grammar errors (this is covered in docs of laravel-mongo)\nalso PK is _id not id. \ni'll keep posting the results.\n. okay, i need help.\ni'm lost trying to override the model with another model... euh, Models\nwhat i want to do is\n$app->when(Spatie\\MediaLibrary\\Media::class)->needs(Illuminate\\Database\\Eloquent\\Model::class)->give(Jenssegers\\Mongodb\\Model::class);\nbut this doesn't work.\n$app->when(Spatie\\MediaLibrary\\MediaRepository::class)->needs(Spatie\\MediaLibrary\\Media::class)->give(App\\Media::class);\nthis does work, but. it is still derived from Illuminate\\Model. if i copy the whole model contents (even leaving Illuminate\\Model) - typeHinting breaks with\nArgument 1 passed to Spatie\\MediaLibrary\\MediaRepository::__construct() must be an instance of Spatie\\MediaLibrary\\Media, instance of App\\Media given\nany suggestions?\n. i've got one level Up(not deeper) and trying to inject a Repository, that will use a proper model.\nbut now, everything is type-hinted,.. so to just change MediaModel to be MongoMediaModel i need to overwrite, like, everything.. which is not that good :/\ni suppose a better approach would be a MediaModelInterface, that will be type-hinted everywhere in the package.\nand then i'd just need to \n- create a MediaModel extend Mongodb\\Model implement MediaModelInterface\n- $app->singleton(MediaModelInterface, App\\Media)... or something\ni guess it could be done like that.\nbut due to lack of development time - i think i will not do that, at least for now. and will go a simplistic way with directly using filesystem\nalso i've noticed several $model->id usages which will definitely break with monogdb._id. but one can use Eloquent's ->getKeyName() which will give you a proper primary key name.\n. ",
    "vesper8": "I know it's been 2 years but @spawn-guy did you have any luck ever getting this to work?\nI want to assign media to a mongo model as well and running into problems. I managed to get it to work. Here's what did it:\nFirst, in CreateMediaTable migration\nreplace\n$table->morphs('model');\nby\n$table->string('model_id');\n$table->string('model_type');\n$table->index([\"model_id\", \"model_type\"], null);\nThen prepare your MongoDb model like normally.. implements HasMedia and add HasMediaTrait\nAnd that's pretty much it! Except.. I was having this suuuuper annoying problem which took me 2 hours to figure out but in the end the fix was so simple. I kept getting a PDO error.. what fixed it was adding\nprotected $connection = 'mysql';\nTo the Spatie\\MediaLibrary\\Media model.\nI guess, without this specification it would try to look for the Media on mongodb?. @nicolasbeauvais \ndid the behaviour change? I just tried your solution and it did not prevent my media db rows from being deleted even though I added the code you posted to my App\\User model.\nAfter softDeleting the user both the images as well as the db row were removed\nDo you have another workaround that works with latest version by any chance?. I am also really hurting to find a workaround to prevent deletion of media rows (and the media itself) when a model is softDeleted. I know you have added logic to preserve the media itself. But I want to be able to restore the media entirely. Anyone got a workaround?. After some fiddling I found the json query that works:\n$post->media[0]->setCustomProperty('invalid', true);\n            $post->media[0]->save();\nand then to exclude posts that are marked as invalid \n$posts = Post::whereHas('media', function ($query) {\n                $query->whereRaw(\n                    '!(custom_properties != \"[]\" AND json_extract(`custom_properties`, \"$[0].invalid\") = true)'\n                );\n            })\n            ->get();\nI haven't tested it yet when mixed with other custom properties, might need a bit of fiddling at the $[0] part\n@freekmurze I think this would make a very nice addition to the list of customProperty commands.. I found it very difficult to use custom_properties as a means of adding a boolean flag to replace adding a column \"invalid\" and then having an easy eloquent means of filtering. would be nice to add a \"usingDate\" instead of this rather hacky proposal. I'm using Server version: 10.2.5-MariaDB Homebrew and was also getting this problem. I thought MariaDB 10.2.x supported json types.. guess not!\nChanged to text type instead.. hope it doesn't break anything. I am also really hurting to find a workaround to prevent deletion of media rows (and the media itself) when a model is softDeleted. I know you have added logic to preserve the media itself. But I want to be able to restore the media entirely. Anyone got a workaround?. I began running into trouble with the /tmp folder not being writable using this method... the resizing seems to work well if it's done on an image that's already been added to the library but not so much if trying to perform the resize on the image that's just been uploaded.\nso instead I refactored the code to make use of the MediaHasBeenAdded event\nEventServiceProvider:\n```\n        'Spatie\\MediaLibrary\\Events\\MediaHasBeenAdded' => [\n            'App\\Listeners\\PictureResizer',\n        ],\n```\nPictureResizer:\n```\n<?php\nnamespace App\\Listeners;\nuse Spatie\\MediaLibrary\\Events\\MediaHasBeenAdded;\nclass PictureResizer\n{\n    /*\n     * @param \\Spatie\\MediaLibrary\\Events\\MediaHasBeenAdded $event\n     /\n    public function handle(MediaHasBeenAdded $event)\n    {\n        $media = $event->media;\n    $image = $media->getPath();\n\n    list($width, $height) = getimagesize($image);\n\n    $minimumWidthOrHeight = 300;\n\n    //\\Log::debug(\"checking image... {$image} {$width}x{$height}\");\n\n    /* resize image if both height and width are smaller than 300 */\n    if ($width < $minimumWidthOrHeight && $height < $minimumWidthOrHeight) {\n\n        \\Log::debug(\"resizing image... {$image}\");\n\n        if ($width >= $height) {\n            \\Spatie\\Image\\Image::load($image)\n                ->width($minimumWidthOrHeight)\n                ->save($image);\n        } else {\n            \\Spatie\\Image\\Image::load($image)\n                ->height($minimumWidthOrHeight)\n                ->save($image);\n        }\n    }\n}\n\n}\n```. I was just having the same problem. My uploads are local and I was trying to delete the media by its id directly\nthe following would delete the database row in the media table, but leave all of the uploads themselves, conversions and all, untouched\n$media = Media::find($request->input('id'));\n$media->delete();\nafter searching for the answer, I found that the only way to get the files deleted is to issue the delete command via the associated model. Since all I had was a media ID however I had to do a bit of reverse work\n$media = Media::find($request->input('id'));\n$model = Model::find($media->model_id);\n$model->deleteMedia($media->id);\nThis deletes the database record as well as all the files/conversions and media-folder. there are quite many to choose from.. i can't remember why I picked this one but I've been using it and it works well enough https://github.com/softon/laravel-face-detect. I have a conversion named 'optimized' and what I'm doing now is I'm piggy-backing off of it like so\n```\nclass FaceDetector\n{\n    use QueueOutput;\n/**\n * @param \\Spatie\\MediaLibrary\\Events\\MediaHasBeenAdded $event\n */\npublic function handle(ConversionHasBeenCompleted $event)\n{\n    $media = $event->media;\n    $conversion = $event->conversion;\n\n    if ($conversion->getName() == \"optimized\") {\n        dispatch(new \\App\\Jobs\\DetectFace($media));\n    }\n}\n\n}\n```\nUnfortunately it doesn't allow me to do $media->getMedia('face') so it's not perfect..\nI got confused about your proposed solution. First, I'm confused about the purpose of writing manipulations in the database as described in the docs here\n```\n// Add a width filter to the 'thumb' manipulations\n$mediaItems = $newsItem->getMedia('images');\n$mediaItems[0]->manipulations = ['thumb' => [ 'width' => '10']];\n// This will cause the thumb conversion to be regenerated\n$mediaItems[0]->save();\n```\nI define all my conversions in my model.. is it just a matter of preference?\nSecond, I'm confused how to define a \"dummy\" conversion that doesn't actually have any manipulations.\nAs it stands.. by piggybacking off of another conversion, my folders all have a face.jpg in them. But now I would like to be able to do $media->getPath('face'). But as understand in order for that to work I'd need a dummy conversion named 'face' in my model. How can I add that?. hehe sorry if this is so obvious.. but i want to keep my optimized conversion! I use it\n$this->addMediaConversion('optimized')\n            ->fit(Manipulations::FIT_MAX, 1000, 1000)\n            ->queued();\nbut what I think you're proposing is that.. I create another conversion identical to the 'optimized' conversion, and call it 'face'.. and piggy back off of that one? and then what? allow for the normal conversion to create the file 'face.jpg', and THEN execute my face detection with the ConversionHasBeenCompleted.. and.. replace the file.jpg with the results of the face detection?\ndo you see what I'm not understanding? this seems redundant\nI would prefer a scenario where I don't have to do a \"fake conversion\". @AlexVanderbist \nI just found this in the docs https://docs.spatie.be/laravel-medialibrary/v6/converting-other-file-types/creating-a-custom-image-generator#creating-a-custom-image-generator\nCouldn't I use this instead?. I got around it by caching the related model just before issuing the forceDelete(). With this, the files get deleted and the error is avoided\n```\n    public function getPath(Media $media): string\n    {\n        $submission = Submission::find($media->model_id);\n    if (!$submission) {\n        $cacheKey = \"submission.{$media->model_id}\";\n        if (\\Cache::has($cacheKey)) {\n            $submission = \\Cache::get($cacheKey);\n        }\n    }\n\n    $fileFolder = md5($media->id);\n    $path = \"{$submission->game->slug}/{$submission->id}/{$fileFolder}/\";\n    return $path;\n}\n\n```\nbut this is definitely a bug\nI also noticed that the top containing folder is left behind undeleted (the part identified by {$submission->game->slug} above). it's safe to assume that when deleting a model you would want to delete any associated files. However I agree that this shouldn't be the responsibility of this package. You're right, and I'm going to add my own deletion for the top-level folder\nmuch thanks for the quick PR!. this would be great!\nside note.. can you currently pass a or many conversion names to this command? say you just added a new conversion and only want to generate that one.. is that currently possible?. This is useful but since you're deep in it I think it would have been nice to also have a --only flag where you can pass a conversion name so it runs it (or re-runs it) whether the file is missing or not.\nYour use-case is good when adding a NEW conversion that you want to run and don't want to re-run all others.\nHowever what if you make a modification to a conversion? Then you have the same problem and the --only-missing won't address it. There could be a --only-changed but that would be very difficult or impossible to implement\nSo being able to specify only the name of the new/changed conversion and only run that one would be a very useful option\nThoughts?. I was in a rush to get this working.. not sure if this code can help you @davidianbonner at all but I'm using it to regenerate only specific conversions\nI also noticed some seemingly dead bodies $erroredMediaIds and {--ids=*}\nThe Conversion class has some methods to filter out conversions but none of them allow to filter by name\n```\n            $this->arguments[\"conversion\"] = \"yourConversionName\"\n        $mediaFiles->each(function (Media $media) {\n            try {\n                $profileCollection = ConversionCollection::createForMedia($media);\n\n                $conversions = $profileCollection->getConversions($media->collection_name);\n\n                for ($i = 0; $i < count($conversions); $i++) {\n                    if($conversions[$i]->getName() != $this->arguments[\"conversion\"]) {\n                        unset($conversions[$i]);\n                    }\n                }\n\n                $this->fileManipulator->performConversions(\n                    $conversions,\n                    $media\n                );\n            } catch (Exception $exception) {\n                $this->errorMessages[$media->id] = $exception->getMessage();\n            }\n        });\n\n```\n. It would be very nice if it was possible to convert images with custom shapes.\nFor example if I want to do a square crop but then I want it to be a png of a circle shape inside the square. ",
    "tolgaCTRLF5": "@vesper8 I used your first step. But I kept getting PDO error. Adding below code did not help me,\nprotected $connection = 'mysql';\nIf anyone gets PDO error while saving a media library image you can try but if the source file gets updated you may come across with other problems:\n1) The composer.json after a fresh install has a part that looks exactly like this\n...\n\"psr-4\": {\n    \"App\\\\\": \"app/\"\n}\n...\nJust change it to this\n...\n\"psr-4\": {\n    \"App\\\\\": \"app/\",\n    \"Spatie\\\\MediaLibrary\\\\\": \"fixes/Spatie/MediaLibrary/\"\n}\n...\n2) Open the file /vendor/spatie/laravel-medialibrary/src/Models/Media.php and copy contents,\n3) Create folders and file /fixes/Spatie/MediaLibrary/Models/Media.php and paste in the code.\n4) Find\n...\nclass Media extends Model\n...\nReplace with\n...\nclass Media extends \\Jenssegers\\Mongodb\\Eloquent\\Model\n...\n5) composer dump-autoload\n6) Profit!. ",
    "ClaudioVarandas": "@tolgaCTRLF5 thx! works perfectly. :) \n@freekmurze Is there a way to override a vendor / package Model ? like we do with the migrations/views .... ?  I guess not but maybe you can have an idea.\nThanks\nCV\n. ",
    "cve": "UPDATE\n~~You are right, thanks :) and sorry for that stupid mistake :)~~\n. Unfortunately there is no fill mode in 0.3.5 version of Glide, but I see it in master... What can we do with it?\n. It will be nice if in medialibrary we could define custom conversions with intervention, is there any plan to do so?\n. We want to have ability to resize the image to exact width and height but without croping, this functionality is implemented in http://glide.thephpleague.com/1.0/api/size/#fit-fit with fill fit mode in Glide, but its very simple to implement in pure Intervention library with:\n$newImage = $imageManager->canvas(100, 100);\n$resized = $image->resize(100, 100); <--- this is resized with ratio, so not always 100 x 100\n$result = $newImage->insert($resized, 'center'); <--- place optimal rezied image on the canvas which always has 100, 100\nBut with medialibrary or glide there is no posibility to define this custom manipulation\n. Ok, I can resize the image before adding to medialibrary, but how to reference it later with getUrl('conversion') and getFirstMediaUrl('conversion') ?\n. ",
    "apt-develop": "Hi, is Glide going to be upgraded to make sure of fill? Thanks.\n. ",
    "stayallive": "Yes I can, but that removes the easy use of collection and such I believe.\n. ",
    "jcornil": "What about the implementation of registerMediaConversions?\nI got this error.\nClass Model contains 1 abstract method and must therefore be declared abstract or implement the remaining methods (Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions::registerMediaConversions)\n. Oh...sorry, my fault.\nThanks for super fast response...:)\n. How about making folders based on the creation date.\nlike this...\nmedia/2015/8/14/1/file.jpg\nmedia/2015/8/14/2/file.jpg\nmedia/2015/8/15/3/file.jpg\nmedia/2015/8/15/4/file.jpg\n. ",
    "canvural": "I found a way to do it, if i'm not missing something.\nIn getMediaDirectory at Filesystem class we are assuming directory is the id of the media object.\nWe just need a new nullable property on Media model. This will be the additional path. Like: \"reports/daily\". And in the getMediaDirectory method we check if this new property is NULL. If it is we fallback to id. If it is not we will use it for the directory.\nThis way we don't need to change anything else.\nThis should work. Am i missing something?\n. For that issue, we can use the id as a default directory. Just like how it is now.\nBut if user gives a custom directory we can \"prepend\" it to the id. So it will become \"custom/directory/{id}\". That way it will be unique. And it will be organised how the user wants it.\nBut for now, just i need this feature. I can make my own forked version and use it. But enough people requests it i can make a PR.\n. I'm using my forked version on my project. It's working good.\nI just didn't write any tests. \nBut, i don't want to force you to merge this just because i wanted it. If you want i can make the PR or in an seperate issue we can ask another users if they want this kind of feature.\n. I have a lot of to do :smile: \nFirst of all i commited the wrong file to my fork. $this->setAdditionalPath = $path; :sob: \n- Need to write tests.\n- Need to change the url generators.\n- Find a way to update the migration file. Publishing again didn't work.\n- About deleting. I don't see how that can be an issue. A media item will have its own path.\n  For example; some/directory/1 and /some/directory/subdirectory/2. We can delete the media with id of 2 without touching the other one. Unless some one specifies /some/directory/1 as the directory of 2. But maybe we can prevent this by rejecting any numbers in the additional_path.\n. @jcornil You will be able to do that with this feature.\n. @freekmurze I added tests, updated url generators.\nOnly thing to do is update the migration file. How can we do this? Re-publishing the vendor files doesn't seem to overwrite migration file.\nWe are adding a new column to database. Everyone installed this package before have to add it too. How can we do this? Or is this counts as a breaking change?\n. @vedmant With that approach you can save it to only one place. Or you have to change the value in that callback, everytime you want to save it to different place.\n. @vedmant Hmm, i guess that would work too. I misunderstood you the first time.\nI will try to implement it tonight. :+1: \n. @vedmant, @freekmurze  I did some work on that. You can take a look at https://github.com/canvural/laravel-medialibrary/commit/7f3b2302003d6b8062aa8ba17fd505cb497027cc\nIt needs tests. But i can't figure out how to write it correctly. Take a look and let me know what do you think.\n. I think i rebased :) Gonna fix the CS issues.\n. @freekmurze All good now? \nI can't see 2 newline at tests/TestModelWithCustomDirectory.php. I don't understand that :)\n. 1) I think it like this. \"Get the directory of this model\". \n And one problem with adding the method to FileAdder class is, when we are fetching media objects from database, we can't know its directory. In this PR i'm getting the directory from model, while fetching from database.\n2) It still uses ids for the folder name. So unless the user gives a number for the custom directory name, which is also the id of another media, it's fine. Maybe we can fix it by restricting numbers in the custom directory.\n. Just assign a default media when the user registers. And if they update it, they can use their own media.\n. When configuring your disk in app/config/filesystems.php you should start your root with the public path. You can see an example of it in the readme.\n. The error is about your storage folder permissions i think.\n. Why are you trying to test this? This package already tests that cover the thing you mention. You can take a look at them.. You have methods like addMultipleMediaFromRequest or addAllMediaFromRequest. You can check those.. I think the custom properties is the thing you are looking for. You can read more here.. Sounds like a missing import or missing \\ Double check  the imports.. ",
    "cwhite92": "Wow, that was quick. Thank you!\n. No problem. Enjoy your holiday and the conference.\nOn 18 Aug 2015 11:55 am, \"Freek Van der Herten\" notifications@github.com\nwrote:\n\nHi, I appreciate your efforts. Currently i'm having a week's holiday and\nLaracon EU after that. I'll take a look at this PR at the end of next week.\nOn Tuesday, August 18, 2015, Chris White notifications@github.com wrote:\n\nHi, me again :)\nI came across a need to not only retrieve the public-facing URL to a\nmedia\nitem, but also to retrieve the full path on disk to it. I thought the\neasiest way to do that would be to create a getPath() method on the Media\nmodel, like the already existing getUrl() method.\nThere are a couple of concerns I have about this PR:\n- The responsibilities of LocalUrlGenerator and S3UrlGenerator is now\n  mixed between generating URLs and generating paths to the file.\n  Separating\n  concerns into a LocalUrlGenerator and LocalPathGenerator seems really\n  redundant, though.\n- I wasn't quite sure what to return in the getPath() method of\n  S3UrlGenerator. In the end I settled on just returning the relative\n  path, as that's how you would usually access an object stored on S3.\n- The it_can_get_the_default_collection test on GetPathTest.php seems\n  to be a duplicate of the same method in GetUrlTestphp, I'm not 100%\n  sure what this method does as it doesn't seem to be relevant to the\n  getPath() or getUrl() methods.\nI'm happy to discuss the above issues and if you think they require\naction\nI'll work on the PR some more.\nThanks,\nChris\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/spatie/laravel-medialibrary/pull/47\nCommit Summary\n- Add getPath() method to Media model and LocalUrlGenerator, create\n  GetPathTest\n- Add getPath() method to S3UrlGenerator\nFile Changes\n- M src/Media.php\n  https://github.com/spatie/laravel-medialibrary/pull/47/files#diff-0\n  (20)\n- M src/UrlGenerator/LocalUrlGenerator.php\n  https://github.com/spatie/laravel-medialibrary/pull/47/files#diff-1\n  (10)\n- M src/UrlGenerator/S3UrlGenerator.php\n  https://github.com/spatie/laravel-medialibrary/pull/47/files#diff-2\n  (10)\n- A tests/Media/GetPathTest.php\n  https://github.com/spatie/laravel-medialibrary/pull/47/files#diff-3\n  (52)\nPatch Links:\n- https://github.com/spatie/laravel-medialibrary/pull/47.patch\n- https://github.com/spatie/laravel-medialibrary/pull/47.diff\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/pull/47.\n\n\nFreek Van der Herten\nhttps://spatie.be\n+32 495 84 27 91\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/pull/47#issuecomment-132171190\n.\n. \n",
    "nicolasbeauvais": "For future readers you can simply override the delete method in the model using soft delete:\nphp\npublic function delete()\n{\n    return parent::delete();\n}\nThe laravel-medialibrary delete method will not be called and will leave all medias untouched. \n. Not exactly compression but you can change image quality using glide which will greatly reduce the image size (http://glide.thephpleague.com/1.0/api/encode/#quality-q)\nphp\n$this->addMediaConversion('small')\n            ->setManipulations(['w' => 166, 'h' => 166, 'fit' => 'fill', 'q' => 80, 'fm' => 'jpg'])\n            ->performOnCollections('default');\n. Hi @amosmos,\nI never used the order_column so I don't know how we can fix your problem by using it, but here is a simple solution for you:\nFirst add a order custom property to the media that needs it:\n``` php\n$media1 = $model->addMedia($pathToFile)\n                ->withCustomProperties(['order' => 1])\n                ->toMediaLibrary();\n$media1 = $model->addMedia($pathToFile)\n                ->withCustomProperties(['order' => 2])\n                ->toMediaLibrary();\n```\nthen you can use the custom property to sort your medias:\n``` php\n$medias = $model->getMedia();\n$ordered = $medias->sortBy(function ($media, $key) {\n    return $media->getCustomProperty('order');\n});\n```\nI hope this can help you :smile: \n. Have you looked at the online documentation https://docs.spatie.be/laravel-medialibrary/v4/introduction ? Lots of examples in it.\nThe relationship is automatically created when your use the HasMediaTrait in your model Class.\n. Will do it later today, thx :)\n. Will do !\n. Done,\nI've deleted the previous commits from history, hope it's ok ;)\n. I've looked at your refactor commits, i will keep the change in mind for next time \n. Done :)\n. This will conflict with #256\n. I had the same issue, after some investigation I found that the symfony console component doesn't parse the argument, it just put it in an array\nhttps://github.com/symfony/console/blob/master/Input/ArgvInput.php#L248-L251\nso your agruments \"39,40\" will be casted to\narray:1 [\n  0 => \"39,40\"\n]\nI don't know if there is a syntax to force the array creation from the command line, I tried:\n39,40\n\"39,40\"\n[39,40]\n\"[39,40]\"\nAll return the same result.\nIn the other hand:\nArtisan::call('medialibrary:regenerate', ['--ids' => [39, 40]]) works perfectly.\nA simple solution will be to modify the RegenerateCommand:\n{--ids=*} to {--ids=} to avoid the useless casting\nand explode the argument on line 78:\nphp\nif ($mediaIds) {\n    $mediaIds = explode(',', $mediaIds);\n    return $this->mediaRepository->getByIds($mediaIds);\n}\nBut this should work without any workaround :/\n. Looks like #248 \n. I just found this package https://github.com/PHP-FFMpeg/PHP-FFMpeg that can do exactly what we need and much much more,\nphp\n$frame = $video->frame(FFMpeg\\Coordinate\\TimeCode::fromSeconds(42));\n$frame->save('image.jpg');\n. Found this one https://github.com/closca/sonus, less robust than PHP-FFMpeg  but no dependencies\n. Haha that's a tough choice :wink: \n. Perfect, will do when I have some extra time :tada: \n. Done :smiley: \n. No worries, enjoy your holiday :sunglasses: :sunny: \n. I changed  extractDuration to extractVideoFrameAtSecond, we can probably use the word timecode instead of duration but it is not as common for non-native English speakers.\nI update all the string()->pop() to use `pathinfo instead\n. My bad, apparentlygetOptionsis ignored if we define$signature, this is whydry-run` disappeared.\nI've added the confirmation on the regenerate command :smile: \n. You're welcome :) It's my pleasure to contribute to this really great package :sunglasses: \n. Where do you try to save the medias ?\n. This error has been issued in the last version of medialibrary  :smile: \n. Also the HasMedia interface and the HasMediaTraittrait should be used on your model not on your controller (preparing your model) which is the reason why you can't use addMediaFromRequest on your user model.\n. What would be the parameter that you send to registerMediaConversions() ?\n. There is a built-in functionality to help you change the directory structure of the medias:\nhttps://docs.spatie.be/laravel-medialibrary/v4/advanced-usage/using-a-custom-directory-structure\nHope this can solve your problem :)\n. Hi @a-wenzel, thanks for reporting this bug, I think I found the cause, can you take a quick look at the #308 PR and tell me if it fixes it for you ? \nSorry for introducing it in the codebase :-1: \n. Though the same but didn't know wich kind of test I could make to avoid this regression. If you have some tips/hint for it I would gladly make them :)\n. Maybe this can help you (I don't know which distribution you are using):\nhttp://askubuntu.com/questions/20783/how-is-the-tmp-directory-cleaned-up\nAlso changing the way media are stored is really easy with this library,  you just have to update your configuration file:\nhttps://docs.spatie.be/laravel-medialibrary/v4/installation-setup-in-laravel\n. Can you show me a row of the media table in your database?  Also which\nversion of the library are you using?\nLe sam. 27 ao\u00fbt 2016 22:13, Jean-Philippe Murray notifications@github.com\na \u00e9crit :\n\n@nicolasbeauvais https://github.com/nicolasbeauvais Actually, the files\nare stored in a media/tmp directory, the media one being where\nspatie/laravel-medialibrary stores it's own files. I thought this would be\na tmp folder created by the package, and not by the system?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/314#issuecomment-242938357,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AC0KGKOgVJZiIWG-u4lUJyH0fVGC56Vlks5qkJp2gaJpZM4Juv-h\n.\n. Everything looks fine,  the version before 4.8.3 add a file path bug which is why I asked,  you are using the media disk which by default if you follow the installation setup https://docs.spatie.be/laravel-medialibrary/v4/installation-setup-in-laravel should write the media's in the public/media directory,  the tmp directory should only be used by the package to perform the conversion not to store files.\n\nCan you check your public directory and the media configuration as explained in the installation documentation I linked? \n. I was thinking about moving spatie/pdf-to-image into a suggested dependency like FFmpeg instead of a required one. What do you think about it ?\nIt can make sense to make this change in this PR, let me know :)\n. Done :)\n. Cool ! Keep me updated :)\n. Saw the changes, as always the new naming is really more comprehensive :+1:\nIf you want me to make some code (new tests or anything) do not hesitate :)\n. Sure it's a good thing if we can avoid tagging a major version, for the pdf lib we just have to keep in mind that we can unrequire it in the v5 (I do not know how todos are managed for medialibrary ? maybe you can use the new github projects feature for that ?)\nI will for sure write some doc I was waiting for the merge to be accepted and merged to avoid writing it several times ;)\nWill you make the change to require spatie/pdf-to-image or should I do it ?\n. You can directly pass the file to media library without saving it first:\nphp\n$product->addMedia($request->file('images'))->toCollection('images');\nBut this will not resolve your conversion issue.\nAre you using a queue to perform the conversion ? If it's the case try again in sync mode it's easier to debug.\nHave you tried the regenerate command php artisan medialibrary:regenerate ? Does it create the conversions ? \nWhich kind of driver are you using to store the file ?\n. Yes if you use the HasMediaConversions trait on your model everything will be automatically performed if you define conversions.\nWhat are the type of file you are trying to attach to your model ?\nYou can verify the type with an instance of your media like:\nphp\n$product->getFirstMedia()->type;\nOnly file with image,  svg,  pdf or  video type can have a conversion. The type is determined using the file extension or mime type.\n. Everything looks ok, what does your public/media directory looks like ?\nJust the files like:\n/media\n  /1\n    hello.jpg\n  /2\n    avatar.jpeg\nor is there an empty conversions directory or something else ?\n. Maybe you didn't set up a proper queue worker ?\n. Have you also changed the medialibrary config ?\nhttps://github.com/spatie/laravel-medialibrary/blob/master/config/laravel-medialibrary.php#L15\n. Also there can be several php.ini files (like differents one for running php in the cli and under nginx)\nYou can use the locate command to find them on linux:\n``` bash\n$ locate php.ini\n/etc/php/7.0/cli/php.ini\n/etc/php/7.0/fpm/php.ini\n```\n. Hi @bakerstreetsystems,\ncan you please check this recent similar issue #321, and make all the checks mentioned there ?\nDoes php artisan medialibrary:regenerate create the conversions ?\nAre you using a queue ?\n...\nThanks !\n. I suggested the issue because queuing (if activated) is the biggest difference between uploading a file and it's conversions, and also one of the only cases when you will not see any errors.\nWhat I would suggest to you is either activating logs on your s3 bucket (this can add some costs to your bucket if you make a lot of operation on it). But first, maybe add some debug lines to the media library core to check when using the s3 driver that:\n- the conversion of the file is called:\n  - https://github.com/spatie/laravel-medialibrary/blob/master/src/FileManipulator.php#L23\n  - https://github.com/spatie/laravel-medialibrary/blob/master/src/FileManipulator.php#L38\n- the file is created:\n  - https://github.com/spatie/laravel-medialibrary/blob/master/src/FileManipulator.php#L79\n- the conversion file is sent to s3:\n  - https://github.com/spatie/laravel-medialibrary/blob/master/src/Filesystem.php#L48\n. @boofman15 Great catch ! I made a PR #370 to fix it\n. I'm not sure that this issue should be closed, #329 hasn't been fixed yet\n. The 4.8.3 version that has been created to fix this bug (#301) is the last release of the package.\nWhich version are you using ?\n. Can you print the result of this method ? It return the converted file path:\n``` php\nprotected function convertPdfToImage(string $pdfFile) : string\n{\n    $imageFile = pathinfo($pdfFile, PATHINFO_DIRNAME).'/'.pathinfo($pdfFile, PATHINFO_FILENAME).'.jpg';\n(new Pdf($pdfFile))->saveImage($imageFile);\n\ndd($imageFile);\nreturn $imageFile;\n\n}\n```\nIf the file path looks correct verify that you have the correct permission on the directory.\n. The correct path for performing conversion should be like storage/medialibrary/temp/*\n. The process for converting jpeg and (pdf/svg/video) are differents,\nto convert a pdf we first extract an image representation of the pdf file using the convertPdfToImage method (that we don't need for a jpeg file which is already an image file) and after we perform the conversion on that extracted file.\nI can see two reason for you not seeing the  dd output, either you are using a queue to process the conversion so the dump will be async and you will not see it, or medialibrary fail to recognize your file as a PDF, if the library does not recognize the file type, no conversions are performed.\n. Maybe you can use the built-in Laravel Exception Handler to override the error message.\nOr use the Service container to swap the exception with your own implementation.\n. Not ideal but it can be a temporary solution:\nphp\n/**\n* Render an exception into an HTTP response.\n*/\npublic function render($request, Exception $e)\n{\n    if ($e instanceof FileCannotBeAdded) {\n        // Get your other locale text\n        $otherLocale = trans('errors/filecannotbeadded.' . $e->getTrace()[0]['function']);\n    }\n}\n$e->getTrace()[0]['function'] will give you which method of the FileCannotBeAdded class is called, so you can have a lang file like this:\nphp\nreturn [\n    'unknownType' => 'other language traduction',\n    'fileIsTooBig' => 'other language traduction',\n    'fileDoesNotExist' => 'other language traduction',\n    'unreachableUrl' => 'other language traduction',\n    ...\n];\n. I tried to push my fix but couldn't do it :/  I tough GitHub would authorize it as the first commit is mine..\nsomething like this in (https://github.com/spatie/laravel-medialibrary/blob/feature-image-generators/tests/ImageGenerators/VideoTest.php#L23) should do the trick\nphp\n$imageFile = $imageGenerator->convert($media->getPath(), new Conversion('test'));\nThe video converter needs a conversion object so it can get the extractVideoAtSecond result.\n. It looks better now :)\n. Nice catch, indeed the right condition will only be executed if the left one is true !\n. I cannot replicate the bug using the 4.8.0 version of the package.\nWe changed a big part of the code that handles video, can you try with the latest 4.9.2 version ? If you can't for some reason please give me the complete version you are using so I can try to replicate the error.\nIn the meantime, I saw some improvements that can be made to your code (If I understood your sample correctly), you can let Medialibrary handle the upload of the file to your machine or to a cloud server, this will slim a part of your code as you will not have to store then erase the file by yourself.\nThis will look like this (this link can also help you to send the file on the required cloud storage:\nphp\n$post->addMedia($request->file('file'))\n     ->usingFileName(str_random(16).'.'.$request->file('file')->getClientOriginalExtension())\n     ->toCollection('video');\n. I never used a custom URL/Path generator with medialibrary, maybe @freekmurze can have more insight on this ?\n. Collections and media disks are two different things.\nmedialibrary collections are used like \"categories\" of files and are abstracted of the disks where they are stored.\nFor example, I have a User entity, my users can have one avatar and a photo gallery of their last holidays. I want all files stored on the default media disk.\n``` php\n// Add the user avatar\n$user->addMedia($request->file('avatar'))->toCollection('avatar');\n// Add the user gallery images\nforeach ($request->file('galery_files') as $file) {\n    $user->addMedia($file)->toCollection('gallery');\n}\n```\nNow the media attached to my user are separated in 2 different collections so I can easily query my user's avatar or only the medias in the gallery collection, or both.\nMedialibrary uses a default disk to store all the files, but you can pass the second parameter to toCollection to store a specific file on a different disk, let's say I want my avatar in the uploads directory (which you named video in your laravel configuration) I just have to do:\nphp\n// Will store the file with the avatar collection but on the video disk.\n$user->addMedia($request->file('avatar'))->toCollection('avatar', 'video');\n. So you have 2 servers provisioned by Forge, one with the laravel code and one where files must be stored ? is that correct ?\nBecause once your project on production on your server, when a user upload a file, if you use the default medialibrary configuration the file will be stored on the forge server where the code is hosted.\n. I never used a different filesystem than the default one or S3 so I don't really know how to help you on this one :/\n. Thanks a lot :smile: \n. Medialibrary is not meant to work with unexisting files.\nBut I think something like this could work:\n``` php\n$media = new \\Spatie\\MediaLibrary\\Media();\n$media->model_id = $model->id;\n$media->model_type = get_class($model);\n$media->name = 'name';\n$media->file_name = 'file name';\n$media->save();\n```\nBut I would not recommend using something like this.\n. I do not remember any functionality in medialibrary to check for this, on a production website where file are converted using a queue I have a small javascript code that checks for the image existence and put a loading icon while the image is not converted yet.\n. Medialibrary uses https://github.com/spatie/laravel-glide as a dependency to interact with glide. To change the glide driver follow the laravel-glide readme instruction:\n1. add the Spatie\\Glide\\GlideServiceProvider::class provider in your app.php\n2. execute the PHP artisan vendor:publish --provider=\"Spatie\\Glide\\GlideServiceProvider\" command to get the glide config file and change GD to Imagick\n. You can easily eager load media using with:\nphp\n $this->section->products($this->city)->with('media')\n            ->orderBy('products.sort', 'asc')\n            ->get();\n. I see two solutions:\n- using something like https://github.com/jubos/fake-s3\n- using a real s3 bucket, and we can put the AWS keys in Travis-ci env (on the Travis-ci website so they remain private)\nAnd we make the test run only if an s3 connection is available so it doesn't prevent other developers from running the test if they don't have a bucket. (Just like we did with specific image generators tests).\n. I can write the test class to save you some time if its ok :)\n. I can't reproduce using medialibrary version 4.9.4,\nCan you check wich version of the package you are using ?\nAlso, can you give me a more complete error log than the CLI output ? in you should have more detail like the file and line of the error in storage/logs/laravel.log \n. What is the region of the bucket ? eu-west-1 ?\nYou should maybe add a S3_BUCKET_REGION env var\n. To perform the tests I need flysystem-aws-s3-v3 which require flysystem-aws-s3-v3 which require guzzlehttp/guzzle  ^5.3 || ^6.0.1 but scrutinizer/ocular already require guzzlehttp/guzzle 3, and there is no more recent version of scrutinizer/ocular  :/\nI saw on https://scrutinizer-ci.com/g/spatie/laravel-medialibrary/ that the code coverage is not enabled, but there is this line in travis.yml:\nyaml\nafter_script:\n  - php vendor/bin/ocular code-coverage:upload --format=php-clover coverage.clover\nSome light on this ?\n. test doesn't pass  :/ ErrorException: file_get_contents(): php_network_getaddresses: getaddrinfo failed: Name or service not known\nany clue on this ? Is it because Travis can't read the file on S3 ? or maybe S3 need a specific header on the request like at least a user agent or something ?\nI'm really happy about being a collaborator on the repo :heart: And sure I will probably start by just using my new rights to help you with issues, will see later for managing PR, tag etc.. if that's ok :)\n. That and also only delete file created by this instance test suite to avoid that the php 7.0 test delete the media being tested in the 7.1 test, I add this to my todo list\n. I couldn't find any documentation on the order_column\nMost of the code that handles order is in the Spatie\\MediaLibrary\\SortableTrait which is by default included in the Media class. Also, the base MediaObserver is used to set the order_column when creating a media.\nBy looking at this I can understand that: by default every newly created media as an order_column that correspond to last inserted media order + 1 (across all media, independent of the file collection / disk).\nAlso, there is a Media::setNewOrder static function:\nphp\n /**\n  * This function reorders the records: the record with the first id in the array\n  * will get order 1, the record with the second it will get order 2, ...\n  *\n  * A starting order number can be optionally supplied (defaults to 1).\n  *\n  * @param array $ids\n  * @param int   $startOrder\n  */\nBy default, medias are ordered using the order_column.\n@freekmurze do you have a little more details on this ? I could write some doc for it using what is learned in this issue.\n. How did you use deletePreservingMedia() ? as documented in the code this method will delete your Post model but leave associated media row in the database.\nIf you want to delete a media only from the database a simple use of the laravel query builder will bypass any restriction of the media model:\nphp\nDB::table('media')->where('id', $media->id)->delete()\n. The teardown method that cleaned all the files uploaded to s3 doesn't work :/ I will investigate tomorrow night !\n. Everything should work now :+1: But as you said my PR Travis build didn't have access to the S3 env vars\n. Media conversions can only be images.\nBut you can easily customize the getUrl() method by creating your own media model\nand overiding the getUrl() method.\n.  Did you installed Imagick ? https://github.com/spatie/laravel-medialibrary/blob/master/README.md#requirements\nAlso which version of medialibrary are you using ? SVG conversion support has been implemented recently.\n. Converted files are always .jpg or .png as Glide (the library used to perform the conversion) only know theses two formats. So to perform a conversion on an SVG file medialibrary first convert the SVG file to a jpg file then perform the thumb conversion.\ngetFirstMediaUrl() should indeed return your file in it's original format (svg) unless you are passing a conversion name argument like getFirstMediaUrl('default', 'thumb').\n. Even with access to the repo I cannot read Travis's env vars :/\n. It's ok I already have my own test bucket, I will setup travis on my fork :)\n. @amosmos something like that?\nphp\n$user = User::find(1);\n$user->media->each(function (Media $media) use ($keep_id) {\n    if ($media->id != $keep_id) {\n        $media->delete();\n    }\n});. Medialibrary use Glide to perform a conversion, glide can only convert images files. Medialibrary  has a feature called Image generator that can convert SVG, pdf, and video to images to use them in Glide.\nCurrently, the only way for you to compress a video file will be to compress it before sending it to medialibrary.\n. I do not see any simple way of doing that with medialibrary for now.\nYou can create your own Path and Url generator with some custom logic to retrieve your video / audio conversions, but there is no feature to let you upload your own conversions, so that's a lot of code to implement on your side.\n. That's some really big file to convert ! \nWhat I would try:\n- Increase the server hardware memory / CPU\n- Increase PHP memory limit\n- Use a queue driver (SQS / Redis / Beanstalk) to perform the conversion in deferred\n- Try Imagick instead of GD (not sure if it's faster but you can try) described in https://github.com/spatie/laravel-medialibrary/issues/375\n. @freekmurze maybe you could put the official documentation site in the GitHub description instead of the v4 announcement ? At first I had some trouble finding the documentation site because of this. \n\nOr maybe just a bigger link in the readme\n. Something like:\nphp\n$model->getMedia('collectionName')->each(function(Media $media) {\n    return $media->getUrl('conversionName');\n});\nwill return a Laravel Collection containing all URLs for the conversion conversionName of all file from the collectionName collection.\nIs that what you were looking for ? :). Hope I'm not too late,\nI indeed did not understand your first question, to get the media conversions of an object manually I would do something like:\n```php\n$model = Model::find(1);\n// Write all conversion in the model's mediaConversions attribute\n$model->registerMediaConversions();\n// This is the exact same line used in the library to find the conversions to perform on a specific media\n$conversions = $model->mediaConversions->filter(function ($conversion) {\n    return $conversion->shouldBePerformedOn('collection_name_to_return');\n});\n```\nI don't know about the getMediaConversions(), is it shown somewhere in the documentation?. Hello @ergonomicus,\nOnly webm, mov or mp4 file are converted. \nThis restriction is written on the following lines:\nhttps://github.com/spatie/laravel-medialibrary/blob/master/src/ImageGenerators/FileTypes/Video.php#L36-L44\nunder the hood medialibrary use FFmpeg to make the conversion, the 3gp format should be compatible https://ffmpeg.org/general.html#File-Formats\nYou could make a small PR to add this file format, you just have to modify the lines I mentioned above to add the file format and MIME and it should work :). @freekmurze  Sorry for not being very active, I'm completely swamped with work :/\nThe PR look fine, great find @arubacao !\nI do not have the time to test it for real now, maybe at the end of the week :)\n. That looks like overengineering to me. Aren't\nphp\n$item->media->find($id);\n// and\n$media->fresh();\nsimple enough ? \nIs there a special use case for this ?. Hello @amosmos,\nmedialibrary integrates https://github.com/thephpleague/glide which can help you achieve this in an elegant way, this is described in the defining conversions part of the documentation.\nIf for any reason you need to resize the image by yourself:\n```php\n$file = request()->file('my_file');\n// Perform the image resize and store the file with the correct size somewhere\n$model->addMedia($pathToCorrectFile)->toMediaLibrary();\n```\n. Medialibrary integrates glides features in a convenient API (images conversions), unless there is a feature in Intervention that you can't use with glide or medialibrary I would stay with glide wich will make you will save a lot of time.. I tried and didn't get any errors, have you defined conversions on your model that might be configured to trigger the pdf conversion?\nThe createDerivedFiles should maybe be renamed, it initializes the media conversion and checks if any defined conversion need to be performed on the media, if not, no conversion should be triggered.\nTo see if any conversion is defined for your pdf file you can add a dd($conversions); at this line:\nhttps://github.com/spatie/laravel-medialibrary/blob/master/src/FileManipulator.php#L43\n. Laravel filesystem support local / s3 / Rackspace or FTP disks:\nhttps://laravel.com/docs/5.3/filesystem#configuration\nyou could also probably use Rsync to create a virtual directory that points to your \"file\" server.\nIf you choose FTP or Rackspace you will have to generate a custom URL for the media, which is pretty straight forward:\nhttps://docs.spatie.be/laravel-medialibrary/v4/advanced-usage/generating-custom-urls. You are not supposed to cache your configuration (or routes) in your development environment, as explained in the laravel documentation: (https://laravel.com/docs/5.3/configuration#configuration-caching)\n\nYou should typically run the php artisan config:cache command as part of your production deployment routine. The command should not be run during local development as configuration options will frequently need to be changed during the course of your application's development.\n\n. I like toMediaLibrary, it explain well what it does and it reminds of the package name which is great for the brand image :smile: . Great change!\n@barryvanveen could you make a PR to https://github.com/spatie/docs.spatie.be to make a short explanation on how one could override the Filesystem ?. Here's my Trello column about media library potential features:\nPossibility to use the same media multiple amounts of time but with only one upload/conversion.\n=> use case: When a user is created I attach a default avatar image to it, when my website will get 1000 users I will have 1000 time the same image + conversions. I can hard link the avatar to avoid that but it's easier if all my code (custom avatar or not) use the same API.\nNew \"URL\" media type\n=> use case: A user can have a media gallery with images/videos, a video can be a .mp4 or a youtube / Vimeo link, always to use a single API instead of having to write some custom code to handle URLs. + It can be a good way to deal with larger files that are already hosted, I don't my users to upload a 2gb video, but I don't mind them using one in their gallery if they have hosted it. We would be able to create custom image generator, for youtube it would be an API call that gets the thumbnail of the video and convert it.\nVuejs image loader\n=> use case: When a user change it's avatar, we can't display it for like 3-5 seconds until it get converted. The vuejs module could operate in two mode, one that request the image every second until it works or one that wait for a web socket event triggered by a ConversionHasBeenCompleted. This is clearly outside of this package scope but it was in my list ^^\n. Also, we can remove image types (except the TYPE_OTHER maybe ?):\nhttps://github.com/spatie/laravel-medialibrary/blob/master/src/Media.php#L21-L24\nAs all type corresponding to an image generator no longer use them:\nhttps://github.com/spatie/laravel-medialibrary/blob/master/src/ImageGenerators/BaseGenerator.php#L44\nFor the URL feature:\nOn first tough, I would make an addUrlMedia (but with a better name that avoids confusion with the existing addMediaFromUrl), use the file_name table column to store the URL (that should maybe be renamed to media_name? and find a way to detect that a media is a URL so it doesn't go trough the UrlGenerator, could be the media column set to web but It could break if somebody use a media with that name, or a new is_url boolean, or just a string check on the file_name to detect if it start with https?://. You are defining your conversions like it should be for medialibrary before v5, now conversions are defined like this:\nphp\n$this->addMediaConversion('thumb')\n              ->width(368)\n              ->height(232)\n              ->sharpen(10);\nas stated in the v5 documentation https://docs.spatie.be/laravel-medialibrary/v5/converting-images/defining-conversions. Version 4.x.x of laravel-medialibrary should work just fine :). I do not think there is any method to add multiple files at once to medialibrary, but you can easily loop on the files:\nphp\nforeach ($request->file('files', []) as $key => $file) {\n    $user->addMedia($file)->toMediaLibrary();\n}\nHope this answer your question :). You can use the version 5.x of this package to get laravel 5.4 support. Hello @Mirdrack,\nIf your app isn't supposed to receive image files shouldn't you just validate the file before handling it to medialibray?\nUsing something like Laravel native image validation should do the work https://laravel.com/docs/5.4/validation#rule-image. Only file type recognized by the library should be converted (listed here: https://github.com/spatie/laravel-medialibrary/tree/master/src/ImageGenerators/FileTypes), if the file doesn't pass the check of one of those 4 types it should'nt be converted :thinking: \nCould you share  the media conversion you defined ? Have you tried with a different txt file ? Which ImageGenerators try to convert the file ?. Maybe just removing the third parameter ?\nphp\n$this->filesystem->disk($media->disk)->put($destination, fopen($file, 'r'));. @AlexVanderbist Looks good to me :) . Hello @muhghazaliakbar,\nthis is because laravel public_path method is hard coded to always return the public directory:\nhttps://github.com/laravel/framework/blob/5.4/src/Illuminate/Foundation/Application.php#L374-L382\nan easy solution would be to use app_path instead:\nphp\n'media' => [\n    'driver' => 'local',\n    'root'   => app_path('public_html/media'),\n],\n. Fixed the conflict. Hello @pedrofurtado,\nthe process to create your own media generator is described in the documentation: https://docs.spatie.be/laravel-medialibrary/v7/converting-other-file-types/creating-a-custom-image-generator\nYou can take a look at the base Video generator that takes a video file in input to create a preview image in output using ffmpeg: https://github.com/spatie/laravel-medialibrary/blob/master/src/ImageGenerators/FileTypes/Video.php. Hello @pedrofurtado,\nthe media generator feature was designed to convert any type of file to an image, like PDF or video previews.\nIt should be possible to use it to convert files to other formats just like your use case, I opened a PR to explore a solution to this issue https://github.com/spatie/laravel-medialibrary/pull/1279.. WIP:\n- [x] Refactored the fix using an early return in the performManipulations method.\n- [x] Created a withoutManipulations helper function for conversions.\n- [x] Added some missing return types in Conversion.php.\n- [x] Add tests for the fix.\n- [x] Add tests for the withoutManipulations method.\n- [ ] Update the documentation to reflect this changes  . I should be done with this, of course, feel free to suggest any improvements.\nI will update the documentation once this gets merged!. Hello @laravelcoder,\naddMedia need to be called on an Eloquent Model, in your example, you are calling the function on $this which in this context is a Controller, not a model.\nYou could take a look a the following piece of documentation to understand how to use this package:\nPreparing an Eloquent Model\nAssociating files. Again you are not calling the function on a model but on a  HasMany relationship. To get a collection of video you should use $clip->videos instead of  $clip->videos documentation\nClip <=> Videos is a one-to-many relationship, if you want to add the media to all the videos of your clip you could do it like this:\nphp\n$clip->videos->each(function ($video) use ($request) {\n    $video->addMedia($request->input('videos[1][video]'))->toMediaCollection('videos', 'local');\n});\nOr retrieve the coreesponding video model and add the media:\nphp\nVideo::find($id)->addMedia(...);. Hello @Adioz01,\none solution could be to save in the media table the image dimensions using CustomProperties:\nWhen you upload the file:\nphp\nlist($width, $height) = getimagesize($pathToFile);\n$model->addMedia($pathToFile)\n    ->withCustomProperties(compact('width', 'height'))\n    ->toMediaCollection();\nIn your blade template:\nphp\n<amp-img {!! $attributeString !!}\n    src=\"{{  $media->getUrl($conversion) }}\" \n    srcset=\"{{ $media->getSrcset($conversion) }}\" \n    width=\"{{ $media->getCustomProperty('width') }}\" \n    height=\"{{ $media->getCustomProperty('height') }}\" \n    layout=\"responsive\"></amp-img>. Something like this should work:\n```php\n    public function storeImage(Request $request, $id)\n    {\n        list($width, $height) = getimagesize($request->file('kategorieBild')->getPathName());\n    $kategorieBild = Kategorie::find($id)\n    ->addMediaFromRequest('kategorieBild')\n    ->withResponsiveImages()\n    ->withCustomProperties(compact('width', 'height'))\n    ->toMediaCollection('content')\n    - save();\n\n    return redirect()->back()->with('success', 'Bild hinzugef\u00fcgt');       \n}\n\n```. You're welcome!. Hello @shirshak55, could you share the code used to add the media?. It appears that the issue is an incorrect use of medial-library by the Nova package that you are using:\nhttps://github.com/jameslkingsley/nova-media-library/issues/17\n. This means that you are trying to call the getPath method on a Collection instead of an eloquent model.\nYou should use the method on the model like this:\n```php\n$collection->each(function ($model) {\n    $model->getPath()\n});\n// or \n$collection->first()->getPath();\n``. done\n. Couldn't find a way to callStorage::orapp('filesystem.disk')in a \u0300tearDownAfterCLassmethod, usingregister_shutdown_function is the only working way that I found to clean the S3 bucket\n. ",
    "olimorris": "Problem solved. May be a useful reference as I was using your package alongside the Laracasts Bulk File Uploads tutorial.\nExploring the error log on my Homestead VM I was seeing the following error:\nupstream sent too big header while reading response header from upstream\nIn order to correct this I ran the following command to access my vhost file:\nsudo nano /etc/nginx/sites-available/YOURSITENAME.dev\nand then I applied the following within the location ~ .php$ { section of the file:\nfastcgi_buffer_size 128k;\nfastcgi_buffers 4 256k;\nfastcgi_busy_buffers_size 256k;\nI then ran sudo service nginx restart and hey presto. it all works\n. What a plonker I am...I was use 'jobs.getMedia' - doh!\nWorks perfectly and down to a respectable number of queries now. Thanks\n. ",
    "thomascharbit": "Thanks!\n. ",
    "dmitry-udod": "You are man! :)\nEverything is OK.\nThank a lot\n. ",
    "uyab": "Hi @freekmurze, I'm sorry if my previous PR caused this problem. But it looks like the root problem is on this line: https://github.com/spatie/laravel-medialibrary/blob/master/src/FileAdder/FileAdder.php#L270-L272\nThe first save() is unnecessary and should be removed. This is the 'usual' way to insert related model in Laravel. It also produces less query (1 vs 2). I hope you have time to check it out :)\n. Thank you, really like this and the others spatie package.\nOn Thu, Sep 3, 2015, 05:09 Freek Van der Herten notifications@github.com\nwrote:\n\n@uyab https://github.com/uyab I've added your contribution back in. You\nwere correct regarding the root problem. Thanks!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/56#issuecomment-137259914\n.\n. HI @pascalbaljet, if you have relationship between Media and User model, did you add additional column to media table (something like user_id or uploader_id) ?\n. Several type hint in HasMediaTrait are still pointing to (hardcoded) Media. If I completely can use custom Model, there is a chance that I create the media model from scratch (not extend built in Media). So this will cause an error. What do you think @freekmurze ?\n. Yes\n. Test failed when using --prefer-lowest, caused by following issue: https://github.com/danielstjules/Stringy/issues/69\n. Just curious, why use --prefer-lowest ?\n. \n",
    "loranger": "OK, I had to composer dump before.\nSorry for the noise.\n. Hello,\nThat was it : I did setup a queue worker after implementing medialibrary and did not notice medialibrary automatically uses it whereas my queue is not running as I'm doing tests.\nMy apologies, thank you for your answer.\nBy the way, while implementing my custom path generator, I noticed the documentation is not up-to-date regarding the interface's methods signatures. The implementation now requires any \u201creturn type\u201d. I've just opened a PR regarding this documentation typo.\n. That's the answer I was afraid of ;p\nThank you, anyway !\n. All right, thanks for the tip !\n. Ok, I found \nphp\n$newsItem = News::find(1);\n$collections = $newsItem->media->pluck('collection_name')->unique();\nSorry for the noise\n. Thanks for your help\nI have a custom url generator (the same I use with Laravel: I'm trying to my project api from Laravel to Lumen, without loosing any feature) and a custom path generator.\nHere is my laravel-medialibrary.php configuration file :\n```php\n<?php\nreturn [\n/*\n * The filesystems on which to store added files and derived images by default. Choose\n * one or more of the filesystems you configured in app/config/filesystems.php\n */\n'defaultFilesystem'           => 'media',\n\n/*\n * The maximum file size of an item in bytes. Adding a file\n * that is larger will result in an exception.\n */\n'max_file_size'               => 1024 * 1024 * 20,\n\n/*\n * This queue will used to generate derived images.\n * Leave empty to use the default queue.\n */\n'queue_name'                  => '',\n\n/*\n * The class name of the media model to be used.\n */\n'media_model'                 => Spatie\\MediaLibrary\\Media::class,\n\n/*\n * When urls to files get generated this class will be called. Leave empty\n * if your files are stored locally above the site root or on s3.\n */\n'custom_url_generator_class'  => App\\Services\\MediaLibraryUrlGenerator::class,\n\n/*\n * The class that contains the strategy for determining a media file's path.\n */\n'custom_path_generator_class' => App\\Services\\MediaPathGenerator::class,\n\n's3'                          => [\n    /*\n     * The domain that should be prepended when generating urls.\n     */\n    'domain' => 'https://xxxxxxx.s3.amazonaws.com',\n],\n\n'remote'                      => [\n    /*\n     * Any extra headers that should be included when uploading media to\n     * a remote disk. Even though supported headers may vary between\n     * different drivers, a sensible default has been provided.\n     *\n     * Supported by S3: CacheControl, Expires, StorageClass,\n     * ServerSideEncryption, Metadata, ACL, ContentEncoding\n     */\n    'extra_headers' => [\n        'CacheControl' => 'max-age=604800',\n    ],\n],\n\n];\n```\nand here is my filsystems.phpfile :\n```php\n<?php\nreturn [\n/*\n|--------------------------------------------------------------------------\n| Default Filesystem Disk\n|--------------------------------------------------------------------------\n|\n| Here you may specify the default filesystem disk that should be used\n| by the framework. The \"local\" disk, as well as a variety of cloud\n| based disks are available to your application. Just store away!\n|\n */\n\n'default' => 'local',\n\n/*\n|--------------------------------------------------------------------------\n| Default Cloud Filesystem Disk\n|--------------------------------------------------------------------------\n|\n| Many applications store files both locally and in the cloud. For this\n| reason, you may specify a default \"cloud\" driver here. This driver\n| will be bound as the Cloud disk implementation in the container.\n|\n */\n\n'cloud'   => 's3',\n\n/*\n|--------------------------------------------------------------------------\n| Filesystem Disks\n|--------------------------------------------------------------------------\n|\n| Here you may configure as many filesystem \"disks\" as you wish, and you\n| may even configure multiple disks of the same driver. Defaults have\n| been setup for each driver as an example of the required options.\n|\n| Supported Drivers: \"local\", \"ftp\", \"s3\", \"rackspace\"\n|\n */\n\n'disks'   => [\n\n    'local'  => [\n        'driver' => 'local',\n        'root'   => storage_path('app'),\n    ],\n\n    'public' => [\n        'driver'     => 'local',\n        'root'       => storage_path('app/public'),\n        'visibility' => 'public',\n    ],\n\n    'media'  => [\n        'driver' => 'local',\n        'root'   => public_path('media'),\n    ],\n\n],\n\n];\n```\nThey are exactly the same as the ones working with Laravel. Maybe I did miss a namepsace conversion or something ?. @kickthemooon @iraklisg I didn't find any way to resolve this issue and also had trouble to use the same User object with both Lumen and Laravel, so I dropped my lumen api and use Laravel only :/. It definitely does, thanks Freek.\nI haven't notice anything related while playing with Laravel models and relations\nWas I lucky, or are the uploaded file size and the bit manipulations responsible of this delay ?. ",
    "aaronfullerton": "Whelp. I'm dumb. It was an issue with my queue handler. Thanks!\n. ",
    "dfoxxdfoxx": "I know it is a old issue but i am having a similar problem. Could one of you please tell me how this is fixed?. Sorry, already resolved.\nThis was a wrong setting in horizon.. ",
    "SoboLAN": "For anyone else ending up here with a similar issue:\n\nThe \"conversions\" are handled/generated by Laravel's queue-jobs\nIf your QUEUE_DRIVER env-variable is set to sync, then it will just generate them automatically\nIf, on the other hand, like in my case, it's set to something else (like database or redis etc.), then it will just insert those jobs in that queue\nTo process those jobs you'll have to either (a) manually run php artisan queue:work or (b) have some sort of automatic process that executes that command for you (like e.g. a cronjob). \n",
    "inov": "I do include the ServiceProvider. The custom_url_generator_class is blank because my files are stored locally:\n\n    /*\n     * When urls to files get generated this class will be called. Leave empty\n     * if your files are stored locally above the site root or on s3.\n     */\n    'custom_url_generator_class' => '',\n\n. yes did that as well. When I add the line below to my ServiceProvider booting method, the Error goes away, but is followed by another error.\n\n$this->app->bind(UrlGenerator::class, LocalUrlGenerator::class);\n\nand the error:\n\nErrorException in Arr.php line 152:\nInvalid argument supplied for foreach() \n\n. ",
    "thijsdemaa": "I too had this issue and it was caused by a mistake of my own. I had used route model binding to get to the Media class, however in this particular route i had used a different identifier. Therefor only the ID (1) was being given, and the type-hinted Media object in my controller had exist => false.\n. ",
    "pascalbaljet": "The primary reason I want this is to have relations between the Media model and other models. For example, I want to know who uploaded the media, so I now have a relationship with a User model.\n. This problem occurs when using 3.7.2 or later, 3.7.1 is fine.\n. Thanks!\n. ",
    "antonkomarev": "EntityTrait from Cartalyst Attribute package got public function delete() method already which is a wrapper over the default Model delete method.\nIf you want to use both of the traits in one model there is an error that delete method already exists in other trait. Renaming delete method in your package trait wouldn't work because in case of model delete it will be just skipped then.\nIs there a way to attach it as event?\n. This method is raising a conflict: https://github.com/spatie/laravel-medialibrary/blob/3.5.0/src/HasMedia/HasMediaTrait.php#L249\n. @hugofabricio @freekmurze I've shared my solution #182. Maybe you'll find it useful.\n. Thank you for the idea. I think it's a pretty good solution.\n. @freekmurze Excuse me that bumping up this issue again. But is there a way to upload media without attaching it to model with your package? Because in use case described by you 2nd point requires it.\n. So, in this case there is only way to add an hidden model which will hold all temporary records then. Because media could be uploaded before model is created.\nI know that's not a great behaviour, but customer want exactly this flow. Media uploaded > Model created.\n. Thanks again, Freek.\nNow I'm clearly see that I will need draft status not only for articles, pages and other common models which has it, but for users too.\n. I thought about using status field for states draft, unapproved, approved and etc... why do you prefer to have separate field for it?\n. @sonuku Yes, Freek said that in his first reply, I'm just trying to find the best way to do it. Right now I'm doing exactly what you've described. Saving file temporary and then move it from temporary directory to media library after model creation.\n. I will recheck why tests are failed. It works for me with this code.\n. I will close current PR and recreate a new one in separate feature branch with tests as soon as possible. To see problem you can change your test class this way:\n``` php\nclass TestModelWithoutMediaConversions extends Model implements HasMedia\n{\n    use HasMediaTrait;\nprotected $table = 'test_models';\nprotected $guarded = [];\npublic $timestamps = false;\n\npublic $morphClass = 'test-model';\n\n}\n``\n. I don't understand why build is failing on Relation dependency, because phpunit isn't dropping any alerts. Maybe because morph map was implemented only in early september? :\\\n. Yes... morphMap was introduced recently, but 2nd use case was implemented much earlier, but I don't know how to add support for it in smooth way.\n. Maybe we can just make hasMediaTrait usable by adding it's own boot method? This will fix an issue, I can provide a PR for it. And wouldn't change a behavior.\n. Already testing it. Will be pushed soon. There are problems only withdeletePreservingMedia` need to find a solution for it.\n. The last PR for the issue. I don't know any more ways to solve it :}\n. Changes are done. Anything else needed for this PR?\n. @freekmurze my pleasure to support such useful package.\n. Will do it from this one soon.\n. Code cleaned up & squashed.\n. I found already created ticket about delete query not firing events.\n. Okay, if you wish to add this functionality I can replicate it for v4. But... I'm not sure I know how to re-target current PR to another branch. I'll create a new one soon if I'll wouldn't find a way to do it.\n. Done. \n. @freekmurze You are welcome! Keep up a good job!\n. It looks like you are just bypassing image manipulations as array to the Glide, so it's Glide issue then :(\n. @freekmurze I thought about extending syntax like you provided, will have a time to dive deeper in this issue in the end of May.\nIs it ok if I will make it in media library v3? Current project where I need this feature can't have PHP7 on board because of old native PHP code which has a lot of deprecated functions, and thats why I can't move to v4 right now. Need time to migrate all the stuff to Laravel.\n. I'm pretty sure I will need it on v4 too on the other incoming project which don't have trash code under the hood :}\n. Ok sure! I'm in progress to dive in it.\n. @freekmurze This issue is very complicated than I've thought before. I can't see a way to implement it without full rewriting conversion class at this moment and maybe even more, or am I missed any light way to implement this? Or one thing I'm thinking about is adding one more class for Conversions - ConversionGroup which will be called instead of Conversions.\n. Here is my quick solution for this. I'm calling saveFileFromBase64() method  when checking upload from request if base64 found.\n``` php\n/\n * Get file content from base64 string.\n \n * @param $data\n * @return string\n /\nprivate function getBase64Content($data)\n{\n    list($type, $data) = explode(';', $data);\n    list(, $data) = explode(',', $data);\n    $data = base64_decode($data);\nreturn $data;\n\n}\n/\n * Saves temporary file from base64 string.\n \n * @param $filename\n * @param $data\n * @return File\n /\nprivate function saveFileFromBase64($filename, $data)\n{\n    $data = $this->getBase64Content($data);\n    file_put_contents($filename, $data);\n    $file = new File($filename);\nreturn $file;\n\n}\n``\n. @freekmurze it should be placed inaddMediaFromUrlbecause v3 don't haveaddMediaFromRequest` method or there are any other reasons to place it there? Base64 is not an URL and will come from request. Or you just meant to make one more public extra method to work only with base64 images?\n. @taliptako You can get an extension from example I've provided above:\nphp\nlist($type, $data) = explode(';', $data);\nlist(, $data) = explode(',', $data);\nlist(, $type) = explode(':', $type);\nlist(, $extension) = explode('/', $type);\n$data = base64_decode($data);\n- $data - file content.\n- $extension - file extension.\n- $type - file mime/type.\nBut there will be some issues with files which has mime/type like application/octet-stream or other non concrete types.\n. @taliptako I've updated an example. But I think there could be better ways to get file extensions already implemented in Intervention image library.\n. @taliptako Do you plan to make a PR for this feature?\n. @taliptako :sob: \n. Sorry for raising it again, but I have the same issue but with clean PHP and won't to duplicate issues.\nshell\n$ php -v\nPHP 7.0.9 (cli) (built: Jul 20 2016 17:07:04) ( NTS )\nCopyright (c) 1997-2016 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies\nI have clean laravel install with clean medialibrary.\n. Sorry, forgot to attach debug.\n\nIlluminate\\Foundation\\ComposerScripts::postInstall\nphp artisan optimize\nPHP Fatal error:  Default value for parameters with a class type hint can only be NULL in /www/dev.test.app/vendor/spatie/laravel-medialibrary/src/Media.php on line 52\n[Symfony\\Component\\Debug\\Exception\\FatalErrorException]\n Default value for parameters with a class type hint can only be NULL  \nScript php artisan optimize handling the post-install-cmd event returned with an error\n[RuntimeException]\n Error Output: PHP Fatal error:  Default value for parameters with a class type hint can only be NULL in /www/dev.test.app/vendor/spatie/laravel-medialibrary/src/Media.php on line 52 \n. Yes, that's really strange because on dev machine with older php it's working, and on staging it's raising an error.\n\nDev machine PHP:\nshell\nphp -v\nPHP 7.0.7 (cli) (built: May 31 2016 22:54:42) ( NTS )\nCopyright (c) 1997-2016 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies\nThe difference - DEV is on Ubuntu. Staging is CentOS.\n. @AlexVanderbist Maybe better to write it this way?\nphp\n        'public' => [\n            'driver' => 'local',\n            'root' => storage_path('app/public'),\n            'url' => public_path('storage'),\n            'visibility' => 'public',\n        ],\nOr it wouldn't work?. Yes, you are right.. I will be able check your PR changes today evening.. Fixed in #552 . @AlexVanderbist It's working. Thanks!. Okay. I've removed it. And removed docblock from determineOrderColumnName because by your logic it's self described too. Additionally resorted methods ordering (protected method determineOrderColumnName goes after all public ones).. @manogi I suppose you followed documentation and have in your model code:\nphp\npublic function registerMediaConversions()\n{\n   // Your code\n}\nBut interface was changed in laravel55 branch and it doesn't reflected in documentation because this branch is under development.\nTry to update method declaration to this one:\nphp\npublic function registerMediaConversions(Media $media = null)\n{\n    // Your code\n}\nOr use stable branch. Hope this helps.. Many-many relationship after then it become the only one solution for image galleries :+1: . No it could not. Because deleted event will be fired in this case and you will not be able to prevent media deletion. I've done so because unit tests were red.\nIf you are talking about replacing $this->deletePreservingMedia = true;\n\nThere were 2 failures:\n1) Spatie\\MediaLibrary\\Test\\HasMediaConversionsTrait\\DeleteMediaTest::it_will_not_remove_the_files_when_deleting_a_subject_and_preserving_media\nFailed asserting that false is true.\n2) Spatie\\MediaLibrary\\Test\\HasMediaTrait\\DeleteMediaTest::it_will_not_remove_the_files_when_deleting_a_subject_and_preserving_media\nFailed asserting that false is true.\n. @sebastiandedeyne what is the problem that deletePreservingMedia is setted to true? It's private and shouldn't be used outside of the class.\n. Ah... sure I will change it.\n. \n",
    "hugofabricio": "@freekmurze When will be fixed?\n. Thank you.\n. But also saves txt, doc, pdf, video and other formats?\n. Which version of the package you use ? 3.16\nDo you use windows? No, Mac os.\nHave you followed all the instructions of the package? Yes\nHave you made some changes to the configuration file? Without changing and changing has the same problem, only change to use another model.\nMy Actual Code:\nlaravel-medialibrary.php\n'media_model' => App\\Models\\Media::class,\nMedia.php\n```\n<?php\nnamespace App\\Models;\nuse Spatie\\MediaLibrary\\Media as BaseMedia;\nclass Media extends BaseMedia\n{\n}\n```\nUser.php\n```\n<?php\nnamespace App\\Models;\nuse Cartalyst\\Sentinel\\Users\\EloquentUser as SentinelUser;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nclass User extends SentinelUser implements HasMediaConversions\n{\nuse HasMediaTrait;\n\nprotected $fillable = [\n    'email',\n    'password',\n    'last_name',\n    'first_name',\n    'permissions',\n    'avatar'\n];\n\npublic function registerMediaConversions()\n{\n    $this->addMediaConversion('thumb')\n         ->setManipulations(['w' => 368, 'h' => 368]);\n}\n\n/**\n * Hidden fields on retrieve data\n */\nprotected $hidden = [\n    'password',\n    'remember_token'\n];\n\n/**\n * Return first_name and last_name of user\n */\npublic function getFullNameAttribute() {\n    return $this->first_name . ' ' . $this->last_name;\n}\n\n}\n```\nUsersController.php\n```\n<?php\nnamespace App\\Http\\Controllers\\Back;\nuse Illuminate\\Http\\Request;\nuse App\\Http\\Requests;\nuse App\\Http\\Controllers\\Controller;\nuse App\\Validators\\UserValidator;\nuse Prettus\\Validator\\Exceptions\\ValidatorException;\nuse Sentinel;\nuse Activation;\nuse Activity;\nclass UsersController extends BaseController\n{\n/**\n * @var [type]\n */\nprotected $validator;\n\n/**\n * @var [type]\n */\nprotected $users;\n\n/**\n * @var [type]\n */\nprotected $roles;\n\n/**\n * Construct\n */\npublic function __construct(UserValidator $validator)\n{\n    parent::__construct();\n    // Middlewares\n    $this->middleware('sentinel.access:back.users.read', ['only' => ['index']]);\n    $this->middleware('sentinel.access:back.users.write', ['only' => ['create', 'edit', 'destroy']]);\n    // Validator\n    $this->validator = $validator;\n    // Repositories\n    $this->users = Sentinel::getUserRepository();\n    $this->roles = Sentinel::getRoleRepository();\n}\n\n/**\n * Remove the specified resource from storage.\n *\n * @param  int  $id\n * @return \\Illuminate\\Http\\Response\n */\npublic function destroy($id)\n{\n    // Find user by id\n    if ($user = $this->users->find($id)):\n        // If user != user id logged\n        if ($id != Sentinel::Check()->id):\n            // Delete user\n            $user->delete();\n            // Success message\n            $message = \"Usu\u00e1rio <b>{$user->full_name}</b> exclu\u00eddo com sucesso.\";\n            // Create log\n            Activity::log($message, Sentinel::Check()->id);\n            // Success alert\n            flash()->success($message);\n        else:\n            // Error alert\n            flash()->warning('Voc\u00ea n\u00e3o pode excluir este usu\u00e1rio.');\n        endif;\n    endif;\n    // Redirect to users index\n    return redirect()->route('back.users.index');\n}\n\n}\n```\n. I'm sorry JolitaGrazyte, I tested now with other Model, worked perfectly, I will see what is happening can, I believe it is for is extending to the Cartalyst Sentinel.\n. @freekmurze This pr will be accepted?\n. For me this is also happening.\n. @roarkmccolgan solved? I have the same problem.. Hello,\nYes, Php 7.1 and Mysql 5.7\n. I update to php 7.2 and continue.\nWhen I comment the lines 164, 165 and remove the? of the Media Object on line 224 works normally.. \n. Sorry, @freekmurze my version is php 7.2 ,But I realized now that not using the docker worked normally, my mistake then, thanks for the help. I'm going to try to figure out what happened because I'm running php 7.2 running on docker and 7.1 in os.. ",
    "sonuku": "Hmm,\nCould you just upload, store reference to a temp file in session array/volatile state, then move/attach the file later using an ORM event?\nAll you\u2019d need to do was track a form unique id against your temp files, then hook into Laravel\u2019s saving event.\nSeems like more of an application workflow requirement than this libraries responsibility?\n. ",
    "judantus": "This is my code:\n        $model= $this->model;\n        try{\n            $item= $model::findOrFail($id);\n            $item->deleteMedia($request->id_media);\n            return \\Response::json(array(\n                'success'=> 200,\n                'request' => $request->id_media\n            ));\n        }\n        catch(\\Exception $exc)\n        {\n            return \\Response::json(array(\n                'error'=> $exc->getCode(), \n                'message'=>$exc->getMessage()\n            ));\n        }\nIn ajax call if the '$request->id_media' is null it does not catch the exception. \nThanks.\n. ",
    "dbpolito": "FYI, in case someone else needs it, i did this using my own model with this:\n```\n<?php\nnamespace App;\nuse Spatie\\MediaLibrary\\Media as BaseMedia;\nclass Media extends BaseMedia\n{\n    /*\n     * Boot events\n     * @return void\n     /\n    public static function boot()\n    {\n        parent::boot();\n    static::creating(function ($media) {\n        if ($user = auth()->getUser()) {\n            $media->user_id = $user->id;\n        }\n    });\n}\n\n/**\n * User relationship (one-to-one)\n * @return App\\User\n */\npublic function user()\n{\n    return $this->belongsTo('App\\User');\n}\n\n}\n```\nYou also have to create a migration to add column user_id.\n. > I would think that just using this config variable to set the temp directory should work for most users: https://github.com/spatie/laravel-medialibrary/blob/f3d8c33/config/medialibrary.php#L107\nThis won't work, because it uses sys_get_temp_dir() at https://github.com/spatie/image/blob/master/src/GlideConversion.php#L50. ",
    "dambridge": "Ah, great idea @dbpolito !\n. I guess now my challenge is figuring out how to do something like\ngetMedia($request->collection)->with('user')\n. Never mind, sorted, and thanks again for that. Sorry to necro-bump this issue!\n. Understood, thanks for the quick reply!\n. Huge! I know I'm pulling from dev-master atm, but what would a custom class look like to use the PathGenerator?\n. Ah, many thanks!\n. ",
    "naumanahmed19": "@freekmurze can you please update docs for this the solution @dbpolito suggested seems not working for \"^5.0.0\". ",
    "api42": "Thanks for quick reply. Yes I did. But on double checking. I tried restarting my CLI and now it works. \n. ",
    "aapiro": "How you do to restart your CLI?\n. ",
    "dsuryono": "just open a new terminal, and it worked... thanks @apurva2342\n. ",
    "RaoulDijksman": "Why didn't i think of that? Thank you! I was really over thinking this.\nBut the addMedia() function would create a new file for every user which is not really necessary. \nCreating a media model without making a copy of the default file wouldn't be possible because the remove function, which would be called once the user uploads his own file, would remove the default file.\nAm i over thinking this again? \nThanks again, you saved me some making a weird and complicated construction.\n. ",
    "kickthemooon": "Ok, great for the start.\nnow i want to have 3 conversions for profile pics, is this the right way?\n```\nclass User extends Model implements HasMediaConversions\n{\n    use HasMediaTrait;\npublic function registerMediaConversions()\n{\n    $this->addMediaConversion('thumb')\n         ->setManipulations(['w' => 368, 'h' => 232])\n         ->performOnCollections('avatars');\n\n    $this->addMediaConversion('medium')\n        ->setManipulations(['w' => 600, 'h' => 400])\n        ->performOnCollections('avatars');\n\n    $this->addMediaConversion('large')\n         ->setManipulations(['w' => 1000, 'h' => 700])\n         ->performOnCollections('avatars');\n}\n\n}\n```\nnext, does the library also handle the names of files? does it make the names unique?\n. and unfortunately, im also not sure how I set up a route for this? I want to send the post request to for example: UsersController@postProfilePic\ndo i need to pass any paramaters?\n. thanks Freek, thanks a lot. I hope i didnt bother too much, i hope your package will be very useful to me for some time.\n. is this ok?\n```\n'disks' => [\n    'local' => [\n        'driver' => 'local',\n        'root'   => storage_path('app'),\n    ],\n\n    'media' => [\n        'driver' => 'local',\n        'root'   => public_path().'/media',\n    ],\n\n    'profilesmedia' => [\n        'driver' => 'local',\n        'root'   => public_path().'/profilesmedia',\n    ],\n\n```\n. can I specify a disk here somewhere?\n$user->addMedia($request->file('file'))->toCollection('avatars');\n. how do i do that exactly:\n```\npublic function avatarUpload(Request $request, $slug)\n    {\n        $user = User::findBySlug($slug);\n    $user->addMedia($request->file('file'))->toCollection('avatars');\n\n    return 'working on it';\n}\n\n```\n. it is in the edit method above:\n$avatarthumb = $user->getMedia('avatars')->first()->getUrl('thumb');\n. :)\n. not why it didnt work, but now its fine\n. of course it is not a valid url but that is the output from:\n$user->getMedia('avatars')->first()->getUrl('medium');\nand this is my disk:\n'avatars' => [\n            'driver' => 'local',\n            'root'   => public_path().'/media/avatars',\n        ],\n. how would i look that up? not sure :(\n. i tried adding it like this but not working:\necho $this->getBaseMediaDirectory().'/'.$this->getPathRelativeToRoot();\nhmm\n. i did dd like this:\n```\npublic function getUrl()\n    {\n        if (!string($this->getStoragePath())->startsWith(public_path())) {\n            throw new UrlCouldNotBeDetermined('The storage path is not part of the public path');\n        }\n    dd($this->getBaseMediaDirectory().'/'.$this->getPathRelativeToRoot());\n\n    return $this->getBaseMediaDirectory().'/'.$this->getPathRelativeToRoot();\n}\n\n```\nthe out put is of course the same invalid url:\n\"\\media\\avatars/46/conversions/medium.jpg\"\n. now i did dd just on:\ndd($this->getBaseMediaDirectory());\nthe out put is:\nStr {#271 \u25bc\n  #string: \"\\media\\avatars\"\n}\n. \"C:\\wamp\\www\\larasilos\\public\\media\\avatars\"\n. this is the functions:\n```\nprotected function getStoragePath()\n    {\n        $diskRootPath = $this->config->get('filesystems.disks.'.$this->media->disk.'.root');\n    return realpath($diskRootPath);\n}\n\n```\nand in my case it returns this:\n\"C:\\wamp\\www\\larasilos\\public\\media\\avatars\"\n. any ideas?\nchrome is \"smart\" enough to display the image while firefox doesnt\n. I hope it'll be fixed soon :)\n. i managed to get it working, but it is probably a dirty way:\n```\npublic function getUrl()\n    {\n        if (!string($this->getStoragePath())->startsWith(public_path())) {\n            throw new UrlCouldNotBeDetermined('The storage path is not part of the public path');\n        }\n    return str_replace('\\\\','/',$this->getBaseMediaDirectory()).'/'.$this->getPathRelativeToRoot();\n}\n\n```\n. return $this->makeCompatibleForNonUnixHosts($url); \nnice :)\n. http://medialibrary.spatie.be/v3/basic-usage/retrieving-media/\nmaybe that can help you, hopefully.\n. this is a nice conversation hope it'll have positive effect on the media library\n. Could somebody help to change the media paths strategy to something like:\nPublic/media\n- 2015 (so the year as a folder )\n  - 01\n  - 02\n  - 03 ( month, so the month as a folder under the year folder )\n    - someimage.jpg\n    - someimage-300x300.jpg\n    - someimage-1024x686.jpg ( so the original and conversions under the month folder )\nany way to achieve this?\nor if no, could you suggest a nice, reliable and scalable folder structure, and how to implement it?\n@alexglue \n@freekmurze \n@cviebrock \n. \nthis is my user controller:\n```\n/*\n     * Profile / avatar upload\n     /\npublic function avatarUpload(Request $request, $slug)\n{\n    $user = User::findBySlug($slug);\n\n    $user->clearMediaCollection('avatars');\n\n    $user->addMedia($request->file('file'))->toCollectionOnDisk('avatars', 'avatars');\n\n    return 'Working on it';\n}\n\npublic function avatarDelete($slug)\n    {\n        $user = User::findBySlug($slug);\n    $user->clearMediaCollection('avatars');\n\n    return redirect('/user/' . $slug . '/edit');\n}\n\npublic function show($slug)\n    {\n        $user = User::findBySlug($slug);\n        if(!is_object($user->getMedia('avatars')->first())){\n            $thumbprofileimg = '/front/img/userimage.png';\n        } else {\n            $thumbprofileimg = $user->getMedia('avatars')->first()->getUrl('medium');\n        }\n    return view('front.users.show', compact('user', 'thumbprofileimg'));\n}\n\npublic function edit($slug)\n    {\n        if($slug != Auth::user()->slug) {\n        abort(403);\n\n    }else {\n\n    $user = User::findBySlug($slug);\n    if(!is_object($user->getMedia('avatars')->first())){\n        $thumbprofileimg = '/front/img/userimage.png';\n    } else {\n        $thumbprofileimg = $user->getMedia('avatars')->first()->getUrl('medium');\n    }\n\n    $cities = ['0'=>'Select country first'] + City::lists('city', 'id')->all();\n    $countries = ['0'=>'Select user country'] + Country::lists('country', 'id')->all();\n\n    return view('front.users.edit', compact('user', 'cities', 'countries', 'thumbprofileimg'));\n\n    }\n}\n\n```\n. I cant seem to be able to find any error logs that reference this issue.\nnothin in laravel.log nothin in php error log :(\n. another funny thing is that the image gets uploaded, but only the original and no conversions.\nTry and catch around the not working code exceeds my skills :(\n. hmm, no ideas?\n. like this:\n```\nuse Illuminate\\Auth\\Authenticatable;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Illuminate\\Auth\\Passwords\\CanResetPassword;\nuse Illuminate\\Contracts\\Auth\\Authenticatable as AuthenticatableContract;\nuse Illuminate\\Contracts\\Auth\\CanResetPassword as CanResetPasswordContract;\nuse Illuminate\\Support\\Facades\\Hash;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions;\nuse Zizaco\\Entrust\\Traits\\EntrustUserTrait;\nuse Cviebrock\\EloquentSluggable\\SluggableInterface;\nuse Cviebrock\\EloquentSluggable\\SluggableTrait;\nclass User extends Model implements AuthenticatableContract, CanResetPasswordContract, hasMedia,  HasMediaConversions, SluggableInterface\n{\n    use Authenticatable, CanResetPassword, EntrustUserTrait, HasMediaTrait, SluggableTrait;\npublic function registerMediaConversions()\n{\n    $this->addMediaConversion('thumb')\n        ->setManipulations(['w' => 60, 'h' => 60])\n        ->performOnCollections('avatars');\n\n    $this->addMediaConversion('medium')\n        ->setManipulations(['w' => 350, 'h' => 250, 'fit' => 'crop'])\n        ->performOnCollections('avatars');\n}\n\n```\ni have the same errors, did i implement it wrong?\n. im not sure but i think if i want to have media conversions, i only need to implement HasMediaConversions:\nhttp://medialibrary.spatie.be/v3/converting-images/defining-conversions/\nStill not working\n. just the 500 internal server error still :( and it is uploading the original just no creation of conversions\n. ```\nuse Illuminate\\Auth\\Authenticatable;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Illuminate\\Auth\\Passwords\\CanResetPassword;\nuse Illuminate\\Contracts\\Auth\\Authenticatable as AuthenticatableContract;\nuse Illuminate\\Contracts\\Auth\\CanResetPassword as CanResetPasswordContract;\nuse Illuminate\\Support\\Facades\\Hash;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions;\nuse Zizaco\\Entrust\\Traits\\EntrustUserTrait;\nuse Cviebrock\\EloquentSluggable\\SluggableInterface;\nuse Cviebrock\\EloquentSluggable\\SluggableTrait;\nclass User extends Model implements AuthenticatableContract, CanResetPasswordContract, HasMediaConversions, SluggableInterface\n{\n    use Authenticatable, CanResetPassword, EntrustUserTrait, HasMediaTrait, SluggableTrait;\n```\n. i will try something, when I manage to catch the error Ill report\n. and got this:\n```\nWhoops, looks like something went wrong.\n1/1\nInvalidArgumentException in Api.php line 60:\nNot a valid manipulator.\nin Api.php line 60\nat Api->setManipulators(array(object(Orientation), object(Rectangle), object(Size), object(Brightness), object(Contrast), object(Gamma), object(Sharpen), object(Filter), object(Blur), object(Pixelate), object(Output))) in Api.php line 31\nat Api->__construct(object(ImageManager), array(object(Orientation), object(Rectangle), object(Size), object(Brightness), object(Contrast), object(Gamma), object(Sharpen), object(Filter), object(Blur), object(Pixelate), object(Output))) in GlideApiFactory.php line 43\nat GlideApiFactory::create() in GlideImage.php line 99\nat GlideImage->save('C:\\wamp\\www\\baseapp\\storage\\medialibrary/temp/0oj6DPZaRxmdnbmZ/oKIX5wjtxnw4srNzthumb.jpg') in FileManipulator.php line 96\nat FileManipulator->performConversion(object(Media), object(Conversion), 'C:\\wamp\\www\\baseapp\\storage\\medialibrary/temp/0oj6DPZaRxmdnbmZ/a13fqEIQjJd4yhEq.jpg') in FileManipulator.php line 65\nat FileManipulator->performConversions(object(ConversionCollection), object(Media)) in PerformConversions.php line 38\nat PerformConversions->handle()\nat call_user_func_array(array(object(PerformConversions), 'handle'), array()) in Container.php line 503\nat Container->call(array(object(PerformConversions), 'handle')) in Dispatcher.php line 193\nat Dispatcher->Illuminate\\Bus{closure}(object(PerformConversions))\nat call_user_func(object(Closure), object(PerformConversions)) in Pipeline.php line 139\nat Pipeline->Illuminate\\Pipeline{closure}(object(PerformConversions))\nat call_user_func(object(Closure), object(PerformConversions)) in Pipeline.php line 103\nat Pipeline->then(object(Closure)) in Dispatcher.php line 205\nat Dispatcher->dispatchNow(object(PerformConversions), object(Closure)) in CallQueuedHandler.php line 43\nat CallQueuedHandler->call(object(SyncJob), array('command' => 'O:43:\"Spatie\\MediaLibrary\\Jobs\\PerformConversions\":5:{s:14:\"conversions\";O:51:\"Spatie\\MediaLibrary\\Conversion\\ConversionCollection\":1:{s:8:\"items\";a:2:{i:0;O:41:\"Spatie\\MediaLibrary\\Conversion\\Conversion\":4:{s:7:\"name\";s:5:\"thumb\";s:16:\"manipulations\";a:1:{i:0;a:2:{s:1:\"w\";i:60;s:1:\"h\";i:60;}}s:23:\"performOnCollections\";a:1:{i:0;s:7:\"avatars\";}s:17:\"performOnQueue\";b:1;}i:1;O:41:\"Spatie\\MediaLibrary\\Conversion\\Conversion\":4:{s:7:\"name\";s:6:\"medium\";s:16:\"manipulations\";a:1:{i:0;a:3:{s:1:\"w\";i:350;s:1:\"h\";i:250;s:3:\"fit\";s:4:\"crop\";}}s:23:\"performOnCollections\";a:1:{i:0;s:7:\"avatars\";}s:17:\"performOnQueue\";b:1;}}}s:8:\"media\";O:45:\"Illuminate\\Contracts\\Database\\ModelIdentifier\":2:{s:5:\"class\";s:25:\"Spatie\\MediaLibrary\\Media\";s:2:\"id\";i:58;}s:5:\"queue\";N;s:5:\"delay\";N;s:6:\"job\";N;}')) in Job.php line 129\nat Job->resolveAndFire(array('job' => 'Illuminate\\Queue\\CallQueuedHandler@call', 'data' => array('command' => 'O:43:\"Spatie\\MediaLibrary\\Jobs\\PerformConversions\":5:{s:14:\"conversions\";O:51:\"Spatie\\MediaLibrary\\Conversion\\ConversionCollection\":1:{s:8:\"items\";a:2:{i:0;O:41:\"Spatie\\MediaLibrary\\Conversion\\Conversion\":4:{s:7:\"name\";s:5:\"thumb\";s:16:\"manipulations\";a:1:{i:0;a:2:{s:1:\"w\";i:60;s:1:\"h\";i:60;}}s:23:\"performOnCollections\";a:1:{i:0;s:7:\"avatars\";}s:17:\"performOnQueue\";b:1;}i:1;O:41:\"Spatie\\MediaLibrary\\Conversion\\Conversion\":4:{s:7:\"name\";s:6:\"medium\";s:16:\"manipulations\";a:1:{i:0;a:3:{s:1:\"w\";i:350;s:1:\"h\";i:250;s:3:\"fit\";s:4:\"crop\";}}s:23:\"performOnCollections\";a:1:{i:0;s:7:\"avatars\";}s:17:\"performOnQueue\";b:1;}}}s:8:\"media\";O:45:\"Illuminate\\Contracts\\Database\\ModelIdentifier\":2:{s:5:\"class\";s:25:\"Spatie\\MediaLibrary\\Media\";s:2:\"id\";i:58;}s:5:\"queue\";N;s:5:\"delay\";N;s:6:\"job\";N;}'))) in SyncJob.php line 44\nat SyncJob->fire() in SyncQueue.php line 27\nat SyncQueue->push(object(PerformConversions)) in Dispatcher.php line 269\nat Dispatcher->pushCommandToQueue(object(SyncQueue), object(PerformConversions)) in Dispatcher.php line 244\nat Dispatcher->dispatchToQueue(object(PerformConversions)) in Dispatcher.php line 176\nat Dispatcher->dispatch(object(PerformConversions)) in DispatchesJobs.php line 18\nat FileManipulator->dispatch(object(PerformConversions)) in FileManipulator.php line 148\nat FileManipulator->dispatchQueuedConversions(object(Media), object(ConversionCollection)) in FileManipulator.php line 42\nat FileManipulator->createDerivedFiles(object(Media)) in Filesystem.php line 41\nat Filesystem->add('C:\\wamp\\tmp/php8513.tmp', object(Media), '_downloadfiles_wallpapers_1920_1200_widescreen_color_pulse_wallpaper_abstract_3d_wallpaper_1920_1200_widescreen_75.jpg') in FileAdder.php line 306\nat FileAdder->toCollectionOnDisk('avatars', 'avatars') in UsersController.php line 28\nat UsersController->avatarUpload(object(Request), 'admin')\nat call_user_func_array(array(object(UsersController), 'avatarUpload'), array(object(Request), 'slug' => 'admin')) in Controller.php line 76\nat Controller->callAction('avatarUpload', array(object(Request), 'slug' => 'admin')) in ControllerDispatcher.php line 145\nat ControllerDispatcher->call(object(UsersController), object(Route), 'avatarUpload') in ControllerDispatcher.php line 93\nat ControllerDispatcher->Illuminate\\Routing{closure}(object(Request))\nat call_user_func(object(Closure), object(Request)) in Pipeline.php line 139\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request))\nat call_user_func(object(Closure), object(Request)) in Pipeline.php line 103\nat Pipeline->then(object(Closure)) in ControllerDispatcher.php line 95\nat ControllerDispatcher->callWithinStack(object(UsersController), object(Route), object(Request), 'avatarUpload') in ControllerDispatcher.php line 54\nat ControllerDispatcher->dispatch(object(Route), object(Request), 'App\\Http\\Controllers\\Front\\UsersController', 'avatarUpload') in Route.php line 204\nat Route->runWithCustomDispatcher(object(Request)) in Route.php line 135\nat Route->run(object(Request)) in Router.php line 685\nat Router->Illuminate\\Routing{closure}(object(Request))\nat call_user_func(object(Closure), object(Request)) in Pipeline.php line 139\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in AuthorizeMiddleware.php line 38\nat AuthorizeMiddleware->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(AuthorizeMiddleware), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in Authenticate.php line 45\nat Authenticate->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(Authenticate), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request))\nat call_user_func(object(Closure), object(Request)) in Pipeline.php line 103\nat Pipeline->then(object(Closure)) in Router.php line 687\nat Router->runRouteWithinStack(object(Route), object(Request)) in Router.php line 660\nat Router->dispatchToRoute(object(Request)) in Router.php line 636\nat Router->dispatch(object(Request)) in Kernel.php line 236\nat Kernel->Illuminate\\Foundation\\Http{closure}(object(Request))\nat call_user_func(object(Closure), object(Request)) in Pipeline.php line 139\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in VerifyCsrfToken.php line 64\nat VerifyCsrfToken->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(VerifyCsrfToken), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in ShareErrorsFromSession.php line 49\nat ShareErrorsFromSession->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(ShareErrorsFromSession), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in StartSession.php line 62\nat StartSession->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(StartSession), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in AddQueuedCookiesToResponse.php line 37\nat AddQueuedCookiesToResponse->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(AddQueuedCookiesToResponse), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in EncryptCookies.php line 59\nat EncryptCookies->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(EncryptCookies), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request)) in CheckForMaintenanceMode.php line 42\nat CheckForMaintenanceMode->handle(object(Request), object(Closure))\nat call_user_func_array(array(object(CheckForMaintenanceMode), 'handle'), array(object(Request), object(Closure))) in Pipeline.php line 124\nat Pipeline->Illuminate\\Pipeline{closure}(object(Request))\nat call_user_func(object(Closure), object(Request)) in Pipeline.php line 103\nat Pipeline->then(object(Closure)) in Kernel.php line 122\nat Kernel->sendRequestThroughRouter(object(Request)) in Kernel.php line 87\nat Kernel->handle(object(Request)) in index.php line 54\n.\npublic function registerMediaConversions()\n    {\n        $this->addMediaConversion('thumb')\n            ->setManipulations(['w' => 60, 'h' => 60])\n            ->performOnCollections('avatars');\n    $this->addMediaConversion('medium')\n        ->setManipulations(['w' => 350, 'h' => 250])\n        ->performOnCollections('avatars');\n}\n\n```\nthts it, im not sure whats wrong there?\n. did you update your media library where you are using it?\nsomething is wrong with the orientation argument for glide, thats where things brake down.\nI found this function:\n```\n/*\n     * Set the manipulators.\n     * @param array $manipulators Collection of manipulators.\n     /\n    public function setManipulators(array $manipulators)\n    {\n        foreach ($manipulators as $manipulator) {\n            dd($manipulator);\n            if (!($manipulator instanceof ManipulatorInterface)) {\n            throw new InvalidArgumentException('Not a valid manipulator.');\n        }\n    }\n\n    $this->manipulators = $manipulators;\n}\n\n```\n. The basic error is of course:\nInvalidArgumentException in Api.php line 60:\nNot a valid manipulator.\nwhen i dd here:\n```\n/*\n     * Set the manipulators.\n     * @param array $manipulators Collection of manipulators.\n     /\n    public function setManipulators(array $manipulators)\n    {\n        foreach ($manipulators as $manipulator) {\n        if (!($manipulator instanceof ManipulatorInterface)) {\n            dd($manipulator);\n            throw new InvalidArgumentException('Not a valid manipulator.');\n        }\n    }\n\n    $this->manipulators = $manipulators;\n}\n\n```\ni get: \nOrientation {#336}\nand then it throws \"Not a valid manipulator\"\nthe conversions are still the same:\n```\npublic function registerMediaConversions()\n    {\n        $this->addMediaConversion('thumb')\n            ->setManipulations(['w' => 60, 'h' => 60])\n            ->performOnCollections('avatars');\n    $this->addMediaConversion('medium')\n        ->setManipulations(['w' => 350, 'h' => 250])\n        ->performOnCollections('avatars');\n}\n\n```\n. i have no idea, it came with the media library its laravel glide i think that is within the media library\n. I summerized everthing I know in the first post of this issue (edited the post) @freekmurze \nIf you have any ideas on how to continue trying to debug this please let me know.\n. i did composer require league glide and composer update again, everything is working fine now\n. could I use collections for the purpose of galleries?\n. its a travel booking app.\nNow I need the travel offer to have a gallery? :)\n. it can handle it like this :) \n. I need to get media from a certain collection?\n. difficutlt to understand.\nLets say I have $mymodel and a collection 64\nhow would I grap these urls from that collection 64?\n. yes\n. great, thanks a lot @sebastiandedeyne I will try that\n. ok, is there a chance now to get and array with value to be the url and the key to be the id of that image in the media table?\n. the response I get is this:\n```\n{50: \"/media/50/twitter cover photos for new year 2016.png\", 51: \"/media/51/174920-1280.png\",\u2026}\n50: \"/media/50/twitter cover photos for new year 2016.png\"\n51: \"/media/51/174920-1280.png\"\n52: \"/media/52/instagram-followers.jpg\"\n```\nis this ok? look strange to me this array :)\n. ok, yes thats what I want. I know im asking too much, but do you know how I would use this response in a javascript loop? I need to loop through this and reference the key and value in the loop?\nAny suggestions?\n. ok, but do I actually type \"myUrls\" I mean do I reference the response json array like that?\nor is the object.keys actually handling that?\n. i dont see spatie/laravel-medialibrary in your compose.json. I see spatie/laravel-sluggable?\nbut yea I am having the same issue as you do @binalfew \n. And the error output is just huge here is the start of it.\n```\nYour requirements could not be resolved to an installable set of packages.\nProblem 1\n    - Conclusion: don't install spatie/laravel-medialibrary 3.11.3\n    - Conclusion: don't install spatie/laravel-medialibrary 3.11.2\n    - Conclusion: don't install spatie/laravel-medialibrary 3.11.1\n    - Conclusion: remove symfony/debug v3.0.0\n    - Installation request for spatie/laravel-medialibrary ^3.11 -> satisfiable by spatie/laravel-medialibrary[3.11.0, 3.11.1, 3.11.2, 3.11.3].\n    - Conclusion: don't install symfony/debug v3.0.0\n    - spatie/laravel-medialibrary 3.11.0 requires spatie/laravel-glide ^2.2.4 -> satisfiable by spatie/laravel-glide[2.2.4, 2.2.5, 2.2.6, 2.2.7, 2.2.8].\n    - spatie/laravel-glide 2.2.4 requires league/glide 0.3. -> satisfiable by league/glide[0.3.0, 0.3.1, 0.3.2, 0.3.3, 0.3.4, 0.3.5].\n    - spatie/laravel-glide 2.2.5 requires league/glide 0.3. -> satisfiable by league/glide[0.3.0, 0.3.1, 0.3.2, 0.3.3, 0.3.4, 0.3.5].\n    - spatie/laravel-glide 2.2.6 requires league/glide 0.3. -> satisfiable by league/glide[0.3.0, 0.3.1, 0.3.2, 0.3.3, 0.3.4, 0.3.5].\n    - spatie/laravel-glide 2.2.7 requires league/glide 0.3. -> satisfiable by league/glide[0.3.0, 0.3.1, 0.3.2, 0.3.3, 0.3.4, 0.3.5].\n    - spatie/laravel-glide 2.2.8 requires league/glide 0.3.* -> satisfiable by league/glide[0.3.0, 0.3.1, 0.3.2, 0.3.3, 0.3.4, 0.3.5].\n    - league/glide 0.3.0 requires symfony/http-kernel ~2.3 -> satisfiable by symfony/http-kernel\n```\n. yes, but thought these were issues related to the media library, :) \ni am just saying you dont have media library in you composer.json\nand thanks for the tip about php 7 optimisation. im still using cviebrock/eloquent-sluggable\n. @binalfew add spatie/laravel-medialibrary to your composer.json\n\"require\": {\n        \"php\": \">=5.5.9\",\n        \"laravel/framework\": \"5.2.*\",\n        \"laravelcollective/html\": \"^5.2\",\n        \"cviebrock/eloquent-sluggable\": \"^3.1\",\n        \"spatie/laravel-medialibrary\": \"^3.11\"\n    },\nAnd then use \"composer update\" in your terminal / CLI , and everything should be fine and get installed.\n. the three dots? do I have to write something additional there?\n. hope im not asking too much.\nId like to add a custom property, 'title' and 'subtitle' but on an existing media record?\n. dont know whats wrong...\n```\npublic function imgDesc(Request $request, $imgid) {\n    $image = Media::find($imgid);\n\n    $title = $request->input('title');\n    $desc = $request->input('desc');\n\n    $image->setCustomProperty('title', $title);\n    $image->setCustomProperty('subtitle', $desc);\n\n    return redirect('/admin/gallery/1');\n\n}\n\n```\nUnfortunately this is not saving anything to the db, everything goes through, no error no nothing but its not saved in the db under custom_properties.\nAny ideas?\n. haha, works, thanks Freek.\n. Sebastian you rock :)\nwill try it if I have problems i'll get back to you. thanks.\n. I have a method and model for my media library uploads:\n```\npublic static function storeGallery(Request $request, $model, $collection, $disk='media') {\n    $model->addMedia($request->file('file'))->withCustomProperties(['title_en'=>'', 'subtitle_en'=>'', 'title_ba'=>'', 'subtitle_ba'=>''])->toCollectionOnDisk($collection, $disk);\n    return 'Media was saved successfully!';\n\n}\n\n```\nnow at this point id like use the ffmpeg to make a thumbnail of that video I uploaded with something like this:\n```\n$frame = 10;\n$movie = 'test.mp4';\n$thumbnail = 'thumbnail.png';\n$mov = new ffmpeg_movie($movie);\n$frame = $mov->getFrame($frame);\nif ($frame) {\n    $gd_image = $frame->toGDImage();\n    if ($gd_image) {\n        imagepng($gd_image, $thumbnail);\n        imagedestroy($gd_image);\n    }\n}\n```\nAnd after this id like to store it with the file under conversions so I can query it later.\nWhat do you think of this idea, could you help me a little\n. i can upload videos with media library already tried it, and it gets saved as any other media.\nnow, when i manage to get this thumbnail generated with ffmpeg I would love to save it in the folder the video got saved to under conversions. I mean i hope you understand what I mean.\nId like to know how I can make this conversion folder that gets created for the other images.\nAny idea?\n. I am using this middleware, maybe it is buggy? :\n```\nclass AuthorizeMiddleware {\npublic function __construct(Guard $auth, Permission $permission)\n{\n    $this->auth = $auth;\n    $this->permission = $permission;\n}\n\n/**\n * Handle an incoming request.\n *\n * @param  \\Illuminate\\Http\\Request  $request\n * @param  \\Closure  $next\n * @return mixed\n */\npublic function handle($request, Closure $next)\n{\n    $user = $this->auth->user();\n\n    $permissions = $this->permission->all();\n\n    $uri = $request->route()->uri();\n\n    foreach($permissions as $permission)\n    {\n        if( ! $user->can($permission->name) && $permission->route == $uri)\n        {\n            abort(403);\n        }\n    }\n\n    return $next($request);\n}\n\n}\n```\n. I mean I have no idea how requests that are not handled by my routes get directed to glide?\n. that was it. thanks.\n. i was looking at that but unfortunately im not sure how i would use it in my mapping to \nONLY \nget images where the custom property \"youtube_url\" is empty or to \nONLY \nget the images that have something saved to that property.\n. Working fine with filtering, thanks.\n. no it was much more severe lol, i forgot implements HasMediaConversions and use HasMediaTrait :)\n. @Crinsane Did you try Freek's suggestion? does it work?\n. @borealsmith I solved this by using the customUrlGenerator. after setting up a custom url generator as @freekmurze suggested it, the symlink was working without issues.. i realized what it is.\nI have 3.17.\nCant install 4.0 because i dont have php 7\n:(\npitty\n. I did dd() on $temp = tmpfile();\nstream resource @267 \u25bc\n  wrapper_type: \"plainfile\"\n  stream_type: \"STDIO\"\n  mode: \"r+b\"\n  unread_bytes: 0\n  seekable: true\n  uri: \"C:\\Windows\\Temp\\php13E9.tmp\"\n  timed_out: false\n  blocked: true\n  eof: false\n  options: []\n}\nthis is my controller part\n```\n$images = $request->file('images');\n    foreach($images as $image){\n        $report->addMediaFromRequest($image)->toCollection('medical-reports');\n    }\n\n```\nthis is dd() on $images\narray:1 [\u25bc\n  0 => UploadedFile {#363 \u25bc\n    -test: false\n    -originalName: \"11082663_10205108991016758_689124932158641809_n.jpg\"\n    -mimeType: \"image/jpeg\"\n    -size: 42149\n    -error: 0\n    path: \"C:\\wamp64\\tmp\"\n    filename: \"php95FE.tmp\"\n    basename: \"php95FE.tmp\"\n    pathname: \"C:\\wamp64\\tmp\\php95FE.tmp\"\n    extension: \"tmp\"\n    realPath: \"C:\\wamp64\\tmp\\php95FE.tmp\"\n    aTime: 2016-05-12 10:21:16\n    mTime: 2016-05-12 10:21:16\n    cTime: 2016-05-12 10:21:16\n    inode: 0\n    size: 42149\n    perms: 0100666\n    owner: 0\n    group: 0\n    type: \"file\"\n    writable: true\n    readable: true\n    executable: false\n    file: true\n    dir: false\n    link: false\n    linkTarget: \"C:\\wamp64\\tmp\\php95FE.tmp\"\n  }\n]\nthis is my form\n<form  method=\"POST\" action=\"/dashboard/nalaz/dodaj/{{ $patients->id}}\" enctype=\"multipart/form-data\">\n    <input type=\"file\" name=\"images[]\">\n</form>\n. I got confused by the fact that I couldn't simply take an request array and use the addMediaFromRequest method in a loop.\n. Its ok. querying the media table directly works fine:\n$media = Media::where('model_type', 'App\\MediaLibrary')->orderBy('id', 'desc')->get();\nI got a little confused, thought some methods wont work but everythings alright :)\n. It's fine now.\nNot sure why, but I had to reference the foreign key:\npublic function featuredImage(){\n    return $this->belongsTo('App\\Media', 'media_id');\n}\nBut its working now.\n. not sure how and why but now its working, change the a bit around and its ok now.\n. not sure if it has something to do with event being fired:\n```\npublic function clearMediaCollection(string $collectionName = 'default')\n    {\n        $this->getMedia($collectionName)->map(function (Media $media) {\n            app(Filesystem::class)->removeFiles($media);\n            $media->delete();\n        });\n    event(new CollectionHasBeenCleared($this, $collectionName));\n\n    return $this;\n}\n\n```\nat the moment i am solving it like this:\n$item = $object->addMedia($file)->toCollection($collectionName);\n$media = Media::find($item['attributes']['id']);\nso this gives me the exact media object so everything works fine\n. @freekmurze the HasMediaTrait has this updateMedia() method. Am not sure but maybe this could help with this issue. Can you share an example of how to use this method, updateMedia()?\nOtherwise I tried to return false in the MediaRepository mediaIsPreloaded() and it works, but not sure if thats good.... I am on windows using wamp so the problem is getting imagemagic installed.. I am looking for:\n$newsItem->getMediaConversions() as $conversion\nBut only for a collection, not all conversions for the model :). I would also love to know where this method is located: \ngetMediaConversions()\nBecause I can't seem to able to find it even though I'm using it successfully.\nThis is my composer.json medialibrary part:\n\"spatie/laravel-medialibrary\": \"^4.9\". This what I'm using:\n```\n@foreach($settings->getMediaConversions() as $conversion)\n    {{ str_replace('_', ' ', $conversion->getName()) }}\n@foreach($conversion->getManipulations() as $manipulation) \n{{ $manipulation['w'] }}x{{ $manipulation['h'] }} \n@endforeach\n\n@endforeach\n```\nI have no idea where that method is located at :D\nBut it works as expected. $model->mediaConversions looks also interesting. I will consider it in the future.\nThanks.. @loranger Having the same error. Did you manage to solve anything?. ok, ill try to configure the ftp driver.\nthanks.. This is my method where I store the uploaded file instance:\n```\n/*\n     * Store a file to the media library.\n     * @param string|\\Symfony\\Component\\HttpFoundation\\File\\UploadedFile $file\n     * @return mixed\n     /\npublic static function storeFile($file){\n    $mediaLibrary = MediaLibrary::first();\n    $item = $mediaLibrary->addMedia($file)\n        ->withCustomProperties(['title'=>'', 'caption'=>''])\n        ->preservingOriginal()\n        ->toMediaLibrary();\n    $media = Media::find($item['attributes']['id']);\n    return $media;\n}\n\n. The solution is:\n$conversion->getManipulations()->getManipulationArgument('width')\n```. ",
    "vladvisinescu": "Following this issue, I cant store images to a subfolder of \"media\" using the toMediaLibraryOnDisk() method.\nWhat am I missing ?\n. Youre were right. Thanks! . ",
    "danilogkir": "well, when i try the solution that @freekmurze gave i'm getitng:\nSQLSTATE[HY093]: Invalid parameter number (SQL: select * from `media` where `media`.`id` in (6, App\\Company, 5, icons, avatar, avatar.png, image/png, public, 20204, 6, 2018-09-09 03:35:27, 2018-09-09 03:35:27, ?, ?, ?))\nMy code: \npublic function updateCompanyIcon($identifier, Request $request){\n        $identifier = Company::where('identifier', $identifier)->first();\n        $oldicon = $identifier->getFirstMedia('icons');\n        $media = Media::find($oldicon)->name = $request->icon;\n        $media->save();\n        return redirect::back();\n    }. ",
    "alexglue": "@freekmurze your're right! my fault, an old migration with the same name was already installed earlier; thanx!\n. @freekmurze so, in case of user's avatar upload i should do this:\n$filename = md5($request->file('image')->getClientOriginalName()) . '.' . $request->file('image')->getClientOriginalExtension();\n            $user->clearMediaCollection('avatar');\n            $user->addMedia($request->file('image'))->setFileName($filename)->toCollection('avatar');\nThis looks strange ) I've some feature request for you:\nCould you just append callback/event or user-defined function to rename files by default?\nAlso, it will be nice to set \"single-file\" mode in model media settings, or add replaceMedia() or something like that.\n. also,it's dangerouse to generate directory name for storing and getUrl() separately:\n//vendor/spatie/laravel-medialibrary/src/UrlGenerator/BaseUrlGenerator.php:64\n    public function getPathRelativeToRoot()\n    {\n        $path = $this->media->id;\n. argh, i'm sorry for bothering you, but \npublic function getMediaDirectory(Media $media)\n    {\n        $this->filesystems->disk($media->disk)->put('.gitignore', Gitignore::getContents());\nthis is extremely bad idea.\nWhat if i use SUBVERSION? What if i don't use LOCAL storage?\nDamn, this is not SOLID! Why some getter should CREATE .gitignore file???\n. @freekmurze You WILL have a perfomance troubles on highload and large count of files. You could read this stackoverflow, etc for more info: http://stackoverflow.com/questions/19212766/user-uploads-folder-structure\nJust FYI: this is how I solved this:\n```\n//vendor/spatie/laravel-medialibrary/src/Filesystem.php:111\n    public function getMediaDirectory(Media $media)\n    {\n        $directory = $this->getMediaDirectoryName($media);\n        $this->filesystems->disk($media->disk)->makeDirectory($directory);\n    return $directory;\n}\n\npublic function getMediaDirectoryName(Media $media)\n{\n    $filename = pathinfo($media->file_name, PATHINFO_FILENAME);\n\n    return implode(DIRECTORY_SEPARATOR, array_slice(str_split($filename, 3), 0, 3)) . DIRECTORY_SEPARATOR . $media->id;\n}\n\n```\n```\n//vendor/spatie/laravel-medialibrary/src/FileAdder/FileAdder.php:100\n    public function setFile($file)\n    {\n        $this->file = $file;\n    if (is_string($file)) {\n        $this->pathToFile = $file;\n        $this->fileName   = md5($file) . pathinfo($file, PATHINFO_EXTENSION);\n        $this->mediaName  = basename($file);\n\n        return $this;\n    }\n\n    if ($file instanceof UploadedFile) {\n        $this->pathToFile = $file->getPath().'/'.$file->getFilename();\n        $this->fileName   = md5($file->getClientOriginalName()) . '.' . $file->getClientOriginalExtension();\n        $this->mediaName  = $file->getClientOriginalName();\n\n        return $this;\n    }\n\n    throw new FileCannotBeImported('Only strings and UploadedFileObjects can be imported');\n}\n\n```\n```\n//vendor/spatie/laravel-medialibrary/src/UrlGenerator/BaseUrlGenerator.php:63\n    public function getPathRelativeToRoot()\n    {\n        $path = app(Filesystem::class)->getMediaDirectoryName($this->media);\n    if (is_null($this->conversion)) {\n        return $path.'/'.$this->media->file_name;\n    }\n\n    return $path.'/conversions/'.$this->conversion->getName().'.'.\n        $this->conversion->getResultExtension($this->media->extension);\n}\n\n```\nSo now I got one-point of directory name rendering, and no any troubles with collisions and perfomance failing.\n. @kickthemooon This is what i'm using at the moment:\nThe structure is like \n/a4f/ad3/f0c/104/file.jpg\n/a4f/ad3/f0c/104/c/thumb.jpg\n*104 is media_id\n```\n//config/filesystems.php:\n    'media' => [\n        'driver' => 'local',\n        'root'   => public_path().'/shared/media',\n    ],\n\n```\n//config/laravel-medialibrary.php:\n//...\n'custom_path_generator_class' => App\\Services\\MediaLibrary\\MediaLibraryPathGenerator::class,\nand custom path generator:\n```\nclass MediaLibraryPathGenerator implements PathGenerator\n{\n    /\n     * Get the path for the given media, relative to the root storage path.\n     \n     * @param \\Spatie\\MediaLibrary\\Media $media\n     \n     * @return string\n     */\n    public function getPath(Media $media)\n    {\n        $parts = [\n            implode(DIRECTORY_SEPARATOR, array_slice(str_split(md5($media->getKey()), 3), 0, 3)),\n            $media->getKey()\n        ];\n    return implode(DIRECTORY_SEPARATOR, $parts) . DIRECTORY_SEPARATOR;\n}\n\n/**\n * Get the path for conversions of the given media, relative to the root storage path.\n *\n * @param \\Spatie\\MediaLibrary\\Media $media\n *\n * @return string\n */\npublic function getPathForConversions(Media $media)\n{\n    return implode(DIRECTORY_SEPARATOR, [$this->getPath($media), 'c' . DIRECTORY_SEPARATOR]);\n}\n\n}\n```\n@freekmurze @cviebrock \nIt will be nice if only i could store its like /file.thumb.jpg instead of /c/thumb.jpg.\nAlso it will be nice if only i could store it WITHOUT media_id in path.\nBut unsuccessfully i can't do it with current version (\nSo, it is possible to have a lot of troubles with media_id in future when i would like to move some files physically or id_sequence will broken.\n. @cviebrock , @freekmurze And why don't you rename the original filename to something like hash-looked-like? \nI want to get files named like \"\u041c\u043e\u0439 \u043a\u0440\u0443\u0442\u043e\u0439 \u0444\u0430\u0439\u043b \u043b\u043e\u043b.jpg\", it could make a lot of troubles with that.\n. @cviebrock @freekmurze Ok, nice. and could you tell me what Custom Path Generator do you use actually?\nLet me explain you what i mean:\n1) You upload first file, and it stored to /62/93/62933a2951ef01f4eafd9bdf4d3cd2f0/file.jpg\n2) Conversions stored as /62/93/62933a2951ef01f4eafd9bdf4d3cd2f0/c/thumb.jpg\n3) Some time later you want to upload another one, and (surprise!) you've got a collision!\nfile stores as /62/93/62933a2951ef01f4eafd9bdf4d3cd2f0/file2.jpg,\nBUT all conversions stores as /62/93/62933a2951ef01f4eafd9bdf4d3cd2f0/c/thumb.jpg, like in (2).\nWhat would you do with it?\n```\n    public function getPath(Media $media)\n    {\n        return implode(DIRECTORY_SEPARATOR, array_slice(str_split(md5($media->getKey()), 2), 0, 2)) . DIRECTORY_SEPARATOR . md5($media->getKey()) .  DIRECTORY_SEPARATOR;\n    }\npublic function getPathForConversions(Media $media)\n{\n    return implode(DIRECTORY_SEPARATOR, [$this->getPath($media), 'c' . DIRECTORY_SEPARATOR]);\n}\n\n```\n. ",
    "nguyentranchung": "how can I change file name with setFileName() and keep extension file?. Has this problem been resolved yet? Im using v7, xampp with gd bundled (2.1.0 compatible) and same problem\n\n. same problem, and cannot remove folder when insert new image. \n\nBonus image. @ysfkaya thanks man, I modified it to nginx and it works fine.\nThis issue will close.. ",
    "ato10": "$item->addMedia(...)->preservingOriginal()->toCollection('images');\nworks great\n$item->addMediaFromUrl(...)->toCollection('images');\ndoesn't work using the same conversion definition\npublic function registerMediaConversions()\n    {\n        $this->addMediaConversion('thumb')\n             ->setManipulations(['w' => 78, 'h' => 78])\n             ->performOnCollections('images');\n    }\n. OK sorry, my bad.\nThe problem is on .gif files extension.\nCan I force another extension on downloaded images?\nThanks in advance\n. never mind, I found it.\nThanks for great work\n. ",
    "huglester": "Hello,\nif I understand correct, you are refering to google insights, or google mobile check or something like that.\nImage optimization/compression/cleaning (lossless maybe) is a 'heavy' work, 1 image optimization (I believe) could be from 1 up to 5 seconds or so. SOme GO packages may do it a lot faster than php (maybe even in lossless mode), but this one probably requires some 'post processing', usually done by queues or osmething like that.\nBecause otherwise if user first visits the page, an images will need to be generated/optimized (ie. 10 images) it would hand for a minute.\nBut it's a good idea/call - maybe someone could share some libs for lossless ocmporession even in php:) I would like to see them too!\n. Actually dropzone should be 'posting' files one by one, no?\n. Hello,\nthis is nice. \nHad similar issue few days ago.\nI just imported all photos, and later altered DB using other script.\nthis will make life easier:)\n. hello @vesper8 \nMay I ask you offtopic, what library do you use for face detection?. Thank you for information :). ",
    "erikbelusic": "What are you planning on doing? I've left this alone as other items became far more important in the app, and I switched companies so I'm not working on it anymore now.\nWhen I look at how WP plugins handle this, they seem to delegate to optipng or something similar creating very high cpu usage so I'm curious what solution you have in mind?\nThe solution may turn out to be a separate package that can both do it locally, or use a different box, or delegate to a service that can do it in the cloud. Not sure!\n. ",
    "gitllermopalafox": "Hi, recently I found this site http://cloudinary.com/ (I haven't tried it yet) maybe it could help you.\n. ",
    "taliptako": "@freekmurze  If we compress files after the conversion we should also compress their conversions and its mean more processor load but if we do this before the conversions, conversions will also created with compressed image and its mean they will smaller like original image isnt it ?\nAlso maybe you can look this package https://github.com/approached/laravel-image-optimizer\n. I'm using cropit in my project  and with this plugin users pick a photo and crop it.\nThis plugin create base64 code for this image also other popular similiar tools do the same.\nSo i should save this image to my media library easily but i cant, only i can do is decode this code and after save it with file_put_contents function\n. I have problem with picture extensions because before sending my picture to AddMedia i should save it to somewhere and i think i should use temporary folder for this.But i cant save temporary file with extension(not sure).\n\n$tmpFile = tempnam(sys_get_temp_dir(), 'media-library');\n        file_put_contents($tmpFile, $stream);\n        $filename = basename(parse_url($url, PHP_URL_PATH));\n\nThis code snippet from addMediaFromUrl function in this example you get extension from url but if i save my picture to temporary folder i cant send you a image path with extension for this media library save pictures without extensions.\nWe should find best way to do this.\nAnd i thought maybe we can use this code in AddMedia i find this code from this package.\nhttps://github.com/Intervention/image\n\n/**\n * Determines if current source data is base64 encoded\n *\n * @return boolean\n */\npublic function isBase64()\n{\n    if (!is_string($this->data)) {\n        return false;\n    }\n    return base64_encode(base64_decode($this->data)) === $this->data;\n}\n. @a-komarev Thank you i will use your example until the new feature.\n. @a-komarev Actually no :) Should i close the issue ?\n. I can fix styleci error if you accept this pull patch\n. I'm trying to create media  and my media also have title and desc fields.When user create media without file just with title and desc i'm creating media like this $post->media()->create($fields); and i'm just getting error from Finfo i dont understand why because i'm not adding it from $post->addMedia();\n. @nicolasbeauvais @freekmurze  Why cant we set this from media library config ?\nThere is a image_driver config which we can set gd or imagick but its not working.GD working always in all situations. Actually all files and folders owned by my user excepts storage  they are owned by www-data and also group and i still didnt find any solution and what cause to this problem.On the resize process php-gd extension is using by this library maybe its because of this extension bug or something idk\nI have Ubuntu 16.04.1 with default LEMP stack and all packages are up-to date and i only used to official ubuntu repositories\n. Here is the stack trace https://kopy.io/J9iil#UbuiI9rPGhLeL8\nI'm sure that i set my image driver to imagick but as you said probably gd is still used somewhere behind scene.. @brendt Unfortunately still same ... @brendt I think we should add a method for configuring image driver globally in medialibrary package and it should set driver for spatie/image only one time\n and then we dont need to add ->useImageDriver(config('medialibrary.image_driver')) method when we use Image::load() because in some places you guys didnt use ->useImageDriver(config('medialibrary.image_driver')) so this causing an error.\nI just search in this package for usages of Image::load() and add all of them ->useImageDriver(config('medialibrary.image_driver')) method and its works now. But instead of doing this i think we should have one method for setting image driver.. \n",
    "thorem": "Thank you for the quick fix\n. ",
    "palypster": "@freekmurze we are looking for a solution of this same problem. We found your proposed solution mentioned couple of times in these GitHub issues (by you or your colleagues), we discussed a lot about it, but we see a problem - maybe you also addressed this issue before.\n\nthe problem we are dealing is, that what we need is final URL of the media before the model is saved. We are creating a meadia library for a WYSIWYG editor. Imagine you are creating a new Blogpost (the model is not saved yet). We were thinking, maybe we can create a Medium and attach it to the model later. Is there a way to do it with v7? With proposed \"draft\" solution has many drawbacks (i.e. use of events is harder, maybe some logging, you need to scope every query so you select only draft etc.). Don't get me wrong, we still consider it as a potential solution, we are just debating about the pros & cons and looking to hear your view.\nsecond problem is more serious. Imagine you have some database constraints i.e. NOT NULL or even UNIQUE, how do you save a model as draft? Fake the data? We find it really weird and probably over the line :) How have you solved it?\n\nWe are looking for a generic solution, because we have built a package on top of your media library (we already chatted about that via email some time ago :P ).\nThank you. @javi-dev - you was looking into the similar problem I guess, maybe you are interested.. Ability to create a private media collection. All media of this collections are served via Laravel and user can attach some authorization logic (i.e. who has the permission to access this file etc.). This is useful when working with files containing personal data (i.e. PDF scan of signed contract full of personal data).. Same here, it's broken. It's obviously just a typo in a release name, even the code looks as in v7.. ",
    "nickground": "Even though I can remove the item by using Collection delete() method, I think it's better to have a method that can be used to remove a media file. \n. ",
    "jsaade": "The solution already works on my mac machine and on our production ubuntu server.\nI checked it out on my windows machine, there are no errors, the upload is moved to the correct folder, but the conversion sub-folder is always empty.\n. Ok so this turned out to be a bug introduced in ubuntu that caused amazon dns not to resolve properly:\nhttps://bugs.launchpad.net/ubuntu/+source/eglibc/+bug/1674532. ",
    "Gummibeer": "@freekmurze can you add it to revisit for next major version? I'm researching how to do it with the current code base without throwing everything away. I can/will share my results here - but it could take some time. My primary problem is the missing dependency injection possibility for the conversions & manipulations.\nCould be that I have to rework the package in a fork cause I can't make it without changing the observer and so on.\nBut I think that an update to enable custom drivers (like other laravel packages) would be pretty good! :). Hey,\nI don't have problems with the /tmp dir but the configured temp directory got flooded in my case. \ud83d\ude15 \nMy solution is to override the FileManipulator and move from the TemporaryDirectory::deleteDirectory() to the filesystem one app('files')->deleteDirectory($temporaryDirectory->path());. I've also changed the directory names from all the random strings to speaking ones media-[id] like the real storage is organized. With these changes it's also possible to identify if the directory is removable or not cause I can search for the Media-ID and don't have to do some magic like if last_modified < now-1h or something like this.\nPutting the delete call in the finally and using a try-catch block there is also no exception that can stop the deletion of the directory.\nI think some of the namings are a bit too specific for my case (primary original) but I think that it's a good starting point for a discussion. If these changes are welcome I can also put them in a PR.\n```php\n<?php\nnamespace App\\Libs;\nuse Exception;\nuse Spatie\\MediaLibrary\\Conversion\\Conversion;\nuse Spatie\\MediaLibrary\\Conversion\\ConversionCollection;\nuse Spatie\\MediaLibrary\\Events\\ConversionHasBeenCompleted;\nuse Spatie\\MediaLibrary\\Events\\ConversionWillStart;\nuse Spatie\\MediaLibrary\\FileManipulator as SpatieFileManipulator;\nuse Spatie\\MediaLibrary\\Filesystem\\Filesystem;\nuse Spatie\\MediaLibrary\\Helpers\\File as MediaLibraryFileHelper;\nuse Spatie\\MediaLibrary\\Media;\nuse Spatie\\TemporaryDirectory\\TemporaryDirectory;\nclass FileManipulator extends SpatieFileManipulator\n{\n    public function performConversions(ConversionCollection $conversions, Media $media, $onlyIfMissing = false)\n    {\n        if ($conversions->isEmpty()) {\n            return;\n        }\n    $imageGenerator = $this->determineImageGenerator($media);\n\n    if (!$imageGenerator) {\n        return;\n    }\n\n    $temporaryDirectory = new TemporaryDirectory($this->getTmpPathByMedia($media));\n\n    try {\n        $copiedOriginalFile = app(Filesystem::class)->copyFromMediaLibrary(\n            $media,\n            $temporaryDirectory->path('original.'.$media->extension)\n        );\n\n        $conversions\n        ->reject(function (Conversion $conversion) use ($onlyIfMissing, $media) {\n            return $onlyIfMissing && file_exists($media->getPath($conversion->getName()));\n        })\n        ->each(function (Conversion $conversion) use ($media, $imageGenerator, $copiedOriginalFile) {\n            event(new ConversionWillStart($media, $conversion));\n\n            $copiedOriginalFile = $imageGenerator->convert($copiedOriginalFile, $conversion);\n\n            $conversionResult = $this->performConversion($media, $conversion, $copiedOriginalFile);\n\n            $newFileName = $conversion->getName().'.'.$conversion->getResultExtension(pathinfo($copiedOriginalFile, PATHINFO_EXTENSION));\n\n            $renamedFile = MediaLibraryFileHelper::renameInDirectory($conversionResult, $newFileName);\n\n            app(Filesystem::class)->copyToMediaLibrary($renamedFile, $media, true);\n\n            event(new ConversionHasBeenCompleted($media, $conversion));\n        });\n    } catch (Exception $exception) {\n        \\Log::warning($exception->getMessage(), ['exception' => $exception]);\n    } finally {\n        app('files')->deleteDirectory($temporaryDirectory->path());\n    }\n}\n\nprotected function getTmpPathByMedia(Media $media): string\n{\n    $path = is_null(config('medialibrary.temporary_directory_path'))\n        ? storage_path('medialibrary/temp')\n        : config('medialibrary.temporary_directory_path');\n\n    return implode(DIRECTORY_SEPARATOR, [\n        $path,\n        'media-'.$media->getKey(),\n    ]);\n}\n\n}\n``. @freekmurze no, cause by using the flysystem one it's no problem for php to delete and my storage is owned by the PHP process user and has0775.. @brendt even if this is good cause it prevents an exception this doesn't solve the real problem and just produces the next one: flooded storage directory.\nAnd like I said, by using the flysystemdeleteDirectory()it works like a charm.\nAnd this is also something I don't understand, the flysystem is already used by this package - so why create an already available method again? \ud83e\udd14. @brendt like I said it fixes the problem of an Exceptionrmdir(/tmp): Permission denied. So I don't want to say that this shouldn't get into the code. But it doesn't solve my issue with the temp directory configured and used in this package.\nHere I like my solution withfinallyand using the, existing, filestystemdeleteDirectorymethod - cause withfinally` it will remove the directory even if during the conversion process an exception were thrown.. @freekmurze Ok, but you also have no idea how to solve this without renaming? . I have a similar requirement because the upload to Azure Blob Storage is pretty slow. The whole upload request (~100mb file) takes around 1-2min because of the slow upload to azure. If I could do the upload, like all conversions, from a queue t would be awesome.. @trevorpan if you use https://www.dropzonejs.com/ you can append form data to the file upload request.\njs\n $form.dropzone({\n    addedfile: function (dzFile) {\n        dzFile.mediaState = $('#media-state').val();\n    },\n    sending: function (dzFile, xhr, formData) {\n        formData.append('state', dzFile.mediaState);\n    },\n});\n```php\n$job = new Job([\n    'state' => $request->get('state'),\n]);\n$job->addMedia($request->file('file'));\n$job->save();\n```\nThis will take the value from the input the moment the file is added, cache it on the dzFile object and send it with the request to the controller. The controller will create a new job, attach the file and save everything.. My example will create 3 jobs. If you want to prevent this just pass a job_id key-value in the form and use it. In PHP you could also check if this job_id is present and if not create a job.\nThe addedfile and sending are default callbacks from dropzone. It offers a lot more - depending on your needs you can use them to send whatever you want to your controller.. ",
    "mdeprezzo": "I'm using the 3.10 release. \nMaybe it can be caused by some intervention package update ?\n. I suspected it. Of course.\n. Thanks man. Have a nice development time !\n. Ok, but for seo purpose, if i use, big, thumb or other, maybe i could be penalized. So in that case, the only way is to not use conversions\n. I've a nested controller like this pages.medias. And i recover the model with automatic binding of L5.2. But maybe i'm missing something\n. Ok sorry, always my fault!! You're right\n. ",
    "irazasyed": "Here's a screenshot of the response time it took:\n\nThe first one is of without this package, It downloads remote file which is simply a tiny image in kb and saves it in local directory & adds a record to database and the second one is with this package, same thing but this time it's simply associating the local file that is already downloaded before (again same tiny image).\n. Hi,\nAlright, That's fine. I'm just doing the same right now. First downloading the media to a temp. location and then attaching it.\nIt's actually processing an incoming request (Another service hits my webhook), Does some other tasks before saving the file. But as compare to with package, 824ms is still better. Now I've actually moved the media download to queue system. So its improved. But 6.38s with package is worst.\nAlso, I tested both with and without conversion turned on (thumbnails). Both make no difference. Same slowness.\nAs far as Blackfire.io is concerned, I don't have much experience with that but when i did run once, it highlighted file_put_contents. Lmk what i need to look at in Blackfire report, I can send over the screenshots or whatever is required to help trace the issues? Thanks!\n. So i did some debugging today and traced the issue.\nIt seems like this line of code is the reason behind it taking 5-6 seconds time: \nhttps://github.com/spatie/laravel-medialibrary/blob/master/src/Filesystem.php#L137\nphp\n$this->filesystem->disk($media->disk)->put('.gitignore', Gitignore::getContents());\nBasically, It's first getting the file contents from the stub file and then putting it into the driver's root.\nI modified to test (This is just for local testing, Since the issue for me is with local driver):\nReplaced to this code:\nphp\nGitignore::createIn(config(\"filesystems.disks.{$media->disk}.root\"));\nAnd It now works super fast as expected, All in ms count and no performance issues at all. I tested this several times. It's surprising to see it performing so well just with a small change. Even the remote file download and saving works super fast as expected. Maybe you should modify that code a lil bit to copy the file to the driver's root instead of reading and writing like it does right now (I understand it also supports cloud driver but there has to be a better solution than the current implementation making it so slow).\nLet me know if you have any Q's. Thanks!\n. Update: Since i can see there is no real way to copy a file to a cloud with the standard storage system and the only way is to use put method, How about you do this:\nphp\nif(config(\"filesystems.disks.{$media->disk}.driver\") == 'local') {\n    Gitignore::createIn(config(\"filesystems.disks.{$media->disk}.root\"));\n} else {\n    $this->filesystem->disk($media->disk)->put('.gitignore', Gitignore::getContents());\n}\nThis too works absolutely good for local driver as expected and for cloud, it should work like before. Just experimenting few options. Lmk your inputs. \n. That's even better and sounds good. Thanks! :+1: \n. P.S Let me know if you need any help. I can send a PR if you're busy (And you can ofc review and we can take things from there). :)\n. Cool, I'll submit it soon then :+1: \n. Nevermind, My composer was pulling dev-master branch which has this change.\n. No problem. Thanks for merging :+1: \n. :+1: \n. Thanks!\n. No problem. Thanks for merging :+1: \n. ",
    "amosmos": "@freekmurze It's an old issue but I have a question - before you removed this functionality, where were gitignore files created? Inside each specific media resource folder? And also inside the conversions folder inside of that?\nI guess now we shouldn't mimic that and only create one gitignore file in the public/media folder? Or maybe even just add that folder to the root gitignore file? What would you recommend?. I want to allow the users to add media to models and control their order. I want to believe it's pretty common feature.\n. Hey - yes that's very helpful!\nOne thing though is how do I add the order value when I add the media -> it needs to be one more then the highest existing order value for the model's media collection.\nThen also how do I make changes to the order, when the user wants to change the order of images\\files.\nI must say I am really surprised this is not a common request. I thought that's the main use for this package...\n. @sebastiandedeyne - I understand that - but how can you accomplish a change in order of the photos? Let's say now the user want to change the order of the photos in collection A.\n. @sebastiandedeyne Just so I'll know I understand:\nSo after you run an update with updateMedia you end up with duplicate values in oreder_column in the table - correct? (Because now the ordering was done only on this specific collection?)\n. No, actually that is how I would expect this column to behave originally. Not sure why it's not like that from the begin with, but alright - this library is still so awesome!!\n. Hey @sebastiandedeyne  - one more question... I see in the updateMedia function, that the first thing it does is deleting the media items that are not in the passed array.. So when I send an array with only the specific model and collection's images, all the rest will be deleted...?. There are different collections AND different models - this means that no items from other collections for this model will be deleted but also items from different models in the same collection name will also not be deleted right?. @freekmurze - Would agree that a better\\sensible use case for order_column is to order the files per each model and each collection separately? If so would it be something you would consider adding to the package or at least accepting a PR that does it?. There is no doubt that the default order is ok and working. But the problem happens when we want to change the order - I think this requires either sending the entire collection of medias to updateMedia in order to re-order them, or to have your own ordering mechanism and set the order_column value \"manually\".\nI think that if you keep the order based on each model and each collection you gain few benefits:\n1. It is better to understand and better represent the most common use case for this field.\n2. It makes re-ordering easier. For just a very simple example: I can show my users an \"order\" field, filled with the order_column value, under each media, and let them manually choose the order value. Of course I can also do it now and it will work, but it will seem very strange for the users to see it (they will see \"random\" numbers for ordering).\nTo sum up - it just looks like you added this column for a reason, but kinda \"stopped in the middle\" once you got some sort of a \"working level solution\". It just doesn't seem complete... While it seems like it will probably not be too complicated to complete (and of course I'm willing to try myself if you prefer).\nI hope so much you understand this is by no means criticism, I am SO grateful for your work on this package and all the others and I use them A LOT (expect a postcard). Just had to share my feeling about this little aspect and offer my assistance should you agree it is something that can be improved.. @plakhin I think the way it works is that you send it a list of media id's and the function re-order them in the order that you sent them.. @freekmurze Not completely related to medialibarary but can you give more details\\share how you build the UI for the user to delete images from an item, when eventually the code only send the ID's of the media to keep? Just curious.... @nicolasbeauvais  I believe that on the server side it is cleaner to use updateMedia...\nBut I was wondering about the front end UX and how it is implemented. How is it implemented so that the request returns an array of images to keep.. Yeah, I get that :-) I'm asking about how you implemented the front end to behave like that (to return the images that should be kept). As I said, I know it is less related to medialibrary, but still very interesting :-). Do you have a delete button next to each image? And if so, clicking it doesn't make a request? You have some javascript going on that removed the image from the DOM? And then a \"Save\" button that triggers JS that forms an array of ID's of the images that were left in the DOM?. That's such a nice way to do it, saving a refresh every time and allowing the user to change and save all data at once - but how do you handle adding images in such way? Let me know whenever I'm asking too much :-). This is just amazing. I am trying to understand how to use Blender, it's still a bit too intimidating for me.. But will get there one day. Yes, I thought there must be a way to use the conversions api also directly on images before adding.\nBut I didn't think it through and just installed the intervention image package - you think it's a mistake because it's unnecessary when glide is already installed?. ",
    "mlusetti": "Yep. Here it is, just the getBasePath function:\n``` php\n        $modelNamePath = explode('\\', $media->model_type);\n    $modelName = $modelNamePath[count($modelNamePath) - 1];\n\n    $slug = $media->getCustomProperty('slug', 'default-images');\n\n    return str_slug($modelName) . '/' . $slug;\n\n```\nThe path is correctly generated for each model (tested).\nThanks for your comment.\n. Not at all, the files have different names. But yes, I would like to have them all in the same directory.\nWouldn't it be the same if I add more then one file to the same collection ?\nWasn't the original PathGenerator using the primary from the Media object to \"calculate\" the path ?\nAre you telling me that clearMediaCollection('collectionname') will delete every files in every collection?\nThanks for your time, appreciated.\n. Ah, just noticed my typo in the title, thanks for clarifying. \n. Hi @sebastiandedeyne ,\n  thanks for your time.\nAny order I use the last one is the only one saved.\nNever tried the default path generator. Should I try it? How could the path generator could go wrong if it saves correctly at least one file?\nCheers\n. The call seems to not cause any different behavior, but testing it I've saw something I didn't noticed before.\nIf the destination path is not present in the disk, say is the first time for a new $prod everything is working correctly. The pdf and jpg goes in the correct directory and the thumb is generated for the images collection.\nThe second time the function is called, say when the user update the $prod instance with a new image and a new pdf, only the last one ends up in the filesystem. The first one is lost.\nDid this rings any bells?\n. Sorry I made confusion.\nThe different behavior is made if the entry is in the db or not. If there's no entry in the db everything is working as expected, if there's already and entry in the media table for the current $prod only the last one is saved in the filesystem.\nDid I made it clear?\n. No change. Only the last one succeed in the filesystem but in the db I got all the entries.\n. Any news on this one ?\nI've used a workaround, which consists in storing in different path based on \"type\" of the media, but I find this behavior pretty limiting when you need or want to handle multiple files for each model.\nSo I add a type custom properties to each media (say type => 'pdf' or type => 'images') and in the path generator I use this property, as I've done with the slug one, to add a directory beneath the main one.\nIf you would like to see the full code snippet I can give it to you.\nCheers.\n. ",
    "kyle-mccarthy": "I am not entirely sure if this is an issue with the medialibrary, if it is from packages used in openshift, or if I am just overlooking something.  But here are some things that I have found out:\n1. $this->filesystem->disk($media->disk)->has($sourceFile) returns true\n2. $this->filesystem->disk($media->disk)->read($sourceFile) will return the array with the correct contents\n3. $this->filesystem->disk($media->disk)->readStream($sourceFile) returns the following array:\narray:7 [\u25bc\n  \"type\" => \"file\"\n  \"dirname\" => \"1\"\n  \"path\" => \"1/logo.png\"\n  \"timestamp\" => 1450153645\n  \"mimetype\" => \"image/png\"\n  \"size\" => \"14497\"\n  \"stream\" => stream resource @57 \u25bc\n    wrapper_type: \"PHP\"\n    stream_type: \"TEMP\"\n    mode: \"w+b\"\n    unread_bytes: 0\n    seekable: true\n    uri: \"php://temp\"\n    options: []\n  }\n]\nHowever, file_put_contents will result in an empty/broken file when using readStream.  I have tried reading the data directly from the readStream implemented in the RackspaceAdapter class from league/flysystem-rackspace, but I haven't had any luck getting the correct results. \n1. I create another file, accessed the resource using a hardcoded url like fopen('http://4b22...e87f.r95.cf1.rackcdn.com/1/logo.png', 'r') and it returned the following resource:\nstream resource @11 \u25bc\n  wrapper_data: array:12 [\u25b6]\n  wrapper_type: \"http\"\n  stream_type: \"tcp_socket/ssl\"\n  mode: \"r\"\n  unread_bytes: 1027\n  seekable: false\n  uri: \"http://4b22...e87f.r95.cf1.rackcdn.com/1/logo.png\"\n  timed_out: false\n  blocked: true\n  eof: false\n  options: []\n}\n. I was using the latest adapter.  I ended up ripping out Rackspace and using S3 instead, in general it has been much easier to work with.  I spent all of yesterday attempting to narrow down the issue but was only able to get it to work by using the filesystem read function instead of readStream. \nSpecifically in the copyFromMediaLibrary method of the Filesystem class contained in the your package, I changed it to $stream = $this->filesystem->disk($media->disk)->read($sourceFile); rather than $stream = $this->filesystem->disk($media->disk)->readStream($sourceFile);.  However, this was more of a hack than an actual fix, especially since using the read function will gobble up memory. \n. ",
    "danieljaniga": "please add laravel 5.2 support\n. now it works for me, just remove vendor files and then composer install and composer require spatie/laravel-medialibrary\n. ",
    "binalfew": "This is what my composer.json file looks\n```\n{\n    \"name\": \"laravel/laravel\",\n    \"description\": \"The Laravel Framework.\",\n    \"keywords\": [\"framework\", \"laravel\"],\n    \"license\": \"MIT\",\n    \"type\": \"project\",\n    \"require\": {\n        \"php\": \">=5.5.9\",\n        \"laravel/framework\": \"5.2.\",\n        \"laravelcollective/html\": \"5.2.\",\n        \"intervention/image\": \"^2.3\",\n        \"baum/baum\": \"^1.1\",\n        \"guzzlehttp/guzzle\": \"^6.1\",\n        \"pda/pheanstalk\": \"^3.1\",\n        \"spatie/laravel-sluggable\": \"^1.0\",\n        \"arrilot/laravel-widgets\": \"^3.2\"\n    },\n    \"require-dev\": {\n        \"fzaninotto/faker\": \"~1.4\",\n        \"mockery/mockery\": \"0.9.\",\n        \"phpunit/phpunit\": \"~4.0\",\n        \"symfony/css-selector\": \"2.8.|3.0.\",\n        \"symfony/dom-crawler\": \"2.8.|3.0.*\"\n    },\n    \"autoload\": {\n        \"classmap\": [\n            \"database\"\n        ],\n        \"files\": [\n            \"app/helpers.php\"\n        ],\n        \"psr-4\": {\n            \"FlairBooks\\\": \"app/\"\n        }\n    },\n    \"autoload-dev\": {\n        \"classmap\": [\n            \"tests/TestCase.php\"\n        ]\n    },\n    \"scripts\": {\n        \"post-root-package-install\": [\n            \"php -r \\\"copy('.env.example', '.env');\\\"\"\n        ],\n        \"post-create-project-cmd\": [\n            \"php artisan key:generate\"\n        ],\n        \"post-install-cmd\": [\n            \"php artisan clear-compiled\",\n            \"php artisan optimize\"\n        ],\n        \"pre-update-cmd\": [\n            \"php artisan clear-compiled\"\n        ],\n        \"post-update-cmd\": [\n            \"php artisan optimize\"\n        ]\n    },\n    \"config\": {\n        \"preferred-install\": \"dist\"\n    }\n}\n```\n. @freekmurze @danieljaniga Which vendor files are you suggesting to remove? You can see my composer.json file above. Thanks.\n. @kickthemooon Yes, spatie/laravel-sluggable is a different package to create slugs. It is a very good package optimised for php 7, by the way.\n. @kickthemooon @freekmurze Yes! It's working now. Thanks a lot man! But what is the difference between adding \"spatie/laravel-medialibrary\": \"^3.11\" to composer.json file before running composer update and running composer require spatie/laravel-medialibrary? am I missing something? \n. ",
    "palokankare": "Ok, it works with: \"spatie/laravel-medialibrary\": \"^3.11\"\n. ",
    "divdax": "@freekmurze I'm in the same situation. If you know the path of one conversion e.g. media/{id}/conversion/thumb.jpg you can go thru all conversions by incrementing the id.\nThe next thing is when you are using S3 with Cloudfront. An updated conversion never will be delivered until the cache expired. :(\nIf i set a custom filename with uniqueid() (59c4f4e1643f2.jpg) why not generateing the conversions like this?\n- 1 (mediaid)\n-- 59c4f4e1643f2.jpg\n-- conversions\n--- 59c4f4e1643f2_large.jpg\n--- 59c4f4e1643f2_thumb.jpg\n// EDIT\nI know this would be a breaking change. Maybe we could add a new config variable?\nphp\n'conversion_filename_prefix_by_main_filename' => true, // default = false. @freekmurze a policy in this case is a \"global thing\".\n@palpalani This makes all files public after this config change.\nIf you want to set the permission for every upload individually you can do this like so even your bucket is set to private:\nphp\n    $model->addMedia($file)\n        ->addCustomHeaders([\n            'ACL' => 'public-read'\n        ])\n        ->toMediaCollection($type);. @omacesc no it's a bug i already reported: #868 . Ok thank you. Can i do a PR if finished the conversion?. A new method to clone a model with all media items e.g. $media->replicateWithMedia(). New idea:\nWhen uploading pdf files with more than 1 page every page should optional generated as convertions so you can display all pages as jpg. (gallery, lightbox). @mokhosh Use the Media model and remove model_type and model_id yourself?\n$media->update(['model_type' => '', 'model_id' => 0]);. I also have a private bucket and need to set acl public via header. In my case a user can upload files and make them public (optional) via interface. An aws bucket policy can't do that.. See issue #868 . @FaridAghili Thank you man! I really like your approach and appreciate the time you invest to help me out. \ud83d\udc4d . Use this to avoid automatic inflection:\nphp\nRoute::resource('media', 'Admin\\MediaController', ['parameters' => ['media' => 'media']]);. Ok got it...\nevery ->registerMediaConversions() is called even if i add a file to a specific collection, so i have to check if $crop is set in every conversion... \ud83e\udd26\u200d\u2642\ufe0f . ",
    "jamiehd": "@freekmurze is this something you would reconsider? As @mdeprezzo said this is something that would be very helpful for SEO purposes? I would be happy to create a PR if it is something you would accept.. ",
    "noonanwebgroup": "I also agree, @jamiehd. Implementing this feature could go a long way for SEO.. ",
    "irfanDC": "Same thing i want to do as @kickthemooon did, but I am using \"spatie/laravel-medialibrary\": \"7.0.0\" Here is the my snippet \n if ($request->hasFile('assets')) {\n            foreach ($request->file('assets') as $key => $file) {\n                $pagecontent->addMedia($file)\n                ->withCustomProperties(['caption' => 'test caption'])\n                ->toMediaCollection('assets');\n            }\n        }\nbut nothing happening. I also added caption field in database media table. It is working. Thanks for great work :). ",
    "michaelstivala": "Sounds good Freek! \nI can work on a PR for this - if there's anything you'd like me to keep in mind while on it to facilitate it getting merged in quicker, let me know.\nThanks! :)\n. Excellent - your refactor makes a lot of sense, my instinct would have been to make the getRemoteHeadersForFile method private, but I see the value in making it public to allow a test to be written - I'll keep it in mind in the future.\nThanks Freek!\n. The tests fail on travis since Laravel glide ^3.0 requires PHP 7, while the test environment is PHP 5.6\n. Hi Freek,\nThanks for looking for a solution to this problem. I'll wait to see what the maintainer of Glide does.\nFeel free to remove this PR.\n. This worked for me. Thanks so much for taking the time on this Freek!\n. ",
    "kduma": "Unfortunately I don't have idea, how to test this. :disappointed: \nYou don't have tests which checks actual creation or removing of files. \n. ",
    "dmknvk": "I found this issue https://github.com/spatie/laravel-medialibrary/issues/129 and use:\n\"spatie/laravel-medialibrary\": \"^3.12\"\nIt works fine! Sorry for the trouble!\n. ",
    "Cannonb4ll": "Well, like this:\nI have a model item, which has multiple media items.\nWhenever I do like: $model->getMedia() it returns 2 items, from out the database, but I want to have the URL aswell in that collection instantly, I do not want to have to do like: $model->getMedia()[0]->getUrl();\nI would like to see that the URL is appended automatically to the collection you ask within $model->getMedia() (even though theres multiple items in that collection)\nCan I accomplish this with a custom media model?\n. Fixed it by doing following:\n```\nprotected $appends = [\n    'url'\n];\npublic function getUrlAttribute()\n{\n    return $this->getUrl();\n}\n```\nIn a custom media model.\n. So there is no way to upload to the storage folder, it always has to be public folder @freekmurze ?\nI am foreseeing conflicts with this because we are using Forge, with envoyer. The problem that occurs is whenever we deploy a new version, the public folder gets sweeped.\n. Yes, thats correct. I have done that but the problem is, whenever I set:\n'media' => [\n        'driver' => 'local',\n        'root'   => public_path().'/media',\n    ],\nTo:\n'media' => [\n        'driver' => 'local',\n        'root'   => storage_path('app').'/media',\n    ],\nIt returns the error:\n[Spatie\\MediaLibrary\\Exceptions\\UrlCouldNotBeDetermined]\n   The storage path is not part of the public path\n. Im not sure what you mean, could you elaborate in steps?\n. It would save more time if you can do ->setDefault() rather than doing ->withCustomProperties(['default =>  true]) and getting the image by doing $model->getMedia()->getDefault()\n. You mean by adding scope's to the custom model? (What would be the right approach?)\n. Yes, like I said I am not sure if this is the way to go, but I solved this in my other project using a MediaController which shows all the media and is filterable (on nulled model types and such).\nSo your suggestion is whenever a user wants to create a new model, you create a 'draft' model in the create method and this way you bind the images?\n. @freekmurze Could you give an example on how to set a the extractVideoFrameAtSecond dynamically through the $media property?. ",
    "zzzace2000": "I found that I returned my laravel-glide version down to 2 then it worked\n. I forget to install the library...\n. ",
    "nathanprins": "Works perfectly! Thanks a lot! \n. If the model doesn't have media in a collection, how would I go about returning a default image? \nI was thinking of something like this:\npublic function getCoverAttribute(){\n        $cover = ???\n        if($this->hasMedia('cover')){\n            $cover = $this->getFirstMedia('cover');\n        }\n        return $cover;\n}\nBut what should I put at the ??? or should it be completely different?\n. I guess you're right, seeing as the default cover photo is something more dependent on the design instead of the system behind it. This keeps things MVC!\nThanks again!\n. ",
    "shellofyou": "Thank you very much!\n. ",
    "hassankhan": "Thanks!\n. ",
    "PheRum": "@freekmurze https://github.com/spatie/laravel-medialibrary/blob/master/composer.json#L23\nuse\n\"illuminate/bus\": \"^5.1|^5.2\",\n. version 3.14\n[ErrorException]         \n  Undefined index: scheme\ndev-master all good\nupdate your version for composer please\nand replace your migration\n``` php\n<?php\nuse Illuminate\\Database\\Schema\\Blueprint;\nuse Illuminate\\Database\\Migrations\\Migration;\nclass CreateMediaTable extends Migration\n{\n    /*\n     * Run the migrations.\n     /\n    public function up()\n    {\n        Schema::create('media', function (Blueprint $table)\n        {\n            $table->increments('id');\n            $table->morphs('model');\n            $table->string('collection_name');\n            $table->string('name');\n            $table->string('file_name');\n            $table->string('disk');\n            $table->unsignedInteger('size');\n            $table->text('manipulations');\n            $table->text('custom_properties');\n            $table->unsignedInteger('order_column')->nullable();\n            //$table->timestamps();\n            $table->timestamp('created_at')->default('0000-00-00 00:00');\n            $table->timestamp('updated_at')->default('0000-00-00 00:00');\n        });\n    }\n/**\n * Reverse the migrations.\n */\npublic function down()\n{\n    Schema::drop('media');\n}\n\n}\n```\nthis is temporary fix for laravel 5.2 https://github.com/laravel/framework/issues/11518\n//$table->timestamps();\n$table->timestamp('created_at')->default('0000-00-00 00:00');\n$table->timestamp('updated_at')->default('0000-00-00 00:00');\n. ",
    "poudigne": "Awesome. thanks\n. ",
    "dennisoderwald": "Hi @freekmurze,\na better support for soft deletes is not added so far or not documented?. ",
    "tristanbailey": "Just to add an updated link for future search on this topic, as the docs moved:\nhttps://docs.spatie.be/laravel-medialibrary/v4/advanced-usage/using-a-custom-directory-structure. ",
    "cfreak": "yeah, thanks! Now it's running again.\n. oh sorry forgot to rename the config file from laravel-medialibrary.php to medialibrary.php. ",
    "AEK-BKF": "@freekmurze  please could you help me ....\n. I'm using 5.1\nhere my composer.json :\n\"require\": {\n        \"php\": \">=5.5.9\",\n        \"laravel/framework\": \"5.1.\",\n        \"laravelcollective/html\": \"5.1.\",\n        ...\n        ... \n        \"spatie/laravel-glide\": \"^3.0\",\n        \"spatie/laravel-medialibrary\": \"3.14.1\",\n        \"intervention/image\": \"^2.3\" \n. Thanks, I can install it now, but an error occurs \n\u2190[37;41m  Undefined index: baseURL  \u2190[39;49m\nwhat's this ?\n. lol sorry i solved the issue ^^  it's ok now\nthanks a lot :))\n. Thanks @freekmurze  for answer,\nIt works now, but will there any mistake when we change json type to text ?. Thanks a lot :) :+1: . Me too !\nI confirm this issue with :\nL 5.6 ,  Mysql 5.7 , Latest version of package !. The mistake is when we use :\n'default_filesystem' => 'public'; \nBut it works fine if we change it to :\n'default_filesystem' => 'media';\nAnd of course don't forget to set :\n'media' => [\n            'driver' => 'local',\n            'root'   => public_path().'/media',\n        ],. set your code and the error message please. Ok, try this when you store files :\n$user->addMediaFromRequest('myfile')->preservingOriginal()->toMediaCollection('myfiles');\nand when you retrieve your file, try this :\n$myfiles = $user->getMedia('myfiles');\ndd($myfiles[0]->getUrl());. Never mind ! it's my fault ! I didn't run queue work ^^'. ",
    "webcrazy": "Yeah @hugofabricio  if I delete a media record by\nMedia::find(1)->delete();\nDatabase record delete and associated file doesn't delete.\n. It should be like this.\nArticle::find(1)->deleteMedia($media_id);\nand works for me.\n. Thanks for your quick reply. I found my error. That was because of I'm trying to update the file name that was already upload to mediaLibray. That's why I got file not found exception with temp file location.\n. No. I don't use hhvm in development.\nSorry to bother. It's fixed now. It's permission issue.  \nbth what permission should I gave to main media folder?\n. Sorry... It's server incorrect configuration.\n. ",
    "Maxeee09": "Yes @freekmurze, this is what I've done. In the delete_model_and_collection_medias test, first I check that media still exists after calling medialibrary:clear command with the collection1 collection name (which is not the associated collection name). And then, I check that media does not exists after calling medialibrary:clear command with the collection collection name (which is the associated collection name). I agree that used names are disturbing :)\n. @freekmurze No problems :)\n. \ud83c\udf89\n. ",
    "ivanvermeyen": "Thanks for the pointer :) I think I found it...\nI'm using the same conversion name for different collections on the same model.\nA thumb for a PNG logo and a thumb for a JPG cover.\nOn this line the collection of all of the model's media conversions is searched for the first conversion name match. But it doesn't check if the collection matches too.\nSo on this line getByName() returns the first thumb conversion that it finds, which is of course always the same one.\nI don't know if you want to allow for duplicate conversion names in this way. It seemed logical when I was writing it, but I could also just use unique names. :)\n. In case anyone else is still struggling with testing file uploads using MediaLibrary.\nAs noted above, when faking the 'media' storage, the uploaded files can't be found.\nThis basic test example works for me. I'm running this test in a package repo, using orchestral/testbench, but I suppose this should also work in a normal Laravel app. I'm using Laravel 5.5.\nInstead of faking the storage disk, I just change the root path of the disk in the config.\nI have this controller method to add a photo to a Post:\n```php\npublic function store(Post $post)\n{\n    request()->validate([\n        'photo' => \"required|image\",\n    ]);\nreturn $post->addMediaFromRequest('photo')->toMediaCollection('photos');\n\n}\n```\nIn the test I create a fake photo, send it via a POST request and then assert that it is added to the Post and that it exists in the filesystem. This also works with conversions.\n```php\n/* @test /\npublic function a_photo_can_be_added_to_a_post()\n{\n    $this->withoutExceptionHandling();\nconfig()->set('filesystems.disks.media', [\n    'driver' => 'local',\n    'root' => __DIR__.'/../../temp', // choose any path...\n]);\n\nconfig()->set('medialibrary.default_filesystem', 'media');\n\n$photo = \\Illuminate\\Http\\Testing\\File::image('photo.jpg');\n\n$response = $this->postJson($this->url(), [\n    'photo' => $photo,\n]);\n\n$response->assertStatus(200);\n\n$photos = $this->post->getMedia('photos');\n\n$this->assertCount(1, $photos);\n$this->assertFileExists($photos->first()->getPath());\n$this->assertFileExists($photos->first()->getPath('thumb'));\n\n}\n```\nNote that the temp folder is not cleared automatically, so you should do that in the setUp probably.. ",
    "acitjazz": "yes this my post class\n``` javascript\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia;\nclass Post extends Model implements SluggableInterface, HasMedia, HasMediaConversions\n{\n  use HasMediaTrait;\npublic function registerMediaConversions()\n{\n    $this->addMediaConversion('square-150')\n        ->setManipulations(['w' => 150, 'h' => 150, 'fit' => 'crop', 'fm' => 'jpg'])\n        ->performOnCollections('thumbnail');\n}\n\n```\n. ",
    "bertalanimre": "I have a very similar issue ATM. I can upload a picture without any error, but I cannot replace it with a newly uploaded picture. I have to remove the original first, then I can upload the new one. I'm getting a very similar error message.\nHandleExceptions->handleError(2, 'mkdir(): Permission denied', '/var/www/html/myproject/vendor/league/flysystem/src/Adapter/Local.php', 367, array('dirname' => '31/conversions', 'config' => object(Config), 'location' => '/var/www/html/myproject/public/media/31/conversions', 'umask' => 18, 'visibility' => 'public'))\nWhat was your answer to your issue?. I've done it today. NginX is running by user web and so does php-fpm. Every service is restarted, BUT...\nWhen the images are being uploaded, the permissions on the project.com/public/media library still switches from web:nginx to nginx:nginx. I have downloaded and set up a watcher to change the permissions back to web:nginx when a file is being created in public/media BUT after the modification, the permissions are set again back to nginx:nginx, So when I upload a file the following happens if I've manually set web:nginx on public/media:\n - File being uploaded into public/media/XX/\n - Permissions are changed on public/media from web:nginx to nginx:nginx by medialibrary\n - Permissions are changed on public/media from nginx:nginx to web:nginx by watcher\n - Permissions are changed back again on public/media from web:nginx to nginx:nginx by medialibrary\nHow do you think this is possible if everything is being run by user web ?. I take it back, even if I stop watcher, the permissions are still changing in this order. . Localhost issue.Problem solved. I don't wanna talk about it..... . ",
    "avanisolanki": "I have the same issue when I upload media queue gets failed with permission denied error message. I created issue for the same https://github.com/spatie/laravel-medialibrary/issues/952.. In which file we need to make this changes? I have raised issue https://github.com/spatie/laravel-medialibrary/issues/952.\nI think this can help me out.. I followed the steps written here http://laravel-recipes.com/recipes/25/creating-an-apache-virtualhost to run laravel app using virtual host.\nI changed user in envvars file with my system user. So It is working properly!. I followed the steps written here http://laravel-recipes.com/recipes/25/creating-an-apache-virtualhost to run laravel app using virtual host.\nI changed user in envvars file with my system user. So It is working properly!. ",
    "grumpysi": "+1 for this\n. ",
    "tomcoonen": "+1\n. @freekmurze The media specific manipulations only work if the same manipulation exists on the model?\nprotected function addManipulationToConversion(array $manipulation, string $conversionName)\n    {\n        foreach ($this as $conversion) {\n            if ($conversion->getName() === $conversionName) {\n                $conversion->addAsFirstManipulation($manipulation);\n                return;\n            }\n        }\n    }\nhttps://github.com/spatie/laravel-medialibrary/blob/master/src/Conversion/ConversionCollection.php#L128\nI think if you drop this requirement it would be more flexible.\nAnd you could partially solve this https://github.com/spatie/laravel-medialibrary/issues/180\n. In my specific case I also needed the conversion name to change for SEO requirements, and since my conversion name prefix is known I solved it this way for now: https://github.com/creacoon/laravel-medialibrary/commit/b297525e1fac0e455fd720b8bf6caff4bb4bdaae\nOn the conversion set on the parent model, I can now set the converion name with a prefix-property (product name in this case).\n. @mattboban I currently use it like this;\n$images = $product->getMedia('product-images');\nAnd then for each image I get the conversion I need:\n$image->getUrl($product->slug.'-large');\nDoes it make sense?\n. ",
    "thequiet": "+1\nWill help with many user's SEO efforts. Thanks for the great package.. @freekmurze Awesome!! This is a much welcome addition - thank you for the update. Excited to use v7.. ",
    "plakhin": "Is this available as an additional option or an only available option?. please leave the option to not include original filename in derived image filename, I see filenames in local languages with various additional symbols very often and it looks too messy.... Hello!\nFaced the same issue, thought order_column is an order for each model, i.e. I can have several images for each post and rearrange their order...\n\nWe pass those id's to the updateMedia function.\n\nDidn't find anything regarding this function in docs. Would you be so kind to describe how do you use it a bit more detailed?\nThank you.. Ability to separate originals and conversions in different parent directories.\n./public/storage/media-library/{modelType}/{modelId}/{mediaId}/{originalfilename}.jpg\n./public/media/{mediaId}/conversion1.jpg\n./public/media/{mediaId}/conversion2.jpg\nBecause usually it's better to backup originals only. It is possible now, but a bit tricky and needs a lot of additional code. Also adding modelType and modelId to directory structure of originals will make it much more easier to navigate, though they are usually not needed for conversions.. ",
    "JolitaGrazyte": "I have tried to use your code exactly as it is, but it works perfectly in my application.\nCould you please tell us  a little bit more:\n- which version of the package you use ?\n- do you use windows ?\n- have you followed all the instructions of the package ?\n- have you made some changes to the configuration file ?\nMaybe you could post the code of your User model?\nAnd maybe we could have a look at your medialibrary configuration?\nLike that we could try to re-create the scene.\nThanks.\n. ",
    "Fanamurov": "I just like to Laracasts, everything is working correctly, except MediaLibrary\n. I place this code in main front controller:\n$diskRootPath = config('filesystems.disks.media.root');\ndd(realpath($diskRootPath));\nreturn \"/Applications/MAMP_SITES/laravel.local/larrock/public_html/media\" (work good)\nstart phpunit:\nreturn FALSE\n$diskRootPath = \"/Applications/MAMP_SITES/laravel.local/larrock/public/media\"\n. Sorry, here is the solution to the problem of tests\nin config/filesystems.php\n'media' => [\n            'driver' => 'local',\n            'root'   => public_path().'/media',\n        ],\nchange to\n'media' => [\n            'driver' => 'local',\n            'root'   => base_path() .'/public_html/media',\n        ],\nThank you\n. ",
    "Syrok": "It (image regeneration) working for me on S3.\nBut sometimes got this error \"File not found at path\" too.\n. ",
    "philmarc": "Indeed it is working! I placed my files at the root of the S3 bucket, and now the regeneration of the thumbnails work.\nThey were put in a subfolder before, which Cloudfront was redirecting to, so the pictures displayed successfully, but the regeneration was looking for the files at the root of the bucket, and not in the /media subfolder. \nThis is maybe something you can specify in the filesystems.php config file under the S3 array, but for now I'd rather leave it at the root.\n. Makes perfect sense now, thank you.\nThe only down side is that if I apply a modification on the file at this state, the conversions will have the same modification.\nFor instance, if I want to add a watermark (using the Glide Api) only on the original file, it will still be visible on the latter generated conversions.\nI guess the only way is not to modify the original file after upload, but rather create a new \"big\" conversion and use it as the main picture in my application.\n. About your solution, \nGlideImage::create($image) is only available in Glide v3 (I am using v2 at the moment)\nWhen I try to require the latest Glide v3, I get the following error:\nspatie/laravel-medialibrary 3.17.3 requires spatie/laravel-glide ^2.2.4 -> no matching package found.\n. So this is the natural behaviour not to delete those folders? \nI guess I'll have to schedule a job to clean the temp folder every day or so, because I have hundreds of folders created everyday, and I feel it's a bit silly to keep those empty folders.\n. It might have to do with my host since my sessions files in storage/framework/sessions are not getting cleaned either by the PHP garbage collector.\nEdit: This was a mistake, my session files are actually getting cleaned.\n. The temporary folders created in storage\\medialibrary\\temp all have a permission of 705 when created. Shouldn't it be 604?\nI can't find out what is wrong, because the temporary uploaded file inside the temporary folder (ie: temp\\KwK2sNOckXgfszLs) is successfully getting cleaned (or moved) after upload has completed. It is just that folder KwK2sNOckXgfszLs that remains...\nAm I the only one experiencing this issue?\n. I believe the error occurs only when using the S3 filesystem.\nOn localhost as well as on production server, \n- when using 'defaultFilesystem' => 'media' , temp subfolders are cleaned correctly.\n- when using 'defaultFilesystem' => 'S3' , temp subfolders are not getting cleaned. (on local env, the conversions files inside the subfolders are not getting deleted, but they are on production env)\nOn upload, I get the following error (on local environment only) - I don't think it's related to the problem but here it is just in case - :\nErrorException in FileAdder.php line 345: \nunlink(C:\\xampp\\tmp/php4693.tmp): Permission denied\nI have checked the C:\\xampp\\tmp folder, and files are actually getting cleaned after the script run.\n```\n// FileAdder.php line 345\n    if (! $this->preserveOriginal) {\n        unlink($this->pathToFile);\n    }\n\n```. I was reading the v6 documentation instead of the v7.\nTo fix the issue, I had to add getResponsiveImagesDirectoryUrl() and getTemporaryUrl() public functions in my MediaUrlGenerator.php file. ",
    "jenky": "Maybe you could try this one: https://docs.spatie.be/laravel-medialibrary/v3/advanced-usage/generating-custom-urls\n. ",
    "Crinsane": "I'm facing this exact same problem, it looks like I've done everything correctly, but I still get the same exception. What for me seems to be a problem is this method:\n``` php\n// LocalUrlGenerator.php\n/\n * Get the path where the whole medialibrary is stored.\n /\nprotected function getStoragePath() : string\n{\n    $diskRootPath = $this->config->get('filesystems.disks.'.$this->media->disk.'.root');\nreturn realpath($diskRootPath);\n\n}\n```\nThe first line returns the correct path /home/vagrant/website/public/storage/media.\nBut the call to realpath() turns the path into /home/vagrant/website/storage/app/public/media.\nWhat am I doing wrong?\n. ",
    "WolfieZero": "I'm having this issue whereby my public/media is symlinked to storage/media (ln -s ../storage/media public/media from project root) but the realpath() function expands the symlink. \nThe solution is to remove the realpath() from the return in LocalUrlGenerator::getStoragePath().\n. ",
    "hopewise": "@WolfieZero that has fixed the problem thanks, but should it be added to the repo?. ",
    "akoSalman": "I fixed issue by adding a url to the disk like below:\n```php\n    'disks' => [    \n    'media' => [\n        'driver'    => 'local',\n        'root'      => public_path('media'), \n        'url'       => env('APP_URL') . '/media',\n    ],\n\n],\n```. ",
    "jiangqx": "I fixed this issue by modified the following code\n'disks' => [\n        'local-media' => [\n            'driver' => 'local',\n            'root'   => public_path().'/img/posts',\n            'url'    => env('APP_URL') . '/media',\n        ],\n]\nCause,public_path() is  define the public path to public , just add '/img/posts' to public.. ",
    "og6k": "I am having the same problem. The method above with adding 'url' help with the error, but now my media gets wiped out every time i deploy to aws elastic beanstalk.\nI am not too sure how the symlink works.\ni do not have a storage/media path.\nthe downloads go to public/media, and it is ignored by gitignore.. ",
    "sidis405": "Of course. \njson\n{\n    \"name\": \"laravel/laravel\",\n    \"description\": \"The Laravel Framework.\",\n    \"keywords\": [\"framework\", \"laravel\"],\n    \"license\": \"MIT\",\n    \"type\": \"project\",\n    \"require\": {\n        \"php\": \">=5.5.9\",\n        \"laravel/framework\": \"5.1.*\",\n        \"laracasts/flash\": \"^2.0\",\n        \"illuminate/html\": \"^5.0\",\n        \"laracasts/presenter\": \"^0.2.1\",\n        \"barryvdh/laravel-debugbar\": \"^2.2\",\n        \"league/glide\": \"^1.0\"\n    },\n    \"require-dev\": {\n        \"fzaninotto/faker\": \"~1.4\",\n        \"mockery/mockery\": \"0.9.*\",\n        \"phpunit/phpunit\": \"~4.0\",\n        \"phpspec/phpspec\": \"~2.1\"\n    },\n    \"autoload\": {\n        \"classmap\": [\n            \"database\"\n        ],\n        \"psr-4\": {\n            \"App\\\\\": \"app/\"\n        }\n    },\n    \"autoload-dev\": {\n        \"classmap\": [\n            \"tests/TestCase.php\"\n        ]\n    },\n    \"scripts\": {\n        \"post-install-cmd\": [\n            \"php artisan clear-compiled\",\n            \"php artisan optimize\"\n        ],\n        \"pre-update-cmd\": [\n            \"php artisan clear-compiled\"\n        ],\n        \"post-update-cmd\": [\n            \"php artisan optimize\"\n        ],\n        \"post-root-package-install\": [\n            \"php -r \\\"copy('.env.example', '.env');\\\"\"\n        ],\n        \"post-create-project-cmd\": [\n            \"php artisan key:generate\"\n        ]\n    },\n    \"config\": {\n        \"preferred-install\": \"dist\"\n    }\n}\nBrand new project. Just setting it up now.\n. Understood. \nYep went with glide .3 and all was good-\nThank you :)\n. Thanks for the reply, but the model implementing HasMediaConversions has to abide to the interface that currently on 4.9 is\n```\n<?php\nnamespace Spatie\\MediaLibrary\\HasMedia\\Interfaces;\ninterface HasMediaConversions extends HasMedia\n{\n    /\n     * Register the conversions that should be performed.\n     \n     * @return array\n     /\n    public function registerMediaConversions();\n}\n```\nso media does not get currently passed unfortunately.\n:/. No worries man. Seems like this is available on v6 so i updated Laravel to 5.5 and updated medialibrary to v6.\nSo i got a way to do what i needed.\nOn a related note. The only way i could think of to get the dimensions of the retrieved media was to do it with Intervention\\Image since it's already installed for Glide. \nDoes Medialibrary provide an api to fetch dimensions of resulting media?. I did find something that allowed me to use the media props as object properties, but I was getting different values compared to intervention\\image which as giving working value sets.\nAs soon as I get to the office I'll post back with a reference to the docs regarding what I meant. . ",
    "jtrachez": "Remove exception error on my L5.2\n. removedd, sorry\n. ",
    "ceesvanegmond": "@freekmurze So what's the advantage of having this order_column?\n. Would it be an good idea to make the order_column depend on the type of collection?\n. Having the same problem as @mattboban. Ideally you want to have the manipulations per item in your media table.  Using the approach @freekmurze is offering this isn't the case.\n. @freekmurze Sounds like a great idea. I'll will implement this very soon. Thanks for the feedback\n. @sebastiandedeyne \ud83d\udc4d . ",
    "marcel-jahn": "i fixed this one before:\nCall to undefined method App\\Media\\S3CustomUrlGenerator::getPath()\nby creating my own URL Generator\neverything is working with images..\ntracked down to $media->type in FileManipulator class call in function createDerivedFiles()\n. ",
    "ghost": "+1\n. Thank you all for your help. The issue i had is resolved.\n. Thank you for the reply and support!\nThis is a great package!\n. Worked around it using a custom UrlGenerator.\n. Re-opening just to clarify :) \nMy solution was to add a custom UrlGenerator and kinda hard code the piece of path based on the deployment one. Not very happy about it, but hey I needed it fast. \n. Sorry, I'm an idiot. Was looking at the wrong docs version.. Figured it out, sorry for bothering you! I'm an idiot.. - having the ability to add wildcard (or regex) manipulations.\nNow a manipulation needs to have a conversion name as the key., so if you want to rotate a picture 90 degrees in a manipulation, and thereafter resize it with 4 conversions this means the rotation has to be specified for the 4 conversions.. @freekmurze\nUp to you to decide: right now first the *, then the thumb is put in front. Meaning the specific thumb manipulation goes before the *... \nFeel free to change order. ",
    "dfox288": "@sebastiandedeyne Thanks, I'll try that.\n. ",
    "Nuranto": "+1 on the original question....\nThe solution suggested probably works fine, but we loose all the benefits of collections (simplicity of use, specific conversions, etc..)\nHowever, I understand such feature would require a quite big refactoring of the package... Because I've missed it -_-\nYou're absolutely right.. Sorry I did not update...\nYes, I use a custom path, and that was the issue... \nYou must use media id as final folder....\nIt's actually specified in the doc : \nThere aren't any restrictions on how the directories can be named. When a Media-object gets deleted the package will delete its entire associated directory. To avoid tears or worse, make sure that every media gets stored its own unique directory.. ",
    "robbens": "Can you(or someone else) elaborate on your solution @sebastiandedeyne? I'm struggling to find something that works. \nThanks! \ud83d\ude4f. I also have the same problem. Tried gd and imagick. \nBoth very similar in file size.\nOriginal size: 286 KB\nBiggest responsive size: 352 KB\n\n. Yes, I'm using v7.\nOriginal\n\nDownsized\n\n. I see. Thank you so much for your time. I'll definitely post here if I find a good solution \ud83d\udc4d . Kinda unrelated question. But are the generated responsive images compressed through the various optimization tools? If not; What's a good way to do this?. ",
    "Krato": "Ok, I found it. You can't have some media images on the same folder because your package removes directories, not files.\nSo I change my pathGenerator by this:\n``` php\n<?php\nnamespace starter\\Http;\nuse Spatie\\MediaLibrary\\Media;\nuse Spatie\\MediaLibrary\\PathGenerator\\PathGenerator;\nclass CustomPathGenerator implements PathGenerator\n{\n/**\n * Get the path for the given media, relative to the root storage path.\n * @param Media $media\n * @return string\n */\npublic function getPath(Media $media)\n{\n    $model = explode('\\\\', $media->model_type);\n    $model = strtolower(last($model));\n    $collection = (empty($media->collection_name) || $media->collection_name == null) ? 'collection' : $media->collection_name;\n    $path = $model.DIRECTORY_SEPARATOR.$collection.DIRECTORY_SEPARATOR.$media->model_id.DIRECTORY_SEPARATOR.str_slug($media->name);\n    return $path. '/';\n}\n\n/**\n * Get the path for conversions of the given media, relative to the root storage path.\n * @param Media $media\n * @return string\n */\npublic function getPathForConversions(Media $media)\n{\n    $model = explode('\\\\', $media->model_type);\n    $model = strtolower(last($model));\n    $collection = (empty($media->collection_name) || $media->collection_name == null) ? 'collection' : $media->collection_name;\n    $path = $model.DIRECTORY_SEPARATOR.$collection.DIRECTORY_SEPARATOR.$media->model_id.DIRECTORY_SEPARATOR.str_slug($media->name);\n    return $path. '/sizes/';\n}\n\n}\n```\nWill be interesting about that. Not remove directories, remove files, and if directory is empty, then, remove folder. Just an idea.\nThanks for this awesome package :thumbsup:\n. What kind of error?. Sure. Thanks for the suggestions.\nBut it's working without the brackets also.\nRegards!\n. Hope I understand.\nNow I get it working just modifying manipulations.php fle.\nHere is the pull: https://github.com/spatie/image/pull/16\nPull Merged!. > I don't understand this part. Could you give a code example?\nIs on the question. I will tell you. I generate custom paths for each media including a model mutator and a media collection.\nFor example, thi is the path for collection properties and Model id 6.\nSo using this Custom Path Generator, the vars will be:\n```\n$media->collection_name = 256956ab-b067-54b3-8873-f6ef0fadce64 // The uuid for word 'properties'\n$model->mediaId =a6c4fc8f-6950-51de-a9ae-2c519c465071 // Mutator giving a uuid for the model\n$media->id = 38 // The media ID\nSo the final path will be:\nmedia/256956ab-b067-54b3-8873-f6ef0fadce64/a6c4fc8f-6950-51de-a9ae-2c519c465071/38\n```\nThis is working fine. But I have the error when deleting a model, because $media->model is nothing. Any way to get the $media->model when deleting a model?\nJajaja, hope you understand.\nRegards!. ",
    "jpcursor": "Sorry, my bad!! :P\nOverlooked it in the docs\n. you may close the issue, all ok\n. thanks!\n. ",
    "unstoppablecarl": "I just wrote my own UrlGenerator that implemented the interface but got an error when there was no UrlGenerator::getPath() function. So I copied it from the LocalUrlGenerator and it worked fine. Not a huge deal but if you are leveraging the interface it should be complete.\n. This is a reduced case of my current solution for updating the file of an existing media item.\nI have not yet tackled triggering regeneration of the media records conversions.\n```php\nnamespace App\\Models;\nuse Spatie\\MediaLibrary\\FileManipulator;\nuse Spatie\\MediaLibrary\\Media as BaseMedia;\nuse Spatie\\MediaLibrary\\Helpers\\File;\nclass Media extends BaseMedia {\npublic function updateFile($newFile) {\n\n    $fileName        = $newFile->getClientOriginalName();\n    $fileName        = $this->sanitizeFileName($fileName);\n    $currentFileName = $this->file_name;\n    $path            = $newFile->path();\n    $fileSystem      = app(\\Spatie\\MediaLibrary\\Filesystem\\Filesystem::class);\n\n    $this->name      = pathinfo($fileName, PATHINFO_FILENAME);\n    $this->file_name = $fileName;\n    $this->mime_type = File::getMimetype($path);\n    $this->size      = filesize($path);\n\n    $fileSystem->removeFiles($this);\n\n    // overwrite current file keep old name\n    $fileSystem->copyToMediaLibrary($path, $this, false, $currentFileName);\n\n    // when this model is saved, the file will be renamed appropriately to $fileName via $media->file_name\n}\n\npublic function setCustomProperties(array $properties) {\n    foreach ($properties as $key => $val) {\n        $this->setCustomProperty($key, $val);\n    }\n}\n\nprotected function sanitizeFileName(string $fileName): string {\n    return str_replace(['#', '/', '\\\\'], '-', $fileName);\n}\n\npublic function regenerate(){\n\n    /** @var FileManipulator $fileManipulator */\n    $fileManipulator = app(FileManipulator::class);\n    $fileManipulator->createDerivedFiles($this);\n}\n\n}\n// usage in route\nRoute::post('media/{media}/update-file', function (Request $request, Media $media) {\n$newFile = $request->file('new_file');\n$media->updateFile($newFile);\n\n});\n```. Is there a reason why? I thought I provided a reasonable case.. There is not a reasonable way to do it with this package. You have to delete and create.. ",
    "borealsmith": "Hi, \nFirst of all thank you @freekmurze for this awesome package.\nAs I am facing now the same issue as @Crinsane  I was wondering  if there are some updates on this issue.\nCheers,. Thank you @kickthemooon I will do the same. I was very much interested for a PR overcoming this issue since Laravel 5.3 directory structure recommands using symlinks from public to storage. . ",
    "Dalamar": "Hey, it's been a while since the last discussion on this subject but the issue still exists and we still limited to use symlinked directories due to the realpath thing.\nHow can I help to overcome this issue? Should I bring PR?\n. ",
    "Reached": "I ended up just saving the path to my image in the other table, however I am still puzzled about updating images instead of storing new ones, can anyone help?\n. ",
    "sailingdeveloper": "Couldn't you use custom attributes for this?\n. I like the sound of that. +1\n. ",
    "ergonomicus": "@PhilMarc I have bunch of folders inside temp folder also. All of them have some file with jpg extension, but I can not open them. This is happening on both local machine and in production. Have you figured out what's causing this issue?. @mira-thakkar I was in a similar situation and I wasn't able to find the solution, so I decided to make a command to empty the content of that folder, and scheduled it to run weekly. I know it's not  the solution, but this hack seems to work for me for a long time now.\nIt's really simple, but If you need it I can find the code and paste it here.. @nicolasbeauvais Thank you for links, didn't know that. Yes, I have tested ffmpeg in console, and everything works fine, I just thought that it was supported by medialibrary.\nI don't know how to make PR, I will just stick it in my code somewhere...\nThanks a lot!. ",
    "bradcis": "This is occurring for me as well. /storage/medialibrary/temp is filled with files, even though the conversions have already been completed. Any thoughts, @freekmurze? Should I create a new issue for this?. I'm using S3 and have conversions enabled. I've run into problems where I haven't had memory_limit high enough (it was set to 128M). If a large image is uploaded using $photo->addMediaFromRequest('photo')->toMediaLibrary(); and there isn't enough memory allocated, the original file is uploaded S3 but the conversions fail with an out of memory error. In these cases, it doesn't appear that the temp subfolders are removed, even if the conversions succeed in a future attempt.. ",
    "barryvanveen": "When I try to run the tests for this package I get some errors which I think might be related to the temp files discussed in this issue.\nI execute vendor/bin/phpunit tests/S3Integration/S3IntegrationTest.php because this contains the tests that fail. It will trigger some errors like \"ErrorException: mkdir(): File exists\". After some digging around I found the real errors are obscured because /Illuminate/Filesystem/Filesystem.php uses @ unlink and @ rmdir which suppresses the more readable errors.\nIt turns out that I get 2 different errors:\n1. The first is always something along the lines of \"ErrorException: rmdir(/home/localcopy/laravel-medialibrary/vendor/orchestra/testbench/src/Traits/../../fixture/storage/medialibrary/temp/HSkg49x52HCGR9RP): Directory not empty\".\n2, The second error (and all errors after that) are \"ErrorException: rmdir(/home/localcopy/laravel-medialibrary/tests/temp/testfiles): Directory not empty\".\nThe problem seems to be part of deleteDirectory in /Illuminate/Filesystem/Filesystem.php. The weirdest thing is that rmdir fails because the directory is not empty. It can see a file 'thumb.jpg' in the temp folder. While unlink should have deleted that file it is sure that the file does not exist...\nSo @PhilMarc, it looks like this is related to S3, somehow.\nAnd @bradcis, my development machine has a memory limit of 1024M which I think should be more than enough to rule out a memory error.\n. It might have something to do with working on a virtual machine. I've tested it at work (a custom Ubuntu-vm on a Windows host) and at home (Laravel homestead on a Windows host) and both have these problems. Seems to be some sort of race condition at the file system level.... Glad you like it :)\nI've added some documentation and created a PR at https://github.com/spatie/docs.spatie.be/pull/109.. ",
    "eaguad1337": "Did not know why my server was running out of inodes and I discovered that temp folder is full of files, I'm using local driver in a production server.\n/dev/vda1      20643840 20643840 0   100% /\nUsing laravel-medialibrary 6.9.0 and Laravel v5.5.40. I'm deleting the files but how can I prevent this happen again?. ",
    "mira-thakkar": "@eaguad1337 i am getting the same issue, my server was running with 'no space on device\" issue, while i check for the space available 70% space was consumed by /tmp directory with media files.\nDo you find solution for this ?. ",
    "moraleslevi": "Just in case anyone else comes across this issue. You can emulate the same functionality of addMediaFromRequest with this:\nif (request()->hasFile('image_field'))\n{\n    $model->addMedia(request()->file('image_field'))->toCollection('images');\n}\n. ",
    "bstrahija": "This would really be great if you could merge it in.\n. There's already a PR in this issue that works perfectly.\n. Yeah I though it was a PR. Added it now: https://github.com/spatie/laravel-medialibrary/pull/237\n. Well the tests I did all pass. Something else is failing from before: https://www.dropbox.com/s/cjlws5owx6rujsr/Screenshot%202016-06-02%2011.58.07.png?dl=0\n. Awesome, thanks\n. ",
    "elephantux": "\"spatie/laravel-medialibrary\": \"^4.10\"\nAll image formats stored with .src extension :(. UploadedFile {#605 \u25bc\n  -test: false\n  -originalName: \"cover.jpg\"\n  -mimeType: \"image/jpeg\"\n  -size: 940996\n  -error: 0\n  path: \"/tmp\"\n  filename: \"phpdvrddw\"\n  basename: \"phpdvrddw\"\n  pathname: \"/tmp/phpdvrddw\"\n  extension: \"\"\n  realPath: \"/tmp/phpdvrddw\"\n  aTime: 2017-01-04 19:42:24\n  mTime: 2017-01-04 19:42:24\n  cTime: 2017-01-04 19:42:24\n  inode: 654100\n  size: 940996\n  perms: 0100600\n  owner: 900\n  group: 900\n  type: \"file\"\n  writable: true\n  readable: true\n  executable: false\n  file: true\n  dir: false\n  link: false\n}\nEmpty extension on any uploaded file. Why?. This is from official docs:\n\nIf you specify src in the fm-key, the derived image will have the same format as the original image.\nhttps://docs.spatie.be/laravel-medialibrary/v4/converting-images/defining-conversions\n\nAnd inside source code I can find this:\n```\npublic function getResultExtension(string $originalFileExtension = '') : string\n    {\n        return array_reduce($this->getManipulations(), function ($carry, array $manipulation) {\n            if (isset($manipulation['fm'])) {\n                $keepExtensions = ['jpg', 'jpeg', 'png', 'gif'];\n            return ($manipulation['fm'] === 'src' && in_array($carry, $keepExtensions)) ? $carry : $manipulation['fm'];\n        }\n\n        return $carry;\n    }, $originalFileExtension);\n}\n\n```. On production server (Digital Ocean LEMP) the same thing - any type of files saved with .src extension.. I using 4.10.2 version of Media Library.\nSorry but I never before run any tests. Can you please point me how to run this test on my platform?. . When 'fm' => 'src' where is no extensions in DB:\n. I do not trim anything:\n$data = $request->all();\n$image = $data['image'];\n$model->addMedia($image->getRealPath());. @Jasper9041 Thanks! It's work for me!. ",
    "langeuh": "Is there any way to achieve this in V5?. Hi @AlexVanderbist, @freekmurze \nI'm using the format() to make everything a png since my thumbnails need to keep the transparency. But because of that .jpg's get turned into .png's as well.\nThe format('src') makes more sense to me and should imo be the default. I never understood why it defaults to a 'jpg' format. Probably because of speed and smaller size results. But if you want all your thumbs to be a .jpg, then you could use the format() function for that specific conversion.\nThanks for looking into this. ",
    "AlexVanderbist": "Hi @langeuh \nCurrently the format() conversion is available which allows you to set the conversion's output filetype:\nphp\n$this->addMediaConversion('png_conversion')\n        ->format(Manipulations::FORMAT_PNG);\nHowever there is no way to do something like format('src') in v5.\n@freekmurze maybe a keepOriginalImageFormat() method on the conversion is a good solution? Or should I implement the format('src') way in the Image package?. I agree, it's a bit strange that every image conversion defaults to a .jpg instead of the original format.\nI can only imagine this is because in the spatie/image package the underlying glide package defaults to jpeg encoding. If this is the case it would probably make sense to make the spatie/image package default to the original image type.. This should fix #534 . Hi @a-komarev!\nThanks for your input. I've created a PR (#552) that uses the url property on the public disk in the getUrl method. This should fix your issue without having to change getStoragePath!\nFeel free to fetch the branch from the PR and try it out. You'll need to make sure that the url property on your media disk is set in config/filesystem.php. If you're using the default public disk it should already be set as follows:\nphp\n        'public' => [\n            'driver' => 'local',\n            'root' => storage_path('app/public'),\n            'url' => env('APP_URL').'/storage',\n            'visibility' => 'public',\n        ],. @a-komarev The public_path() method would return the directory's path (for example /Users/alex/Webdev/laravel-medialibrary-demo/public/storage) instead of an url.\nThe url parameter is set to env('APP_URL').'/storage' by default in Laravel anyways: https://github.com/laravel/laravel/blob/master/config/filesystems.php#L54. Should fix #549. My bad, must've missed this when testing...\nThe third parameter is necessary to set some headers when uploading the file to a remote driver (like S3) so removing that is not an option.\nNow I'm looking at it again I'm thinking putStream() should be used instead of put() since fopen() will return a resource (on this line https://github.com/spatie/laravel-medialibrary/blob/v4/src/Filesystem.php#L69). I think this should fix the original #453 issue as well. Any thoughts @nicolasbeauvais ?\n. I'll test this in a minute, then send a PR \ud83d\udc4c. Maybe something like clearMediaCollectionExcept() or clearMediaCollectionPreserving()?\nIs the change considered breaking if the $excluded argument would be optional and null by default?. Should the CollectionHasBeenCleared event still be fired if the collection was only partly cleared?. Also; doesn't the removeMediaItemsNotPresentInArray method do exactly what the issue describes?. Updated the test and removed the unnecessary removeFiles(). Hi @Krato \nYou're looking for the following: \nphp\n$imageToModify->manipulations = [\n    'thumb' => [\n        'manualCrop' => \"{$value['imageWidth']},{$value['imageHeight']},{$value['imageLeft']},{$value['imageTop']}\"\n        ],\n    ],\n];\nThe docs aren't really clear on this but some investigating pointed this out: for the media specific conversions the value of the manipulations for a conversion always is a string. In this case the necessary arguments separated by comma's (as seen here: https://github.com/spatie/image/blob/master/src/Manipulations.php#L146).\nGood luck!. Looks like I've missed some things when adding keepOriginalImageFormat, thanks for pointing this out!. Hi @Krato \nI don't think it's possible (yet) to use the apply method on media specific conversions since it's not really a manipulation in the first place. \nAll the apply method does is start a new manipulationSequence every time it's called. When you're using media specific conversions the entire array you provided will be used as a manipulationSequence without checking for apply.\nI do see the need for different manipulationSequences when using media specific conversions and I think the example you provided would be a nice way to implement that.\nOnce that's in place another option might be to add a toArray method on the Conversion class, this way you could create Conversions just like in your HasMedia models and add those to the specific media:\n```php\n$resizedConversion = Conversion::create('resized')\n    ->width(123)\n    ->apply()\n    ->manualCrop(20, 20, 10, 10);\n$media->manipulations = [\n    'resized' => $resizedConversion->toArray()\n];\n```. Hi @jameslkingsley \nI've just checked the Superbalist/flysystem-google-cloud-storage package that's being used and one of their latest commits is a fix for your problem! It's tagged as 5.0.0 but the Superbalist/laravel-google-cloud-storage package still uses ^4.0...\nI'd suggest you open a new issue there so they can update their dependencies (or just implement the adapter yourself, it's just one provider).\nGood luck! . Hi @shankhadevpadam, is your media being stored on the local filesystem?. What OS are you using? Might be a filesystem permission issue, can you check if you can manually delete the files using the Storage facade? \nphp\nStorage::deleteDirectory(public_path('uploads/1'));. That's strange... $model->deleteMedia() simply finds and deletes() the media as well.\nI just added a passing test for deleting the Media instance directly, just to be sure:\nhttps://github.com/spatie/laravel-medialibrary/blob/e281b9dc7722258493e91005817813539afd6bba/tests/Media/DeleteTest.php#L25-L35\n. Hi Bert, I'm no expert on permissions but I'd suggest running PHP and NGINX as the web user as well just to avoid the issue altogether.. Alright, glad you got it solved!. Hi,\nIf you're looking to prevent large images from being uploaded you can use the dimensions validation rule: https://laravel.com/docs/5.5/validation#dimensions\nFor example:\n```php\npublic function upload() {\n    $this->validate(request(), [\n        'image' => 'dimensions:max_width=1500,max_height=1500',\n    ]);\n// Continue adding the file to medialibrary\n\n}\n``. What error is being thrown exactly? \n. My bad, on it right now! . Fixed in 6.1.1, sorry again. I couldn't seem to replicate this. Can you check whatdiskthe media is using in your database? If I understood correctly it should beposts`. \nCan you also check if your filesystems.php is structured correctly? The Media class checks for the value in filesystems.disks.DISK_NAME.driver (diskname should be posts again in this case).. Looks like I used the output from getDiskDriverName as the disk name for temporary urls... It got through testing because by default they're both s3 \ud83d\ude05\n6.1.2 fixes the issue.. @rluders Just a heads-up: last time I checked MariaDB didn't fully support the JSON type yet... You might want to look into that first.. That's really strange. I have a feeling this is not necessarily related to medialibrary... Escaping strings in relationship queries is really up to Laravel itself. \nJust to be sure, can you post the value for media_model in your medialibrary.php config please?. @guicara This is actually documented in the docs at https://docs.spatie.be/laravel-medialibrary/v6/requirements\nIt's also not possible to change the migrations to use anything else but the JSON columns as the packages relies on the column->\"$.jsonProperty\" SQL syntax.. Hey, you might actually be in luck. I had a quick look through the package and I couldn't find anything that might end up being a problem. Only array casting \n(https://laravel.com/docs/5.5/eloquent-mutators#array-and-json-casting) seems to be used on the json columns and that'll work just fine with a TEXT column. \nCan you let me know if this ends up working? Thanks. You're right! I'll look into it.. @vesper8 did the ConversionWillStart event work out for you? \nCan this issue be closed? . Hey @vesper8 \nYou're already piggybacking off of the optimized conversion. This means you can do something like $media->getPath('optimized'). If you would rename your dummy optimized conversion to face you can simple $media->getPath('face') as intended. Let me know if this works out or if I'm missing anything obvious.. @vesper8 I see your point on not having to create a \"fake conversion\". Ideally you would be able to define custom image manipulations but that's not implemented yet. \n\nbut what I think you're proposing is that.. I create another conversion identical to the 'optimized' conversion, and call it 'face'.. and piggy back off of that one? and then what? allow for the normal conversion to create the file 'face.jpg', and THEN execute my face detection with the ConversionHasBeenCompleted.. and.. replace the file.jpg with the results of the face detection?\n\nExactly. You'd replace the face.jpg conversion file with the result of the face detection. This way ->getPath('face') with simply return the path to face.jpg (which will be your custom file). \nI totally agree that this seems a bit redundant. If you can figure out a clean and tested way to do this feel free to open a PR! . That's really strange... I tried to reproduce this issue but couldn't seem to make anything break. \nDoes this happen with all images? Can you try this with a regular text file?\n. You can also try $client->getFirstMediaUrl() to get the same result (the url, not a collection). \nClosing this due to inactivity for now. Feel free to open a new issue if you're still running into problems.. Hi, \nI haven't used Windows for a while so I'm not sure what the expected separator would be for a relative path like the one in your first code example. Afaik a forward slash should always work, even on Windows.\nSomething strange I noticed when looking into this is that the storage_path helper uses the DIRECTORY_SEPARATOR constant but Laravel's FilesystemAdapter doesn't... \nMaybe someone with some more Windows experience can shed some light on this? \n. Hi, there's currently no way to do this. You can however add your own pivot model that supports adding one Media to many models. Check out this issue that has some more info on that: https://github.com/spatie/laravel-medialibrary/issues/205. I assume by \"media generator\" you mean a custom path generator? \nIf that's the case: there's no way to assign a specific path generator to a specific model. You can however implement this in your custom path generator. For example something like this (untested):\n```php\nclass CustomPathGenerator extends BasePathGenerator implements PathGenerator\n{\n    public function getPath(Media $media): string\n    {\n        if ($media->model_type === ModelWithCustomPath::class) {\n            return 'custom/path/logic/here';\n        }\n    return parent::getBasePath($media).'/';\n}\n\npublic function getPathForConversions(Media $media): string\n{\n    // same as `getPath`\n}\n\n}\n```\nHopefully this is what you're after.\n. Hi @maximaexchen \n\nCould I some how directly save it to a storage path (custom PathGenerator) with the associated collection_name?\n\nThere's currently no way to save to the media's conversion path directly. That means you're right about having to save your pdf to a temp folder first.\nSomething like this should do the trick:\n```php\n$pdf = PDF::loadView('account.pdf', compact('procedure' ));\n$pdfPath = storage_path(\"temp_procedure_pdfs/{$procedure->id}.pdf\");\n$pdf->save($pdfPath);\n$procedure\n            ->addMedia($pdfPath)\n            ->toMediaCollection('procedure');\n```\nGood luck! . Hi! \nThe easy \"Laravel way\" of doing this is via the public disk.\nRetrieving media in your blade views then becomes as easy as $user->getFirstMediaUrl('avatars', 'resized') (like you said).. It wasn't, reverting this one in 7.3.10 as tests for 7.3.9 still fail with that issue.... Thanks for the suggestion and the compliment! Most of these aspect/features are currently quite interwoven in the the package. I don't think there are any concrete plans to abstract any of these features into separate packages. \nHowever, all code is open source so feel free to abstract any of it to your own package.. Are you still experiencing this issue? Can you share the contents of your composer.json file? \nFeel free to close this issue if you're no longer having problems.. If you're still experiencing this issue: can you share the code where you're adding the image to the media library?\nIf not, feel free to close this issue. Thanks! . This was done mainly to have a clear difference between addMediaFromRequest returning a FileAdder instance and addMultipleMediaFromRequest returning an array of FileAdders. \nPersonally I'd prefer a variadic method as well but I'm not sure if that's considered a breaking change?. ",
    "theinhlamaw": "I was looking for the same answer for Laravel Medialibrary v.7 here. The following code works for me.\nphp\nforeach($request->file('images') as $image) {\n   $report->addMedia($image)->toMediaCollection('medical-reports');\n}\nI only need to change toCollection() to toMediaCollection(). Thanks @kickthemooon and @freekmurze.. ",
    "matthewhall-ca": "@sebastiandedeyne It's in the examples on\nhttps://docs.spatie.be/laravel-medialibrary/v4/advanced-usage/consuming-events\n. ",
    "laravelpro": "//        rename($conversionResult, $outputFile);\nif( copy($conversionResult, $outputFile) )\n    {\n        unlink($conversionResult);\n    }\nSo I have to replace the rename function and it works. \nCan you update the package?\n. ",
    "tcsehv": "I know it is a closed issue, but this might help people that run into the same issue. I had the same issue when using vagrant with VMWare Fusion while using the default shared folder settings for my project files. The files where moved (with rename), but php still triggered an error. \nWhen I changed the shared folder settings to NFS the problem was gone. Another option is to suppress the error by using @rename, but ugh. \n. ",
    "matriphe": "I found this error too. The image was renamed and existed, but the error occured. \nI were on Mac, it said:\nErrorException in GlideImage.php line 67:\nrename(/var/tmp//UuVUlLnpaBWh2nB2thumbnail.jpg/b2d297c271f2457bf482ee90d5ff439e, /home/matriphe/dev/laravel/storage/medialibrary/temp/XMFM21eCqTsI2n0z/UuVUlLnpaBWh2nB2thumbnail.jpg): Operation not permitted\nBoth /var/tmp//UuVUlLnpaBWh2nB2thumbnail.jpg/b2d297c271f2457bf482ee90d5ff439e and /home/matriphe/dev/laravel/storage/medialibrary/temp/XMFM21eCqTsI2n0z/UuVUlLnpaBWh2nB2thumbnail.jpg existed.\nBoth directories has been chmod-ed to 777.\n. @laravelpro in what file did you change the function?\n. just did what @laravelpro did, by changing rename function to copy on laravel-glide's GlideImage.php and worked like charm.\nI think using copy instead of rename is great option.\n. I've been looking for this issue. Now it's confirmed that it's a ownership and permission problem. \nOn my OSX 10.11, I changed ownership of /var/temp folder using chown -R {username}:staff /var/tmp (notice staff group). \nI use PHP 7.0 from Homebrew. I don't know why why the images were uploaded to /var/tmp. Changing upload_tmp_dir in php.ini has no effect.\nIt might help someone who facing the same problem with mine.\n. ",
    "bakerstreetsystems": "I had the same problem and @matriphe's suggestion helped. I ran the following command and now everything works great:\nsudo chown -R {your username}:staff /var/tmp\nI'm on a Mac running macOS Sierra with Mamp Pro running PHP 7.\n. Thanks for replying. I've looked through the recent similar issue you suggested (#321), and though both issues are related to file conversions, I believe issue 321 has to do with possible errors in the Laravel queue configuration whereas the issue I'm having - trying to use conversions with S3 - doesn't ever get to the queue step.\nMy queue driver up to this point has been 'sync', and as I mentioned in my original post, everything works perfectly when the filesystem is set to 'local' or 'media'. But when I switch it to S3, only the original image gets uploaded to S3 and I don't think laravel-medialibrary even attempts to execute the conversions.\nTo double check this, I changed my queue driver to 'database' so I could see if jobs were even being queued. With the filesystem set to 'local' or 'media', the conversion job was successfully queued and I could see the record in the 'jobs' table in my database. With the 's3' filesystem, no job was queued.\nI then tried adding ->nonQueued() to each addMediaConversion in the registerMediaConversions method in my Product model. Again, it works with the 'local' and 'media' filesystems, but not with the 's3' filesystem.\nAnything else I should try?\n. I just tried using the latest version, and it appears to work great now! This issue may be closed.\n. ",
    "kblais": "Here is the output when launching tests with PHP 5.6.22 on v3 branch :\n```\n$ php5 ./vendor/bin/phpunit\nPHPUnit 4.8.26 by Sebastian Bergmann and contributors.\nRuntime:    PHP 5.6.22-1\nConfiguration:  /workspace/laravel-medialibrary/phpunit.xml.dist\nWarning:    The Xdebug extension is not loaded\n        No code coverage will be generated.\n............................................................F..  63 / 127 ( 49%)\n...F........................................................... 126 / 127 ( 99%)\n.\nTime: 7.59 seconds, Memory: 32.75MB\nThere were 2 failures:\n1) Spatie\\MediaLibrary\\Test\\HasMediaConversionsTrait\\DeleteMediaTest::it_can_clear_a_collection\nFailed asserting that actual size 3 matches expected size 0.\n/workspace/laravel-medialibrary/tests/HasMediaConversionsTrait/DeleteMediaTest.php:39\n2) Spatie\\MediaLibrary\\Test\\HasMediaTrait\\DeleteMediaTest::it_can_clear_a_collection\nFailed asserting that actual size 3 matches expected size 0.\n/workspace/laravel-medialibrary/tests/HasMediaTrait/DeleteMediaTest.php:38\nFAILURES!\nTests: 127, Assertions: 257, Failures: 2.\n```\nOn PHP 7, tests work fine.\n. ",
    "fgreinus": "This has now been implemented and successfully merged btw :-).. I fixed the things you noted in your comments. The failed travis builds seem to be related to an issue within the provisioning.. $base64data or $base64Data (the second seems to be more correct in favour of camel-case). First time actually using scalar type hints.. so I did not think about this neat behaviour.. thanks!. ",
    "cobisja": "Oh I see, well I'm going to do more researching :p\nThanks so much!\n2016-06-14 17:52 GMT-04:00 Freek Van der Herten notifications@github.com:\n\nThanks for the kind words on the package.\nI don't know the exact setting by heart, but I'm pretty sure that in S3\nyou can specify somewhere (via a policy I believe) that all uploaded files\nshould be public.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/241#issuecomment-226027435,\nor mute the thread\nhttps://github.com/notifications/unsubscribe/AJzLMifMG6yG7KkMUBznVKZaYnj0l0Viks5qLyKUgaJpZM4I1hfW\n.\n. \n",
    "palpalani": "Add the custom header 'ACL' => 'public-read', to config/laravel-medialibrary.php.\nComplete example:\n'extra_headers' => [\n            'CacheControl' => 'max-age=604800',\n            'ACL' => 'public-read',\n        ]\n. Yes, It works.\nThanks for the information.\n. ",
    "omacesc": "@divdax thanks for your answer, but do you know any way to apply public read to the conversions? thanks!. @divdax @freekmurze  any news about this? exist another way to put acl public in conversions? . No, because i have some files public and other private. @brendt thanks for you answer, but i tried and doesn't work :(\nin controller:\n$model->addMedia($request->image)->addCustomHeaders([\n                    'ACL' => 'public-read'\n                ])->toMediaCollection($type,'s3');\nin model:\n$this->addMediaConversion('thumb')\n            ->fit(Manipulations::FIT_FILL, 500, 120)\n            ->nonQueued();\n. @brendt thanks for the work, if you want to check something tell me.. sorry for open this issue, but can you apply this fix to version 6.6? Thanks!. thanks for your answer @brendt , but the problem is my version of php, is the 7.0, and i can't use the medialibrary 7.*. ",
    "joaosalless": "@palpalani see this documentation:\nhttps://docs.spatie.be/laravel-medialibrary/v4/advanced-usage/using-a-custom-directory-structure\nand\nhttps://github.com/spatie/laravel-medialibrary/blob/3.9.0/tests/PathGenerator/CustomPathGenerator.php\n. ",
    "Banandrew": "I tried responding with a specific header, but it didn\u2019t help:\nPHP\nreturn response()->file($media->getPath(), [\n    'Content-Type' => 'image/jpeg'\n]);\n\nb) Create a symlink in the public folder to storage/files\n\nBut isn\u2019t it the same as having everything in public_path? I mean, everybody can access a url and get to the file, it just points to another directory, correct? I already created one, it works perfectly, but doesn\u2019t resolve the privacy issue, am I missing something?\n. That\u2019s relieving, thank you.\n\nAre you getting a response when you go straight to the url?\n\nYeah, the route is set up like so:\nPHP\n// When I open http://localhost:3000/files/2RmYR3\n// I get this blank 200 response I mentioned in the first commentary.\nRoute::get('files/{slug}', [\n    'as'   => 'get.file',\n    'uses' => 'FileController@getFile',\n]);\nHere\u2019re the response headers:\n\n. Thanks for reaching out, Sebastian, I\u2019ll keep digging.\n. ",
    "kmbt": "Oh, never mind my request. I have just realized that the check is done in URL generator and not in the Path generator so I just need to write my own URL generator and everything should be ok.\n. Thank you for the prompt response and for the links :) Sorry for the trouble.\n. ",
    "jamesinglis": "The above errors were generated on a Laravel Forge server running PHP 7 with HHVM.\nPHP 7.0.8-1+deb.sury.org~xenial+2 (cli) ( NTS )\nCopyright (c) 1997-2016 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies\n    with Zend OPcache v7.0.8-1+deb.sury.org~xenial+2, Copyright (c) 1999-2016, by Zend Technologies\n. I've done a bit more exploring around this issue and have found a very simple explanation - my test environment was running HHVM, instead of just plain PHP 7.0. I see that HHVM isn't as flexible with the type hinting options, which is why it caused errors.\n. ",
    "Garbee": "Comments inline. Personally I think removing the type hints is the incorrect approach to solving the problem. Instead using the errors to your advantage and fixing things internally to the method will provide the best package.\n. @nicolasbeauvais Depending no whichever is merged first, resolving that is simple and hardly a problem.\n@freekmurze Why in this situation are if statements preferred? Knowing this will help me, and possibly others, know whether trying to clean up other parts of the codebase would be worth putting the time into.\n. This PR is ready for complete review along with the documentation. All functionality is complete and tested.\n. medialibrary:regenerate is exactly why I need this upstream. It fails outright if you are missing a primary image. So you have to go remove the entry, then try again and hope another isn't missing.\nI do plan to add a flag to that for fixing that problem. However, this command and service layer are still extremely useful. Since it allows you to easily keep constant check on your media.\nThis also has nothing to do with the clean command. That is an entirely different kind of issue.\nI guess if this service isn't accepted upstream I'll need to fork the package outright to improve it for large-scale media sites. Currently it can't gracefully handle any issues that occur where a media item ends up missing. And when you have tens-of-thousands of media files, that is crucial to be able to handle.\n. > Derived images should always exists. If not, because a new conversion is defined on a model later on, users can use the medialibrary:regenerate command.\nAlso on this note there is still no verification that the primary files still exist which are a problem. So it completely dodges the point of \"do my main files still exist.\"\nHow are applications supposed to know en-mass if the primary media files still exist? Or is every app using your package supposed to custom-code their own solution to this problem?\nThis is massive issue with this package for sites that have large-scale media.\n. I happen to have built a system automating trying to pull in 30 thousand images initially and several hundred more every few months. Some of these fail creating files for who-knows-why, yet the DB is still updated.\nAt scale, this package doesn't handle helping people with large datasets like this out. I'm also very confused as to why the package is open-source, but only things you need within your apps are approved for merge. Open-source is about helping everyone out. This package could greatly benefit from some thought-process as to how it works at scale, and everyone can benefit. Yet, it is being turned aside with only \"we've never needed it.\"\nI'm simply upset that other users of your package can't benefit from this addition if they are having problems doing the same type of thing. Nothing here affects how any existing apps operate or how future things would operate. It is extremely puzzling.\n. So, there is a technical reason, it is too complex. Do you mind pointing out the complex areas? I could possibly reduce the solution to be simpler. The service layer is the important piece here and it is quite trivial. The artisan command is certainly slightly-complex, however that is to provide the best user-experience.\n. Anything without a default value can be left alone. They aren't causing a problem.\n. Why not use string $collectionName = null, $filers = [] and then do return app(MediaRepository::class)->getCollection($this, $collectionName ?: '', $filters); for the content here? (Rinse and repeat for the other methods.)\n. ",
    "Benpxpx": "Thought that might be the case, I've managed to get word docs working.\nMany thanks\n. ",
    "hamid-shafiee": "Thanks for your quick response. Appreciate it.\n. I've been studying this topic in documentation before hand. but I how do I tell media-library to use new path generators based on entity types? \n. Thanks for answer but I didn't mean that. In Helpers namespace there's a File.php which utilizes Finfo class (line 55)\n. Yes thanks anyways man\n. you have done much for the community. cheers\n. Thanks guys. so I'd suggest adding this feature as well: ability to change/update CustomProperty after adding new media.\n. ",
    "chirag6451": "Thanks, as I wrote I can retrieve the path but actual/physical folders/files are not there on given path. please help. It would be very useful to have full blog. \n. OK I just found something, I dont know why but if we use as per your documentations \n$User->addMediaFromUrl($url)\n          ->toMediaLibrary();\nit does not create conversions folder and thumbs but if we use like\n$User->addMediaFromUrl($url)\n          ->toMediaLibrary('');\n```\nIt does create. I dont know why\n```\n. ",
    "bjornbjorn": "Hi, I agree that this is a bit confusing ... I think the reason for the behaviour is because ->toMediaLibrary() takes a collection name as first parameter, and when you run it without a parameter the collection name used is 'default'.\nMost likely you have defined your thumbs conversion to run on the 'images' collection only, like this:\npublic function registerMediaConversions()\n{\n        $this->addMediaConversion('thumb')\n            ->setManipulations(['w' => 512, 'h' => 288])\n            ->performOnCollections('images');\n}\nSo it won't run on your 'default' collection. Not sure why it does run when you specify an empty string as the collection like you did though.\n. ",
    "jpmurray": "Honestly, I was hoping for some kind of surprise like this one! :) (That'll teach me not to scourge the source code :P) Thanks!\n. @freekmurze Hum, just to make sure, what do we feed updateMedia()'s mediaArray with? IDs of media, or filename path like with addMedia() ?\n. Ok, so it's really just the result an array of the results for getMedia(). Thanks!\n. @nicolasbeauvais Actually, the files are stored in a media/tmp directory, the media one being where spatie/laravel-medialibrary stores it's own files. I thought this would be a tmp folder created by the package, and not by the system?\n. I'm on 4.8.3. And here's a screenshot of some rows!\n\n. Well, apart from changing the disk field in the database too... Yes, that's how easy it is!\nClosing! \ud83d\udc4d . ",
    "timgavin": "I'm receiving an error. Not sure exactly what I'm doing wrong; just trying to regenerate images...\n$media = $post->getMedia()->toArray();\n$post->updateMedia($media, 'mycollection');\nResults in: Class 'Spatie\\Medialibrary\\Exceptions\\MediaCannotBeUpdated' not found\n. Yep, that solved it, thanks!\nI'm experiencing a different problem though; I have 3 images from when I saved the post. I now want to add 3 more images, each with a filter.\nThe workflow is like so:\n1. User creates a post and adds an image.\n2. Images are converted tosm, md, and lg, with original being preserved.\n3. user updates post and ticks checkbox to add a filter to image.\nI need to be able to save the original images, PLUS add new conversions with the filter. I already have the code for creating the filter, so I'm really just trying to update an existing collection by adding 3 new images to it.\nDirectory after creating the post\nimages\n  -- conversions\n  ---- lg.jpg\n  ---- md.jpg\n  ---- sm.jpg\n  -- original.jpg\nDesired directory after user updates post and applies filter\nimages\n  -- conversions\n  ---- lg.jpg\n  ---- md.jpg\n  ---- sm.jpg\n  ---- lg-with-filter.jpg\n  ---- md-with-filter.jpg\n  ---- sm-with-filter.jpg\n  -- original.jpg\nHope this makes sense! :)\nEdit: the original uploads have the collection_name \"original\" and the new images will have the collection name \"filtered.\" This is where I'm experiencing the problem. When updating the post I receive the following error.\nMedia id 1 is not part of collection `filtered`\nI'm guessing I need to add a new collection_name to the existing, but not sure how?\n. I think I may have it, but it just feels really clunky. I had to build out the full path; I wasn't able to use $image->getPath() because I kept receiving the following error:\nCall to undefined method App\\SpatieUrlGenerator::getPath()\nHere's what I'm working with so far...\n```\n$mediaItems = $post->getMedia();\nforeach($mediaItems as $image) {\n    $post->addMedia(storage_path('app/'.$image->getCustomProperty('hash').'/'.$image->file_name))\n         ->usingFileName('with-filter-'.$image->file_name)\n         ->withCustomProperties(['hash' => $image->getCustomProperty('hash'), 'visability' => 'filtered'])\n         ->toCollection('filtered');\n}\n```\nIs there a better way?\n. Figured it out. It was automated and right in front of my face and I totally missed it! :P\n. Is it possible to pass parameters to registerMediaConversions()?\n. I think I was asking about  passing ausername. I originally thought I'd like to store all of a user's images inside a folder named with their username.\nSomething like this\n```\njoedoe\n--imageOne\n----conversions\n--------imageOne.jpg\njanedoe\n--FluffyCats.jpg\n--conversions\n----tnFluffyCats.jpg\n--StarWars\n---LightsaberSquirrels.jpg\n--conversions\n----tnLightsaberSquirrels.jpg\n```\n. Thanks. I have that figured out; I'm using unique hashes as my directory names now. Users will be uploading lots of pictures so I was hoping to be able to organize them by username instead of having thousands and thousands of hashed directories. :)\n. @threeel \nThis adds and centers a watermark PNG to a thumbnail conversion\n->setManipulations([\n     'w' => 350,\n     'fm' => 'src',\n     'mark' => public_path('assets/img/watermark.png'),\n     'markfit' => 'fill',\n     'markpos' => 'center',\n ])\n. Thanks for that example, it worked perfectly.\nI upgraded to the latest Media Library and am still having the problem. I think the issue I'm having is that I'm using the media library for images (works well - no error messages), which are stored locally, and for videos, which are not stored locally. So, inside config/laravel-medialibrary.php I'm calling custom classes to generate my URLs and paths.\n```\n/\n * When urls to files get generated this class will be called. Leave empty\n * if your files are stored locally above the site root or on s3.\n /\n'custom_url_generator_class' => App\\SpatieUrlGenerator::class,\n/\n * The class that contains the strategy for determining a media file's path.\n /\n'custom_path_generator_class' => App\\SpatiePathGenerator::class,\n```\nThe docblock says to leave custom_url_generator_class blank if not storing locally. Could this be the problem?\n. @freekmurze I don't understand what you mean by this: \"The quickest solution for should be to just at that getPath method an return the full path to the file.\"\n. Yep, works. No error messages. Thanks. :)\npublic function getPath()\n{\n    return $this->getPathRelativeToRoot();\n}\n. Thank you for the explanation - it's clearer now.\nWhat's confusing to me though is that I only want to add the item to the collection, but leaving off the second parameter means that Media Library will actually move the file to the default disk. I don't want that, I only want to add the file to the collection - not manipulate or move it.\nSee, the problem that I have is that I need to SFTP the file to my server and in order to do that I (believe) I need to use the SFTP package included in FlySystem, as I haven't been able to SFTP with the default Laravel FileSystem. I haven't been able to successfully upload a file using Media Library and FlySystem either, so I have to do it in two steps: upload with FlySystem, then add to collection using Media Library.\n```\n$hash = str_random(16);\n$filename = $hash.'.'.$request->file('file')->getClientOriginalExtension();\n$contents = fopen(request()->file('file'), 'r+');\nFlysystem::connection('sftp')->put($hash.'/'.$filename, $contents);\n$post->addMedia($request->file('file'))\n    ->usingFileName($filename)\n    ->toCollection('video', 'video');\n```\nThis isn't desirable, but it's the only thing I can get to work so far.\nIsn't there a way to just add the file to the collection without moving it? Or, better yet, is there a way to SFTP the file to my Forge server using Media Library?\n. I have two Forge servers: one for the app and one for encoding video. I upload the file through the app and then send it to the encoding server to be encoded, then stored using DigitalOcean block storage.\n. I'm using LaravelCollectives SSH package and it's working well. Thanks. :)\n. OK, thanks.\nFor anybody else who might need this, I've created a simple function to check if a conversion exists, and if not to show the full-size upload\n```\nfunction getImage($image, $size) {\n    if(file_exists(storage_path('app/media/'.$image->getPath($size)))) {\n        return $image->getUrl($size);\n    }\nreturn $image->getUrl();\n\n}\n```\nuse like\n<img src=\"{{ getImage($image, 'md') }}\" alt=\"\">\n. Works perfectly. Thanks!\n. @freekmurze Unfortunately I can't. I couldn't wait and had to develop another means of doing this.\n. This change actually breaks my app, which I've spent a very long time building.\nIf I get 'public' images, then I can't see the private ones, and vice versa. Do I need to rebuild how I'm doing things and add everything to a 'default' collection (which I currently don't have) and set the visibility via the custom_properties?\nWhat's the point of having collection names if you can no longer use them?. Right, so when I didn't provide a collection name I would receive all images from the public and private collections for each post, and then I would filter them based on a custom property, like so...\n```\n$array = $post->getMedia();\nforeach($array as $image) {\n    if(canView($post, $access)) {\n        if($image->getCustomProperty('visability') == 'private') {\n            // show private image\n        }\n    } else {\n        if($image->getCustomProperty('visability') == 'public') {\n            // show public image\n        }\n    }\n}\n```\nNow that I have to specify a collection name, I only get the images from that specified collection, not from both, which breaks my app.\nCan there be a preference that allows the old behavior? Or do I need to reconfigure my app and only use a default collection?. still doesn't make a difference. in fact, it won't even do conversions anymore on new images.. Found the problem: I needed to convert all of my manipulations to the new format supported by spatie/image.\nI know that's specified plain as day in the upgrade guide, but for some reason it just didn't click with me. :P. Wish I could help code it, but my PHP & Laravel skills are nowhere near what's required. :(\nI can, however, offer ideas: I think it would be a good thing to not only give each image a temp URL, but each conversion as well. \nScenario 1\nI upload a photo and want to make three different sizes of it, small (for mobile), medium (for desktop and tablet), and large for Lightbox display. All three of those would be public URLs.\nScenario 2\nI upload a photo that I want to sell, so I don't want to show the large one. In this case I could have a small and medium for thumbnail display, and the large one with a private URL that is only visible when the user purchases access.\nScenario 3\nBasically the same as #2, but with 6 conversions instead of 3. The 3 public conversions will be watermarked, or blurred, or obfuscated in some way, and the 3 private conversions will be normal photos that will only be shown if the user is granted access.\nHopefully that makes sense. :)\n. @codyphobe I tried that too but kept receiving the error: This driver does not support creating temporary URLs.\nI couldn't get it to work.. Thanks for this!\nUnfortunately, it doesn't seem to work with DigitalOcean, which I'm assuming has something to do with this: https://github.com/GrahamCampbell/Laravel-Flysystem/issues/100#issuecomment-330216084\nThis is an FYI, not a complaint. :). I didn't. I gave up and went with S3.. Now I'm receiving a new error.\nWhen running: dd($image->getTemporaryUrl(\\Carbon\\Carbon::now()->addMinutes(5)));\nI get the error: Driver [] is not supported.\nWhen running: dd($image->getUrl()); I get the expected result.\nI've removed the URL Generator from the Media Library class to make sure it wasn't causing the problem.\n```\n/\n * When urls to files get generated this class will be called. Leave empty\n * if your files are stored locally above the site root or on s3.\n /\n'custom_url_generator_class' => null,\n/\n * The class that contains the strategy for determining a media file's path.\n /\n'custom_path_generator_class' => null,\n```\nThis is my driver in filesystems.php\n'posts' => [\n    'driver' => 's3',\n    'key' => env('AWS_KEY'),\n    'secret' => env('AWS_SECRET'),\n    'region' => env('AWS_REGION'),\n    'bucket' => env('AWS_BUCKET'),\n    'root' => 'posts',\n],\nAny ideas?. Yes, it's posts.\n\nAnd I've switched over to Amazon S3 (from DigitalOcean) at this point to make sure we're all on the same page and to rule that out.\nHere's my filesystems.php\n```\n<?php\nreturn [\n/*\n|--------------------------------------------------------------------------\n| Default Filesystem Disk\n|--------------------------------------------------------------------------\n|\n| Here you may specify the default filesystem disk that should be used\n| by the framework. The \"local\" disk, as well as a variety of cloud\n| based disks are available to your application. Just store away!\n|\n*/\n\n'default' => env('FILESYSTEM_DRIVER', 'local'),\n\n/*\n|--------------------------------------------------------------------------\n| Default Cloud Filesystem Disk\n|--------------------------------------------------------------------------\n|\n| Many applications store files both locally and in the cloud. For this\n| reason, you may specify a default \"cloud\" driver here. This driver\n| will be bound as the Cloud disk implementation in the container.\n|\n*/\n\n'cloud' => env('FILESYSTEM_CLOUD', 's3'),\n\n/*\n|--------------------------------------------------------------------------\n| Filesystem Disks\n|--------------------------------------------------------------------------\n|\n| Here you may configure as many filesystem \"disks\" as you wish, and you\n| may even configure multiple disks of the same driver. Defaults have\n| been setup for each driver as an example of the required options.\n|\n| Supported Drivers: \"local\", \"ftp\", \"s3\", \"rackspace\"\n|\n*/\n\n'disks' => [\n\n    'local' => [\n        'driver' => 'local',\n        'root' => storage_path('app'),\n    ],\n\n    'public' => [\n        'driver' => 'local',\n        'root' => storage_path('app/public'),\n        'url' => env('APP_URL').'/storage',\n        'visibility' => 'public',\n    ],\n\n'posts' => [\n        'driver' => 's3',\n        'key' => env('AWS_KEY'),\n        'secret' => env('AWS_SECRET'),\n        'region' => env('AWS_REGION'),\n        'bucket' => env('AWS_BUCKET'),\n        'root' => 'posts',\n    ],\n],\n\n];\n``. I decided to try switching the disk name back frompoststos3` and that solved it; I now get a full temporary URL.\n's3' => [\n    'driver' => 's3',\n    'key' => env('AWS_KEY'),\n    'secret' => env('AWS_SECRET'),\n    'region' => env('AWS_REGION'),\n    'bucket' => env('AWS_BUCKET'),\n    'root' => 'posts',\n],\nHopefully we're not stuck with this and will be able to use custom disk names?. That fixed it. Thanks! \ud83d\ude03 . Just updated Media Library to test and received Call to undefined method Spatie\\MediaLibrary\\Media::getFirstTemporyUrl() error.\nDo I need to pull in the dev version?\nAlso, the method name is misspelled. Currently it's getFirstTemporyUrl and it should be getFirstTemporaryUrl :). I use custom properties for all sorts of things; I think they would be perfect for alt tags.\n<img alt=\"{{ $media->getCustomProperty('alt') }}\" src=\"{{ $media->getFirstMediaUrl('images', 'thumb') }}\">. ",
    "legshooter": "Done. Is that ok?\n. Right, I thought I did, sorry :/\n. argh. Nah man, it's ok, this is the exact reason why I avoid PRing, I don't want to f:boom:ck things up and waste people's time. Thanks for the tips.\nStill got a way to go with OS/Git/GitHub/PRing/testing ($key/$name part has nothing to do with it of course, that was just a careless mix up)... I think I told you that once in the PJAX Middleware context. Which reminds me I made a nice function (I think) to bust the cache automatically, but I don't wanna embarrass myself with another PR, haha :)\nI do have a couple of questions about stuff I am still not sure about, if you're willing.\nYou wrote this check:\nphp\nif ($this->hasCustomProperty($name)) {\n    // ...\n}\nThis way if I pass a non-existing $name, I'll never know that it wasn't in $this->custom_properties to begin with. The end result is indeed the same, $this->custom_properties will not contain a $name key, but I thought there's value to erroring out on passing non-existing keys. Was I supposed to know on my own that a check is preferred to let non-existing names \"slide\"?\nAlso, are you saying you can only overwrite $this->custom_properties? This is why you're overwriting it with a merged (with itself) array in $this->setCustomProperty()? Does this have anything to do with the fact $this->custom_properties is not explicitly declared anywhere?\n. ",
    "hosmelq": "I pushed this to v3 too. Is the version that i'm using. \ud83d\ude15\n. ",
    "dopyoman": "What extension would need to be enabled to fix this? I'm running into this error as well.. ",
    "joebenson": "I also ran into this. Perhaps adding exif as a dependency in the docs would be helpful for others. Just a suggestion. Would've saved me a few extra minutes. Stellar package overall!. ",
    "dliebel": "Hello\nI have a problem getting the url of the image\nThis is my model\n`namespace App\\Models;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia;\nclass BlogPost extends Model implements HasMedia\n{\n    use HasMediaTrait;\n    public $table = 'blog_post';\npublic function addImage($path){\n    $this->addMedia($path)\n         ->preservingOriginal()\n         ->toMediaCollection();\n}\npublic function getImage(){\n    $media = $this->getMedia();\n    $ruta = $media[0]->getUrl();\n    return $ruta;\n}\n\n}`\nThis my method when I want to get the url of the image\n`$postQuery=  BlogPost::where('status', '=', 1)\n                            ->orderBy('id', 'asc')\n                            ->select(['title','description','article','date_published','banner_imagen'])\n                            ->get();\n            $postsSend=array();\n            foreach( $postQuery as $q ){\n                $post = array();\n            if( $q->hasMedia('images') ){\n                $post['imagen'] = $q->getImage();\n            }else{\n               $post['imagen'] = 'noUrl';\n            }\n            $postsSend[]=$post ;\n        }\n        $statusCode=200;\n        $response = [\n            'post'=>$postsSend\n        ];\n         return response()->json($response, $statusCode);`\n\nI do not know where I'm wrong. One not so elegant solution was the following\n`$postQuery=  BlogPost::where('status', '=', 1)\n                            ->orderBy('id', 'asc')\n                            ->select(['id','title','description','article','date_published','banner_imagen'])\n                            ->get();\n        $postsSend=array();\n\n        $media=array();\n\n        foreach( $postQuery as $q ){\n\n            $post = array();\n\n            $post['id'] = $q->id;\n            $post['title'] = $q->title;\n            $post['description'] = $q->description;\n            $post['article'] = $q->article;\n            $post['banner_imagen'] = $q->banner_imagen;\n            $media= Media::where([\n                    ['model_type', '=', 'App\\Models\\BlogPost'],\n                    ['model_id', '=',  $q->id] ])\n                    ->orderBy('id', 'desc')->first();\n            if (!empty($media)) \n               $post['imagen'] = $media['id'] .\"/\".$media['file_name'];\n\n            $postsSend[]=$post ;\n        }`\n\n. ",
    "xtrasmal": "duplicate #288 \n. Ok seems to be solved. The error is gone after updating to 4.8.\nBut. any ideas why images do get added to the database, but the actual storing of the file does not go through. No error.\n. Ok, locally it works when I have a symlink from the public folder to the storage folder:\nmedia@ -> ../storage/media\n. Blegh.. I knew this was something simple like a typo. Changed it to the real folder.\nmedia@ -> ../storage/app/public/media\nSorry for this. This webshop is taking me 12 hours a day and I might need to buy me a crate of beer and a rubberboat with a palmtree.\n\n. thnks\n. ",
    "sdeering": "How did you solve this? @xtrasmal . Looks like removing vendor dir and composer install did it for me.. ",
    "mintbridge": "The $key and $value arguments have swapped round in first in 5.3, so this will need updating as well: https://github.com/spatie/laravel-medialibrary/blob/95b4f666eed00b40fe1bbb69e2fd06db67d94c4a/src/Conversion/ConversionCollection.php#L51\nmore in the upgrade guide under collections https://laravel.com/docs/master/upgrade#upgrade-5.3.0\n. ",
    "gnumoksha": "Laravel 5.3 is in release candidate now. Don't you think that it is time to support him to get feedback of testers?\n. Laravel 5.3 is in release candidate now. Don't you think that it is time to support him to get feedback of testers?\n. ",
    "LeonB": "And I believe the SelfHandling interface should be removed from src/Jobs/PerformConversions.php.\nIn Laravel 5.2 that interface was deprecated and in 5.3 it is removed: https://github.com/laravel/framework/pull/11419/files\n. thanks @freekmurze!\n. ",
    "peterfrankjohnson": "Laravel 5.3 is now officially available. https://laravel-news.com/2016/08/laravel-5-3-is-now-released/\n. ",
    "packytagliaferro": "@freekmurze  Its Medialibrary V. 4 and PHP V. 7. \n@nicolasbeauvais , whoops. I just came back to this project and I did have all the on the User Model. I accidentally added it to the controller.  But when I remove it I still get the same error even with those trates in the User model. Here is what the upload response is if I print $file in the loop:\n```\nReszc9X2LqPCCCFm1PoD0zHqdXXun5nnZ7NskZ7gArray\n(\n    [0] => Illuminate\\Http\\UploadedFile Object\n        (\n            [test:Symfony\\Component\\HttpFoundation\\File\\UploadedFile:private] => \n            [originalName:Symfony\\Component\\HttpFoundation\\File\\UploadedFile:private] => alarm-news-pic-5.jpg\n            [mimeType:Symfony\\Component\\HttpFoundation\\File\\UploadedFile:private] => image/jpeg\n            [size:Symfony\\Component\\HttpFoundation\\File\\UploadedFile:private] => 120482\n            [error:Symfony\\Component\\HttpFoundation\\File\\UploadedFile:private] => 0\n            [pathName:SplFileInfo:private] => /Applications/MAMP/tmp/php/php2efdGJ\n            [fileName:SplFileInfo:private] => php2efdGJ\n        )\n[1] => Illuminate\\Http\\UploadedFile Object\n    (\n        [test:Symfony\\Component\\HttpFoundation\\File\\UploadedFile:private] => \n        [originalName:Symfony\\Component\\HttpFoundation\\File\\UploadedFile:private] => alarm-news-pic-6.jpg\n        [mimeType:Symfony\\Component\\HttpFoundation\\File\\UploadedFile:private] => image/jpeg\n        [size:Symfony\\Component\\HttpFoundation\\File\\UploadedFile:private] => 116141\n        [error:Symfony\\Component\\HttpFoundation\\File\\UploadedFile:private] => 0\n        [pathName:SplFileInfo:private] => /Applications/MAMP/tmp/php/phpnFIaEs\n        [fileName:SplFileInfo:private] => phpnFIaEs\n    )\n\n)\n```\nUser Model:\n```\n<?php\nnamespace App;\nuse Zizaco\\Entrust\\Traits\\EntrustUserTrait;\nuse Illuminate\\Foundation\\Auth\\User as Authenticatable;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia;\nclass User extends Authenticatable implements HasMedia\n{\n     use EntrustUserTrait; // add this trait to your user model\n     use HasMediaTrait; //this is for the media library\n     .............................More code\n```\n. @freekmurze @DotFreelance  per Laravel 5.2 I dont use formbuilder but just a regular form that allows uploads\n<form id=\"real-dropzone\" class=\"dropzone\" action=\"/media\" method=\"post\" enctype=\"multipart/form-data\">\nI have another form that just uploads one image not using this plugin where this works fine using the $request->file('FILE_NAME') just fine. \nCan you reopen this issue or should I open a new one?\n. ",
    "DotFreelance": "It looks to me like you're taking the filename from your request and directly dropping that in, and that's why it cannot call the method file()... are you certain your file upload form has the Laravel required property files => true?\n. ",
    "a-wenzel": "Just for info - JPG, PNG conversions still working. Only PDFs are failing. I tryed it on two different systems... local in my VM (Homestead) and on my live system.\nIm the only one with that Problem after the latest updates?\nThanks\n. hey @nicolasbeauvais work like a charm. Thank you very much.\n. Hey @nicolasbeauvais \ni use the latest version\n```\nprotected function convertPdfToImage(string $pdfFile) : string\n    {\n        $imageFile = pathinfo($pdfFile, PATHINFO_DIRNAME).'/'.pathinfo($pdfFile, PATHINFO_FILENAME).'.jpg';\n    (new Pdf($pdfFile))->saveImage($imageFile);\n\n    return $imageFile;\n}\n\n```\n. Silly question but how can i fire the dd($imageFile)? If i upload any PDF i didnt get any dd output.\nbtw. the permissions couldnt be wrong when jpegs still gets conversions right?\n. mhm... i tried svg now same as pdf... so which permission could be wrong? the funny thing.. on my live system it works! Only in my homestead local not...\n. @nicolasbeauvais im so sorry... that was 100% my fault... i got a new PC and forgot to install imagick in my VM... rly sorry for that!\n. ",
    "threeel": "sorry to reopen i just needed to say Thank you! i really appreciate all the work that you guys do! \n. ",
    "jeremykenedy": "http://www.pbs.org/parents/education/going-to-school/grade-by-grade/\nPHP >= 5.6.4\nhttps://laravel.com/docs/5.3/installation\n. ",
    "pyaesone17": "php artisan medialibrary:regenerate\nThis doesn't regenerate conversion.\nDriver : local\nQueue : doesn't use.\nBtw performConversions is automatic right ? I don't have to use explicit on product model ?\n. Yes I only attach image on my model . My image file type is jpeg, jpg .\n. I can confirm that using nonQueue can resolve this issue. I don't know what is wrong with my queue.\nYes this issue is not related with media library. It is just some config cache problem.\n. 1. chaining nonOptimized work it.\nI think the problem is something in optimizing image. . ",
    "knnnrd": "Yes I have.\n'max_file_size' => 1024 * 1024 * 100,\n. This is a screenshot of what my phpinfo() outputs. These values should be sufficient?\n\n. Solved it, I had to increase this in my php.ini to something bigger.\nmemory_limit=128M\n. Already found the solution myself. To swap media from one model to another you can simply do this:\n$myModel->media()->save($mediaFromOtherModel);. ",
    "LKaemmerling": "@freekmurze i have suddenly the same issue with Version 4.8.3 and Laravel 5.3.6.\n. I doesnt debug this right now but it seems to be an issue with an Update on the filesystems component of laravel\n. I'll make it, just one moment :). arg wrong branch sorry!. Okay, glad to help you with your projects. if there are something more just say a word :). The Errors doesn't appear with laravel, so it might work.. ",
    "boofman15": "Just wanted to throw something I found out regarding conversions on S3.  Some images I submitted were saving and getting converted fine, some were not.  Found out that images that have \".JPG\" instead of \".jpg\" were not saved.  Looks like some code in the ImageGenerators/FileTypes classes' convert function try to reference files with \".jpg\" so it was not able to find my files with uppercase extensions.\nI can make sure my extensions are lower case when saved to S3, but should uppercase extensions be handled in the converter as well?\n. ",
    "GaspariLab": "It looks like this bug still exists.\nCommit 48ed0b4 removed the rawurlencode function, so filenames with spaces are still broken.. ",
    "hootlex": "@freekmurze can you apply this to v3.* too? :)\n. ",
    "SavKS": "Version 3.18.0 for php 5 are not compatible.\n. Laravel 5.3 required php 5.6. Why laravel-medialibrary not supported this php version?\n. The branch, v3 (3.*) is no longer supported?\n. ",
    "sudomabider": "@nicolasbeauvais thanks for the reply.\nI did briefly think about using Laravel's owner handler. I don't see how it can be done without doing string/regex matches to check the type of error though, since they're all the same exception only with a different error message. I can catch it...but then it gets quite ugly.\nFileCannotBeAdded is called statically from FileAdder. Not sure how it's possible to swap that out. Best I can do is use my own implementation for FileAdder which is resolved via the container. But even then it has kind of the same problem. Would have to copy and paste 3 methods to override the exception messages because again...a try catch doesn't tell you which error it is. It's probably what I'll end up doing though unless there's a better way.\n. @nicolasbeauvais haha that's so hacky and brilliant at the same time. I'll keep the trick in mind :)\n. Experiencing the same issue here. Can confirm it is resolved in dev-master.\n. ",
    "snapey": "I see \"Don't forget to ignore the directory of your configured disk so the files won't end up in your git repo.\" in the documentation, but medialibrary also creates a temp folder in storage/medialibrary and after some crashes uploading images larger than Intervention could cope with I was left with quite a few directories in temp and also committed to Git.\nCould the creation of the storage/medialibrary folder also create a .gitignore file?. ",
    "marcusmoore": "There was some changes and fixes to morphTo in Laravel that broke this. I was able to fix it by reloading the relationship before returning:\nphp\n// ...\n$highlight->load('media');\nreturn $highlight->getFirstMediaUrl('published_images');\n. ",
    "marsd": "Currently null, was not changed previously.\n'custom_url_generator_class' => null,\n    'custom_path_generator_class' => null,\n. ",
    "bakrpx": "I have the same issue  after some debugging i have found the problem in FileManipulator.php line 138 ,it is trying  to getPath and s3UrlGenerator doesn't have getPath method\n. @marsd you do not have custom URL generators but you are using s3 and it`s generator doesn't have  a path \n. ",
    "asartz": "Had the same issue. It was fixed by pulling the dev-master branch.\n. ",
    "andaril": "I'm having same problem with v4.9.2 :(\n```\n[2016-10-12 14:52:06] production.CRITICAL: Symfony\\Component\\Debug\\Exception\\FatalThrowableError: Call to undefined method Spatie\\MediaLibrary\\UrlGenerator\\S3UrlGenerator::getPath() in /vendor/spatie/laravel-medialibrary/src/Media.php:86\nStack trace:\n0 /vendor/spatie/laravel-medialibrary/src/ImageGenerators/BaseGenerator.php(21): Spatie\\MediaLibrary\\Media->getPath()\n1 /vendor/spatie/laravel-medialibrary/src/FileManipulator.php(138): Spatie\\MediaLibrary\\ImageGenerators\\BaseGenerator->canConvert(Object(Spatie\\MediaLibrary\\Media))\n2 /vendor/spatie/laravel-medialibrary/src/FileManipulator.php(44): Spatie\\MediaLibrary\\FileManipulator->determineImageGenerator(Object(Spatie\\MediaLibrary\\Media))\n3 /vendor/spatie/laravel-medialibrary/src/FileManipulator.php(25): Spatie\\MediaLibrary\\FileManipulator->performConversions(Object(Spatie\\MediaLibrary\\Conversion\\ConversionCollection), Object(Spatie\\MediaLibrary\\Media))\n4 /vendor/spatie/laravel-medialibrary/src/Filesystem.php(42): Spatie\\MediaLibrary\\FileManipulator->createDerivedFiles(Object(Spatie\\MediaLibrary\\Media))\n5 /vendor/spatie/laravel-medialibrary/src/FileAdder/FileAdder.php(328): Spatie\\MediaLibrary\\Filesystem->add('/tmp/media-libr...', Object(Spatie\\MediaLibrary\\Media), '163930_new_Y4Zi...')\n6 /vendor/spatie/laravel-medialibrary/src/FileAdder/FileAdder.php(251): Spatie\\MediaLibrary\\FileAdder\\FileAdder->toCollectionOnDisk('default', '')\n7 /app/Jobs/ConvertOldSiteItemsJob.php(59): Spatie\\MediaLibrary\\FileAdder\\FileAdder->toMediaLibrary()\n8 [internal function]: App\\Jobs\\ConvertOldSiteItemsJob->handle()\n```\nMy code:\nforeach ($this->images as $image) {\n            if ($image->url != '') {\n                $this->model->addMediaFromUrl($image->url)->toMediaLibrary();\n            }\n        }\n. @freekmurze Yep, I found these issues later, but thanks.\nAnd I think this PR #329 is the solution. May be I must do pr with correct CS? 21 day is too long to wait response \ud83d\ude15\n. ",
    "sebestenyb": "I'm still having this issue on v5:\n```\n[Symfony\\Component\\Debug\\Exception\\FatalThrowableError]\nCall to undefined method Spatie\\MediaLibrary\\UrlGenerator\\S3UrlGenerator::getPath()\nException trace:\n () at /vendor/spatie/laravel-medialibrary/src/Media.php:81\n Spatie\\MediaLibrary\\Media->getPath() at /vendor/spatie/laravel-medialibrary/src/ImageGenerators/BaseGenerator.php:24\n Spatie\\MediaLibrary\\ImageGenerators\\BaseGenerator->canConvert() at /vendor/spatie/laravel-medialibrary/src/FileManipulator.php:120\n```\nActually tried out in a blank new Laravel 5.4 project.\n// composer.json\n\"require\": {\n        \"php\": \">=5.6.4\",\n        \"laravel/framework\": \"5.4.*\",\n        \"laravel/tinker\": \"~1.0\",\n        \"league/flysystem-aws-s3-v3\": \"^1.0\",\n        \"spatie/laravel-medialibrary\": \"^5.0\"\n    },\n```\n<?php\n// User.php\nnamespace App;\nuse Illuminate\\Notifications\\Notifiable;\nuse Illuminate\\Foundation\\Auth\\User as Authenticatable;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia;\nclass User extends Authenticatable implements HasMedia\n{\n    use Notifiable, HasMediaTrait;\n```\n// filesystem.php\n        'media' => [\n            'driver' => 's3',\n            'key' => env('AWS_KEY'),\n            'secret' => env('AWS_SECRET'),\n            'region' => env('AWS_REGION'),\n            'bucket' => env('AWS_BUCKET'),\n        ],\n```\n// tinker\nPsy Shell v0.8.1 (PHP 7.0.8 \u2014 cli) by Justin Hileman\n\n\n\nuse App\\User\n=> null\nuse Faker\\Factory\n=> null\n$faker = Factory::create()\n=> Faker\\Generator {#678}\nUser::first()->addMediaFromUrl($faker->imageUrl())->toMediaLibrary()\nPHP error:  Call to undefined method Spatie\\MediaLibrary\\UrlGenerator\\S3UrlGenerator::getPath() in /Users/balazssebesteny/Sites/medialibrary-test/vendor/spatie/laravel-medialibrary/src/Media.php on line 81\n```\n\n\n\nPS: Create new ticket #534 . #546 . !! Nice, you guys are fast !!\nThanks for all the effort \ud83d\udc4d . ",
    "anchepiece": "Agreed. It certainly would cause complications and possibly have unintended effects.\n. ",
    "azcoppen": "Thanks for clarifying. I'm having to work with legacy code that has a pre-existing database and tonnes of folders that needs to be imported onto Azure. Future file uploads will be handled that way, but i've had to do as you suggested for historical data. Thanks for a great package!\n. ",
    "nejtr0n": "I will try to explain.\n$products =  $this->section->products($this->city)\n            ->orderBy('products.sort', 'asc')\n            ->get();\nThis will return 1k object of Product eloquent models with HasMedia trait.\nNow im walking throug it in template and show image. \nAnd every model make request to get image from db.\nInstead of it, I'm getting all images in one go:\n$sub = $this->section->products($this->city)->select('products.id');\n$images = Media::where('collection_name', 'products')\n            ->where('model_type', ProductModel::class)\n            ->join(DB::raw('('.$sub->toSql().') as products'), 'products.id', '=', 'media.model_id')\n            ->addBinding($sub->getBindings(), 'join')\n            ->orderBy('model_id', 'asc');\nIt is single query and It is faster.\nAnd now i need to push image to collection in HasMedia object, but there is no such method =(\nDo you know any way to solve my problem?\n(May be it should be some decorator before taking images from DB in HasMedia trait).\n. Hm... it was so simple. Thank you!\n. ",
    "Plytas": "Can this be looked at again? I'm using https://github.com/hyn/multi-tenant package and for the jobs to work, they need to be tanant aware. That package provides a trait that extends SerializesModel trait to attach some extra attributes required for tenant identification. Currently there's no way to extend PerformConversion job to add this functionality.. ",
    "luceos": "Thanks @freekmurze much appreciated! \ud83d\ude47 . ",
    "vool": "Hi Freek, \nYes that make sense.\nThanks\n. Thanks for that info Nicolas,\nI am looking to allow upload  of images, audio and video, associate these with a model and generate preview (compressed) versions of the files, this all works fine with images but the audio/video are an issue. \nI can compress these before sending it to medialibrary as you suggest but is there a way for me to associate the original version as well as the compressed version with the model ? \nie if a user upload a image this can have many conversions eg org, thumbnail etc. is similar associations possible  with non image files or should I look at an alternative package\nThanks\nKeith\n. ",
    "arubacao": "You could alternatively use https://minio.io/ or https://github.com/scality/S3 or any other S3 compatible services with Travis.. The copyToMediaLibrary method could also be a good place for this.. PR was merged, so I'm going to close this here.. Sure and thank you :). No need to thank me! Keep up the great work \u270c\ufe0f. Thanks @freekmurze and @nicolasbeauvais \ud83d\udc4d . You don't need a PR for this since you can do this in your own application. \nhttps://github.com/spatie/laravel-medialibrary/blob/master/config/medialibrary.php#L26\nCreate a own model class that extends the original one and edit as you wish. At least this works for me :)\n. ",
    "peerrabe": "It seems you don't implement required interface HasMedia as the error message said.\nclass Post extends Model implements HasMedia\nshould work?. I take a look to the log, it seems there is a default for media class missing. Sorry for that, i run tests only locally, there were only skipped tests. Also a test for the Repository should be possible, to check if it uses the correct injected class.. Changes i made are working for a derived version of tag 4.13.0. Tests also failing without my changes on master.\nIt seems a class is missing Error: Class 'Spatie\\Image\\Manipulations' not found \nbut indeed, also my changes raising an error because of using config helper returns at this point NULL now (dedicated to new laravel version?). Direct access in way of $mediaClass = $this->app['config']['medialibrary']['media_model']; will work.. The PR target was wrong, now i corrected it and split it into two PRs because of renaming config file. A problem still exits, the missing Spatie\\Image\\Manipulations class. Do you know what's happens here?. Ah sorry for confusion, a composer update did the \"trick\" and tests running now without errors (skipped tests only) locally, hopefully also in travis-ci.. This change is a little bit different, due to renaming of config file laravel-medialibrary -> medialibrary. So you have to take care, if you want to back-merge changes from v4 to master.. Sorry for PR without tests again, but i didn't found any tests to MediaRepository, so i decided to go the same way. I tested with my current version in use and there it works (only with fix).. ",
    "OpusDevTeam": "Yeah its a little tricky. I'm going to cancel the request as I found some additional problems in some of the other files.\n. ",
    "MikeElghali": "Actually, i use two methods for this :\n$media->addMedia('url')->toCollection('CollectionName');\nAnd to delete a media, i use delete() method (but this removes entire folder).\nTo delete juste one file and not the folder, witch method can i use ?\nThanks.\n. ",
    "ittikorns": "+1 on this after called delete() it delete the entire folder instead of one single image. I came across the same problem since version 4. My workaround is to query the media first and then call the delete method.\n$media = $story->media->where('file_name', $filename)->first();\n$media->delete();. ",
    "adiachenko": "Stumbled upon this problem today when running conversions in Horizon from inside a docker container. This is caused by queue workers being run by incorrect user. The solution for me was as follows:\ndocker-compose exec --user www-data php php artisan horizon. By the way, I've just read in your tweet that responsive images support is coming in v7. Does that mean there would be a better (or maybe easier) way to do it providing we take care of the markup on the client?. Here you go, buddy. I have encountered the same issue not long ago.\n```\n<?php\nnamespace App\\Http\\Resources;\nuse Illuminate\\Http\\Resources\\Json\\Resource;\nuse Spatie\\MediaLibrary\\Conversion\\Conversion;\nuse Spatie\\MediaLibrary\\Conversion\\ConversionCollection;\nclass MediaResource extends Resource\n{\n    /\n     * Transform the resource into an array.\n     \n     * @param  \\Illuminate\\Http\\Request\n     * @return array\n     /\n    public function toArray($request)\n    {\n        return [\n            'id' => $this->resource->id,\n            'file_name' => $this->resource->file_name,\n            'versions' => $this->getVersions(),\n        ];\n    }\n/**\n * @return mixed\n */\nprotected function getVersions()\n{\n    $conversions = ConversionCollection::createForMedia($this->resource);\n\n    $versions = $conversions->reduce(function ($carry, Conversion $conversion) {\n        if ($conversion->shouldBePerformedOn($this->resource->collection_name)) {\n            $name = $conversion->getName();\n            $carry[$name] = $this->resource->getFullUrl($name);\n        }\n\n        return $carry;\n    }, []);\n\n    return array_merge($versions, [\n        'original' => $this->resource->getFullUrl()\n    ]);\n}\n\n}\n```\nOverall, I advise avoiding using getMedia for API responses. You should write your own relationships for each media collection and eager load it directly instead. See example implementation below.\n```\n<?php\nnamespace App;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\ntrait HasMedia\n{\n    use HasMediaTrait;\n/**\n * @return \\Illuminate\\Database\\Eloquent\\Relations\\MorphOne\n */\npublic function morphOneMedia()\n{\n    return $this->morphOne(config('medialibrary.media_model'), 'model')->orderBy('order_column')->limit(1);\n}\n\n/**\n * @return \\Illuminate\\Database\\Eloquent\\Relations\\MorphMany\n */\npublic function morphManyMedia()\n{\n    return $this->morphMany(config('medialibrary.media_model'), 'model')->orderBy('order_column');\n}\n\n}\n```\n```\n<?php\nnamespace App;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions;\nuse Spatie\\MediaLibrary\\Media;\nclass Section extends Model implements HasMediaConversions\n{\n    use HasMedia;\npublic const MEDIA_IMAGES = 'images';\npublic const MEDIA_BANNER_IMAGES = 'banner_images';\n\n/**\n * @return \\Illuminate\\Database\\Eloquent\\Relations\\MorphOne\n */\npublic function image()\n{\n    return $this->morphOneMedia()->where('collection_name', static::MEDIA_IMAGES);\n}\n\n/**\n * @return \\Illuminate\\Database\\Eloquent\\Relations\\MorphMany\n */\npublic function bannerImages()\n{\n    return $this->morphManyMedia()->where('collection_name', static::MEDIA_BANNER_IMAGES);\n}\n\n}\n```\nThe package is heavily tailored to the needs of monolithic applications. You are expected to do some customization to make it work for API development workflow. But once it is done, it works perfectly.. @corbin88 Yeah, the Section is just a generic model to showcase how you would use the trait. Though the given example is very basic. \nThere is more to be done to really shoehorn this lib into JSON API context. For example, by default the lib doesn't scope returned conversions. Say, by convention, you have all image collections in your API called images (product.images, category.images etc.). When trying to get product images conversions, you'll have unrelated category images in your responses because there is no scoping.\nI created a gist with more snippets on I how managed to work around laravel-medialibrary limitations. Hope it'll give you some ideas. Sorry I can't explain more right now, because I moved on to another project and don't remember all the nitty-gritty details myself. It looks kinda confusing even for me at this point. \ud83d\ude06. ",
    "clementbirkle": "Sorry but i just saw your response now.\nThe answer is no. I didn't activate it before but now it is activated.\nNow it works but, when i see the path generated for the thumb, it shows : c/thumb.jpg but the original file is a SVG.\nFor me the logic is: when the function \"getFirstMediaUrl\" is called, it returns to the original file path when it is a SVG. (maybe with a supplementary argument)\n. Ok, thanks for your reply and explication. I will work with the original file for SVG and thumb for the other formats.\n. Finally, I found a partial solution with the method: ->keepOriginalImageFormat()\nBut with this, the SVG file wasn't converted to JPG anymore. I don't want this way. So I think I need to edit Conversion::getResultExtension() method... is it the best solution ? If yes, how can I override properly this method ?\nThank you in advance. ",
    "niqs87": "thanks for your very fast answer. can you send me some link how to push it to queue?\n. ",
    "LasseRafn": "This makes sense - I didn't even notice the documentation site, lol. No problem\n. I'd gladly work on a medialibrary wrapper for this.\nSeems like it wouldn't be the largest thing to solve, considering the flexibility of medialibrary.\nOne could create a class/helper method that generates a srcset based on the media-conversions made, and the media-conversions could potentially be generated dynamically based on the filesize formular above.\nI would probably have to do a little research into responsive images.. I haven't touched them beyond in a Codepen or two for testing. Oh, cool! Even better \ud83d\udc4d\ud83c\udffb\n. ",
    "emilioborraz": "I'm experiencing the same issue:\n\n$emailNotification->clearMediaCollection();\n$emailNotification->addMediaFromRequest('attachment')->usingName('email_notification_'.$emailNotification->id)->toMediaLibrary();\nreturn $emailNotification->getMedia()->first()\n\nReturns the last deleted media.. My solution to this so far is to unset the Media relationship, please see step 3.\n\n$emailNotification->clearMediaCollection();\n$emailNotification->addMediaFromRequest('attachment')->usingName('email_notification_'.$emailNotification->id)->toMediaLibrary();\n$emailNotification->media = null;\nreturn $emailNotification->getMedia()->first();. \n",
    "austintoddj": "Using this media manager in Canvas right now, and it's been a great addition. Written for Laravel in VueJS2.0. \n. ",
    "Jasper9041": "I have created a PR that fixes these errors in the documentation. https://github.com/spatie/docs.spatie.be/pull/112\nI believe the errors you are having are indeed caused by the use of getPath() in combination with a Non-local driver. This issue describes your problem: https://github.com/spatie/laravel-medialibrary/issues/464\nI can't speak for @freekmurze but I think this issue should no longer occur in v5 if issue 464 gets fixed.. I might be a little late to the party here, but since the issue is still open I might as well answer.\nI was able to replicate your issue. Since you are calling getRealPath(), you are retreiving the actual real path to the uploaded file, which is a path to the /tmp directory. This path does not contain a file extension. See the 'realtpath' field in the included dump:\nUploadedFile {#158 \u25bc\n  -test: false\n  -originalName: \"dd.png\"\n  -mimeType: \"image/png\"\n  -size: 217230\n  -error: 0\n  path: \"/tmp\"\n  filename: \"phpLvq1Df\"\n  basename: \"phpLvq1Df\"\n  pathname: \"/tmp/phpLvq1Df\"\n  extension: \"\"\n  realPath: \"/tmp/phpLvq1Df\"\n  aTime: 2017-02-02 15:00:34\n  mTime: 2017-02-02 15:00:34\n  cTime: 2017-02-02 15:00:34\n  inode: 926336\n  size: 217230\n  perms: 0100600\n  owner: 1000\n  group: 1000\n  type: \"file\"\n  writable: true\n  readable: true\n  executable: false\n  file: true\n  dir: false\n  link: false\n}\nThis is why there is no extension in the the database. When converting with 'fm' => 'src', laravel-medialibrary looks for the original file extension by calling getExtensionAttribute(), which does not have any extension to report. I included an extract of this method in Media.php:\npublic function getExtensionAttribute() : string\n{\n    return pathinfo($this->file_name, PATHINFO_EXTENSION);\n}\n@freekmurze Maybe the package needs to throw an exception if you try to add a file without extension to the library?\nIn conclusion: if you want to solve your issue you should be able to do this instead:\n$data = $request->all();\n$image = $data['image'];\n$model->addMedia($image);\nOR\n$model->addMediaFromRequest('image');\n. Sadly I don't think image generators are what I'm looking for. \nI like the way image generators can be used to take a screenshot of a video, so that the library can use that screenshot to generate all sorts of converted images. The package allows the user to create a custom image generator implementation.\nI am looking for somehting similar: \nLet's say i have a 1080p .mp4 and I want to create a  720p .webm version.\nIt would be great I would be able to create a custom VideoConversion class that handles all the converting logic. This class could then be injected into the medialibrary, just like you would inject a custom image generator.\nIt would enable a user to create their own implementation of a \"conversion\":\nclass VideoConversion extends BaseConversion implements ConversionInterface\n{\n    //video conversion implemantation created by user\n}\nThe user would than use laravel medialibrary and specify a custom conversion like this\n```\nclass Post extends Model implements HasMedia\n{\n    use HasMediaTrait;\npublic function registerMediaConversions()\n{\n    $videoConversion = new VideoConversion(['format' => 'webm', 'size' => '720p']); // custom user-defined conversion\n    $this->addMediaConversion($conversion);\n\n    $normalConversion = new ImageConversion(['w' => 368, 'h' => 232]); //normal image conversion that is built in to the package\n    $this->addMediaConversion($normalConversion);\n}\n\n}\n```\nIt's proving a little difficult to explain all this, I hope this helps you understand what I'm talking about. \ud83d\ude04 . OK. Thank you for your time and your hard work. \ud83d\ude03 \nI'll probably end up extending the media model and add custom behavior to convert the video there.. You have used an incorrect namespace for the Media class from the medialibrary package. Your first code fragment seems to suggest you used the correct namespace, but your error says otherwise. Maybe you've changed it?\nThe correct namespace for the Media class is Spatie\\MediaLibrary\\Models\\Media, not Spatie\\MediaLibrary\\Media.. ",
    "mikemand": "Thank you!. ",
    "mohammad6006": "@sebastiandedeyne \nusing this code:\n\nbut I need media image file url or path instead of file name. i didn't upload configuration file, but I upload it and solved the problem.\nI think its a bug. ",
    "smakman": "You could also append the image URL to your Product model:\n```php\n// app/Product.php\nnamespace App;\n...\nclass Product extends Model\n{\n    protected $appends = ['image_url'];\npublic function getImageUrlAttribute()\n{\n    return $this->getFirstMediaUrl('images');\n}\n\n}\n``. Thanks @freekmurze. My virtualbox was running on PHP7 but my local machine was running on PHP5.6. After updating to PHP7 withcurl -s http://php-osx.liip.ch/install.sh | bash -s 7.0I could install the package without any problems..$mediaItem->getPath()` actually returns the following error using \"spatie/laravel-medialibrary\": \"^4.10\".\nphp\nCall to undefined method Spatie\\MediaLibrary\\UrlGenerator\\S3UrlGenerator::getPath()\nGenerating the path manually now. This seems to work:\n```php\n$file = Storage::disk('media')->getDriver()->readStream('/' . $mediaItem->id . '/' . $mediaItem->file_name);\nreturn \\Response::stream(function() use($file) {\n    fpassthru($file);\n}, 200, [\n    'Content-Type' => $mediaItem->getCustomProperty('mime-type'),\n    'Content-Disposition' => 'attachment; filename=\"' . $mediaItem->file_name . '\"',\n    'Content-Length' => $mediaItem->size\n]);\n```\n. ",
    "sandervanhooft": "I understand, but does the media library expose a function to get the file storage path, which in turn perhaps could be used for this \"on the fly conversion\" method?\nIf so, do you see any reason why this would be cumbersome to implement?. @sebastiandedeyne Thanks for responding! I've just tested again with the default settings, and I get no errors now. My best guess is that the errors were caused by a lingering config cache.\nIssue can be closed for now.. Hi @canvural , @freekmurze ,\nI understand that these feature tests are already covered in the package (which is great). But I need to test the package's integration within my app - I was talking about my app's feature tests, not the package's, sorry for any confusion.\nHow would you recommend doing this, as Storage::fake() seems to not support this?\nBy the way, I experience the same issue with all medialibrary storage methods when combined with Storage::fake(),  including addMediaFromUrl() (so no UploadFile::fake() here).. Addendum: the test I shared above is a stripped-down shareable example of what happens when I try to test this functionality. The actual tests are richer, testing real app behavior.. I will give that a try, thanks!\nOn Wed, 26 Apr 2017 at 13:56 Freek Van der Herten notifications@github.com\nwrote:\n\nHaven't worked with Storage::fake myself just yet, so can't advise you\nthere.\nYou could take the same approach as we did in our package tests. Create a\nreal disk and manually make asserts against the filesystem.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/623#issuecomment-297378700,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AG7dp8wxxQOYPcpB1TACE2D_qfgiCo6Hks5rzzDKgaJpZM4NImXs\n.\n. I'm on the road currently so I can't access my code the next two weeks...\n\nThis is what I think I did in the end:\nI dropped the fake and used the normal mode instead, used a stub file,\nlearned the path used by medialibrary to save it. The test now checks if\nthe file is stored at that path.\nOn Tue, 5 Sep 2017 at 18:31, J\u00e9r\u00f4me Copp\u00e9e notifications@github.com wrote:\n\nHi @sandervanhooft https://github.com/sandervanhooft ,\nDid you finally find a way ? Thanks.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/623#issuecomment-327230975,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AG7dp8yLy7g6EBDlmRopR1uhtHxArsCNks5sfXcsgaJpZM4NImXs\n.\n. And ofcourse clean up the stub file afterward :)\nOn Tue, 5 Sep 2017 at 20:11, Sander van Hooft info@sandervanhooft.nl\nwrote:\nI'm on the road currently so I can't access my code the next two weeks...\nThis is what I think I did in the end:\nI dropped the fake and used the normal mode instead, used a stub file,\nlearned the path used by medialibrary to save it. The test now checks if\nthe file is stored at that path.\nOn Tue, 5 Sep 2017 at 18:31, J\u00e9r\u00f4me Copp\u00e9e notifications@github.com\nwrote:\n\nHi @sandervanhooft https://github.com/sandervanhooft ,\nDid you finally find a way ? Thanks.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/623#issuecomment-327230975,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AG7dp8yLy7g6EBDlmRopR1uhtHxArsCNks5sfXcsgaJpZM4NImXs\n.\n\n\n. Thank you for sharing!\n\nI\u2019d make sure the temp folder is clean both at tearDown() and setUp() (in\ncase the testrun for whatever reason crashes and does not make it to\ntearDown()).\nOn Fri, 10 Nov 2017 at 16:48, Ivan Vermeyen notifications@github.com\nwrote:\n\nIn case anyone else is still struggling with testing file uploads using\nMediaLibrary.\nAs noted above, when faking the 'media' storage, the uploaded files can't\nbe found.\nThis basic test example works for me. I'm running this test in a package\nrepo, using orchestral/testbench https://github.com/orchestral/testbench,\nbut I suppose this should also work in a normal Laravel app. I'm using\nLaravel 5.5.\nInstead of faking the storage disk, I just change the root path of the\ndisk in the config.\nI have this controller method to add a photo to a Post:\npublic function store(Post $post){    request()->validate([        'photo' => \"required|image\",    ]);    return $post->addMediaFromRequest('photo')->toMediaCollection('photos');}\nIn the test I create a fake photo, send it via a POST request and then\nassert that it is added to the Post and that it exists in the filesystem.\nThis also works with conversions.\n/* @test /public function a_photo_can_be_added_to_a_post(){    $this->withoutExceptionHandling();    config()->set('filesystems.disks.media', [        'driver' => 'local',        'root' => DIR.'/../../temp', // choose any path...    ]);    config()->set('medialibrary.default_filesystem', 'media');    $photo = \\Illuminate\\Http\\Testing\\File::image('photo.jpg');    $response = $this->postJson($this->url(), [        'photo' => $photo,    ]);    $response->assertStatus(200);    $photos = $this->post->getMedia('photos');    $this->assertCount(1, $photos);    $this->assertFileExists($photos->first()->getPath());    $this->assertFileExists($photos->first()->getPath('thumb'));}\nNote that the temp folder is not cleared automatically, so you should do\nthat in the setUp probably.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/623#issuecomment-343508764,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AG7dp79M8VmghW8zFxTcr1F3xI8rDntkks5s1HBcgaJpZM4NImXs\n.\n. \n",
    "olipiskandar": "i love it . im so sad :-(. ",
    "dragonfire1119": "@freekmurze Thanks for the reply I noticed by using dd($this->mediaConversions); then it said onQueue right before you commented LOL For some reason it was changed to database. My mistake thanks for the quick reply & awesome packages! . ",
    "scottjo": "Hi, I have a similar issue. I am stuck on PHP 5, so trying to install version 3.18.0 of medialibrary. In my composer.json - \n\n\"require\": {\n        \"php\": \">=5.6.4\",\n        \"laravel/framework\": \"5.3.*\",\n        \"laravelcollective/html\": \"^5.2.0\",\n        \"laracasts/flash\": \"^2.0\",\n        \"kyslik/column-sortable\": \"~5.0\",\n        \"garygreen/pretty-routes\": \"^0.0.5\",\n        \"spatie/laravel-medialibrary\": \"3.18.0\"\n    },\n\nAnd running composer update I get \n\nProblem 1\n    - Conclusion: don't install laravel/framework v5.3.28\n    - Conclusion: don't install laravel/framework v5.3.27\n    - Conclusion: remove laravel/framework v5.3.26\n    - Conclusion: don't install laravel/framework v5.3.26\n    - Conclusion: don't install laravel/framework v5.3.25\n    - Conclusion: don't install laravel/framework v5.3.24\n    - Conclusion: don't install laravel/framework v5.3.23\n    - Conclusion: don't install laravel/framework v5.3.22\n    - Conclusion: don't install laravel/framework v5.3.21\n    - Conclusion: don't install laravel/framework v5.3.20\n    - Conclusion: don't install laravel/framework v5.3.19\n    - Conclusion: don't install laravel/framework v5.3.18\n    - Conclusion: don't install laravel/framework v5.3.17\n    - Conclusion: don't install laravel/framework v5.3.16\n    - Conclusion: don't install laravel/framework v5.3.15\n    - Conclusion: don't install laravel/framework v5.3.14\n    - Conclusion: don't install laravel/framework v5.3.13\n    - Conclusion: don't install laravel/framework v5.3.12\n    - Conclusion: don't install laravel/framework v5.3.11\n    - Conclusion: don't install laravel/framework v5.3.10\n    - Conclusion: don't install laravel/framework v5.3.9\n    - Conclusion: don't install laravel/framework v5.3.8\n    - Conclusion: don't install laravel/framework v5.3.7\n    - Conclusion: don't install laravel/framework v5.3.6\n    - Conclusion: don't install laravel/framework v5.3.5\n    - Conclusion: don't install laravel/framework v5.3.4\n    - Conclusion: don't install laravel/framework v5.3.3\n    - Installation request for spatie/laravel-medialibrary 3.18.0 -> satisfiable by spatie/laravel-medialibrary[3.18.0].\n    - Conclusion: don't install laravel/framework v5.3.2\n    - Conclusion: don't install laravel/framework v5.3.1\n    - spatie/laravel-medialibrary 3.18.0 requires illuminate/console ~5.1.16|~5.2.0 -> satisfiable by illuminate/console[v5.1.16, v5.1.20, v5.1.22, v5.1.25, v5.1.28, v5.1.30, v5.1.31, v5.1.41, v5.2.0, v5.2.19, v5.2.21, v5.2.24, v5.2.25, v5.2.26, v5.2.27, v5.2.28, v5.2.31, v5.2.32, v5.2.37, v5.2.43, v5.2.45, v5.2.6, v5.2.7].\n    - don't install illuminate/console v5.1.16|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.1.20|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.1.22|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.1.25|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.1.28|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.1.30|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.1.31|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.1.41|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.0|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.19|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.21|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.24|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.25|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.26|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.27|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.28|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.31|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.32|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.37|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.43|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.45|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.6|don't install laravel/framework v5.3.0\n    - don't install illuminate/console v5.2.7|don't install laravel/framework v5.3.0\n    - Installation request for laravel/framework 5.3.* -> satisfiable by laravel/framework[v5.3.0, v5.3.1, v5.3.10, v5.3.11, v5.3.12, v5.3.13, v5.3.14, v5.3.15, v5.3.16, v5.3.17, v5.3.18, v5.3.19, v5.3.2, v5.3.20, v5.3.21, v5.3.22, v5.3.23, v5.3.24, v5.3.25, v5.3.26, v5.3.27, v5.3.28, v5.3.3, v5.3.4, v5.3.5, v5.3.6, v5.3.7, v5.3.8, v5.3.9].. \n",
    "MarceauKa": "Just tried to update them but it seems there's others problems to solve.\nI'm trying to investigate on that.... ",
    "cotein": "Please, explicity what is $pathToFile.\nExample, please!. ",
    "netwrkx": "return $news->getMedia('images');\nit returns empty array. $news->clearMediaCollection('images');   //doesn't clear collection\n              $file = $news->addMedia($photo)\n                          ->usingFileName(time(). $photo->getClientOriginalName())\n                  ->toCollection('images');\n\nreturn $news->getMedia('images');. FatalThrowableError in MediaDirController.php line 22:\nCall to a member function getMedia() on null\npublic function medialibrary(News $news)\n    {\n        $news = $news->fresh();\n        $media = $news->getMedia('images'); //LINE 22\n        return $media;  \n    }\n```\npublic function addMedia(StoreMediaRequest $request, News $news)\n    {     \n        $photo = $request->file('photo');\n        $news->save();\n            $file = $news->addMedia($photo)\n                        ->usingFileName(time(). $photo->getClientOriginalName())\n                ->toCollection('images');\n\n    return [\n                    'url' => $file->getUrl(),\n        '$mediaItems' => $news->getMedia('images'),\n    ];          \n}\n\n. I don't understand what you mean by being passed through a valid News object or what am i missing. $news = News::first(); only to pull the first data\n$news = News::first(); or $news = \\App\\Models\\Owna\\News::first(); // works\n$media = $news->getMedia('images');\nreturn $media;\n```\nwhen i try $news = News::all(); or $news = \\App\\Models\\Owna\\News::all(); to pull all item, i get the following error\nBadMethodCallException in Macroable.php line 74:\nMethod getMedia does not exist.. i finally used V3.16... Problem solved. thanks. ",
    "iraklisg": "@loranger not sure if this is your case, but does your custom  App\\Services\\MediaLibraryUrlGenerator correctly implements Spatie\\MediaLibrary\\UrlGenerator\\UrlGenerator interface?\nYou can also try instead of implementing the interface, to extend the Spatie\\MediaLibrary\\UrlGenerator\\BaseUrlGenerator\nPlease have a the docs as well. I am also having troubles storing an uploaded file with greek characters in its filename\nIn particular, when I try to to upload a file with filename cosmos - \u03ba\u03bf\u03c3\u03bc\u03bf\u03c2.pdf, the name field of the media table stores the right name (i.e. cosmos - \u03ba\u03bf\u03c3\u03bc\u03bf\u03c2.pdf) but when I try to upload a file named  \u03ba\u03bf\u03c3\u03bc\u03bf\u03c2 - cosmos.pdf the name field of the media table gets the wrong value i.e. - cosmos.pdf \nMoreover, when I try to upload a file with only greek haracters in its filename, the name filed the media table gets an empty value. ",
    "Christophvh": "I have the same issue and i'm not using Lumen.. - A simplified way of generating a unique filename when adding a file.\n- Storing conversions in db , still not sure why manipulations are stored in the db and conversions aren't. ",
    "benjivm": "I am using v6.6.2 with Laravel 5.5 and cannot get this issue resolved.. Here it is:\nMedia {#458 \u25bc\n  #guarded: []\n  #casts: array:2 [\u25b6]\n  #connection: \"default\"\n  #table: null\n  #primaryKey: \"id\"\n  #keyType: \"int\"\n  +incrementing: true\n  #with: []\n  #withCount: []\n  #perPage: 15\n  +exists: true\n  +wasRecentlyCreated: false\n  #attributes: array:14 [\u25bc\n    \"id\" => 3\n    \"model_id\" => 22\n    \"model_type\" => \"App\\Models\\Article\"\n    \"collection_name\" => \"signatures\"\n    \"name\" => \"signature\"\n    \"file_name\" => \"SdrvtBbHb+QAAAABJRU5ErkJggg==\"\n    \"mime_type\" => \"image/png\"\n    \"disk\" => \"attachments\"\n    \"size\" => 5002\n    \"manipulations\" => \"[]\"\n    \"custom_properties\" => \"[]\"\n    \"order_column\" => 3\n    \"created_at\" => \"2017-11-20 10:47:34\"\n    \"updated_at\" => \"2017-11-20 10:47:34\"\n  ]\n  #original: array:14 [\u25b6]\n  #changes: []\n  #dates: []\n  #dateFormat: null\n  #appends: []\n  #dispatchesEvents: []\n  #observables: []\n  #relations: []\n  #touches: []\n  +timestamps: true\n  #hidden: []\n  #visible: []\n  #fillable: []\n}. This appears to have something to do with filenames. If I do not set a filename I get that error, but if I do use usingFileName('something') I can then use getUrl(), on all media, even those that were failing before.\nRelated: I was occasionally receiving SQLSTATE[22001]: String data, right truncated: 1406 Data too long for column 'file_name' at row 1 so I switched to manually specifying a name. However I cannot do this for all media types and I will need to leave filenames alone for some uploads, how can I avoid this error?\nEdit: I think I get it now, it isn't this package at all creating those names, by default this package simply uses the original name, but because some files are being generated by the user in-browser the filename is the hash given by the JavaScript function being used, so to avoid this issue I just need to be more observant about how the data is being handed over.. ",
    "Shandur": "For those who comes here.\nMy solution: check that your filesystems.php has configurations for 'disk_name' from medialibrary.php config file.\nBecause media library relies on the value of disk_name and tries to create {DiskName}UrlGenerator class that probably doesn't exist.\nCheers!. ",
    "yusufyilmaz": "Thanks for the reply @freekmurze . I have asked my question in wrong way I suppose. \nI have been using laravel own auth middleware. I have a route for the image viewer under auth middleware. This part is not related to the medialib package. My question is that on my route, I have been using image ids get('image/{image-id}') \nwhen I use your package I could not decide what to do on image id since there are different conversions of the image.  Have you seen any implementation with non-public images to show with auth middleware with different conversions?. ",
    "smitbit": "Okay, so it shouldn't try to convert unless something is telling it to. I'll look around at this more. Thanks for the help!. ",
    "roberto-aguilar": "@freekmurze \nI have been using a pattern where i define the cloud filesystem driver in config/filesystem.php as:\n'cloud' => env('CLOUD_DRIVER', 's3'),\nThat way if i'm in development environment, i can set CLOUD_DRIVER as local disk and this way avoid the upload of files to s3 disk anywhere in my code\nIlluminate\\...\\Filesystem\\Cloud::put(...) // <- the file goes to local disk on development environment\nI was wondering if i could tell the library to use the cloud driver (which is a disk really) instead of use a disk directly and this way continue using disks based on the environment.\nAnd actually i make this works with the following line, but again, i was wondering if there was a cleaner way to do it\n$this->model\n     ->addMedia($file)\n     ->toCollectionOnDisk($collection, config('filesystems.cloud'));\nEven if that is not posible, i'm amazed with the quality of the project, you guys did an amazing work, congratulations!. Wow, thank you very much @freekmurze :metal:. ",
    "ethaizone": "I'm sorry that I don't answer your question. I tested it on my staging server and it work after I patch this PR. It fix my problem. ^^\nThank you for this merge. :D. ",
    "Butochnikov": "@freekmurze same problem (laravel-medialibrary v4)\nupd: but Storage::disk('ftp')->put('test.jpg', $file); works. Thanks \ud83d\udc4d . yes, if I use CustomPathGenerator:\nphp\npublic function getPath(Media $media) :string\n    {       \n        return $media->collection_name . '/' . $media->id .'/';\n    }\n    public function getPathForConversions(Media $media) :string\n    {      \n        return $media->collection_name . '/' . $media->id .'/c/';\n    }\nPath will be removed the first and PathForConversions doesn't exist any more.\n. ",
    "simplethemes": "Thanks for the reply. What I'm saying is the model_id always inherits the id column instead of the primary key defined on the model. This is probably an edge case scenario, but in this instance I have a primary key as a 25 character CHAR field (I'm syncing data over a RETS API).\nShould I bypass $table->morphs('model'); in the migration and define the relationship manually? . ",
    "Sindoweb": "Followup: \nIf you comment out $temporaryDirectory->delete(); in laravel-medialibrary/src/FileManipulator.php the uploads work fine.. Problem is indeed fixed. Thanks!. ",
    "patrickguevara": "Looks like it works with Postgres using either json or jsonb. This is of course, without the S3 tests.\nOne note, however, is the assumptions made about column data types and query results order for a Sqlite database. Because of this, I had to modify the tests in order for them to pass when connected to a Postgres database instance. \nFor instance, HasMediaTrait/GetMediaTest.php asserts that it_will_return_preloaded_media_sorting_on_order_column. This assumes that order_column value returned from the database will be wrapped in single quotes. This is true for Sqlite but not true for Postgres where it comes out as an integer (as PHP understands it). This makes the test fail when using Postgres. I fixed it with a ->map() that typecasts the results to an int. \nIn the HasMedia/UpdateMediaTest.php the assertion for it_removes_a_media_item_if_its_not_in_the_update_array fails because the wrong media item was removed in the test setup. This is based on the assumption that the insert order is preserved when fetching. This is true for a Sqlite database, but not for Postgres. I modified the test setup to use the scopeOrdered trait for ensure that we're removing the intended item.\nIn the same test class, the it_reorders_media_items assertion also fails based on the same assumption of fetch order. I added a sortBy() to make sure that when array_reverse is issued in the setup phase, it performs the correct reversal and the update goes through as intended.\nThe tests still pass for both Sqlite and Postgres after these modifications.\nAnother note, in TestCase.php I added a couple lines to check for database tables and drop them if they exist. This is necessary for Postgres because the tables (and their rows) persist between tests. \nI'm going to submit a PR for your review so you can see the changes I made, but I'm satisfied with Postgres compatibility so far. . Yep! I wouldn't make a change to the docs, either. Yes, it technically can support a postgres database but I don't think it's worth including the caveat or increasing your overhead. \nThanks again for a great package!. Thanks! \nBut just to be clear, the commented code was only to show the settings I used for the postgres database. That can easily be removed. \nThe tests do run on Travis. The only modifications were so that the assertions would play nicely with a postgres database.\nI understand you don't need postgres compatibility, but these changes were only meant to harden the tests to make the assertions more reliable.\nAnyway, I appreciate you reviewing it! and I get why you aren't merging it in \ud83d\udc4d . ",
    "davidvd": "You need to run L5.3 with php7 for this to work. Doesn't work with L5.3 php5.. ",
    "gotroch": "I'm behind a proxy and fopen doesn't work for me. I need to use curl with proxy options CURLOPT_PROXY, CURLOPT_PROXYPORT  and @anorgan helps to sort it out. This is usefull for me. Thanks.\n. ",
    "faustbrian": "I quickly added a test which I suppose should work, just closed my macbook so had to add the test in the browser and couldn't test it on my local machine.\nIf it fails I will send a fix for the test tomorrow.. ",
    "nelson6e65": "How can I get the URL? Files are stored without extensions when used addMediaFromBase64() :sweat_smile: . Well... I only have issues with the svg+xml. Other types displayed well.. ",
    "AchoArnold": "Perhaps this should be added to the documentation because when I do \nbash\n composer require spatie/laravel-medialibrary\nI get \nbash\nUsing version ^3.18 for spatie/laravel-medialibrary\n./composer.json has been updated\nLoading composer repositories with package information\nUpdating dependencies (including require-dev)\nAnd this fails.\nI had to add  \"spatie/laravel-medialibrary\": \"5.x\" under the \"require\" section of my composer.json.. ",
    "Mirdrack": "I have the same problem here but only with files that are not images\nIf I upload an image everything is right but if I try with a text file I get an error\nIs there a way to filter by file type?. I'm creating a file manager for an specific entity(Client) this should be able to receive all kind of files(media) and relate the items to the main entity\nWhen I upload an image there is no problem, the problem comes when I try to upload another kind of files like a txt, the package tries to generate a thumb for an txt file\nMy question was if there is a way to generate a thumb only for specific type of files\n. ",
    "njbarrett": "This is also an issue for me.\nLaravel 5.4 / \"spatie/laravel-medialibrary\": \"^5.0.0\",. ",
    "Rias500": "Great! I've solved it temporarily by adding the conversion to the individual media manipulations instead of the model. ",
    "svenluijten": "(sorry in advance for the spam! \ud83d\ude1b). ",
    "tranviettrung": "I successfully install v4 with: \ncomposer require spatie/laravel-medialibrary:4.*.*\nnot with\ncomposer require spatie/laravel-medialibrary:^4.0.0\nas doccument say.. ",
    "JoelGross": "I am still having the exact same issue:\nvagrant@homestead:~/Code/recruiting$ php artisan backup:run\nStarting backup...\nDumping database recruiting7...\nDetermining files to backup...\nZipping 6305 files...\nCreated zip containing 6305 files. Size is 196.01 MB\nCopying zip to disk named s3...\nSuccessfully copied zip to disk named s3.\nBackup failed because: unlink(/home/vagrant/Code/recruiting/storage/app/backup-t\nemp/temp/2017-10-15-10-53-01.zip): Text file busy.\nRunning PHP 7, Laravel 5.5 and Spatie backup:  \"name\": \"spatie/laravel-backup\",\n            \"version\": \"5.0.5\",\nOn Homestead on Windows 10.\n. ",
    "emielmolenaar": "That would work with one worker process per box, but not with multiple workers per box as they all use the same environment variables. . That could work. But still, in a very rare situation, workers are doing stuff in the same directory and they will be trashing that directory. I think one must prevent that at all times. \nA worker cleaning up it's own files guarantees that it does not trash other workers' files and / or directories. And to be honest, microtime() calls in config files sound a bit hacky to me :wink: . Not really. And only if I would have such an ID, that does not guarantee that other people don't have the same problem. \nWhat keeps you from changing the file-clearing?\nTrashing the whole directory is also a solution to the problem, as long as TemporaryDirectory creates a uniquely-named directory on initialization; something like\nphp\ndo {\n  $directory = $this->directory . '/' . sha1(uniqid(true));\n} while(!is_directory($directory));\nOr something like that. But this should happen somewhere in the application / library logic and not in config files.. Thank you!. All right, OK. I was looking for a nice clean way to fill up order_column with a value per model. Ended up overriding getHighestOrderNumber and modifying the query there. It works OK for now, but something like a buildSortQuery method which can be overriden is a bit of a cleaner and more future proof way I guess.\nThanks!. ",
    "h3ndro": "i confirm that this error is exist when i try to php artisan migrate. @freekmurze , nope, im using mariadb 10.1.9 bundled in laragon, :). ",
    "mikewink": "@vesper8 MariaDB does not have dedicated json or jsonb data types yet. It comes with a hand full of json related functions though. Find out more about the current state as of posting this comment here: https://mariadb.com/resources/blog/json-mariadb-102. ",
    "thsdeveloper": "Mudei os meus campos de json para text:\n$table->text('manipulations');\n            $table->text('custom_properties');\nFunciona normal!. ",
    "j0131n": "As per mariadb version 10.1.32 and lower it seems like mariadb does not support json data type I am still unsure if it is available in version 10.2.7+.\nbut here's a simple workaround to get through this.\nchange json data type into text and then run your migration again.\n\n. ",
    "newsapkota": "Thanks, it's save my time :+1: . ",
    "facundofarias": "Hi @sebastiandedeyne,\nShouldn't the library itself provide a migration to add this field? I mean, instead of just pointing out about it in the docs like:\n\nadd a mime_type column to the media table, manually populate the column with the right values.\n\nFor example, I have no idea which are the 'right values'.\nThanks. @sebastiandedeyne Thanks!. ",
    "fetzi": "@freekmurze  I'll send a PR. @freekmurze i can do the rename tomorrow if you  want me to?. @freekmurze tried to reproduce the issue but files get deleted correctly.. ",
    "rodymolenaar": "Wouldn't toMediaCollection be a more sensible name? Would go in hand with the clearMediaCollection I've seen in another issue.. One PR incoming! ;). ",
    "alexeightsix": "i was referencing the v4 documentation, i'm assuming the method was removed from v5. hmm, not sure if i'm doing something wrong or the method is no longer available in v5?. ",
    "robinvalk": "This can be achieved by adding a url property to the media disk in the filesystem config. \nSee https://github.com/spatie/laravel-medialibrary/issues/549#issuecomment-284697690 for more information.. This can be closed as it's now implemented :+1: . It definitely is, shall I update this PR or do you prefer a new one?. As you can see I added the commit. Might not even need to use the PR :joy: . You are right, I also updated the tests. I couldn't run these yesterday because I had some environment issues. Should all be succeeding now.\nI'm using http://localhost as the hardcoded domain for now. I tried to keep it simple stupid so I'm keeping an eye on travis if that's using a different domain. If so we should look into a config option for the test.. It seems that Travis is succeeding so the hardcoded domain should be good. I'm not too happy with the trailing slash that I had to add, but url() trims it off the end so it is necessary.. S3 has it's own URL generator, I think that would be a separate issue. It would be awesome if this fix can be merged separately. Then we can test the responsive images on staging for our project.. After a quick look into the sourcecode, I think we need to extend the base path generator and create a new one specific for S3. We can use that one then for the S3UrlGenerator so that the root path is always included.\nSecond opinion appreciated, I suggest creating a separate PR for this so the PR #1195 is not on hold for S3.. ",
    "JasonSuave": "My current workaround looks like this \nphp\ntry {\n    /** @var Media $media */\n    $activity->addMedia($request->file('attachment'))\n        ->toMediaLibrary('information');\n} catch (\\ErrorException $error) {\n    Log::error($error->getMessage());\n    $media = $activity->getMedia('information')->last();\n    \\Artisan::call('medialibrary:regenerate', ['--ids' => $media->id]);\n}\nIt ain't pretty but it gets the job done for now. \ud83d\ude48\nUpdate: Scratch that, I was mistaken. The workaround does not work either.\nIt appears to be a lower level permissions problem. Perhaps with Valet and MacOS.\nI can: \n- Rename a file in my storage \nphp\n$original = storage_path('test.txt');\n$new = storage_path('foo.txt');\nrename($original, $new);\n- Rename a file in the system temporary directory \nphp\n $temp_file = tempnam(sys_get_temp_dir(), 'Tux');\n $new_temp = tempnam(sys_get_temp_dir(), 'Flux');\n rename($temp_file, $new_temp);\nBut I can't rename a file in the system temporary directory to a path in my project (i.e. storage).. Okay, after some serious Google Fu I found the underlying issue and managed to resolve it.\nThe problem is caused by the fact that rename can only work \"normally\" on the same drive (cf. PHP Bug).\nAs I have my macOS Users folder symlinked to another volume, the system's temporary directory and my source code are on different drives.\nThe solution is to change Valet's php.ini and set the temporary directory to a folder on the same drive. (That or move your source code to the other drive)\nIn my case it now looks like this.\nsys_temp_dir = \"/Volumes/UserSpace/var/tmp\"\nRestart Valet and everything should work as expected.. ",
    "spyrosk": "No problem! Thank you for the quick turnaround @freekmurze!. ",
    "Melcus": "Symfony \\ Component \\ Debug \\ Exception \\ FatalThrowableError (E_ERROR)\nCall to undefined method Spatie\\MediaLibrary\\FileAdder\\FileAdder::toMediaCollection(). ",
    "JinalSomaiya": "@freekmurze \n`$resizedConversion = Manipulations::create()\n                ->width(123)\n                ->apply()\n                ->manualCrop(20, 20, 10, 10);\n        $media->manipulations = [\n            '*' => $resizedConversion->toArray()\n        ];\n    $media->save();`\n\nI want to crop image and my code is as above.\n it is regenerating conversions but cropping is not working.\n. I also tried with using $yourModel->media but same queries used.\nno difference showed me.\nwhy?. this issue is solved.\ngetUrl() method give me more query.\nso, i replace getUrl() method to custompath(config('medialibrary.s3.domain').'/listing/'.$listingId.'/'.$media->file_name)\nSo, my code is:\n$listing = Listing::with(['car', 'media'])->findOrFail($listingId);\n    foreach ($listing->media as $media) {\n        $url = config('medialibrary.s3.domain').'/listing/'.$listingId.'/'.$media->id.'/conversions/';\n        $media->url = $url.'375x375.jpg';\n        $media->compressed_url = $url.'compressed.jpg';\n    }. Thanks for your help!\n\nI don't want to create directory in amazon but apply changes in compressed image store in amazon s3.. ",
    "jameslkingsley": "Yes, 4.13.5.. ",
    "AlexECP": "@jameslkingsley any advice on how to handle deleting files from GCS?  They dont seem be deleted automatically when deleting media using this library?. ",
    "LarBearrr": "@AlexECP I'm having a similar issue. I've managed to get the package to work with my GCS bucket as far as creating a media record in my database and uploading the image to my bucket. \nHave you been able to actually display an image on your frontend using something like $model->media->first()->getUrl()?\nAlso, I think I'm having permission issues with my bucket as it may not be publicly accessible. \nReading the Laravel documentation at https://laravel.com/docs/5.7/filesystem#storing-files, if I were using the standard Storage driver for laravel I should be able to do something like this:\n```\nThe putFile and putFileAs methods also accept an argument to specify the \"visibility\" of the stored file. This is particularly useful if you are storing the file on a cloud disk such as S3 and would like the file to be publicly accessible:\nStorage::putFile('photos', new File('/path/to/photo'), 'public');\n```\nWhat kind of success did you have using this package with GCS? We're you able to display your images? Did you figure out how to delete from GCS when the model is deleted?\n. ",
    "beerwin": "\n@jameslkingsley any advice on how to handle deleting files from GCS? They dont seem be deleted automatically when deleting media using this library?\n\nI have the same issue, deletion doesn't work. No errors messages at all.. ",
    "stroebjo": "Ah makes sense. Thanks for the hint!. ",
    "Nks": "How does php package must be integrated with vuejs? :) \nYou just need use vue.js resource package and send your files to your API and save it with this package. \nExample:\n```\nfilesChange: function (event) {\n                if (!event.target.files.length) return;\n            this.currentStatus = STATUS_SAVING;\n\n            const formData = new FormData();\n\n            if (this.options) {\n                _.each(this.options, function (value, key) {\n                    formData.append(key, value);\n                });\n            }\n\n            let fileList = event.target.files;\n            let fieldName = event.target.name;\n\n            _.each(fileList, function (file, key) {\n                formData.append(fieldName, file);\n            });\n\n            this.$http.post(this.url, formData).then((response) => {\n                this.$emit('dropzoneUpdate', response.data.data);\n                this.currentStatus = STATUS_SUCCESS;\n            }, (response) => {\n                toastr.error(response.statusText);\n                this.currentStatus = STATUS_FAILED;\n            });\n\n            event.target.form.reset();\n        },\n\n```\nAnd here a medialibrary usage in the api side:\n```\npublic function saveMedia(array $media)\n    {\n        foreach ($media as $item) {\n            $this->model->addMedia($item)->toMediaCollection(SocialNetworkPost::MEDIA_COLLECTION);\n        }\n    return $this->model;\n}\n\n``\nWhere in$media` array we have a files which got with the Request class.. Lol. I think I found a solution for this as I described.\nHere a result of the event listener - https://gist.github.com/Nks/b3b1cd7398a560eda8ddb7e37901869e \nBy the way, when you write a question and ponder it - usually the solution comes by itself :D Magic :). @freekmurze a reason why I'm first saving item instead convert it first - I want to show a progress for a user that the file is converting (with \"progress\" custom attribute). Also I'm creating parent model record when uploading first file. Also in this case if decoding will fail I can send notification to myself to fix it (if issue in the ffmpeg configuration) and have an ability to load a lot of files while first file is decoding. In any case I tested it a lot of times - it works perfectly for me and it's not calling any media's events when it's updating progress, etc. . ",
    "sebastiaanluca": "I have a similar situation where a user is redirected to a page containing the (converted) media they just uploaded. Since it's queued and the conversion is still pending, they see missing/broken images. Ideally, there'd be a property on the media model to check if all conversions and manipulations have completed.\nIn addition to the ConversionHasBeenCompleted event being dispatched in FileManipulator per conversion, wouldn't it be trivial to add the AllConversionsHaveBeenCompleted just at the end of the performConversions method or am I missing something? I see no queued jobs in that flow other than the PerformConversions which encapsulates all.\nCurrently trying to set the expected number of conversions on a media model using custom properties and reducing it when ConversionHasBeenCompleted until it reaches 0, but it feels too cumbersome just to know when the media is ready to be used.. No problem, I'll try to schedule some time to submit a PR when I'm refactoring our image handling.. Was going to implement this today, doesn't seem necessary anymore \ud83d\ude05 A lucky \"side-effect\" of switching to responsive images (for all our images) is that it defaults to the original, already uploaded and available, image. When the queue has converted the responsive images, it uses those instead. So win-win here.\nGreat package, cool new features. Cheers to the team!\n\nAlso related to https://github.com/spatie/laravel-medialibrary/issues/606. \n",
    "slavarazum": "@freekmurze Can you please clarify what exactly do you mean? \n\ndelete all stray media items that are not related to a model\n\nBecause if the save method was never called, media model record hasn't be stored into database.. @freekmurze Testcase added, something else?. I have found only 2 calls of this value. Don't see cases which will break any functionality.. Yep, it's for next major release. With updated upgrade guide.. Of course, we can remove this intermediate variables.\nThe main goal of my PR - it's to show, how we can resolve current issue.\nWhat exactly do you think we need to test?\nHow we can avoid the adding a method to an interface in this case?. Ok, I understood you, will start working on this as soon as I have enough time. Thanks!. ",
    "amouillard": "Wrong issue.. ",
    "Punksolid": "I also think that  ->replace($name = 'logo') would be useful . ",
    "ConstantMath": "Hello Freek, I think it could be very useful to be able update a record since you want to include a media manager in your cms where you can update some infos, upload new file, etc. \n(like in Wordpress to use a famous example ;). Thanks, yes I got the idea but my problem is that I need this information even if there is no medias in the DB. . ",
    "Akhibemudu": "@unstoppablecarl  @canvural Please is there a way I can upload new image[s] to an existing model? In my situation, I created a Property form that accepts multiple property images which work well, but the problem is when trying to update that Property Model to accepts more image whenever the user clicks on update form, I get the same error as above.\nHere is it for update function.\nforeach ($request->file('property_photos', []) as $key => $file) {\n            $property->addMedia($file)\n                ->preservingOriginal()\n                ->toMediaCollection('property_image');\n        }\nFor this update, I want to add more images to the existing image in the Property Model without having to delete previous uploaded image. @cyberfly for example, I have 4 images and each image has a remove/delete button nd when u click on the delete button it should remove just that image and its related conversion both from db and from the directory. Your solution alongside others would remove the image from db however, it would also delete all images in the folder. \nso my question is - is there a way to remove each image using medialibrary? \ne.g 5 images, user remove 1, remaining images should be 4 inside the folder, but currently, the folder that contains the images to that model wud be deleted. Any hint for this?. @dlaynes and @MannikJ Please is there a way you can add more images to an existing image in media library without deleting the existing image?  If Yes, please can you provide a workable solution to it? Thanks.. @MannikJ  well after updating media-library to 7.6.0, I was able to add more media to existing media without having to delete the existing media. . Am having a similar issue, I have tried debugging it for 2 days now but dont seems to hv any progress, Please here is my code, for the custompathgenerator\n`<?php\n/*\n * Created by PhpStorm.\n * User: DELL\n * Date: 10/24/2018\n * Time: 11:51 AM\n /\nnamespace App\\Helper;\nnamespace Spatie\\MediaLibrary\\Tests\\Unit\\PathGenerator;\nuse Spatie\\MediaLibrary\\Models\\Media;\nuse Spatie\\MediaLibrary\\PathGenerator\\PathGenerator;\nclass CustomPathGenerator implements PathGenerator\n{\n    public function getPath(Media $media) : string\n    {\n        //return md5($media->model_id).'/';\n    $model = class_basename($media->model_type);\n    return $model .'/'.$media->model_id.'/'.md5($media->id).'/';\n\n}\n\n/*\n\n\n\nGet the path for conversions of the given media, relative to the root storage path.\n  */\n    public function getPathForConversions(Media $media): string\n    {\n        return $this->getBasePath($media).'/conversions/';\n    }\n/\n * Get the path for responsive images of the given media, relative to the root storage path.\n /\npublic function getPathForResponsiveImages(Media $media): string\n{\n    return $this->getBasePath($media).'/responsive-images/';\n}\n/\n * Get a unique base path for the given media.\n /\nprotected function getBasePath(Media $media): string\n{\n    return $media->collection_name;\n}\n}\nMedialibrary    'path_generator' => App\\Helper\\CustomPathGenerator::class,\n. @freekmurze sir, please i need assistance to migrate table in medialibrary. Till now am still hving the above issue of not being able to migrate table even after following the installation guide. any assistance or suggesstios would be appreciated. thank you.. Ok thank you @CaesarChan . @adriandmitroca  Please is there a way I can upload new image[s] to an existing model? In my situation, I created a Property form that accepts multiple property images which works well, but the problem is when trying to update that Property Model to accepts more image whenever the user clicks on update form, I get the same error as above. \nHere is it for update function. foreach ($request->file('property_photos', []) as $key => $file) {\n        $property->addMedia($file)\n            ->preservingOriginal()\n            ->toMediaCollection('property_image');\n    }**For this update, I want to add more images to the existing image in the Property Model without having to delete previous uploaded image**. @lorisleiva seems ur use case solved my current need. Here is my scenario; I created a Property form that accepts multiple property images which work well, but the problem is when trying to update that Property Model to accepts more image whenever the user clicks on update form,  Nothing happens, the only solvable scenario am left with, is to delete the existing media before adding new media. Which is wrong for my use case. Please, can I see your updateMedia  Method? Thank you. . **Here is my UpdatePropertyForm**   foreach ($request->file('property_photos', []) as $key => $file) {\n        $property->media->each->delete();\n        $property->addMedia($file)\n            ->preservingOriginal()\n            ->toMediaCollection('property_image');\n    }\n`\nFor this, I want to add more images to the existing image in the Property Model without having to delete previous uploaded image ,,, \n. \n\n",
    "muhghazaliakbar": "Ah i didn't check the API docs. Thank you!. ",
    "markvaneijk": "PR: https://github.com/spatie/laravel-medialibrary/pull/612. Yes, I made the simple changes you suggested. But what about the errors messages? Do you want to collect them and display at the end? Or what should be the outcome?. ",
    "Jafo232": "Anyone?. V3.17.2. I am using Laravel Framework 5.4.19.  We cannot run in a PHP7 environment as of yet with this project.  Is PHP7 a requirement in V4?\n. Ok thank you so much for your help! :). ",
    "mtarlac": "Maybe you can try something like this:\n<img src=\"{{ url('') }}/uploads/{{ $img->id }}/conversions/thumb.{{ substr(strrchr($img->file_name, '.'), 1) }}\" alt=\"{{ $img->name }}\">. ",
    "silverqx": "I'm absolutely sure, I tested it in a simple script like touch('e:/xyz/file.') and I got an error, I was surprised too :/\nI send PR later . I forgot, tested on latest PHP 7.1. ",
    "coppee": "Hi @sandervanhooft ,\nDid you finally find a way ?  Thanks.. Of course :) Thanks for your message !. ",
    "ohnotnow": "Just in case anyone else finds this, on the back of @ivanvermeyen 's code above - if you want to take advantage of Laravel's Storage::fake() so that your test uploads are cleaned up etc, you can try this :\n// some test function\nStorage::fake('images');\nconfig()->set('filesystems.disks.images', [\n    'driver' => 'local',\n    'root' => Storage::disk('images')->getAdapter()->getPathPrefix(),\n]);\n// do some test code that triggers your upload, then if you want you can :\n$this->assertFileExists($model->getFirstMedia('my-collection')->getPath());\nEdit: oh, and if you're trying to test code that outputs a view that uses the getUrl() from a media item, you might need to over-ride the default LocalUrlGenerator too as it throws an exception if the URL doesn't seem to be public (as far as I can see anyway). So I made a fake url generator which just skipped the exception check :\n```\n<?php\nnamespace Tests\\Feature;\nuse Spatie\\MediaLibrary\\UrlGenerator\\LocalUrlGenerator;\nclass FakeStorageUrlGenerator extends LocalUrlGenerator\n{\n    protected function getBaseMediaDirectoryUrl() : string\n    {\n        if ($diskUrl = $this->config->get(\"filesystems.disks.{$this->media->disk}.url\")) {\n            return str_replace(url('/'), '', $diskUrl);\n        }\n    // conditional that throws exception was here\n\n    return $this->getBaseMediaDirectory();\n}\n\n}\nThen in the test :\nStorage::fake('images');\nconfig()->set('filesystems.disks.images', [\n    'driver' => 'local',\n    'root' => Storage::disk('images')->getAdapter()->getPathPrefix(),\n]);\nconfig()->set('medialibrary.url_generator', 'Tests\\Feature\\FakeStorageUrlGenerator');\n// now you can get your view without an exception being thrown\n```\n. ",
    "Xety": "Oh sorry i didn't saw that before. My bad. Thanks for the fast reply.. ",
    "bbashy": "Yeah I know, forgot I wasn't working on the edit area :P\nI fixed it by calling the addMedia() after saving the related model but my main question was around the error I received. Shouldn't there be a model related error?\nConfused me a little and thought my PHP was broken where it couldn't find the upload path. Best to do a dd($request->file('avatar')); to make sure.. I do it the same way and it's working here.\n$model->addMediaFromRequest('file')\n      ->withCustomProperties(['user' => auth()->user()->id])\n      ->toMediaCollection('attachments');. Same. If $request->file('avatar') is picking it up, it should work.\nWhat does dd($request->hasFile('avatar')); or $request->file('avatar')->isValid() return?. Waiting on this (unless there's a good way to move from local to S3 without this?).. You can use this package with MariaDB 10.2+. ",
    "umair321": "This mistake is here not in code, I am calling  it like User::find(3) and yes the key is avatar.. I already did, and have file in request.. I am using Laravel 5.4. Yes I added.. ",
    "xilwal": "RequestDoesNotHaveFile in RequestDoesNotHaveFile.php line 12:\nThe current request does not have a file in a key named /tmp/phpZVbJ0F.\nPlease help me out.. view:\n{{Form::open(array('route'=>'postmeta.store', 'method'=>'POST', 'enctype'=>'multipart/form-data' ))}}\n{{Form::file('images[]', ['multiple' => 'multiple'])}}\n{{Form::submit('Upload')}}\n{{Form::close()}}\nmethod\n```php\n//dd($request->all());\n$post = Post::find(24);\n//$files = $request->file('images');\n$post->addMultipleMediaFromRequest($request->file('images'))->toMediaCollection('images');\nreturn back()->with('success', 'Uploades Successfully');\n``. Error:\nRequestDoesNotHaveFile in RequestDoesNotHaveFile.php line 12:\nThe current request does not have a file in a key named/tmp/php3EPUCp`. This can be a solution or not, Sir? Its work.\nforeach($files as $file)\n        {\n        $post->addMedia($file)->toMediaCollection('images');\n        }. ",
    "BePsvPT": "After some searching, I found that ImageMagick may require Ghostscript to convert pdf to image.\nReferences: 1, 2, 3\n. ",
    "jorenvh1": "Thanks for the quick response.\nIf I use GlideImage to convert my image before saving, I'd be saving a .tmp file.\nIs there any way to rename the file before saving it?\n```\n$img_path = $avatar->getPathName();\n        $avatar_img = GlideImage::create($avatar)\n                        ->modify(['w'=> 75])\n                        ->save($path);\n    $child->addMedia($path)\n    ->withCustomProperties(['url_id' => $avatar_url_id])\n    ->toMediaLibrary('avatar');\n\n```\n$avatar is a temp file because it's being uploaded, so in this case I'm saving the correct image but with the temp name and .tmp extension\n. How would I go about using this in Laravel?. Nevermind, I don't know what happened but now it works. Probably made a small mistake, but it works, thanks!. ",
    "mhamlet": "Ok, will add tomorrow.. You already have a test that covers my change - it_can_add_handle_file_keys_that_contain_an_array_to_the_medialibrary_from_the_current_request. \nBut it asserts that number of File Adders is 3.\nphp\n$this->assertCount(3, $fileAdders);\nCan you confirm that if number of uploaded files is 4, the number of file adders must be 4 too?. Also, we must use flatten, not collapse. I will change it in my next commit.. ",
    "williamoliveira": "But in a case where the subject model is not saved yet and preserveOriginal is false, processMediaItem will be called on a later time, the original file will be already deleted and it will crash . ",
    "dees040": "I totally missed out on the HasMediaConversions interface. It all works now, thanks!. ",
    "dror3go": "I don't think that custom properties suits my needs, cause I'll want to filter results by using these extra columns.\nIf you take my example for the media's date it was taken (let's call it taken_at column) - I need to index this column and to be able to query with stuff like SQL's BETWEEN, etc.. ",
    "IlCallo": "I think you shall add columns to the migration.\nSet them as nullable or with a default value, then save the model using the library with\n$media = $user->addMedia($file)->toMediaCollection($collection)\nand update the returned instance fields you need\n$media->taken_at = $currentDate;\n$media->save();. On this regard, I don't know if it can be fixed in some way, but all method of the library which returns a Media model have \n@return \\Spatie\\MediaLibrary\\Media\nin their PHPDocs and this can create problems in the IDEs autocomplete feature if a custom model is used.. Same concern about the addMediaFromBase64 method. ",
    "bhulsman": "I'll give it a try!. See the documentation; https://docs.spatie.be/laravel-medialibrary/v5/introduction\n\n$newsItem->addMediaFromRequest('image')->toMediaCollection('images');\n\nYou should use addMediaFromRequest('my_file') instead of addMediaFromRequest($request->my_file).. Here you go! Not sure if this is exactly what you had in mind, but just let me know.. Created a guardAgainstInvalidMimeType method as you requested.  Besides that; the validator requires an instance of UploadedFile or File, fixed that too.\nSorry for the hassle!. Add $with = ['media']; to the Product model and create your own Media model (extending the default media model) and add $appends = ['url'] with a getUrlAttribute method.\nDocs:\n- https://docs.spatie.be/laravel-medialibrary/v7/advanced-usage/using-your-own-model\n- https://laravel.com/docs/5.6/eloquent-mutators#defining-an-accessor. Company is model from which you have to fetch the media first. Calling getUrl() only works on an instance of Media.\nUse $company->getFirstMediaUrl() and see https://docs.spatie.be/laravel-medialibrary/v7/basic-usage/retrieving-media for more information.. @fhusquinet What would be the use case for having a PNG image but giving it a JPG extension?. ",
    "Oussama-Tn": "Thanks! :+1: . ",
    "kikoseijo": "Came up here, in my case was the size of the file was exceeding PHP restrictions.\nHappy coding!. ",
    "nasirkhan": "@canvural thanks for your response. \ni did not fully understand your feedback. As i mentioned above. if i implement HasMedia it works perfectly. But when i changed to HasMediaConversions and add the method registerMediaConversions it starts to show the error.. @freekmurze thanks for informing that you discontinued the support. I will really appropriate if you please add this notice on the introduction page of v4. I did not find such notice in any place of the v4 doc.  Otherwise i would not use this package. \nMy application is developed based on Laravel 5.1. As this is the only long time support version till now and did not ended the support as yours, we do not have any plan to upgrade the version now. But after the L5.5 release we believe we would do so. \nI thought the Spatie team was more responsible and dependable. . ",
    "Childplan": "I think this is the same as a question that I have - which is:\nIf the file uploaded is not an image (.jpg / .png) and is another file type such as a MS Word file (.doc / .docx) or PDF then is there an easy way to display the default icon for that file type.  For most non image doc types it makes more sense to display an icon than a thumbnail of the document itself.\nMany thanks . ",
    "sebeq": "Hello,\nI am working one the same setup (Laravel 5.4) and \"spatie/laravel-medialibrary\": \"5.0.0\" and having the same issue.\nMethod toMediaCollection() cannot be found, however, toMediaLibrary() works.\n@Wolrab1: Are the conversions working well for you? Not sure if connected with function name, but when defining:\n`\npublic function registerMediaConversions()\n    {\n        $this->addMediaConversion(\"box\")\n            ->crop(Manipulations::CROP_CENTER, 382, 189)\n            ->performOnCollections(\"images\", \"gallery\");\n    $this->addMediaConversion(\"thumb\")\n        ->crop(Manipulations::CROP_CENTER, 100, 100)\n        ->performOnCollections('images', 'gallery');\n\n    $this->addMediaConversion('small')\n        ->width(300)\n        ->height(200)\n        ->performOnCollections('images', 'gallery');\n\n    $this->addMediaConversion('medium')\n        ->width(1024)\n        ->height(768)\n        ->performOnCollections('images', 'gallery');\n\n    $this->addMediaConversion('large')\n        ->width(1920)\n        ->height(1080)\n        ->performOnCollections('images', 'gallery');\n}\n\nI can get only original picture and first defined conversion. \nWhen using$model->getFirstMediaUrl(\"gallery\")I'm able to get source file, but$model->getFirstMediaUrl(\"gallery\", \"thumb\")` (or any other - small, medium, large) always return \"box\".\nWhen changing order e.g. \"large\" conversion set as first one - function will always return \"large\".\nFiles are created properly and exists on a filesystem.\nEdit:\nPackage refreshed, but still the same issue. Here is a screenshot from mentioned file: http://prntscr.com/frv4wi. Of course you are right, but still not working. I've got other example:\n@foreach($content->getMedia('gallery') as $row)\n                    <a class=\"colorbox\" rel=\"gallery\" href=\"{{ $row->getUrl('large') }}\"><img src=\"{{ $row->getUrl('thumb') }}\" alt=\"grid\"></a>\n@endforeach\nIf I understand correctly - HREF should link to large conversion and img should show thumb .. but both show box converted file (defined as the first of conversions). Files are available on the drive (generated correctly).. For both issues solution is to update source by hand. Composer update, removal, reinstall did not help. But simple file update solve both issues.. ",
    "Radiergummi": "While I think your point is valid, I'd like to express my disagreement considering this small change is the only one necessary to make Lumen work projects out of the box, without modifying files below vendor/, and you already give usage instructions for Lumen projects.\nProposing people to switch frameworks isn't a real recommendation either, they probably had a reason for their decision.   \nThank you for your prompt response, though.. @Shadomax I ultimately settled with a custom solution more specific to my project, however I solved this specific issue with my own helpers.php file (using the function I proposed above) and included that in composer's autoload section, like so:\njson\n{\n  \"autoload\": {\n    \"psr-4\": { ... },\n    \"files\": [ \"app/helpers.php\" ]\n  }\n}\nThat way, your helpers file will be autoloaded right away, including the function and making the library work fine.. ",
    "erss400": "how did you solve this error @Radiergummi ?. ",
    "DigicreateJens": "I do indeed like the package, thanks!\nSo I cannot use the custom_properties of a Media model in registerMediaConversions? It's not 100% clear how this would work with the focalX and focalY properties I'm trying to add to the model.. Basically what I'm trying to make is a focus-crop plugin where the user can set a point on an image before it's uploaded. This point is then saved in the custom_properties of the uploaded media as focalX and focalY. But now I want to use these custom_properties when using the focalCrop function in the registerMediaConversions function.\nSo in a perfect world I would be able to add the following code to my own Models' registerMediaConversions method:\n$this->addMediaConversion('thumb')->focalCrop(400, 60, $media->getCustomProperty('focalX'), $media->getCustomProperty('focalY'));\nAny tips on how I could achieve something like this?. @freekmurze I have created a Pull Request as I have found a way to do what I described above. If I did anything wrong in the PR, please let me know as this is the first time I'm doing something like this to an official repository.. ",
    "bobinrinder": "Check out this part of the documentation:\nhttps://docs.spatie.be/laravel-medialibrary/v5/advanced-usage/using-a-custom-directory-structure#using-a-custom-directory-structure\nI assume you could just add a config var with a folder path to those functions, then you can you change that config var for each environment.. Thanks for your reply.\nBy collection specific I meant that the name of the conversion can exist once in each collection. I ran into trouble as I had a conversion with the name large three times on the same model but differently configured for each collection (as I tried to demonstrate with the code above). Which means I cannot give the same name to multiple conversions in the same model, although each conversion is aiming at a different collection.. That seems like a neat solution, I will give that a try! :)\nThank you very much! \ud83d\udc4d . ",
    "rayboyd2018": "This is perfect and much better than I hoped for. I've implemented and it's working as expected. Thanks for helping me with this. I'll be sure to RTFM next time :)\nI owe you guys a few postcards.. @mindmergedesign of course, info below.\nFirst up, make sure you publish the medialibrary configs ...\nphp artisan vendor:publish --provider=\"Spatie\\MediaLibrary\\MediaLibraryServiceProvider\" --tag=\"config\"\nIn my app I have a namespace App\\Helpers within this namespace I created a class called EnvironmentPathGenerator the contents of this class are at the end of this comment, but it's really simple and basically just prepends the env to the file path.\nIn order to make use of the custom path generator class, I then needed to update the file config/medialibrary.php and point the configuration variable custom_path_generator_class at my custom path generator class.\nMy configuration change within config/medialibrary.php is as follows -\n'custom_path_generator_class' => App\\Helpers\\EnvironmentPathGenerator::class,\nAnd the code for EnvironmentPathGenerator is as follows -\n```\nnamespace App\\Helpers;\nuse Spatie\\MediaLibrary\\Media;\nuse Spatie\\MediaLibrary\\PathGenerator\\PathGenerator;\nclass EnvironmentPathGenerator implements PathGenerator\n{\n    protected $path;\npublic function __construct()\n{\n    $this->path = app()->env . '/';\n}\n\npublic function getPath(Media $media) : string\n{\n    return $this->path . $media->id . '/';\n}\n\npublic function getPathForConversions(Media $media) : string\n{\n    return $this->getPath($media) . 'conversions/';\n}\n\n}\n```\nI hope this helps,\nRegards,\nRay.\n. ",
    "mindmergedesign": "@wsray would you mind sharing how you implemented this? I am not really sure where to add the config file containing the functions. . @wsray Thank you so much! I'll give it a try later today.. @wsray it worked perfectly, Thanks again!. ",
    "Pixelworlds": "Its good to note that the import has changed from use Spatie\\MediaLibrary\\Media; to use Spatie\\MediaLibrary\\Models\\Media;. ",
    "BondaCB": "@freekmurze I'm sorry but i don't know how to do tests.. @freekmurze I'm sorry but i don't have time those days to perform the tests.\nI will close the issue and i will repoen it again when i have them done.\nThanks. ",
    "royduin": "SoftDeletes is core functionality of Laravel, there are more people requesting this: https://github.com/spatie/laravel-medialibrary/issues/632, https://github.com/spatie/laravel-medialibrary/issues/155, https://github.com/spatie/laravel-medialibrary/issues/152, https://github.com/spatie/laravel-medialibrary/issues/49, because you're not using it you won't accept it?. I'll create some tests tomorrow \ud83d\udc4d . @freekmurze, can you reopen the PR? I've created the tests. That's working fine because the medialibrary:clean command just matches directories with the media table. It's not checking the model_id.. Any idea why the test is failing? When all tests ran successful the PR will be merged and a new release will be created?. Fixed and I've created a PR for the docs: https://github.com/spatie/docs.spatie.be/pull/180. Thanks for merging! . I'd the same issue, locally it was fixed by editing the config/medialibrary.php file but when deploying I was keep getting the error because php artisan config:clear kept failing. Removing the cached config file manually solved the problem: rm bootstrap/cache/config.php.. That's not the case as far as I know @freekmurze. Just inspect your thumbnail on the left of your message here on Github, displayed as 44px but a 88px is loaded. Change the url from 88 to 44 and you'll see the problem on a device with a retina display; a blurry image. I've \"embedded\" our avatars so you can compare:\n\n\nI would love to see support for this, maybe just multiply all sizes?. Fixed. ",
    "giorgiomen": "Solved. The problem was php 5.6. Using php7, it works fine.\nThank you. ",
    "rafaelsisweb": "Hy @freekmurze, how should i do that?. Hi @freekmurze, i really will try to do that.\nCould you help me to find where exactly is the code that delete files from disk?\nI will be happy to try solve that and contribute to the project.\n. The problems seems to be, that deletion is issued in directory not in file, and with custom path i'm using i'm not using a directory per media file. Only grouping medias of same \"model\" into same directory, i this case, the deletion is been issued to model directory.. Hi,\nI'd changed my custom path to use each media into a exclusive directory and works fine to me.\n```php\n<?php\nnamespace App;\nuse Spatie\\MediaLibrary\\Media;\nuse Spatie\\MediaLibrary\\PathGenerator\\PathGenerator;\nclass CustomPathGenerator implements PathGenerator\n{\n    /\n     * Get the path for the given media, relative to the root storage path.\n     /\n    public function getPath(Media $media) : string\n    {\n        $model_type = str_replace('App\\', '', $media->model_type);\n        return $model_type.'/'.$media->model_id.'/'.md5($media->id).'/';\n    }\n    /\n     * Get the path for conversions of the given media, relative to the root storage path.\n     * @return string\n     /\n    public function getPathForConversions(Media $media) : string\n    {\n        return $this->getPath($media).'formats/';\n    }\n}\n```. ",
    "tantana5": "Thanks a lot @rafaelsisweb! You save my life, It work for me:\nCollection_name:\n-Media_ID1\n--file.exp\n-Media_ID2\n--file2.exp\nclass BasePathGenerator implements PathGenerator\n{\n    /\n     * Get the path for the given media, relative to the root storage path.\n     /\n    public function getPath(Media $media): string\n    {\n        return $this->getBasePath($media).'/'.$media->id.'/';\n    }\n/*\n * Get the path for conversions of the given media, relative to the root storage path.\n */\npublic function getPathForConversions(Media $media): string\n{\n    return $this->getBasePath($media).'/conversions/';\n}\n\n/*\n * Get the path for responsive images of the given media, relative to the root storage path.\n */\npublic function getPathForResponsiveImages(Media $media): string\n{\n    return $this->getBasePath($media).'/responsive-images/';\n}\n\n/*\n * Get a unique base path for the given media.\n */\nprotected function getBasePath(Media $media): string\n{\n    return $media->collection_name;\n}\n\n}. I have same issue true, it happens when your form validate fails and redirects back. ",
    "StApostol": "I understand that need to use a different method, but do not use it correctly\nMediaCannotBeDeleted :: doesNotBelongToModel which throws out a fatal error. ",
    "joshforbes": "Looking into this a little more I don't think its anything the superbalist adapter is doing - they simply pass execution off to the official google cloud storage php library:\n```\n    /\n     * Uploads a file to the Google Cloud Storage service.\n     \n     * @param string $path\n     * @param string|resource $contents\n     * @param Config $config\n     \n     * @return array\n     */\n    protected function upload($path, $contents, Config $config)\n    {\n        $path = $this->applyPathPrefix($path);\n    $options = $this->getOptionsFromConfig($config);\n    $options['name'] = $path;\n\n    $object = $this->bucket->upload($contents, $options);\n\n    return $this->normaliseObject($object);\n}\n\n```\nwhere $this->bucket is part of the offical google library.  I mention this because I wonder if you would want to address the possibility of the file already being closed in your package (since doesn't appear to be caused by a simple bug in a flysystem adapter). I don't know if this is the best approach but adding:\nif (is_resource($file)) {\n            fclose($file);\n        }\ndoes solve the issue. I could submit a PR with this change if you would like or if it is not something you want to do I guess I could always override the DefaultFilesystem.\nThanks!. ",
    "AzAzzAzzz": "I'm sorry, I meant Eager Loading... How to avoid multiple database requests?\nIn the controller, I get the data this way\nreturn view('blog.index', ['posts', Blog::where('active', 1)->paginate(5)]);\nOutput in view\n@foreach($posts as $post)\n    <div class=\"\">\n        <h3 class=\"\">{{ $post->name }}</h3>\n        <img src=\"{{ $post->getFirstMediaUrl('images') }}\">        \n        ...\n    </div>      \n@endforeach\nAll works, but it turns out a lot of queries to the database, please tell me how to avoid this. Thanks already understood, earlier to make such it did not turn out, because I in the table did changes which are not necessary). Thanks to the author for the cool package. ",
    "abishekrsrikaanth": "\ud83d\udc4d . The new version requires an upgrade to Laravel 5.5, could you add the parameter to the package that support Laravel 5.4? I really don't see a point to spend more hours upgrading to Laravel 5.5 and testing it to be able to use a new parameter on the registerMediaConversions function. . ",
    "s1rc": "Running into the same issue as @dimitribocquet.\nSame version and same exact symptoms.. @dimitribocquet I went back through the history of the S3UrlGenerator class and found that the method was removed. \nIf you make your own URLGenerator class you can resolve this error.. Edit: I read UPGRADING.md and see this is normal behaviour.\nIs there any way in my custom path generator to remove the filename from the conversion path?\nI have about 12,000 media objects with are video and use AWS Elastic Transcoder to generated multiple file sizes. I can change newly added conversions to the new path format, however the existing files it'd be nice to not have to go through and rename.. ",
    "jonathandey": "I'm running version 4.13.5 and I'm still running in to this problem. Any idea what could be wrong?. Don't think I can. I'm using OctoberCMS on Laravel 5.1. To the best of my knowledge this is a small fix. I have my own fork but I'd rather be using the official version. You can see my fix here: https://github.com/jonathandey/laravel-medialibrary/commit/8a0d1bbde150794477e5c922e4bc7708daadf60b. Ok. Thanks for your help.. ",
    "Yentel": "This has been fixed in v4 already :-). ",
    "diptesh-patel": "Actually issue is my laravel is installed at 5.6.14 PHP version.. \nand not able to update the version 4 of medialibrary as it requires PHP 7\n-- I have tried many ways to update to php 7 but not got success ..\n-- So Is it possible to change in version 3 function directly so whenever anybody download version 3 it should work with Laravel 5.4 and PHP 5.16..\nIf possible please do .. anyway I have fixed the issue by overriding function in MODEL class. \nThank You,\nDiptesh Patel. ",
    "manogi": "@a-komarev Thank you very much. Yes, that helps. I should probably not post issues concerning development branch. I did use this because I started a project on laravel 5.5 and needed to use the laravel55 version of medialibrary, though.\n. ",
    "seandelaney": "I'm a bit confused, sorry. I might not have asked the correct question either...\nMy disk is called uploads like:\n'uploads' => [\n    'driver' => 'local',\n    'root' => public_path('uploads'),\n],\nI want to upload a file X to /uploads/carbs but let's say I then want to upload my next file to /uploads/proteins.\nThe upload path can change if that makes sense.\nWhen I call $asset->addMedia($file)->toMediaCollection($this->mediaCollection);, the file gets uploaded to /uploads but I'd like to set the path to /uploads/carbs or /uploads/some_folder.\nDo I still need to update the public_path() value each time?\n. Yeah, I've also setup a custom directory structure.\nI've got:\n```\n/*\n * Get the path for the given media, relative to the root storage path.\n /\npublic function getPath(Media $media) : string\n{\n    // Set path to root level \n    return '';\n}\n/\n * Get the path for conversions of the given media, relative to the root storage path.\n * @return string\n /\npublic function getPathForConversions(Media $media) : string\n{\n    // Sets asset conversions in a folder called \"conversions/model_id\"\n    return 'conversions/'.$media->model->id.'/';\n}\n```\nI didn't want:\n/uploads/1/\n/uploads/1/conversions\n/uploads/2/\n/uploads/2/conversions\n...\n/uploads/n/\n/uploads/n/conversions\nI changed this because I'm also using https://github.com/DirectoryLister/DirectoryLister as my File Manager UI. \nI wanted all my file uploads to be saved in the /uploads with single conversions as a subfolder holding all my conversions in sub-sub folders based on model_id. It actually works very well:\n/uploads/file1.ext\n/uploads/file2.ext\n/uploads/conversions/1/file1conversion.ext\n/uploads/conversions/2/file2conversion.ext\nI added a Create Folders button to the File Manager UI that I'm trying to build, allowing the client to create a sub folder. This is why I asked how do I set the path to allow a user to upload a file to a specific folder within the uploads folder.\nMake better sense?. @ludo237 \nOops, sorry, I thought I had posted after I closed.\nI was using an out-dated docker image which didn't have upload_max_filesize or post_max_size set correctly.. It turns out that the issue is with the customers pptx file itself. Apologies.. ",
    "yatin13490": "Thanks for quick reply and guidance.....+1. ",
    "ctf0": "sadly this is not the current behavior, cuz laravel dump the autoload after each package installation automatically. . ",
    "Kolovious": "hmmm, will check again, none of my bmp's are handled.\nBtw, im using version v.4 ( for laravel 5.1 on 5.3 ) \nThe url of the doc was https://docs.spatie.be/laravel-medialibrary/v4/advanced-usage/converting-other-file-types/creating-a-custom-image-generator, but it doesn't exist any more.. In https://github.com/spatie/laravel-medialibrary/blob/master/src/ImageGenerators/FileTypes/Image.php#L23 are defined the image extensions.\nHow i should overwrite this value?. Aha! that was the link! \ni don't know why i was getting the other posted by me. Will post the snippet here.. ",
    "ottosmops": "I think you can add extensions via your ImageGenerator (supportedExtensions() and supportedMimeTypes()):\nhttps://docs.spatie.be/laravel-medialibrary/v4/converting-other-file-types/creating-a-custom-image-generator\n. This works  for me (tifs)\n```php\n// Media.php\nclass Media extends BaseMedia  {\n/**\n* Collection of all ImageGenerator drivers.\n*/\npublic function getImageGenerators() : Collection\n{   \n    return collect(config('medialibrary.image_generators'))->push(\\App\\ImageGenerators\\Tiff::class );\n}\n\n```\n```php\n// Tiff.php\nclass Tiff extends BaseGenerator \n{\n   /*\n    * This function should return a path to an image representation of the given file.\n    /\n    public function convert(string $path, Conversion $conversion = null) : string\n    {\n        return $path;\n    }\n...\n public function supportedExtensions() : Collection\n    {\n        return collect(['tif', 'tiff']);\n    }\npublic function supportedMimeTypes() : Collection\n{\n    return collect('image/tiff');\n}\n\n```\n. If I got you right, then it would be possible to do that with a queryScope. https://laravel.com/docs/5.5/eloquent#query-scopes\nphp \npublic function scopeCollection($query, $collection)\n    {\n        return $query->where('collection', $collection);\n    }\nNot tested.. ",
    "bbdangar": "@cesargb Hey, I just changed field type json to text and it works for me.. ",
    "shankhadevpadam": "Still record delete, file doesn't delete.. yes inside public/uploads. I have fixed my self setting the value like this\nphp_admin_value open_basedir none. I am using v6 and i have follow the documentation also. Please provide me some proper example.. I have also added that one also but how to use please give me some proper example.\n```\npublic $registerMediaConversionsUsingModelInstance = true;\npublic function registerMediaConversions(Media $media = null)\n{\n        $this->addMediaConversion('thumbnail')\n             ->fit(Manipulations::FIT_CROP, 100, 100);\n    $this->addMediaConversion('image_250x250')\n         ->fit(Manipulations::FIT_CROP, 250, 250);\n\n}\n```. Then how to pass this height and width from\n$newsItem = NewsItem::find(1);\n$newsItem\n   ->addMedia($pathToFile)\n   ->toMediaCollection();\nhere. My question is, i want to pass this custom height and width from the controller like\n$newsItem = NewsItem::find(1);\n$newsItem\n   ->addMedia($pathToFile)\n   ->width(120)\n   ->heigth(120)\n   ->toMediaCollection();\nlike this . ",
    "voeurnchy": "My solution: \nphp\nModel::whereHas('media', function ($query) use($media_id){\n     $query->whereId($media_id);\n})->first()->deleteMedia($media_id);. For installation and configuration, I followed The Document\nI ran this comment vendor/bin/phpunit\n\nIt seem checking only in tests/ExampleTest.php\nPlease advice me.\n. ",
    "cyberfly": "A little improvement to @vesper8 solution if you want to dynamically query the model by its model_type string\n```\n$media = Media::find($request->input('id'));\n$model_type = $media->model_type;\n$model = $model_type::find($media->model_id);\n$model->deleteMedia($media->id);\n```. ",
    "jerauf": "Yes it does.. Yes it did.. This is the top of my model.\n```\nuse Spatie\\MediaLibrary\\Media;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nclass MovieList extends Model implements HasMediaConversions\n{\n    use HasMediaTrait;\n```\nSo, it's got everything that the docs outline.. I did this:\n`$movies = MovieList::orderBy('sort_title')->first()->getMedia();\necho $movies[0]->getUrl('large');\n`\nI got the path for the media.. No. It's only displaying when there's one record. Not when I'm looping\nthrough multiple. That's when I'm getting an error.\nOn Sun, Sep 17, 2017 at 6:20 AM, Freek Van der Herten \nnotifications@github.com wrote:\n\nSeems like it is working then no?\n$movies is a collection of Media objects.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/755#issuecomment-330036908,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AD0JO1mFEpVuOW_BuA29sJCKy77YZLflks5sjQB4gaJpZM4PY3Wn\n.\n. It gives me the count of the rows in MovieList and then the error:\n\nCall to undefined method App\\Http\\Models\\MovieList::getUrl(). I had installed it on a vanilla app to begin with and get it working. This issue was unforeseen before I installed it on a website that's in production.\nSame problem there though. Same server.. I figured out a workaround.. There must be something. I can do it with Intevention/Image. I can't do it with this package.\nChecked the php.ini file. And it's not a server setting.. I'm willing to try. When I require, there is an error:\n[InvalidArgumentException]                                                                                                               \n  Could not find package require at any version for your minimum-stability (stable). Check the package spelling or your minimum-stability. Hi - PHP version is 7. And I installed it in the directory with my Laravel app.. Did I install it wrong?. No. The opposite. I need to convert larger files.\nThe files are uploading. The conversion is throwing the error.. It's a 500 error.. The problem is that the php.ini file I was editing is not the one that the server was loading. I was able to make that change and now it's working.\nWhat was happening is that for an image larger than 1500px, the memory settings were too low to handle resizing it.. I did this. But something went wrong. So I deleted everything from the database and the copied files. It seems like it won't re-add the same image twice. How do I fix that?. Well, yes. But is there a way without needing to do another query?. ",
    "hamidhosseini": "How did you get this to work? I'm having the same problem.. ",
    "MyhedinZika": "I'm having the same problem here, any idea what's wrong?. Hmm nah apparently that's not the issue, was thinking that might have been the issue, but nah its not apparently. \nI'm on http://uw-blb.test/products\nIts the same path \nproducts:770 GET http://uw-blb.test/storage/2/AllOrders.PNG 404 (Not Found)\nproducts:731 GET http://uw-blb.test/storage/1/AddStock2.PNG 404 (Not Found)\nproducts:848 GET http://uw-blb.test/storage/4/Ballina.PNG 404 (Not Found)\nproducts:809 GET http://uw-blb.test/storage/3/createVendor.PNG 404 (Not Found). Yes I have tried that, but unfortunately thats not the problem \nThe \"public/storage\" directory already exists.\n. ",
    "tylerwiegand": "@jerauf and whoever else runs into this issue, I had it recently. Memory limits can be increased, but imo the proper way to handle this issue is actually to not use the \"sync\" queue driver in your .env file. Install a queue manager, like Redis\ncomposer require predis/predis\nbrew install redis\nThen just have a queue working running, or run one on demand\nphp artisan queue:work\nphp artisan queue:work --once\nCheers!. ",
    "codyphobe": "I knew I starred a Spatie package for this \ud83d\ude09. ",
    "eichgi": "@timgavin So you implemented spaces instead s3 with this package. I have a question, how can I set my spaces url correctly? I set this in medialibrary.php:\n'domain' => 'https://sfo2.digitaloceanspaces.com'\nbut I am getting this error:\nError executing \"PutObject\" on \"https://la-space.s3.sfo2.amazonaws.com/6/backgroundish.jpg\"; AWS HTTP error: cURL error 6: Could not resolve host: la-space.s3.sfo2.amazonaws.com\nHow did you set your space url so? thanks!. damn, I can't find a solution. thanks anyway tim!. @AEK-BKF I had tried already what you suggest and still not working. When I dump dd($user->getMedia()); I got a null collection, but the reference and the media is stored.\n. Debugging with your suggestions it works out, the \"error\" of retrieving null collection is because no parameter was passed, it works even if you do not define a media collection \ngetMedia(\"\")\nSo if you define no parameter it returns nothing, which is weird because is what the docs shows. Anyway thanks!. Using public disk and defining no media it got saved as default on field collection_name.\n$user->addMediaFromRequest('avatar')->toMediaCollection();\nAnd now I can retrieve a collection with:\ndd($user->getMedia());\nAfter debugging and testing it seems we didn't realize the matter of defining collections and how to relate them. Right now they are working as expected. \n. I didn't find the getFullUrl()method on docs, also $inmueble it's already the model which it's related to the media library, not an array. Thanks for your suggestion!. APP_URL is already specified but by some reason it's not been attached to the img path, what else could it be?. When I do: dd(config('app.url')); \nI got this: \"http://inmuebles.test/\" (what I defined in .env). I tried $inmueble->getFirstMedia('destacadas')->getFullUrl();\nbut I still got the same incomplete path:\n//storage/1/1-1.jpg. Sorry, I was kind off. Last day I changed the disk I was using (media) for public and everything went ok again. I guess I haven't tried but thanks for the help \ud83d\udc4d . Hi mokhosh, as I mentioned I was using another disk for storing files, which I called media. It wasnt working so I changed it back to public disk on medialibrary config and it works like a charm again. I hope it works for you too. I think public is the default option disi, but publish them to ensure it is. . That sounds pretty obvious, I'll try it and let you know if works!\nUPDATED 03/06/2018\nI tried what you suggests and it works like a charm! Thanks, now I am going to close this issue!. @netanelwebninja how did you manage to set your spaces url in this package?\nI set this in medialibrary.php:\n'domain' => 'https://sfo2.digitaloceanspaces.com'\nbut I am getting this error:\nError executing \"PutObject\" on \"https://la-space.s3.sfo2.amazonaws.com/6/backgroundish.jpg\"; AWS HTTP error: cURL error 6: Could not resolve host: la-space.s3.sfo2.amazonaws.com\ninstead something like you wrote (https://bluejay.ams3.digitaloceanspaces.com/14/medialibraryw1oh8c)\nAny suggestions? Thanks!. I tried the same but I couldn't make it work, instead I did this:\nif ($request->has('galeria')) {\n            //$model->addAllMediaFromRequest('galeria')->toMediaCollection('galeria');\n            foreach ($request->galeria as $key => $imagen) {\n                try {\n                    $model->addMedia($request->galeria[$key])->toMediaCollection('galeria');\n                } catch (DiskDoesNotExist $e) {\n                } catch (FileDoesNotExist $e) {\n                } catch (FileIsTooBig $e) {\n                }\n            }\n        }\nI hope this helps you!. Sure, this is my composer file:\n{\n    \"name\": \"laravel/laravel\",\n    \"description\": \"The Laravel Framework.\",\n    \"keywords\": [\"framework\", \"laravel\"],\n    \"license\": \"MIT\",\n    \"type\": \"project\",\n    \"require\": {\n        \"php\": \"^7.1.3\",\n        \"fideloper/proxy\": \"^4.0\",\n        \"laravel/framework\": \"5.7.*\",\n        \"laravel/tinker\": \"^1.0\",\n        \"yajra/laravel-datatables-oracle\": \"~8.0\"\n    },\n    \"require-dev\": {\n        \"beyondcode/laravel-dump-server\": \"^1.0\",\n        \"filp/whoops\": \"^2.0\",\n        \"fzaninotto/faker\": \"^1.4\",\n        \"mockery/mockery\": \"^1.0\",\n        \"nunomaduro/collision\": \"^2.0\",\n        \"phpunit/phpunit\": \"^7.0\"\n    },\n    \"autoload\": {\n        \"classmap\": [\n            \"database/seeds\",\n            \"database/factories\"\n        ],\n        \"psr-4\": {\n            \"App\\\\\": \"app/\"\n        }\n    },\n    \"autoload-dev\": {\n        \"psr-4\": {\n            \"Tests\\\\\": \"tests/\"\n        }\n    },\n    \"extra\": {\n        \"laravel\": {\n            \"dont-discover\": [\n            ]\n        }\n    },\n    \"scripts\": {\n        \"post-root-package-install\": [\n            \"@php -r \\\"file_exists('.env') || copy('.env.example', '.env');\\\"\"\n        ],\n        \"post-create-project-cmd\": [\n            \"@php artisan key:generate --ansi\"\n        ],\n        \"post-autoload-dump\": [\n            \"Illuminate\\\\Foundation\\\\ComposerScripts::postAutoloadDump\",\n            \"@php artisan package:discover --ansi\"\n        ]\n    },\n    \"config\": {\n        \"preferred-install\": \"dist\",\n        \"sort-packages\": true,\n        \"optimize-autoloader\": true\n    },\n    \"minimum-stability\": \"dev\",\n    \"prefer-stable\": true\n}\n. @dundermave as you mentioned, it works. \nI guess the doc shoulnd't specify the version, just the name of the package as you did.\nThanks!. @MdkanokHossain & @leonardolouie did you already tried to use the command @dundermave posted before??. ",
    "MannikJ": "This would create a hole in the id range, because of the new media object the auto-increment steps forward, no matter if the id is actually used or not, correct?\nNot that this would technically matter unless you're going against 4 billion media items in you application ;) It's just not very beautiful.... No this does not work if I get you correct. Obviously one media record can only reference one file out of the box. \nBut what you could possibly do is to add the HasMedia trait to a custom Media model so you can assign media to media like you assign media to users.. @freekmurze @timacdonald I would really appreciate using the storage mechanism consequently in this package. As already discussed, feature testing actions where media library is involved is currently quite complicated. It could be so easy if we could use Storage::fake($disk) instead.. ",
    "dlaynes": "Hi, I just stumbled upon this thread, and the quickest solution is to delete the previous object.\nAlso, old databases do not support JSON fields, so using the default BIGTEXT is fine, I guess, for regular websites.. ",
    "vaniyokk": "Maybe you are right at keeping things simple, but for me, default behavior is slightly annoying. It looks like all-around solution with \"one more thing forgotten\"\n```\n$media = $property->addMedia($this->tempFile)\n            ->usingName($newName)\n            ->withCustomProperties([\n                'width'  => $width,\n                'height' => $height,\n            ])\n            ->toMediaCollection('gallery');\n// Oh, really?\n$media->order_column = $image->index;\n$media->save();\n```\nvs\n```\n$property->addMedia($this->tempFile)\n            ->usingOrder($image->index)\n            ->usingName($newName)\n            ->withCustomProperties([\n                'width'  => $width,\n                'height' => $height,\n            ])\n            ->toMediaCollection('gallery');\n```\nSomeone may need to reverse order of uploaded files or custom ordering etc.\nBut, it's totally up to you! Thank's for review. =). ",
    "rluders": "@freekmurze my mySQL version is:\n\nmysql  Ver 14.14 Distrib 5.7.19, for Linux (x86_64) using  EditLine wrapper\n\nAnyway, I'll try to update it to the last version or maybe migrate to MariaDB and see what happens. Any news I'll post here again.\nThank you for you help.. @AlexVanderbist Thanks.\nOK. I'm sure that what its running is the last version of mySQL 5.7.\nAlso I recreate all the migrations (migration:fresh), just to make sure.\nmysql> describe media;\n+-------------------+------------------+------+-----+---------+----------------+\n| Field             | Type             | Null | Key | Default | Extra          |\n+-------------------+------------------+------+-----+---------+----------------+\n| id                | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| model_id          | int(10) unsigned | NO   | MUL | NULL    |                |\n| model_type        | varchar(255)     | NO   |     | NULL    |                |\n| collection_name   | varchar(255)     | NO   |     | NULL    |                |\n| name              | varchar(255)     | NO   |     | NULL    |                |\n| file_name         | varchar(255)     | NO   |     | NULL    |                |\n| mime_type         | varchar(255)     | YES  |     | NULL    |                |\n| disk              | varchar(255)     | NO   |     | NULL    |                |\n| size              | int(10) unsigned | NO   |     | NULL    |                |\n| manipulations     | json             | NO   |     | NULL    |                |\n| custom_properties | json             | NO   |     | NULL    |                |\n| order_column      | int(10) unsigned | YES  |     | NULL    |                |\n| created_at        | timestamp        | YES  |     | NULL    |                |\n| updated_at        | timestamp        | YES  |     | NULL    |                |\n| user_id           | int(10) unsigned | YES  | MUL | NULL    |                |\n+-------------------+------------------+------+-----+---------+----------------+\n15 rows in set (0.00 sec)\nYeah, I just add an extra column at the table, but if I remove it I still getting the same error.\nAnd then I just try to run the same SQL code that the error throws.\nmysql> select * from `media` where `media`.`model_id` = 301 and `media`.`model_id` is not null and `media`.`model_type` = App\\Models\\User;\nERROR: \nUnknown command '\\M'.\nERROR: \nUnknown command '\\U'.\nERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '\\Models\\User' at line 1\nBut, If I fix the SQL Query:\nmysql> select * from `media` where `media`.`model_id` = 301 and `media`.`model_id` is not null and `media`.`model_type` = \"App\\\\Models\\\\User\";\n+----+----------+-----------------+-----------------+--------------------+--------------------+------------+-------+-------+---------------+-------------------+--------------+---------------------+---------------------+---------+\n| id | model_id | model_type      | collection_name | name               | file_name          | mime_type  | disk  | size  | manipulations | custom_properties | order_column | created_at          | updated_at          | user_id |\n+----+----------+-----------------+-----------------+--------------------+--------------------+------------+-------+-------+---------------+-------------------+--------------+---------------------+---------------------+---------+\n|  1 |      301 | App\\Models\\User | avatars         | medialibraryEDODph | medialibraryEDODph | image/jpeg | media | 34565 | []            | []                |            1 | 2017-09-26 00:55:51 | 2017-09-26 00:55:51 |    NULL |\n+----+----------+-----------------+-----------------+--------------------+--------------------+------------+-------+-------+---------------+-------------------+--------------+---------------------+---------------------+---------+\n1 row in set (0.00 sec). Here is my media_model config.\n/*\n     * The class name of the media model to be used.\n     */\n    'media_model' => App\\Models\\Media::class,\nJust to be clear. If I use the default config, the error persists, and of course that the SQL query changes.\n@AlexVanderbist so I was thinking the same. The problem is something with the Laravel Eloquent, so last night I debug all down to the eloquent classes, but was unable to fix the problem.\nJust to be clear about my environment at this moment.\n\nLaravel 5.5.13\nMedialibrary 6.1.2\nPHP 7.1.9\nmySQL 5.7.19. Hey!\nForget about everything. I just found out why it's happening. Oh, and it is so stupid. ~shame on me~\n\nFor some reason, the MySQL docker image came with the charset configured by default as latin1. I just change the charset to the correct one and everything works fine.\nDude, I lost at least 3 hours with this problem. Just 'cause this dammit mysql image came with latin1 instead utf8...\nThank you guys, for your support. Oh, and I'll make a pull request later to give an extra support to the library.. @mgkimsal I have no idea, but after I change it for ut8 the problem was solved. :joy_cat: . ",
    "guicara": "Hello,\nCould you update the requirements in the README.md file to specify that MySQL >= 5.7 or MariaDB >= 10.2 is required? Not everyone has these versions.\nIt is possible to change $table->json('...'); for something else?. @AlexVanderbist Thank you for your fast reply.\nSo if I change the schema for $table->longText() the MediaLibrary will not work anymore? (just to be 100% sure because if yes, I will need to ask my host provider to upgrade the version of MySQL).. @AlexVanderbist I will let you know this week if this ends up working. Thanks ;). @alederzz Yes it works well.. ",
    "alederzz": "@guicara Hi, did you try if it works by making the change in the migration?. ",
    "mgkimsal": "@rluders  - having this same problem, with utf8 database  charset already.  Why would the charset make a difference on whether a column value was quoted or not?  . ",
    "nenads": "are we shure about this ?\nselect * from media where media.model_id = '1' and media.model_id is not null and media.model_type = 'App\\Models\\Base\\Manufacturer'\nshoudn't App\\Models\\Base\\Manufacturer be escaped ?\n. $manufacturer->getMedia();\nno result\n$manufacturer->media()->get();\nresult\nmysql column setings\nutf8mb4\nutf8mb4_unicode_ci. ",
    "z-h-z-h": "same issue on mysql 5.7.19\ntry to execute getMedia() and have no result with query\n\nselect * from media where media.model_id = '18' and media.model_id is not null and media.model_type = 'App\\Models\\Set'\n\nbut everything ok if i added \\ character and execute query by myself\n\nselect * from media where media.model_id = '18' and media.model_id is not null and media.model_type = 'App\\\\Models\\\\Set'\n\nwhy laravel don't auto escape \\ ?\nhow to fix this?. ",
    "tmikeska": "\nsame issue on mysql 5.7.19\ntry to execute getMedia() and have no result with query\n\nselect * from media where media.model_id = '18' and media.model_id is not null and media.model_type = 'App\\Models\\Set'\n\nbut everything ok if i added \\ character and execute query by myself\n\nselect * from media where media.model_id = '18' and media.model_id is not null and media.model_type = 'App\\Models\\Set'\n\nwhy laravel don't auto escape \\ ?\nhow to fix this?\n\nTry to use real collection name (media.collection_name) in getMedia('collection_name'). ",
    "brendt": "Hi @lordraz0r \nBy default, the media library will use the public disk. Configuring a dedicated media disk in config/filesystems.php is the first step, which you did.\nDid you also configure this disk to be used as default by the media library? This can be done in config/medialibrary.php, as follows.\nphp\nreturn [\n    'default_filesystem' => 'media'\n];\nIf you don't want to use this disk as default, you can also pass a second parameter when calling the toMediaCollection() method on a HasMedia model, eg.\nphp\n$model\n    ->addMedia(\"{$sourceDirectory}/{$file}\")\n    ->toMediaCollection($collectionName, 'media');\n. Hi @lordraz0r \nBased on your example, I've made a test setup on my local environment. I've set the media disk as default in config/medialibrary.php. For me this setup works as expected. \nDo you by any chance have config caching enabled on your environment? This might cause config changes not to happen instantly.\nCan you try php artisan cache:clear?\nIf this doesn't work, could you share both your config/filesystems.php and config/medialibrary.php files?. Hi @lordraz0r \nThe default filesystem parameter is not correct in your config/medialibrary.php, it should be the following.\n```\nreturn [\n    // ...\n'default_filesystem' => 'media',\n\n]\n```\nInstead of defaultFilesystem.. The PR above ( #808 ) address the first part of this issue: being able to get the parent model when deleting media.\nRegarding the second part; the empty top level directory not being deleted: this happens because only the media files themselves are deleted, and not the whole directory. One could assume that if you're specifying a custom path for media to be saved in, you might want to use that same location to store other data in.\nIt might be possible to add a check after deleting all media files related to a model: \"does the media directory contains any other files?\". This check has to be recursive. If all underlying directories are empty, it's safe to completely remove the top level directory for that media file.\nI'm not sure that this is responsibility the media library should be concerned with. It seems to me that a full cleanup of related files of a model should happen on the deleting or deleted event of the model and not from within the media library, used by that model.\n@freekmurze what's your opinion?. Another approach to solving this issue:\nCaching the media paths when saving media in the database. And making it so that on delete, the path will not be re-generated, but rather be read from the DB.\nThe current approach seemed less intrusive; but the other solution could also be possible, if needed.. First of all, the merge above was by mistake and is reverted, GitHub closed the PR though, but it can probably be re-opened. \n@Airidas10 To further address the issue, I can't seem to reproduce it.\nLet's take a look at the original implementation of the MediaObserver:\nphp\npublic function deleted(Media $media)\n{\n    app(Filesystem::class)->removeFiles($media);\n}\nWhen a media file is remove, its file is also removed. This behaviour is correct.\nThe functionality of soft-deleting doesn't happen at this level; it happens when a model using a Media item is deleted from the database. When using the SoftDeletes functionality, the deleted event isn't triggered at all.\nThat's what the it_will_not_remove_the_files_when_delete_with_softdeletes_is_used test tests for in DeleteTest, and seems to work fine.\nIf files are removed in your project, even when using the SoftDeletes trait; maybe something is happening on the project level which is triggering that deleted event. Maybe you could share some of your project specific code? The model class would be a good start.. @Airidas10 I'm looking further into it today or tomorrow.. @Airidas10 I've tested your case in a clean project, and it seems to work as expected, so at this point I'm unsure why your files are removed. Which version of the medialibrary are you using? Could you maybe start a new project and try it out like I did: create a model with soft delete enables, and an artisan command which saves a model, makes a loopup and deletes it. . @Airidas10 Could you push your test project + a README on setting up to GitHub?. I'll look at this in a few days!. @Airidas10 The SoftDeletes trait should be added on the model using the MediaModel, not on the MediaModel itself. So in your case SoftDeletes should be added on User.\nThis makes sense because the MediaModel itself can be linked to different models using a polymorphic relation.. @Airidas10 you're right, feel free to send a new PR with a testcase! . We're going to move this discussion here: https://github.com/spatie/laravel-medialibrary/issues/876. @omacesc Am I correct in assuming that if you make the conversion in your model non queued, the headers are passed correctly?\nYou  can do this by calling ->nonQueued() in registerMediaConversions:\nphp\npublic function registerMediaConversions(Media $media = null)\n{\n    $this->addMediaConversion('thumb')\n        ->nonQueued();\n}. Thanks for trying it out. We'll look further into this.. Fixed as of 7.0.2: https://github.com/spatie/laravel-medialibrary/releases/tag/7.0.2. @Airidas10 You mentioned a failing test because the deleted_at column is missing; feel free to add it in the migration file. We will also provide an entry in UPGRADING.md for people who are already using the media library, they will have to manually add a conversion.. I'll also be closing this issue as Freek already answered in https://github.com/spatie/laravel-medialibrary/pull/879. I have a fix PR open for this: https://github.com/spatie/image/pull/45. @Gummibeer thanks for the input. I suggest we move this discussion to the PR: https://github.com/spatie/image/pull/45. This bug is fixed in spatie/image ^1.5.1: https://github.com/spatie/image/releases/tag/1.5.1. More info on how we fixed it: https://github.com/spatie/image/issues/38\nIf you're using the latest medialibrary version, you can run composer up to get the bugfix.. @Omranic before looking into this, do you think it would be possible to share the image? It'll make debugging easier.. I'm going to take a look at this starting next week.\nIf I can't reproduce it using own test images, there's still a chance your image will be able to reveal a problem.. Did some testing. Turns out the original image was very helpful, as many images don't have this problem.\nThese are the file sizes of the responsive variations of the original image, in order of width.\n\nI tried out lots of other images, and can see this issue returning in PNG encoded files, with large areas of the same color. An example:\n\nThis image (its large variant) produces these filesizes:\n\nEncoding the source image as JPEG, and then running it through the media library shows these filesizes, which makes much more sense:\n\nI also tried another kind of image, with lots of the same colors in it:\n\n\nSo that's that for my first observations. Going to look into the reason now. It probably has to do something with the optimisers ran on each responsive variation.\n  . @willemvb helped reveal the underlying issue. We compared a manually downscaled image in photoshop to the generated image from the medialibrary with kaleidoscope:\n\nThe interesting part is the white background, which should not differ; but the medialibrary (actually an underlying package) will take that plain white background, and make lots of artifacts. Instead of one color, there's a subtle difference between #ffffff and #fefefe. I'll be looking into where exactly this \"optimisation\" happens later this week. It will probably be one of the image optimiser binaries, which we should give an extra parameter to.. Update: the problem happens when downscaling images if using gd. imagick seems to work just fine. I'm looking if there's a way to configure gd to fix the issue.. Addressing the underlying issue: https://github.com/thephpleague/glide/issues/218. We've merged a commit in the v7 branch to solve this, for both the gd and imagick drivers.. Are you using v7 of the media library? If so, please provide an the downscaled image with the larger size, and the original.. As I expected: there are lots of artifacts generated by the underlying glide library..\n\nThe way we solved this issue was by adding extra optimizers to the generated responsive images. This however never solved the underlying problem. I'm afraid that because of the complexity of your image, this optimizer trick isn't good enough to mitigate the real issue.\nUnfortunately, the real issue is in a package that's not our own: https://github.com/thephpleague/glide/issues/218\nYou could try and play around in your local project with optimizer settings, but I'm afraid that's the only help I can give at the moment \ud83d\ude15. They should be optimised, which was the \"fix\" for this issue: https://github.com/spatie/laravel-medialibrary/commit/d96ce0e22db7069abf335424be65ed0232c0d135. I tried this out, but don't think it's possible, because Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait::loadMedia sometimes returns Illuminate\\Support\\Collection instead of Illuminate\\Database\\Eloquent\\Collection.\nhttps://github.com/spatie/laravel-medialibrary/blob/master/src/HasMedia/HasMediaTrait.php#L458-L460\n. Did a lot of digging into this issue; turns out that Intervention (the image library used by thephpleague/glide) doesn't support animated GIFs: https://github.com/Intervention/image/issues/176\nReading from the comments it seems that there support will come in V3, but there no release date set. \nLong story short: you're able to save animated GIFs in the media library, but you're not able to perform optimisations on them. You could eg. add a check on the extension before applying conversions.\n```php\npublic function registerMediaConversions(Media $media = null)\n{\n    if ($media && $media->getExtensionAttribute() === Manipulations::FORMAT_GIF) {\n        return;\n    }\n$this\n    ->addMediaConversion('optimized')\n    ->optimize()\n    ->keepOriginalImageFormat()\n    ->apply();\n\n}\n```\nYou would have to manually check in eg. view files whether the conversion exists, or you'll get a Spatie\\MediaLibrary\\Exceptions\\InvalidConversion error.. I'm going to close this issue for now, but we'll come back to it when there's a V3 release of intervention.. We're handling this issue in https://github.com/spatie/laravel-medialibrary/issues/868. Hi @hatcham \nThanks for your enthusiasm to help us fix it! However, this was a more complex issue to write a good test for, so I went ahead and made a PR myself. If you're interested in how the issue is fixed, you can check out the PR: #973\nWe'll merge this as soon as the review is done.. Fixed in 7.0.3.\nhttps://github.com/spatie/laravel-medialibrary/releases/tag/7.0.3. Please refer to the UPGRADING guide https://github.com/spatie/laravel-medialibrary/blob/master/UPGRADING.md#from-v6-to-v7\nThe model class has been moved to the Spatie\\MediaLibrary\\Models\\Media FQCN.. @omacesc 7.0.2 fixes the issue!\nhttps://github.com/spatie/laravel-medialibrary/releases/tag/7.0.2. Hi @omacesc \nUnfortunately we will not port this to older versions. I'd recommend to update to version 7 by following the upgrading guide: https://github.com/spatie/laravel-medialibrary/blob/master/UPGRADING.md#from-v6-to-v7. It's a problem that needs solving anyway. PHP 7.0 is already in security-fixes only phase, and will be end of life before 2019: http://php.net/supported-versions.php\nIf PHP versions is the only reason holding you back, you and/or your company should take the time and upgrade to 7.1 or 7.2. The last one would be the best decision. It will take some time to do, but in the end it'll be beneficial. . @freekmurze Care to take another look?\nI figured it makes more sense to add an event after every responsive image is generated for a media item instead of an event for every variation, especially with cache clearing in mind.. @eichgi looking in the media table in the database, what collection_name are media items saved to by default?. Yes, base64 encoded uploads are a good way to handle API uploads.\nRegarding the exception: I think you'll have to do some more debugging. What kind of base64 string is created on the client? Can you manually decode it in a standalone PHP script with the same result? What's the difference between the uploaded bas64 string and the decoded/encoded version which causes the exception? See: https://github.com/spatie/laravel-medialibrary/blob/aecc201e7b43b9548556187e9aa15b42edf9dee1/src/HasMedia/HasMediaTrait.php#L169. I'm going to look at this today, though it might be possible a fix won't be released until next week, depending on how easy it is to implement this fix.. This is fixed as of 7.1.0.\nhttps://github.com/spatie/laravel-medialibrary/releases/tag/7.1.0. Hi @zhi8617 \nThanks for the question! At Spatie don't really have use cases for this. If you'd really want to save an image and its responsive variations in another format via the medialibrary, you could manually format the image before saving it as a media item.\nIf you're really interested in adding this feature, we might accept a PR if it could be done in a non-breaking way, so feel free to take the initiative.\nAt this point though, we're not going to invest time in this feature.. Hi @emredipi \nPlease use the proper code format for your errors and code snippets.\nFurthermore, could you please provide more information about what exactly you're trying to do when this error occurs? I assume you're running migrations? What version of the media library are you on? What's in your migration file?\nPlease also provide the real query that's trying to be executed on your database server. This is how you do it in MySQL, I'm not sure if it's the same for MariaDB: https://www.stitcher.io/blog/mysql-query-logging. Correct me if I'm wrong, but I guess you want to check whether a conversion is already rendered or not?. @sebastiandedeyne and I had a little discussion about this. Here are our thoughts:\nWe could add a method hasGeneratedMediaConversion($name) or hasMediaConversion($name) or something similar. This would solve a great many cases in which we now have to write a lot more conditionals in view files.\nThere's a problem with the implementation though.\nWe can do the check at runtime, meaning we'd check if the conversion files actually exist on the filesystem. The obvious problem here is S3 filesystems, as it means that a call to hasMediaConversion means a HTTP request. That's going to very inefficient.\nWe could keep a mapping of generated media files on the media item itself. This mapping means we can toggle a flag for a conversion when that conversion is generated. The problem here is backwards compatibility. We could add a new column or table, which automatically means a breaking change. Another approach could be to (mis)use the custom properties of a Media item. Seb argued about what would happen if people manually cleared custom properties in their code, which means this wouldn't work.\nEven if we decided to use custom properties, it would still require all existing models to be updated with a script, before this meta data is registered in the database. I'm not sure this would count as a \"breaking change\" though.\n@freekmurze , what's your input?. FYI the method hasGeneratedConversion is available as of v7.2.0\nBe sure to read the UPGRADING guide for existing projects: https://github.com/spatie/laravel-medialibrary/blob/master/UPGRADING.md#720. @matthewgovaere What version of the media library are you using? Are you testing this on existing media items or new ones?. Thanks for digging into this. Feel free to open an issue and even submit a fix PR if you're willing.. Please refer to the documentation to learn about how to use the media library.. I'm afraid that if you're using v5 of the medialibrary, I won't be able to help you solve this. There have been numerous bugfixes in v6 and v7, though updating means you'll have to do some manual work. You can read the upgrading guide here: https://github.com/spatie/laravel-medialibrary/blob/master/UPGRADING.md\nUnfortunately, while you can override the model class via config, there's no way to override the conversion class.. This is an interesting question. Albeit not a concern of the media library itself, I think there's value in writing up some thoughts.\nAt Spatie we do use the medialibrary in Blender (https://github.com/spatie/blender), but always in the context of a model. From what I understand, you're talking about embedding medialibrary images in a WYSIWYG or another \"text source\".\nThere's two things you'll need to keep in mind.\nFirst, a medialibrary should be connected to a model, it shouldn't live on its own. Note that it is possible to save media items without a related model to it, but this package wasn't designed in this way. If you're going this road, you're on your own \ud83d\ude04\nI too have encountered \"images on their own\", for which I made a simple Image model which a media item can connect to. Here's my implementation of this model:\n```php\nclass Image extends Model implements HasMedia\n{\n    use HasMediaTrait;\nprotected $guarded = [];\n\npublic static function boot()\n{\n    self::created(function (Image $image) {\n        $image->addMedia(resource_path($image->path))\n            ->withResponsiveImages()\n            ->preservingOriginal()\n            ->toMediaCollection();\n    });\n}\n\npublic static function findByPath(string $path): ?Image\n{\n    return self::wherePath($path)->first();\n}\n\npublic static function createWithPath(string $path): Image\n{\n    return self::create([\n        'path' => self::normalizePath($path),\n    ]);\n}\n\npublic function scopeWherePath(Builder $builder, string $path): Builder\n{\n    return $builder->where('path', self::normalizePath($path));\n}\n\nprivate static function normalizePath(string $path): string\n{\n    $resourcePath = 'assets/images';\n\n    $fullResourcePath = \"resources/{$resourcePath}\";\n\n    $basePath = resource_path($resourcePath);\n\n    return\n        rtrim($resourcePath, '/')\n        . '/'\n        . ltrim(str_replace([$basePath, $fullResourcePath, $resourcePath], '', $path), '/');\n}\n\n}\n```\nAs you can see, I've added some helper methods so that I can use the path itself as the identifier. So to answer this question:\n\nWould you simply put the main image + an identifier ID as a reference when you save the content\n\nI would probably use the path as the ID, and load the Image model from there. This means you'll have to parse your WYSIWYG content somewhere, I'd do this on save, and keep a rendered version and editor version. Another approach would be to introduce some kind of \"shortcode tags\" as known in WordPress. How exactly you'd parse the content is up to you \ud83d\ude42\nSecond, the question about sizes. I won't go into much detail about how the sizes spec was designed, but it's important to know that you cannot solve this problem in a reusable way. There's no way around it: you need to configure sizes for every image, and what will be in that sizes attribute will depend on where the image will be shown on your page. A full-width hero image will have different sizes than an overview thumbnail image. You can read more about the why and how of sizes in the media library in this issue: https://github.com/spatie/laravel-medialibrary/issues/810\nSo what you're doing, determining the sizes with JS is an option, though to me personally it doesn't feel like the best one. From my experience - and certainly in a CMS setting - you should configure a few different size-presets. Eg. \"hero\", \"thumbnail\", \"article-aside\", \"article-full\" etc. Each preset has their own sizes. When uploading an image, you should configure select what kind of preset you want to use for this image, and save it in either the Image model I mentioned earlier, or in the Media model itself, as it has custom properties support.\nThere's a lot more to say about this, but I'm going to close this issue for now. Feel free to still respond, but it's not a \"real issue\" concerning this package.. > If I\u2019m not wrong, this approach makes it unnecessary to deal with different size presets (except thumbnails which require a square format - I use a separate media conversion for them).\nIt certainly is a valid approach. There's a downside with the JS solution though. The real image is loaded slightly later than when it could be loaded if you knew the sizes beforehand.\nIf the correct srcset and sizes are defined in the HTML, that is: the HTML that's downloaded from the server; almost every browser can pre-load the correct image way earlier. Loading the correct image is based on both srcset and sizes attributes and the current viewport width. If the browser knows both, it can request the image from the server as soon as the HTML is downloaded and pre-parsed.\nOn the other hand, if you use JS to dynamically calculate the sizes of the image, you'll have to wait for a few things:\n\nDOM and CSS to be parsed, which is needed to know the width of the image\nJS to be parsed and executed\n\nThis pushes back the load time of the image quiet far. It will of course show the blurred preset immediately, but on devices with a slower CPU, there might be a noticeable delay. \nNow what with client-side cached images? The same flash can happen with your approach, because even though the image doesn't need downloading, the browser still has to parse DOM and CSS, and on top of that execute some JS code for every image.\nIt's a detail of course, and chances are your users won't be bothered by it. But keep in mind that this little improvement is exactly why the sizes attribute was introduced. There's the downside of more manual configuration, but you'll have the benefit of images appearing a little faster on your screen in a lot of cases.. Cool! It's a nice example on how to use the medialibrary in a CMS context \ud83d\udc4d. Thanks. It's fixed!. Could you share the error you're getting? I've got GD bundled in my compiled PHP installation and have no easy way to disable it. I'm sure Imagick is used to render images, but maybe GD is used somewhere behind the scenes still, causing the error. If you can provide a stack trace, it might clarify where the error is happening.. Thanks for the input! I was able to pin this problem down. It was in spatie/image, when the width or height of an image was requested.\nThis commit fixed it: https://github.com/spatie/image/commit/9b7a027b618943c5fd6136285f0ead28c4f75c1e\nAnd it's tagged here: https://github.com/spatie/image/releases/tag/1.4.2\nYou should be able to just run composer update if you're on the newest medialibrary version, and spatie/image should update automatically. . Is it a different error?. Hi @taliptako \nThis should now be fixed everywhere with 7.1.5 (https://github.com/spatie/laravel-medialibrary/releases/tag/7.1.5).. Hi @Numline1 \nThe conversion name change happened in 7.0: \n\nall converted files should now start with the name of the original file.\n\nhttps://github.com/spatie/laravel-medialibrary/blob/master/UPGRADING.md#from-v6-to-v7\n. Unfortunately, this is a know issue: https://github.com/spatie/laravel-medialibrary/issues/887. The underlying issue is here: https://github.com/spatie/image/issues/38\nI'd recommend reading through that thread to know what's going on. I'll try to look at a fix this week, though we first need a consensus on how to fix it.. You can use PHP's pathinfo function: http://php.net/manual/en/function.pathinfo.php\nphp\npathinfo($media->getFirstMediaPath(), PATHINFO_DIRNAME);. PHP doesn't allow the following:\n```php\nclass A \n{\n    public function test(A $a) {}\n}\nclass B extends A \n{\n    public function test(B $b) {}\n}\n$b = new B();\n```\nAllowing subclasses as typehints would break LSP. There's a lot of theory on the why and how, if you're interested you should lookup \"variance and contra variance\".\nAnyways the fix here is to still use Media as type hint, and not your own implementation, you will be able to use your implementation, but you're not able to type hint it.\nphp\npublic function registerMediaConversions(Media $media = null) {}. PHP doesn't allow the following:\n```php\nclass A \n{\n    public function test(A $a) {}\n}\nclass B extends A \n{\n    public function test(B $b) {}\n}\n$b = new B();\n```\nAllowing subclasses as typehints would break LSP. There's a lot of theory on the why and how, if you're interested you should lookup \"variance and contra variance\".\nAnyways the fix here is to still use the spatie Media class as type hint, and not your own implementation, you will be able to use your implementation, but you're not able to type hint it.\n```php\nuse Spatie\\MediaLibrary\\Media;\n// ...\npublic function getPath(Media $media) : string { ... }\n```. Have you correctly set your custom media model in the config? https://github.com/spatie/laravel-medialibrary/blob/master/config/medialibrary.php#L26. I've renamed the method. What about the question about what to do when a conversion file is removed?. It is!. Hi @SamuelNitsche \nAm I correct in assuming you want to save your media files in a sub-folder of the model they are attached to?\nSo instead of\nmedia/\n  1/\n    file.jpg\n    conversions/\n      small.jpg\n      medium.jpg\n      big.jpg\n  2/\n    file.jpg\n    conversions/\n      small.jpg\n      medium.jpg\n      big.jpg\nYou want\nmedia/\n  model_id_1/\n    1/\n      file.jpg\n      conversions/\n        small.jpg\n        medium.jpg\n        big.jpg\n  model_id_2/\n    2/\n      file.jpg\n      conversions/\n        small.jpg\n        medium.jpg\n        big.jpg\nIf that is so, there's a bug in your implementation:\nphp\npublic function getPath(Media $media) : string\n{\n    return $media->model_id.'/';\n}\nYou should return the path for the media item to save, not the folder where all media items for that model should be stored. Like so.\nphp\npublic function getPath(Media $media) : string\n{\n    return $media->model_id . '/' . $media->id . '/';\n}. Hi @Pixelairport \nBesides changing the migration, you also have to use your own model: https://docs.spatie.be/laravel-medialibrary/v7/advanced-usage/using-your-own-model. Hi @cstriuli \n\nI've set up my app to listen to the \"Spatie\\MediaLibrary\\Jobs\\PerformConversions\" event\n\nAre you listening to a job? Shouldn't you listen to Spatie\\MediaLibrary\\Events\\ConversionHasBeenCompleted ?. @mradamwood are you sure that there's no other reason for your custom properties not te be moved in your code? There's a test in \\Spatie\\MediaLibrary\\Tests\\Feature\\Models\\Media\\CopyTest which tests for customer properties to be copied to, and it works, even with the old implementation.. @mradamwood That's right, but the actual copying still is the same:\nphp\n$movedMedia = $media->copy($anotherModel, 'images');\nAre you able to make a failing test with the latest version of the media library? Because it seems that I'm not able to reproduce it. . Right, got it. I'm working on a fix :). This is fixed as of 7.3.1: https://github.com/spatie/laravel-medialibrary/releases/tag/7.3.1. This bug will be fixed in v7.3.2, give it half an hour for Travis to finish and I'll tag the release.. Released: https://github.com/spatie/laravel-medialibrary/releases/tag/7.3.2. Released as of 7.3.3: https://github.com/spatie/laravel-medialibrary/releases/tag/7.3.3. Don't worry about StyleCI, I'll merge the fixes once your PR is merged. I'm going to further look at and merge this tomorrow.. Looks good! I'm going to merge the StyleCI and cleanup the tests after merging your PR, thanks for the help!. Couldn't we use realpath? \nhttp://php.net/manual/en/function.realpath.php. I think both: the tests should also work with realpath, instead of the manual use of DIRECTORY_SEPARATOR you've got in the PR. \nBut changing the tests isn't enough, the BasePathGenerator should also use realpath.\nEdit: I'm of course assuming other things also break on Windows because of wrong path separators, and not just the tests.. Thanks!. Replacing '' by 'default' in loadMedia doesn't seem to be the solution. 'default' actually is a valid collection name. So it's not that 'default' means \"all collections\". I'm looking further into this to find a proper solution. . To summarise: @dfoxxdfoxx expects all media to be cleared when calling ->clearMediaCollection(), which is the behaviour described in the docs.\nBecause the collection name defaults to 'default' when calling clearMediaCollection, not all media items are cleared, but only those in the default collection. \nI can see a few ways to fix this:\n\nAllow for null to be passed in clearMediaCollection and use null as the default.\nChange the default from 'default' to '', which will result in all media items to be cleared.\n\nBoth solutions are a breaking change.\nWe could update the docs and say that you should manually pass '' to clear all media items, and tag this issue to revisit for a later version.\n@freekmurze what's your opinion?. Hi ~~@davidianbonner~~ @dfoxxdfoxx \nFreek and I discussed this in the office today. There was some confusion about what you exactly wanted to do.\nThe clearMediaCollection method is used to clear one collection, and defaults to default.\nIf you want to remove all media of a model, regardless of a collection, you can simply use eloquent: $model->media->each->delete().. Woops.. my bad! . ~~We're going to solve this by throwing a specific exception when a conversion has failed. This exception will contain the Media model. Handling the exception should be done in your project code, this means you'll probably want to add functionality to the ExceptionHandler~~\nA quick tip regarding memory issues: are you using gd or imagick as the image driver? imagick has a significant smaller memory footprint. Nevertheless, we'll add this exception functionality. . Scratch the above, it's a fatal error that's uncatchable. I'm afraid the only solution will be in monitoring the job status. If it fails because of a memory exception, your application should manually handle the cleanup based on the failed job logs (in your database).\nOne more tip: there's an event called Spatie\\MediaLibrary\\Events\\ConversionWillStart which you could hook into, to maybe prevent the generation from starting altogether based on your own logic. Maybe this can be of help.. And another tip I just thought of, there's a method hasGeneratedConversion as of 7.3.0 on the Media model. You can use this to verify whether the conversion actually has been generated or not. Beware that this feature only works for media items generated after 7.3.0, please refer to the UPGRADING guide for more information: https://github.com/spatie/laravel-medialibrary/blob/master/UPGRADING.md#730. Best of luck!. Thanks for the heads-up, I've made a bugfix. I'll tag a release once Travis is done.. This is fixed as of 7.3.4: https://github.com/spatie/laravel-medialibrary/releases/tag/7.3.4. @mortenscheel I suppose you were able to solve this? If not, feel free to comment, but I'm closing the issue.\nFYI: if it is the case that it's not fixed yet, you're free to submit a PR if it's fixable here.. For reference, from the old issue:\n\nI want to where logic on query builder \"retrieve models where hasMedia\"? It can be also improved by providing media collection name for specific hasMedia checks.. So, from what I understand, you want a scope in the HasMedia trait so that you can quickly find models with or without media?\n\nI don't mind the addition. Can't think of any concrete use cases myself, but I can imagine others have some good uses for it.\nRegarding the names, as scopes most of the time add where statements, I tend to prefix them with where when possible. So something like scopeWhereHasMedia, although that might still be too confusing with the HasMedia trait. . Hi @Elhebert can you share the generated HTML with the added nonce on the image tag?. We're mainly using that script to allow for async image loading beneath the fold, though it would also probably solve your issue, as you're not relying on inline scripts anymore.\nI did some digging and found this issue on the W3C repo. From what's written there, nonces are not supposed to work with inline event handlers, just with scripts: https://github.com/w3c/webappsec-csp/issues/13\nSo for now, you'll probably want to use the script we also use on the Spatie website, I'm going to discuss this internal, see if we can change the responsive image implementation. I'll be closing this issue for now, but feel free to keep commenting.. @UmarAbdullahi the documentation linked by @Okipa should help you figure things out. One key aspect of the media library is that it can be coupled to every model, but that also means you cannot link one media file to a fixed field in those models. You'll always have to use the helper methods provided by the HasMediaTrait. More info can be found here: https://docs.spatie.be/laravel-medialibrary/v7/basic-usage/retrieving-media. This probably means the exception isn't thrown, or it is thrown in a queue. Media files can be generated in a queue, so the error might not show up in your browser, depending on how you've configured your project.. @jorenvh Could you by any chance share your medialibrary.php config file?. Hi @jwtea \nTechnically, it's already possible to change this behaviour on a model basis, it's just not documented. Conversions are created in the HasMediaTrait, in the addMediaConversion function (https://github.com/spatie/laravel-medialibrary/blob/master/src/HasMedia/HasMediaTrait.php#L412).\nYou could extend \\Spatie\\MediaLibrary\\Conversion\\Conversion, and override the addMediaConversion function in the model you're want this custom conversion to be used.\nNote that this is no tested behaviour, but it should work from glancing at the code. I don't think we want to make conversions configurable, unless there's a good reason to do so. You say you don't want hyphens (-) in the file names, but the media library is designed in such a way that you should never worry about files themselves. So I'm interested to hear what's the reason behind your request.\nI'm closing the issue for now, as we don't have plans to change this behaviour, but feel free to comment back here if you have any more thoughts or remarks.. Hi @jwtea \nDo you mean Safari on IOS? srcset is supported on all browsers except IE and Opera Mini: https://caniuse.com/#search=srcset\nsrcset allows the browser to figure out which image to download, and it takes pixel density into account. This makes @2x etc. images obsolete. The media library will generate a srcset for you when you're using ->withResponsiveImages() when adding media. You can read about it here: https://docs.spatie.be/laravel-medialibrary/v7/responsive-images/getting-started-with-responsive-images#getting-started-with-responsive-images\nAlso be sure to read up on the responsive images spec here: https://responsiveimages.org/ it's a very cool feature, and I'd encourage everyone to use it!. Right, got it! Thanks for the clarification \ud83d\udc4c. That will be a difficult issue to debug for us. My recommendation is that you debug on a local project.\nFirst make sure you can reliably reproduce the issue; than start debugging here: https://github.com/spatie/laravel-medialibrary/blob/master/src/ImageGenerators/FileTypes/Video.php#L26\nWe're using the PHP-FFMpeg package to generate video thumbnails which is not included by default. You should make sure the correct dependencies are installed on your new system. You can read more about it here: https://docs.spatie.be/laravel-medialibrary/v7/converting-other-file-types/using-image-generators#video\nI'm closing this issue, as I don't consider it an issue of the medialibrary. But feel free to ask more questions here if needed. Good luck.. Hi @mokhosh \nI'd start from where the error occurs: the system is unable to copy a temporary file: D:\\dev\\storage\\medialibrary/temp\\O2p5uv13ju1HAMUt2Ac2Vrcm2uIrZDKE/1ilQVo9RVkbhWqRx.jpg\nIt looks like the path uses both forward and backward slashes. I'd add a str_replace(\"\\/\", \"\\\\\", $path) right before that file is saved (the stack trace should show you where it happens). This code will be in the vendor folder, but obviously it's for debugging only.. Hi @divdax \nYou'll want to use an event hook for this. Take a look at the documentation, which lists all available events. You can hook into these events with default Laravel code. My guess is that you want to hook into MediaHasBeenAdded.\nIf you don't mind me asking, what exactly do you want to use this for? As one media item has multiple files, depending on the conversions and responsive images; you cannot simply save one dimension as a custom property. Furthermore, in case of responsive images; you should never be concerned about the dimensions, as the browser will figure out which image to load using srcset and sizes.\nIf you just want to save the original image dimension, you can by hooking using events.. Hi @melokki \nYou'll have to register your custom URL generator in your medialibrary.php config file. Here's an example: https://github.com/spatie/laravel-medialibrary/blob/master/config/medialibrary.php#L77\nObviously, the class Spatie\\MediaLibrary\\UrlGenerator\\GcsUrlGenerator won't exist, you'll have to use \\App\\Utils\\ GcsUrlGenerator, the fully qualified class name.\nPlease also refer to the documentation to know how to create custom url generators.: https://docs.spatie.be/laravel-medialibrary/v7/advanced-usage/generating-custom-urls#generating-custom-urls. At the moment, this is not possible. The media observer is registered in the service provider. You're free to send a PR to make this configurable in the config, provided that it's backwards compatible and tested.. Media conversions are a big part of the package, there isn't anything in place to simply disable them. I'm afraid that if proc_open will be a requirement for the package to work correctly. My suggestion would be to look at a cheap DigitalOcean droplet to run your project on.. I prefer to keep tests as specific as possible to avoid unforeseen future side-effects. But I've removed the [] because it was unnecessary. . This test now fails: https://travis-ci.org/spatie/laravel-medialibrary/jobs/356919799. Are we sure $mediaExt will always be an array with at least two elements? Otherwise I'd add an isset-like check and a proper fallback.. I can imagine there could be a corrupted image which mime type doesn't contain the slash? I would personally handle it like so.\n```php\n$extension = $mediaExt[1] ?? null;\nif (! $extension) {\n    // ...\n}\n``. That's not true, because$generatedConversions[$conversionName]can containtrueorfalse`.\nSo if $generatedConversions[$conversionName] is set, it will return either true or false, if it's not set the fallback is false.. Done.. Done.. ",
    "lordraz0r": "I did configure it to use the media disk yeah. What I find very strange is when uploading say for instance from the site it seems to work fine but when the origin file exists on the server it seems to be doing this.. This code is my implementation where it happens.\n`$path = public_path() . '/tmp/users/' . $user->id . '/';\n        if (!\\File::exists($path)) {\n            \\File::makeDirectory($path, $mode = 0777, true, true);\n        }\n\n        $manager = new ImageManager();\n        $new_image = $manager->make($file)->fit(300, 300)->save($path . $file->getClientOriginalName());\n\n        $user->addMedia($new_image->basePath())->toMediaCollection('avatar');`. I infact did try that again now just to make sure and somehow it is still\n\ndoing it. 'defaultFilesystem' => 'media',is also set.\nOn Fri, Oct 6, 2017 at 9:52 AM, Brent Roose notifications@github.com\nwrote:\n\nHi @lordraz0r https://github.com/lordraz0r\nBased on your example, I've made a test setup on my local environment.\nI've set the media disk as default in config/medialibrary.php. For me\nthis setup works as expected.\nDo you by any chance have config caching enabled on your environment? This\nmight cause config changes not to happen instantly.\nCan you try php artisan cache:clear?\nIf this doesn't work, could you share both your config/filesystems.php\nand config/medialibrary.php files?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/776#issuecomment-334684711,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AI4mRcB5Urbd83KRIxJhyQniHVPdxN73ks5spdwigaJpZM4PvFtX\n.\n. medialibrary.php\n\n`<?php\nreturn [\n/*\n * The filesystems on which to store added files and derived images by default. Choose\n * one or more of the filesystems you configured in app/config/filesystems.php\n */\n'defaultFilesystem' => 'media',\n\n/*\n * The maximum file size of an item in bytes. Adding a file\n * that is larger will result in an exception.\n */\n'max_file_size' => 1024 * 1024 * 10,\n\n/*\n * This queue will be used to generate derived images.\n * Leave empty to use the default queue.\n */\n'queue_name' => '',\n\n/*\n * The class name of the media model to be used.\n */\n'media_model' => App\\Models\\MediaFile::class,\n\n/*\n * The engine that will perform the image conversions.\n * Should be either `gd` or `imagick`\n */\n'image_driver' => 'gd',\n\n/*\n * When urls to files get generated this class will be called. Leave empty\n * if your files are stored locally above the site root or on s3.\n */\n'custom_url_generator_class' => null,\n\n/*\n * The class that contains the strategy for determining a media file's path.\n */\n'custom_path_generator_class' => null,\n\n's3' => [\n    /*\n     * The domain that should be prepended when generating urls.\n     */\n    'domain' => 'https://xxxxxxx.s3.amazonaws.com',\n],\n\n'remote' => [\n    /*\n     * Any extra headers that should be included when uploading media to\n     * a remote disk. Even though supported headers may vary between\n     * different drivers, a sensible default has been provided.\n     *\n     * Supported by S3: CacheControl, Expires, StorageClass,\n     * ServerSideEncryption, Metadata, ACL, ContentEncoding\n     */\n    'extra_headers' => [\n        'CacheControl' => 'max-age=604800',\n    ],\n],\n\n/*\n * These generators will be used to created conversion of media files.\n */\n'image_generators' => [\n    Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Image::class,\n    Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Pdf::class,\n    Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Svg::class,\n    Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Video::class,\n],\n\n/*\n * FFMPEG & FFProbe binaries path, only used if you try to generate video\n * thumbnails and have installed the php-ffmpeg/php-ffmpeg composer\n * dependency.\n */\n'ffmpeg_binaries' => '/usr/bin/ffmpeg',\n'ffprobe_binaries' => '/usr/bin/ffprobe',\n\n];\n`\nand filesystems.php\n`<?php\nreturn [\n/*\n|--------------------------------------------------------------------------\n| Default Filesystem Disk\n|--------------------------------------------------------------------------\n|\n| Here you may specify the default filesystem disk that should be used\n| by the framework. A \"local\" driver, as well as a variety of cloud\n| based drivers are available for your choosing. Just store away!\n|\n| Supported: \"local\", \"ftp\", \"s3\", \"rackspace\"\n|\n*/\n\n'default' => 'local',\n\n/*\n|--------------------------------------------------------------------------\n| Default Cloud Filesystem Disk\n|--------------------------------------------------------------------------\n|\n| Many applications store files both locally and in the cloud. For this\n| reason, you may specify a default \"cloud\" driver here. This driver\n| will be bound as the Cloud disk implementation in the container.\n|\n*/\n\n'cloud' => 's3',\n\n/*\n|--------------------------------------------------------------------------\n| Filesystem Disks\n|--------------------------------------------------------------------------\n|\n| Here you may configure as many filesystem \"disks\" as you wish, and you\n| may even configure multiple disks of the same driver. Defaults have\n| been setup for each driver as an example of the required options.\n|\n*/\n\n'disks' => [\n\n    'local' => [\n        'driver' => 'local',\n        'root' => storage_path('app'),\n    ],\n\n    'public' => [\n        'driver' => 'local',\n        'root' => public_path(),\n        'visibility' => 'public',\n    ],\n\n    's3' => [\n        'driver' => 's3',\n        'key' => 'your-key',\n        'secret' => 'your-secret',\n        'region' => 'your-region',\n        'bucket' => 'your-bucket',\n\n\n\n    ],\n    'media' => [\n        'driver' => 'local',\n        'root'   => public_path('media'),\n    ],\n]\n\n];\n`. Haha thanks a lot. I was probably being an idiot.\nOn Fri, Oct 6, 2017 at 10:08 AM, Brent Roose notifications@github.com\nwrote:\n\nHi @lordraz0r https://github.com/lordraz0r\nThe default filesystem parameter is not correct in your\nconfig/medialibrary.php, it should be the following.\n[\n    // ...\n'default_filesystem' => 'media',\n\n]\nInstead of defaultFilesystem\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/776#issuecomment-334687998,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AI4mRTiAdhcI4AXSWvlbq9VFxfD-CyRdks5spd_3gaJpZM4PvFtX\n.\n. \n",
    "BrentRobert": "I can't reproduce this bug.\nWhen using the following code it deletes the tmp files:\n$user = User::find(1);\n$user->addMediaFromUrl('http://ichef.bbci.co.uk/images/ic/640x360/p04nfr07.jpg')->toMediaCollection('images');\nWhen using the following, it doesn't (as it should)\n```\n$user = User::find(1);\n$user->addMediaFromUrl('http://ichef.bbci.co.uk/images/ic/640x360/p04nfr07.jpg')->preservingOriginal()->toMediaCollection('images');\n```. ",
    "matthewscalf": "You are totally right. I did not notice I had the preservingOriginal set at the end of the chain :sob: I guess that is what happens when you work too late. Thanks!. Nevermind, I found the clean command, doh.. ",
    "bmichotte": "Ok, make sense.\nWwhat about adding a new method then ?\nphp\n$item->addMediaFromRequest('image')\n     ->sanitizingFileName(function($fileName) {\n         return strtolower(str_replace(['#', '/', '\\\\', ' '], '-', $fileName));\n     })\n     ->toMediaCollection();. Sure, I will as soon as I'll PR another feature here ;). Sure, but I'm not sure on which page of the doc I should add it. ",
    "paulprok": "Great, thanks!. $model->media\n$model->media->keyBy('collection_name')\nmaybe. In this way there are not available spatie methods like getUrl and conversions. ",
    "eduardduta": "hi, it has\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia;\nclass Topics extends Model\n{\n    use LogsActivity;\n    use SoftDeletes;\n    use HasMediaTrait;\nI used in other model too. there i saved from input it worked like a cham. but when i try from base64 or from url i get same error. nothing. i use last version of laravel.\ni use $topicObj->addMediaFromBase64('base64string')->toMediaCollection('topic-images'); and i get\n[Symfony\\Component\\Debug\\Exception\\FatalThrowableError]                                                                                                                                                                                                         \n  Type error: Argument 1 passed to Spatie\\MediaLibrary\\FileAdder\\FileAdder::processMediaItem() must be an instance of Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia, instance of App\\Models\\Topics given, called in vendor/spatie/la\n  ravel-medialibrary/src/FileAdder/FileAdder.php on line 329       . this?\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia;\nclass Topics extends Model\n{\nuse LogsActivity;\nuse SoftDeletes;\nuse HasMediaTrait;\n. crap,\nReally sory. I sow that now. Thank you for help.. ",
    "davidianbonner": "Hopefully this does what you're looking for.\nphp\nartisan medialibrary:regenerate --only-missing. I'll create a separate branch for an only option and have a look. Shouldn't be a problem to implement I don't think.\nAn only-changed option would be nice, needs a bit of thought as to how to implement it with little overhead.. No worries @freekmurze.\n@vesper8 the only-missing option can be used along with only which accepts an one or multiple conversion names.. Thanks @vesper8. Submitted a PR just before this that implements only the specified conversions.\nhttps://github.com/davidianbonner/laravel-medialibrary/blob/f5fc5e3cb794eeafdb367c22624e7bc3599b9c63/src/FileManipulator.php#L30. The changes were minimal for this so using the same branch:\nThe only command can be used alongside only-missing.\nartisan medialibrary:regenerate --only-missing\nartisan medialibrary:regenerate --only=thumb --only=foo\nartisan medialibrary:regenerate --only=thumb --only-missing\n. No problem @freekmurze.\nDocs updated.. @dfoxxdfoxx I belive this was meant for you.... ",
    "oad-dwarf": "It happened with a 616696 bytes png file.. @tobz-nz No I still have my patch in place. Haven't tested since then if the problem is still there. Perhaps I'll check it again when we switch to Alpine 3.8 and PHP 7.2. ",
    "MartinJac": "@freekmurze unsure about @oad-dwarf, but I've been able to replicate this when using s3.\nChanging from fread() to fgets() resolved the issue (Windows).. ",
    "tobz-nz": "@oad-dwarf Did you figure this one out? I'm getting the same issue. Also Alpine-Linux & S3. (in a K8 setup)\nSeems to be all png's.  \njpg's are also failing for me but with no error. The POST request just sort of stops (no response). Its weird.. I think its an Alpine issue. We swapped to an Ubuntu image(no other changes) and all working perfectly now.. ",
    "simioluwatomi": "I have been getting this error on all PNG images when uploading to s3. Very weird. Uploads are being performed with addMediaFromBase64. And yes,  changing from fread() to fgets() resolves it for me.\nEnvironment: Windows\nPhp version: Php 7.1\nServer: Nginx. I think this is a Windows issue. My workaround is to check the file extension of the file before performing operations because I know that preservingOriginal() is not something you want to do in production.\nif ('tmp' !== pathinfo($request->file('image'), PATHINFO_EXTENSION)) {\n            $user->addMediaFromRequest('image')\n                ->toMediaCollection('images');\n        } else {\n            $user->addMediaFromRequest('image')\n                ->preservingOriginal()\n                ->toMediaCollection('images');\n        }. ",
    "Aryan1": "Having same issue, the original image is uploaded successfully but conversions simply fails for all png files when using s3 driver, same error as mentioned above.\non Windows + PHP 7.2.8. ",
    "ShinHyungJune": "Having same issue Too T.T\nwhen using s3 driver, same error as mentioned above.\non Windows + PHP 7.1.2. ",
    "RudySIMPLON": "thank's it work !!. ",
    "ModestasV": "Right, while doing tests I've found a case where it fails - in tests it's passing an array of the data instead of the instace. \nFailing code:\n$mediaArray = $this->testModel->getMedia('collection');\nNon failing code:\n$mediaArray = $this->testModel->getMedia('collection')->toArray();\nSo, the next question - do you want a PR with an ability to accept model instances, instead of just array? :). Yap, that is what I've encountered - array of model instances were not working out for me :) Will make a PR for you ;). ",
    "Amaarys": "I want to install consoletvs/charts on my Laravel project. When try it, These issues was generated.\nHow can I do  to install consoletvs/charts?. ",
    "driesvints": "@Amaarys try here: https://github.com/ConsoleTVs/Charts. ",
    "adriaanvermeire": "The records are being added to the Media table and the output of $myModel->media gives back the correct data. Using $myModel->getMedia() still results in an empty collection.. Also is there any way to limit the amount of files associated with a model intance? \nSay you can only have one avatar for a user. If the user then changes his avatar, the older picture gets deleted.. Thanks! That worked! . ",
    "sunnyjayjay": "I have exactly the same problem. I now see in fact that this is already solved earlier:\nhttps://github.com/spatie/laravel-medialibrary/issues/241. ",
    "jafar-albadarneh": "you either add 'ACL' => 'public-read' to your config file, or Adjust the Bucket Policy it self having from s3 console manager.\nSomething similar to this: \n{\n    \"Version\": \"2012-10-17\",\n    \"Id\": \"PolicyId\",\n    \"Statement\": [\n        {\n            \"Sid\": \"SomeValidId\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"*\"\n            },\n            \"Action\": [\n                \"s3:GetObject\",\n                \"s3:GetObjectAcl\"\n            ],\n            \"Resource\": \"arn:aws:s3:::bucketName/*\"\n        }\n    ]\n}. ",
    "pjnorberg": "Sorry, I found the issue, I was using the same key for two different addMediaConversions.. ",
    "lalitvj": "Hey Freek,\nAdded getTemporaryUrl.\nCheck out with my first pull request for Spatie. Need feedbacks. Cool, will update tonight. . ",
    "shanginn": "sorry, forgot to read contributing guide. ",
    "introwit": "@RudySIMPLON Hey :) nope, this shouldn't happen. There are appropriate tests in the package. Also, I tested it myself in tinker and it works as it should :) \n```\n\n\n\nApp\\User::first()->getMedia('avatar')[0]->getUrl();\n=> \"/media/36/21112293.jpeg\"\n``. @codeitlikemiley you can directly do$order->addMediaFromRequest('file'). That's a different functionclearMediaCollectionExcept &clearMediaCollectionExceptMedia . The other tests and tests for other collections break since there is no property calledsingleFile` defined.. Didn't understand this, can you explain a bit more on this? . \n\n\n",
    "Airidas10": "I pushed the changes you asked for :)\nRegarding tests, I am not sure what tests need to be added, as soft deletes already had some tests in the DeleteTest suite (it_will_not_remove_the_files_when_delete_with_softdeletes_is_used and it_will_remove_the_files_when_forcedelete_with_softdeletes_is_used).\nWhat's really confusing for me, is how these tests were passing, even when soft deletes were deleting files. I looked into those tests, but could not figure out why they weren't catching that. Is it because it happens in the Observer?\nAny ideas? :)\nThanks!. Any updates on this issue?. Thank you for the response! And sorry for not getting back to you quicker, finding myself rather busy these days :)\nIn my case MediaObserver's deleted was definitely being triggered - I had a Log statement inside. Hence this particular pull request :)  \nWhen I encountered this issue in my project, I started a new Homestead project, just to test this functionality. I created a custom Model named MediaModel.php:\n```\n<?php\nnamespace App;\nuse Spatie\\MediaLibrary\\Media as BaseMedia;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia;\nuse Illuminate\\Database\\Eloquent\\SoftDeletes;\nclass MediaModel extends BaseMedia implements HasMedia\n{\n    use HasMediaTrait;\n    use SoftDeletes;\nprotected $table = 'media';\nprotected $dates = ['deleted_at'];\n\n}\n```\nThen, in my FileController, after AJAX request comes in and after I do the validation, I do:\n$file = MediaModel::find($request->file_id);\nif($file){\n    $file->delete();\n    // Further AJAX code to return response omitted...\n}\nI expect the file to stay in my storage folder, but it's gone... The deleted_at timestamp is correctly inserted in the database, proving that it was indeed a soft delete. If I do forceDelete, the behavior is as expected (file is gone, the row in the DB is gone too).\nThe expected behavior with soft deletes is achieved, if I use the code proposed in this pull request.\nThis is a great package and I like using it for file management, so I'd like to have this issue fixed, whether it's the fault with the package or whether I am just using it wrong. Please let me know, if there's any other way I could help! :)\nAiridas\n. Any more info or should I resubmit this PR to be reopened? :). @brendt Tried that, same results...\nThat's a step by step on how I tested it using medialibrary 6.6.3.:\nI created a fresh Laravel Homestead project;\nPulled in the package, published a config and a migration, added $table->softDeletes() and migrated;\nMade a MediaModel model. (code is Identical to the one I posted above);\nUpdated the config file to let it know that I am using a custom model;\nOpened a User.php model and added\n```\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia; \nuse App\\MediaModel;\nclass User extends Authenticatable implements HasMedia\n{\n    use HasMediaTrait;\n[REST EMITTED]\n\n```\nI also manually created a user (INSERT INTO USERS...;\nThen I made this artisan command and ran it: \n```\npublic function handle()\n    {\n        $user = User::first();\n        $user->addMediaFromUrl('https://www.planwallpaper.com/static/images/desktop-year-of-the-tiger-images-wallpaper.jpg')->toMediaCollection('images');\n    $file = MediaModel::first();\n    $file->delete();\n}\n\n```\nOnce again, if I commented out the delete part, I saw the file under /storage/app/public and I saw the database row in the media table.\nIf I did ->delete(), the Database row has deleted_at with a timestamp, suggesting it was soft deleted. The file was gone.\nIf I did ->forceDelete(), both the file and the DB entry were gone (as expected).\nBy the, way, I added a log statement in MediaObserver:\npublic function deleted(Media $media)\n    {\n        \\Log::debug(\"Deleted triggered\");\n        app(Filesystem::class)->removeFiles($media);\n    }\nAnd Every time I was doing a delete (whether soft or hard), \"Deleted triggered\" was in my Log :)\n. @brendt There you go:\nhttps://github.com/Airidas10/FileTest\n:). @brendt Exactly what @mwingren said! I looked again at the tests you have and seems to me like you delete the model (let's say a user) and then the files, associated to that user, stay.\nWhat I want to do is not touch that user at all. I just want to be able to soft delete a file, and have it stay on the system, so I can hide it from some users, but display to others. \nCan't find a way to do that at the moment... \nIf you need a test for that particular use case, I would be happy to make one :). @brendt I am trying to add some tests for the proposed solution. \nOne of the tests I made looks like this:\n```\n/* @test /\n    public function it_will_keep_soft_deleted_files_on_the_system()\n    {\n        $media = $this->testModelWithSoftDeletes->addMedia($this->getTestJpg())->toMediaCollection('images');\n    $file = Media::first();\n\n    $this->assertTrue(File::isDirectory($this->getMediaDirectory($file->id)));\n\n    $file->delete();\n\n    $this->assertTrue(File::isDirectory($this->getMediaDirectory($file->id)));\n}\n\n```\nBut it fails, as it looks like the media table, used in those tests, does not have a 'deleted_at' attribute (I added it in my project). \nI also have another test:\n```\npublic function it_will_remove_force_deleted_files_from_the_system()\n    {\n        $media = $this->testModelWithSoftDeletes->addMedia($this->getTestJpg())->toMediaCollection('images');\n    $file = Media::first();\n\n    $this->assertTrue(File::isDirectory($this->getMediaDirectory($file->id)));\n\n    $file->forceDelete();\n\n    $this->assertFalse(File::isDirectory($this->getMediaDirectory($file->id)));\n}\n\n```\nThis one passes. \nSo, I cannot figure out how to test this functionality with the current setup... Any ideas?. @brendt Added deleted_at column, created a new custom model in the test case and submitted the tests, which pass with the new changes in MediaObserver, but fail with the old MediaObserver indicating that the new behavior is working as intended.\nPlease take a look, https://github.com/spatie/laravel-medialibrary/pull/879 . ",
    "mwingren": "@brendt - wouldn't putting soft deletes on the linked model only protect the linked model record?\nThe problem @Airidas10 is seeing involves soft deleting the MediaModel object and having the associated file deleted from the file system.. ",
    "addorange": "Thanks for the advice :-).. ",
    "dafonso": "@addorange, you have a couple solutions for that. First off you should be using collections to store the uploaded media, that way is easier to distinguish between media for different purposes.\nSecond, you could use a really fast way to see if an uploaded media already exists in the library.\nphp\n$mediaItem = $model\n    ->addMediaFromRequest('your_form_file_input_name')\n    ->withCustomProperties(['md5' => md5_file($request->file('your_form_file_input_name')->getRealPath())])\n    ->toMediaCollection();\nUnfortunately the custom properties on media library isn't a JSON field, otherwise it would make the queries easier. But still you could check for duplicates hacking something on the likes of:\nphp\nMedia::where('custom_properties', 'LIKE', '%'.md5_file($request->file('your_form_file_input_name')->getRealPath()).'%'\nChange this to fit for a collection if needed.... ",
    "amirshawn": "I duplicated the Media model and named it CustomMedia.  Then I changed the medialibrary config file to reference the new model.  That stopped the error from occuring in the commands, but I think there's a bug if you use Media for the name of the extended model when running commands.. I'm confused.  Don't I have to import Media from your library?  This is what my Product model looks `like.\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions;\nuse Spatie\\MediaLibrary\\Media;\nclass Product extends Model implements Item, HasMediaConversions\n{\n    protected $guarded = ['id'];  \n    use HasMediaTrait;\npublic function registerMediaConversions(Media $media = null)\n{\n    $this->addMediaConversion('icon_sm')\n        ->width(50)\n        ->height(50);\n    $this->addMediaConversion('icon')\n        ->width(100)\n        ->height(100);\n    $this->addMediaConversion('icon_lg')\n        ->width(150)\n        ->height(150);\n    $this->addMediaConversion('thumb')\n        ->width(250)\n        ->height(250);\n    $this->addMediaConversion('gallery')\n        ->width(500)\n        ->height(500);\n\n}\n\nIf I try importing my custom Media model then I get this error:\n\nDeclaration of App\\Product::registerMediaConversions(?App\\Media $media = NULL) must be compatible with Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions::registerMediaConversions(?Spatie\\MediaLibrary\\Media $media = NULL)\n\nI searched for Media:: to see if I'm calling that directly anywhere and it doesn't seem so. \nThank you for your help!!\n. Thank you for the response.  I'm not sure how to debug this.  I deleted everything in the command and ran Category::all();  and got the same error.  The category model uses the HasMediaConversions interface as well.\n I changed the name of my Media model  to CustomMedia and now everything is working fine.   So somehow the names are conflicting.   What confuses me is that I've had no problems running the same code through a controller but as a command it errors.  I'll just use the CustomMedia model.\n I just wanted to see if this has come up before and maybe there was a known solution.  I appreciate the help though and the great packages.  As soon as I finish this site, I will send you some postcardware :). This might be pushing it but optional image cropping in the vue component would be amazing.. @ipalaus I think the function is called usingFileName('name')\nI haven't tested it but I know usingName() is used for changing the name.  I'm assuming usingFileName is for changing the file name.  I don't think the documentation has all the available methods, but the video has some great info!. ",
    "goyne": "Ok, thanks for answering.. ",
    "killgt": "Chunked uploading for large assets could be a useful feature. ",
    "ryankilf": "Being able to select a focal point for an image would be great for resizing. i.e. a user could get an image to resize around a point in the top left, instead of in the centre, if that was more appropriate.. ",
    "ipalaus": "Afaik, there is no easy way to name a file on a disk atm. I think it would be useful for SEO to being able to name files... i.e.: /media/1/users-freekmurze.jpg, /media/1/users-freekmurze_thumbnail.jpg, /media/1/users-freekmurze@x2.jpg.... ",
    "javi-dev": "This is potentially against the core idea of this package, so feel free to turn it down, but here it goes: ability to have media not attached to a model.\nWhy would this be useful? I recently wanted to upload images using json before the model was created, and assign them after creation, but it was not possible.\nIt's a common problem, not strictly related to this package, and the usual solution is to create an empty model, attach the media, and update with the rest of the data afterwards; or upload to a temp folder, get the url, use a cron job to clean up unused media, etc.\nBut it would be nice if I could attach files to a collection, not a model, get their ids back or something so I could find them later, and attach the files when necessary. This would also allow moving images between models and things like that.\nThe problem I see with the idea is that it would probably make the API and the flow of using the package more complicated, and the fantastic usability of this package is what originally brought me here. I guess I don't know what I want :sweat_smile:.. ",
    "ttphi88": "Ability to customize conversion file name, for now it's hard-coded in https://github.com/spatie/laravel-medialibrary/blob/36f25439883d2f15b0afe81e31e788f87bca481b/src/FileManipulator.php#L86-L90\nAnd overriding conversion's url in getPathRelativeToRoot using custom_url_generator_class will generate 404 links. ",
    "bcreeves": "Ability to version media. For example I'm currently writing an app that has one file associated with each model. I want to update that model with a new file but have the old file still associated as an older version. \nIdeally I want to create a revisions model and then move that file along with it's conversions to a revisions directory and associate it with the new revision without having to recreate the conversions.. Ok that makes sense. \nIs there a way to move a media association from one model to another? Detach from one model and attach to another model?. ",
    "ludo237": "Add the ability to select a custom morph name \ud83e\udd14 \n. @freekmurze at the moment I am brainstorming, follow me a little bit here:\nSometimes it could be useful to edit the current $table->morphs(\"model\"); property inside the migration stub for any reason, the only thing that needs to be updated is the media method inside HasMediaTrait\npublic function media()\n    {\n        return $this->morphMany(config('medialibrary.media_model'), 'model');\n    }\nit would be nice if the model string comes from another configuration key, something like config('medialibrary.media_model_key'), for backwards compatibility the default config value will be model.\nWhat do you think about?\n. @tjmartin69 yes please do the pull request if you have already done the hard work <3. ## Further Details\nWhen logging the exception it seems that the problem is somehow related to the initialization of the jpegoptim process\n```\n0 [internal function]: Illuminate\\Foundation\\Bootstrap\\HandleExceptions->handleError(8, 'Array to string...', '/app/vendor/sym...', 334, Array)\n1 /app/vendor/symfony/process/Process.php(334): proc_open('\\\"jpegoptim\\\" --s...', Array, Array, '/app/public', Array, Array)\n2 /app/vendor/symfony/process/Process.php(210): Symfony\\Component\\Process\\Process->start(NULL, NULL)\n3 /app/vendor/spatie/image-optimizer/src/OptimizerChain.php(101): Symfony\\Component\\Process\\Process->run()\n4 /app/vendor/spatie/image-optimizer/src/OptimizerChain.php(77): Spatie\\ImageOptimizer\\OptimizerChain->applyOptimizer(Object(Spatie\\ImageOptimizer\\Optimizers\\Jpegoptim), Object(Spatie\\ImageOptimizer\\Image))\n5 /app/vendor/spatie/image/src/Image.php(139): Spatie\\ImageOptimizer\\OptimizerChain->optimize('/app/storage/tm...')\n6 /app/vendor/spatie/image/src/Image.php(118): Spatie\\Image\\Image->performOptimization('/app/storage/tm...', Array)\n7 /app/vendor/spatie/laravel-medialibrary/src/FileManipulator.php(117): Spatie\\Image\\Image->save()\n```. ## Update\nIt's clearly something related to the optimization system because if I include nonOptimized() method the following conversion works\nphp\n/**\n     * @param \\Spatie\\MediaLibrary\\Media|null $media\n     * @throws \\Spatie\\Image\\Exceptions\\InvalidManipulation\n     */\n    public function registerMediaConversions(Media $media = null)\n    {\n            $this->addMediaConversion(\"square_96\")\n                ->crop(Manipulations::CROP_CENTER, 96,96)\n                ->nonOptimized()\n                ->performOnCollections(\"photos\");\n    }\nSomething is broken on the optimization process . ## Update\nThis issue seems to be related and the related pull request\nEdit: yest the problem is right here @freekmurze I think you should notice this and for everyone who will face this problem in the future, you are welcome \ud83d\ude04 \n. @freekmurze yes, sorry for the delay, holidays... . @freekmurze can you please paste the test example that you've created?. ## Update\nThe above exception is not complete, this is the second message buried inside the stack trace\nJust a reminder, ffprobe is in the correct path!\n```\nCaused by\nAlchemy\\BinaryDriver\\Exception\\ExecutionFailureException: ffprobe failed to execute command '/usr/bin/ffprobe' '/app/storage/tmp/CjgVnZrr0KZ9EKQRjiIXDoUfoClJLF4s/eGnL6HhxKfazU7Sf.mp4' '-show_streams' '-print_format' 'json'\n/app/vendor/alchemy/binary-driver/src/Alchemy/BinaryDriver/ProcessRunner.php:100\n/app/vendor/alchemy/binary-driver/src/Alchemy/BinaryDriver/ProcessRunner.php:72\n/app/vendor/alchemy/binary-driver/src/Alchemy/BinaryDriver/AbstractBinary.php:209\n/app/vendor/alchemy/binary-driver/src/Alchemy/BinaryDriver/AbstractBinary.php:137\n/app/vendor/php-ffmpeg/php-ffmpeg/src/FFMpeg/FFProbe.php:261\n/app/vendor/php-ffmpeg/php-ffmpeg/src/FFMpeg/FFProbe.php:206\n/app/vendor/php-ffmpeg/php-ffmpeg/src/FFMpeg/FFMpeg.php:92\n/app/vendor/spatie/laravel-medialibrary/src/ImageGenerators/FileTypes/Video.php:22\n```. @seandelaney you closed this issue, why? did you solve it? how?. Thank you. @jerauf you should eager loading the media ids of a related model\nModel::with(\"mediaIds\")->first()\nWhere mediaIds is a custom relationship inside Model\npublic function mediaIds()\n{\n    return $this->media()->lists(\"id\");\n}\nBy doing this you don't need another query. That's way too generic, there are no magicians here. Cool story bro. ",
    "tjmartin69": "I have had to currently extend this library to do the following I can raise it as a pr if you find it useful/ a needed feature.\nWe currently run cloud front on top of our s3 and an uploaded file can potentially take up to 30 minutes to sync across all the servers. The feature that I built allows you to switch to the CDN address after the file is x minutes old.\nBasically it will use the direct address for the first x minutes then use the CDN address after. \nHope that makes sense. . @freekmurze @ludo237 I will do it this weekend when I will have some free time.\n@freekmurze Would you like this against the v7 branch?. @freekmurze @ludo237  Added the PR for the cdn domain here - https://github.com/spatie/laravel-medialibrary/pull/874. It can be, if you use multiple disks like we do you have to create a proxy url generator class that can switch between local and s3.\nMaybe a better solution would be to allow adding a custom url generator per disk instead of a global one.. ",
    "MaximVanhove": "Would it be possible to add a second parameter to only delete media for certain collections\ndeleteMedia->($id, String|Array $collections). ",
    "renebakx": "Support for VIPS would be nice. There is a abstraction class for Imagine \nThe hardest part is getting the extension on a production environment as it's a PECL based extension. \nOr just support for the command line tool VIPSThumbnail Especially the Smart Cropping Options  can be a very welcome addition over calculating the entropy using PHP. . hence the command line option :) But perhaps it's a better fit for the Spatie Image over this library.  . ",
    "timacdonald": "Wish the 1st.\nThe package to use the Storage facade to access disks so we can Storage::fake() and not litter the actual disks with testing images. I know the package is tested and I don't need to duplicate \"test_files_are_able_to_be_uploaded\", however on routes that require images to he sent with the response due to validation, it would be great to just fake the storage on tests that hit those routes so they are cleaned up for us automatically.\nPreviously you've mentioned just switching the disk manually - which does work - but with Laravel giving us the power to fake storage so easily - unless there is package crippling issues with using the storage facade - it would be awesome.\nI've just been doing this at the end of my tests: Media::all()->each->delete();\n but consistency is key.\nWish the 2nd.\nAbility to have the original image saved to different disk than the generated images.\n\nEither way - super excited for the new version - sounds like its gonna be wicked. Thanks Spatie team!. ",
    "pixelpeter": "Keep original filename and create directories for each conversion\nImage names are very relevant for SEO.\n.. and this is the only thing holding me back from using this great library.\nTherefor I suggest this feature resulting in a directory structure like this\nmedia/\n\u251c\u2500\u2500 1/\n\u2502   \u251c\u2500\u2500 my-very-descriptive-filename.jpg\n\u2502   \u251c\u2500\u2500 thumb\n\u2502   \u2502   \u2514\u2500\u2500 my-very-descriptive-filename.jpg\n\u2502   \u251c\u2500\u2500 preview\n\u2502   \u2502   \u2514\u2500\u2500 my-very-descriptive-filename.jpg\n\u2502   \u2514\u2500\u2500 full\n\u2502       \u2514\u2500\u2500 my-very-descriptive-filename.jpg\n\u251c\u2500\u2500 2/\n\u2502   \u251c\u2500\u2500 this-filename-says-everything.jpg\n\u2502   \u251c\u2500\u2500 thumb\n\u2502   \u2502   \u2514\u2500\u2500 this-filename-says-everything.jpg\n\u2502   \u251c\u2500\u2500 preview\n\u2502   \u2502   \u2514\u2500\u2500 this-filename-says-everything.jpg\n\u2502   \u2514\u2500\u2500 full\n\u2502       \u2514\u2500\u2500 this-filename-says-everything.jpg\n\u251c\u2500\u2500 .../\nAdditional benefit would be that you can easily cleanup specific conversions from the filesystem\nI'm aware that you can achieve a similar solution by using by overwriting getPath() from the PathGenerator using the slug of the Eloquent model resulting in a directory structure like this:\nmedia/\n\u251c\u2500\u2500 slug-of-my-article/\n\u2502   \u251c\u2500\u2500 my-very-descriptive-filename.jpg\n\u2502   \u251c\u2500\u2500 conversions\n\u2502   \u2502   \u251c\u2500\u2500 thumb.jpg\n\u2502   \u2502   \u251c\u2500\u2500 preview.jpg\n\u2502   \u2502   \u2514\u2500\u2500 full.jpg\n\u251c\u2500\u2500 slug-of-another-article/\n\u2502   \u251c\u2500\u2500 this-filename-says-everything.jpg\n\u2502   \u2514\u2500\u2500 conversions\n\u2502       \u251c\u2500\u2500 thumb.jpg\n\u2502       \u251c\u2500\u2500 preview.jpg\n\u2502       \u2514\u2500\u2500 full.jpg\n\u251c\u2500\u2500 .../\nBut I think solution 1 is the better approach for SEO.\nPlease let me know your opinion on this.\nThanks in advance\npp. ",
    "leewillis77": "Another vote here for @javi-dev suggestion about allowing media not attached to a model. My use case is similar I think. \nI have a \"create\" form for my product model, and I want to allow media to be uploaded and stored via AJAX prior to the form being submitted.\nI'd store the IDs of the created media models in the form, so I can associate them with the product model when it's finally created. \nSo, I'd expect to be able to do something like this in my AJAX upload handler:\nphp\n$product = new Product();\n$mediaItem = $product->addMedia($request->file('file'))->toMediaCollection('product-images');\nreturn [\n    'id'    => $mediaItem->id,\n    'url'   => $mediaItem->getUrl(),\n];\n. ",
    "slakbal": "@freekmurze this request might already be listed or supported. Would be great if one could e.g. give a default file/object per model or media-collection via a property or trait class e.g. defaultMedia = 'profile.jpg', whatever way.\nUsecase: User profile image, if the user did not up upload a profile image the default would be returned, which of course would be a stand-alone file that is not directly related to any model but would be run through the same conversions as defined in the model where the property was defined. \nWhen it is to be displayed an no media exist it is returned as the \"placeholder\". I think it would be better if it is an explicit method call just as a stupid example method-name \"mediaOrDefault\" or method parameter that is passed in. \nThis comes from always writing the same old code to do this over and over, but if supported in the medialibrary package the leverage of the conversions, etc. would ensure that even placeholder images are exactly treated and returned in the same way than actual media, which is a huge boost in consistency.\nor something like this...\n$this->addMediaCollection('images')\n->acceptFiles(function (File $file, HasMedia $model) {\n   return $file->mimeType == 'image/jpg';\n})\n->applyConversions(.....)\n->useDisk('s3')\n->placeholder( function() {\n   $this->filename('default_profile.jpg') //throws exception if mime-type is not the same as the parent collection\n   ->useDisk('local') //location of the default file\n});\n  . ",
    "AdrianKuriata": "I hope you will implement many to many relationship, really not need is when i want put same picture or pdf file to the two post and i need add them twice. This is not optimizing and clearing, a lot of not required files. . ",
    "robjbrain": "Any update on a release date for V7? Really keen for the multi downloads feature :). Could you add native support for saving a hash of the file, presumably using file_hash() http://php.net/manual/en/function.hash-file.php \nIt's a nice way to check for duplicate media.\nOf course it can cause problems with large files so it would be good to have an on/off option in the config as well as a max size to try and hash (so it won't bother hashing a file that is too large). ",
    "Dennisvb": "Custom exceptions/validation for the addMediaFromUrl method would be nice.. ",
    "mokhosh": "Can we detach a media from a model without deleting the media? So we can attach it later to another model?. Thanks for your response. But can we detach if from all models? A media not attached to any model, to be attached later.\nThat way the media library is a more independent ecosystem that can have loose relationships with other parts of the application.. @divdax I guess all wishes in this wish list could be somehow done the non-elegant way, but I thought this is a reasonable feature to have in future versions.. @eichgi I'm having the same problem, can you tell me how you solved yours?. Well, I haven't even published the config. I'm just using the defaults. So that shouldn't be my problem, right?. No the problem is here //storage/. You see I don't have my domain name at the beginning. It's just two slashes.. OK, I got it. I don't think it was about Laravel file system.\nFor anyone else who might run into this problem, I had a trailing slash at the end of my APP_URL in my .env file:\nAPP_URL=http://areyoukiddingme.com/ <-- trouble\nAPP_URL=http://areyoukiddingme.com  <-- everything fine!\nIs this a bug, or am I missing something here?. Got it! Laravel resource routes uses Latin singular \"medium\" for the route segment, like I did with my variable. But Artisan generates controllers with $media for parameters, and that's why Laravel didn't automatically resolve it.. Sorry, how is that code related to changing file names?. I don't want to delete them, that's against the whole point of soft deletion. What I do need though is an elegant way to query media that their models are not soft deleted, and I think this should be the default.\nEven this didn't work:\nphp\n$media = Media::has('model')->get();. Thank you for your detailed response.\nThis is what I wrote to test the class you mentioned:\nphp\nRoute::get('test', function() {\n    $video = new \\Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Video();\n    echo $video->convert('intro.mp4');\n});\nI put the intro.mp4 video file in my public folder and the thumbnail was created next to the video.\nWhere else do you think I can find the problem?. That's what I expected is what causes the problem at first, but I went to the directory and there is no thumbnail. I tried what you suggested anyway:\nphp\n$copiedOriginalFile = str_replace(\"\\\\\", \"/\", $copiedOriginalFile);\nThe slashes change but the problem is the same:\ncopy(D:/dev/storage/medialibrary/temp/Hc8nhzZkT3hCZs7G7qk2KrWpCVEIGGGP/7jR2IISPSXiKM437.jpg):\n failed to open stream: No such file or directory. ",
    "Okipa": "It could be great to have some methods to get for a collection :\n- the declared sizes\n- the accepted types\nIt is currently not so easy to get these data.\nThis could give the opportunity to analyse the results in order to use the model declared collections and conversions to dynamically generate the needed Laravel validations.\nExample with a collection with the following declaration :\n```\n// registerMediaCollections()\n$this->addMediaCollection('logo')->singleFile()->acceptsFile(function(File $file) {\n    return $file->mimeType === 'image/jpeg' || $file->mimeType === 'image/png';\n});;\n// registerMediaConversions(Media $media = null)\n$this->addMediaConversion('thumb')->width(40)->height(40)->sharpen(10);\n$this->addMediaConversion('email')->width(100)->height(100)->performOnCollections('logo');\n$this->addMediaConversion('base')->width(225)->height(225)->performOnCollections('logo');\n```\nCould return an array like this :\n['logo'] => [\n    'types' => ['image/jpeg', 'image/png'],\n    'sizes' => [\n        'thumb' => [\n            'width' => 40,\n            'height' => 40,\n        ],\n        'email' => [\n            'width' => 100,\n            'height' => 225,\n        ],\n        ... etc.\n    ],\n]\nThen everyone could use these data for its own purpose.. @freekmurze I'll try when I'll have some free time (full rush right now).. @freekmurze\nI have submit a full tested PR for a dynamic validation and legend strings generation implementation proposition here : https://github.com/spatie/laravel-medialibrary/pull/1342.\nHave implemented this separately on my project for a while and it definitely saved me from redondant implementations and errors.. It seems that you didn't read the doc ;)\nhttps://docs.spatie.be/laravel-medialibrary/v7/downloading-media/downloading-a-single-file#downloading-a-single-file. Up ! Anybody here ?. Hello there, I've been digging a little more into this problem.\nAfter having registered the collections like this :\npublic function registerMediaCollections()\n{\n    $this->addMediaCollection('logo')\n        ->singleFile()\n        ->registerMediaConversions(function(Media $media) {\n            $this->addMediaConversion('email')->width(100)->height(100);\n            $this->addMediaConversion('base')->width(225)->height(225);\n    });\n}\nI am now able to get a model conversion from its name.\n$collections = array_where($model->mediaCollections, function($collection) use ($collectionName) {\n    return $collection->name = $collectionName;\n});\n$collection = head($collections);\nBut once I have the collection, I can't manage to get its registered conversions.. I also found a way to get a model registered collections.\n$model->registerMediaConversions();\n$conversions = array_filter($model->mediaConversions, function($conversion) use ($collectionName) {\n    return $conversion->shouldBePerformedOn($collectionName);\n});\nThe problem is that we only get the conversions registered using the global registerMediaConversions() model method and not conversions registered for an given collection :\npublic function registerMediaConversions(Media $media = null)\n{\n    $this->addMediaConversion('thumb')->width(40)->height(40)->sharpen(10);\n}. Hi @UmarAbdullahi,\nOnce you have declared your avatar collection in your User model, you can get your avatar images like that :\n// for example\n$user->getMedia('avatar')->first()->getUrl();\nAll is well explained here : https://docs.spatie.be/laravel-medialibrary/v7/working-with-media-collections/defining-media-collections. It does take the name of your uploaded file, except if you rename it during the process.\nWouldn't 19224971_101423607143177_5516819573616429777_n .jpg be the name of your uploaded image ?. Is see, this is not a package issue but more a Laravel workflow you should get into.\nCheck this to get the solution for your problem : https://laravel.com/docs/5.6/filesystem. Hi @batFormat, could you be more specific about what you changed in the PerformConversions job to make it work ?\nI have the same problem with the very same configuration but I can't see any SerializesModels in this job.. Sorry, I get it, you mentionned the trait and I was searching a method.\nThe weird thing is that I have set up the same configuration in local with Laradock and everything is working fine with the redis queue.... Hi @freekmurze, thanks for your review, too bad this was not accepted ;)\nI fully understand your point of view regarding the weight of this package (it must already take time to maintain it).\nNerver the less, I would like to know if you would mind if I created a new package named laravel-medialibrary-extension for example, allowing people to add some extra features to this great package.\nIn fact, I use the features I proposed every day at work and they are such time-saving that I would be ready to set this up in a separate package and to maintain it.  . ",
    "aghayeff": "Hi!\nIs it possible firstly crop and fit image and then make responsive images?\nFor example, an uploaded photo firstly will be cropped to 450x300. Then responsive images will be generated from cropped image (450x300).\nSomething like this:\n`                $model->addMedia($request->image)->fit('crop', 450, 300)->withResponsiveImages()->toMediaCollection();\nOf course I can register multiple Media Conversions. I think this way would be more sensible.\n. > his conversion produces an image in 1920x1080px but the responsive versions are not generated correctly.\nExactly! Did you find a solution? . ",
    "josegus": "So, version 7 is up, I've search for the vue components and found nothing. When will be they available?. why? this is a good pull request, i currently need an array of full urls. Would be great if we could get this array directly from the trait. This many-to-many polymorfic is a wordpress behavior, I have the same question.. ",
    "faustuzas": "I have it like this\npublic function registerMediaConversions(Media $media = null)\n    {\n        $this->addMediaConversion('resized')\n            ->height(50)\n            ->width(50)\n            ->nonQueued();\n    }. So I did \nphp artisan storage:link\nand now refering to image as \nAuth::user()->getFirstMediaUrl('avatars', 'resized')\n but I get this error\n\n...\\ap_avatar\\storage\\app\\public` is not part of public path ...\\ap_avatar\\public \n\nFilesystem: \n'media' => [\n            'driver' => 'local',\n            'root'   => storage_path('app\\public'),\n        ],. @lorlab thank you, man :)\nIt worked just I did 'url' => './storage/media'. Here it is: \n\n. @HenkVanMaanen I didn't . Problem probably was somewhere elsewhere. ",
    "lorlab": "I was just trying to achieve the same thing and was getting the same error. \nI am assuming you have a media disk in filesystems.php and have set this as the default_filesystem in medialibrary.php.\nWhat I was not including was the url property. After adding it like shown below it started to work... \nHopefully this will help!\n'media' => [\n    'driver' => 'local',\n    'root' => storage_path('app/public/media'),\n    'url' => env('APP_URL').'/storage/media',\n],. ",
    "jozeflambrecht": "running php artisan config:clear fixed my issue. Sorry for the late answer, but it is the proper way to do this. (more info: https://laravel.com/docs/5.6/filesystem#configuration). Did I pick the wrong branch?. @jhm-ciberman Do you have a solution for this?. ",
    "crossRT": "Hi @jozeflambrecht ,\nMay I know how do you allow public to access images in your storage folder?\nWrite a new route to do the job?\n. I found this,\nhttps://stackoverflow.com/questions/30191330/laravel-5-how-to-access-image-uploaded-in-storage-within-view\nHope it's a proper way to do this?. ",
    "HenkVanMaanen": "@faustuzas How did you solve the problem?. ",
    "liran-co": "I've already tried this several times. Any other possible causes?. Turns out I didn't change defaultFileSystem to default_filesystem when upgrading to v6 :/. ",
    "bomshteyn": "@freekmurze Thank you so much!!! . ",
    "Quadriphobs1": "I would have simply do that but in this case is till do want to keep the old image in the collection. ",
    "Omranic": "Will wait until final release then, thanks.. Fix PR submitted #889. @brendt Well, that's unexpected request \ud83d\ude02  but yeah, seems ok! \ud83d\ude0f\nNot sure if GitHub will upload with same quality/size or not, but here we go:\n\nJust in case someone interested in that material, it's here: \"Actions on Google: Conversation Design Tips\" https://www.youtube.com/watch?v=MSUPVbbhIGA&t=5s \ud83d\ude1c. Wow, I respect the efforts given to deep dive into the insights of that issue, kudos \ud83d\udc4f. ",
    "ammonkc": "Setting that config value doesn't seem to fix it. I set it to:\nphp\n'temporary_directory_path' => storage_path('medialibrary/temp'),\nmedialibrary/temp is used as the temp folder, but it never gets cleaned up because it still tries to delete /tmp\nphp\n\"message\": \"rmdir(/tmp): Permission denied\",\n    \"exception\": \"ErrorException\",\n    \"file\": \"/var/www/html/ptpkg/vendor/spatie/image/src/GlideConversion.php\",\n    \"line\": 107,\n    \"trace\":\n....\n  EDIT: Here are details about the development server I'm using incase this helps.\nOS Release........: CentOS Linux release 7.4.1708 (Core)\nkernel............: 3.10.0-693.11.1.el7.x86_64\nApache............: 2.4.6\nPHP...............: 7.1.12\nMySQL.............: 5.7.20. I'm on version 6.6.7\n\"spatie/laravel-medialibrary\": \"^6.0\". After much digging I've found the cause of this issue. I've already posted this here in\nspatie/image#38, but I'll post it here as well since it's relative.\nIt's related to something called \"systemd /tmp isolation\". The php service (and others like httpd) have the PrivateTmp option to true in the systemd script (/usr/lib/systemd/system).\nIt's a security measure where a new /tmp is created and isolated from the other ones. All the data saved inside are deleted once the service is stopped.\nIf running on a Linux system where systemd has PrivateTmp=true (which is the default on CentOS 7 and perhaps other newer distros), sys_get_temp_dir() function will simply return \"/tmp\", not the true, much longer, somewhat dynamic path. \n(example: systemd-private-5049768e046a4449b2d8dd552949bb17-php-fpm.service-FYJIWf/tmp/ )\nsee: http://php.net/manual/en/function.sys-get-temp-dir.php#121073\nas a quick fix you can disable the PrivateTmp option. see https://gryzli.info/2015/06/21/centos-7-missing-phpapache-temporary-files-in-tmp-systemd-private-temp/.\nBut since this is a security feature of linux, a better long term solution would be to avoid using the system /tmp directory to cache conversion files, and instead use a directory within the project. . ",
    "ptiuma": "I have same error after last update\n ErrorException In GlideConversion.php line 107 :\nrmdir(/tmp): Permission denied.      \"spatie/laravel-medialibrary\": \"6.0.0\",\ni set in config 'temporary_directory_path' => storage_path('medialibrary/temp'),\nand can view temp files in this dir -  medialibrary/temp\nbut error same - rmdir(/tmp): Permission denied\nWorking only after i've commented line 107 In GlideConversion.php. ",
    "lostincode": "Getting this today as well. What version of medialibrary is everyone using?. fwiw, the server I was getting this on was also running PHP 7.1.12. I provisioned a fresh server running 7.2 and the issue was not there. Not saying PHP is the culprit for sure but a good place to check. I didn't have enough time to dive into it. I did check folder permissions and those looked good. . ",
    "htulibacki": "@ammonkc @freekmurze @lostincode @ptiuma \nI came across a similar problem today, and what I found out is that medialibrary is trying to delete a temporary folder only when it's empty. So if you create for example an empty folder in /tmp dir, everything works as expected.. I tried this earlier, but somehow it did not work (it still wants to delete /tmp). I'll try to look at this after work.. Ok, it's related to https://github.com/spatie/image/issues/38, so i think this issue can be closed.. ",
    "eminos": "@adiachenko Thank you! This is very useful.. ",
    "corbin88": "@adiachenko \nCan you please explain how to implement this? I'm not overly sure what I am overriding and what I'm creating. It would be helpful to gets some comments in the code you provided.\nMy guess is I create a resource called MediaResource and create my own HasMedia trait in my App folder. \nI'm guessing the \"Section\" model is just a placeholder for any model? So for example:\n```\n<?php\nnamespace App;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions;\nuse Spatie\\MediaLibrary\\Media;\nuse App\\HasMedia;\nclass User extends Model implements HasMediaConversions\n{\n    use HasMedia;\npublic $with = ['media'];\n\npublic const MEDIA_AVATAR_IMAGES = 'avatar';\n\n\npublic function registerMediaCollections()\n{\n    $this->addMediaCollection('avatar')->singleFile();\n\n}\n\n\npublic function registerMediaConversions(Media $media = null)\n{\n    $this->addMediaConversion('profile_thumbnail')\n          ->fit(Manipulations::FIT_CROP, 200, 200)\n          ->withResponsiveImages()\n          ->performOnCollections('avatar');\n\n    $this->addMediaConversion('thumbnail')\n          ->fit(Manipulations::FIT_CROP, 50, 50)\n          ->performOnCollections('avatar');\n}\n/**\n * @return \\Illuminate\\Database\\Eloquent\\Relations\\MorphOne\n */\npublic function avatar()\n{\n    return $this->morphOneMedia()->where('collection_name', static::MEDIA_AVATAR_IMAGES);\n}\n\n}\n``\n[I'm trying to eager load media with the users model to and get the path there. As my issue states.](https://github.com/spatie/laravel-medialibrary/issues/1388) Would I not need to use some controller method to implement that resource? Instead ofAuth::User()`?\n. I figured out how to go about what I was trying to do without the help of intervention. This package is awesome! Thank you.. This works, but I'm not overly sure it's a good solution as I haven't thought it out enough yet. Essentially you just append the conversions to the JSON output like so:\nUser Model\n```\nprotected $appends = ['profile_thumbnail','thumbnail'];\npublic function getProfileThumbnailAttribute()\n{\n    //Check if media has collection and return default.jpg if false\n    if ($this->media->isEmpty()) {\n        return 'default.jpg';\n    } else {\n        return $this->media->first()->getUrl('profile_thumbnail');\n    }\n}\npublic function getThumbnailAttribute()\n{\n    //Check if media has collection and return default.jpg if false\n    if ($this->media->isEmpty()) {\n        return 'default.jpg';\n    } else {\n        return $this->media->first()->getUrl('thumbnail');\n    }\n}\n```\nThis will only really work if you eager load media public $with = ['media']; every time you get the user model. You can also add the isLoaded function to the conditions if you don't want to eager load media every time you get the user model. \nhttps://laracasts.com/discuss/channels/laravel/how-to-check-if-an-relationship-has-been-eager-loaded-or-not. ",
    "gkarugi": "@freekmurze thanks, That sorted out my problem.. Yes it does.\nAm on version 6.0.0.\nApp\\Models\\Media model  extends Spatie\\MediaLibrary\\Media.php.\nhere it is:-\n```\n<?php\nnamespace App\\Models;\nuse HipsterJazzbo\\Landlord\\BelongsToTenants;\nuse Spatie\\MediaLibrary\\Media as ParentMedia;\nclass Media extends ParentMedia\n{\n    use BelongsToTenants;\n}\n```\nSeems latest version of media library is v7+, I will try upgrading and see if the problem persists.. Still after upgrading to version 7.0.0 the problem persists.\n```\n<?php\nnamespace App\\Models;\nuse HipsterJazzbo\\Landlord\\BelongsToTenants;\nuse Spatie\\MediaLibrary\\Models\\Media as ParentMedia;\nclass Media extends ParentMedia\n{\n    use BelongsToTenants;\n}\n```\nAs you can see on the above model, My Media Model extends  Spatie\\MediaLibrary\\Models\\Media\n. @jwtea and can I see your generator class?\n. ",
    "felixpenrose": "I ran into the same issue myself. The max file size was not big enough. This seems like a very verbose error message for something that could be relatively common.\nSurely the library should spit out an appropriate error message to indicate such an error.. ",
    "unfalln": "A quick example of the code I'm currently using:\n```php\npublic function registerMediaConversions(Media $media = null)\n{\n    $pdfConverter = new \\Spatie\\PdfToImage\\Pdf($media->getPath());\n\n    $pages = $pdfConverter->getNumberOfPages();\n\n    for($page = 0; $page < $pages; $page++) {\n        $pageName = $page + 1;\n        $this->addMediaConversion(\"fieldDesigner_page{$pageName}\")->page($pageName)->width(900);\n    }\n\n    $media->setCustomProperty(\"pages\", $pages);\n    $media->save();\n}\n\n```\nNote that this means I now have a thumbnail available for each page of the uploaded pdf that I can now iterate and display.\nAs previously stated, I also refactored the extractVideoFrameAtSecond parameter to demonstrate that these Generator-specific parameters can be added with no further intervention required in the Conversion object.. ",
    "szepeviktor": "styleci failures are inherited!. ",
    "shiroamada": "Can show example step how to do it correct way? I am not familiar extend from other modal.\nThank you!. OK, I found it in the documentation. And added pull request for class name typo error.\nThanks!. OK. I didn't have any config cache.\nHowever, I manage to find out the issue.\nIt is due to in the view I have 2 media.\n1st one I save in public media, and the 2nd one I changed it to media filesystem. Somehow. I remove all the data and do it again, there is no more error.\nSorry for the inconvenience. . ",
    "hakimihamdan88": "@altercode any hacks?. ",
    "altercode": "Hi @hakimihamdan88 \nI finally did something like this:\n    $addedFiles = [];\n\n    $filesAdded = $mediable->addMultipleMediaFromRequest(['file']);\n\n    foreach ($filesAdded as $fa) {\n        $addedFiles[] = $fa->toMediaCollection('images');\n    }\n\n    return json_encode($addedFiles);.\n",
    "eduduardo": "The \"Class Spatie\\MediaLibrary\\UrlGenerator\\UrlGenerator\" is an interface and it cannot be used as the generator itself.\nMaybe you can set the config file to:\n```\n'custom_url_generator_class' => \\Spatie\\MediaLibrary\\UrlGenerator\\LocalUrlGenerator::class,\n````\n. ",
    "DivineOmega": "Hope this does the trick. :). ",
    "elamotte": "Perfect. Thanks for the tip!. ",
    "clarkwinkelmann": "@freekmurze yes I've registered a custom PathGenerator and UrlGenerator, no problem on that side, extensibility is great !\nI've found that the following bare minimum is required in config/filesystem.php in order to use medialibrary and the multitenant dynamically-registered disk:\nphp\n    'disks' => [\n        // The tenancy disk is created dynamically by hyn/multi-tenant but spatie/laravel-medialibrary\n        // requires any disk to be declared in the config file. This dummy entry fixes the issue.\n        // Used in Spatie\\MediaLibrary\\FileAdder\\FileAdder::determineDiskName\n        // @see https://github.com/spatie/laravel-medialibrary/issues/920\n        'tenant' => [\n            // Used in Spatie\\MediaLibrary\\Media::getDiskDriverName\n            'driver' => 'local',\n        ],\n    ],\nI guess there's not really any other solution than adding this dummy entry. Given hyn/multi-tenant registers its tenant disk very early I didn't found any case where Laravel would try to load it from that dummy configuration instead.. ",
    "dilger": "Nevermind, seems to be not necessary to set explicit expiry headers and I figured out that Google Pagespeed complains only on those assets, that have been uploaded aside from the medialibrary by ftp. All others uploaded with medialibrary get there max-age and are fine.. ",
    "ajaybairagi": "@freekmurze \nThanks for your reply\nIt is working with extends BaseMedia and put static connection  but I want to pass dynamic database connection \nHave any option to pass  Tenant database name in\n$emailAuditMedia->addMedia($file)->toMediaCollection();\nor have other code\nor have any option to pass variable in  __construct($connection)\nmy custome Model-\nnamespace App\\Models;\nuse Spatie\\MediaLibrary\\Media as BaseMedia;\nclass CustomMedia extends BaseMedia {\n public $connection;\n    function __construct($dbname = null) {\n        if (!empty($dbname)) { \n            $this->connection = $dbname;\n        }\n    }\n    protected $table = 'media';\n}\nand use below code in another modal. how can pass $dbname variable \n$emailAuditMedia->addMedia($file)->toMediaCollection();. I have extend Media Modal and solved problem\nnamespace App\\Models;\nuse Spatie\\MediaLibrary\\Media as BaseMedia;\nclass CustomMedia extends BaseMedia {\n    public $connection;\n    function __construct($connection = null) {\n        if (!empty($connection)) {\n            $this->connection = $connection;\n        } else {\n            $conn = app('db')->getConnections();\n            reset($conn);\n            $this->connection = key($conn);\n        }\n    }\n    protected $table = 'media';\n}\n. ",
    "shabaz-ejaz": "I've also just realised that Pivot extends Model anyway. See: https://laravel.com/api/5.5/Illuminate/Database/Eloquent/Relations/Pivot.html\nSo this shouldn't be the problem. Just not sure why its returning an empty collection.. @freekmurze  Why was this closed? It's not resolved if that's what you thought.. I'm not sure if it's failing any tests but I just wanted to know if the media library is compatible with Pivot classes? as this isn't quite the same as an Eloquent model. . Nope it doesn't. Do you want me to write my own test and show its failing?. Also you've closed this issue again without warning, can you please not do that its quite annoying. This issue is still open. Okay... why did you close this issue?. I've found some more information on the issue.\nIf I do this:\ndd(UserTask::find(1)->getMedia()); \nit shows the media objects.\nHowever if I try and fetch the media using the relations in a query builder:\n$sections = $this->model->with('subsections.tasks.users')->get();\nIt does not return the media objects as part of the json:\n\"tasks\": [\n                   {\n                        \"id\": 1,\n                        \"name\": \"Create a policy\",\n                        \"description\": \"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc nisl nibh, iaculis nec posuere sit amet, fermentum sed orci. Aliquam dignissim, elit at malesuada imperdiet, est leo ullamcorper urna, nec hendrerit lorem lacus vel quam. Fusce mauris massa, pharetra id nisl non, vestibulum tempus est. Curabitur vitae metus non massa volutpat semper ac a ligula. Nunc feugiat pulvinar tortor, viverra hendrerit metus lacinia ut. Etiam efficitur in arcu ut bibendum. Etiam non diam ac odio auctor faucibus sit amet ac metus.\",\n                        \"question\": \"Have you created a training policy?\",\n                        \"yes_description\": \"Upload policy to secure, off-site storage\",\n                        \"no_description\": \"Download template\",\n                        \"high_urgency\": 1,\n                        \"document_upload_required\": 1,\n                        \"active\": 1,\n                        \"created_at\": \"2018-02-26 09:40:39\",\n                        \"updated_at\": \"2018-02-26 09:56:33\",\n                        \"pivot\": {\n                            \"section_id\": 3,\n                            \"task_id\": 1\n                        },\n                        \"users\": [\n                            {\n                                \"id\": 1,\n                                \"name\": \"Admin\",\n                                \"email\": \"admin@example.com\",\n                                \"company_id\": null,\n                                \"is_active\": 1,\n                                \"created_at\": \"26-02-2018 09:31:15\",\n                                \"updated_at\": \"2018-02-26 09:31:15\",\n                                \"stripe_id\": null,\n                                \"card_brand\": null,\n                                \"card_last_four\": null,\n                                \"trial_ends_at\": null,\n                                \"pivot\": {\n                                    \"task_id\": 1,\n                                    \"user_id\": 1,\n                                    \"completed\": false,\n                                    \"task\": {\n                                        \"id\": 1,\n                                        \"name\": \"Create a policy\",\n                                        \"description\": \"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc nisl nibh, iaculis nec posuere sit amet, fermentum sed orci. Aliquam dignissim, elit at malesuada imperdiet, est leo ullamcorper urna, nec hendrerit lorem lacus vel quam. Fusce mauris massa, pharetra id nisl non, vestibulum tempus est. Curabitur vitae metus non massa volutpat semper ac a ligula. Nunc feugiat pulvinar tortor, viverra hendrerit metus lacinia ut. Etiam efficitur in arcu ut bibendum. Etiam non diam ac odio auctor faucibus sit amet ac metus.\",\n                                        \"question\": \"Have you created a training policy?\",\n                                        \"yes_description\": \"Upload policy to secure, off-site storage\",\n                                        \"no_description\": \"Download template\",\n                                        \"high_urgency\": 1,\n                                        \"document_upload_required\": 1,\n                                        \"active\": 1,\n                                        \"created_at\": \"2018-02-26 09:40:39\",\n                                        \"updated_at\": \"2018-02-26 09:56:33\"\n                                    },\n                                    \"media\": []\n                                }\n                            }\n                        ]\n                    },\n]\n. How could it not be caused by this package? I've shown above a bare bones example of the media not being retrievable from the query. Please re-open. If not I'll open a new issue.. Its just overkill to create a pull request and write tests for an issue like this. I think the above example is more than sufficient for you to replicate.. How about if you try $inmueble[0]->getFullUrl()?. @sebastiandedeyne Any way I can achieve this?. @fridzema Thanks for your suggestion and examples.\nWould something similiar work for say documents like .doc and .pdf? I know I'd need to read the contents of the file first with file_get_contents() so maybe something like:\n$model->addMediaFromBase64(Crypt::encryptString(file_get_contents($request->file('document'))))->usingFileName($request->file('document')->getClientOriginalName())->toMediaCollection('documents');\n. @fridzema Okay, so it seems like it encrypts the file perfectly but when I decrypt the file it returns the following error:\nlocal.ERROR: The payload is invalid. {\"userId\":1,\"email\":\"admin@example.com\",\"exception\":\"[object] (Illuminate\\\\Contracts\\\\Encryption\\\\DecryptException(code: 0): The payload is invalid. at C:\\\\wamp\\\\www\\\\astrid-api-post-mvp\\\\vendor\\\\laravel\\\\framework\\\\src\\\\Illuminate\\\\Encryption\\\\Encrypter.php:191)\n[stacktrace]\nThe way I encrypt: \n$documentUploaded = $company->addMediaFromBase64(Crypt::encrypt(base64_encode($file)))->usingFileName($file->getClientOriginalName())->toMediaCollection();\nDecrypt:\n$taskMedia = Crypt::decrypt(file_get_contents($taskMedia->getPath()));. @fridzema I've tried that too. It keeps giving payload is invalid.\nWhen I open the encrypted file in Notepad it looks like this:\n{\"iv\":\"OEgwSuY7eBy202fE9ZdxKw==\",\"value\":\"We2UcDvODKDv+iVV8wiCuiZqaho8UV83JjyXhV\\/6\\/X8=\",\"mac\":\"b9e7967ad0f38c9064958070a3bea97f5463043bf27a4a6c8aee624d997fd4a2\"}. Hmmm interesting. So here is what i'm getting now:\ndump(file_get_contents($taskMedia->getPath()));\n returns: \n{\"iv\":\"YzWg0r7H0opgh3CecWmc+Q==\",\"value\":\"LCbAi14DYOWbSogWAJQESWd8XEoqdqpQoJ\\/mjdAbvhD54juA2HVKrqxWtTF4WX7h\",\"mac\":\"2211138f4e73fd59a9d7ef0dc3a26d09d2d42a236f3ce14cd7517f30b85ff224\"}\"\ndump(base64_encode(file_get_contents($taskMedia->getPath())));\nreturns:\n\"eyJpdiI6Ill6V2cwcjdIMG9wZ2gzQ2VjV21jK1E9PSIsInZhbHVlIjoiTENiQWkxNERZT1diU29nV0FKUUVTV2Q4WEVvcWRxcFFvSlwvbWpkQWJ2aEQ1NGp1QTJIVktycXhXdFRGNFdYN2giLCJtYWMiOiIyMjExMTM4ZjRlNzNmZDU5YTlkN2VmMGRjM2EyNmQwOWQyZDQyYTIzNmYzY2UxNGNkNzUxN2YzMGI4NWZmMjI0In0=\"\ndump(Crypt::decrypt(base64_encode(file_get_contents($taskMedia->getPath()))));\nreturns:\n\"Qzpcd2FtcFx0bXBccGhwMjBBRC50bXA=\"\nI think the base64 stuff is causing a bit of confusion. Is there a way we can simply encrypt without the addMediaFromBase64 call?\nOr maybe due to the length of the word document being uploaded it won't properly be converted to base64 as it has a character limit right?. So I don't need any of the base64 methods? Meaning I literally do this?\n$company->addMedia(Crypt::encrypt($file->getPath()))->toMediaCollection();. @fridzema Now I get File does not exist. Probably because I'd need to encrypt the temp file first as it wouldn't have been uploaded at that point?. Yeah so seems like I cannot easily encrypt the file instance before upload. \nI guess I'm gonna have to manually store and retrieve documents without media library like this example. If that doesn't work, I'm gonna have to bury my head in the sand. \n. Thanks for your help @fridzema  \ud83d\udc4d . ",
    "Erdboden": "@freekmurze no. thank you, changed and it worked. ",
    "peyobr": "Thank you!. ",
    "qrczak": "OK, nevermid :)\nIn controller:\n$posts = Post::paginate(10);\nreturn view('dashboard.index', ['posts' => $posts]);\nin blade for example - I need first thumb of images related to the posts:\n@foreach ($posts as $post)\n       <img src=\"{{ $post->getFirstMediaUrl('', 'thumb') }}\">\n@endforeach. ",
    "AlhasanIQ": "installed perfectly. weird ...\n```\n$ composer require spatie/laravel-medialibrary\nUsing version ^6.9 for spatie/laravel-medialibrary\n./composer.json has been updated\nLoading composer repositories with package information\nUpdating dependencies (including require-dev)\nPackage operations: 7 installs, 0 updates, 0 removals\n  - Installing spatie/temporary-directory (1.1.3): Downloading (100%)\n  - Installing spatie/image-optimizer (1.0.14): Downloading (100%)\n  - Installing intervention/image (2.4.1): Downloading (100%)\n  - Installing league/glide (1.3.0): Downloading (100%)\n  - Installing spatie/image (1.4.1): Downloading (100%)\n  - Installing spatie/pdf-to-image (1.2.2): Downloading (100%)\n  - Installing spatie/laravel-medialibrary (6.9.0): Downloading (100%)\nintervention/image suggests installing ext-imagick (to use Imagick based image processing.)\nintervention/image suggests installing intervention/imagecache (Caching extension for the Intervention Image library)\nspatie/laravel-medialibrary suggests installing php-ffmpeg/php-ffmpeg (Required for generating video thumbnails)\nspatie/laravel-medialibrary suggests installing league/flysystem-aws-s3-v3 (Required to use AWS S3 file storage)\nWriting lock file\nGenerating optimized autoload files\n\nIlluminate\\Foundation\\ComposerScripts::postAutoloadDump\n@php artisan package:discover\nDiscovered Package: fideloper/proxy\nDiscovered Package: laravel/tinker\nDiscovered Package: nunomaduro/collision\nDiscovered Package: laracasts/flash\nDiscovered Package: prettus/l5-repository\nDiscovered Package: infyomlabs/laravel-generator\nDiscovered Package: infyomlabs/adminlte-templates\nDiscovered Package: laravelcollective/html\nDiscovered Package: laravel/socialite\nDiscovered Package: intervention/image\nDiscovered Package: spatie/laravel-medialibrary\nPackage manifest generated successfully.\n```. \n",
    "ronydebnath": "Thank you for enlighten me. The temporary directory in storage folder has been creating with the root user group  which was restricting the package from creating the conversions folder for a specific media.\ndd'ing the $directoryPath returns\n\"/var/www/storage/medialibrary/temp/gqhU9vSpveO4CvvV0hlSgHNxMvHX9Zwn\"\nand i have solved the situation by adding chown function while making directory in path method of this fantastic package:\nif anyone is facing the same situation like me, here is what is did: \n```\npublic function path(string $pathOrFilename = ''): string\n    {\n        if (empty($pathOrFilename)) {\n            return $this->getFullPath();\n        }\n    $path = $this->getFullPath().DIRECTORY_SEPARATOR.trim($pathOrFilename, '/');\n\n    $directoryPath = $this->removeFilenameFromPath($path);\n\n    if (! file_exists($directoryPath)) {\n        mkdir($directoryPath, 0777, true);\n        chown($directoryPath, 1000);\n    }\n\n    return $path;\n}\n\n```\nwhere 1000 is the uid of the user in my docker instance. \nit could be nice addition to the medialibrary.php  to let user set the user/group name while creating the directory and avoid such circumstances. . i had to modify in vendor/spatie/temporary-directory/src/TemporaryDirectory.php to change the user from 'root' to my docker instance user so that it can create directory inside of the medialibrary directory in laravel storage folder. \nIf the queue operation doesn't work, then use nonQueued() on conversion\nDocumentation here:\nhttps://docs.spatie.be/laravel-medialibrary/v6/converting-images/defining-conversions/#queuing-conversions. ",
    "sezaiozarslan": "php artisan media:regenerate\n 1/1 [\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593] 100%All done, but with some error messages:\nMedia id 2: mkdir(): Permission denied\nAll done!\nsudo chmod 777 -R storage/\nphp artisan media:regenerate\n 2/2 [\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593] 100%All done, but with some error messages:\nMedia id 5: fopen(/home/.../public/media/5/conversions/20171203_162520-big.jpg): failed to open stream: Permission denied\nMedia id 6: fopen(/home/.../public/media/6/conversions/20171203_162520-big.jpg): failed to open stream: Permission denied\nAll done!\nsudo chmod 777 -R public/media/\nphp artisan media:regenerate\n 2/2 [\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593] 100%All done!\nIt works :) But when I upload a new photo :\nphp artisan media:regenerate\n 3/3 [\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593\u2593] 100%All done, but with some error messages:\nMedia id 7: fopen(/home/.../public/media/7/conversions/20171203_162520-big.jpg): failed to open stream: Permission denied\nAll done!\nBecause new variation has \"-rwxrwxrwx\" permission.\nDefault variation permission must be \"777\"\n. ",
    "nessimabadi": "Thanks for the help.\nNow lets wait for intervention/image V3. ",
    "ashwani23": "Hi @sebastiandedeyne \nCan you please share that what database driver and storage engine are you using?. ",
    "phamels": "Exact same issue with same specifications.\nhasMedia() on model returns nothing, making manual query, no problem.\nAlso, $model->hasMedia() returns false.\nModels contains: \nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMedia;\nimplements HasMedia\nuse HasMediaTrait;\nSaving media was not an issue, but can't seem to retrieve it.. Ok, update:\nSo doing getMedia() returns nothing, but specifying a specific collection does work for example: getMedia('collection')\ndocumentation ftw :-). ",
    "flexchar": "Just to note, came exactly around the same issue. Been digging for a few hours. \nI don't know if I'm misusing something or so but the very least I'd expect documentation to point this out. Now it's not even mentioned. https://docs.spatie.be/laravel-medialibrary/v7/basic-usage/retrieving-media :(\nUsed with comments that belong to post as realationship hasMany.\n$post->comments[3]->getFirstMedia() returns an empty collection, where as$post->comments[3]->getFirstMediaUrl('comments') returns as expected.\nThanks for the package thou!\n. ",
    "audetcameron": "Having the same issue, I had to pass the collection name to getMedia   aka:  ->getMedia('mycollectionname'). can you try       CROP_CENTER  instead of crop-center .  per docs. \nThe following $cropMethods are available through constants of the Manipulations class:\nCROP_TOP_LEFT, CROP_TOP, CROP_TOP_RIGHT, CROP_LEFT, CROP_CENTER, CROP_RIGHT, CROP_BOTTOM_LEFT, CROP_BOTTOM, CROP_BOTTOM_RIGHT.. ",
    "meletisf": "Same problem here. It seems like the FQN of a model, when it contains slashes, causes the query to not return any results.\nIn my case media.model_type = 'App\\Evently\\Organizer\\Models\\Organizer' returns nothing but media.model_type = 'App\\Evently\\Organizer\\Models\\Organizer' works fine. It seems like an assumption is made that models will always reside inside st the App namespace. \nEDIT: Indeed if you pass a collection it does work with the same exact query.. ",
    "adick": "@meletisf can confirm this. My models reside in App\\Models, a simple getMedia() on my models returns an empty collection, whereas getMedia('collection_name') works. . ",
    "jonlod": "Nope that was not the case. Isn't an explanation for the partly cut either.. . ",
    "snipiba": "are u sure with php artisan require command? not composer require? ;). ",
    "afraca": "As long as this is not merged we're undoing the observe(new MediaObserver) in our model and replace it with our own observer by the way. (For those looking for some workaround). Is there somewhere where the observer is currently tested? I couldn't find it but I could try harder if you want.. (If someone else would do this, would you be so kind to backport this to v6? :) ). What to do with the StyleCI failing?. Cool. Keep in mind that json_decode('[]') will NOT return an object, but that was likely why it didn't really surfaced before as most people don't set the manipulations array themselves.. Also really important, I couldn't really figure out why it was often only necessary to replace only the first directory separator.... Yes, that was also what I stated in the original issue for this. I did a quick workaround with realpath on the return value of getTempDirectory  in the TestCase , but that does not fix all issues (only those for my other PR which was already merged). \nI'm not sure where the realpath calls should be placed then, in the path generator classes? You're way more familiar with the library than I am.. ",
    "whdckszxxx": "Try to clear bootstrap/cache directory.. Wow thanks for quick response.\nBy the way, sample url I provided is not permanent. Test case will fail after the file removed.. ",
    "ideadx": "ah, updated the model in config/medialibrary.php file. ",
    "hatcham": "Perfect! Thank you again.. ",
    "simonellensohn": "I've replaced assertEquals with assertContains, feels a lot cleaner now.. ",
    "IshanDemon": "Yes sure. Will do that in few minutes.. I have added a test case for same. Also, you may need to update URL for the image.\nFor now, I am using \nhttps://dthumb-phinf.pstatic.net/?src=%22https%3A%2F%2Fshop-phinf.pstatic.net%2F20180116_81%2Flovelyamie_1516031621836Wd9JR_JPEG%2F39338801478811043_156275708.jpg%3Ftype%3Dm450%22&type=ff120\nPlease replicate it to \nhttps://docs.spatie.be......\nand update branch accordingly.\nlet me know If I am missing something.\n. My Pleasure.\nThanks for providing all these packages. \nYou and your team is doing an awesome job.\n:). ",
    "YoshiMannaert": "I'm having the same issue.\nI've set up everything according to the docs (maybe I missed something) and I'm able to store images and add conversions,\njust retrieving the media doesn't seem to work.\nAlso using:\nLaravel 5.6\nMySQL 5.7\nLaravel Medialibrary 7.0.0. ",
    "gauravmak": "We found that using the NO_WRAP constant on the Android side created a base64 encoded string which worked properly. Thanks.. ",
    "roarkmccolgan": "I think you're right,\nI'll close for now and post solution if I find it.\nThanks!. Hi @hugo i n bet found the source of the issue but re-publishing the config\nfile fixed my issue. It was as if the plugin never recognized the one from\nsource control\nHope that helps!\nOn Sat, 31 Mar 2018 at 21:18, Hugo Fabriicio notifications@github.com\nwrote:\n\n@roarkmccolgan https://github.com/roarkmccolgan solved? I have the same\nproblem.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/985#issuecomment-377716608,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ABfpuv7f8oJo6Qd5HgicnIArry3rmtfAks5tj9ZzgaJpZM4S3r5n\n.\n. I meant to say \u2018I never found the source of the issue...\u2019. \n",
    "clarkewing": "Duplicate of #964 . ",
    "beartas": "#964 is closed although the fix hasn't made it into the master branch.\nI also didn't spot #964 . \nMerci beaucoup. ",
    "TVke": "Hi @pdewit \nThank you for the great amount of information. I simulated the situation and found the same problem. \nI found that if you make the image 2px of height it does not gives an error. This made me think that it was a ratio problem and found that it also works if the height is 1px and the width smaller then 385px. \nHope this helps you because as you already pointed out the problem lies in the Intervention image manipulation package.\ngreetings,\nThomas. Hey @laravelish \nI think it is because of the md5(...). \nThe getPath method creates the path (the name not included).\nHope this helps.. Hi @woodgates \nI just copied your code in an empty project with a clean install of the medialibrary and it works perfectly.\nMaybe a composer update would fix it.\nHere is the code I used (that works):\n``` php\nnamespace App\\Models;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Spatie\\Image\\Manipulations;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMedia;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nabstract class AbstractComponent extends Model implements HasMedia\n{\n    use HasMediaTrait;\npublic function registerMediaConversions(WgtMedia $media = null)\n{\n    $this->addMediaConversion('square')\n        ->fit(Manipulations::FIT_CROP, 320, 320)\n        ->sharpen(10);\n\n    $this->addMediaConversion('thumb')\n        ->height(320)\n        ->sharpen(10);\n\n    $this->addMediaConversion('mini')\n        ->height(150)\n        ->sharpen(10);\n}\n\n}\n```\nAnd the model:\n``` php\nnamespace App\\Models;\nuse Spatie\\MediaLibrary\\Models\\Media as BaseMedia;\nclass WgtMedia extends BaseMedia\n{\n}\n```\nHope this helps.\ngreetings\nThomas. Hi @woodgates \nI changed my medialibrary config file like this:\n'media_model' => \\App\\Models\\WgtMedia::class,\n. Hi @woodgates \nIt is possible, but it is probably something that calls the registerMediaConversions method that generates the error. Maybe delete your vendor directory and then composer install again. . Hi @woodgates \nYou can always set a custom table name to use as specified in the laravel docs.. Hi @rafailml \n\n\nthe base url is retrieved from the filesystems.php config file (if you have not touched it, it will take the url set in the .env file at APP_URL)\n\n\nThere is no helper function to list the first images. If you want a cleaner way, you can always place the logic in your model in a static function or maken a scope to clean up the query\n\n\nHope this helps\ngreetings\nThomas. Hi @SamuelNitsche \nI think there may be something wrong with your custom path generator, could you share the content here?\nDefiantly don't forget to read the docs about the custom path generator.\ngreetings\nThomas. Hi @SamuelNitsche \nI have not tested it yet but I see that you did not start with the ->getBasePath() method in getPath maybe this causes the problem.\ngreetings\nThomas. Yes I just checked and there is always a slash in a mime type and it is always present. I can add the check but it is not necessary to do so.. Yes the test fail because the PR at the docs site is not yet merged. After that it will pass.\n(this is the PR I was talking about: https://github.com/spatie/docs.spatie.be/pull/272). That is true, I'll remove the extra check. ",
    "harryprasath": "Thanks for your reply please look in to this soon. But its not fixed yet.. Can we close it once its fixed?. ",
    "pankajsanam": "I am having the same problem. Hopefully you guys figure something out.. ",
    "estaticfear": "i'm having the same problem :(. ",
    "bitfumes": "Okay I need to wait for their support. Thanks for this information.. ",
    "tomlankhorst": "Okay... well hopefully this PR gets merged. \nhttps://github.com/laravel/framework/pull/23753\nThat will make maintenance easier. . Trying to find time to do this but I'm a little bit short. \nWill try later this week. . There were '/' slashes inserted here, I removed this as they seemed to be inserted by getMediaDirectory already. . ",
    "ediblemanager": ":|\nThanks for that, @freekmurze ...and apologies. My excuse? It's Friday.\nIf I may ask another question: the Conversion now doesn't error, but also doesn't change the format of the image - I'm still seeing uploaded jpg's as jpg's in storage/app/public/x. No errors in logs. I can create a new ticket for this if you think it's unrelated.. ",
    "laravelish": "Sorry this can be closed because the url is generated based on user ip or something like that i think. this fixed my issue https://docs.spatie.be/laravel-medialibrary/v7/api/adding-files#usingname\nnow i can use str_slug($model->name)\nThanks for this amazing package.. hmm but it creates a folder inside str_slug($media->name) like this folder structure\nFolder_title\n         -- fa3a8a3eab2e05db2fed915333a2f00c\n  -- fa3a8a3eab2e05db2fed915333a2f00c512.jpg\n\nwhy is that ?. ",
    "mydnic": "I have the same issue on my local environment, really weird. On my test server it's working fine. Is it possible that the method addMediaFromUrl() is checking if the Media URL is accessible from the internet ??\ncc @freekmurze . Nevermind, I found the problem:\nFor some reason, it's not working if using HTTPS in local development with Laravel Valet.\nI \"unsecured\" my local site and now it's working fine\n```bash\n$ art tinker\nPsy Shell v0.9.9 (PHP 7.2.9 \u2014 cli) by Justin Hileman\n\n\n\n@fopen('https://fitnss.test/assets/uploads/yrRPzaw1X4Is2VctOofgw8Q5T2ZIlCMJoYYSHqCO.jpeg', 'r')\nPHP Warning:  fopen(): SSL operation failed with code 1. OpenSSL Error messages:\nerror:14090086:SSL routines:ssl3_get_server_certificate:certificate verify failed in Psy Shell code on line 1\nPHP Warning:  fopen(): Failed to enable crypto in Psy Shell code on line 1\nPHP Warning:  fopen(https://fitnss.test/assets/uploads/yrRPzaw1X4Is2VctOofgw8Q5T2ZIlCMJoYYSHqCO.jpeg): failed to open stream: operation failed in Psy Shell code on line1\n=> false\n\n\n\n\n$ valet unsecure fitnss\nPassword:\nRestarting php...\nRestarting nginx...\nThe [fitnss.test] site will now serve traffic over HTTP.\n$ art tinker\nPsy Shell v0.9.9 (PHP 7.2.9 \u2014 cli) by Justin Hileman\n\n\n\n@fopen('http://fitnss.test/assets/uploads/yrRPzaw1X4Is2VctOofgw8Q5T2ZIlCMJoYYSHqCO.jpeg', 'r')\n=> stream resource #806\n```. \n\n\n",
    "Tjoosten": "Alright will love to it in my free time!\n2018-04-03 11:58 GMT+02:00 Freek Van der Herten notifications@github.com:\n\nFeel free to send a PR to the docs, there's an edit button on every page.\n\ud83d\udc4d\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/1012#issuecomment-378195953,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AE6y6XQgoyuov4pg1d-a_WtP2ICwbsSiks5tk0eugaJpZM4TCdO0\n.\n. \n",
    "elwin": "Ahh easier than I thought \ud83d\ude05\nThank you!. ",
    "thisiskaden": "Add visibility header in config file.\n```\nconfig/medialibrary.php\n'remote' => [\n    /*\n     * Any extra headers that should be included when uploading media to\n     * a remote disk. Even though supported headers may vary between\n     * different drivers, a sensible default has been provided.\n     *\n     * Supported by S3: CacheControl, Expires, StorageClass,\n     * ServerSideEncryption, Metadata, ACL, ContentEncoding\n     */\n    'extra_headers' => [\n        'CacheControl' => 'max-age=604800',\n        'visibility' => 'public',\n    ],\n],\n\n```\n. ",
    "netanelwebninja": "@thisiskaden Thanks !. ",
    "lostlian": "@thisiskaden @netanelwebninja this worked for the main file. but conversion and responsive images still are still private. \nhow do you guys handle conversions and responsive images?\nUpdate\nFound the solution. \nI was running jobs with horizon and after restart the horizon daemon it cached the proper headers. Looks like jobs cache the current state of the code and if any changes it wont be applied to jobs after restart the daemon. @Jasper9041 Hi Jasper. I trully have spent some time trying to know why the keepOriginalImageFormat is not working for me.\nVersion 7.5.2\n```\nprotected $sizes = ['xs', 'sm', 'md', 'lg','xl','full','thumb'];\nprotected $size = [\n        'xs'    => 80,\n        'sm'    => 150,\n        'thumb' => 300,\n        'md'    => 600,\n        'lg'    => 1200,\n        'xl'    => 1900,\n    ];\npublic function registerMediaConversions(Media $media = null)\n    {\n        foreach ($this->sizes as $size) {\n            if ($size!='full') {\n                $width = $this->size[$size];\n                $height = $this->size[$size];\n            $mediaConversion = $this->addMediaConversion($size);\n            $mediaConversion = $mediaConversion->width($width);\n            $mediaConversion = $mediaConversion->height($height);\n            $mediaConversion = $mediaConversion->keepOriginalImageFormat();\n\n            Log::info('Should keep Original format ' . $mediaConversion->shouldKeepOriginalImageFormat());\n            Log::info('Result Extension ' . $mediaConversion->getResultExtension());\n        }\n    }\n}\n\n```\nThe uploading file is logo.png\nThe Output is:\nShould keep Original format 1\nResult Extension jpg\nI spent sometime in the conversion class and found something odd.\n```\npublic function getResultExtension(string $originalFileExtension = ''): string\n    {\n        if ($this->shouldKeepOriginalImageFormat()) {\n            if (in_array($originalFileExtension, ['jpg', 'pjpg', 'png', 'gif'])) {\n                return $originalFileExtension;\n            }\n        }\n    if ($manipulationArgument = $this->manipulations->getManipulationArgument('format')) {\n        return $manipulationArgument;\n    }\n\n    return $originalFileExtension;\n}\n\npublic function getConversionFile(string $file): string\n{\n    $fileName = pathinfo($file, PATHINFO_FILENAME);\n\n    $extension = $this->getResultExtension(); // The file extension is not send in the parameters\n    //The extension will always return jpg as defined in the constructor\n\n    if (! $extension) {\n        $extension = pathinfo($file, PATHINFO_EXTENSION);\n    }\n\n    return \"{$fileName}-{$this->getName()}.{$extension}\";\n}\n\n```\nThe method getResultExtension is always being called without parameters. So it will always return the format defined in the constructor. (in this case jpg)\nam i doing something wrong?. I had this same issue. An the solution was to be quite simple. I was running jobs with horizon and after restart the horizon deamon it started to find the proper disk. Looks like jobs cache the current state of the code and if any changes it wont be applied to jobs. I found the problem. \nWhen adding media file i was setting the file name. And it needs to contains the extension of the file. So i changed.\nBefore\n```\n        $name = md5($this->id);\n    $media = $this\n                ->addMedia($photo)\n                ->setName($name)\n                ->setFileName($name)\n                ->withResponsiveImages()\n                ->toMediaCollection($this->media_collection);\n\n```\nnow\n```\n        $name = md5($this->id);\n        $extension =$photo->extension(); //$photo is a Illuminate\\Http\\UploadedFile instance\n    $media = $this\n                ->addMedia($photo)\n                ->setName($name)\n                ->setFileName($name.'.'.$extension)\n                ->withResponsiveImages()\n                ->toMediaCollection($this->media_collection);\n\n```. ",
    "rslanzi": "Sorry, solved.\nThe problem was related to a queued conversion and the max_file_size.. ",
    "omarrida": "I have a similar need for a different use-case. My existing system contains thousands of images managed by the media-library.\nI recently registered a new conversion to support transparent .png images (essentially maintaining the original uploaded image with some optimizations). The problem is that now ALL my media arrays are returning the new conversion type's url, even for models which were created before I registered the conversion. I have to do ugly client-side checks to figure out which image url to load.\nP.S. I know that I'm an asshole for not sending a postcard yet. Sorry Spatie, I will do it soon. Promise.. ",
    "matthewgovaere": "Hmm, is there anything specific I need to do in order for the generated custom properties to show up in the database?\nI'm adding the file like this...\n$user\n    ->addMedia($request->file('image'))\n    ->toMediaCollection('avatar');\nand added the conversions like this...\n```\npublic function registerMediaCollections()\n{\n    $this\n        ->addMediaCollection('avatar')\n        ->useDisk('s3')\n        ->singleFile()\n        ->registerMediaConversions(function (Media $media = NULL) {\n            $this\n                ->addMediaConversion('small')\n                ->format('jpg')\n                ->fit('crop', 300, 300);\n        $this\n            ->addMediaConversion('medium')\n            ->format('jpg')\n            ->fit('crop', 500, 500);\n\n        $this\n            ->addMediaConversion('large')\n            ->format('jpg')\n            ->fit('crop', 1000, 1000);\n    });\n\n}\n```\nThe hasGeneratedConversion method comes up as false, assuming because the custom_properties field in the database doesn't show any of the conversion data, even though the conversions are saved correctly within the file system.. @brendt I'm using 7.3.8, and testing on new media items.\nI did some variable dumps during the methods markAsConversionGenerated and performConversions, and noticed each conversion contains the proper custom_properties fields, but it appears they're never added to the custom_properties for the original media item that actually gets saved to the database.. I've temporarily solved the issue by just adding the custom properties myself, though I think the feature implies this is done automatically, so the solution below is just for anyone else running into the same problem and needs a quick fix.\n$user\n    ->addMedia($request->file('image'))\n    ->withCustomProperties([\n        'generated_conversions' => [\n            'small' => true,\n            'medium' => true,\n            'large' => true,\n        ]\n    ])\n    ->toMediaCollection('avatar');\nHoping to find some time soon to submit a PR with a permanent fix.. ",
    "intrepidws": "My SuperUser model doesn't have a one on one relation with User, it actually extends User like this:\n```\nnamespace App\\Models;\nuse App\\Models\\User as BaseUser;\nclass SuperUser extends BaseUser\n```\nSo when I try to access the media, it does so with the assumption that it will be found with a model_type of App\\Models\\SuperUser instead of App\\Models\\User. While overriding the getMorphClass method, from within SuperUser, seems to work for other MorphToMany relationships that exist on User, it does not work here.\nI thought about the morphMap solution as well, but that seems to provide a mapping from database to class, which isn't really what I need.\nI have resorted to doing the following, which I don't love, but which does work:\n$media = Media::whereModelType('App\\Models\\User')->whereModelId($id)->get();. Well, that's what I get for working late at night. My original solution does work, I just didn't have any media attached to the model that I was testing. Sorry for bothering you. For anyone else who finds this, overriding the getMorphClass method on my SuperUser model works:\npublic function getMorphClass()\n    {\n        return 'App\\Models\\User';\n    }. ",
    "sahtepetrucci": "For anyone interested, I simply ended up by adding images to the blog content including their srcset, but not including their sizes & onload attributes.\nWhen rendering images I dynamically add \"sizes=1px\" property to each image on the server side, then I run a jQuery function to get each image and set their \"sizes\" attribute.\n. Hi @brendt , thank you for sharing your thoughts on this.\nI too always use medialibrary in the context of my Post model. I then list a post's attachments in the sidebar of an editing window and I provide an option to occasionally add them to the WYSIWYG editor. I like the way the medialibrary works as I don\u2019t want to have a separate \u201cMedia\u201d panel, I just want to keep all attachments live under their respective posts in order to prevent clutter. But anyway it\u2019s good to know that we also have an easy way to use the library without a related model. :)\nI think storing the same content twice (both for the editor and for the frontend) would be a bit redundant, but maybe parsing it before rendering it on the frontend + using some frontend caching would be preferable.\nFor the sizes, I was thinking that I had already managed to resolve it thanks to responsive images + progressive loading options provided by the library.  I\u2019m not sure what could go wrong with this approach but I\u2019m happy to get some more thoughts about it. \nWhen you render all the images (within the content ) with the \u201csizes=1px\u201d tag on the first go, you only get the blurry svg previews (which are already prepared by the library), and then when you dynamically set the sizes attribute via JavaScript, browsers read the srcset attribute and automatically download the most appropriate version from the responsive images folder, as it was also documented in the media library documentation. \nIf I\u2019m not wrong, this approach makes it unnecessary to deal with different size presets (except thumbnails which require a square format - I use a separate media conversion for them). \nThe original src attribute always remains as the fallback, and I also consider keeping this under control by limiting the maximum dimensions of the main image to 1024 x 1024 pixels by the following code piece on the upload process:\n```\nrequest()->validate([\n    'upload' => ['image']\n]);\n$file = request()->file('upload');\n$image_size = getimagesize($file);\nif ($image_size[0] > 1024 or $image_size[1] > 1024) {\n    Image::load($file)->width(1024)->save();\n}\nreturn $this\n    ->addMedia($file)\n    ->withResponsiveImages()\n    ->toMediaCollection('attachments');\n```\nAnd in my Post model, I use an accessor for the parsed content (a single line for now):\npublic function getParsedContentAttribute()\n{\n    $content = str_replace(\"<img\", \"<img sizes=\\\"1px\\\"\", $this->attributes['content']);\n    return $content;\n}\nAnd finally, I use this piece of JavaScript to find the appropriate size for each image in the post content:\n<script defer>\n    jQuery('.blog-image').each(function(){\n        jQuery(this).attr('sizes', Math.ceil(this.getBoundingClientRect().width/window.innerWidth*100)+'vw');\n    });\n</script>\nThis is how I managed to make it work for my case and I just wanted to share it with you Brent and also for anybody who may require working for such a thing.. > The real image is loaded slightly later than when it could be loaded if you knew the sizes beforehand.\nYou made a very good point and I also figured out that we could consider disabling that \"load SVG first + find the appropriate image with JS while displaying the content\" approach in the future.\nSo I changed my way a little and decided to include the correct sizes parameter directly when saving the content to the database, but as an additional \"data-sizes\" attribute. This makes me able to still support the previous approach upon our future needs.\nHere is how I implemented this.\nNote: In order this to work properly, your editor width and the actual content holder in frontend should be identical or at least close enough, because we calculate the sizes according to the images' actual sizes in the editor window.\n1) In the post editor, just before saving the content, I grab all the included images' sizes and add them as \"data-sizes\" attribute:\n```\nsave: function(formData) {\njQuery('.blog-image').each(function(){\n    jQuery(this).attr('data-sizes', Math.ceil(this.getBoundingClientRect().width/window.innerWidth*100)+'vw');\n});\nlet content = jQuery('#editor1').summernote('code');\n...\n\n```\n2) Before displaying the content, In the parsed post content accessor, I decide to/not to use those attributes we already saved:\npublic function getParsedContentAttribute()\n{\n    if (config('medialibrary.responsive_images.use_tiny_placeholders')) {\n        return str_replace(\"<img\", \"<img sizes=\\\"1px\\\"\", $this->attributes['content']);\n    } else {\n        return str_replace(\"data-sizes=\", \"sizes=\", $this->attributes['content']);\n    }\n}\n3) Finally, we display the content directly (without a JS manipulation) if sizes attributes are already set, or dynamically calculate them if we enabled tiny placeholders:\n<script defer>\n    jQuery('.blog-image[sizes=1px]').each(function(){\n        jQuery(this).attr('sizes', Math.ceil(this.getBoundingClientRect().width/window.innerWidth*100)+'vw');\n    });\n</script>. ",
    "Numline1": "@brendt thanks. It was probably missed, from what I gather from the commit history, the change didn't work up until 7.1?. Hi, the way we've discovered this issue was an upgrade to Laravel 5.6 (we were on 5.3 previously). This also came with medialibrary upgrade. All of these changes went through a regular lifecycle, meaning being deployed on dev and test environments first. Composer.json and composer.lock were already updated at this point, the package was working fine (with all the changes to conversions made in model classes). The day we deployed to production, everything was fine as well (This was 7.0.0, the version was only restrained to stay within the same major release), until someone hit \"composer update\" accidentally. This updated medialibrary to 7.1.3, which somehow started the issue with conversions / renamed thumbnails. This was a huge messup (mostly on our side, but the thumbnail issue took us by surprise).\nThe commits I was referring to were:\nhttps://github.com/spatie/laravel-medialibrary/commit/f9e1f015607d6dbfe42db4c14b5d37f091f5541a\nand the release message saying \"Fix for renaming files when not all conversions are present\" (I'm not sure what this refers to exactly).\nJust to sum up, I'm not blaming anyone (especially not Spatie guys), but something went wrong and I'm trying to figure out what and why (why was 7.0 working fine). Thanks for any feedback.. Hi, I'll check our commit history and respective composer.jsons and composer.locks to see what went wrong. I'm sure it was an issue on our side, just gotta find how it happened. Thanks for the help, I'll post an update if I find something that could explain this.. ",
    "woodgates": "Hi @TVke \nI updated composer and I still get the same error. I'm using Laravel 5.6 and \"spatie/laravel-medialibrary\": \"^7.0.0\"\nDid you changed the medialibrary .php? If so, how? I ask because I'm having the same error no matter the 'media_model' I set:\n'media_model' => Spatie\\MediaLibrary\\Models\\Media::class,\n\nOR\n'media_model' => App\\Models\\WgtMedia::class,\n\ngives me the same error.\n. Hi @TVke \nCan it be related with the access level of the Classes, or the folder permissions?. @brendt \nThanks Brendt, I'll try to make it work that way.\nJust one last comment: In this case, as my model is named WgtMedia laravel is looking for the \"wgt_media\" table in my db. Maybe it can be mentioned in the Docs that your table name should be according to the custom Model Name.\nMy Best.. Great, thanks!. ",
    "jwtea": "@brendt Thanks for the explanation of this issue. However i still can't use the implementation of the custom model from the custom path generator.\nWhen trying to get an attribute from a relation ie $media->fileGroup->name i get Trying to get property 'name' of non-object\nIf i replace the $media variable with a new instance of my custom media model $media = \\App\\Models\\Media::find($media->id) then it works fine ? \n. Yeah i have configured that to use the model in App\\Models. The definition of which is: \n```\nuse Spatie\\MediaLibrary\\Models\\Media as BaseMedia;\nclass Media extends BaseMedia \n.<?php\nnamespace App\\Spatie\\MediaLibrary;\nuse \\Spatie\\MediaLibrary\\Models\\Media;\nuse App\\Models\\Product;\nclass ModelPathGenerator extends \\Spatie\\MediaLibrary\\PathGenerator\\BasePathGenerator\n{\n    /\n     * Store the category for the given media\n     \n     * @var String\n     /\n    protected $category;\n/**\n * Store the type for the given media\n *\n * @var String\n */\nprotected $type;\n\n/**\n * Get the path for the given media, relative to the root storage path.\n *\n * @param \\Spatie\\MediaLibrary\\Models\\Media $media\n *\n * @return string\n */\npublic function getPath(Media $media): string \n{\n    //@todo\n    $media = \\App\\Models\\Media::find($media->id);\n    if(is_a($media->model, Product::class)) {\n\n        $this->category = $this->sanitizeForFS($media->model->category->name);\n        $this->type = $this->sanitizeForFS($media->model->type->name);\n\n        if($media->collection_name == 'main_image'){\n            return $this->productMainImagePath($media);\n        } else {\n            return $this->productRepositoryImagePath($media);\n        }\n\n    } else {\n        return $media->model_type.'/'.$this->getBasePath($media).'/';\n    }\n}\n\n/**\n * Get base path\n * @param Media $media\n * @return string\n */\nprotected function getBasePath(Media $media): string\n{\n    return $media->file_name;\n}\n\n/**\n * Strip any characters out that we dont want for storing to fs\n *\n * @param String $string\n * @return string\n */\nprotected function sanitizeForFS(String $string): string\n{\n    return  preg_replace( '/[^a-z0-9]+/', '-', strtolower($string));\n}\n\n/**\n * Return path for a products main image.\n *\n * @param Media $media\n * @return string\n */\nprotected function productMainImagePath(Media $media): string \n{\n    return $media->model_type.'/'.$this->category.'/'.$this->type.'/'.$media->model->id\n        .'/main_image/'.$this->getBasePath($media).'/';\n}\n/**\n * Create file path for storign images stored under a product \n *\n * @param Media $media\n * @return string\n */\nprotected function productRepositoryImagePath(Media $media): string\n{\n    return $media->model_type.'/'.$this->category.'/'.$this->type.'/'.$media->model->id.'/'\n        .$media->fileGroup->name.'/'.$this->getBasePath($media).'/';\n}\n\n}. So this issue is no longer persisting, I rebuild the vagrant box i was using and installed again and it's started working. So not sure what is happening. Thank you for the time, i'll update one here if it comes back.. Ah i found another reference in the Conversion class getConversionFile function. \nWould there be any interest in making this configurable? . Thanks @brendt for taking the time to reply to this. \nSo the reasoning for doing this was for the way that images are loaded on IOS using the @2x and @3x notation for screen sizes so that images are displayed in the correct resolution.\nWhile its fine to have the -@2x, it means that the file must be named file-.ext which just bugged me. This is the only reason i've had for this. \nI understand that this is not going to be a common use case for most people.. @brendt So it's for a native IOS application which needs to pull in images remotely, in order to get the correct pixel density IOS looks for the files with @2 and @3.\nThanks for the info about responsive images though!. ",
    "scheMeZa": "I'm stumped,\nI've moved views around, came back to the problem to show someone else, and now it works.\nI promise I'm not going insane!. ",
    "xron89": "Issue resolved you have to pass a collection name to getMedia(); if you're not using the \"default\" collection. in my instance getmedia('banner');. Yes, I also don't see it in the documentation, worth updating to accommodate. Well done on resolving your issue!. ",
    "techdaddies-kevin": "Thank you for posting your solution. I was about to tear my hair out trying to figure out why this wasn't working. The docs should definitely address this if they don't already (I didn't see this noted anywhere). Thanks so much for all of your advice. We are currently using GD but I will switch over to Imagick today and add a few checks to hopefully catch this on our end after the fact!. ",
    "marksparrish": "You need to delete it from your composer.json file.  . I found this on laracast.com\nhttps://laracasts.com/discuss/channels/laravel/how-properly-remove-package-with-auto-discover?page=1. ",
    "b3smith13": "@marksparrish What would it be called in there? I don't see it.\n{\n    \"name\": \"laravel/laravel\",\n    \"description\": \"The Laravel Framework.\",\n    \"keywords\": [\"framework\", \"laravel\"],\n    \"license\": \"MIT\",\n    \"type\": \"project\",\n    \"require\": {\n        \"php\": \">=7.1.3\",\n        \"fideloper/proxy\": \"~4.0\",\n        \"laravel/framework\": \"5.6.*\",\n        \"laravel/tinker\": \"~1.0\"\n    },\n    \"require-dev\": {\n        \"filp/whoops\": \"~2.0\",\n        \"fzaninotto/faker\": \"~1.4\",\n        \"mockery/mockery\": \"~1.0\",\n        \"nunomaduro/collision\": \"~2.0\",\n        \"phpunit/phpunit\": \"~7.0\",\n        \"symfony/thanks\": \"^1.0\"\n    },\n    \"autoload\": {\n        \"classmap\": [\n            \"database/seeds\",\n            \"database/factories\"\n        ],\n        \"psr-4\": {\n            \"App\\\\\": \"app/\"\n        }\n    },\n    \"autoload-dev\": {\n        \"psr-4\": {\n            \"Tests\\\\\": \"tests/\"\n        }\n    },\n    \"extra\": {\n        \"laravel\": {\n            \"dont-discover\": [\n            ]\n        }\n    },\n    \"scripts\": {\n        \"post-root-package-install\": [\n            \"@php -r \\\"file_exists('.env') || copy('.env.example', '.env');\\\"\"\n        ],\n        \"post-create-project-cmd\": [\n            \"@php artisan key:generate\"\n        ],\n        \"post-autoload-dump\": [\n            \"Illuminate\\\\Foundation\\\\ComposerScripts::postAutoloadDump\",\n            \"@php artisan package:discover\"\n        ]\n    },\n    \"config\": {\n        \"preferred-install\": \"dist\",\n        \"sort-packages\": true,\n        \"optimize-autoloader\": true\n    },\n    \"minimum-stability\": \"dev\",\n    \"prefer-stable\": true\n}. ",
    "dhildreth": "Okay, had a good nights rest and came back to it.  I noticed it actually is saving to the DB, but it's throwing that same file not found error.  I decided to install v7.1.6 which includes some improvements around addMultipleMediaFromRequest() (https://github.com/spatie/laravel-medialibrary/issues/629).  This worked and now I'm moving forward again.\ncomposer require spatie/laravel-medialibrary\ncomposer require spatie/laravel-medialibrary:^7.1.6\n$fileAdders = $product\n            ->addMultipleMediaFromRequest(['images'])\n            ->each(function ($fileAdder) {\n                $fileAdder->toMediaCollection('product-images');\n            });. ",
    "kamalkhan": "You may simply add a custom relationship method to your model that you can use to eager load all media collections or even a specific media collection.\nphp\n    // 'attachments' media collection\n    public function attachments()\n    {\n        return $this->media()->where('collection_name', 'attachments');\n    }\nNow, to eager load, you have the following abilities:\n\n\\App\\Listing::with('attachments')->get()\n$listing->load('attachments'). \n",
    "ingageco": "Imagemagick and Imagick I guess are not the same thing. My mistake!. Great! I missed that in the docs. . I'm fine with implementing it myself - but how do i provide the $downloads parameter with a list of media that will choose a derived image? I don't see that being a possibility without rewriting the streaming function. Agree?. ",
    "SamuelNitsche": "Thanks for your help!\nMy path generator looks like this. \n```\n<?php\nnamespace App\\Generators\\CustomPathGenerator;\nuse Spatie\\MediaLibrary\\Models\\Media;\nuse Spatie\\MediaLibrary\\PathGenerator\\PathGenerator;\nclass CustomPathGenerator implements PathGenerator\n{\n    public function getPath(Media $media) : string\n    {\n        return $media->model_id.'/';\n    }\npublic function getPathForConversions(Media $media) : string\n{\n    return $this->getPath($media).'conversions/';\n}\n\npublic function getPathForResponsiveImages(Media $media): string\n{\n    return $this->getPath($media).'responsives/';\n}\n\n}\n```\nI noticed that an existing record for a media is deleted when uploading and overwriting. Is there possibly a timing problem here?. Hm, didn't see this. At the moment I cannot test this, but I will give it a try. I think this should be documented.\nAnyways, thank you very much! I will give you feedback.\n[Edit]\nNope, that didn't work. Some other ideas? :P. Sorry for not responding quite a while. I paused the project I was working on and must have forgotten this issue. I actually don't know if that was a bug that is fixed now or if I failed with my implementation. Whatever, I tried implementing this again and everything works like expected.. ",
    "basvandertogt": "Sorry, i just figgered out that the move method has a second param to set collection. . ",
    "akazorg": "I believe we can create an image for that video, and use Custom Properties to hold the video url?\n$instance->withCustomProperties([\n          'video_url' => 'http://www.youtube.com/foo',\n      ])\n      ->toMediaCollection('my-video-collection');\nPing: @freekmurze @woodgates . ",
    "variantgroup": "I was able to regenerate the conversions with the v7 naming convention. . ",
    "fernandocoronatomf": "Oh that's cool, thanks @freekmurze ... Is that mentioned on the documentation? I searched but couldn't find it. . @tim0991 That`s just what I needed... So I ended-up having another model just to save the media and returning its ID so I can reuse on the other entity (the one not saved yet)... My case was also for a dropzone file\n``. Hi @nyeyint... \nWhat I did basically was creating a new table, let's call it EntityMedia.\nI upload the file there using dropzone, and it creates a new entity with its own id...\nThen I use this ID on the main entity.... ",
    "tim0991": "@freekmurze So i still can't get media id before model save? \nSometime, there is a dropzone case, page need media id,before page submit\uff0c and dropzone don't kown which the model is. ",
    "nyeyint": "Hi @fernandocoronatomf, @freekmurze \nCan you please explain little bit more.I'm trying to integrate my laravel app with vuejs and dropzone .I already try many way to upload and manage media.I still didn't found proper way. my problem is also to upload media before saving entity like @fernandocoronatomf said.Please give me any refrence links if u have.\nThanks! . Hi @fernandocoronatomf ...\nYou mean save media to media talbe with EntityMedia model name and return url or id like this.\n.\nthat work but.how about duplication in media table ?\n. ",
    "e200": "So, those building APIs still can't upload files in background while user keep filling a form... :/. ",
    "patrickomeara": "This functionality would be useful for implementing a markdown editor. I have had to make a model that only persists an id to addMedia to.\n@freekmurze maybe an idea for next release?. Thanks @freekmurze . ",
    "Dresing": "Beware that the interface Spatie\\MediaLibrary\\HasMedia with method media() gets implemented by Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait. You may experience conflicts if you define relations with the same name yourself.. ",
    "krns": "We also have the same problem. We are developing inside a docker container. \nDo you have some ideas what system settings could cause this problem @freekmurze?. We also face this issue.. using spatie/laravel-medialibrary 7.5.5\nBtw looks similar to #1062 . ",
    "simonbowen": "I'm also getting this issue on a standard ubuntu 18.04 server. Any one got any pointers?. ",
    "virtruvio": "Hey freekmurze\nProbably won't get bandwidth to write Unit Tests for this for a while.  But this mod to getResultExtension method in Conversions class should fix this.\n```\n  /\n  * Get the extension that the result of this conversion must have.\n  /\n  public function getResultExtension(string $originalFileExtension = ''): string\n  {\n$supportedFormats = ['jpg', 'pjpg', 'png', 'gif'];\nif ($this->shouldKeepOriginalImageFormat() && in_array($originalFileExtension, $supportedFormats)) {\n  return $originalFileExtension;\n}\n\nif ($manipulationArgument = $this->manipulations->getManipulationArgument('format')) {\n  return $manipulationArgument;\n}\n\nreturn 'jpg';\n\n}\n```. You're timely.  I just issued an internal request that we try using the toHtml() method in a Twig extension.  I'll check both toHtml() and img(), and let you know our results.  Thanks for the swift response with ideas.. @sebastiandedeyne Both approaches work, both with and without an explicit extension to Twig.  Thanks for the guidance.  I'll assume that these under-the-hood methods will remain in place as part of the methodology to output HTML for responsive images, and that CI of the package won't likely break our implementations.   We'd spent more time on this than I feel comfortable admitting. I appreciate your insight.. ",
    "spatie-bot": "Dear contributor, \nbecause this issue seems to be inactive for quite some time now, I've automatically closed it. If you feel this issue deserves some attention from my human colleagues feel free to reopen it.. Dear contributor, \nbecause this issue seems to be inactive for quite some time now, I've automatically closed it. If you feel this issue deserves some attention from my human colleagues feel free to reopen it.. Dear contributor, \nbecause this issue seems to be inactive for quite some time now, I've automatically closed it. If you feel this issue deserves some attention from my human colleagues feel free to reopen it.. ",
    "cstriuli": "Hi @brendt ,\nI had something like this\nphp\nQueue::after(function (JobProcessed $event) {\n    ....listening PerformConversions...\n});\nBut I was wrong and as you said, I just needed to listen the ConversionHasBeenCompleted event.\nThanks! \n. ",
    "mradamwood": "@brendt I'm not doing anything controversial that I can see. This is the code I'm using to move an image\nphp\n$media = TempUpload::where('id',$image['id'])->first();\n$mediaItem = $media->getMedia($image['type'])->first();\n$mediaItem->move($product,$image['type']);\nI've just tested again to make sure that it wasn't the fact that I wasn't using a collection in getMedia() and move() (see #1075) but the original method still doesn't work for me. . The copy test at \\Spatie\\MediaLibrary\\Tests\\Feature\\Models\\Media\\CopyTest uses withCustomProperties()\nphp\n$media = $model\n     ->addMedia($this->getTestJpg())\n     ->usingName('custom-name')\n     ->withCustomProperties(['custom-property-name' => 'custom-property-value'])\n     ->toMediaCollection();. @brendt my test passed when I based it on yours but when I added in another assertion to get the custom property via the new model, not directly from $movedMedia it fails.\nphp\n$this->assertEquals($anotherModel->getMedia('images')->first()->getCustomProperty('custom-property-name'), 'custom-property-value');\n1) Tests\\Feature\\CopyTest::it_can_copy_media_from_one_model_to_another\nFailed asserting that 'custom-property-value' matches expected null.\nYou can also see from below that the custom properties aren't saved to the database.\n\nLooks like the info is stored in $movedMedia but doesn't save to database.\nWith the change from $newMedia->custom_properties = $this->custom_properties; to \n->withCustomProperties($this->custom_properties) the test passes.\nshell\nOK (1 test, 5 assertions)\n. Sorry Freek, lack of detail in original post:\nQueues are running (tried sync and db)\nDoesn't work when using  -> nonQueued() either. Found the problem in case anyone else runs into it.\nI'm basically using the move example from the docs\n```php\n$mediaItem = $model->getMedia()->first();\n$movedMediaItem = $mediaItem->move($anotherModel);\n```\nHowever looking at the src move() takes a collection as an optional second parameter and defaults to 'default'. I've updated my move to set the collection again and this kicks in the conversion (my conversions are restricted by collection)\nphp\n$movedMediaItem = $mediaItem->move($anotherModel,'product');. ",
    "chadjw": "I see that just about all of the tests for addMediaFromUrl use images within this location in your documents: \nhttps://docs.spatie.be/images/medialibrary/\nCan you upload an image to this location that has a space in the image name (ex. https://docs.spatie.be/images/medialibrary/image name with space.jpg)?. Test added and run successfully. I also tested without my change to make sure it was broken prior to the change.. ",
    "rachid804": "An other option is to use API Resource or laravel fractal, for API resource I will something like:\n```php\n//app/Http/Resources/ProductResource.php\nclass ProductResource extends Resource\n{\n    /\n     * Transform the resource into an array.\n     \n     * @param  \\Illuminate\\Http\\Request $request\n     * @return array\n     /\n    public function toArray($request)\n    {\n        return [\n           'image' => $this->media->getFullUrl(),\n           ...\n    }\n}\n```\nAnd in your controller:\nphp\n$product = Product::with(\"product_image\")->get();\nreturn new ProductResource($product);. ",
    "gbdematos": "@dfoxxdfoxx can you clarify which settings were wrong? I'm having the same issue.. ",
    "batFormat": "+1, some issue( \n@dfoxxdfoxx How did you decide? . Soldved in #1281. Solved a problem.\nThe problem was that the standard job PerformConversions uses SerializesModels.\nTherefore, I did the same job but without SerializesModels.\nAnd redefined it in the configuration in medialibrary.php.\n/*\n     * Here you can override the class names of the jobs used by this package. Make sure\n     * your custom jobs extend the ones provided by the package.\n     */\n    'jobs'                     => [\n        'perform_conversions'        => App\\Jobs\\PerformConversions::class,\n        // 'perform_conversions'        => Spatie\\MediaLibrary\\Jobs\\PerformConversions::class,\n        'generate_responsive_images' => Spatie\\MediaLibrary\\Jobs\\GenerateResponsiveImages::class,\n    ],\n. ",
    "rjsworking": "Hi @freekmurze. \nThank you very much. So simple. Sorry for the inconvenience.\nCheers. Hi. Perhaps because it reads the config/database.php configuration file?\nCheers. ",
    "FabienLucini": "Forget one, the same issue here:\nhttps://github.com/spatie/laravel-medialibrary/blob/master/src/HasMedia/HasMediaTrait.php#L45\nEDIT: No sorry, this one is okay because in the trait. ",
    "polashmahmud": "@bhulsman Thank you vary much :+1: . ",
    "Roywcm": "I also need this and tried the hasGeneratedConversion function. \nMaybe i'm doing something wrong, but it looks like the 'generated_conversions' property never get's saved when the conversion is generated?. ",
    "Skullbock": "I noticed that too.\nCreated a PR that seems to fix it:\nhttps://github.com/spatie/laravel-medialibrary/pull/1138. @Elhebert i've moved it, but i don't get why travis is failing. Maybe some other issues there?. Yeah, i agree that it would be strange from my change. Maybe some other PRs invalidated this and it still needs to be checked \ud83d\udc4d . I'm at a loss here... sorry :(\nOn Tue, Jun 19, 2018 at 10:12 AM Dieter Sting notifications@github.com\nwrote:\n\nIf you comment one of those 2 lines\nhttps://github.com/spatie/laravel-medialibrary/blob/master/tests/Unit/Conversion/ConversionCollectionTest.php#L21-L22\nthe test will fail, but won't trigger an exception \ud83e\udd14\nNot sure on where to look next.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/pull/1138#issuecomment-398313917,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ABDY0_OX-avtIbTnLQ3LMMOl199rCJ_uks5t-LJ_gaJpZM4Ud7P_\n.\n\n\n-- \n[image: Logo Weble] Daniele Rosario\nCTO\nWeble Srl\nVia Enrico Fermi, 265\n36100 Vicenza\nufficio: +39 0444 1454934 \nmobile: +39 3283017134 \nweble.it https://www.weble.it/\nhttps://www.facebook.com/pages/Weble/110077192371908?fref=ts\nhttps://twitter.com/Webleit?lang=it\nhttps://www.linkedin.com/company/2470613?trk=tyah&trkInfo=clickedVertical%3Acompany%2Cidx%3A2-2-7%2CtarId%3A1432717146425%2Ctas%3Aweble\nhttps://www.instagram.com/weble.it/\n. @freekmurze thanks for merging! Was the issue with the tests solved?. ",
    "chris-faulkner": "Media::all()\nWorks for me, just add use statement at the top:\nuse Spatie\\MediaLibrary\\Models\\Media;\nOr did I misinterpret what you meant?. ",
    "RoussKS": "Apologies for any inconvenience. We have rechecked the docs and found the explanation on Custom Directory Structure (Path Generator)\nHowever, could you consider that as a feature?\nThanks. ",
    "gareth-ib": "quick structure starter concept... I don't know enough details of those remaining json fields to post suggestions.\nit's more complex but much more efficient. \n```\nCREATE TABLE media\n(\n  media_id          serial NOT NULL,\n  mediamodeltype_id integer NOT NULL,\n  model_id          bigint NOT NULL,\n  collection_id     integer NOT NULL,\n  name              character varying(255) NOT NULL,\n  mediafile_id      integer NOT NULL,\n  mime_type_id      integer NOT NULL,\n  mediadisk_id      integer NOT NULL,\n  manipulations     json NOT NULL,\n  custom_properties json NOT NULL,\n  responsive_images json NOT NULL,\n  order_column      integer,\n  seconds           integer NOT NULL, -- for video files\n  created_at        timestamp(0) without time zone,\n  updated_at        timestamp(0) without time zone,\n  PRIMARY KEY (media_id)\n);\nCREATE TABLE mime_type (\n  mime_type_id  serial NOT NULL,\n  name          character varying(255) NOT NULL,\n  PRIMARY KEY (mime_type_id),\n  UNIQUE (name)\n);\nCREATE TABLE mediamodeltype (\n  mediamodeltype_id serial NOT NULL,\n  name              character varying(255) NOT NULL,\n  PRIMARY KEY (mediamodeltype_id),\n  UNIQUE (name)\n);\nCREATE TABLE mediacollection (\n  mediacollection_id   serial NOT NULL,\n  name                  character varying(255) NOT NULL,\n  PRIMARY KEY (mediacollection_id),\n  UNIQUE (name)\n);\nCREATE TABLE mediafile (\n  mediafile_id      serial NOT NULL,\n  mediafiletype_id  integer NOT NULL,\n  media_id          integer NOT NULL,\n  file_name         character varying(255) NOT NULL,\n  size              integer NOT NULL,\n  width             integer NOT NULL,\n  height            integer NOT NULL,\n  PRIMARY KEY (mediafile_id)\n);\n-- for things like : medialibrary_original, responsiveImageWithPlaceholder, responsiveImage\nCREATE TABLE mediafiletype (\n  mediafiletype_id  serial NOT NULL,\n  name              character varying(255) NOT NULL,\n  PRIMARY KEY (mediafiletype_id),\n  UNIQUE (name)\n);                \nCREATE TABLE mediadisk (\n  mediadisk_id      serial NOT NULL,\n  name              character varying(255) NOT NULL,\n  PRIMARY KEY (media_disk_id),\n  UNIQUE (name)\n);\n```. but probably ideal if the code was setup so the user can define their own structure. ",
    "alfonsobries": "In case someone has the same error in my case was the URL defined in the env file:\nYou should put the URL without the final slash:\nBad: APP_URL=http://my-domain.test/\nGood: APP_URL=http://my-domain.test\n. ",
    "EricBusch": "\nIn case someone has the same error in my case was the URL defined in the env file:\nYou should put the URL without the final slash:\nBad: APP_URL=http://my-domain.test/\nGood: APP_URL=http://my-domain.test\n\nI was having the same issue as @eichgi and @alfonsobries reply fixed it for me.. ",
    "Shobuj718": "The problem may be solved,\nbefore you can  use storage in public folder change APP_URL in  .env and config/App.php\nhttp://localhost change to \nhttp://localhost/project/public\nand run this may be ok.. The problem may be solved,\nbefore you can  use storage in public folder change APP_URL in  .env and config/App.php\nhttp://localhost change to \nhttp://localhost/project/public\nand run this may be ok.. ",
    "fridzema": "I needed to clean svg's before storing it. I have found this way:\n$model->addMediaFromBase64($this->cleanSvg($request->file('logo')), 'image/svg+xml')->usingFileName($request->file('logo')->getClientOriginalName())->toMediaCollection('logo');\nI think you can use this also to encrypt the file.\n. I think this should work, not tested!\n```php\n// Store\n$model->addMediaFromBase64(Crypt::encryptString(base64_encode($request->file('logo'))))->usingFileName($request->file('logo')->getClientOriginalName())->toMediaCollection('logo');\n// Retrieve\nCrypt::decryptString(file_get_contents($model->getMedia('logo')->first()->getPath()))\n```. @shabaz-ejaz i think it should work with all documents. \nDownside of this method is that it is memory/cpu intensive to load the whole file and decrypt it, and you can't use browser caching of the file because you can't use the extension to show the file.. @shabaz-ejaz Maybe you can test first without the encrypt/decrypt part, if that works and the file is displayed properly the encrypt/decrypt can easily be added after that. \nI haven't tested this method myself so i can not give a direct working answer.\nMaybe you can play around with the order of functions like base64_encode(Crypt::encrypt($file)). @shabaz-ejaz Hmmm i think this occurs because of addMediaFromBase64 transform it back to a file, it is not stored as base64 while you encrypt the base64 and not the file. \nMaybe at the retrieving part you can do something like this:\nCrypt::decrypt(base64_encode(file_get_contents($taskMedia->getPath())).. You are right base64 was the method i was personally working with yesterday.\nThis methods are available https://docs.spatie.be/laravel-medialibrary/v7/api/adding-files#addmedia\nI think that the addMedia is enough for your case.\n. Yes, excuse me!. Sorry i overlooked you previous answer a bit..\nThe ->getPath() does output the path and is only needed with file_get_contents() you can try something like:\n$company->addMedia(Crypt::encrypt(file_get_contents($file)))->toMediaCollection();\nMaybe you can try first without the encryption/decryption part and with an simple txt file to easily examine the content of it.\n. I have mad for myself a little example, this goes well:\nphp\n$encrypt = \\Crypt::encrypt(file_get_contents($request->file('file')));\ndd(\\Crypt::decrypt($encrypt));\nWhen i try to do addMedia(\\Crypt::encrypt(file_get_contents($request->file('file')))) i am getting the error File does not exist to.\nThat was exactly why i have to go with base64 approach, i could not find a way to modify the upload file instance before processing. At this point you only have a string left and no path etc. Probably the addMedia wants to perform a getPath() on a string, thats not going to work.\nFor me it was a simple thing where base64 is good enough so i gave up real quick, but for your usecase i think you definitely should search how to modify the instance since base64 and encrypt/decrypt is far from efficient.\n. I think that is the best way to go! \nFor most of my file handling i do it manually with storage api for full control of storage/retrieval if needed. . No problem, good luck @shabaz-ejaz ;). ",
    "FaridAghili": "I've got an idea about how this could be implemented:\nWe set the default file for each collection (or maybe for each conversion as well) like this:\nPHP\npublic function registerMediaCollections()\n{\n    $this->addMediaCollection('image')\n        ->singleFile()\n        ->defaultFile('path/to/file/which/will/be/returned/as/it/is')\n        // This library won't touch the default file, it just get a file name\n        // as string and return it exactly as it is\n        // It doesn't care about file type, or if it exists or not\n        // ->defaultFile('images/user/default.png')\n        ->registerMediaConversions(function (Media $media) {\n            $this->addMediaConversion('resized')\n                ->fit(Manipulations::FIT_FILL, 256, 256)\n                ->background('white')\n                ->nonQueued();\n        });\n}\nThen there will be a new set of methods to retrieve file:\n->getMediaOrDefault()\n->getFirstOrDefaultMedia()\n->getFirstOrDefaultMediaUrl()\nSo, we can use this methods in our frontend code to get the media (or the default one if there is none), and we can continue to use current methods (getMedia, getFirstMedia, getFirstMediaUrl) in our admin panel because we don't need the default file in there.\nI know it's not complete and can get better, just wanted to start.. Sounds cool.\nThere is only one more thing that should be considered.\nThere should be a way to tell whenever you want the fallback to be returned if there is no media. It shouldn't be the default behavior and even if it is, there should be a way to change it, something like:\n$model->getMediaWithFallback()\n$model->getFirstMediaWithFallback()\n$model->getFirstMediaUrlWithFallback(). OK, looking forward to it.. For anyone looking here for a [temporary] solution, add this method to your model (or use it as a trait):\n```PHP\npublic function getFirstOrDefaultMediaUrl(string $collectionName = 'default', string $conversionName = ''): string\n{\n    $url = $this->getFirstMediaUrl($collectionName, $conversionName);\nreturn $url ? $url : $this::$defaultImage ?? '';\n\n}\n```\nAnd define a static property inside your model (You can skip this if you don't mind have a default image):\nPHP\nprotected static $defaultImage = '/images/default/event.png';\nAnd access the first media url, or the default one as simple as:\nPHP\n$model->getFirstOrDefaultMediaUrl('collection');. Maybe php artisan migrate:fresh could help.. First let's define our base trait which all models could use:\n```PHP\n<?php\nnamespace App\\Models\\Concerns;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\ntrait HasMediaCollection\n{\n    use HasMediaTrait;\npublic function registerMediaCollections()\n{\n    foreach (get_class_methods($this) as $method) {\n        if (starts_with($method, 'hasMediaCollection')) {\n            $this->{$method}();\n        }\n    }\n}\n\n}\n```\nThen we can define multiple traits, let's start with one for every models that should have multiple images:\n```PHP\n<?php\nnamespace App\\Models\\Concerns;\nuse Spatie\\Image\\Manipulations;\ntrait HasMultipleImages\n{\n    public function hasMediaCollectionMultipleImages()\n    {\n        $this->addMediaCollection('images')\n            ->registerMediaConversions(function () {\n                $conversion = $this->addMediaConversion('resized')\n                    ->fit(Manipulations::FIT_FILL, 720, 480)\n                    ->background('white');\n            });\n    }\n}\n```\nNeed another collection for models with a single image? Easy:\n```PHP\n<?php\nnamespace App\\Models\\Concerns;\nuse Spatie\\Image\\Manipulations;\ntrait HasSingleImage\n{\n    public function hasMediaCollectionSingleImage()\n    {\n        $this->addMediaCollection('image')\n            ->singleFile()\n            ->registerMediaConversions(function () {\n                $conversion = $this->addMediaConversion('resized')\n                    ->fit(Manipulations::FIT_FILL, 720, 480)\n                    ->background('white');\n        });\n}\n\n}\n```\nAnd finally inside your models, just add the traits:\n```PHP\n<?php\nnamespace App\\Models;\nuse App\\Models\\Concerns\\HasMediaCollection;\nuse App\\Models\\Concerns\\HasSingleImage;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMedia;\nclass ModelWithSingleImage extends Model implements HasMedia\n{\n    use HasMediaCollection, HasSingleImage;\n}\n```\n```PHP\n<?php\nnamespace App\\Models;\nuse App\\Models\\Concerns\\HasMediaCollection;\nuse App\\Models\\Concerns\\HasMultipleImages;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMedia;\nclass ModelWithMultipleImages extends Model implements HasMedia\n{\n    use HasMediaCollection, HasMultipleImages;\n}\n```\n```PHP\n<?php\nnamespace App\\Models;\nuse App\\Models\\Concerns\\HasMediaCollection;\nuse App\\Models\\Concerns\\HasMultipleImages;\nuse App\\Models\\Concerns\\HasSingleImage;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMedia;\nclass ModelWithBoth extends Model implements HasMedia\n{\n    use HasMediaCollection, HasMultipleImages, HasSingleImage;\n}\n```\nRemember that you can make properties like width, height, etc configurable by adding some properties to your model's class and check/read them in your traits.. ",
    "gildastema": "to solve my conversion problem I used image intervention at the registerconverstion method and inside I used a job that will convert to a background task. The conversion goes well but during the recovery of the image j to a problem.. ",
    "vintagesucks": "You may find this useful.. ",
    "mortenscheel": "Thanks guys, sorry for not responding earlier.\nI haven't checked if this is still an issue, but I solved it by using the pbmedia/laravel-ffmpeg package. ",
    "shirshak55": "Is intervention maintained these days?. @kalinichenko88  Ok i may use it but I guess it will create problem with non uuid models right?. @kalinichenko88 Yeah I agree but I usually use other package and I cannot change package code as it will be updated right.. Although my project is fully UUID.  Is there any solutions for such bro ?\nThanks. @kalinichenko88 yeah but that is abit tedious . Cannot we make this package flexible enough to support different key. May be lets say model_id represents other unique key like slug etc.?\nIt is tedious because I will need to change package model incrementing etc to false and override various methods like boot etc to generate uuid for that package and even need to modify every migrations etc..\nThanks. Can we use model slug or other unique key instead of primary key? \nI always like to hide primary key instead of exposing to public?. Yeah thank you bro. . you tried to populate eloquent model which was converted to json.\nI think it is normal behaviour. If you try with user model like this {{ auth()->user() }} i think it will display same.. @bernhardh  I think spatie is going to make it soon too . Yea started using your package and it is good experience also \nhttps://twitter.com/freekmurze/status/1036949435094364160. It would be nice if we can watch development from early stage :D. @nicolasbeauvais hmm it is done by nova media library.\nAnd how is this related to add media. It is case where without queue it works but without it it don't works\nhttps://github.com/jameslkingsley/nova-media-library\nThanks for your concern.. @nicolasbeauvais hmm it is not looking for correct file if you check. It is using relative filesystem. According to that issue job get run before model is saved. But it seem it is getting model correctly. hmm but is it fixed?\n. ",
    "kalinichenko88": "Hi! I published and rewriting database migration. Migration lookls like this;\n```php\n        Schema::create('media', function (Blueprint $table) {\n            $table->uuid('id')->primary();\n        $table->uuid('model_id');\n        $table->string('model_type');\n        $table->index(['model_id', 'model_type']);\n\n        $table->string('collection_name');\n        $table->string('name');\n        $table->string('file_name');\n        $table->string('mime_type')->nullable();\n        $table->string('disk');\n        $table->unsignedInteger('size');\n        $table->jsonb('manipulations');\n        $table->jsonb('custom_properties');\n        $table->unsignedInteger('order_column')->nullable();\n        $table->nullableTimestamps();\n    });\n\n```\nI using medialibrary 6.0 in this project. @bloggervista yes, only one solving may used. @bloggervista not good using different primary keys in one project, IMHO. @bloggervista I rewriting primary keys and foreign keys in all migrations on side packages. Problems may be, but it's good solution for me. \nIf problem will be in business logic Laravel DI or package configuration should solves this :-). @bloggervista I think it's impossible without hacks. ",
    "golamrabbi3": "Hi, My question's different. How can I set default value to this $table->uuid('model_id'); ?. ",
    "harrysbaraini": "You can use your own model (as explained in https://docs.spatie.be/laravel-medialibrary/v7/advanced-usage/using-your-own-model).\nExample:\n```php\n<?php\nnamespace App\\Models;\nuse Illuminate\\Support\\Str;\nuse Spatie\\MediaLibrary\\Models\\Media as BaseMedia;\nclass Media extends BaseMedia\n{\n    public $incrementing = false;\nprotected static function boot()\n{\n    static::creating(function (Model $model) {\n        if (is_null($model->getOriginal('id'))) {\n            $model->id = Str::uuid()->toString();\n        }\n    });\n}\n\n}\n```. ",
    "bernhardh": "I am quite new and maybe I missunderstand you, but you can define as many collections as you want and all of them can be single file collections. F.E.\npublic function registerMediaCollections()\n{\n    $this\n        ->addMediaCollection('avatar')\n        ->singleFile();\n    $this\n        ->addMediaCollection('other-single-image')\n        ->singleFile();\n    $this\n        ->addMediaCollection('yet-other-single-image')\n        ->singleFile();\n    $this\n        ->addMediaCollection('normal-collection');\n}. Not perfect yet, but maybe a starting point https://novapackages.com/packages/jameslkingsley/nova-media-library. Any updates to this?. Not sure if I am wrong, but I think you missunderstand the sense of these generators.\nYou took your example from https://docs.spatie.be/laravel-medialibrary/v7/converting-other-file-types/creating-a-custom-image-generator - As you can see, its a PPT to Image (=jpg) converter. You want to do the opposite way, an \"image\" (=jpg) to webp converter.\nLook at the following issue, what has the same target: https://github.com/spatie/laravel-medialibrary/issues/1227. So to make it more clear:\n\nThe user uploads a file with the extension .jpg. \ngetImageGenerators gets called which returns the array with all generators as your first dd shows-\nSince the Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Image is the first generator in the array, it is first called and now the system knows, that the .jpg can be converted with this generator.\nNone of the other generators is getting called. \n\nIf you would upload a file with the extension webp or even xxx (and mimetype text, or anthing thats not jpg/gif/png/mov/pdf, etc), then your generator would be called. . ",
    "Elhebert": "+1 The url should be cleared before the new ones are added.. I'm experiencing the exact same thing. Which is quite annoying to be honest.\nHere's what one of my conversion looks like:\nphp\n$this->addMediaConversion('resized')\n        ->fit(Manipulations::FIT_FILL, 3000, 1650)\n        ->withResponsiveImages()\n        ->performOnCollections('cover');. There's a PR (#1138) open that will fix this \ud83d\udc4c. Hi @brendt, \nsorry for the delayed answer, here's the HTML\n```html\n<img \n    srcset=\"http://localhost:8000/media/me_3280_2186.jpg 3280w,\n        http://localhost:8000/media/me_2744_1828.jpg 2744w,\n        http://localhost:8000/media/me_2296_1530.jpg 2296w,\n        http://localhost:8000/media/me_1920_1279.jpg 1920w,\n        http://localhost:8000/media/me_1607_1071.jpg 1607w,\n        http://localhost:8000/media/me_1344_895.jpg 1344w,\n        http://localhost:8000/media/me_1125_749.jpg 1125w,\n        http://localhost:8000/media/me_941_627.jpg 941w,\n        http://localhost:8000/media/me_787_524.jpg 787w,\n        http://localhost:8000/media/me_658_438.jpg 658w,\n        http://localhost:8000/media/me_551_367.jpg 551w,\n        http://localhost:8000/media/me_461_307.jpg 461w,\n        http://localhost:8000/media/me_385_256.jpg 385w,\n        http://localhost:8000/media/me_322_214.jpg 322w,\n        data:image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHg9IjAiCiB5PSIwIiB2aWV3Qm94PSIwIDAgMzI4MCAyMTg2Ij4KCTxpbWFnZSB3aWR0aD0iMzI4MCIgaGVpZ2h0PSIyMTg2IiB4bGluazpocmVmPSJkYXRhOmltYWdlL2pwZWc7YmFzZTY0LC85ai80QUFRU2taSlJnQUJBUUVBWUFCZ0FBRC8vZ0E3UTFKRlFWUlBVam9nWjJRdGFuQmxaeUIyTVM0d0lDaDFjMmx1WnlCSlNrY2dTbEJGUnlCMk9UQXBMQ0J4ZFdGc2FYUjVJRDBnT1RBSy85c0FRd0FEQWdJREFnSURBd01EQkFNREJBVUlCUVVFQkFVS0J3Y0dDQXdLREF3TENnc0xEUTRTRUEwT0VRNExDeEFXRUJFVEZCVVZGUXdQRnhnV0ZCZ1NGQlVVLzlzQVF3RURCQVFGQkFVSkJRVUpGQTBMRFJRVUZCUVVGQlFVRkJRVUZCUVVGQlFVRkJRVUZCUVVGQlFVRkJRVUZCUVVGQlFVRkJRVUZCUVVGQlFVRkJRVUZCUVUvOEFBRVFnQUZRQWdBd0VpQUFJUkFRTVJBZi9FQUI4QUFBRUZBUUVCQVFFQkFBQUFBQUFBQUFBQkFnTUVCUVlIQ0FrS0MvL0VBTFVRQUFJQkF3TUNCQU1GQlFRRUFBQUJmUUVDQXdBRUVRVVNJVEZCQmhOUllRY2ljUlF5Z1pHaENDTkNzY0VWVXRId0pETmljb0lKQ2hZWEdCa2FKU1luS0NrcU5EVTJOemc1T2tORVJVWkhTRWxLVTFSVlZsZFlXVnBqWkdWbVoyaHBhbk4wZFhaM2VIbDZnNFNGaG9lSWlZcVNrNVNWbHBlWW1acWlvNlNscHFlb3FhcXlzN1MxdHJlNHVickN3OFRGeHNmSXljclMwOVRWMXRmWTJkcmg0dVBrNWVibjZPbnE4Zkx6OVBYMjkvajUrdi9FQUI4QkFBTUJBUUVCQVFFQkFRRUFBQUFBQUFBQkFnTUVCUVlIQ0FrS0MvL0VBTFVSQUFJQkFnUUVBd1FIQlFRRUFBRUNkd0FCQWdNUkJBVWhNUVlTUVZFSFlYRVRJaktCQ0JSQ2thR3h3UWtqTTFMd0ZXSnkwUW9XSkRUaEpmRVhHQmthSmljb0tTbzFOamM0T1RwRFJFVkdSMGhKU2xOVVZWWlhXRmxhWTJSbFptZG9hV3B6ZEhWMmQzaDVlb0tEaElXR2g0aUppcEtUbEpXV2w1aVptcUtqcEtXbXA2aXBxckt6dExXMnQ3aTV1c0xEeE1YR3g4akp5dExUMU5YVzE5aloydUxqNU9YbTUranA2dkx6OVBYMjkvajUrdi9hQUF3REFRQUNFUU1SQUQ4QTN0UitGMTE0RzhOeTYyMEJka0dRQ0t5ZkJYam1UNGhhWmNhWnFqQ0dMQlVBMTlSK1BQRTNoM1h2RE4vcG5uUkIvTE9FeVBTdmc2dzhUMjNoM3hIZTJXM2FSS2RyZTJhOVdNdWZWbm1PUEpvano3eC80REVIamFTeXRWTWdML0xqNjE3NzhQOEE0V1gybStFQks4YkpKakl5S3QrRS9ETmg0ZzFWZFdJV1dSUG14MXIwSFZmR0dwU2FXOW5hV3F4cXZ5ZzRyUkxsMk0yK2JjK2ZmRlhqelU3cStGMkpERkl3NUNrNE5XZmhob3RuNHcxb25VSVE3c2VXNzBVVmwwTmVwOUVmQzd3RnA5aDRodVlJeTNsWSs2YXEvRlcxSGh6Vlk0N1JpcW5raWlpaURkN0JOS3gvLzlrPSI+Cgk8L2ltYWdlPgo8L3N2Zz4= 32w\" \n    onload=\"this.onload=null;this.sizes=Math.ceil(this.getBoundingClientRect().width/window.innerWidth*100)+'w';\"\n    nonce=\"Ic6fiDVgAf7wR9pZWZPFybKp7yeItF5I\" \n    sizes=\"1px\" \n    src=\"http://localhost:8000/media/me.jpg\" \n    width=\"3280\"\n\n```\n\nMy CSP looks like this: \nbase-uri 'self';\nconnect-src 'self';\ndefault-src 'self';\nform-action 'self';\nimg-src 'self' data: 'nonce-Ic6fiDVgAf7wR9pZWZPFybKp7yeItF5I';\nmedia-src 'self';\nobject-src 'none';\nscript-src 'self' 'nonce-Ic6fiDVgAf7wR9pZWZPFybKp7yeItF5I';\nstyle-src 'self' 'nonce-Ic6fiDVgAf7wR9pZWZPFybKp7yeItF5I'\n\nI was browsing the code base of spatie.be and found this https://github.com/spatie/spatie.be/blob/master/resources/assets/js/front/images/index.js which should solve this issue \ud83e\udd14. @Skullbock I would put it inside the markAsConversionGenerated function. \nI think it would make sense since it's supposed to be the responsibility of that function.. From what I'm seeing in Travis logs:\nPHP Fatal error:  Maximum function nesting level of '256' reached, aborting! in /home/travis/build/spatie/laravel-medialibrary/vendor/laravel/framework/src/Illuminate/Container/Container.php on line 733\nI've never encountered this issue before, so not sure on why it's occurring. My first thought would be a recursion error somewhere, but I can't see why this would happen with the change you made.\nI suppose that @freekmurze or someone more familiar with the codebase could have a better answer for that \ud83e\udd14. From what I could gather the tests that trigger the exceptions are from tests/Unit/Conversion/ConversionCollectionTest. This should already narrow the search \ud83e\udd14. If you comment one of those 2 lines https://github.com/spatie/laravel-medialibrary/blob/master/tests/Unit/Conversion/ConversionCollectionTest.php#L21-L22 the test will fail, but won't trigger an exception \ud83e\udd14\nNot sure on where to look next.. ",
    "DevDavido": "Thanks @Elhebert \ud83d\udc4d . ",
    "Moix1": "=========This is Solution I Got ==========\nGot to your Laravel Application Folder \n1: Inside Folder you will see App Go to this folder\n2: Now you will have multiple folders look for \" Providers \"\n3: Inside this folder you will get File called \" AppServiceProvider.php \"\n4: Open this file and add this line \" Schema::defaultStringLength(191);  \" inside function called public f \n    function boot() { Here paste it }\n5: Save the file\nNow you are good to go ;-)\n. ",
    "mattias-persson": "@Moix1 For more info on your solution, see the \"Index Lengths & MySQL / MariaDB\" section under  https://laravel.com/docs/5.6/migrations#indexes. This issue has nothing to do with this package and should probably be closed.. ",
    "vijaybajrot": "1117 I have same issue with uploading multiple files .\nMy request data: \n\nFile Uploading Error:\n\nWhoops File Debug :\n\n. ",
    "codebyray": "You can loop through the photos if you make them an array like so:\nphp\nforeach ($request->photos as $photo) {\n    $company->addMedia($photo)\n        ->toMediaCollection();\n}\nName your inputs like:\nHTML\n<input type=\"file\" name=\"photos[]\" />\n<input type=\"file\" name=\"photos[]\" />\n<input type=\"file\" name=\"photos[]\" />\n<input type=\"file\" name=\"photos[]\" />\nHope this helps.\nRegards,\nRay. ",
    "matbeard": "My bad... (sort of)\nThe documentation for v.7 states: By default all files are stored on the disk specified as the \"default_filesystem\" in the config file.\nHowever, the property should be \"disk_name\" not \"default_filesystem\"\nIt's working now.. Looks like I just needed to call ->toJson(); on the return from addMediaFromRequest. ",
    "oliveready7": "Having the same issue.\nQuick Fix: Listen for the 'ConversionHasCompletedEvent' and mark them yourself.\nEvent Service Provider\nphp \n'Spatie\\MediaLibrary\\Events\\ConversionHasBeenCompleted' => [ \n     'App\\Listeners\\MarkConversionAsGenerated'\n],\nCreate 'MarkConversionAsGenerated listener\n```php\nnamespace App\\Listeners;\nuse Spatie\\MediaLibrary\\Models\\Media;\nuse Spatie\\MediaLibrary\\Conversion\\Conversion;\nuse Spatie\\MediaLibrary\\Events\\ConversionHasBeenCompleted;\nclass MarkConversionAsGenerated\n{\n    public function handle(ConversionHasBeenCompleted $event)\n    {\n        $event->media->markAsConversionGenerated($event->conversion->getName(), true);\n        $event->media->save();\n    }\n}\n```. ",
    "helmut": "Experiencing this issue too. The custom properties added by the markAsConversionGenerated method are not being saved. The properties are being added but at no point is the model saved.. ",
    "tfortier": "I get the same thing. My solution was to add ->preservingOriginal() to the add request and bypass the unlink function. Since in wamp it gets uploaded to a temp directory before going to S3, the file eventually gets deleted on it's own. However, I may have to code a \"clean up\" cron when I publish this to the live server. \nI tried a few things but it seems to me that line line 304 of FileAdder.php ($this->filesystem->add($fileAdder->pathToFile, $media, $fileAdder->fileName);) may still be uploading the file when line 308 (unlink($fileAdder->pathToFile);) gets called.\nThat would explain why the file set for unlinking is not available if another part of the script is uploading it. That being said, I'm a bit out of my depths as to how this could / should be fixed.. ",
    "jorenvh": "I'm having the same issue, however I don't have a trailing slash in my APP_URL.\nEDIT:\nWhen changing spatie/laravel-medialibrary/src/UrlGenerator/LocalUrlGenerator R53\nto return $diskUrl, I do get a valid url\n@freekmurze is this a known issue?. For now I just copied the LocalUrlGenerator logic to a custom UrlGenerator with the fix I mentioned in my previous comment.\nCan anyone confirm this? If it's indeed so I'm open to create a PR for this.\n. ",
    "radmen": "Looks like the problem is here:\nhttps://github.com/spatie/laravel-medialibrary/blob/1e4fbaf0d439919b8e79605db65872a3b1aba8f1/src/UrlGenerator/LocalUrlGenerator.php#L51-L53\nLocalUrlGenerator basically removes app.url from generated link.\nI think this might be a bug.. ",
    "isneezy": "~~the Spatie\\MediaLibrary\\UrlGenerator\\LocalUrlGenerator class is replacing the domain and this is making difficult to me because I'm developing to separated app with depends on each other! I think ill do the @jorenvh solution. but i think this is not a desired behavior~~\nEdit:\nI've used the getFullUrl() method and it worked like a charm, no need Custom urlGenerator. ",
    "tonyxhepa": "thank you. ",
    "lmartins": "Any chance I can get some feedback on this?. I went with different collection for each language. If there's a better, built-in way to approach this please let me know.. Thanks so much for the confirmation @freekmurze I appreciate it.. Should be possible but you should wait. Please see https://github.com/spatie/laravel-medialibrary/issues/1288. Having the same issue and not really sure why. The model relocation seems to be related to v.7 although my dependencies still declare 6.9, which I've just tried to upgrade to 6.9.1 so I could upgrade to Laravel 5.7. ",
    "DaanAmsterdam": "Hi there, I'm having a similar or the same problem.\nI have everything setup and it works well. My problem is that when I generate media conversions from my original photo (width 1920) the conversions look different. The pictures have a lot less colour in it, they look a lot more pale, for instance a lot of yellow gets pulled out. It feels like the hue and saturation gets lowered.\nI have used both GD and Imagick (wow, to set that up on mac!) but the problem is the same with both drivers.\nI have tried to generate the images with nonOptimized like this but it doesn't make a difference for the colour changes.\nplease check my original post as of yesterday on Laracasts.\nhttps://laracasts.com/discuss/channels/general-discussion/spatie-media-library-image-changes-the-colourhue-of-converted-photos\nRegards, Daan. ",
    "harveyjovit": "experiencing this too... ",
    "nwrman": "I'm having the same issue.\nIs there incompatibility with Faking the filesystem, or is it windows?\nI am too using Windows.. ",
    "xyloshrike": "Solved, i was using the wrong namespace !. ",
    "riseoflex88": "@xyloshrike can you post a copy of the working namespace, I'm also getting this issue and can't resolve it. . By changing config/medialibrary.php to: \n'path_generator' => \\App\\Generators\\CustomPathGenerator::class\nI've got the file hooked up, however, now the error is..\nDeclaration of App\\CustomPathGenerator::getPath(Spatie\\MediaLibrary\\Media $media): string must be compatible with Spatie\\MediaLibrary\\PathGenerator\\PathGenerator::getPath(Spatie\\MediaLibrary\\Models\\Media $media): string\nIf I change getPath to return 'abc' it still shows the same error, I really can't see the answer here.. @Jasper9041 thanks, that fixes this specific issue but in the hunt for the answer I've got myself into a world of pain. I've created a new job with the new issue . Damn the answer was simple. My lack of understanding of php namespaces bit me in the arse here.\nThe namespace declared at the top of the file needs to be the name of the parent folder, not the name of the class as I was doing. \nSo the top namespace should just be namespace App\\Generators\nSo when this is used in config/medialibary, it's using the 'App\\Generators' structure, and looking for a class named 'CustomPathGenerator'. Reading the article here: https://murze.be/comparing-laravel-mediable-with-laravel-medialibrary I'm realising that Spatie's medialibrary really is designed to explicitly not support what I'm hoping to do. \nI guess my question is, can this be done with a reasonable workaround (a not-too-bodgy bodge)?\n. ",
    "AwkwardKore": "@riseoflex88 You have to write the config like this in config/medialibrary.php:\n'path_generator' => App\\Generators\\CustomPathGenerator::class,. ",
    "Benjyclay": "Run this\nphp artisan vendor:publish --provider=\"Spatie\\MediaLibrary\\MediaLibraryServiceProvider\" --tag=\"config\"\nIt will publish the vendor config to the config directory in the root of your project. ",
    "paparabbit": "Ok its S3 permissions related... the usual fun.. ",
    "hardikdangar": "behind the scenes conversations happen using https://docs.spatie.be/image/v1/introduction, i guess you can look at the docs of that and figure out what you want.. i think you are looking for this,\nhttps://docs.spatie.be/laravel-medialibrary/v7/advanced-usage/working-with-multiple-filesystems. From what i can see is, /tmp is redirected to user's home directory in your server setup. and either /home/admin/tmp does not exist or have diffrent permissions. this might help you https://stackoverflow.com/questions/1846882/open-basedir-restriction-in-effect-file-is-not-within-the-allowed-paths \nthis is the issue with your server setup not library.. are you using v7 or v6? if you are using v7 then the correct documentation for what you want is at,\ndefining conversions. Only thing i can think of is you forgot the property in your model,\npublic $registerMediaConversionsUsingModelInstance = true;\n. see the above code will generate new thumbnail automatically. but if you want to set custom height and width then you can do inplace generation like,\n```\n$newsItem = NewsItem::find(1);\n$newsItem\n   ->addMedia($pathToFile)\n   ->toMediaCollection();\n$newsItem->addMediaConversion('thumb')\n     ->width($width)\n     ->height($height);\n```. i am still not able to understand what you want to achieve. So to understand your requirement do you want to have collection with fix height and width i.e. thumb 150x150 so that when you create new image it will have thumb? or you just want one specific image to be converted to one specific dimension? if so medialibrary uses https://docs.spatie.be/image/v1/introduction for image manipulation you can look at it and use it directly.. ",
    "michellaurent": "@freekmurze I think this feature would be useful. Any idea/advices about a way to implement this ?. @riseoflex88 I think you can do what you want by attaching your medias to the user model within a \u201cuploads\u201d collection. Then select the media and copy/move it to your other model. ",
    "dmitrybubyakin": "I've found a better way to solve this, without setting a relation. Thanks for your reply.. ",
    "hohl": "Looks like...\n\n\nmigrate with $table->json('responsive_images')->default('[]');\n\n\nthen drop the default with $table->json('responsive_images')->default(null)->change();\n\n\n... works for upgrading the database. But some official help/documentation would still have been helpful (to prevent that upgrading it in a wrong way causes unexpected side effects).. Oh, sorry. Missed that.. ",
    "IChris2698I": "@hohl Thanks!\n@freekmurze Could this be added to the UPGRADING.md guide?. ",
    "fragkp": "Duplicate #1175 :). ",
    "nwaughachukwuma": "@mhardaniel123 @mintbridge @bstrahija @uyab @chadjw  Cloudinary is fast becoming the media/file storage platform of choice, offering media manipulation capability and serving over CDN with awesome transformations. It will be nice if there's some sort of integration from media-library to Cloudinary  . ",
    "victorhsanjos": "\n@mhardaniel123 @mintbridge @bstrahija @uyab @chadjw Cloudinary is fast becoming the media/file storage platform of choice, offering media manipulation capability and serving over CDN with awesome transformations. It will be nice if there's some sort of integration from media-library to Cloudinary\n\nI found this package flysystem-cloudinary. You will need to create a provider:\n```php\n<?php\nnamespace App\\Providers;\nuse Enl\\Flysystem\\Cloudinary\\ApiFacade as CloudinaryClient;\nuse Enl\\Flysystem\\Cloudinary\\CloudinaryAdapter;\nuse Enl\\Flysystem\\Cloudinary\\Converter\\TruncateExtensionConverter;\nuse Illuminate\\Support\\Facades\\Storage;\nuse League\\Flysystem\\Filesystem;\nuse Illuminate\\Support\\ServiceProvider;\nclass CloudinaryServiceProvider extends ServiceProvider\n{\n    /\n     * Perform post-registration booting of services.\n     \n     * @return void\n     /\n    public function boot()\n    {\n        Storage::extend('cloudinary', function ($app, $config) {\n            $client = new CloudinaryClient([\n                'cloud_name' => $config['cloud_name'],\n                'api_key' =>  $config['api_key'],\n                'api_secret' => $config['api_secret'],\n                'overwrite' =>  $config['overwrite'],\n            ], new TruncateExtensionConverter());\n        return new Filesystem(new CloudinaryAdapter($client));\n    });\n}\n\n/**\n * Register bindings in the container.\n *\n * @return void\n */\npublic function register()\n{\n    //\n}\n\n}\n```\nin the .env file add:\nyaml\nCLOUDINARY_CLOUD_NAME=\nCLOUDINARY_API_KEY=\nCLOUDINARY_API_SECRET=\nand create CloudinaryUrlGenerator class that will extend Spatie\\MediaLibrary\\UrlGenerator\\BaseUrlGenerator and implement the methods: getUrl, getTemporaryUrl and getResponsiveImagesDirectoryUrl and do not forget to put the new class in the package configuration file (config/medialibrary.php).\n. ",
    "CriptoMex": "Hello, just checked... that's not the problem, the problem is another... the error code it gives me now is: Interface 'App\\HasMediaConversions' not found \nmy user model has this:\n```\n<?php\nnamespace App;\nuse Illuminate\\Notifications\\Notifiable;\nuse Illuminate\\Foundation\\Auth\\User as Authenticatable;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMedia;\nuse Illuminate\\Database\\Eloquent\\User as EloquentUser;\n\nclass User extends \\TCG\\Voyager\\Models\\User implements HasMediaConversions\n{\n    use Notifiable, HasMediaTrait;\n```\nBut i really don't know what is going on.... \nwell... still not working :) . \n. I've followed the documentation, but... Undefined namespace Interfaces and Undefined class HasMediaConversions. So basically, the issue has not been solved :P \n@freekmurze . What do you mean about a vanilla laravel app?. I mean, i want to use the package on my project... and i don't have any idea why this is happening, basically this is not something i caused.... Ok, let my try to install it in a brand new project, let's see what is going on.... Just installed it in a brand new project, still getting the same problem: \n\n. made some changes to my user model: \n```<?php\nnamespace App;\nuse Illuminate\\Notifications\\Notifiable;\nuse Illuminate\\Foundation\\Auth\\User as Authenticatable;\nuse Illuminate\\Database\\Eloquent\\User as EloquentUser;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMedia;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\n\nclass User extends \\TCG\\Voyager\\Models\\User implements HasMedia\n{\n    use Notifiable, HasMediaTrait;\nBut then, what happens here is that the page now correctly loads, the problem is that when i sign up a new user and add an avatar, i get the following error: `The current request does not have a file in a key named \"avatar\"` the register form has the following in it: `<form method=\"POST\" action=\"{{ route('register') }}\" aria-label=\"{{ __('Register') }}\" enctype=\u201dmultipart/form-data\u201d>`\nand\n{{ __('Avatar (optional)') }}\n                        <div class=\"col-md-6\">\n                            <input id=\"avatar\" type=\"file\" class=\"form-control\" name=\"avatar\">\n                        </div>\n                    </div>\n\n```\nSo it seems that my code is ok, then, why is it throwing me that exception? \nin my registercontroller i have this: \n```if (isset($data['avatar'])) {\n            $user->addMediaFromRequest('avatar')->toMediaCollection('avatars');\n        }\n    return $user;\n\n```. Hello freek! I've decided to make a use of the package out of the user model and... well, it works, but it only crashes when i try to make use of it in the user model.... ",
    "kgenly": "Would something like this not work for you?\n```\n$media = $profile->addMediaFromRequest('file')\n      ->usingFileName($fileName)\n         ->toMediaCollection('avatar');\nreturn $media;\n```. I also have this question.. Does this not answer your questions?\nhttps://docs.spatie.be/laravel-medialibrary/v5/introduction. Ahh, gotcha. Not a question I can help with then. :). Nevermind; I'm discovering the issue is not that I was editing the original image. I'm getting this \"generated images for smaller sizes would only show a few \"chunks\" of the image and then the rest are grey\" issue on most images, regardless of whether or not I have manipulated the original.. How about...\n\nMedia::where('collection_name', $collection_name)->get()\n\n`. Are you accessing using a foreach loop? This seems to work fine for me, including with getURL. ",
    "spacemudd": "https://stackoverflow.com/questions/3614925/remove-exif-data-from-jpg-using-php. You did not import the trait to the class you are working in.\nI suggest you to learn PHP basics before digging into this.. ",
    "halatef": "thanks @kgenly \nwhat am asking for is how to access it via URL, :)\ni am asking about the view and rout name . ",
    "CaesarChan": "@Akhibemudu  the native json data type supported from mysql 5.7.8 and  mariadb 10.2\u3002. ",
    "mohammad-y": "no. There was no explanation in the documentation\nThe problem was solved. Thanks. ",
    "jhm-ciberman": "Nope. I had to refactor my code to use paths instead of the Laravel storage\nfacade.\nEl mi\u00e9., 29 de ago. de 2018 2:11 PM, jozeflambrecht \nnotifications@github.com escribi\u00f3:\n\n@jhm-ciberman https://github.com/jhm-ciberman Do you have a solution\nfor this?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/1207#issuecomment-417031474,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AHnkf0WI2Z52rgN4a1_T7YAys67PjV0gks5uVssrgaJpZM4V3fDE\n.\n. The test for php 7.2 is failing. \nIt seems you also need to update \"orchestra/testbench\": \"~3.5.0|~3.6.0|~3.7.0|~3.8.0\",\n\n. > hink this is done from owner\nWhat do you mean by \"is done from owner\"? Did \u00b4laravel-medialibrary\u00b4 get updated to L5.8 already? . O yes. Just saw the commit. . ",
    "ELmardi2": "Thanks a lot of for your answer\nLe ven. 17 ao\u00fbt 2018 \u00e0 02:02, Shafiq al-Shaar notifications@github.com a\n\u00e9crit :\n\nYou did not import the trait to the class you are working in.\nI suggest you to learn PHP basics before digging into this.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/1208#issuecomment-413719309,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ARJp16yhHm07KUWaBpL-LpnfFfit_JTyks5uRggYgaJpZM4V4KgV\n.\n. \n",
    "kminek": "this was bug in my code, sorry, closing. ",
    "Vanlombardi": "5.7 released and support is not provided yet. Any timing?. ",
    "Adasso": "Do you have a date for the release?. ",
    "tomhatzer": "Can you post the exact error message from your storage/logs/laravel.log file and show us the changes you made to your php.ini (variables you changed with old and new value) and also tell us if those changes are listed in phpinfo please (or if there are still the old values)?. @fhusquinet do you possibly have a test repo with a little example of your code? Just a quick and dirty proof of concept so I can test it on my machine.. ",
    "emredipi": "I changed memory_limit and max_upload_size values and it worked. Thanks.... ",
    "adriandmitroca": "This happens when you are iterating on a set of images and trying to add the same image at the second time (for example, in seeders).\nBy default, Media Library deletes original file after adding it to the library. To avoid this, make sure your original files will be untouched by using this method:\nhttps://docs.spatie.be/laravel-medialibrary/v7/api/adding-files#preserveoriginal. ",
    "dinandmentink": "Really good to hear you are working on this.\nIs there any repo I can follow? Are you open to cocreation/PRs?. ",
    "sarhugo": "This is what I made:\n\n\nRegenerate the conversions for every media:\nphp artisan medialibrary:regenerate\n\n\nDelete old non prefixed files: it hard depends on your conversions so plese check carefully, here my conversion was called thumb, yours may be different\n\n\nfind storage/app/media -name \"thumb.jpg\" -delete. ",
    "ixperiencenl": "Yes this would be very welcome as Google also changed it's Insights algorithm to look more at WebP formats also.. ",
    "AlexMcDee": "For solving this I added new constant \nphp\nconst FORMAT_WEBP = 'webp';\nto class\nphp \nclass Manipulations\nfor quick fix.\nI'm not found any way for overwriting default configs. \nUPD\nYeah, I checked all structure of library and trying generate webp from generator. But as I understand, when I apply my generator for model I also needed use format() method for output. But method get values from constants. So we need to add this additional constant for WebP supporting.  Any Ideas?\nUPD 2\nI was wrong. It just switches the file extension but not generate the image to webp. The result of this mistake webp file has the biggest size then original file. So we should use a webp generator for getting needed result.\n. ",
    "idragon81": "Would be better if we could extract out supported formats to a config file or retrieve it through generators' supportedExtensions() method. I think that there's a lot of architectural changes required for this.\nThe ImageGenerators class is on spatie/laravel-medialibrary and not on spatie/image\nI think it should be the responsibility of the image library to check whether or not it can handle the file as an image and the medialibrary should just manage the media files and query the image library whenever we need to.\nTo achieve this I think the ImageGenerators should be a part of the image library instead. As this could take a great while to refactor, we should plan on making the necessary changes for the next major version.  Correct me if I'm wrong, I could be way off about this.\nFor the meanwhile, I will send a PR to spatie/image to temporarily fix the WebP issue. ",
    "zr87": "Got it, my solution is:\nphp\n    $images = $this->getMedia('images');\n    $image = $images->where('id', $this->primaryMediaId)->first();. ",
    "andru-h": "Thanks a lot @eichgi helped me a lot, I struggled with addMultipleMediaFromRequest for a couple of hours. @freekmurze are we missing something here? . ",
    "franzdumfart": "Had the same problem because I haven't setup a queue at this points. You need to do that and you will get the converted images.. ",
    "martinhschei": "adding a reference to the extended media class on my model sort of solved the first problem and it's a solution that will work when the project is installed on a new server:\n\nuse companyName\\Registration\\Participants\\Media;\n\nstill, the Webp class is missing.\n. a cleaner solution was to change the type-hinting on my model from:\n\npublic function registerMediaConversions(Media $media = null)\npublic function registerMediaConversions(\\Spatie\\MediaLibrary\\Media $media = null)\n. For some reason Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Webp::class was referenced in the config file even though it does not exists in the library. Why?\n\n```\n    'image_generators' => [\n        Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Image::class,\n        // Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Webp::class,\n        Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Pdf::class,\n        Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Svg::class,\n        Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Video::class,\n    ],\n```\nRemoved that line and it seems to work fine.. ",
    "rohanshukla9": "After googling for some time I realize  $this->json was giving errors\nSo I checked Mariadb's site for their support of Json\n\"The JSON table type was introduced in MariaDB 10.0.16.\"\nhttps://mariadb.com/kb/en/library/connect-json-table-type/\nBut I have version 10.1.26, is this related to mariadb and not the package?\n\"Server version: 10.1.26-MariaDB-0+deb9u1 Debian 9.1\"\n. Thanks guys, you have to upgrade Mariadb 10.1.26 to 10.2+ and laravel will accept $table->json('...');\nCheers have a nice day!. ",
    "ishosys": "Sorry, wrong package. ",
    "fhusquinet": "@tomhatzer I will try to provide that later today.\n. @tomhatzer @freekmurze \nI have provided a repository with a failing test and a real-life example closely related to my current use-case.\nThe exception seems to be only thrown when I provide a base64 encoded PNG image, add it to the media library with responsive images and a filename with the jpg extension.\n$model\n     ->addMediaFromBase64($pngImage)\n     ->withResponsiveImages()\n     ->usingFileName('filename.jpg')\n     ->toMediaCollection('images');\nI'm not sure it is the responsibility of the media library because this is a weird edge case.... @bhulsman \nThis happens when the original filename is used but the image is transformed to a data64 png image using a canvas in javascript.\nThe Javascript receives a JPG image, transforms it (resize, resample, rotate...) then spits out a PNG data64 image. The API receives the filename and the data64 image, gives everything to the media library which handles everything fine except for the tiny jpg.\nThe easiest thing would be not to give the original filename of course, but I was wondering why only the blurred version generated for the responsive images was failing and not the rest.. Media is a relationship which is likely loaded on your API controller. You can always hide it from your response if you want using ->setHidden(['media']) for example or by using a resource response to format your data the way you want it:\nhttps://laravel.com/docs/5.7/eloquent-resources#resource-responses. ",
    "rathesDot": "The easiest fix for this would be to add a ->format(Manipulations::FORMAT_JPG) when generating the TinyPlaceholder in  Spatie\\MediaLibrary\\ResponsiveImages\\TinyPlaceholderGenerator\\Blurred::generateTinyPlaceholder()\nThis would force the placeholders to be always generated as jpg ... Not sure if that is the desired fix, though.. ",
    "kiwina": "Conversions are queued by default. try with sync driver to convert them. ",
    "OpenHaus": "Thank you that was the correct hint. Somehow the queue was never processed.. ",
    "AndreasHerss": "Can't you just use the events fired already? \ni'm thinking of the MediaHasBeenAdded event, it specifically says it's fired after the file is stored\nhttps://docs.spatie.be/laravel-medialibrary/v7/advanced-usage/consuming-events\n. ",
    "SPQRInc": "Closed as it's not an issue but a \"How to\" question.. Solved it. Had to add nonQueued().. ",
    "jryd": "@freekmurze this is still an issue.\nI am integrating with Google Cloud Storage like @LarBearrr is and have written both a path generator and url generator.\nMy path generator:\n```php\n<?php\nnamespace App\\Core\\MediaLibrary;\nuse Spatie\\MediaLibrary\\Models\\Media;\nuse Spatie\\MediaLibrary\\PathGenerator\\PathGenerator;\nclass MediaLibraryPathGenerator implements PathGenerator\n{\n    /\n     * Get the path for the given media, relative to the root storage path.\n     /\n    public function getPath(Media $media): string\n    {\n        return $this->getBasePath($media) . '/';\n    }\n/*\n * Get the path for conversions of the given media, relative to the root storage path.\n */\npublic function getPathForConversions(Media $media): string\n{\n    return $this->getBasePath($media) . '/conversions/';\n}\n\n/*\n * Get the path for responsive images of the given media, relative to the root storage path.\n */\npublic function getPathForResponsiveImages(Media $media): string\n{\n    return $this->getBasePath($media) . '/responsive-images/';\n}\n\n/*\n * Get a unique base path for the given media.\n */\nprotected function getBasePath(Media $media): string\n{\n    return config('filesystems.path_prefix') . '/media_library/' . $media->getKey();\n}\n\n}\n```\nMy URL generator:\n```php\n<?php\nnamespace App\\Core\\MediaLibrary;\nuse DateTimeInterface;\nuse Illuminate\\Support\\Facades\\Storage;\nuse Spatie\\MediaLibrary\\UrlGenerator\\BaseUrlGenerator;\nclass GCSUrlGenerator extends BaseUrlGenerator\n{\n    /\n     * Get the url for the profile of a media item.\n     \n     * @return string\n     /\n    public function getUrl() : string\n    {\n        $disk = Storage::disk($this->media->disk);\n        return $disk->url($this->getPathRelativeToRoot());\n    }\n/**\n * Get the temporary url for a media item.\n *\n * @param \\DateTimeInterface $expiration\n * @param array $options\n *\n * @return string\n */\npublic function getTemporaryUrl(DateTimeInterface $expiration, array $options = []) : string\n{\n    // To Do - not needed currently\n}\n\n/**\n * Get the url to the directory containing responsive images.\n *\n * @return string\n */\npublic function getResponsiveImagesDirectoryUrl() : string\n{\n    // To Do - not needed currently\n}\n\n}\n```\nWhen I had not specified a URL generator in the medialibrary config file, my path generator was successfully used. When adding files to the cloud (GCS), they were placed in the correct directories as determined by the path generator.\nOnce I added a URL generator so I could generate images for GCS, trying to call getPath() stopped working:\n\n$model->getFirstMedia()->getPath()\nPHP Error:  Call to undefined method App/Core/MediaLibrary/GCSUrlGenerator::getPath() in /var/www/my-project/vendor/spatie/laravel-medialibrary/src/Models/Media.php on line 76\n\nTo fix this, I just needed to add a getPath() and getStoragePath() method to the GCSUrlGenerator class:\n```php\n/\n * Get the url for the profile of a media item.\n \n * @return string\n /\npublic function getPath() : string\n{\n    return $this->media->disk === 'public' ? $this->getStoragePath() . '/' . $this->getPathRelativeToRoot() : $this->getPathRelativeToRoot();\n}\n/\n    * Get the path where the whole medialibrary is stored.\n    /\nprotected function getStoragePath() : string\n{\n    $diskRootPath = $this->config->get(\"filesystems.disks.{$this->media->disk}.root\");\n    return realpath($diskRootPath);\n}\n```\nThis resolved the issue, and paths are correctly rendered, but it raises the question as to why this is necessary. Shouldn't the path generator be responsible for this and not the URL generator.\nI see that both the LocalUrlGenerator and S3UrlGenerator implement a getPath() method.. ",
    "catalinux": "Is it Ok to open a PR for such a feature?. > way to cache a queries when\nWhat queries do you want to cache?. you could define an accesor getUrlAttribute and add it to $appents variable. Than: the toArray() will return also this value. ",
    "szana8": "Hi,\nHave you tried to change the APP_URL from APP_URL=http://localhost to APP_URL=http://localhost:8080 in the .env file?\nRegards,. ",
    "amrnn": "Thank you very much @szana8 , that fixed it.. ",
    "dundermave": "yup, not able to install on 5.7.*. I solved it by installing this way:\ncomposer require spatie/laravel-medialibrary\nIt installed me ^7.5 version and now everything works fine. ",
    "bscript": "Working fine on : Laravel Framework 5.7.6 \n\nCould you please post your composer.json content here ! . ",
    "MdkanokHossain": "I am also here stack with the same problem. . ",
    "leonardolouie": "same problem heree help T_T \n. Gloudemans/shoppingcart not installing . @eichgi  i use other package and its work now https://github.com/darryldecode/laravelshoppingcart\n. ",
    "irfan-mirza686": "@eichgi .. i also try this \"darryldecode\" its work but \"Gloudemans\" not working . . ",
    "lasselehtinen": "I think I solved the issue. I did run php artisan vendor:publish --provider=\"Spatie\\MediaLibrary\\MediaLibraryServiceProvider\" --tag=\"config\" after the upgrade, but it seems that it does not overwrite an existing file. So the default_filesystem has been actually changed to disk_name. . ",
    "VincentKos": "@freekmurze did you really expect this behavior ? Aren't we supposed to use usingFileName() to rename the file and usingName() just for the name in the record? . The problem came from the method isFilePath in TemporaryDirectory. The way you detect if the path is a file or a folder is by looking for a point, in a file without extension, chance are, you will never find it so it return false and create two folder in the path method (same file).\nWould love to PR but i'm pretty bad at writing test so :confused:. @Joucke same, can't reproduce . yes it is, look here : https://github.com/spatie/laravel-medialibrary/blob/7.0.0/tests/Unit/PathGenerator/CustomPathGenerator.php\nLooks like you need to implement this interface https://github.com/spatie/laravel-medialibrary/blob/master/src/PathGenerator/PathGenerator.php and then you can do whatever you want . ",
    "tumainimosha": "Plus 1 on this. Faced same issue when trying to move user uploaded files which were missing extensions. Seems they are created in temp directory as folders instead of files.. ",
    "AbdelElrafa": "Did you symlink your public/storage? \nRun php artisan storage:link \n\nCreate a symbolic link from \"public/storage\" to \"storage/app/public\". \n",
    "Joucke": "Also, is your public linked to your public_html?. I've tried to reproduce on php 7.2.5, latest version of laravel-medialibrary, cannot reproduce. When adding media to testModelWithConversion, named \u043a\u0440\u043e\u0432\u0430\u0442\u044c-min.png, it preserves the conversion's filename properly:\n\n. ",
    "amrmsccs": "Hello, Here is sample work around since I was looking for the same answer and took me really long time to figure it out, I didn't get any quick and short example. \nAssume you have a model called Library  that is having a relationship with another model called Book and you wanna retrieve the Books with its cover photos.\n$library = Library::whereDate('published_date', '>=', $tody)->where('published', '1')->with(\"book\")->with(\"created_by\")->get();\nYou need to Change the  $library collection to modify the books images to insert link attribute for every book image exist and retrieved.\nHere is the Code where getMedia('images') is the collection you have saved your images in.\n$library = $Library->transform(function ($item, $key) {\n                                  foreach ($item->book->getMedia('images') as $media) {\n                                                 $media['link'] = $media->getFullUrl();\n                                  }\n                             return $item;\n                        });\nreturn the result as json resopnse\nif($library->isEmpty()) {\n            return response()->json(['data' => null]);\n        }else{\n            return response()->json(['data' => $library]);\n        }\nHope this help others.. ",
    "ClickerTech": "Hi,\nsee my code\n`\nRoute::get('/media', function () {\n    $admin = Admin::find(1);\n    $admin->addMedia(storage_path('/app/demo/test.png'))\n        ->preservingOriginal()\n        ->toMediaCollection('avatar');\n    return $admin;\n});\nRoute::get('1', function () {\n    $admin = Admin::find(1);\n    $admin = $admin->transform(function ($item, $key) {\n        foreach ($item->getMedia('avatar') as $media) {\n            $media['link'] = $media->getFullUrl();\n        }\n        return $item;\n    });\nif ($admin->isEmpty()) {\n    return response()->json(['data' => null]);\n} else {\n    return response()->json(['data' => $admin]);\n}\n\n});\n`\ni am getting this error\nCall to undefined method App\\Models\\Admin::transform(). hi,\ni done like this is this correct way to do?\nRoute::get('1', function () {\n    $admin = Admin::find(1);\n    $avatar = $admin->getFirstMediaUrl('avatar');\n    $admin->avatar = $avatar;\n    return $admin;\n});. ",
    "Dmarthaller": "In following the instructions posted here it indicates that I should install release 7. When I pulled from master I was successful. . Well I found how to correct this issue. This package has a dependency on spatie pdf-to-image and in the composer.json specifies version 1.2 (which was heavily modified in V1.4) and in the src\\Pdf.php class, getImageData Method which reads as:\n```\n  public function getImageData($pathToImage)\n    {\n        $imagick = new \\Imagick();\n    $imagick->setResolution($this->resolution, $this->resolution);\n\n    $imagick->readImage(sprintf('%s[%s]', $this->pdfFile, $this->page - 1));\n\n    $imagick->mergeImageLayers(\\Imagick::LAYERMETHOD_FLATTEN);\n\n    $imagick->setFormat($this->determineOutputFormat($pathToImage));\n\n    return $imagick;\n}\n\nShould be:\n  public function getImageData($pathToImage)\n    {\n        $imagick = new \\Imagick();\n    $imagick->setResolution($this->resolution, $this->resolution);\n\n    $imagick->readImage(sprintf('%s[%s]', $this->pdfFile, $this->page - 1));\n\n    $imagick = $imagick->mergeImageLayers(\\Imagick::LAYERMETHOD_FLATTEN);\n\n    $imagick->setFormat($this->determineOutputFormat($pathToImage));\n\n    return $imagick;\n}\n\n```\nHow do I go about updating this in my project without overwriting the vendor file?. I have verified that manually changing the composer.json to include pdf-to-image v1.4 or greater has solved my problem. . Hi I see two different server domain names in your comments are you pulling your images from the same server or is there a problem with your generated path names? . Hi have you run php artisan storage:link? \nDale Marthaller(dmarthaller@shaw.ca)\n----- Original Message -----\nFrom: MyhedinZika notifications@github.com\nTo: spatie/laravel-medialibrary laravel-medialibrary@noreply.github.com\nCc: DMarthaller dmarthaller@shaw.ca, Comment comment@noreply.github.com\nSent: Sat, 20 Oct 2018 11:32:40 -0600 (MDT)\nSubject: Re: [spatie/laravel-medialibrary] image won't load (#1275)\nHmm nah apparently that's not the issue, was thinking that might have been the issue, but nah its not apparently. \nI'm on http://uw-blb.test/products\nIts the same path \nproducts:770 GET http://uw-blb.test/storage/2/AllOrders.PNG 404 (Not Found)\nproducts:731 GET http://uw-blb.test/storage/1/AddStock2.PNG 404 (Not Found)\nproducts:848 GET http://uw-blb.test/storage/4/Ballina.PNG 404 (Not Found)\nproducts:809 GET http://uw-blb.test/storage/3/createVendor.PNG 404 (Not Found)\n-- \nYou are receiving this because you commented.\nReply to this email directly or view it on GitHub:\nhttps://github.com/spatie/laravel-medialibrary/issues/1275#issuecomment-431602524\n. If you copy the generated IMG url in another browser window can you see the image? If you either have a misgenerated url or a server config (missing link from your public directory to the storage directory issue). \nDale Marthaller(dmarthaller@shaw.ca)\n----- Original Message -----\nFrom: MyhedinZika notifications@github.com\nTo: spatie/laravel-medialibrary laravel-medialibrary@noreply.github.com\nCc: DMarthaller dmarthaller@shaw.ca, Comment comment@noreply.github.com\nSent: Sat, 20 Oct 2018 13:58:47 -0600 (MDT)\nSubject: Re: [spatie/laravel-medialibrary] image won't load (#1275)\nYes I have tried that, but unfortunately thats not the problem \nThe \"public/storage\" directory already exists.\n-- \nYou are receiving this because you commented.\nReply to this email directly or view it on GitHub:\nhttps://github.com/spatie/laravel-medialibrary/issues/1275#issuecomment-431613434\n. ",
    "joaomarcusjesus": "I have the same problem, any tips?\nit is simply creating automatically / storage / medialibrary / temp\n'media' => [\n       'driver' => 'local',\n        'root'   => public_path('uploads'),\n    ],. ",
    "booni3": "\nI have the same problem, any tips?\nit is simply creating automatically / storage / medialibrary / temp\n'media' => [ 'driver' => 'local', 'root' => public_path('uploads'), ],\n\nThis actually does not have anything to do with this error as far as I am aware. This is the public directory for the end files & not where the image conversion happens. \nImage conversion uses the temporary directory as set in set in medialibrary.php with 'temporary_directory_path' => null\nWhen the package creates the temporary directory it should be making it with 777 permissions, as detailed in TemporaryDirectory.php\n    if (! file_exists($directoryPath)) {\n        mkdir($directoryPath, 0777, true);\n    }\n\nOur systems appear to be modifying this to 755 afterwards or maybe its not being created as 777 in the first place. I have another server setup using this package and on this one the directories are created as 775.\nCan anyone provide any ideas to where this permission change may be happening?\n. It seems this error started happening for a lot of people last week. No real reason why though. To partially fix...\nStep 1:\nsudo nano /etc/ImageMagick-6/policy.xml\nStep2:\nAdd/edit the following lines\n<policy domain=\"coder\" rights=\"read|write\" pattern=\"PDF\" />\n  <policy domain=\"coder\" rights=\"read|write\" pattern=\"LABEL\" />\nYou may also need to comment out the MGV line if you have it. I did not.\nStep3:\nRestart web server AND php-fpm. i.e. (on nginx/php7.2)\nsudo service nginx restart\nsudo systemctl restart php7.2-fpm\nReferenced from: https://stackoverflow.com/a/52661288/6771855\nRedis Queue\nIf using a redis queue, then the above advice does not work. Removing or commenting out the lines in step 2 will get it working, however I expect this is not the best action as you are disabling all security. Does anyone know what this should be set to in order for the conversions to be handled by a queue?\nThe other option is of course just to add ->nonQueued() to the media conversion but this may not be advisable for higher volume sites.. ",
    "larry852": "php\n$path   = $media->getPath();\n$type   = pathinfo($path, PATHINFO_EXTENSION);\n$data   = file_get_contents($path);\n$base64 = 'data:application/' . $type . ';base64,' . base64_encode($data);\nreturn response()->json(['type' => $type, 'file' => $base64]);. ",
    "ysfkaya": "@nguyentranchung Are you use supervisor or another 3rd party software for queues ?. I'm using supervisor for queues. I was changed supervisor user root as a current user and did it works.\n\n. ",
    "PimButton": "Ping @freekmurze for notice :). Whoops, I did not get a notification of your reply! Will pick this up asap :) . @freekmurze I have made the changes you requested and added a test. This was the first test I have ever written so hope it's up to par. I couldn't figure out how to implement assertContains so that it would check the complete getResponsiveImageUrls array, so I used three separate calls and the getResponsiveImageUrls[0] notation. \nLet me know if you have any thoughts! . @freekmurze did you have time to take a look at this already?. @freekmurze just another ping ;) . I used the same name as the default getTemporaryUrl function, but expiresAt makes more sense indeed. Have changed it in my function now. I have added an exception when using the Local Url Generator. ",
    "rubenvanassche": "@Nuranto, @ambengers, @anouarabdsslm are you using an Custom Path generator(https://docs.spatie.be/laravel-medialibrary/v7/advanced-usage/using-a-custom-directory-structure) ?. @ambengers, @anouarabdsslm I made the same error when trying to find the error(using the model_id instead of the media id in the path generator). Can it be you made this error too? I will close the issue for now.. @ambengers that's right, you should not use the model_id.. ",
    "ambengers": "@rubenvanassche apparently I did (code below). So this means we cannot use model_id in the path generator at all? Or can we use model_id but have to be in conjunction with the media_id?\n/**\n     * Get the path for the given media, relative to the root storage path.\n     *\n     * @param  Spatie\\MediaLibrary\\Models\\Media $media\n     * @return string\n     */\n    public function getPath(Media $media): string\n    {\n        return $media->model_type . '/'\n            . $media->model_id . '/'\n            . $media->collection_name . '/';\n    }. @rubenvanassche thanks and noted!. @freekmurze thanks for your response! I think that's the intended behavior. The only problem is that when new media is added it also deletes that media, which is odd. \nShouldn't the flow when new media is added be like delete all items in the collection and all the stored files except the most recent?. ",
    "bxmas13": "@MyhedinZika I had a similar situation happen on my site. It wasn't until I read the comment by  @Dmarthaller that I realized I might have an issue with my storage link. \nIt turns out that when I moved my site to a different directory the symlink didn't transfer correctly. It ended up making a copy of the 'storage' directory instead of remaining a symlink. \nI even ran php artisan storage:link and it came up with 'The \"public/storage\" directory already exists.'\nI decided to double check that the public/storage directory did in fact exist. That's when I noticed it wasn't a symlink but an actual directory. After making a quick backup of my site I removed the 'public/storage' directory and ran php artisan storage:link again. Once the function completed all my images started loading as expected.\n. ",
    "cuevven": "If you use homestead, you need to use the php artisan storage:link command in vm.\n1. unlink storage in your host OS\n2. vagrant ssh\n3. php artisan storage:link\nYou can get more details from https://github.com/laravel/framework/issues/15439. ",
    "pedrofurtado": "I've created the generator with code below:\n```php\n<?php\nnamespace App\\Spatie\\MediaLibrary\\Generators;\nuse Illuminate\\Support\\Collection;\nuse Spatie\\MediaLibrary\\Conversion\\Conversion;\nuse Spatie\\MediaLibrary\\ImageGenerators\\BaseGenerator;\nclass Wav extends BaseGenerator\n{\n    public function convert(string $file, Conversion $conversion = null) : string\n    {\n        $pathToWavFile = pathinfo($file, PATHINFO_DIRNAME).'/'.pathinfo($file, PATHINFO_FILENAME).'.wav';\n        $pathToM3u8File = pathinfo($file, PATHINFO_DIRNAME).'/'.pathinfo($file, PATHINFO_FILENAME).'.m3u8';\n        $pathToTsFile = pathinfo($file, PATHINFO_DIRNAME).'/'.pathinfo($file, PATHINFO_FILENAME).'-%05d.ts';\n    exec(\"ffmpeg -i {$pathToWavFile} -vn -ac 2 -acodec aac -f segment -segment_format mpegts -segment_time 100 -segment_list {$pathToM3u8File} {$pathToTsFile}\");\n\n    return $pathToM3u8File;\n}\n\npublic function requirementsAreInstalled() : bool\n{\n    return true;\n}\n\npublic function supportedExtensions() : Collection\n{\n    return collect(['wav', 'wave']);\n}\n\npublic function supportedMimeTypes() : Collection\n{\n    return collect([\n        'audio/wav',\n        'audio/wave',\n        'audio/x-wav',\n        'audio/x-pn-wav'\n    ]);\n}\n\n}\n```\nwith config file like this:\n```php\n<?php\nreturn [\n    # ...\n    'image_generators' => [\n       # ...\n       App\\Spatie\\MediaLibrary\\Generators\\Wav::class\n    ],\n];\n```\nand model like this:\n```php\n<?php\nclass Audio extends Model implements HasMedia\n{\n    public function registerMediaConversions(Media $media = null)\n    {\n    $this->addMediaConversion('transcode')\n         ->nonQueued()\n         ->performOnCollections('file');\n}\n\npublic function registerMediaCollections()\n{\n    $this->addMediaCollection('file')->singleFile();\n}\n\n}\n```\nBut when I execute the snippet (for example):\n```php\n<?php\nApp\\MyModel::first()->addMedia('path/to/file.wav')->toMediaCollection('file')\n```\nAppears the following error: Intervention/Image/Exception/NotReadableException with message 'Unsupported image type. GD driver is only able to decode JPG, PNG, GIF or WebP files.'\nCan I return, from my custom generator, a path to a file that is not a image (.m3u8, .ts, for example)?. @nicolasbeauvais That's a great news! Enabling the devs to create conversions to any type of file (respecting, of course, the default to behavior to the images) will be awesome for the package! In my case, for example, I already use all the conversions and manipulations already coded in media-library for images (jpg, png, and so on).\nBut I also upload some binary files, like audios (mp3, wav, for example), videos and documents (excel, word, ...).\nThe flexibility proposed in this PR is great for this! \ud83d\udc4d \ud83e\udd1d . @nicolasbeauvais The CI failed because of some rules of coding standard \ud83d\udc4d . Ping for notice: @freekmurze . @freekmurze Where is versioned the docs of the package? It's great to update it to include a section explaining this feature. I can help creating a PR for this \ud83d\udc4d . ",
    "laravelcoder": "Oops i was just trying different things here is the code it was supposed to be. \n```\n    public function store(StoreClipsRequest $request)\n    {\n        if (! Gate::allows('clip_create')) {\n            return abort(401);\n        }\n        $clip = Clip::create($request->all());\n        $request = $this->saveFiles($request);\n    foreach ($request->input('videos', []) as $data)\n    {\n        $clip->videos()->addMedia($request->input('videos[1][video]'))->toMediaCollection('videos', 'local');\n    }\n    foreach ($request->input('brands', []) as $data) \n    {\n        $clip->brands()->create($data);\n    }\n    return redirect()->route('admin.clips.index');\n}\n\n```\n\nAnd this is the Error i get\nCall to undefined method Illuminate\\Database\\Eloquent\\Relations\\HasMany::addMedia()\nMy model setup is like this\n```\n<?php\nnamespace App;\n\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Illuminate\\Database\\Eloquent\\SoftDeletes;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMedia;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;\nuse Spatie\\MediaLibrary\\File;\nuse Carbon\\Carbon;\nclass Clip extends Model implements HasMedia\n{\n    use SoftDeletes, HasMediaTrait;\n. I might be wrong but it looks like you have the function a bit off. here is mine hope it helpsphp\npublic function registerMediaCollections()\n{\n        $this->addMediaCollection('videos')\n            ->acceptsFile(function (File $file) {\n                return $file->mimeType === 'video/mp4';\n            })\n            ->useDisk('videos')\n            ->registerMediaConversions(function( Media $media ){\n                $this->addMediaConversion('video')\n                    ->width(560)\n                    ->height(315)\n                    ->extractVideoFrameAtSecond(2)\n                    ->nonQueued()\n                    ->withResponsiveImages()\n                    ->performOnCollections('videos');\n            });\n    $this->addMediaCollection('images')\n        ->acceptsFile(function (File $file) {\n            return $file->mimeType === 'image/jpeg';\n        })\n        ->useDisk('images')\n        ->registerMediaConversions(function ( Media $media ) {\n            $this->addMediaConversion('thumb')\n                ->useDisk('thumbs')\n                ->width(150)\n                ->height(120)\n                ->performOnCollections('videos', 'images')\n                ->nonQueued()\n                ->optimize()\n                ->withResponsiveImages();\n        });\n\n}\n```. do i create a function for this or just add it to the existing functions in\nmy model?\nsomething like this\npublic function getPath($model){\n    $collection->each(function ($model) {\n        $model->getPath()\n    });\n}\nAnother question do you have a way to reference each media item globally\nsay {{ $user->avatar->getUrl() }}\nsomething i can use to pull the auth::user avatar in my sidebar that will\nalways be available not just when on profile page using avatar and user?\n$clip->videos->each(function ($data) use ($request) {\n    $data->addMedia($request['videos'][1]['video'])->preservingOriginal()->toMediaCollection('videos');\n    Log::info(\"SAVED TO MEDIA\");\n});\non the above function\ndo i need to specify where the files are stored for\ntoMediaCollection('videos') or does it look at medialibrary.php and\ndetermine that accordingly?\nright now im uploading the file to /uploads/clips/  but i am having\nproblems adding the upload into the media collection for videos\nany advice would be appreciated.\nthank you\nphillip\nOn Tue, Nov 6, 2018 at 3:15 AM Nicolas Beauvais notifications@github.com\nwrote:\n\nThis means that you are trying to call the getPath method on a Collection\ninstead of an eloquent model.\nYou should use the method on the model like this:\n$collection->each(function ($model) {    $model->getPath()});// or $collection->first()->getPath();\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/spatie/laravel-medialibrary/issues/1300#issuecomment-436201059,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AWNSI2u6jK--P7BzkwGuF1mG6k3YkUpyks5usWElgaJpZM4YPXF3\n.\n. nevermind i found the problem it was the reference in my filestystem.php\n\n. found this can you maybe tell me how i might implement it. \nExtractMultipleFramesFilter\nmaybe something along the lines of this\n\nimports\nuse FFMpeg\\Coordinate\\Point;\nuse FFMpeg\\Media\\Video;\nuse FFMpeg\\Coordinate\\TimeCode;\nuse FFMpeg\\Coordinate\\Dimension;\nuse FFMpeg\\Coordinate\\FrameRate;\nNot sure how to make your package use it though any help would be great\n```\n$this->extractImages($video, $duration, 5);\n\nfunction extractImages( $video, $duration, $n ){\n    $interval = floor( $duration / $n );\n    for($i = 0; $i < $n; $i++){\n        $frame = $video->frame(FFMpeg\\Coordinate\\TimeCode::fromSeconds( $i * $interval ));\n        $frame->save( '/your/path/frame-' . $i . '.jpg');\n    }\n}\n```\n. month and a half still not help.... anyone?. almost a month still no reply, so helpful.... ## Any help getting this working would be great.  Anyone? \n. almost a month still no reply, so helpful.... ",
    "Adioz01": "Hi @nicolasbeauvais ,\nthis could work out. Just one question, how can i access the path$pathToFileof the (temporary image?). Else i would first have to save the image and later access it and get the height with getimagesize()\nThis ist my upload function:\n```php\n    public function storeImage(Request $request, $id)\n    { \n    $kategorieBild = Kategorie::find($id)\n    -> addMediaFromRequest('kategorieBild')\n    -> withResponsiveImages()\n    -> toMediaCollection('content')\n    -> save();\n\n    return redirect()->back()->with('success', 'Bild hinzugef\u00fcgt');       \n}\n\n```\n. Thanks @nicolasbeauvais \nit works like a charm :) \nHave a great day! . ",
    "BenQoder": "I don\u2019t think this package is intended for that purpose.\nYou can try creating a model that has Many-To-Many relationship then attach media library files to it.. ",
    "NormanEdance": "@freekmurze I confirm it happens. But! File with cyrillic name uploads to folder correctly with correct filename; url stores in db with cut filename  so 404 errors occurs. Conversions however partially work with -thumb.jpg url.\n\nspatie/laravel-medialibrary: 7.5.5\nlaravel: 5.7\nphp: 7.2\ndb: pgsql and mysql/maria\n\nTo display I use getUrl() . relativeUrl() not helping.\nMy quickfix is to use usingFileName() with Laravel's helper str_slug() on submission.\n$contest\n                ->addMediaFromRequest('video')\n                ->usingFileName('video.'.$request->video->getClientOriginalExtension())\n                ->toMediaCollection('contest-videos');. ",
    "fomvasss": "I fixed it in the following way:\nAdded next string in file bootstrap/app.php:\nsetlocale(LC_ALL,'en_US.UTF-8');\nafter code:\n$app = new Illuminate\\Foundation\\Application(\n    realpath(__DIR__.'/../')\n);\nAfter it medialibrary working good! :)\nBut i think it is not perfect way(. I think it would be nice to add the ability to start from the generation console with indication of the range ID for the medias table. For example:\nphp artisan medialibrary: regenerate --id_between = 12,234. ",
    "igorrebega": "I also reproduced this bug.\nAnd found exactly why this is happening.\nSo in \"FileAdder\" there is the usage of \"pathinfo()\" function that doesn't work correctly with encoding without set_locale to UTF.\n\nBut if we add \"setlocale(LC_ALL,'C.UTF-8')\" before pathinfo() it will works:\n\nSo question is what we should do about it?\n1. Make some kind of wrapper to change locale to C.UTF-8 and revert it after.\n2. Make programmers set this locale by their own.\n3. Try to understand why Laravel don't set this locale by default.\n. ",
    "flowlep": "This release seems to be based on v7.5.1, not 6.9.*. ",
    "gpluess": "I think @flowlep is right, I just experienced the same issue. ",
    "kolydart": "+1\nI had to downgrade to stop fatal error. ",
    "chrisGeonet": "Same here\nIn MediaLibraryServiceProvider.php line 33:\n  Class 'Spatie\\MediaLibrary\\Media' not found  . ",
    "pianistprogrammer": "I have the same issue too, all setup for me, I tried to inspect the url of the image to be shown i get something like this http://localhost/storage/1/conversions/Jeery-thumb.jpg which is the correct path, but the thumb doesn't show, Then i added the port on which my laravel project is served, then i saw the image localhost:8000/storage/1/conversions/Jeery-thumb.jpg. How can this be handled?. Yea, I used a different technique, saving the file to a folder called upload while sending a redefined file name to db\n    $file = $request->file('file');\n    $ext = $file->getClientOriginalExtension();\n    $newName = rand(100000, 1001238912) . \".\" . $ext;\n    $file->move('uploads/file', $newName);\n\nIf you want more direction, hit me up jeremiahabimbola@outlook.com, I can send you files with already done codes. all images..... did that already, I can see the storage folder in the public . ",
    "Wikiki": "I have the same behavior :-(\nDid you find how to solve this ?. ",
    "fkeloks": "I solved the problem with a ->with('media.model') on the parent model.\nI did not know this feature.. Hello,\nI have the same problem.\nMy code:\nphp\npublic function registerMediaConversions(Media $media = null) {\n    $this->addMediaConversion('full-hd')\n        ->fit(Manipulations::FIT_FILL, 1920, 1080)\n        ->background('white')\n        ->optimize()\n        ->withResponsiveImages();\n}\nThis conversion produces an image in 1920x1080px but the responsive versions are not generated correctly.. ",
    "zangab": "yes you can, but u need to send the data (cropping points) to the backend. You can use e.g. this cropper to get the desired data on the frontend to send it to your backend https://fengyuanchen.github.io/cropperjs/.\nthere you would do something like:\n$cropValues = $media ? $media->getCustomProperty('crop') : [];\nand perform cropping like:\n$thumb->manualCrop($cropValues['width'], $cropValues['height'], $cropValues['x'], $cropValues['y']);\nthe thumb is a defined conversion on images like:\n$thumb = $this\n    ->addMediaConversion('thumb')\n    ->width(100)\n    ->height(100)\n    ->optimize()\n    ->nonQueued();. I think you'll just get an image url if you do it like this.\n$this->getFirstMediaUrl('images', 'high'),\nbut you could fetch the image instance before hand:\n$image = collect($this->getMedia('images'))->first();\nand then perform a $image->getSrcset('high') and $image->getUrl('high') on it.. ",
    "Yahav": "This would be life saver feature.. ",
    "mrsamirmh": "Making queue process user as work process user helped me.. ",
    "imabug": "looks like maybe you were looking at the v.6 documentation?  The v.7 documentation has\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Spatie\\MediaLibrary\\Media;\nuse Spatie\\MediaLibrary\\HasMedia\\Interfaces\\HasMediaConversions;\nuse Spatie\\MediaLibrary\\HasMedia\\HasMediaTrait;.\n",
    "wiwa1978": "Have the same issue. The v7 documentation also does not help. ",
    "yemilgr": "only thumb images are showing 404 or all images ???. Have you tried php artisan storage:link ??\nI think this will solve the problem. ",
    "carbontwelve": "@yemilgr \nI can reproduce this issue running my Laravel app via php artisan serve.\nHaving looked into this further I can see that the issue is caused due to the filesystems.php config in my Laravel install using env('APP_URL').'/storage' and my APP_URL in .env is set to http://localhost.\n@pianistprogrammer \nThe solution is to change your APP_URL value to http://localhost:8000\n. @mohammad6006 The fact that FileIsTooBig.php is being executed tells me the file being uploaded was too big for the file upload limit imposed by your shared hosting.\nLine 14 of that file in 7.5 reads $maxFileSize = File::getHumanReadableSize(config('medialibrary.max_file_size')); With medialibrary.max_file_size returning 1024 * 1024 * 10.\nHave you modified that configuration value? It being null shouldn't happen.. ",
    "mateo2181": "Any solution for this? I have the same problem. I am saving my images in public disk and I have run php artisan storage:link. \nCode:\n$p = Paciente::find(1);\n$mediaItems = $p->getMedia();\n$publicUrl = $mediaItems[0]->getUrl();\necho \"<img src='\" . $publicUrl . \"' \\>\";. ",
    "larsjanssen6": "@laravelcoder that's currently not possible. You could send a pr ?. Hmm it does not support php 7.1 should that be removed in .travis.yml?. ",
    "realripley00": "Have you tried just using JQuery?. ",
    "victoryforphil": "I had the same issue. Someone please help. I tried npm, yarn, pip, wget, carrier pigeon, nothing will work.. Also can confirm smoke signals resolve in a 404 error . ",
    "algiuxass": "I have exact same issue. Anyone has solved it?. ",
    "malikshahzad228": "+1. ",
    "NicTorgersen": "This doesn't work for me. Any other tips?. Had the same issue but downgraded to GS 9.25. I tested converting some PDFs generated with phpwkhtmltopdf and the library kept throwing ImageMagick, FailedToExecuteCommand \n'gs' -sstdout=%stderr -dQUIET -dSAFER -dBATCH -dNOPAUSE -dNOPROMPT -dMaxBitmap=500000000 -dAlignToPixels=0 -dGridFitTT=2 '-sDEVICE=pngalpha' -dTextAlphaBits=4 -dGraphicsAlphaBits=4 '-r144x144' -dFirstPage=1 -dLastPage=1 '-sOutputFile=/var/tmp/magick-29197Nuya33B6oSq%d' '-f/var/tmp/magick-2919AloWiKjccUAf' '-f/var/tmp/magick-2919X6eopPlvaOHC'.\nIt's using dFirstPage and dLastPage options, which JeremyRoundill reports doesn't work.\nI used brew install https://raw.githubusercontent.com/Homebrew/homebrew-core/b0b6b9495113b0ac5325e07d5427dc89170f690f/Formula/ghostscript.rb on MacOS to get a working version of GhostScript (9.25).. ",
    "rativardhan": "Just try to run composer update command . ",
    "tanthammar": "Solved. w spatie media library v7.5.2. Solved. w spatie media library v7.5.2. ",
    "vrkansagara": "@tanthammar Can you point that code line number or file name. Thanks.. ",
    "gavinhewitt": "I have the same question but I guess this is not possible or not intended to use it this way. ",
    "atapatel": "@msassa Are you using a separate queue for tenant database?. @msassa ina config/medilibrary.php change 'queue_name' according to your tenant . . @msassa Awwwww. Let me think about it. . @msassa i guess you need to run the worker on bases of the tenant.\n. @msassa \nOne question : Are you using any laravel packages for tenanat database selection?. ",
    "msassa": "yes @atapatel , each tenant has their own queue . But the problem is not the queue name. The problem is the queue process doesn't know about the tenant who run the task, db connection, s3 configuration ... and all data relative to the tenant.. Sorry, how is that?. No, I make a middleware and a method that overwrite the 'tenant' connection. That work just fine.\n. ",
    "willemvb": "https://docs.spatie.be/laravel-medialibrary/demo/responsive-images\nThis demo should work in IE11, does it work for you?\nWe don't use a polyfill ourselves and don't have actual experience with it. Since IE11 doesn't support srcset, things should work out of the box with the largest file available as declared in the standard src attribute. Kinda brute force, but it works.\nIn some cases (browsing back, or loading images from cache) we experienced that the unload script was executed multiple times. The this.onload=null is an inline technique to prevent this. The browser should however execute the entire statement the first time.\nSo I wouldn't recommend removing it, because it would deoptimize behaviour for newer browsers.\nMaybe you could try switching it to the end of the line?\nthis.sizes=Math.ceil(this.getBoundingClientRect().width/window.innerWidth*100)+'vw';this.onload=null\nLet me know if this helps.. ",
    "JeremyRoundill": "I'm hitting the same issue.\nIt seems to be only with the ps:alpha delegate (which I suspect is the reason some PDFs get converted successfully, and some do not), and running the command manually and removing the -dFirstPage=1 and -dLastPage=1 options from the gs command seems to fix things; although I get a segfault when they're included, which could be an issue on my end.\n. My solution was to downgrade back to 9.22 and 9.18 on my two different environments. The dFirstPage and dLastPage options seem to work fine with them. I might have to give 9.25 a go when I've next got a bit of time.. I haven't read into the package well enough to work that out, but if you're able to remove the dFirstPage and dLastPage options, it might fix it.. ",
    "michaellindahl": "You might want to look into using Glide directly: http://glide.thephpleague.com/\nspatie/laravel-media library uses spatie/image which uses Glide.. You can just call ->delete() on the Media object. However it sounds like you'd like to use a single file collection.\n\nIf you want a collection to hold only one file you can use singleFile on the collection. A good use case for this would be an avatar collection on a User model. In most cases you'd want to have a user to only have one avatar.. Alright, I experienced this in two different ways due to some errors. The first was due to a custom listener not working correctly, and the second was due to unhandled errors using a Backblaze B2 filesystem (not handling a 503 system busy error).. Recreated the issue. Looks like when I upload a video, I get the following error:\n\ncopy(\u2026/storage/medialibrary/temp/bfxLU1GSwE6sTHQMptQA6CXhHJxDSnrZ/HiquUPwrz0vS2fLk.jpg): failed to open stream: No such file or directory\nThis error is because the file exists at HiquUPwrz0vS2fLk.MP4 but for some reason the file extension did not keep. The job never ends and it keeps attempting to complete the job, ballooning out the temp directory until the disk is full.\nI only have one conversion on this file:\n$this->addMediaConversion('thumbnail')->queued()\n            ->width(250)\n            ->height(250)\n            ->extractVideoFrameAtSecond(20)\n            ->performOnCollections('videos');. So it appears that extractVideoFrameAtSecond(20) can only be used when you know the video is going to be longer than the specified second. If you choose 20 and the user uploads a 10 second video everything will go to shambles.. ",
    "lloricode": "fetching data from database when getting media from models\nphp\n    $model->getMedia($collection);\n    // or\n    $model->getFirstMediaUrl($collection, $convertion);. i think this is done from owner. ",
    "thanhtutoo": "I am also facing this problem, any solution ?. ",
    "acodeninja": "Is the process that does the conversions running as a different user from the process that is serving your application? In my setup, I have supervisord running conversions and php7.2-fpm serving the site itself. Both processes run as the www-data user (usual for Ubuntu, etc).\nIf you have configured the processes to run under different users this may cause the issue, as the process that is trying to delete the conversions doesn't have permission to delete them (as they were created by a different user).. In our environment I've added the following step to our deployment script while I've been waiting for this to be merged:\nsed -i -e \"s/\\$duration = \\$ffmpeg->getDuration();/\\$duration = \\$ffmpeg->getFFProbe()->format(\\$file)->get('duration');/\" vendor/spatie/laravel-medialibrary/src/ImageGenerators/FileTypes/Video.php\nMight help you and yours with your deployments in the meantime \ud83d\udc4d . ",
    "im-sunil": "\nI am facing same issue Laravel Lumen version 5.7.* . ",
    "denitsa-cm": "@freekmurze I've made a pull request for this. First pull request to an open source repo - yay!. ",
    "anouarabdsslm": "@freekmurze Im experiencing exact the same issue when replacing an image using singleFile option, the record for the replaced image media still exists on media table but the related file get removed.. ",
    "vswarte": "Seems you are lacking some PHP extensions, try installing the mbstring and curl extensions?. ",
    "ThomasTesla": "To add a bit more: It is only possible to get the path or url of the conversion, but not returning it directly.\nSince my media files are not public, I have to return them directly like the default main media item. But like I stated, it's not possible for conversions.. ",
    "hassanalami": "Just found out that the url returned looks like : //storage/{folder}/19/conversions/{filename}-thumb.jpg)\nI'm using getFirstMediaUrl() function to return the url, why does it generate a url with two slashes in the begining ?. My issue was the same as here https://github.com/spatie/laravel-medialibrary/issues/1097\n@alfonsobries reply helped me solving my problem\nhttps://github.com/spatie/laravel-medialibrary/issues/1097#issuecomment-419275560. ",
    "nnvvii": "Thanks a lot @freekmurze for answering.\nRegarding query no. 1, I tried returning an empty string from the generator but then it generated an error \"The expected tiny jpg at Project\\storage\\medialibrary/temp\\5vPNxXCJFMejq1EmeRRrK0BpEdhdlCik\\tiny.jpg does not exist\".. ",
    "bakkertjebrood": "\nyou could define an accesor getUrlAttribute and add it to $appents variable. Than: the toArray() will return also this value\n\nThanks very much! That solved my problem! \nI implemented a custom class as explained here:\nhttps://docs.spatie.be/laravel-medialibrary/v7/advanced-usage/using-your-own-model\nAnd then added the url as shown below:\n```\n<?php\nnamespace App;\nuse Spatie\\MediaLibrary\\Models\\Media as BaseMedia;\nclass Media extends BaseMedia\n{\n    protected $appends = ['url'];\npublic function getUrlAttribute()\n{\n    return $this->getUrl();\n}\n\n}\n```\n. ",
    "trantuanngoctn97": "I resolved it. Problem is, that your variable $media is type Collection, and Collection does not have update method. \n$media = Media::where(['model_id' => $id, 'collection_name' => 'log_doctor_avatar'])->update(['collection_name' => 'doctor_avatar',]);\n. ",
    "metalcamp": "Have you looked at https://github.com/spatie/laravel-medialibrary/issues/1299?. ",
    "ionesculiviucristian": "Temporary solution for me is to use this intermediary method:\n```php\n    /*\n     * @param UploadedFile $file\n     * @return UploadedFile\n     /\n    public function convertUploadedFile(UploadedFile $file)\n    {\n        if (! in_array($file->getMimeType(), $this->requiredMimeTypes)) {\n            $originalName = $file->getClientOriginalName();\n        $image = new Image($realPath = $file->getRealPath());\n        $image->format(Manipulations::FORMAT_JPG);\n        $image->save();\n\n        return new UploadedFile($realPath, $originalName, null, null, true);\n    }\n\n    return $file;\n}\n\n```. ",
    "refucktor": "Please merge this PR ASAP!! The changes introduced in 7.5.5 are breaking the conversions for videos. Kindly ask the collaborators to take action ASAP. I already checked the changes from the proposed PR and they fix the problems. Thanks @acodeninja . Thanks @acodeninja it's a nice solution, I will share mine as well:\n1. Create a new class extending the original one and apply the changes that @acodeninja already propose on his PR\n```\n<?php\nnamespace App\\Media;\nuse FFMpeg\\Coordinate\\TimeCode;\nuse FFMpeg\\FFMpeg;\nuse Spatie\\MediaLibrary\\Conversion\\Conversion;\nuse Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Video;\nclass CustomVideoGenerator extends Video\n{\n    public function convert(string $file, Conversion $conversion = null): string\n    {\n        $imageFile = pathinfo($file, PATHINFO_DIRNAME).'/'.pathinfo($file, PATHINFO_FILENAME).'.jpg';\n    $ffmpeg = FFMpeg::create([\n        'ffmpeg.binaries' => config('medialibrary.ffmpeg_path'),\n        'ffprobe.binaries' => config('medialibrary.ffprobe_path'),\n    ]);\n\n    $video = $ffmpeg->open($file);\n    $duration = $ffmpeg->getFFProbe()->format($file)->get('duration');\n\n    $seconds = $conversion ? $conversion->getExtractVideoFrameAtSecond() : 0;\n    $seconds = $duration < $seconds ? 0 : $seconds;\n\n    $frame = $video->frame(TimeCode::fromSeconds($seconds));\n    $frame->save($imageFile);\n\n    return $imageFile;\n}\n\n}\n```\n\nThen you can update the configuration file of the medialibrary and set your new generator\n\n...\n/*\n     * These generators will be used to create an image of media files.\n     */\n    'image_generators' => [\n        Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Image::class,\n        Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Webp::class,\n        Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Pdf::class,\n        Spatie\\MediaLibrary\\ImageGenerators\\FileTypes\\Svg::class,\n        App\\Media\\CustomVideoGenerator::class\n    ],\n...\nEnjoy! :+1: . ",
    "clementblanco": "It looks like one of the php 7.3 build failed due to TravisCI not being able to run apt-get update. Pretty sure this has nothing to do with that specific PR:\nE: Failed to fetch http://security.ubuntu.com/ubuntu/dists/trusty-security/main/source/Sources.gz  Hash Sum mismatch\nE: Failed to fetch http://security.ubuntu.com/ubuntu/dists/trusty-security/main/binary-amd64/Packages.gz  Hash Sum mismatch\nE: Some index files failed to download. They have been ignored, or old ones used instead.\nThe command \"sudo apt-get update\" failed and exited with 100 during .\nUnsure why Travis failed here. Seems like I can't retry to run the build myself.\nLet me know if you need anything from me.. Trying to close/re-open this to trigger TravisCI build again.. \ud83c\udf89 . Sorry @aFluxx, what do you mean? The tests look okay to me and I could call that function locally when working on that PR. Are you in charge of reviewing that PR? Happy to help you with anything, just let me know how to help.. ",
    "aFluxx": "I tried to use the method getLastMedia but it doesn't seem to work, might I be doing something wrong?\nError:\nhttps://i.gyazo.com/325ef0566efadafd6723ad094aed30b8.png. ",
    "lorisleiva": "Hi there. It's a bit subjective because I have a Media resource class that defines how I want to provide the media to my frontend but here it is:\n```php\n<?php\nnamespace App\\Concerns;\nuse App\\Http\\Resources\\Media;\nuse Illuminate\\Http\\UploadedFile;\nuse Illuminate\\Support\\Collection;\nuse Spatie\\MediaLibrary\\Exceptions\\MediaCannotBeUpdated;\ntrait SyncMedia\n{\n    public function syncMedia(array $newMediaArray, array $keepMediaArray = [], string $collectionName = 'default'): Collection\n    {\n        $newMediaArray = array_filter($newMediaArray);\n    $this->removeMediaNotInArray(array_merge($newMediaArray, $keepMediaArray), $collectionName);\n\n    return collect($newMediaArray)\n        ->map(function ($newMedium) use ($collectionName) {\n            static $orderColumn = 1;\n\n            if ($newMedium instanceof UploadedFile) {\n                $currentMedium = $this->addMedia($newMedium)->toMediaCollection($collectionName);\n                $currentMedium->update([ 'order_column' => $orderColumn++ ]);\n                return $currentMedium;\n            }\n\n            $mediaClass = config('medialibrary.media_model');\n            $currentMedium = $mediaClass::findOrFail($newMedium['id']);\n\n            if ($currentMedium->collection_name !== $collectionName) {\n                throw MediaCannotBeUpdated::doesNotBelongToCollection($collectionName, $currentMedium);\n            }\n\n            if (array_key_exists('name', $newMedium)) {\n                $currentMedium->name = $newMedium['name'];\n            }\n\n            if (array_key_exists('custom_properties', $newMedium)) {\n                $currentMedium->custom_properties = $newMedium['custom_properties'];\n            }\n\n            $currentMedium->order_column = $orderColumn++;\n            $currentMedium->save();\n            return $currentMedium;\n        })\n        ->mapInto(Media::class);\n}\n\nprotected function removeMediaNotInArray(array $array, string $collectionName = 'default')\n{\n    $idsToKeep = collect($array)\n        ->reject(function ($medium) {\n            return $medium instanceof UploadedFile;\n        })\n        ->pluck('id')\n        ->unique()->values()->toArray();\n\n    $this->getMedia($collectionName)\n        ->reject(function ($medium) use ($idsToKeep) {\n            return in_array($medium->id, $idsToKeep);\n        })\n        ->each->delete();\n}\n\n}\n```\nI hope this helps. \ud83c\udf40 . ",
    "sarthaksavvy": "Got it, just need to use endpoint setting.. ",
    "shaffe-fr": "I updated the tests suite to comply with the $@\u00a4$!@ change in PHPUnit 8 where the return type of the setUp method has been strongly typed.\nhttps://phpunit.de/announcements/phpunit-8.html. I fixed the test that I could but there are still errors in the vendor libraries.. ",
    "trevorpan": "Is it really that simple?\nBelow is my attempt at using the above mentioned tutorial (create.blade.php). Will your approach create (3) jobs if a user uploads (3) files?\n```\n@extends ('layouts.master')\n@section ('content')\n\n\nPost a job with BidBird!\n\n\n\n            @csrf\n        \n\n                form stuff...\n\n\n        \nDocuments\n\n\n\n\n\nPost job!\n\n\n\n        @include ('layouts.errors')\n\n@endsection\n@section('scripts')\n\n  var uploadedDocumentMap = {}\n  Dropzone.options.documentDropzone = {\n    url: '{{ route('jobs.storeMedia') }}',\n    maxFilesize: 15, // MB\n    addRemoveLinks: true,\n    headers: {\n      'X-CSRF-TOKEN': \"{{ csrf_token() }}\"\n    },\n    success: function (file, response) {\n      $('form').append('<input type=\"hidden\" name=\"document[]\" value=\"' + response.name + '\">')\n      uploadedDocumentMap[file.name] = response.name\n    },\n    removedfile: function (file) {\n      file.previewElement.remove()\n      var name = ''\n      if (typeof file.file_name !== 'undefined') {\n        name = file.file_name\n      } else {\n        name = uploadedDocumentMap[file.name]\n      }\n      $('form').find('input[name=\"document[]\"][value=\"' + name + '\"]').remove()\n    },\n    init: function () {\n      @if(isset($job) && $job->document)\n        var files =\n          {!! json_encode($job->document) !!}\n        for (var i in files) {\n          var file = files[i]\n          this.options.addedfile.call(this, file)\n          file.previewElement.classList.add('dz-complete')\n          $('form').append('<input type=\"hidden\" name=\"document[]\" value=\"' + file.file_name + '\">')\n        }\n      @endif\n    }\n  }\n\n@stop\n```\n. ok, new at this. I'll give it a shot and get back. Thank you!. ",
    "ggportfoliowork": "I have a project with a lot of various requirements for conversions, deletions, and a varied structure in an S3 bucket.  When I was trying to override the deleted() function on my MediaObserver, Spatie's default MediaObserver was having issues with my S3 bucket, all of the files of which are delivered via CloudFront.  I'm not sure if there's a way to modify the path generator to do what I need, so I wrote a quick modification to the package to allow myself to override the default MediaObserver class with my own, as I did not need the manipulations or file conversions.. Unsure how to get Travis-CI working with PHP Unit\nPHP Fatal error:  Declaration of Orchestra\\Testbench\\TestCase::setUp() must be compatible with PHPUnit\\Framework\\TestCase::setUp(): void in /home/travis/build/spatie/laravel-medialibrary/vendor/orchestra/testbench-core/src/TestCase.php on line 15\nThis PR is based on https://github.com/spatie/laravel-medialibrary/issues/1186#issuecomment-407759942. ",
    "delenamalan": "Try adding '--force' => true to the array of arguments.  I.e. make it \nArtisan::call('medialibrary:regenerate', [\n'--ids' => $this->mediaId, '--force' => true,\n]);. Cool, glad I could help :smile: . ",
    "MoinGandhi": "Hello @delenamalan, Now, it works. Thank you so much for your valuable reply. It works with --force => true. ",
    "Nitpick-CI": "Expected 1 space after IF keyword; 0 found\n. Expected 0 spaces between argument $directory and closing bracket; 1 found\n. Expected 1 space after IF keyword; 0 found\n. Method name IntegrationTest::it_can_move_the_original_file_with_custom_directory_to_the_medialibrary is not in camel caps format\n. - Line indented incorrectly; expected at least 4 spaces, found 3\n- Opening brace indented incorrectly; expected 4 spaces, found 3\n. Line indented incorrectly; expected at least 8 spaces, found 7\n. Line indented incorrectly; expected at least 8 spaces, found 7\n. Line indented incorrectly; expected at least 8 spaces, found 7\n. Line indented incorrectly; expected at least 8 spaces, found 7\n. - Line indented incorrectly; expected 4 spaces, found 3\n- Closing brace indented incorrectly; expected 4 spaces, found 3\n. Method name DeleteTest::it_will_remove_the_files_when_deleting_a_media_object_with_custom_path is not in camel caps format\n. Method name GetUrlTest::it_can_get_an_url_of_an_original_item_with_custom_directory is not in camel caps format\n. Expected 1 newline at end of file; 0 found\n. Expected 1 blank line at end of file; 2 found\n. Method name IntegrationTest::it_can_add_file_to_model_with_morph_map is not in camel caps format\n. - Expected 1 space after FUNCTION keyword; 0 found\n- Expected 1 space after closing parenthesis; found 0\n. The closing brace for the class must go on the next line after the body\n. The closing brace for the class must go on the next line after the body\n. The closing brace for the class must go on the next line after the body\n. Opening parenthesis of a multi-line function call must be the last content on the line\n. - Multi-line function call not indented correctly; expected 16 spaces but found 20\n- Only one argument is allowed per line in a multi-line function call\n- Closing parenthesis of a multi-line function call must be on a line by itself\n. Multi-line function call not indented correctly; expected 20 spaces but found 18\n. - Expected 1 space after IF keyword; 0 found\n- Inline control structures are not allowed\n. There must be one blank line after the last USE statement; 2 found;\n. Expected 0 spaces after opening bracket; 1 found\n. Expected 0 spaces after opening bracket; 1 found\n. Whitespace found at end of line\n. Expected 1 space after FOREACH keyword; 0 found\n. Method name ConversionTest::it_will_extract_a_video_thumbnail is not in camel caps format\n. Method name ConversionTest::it_will_convert_pdf_to_image is not in camel caps format\n. Method name ConversionTest::it_will_convert_svg_to_image is not in camel caps format\n. ",
    "Anahkiasen": "This will need to be removed otherwise it'll mess up the output of the progress bar unless I'm mistaken (since you're technically outputting things in the middle of outputting the bar). "
}