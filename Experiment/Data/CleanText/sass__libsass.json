{
    "akhleung": "Yeah, I'll be commenting out all the \"cerr << ...\"s.\n. Commented out the debug output statements.\n. Fixed since the refactor.\n. Fixed.\n. Fixed.\n. Hmm, seems to be the |= operator that LIbSass doesn't like; thanks for the report. Also, whenever you find a valid bug in a closed ticket, please re-open the ticket -- otherwise it might fall through the cracks!\n. Okay, I pushed a fix to master. Please give it a try!\n. Yeah, unit math is incomplete. Will look into this particular case.\n. This case should be fixed now.\n. Should be fixed now. Sorry for the delay!\n. Wow, thanks for the cleanup! I'll review that last patch this evening.\n. Yes, all the output styles will be implemented. It's currently a low priority compared to other features such as full interpolation and selector inheritance.\n. I'll be getting this feature in by the end of the month!\n. Added support for compressed output styles. Please give it a try!\n. Can you provide more details on how you're invoking LibSass? It's been working for us.\n. Oh, the SassC command-line tool is still hard-coded to use the nested style (haven't had time to update that yet!). To use the compressed style, you currently have to set the flag in the C interface when invoking LibSass as a library.\n. Hmm ... preferably Windows-friendly, but that's less of a priority than keeping the core library itself portable. So I'd say go ahead and use getopt if it makes things much easier and more robust. Thanks for the help!\n. Have you updated the libsass submodule? Try going into the libsass subfolder and run git pull. Then back out and do a make clean and make.\n. No problem! And let me know if the styles don't look right!\n. Sorry I didn't chime in sooner; I was on vacation. Anyway, I would like to support the indented syntax eventually -- as Chris mentioned, this may be as simple as swapping the tokenizer, but that will require a little bit of refactoring (which I was planning to do anyway).\n. Currently the parser and scanner are pretty tightly coupled, so adding support for the indented syntax would be complicated. I am planning to eventually decouple the scanner and parser; once that happens, it should be relatively straightforward to write a new scanner that keeps track of indentation, and swap it in when handling .sass files.\n. Sure, if you can submit a converter function that will take a complete input string and return a complete output string, it should be relatively easy to add it as an extra compilation step. I should mention that LibSass is written in a re-entrant manner, which basically means that you shouldn't use any mutable global or static data (in case the library is invoked by multiple threads).\n(I do eventually want to integrate support for the indented syntax into the parser, but it isn't quite ready for that yet.)\n. Thanks! If you make a pull request with the file that has your function, I'll merge it in and make whatever changes I need to in order to get it working with LibSass.\n. Sounds good so far -- feel free to make a pull request whenever you're ready! I can help with integrating it more when you're ready to hand it off.\n. Since no one has complained, I'm going to assume that this is working for people.\n. Compiles fine on my test systems, but I'll add the import if it's generally expected.\n. Fixed!\n. Nice catch!\nMore specifically: properties that look like functions are passed through without being evaluated. I'll modify the evaluator so that it evaluates the arguments.\n. Should be fixed now.\n. Just check for those three bytes? No problem.\n. I'll work on this one right now.\n. All right, I added checks for all of the BOMs listed on the Wikipedia page:\nhttp://en.wikipedia.org/wiki/Byte_order_mark\nPlease let me know whether or not it works for you.\n. Sounds like a good idea. I'll make the change when I get a chance.\n. Oy, sorry for taking forever on this. The separator will be ';' on Windows and ':' everywhere else. Using an arbitrary separator at runtime will take more effort than I can spare at the moment!\n. Not currently; I didn't have time to look into it when we began the project. Is it as simple as using wchar_t? Will I need to rely on a 3rd party library for checking character classes and such?\n. LibSass will currently read a BOM if present and reject any files that aren't UTF-8.\nAside from that, since we'd like to avoid external dependencies if possible, I'll look into using wchar_t then.\n. LibSass is only going to support UTF-8 for the forseeable future. This support is mostly implemented, and there are tickets for the little edge-cases on which it fails.\n. Merged the pull request; thanks for the fix!\n. All right, this should be fixed now!\n. Fixed in the last batch of updates. Sorry for the delay!\n. All right, this was fixed in the last batch of updates. Sorry for the wait!\n. Fixed!\n. Not enough info to reproduce anymore. :-(  Also, given that I fixed a bunch of hard crashes in the past month or so, I'm going close this issue.\n. Sorry, no progress on this yet; I've been working on other features. The closest thing that LibSass supports so far are human-readable comments that provide the SCSS filenames and line numbers for each generated CSS block (enable with the source_comments flag in the sass_options struct).\nI'll take a look at the article linked above.\n. Thanks for the encouragement! The whitespace-sensitive syntax is on our long-term to-do list. And we always welcome pull requests!\n. I haven't forgotten about your merge request -- I'll be doing some LibSass development next week and will be able to review it then.\n. I'm unable to reproduce the error with the snippet you provided. Is there some larger context that you're leaving out?\n. Unable to reproduce this one too. Can you provide more info on what you're testing against?\n. Thanks, I think I see the problem -- if also exists as a function, and not just an @-keyword. Should be a quick fix. Please keep 'em coming!\n. This particular issue should be fixed now.\n. This is a semantically weird thing for Sass to allow, but I'll duplicate it if it's standard and existing code depends on it.\n. Fixed!\n. Oops, the API has changed slightly -- the sass_options struct now has a field for the path where image assets are located; this is used by the image-url function to automatically splice together paths to images. I'll add a null check to prevent the segfault in the event that the image_path field isn't set.\n. All right, made the fix. Please try the latest master.\n. All right, we've got backtraces now!\n. Oops, spoke too soon. Need to print out backtraces for warnings too, not just errors.\n. Okay, warnings now have backtraces too.\n. Okay, this part is done. Inheritance resolution in general still needs work in order to handle all possible cases, though.\n. Oops, should mention that the new code is still in the inheritance branch. Will merge after some more testing.\n. Done.\n. Will work on the issue this week -- however, please be aware that for the time being, the \"fix\" will be to ignore the directive. As long as your SCSS files are UTF-8 they should work fine; we're still looking into how to handle different encodings.\n. Just made the fix (i.e. ignoring the directive for now)! Sorry for the delay; other issues took prioritiy.\n. Thanks for the report; it's a known issue that I'll be working on this week!\n. Should be fixed now.\n. Thanks for the help! Makefiles are not exactly our forte. I'll merge this in when I'm at my dev machine.\n. I believe this is fixed by the recent patch from @craigbarnes?\n. Thanks for the patch! Windows compatibility is definitely something we could use help with!\n. Thanks for the fix!\n. Done.\n. Good catch! The problem is specifically that conditionals aren't allowed inside namespaced properties. I'll fix this soon. Thanks!\n. Oh, I should also point out that replacing the background { ... } block with the following should work (assuming that the is-url function is implemented in SassScript, of course):\nbackground-image: if(is-url($img), $img, image-url($img));\nbackground: {\n  repeat: no-repeat;\n  position: $x $y;\n}\n. Yeah, the parser is hand-written and somewhat complex, and the formal syntax of Sass itself is fairly complicated too. Documenting the whole thing isn't really feasible for me at the moment, but if you can tell me how you want to integrate Lua and what you want to do with it, I may be able to explain some of the relevant LibSass components.\n(Incidentally, Lua is one of my favorite langauges, so I appreciate your interest in integrating it with LibSass!)\n. Hmm, rather than introduce special syntax, a better way might be to introduce a new built-in Sass function that takes a Lua source string as an argument. Check out functions.cpp for the set of built-in Sass functions. They're also declared in functions.hpp and registered in context.cpp.\nYou could define the function to be used as follows:\n$x: something();\n$y: something-else();\ndiv {\n  foo: lua(\"some_lua_function(#{$x}, #{$y})\");\n}\nUnfortunately, defining functions in Lua and making them accessible in Sass will require a foreign function interface, which is still in development. But once this is done, you'd be able to add Lua support without needing to fork LibSass.\n. All right, directives and whatnot are allowed in namespaced properties now.\n. I'll try to implement this by the end of the month. There's no workaround that I'm aware of; sorry!\n. Sorry for the huge delay; been busy with other work. I should be able to get this in by the end of April (probably a bit sooner).\n. I skimmed it -- looks good! I've been pretty busy recently, so I haven't had a chance to make and test any changes to the repo. I'll try to get this merged in soon.\n. Keyframes are supported now thanks to @enriclluelles, but the code still needs to be generalized to handle other similar directives.\n. This should be totally fixed now in the refactor branch. Will merge it during the coming week.\n. Okay, all of these should be working. Please give it a shot.\n. Given the way that the LibSass tokenizer is implemented, LibSass itself will probably not be able to stream from stdin. It would be better for the caller/wrapper to read everything from stdin and pass it to LibSass as a string. I'll close this ticket and open a corresponding one in the SassC repo.\n. Should be fixed. Please give it a try!\n. Thanks for the heads-up -- we expect that there will be edge cases like this. I'll try to iron them all out as development continues, but right now they're a low priority compared to getting other major features in!\n. Okay, this one should finally be fixed, but there are other similar discrepancies involving concatenation of adjacent strings and expressions (and I think official Sass has some bugs in this area too).\n. Ah, LibSass is currently only implementing Sass 3.1 features. 3.2 features will be under development for the next month or two!\n. Okay, mixin content should be working now!\n. I'm not able to reproduce the error. Can you provide  more details on how you're using LibSass? I.e., are you using the SassC command-line wrapper, or calling it from some host langauge, or something else?\n. Also, are you actually running LibSass, or just buiding it? (I've tried to make LibSass re-entrant.)\n. @gregtillbrook Can you provide a copy of the Sass stylesheets that you're trying to compile? Then I can test them myself and try to reproduce the problem -- it could be that there's a null pointer dereference that I haven't caught.\n. A generic sample that reproduces the crash should be fine -- just post it here, if you can. Thanks!\n. Thanks for the catch! Should be fixed now.\n. Looks like the problem is actually when comments are directly inside media queries. Working on it now.\n. Updating the title of the issue.\n. Should be fixed now!\n. Nice catch. Should be fixed now.\n. Looks good! Thanks!\n. Should be fixed now! Thanks!\n. Currently, the context struct should only be used once per compilation -- although I haven't checked, I'm pretty sure it's not safe to re-use it. We'll look into this possibility in the future.\nAlso, the intention is that a single context struct be used to compile a self-contained Sass project (and then you discard the struct). So if you want an environment to be shared between Sass files, you'll currently need to import them into a single tree of stylesheets. We'll also look into the possibility of preserving the environment between calls.\n. All right, it should be working now.\n. Fixed.\n. That looks like a useful trick. I like it!\n. Sorry; IE compatibility was not originally a priority for me and my sponsor. Will work on this in my next dev cycle.\n. Thanks for the info and the link!\n. This should be working now; please give it a try!\n. Oops, not working completely, but should handle many/most cases. Interpolations work fine inside of the IE function calls, but not plain variables.\n. Okay, this should be fixed now. Unfortunately, I think node-sass is still using an old version of libsass.\n. Are you using the latest version of LibSass? These files all work for me.\n. No problem. I'll close out this ticket.\n. Thanks. We haven't gotten around to the 3.2 features yet, but it's definitely helpful to know what users want most!\n. Thanks for the heads-up. I'm working on variable-length arguments now, and I'll start testing against sass-twitter-bootstrap to figure out which other features to prioritize.\n. All right, variable-length arguments and \"splats\" should work now.\n. Unable to reproduce (and this was already reported and fixed in #64). Please make sure you're using the latest master branch.\n. Whoops, this was an oversight. I'll catch the exception in the appropriate place.\n. Okay, should be fixed now.\n. Thanks, I'll get this fixed this weekend.\n. Okay, should be fixed now.\n. Ooh, it looks like Compass's linear-gradient function is defined in Ruby, so LibSass can't use it. We currently require custom functions to be defined in SassScript (like in Bourbon, which we do test against).\n. Ah, yes, much of Compass is actually implemented in Ruby -- it currently won't work with LibSass. I believe there are long-term plans to port it over, but it's at least several months off. LibSass would first need to provide some kind of foreign-function interface (currently in the works), and then Compass itself would need to be ported to take advantage of it.\n. Sounds like a good idea in general ... just give me a few days to think about some of the specifics. It might be good to continue to make original C struct available (but mark it as deprecated) so that users don't have to change anything, and the API functions can either use a new struct type, or access the C++ classes directly.\n. Sorry, @extend is not fully implemented yet. I'll try to work on this over the holidays.\n. It's on my list of things to work on in the next few weeks, but there are some things I need to get out of the way first (a general refactor, and then C callbacks).\n. Referencing #109 and #110 -- I'm putting all inheritance-related bugs under this ticket for now.\n. Closing this since it's subsumed under #146.\n. Yeah, I'm unable to reproduce this. Please make sure you're using the latest from the master branch.\n. It'll be in the works as soon as I finish the current overhaul (should be done within the week)! See @chriseppstein's comment in #98.\n. Yeah, we're not planning to add Compass features directly to LibSass; rather, we intend to catch up with Ruby Sass, and implement a way for users to create dynamically loadable native extensions. This should allow Compass itself to be ported atop LibSass.\n. Thanks for the catch! I'll look into it.\n. Okay, should be fixed now! It was a silly oversight on my part. Sorry about the delay!\n. @lmartins I'm not able to reproduce the error for @-webkit-keyframes #{$name} {... -- have you pulled the latest version?\n@JasonGhent Can you post a bit more of the context for your error?\nIn general, I don't seem to be getting these missing semicolon errors after mixin content blocks. Can you post more of the Sass that's failing for you? Is it part of a framework that you're using?\n. Okay; looks like grunt-sass may need to pull the latest from libsass/master.\n. Hi Lance,\nthanks for the interest in LibSass! We're currently at version 1.0 (and still have a fair amount of development in the works). As far as a changelog goes, we've pretty much been using the commit history; the plan is to add a proper changelog once we get 100% caught up with the Ruby version.\n. Not a trivial addition ... I'll try to get in by end of April. (I'll also comment on the test suite in the appropriate thread.)\n. I'll be working on this soon -- just need to refactor some stuff first!\n. I'm working on it! This (and an bunch of other things) will be ready in a week!\n. Working on it -- hope to have it working by mid-week.\n. Okay, preliminary support for placeholders should be in. Please note that this is a first attempt, so there may be some discrepancies in the output compared to Ruby Sass. Also, my implementation of @extend doesn't handle the really subtle or advanced cases, so watch out for that as well.\n. This case works for me -- how are you running LibSass? If it's part of another tool, they may need to update to the latest version.\n. Hmm, since there's another issue that specifically addresses this bug, let's just close this one.\n. Thanks for the bug report -- I'll look into it right away!\n. This bug was a silly oversight on my part. It should be fixed now!\n. Okay, this should be fixed as well now.\n. Thanks for the catch -- I've found quoting and unquoting to be one of the trickier things to implement from scratch. I'll look into this.\n. Okay, this should be fixed now.\n. LibSass doesn't handle the @keyframe stuff yet. Will try to add it in the next month. See issue #54.\n. Thanks! I'll look it over merge it in this weekend.\n. Ah, media expressions currently don't get evaluated in LibSass. We're planning to add some new features in the coming weeks, so I'll try to get this in.\nUnfortunately, there's no workaround at this time. :-(\n. Okay, I think I have it working now. Please give it a try.\n. The url parsing is a known issue (#94); I'll probably work on that one next. When you say that you get an empty file, do you mean when you try to use the mixin?\n. All this should be working now; please give it a try.\n. Thanks for the pull request, but I can't merge it as is -- it fails on some cases that I need (the relevant test case is in tests/url.scss of the hcatlin/sassc repo).\n. There are some really long urls (encoded data or something like that) that my team needs to work correctly. I've fixed this in my refactor branch by trying to parse an expression first, then backtracking and munching characters if the parse fails (this was always the simplest solution, but I wanted to avoid backtracking if at all possible).\n. The url parsing code has changed a lot and handles more cases, but still needs work. Can no longer merge this pull request.\n. Thanks for the bug report! I should be able to look into it next week.\n. Okay, should work now.\n. I've implemented this in the refactor branch; will merge it in the next week.\n. It's implemented in my refactor branch, which I will be merging in by Thursday.\n. This should be fixed now. Please give it a try.\n. Thanks for looking into it. I'm currently working on cleaning up the codebase; hopefully this issue will be easier to figure out once that's done.\n. 2 weeks. I apologize if it causes any inconveniences to your projects, but this really needs to happen for the sake of long-term maintainability and scalability; some of the decisions I made during the prototyping phase are now being stretched a bit too far.\nAs far as Compass compatibility, I'm also currently working on allowing LibSass users to hook in their own C functions, which I believe will be necessary for porting Compass. My understanding is that Compass is largely written in Ruby and extends the Ruby version of Sass, such that making it work with LibSass will require some sort of FFI.\n. Oy, I can't believe the code in the original example is even allowed. You can pass keyword args to a function that doesn't declare them, as long as it passes them along to a function that does?!\n. This should be fixed now.\n. Duplicate of #85? Closing.\n. I've added some backslash handling to the refactor branch ... I'll make sure it works with your examples and merge it during the coming week.\n. Hmm, looks like I need to futz with the string matcher ... thanks for checking!\n. Hmm, the modulus operator seems to be relatively new? Thanks for the catch!\n. Huh, I must have totally overlooked it then. :-/\n. Okay, should be working now; please try it out.\n. I re-implemented the parsing for the calc function, so the whitespace should be preserved now.\n. Looks like this one: aa92df14a5778aaec132299f77baf0d8c8c849b0\nI think the latest release tag was made before this commit.\n. I would recommend using the latest master, as it contains numerous fixes that were done over the past couple of months. As for releases, we've been doing this in an ad-hoc manner because we're still catching up with the Ruby implementation, so there are currently no plans for declaring a new release. If you have an opinion on the topic, please contribute to the discussion in #282!\n. Thanks, I was looking for a fix to this problem. I'll take a look at the page that you linked.\n. We've been building on Windows without problems here, so I'm gonna go ahead and close this.\n. Thanks to both of you for your patience and interest! I'll be trying to clear out as many open issues as I can this week, so I'll look at the pull request today. (And I will admit that the edge cases in list evaluation have caused me a lot of headaches, as the behavior of the Ruby implementation didn't seem altogether consistent when I began LibSass.)\n. This should be fixed now. Please give it a try.\n. This should be under the umbrella of #80. Closing.\n. Closing since this falls under #80.\n. Yes, thanks for the contribution! I'm in the middle of overhauling the evaluator, but I should be able to merge your stuff in this weekend.\n. First example seems to be bad use now -- canonical Sass reports an error (the \"to-do\" tests were pulled from the Ruby test suite over a year ago). The second one should be valid though.\nOne of the changes I've been making is to use different classes for each type of Sass expression, so correct evaluation should be much easier when that's all merged in. Looks like I still have to modify the parser to handle some of these edge cases though....\n. Okay, I got all of this working in my refactor branch. I'll merge your pull request so that we can have something that works for the time being. Thanks!\n. I was working on this in my dev branch, but I had overlooked this case -- thanks! I've fixed it in the dev branch and will merge it in soon.\n. This should be fixed now. Please give it a try.\n. Whoops, I seemed to have totally overlooked the null value ... I'll get that fixed by Thursday.\n. Sorry, I've run into some bugs with my refactoring, so I haven't merged it in yet. If I can't get them fixed over the weekend, I'll add the null stuff directly to master.\n. Hi, I'm still working on the issue; it's a little trickier than I originally thought. Will try to have it done by mid-week.\n. Okay, last night I ran libsass on the linear-gradient mixin, and it seemed to work (though the whitespace was a little off). Are you running libsass through sassc, or some other tool? If it's the latter, they might not be using the latest version of libsass.\n. Hey @caldwell, thanks for the contributions! I'll take a look at them tomorrow morning and get them merged in. The C callback stuff is still beta-quality and not super-thoroughly tested right now, so any extra help is welcome.\n(And if you could put your conflicting commits on the same branch, that would be great -- thanks again!)\n. updated the title of the issue, since there's already a separate issue for sourcemaps\n. I've already ported a number of the Ruby Sass tests into Sass-Spec, but the main problem/feature of the Ruby tests is that they are in Ruby -- as such, they can test not only input-output behavior, but can also check whether certain exceptions are thrown, whether certain warnings are reported, whether certain internal data structures have the right properties, etc. I think this will be somewhat harder (or impossible) in a suite like Sass-Spec that is organized solely around input/output files.\n. Also, I'm going to close this issue in favor of the discussion that @chriseppstein opened in #282.\n. To my knowledge, we're not pushing silent updates to the release tags.\n. Hmm, I believe this was addressed in a pull request (#89).\n. Thanks for the link; I'll take a look at the Source Maps Revision 3 Proposal and see if I can implement it.\n. Ooh, sounds great! Looking forward to the pull request!\n. After numerous recent fixes, I've been able to compile @jlong's sass-twitter-bootstrap. Please give it another shot!\n. Hmm ... it looks like node-sass is using libsass as a submodule, so you'd need to go into the submodule folder where libsass is stored and pull the latest changes (e.g., go to grunt-sass/libsass and do git pull).\n. Damn, I put the check in the wrong place ... this should be a quick fix.\n. Should be fixed now.\n. Thanks; I think I've fixed the problem now. As for tests ... we definitely need to improve the test framework. Currently the automated tests reside in the hcatlin/sassc repo; that's the command-line program that uses libsass to do the work. Then there are a bunch of tests in this repo, under the src/tests folder, which I run manually as I develop (I haven't had time to put them all into the sassc repo yet). We do intend to unify all of this in the near future. (Nice avatar, by the way!)\n. Hmm, this works for me ... is Node-Sass using an old version of LibSass?\n. Thanks for the report -- I just made the fix!\n. I believe this is fixed now (though LibSass still doesn't allow superfluous commas at the end of a selector).\n. Thanks for the report; I'll clone node-sass and look into it.\n. Okay, I think I just needed to include stddef.h in order to define size_t for C compilers. Can you try it again?\n. Thanks for the info! I'll make the change to libsass right away.\n. Okay, please try it again!\n. @Nabellaleen Yeah, if I recall, OS X still uses GCC 4.2, which is frustrating because there are some C++11 features that I would have liked to try out in libsass!\n. +1 on providing the scss file that yields the crash -- I need to stamp them out ASAP!\n. This issue is fixed, but node-sass hasn't been updated to use the latest version of LibSass. (Unfortunately, they run into errors when trying to build with the latest LibSass updates; I'll have to look into that.)\n. No problem; better to err on the side of reporting an issue rather than not report it! I'll try to resolve the node-sass issue asap.\n. Thanks for catching this ... I thought I had handled this case, but I'll check again.\n. @extend is tricky to implement completely, and I can't get to it right away, so I can't give an ETA yet. Sorry!\n. @hcatlin and I are set on getting selector inheritance finished by the end of the year, come hell or high water!\n. The example that @jpdevries posted should work now. I'll close this ticket since it's subsumed under #146.\n. Whoops, totally overlooked this feature. I'll look into it.\n. I'll try to get this done this week.\n. Ran into a hiccup with the way that I was parsing selectors, and wasn't able to ensure a robust fix at the time. I'm currently working on overall improvements to @extend, so I'll try to fold this in.\n. Sorry for the regression; I'll look into it.\n. @pkieltyka Can you tell me how you're invoking LibSass? Are you using the interface supplied in sass.h and supplying the include paths as an array? Or are you supplying them as a single colon-separated string?\n. Wait, I just re-read the issue. So you're using sassc? I'll double check there.\n. Okay, both the include-path bug and the file/folder bug should be fixed now. Please give it a try.\n. Thanks for catching this; it must be an odd edge case because we've been using LibSass on lots of projects that rely on variables defined in sub-files. I'll look into it.\n. Okay, after playing around with the sample project, the problem actually has nothing to do with variables. Rather, the parser scans for traditional CSS imports too aggressively -- if it sees any occurence of .css in the path, it assumes it's a plain CSS import and generates something like @import url(\"lib/inuit.css/something.scss\"), and won't actually read the desired SCSS file. This bug has already been filed under #208.\nSo for the time being, removing .css from your folder names should fix it. In the meanwhile, I'll close this issue and work on #208 this week.\nOh, also, running your code turned up a new bug, described in #267.\nSorry for the huge delay and inconvenience!\n. Glad I could help. @kennethormandy: feel free to re-open this issue if you're able to reproduce it on paths that don't have a .css in them.\n. @lbastendorff Thanks for the contributions! I'll look over them and merge them in. If you're unfamiliar with Git and GitHub, look up \"pull requests\" to see how code contributions are typically made. Thanks again!\n. Closing this since it's a duplicate of #139. Had to use sys/stat.h to get the proper behavior back.\nAnd we'd love to have Java bindings for LibSass!\n. Hmm, are you sure that a == a == a does what you think it does? The left-most a == a evaluates to true, and then the resulting true == a evaluates to false. So you still need an intervening logical operator. Granted, it's technically an error in LibSass, but it's also bad Sass usage.\n. I don't think that an expression like x == y == z will ever have the intended effect -- even 5 == 5 == 5 returns false. Are you sure this library is written correctly?\n. Whoops, I was replying to your original comment before the edit; never mind about the relational operators. Anyway, as @hcatlin said, we could definitely use some Java integration!\n. So, file_join isn't a built-in Sass function, but the real issue is that URI parsing in LibSass is still a bit janky because it has to handle both arbitrarily complex unquoted URIs, as well as full expressions such as function calls etc.\n. And yes, there is an alpha-quality facility for adding your own C functions to LibSass. I think I would still need to do a fair amount of work to get it to the point where you could dynamically add new functions in Java, though....\n. Yeah ... there are probably still bugs in URL parsing. If I recall, I do some combination of trying to scan for a URI pattern (but there are lots of possible URI patterns, and some of them can get really complicated), as well as trying to parse a normal expression and backtracking if it fails. I'll probably have to see how Ruby Sass does it, but I imagine they might be using some Ruby library functions (and we're trying to make LibSass zero-dependency).\n. Sure, if you have a link to it, it could help. I implemented my own pattern matching templates for LibSass, but they're pretty similar to regexps.\n. Thanks, I'll see if I can figure it out....\n. No, it's still a bug in the parser -- when it sees url(, it does special things to try to match arbitrarily complex URIs (and normal expressions too), but apparently this case fell through. It's tricky because (among other reasons) URIs and normal expressions aren't disjoint as far as scanning and parsing go.\n. Looks like a dupe of #137? I'll close this in favor of that ticket.\n. Referencing #80. This feature is difficult to implement completely, so I can't give an ETA yet.\n. We know this is an important feature and we're bumping up the priority on it ... it is, however, a very difficult feature to get completely right, but I'm hoping to consult with @nex3 in the near future to figure out how he did it in Ruby Sass.\n. Working on the feature right now. 100% compatibility with Ruby Sass's @extend implementation is a monumental task, but I think I can at least address the specific use-cases in these tickets before the holidays.\n. Okay, the two examples given are now working correctly on the @extend branch, which I'll try to merge in a couple of days.\nThis is not to say that the feature is done -- far from it! I'm just trying to get it working one chunk at a time.\n. The new code is in the @extend branch. It's a bit messy, but it you should be able to build it with the default makefile (I haven't updated the automake stuff yet).\n. Interesting; I'll look into why the order gets mixed up. (At least the output is still semantically correct, if I'm not mistaken.)\n. Oh, also, I should mention that I've merged what I have so far into master, so @extend should work a little better than before.\n. @mzgol @extend is still under active development, and I'm testing against the ~250 or so cases in the Ruby implementation, so it's probably not necessary for you to copy your broken cases here (unless you feel that it's something really unusual). Thanks!\n. It's hard to say for sure, but I think @extend will still require a lot more effort -- that single feature has turned out to be much more sophisticated and subtle than I ever would have imagined when we started this project! Fortunately, @nex3 was kind enough to write up a description of his algorithm, and I've been reading the Ruby source as well, so I hope to get it all figured out in a month or two (depending on how much time I'm able to devote to this project, of course).\n. @vaibhavkanwal All of your @extends are breaking? I did push some new code a couple of months ago based on the algorithm in Ruby Sass -- perhaps that was premature. I'll see if I can make some improvements by early next week. Unfortunately, the full algorithm is complex enough such that doing it in bits and pieces won't produce reliable results; I need to port the whole thing, which I haven't had time for recently.\n. Oh, also, if you could post a simple test case that is failing for you, that would be helpful. Thanks!\n. +1 to what Hampton said, and I'll add that because my employer pays me to work on LibSass (sometimes), what really means a lot to us here isn't the money itself, but rather the show of serious support. This sends a very clear signal that people are taking the project seriously, and for that you have my sincerest thanks.\n. Given the size of the bounty and the complexity of the reference implementation (which makes it hard to port over in an incremental manner), I believe that passing all the extend-tests is a reasonable requirement.\n. Wow, thanks for running these checks! After glancing at op_strings, the problem seems to be that I accidentally used the default operator new instead of my overloaded version that take a Context object (which tracks allocations and deletes them when the program finishes). In fact, any occurence of new that isn't of the form new (ctx.mem) ... is probably an error!\nNot sure what's wrong with op_numbers, but I'll keep looking. Thanks again!\n. Hmm, I merged an earlier pull request from @jbussdieker, and now there's a merge conflict in Makefile.am. Would you mind taking a look at that and rebasing? I'd try to fix it myself, but I don't know enough about autotools.\n. I'm currently working on @extend, but I'll try to get to this one before the holidays!\n. Just putting this here for reference:\nhttps://developer.mozilla.org/en-US/docs/Web/CSS/filter\n. This example should compile now (though the hex colors will remain in hex).\n. Okay, this use of alpha should work now.\n. The fix is in commit db9ef0aa6a981167d08357ada990e7fd91ba0017, but you should probably just use master, as I've recently merged in some pull requests that fix other issues.\nI should also point out that CSS seems to have introduced a number of new filter functions that conflict with Sass functions (e.g. grayscale) -- those are on my to-do list as well. But this particular issue should be closable.\n. All right, I'll go through all the PRs today.\n. Just to clarify, is a feature like this already accessible in Ruby Sass (e.g., via a custom Ruby extension or something), or is it just a Ruby feature that you'd like LibSass to support?\n. Thanks for catching this! If it's an actual crash, I'll move it to the front of the queue.\n. Thanks for the report! @extend is difficult to implement fully, so I haven't been able to cover cases like these yet.\n. Currently working on making @extend do the right thing. It's a very complex feature, but I'll try to get this particular case working by the holidays.\n. Closing this since it's subsumed by #146.\n. This seems to have been fixed for a while now.\n. Essentially a dup of #113; closing in favor of that ticket.\n. Fixed in the @extend branch, which I hope to merge in a couple of days.\n. Okay, the fix for this should be merged in.\n. Thanks for the contribution! The API went through an update over the summer, but there are some projects that are using the old API, so I kept the old interface in place. As long as the top-level client-facing API stays the same, we should be able to merge the changes in; just give me some time to look them over.\n. Thanks for the contribution; we've been needing help with some of these issues! I'll look it over and comment/merge.\n. Sorry, I copied the files when I did a big refactor during the summer, and never got around to deleting the extras. Everything in the src folder is unused.\n. You should thank @hcatlin for this one! Sometimes he cleans my desk too, when he can't stand the sight of it! ;-)\n. Looks like the fundamental issue is that nested media queries need to be combined with some boolean algebra. Closing this in favor of #185.\n. Thanks for catching this; I'll take a look today. Some of those context functions were rewritten a few months ago, so I may have introduced the leak there.\n. Crap, did I forget to fix that? Thanks, I'll merge this in right away.\n. Sorry, I think I overlooked this because I confused it with a different pull request (also regarding sass_interface) that was ultimately withdrawn. I'll go through this tomorrow morning and get it merged in. Thanks!\n. Thanks, I'll take a look and get this merged in!\n. I realize it's been a long time, but now that the sass2scss stuff is part of this pull request, I just want to review it carefully before I merge it. Please hold on for a few more days!\n. Credit goes to @mgreter; I just clicked the merge button!\n. So, although some of the selectors in sass-bootstrap were malformed (extra commas), Ruby Sass accepts them, so I made LibSass accept them too. Closing this ticket.\n. Okay, interpolants within block comments should work now. Please give it a try!\n. This works for me now on the master branch, so I'm going to mark it as fixed. Feel free to re-open it if it doesn't work for you.\n. Hmm, looks like Sass does some boolean algebra on nested media queries ... thanks for the report!\n. Yeah, I have little familiarity with autotools, so I've pretty much relied on the kindness of strangers for that ... I do, however, use the default Makefile for my own building and testing. We added the autotools stuff because we assumed it was \"the right thing to do\" to ensure that LibSass could build on as wide a variety of systems as possible.\n. Off the top of my head, I believe this is because not needs its argument to be parenthesized (in LibSass, anyway). Try something like @if not($one) and not($two) ....\n(I haven't had time to make the syntax of not match Ruby Sass exactly, unfortunately.)\n. Closing in favor of #368, which is the most general phrasing of the issue.\n. Ooh, good catch! Let me change it to an int and see if that fixes it.\n. Okay, I've changed the variable to a double and pushed the change. As for the segfaults, everything works fine when I use gcc/g++, but it's been a while since I've used a Mac, and I've never tried clang. Do you think the problem is with the compiler?\n. Okay, I had to revert the pull request because the binary was segfaulting when compiled with g++ ... some of the changes look inoccuous though, so I'll merge those in piecemeal and try to find the cause of the problem.\n. Yeah, my tests were breaking all over the place when I used g++. Anyway, I'm currently tied up with @extend, so I appreciate your looking into this!\n. Are you using an older version of LibSass? I tried this on master and was unable to reproduce it.\n. Does it happen with the original example you gave, or only when using the url function? Because url is admittedly still buggy.\n. Okay, sounds like this is mainly a problem with url, for which there are already a couple of tickets (#231, #245). I'm closing this one.\n. https://developer.mozilla.org/en-US/docs/Web/CSS/filter\n. All right, closing this in favor of #151.\n. Yeah, this has been in the back of my mind for a while ... I was hoping it would never become an issue!\n. Okay, this should be fixed on master now. Please give it a try.\n. Sorry about the lack of comments; I'll add some. The include_paths string is intended to be a colon-separated list of paths (semicolon-separated if you're on Windows).\n. Wow, pretty cool! Thanks for looking into these issues. As for the big error that you found, I must have assumed that the compiler would never be run with an empty source queue, but of course it would be better (and easy) to check for a null pointer.\n. Ah, that's part of the interface for custom C extensions, which is still alpha/beta-ish quality (and, to my knowledge, not currently used by anyone). I can't recall off the top of my head whether the developer of the C extension is supposed to free the memory, or whether LibSass is supposed to take ownership and free it. I'll open a separate issue for this.\n. Hmm, I'm not sure about this one ... I'll have to dig around a bit to see what makes it different from all the other lexer functions (which I assume generated no warnings)....\n. Thanks, this is awesome! Lemme just grab lunch and wait for the Travis build to finish, then I'll look into merging this in.\n. Thanks -- the build failure probably has nothing to do with your pull request; we've just been lax in keeping the Travis script up to date!\n. Thanks -- the build failure probably has nothing to do with your pull request; we've just been lax in keeping the Travis script up to date!\n. Hmm, I thought Travis had already been choking on something else....\n. Oh yeah, we're running the entire test suite (including the \"to-do\" tests), so that's expected to fail ... but I thought that Travis wasn't even able to compile for some other reason (like, we were passing the wrong flag to autotools or something).\n. A little more info: the error occurs when these 2 conditions are true:\n- the path contains a .css substring\n- the .scss is omitted (or, more specifically, the . in .css is the last one in the path)\n. All right, I've pushed a fix to master. Please give it a try!\n. Gonna assume this is fixed -- feel free to re-open if it crops up again!\n. I'm not able to duplicate this issue -- I think you may be using an outdated version of LibSass. Are you running it via another wrapper such as node-sass?\n. Okay ... I should point out that @supports isn't currently supported, so that still returns a bogus error. The @keyframe stuff should work though.\n. I think the syntax of @supports is different from other @-rules. Anyway, yeah, go ahead and open a separate ticket. Thanks.\n. Essentially a dup of #113; closing in favor of that ticket.\n. @am11 The collection of style_sheets represents all of the scss source files after they've been parsed. The various compilation and rendering steps do eventually produce a single CSS style-sheet.\n. All right, I've made the fix. But how new is this feature? Ruby Sass 3.2.13 doesn't seem to support it yet.\n. Whoops, looks like I oversimplified the preceding code. I should redo the index calculation so that it'll report the appropriate error when indexing too far from the end.\n. Sure, let me merge this for now, though I think I'll still need to do more checks when using negative indices.\n. All right, I've deleted the merged branches.\n. Are you using an older version of LibSass? I'm not able to reproduce the error.\n. This particular issue is fixed in master. More generally, however, LibSass doesn't recognize all the new CSS filter functions; that problem is filed under #151.\n. I've just finished up a number of other bugs, so I'll look at this one next, as the implementation has been bothering me for some time. I've been looking over the parser for the Ruby implementation; hopefully that'll help speed things along.\n. Looking into this now. Hopefully I'll be able to fix it this week.\n. Okay, I believe I've fixed it. Please give it a try!\n. Okay, I'm going to mark this particular issue as fixed. Feel free to re-open if it crops up again.\n. Sorry, the expanded output style is currently identical to the nested style. We do plan to fully implement all four styles, but at the moment, we felt that nested and compressed were the most important ones (since nested is most likely to be used for debugging, and compressed is most likely to be used in production).\n. Covered by #15 .\n. We actually tried this back in the beginning, but the Ruby bindings seemed to want the files to reside at the top level, so we changed it back. Chances are we were doing something wrong (and we have been wanting to organize the source files better), so I'll merge this later today and see if it breaks anything.\n. Hmm, I think now would be a good time to rebase and merge. Thanks, and sorry about the hassle!\n. Okay, the calc function should be fixed now, though this seems to have exposed a different bug because the interpolated placeholders are being output. Please give it a try and see if calc works correctly for you.\n. Okay, output should be correct now, though there will be some extra whitespace compared to the Ruby output.\n. Yeah, the argument to the url function isn't parsed correctly ... I'm looking into how to fix that.\n. Okay, this got fixed with my updates to url scanning. Ruby Sass changes the single quotes to double quotes for some reason (whereas LibSass doesn't), but otherwise the output should now be semantically correct.\n. Yeah, this should be fine. Thanks!\n. I'm looking into this now. Hopefully it'll be as simple as accepting any byte whose value is greater than 127.\n. Hmm ... my understanding is that if we restrict the input to UTF-8, then each byte in a multibyte character will be greater than 127 -- this appears to be by design, to assist with backward compatibility with ASCII. Moreover, the leading byte of a given character will specify how many bytes the whole character takes (I mention this mainly because it seems like it would be useful for implementing Sass 3.3's string length function). I got this all from the Wikipedia article on UTF-8 (particularly the first table in the \"description\" section):\nhttp://en.wikipedia.org/wiki/UTF-8\nAs for using a unicode library, we're sort of attached to the notion of LibSass being zero-dependency (well, aside from standard POSIX and Windows libs). If these issues keep coming up, however, then I suppose we'll have to reconsider....\n. @mgreter I'm working on more general improvements to LibSass's scanning functions, but I'll try your suggestions and see how well they work. Thanks!\n. Sounds good ... incidentally, do you want to put this into a pull request?\n. I've been redoing the scanning functions to be closer to the diagrams and algorithms detailed in http://www.w3.org/TR/css3-syntax/ ... it looks like their definition of a non-ascii character is any char whose value is >= 128. isascii appears not to be a standard function, but assuming it's defined the way one would expect, it should be fine for now.\n. All right, I'll tentatively mark this as ready for validation. Please let me know if you have use-cases that still fail.\n. That particular case is supposed to generate an error (though LibSass's error message isn't very helpful in this case) -- you need to escape the backslash in your string: \"\\\\\".\n. Hmm ... I think your error is probably related to #102, which was fixed just a few days ago. If you're using grunt-sass and node-sass, they probably haven't pulled in the latest updates.\n. Closing this since it's a dup of #231.\n. This seems to be restricted to the calc function, which LibSass treats specially because it's supposed to pass the argument through ... I'll update it to treat the argument as an interpolated string.\n. Okay, interpolation should work properly in the calc function now.\n. The problem is with url, not the @font-face directive. I'll be looking into url this week.\n. Also, since there are other tickets regarding url (#231, #245), and calc seems to be fixed, I'll go ahead and close this ticket.\n. Yeah, little discrepancies like this have been an issue for us (not just whitespace, but also things like color formats, rounding differences, etc). @hcatlin told me that there's a way to get Ruby Sass to output the abstract syntax tree (or something along those lines), so maybe that'll give us a way to normalize the output before diffing.\n. Sure, this feature sounds fine, especially if that's what the Ruby version does. I would prefer to keep working on more critical incompatibilities & bugs in the near future, but I'd certainly welcome a pull request for this if you're thinking about it! :-)\n. Thanks! I can't merge this yet because I just merged a different pull request that reorganized the files, but I'm probably going to revert that because it broke some other build script that I was using.\n. No, it broke the automake build for Windows, which is one of our internal targets. Anyway, I've thought about it a bit more and decided that this probably isn't the best time to make this kind of change -- maybe later, when there's more of a lull in development/contributions, and preferably in a separate branch as well. Sorry for flip-flopping on this one!\n. Hmm, this seems to have something to do with the way that variable-length argument lists are interpreted ... here's a more concise example that shows the erroneous behavior:\n```\n@mixin foo($args...) {\n  @each $arg in $args {\n    @if $arg {\n      thing: $arg;\n    }\n  }\n}\ndiv {\n  @include foo(a, b, false);\n}\n```\nAnyway, I'm looking into this right now.\n. All right, I've pushed a fix. Please give it a try, and let me know if it comes up in other contexts!\n. Yeah, this is a regression -- thanks for catching it. I'll move it to the top of the list.\n. Okay, I've pushed a fix for this -- please give it a try!\n. #183 \n. No problem; thanks for posting the SassMeister example!\n. I've merged the pull request, so please let me know if the error still occurs. Thanks!\n. I recently pushed a fix for the calc function (#239, #246) -- I think node-sass is likely using an older version of LibSass.\n. I tried to make a simple test case (variables in one partial, styles that use those variables in another partial, both imported by a third file), but I wasn't able to duplicate the problem. Can you post a minimal set of files/code that exhibits the bug?\n. Pushed a fix to master. Please give it a try!\n. Essentially a dup of #113; closing in favor of that ticket.\n. I'm okay with removing sassc++ and changing Makefile.am, but I would prefer to keep the test_* files, as I eventually want to turn them into a suite of unit tests. Thanks!\n. \n. Also, are you using the latest master builds of LibSass and SassC? I just tried an example with interpolation and arithmetic operators, and it worked correctly for me.\n. Gonna assume this is fixed -- feel free to re-open if it still happens after SassMeister is updated!\n. Hmm, this doesn't work with the latest LibSass either. I'll look into it.\n. Okay, I've pushed a fix. Please give it a try.\n. Gonna assume this is fixed -- feel free to re-open if it still happens after a node-sass update!\n. Yes, please provide a copy of whatever input you passed to LibSass. Also, be aware that LibSass can be invoked in 2 ways: by providing the name of a file to compile, or by providing the SCSS itself as a string argument. Make sure you're not mixing them up!\n. What tools are you using to build the project? I admit that I'm a bit cavalier about leaving in-progress files in the master branch, but I make sure that they're ignored by the bundled makefiles.\n. Also, I commented out the contents, so I'll go ahead and close this ticket.\n. Thanks for the heads-up! I'll try to get it in ASAP.\n. Okay, I'll bump this up the list if it's causing lots of headaches.\n. Unfortunately, @at-root is a bit trickier, but this one should be relatively easy. #famouslastwords\n. That's correct; the scoping behavior hasn't been updated yet.\n. Just want to let you know that I've been working on this one; I should be able to merge my fix today.\n. I believe that this particular issue is fixed now (though @extend is still not 100% complete). Please give it a try!\n. Whoops, I think I only tested fileA.scss and not fileB.scss.\n. This has been fixed in master -- see #208. Node-sass hasn't updated the version of LibSass that it's using.\n. Are you using node-sass, or standalone libsass/sassc? Node-sass is bundling an outdated version of libsass. I tried an example similar to yours with the master build of libsass, and it works for me.\n. @chriseppstein Thanks for opening this discussion; getting LibSass caught up with the Ruby Sass implementation and community is also one of my goals for this year, and I definitely need support from the more established players. What follows are some issues that have been on my mind in recent months (and if any of them stem from misconceptions or lack of research on my part, then please set me straight!).\nOverall, I'm not a heavy user of Sass/CSS (i.e., I make ovens, but I don't bake!), so my approach to LibSass has tended to be very tactical. I would like to participate in the broader issues as the year goes on, but for the short term, I do need to balance that against the sheer volume of work that's required to fix bugs, implement missing features, and get the codebase better organized. So, having said that, I'd also like to encourage everyone to chime in with suggestions and comments, and I hope I'll have some useful ideas to respond with.\nProbably the biggest difficulty I've had in re-implementing Sass is that, as a language, it doesn't seem to have a comprehensive or precise specification written up anywhere (not counting the reference implementation itself, of course). This had led to numerous mistaken assumptions and misconceptions on my part regarding how Sass works, particularly for subtle edge-casey things (E.g., what happens when you nest media queries? The sass-lang docs say that they'll be combined with and. But it's actually more complicated than that, depending on how the media types match up! Also, in what order are nested combinations of media queries and rulesets rendered? Et cetera.). Granted, maybe I could have averted all this if I had simply done a line-by-line port of the reference implementation, but ... well, I'm sure you're familiar with Larry Wall's remark about the laziness, impatience, and hubris of programmers....\nAnyway, to address the specific points that @chriseppstein mentioned in his post:\nGeneral feature compatibility -- @hcatlin and I definitely want to make some kind of comprehensive grid, but does Sass itself have such a thing? I've glanced at the changelogs, but it would be helpful if all that information was tabulated somewhere (and if it isn't, then I'm guessing that I just volunteered for the task?). Also, it's sometimes hard for me to decide what's a discrete feature, versus what's a fundamental property of the language (E.g., is nesting a feature, or is it so fundamental and pervasive that there's no point in listing it? What about nestable media queries? Variables? Interpolation? Arithmetic? Etc.). On top of that, the fact that SCSS is a superset of CSS, which is itself evolving to include Sass-like features, makes things even fuzzier for me (e.g., nested media queries were once a Sass-only thing, but now they're \"normal\" in CSS3). It would be very helpful if some kind of official feature table were available for recent Sass versions.\nFeature prioritization and versioning -- I've been thinking that the simplest thing would be to make LibSass version numbers follow the Ruby Sass version numbers, and our goal would be complete feature parity between matched versions (obviously we're not there yet; we'd have to declare a target (probably 3.2) and make it happen). But the downside would be issues like #278; apparently, this 3.3 feature is expected to be widespread enough such that I've been encouraged to implement it even before finishing the remaining 3.2 features. I'm open to suggestions as to how to reconcile these issues.\nSass-Spec -- Looks like @hcatlin has already commented. I'll add that he had mentioned that you have some idea about how to overcome the problem of non-semantic discrepancies (something about getting Sass to output its AST?).\nAnyhoo, just wanted to get my perspective out there, and hopefully this will encourage more discussion.\n. Hmm ... having skimmed the Rework parser, it looks too \"coarse-grained\" to be able to do the sort of normalization that we'd need (for example, it matches the right-hand side of a style declaration as a single chunk of text, whereas we would need something that can break down every little subexpression).\n. I assume this is regarding source maps? If it's the same issue as the one reported in #264, then you may be using an outdated build of LibSass.\n. I see ... in that case, I'll wait for @svnieuw to comment, since I haven't familiarized myself with the source map implementation yet.\n. Closing this, since it's covered by #233.\n. You're correct; it's currently hard-coded. It should be relatively easy to make it configurable.\n. All right, I've pushed a fix for this. The context struct now has a precision field that you can set; I've also added a --precision option to SassC.\n. Was fixed, but now it's regressed. :-( Addressed in the newer ticket #364.\n. I'm not familiar with that pseudo-class, and I wasn't able to google up anything useful ... I'm guessing it's really new? Could you link to some documentation about it?\n. I tried your example on the master branch and the import appears in the output (although LibSass doesn't move it to the top of the file the way that Ruby Sass does) ... have you pulled in the past couple of weeks?\n. Okay, this should be fixed now. Please give it a try.\n. Looks like a dup of #151.\n. Loud comments are working in master; node-sass and grunt-sass are still using outdated versions of LibSass.\n. Ah, that's because LibSass treats not like a function, and expects the argument to be parenthesized -- if you don't parenthesize it, it'll be treated as a constant. If you use not(unitless($value)), it should work.\n. Gonna close this in favor of #368, which is the most general phrasing of the issue.\n. Agreed, this is fixed in master. (LibSass doesn't quote the URL the way that Ruby Sass does, but the output is semantically correct.)\n. All right, I've changed that name to lowercase. Please let me know if it compiles now!\n. Gonna assume this works for you; please re-open the ticket if the problem persists!\n. If I recall, Sass used to be more liberal about where you could put the &, but the rules were tightened up a release or two ago.\n. Loud comments are working in master; node-sass and grunt-sass are still using an outdated version of libsass.\n. I'm not able to reproduce this -- are you using LibSass through Node-Sass? That version is outdated; I believe this behavior is fixed in the latest master branch.\n. If this isn't valid Sass, I'll go ahead and close the ticket.\n. It's ugly, but this should do the trick for now:\n```\n$x: \"\\\"hello\\\"\";\na#{\"[data-foo=\" + $x + \"]\"} {\n  color: red;\n}\n```\nI'll have some time next week to work on this bug (as well as some others).\n. All right, I've pushed a fix for this. Please give it a try!\n. Thanks for the report -- it looks like a duplicate of #308. I'll close this in favor of the earlier ticket.\n. This should be fixed now. Please give it a try.\n. Hmm, I believe @hcatlin maintains the brew thingie; I'm not sure what the status of that is. The readme in the SassC repo should have pretty good instructions on building from scratch (LibSass is no longer a submodule; you need to grab the repos separately and set some environment variables).\n. This should be implemented now. If you're using LibSass through node-sass, they'll need to pull in the latest changes.\n. Thanks!\n. This issue is a pretty big bucket, but we do plan to add 3.3 support!\n. All right, that selector syntax should be relatively easy. I'll move it up on the to-do list.\n. I'm going to try to make time for it this week.\n. I think it's up to the node-sass maintainers to manually pull in the latest libsass updates.\n. Services like SassMeister and node-sass are probably still using an old build of LibSass ... if you're testing with them, you'll still see the old behavior. (I'll double check this when I get to my work machine though.)\n. Just following up to say that your example works on my local build (both the current master branch, as well as the commit that's tagged as the 2.0 release).\n. Uh oh, this looks like it's probably related to @extend ... :-(\n. The aspect ratio stuff works when I try it ... are you using the latest LibSass?\nAlso, I have considered adding some sort of \"pass-through\" block to LibSass, but haven't really had time to think through it.\n. This seems to have been fixed for a while now.\n. Closing this, since it's subsumed by #263.\n. Hmm ... I'm wondering if it would be better to convert single backslashes to double backslashes (so that they're escaped). Anyway, I'll merge this now, since it seems easy enough to switch it to the other option.\n. Can you provide some SCSS code that causes the crash?\n. The SCSS snippet works fine on my master build ... it could be that node-sass needs to pull in the latest LibSass changes, or maybe there's a problem with its bindings.\n. Oh, also, if the snippet is part of a larger file, please post the whole thing -- maybe the combination of various pieces of code is causing the problem.\n. This should be fixed on master now; please give it a try.\n. Hmm, I assumed that that form of if would behave like an ordinary function and evaluate all of its arguments ... I guess it needs to be treated like special syntax as well.\n. Okay, this should be fixed in master. Please give it a try.\n. I'm going to be overhauling the tokenizer this week and will factor out the vendor prefixes along the way, but for now I'll merge this in as a stopgap.\n. Currently not possible with the C api, though it is theoretically possible if your app is in C++ and you're willing to invoke various LibSass components directly. I'll take a look at the feature and see if I can add the support at some point.\n. Hmm, I am getting a hard crash on the command-line with the latest code. Will look into it.\n. I'm not able to reproduce this, so I'm guessing Node-Sass is using an outdated version of LibSass. Unfortunately, I don't know which version of Node-Sass to roll back to.\n. Looks like this is actually a dup of #323.... will try to get it fixed this week.\n. Sorry, I didn't realize that loud comments were a separate thing until this issue got filed! Compressed mode will currently strip all comments.\n. I tried this out, but it fails on a different set of cases -- for example, the following:\ndiv {\n  blah: not true;\n}\nis supposed to remain unchanged, but your fix will cause it to be evaluated into\ndiv {\n  blah: false;\n}\nI believe there needs to be a deeper fix ... this week I'm going to be updating the scanner/parser and making it work more like Ruby Sass, so hopefully I'll be able to figure out exactly what's going on there. For the time being, a workaround is to parenthesize the argument to not (e.g., not(true)) so that it looks like a function call.\n. Thanks for the bug report. Can you post a snippet of the actual SCSS that caused the crash?\n. Thanks for investigating!\n. Related to #98; closing this issue in favor of that one.\n. We do want to implement it eventually. I would have been fine with leaving this issue open. In fact, I guess I'll re-open it.\n. Related to #293 which boils down to the same problem, so I'm going to close this one. If you put parentheses around the argument for not so that it looks like a function call, e.g. not($var), it should work correctly.\n. Closing this since it's a dup of #346.\n. Closing this since it's a dup of #308.\n. Hmm, looks like the error might actually be in your _variables.scss, line 103 ... can you post that file?\n. Interesting ... I suppose I could try storing only the precision in the To_String visitor instead of the entire Context object....\n. Closing this one, as it's subsumed by #151.\n. Sounds good -- I had assumed that binary literals were part of the C standard, but I guess that's not the case! Feel free to make a pull request, or I can make the change in the morning.\n. Okay, changed the binary literals to hex literals. Please give it a try.\n. Great, looking forward to it!\n. I still get a warning about an unused variable pos_right, but otherwise it looks good.\n. Hmm, GitHub won't let me merge this automatically anymore, so I'll stick with the hex literals for now. Thanks!\n. Looks like this is working now thanks to some recent updates to the parser.\n. Hmm, it looks like you're returning a map? Maps aren't implemented in LibSass yet.\n. Closing this since it's covered by #263.\n. My knee-jerk reaction is that I'd rather not make libiconv a dependency of LibSass itself ... it might be appropriate to put it in SassC instead, as a conversion step before invoking LibSass. If libiconv needs to be invoked on each import in a Sass project, then maybe this could be solved with custom importers (i.e., SassC could provide a callback that would pass each import through libiconv). Or, since the command-line version of iconv is installed on most Unix-like systems, we could even simply pipe each import through that before compiling (not what I would actually recommend).\n. Give me a couple of days to collect my thoughts -- it's been a while, and I'll need to revisit some of the code in the visitors (no pun intended).\n. Sounds good to me (though it's Hampton's decision).\n. Hmm, I seem to have lost my contributor/team-member status ... could I get that back? :-)\n. I actually wanted the opposite -- keep the hand-written makefile which is fast and clean, and get rid of the automake stuff which seems like overkill for LibSass (and takes like 10x longer to build).\n. Sorry, there are a few @extend-related regressions, which is why the tests are failing. I'll move them to the todo bucket this weekend.\n. Ah, I see the problem ... the build that uses the default makefile compiles, but fails on the aforementioned test cases. The one that uses autotools fails to compile because I haven't updated the makefile template to include some new files that were added in a recent commit.\n. Thanks for the reports and the link to the docs ... I had assumed that this feature was only for iterating over maps (which LibSass doesn't support yet), but iterating over lists of lists should be fixable in the short term.\n. It's a submodule; you'll need to do a git submodule init and git submodule update to pull the files in.\n. Sorry for the delay; I haven't had a chance to look at this closely yet.\n. I tested this on master and it works ... can you post a larger code snipped that fails? Also, it could be the case that node-sass needs to update the version of LibSass that it's using.\n. Currently no good way to do this ... the proper way would be to create an extension, but LibSass currently doesn't support user extensions. (And I arguably should never have added image-url in the first place. :-/)\n. Can you give a specific example of when it would allow erroneous SCSS to pass through? My rationale for catching an exception here is to allow the parser to try parsing a full SCSS expression for the argument to url(...), and if it fails, then backtrack and try parsing a literal URL. Actual syntax errors that are caught by the rest of the parser will propagate correctly, I believe.\n. When you say that the code base is huge, I assume you're talking about your SCSS code? I suggest commenting out large portions to see whether it still crashes, until you can narrow it down to a single file or block of code that's causing the crash, and then post it here. (Or if you can link to your SCSS code base, I can try to track down the problem for you.)\nI should also mention that node-sass is probably using an out-of-date version of LibSass at this point ... I need to update a few tests, and they should be able to pull in the latest master version.\n. Works on master ... I believe that node-sass/grunt-sass probably needs to update its version of LibSass.\n. Right now the most reliable way to see if a function is implemented is to check the list of built-ins in functions.hpp. (But yes, call isn't in there.)\n. LibSass currently doesn't support @supports, though it is on the list of things to add.\n. Hmm, the text inside multi-line comments is interpreted by LibSass because things like variable substitutions are allowed, but it looks like it needs to treat the comment as raw text when interpretation would result in errors.\n. Ah, we added code recently to make hyphens and underscores interchangeable in variable names, but it looks like we neglected to do it to the iteration variables in the @each and @for directives. We'll get this fixed soon.\n@wonja\n. I believe this was fixed in #436 ... Node-Sass will need to pull in a newer version of LibSass in order to get some of these bugfixes.\n. This looks like a significant addition, so I'll need a bit more time to review. Thanks!\n. Not able to reproduce the segfault (this may be a problem with Node-Sass?). The issue of color names was brought up in the past, but it looks like the fix wasn't general enough....\n. Whoops, looks like #308 is still open. Closing this in favor of that ticket then.\n. I'm not able to reproduce the error when running LibSass on its own ... given the various other segfaults that have been occurring with Node-Sass (which I can't reproduce when running LibSass standalone), I'm starting to think that there might be something wrong with how they're handling LibSass errors....\n. I'm not able to reproduce the segfault. Are you using Node-Sass? I think it's still using an older build of LibSass.\n. I'm not able to reproduce the segfault ... it could be that Node-Sass is using an outdated version of LibSass.\n. Sorry, I just haven't had time to look at it yet. Will try to get it merged soon.\n. Looked over the code and it looks good ... I'll test/merge it in the morning when I have access to my work machine.\n. Unfortunately, it looks like node-sass's maintainer is no longer able to devote time to the project:\nhttps://twitter.com/teabass/status/494993372252495874\n. Sorry, I've been really busy for the past several weeks. I'll take a look at these this week.\n. Hey sorry for the delay -- I've been ill for the past few days. I'll review this and comment on it today!\n. Sure, I'll get this merged in time for SassConf.\n. Sorry, I have to reject this -- you seem to have accidentally made a lot of breaking changes to other files.\n. Alas, my employer (who sponsored the initial development of LibSass) needs it, which is why it's in there....\n. @hcatlin Yeah, that would be the proper thing to do ... image-url was added early in LibSass's life cycle because we were using it all over the place.\n. I merged a PR late yesterday ... have you pulled the latest master into your branch?\n. Hmm, that test should work with #517 that was merged yesterday.\n. Lemme review this and get back to you regarding the open questions. I think Ruby Sass might have an easier way of handling this, but I'll need to re-read their parsing and scanning code.\n. Hmm ... I haven't kept up with the implementation of the map feature, but I can say that code that makes maps work in the @each directive (and other control structures) needs to be in both the Eval and Expand visitors -- I'm guessing that the former wasn't updated.\n@xzyfer \n. @xzyfer \nOkay, at the high level, the difference between Expand and Eval pretty much mirrors the distinction that most languages make between statements and expressions -- the former are executed primarily for side effects (control flow, state change, etc), whereas the latter are evaluated primarily to return a value.\nSo, the Expand visitor is primarily for expanding declaration blocks, running standalone control directives (which are in turn expanded into more declaration blocks), expanding mixins, etc -- basically, things which are expected to expand into blocks of CSS code. The Eval visitor is primarily for reducing expressions down to values -- so, it basically handles anything inside an interpolation, or on the right-hand side of a declaration (function calls, arithmetic, etc).\nSince control directives can occur in both an expansion context (i.e., a context where declaration blocks are supposed to be generated) and a value context (i.e., inside a function, from which a value must be returned), both visitors must implement them.\n. When using a control directive as an expression (i.e., inside a function), the only things permitted inside are assignments, warnings, more control directives, or return statements (this is all enforced by the parser). Among all those things, note that return statements are the only ones that directly yield values; the rest are executed for their side effects.  So, the eval methods for all of those things return null except for return statements -- thus, when the evaluation of a control directive's body yields a non-null value, we can assume that there was a return statement inside, and bail out. Otherwise, it was one of the other kinds of expressions, and we need to keep looping in order to execute the side effects.\n. Yeah, I think we needed it for Bourbon support at one point ... not really necessary now that variadic functions are natively supported.\n. @mgreter @hcatlin I think the best solution in the long run would be to use dlopen (and whatever the analogous feature is on Windows) to have truly dynamically loadable 3rd party functions, without needing to recompile LibSass.\n. If memory serves, Ruby Sass had this restriction. LibSass's @extend implementation hasn't fully caught up with Ruby Sass's.\n. I haven't had time to look into this further, but if I recall, the Ruby Sass tokenizer checks whether the entire right-hand side of a style is static. Specifically, it has a regexp that checks for styles that don't require interpretation (i.e., anything without interpolations, arithmetic symbols, etc). I assume the Ruby Sass parser will then generate some sort of static style node that will simply pass though the interpreter unevaluated. I would guess that this is how it is able to ignore certain occurrences of not. I believe that adding this feature to the LibSass tokenizer would solve this case, and perhaps numerous other edge cases.\n. @mgreter Let me see ... the is_delayed flag was, at the time, the only way I could think of to handle those cases where Sass sometimes evaluates the RHS of a style declaration, and sometimes not (specifically declarations with slashes, which are sometimes quotients, and sometimes just separators). However, I believe that this may be fixed by the recent tokenizing update that scans for static rules -- this might be the way that Ruby Sass decides whether or not to evaluate the RHS of a style (i.e., always evaluate, unless the declaration was matched by the \"static declaration\" regexp).\nAs for the hoistable flags, I'll need to review the code a bit -- it has to do with whether blocks can be flattened or not, which depends on whether the elements within are \"hoisted out\" during final rendering, or remain nested. I can't recall all the details at the moment, so I'll have to get back to you on this one.\n. Also tagging @xzyfer \n. I guess that's what I get for copying and pasting code :-/. If you're already committed to using C++11, then maybe the sequence and alternatives prelexers could be rewritten to use variadic templates.\n. Yeah, I had been meaning to make this change -- I didn't know what the convention was when I started the project!\n. Yeah, I had been meaning to make this change -- I didn't know what the convention was when I started the project!\n. I believe variadic argument lists were supposed to make this function unnecessary.\n. Hmm, looks like the parser is interpreting the expression as a subtraction instead of a list of two elements.\n. Ooh, pretty cool! It'll be interesting to see the impact on large scss projects.\n. Gains would be significant for the test suite because it's a lot of tiny inputs -- but I doubt this is representative of most real-world inputs. Just wondering if the added complexity is worth it; the old way is (IMO) very readable, maintainable, and provides a bit of implicit documentation for the built-ins!\n. The check for (str[i] & 0b11000000) == 0b10000000 should follow the check for i < length_of_s; otherwise, it'll be possible for the former to run off the end of the string and attempt an invalid access, since it currently runs before the length check. Also, I'd feel better if the str[i] were cast to an unsigned char.\n. This is still error-prone -- i could be the last valid index, upon which this code would increment it and try to make an invalid reference. It's probably best not to use c in the else clause, and just use something like\nwhile ((i < length_of_s) && (static_cast<unsigned char>(str[i])). That way, the string accesses are always guarded by the length check.\n. You should call unquote on the argument to these functions; otherwise, if the argument happens to be quoted, you'll get a false negative since the quote marks are part of internal representation of the string.\n. Just to be safe, this clause should be else if (parent_) { ..., and there should be another else clause after it that returns false -- just in case someone ever tries to call this method on an environment that has no parent.\n. That seems fine for a first pass; we can optimize later if it becomes a problem.\n. Hmm ... I assume that this function is supposed to accept lists and treat them as maps that have integer keys? If you need to handle both cases, I can't think of a good way to do the type checking that wouldn't involve some boilerplate ... I suppose you could write variants of ARG and get_arg that can take 2 or 3 different types, and check that the argument matches one of them....\nAlso, even though you check for both Maps and Lists, you seem to cast only to a Map afterward -- is this an omission?\n. Actually, now that I've consulted the Ruby Sass docs and code snippets, I'm not sure why you're checking if the $map argument might also be a list -- can't you just require it to be a map? Then you could just use\nMap* m = ARG(\"$map\", Map);\non the first line.\n. Whoops, didn't see your replies before I posted my more recent remark.\n. dynamic_cast will return a null pointer if the cast isn't possible (and List to Map isn't possible, if you actually have a Map). This will probably cause a crash! Anyway, I'll provide more feedback tomorrow.\n. damn, I meant \"List to Map isn't possible, if you don't actually have a map\"\n. Oh, looks like you check the result of the cast and abort if it's null ... never mind. Sorry for spamming all these comments.\n. These interface structs are still alpha quality, so implementing them isn't a super-high priority (but it's good to be thorough). An array of key-value pair structs sounds good, especially if it reflects what Ruby Sass is doing internally.\n. It might be worth seeing if you can add a template specialization of get_arg (specialized for Map) that does some extra checking to see if the arg is an empty list, and if it is, then replace the arg with a newly-constructed empty map and return a pointer to that map. (If you try this, you'll need to modify get_arg to take a Context object so that the memory allocations can be tracked.)\n. This line should not be removed! The tests should pass once this bit is fixed.\n. @xzyfer The Inspect visitor is meant for rendering internal nodes back into a textual format (and the To_String visitor is defined using Inspect). In addition to rendering the final CSS output, it's also useful for debugging, in case you just need to print out internal nodes in your debug logs.\nControl directives such as @each aren't present in the fully expanded tree, so they'll never be rendered in the final output. But the Inspect visitor still handles them in case you really need to print them out.\n. ",
    "hcatlin": "I'm doing sample outputs and stuff right now and also trying to\nbuild gem releases for tomorrow....\nsooner rather than later, plz.\nOn Sun, Apr 22, 2012 at 5:31 PM, Aaron Leung <\nreply@reply.github.com\n\nwrote:\nYeah, I'll be commenting out all the \"cerr << ...\"s.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/hcatlin/libsass/issues/1#issuecomment-5271848\n. Just fixed it! \n. Using the SassC wrapper? or just compiling it directly?\n\n-hampton.\nOn Mon, Apr 23, 2012 at 6:18 PM, Nathan Weizenbaum <\nreply@reply.github.com\n\nwrote:\nI get a segfault when I try to compile foo {bar: 1px * 2}.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/hcatlin/libsass/issues/8\n. Whoops. I'm late to this issue... :( Sorry.\n. Done and done.\n\nFirst pull request a grand success.... and based off the fact that I'm a dumbshit.\n. This is the right place! All that logic is handled here. We'll get this\nsorted quickly.\nTotally forgot that feature... sorry!\nOn Tue, Apr 24, 2012 at 4:25 AM, Johan Halse <\nreply@reply.github.com\n\nwrote:\nThis might be posted in the wrong place (I was testing sassc so maybe\nthat's where this should go). But sassc won't import partials the way\nvanilla SASS does it, using underscore for naming and then omitting both\nunderscore and extensions in the import directive.\n``` css\n/ This will fail: /\n@import \"variables/measures\";\n/ This will succeed: /\n@import \"variables/_measures.scss\";\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/hcatlin/libsass/issues/10\n```\n. Yay. Let's get rid fo some of those warns... thanks man!\n. lars- yeah, I'm up for that change. I like it. \n\nJust have to make sure to coordinate this with the SassJS guys' work.\nOr, were you helping with that too?\n. Lars, I noticed you said there were no tests... there are! They are just in SassC... which is the\nrecommended way to dev on libsass. \nI just added a note to the readme about this... 6b8405d10372b225e5d302a82b32ba296fcb5722\n. Yeah, I was working on this... make install is a bitch if its cross-compatible!\n. That's the main method I was assuming for integration! So small anyway..\n- Hampton\nOn Apr 27, 2012, at 2:42 PM, Andrew Nesbittreply@reply.github.com wrote:\n\nFor the moment I'm going to vender libsass into node-sass and compile it all on install as libsass as no other dependencies.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/hcatlin/libsass/issues/14#issuecomment-5390988\n. I think this is sorted already.\n. Awww, we didn't mean to ruin your excitement.\n\nOn Tue, May 1, 2012 at 6:05 AM, Jamie Rumbelow <\nreply@reply.github.com\n\nwrote:\nI got all excited about adding different output styles to my libsass\nbinding to discover that only SASS_STYLE_NESTED is working!\nAre there still plans to make the other style constants work?\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/hcatlin/libsass/issues/15\n. We are trying to match the styles produced by the Ruby implementation. I'm going to close this since the issue is actually about the constants, not compatibility with Ruby sass.\n. We have no plans to support meaningful white space with libsass. \n\nWill accept a super well tested patch if you are passionate. Complex enough to get the more popular form working.\n- Hampton\nOn May 4, 2012, at 3:54 PM, Donald Plummerreply@reply.github.com wrote:\n\nGiven the test.sass file:\ndiv\n background-color: blue\nwhen I run \"./bin/sassc test.sass\" I get the error:\nERROR -- test.sass, line 1: invalid top-level expression\nIs there a flag I'm missing, or is sass not supported yet? Significant whitespace is awesome.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/hcatlin/libsass/issues/16\n. What about mixins and stuff?\n\nWe'd happily support this if its doable!\nOn Sat, May 5, 2012 at 9:23 AM, Chris Eppstein <\nreply@reply.github.com\n\nwrote:\nSeems to me that whitespace can be supported by a preprocessing step that\nconverts indents and outdents to curly braces and adds semicolons.\nshouldn't actually be that complicated.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/hcatlin/libsass/issues/16#issuecomment-5528323\n. Methinks we should keep this quiet till Camp Sass\n\nOn Wednesday, March 19, 2014, Marcel Greter notifications@github.com\nwrote:\n\nI did some more refactoring. My C++ is really very bad and I don't feel\ncomfortable to push anything in this perspective without any proper review.\nBut from this point on, given that actual converting works correctly, one\nshould be able to use this function to convert sass to scss.\nhttps://github.com/mgreter/sass2scss/blob/master/sass2scss.h\nhttps://github.com/mgreter/sass2scss/blob/master/sass2scss.cpp\nMaybe someone from this thread could verify if my implementation works\ncorrectly? I have created a repository which also contains a basic\ncommandline tool:\nhttps://github.com/mgreter/sass2scss\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/16#issuecomment-38128270\n.\n. I believe this is already solved. Please let me know if it's still an issue.\n. Hmm... yeah, we haven't written anything like that. I bet we could do it\nwith a callback that you can register.\n\nIn your mind, would you expect the @import callback to act like a \"last\nditch\" or \"method missing\" resolver? Or, have it be the first thing\ncalled, and then if it's unaware of a package name, go to the standard Sass\nimport resolver?\nOn Mon, Oct 6, 2014 at 10:36 AM, Johannes Ewald notifications@github.com\nwrote:\n\n@BPScott https://github.com/BPScott that's exactly the use-case [image:\n:+1:]\n\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/21#issuecomment-58025932.\n. Hmm\u2026 I think I\u2019d assume it did local resolution first. But, I can see your point.\n\nOn Mon, Oct 6, 2014 at 11:38 AM, Ben Scott notifications@github.com\nwrote:\n\nI think it would need to be the first thing to try. This functionality feels like an override rather than a fallback coping mechanism.\nI believe @import 'foo/bar; would need to look within the foo package first, then if that fails it should use the default resolver to try the relative file path ./foo/bar.scss (though it could be up to the binding library to skip trying the default resolver). Otherwise you could end up with oddness where files relative to the current file take precedence over the files from the package manager which would be undesirable.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/21#issuecomment-58036305\n. Can you attach a sample failing file?\n- Hampton\n\nOn Jul 6, 2012, at 10:27 AM, Igorbekreply@reply.github.com wrote:\n\nWhen trying to process file with UTF-8 with signature (BOM) encoding, getting error:\nERROR -- filename, line 1: invalid top-level expression\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/hcatlin/libsass/issues/22\n. Sorry guys! Behind by a couple days. Aaron's going to review this today.\n. I believe we intend it. We are noobs.\n\nOn Mon, Jul 9, 2012 at 3:50 PM, Igorbek <\nreply@reply.github.com\n\nwrote:\nInternally the project uses 'char' instead of 'wchar_t' for manipulating\nstrings.\nSo that means no Unicode support?\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/hcatlin/libsass/issues/25\n. ooohhhh\n. Not yet! But should be fairly trivial once we get the time. Patches welcome!\n- Hampton\n\nOn Jul 27, 2012, at 12:19 AM, Mario Rutzreply@reply.github.com wrote:\n\nHi,\njust one quick question: Does libsass support the \"debug_info\" option that generates Firesass compatible meta information?\nCheers,\nMario\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/hcatlin/libsass/issues/33\n. @franckbret LibSass is a pure library. It doesn't execute itself. SassC is the counterpart to libsass that allows you to read from stdin.\n. Can you please open an issue on SassC? This isn\u2019t something we can fix in this project.\n\nOn Thu, Oct 16, 2014 at 10:21 AM, franck bret notifications@github.com\nwrote:\n\nThanks for your answer. Btwi don't get why i can't see this option when I run ./bin/sassc --help\nI've seen this merge, quite old but with stdin support at the sassc level, so I supposed it was ok... https://github.com/sass/sassc/pull/44\nNow I really miss something...\nLooks like I run sassc version 0.4.2\n    ./bin/sassc --version\n    sassc 0.4.2\n    ./bin/sassc --help\n    Usage: sassc [options] SCSS_FILE [OUT_CSS_FILE]\n    Options:\n      --version             show program's version number and exit\n      -h, --help            show this help message and exit\n      -s STYLE, --output-style=STYLE\n                        Coding style of the compiled result.  Choose one of\n                        compact, expanded, compressed, or nested. [default:\n                        nested]\n       -m, -g, --sourcemap   Emit source map.  Requires the second argument (output\n                        css filename).\n       -I DIR, --include-path=DIR\n                        Path to find \"@import\"ed (S)CSS source files.  Can be\n                        multiply used.\n       -i DIR, --image-path=DIR\n                        Path to find images. [default: ./]\n       -w, --watch           Watch file for changes.  Requires the second argument\n                        (output css filename).\nObviously if i give something from stdin or if I use --stdin arg, it fails. Why do ./bin/sassc doesn't give the same options as I can see there ?  https://github.com/sass/sassc/blob/master/sassc.c \nThanks in advance\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/55#issuecomment-59368407\n. I'd consider this for a future release. Would definitely break existing integrations, but we'd happily take this patch.\n. Yeah, this is definitely in the plans. We mostly use Bourbon and our own extensions ourselves, but a little bit of effort and we can get native function hooks in place.\n. @llinder WHOA! JAVA BINDINGS! Share them!\n\nEventually, we'll normalize our versions with the primary sass project, but for early development, we're just sticking with 1.0 as long as its usable. \n. Yeah, there is versioning. We're moving major version numbers quickly by release until we catch up to Ruby Sass, and at that point we'll go with a more standard versioning scheme.\n. I'm not 100% sure this is something that should be in libsass. Seems more like SassC or a wrapper's job. We try and keep as much OS-specific stuff out of libsass as we can.\n. Yeah, this is something that the host wrapper should deal with. We want to work with environments without environment variables. Many host applications would certainly not want their embedded library referencing env variables with it being aware of it.\n. libsass is loosely modeled on libraries like libxml, which (afaik) don't use environment variables to change their behaviour. This is a very, very, very easy feature to add to sassc which would be the appropriate place to handle interactions with the operating system.\nWhat adaptor are you using?\n. I just verified that this is no longer the case.\n. Hey thanks for this @Nabellaleen, but can you please add a test case in SassC's \"spec\" folder to demonstrate the issue. Just needs an input.scss and an expected_output.css file in a folder named after the issue. Hard to know exactly what the issue was without that. \nJust reference the other pull request the way you've done here.\nIf the test suite passes, then we're good... as long as @akhleung is cool with the code (looks great to me).\n. I think the evaluator stuff just got added in!\nOn Sunday, June 9, 2013, Nabellaleen wrote:\n\nOk, I'll add the test to sassc on monday ;)\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/pull/111#issuecomment-19162755\n.\n. WHA-BAM!\n. Yeah, this still looks like it's an issue. Let's try and get this in for 3.0.\n. I'm delaying this till 3.1. It's pretty annoying but not totally breaking CSS.\n. I'm delaying this till 3.1. It's pretty annoying but not totally breaking CSS.\n. We're happily waiting for a patch from anyone.\n\nWhen we looked at the Sourcemaps code used in Sass, we realized just how\ndamn obtuse and obscure it is. The main Sass project got it integrated\nbecause Google wrote the source code and gave it to the Sass project.\nWe a lot of high priority features that we need to fix in libsass and that\nis where the core project is focusing our time. Implementing a non-standard\nChrome feature that is complex to actually implement is not really the\nhighest priority, even though I do know that its a nice feature.\nWe'd love to have support, but the tradeoff isn't worth it at the moment.\nOn Sat, Sep 14, 2013 at 8:36 AM, Bryan Levay notifications@github.comwrote:\n\nAny motion on this front?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/122#issuecomment-24449267\n.\n. It's OT, but I moved all failing libsass tests into TODO.... This means\ntravis will start passing, but PLEASE if you fix an issue, please run the\ntodo tests and move fixed issues into the main tests!\n\nOn Wed, Dec 18, 2013 at 11:30 AM, Filipe Araujo notifications@github.comwrote:\n\nawesome, great work\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/122#issuecomment-30872538\n.\n. Closed by @svnieuw! This has been merged into master!\n\nSupport has also been included in SassC.\n. @svnieuw Make sure to grab your bounty!\n. Feel free to open a new issue for that. Will probably require a bounty to get done.\n. I'd love to get these on the Sass website! Let me open a ticket over there.\n. Thanks philip for making these test cases! Suuuuuper helpful to get this\nthing more polished!\nOn Sun, Jul 7, 2013 at 10:53 PM, Philip Hofstetter <notifications@github.com\n\nwrote:\nI can confirm that current HEAD fixes this.\nThanks for the pointer to the tests. There currently seem to be quite a\nfew failures. Is that an issue with my local config, with the tests or with\nthe library? Anyways - as I'm finding more issues, I'll be making test\ncases now. Thanks.\n(as for the avatar: That's Frog from Chrono Trigger)\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/131#issuecomment-20586802\n.\n. Ah, we should put this into a test case in the sassc test cases.\n. C is fun!\n\nOn Sun, Jul 14, 2013 at 5:05 AM, Jeroen Houben notifications@github.comwrote:\n\nsame here:\ngyp info spawn args [ 'BUILDTYPE=Release', '-C', 'build' ]\n  CXX(target) Release/obj.target/binding/binding.o\n  CXX(target) Release/obj.target/binding/sass_context_wrapper.o\nIn file included from ../sass_context_wrapper.cpp:1:\nIn file included from ../sass_context_wrapper.h:1:\nIn file included from ../libsass/sass_interface.h:3:\n../libsass/sass.h:88:3: error: unknown type name 'size_t'\n  size_t              length;\n  ^\n../libsass/sass.h:117:37: error: unknown type name 'size_t'\nunion Sass_Value make_sass_list    (size_t len, enum Sass_Separator sep);\n^\n?\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/135#issuecomment-20935427\n.\n. Here is a new spec test for this issue...\n\nhttps://github.com/hcatlin/sass-spec/commit/b26f84ed9703913e0c068f1640bef6af83ed2706\n. This has been fixed with the closure of sass/libsass#146\n. Totally valid. master at libsass just finished a major reworking, so this\nkind of thing isn't surprising. Can you describe a simple failing test case?\nOn Saturday, July 27, 2013, Peter Kieltyka wrote:\n\n@QuLogic https://github.com/QuLogic yea, you're right, the libsass\nversion (906a9a1https://github.com/hcatlin/libsass/commit/906a9a139a89f1a26ecd)\nlinked to sassc works, but, thats from June 8th, which doesn't include\nsupport for placeholders which is something I need for my project. The team\nhas already been using many sass placeholders in the source with ruby sass.\nIt looks like the include path seems to be working properly with that\nversion of libsass too. But in any case, the current head of libsass still\nhas both of those issues. (As well when used with node-sass). Perhaps some\ninterface changed in libsass, and node-sass and sassc need updating, I am\nnot sure the source of the issue, but I just wanted to let you guys know.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/139#issuecomment-21667715\n.\n. Wow, sounds ambitious! Lots of companies are having similar issues and\nactually, that's one of the main use-cases we want for libsass. Big teams\nwith huge projects!\n\nOn Wed, Aug 7, 2013 at 11:27 PM, Luke Bastendorff\nnotifications@github.comwrote:\n\nOf course, there was a flaw with my testing.\nI only tested with true and false but the library I am trying to get\nworking was using variables of numbers.\nI'll do much more testing of these changes when the library fully compiles\nso maybe I was a bit hasty in posting these \"solutions\". I think I should\ncome back with a pull request for these fixes and the next ones that are\nalready in the works after more testing.\nI'm looking to get sencha ext 4.2 compiling you see.\nI know it has a compass dependency but I'm hopeing to wean it off any\ncompass mixins that use ruby script.\nThe goal is to integrate this with a java application at work but as a\nspin off I thought I might push a project that allows the sencha build\ntools to use libsass (these are also written in java).\nFor the extension to sencha's build tool to work I would need to get it\ncompiling the ext scss files unpatched otherwise users of ext who wanted to\nuse my drop in extension would need to patch their ext source before trying\nto compile.\nHowever for making the java app at work compatible I'm not worried about\nchanging ext we already have a patches folder with many custom changes in\nit.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/142#issuecomment-22305152\n.\n. Hrrrm.... I'm struggling with this one. I'm feeling like I'm missing the party.\n\nFile-join is not a function... in Sass, Compass, or CSS... as far as I can find. I might be missing something obvious here.\nWhen I write up an executable version of this example, it looks like this.\n$path: \"images\";\n        $file: \"kittens.jpg\";\n        $image: \"\";\n        $other: file_join(\"images\", \"kittens.jpg\");\n@if $image != none {\n        $image: url(file_join($path, $file));\n    }\n    body {\n        background: $image;\n        color: $other;\n    }\nAnd when I run sass, I get...\nbody {\n  background: url(file_join(\"images\", \"kittens.jpg\"));\n  color: file_join(\"images\", \"kittens.jpg\"); }\nSo, is this just the parser issue that it won't output the invalid CSS? I mean, if so, then that's probably fair enough. Just want to make sure we are solving the right issue.\n. It doesn't seem like the above sample fails due to URL parsing... right?\nIf the custom-function doesn't exist, then it should just print out the CSS as it does with regular Sass. @akhleung, does the sample above properly solve that?\nI'm going to add this as a test in the spec. The break is legit, and even if we don't have the custom function, we should act the way Sass does. Test coming.\n. Just added a spec test for this example... \nhttps://github.com/hcatlin/sass-spec/commit/8a6a1c32164bbe3c69a0a87ab71bc34557d6c4e0\n. Unfortunately, it's libsass doing that... ;/\nOn Wednesday, May 21, 2014, Aleksey notifications@github.com wrote:\n\nHi! I am experiencing an @extend https://github.com/extend error using\ngrunt-sass. The SCSS:\n.module {\n  padding: 10px;\n  h3 {\n    color: red;\n  }\n}\n.news {\n  @extend .module;\n}\nshould produce the CSS\n.module, .news {\n  padding: 10px;\n}\n.module h3, .news h3 {\n  color: red;\n}\nbut instead, it gives:\n.module, .news {\n    padding: 10px;\n}\n.module h3, .module .news {\n    color: #FF0000;\n}\nDo I get this wrong, or is the culprit really the libsass in grunt-sass\n?\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/146#issuecomment-43721035\n.\n. Actually, Ruby Sass can take up to 2 hours to compile on very, very complex\nprojects, but several minutes on regular large projects. Libsass is a new\nproject to try and speed up Sass compilation, and ease both integration and\nmemory usage.\n\nFeel free to use the main Ruby-based project if it better fits your needs.\nOn Wednesday, May 28, 2014, Lu Nelson notifications@github.com wrote:\n\n@Ilyes512 https://github.com/Ilyes512 ruby sass gets much slower than\nthat on big projects. I've seen cases with over 5 seconds compile time.\nWhich is just not workable, in this era where we're told we should 'design\nin the browser'. Speed is the basic reason for libsass. See @benfrainhttps://github.com/benfrain's\narticle for reference\nhttp://benfrain.com/libsass-lightning-fast-sass-compiler-ready-prime-time/;\nand yes as @KayLeung https://github.com/KayLeung said you can just\nsimplify your use-cases for @extend. Basic non-nested usage and\nplaceholder classes are already working.\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/146#issuecomment-44396470\n.\n. Yeah, wowza! I saw that happen and nearly dropped my coffee. That's really,\nextremely generous of you.\n\nThe complicated part is that the projects are partially sponsored by\ncompanies. Aaron is paid as part of his\njob (sometimes) to work on libsass. However, since weekend time isn't\nreally sponsored and I don't think\nAaron has enough time during the workweek to get such a large feature\nfinished, this seems like great incentive. ;)\nOR, anyone else out there who wants a little extra money can take a stab at\ntackling this!\nOn Fri, Jun 6, 2014 at 3:47 PM, Westbrook notifications@github.com wrote:\n\n@hcatlin https://github.com/hcatlin, @akhleung\nhttps://github.com/akhleung, really interested in getting this worked\nout, so I just bumped up the bounty. If either of you know more about the\ntime to complete, would be willing to discuss what you think might be a\nmore appropriate number.\n\nReply to this email directly or view it on GitHub\nhttps://github.com/hcatlin/libsass/issues/146#issuecomment-45344780.\n. @Westbrook email me at hcatlin@gmail.com\n\nOn Sat, Jun 7, 2014 at 5:02 PM, Westbrook notifications@github.com wrote:\n\nIt all stems from the great work yall are doing. LibSass makes a huge\ndifference to our stack and the features we want to deliver on it, so\nwe're\nreally looking forward to having it in a place where we can deploy it to\nproduction. Thanks again!\nOn Sat, Jun 7, 2014 at 11:30 AM, Aaron Leung notifications@github.com\nwrote:\n\n+1 to what Hampton said, and I'll add that because my employer pays me\nto\nwork on LibSass (sometimes), what really means a lot to us here isn't\nthe\nmoney itself, but rather the show of serious support. This sends a very\nclear signal that people are taking the project seriously, and for that\nyou\nhave my sincerest thanks.\n\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/146#issuecomment-45412951.\n\n\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/146#issuecomment-45413773.\n. A year after its opening... I'm ridiculously, incredibly excited to click the close button on this issue. Thanks to @uberska @jaddessi and @michaek this mega-extends-issue can now be closed. The original test case now passes, as do many, many, many, many other new ones written by the team at @dealerdotcom. Also, super thanks to @paulirish for funding the bounty on this and never letting us forget that this was pending. So, @uberska what are you going to do with the bounty? ;)\n. Oh wow, sweet win!\n\nThanks Elliot!\nOn Sat, Aug 10, 2013 at 8:23 PM, Aaron Leung notifications@github.comwrote:\n\nWow, thanks for running these checks! After glancing at op_strings, the\nproblem seems to be that I accidentally used the default operator newinstead of my overloaded version that take a\nContext object (which tracks allocations and deletes them when the\nprogram finishes). In fact, any occurence of new that isn't of the form new\n(ctx.mem) ... is probably an error!\nNot sure what's wrong with op_numbers, but I'll keep looking. Thanks\nagain!\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/148#issuecomment-22451739\n.\n. Sounds like Aaron fixed the main issue. I'm going to close this.\n. Alright, let me see if we can get this in 3.0.\n. What do I actually have to do to get this going. I clicked add on coveralls... not sure what else is required.\n. Hey, always up for a patch! ;) +1\n\nThough, might have to be in the driver due to OS differences, etc.\nOn Monday, September 2, 2013, welch wrote:\n\n+1\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/156#issuecomment-23687563\n.\n. We've made a promise not to implement things that aren't in the standard\nSass project, so unfortuntaley, you must first convince Chris Eppstein and\n@next3 about this before we can implement it.\n\nOn Tue, Oct 8, 2013 at 3:24 AM, Norris notifications@github.com wrote:\n\nYeah, I misunderstood at the beginning the \"always up for a patch\". Still\nit would be nice to see this implemented.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/156#issuecomment-25878951\n.\n. This project is a sub-project to the main Sass project. The discussion on that list is the main one. I'm going to close this unless there is a change of status at the other project. \n. This was a known node issue that I've seen in a couple bug reports. It's now been fixed and we have also done more to improve error handling.\n. My misunderstanding! I saw a talk by a lawyer at some point that basically\nsaid that if you don't say something like this, then any later action might\nrequire permission of all contributors.\n\nAnd, as several companies are paying for people to contribute, I didn't\nwant to have to work with their legal directly if any issues did come up.\nDo you have some better language you might suggest? Or are you indicating\nthat the lawyer was mistaken and that no such issues can arise?\nOn Sunday, September 1, 2013, Vincent Bernat wrote:\n\nHi!\nI am sorry to bring this non-technical issue but I find the copyright\nassignment paragraph in README.md quite misleading:\nAny contribution to the project are seen as copyright assigned to Hampton\nCatlin. Your contribution warrants that you have the right to assign\ncopyright on your work. This is to ensure that the project remains free and\nopen -- similar to the Apache Foundation.\nFirst, the Apache Foundation CLA is not about copyright assignment. This\nis a copyright and patent license. You keep your copyright and grant the\nApache Foundation a perpetual and transferable license with similar terms\nas a BSD or MIT license. A copyright assignment is quite different because\nyou could become the exclusive owner of the copyright.\nSecond, copyright assignment has little to do with keeping a project free\nand open. Usually, this is either done to be able to publish a commercial\nversion with a different license (not applicable here since the original\nlicense is quite liberal) or to get some legal protection.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/158\n.\n. Well, sounds like leaving it isn't harmful\u2013 so I'm going to leave it in place. Maybe it means nothing, but I want to be aggressive about how liberal this license must remain. And, I'm the only one I trust to protect it. ;) The intention is to just be 10000% sure that the project never gets bound up in any disagreements, and remains as free as possible. I have removed the language about the Apache Foundation, as I was misinformed (or just misunderstood), and so hopefully this resolves your issue.\n. Hrrrm... when I run this with Sass 3.2, it returns \n\n.test {\n  background-color: null;\n  color: blue; }\nWhat version are you using to get that output?\n. Can you write this test into the spec repo before we merge them both in?\nOn Tue, Sep 17, 2013 at 8:55 AM, Nabellaleen notifications@github.comwrote:\n\nProblem was fixed in the above pull request. But it's a quick fix, so it\nstill remain a difference with ruby sass.\n$nonEmptyVar: red;$emptyVar: null;\n.test {\n  background-color: #{$nonEmptyVar};\n  font-family: #{$emptyVar};\n  color: $emptyVar;\n  font-size: null;}\nShould output\n.test {\n  background-color: red;\n  font-size: null; }\nand input in my fix\n.test {\n  background-color: red; }\nBut \"null\" means nothing in css, so I think this is a sass bug and so, I\nprefer this fix instead of the current version, printing a lot of empty\ndeclarations ;)\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/166#issuecomment-24599652\n.\n. Oh, fucking NICE!\n\nOn Tuesday, September 17, 2013, Nabellaleen wrote:\n\nDeclarations with value being a variable with an empty string or null was\nprinted in output. Now, this is fixed in nested & compressed modes.\nTODO: print declarations when the value is not a variable and directly a\nnull value (sass official behaviour)\nLinked to hcatlin/libsass#166https://github.com/hcatlin/libsass/issues/166\nYou can merge this Pull Request by running\ngit pull https://github.com/Nabellaleen/libsass NullValuesFix\nOr view, comment on, or merge it at:\nhttps://github.com/hcatlin/libsass/pull/168\nCommit Summary\n- This function was defined in the Header file, but\n- Using consistent spacing to the rest of the file for a single-line\n  function.\n- Merge remote-tracking branch 'upstream/master'\n- Merge remote-tracking branch 'upstream/master'\n- Add SVN and visual studio project files to gitignore\n- Merge https://github.com/hcatlin/libsass\n- Merge https://github.com/hcatlin/libsass\n- Merge https://github.com/hcatlin/libsass\n- Merge remote-tracking branch 'upstream/master'\n- Fix null & empty values printed in output\nFile Changes\n- M .gitignorehttps://github.com/hcatlin/libsass/pull/168/files#diff-0(9)\n- M output_compressed.cpphttps://github.com/hcatlin/libsass/pull/168/files#diff-1(25)\n- M output_nested.cpphttps://github.com/hcatlin/libsass/pull/168/files#diff-2(18)\nPatch Links:\n- https://github.com/hcatlin/libsass/pull/168.patch\n- https://github.com/hcatlin/libsass/pull/168.diff\n. Oh, wow. Heck yes! Will review and merge ASAP.\n\nOn Saturday, October 12, 2013, Rowan Beentje wrote:\n\nAddress a few failing tests by tackling three separate issues; firstly,\nevaluation of divisions within parentheses (see rowanbeentje@1818116https://github.com/rowanbeentje/libsass/commit/18181169745cebaeb1caa964a3ce6292e9d35010);\nsecondly, formatting of unmodified colors (see rowanbeentje@c6e4b86https://github.com/rowanbeentje/libsass/commit/c6e4b86094c12ad54b2b96367bc5f23bafa6d94b);\nand finally a number of improvements to Null handling, including list\noutput tweaks (see rowanbeentje@030d078https://github.com/rowanbeentje/libsass/commit/030d0784d93de70ce97d3aaf261f0bd95b1924ed)\n- I think this builds on the work done by @Nabellaleenhttps://github.com/Nabellaleenin\n  #168 https://github.com/hcatlin/libsass/pull/168.\nNote that the color handling code takes an approach of favouring the\noriginally entered values, overriding this in a few places - this is so\nthat when nex3/sass#363 https://github.com/nex3/sass/issues/363 is\nactioned, the overrides can be easily removed.\nYou can merge this Pull Request by running\ngit pull https://github.com/rowanbeentje/libsass master\nOr view, comment on, or merge it at:\nhttps://github.com/hcatlin/libsass/pull/172\nCommit Summary\n- Fix evaluation of divisions within parentheses\n- Fix formatting of unmodified colors\n- Improve Null handling to match tests and compass\nFile Changes\n- M ast.hpphttps://github.com/hcatlin/libsass/pull/172/files#diff-0(5)\n- M ast_factory.hpphttps://github.com/hcatlin/libsass/pull/172/files#diff-1(2)\n- M eval.cpphttps://github.com/hcatlin/libsass/pull/172/files#diff-2(24)\n- M functions.cpphttps://github.com/hcatlin/libsass/pull/172/files#diff-3(1)\n- M inspect.cpphttps://github.com/hcatlin/libsass/pull/172/files#diff-4(37)\n- M inspect.hpphttps://github.com/hcatlin/libsass/pull/172/files#diff-5(2)\n- M output_nested.cpphttps://github.com/hcatlin/libsass/pull/172/files#diff-6(12)\n- M parser.cpphttps://github.com/hcatlin/libsass/pull/172/files#diff-7(5)\n- M to_string.cpphttps://github.com/hcatlin/libsass/pull/172/files#diff-8(2)\n- M to_string.hpphttps://github.com/hcatlin/libsass/pull/172/files#diff-9(3)\nPatch Links:\n- https://github.com/hcatlin/libsass/pull/172.patch\n- https://github.com/hcatlin/libsass/pull/172.diff\n. Travis definitely shows an extra test is passed.\n. Probably. You should see Aaron's desk and you'd understand.\n\nOn Sunday, October 13, 2013, Rowan Beentje wrote:\n\nI got a little confused by this as well - thanks @hcatlinhttps://github.com/hcatlin:) Am I right in thinking everything in old/ could also be deleted?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/173#issuecomment-26226478\n.\n. Easy merge.\n. Maybe its natural or maybe its naballaleen.\n. We have to be like Ruby Sass... though, I wish @chriseppstein and @nex3 would consider this change...\n. I'm going to open a new issue on this, since the second one seems like a different issue.\n. Oh shit, totally misread this. Sorry, I thought that was a merge against the original issue above. Sorry, missed that it's never been addressed at all.\n. Hmmm.... this is a complicated one. You should definitely not be checking in your CSS output from Sass. Seriously. It will break all sorts of things and make a merge hell no matter what.\n\nAnd, clearly, this would be one of the worst things to merge. Buuuut, the problem is that file handling is really complicated and differs on every operating system. Since Ruby Sass has the Ruby runtime, it makes it very easy for that project to show relative paths. For us, this is much, much harder.\nThis is a difference between libsass and ruby sass, but I'm not sure we should fix it as the complexity and code required is very heavy... and also, again, you should definitely not be versioning the output from Sass! It's one of the pre-processor golden rules.\n/hugs.\n. I'm like 1000% sure we've fixed this since then. It's been a lonnng time and we have lots of mixins now. ;)\n. I'm thinking that the pending refactor will fix the second issue. And I added a note with the first issue. ;)\n. If you call sass_make_number, then you should have to free it yourself with free_sass_number. Or... do we not have that? /me should go read.\n. @QuLogic I added a test_build to the main Makefile that was not working with autoconf based systems. So, @jbussdieker was just helping me with Autoconf. ;)\n. I agree. Option. Though, I could be swayed that it should be the default in\nsassc... since its easier to startup.\nOn Thu, Dec 19, 2013 at 12:31 PM, Bryan Jones notifications@github.comwrote:\n\n@Etienne is right: it should be an option, just as it is for Less.\nI think the vast majority of folks would rather edit stylesheets in a real\neditor than work in Chrome's Dev tools. For these people, having the\noriginal sass sources right in the map file seriously reduces headaches.\nA good example is Wordpress: it can be incredibly tricky to get source map\nurls to resolve to the correct path when you have Wordpress running with\nsub-sites. Another example is a sass file that is not part of a website's\nproject folder. I might keep a sass file defining some basic styles on my\ndisk and use it from a shared location across many web projects, without\never copying it into my website folder. In this case, source mapping urls\nwill always fail. The only way to make that work is to embed the source in\nthe map file.\nSent from my iPhone\n\nOn Dec 19, 2013, at 10:50 AM, Etienne notifications@github.com wrote:\nMaybe this could be an option (as indicated in the spec).\nSo we could have the choice to use it or not.\n\u2014\nReply to this email directly or view it on GitHub.\n\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/212#issuecomment-30963697\n.\n. Oh yeah! I love this kind of stuff. Bad indentation is a bug!\n. I merged this into the extend branch.\n. Looks great, thanks Nick! \n. Is this still an issue?\n. This has been completed by @xzyfer!\n\nThe entire initial specification for maps has been implemented. What isn't currently there is the each iterator, but that was added as a separate feature to Sass and will be treated the same here.\n. Yup, I believe so.\n. I just want to pitch in here and say that libsass does not support 3.3\nfeatures. We are focusing on getting 3.2 compatibility. If Bourbon has\nchosen to use a feature that is not supported in most Sass installs (people\ndon't upgrade immediately), then that's their prerogative.\nWe can't jump ahead and implement things before the mainline Sass is\nreleased because a library is using it immediateyl, when we have a huge\nbacklog of 3.2 features that are critical.\nOur roadmap for Aaron's work focuses on gaining 100% 3.2 support.\nHowever, to be clear, we will happily accept patches from users that\nimplement features that are ahead of our development roadmap. So, feel free\nto roll up your sleeves and help us get this done!\nOn Tue, Mar 11, 2014 at 1:19 PM, jetlej notifications@github.com wrote:\n\nAlso seeing this issue with CodeKit and Foundation out of the box\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/278#issuecomment-37344645\n.\n. That's an option. But, so far we've had minimal issues with compatibility\nbetween versions.\n\nI was just responding to the tone of this thread of \"WHY IS IT NOT\nFIXED?!?!?!\" and pointing\nout that the priority is to get feature parity with 3.2 first, before\nthere is concerted effort to\nmatch all 3.3 features.\nWe'll fix these as they come up, but we can't consider new features to\nSass the ultimate priority\nuntil we've fully caught up.\nThat being said, its my recommendation that tests for libsass are run\nagainst whatever the newest\nbuild is. If we are going to add a feature that was added in 3.2, I'm fine\ndoing it in a 3.3-compliant way.\nAka, imagine some spacing broke. I'd prefer to match 3.3's spacing, then\n3.2's, since we want to\ncatchup and there is no reason to re-implement.\nBut, if a feature or syntax is totally absent from 3.2 and was recently\nadded, then that is a secondary\npriority in the tickets and roadmap, generally.\n-hampton.\nOn Tue, Mar 11, 2014 at 2:38 PM, Chris Eppstein notifications@github.comwrote:\n\nDoes it make sense to have a 3.2 branch and a 3.3 branch and separate\nreleases for each? Then patches that land on 3.2 could get rolled into 3.3\nbut not the other way around.\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/278#issuecomment-37352612\n.\n. Looks like this was fixed. We need real scoping support soon though.\n. Works perfect in my tests. Must have been fixed with another issue.\n. My goal (soon) is to make sass-spec spit out feature compliance reports,\netc. Like, something you could put on a website.\n\nHalf the sass-spec code was written by a junior ruby developer. I've moved\na lot of that code into better classes, but as far as I am concerned, ALL\nof it could be rewritten. I'm happy to have help building a bad ass test\nsuite.\n- clean output\n- easy reports\n- paralellized\n- easy integration with any new implementations\n- simple code\nI'm arranging my life to be able to concentrate on this more over the year.\nOn Friday, February 7, 2014, Chris Eppstein notifications@github.com\nwrote:\n\n@ericam https://github.com/ericam @Snugug https://github.com/Snugug I\nthink you can both help a lot with testing and sass-spec tools. No ruby or\nC/C++ knowledge should be needed for that once we have the infrastructure\nin place.\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/282#issuecomment-34482555\n.\n. @Jakobud that's a complicated question. We have most of the features with our 3.0 release that is pending. But, we do not have variable scoping yet or looping over maps.\n\nI'm going to close this issue. It's a great discussion and one that will always be continuing. I know that Chris and Natalie and myself have been discussing this at length now. No firm decisions are made, but we are building sass-spec to be an official representation about what Sass should do.\n. Unfortunately, my hands are tied on this at the moment. Until Sass officially implements it, we can't implement it here. If you want that feature in libsass, then it needs to be in Sass first, so feel free to encourage support of the above referenced feature request issue on the main Sass project.\n. This seems to be fixed over at #242\n. We love your participation anyway!\nOn Friday, February 28, 2014, Bryan Jones notifications@github.com wrote:\n\nClosed #303 https://github.com/hcatlin/libsass/issues/303.\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/303\n.\n. Yup. Gives the error:\n\nsource string:2: error: invalid selector after\n. I ran this test, and it seems to pass now in 3.0rc3!\n. Sass 3.4 does the same behaviour.\nhttp://sassmeister.com/gist/d562317a35afb2af9462\n. Verified that this is fixed in master.\n. Definitely still an error.\n. Yeah, this is a bad place to put a bounty. Would be better on something\nlike Maps.\nOn Thursday, May 1, 2014, Aaron Leung notifications@github.com wrote:\n\nThis issue is a pretty big bucket, but we do plan to add 3.3 support!\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/319#issuecomment-41949408\n.\n. So, there is no such thing as \"3.3 syntax support\", exactly. It's a whole\nset of features and changes. Maps (not source maps) are a major syntax\nchange in 3.3.\n\nFrom the example above, it seems that you are referring to using the parent\nselector to implement BEM-style approaches?\nAka, what is described here:\nhttp://www.alwaystwisted.com/post.php?s=2014-02-27-even-easier-bem-ing-with-sass-33\nIs that what this ticket is in reference to? If so, it looks pretty simple\nto implement @akhleung.\nOn Sat, May 3, 2014 at 9:08 AM, Dominic notifications@github.com wrote:\n\nI added bounty here because 3.3 syntax support (for the BEM approach,\nspecifically) is important to me and something I'd like to see in libsass\nbefore Maps (source maps I'm guessing? I don't use them and possibly never\nwill) or anything other feature. This feature would make my life a heap\neasier and I'd like to support (albeit in a small way via adding to the\nbounty) if I can.\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/319#issuecomment-42104639\n.\n. I'm closing due to non-response. Assuming that in the past 6 months and 2 versions, this got fixed.\n. Neither @akhleung nor myself are familiar with or use sourcemaps ourselves. @svnieuw would you mind helping out again? We have a lot of open sourcemap issues and I'm feeling kind of helpless on them!\n. Extend has been broken. We are closing duplicates. It is fixed right now in master and the 3.0RC1. It should be working its way to node-sass or whatever project you are using soon.\n. 3.0rc1 is tagged!\n. Make sure to upgrade node-sass. They recently fixed a lot of hard crashing bugs!\n. Sorry, this is not implemented in Ruby Sass, so we can't implement it here. This can be achieved with some handwritten functions though (though they aren't as robust as what compass has). Feel free to go request it in the main sass repo.\n. Extends is currently implemented incorrectly. There is a $1.2k bounty on issue #146 which covers this broken test case (and many others). I'm closing this to focus on the other issue. If you'd like to submit your code to the sass-spec repo, it could be very useful to help know we've nailed the new implementation.\n. I believe this is a duplicate of #185 \n. This is fixed with the latest release.\n. Asshole ticket cleanup answer: So, this isn't really something that is in scope for our work on this for a while. This would most likely complicate the codebase and we currently aren't yet at parity with Ruby Sass yet. I'm going to close this for now. We might consider a patch in the future, or a more specific design plan. But, as it stands, this is one of those big-rewrite-feature-requests-issues that will stay in the repo for years, rotting away. \n\nToday, this isn't in the roadmap and probably won't be for a long time. Sorry for the dissapointing, assholish, answer. We're having to work hard and focus our energy on the biggest, baddest things stopping people from using the project.\n/hugs.\n. Node-sass had a known crashing bug that has since been fixed. Please updated node-sass and you should be good to go!\n. That's really weird. SassC crashes after outputting the right answer?\n. Extends is currently implemented incorrectly. There is a $1.2k bounty on issue #146 which covers this broken test case. I'm closing this to focus on the other issue. If you'd like to submit your bug to the sass-spec repo, it could be very useful to help know we've nailed the new implementation.\n. This is definitely an error I've seen and we need to fix it. This is a very clean test case!\n. Sourcemaps really need more help. :/\nAnd, testing them is difficult\n. @sergiomcalzada It's definitely not the issue you think it is. If you look at the error message you posted, it says:\n<full_path>\\Web\\Content\\scss\\/tool-comp/_variables.scss:103: error: invalid top-level expression\nIt's saying there is an error on line 103 of your _variables.scss file. On line 103, there is the following code.\n$baseheadingfontweight : normal;;\nThe issue is the \";;\" is causing us to break. I'm going to open another issue with that as a bug report. But, for the meantime just remove the second semi-colon and this should work.\n/cc madskristensen/WebEssentials2013#1057\n. What's the status here...? I'm confused.\n. Remember though, we are targeting 3.4 which I believe doesn't actually allow this. :/\nOn Mon, Oct 27, 2014 at 5:17 PM, Marcel Greter notifications@github.com\nwrote:\n\nReversed the logic @akhleung proposed and simply added a status bool to context, to flag this situation. Feels hackish, but IMO still better than breaking custom precision. Hope it works as intended.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/364#issuecomment-60670988\n. I swear I was reading a thread on sass that discussed that... let me look around. Ignore me until I find it as, it could have been a threaded fever dream.\n\nOn Mon, Oct 27, 2014 at 7:48 PM, Michael Mifsud notifications@github.com\nwrote:\n\nAccording to the changelog the --precision flag was introduces in 3.1.8 and defaulted to 3. In 3.2.0 it was defaulted to 5. Custom precisions via the --precision flag is still in a thing in ruby sass master.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/364#issuecomment-60689463\n. Bourbon 4.0 requires Sass Maps to function correctly. This feature is not\nin the 2.0 release.\n\nOn Sun, Jun 8, 2014 at 6:26 PM, Scotty Vernon notifications@github.com\nwrote:\n\nSorry to repeat the question, but will libsass 2 support Bourbon 4.x? Or\nis it still only Bourbon 3.x?\n\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/365#issuecomment-45442733.\n. We have included maps, but have not tested this functionality. Our goal is to add the features to match Sass' behaviours, not to support a particular platform or framework. It's worth a try now!\n. I'm going to close this, but note that 3.0 actually requires GCC 4.7+ due to the use of shared_ptr.\n. We're hoping to get Bourbon compat back in the next release. We know that\nwe don't support maps yet.\n\nOn Thu, Jun 5, 2014 at 8:31 PM, Aaron Leung notifications@github.com\nwrote:\n\nHmm, it looks like you're returning a map? Maps aren't implemented in\nLibSass yet.\n\nReply to this email directly or view it on GitHub\nhttps://github.com/hcatlin/libsass/issues/380#issuecomment-45263547.\n. We're hoping to get Bourbon compat back in the next release. We know that\nwe don't support maps yet.\n\nOn Thu, Jun 5, 2014 at 8:31 PM, Aaron Leung notifications@github.com\nwrote:\n\nHmm, it looks like you're returning a map? Maps aren't implemented in\nLibSass yet.\n\nReply to this email directly or view it on GitHub\nhttps://github.com/hcatlin/libsass/issues/380#issuecomment-45263547.\n. Yeah, iconv is a BEAST. I've spent many years wrangling with it... and never come out unscarred. \n. It's a great honor to do this... transfer complete.\n. There has been discussion before of only using Automake and removing the Makefile entirely. I'm not sure why it's still there, actually. @akhleung was a dreaming or was that a thing?\n. Oh, I'm down with that. It is weird to have two systems... plus, I've\nalways liked Make.... for some reason.\n\nOn Fri, Jun 6, 2014 at 3:39 PM, Aaron Leung notifications@github.com\nwrote:\n\nI actually wanted the opposite -- keep the hand-written makefile which is\nfast and clean, and get rid of the automake stuff which seems like overkill\nfor LibSass (and takes like 10x longer to build).\n\nReply to this email directly or view it on GitHub\nhttps://github.com/hcatlin/libsass/pull/386#issuecomment-45343808.\n. It fails because we haven't passed sass/sass-spec yet. Damnit.\n\nOn Fri, Jun 6, 2014 at 4:06 PM, Laurent Goderre notifications@github.com\nwrote:\n\nHmmm, I was wondering why the CI build failed but then again all of the\nprevious build failed as well. Not very helpfull\n\nReply to this email directly or view it on GitHub\nhttps://github.com/hcatlin/libsass/pull/388#issuecomment-45347015.\n. I have just done a pre-release of 2.1-beta (why not go larger with\nversions) as I don't want to pick through\nwhat were critical vs non-critical changes to master.\n\nI have also created a branch called stable_2_1 (to mimic somewhat the sass\nrelease process) for any\nchanges needed before we let 2.1 out.\nOn Sun, Jun 8, 2014 at 6:41 PM, Parris Khachi notifications@github.com\nwrote:\n\nHello!\nCan we get a patch version tagged so that down stream can have a stable\n2.0.x release? The compilation via gcc seems to be broken in 2.0.0.\nAlso, would it make sense to formalize the release process a bit more?\nThat is can we have a branch for each major and minor version. That way we\ncan just check in critical patches for those branches and carry on with the\nnext version in master.\nThanks,\nParris\n\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/393.\n. sass2scss is no longer a submodule. So, this is now solved.\n. I just merged this with master and ran the specs locally, and I get a TON of errors when running them.\n. Seems like it's fixed.\n. I believe you can write a Sass function for this... I mean, it's kind of hacky, but its totally doable. It's not something we can support directly though, since sass doesn't implement it.\n. We've already fixed it... time to upgrade node-sass! We can't control what version they choose to use. :P\n. I don't believe its implemented yet...\n. @rodneyrehm would there be anyway for us to put this in your project and not have to have it part of the main lightweight lib?\n. You can move it whenever, I'm just going to drop the files from this project. Trying to get 3.0 out the door and have no idea how your projects works. :P\n. BUT THANKS FOR DOING AN AWESOME PROJECT! (not trying to sound snippy)\n. More detail over at #489\n. We definitely need a simpler test case here...\n. Soooooooo, yeah, it now dawns on me what's going on here. This exact same sample causes the same error, because Sass interpolates inside of comments. The @each was a red-herring\n\n/* #{$header} */\nIf $header is defined, it works just fine. If it's not... it breaks. This is the intended Sass behaviour and I can't believe I didn't think of comment interpolation.\n. I think that might be nice, but we have to stick with Sass' choices right now. Maybe open an issue there, as I agree with you.\nOn Tue, Oct 7, 2014 at 1:11 PM, Adeel Mujahid notifications@github.com\nwrote:\n\n@malrase, thanks for looking into it. But wouldn't @akhleung's approach (above) makes sense? If it throws error in multi-line comments, wouldn't it be nice to raise a warning instead of syntax error. Something like:\nWarning: Unbound variable in multi-line comment at line X, column Y in <file>.scss. \n         Did you mean to use single-line comment?\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/424#issuecomment-58220869\n. https://github.com/benschwarz/homebrew-sassc\n\nAlready exists! Getting it in officially would require the brew team to include it.\n. Is this the project you are referring to?\nhttps://github.com/kjdev/apache-mod-sass\nIt looks like they are using a 4 month old version of libsass. :(\nOn Thu, Jul 10, 2014 at 12:14 PM, Egbert Verhage notifications@github.com\nwrote:\n\nI got a problem with running the apache2 module that uses libsass 2.0/\n2.1.0.\nCompileing works just fine, no errors / warnings.\nAnd this error I get if I run the server or I run configtest\n_ZN4Sass5UTF_832code_point_offset_to_byte_offsetERKSsm\nGreetz,\nEgbert\n\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/437.\n. I'm sorry @EggieCode, I have no idea about apache and that line doesn't make any sense to me. Please try to compile master, as we've done some UTF-8 improvements, it might be fixed. It seems like some kind of issue with apache though?\n. Yeah, seems like the issue is fixed via that test.\n. @michaek do you think this is covered by your placeholder fixes?\n. Yeah definitely looks like an issue with interpolation. \n. We, really really need a test here. I'd LOVE to merge this in, but I don't think I should till I can be sure it breaks less than the last version. I'm not really familiar with this code at all.\n. Hmmm... just noticed the Copyright notice and license on the Json files. I might contact the person whose email is indicated and ask if we can remove the notice, put it under our license (MIT), and give him credit in the Readme? \nI'm a little wacky about this kind of stuff, since we want to make sure that the code is solidly able to be owned by a Sass foundation in the future. We have a lot of businesses involved in the Sass community now, so I get a little paranoid on this kind of stuff. Like to keep it streamlined!\n. Oh, apparently he's on github! Hey @joeyadams, mind if we remove the copyright notice from the file and add a shout out to you in the Readme. This is an MIT-licensed project.\n. Alright, I'm going to email @joeyadams and hope that we can get this sorted out!\n. @joeyadams WOO! Thanks!\n@aexmachina Looks like this needs to be rebased now.\n. The slow moving on responding to this is that none of the libsass core team actually wrote any of the sourcemaps code and don't really know how it works. :/ We'd love to fix this shortcoming, and we know that our support is too minimal right now. Definitely something we need to learn about.\n. Hoping to get this sorted by 3.2\n. Hey Brad,\n\nSo first, thanks for making a strong test case. Normally, we put them in sass-spec. Extend is currently a very broken feature to the point that we  don't even include \"@extend support\" in a list of features at all. Plus, it gets top billing in release notes since it's something most people are looking for. The current half-functional extends is a quick implementation @akhleung did as a test.\nOther issues: #336 #340 #326 #145 \n. Actually, I'm going to close this, as #146 has a $1.2k Bounty on it right now and seems to be the lead issue. I'd highly suggest you merge this test into sass-spec so we can be sure we've nailed the extends feature when we roll it out.\n. It's in a pretty good state for most things, extends is a rare exception.\nThe original feature is deceptively complicated! there is a great writeup\nhere:\nhttp://anotheruiguy.roughdraft.io/8794442-where-extended-placeholder-selectors-go-wrong-in-libsass\nOn Mon, Jul 21, 2014 at 1:33 PM, Brad Robertson notifications@github.com\nwrote:\n\nSure, sorry for the duplicate issue log. I only just discovered libsass\nthis weekend so I wasn't really sure what state it was in\n\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/449#issuecomment-49595181.\n. Totally agree that this will be cool in the future, but until then.... sorry dude, can't keep the issue around for a future feature that we can't add here. ;P\n. Can you please give a test case or example of this code that you want to work, and how you'd expect it to behave?\n. Uhhh... this is obviously a complicated patch. This is barely a new CSS\nfeature, and one that is... questionably... useful for Sass users. Does\nmainline Ruby Sass support this already?\n\nWe don't really usually guarentee compatibility with bleeding-edge CSS\nfeatures that haven't gotten mainstream usage by developers... let alone,\nthe first time that a CSS feature directly overlaps with the major use of\nSass. Is this a finalized spec agreed on by the W3C? Is there a reason not\nto actually precalc these values with the Sass toolkit you are using?\nOn Sun, Jul 27, 2014 at 9:52 PM, Micha\u0142 Go\u0142\u0119biowski \nnotifications@github.com wrote:\n\nThe following valid CSS:\ndiv {\n    --a: 2px;\n    top: var(--a);}\nbreaks when passed through libsass with an error:\nerror: invalid property name\nCSS Variables are already supported by Firefox 31 that was released a few\nyears ago. They're available without any prefix. libsass shouldn't break\nthis valid CSS.\nSee also: sass/sass#1128 https://github.com/sass/sass/issues/1128\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/453.\n. To be clear, I'm not questioning that we should fix this, I'm just discussing priority. \n\nI'll tag this as a 3.1 feature, so give us a little bit to work out some of the other bugs first.\n. Merge o'clock has begun.\nOn Fri, Aug 8, 2014 at 9:09 PM, Aaron Leung notifications@github.com\nwrote:\n\nMerged #455 https://github.com/sass/libsass/pull/455.\n\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/455#event-150896976.\n. Closing based on dup status.\n. This was a known issue in node-sass (don't have the number handy), but I know it's been fixed. Please update your node-sass version!\n. We recently merged in a whole re-write of extends, and this should be fixed now.\n. This has been fixed with the merger of the extends branch.\n. Alright, re-enabled the test case this one solves. Works!\n. 3.0 is in RC1!\n. As posted, this doesn't actually run in either... And, I can't replicate the error. Can you find a 1 or 2 line input and output example. I'd love to get this fixed, just need to figure out what's wrong! The first code sample doesn't have any multiplication in it at all.\n. I'm going to temporarily close until I can get a better understanding of the bug. It's not because we don't care, but its because bugs like this can stay open for years. \n. Not yet. I know both teams are working on it! And we're working on getting all the features required. /cc @ericam @snugug\n. IT DOES NOW.\n. Seems like this was a bourbon importing issue. Reopen if you discovered something else.\n. This seems to conflict with the work @iamcarrico did on his patch #456, which only focused on invert(). This does address alpha() and grayscale() \nI was able to merge them together, however the specs break for alpha(). \nIf you can please rebase off master and run the test suite with ./script/spec then I'd love to be able to fix this issue!\n. That's definitely weird. I guess we coded the import to float to the top?\nHere is a simpler test case:\nhttp://sassmeister.com/gist/1f4393195c3175b71aae\n. It doesn't really matter... Sass 3.4 keeps import below the comment, so we should too. There's very rarely an accident over on the main Sass project. ;)\n. I'm confused on this issue. What would you expect to happen when you nest @keyframes? Like... why is it nested at all? Unless I'm missing something obvious.\n. Can we get a better test case here with input, Sass 3.4 output, and what happens when libsass runs it.\n. I believe this is definitely a duplicate of #185. These test cases are better, so please mention them over there!\n. Can we get a simple example test case based off master, please?\n. Test written by @carsonmcdonald! Now it's ready for fix'n.\n. EEEEE!!!!\n. @akhleung can we have a special \"Maps in LibSass\" announcement for SassConf this week?\n. Umm, this seems like it's a node-sass issue. We don't handle building or anything like that in this project. And, it sounds like it was fixed in a newer version anyway.\n. Can we please get a test case for this?\n. One of my amazing C++ badasses... @akhleung @xzyfer @uberska @nschonni... this is the last issue that I think's pretty serious before we get 3.0 out! \n\nWe can't have people going to production with compressed output, and getting a broken production build. :(\nI BELIEVE! Let's ship this shit!\n. Aaron- what adapter are you using for libsass?\nOn Fri, Oct 3, 2014 at 7:02 AM, Marcel Greter notifications@github.com\nwrote:\n\nIf you know that you have indented sass syntax in your string, you should be able to call sass2scss yourself to make the conversion before feeding it into libsass.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/488#issuecomment-57780863\n. Hmm... this is tricky. I can see doing it both ways. I mean, if we allow it as a config option, then we just add one line. Then again, passing in a string, it's really easy to just call the sass2scss function yourself.\n\nLet me see what I can do...\n. Hmm... yeah, I don't think we can properly implement URL parsing in C++... without incurring a lot of overhead. I think host languages should be able to include it when we get custom functions in.\n. @akhleung couldn't you use the custom function compilation interface to implement this just for the moovweb gosass?\n. hmmm\u2026. can we come up with the hardcoded-sass function that is similar? I want to make sure that we don\u2019t alienate people who are using it and ruin their \u201cWEEE! FUN!\u201d feeling of getting all these new features.\n. Yeah, I think that might be the best option for now.\n. Yeah, that's a good point @am11. How does Ruby Sass handle this?\n. Can you open a new issue for that discussion, though?\n. Hey @chriseppstein, has the compass team gotten to a pure-Sass image-url() implementation yet?\n. From @jonsuh and @roytomeij:\n$image-url-path: \u201c../images/\u201d !default;\n@function image-url($url) {\n  @return url(\"#{$image-url-path}#{$url}\");\n}\n. @chriseppstein Sorry, I thought there was an effort to port some functions from Ruby to Sass, and didn't know if this was one of them.\n@xzyfer I think I've agreed since the top to remove it...\n. Hmm... I like the idea. We should really find a way to test this.\n. Oh, don't worry about the Travis test, it looks like it was just a sass-spec issue. I wish we could re-run these damn things.\nI was just talking about an actual C++ test.\n. Done.\n. Good one. I'll add this as a test in the spec.\n. You sir, are a hero. This code looks much, much more robust. Thanks doing this!\n. Seems to be reporting zero coverage: https://coveralls.io/builds/1291084\n. ooohhhh! hahaha. i get it.\nOn Fri, Oct 3, 2014 at 3:09 PM, Marcel Greter notifications@github.com\nwrote:\n\nYeah, sorry, I should have pointed out more clearly that I intended to add\nmore commits to test how the build behaves. It's a bit hard to anticipate\nso I figured I could use this pull request to see what travis ci is doing\nwith it. It seems that the spec suite is not running correctly and thus no\ncoverage is reported. Looking into it right now.\n\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/497#issuecomment-57840123.\n. I believe we write them by hand. Except for automake and I have hacked that a few times.\n\nOn Fri, Oct 3, 2014 at 3:21 PM, Marcel Greter notifications@github.com\nwrote:\n\nFrom my local tests it indicates that sassc would need some option to have it compiled with these flags enabled: --coverage --no-inline. Do you know how the commited Makefiles are generated?\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/497#issuecomment-57841518\n. It's merged now... sorry about that!\n. Oh, also, I wrote some: https://github.com/sass/libsass/wiki/Setup-Dev-Environment\n. I've added the test to the sass spec. Please write those first next time. ;)\n. Alright, I just ran this against the lastest 3.0 build and it no longer crashes. I'm going to still commit the issue test, since this wasn't covered anywhere. It broke in 2.0, not sure when it got fixed.\n. Since this got magically, fixed... closed!\n. Ha. That's an impressive increase in coverage!\n\nOn Sat, Oct 4, 2014 at 9:39 PM, Coveralls notifications@github.com\nwrote:\n\n\nCoverage increased (+69.54%) when pulling 5d82781f119b75a1bc8a241607db9f38b0d3b270 on mgreter:feature/coveralls-metrics into c31087c6e7ab479c7c3f5f20d2f3fb31b3491c8b on sass:master.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/503#issuecomment-57923849\n. Oh wow, you not only wrote the test case, but you fixed it too? Nice. Thanks @carsonmcdonald \n. Yeah, there was another open issue about not using structs at all, and having configuration methods. Probably a better idea in the long run. I'll merge this in, but I say let's look at the whole interface itself and maybe do a larger change in 3.1\n. Shhh.... this is our secret. I know that @snugug had this as a hard requirement for his library supporting libsass... so maybe... shhh...\n. Awesome catch. Will get this in the spec. Thanks @lunelson \n. I do know that the initial spec for the custom function stuff got a bit\nconfused. I think we didn't document it, because we weren't entirely happy\nwith how it works. @akhleung, I don't have access to my email anymore (boo)\nand so I know you sent me an example a while ago.\n\nWhat I'd REALLY like, is custom function registration at the interface\nlevel.\nHere is my shitty pseudo code on what I'm proposing. It's very pseudo:\n```\nint IsEven(string *function_name, args[], &returnValue) {\n  int number = sass_val_number(args[0])\n  if(number % 2) {\n     returnValue = sass_make_bool(true);\n  } else {\n     returnValue = sass_make_bool(false);\n  }\n  return SASS_FUNCTION_RAN;\n}\nsass_register_function(\"is-even\", IsEven)\n```\nOn Mon, Oct 6, 2014 at 9:47 AM, Scott Davis notifications@github.com\nwrote:\n\nI've googled and greped and couldn't find any info on \"custom function\ncompilation\" that has been mentioned in a few issues.\nIf you can give me an example I would be happy to write the documentation.\n\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/514.\n. I didn't see any tests for this, so @malrase wrote some up. It is here: https://github.com/malrase/sass-spec/blob/issue_151/spec/libsass-todo-issues/issue_151/input.scss\n\nWE ARE SO CLOSE... but the tests that we wrote fail.\nWith Sass 3.4, when you do \"saturate(red)\" with only one variable, it doesn't error, it returns \"saturate(red)\". Right now, as written, it breaks. \nSo close! Come on! Help us finish this one up!\n. Alright, this looks good to me now.\n. I wrote this into the wiki documentation.\n. Besides variable-scoping, we're targeting 3.4 now. It seems like some of the repeating color handling is different (#dddddd vs #ddd). I really shouldn't have merged in the specs, but it was only here that I saw the 3.2 reference. \n. Whoa you work fast.\n. Still getting one failure locally: \n1) Failure:\nSassSpec::Test#test__/Users/hcatlin/dev/sass/spec/spec/libsass/color-names [/Users/hcatlin/dev/sass/spec/lib/sass_spec/test.rb:24]:\nExpected did not match output.\n--- expected\n+++ actual\n@@ -83,7 +83,7 @@\n MediumAquaMarine: mediumaquamarine;\n MediumBlue: mediumblue;\n MediumOrchid: mediumorchid;\n-MediumPurple: mediumpurple;\n+MediumPurple: #9370db;\n MediumSeaGreen: mediumseagreen;\n MediumSlateBlue: mediumslateblue;\n MediumSpringGreen: mediumspringgreen;\n@@ -104,7 +104,7 @@\n PaleGoldenRod: palegoldenrod;\n PaleGreen: palegreen;\n PaleTurquoise: paleturquoise;\n-PaleVioletRed: palevioletred;\n+PaleVioletRed: #db7093;\n PapayaWhip: papayawhip;\n PeachPuff: peachpuff;\n Peru: peru;\n. Oh, god. I know what happened. I'll fix this. It was a merge that I remember touched color values. \n. Seems like it's probably related to #515\n. Please ignore me. Running \"make clean\" seems to have fixed it. grumble\n. I make some mention of sass spec's future role. And, I did a training session at SassConf to introduce people to it.\nIt's certainly chaotic right now as it's a pretty random collection of tests, primarily sorted by where they came from rather than what they are testing.\nPart of the chaos is hard to lose though, in that keeping old tests around is important for such an old project. They may test assumptions that are unclear and still vital. Removing them entirely is probably unwise.\nThere's been a lot of effort to create more specs that are closer to unit tests... That is test the smallest possible demonstration of a behavior.\nAnd, obviously, doing those unit tests as issue tests is one way to achieve that.\nI'm happy to hear suggestions on how to structure the project in the long term, but everytime I think I have figured out a way to make it simpler... It ends up just as complex.\nThe goal is by the time we get to libsass 3.4, and it's usage as a libsass test bed is done, we will focus on organizing the tests in a more logical manner.\nI do know that there are 2-3 people working only on the spec, but focusing on test cases for currently broken libsass issues.\nOne thing that needs a lot of work is error testing and output style testing. That's currently entirely missing and needs some solid programming done.\nOn Wed, Oct 8, 2014 at 8:31 PM, xzyfer notifications@github.com wrote:\n\n:+1: these discussions are a big step forward.\nI'd also like to put some emphasis on restoring some order to sass-spec. Currently it feels rather chaotic and lacks clear contributing guidelines. Sass spec (or something of it's kind) is integral to moving libsass forward in sync with ruby sass. IMHO it's worth building a community around sass spec with clear goals. I'm happy to put my hand up to help out here.\nThis probably a discussion best to be had on the sass-spec project, and it's one that I think needs to be had.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/521#issuecomment-58448711\n. People are going to hate us. But, your right. This should be a breaking change to go to 3.0, it's more worth it. URL handling is still weak, so we need to make sure this is doable in Sass or equivalent. \n. Hmmm... so I merged this in locally, there were still image_url references, so the build wouldn't happen. So, I went through and removed them.\n\nAs I was running the test suite.... it ran 10-20x slower. Seriously. No idea why. \nI'm re-changing my mind. I think we need to have a better plan on how to handle image paths and stuff. And, the fact that it's causing my fan to turn on for some insane mysterious reason... it's a sign!\n. Had to revert this from master, since apparently it breaks with gcc but works with the llvm compiler. will re-consider for 3.1.\n. Check the failing Travis builds. They went all E on me, only for gcc 4.7, but llvm builds were fine.\nOn Sun, Oct 12, 2014 at 3:11 PM, Jeremy Linton notifications@github.com\nwrote:\n\nHmm, the gcc breakage is strange, I was building it with GCC. As far as the tabs, I tried cleaning them up (hence \"correct poor formatting\") where did you see a problem?\nIf your interested in committing this in the future, just tell me what you want changed (variable sanitation?, multiple parms?) and I can spend a little time cleaning it up.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/523#issuecomment-58817283\n. I'm running these locally to test the compressed output. I'm going to fixed SassSpec soon, promise. ;)\n. @am11 can you point out the exact test in the node repo?\n. @xzyfer seems to be an actual compile error on Travis. Does this need some other commit to work?\n. YESSSSSS\n. Yeah, I\u2019m looking at it. Seems to be gcc vs clang.\n\nOn Sun, Oct 12, 2014 at 11:11 AM, xzyfer notifications@github.com wrote:\n\nMaster is currently failing. FWIW git bisect says the culprit commit is fe8ae97b03d5bbdb53039462f74c2bd59c62daf3\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/531#issuecomment-58803969\n. I only have clang on my system, so that's why this slipped through. Also, I didn't check the build status. :( #fail \n. hmmm... I was hoping that @xzyfer's maps parser fixes would have gotten this... damn maps!\n. @bdkjones I only compile with clang... which is why RC3 was broken, because I suck at testing with gcc. ;) But yeah, we are using C++11 which changes some of that.\n. This is actually broken on 3.4! http://sassmeister.com/gist/9a971dd914b246f6824b\n. Apparently, Foundation dropped support for Sass 3.4, based off this function breaking! I wrote them a patch that should work for both versions.\n. So yeah, we can't \"fix\" this one, that way. It's actually more how Foundation was working to support something in libsass 2.0. I'll keep this open until they are fixed on the upstream.\n. This is awesome dude. For 3.1, I really, really, really want to get all the major frameworks compatible. This will help a TON.\n. That's a good point. Seems like we should be handling these some other way in the lib. @akhleung is there something obvious we are missing here?\n. This seems to break the test added for #509 \n. Yeah, #509 breaks. \n\n```\n$foo: (\n    (key1): (value-1-0),\n    key2: value-2-0,\n    (key6): (value-6-0),\n    key-3-0 key-3-1 key-3-2: value-3-0 value-3-1 value-3-2,\n    key4: (value-4-0, value-4-1, value-4-2),\n    key5: (key-5-0: value-5-1),\n    (key-7-0: key-7-1): (value-7-0: value-7-1),\n    (key-8-0, key-8-1, key-8-2): (value-8-0, value-8-1, value-8-2),\n);\ndiv {\n    foo: map-get((foo: 1, bar: 2), foo);\n    foo: map-get((foo: 1, bar: 2), bar);\n    foo: map-get((foo: 1, bar: 2), baz);\n    foo: map-get((), foo);\n    foo: map-get($foo, (key-5-0: value-5-1));\n    foo: map-get($foo, (key2));\n    foo: map-get($foo, (key-3-0 key-3-1 key-3-2));\n}\n```\nResults in an ~/dev/sass/spec/spec/libsass-closed-issues/issue_509/input.scss:7: unclosed parenthesis\nTested against s3.4 and it works just fine.\n. Lovely! Apparently, this breaks now on master. This wasn't an issue with this particular pull.\nUpdate:_ ugh. I'm a brilliant professional who is not at all an idiot. I misread the Travis output... I thought \"current\" meant master. Nope. It's this pull request failing. 3.1 then!\n. Ohhh... this is a good one. Thanks for the useful bug report. I've marked this as needs test and we'll get it in sass-spec soon.\n. @mzgol what adapter are you using?\n. If you checkout the Contribution guide in the wiki, it's so that we can write a sass-spec test case that is \"todo\"\nOn Sat, Oct 18, 2014 at 2:32 PM, Micha\u0142 Go\u0142\u0119biowski\nnotifications@github.com wrote:\n\nWhat does the needs test label mean? I've provided a test case. :)\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/552#issuecomment-59624680\n. Hmm... just checked and this seems to be passing now on master. @xzyfer did we change anything?\n. Good find!\n. Okay. I got merge happy. Such a failure. Needed more coffee. \n\nBuild is failing because I think this pull request and some of the other crop weren't compatible. :/\n. Can you title it WIP when it's not ready?\n. The \u201cHampton Awesome/Chaos Field\u201d can often cause unintended positive consequences.\nOn Mon, Oct 27, 2014 at 8:21 AM, Michael Mifsud notifications@github.com\nwrote:\n\nYep, sorry I though I had. I'll have a fix up shortly. Funnily enough the test failure answered my todo question.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/568#issuecomment-60584315\n. Yeah, just did that.\n\nOn Mon, Oct 27, 2014 at 9:13 AM, Michael Mifsud notifications@github.com\nwrote:\n\nI suspect you'll need to revert https://github.com/sass/sass-spec/pull/96 as well to get the green light.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/570#issuecomment-60589880\n. If I'm reading the above thread correctly, seems like this is ready to be merged in. So, I'm doing it... like now. ;P\n. @xzyfer let's get this and map looping into a quick release. I think those really were things people needed. ;P\n. Well, building it yourself is definitely a damn fine way of registering a strong protest. ;) I for one rather like this, but I know that @nex3 wants a more robust system for sass long term.\n\nWe could make a libsass-compass project that adds in functions like this. There are a couple of those, including path handling (image_path, etc) and spriting, etc.\nBut, I'd also like to point out that you can emulate this behaviour in pure sass too! Foundation does it that way with a map in its export() function. https://github.com/hcatlin/foundation/blob/29ffaad25daa4cfd99f5c9da4143baf89d883565/scss/foundation/_functions.scss\n. Check this out: https://gist.github.com/nex3/81c8a64f29771803916a\n. So, I'm guessing this is an issue with the export() function in Foundation. They released 5.4.6 / 5.4.7 as compatible with libsass 3.0! https://github.com/zurb/foundation/releases/tag/v5.4.7\n. (reopen if this happens on the latest Foundation!)\n. The license looks fine to me to remove the notice, since they are declaring\nit public domain, we can put it under our MIT license.\nOn Wed, Oct 29, 2014 at 6:42 PM, Coveralls notifications@github.com wrote:\n\n[image: Coverage Status] https://coveralls.io/builds/1402029\nCoverage increased (+1.62%) when pulling 1b00718\nhttps://github.com/sass/libsass/commit/1b007181fbbebd258e456d97ca2774829fce08bd\non mgreter:source-map-sources into 2fae47a\nhttps://github.com/sass/libsass/commit/2fae47a29133cf7f845d4a9386b2dd9e24adf608\non sass:master.\n\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/591#issuecomment-61017999.\n. soft tabbbbbssssss\n\nOn Tue, Nov 4, 2014 at 5:45 PM, Adeel Mujahid notifications@github.com\nwrote:\n\nLOL that is funny. :smile:\nI guess two-tab indentation is a convention in libsass project.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/603#issuecomment-61714633\n. Actually, the test was written wrong for this one, @xzyfer. You have to use 3.4 to generate this correctly. Your test showed \n\n@supports ((foo: bar) or (foo: bar) or (foo: bar)) and (foo: bar) {\n  div {\n    bar: baz;\n  }\n}\nWhen it should be...\n@supports (foo: bar) or (foo: bar) or (foo: bar) and (foo: bar) {\n  div {\n    bar: baz;\n  }\n}\nI'm updating this test in the threefour branch at sass-spec\n. Actually, let me move this over to master, so that you can test the single issue without dealing with all teh 3.4 issues (though, this is related to one major issue i've run into, methinks)\n. Sorry for not breaking this up. I'm a lazy, lazy developer. I'm updating the specs to match 3.4.9\n. Wait, we have a generic Sass function callback?\n. @mgreter generic as in, it functions like method_missing and unresolved function call attempts during execution are passed to the callback dynamically. Aka, they don't have to be defined (named) at compile time, and we could write a full RubySass compatibility layer (you could write Sass functions in Ruby)\n. The more limited (aka, must be predefined) function callback system was supposed to get ripped out and replaced with one that functions as a function resolver.\n. Definitely, overloads are one of the most requested features.\nThis branch is crazy! Guessing we call this 3.1 ;)\n. ...This is libsass. ;)\nOn Sat, Nov 8, 2014 at 5:45 PM, Adeel Mujahid notifications@github.com\nwrote:\n\nPlease report this issue to libsass. Node-sass is merely a node.js wrapper around libsass.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/632#issuecomment-62281899\n. NOOOO!!!!!\n\n(just kidding)\n. This is a common gotcha. Sass actually allows you to interpolate inside a comment. Aka..\n/* #{$width} */\nWill actually resolve out $width and print the value as a CSS comment. Aka, think of version and build info.\nSo, your commented out interpolation is being interpolated!\n. Yay!\nOn Sun, Nov 30, 2014 at 11:15 PM, Michael Mifsud notifications@github.com\nwrote:\n\nClosed #660 via #680.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/660#event-200369598\n. I like that you are disagreeing with your own implementation...!\n. Can you give an example of that code? How it might work?\n. Oh man. This has been a sorely needed addition.\n\nOn Mon, Dec 8, 2014 at 8:04 AM, Marcel Greter notifications@github.com\nwrote:\n\nMerged #693.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/693#event-204269993\n. We should definitely do a pre-release.\n\nOn Tue, Dec 9, 2014 at 5:03 AM, Michael Mifsud notifications@github.com\nwrote:\n\nIt's about a month since out previous release. I'm keen to keep the momentum rolling! We have a lot of good stuff on master which I've tried to summaries in https://github.com/sass/libsass/issues?q=milestone%3A3.0.3+is%3Aclosed.\nI'm opening this issue mainly because of @mgreter's incredible API updates. I want downstream libraries to be aware of the impending release and API changes to reduce lag time in implementation.\n/cc @hcatlin @mgreter @am11\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/697\n. I think we should definitely do a pre-release! Helps with integration stuff.\n\nOne of you all should do it... I don't have much to show myself on this\nrelease. ;(\nOn Mon, Dec 15, 2014 at 3:19 PM, Marcel Greter notifications@github.com\nwrote:\n\n@xzyfer https://github.com/xzyfer I've ammended your original post.\nHope you don't mind!?\nIMO most open issues are only a question if we want to ship it or not!\nI'll push my changes for the perl examples when all PRs are merged/decided!\nAs for the open Tasks (aka Documentation)\nFirst I want to give some props to @drewwells\nhttps://github.com/drewwells for his contributions to the API wiki\npages!\nIn the spirit of \"momentum rolling\", I would love to see if we could\ngather a bit more documentation for the next release. I will have my share\nwith updating the API docs to make sure it matches the latest. If anyone\nneeds some ideas what could be documented [image: :wink:]\n- what does is_delayed mean?\n- what does is_hoistable mean?\n- how does the lexer/parser work?\n- what are the roles of inspect and eval?\n- how is unicode handled?\n- what is a environment?\n- what is a context?\nOr what is your opinion on the documentation situation? IMO I really hope\npeople will continue to contribute to the wiki pages and the documentation!\nIt's very much appreciated from my side!\n\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/697#issuecomment-67085292.\n. I'm a dick: https://github.com/sass/libsass/releases/tag/3.1-alpha\n\nAnyhow, it needs to be 3.1, since we made interface changes.\n. All you do is write up the details! Here is Hampton's Helpful Release Notes\n- Start with 2-3 sentence really quick overview\n- List new features\n- List major bugfixes\n- Give as much credit out as you can!!!\nAlso... make sure we do some RC's for this release (I chose alpha for this one, since it's not a representation of the final... it's just for testing adapters, etc).\n. I can only get it setup w/ https://ci.appveyor.com/project/hcatlin/libsass\n. Source code > repo host of the decade\n. Should we do this as a New Years release?\n. Tres simple!\nOn Thu, Dec 11, 2014 at 3:32 PM, Marcel Greter notifications@github.com\nwrote:\n\n:+1: Thanks for the info! So I guess this implementation is on par with ruby sass! If we see a char above 127 we will output the utf-8 charset declaration, simple as that!\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/717#issuecomment-66708814\n. I mean, it's not that it's hard to implement, it's just that it's typically not that important. Why? Because, most production output is done in compressed style (or should be!) which doesn't include any spacing or indentation at all. It's only in development environments that you should maybe be using the nested output style... and in that case, it's not anything that affects anything really. \n\nIn your original post, you said that it would be more consistent to have hard tab spacing... what do you mean by that? Does some part of gulp use hard tabs?\n. Yeah, this is one of those awkward ones where I've vocally disagreed with Ruby Sass about it, but... we have to follow their lead.\nSee @nex3 and @chriseppstein, we're being good! All those +1's be damned. ;)\n. I mean, yes, it's okay.\n. I have long voted for this behaviour and fully support it.\nJust to be clear, the behaviour is that if the .css extension is not specified, but a .css file is discovered then its embedded into the Sass source tree?\n. We'd definitely love that. It seems that some people are already working on that.\nFirst it started here: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=721152\nThen that project seems to have died? Then, someone was talking about it here: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=694730\nIt's kind of out of our scope to learn how the debian package ecosystem works, but it should be pretty trivial to package in from the way we've constructed it.\n. I think this is an issue we close. We totally agree and want the stated goal, but it's not something we can really do from within this issue tracker or within the project itself. If anything comes up with the packaging that is a specific issue that is blocking Debian maintainers from packaging, then we'll deal with that separately. \n. WEEEEEEE\n. I just checked and the settings for libsass webhooks seem to match this. Is there anything you need me to do as an admin?\n. Any chance to get #548 in on this release? I've had a couple people contact me via email about it.\n. How about a Camp Sass release in like a month? Do preview till then?\nOn Mon, Mar 9, 2015 at 4:42 PM, Michael Mifsud notifications@github.com\nwrote:\n\nAlso worth a mention, we added 66 new specs with ~270 extra assertions and skip 26 less specs.\nmaster\n799 runs, 2109 assertions, 0 failures, 0 errors, 96 skips\n3.1.0\n733 runs, 1833 assertions, 0 failures, 0 errors, 122 skips\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/812#issuecomment-77968409\n. Hmm... makes me think maybe we should as Sass if they will add this feature.\n\nBut, remove it for now, as it's not covered in Sass.\n. :+1: \n. Thanks for the report!\n. I'd disagree that there is any philosophic war going on. At least not from our perspective. Less was a project that was founded in response to Sass and was actually first written in Ruby, just like the main Sass project. It's main reason for being was to be CSS-compatible and to try out a different-style extension mechanism. Our introduction of the CSS-compatible syntax as the primary Sass syntax means that the main remaining differences between the language are syntactical and behavioural.\nI definitely agree that if we could support LESS, that would be pretty cool. We have no hard feelings about LESS at all. But...\nTechnically speaking, what you are proposing is nearly impossible. Less uses a significantly different model for compilation and resolution than Sass. The example above is simple enough and is something we could do... that is, use @ instead of $. But, only in that simple case. The reason we don't use @ as variable names, is because it's significant in CSS selector parsing and in rules like @media. The CSS selector parser and resolver is probably the most complex part of Sass and there are endless tiny compilation and parsing differences between the two languages, that getting anything that could function with enough predictability to work with a complex project would be an enormous undertaking.\nRight now, and probably for the future, we're focusing on coordinating with the rest of the Sass ecosystem to do the already enormously difficult task of keeping a C++ implementation of a very complex and mature language.\nFor your project, if it's mixed like that, I'd highly suggest just picking one language. It doesn't have to be Sass! Sass' .sass and .scss files can easily be mixed together, because they use the same internal extension logic. In fact, you can easily convert between languages (don't confuse automated conversion w/ human bugfixing as interchangable with parsing all at the same time) with projects like https://github.com/ekryski/less2sass\nAnyhow, your heart's in the right place, but the enormous task we have here already is enough, without biting off an entirely other language! Thanks for taking the time to come write this up, and hopefully my answer and reasoning seem sound. Feel free to re-open if you want to keep the conversation going!\n. todo-issues is where it goes! Until it's fixed that is!\n. No big deal! It's fine!\n. Sorry, just realized it was requested to stay open above. @xzyfer I'll stop mucking about. ;)\n. I'm at Camp Sass right now in Atlanta, and it would be the COOLEST THING EVER, to announce rc2. ;)\n. This has been fixed in the latest 3.2 release.\n. NOPE. Sorry. Failure in my old script.\n. I can confirm that this issue has been solved in the latest release.\n. Aaaand, I'm mistaken.\n. Interestingly, the test for 1080 passes already... without this commit!\n. hmmm... what the hell is wrong with my setup...\n. @mgreter  I don't understand why the perl value would come with quotes in the first place?\nIt seems like we definitely keep that quoted value in the actual strings... shouldn't be hard to expose that to the API, right?\nhttps://github.com/sass/libsass/blob/c8885dcac114b8b6a5ba19c30ea7313d831a16be/ast.hpp#L1442\nInternally, we use that all over the place... https://github.com/sass/libsass/search?utf8=%E2%9C%93&q=quote_mark\n. I'm assuming that he's trying to use the C-API to define a function like  compare(\"a\", a). In the wrapper code, the Sass_Value that's sent back those values is \"\\\"a\\\"\" and \"a\" respectively, meaning that comparing them as equivalent would require implementing unquote. Where, we could send back value as \"a\", and then each Sass_Value would also have a boolean property called quoted, so that you can include that in your logic if required... because maybe we do want to react to them differently. But, most of the time, I would be surprised if I were writing an integration library and I got back a string value as \"\\\"a\\\"\".\nObviously, if we are passing a Sass_Value back to the interpreter, then it doesn't matter and libsass is dealing with the details for us, so either way is the same.\nI definitely agree with @chriseppstein on this one... since we really want it to be easy to take values from  Sass->Lib.\n. @mgreter I haven't repro'd what Chris says, but it sounded to me like the Sass_Value passed in did include the quotes, maybe re-attaching them with getValue()?\nChris, can you show what you mean in some code that we can write a test based on?\n. Cool, then it looks like @mgreter's patch should fix this... because we can now pass the quoted-ness both directions in a civilized manner (and maintaining the original, if you don't change the Value)\n. I'm not a fan of making units seem natural between two languages that are interop, when they aren't. I'm fine mutating on something like SassValue as a thin wrapper on the C-API. It seems to kind of put things in a corner.\n. I've written a test for this over in sass/sass-spec#357. I've verified that this fixes the issue.\n. I definitely vote for a hotfix... these are show-stoppers.\n. It's nice when you realize you fixed a bug without meaning to.\nOn Tue, Aug 25, 2015 at 3:10 PM, Marcin Cie\u015blak notifications@github.com\nwrote:\n\nHaving removed extra braces in input:\n``` js\n    var sass = require('node-sass');\n    var input = \"#test1 { area: 1px * 2px / 1px;\\n\" +\n                \"         area-fn: testing(1px * 2px) / 1px; }\\n\" +\n                \"#test2 { ratio: 20px / 2% * 1%;\\n\" +\n                \"         ratio-fn: testing(20px / 2%) * 1%; }\";\n    var options = {\n      data: input,\n      functions: {\n        \"testing($value)\": function(value) {\n          console.log(value.getUnit());\n          return value;\n        }\n      }\n    };\n    var expected = \"#test1 { area: 1px; area-fn: 1px; }\\n\" +\n                   \"#test2 { ratio: 10px; ratio-fn: 10px; }\\n\";\nsass.renderSync(options);\nconsole.log(options.result.css.toString());\n\n```\nI am getting:\n```\npx*px\npx/%\ntest1 {\narea: 2px;\n  area-fn: 2px; }\ntest2 {\nratio: 10px;\n  ratio-fn: 10px; }\n```\nso units are still strings, but they do work here and back.\nTested with node-sass master https://github.com/sass/node-sass/commit/7c15014b594f2b9e85b72cab89e2aca56762e740, libsass master as of Aug 20th https://github.com/sass/libsass/commit/0ae11a47e69164bc5ce563f51201f765d2822fb6\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/1149#issuecomment-134756820\n. Whoa, I'd totally missed this thread... EEEEEEEEEEEE!!!!!\n. If you'd like a change in the error message, ask at sass/sass and if they change it, then we can. We try and stay as close as we can to their good (and odd) behaviours.\n\nWe could just change the error message (have the parser keep that info), but it would take up more memory which is not ideal.\nOn Tue, Aug 4, 2015 at 6:03 PM, Michael Mifsud notifications@github.com\nwrote:\n\nThis is a Sass feature and as such has been implemented in LibSass.\nscss\na { \n  b: $foo-bar__baz;\n}\nRuby Sass output\nUndefined variable: \"$foo-bar--baz\". on line 2 at column 6\n\nFor historical reasons, variable names (and all other Sass identifiers) can use hyphens and underscores interchangeably. For example, if you define a variable called $main-width, you can access it as $main_width, and vice versa\nSource\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/1428#issuecomment-127819005\n. Can't figure out how to 'transfer ownership', but I did disable the feature.. WTF! We're not going GNU.\n. Can we change this to is_indented_syntax_src() ... since, Scss is Sass is Sass.\n. \n\n",
    "lunelson": "This does not seem to be fixed.\nCertain kinds of attribute selector matching\u2014e.g. span[class|=\"lang\"]\u2014still throw an error, although they should be valid. \nReference:\nhttps://developer.mozilla.org/en-US/docs/Web/CSS/Attribute_selectors\n. Some of these use-cases are already working, based on what I can see on sassmeister; but a modification of @anotheruiguy's example\u2014which is still broken\u2014produces an interesting glitch:\nscss\n%new-parent {\n  border-width: 1px;\n  border-style: solid;\n  &.background-color {\n    background-color: orange;\n  }\n  &.add-border {\n    border: 1px solid red;\n  }\n}\ncss\n.outer-box {\n  border-width: 1px;\n  border-style: solid; }\n  .background-color.outer-box {\n    background-color: orange; }\n  .add-border.outer-box {\n    border: 1px solid red; }\nThe silent class is not repeated here; but the parent selector reference is coming out in reverse order. It would still be valid since a compound class is valid in any order, but I wonder if it points to something deeper?\nAnyway basic implementation of silent/placeholder classes\u2014notwithstanding classes nested in the placeholder\u2014is working for me so thanks @akhleung and everyone else.\n. @Ilyes512 ruby sass gets much slower than that on big projects. I've seen cases with over 5 seconds compile time. Which is just not workable, in this era where we're told we should 'design in the browser'. Speed is the basic reason for libsass. See @benfrain's article for reference http://benfrain.com/libsass-lightning-fast-sass-compiler-ready-prime-time/; and yes as @KayLeung said you can just simplify your use-cases for @extend. Basic non-nested usage and placeholder classes are already working.\n. I discovered an odd thing with chaining of extends, which isn't incorrect but unexpected. In the following example if I extend %orig directly the selectors come out the way one would expect i.e. .h1.single, h1.single, but if I extend the %inter declaration, the first compound class gets the class-names reversed. \nJust posting in case it's of interest to those working on the feature and running tests.\n``` scss\n%orig {\n  &.single {\n    line-height: 1;\n    margin-top: 0;\n    margin-bottom: 0;\n  }\n}\n%inter {\n  @extend %orig;\n}\n.h1, h1 {\n  @extend %inter;\n}\n```\ncss\n.single.h1, h1.single {\n  line-height: 1;\n  margin-top: 0;\n  margin-bottom: 0; }\n. I've got the official one. No problem, I'll be quiet ;)\n. Also with nesting retina media queries inside a width query. This Sassmeister gist illustrates it: if you switch compilers in the control panel you can see how ruby-sass 3.3 combines them correctly but libsass simply writes it out nested:\nhttp://sassmeister.com/gist/8914969\n. I've written a library of functions that provide all the Sass 3.3 map capabilities using lists. It's 'forward-compatible'. Meaning, when native maps arrive your code will work the same. You can modify Susy Next to work with these functions by just removing the colons (:) from the maps. \nYou can install it with bower install sass-list-maps or cut and paste. Read more here:\nSass List-Maps\n. No, libsass is a several steps behind and does not support the complete set of features even from sass 3.2. If you choose to work with libsass you have to test all your output. The speed increase can make it worthwhile however.\n. +1 for a 'compiles with libsass' badge, this would be a good incentive.\n. @digitaljhelms glad to help.\n. @thomaswelton that would be badass indeed.\n. @stu-salsbury I'd be interested to know if such a tool exists and how to use it; I used to run tests in sassmeister or else hack a local save-on-change thing with Sublime Text 3 which updates the CSS file on changes. You could also hack Takana for a live-compiling setup.\n@darkwebdev and @msikma if maps support is all that's holding you back try my sass-list-maps polyfill, the implementation is functionally the same. Unfortunately susy makes heavy use of Sass 3.3+ syntactical changes which do not provide new or different functionality but an alternate way of writing it, so porting Susy to libsass even with the polyfill is a bit tedious\n. With the @each operator thing, do you mean the multi-assignment thing like @each $key, $value in $map? That's the only thing missing?\n. libsass doesn't support maps right now. You can get the same functionality but with different syntax using some functions I wrote called 'sass-list-maps'. Explanation in this thread: https://github.com/hcatlin/libsass/issues/263#issuecomment-33230572\n. awesome\n. libsass doesn't support the unique-id() function yet afaik. I was going to put up an issue about that actually. Or did I already? can't find it now.\n. As far as I can tell ruby sass is still producing invalid output, with the div selector inside the @keyframes block...? This use-case might be one for the @at-root functionality rather.\n. I had the same thing today; it seems to be bubbling of media rules that don't play nicely. \nThis first example does not output what it should\nscss\n.test {\n  @media screen and (min-width: 30em) {\n    color: blue;\n  }\n}\n.other {\n  @extend .test;\n}\ncss\n@media screen and (min-width: 30em) {\n  .test {\n    color: blue; } }\nBut when written this way it works.\n``` scss\n@media screen and (min-width: 30em) {\n  .test {\n    color: blue;\n  }\n}\n.other {\n  @extend .test;\n}\n```\ncss\n@media screen and (min-width: 30em) {\n  .test, .other {\n    color: blue; } }\n. I'm getting syntax failure on the following.\n``` scss\n$nest: (\n  alpha: (\n    beta: (gamma: delta),\n    epsilon: 2 3 4,\n    zeta: 'hi'\n  )\n);\n.test {\n  out: map-get(map-get(map-get($nest, alpha), beta), gamma);\n  out: map-get(map-get($nest, alpha), epsilon);\n  out: map-get(map-get($nest, alpha), zeta);\n}\n```\noutput with ruby sass 3.4.4 is the following:\ncss\n.test {\n  out: delta;\n  out: 2 3 4;\n  out: \"hi\";\n}\nRunning sassc on the command line with this however, I get unclosed parenthesis error for line 4.\n. Cool. Yes, it's definitely edge-case to have maps as keys but it's been shown in ruby-sass that pretty much any value type is accepted as a key or value, so FWIW that's the spec.\n. Great! I knew that @xzyfer was already aware of it but I figured it should be in the queue.\n. OK this is same as #509 now, feel free to combine/delete\n. Seems to be fixed in 3.0rc1 ;)\n. Interesting, @xzyfer. I've been wondering what the performance of native maps would be like compared to my polyfill, which as you might be aware uses SassScript lists of pairs. The performance has been good and stable, and I also do extensive deep nested getting and merging; but it doesn't support maps or lists as keys, the assumptions are more restrictive. In any case a native implementation would have to do better than the performance of the list-based approach I would think.\n. Oh great, it's very gratifying to hear that. I'm glad to know that the native implementation is being built by someone who cares about it as much as I do :smile:! I can't help with C unfortunately, but if I can help with testing let me know.\n. Sounds great @xzyfer, I'm going to jump in as soon as I can clear the decks on another project. I'm following this progress closely and really looking fwd to trying it out!\n. Isn't this an interpolation inside an interpolation? The following works as far as I can tell\n``` scss\n$foo: \"bar\";\n%foo--#{$foo} {\n    foo: bar;\n}\na { \n  @extend %foo--bar; \n}\n``\n. Right. Good idea, I will put up an issue on ruby-sass about it too.\n. This is not to do withmap-keys()`, rather it's a problem with interpolating a list to a string. So the title of this issue and the test do not point to the real problem\u2014I suggest you edit it and reference a better test.\nFor your use-case, you could in the meantime use a loop to build the right string for you, e.g.\nscss\n$color-names: map-keys($primary-color-palette);\n$length: length($color-names);\n$string: '';\n@for $n from 1 through $length {\n  $name: nth($color-names, $n);\n  $string: $string + if($n == $length, '#{$name}', '#{$name}, ');\n}\n.out {\n  content: $string;\n}\n. As of today, I'm still seeing problems with lists of quoted items. The following is a bit elaborate but please bear with me, it's just to show that what's at issue is a list of explicitly quoted strings:\n``` scss\n$contexts: (\n  mobile-l: (min-width: 20em),\n  tablet-s: (min-width: 30em),\n  tablet-l: (min-width: 48em),\n  desktop-s: (min-width: 64em),\n  desktop-m: (min-width: 80em)\n) !default;\n$quoted-context-keys: ();\n@each $key in map-keys($contexts) {\n  $quoted-context-keys: append($quoted-context-keys, quote($key), 'comma');\n}\n.test {\n  output: map-keys($contexts);\n  output: $quoted-context-keys;\n  output: #{$quoted-context-keys};\n  output: \"[#{$quoted-context-keys}]\";\n  output: \"#{$quoted-context-keys}\";\n  output: \"[\"#{$quoted-context-keys}\"]\";\n  output: '#{$quoted-context-keys}';\n  output: \"['#{$quoted-context-keys}']\";\n}\n```\nin ruby sass 3.4.9 produces\ncss\n.test {\n  output: mobile-l, tablet-s, tablet-l, desktop-s, desktop-m;\n  output: \"mobile-l\", \"tablet-s\", \"tablet-l\", \"desktop-s\", \"desktop-m\";\n  output: mobile-l, tablet-s, tablet-l, desktop-s, desktop-m;\n  output: \"[mobile-l, tablet-s, tablet-l, desktop-s, desktop-m]\";\n  output: \"mobile-l, tablet-s, tablet-l, desktop-s, desktop-m\";\n  output: \"[\"mobile-l, tablet-s, tablet-l, desktop-s, desktop-m\"]\";\n  output: \"mobile-l, tablet-s, tablet-l, desktop-s, desktop-m\";\n  output: \"['mobile-l, tablet-s, tablet-l, desktop-s, desktop-m']\"; }\nbut in sassc: 3.1.0-2-g2033 / libsass: 3.1.0-76-g71448, produces\ncss\n.test {\n  output: mobile-l, tablet-s, tablet-l, desktop-s, desktop-m;\n  output: \"mobile-l\", \"tablet-s\", \"tablet-l\", \"desktop-s\", \"desktop-m\";\n  output: mobile-l\", \"tablet-s\", \"tablet-l\", \"desktop-s\", \"desktop-m;\n  output: \"[mobile-l\", \"tablet-s\", \"tablet-l\", \"desktop-s\", \"desktop-m]\";\n  output: \"mobile-l\", \"tablet-s\", \"tablet-l\", \"desktop-s\", \"desktop-m\";\n  output: \"[\"mobile-l\", \"tablet-s\", \"tablet-l\", \"desktop-s\", \"desktop-m\"]\";\n  output: 'mobile-l\", \"tablet-s\", \"tablet-l\", \"desktop-s\", \"desktop-m';\n  output: \"['mobile-l\", \"tablet-s\", \"tablet-l\", \"desktop-s\", \"desktop-m']\"; }\nnote different results with single and double quoting, etc.\n. Sure thing\n. I made a test for this\u2014note however, that actually writing null directly in to a declaration still outputs. For this test I had to create a function that returns null, rather than the following which was my first try (however this is an unlikely edge case).\ninput:\nscss\n.test {\n  out: null;\n}\noutput:\ncss\n.test {\n  out: null; }\n. Thanks @HugoGiraudel that's what I figured ;)\n. The next release is going to be epic\n. Working with the latest sassc, I'm finding the not expression seems to give the wrong result on types other than booleans or null. The following test in ruby sass all produce 'truthy'; but I'm getting 'falsey' on all but the first:\n``` scss\n@function truefalse($bool: null) {\n  @if not $bool {\n    @return 'falsey';\n  } @else {\n    @return 'truthy';\n  }\n}\n.test {\n  debug: truefalse(true);\n  debug: truefalse(5);\n  debug: truefalse(string);\n  debug: truefalse((alpha: 1, bravo: 2));\n  debug: truefalse(this is a list);\n  debug: truefalse('true');\n}\n```\ncss\n.test {\n  out: 'truthy';\n  out: 'falsey';\n  out: 'falsey';\n  out: 'falsey';\n  out: 'falsey';\n  out: 'falsey'; }\n. Made a test for this. The issue would seem to be that libsass needs to intelligently handle situation where quotes are part of the string, using single quotes in these cases, in order to preserve them. That being said, this issue made me wonder if Sass is too permissive about quoting: in other languages escaping and interpolation are only allowed inside double-quotes, and single-quoting causes straight output.\n. Although if I cd in to the sassc/ folder and run make, it builds a sassc binary, but with the flag \"DSASSC_VERSION=\"\\\"3.0.2-3-gbbba\\\". Seems to me this was different on earlier builds\n. I followed the commands from the wiki mostly. Attempting to isolate the problem, I used the finder to delete all the files in the libsass directory and ran git reset --hard HEAD to re-acquire the sources files. Then I ran ./script/bootstrap which cloned the other repos, then make to build. The build seemed to work but at this point there was still no binary file. I went in to the sassc directory and ran make again, which seemed to build it. Now when I run the binary with -v I get this\nshell\nsassc: 3.0.2-3-gbbba\nlibsass: 3.1-alpha-5-g705e\nsass2scss: 1.0.3\nSo I guess it's ok... does that look right to you?\n. Great. How does one make changes to the wiki? Is it doing PRs? I was thinking about writing a set of instructions anyway cause I have a gulp setup to run the binary too, for folks who use that.\n. This is great news @mgreter, thanks. It does seem to be as you say, that ruby sass interpolates a list by unquoting everything to make it one string, and if this in turn is quoted , the outermost will be normalized to double quotes. It might be worth asking @nex3 or @chriseppstein to chime in though, as I seem to remember my test gave different output in sass 3.3.x vs 3.4.x , so I think they updated this logic recently. \n. @nex3 I was inferring that since\u2014according to Sassmeister\u2014the code in the first post renders differently in sass 3.3 vs 3.4, something might have explicitly changed there; but in any case that you could probably clarify in plain terms what the logic is behind sass' interpolation of\u2014for example\u2014lists of quoted items\n. Thanks for that @nex3 \n. Great catch @anlutro .\n. This is a super exciting feature if it does what I think. Would this be a means to add advanced math functions, for example?\nExample plugin link above is 404.\n. I noticed the following today with 3.3.4: anything starting with calc seems to be skipped:\n``` scss\n@function calcfoo() { @return 'hello world'; }\n@function barcalc() { @return 'hello world'; }\n.test {\n  out: calcfoo();\n  out: barcalc();\n}\n```\ncss\n.test {\n  out: calcfoo();\n  out: \"hello world\"; }\n. So is this the spec then? I have a group of functions that operate on calc() expressions\u2014would be good to know what the future-proof naming convention is\n```scss\n@function calc(){ @return 'hello world'; }\n@function -foo-calc(){ @return 'hello world'; }\n@function foo-calc(){ @return 'hello world'; }\n@function calc-foo(){ @return 'hello world'; }\n.test {\n  out: calc(); // won't be processed\n  out: -foo-calc(); // won't be processed\n  out: foo-calc(); // ok?\n  out: calc-foo(); // ok?\n}\ncss\n.test {\n  out: calc();\n  out: -foo-calc();\n  out: \"hello world\";\n  out: \"hello world\";\n}\n```\n. ah good catch! I can work with that, shall I update the title of this issue?\n. > I am unable to reproduce the out of order selectors on 3.3.3.\nYeah I got the out-of-order selectors with node-sass latest release (v3.5.0-beta.1), plugged in to my fork of sintaxi/terraform which plugs in to my fork of sintaxi/harpjs, and I also get the error also if I use this build system in sublime text, which seems to be pointing at the latest version of sassc; however if I clone and run sassc as of right now, I don't get the error. I also don't get it when I switch node-sass back to v3.4.2.\n. @xzyfer I think I've identified what's going on, there's a series of bugs at work: it's not a problem of #{} not stripping quotes as much as a problem of double-quotes resulting from the quote() function and causing havoc with #{}, particularly when combined with @extend\nRe quote():\nscss\n.test {\n  /* should quote */\n  out: inspect(quote(b));\n  /* should not double quote */\n  out: inspect(quote('' + b));\n  /* should fail, because input is a list (separate bug) */\n  out: inspect(quote(a b c));\n  /* should still not double quote */\n  out: inspect(quote('a b c'));\n}\ncss\n.test {\n  /* should quote */\n  out: \"b\";\n  /* should not double quote */\n  out: '\"b\"';\n  /* should fail, because input is a list (separate bug) */\n  out: \"a b c\";\n  /* should still not double quote */\n  out: '\"a b c\"'; }\n...and when trying to interpolate that:\nscss\n/* this is ok */\n.foo--#{quote(bar)} { c: d; }\n/* this is not ok */\n.foo--#{quote('' + bar)} { c: d; }\n/* this is just weird */\n.foo--#{quote('' + bar)} { @extend %baz; }\n%baz { c: d; }\n``` css\n/ this is ok /\n.foo--bar {\n  c: d; }\n/ this is not ok /\n.foo--\"bar\" {\n  c: d; }\n/ this is just weird /\n\"bar\".foo-- {\n  c: d; }\n```\n. @mgreter that sounds like what canonical sass would do, yes: don't quote it if it's already quoted\n. Sorry @mgreter I didn't get to testing it but glad to see its closed\n. I've run in to this too, and noticed there is at least one combination which will cause a crash. I've made a repo for this test case, but the results are also copied below.\nhttps://github.com/lunelson/node-sass-selector-unify-test\nFirst, this compiles incorrectly:\nscss\n.a {\n  color: blue;\n  & > * {\n    @at-root #{selector-unify(&, '.b')} {\n      color: red;\n    }\n  }\n}\n```css\n/ dart-sass / ruby-sass result /\n.a {\n  color: blue;\n}\n.a > .b {\n  color: red;\n}\ncss\n/ libsass result /\n.a {\n  color: blue;\n}\n.b .a > {\n  color: red;\n}\nAnd this will cause the compiler to crash:scss\n.a, .b {\n  color: blue;\n  & > * {\n    @at-root #{selector-unify(&, '.c, .d')} {\n      color: red;\n    }\n  }\n}\ncss\n/ dart-sass / ruby-sass result */\n.a, .b {\n  color: blue;\n}\n.a > .c, .a > .d, .b > .c, .b > .d {\n  color: red;\n}\nsh\nlibsass crash result\nAssertion failed: (l_last_head && \"lhs head is null\"), function unify_with, file ../src/libsass/src/ast.cpp, line 1005.\nAbort trap: 6\n```. ",
    "techdragon": "this also throws an error \n*[class|=\"has-background\"] {\n    background: #efefef;\n    padding: 7px;\n    border: 1px solid #888;\n    margin-bottom: 5px;\n    }\nspits out \nerror: invalid attribute name in attribute selector\nit seems that http://css2sass.heroku.com/ can correctly parse it, so i'm suspecting its libsass at work here.\n. I left a comment in a ruby-sass discussion that may be relevant to this effort. https://github.com/nex3/sass/issues/765#issuecomment-34569655 it was about the potential to refactor the ruby-sass tests to make the test cases portable. if this could be done then the tests could be reused by libsass to give an easy check with regards to ruby-sass compatibility.\n. ",
    "kennethormandy": "@hcatlin Unfortunately in that case, only people with commit access or the person who opened the issue can re-open it.\n. Hopefully this helps a little, thanks to all the contributors for the work on libsass so far.\nhttps://www.bountysource.com/issues/1057273-sass-files-not-supported\n. @mgreter That\u2019s exciting! @ArnaudRinquin got pretty far with sass2scss in JavaScript, and it has a good test suite. I had previously tried to do something similar myself and have an open PR for the remaining tests that I have. If you wanted help moving those over, between the two, I think it\u2019d be pretty thorough.\n. @mgreter I\u2019m happy to add more test cases, but can we do the testing in your sass2scss repo too? Ideally people will end up using this through Node-sass and libsass, so I think the tests would be beneficial in the lower-level project. Amazing job, by the way, that\u2019s great to see so many cases are passing.\n. @LaurentGoderre Unfortunately, the feature isn\u2019t implemented yet. I believe #80 is the original issue, but #146 seems to be the main one for it now. @benfrain kindly opened a bounty on it.\n. Hm, I actually had this problem with Bourbon\u2019s Neat, which doesn\u2019t have CSS in the name, so I\u2019m not sure if that\u2019s all it is. I\u2019ll see if I can create another test case that isn\u2019t using Inuit.\n. @akhleung Ah, the conditions you described in the new issue were the problem I think, I was omitting .scss.\n. Found a workaround, you can use this function in the meantime. It should be a drop-in solution:\nscss\n@function grayscale($value) {\n  @return #{ \"grayscale(\" + $value + \")\" };\n}\nYou can vendor prefix it, too, if you\u2019d like:\nscss\n@mixin filter($properties) {\n  // Your vendor prefixing stuff here, I am using Bourbon:\n  @include prefixer(filter, $properties, webkit moz spec);\n}\nThen, you can just write:\nscss\n@include filter(grayscale(100%));\n. ~~Wow, I had no idea darken() didn\u2019t work. @akhleung, is that a regression?~~ Sorry, I was testing the problem and recreated the issue, ha. @restlessdesign, if you get rid of your custom function, darken() works already. So just write:\nscss\n.selector {\n    border: 1px solid darken(#f0f1f4, 3);\n}\nand you\u2019ll get\ncss\n.selector {\n  border:1px solid #e7e9ee;\n}\nI think you might (understandably) be mixing up Sass\u2019 functions with CSS Filters. The example I gave will only work because it\u2019s a CSS Filter. If you\u2019re looking to use Sass\u2019 darken or saturate, that should work already, per the Sass docs. If you want to use the CSS Filter saturate, you\u2019re on the right track basing it off of my greyscale() function. There is CSS darken() filter, so you\u2019re actually just over-writing libsass\u2019 built-in darken function right now.\n. I managed to narrow down the Segmentation fault: 11 that lead me to this bug. This one is an actual crash.\n``` scss\n@mixin experimental($property, $value, $moz: true, $webkit: true, $ms: true, $o: true, $khtml: false, $official: true) {\n  @if $webkit { -webkit-#{$property}: $value; }\n  @if $khtml { -khtml-#{$property}: $value; }\n  @if $moz { -moz-#{$property}: $value; }\n  @if $ms { -ms-#{$property}: $value; }\n  @if $o { -o-#{$property}: $value; }\n  @if $official { #{$property}: $value; }\n}\n$appearance-support: -moz, -webkit, not -ms, not -o, not -khtml;\n@mixin appearance($appearance) {\n  $appearance: unquote($appearance);\n  @include experimental(appearance, $appearance, $appearance-support...);\n}\ninput[type=\"search\"] {\n  @include appearance(textfield);\n}\n```\nRemoving ... from @include experimental(appearance, $appearance, $appearance-support...); fixes this, and appears to give the correct output. So maybe this is just a syntax bug, it looks like you might already be able to pass in an incorrect number of arguments, just not with an ellipses at the end.\n. @opichals @killercup There\u2019s a bit more info in #146, #137, it\u2019s hopefully supposed to be in before the end of the year. There\u2019s an open bounty on it, too: https://www.bountysource.com/issues/1057456-extend-classes-wont-compile-correctly-with-both-regular-and-silent-selectors/bounties\n. :sparkles: Woah! :sparkles:\nGreat work @mgreter and @akhleung\n. Believe this is a duplicate of https://github.com/hcatlin/libsass/issues/151\n. I\u2019m using Node-sass, too. I\u2019ll let you know if there\u2019s a problem after the next update.\n. @aedenj I believe this is fixed in libsass, but Node-sass is waiting to pull in the latest changes until @extends is done.\n. I believe this is an issue with @supports, too.\nEdit\nHere\u2019s an example:\nscss\n@supports not (font-feature-settings: \"smcp\") {\n  font-size: 100%;\n}\n. I\u2019m using Node-sass, yeah, so I will try Sassc instead and let you know. I think @whatisjasongoldstein was already using Sassc, though.\n. Oh, okay. I thought the fix would overlap by allowing general @ rules. Would you prefer I opened a new issue for that?\n. I think there is at least some support for this. I\u2019ve been using Node-sass, which outputs @warn statements to the console, and I believe it does the same for @debug statements, though I never looked at which project that was coming from. Which libsass wrapper are you using?\n. Was this in a branch, or is it \u201cout there?\u201d I built the last OS X binary for Node-sass the other day, I\u2019m wondering if I should do it again for this. Is there anything we can help with to prevent this kind of thing from happening? Writing tests or something? (Sorry for all the questions!)\n. @nschonni Thanks! My understanding of the whole process is still a little hazy.\n. Just wanted to say you did a great job with the examples for this issue. Using that SassMeister thing is a pretty coll, fast way to test it.\n. Thanks, good point. I guess I was thinking all @ rules would work like media queries do now, but maybe they don\u2019t in the Ruby version, not sure.\nEither way, @supports doesn\u2019t work in any capacity right now.\n. This isn\u2019t a super specific answer, but I remember finding there was a lot more than just that which didn\u2019t working with Suzy Next. The last version I had working was, I think 1.0.9, and I still had to comment a mixin out.\nIf you\u2019re interested in a workaround, Harp implicitly compiles SCSS files through Node-sass and libsass, and I got that version of Susy to work with it. We were testing out using Component and Harp, so you can follow the instructions for using Harp and Susy here. If you\u2019re not interested in Harp, that fork of Susy might still prove useful for use with libsass in the meantime.\n. If you\u2019re using Node-sass this still won\u2019t work, but I think it is fixed on the Master branch (https://github.com/hcatlin/libsass/issues/154). It\u2019ll probably get pulled into Node-sass soon.\n. @niallobrien Bourbon is making other changes that won't work with libsass, but v3.2.0 was just released and is the libsass compatable version.\n. Good catch. You can also @import a .css file, but it looks like it\u2019s explicitly checking for a .css extension. The following can serve as a workaround:\nscss\n@import \"http://fonts.googleapis.com/css?family=Titillium+Web:400,300,200,600.css\";\nBut really, this should work too:\nscss\n@import \"http://fonts.googleapis.com/css?family=Titillium+Web:400,300,200,600\";\n. I know libsass isn\u2019t wanting to add anything not in the Ruby version, but I agree, it would be kind of nice to see Stylus-esque CSS blocks until stuff like this will work by default. I\u2019m having the same kind of issue with @supports in https://github.com/hcatlin/libsass/issues/261\n. Bourbon 3.x is being maintained alongside Bourbon 4.x and will continue to work with libsass and Sass 3.2. If you\u2019re using it with Node-sass, you should be able to npm install --save-dev thoughtbot/bourbon#v3.2.1\n. I believe there are more details here https://github.com/hcatlin/libsass/issues/151\n. I believe this is a duplicate of https://github.com/sass/libsass/issues/261. Unfortunately no one seems to have figured out a way to get this read as regular CSS to compile successfully in the meantime.\n. Thank you! :balloon: :confetti_ball: :tada: \n. ",
    "nuclearsandwich": "It happens to the best of us. :)\n. ",
    "larsimmisch": "You're welcome.\nDo have a look at 8b24df9f8e9f540b0bb49c7d884914d8f6ae1828. That one is really a potential problem.\n. Also, may I suggest that the C-API is changed?\nI'd do something like:\n```\nstruct sass_context {\n  const char output_string;\n  int error_status;\n  const char error_message;\n};\n// options may be NULL\nint sass_compile(const char input, struct sass_context ctx, struct sass_options *options);\n// sass_compile_file never sets the output_string in sass_context and writes to output instead\nint sass_compile_file(FILE input, FILE output, struct sass_context ctx, struct sass_options options);\n```\nI would omit sass_compile_folder. It's a friendly idea, but if there is an error, there is no way to signal where the error occurs.\nAlso, for the record: Yes, this isn't pretty, even uglier than the current version. But sass_context is only written to in this draft, which avoids a bit of confusion.\nI think that sass_compile_file that outputs to a file would be nice, because on more memory constrained sustem (think Raspberry P)i, the result of he compilation might not fit into memory.\nIf you are interested, I can work on a patch.\n. No, I just helped out with the Python wrappers.\nI'll be offline for a week now, but when I'm back, I'll try to come up with a patch and look at what the SassJS guys are up to. \n. ",
    "andrew": "For the moment I'm going to vender libsass into node-sass and compile it all on install as libsass as no other dependencies.\n. Great job! :+1: \n. Ah yes, that fixed building sassc for me, but still having the same issue with node-sass, I'll edit the issue to avoid confusion\n. Still getting the same error after updating the submodule and rebuilding\n. Thanks for your help @akhleung \n. @LaurentGoderre Yup, now you've mentioned me I'll get any further email updates.\n. @am11 it's a libsass issue I believe.\n. I may be missing something here, but I'm still getting the same build error from abs that was considered ambiguous on lucid-x64: https://gist.github.com/andrew/30eaff7e65e5e4fd0f65\n../libsass/utf8_string.cpp: In function 'size_t Sass::UTF_8::normalize_index(int, size_t)':\n../libsass/utf8_string.cpp:111: error: call of overloaded 'abs(int&)' is ambiguous\n/usr/include/c++/4.4/cmath:94: note: candidates are: double std::abs(double)\n/usr/include/c++/4.4/cmath:98: note:                 float std::abs(float)\n/usr/include/c++/4.4/cmath:102: note:                 long double std::abs(long double)\nmake: *** [Release/obj.target/binding/libsass/utf8_string.o] Error 1\nUpgrading glibc would fix it, but then the binary won't work on heroku, which uses glibc-2.11\nAny suggestions?\n. @pornel yeah I just tried that out and it builds cleanly for me\n. @am11 yeah I think your right\n. @xzyfer I added you and @mgreter to this team: https://github.com/orgs/sass/teams/node-sass-owners, hopefully that will sort it, you should get an email about it.\n. ",
    "craigbarnes": "\nI've created a homebrew formula so we can simply run brew install libsass but the Makefile doesn't have an install command.\n\nI added make install in a7ddccf. It should work on at least Linux and OS X.\n\nThat's the main method I was assuming for integration! So small anyway.\n\nBundling libraries and static linking is a bit of a show stopper for packaging for Linux distros.\n. I'm just working on sassc flag handling now. Is it ok to use getopt or does it need to be Windows friendly?\n. The UTF-8 BOM is 0xEF 0xBB 0xBF. No other BOM begins 0xEF, so a simple fix would be to check if byte 0 is 0xEF and if so, drop the first 3 bytes.\n. If you're using Visual Studio, I think you can set the encoding to UTF-8 without signature to save without a BOM.\n. > ... should be trivial ...\nFamous last words.\n. Works for me.\n. Closing this to rebase.\n. Just seen that it's mentioned in the readme. Guess I didn't look hard enough.\n. Does grunt-sass or node-sass use threads? The backtrace starts and ends with pthread calls but it's not clear where they're coming from. Also, in your node-sass issue you said it happens \"roughly once in every 10 runs\". That sounds consistent with a race condition to me.\nWhat does thread apply all backtrace give you?\n. This is working great. bootstrap-sass now mostly works if you comment out cases of issue #54 and all \\9 IE hacks.\n. Works great. Thanks!\n. See #78.\n. > We try and keep as much OS-specific stuff out of libsass as we can.\ngetenv is in C89.\n\nIs this not what the sassc -I (import) option does, or am I missing something?\n\nYes, of course, but environment variables aren't the same thing as arguments. Some programs take command-line arguments, some take config files, some take API arguments but none of those things are visible to libsass without being passed explicitly. The environment is to available to all linked libraries and sub-processes automatically.\nIn a way, SASS_PATH is part of a public API, if people are already using it in Makefiles and build systems.\n. > We want to work with environments without environment variables.\ngetenv is C89. Very few environments exist without environment variables.\n\nMany host applications would certainly not want their embedded library referencing env variables with it being aware of it.\n\nEvery process running on your system right now is referencing env variables. For example, libc uses LANG, LC_NUMERIC etc.\n. According to the CSS 2.1 grammar spec, literal, UTF-8 encoded characters (\"nonascii\") are valid in selectors too but that also causes an error in libsass:\n$ sassc <<< '.\u00e9motion {color: red}'\n:1: error: invalid top-level expression\nhttp://jsfiddle.net/XbGfh/\n. @jbussdieker \nThis is just an incremental fix. If you want to argue in favor of autotools, surely the Makefile should be removed, rather than left to bitrot?\n. I'm not so sure about the self-generating header declarations though. Some languages have FFI libraries that can parse header declarations but completely choke on non-trivial macros.\n. Macros aren't problematic per se, just the ones in public headers. The public headers are usually the only thing parsed by FFI libraries, binding generators, etc.\n. I haven't taken a proper look at the new API yet, but I just built lua-sass against this branch (still using the old API) and it builds and passes the tests fine.\n. Understood. My thought was that the wiki could be a little clearer, but thinking about it more, the sass_interface.h stuff is only relevant to a small number of authors of older bindings anyway.\nI just updated lua-sass to the new API (to fix craigbarnes/lua-sass#4).\n. The failed test seems to be caused by an unrelated change in the sass-spec repo.\n. > the ownership transfers to libsass\nlibsass currently doesn't seem to free source_string. Unless I'm missing something? \nOn a related note, running sassc via valgrind seems to show several memory leaks in the library.\n. The current contract of the API seems to be: \n- libsass reserves the right to mutate source_string (even though it actually doesn't). \n- libsass leaves it up to the user to guess whether or not to free source_string.\nIMHO, libsass should:\n- Promise to not mutate source_string by declaring it const, thereby allowing garbage-collected languages to pass a pointer to the GC'd heap instead of making a full copy.\n- Leave the client responsible for freeing/collecting the memory and consider Sass_Data_Context::source_string a \"borrowed\" pointer to it.\n- Mention ownership in the API docs, so that knowledge of library internals isn't required for correct usage.\n. ",
    "MrBenGriffin": "We also would like to see compressed!\n. Okay thanks for this - I will close the issue.\nI am hoping to see either the @include or other means of loading into a context soon!\n. This was an implementation issue. It seems to be working fine.\n. ",
    "paramdhal": "Not working for me. Getting an empty output\n. Using SassC \nas in\n./bin/sassc [input file]\n. Sorry if i being a bit dense - dont have much experience with C\nChanged the sassc.c file line 16 to     ctx->options.output_style = SASS_STYLE_COMPRESSED;\nThen ran make\nOutput is now empty\n. That did it! Thanks for the help...\nSeems to be working well\n. Will be testing tomorrow. Ill let you know if there any problems! \n. Thanks for this - very quick.\n. Thanks - working great...\n. ",
    "dplummer": "Sad. Understandable though. Thanks!\n. ",
    "chriseppstein": "Seems to me that whitespace can be supported by a preprocessing step that converts indents and outdents to curly braces and adds semicolons. shouldn't actually be that complicated.\n. Good point. Anyways, this can be done with a simplified parser, the differences are always the first token of the line. \n. The Sass Importer abstraction is a well defined API. It doesn't require the sass file to be on disk. It allows you to load Sass files from a database or over HTTP. It allows you to construct a sass file on the fly (Eg. compass sprites)\nThe resolution order is always relative to the current Sass file and then falling back to searching the load path from the beginning.\nIs this how this works? I'm having a hard time understanding this from the code and wiki.\n. https://github.com/sass/sass/blob/stable/lib/sass/importers/base.rb is the Ruby API.\n. I don't see how this scheme handles relative import resolution.\n. So if a file imports \"foo/bar/baz\" and then that file imports \"asdf\" then the file that should be imported is \"foo/bar/asdf\" if such a file exists otherwise a file \"asdf\" on the import path should be looked for. With importers the concept of a file is abstract, so there's a relative resolution that is passed the import statement as well as the current filename. filenames and import statements are not necessarily filesystem paths, they can be any string that the importer understands.\n. Yes, any parameter can have a default value that depends on the value of the previous arguments. Python does this too and it's really quite nice.\n. @akhleung The ruby implementation has a special case for filters, we basically parse it as a raw string and allow interpolation. Effectively, the user gets the unquote solution without needing to add unquote(\"...\")\nTest: https://github.com/nex3/sass/blob/563158bab3cf9463c458c87ee84a2d9507b7f1fd/test/sass/engine_test.rb#L1930-L1938\n. Seems like a change like this should originate in the ruby sass implementation. This sort of behavior should be expected by both implementations. @nex3 do you agree?\n. This issue does not belong to libsass. It is on me to make compass compatible with libsass, not the other way around. I might have specific features that I need from libsass in order to make this work, and I will work with the libsass team to get those implemented.\nSpecifically, I've extracted compass-core as a separate rubygem with the goal of making that part of compass compatible with libsass. What I need right now is sass 3.3 compatibility. Focus on making libsass compatible with sass and I will make compass work with it.\n. @frewsxcv I need libsass to support Sass 3.3 features. That's the biggest blocker.\n. FYI: https://github.com/Compass/compass/issues/1916\n. Are there docs on what is required of wrappers using libsass in order to create a compliant implementation?\n. Agree, this should be supported by the libsass frontends. We should have a\nguide of things that frontends are required to do in order to be a\ncompliant frontend.\n. @sorccu I'm curious what you mean by \"weird usage patterns that just happened to work with the official compiler\". I don't know of any unintended \"features\" in sass and it's likely that each of those things should be considered a bug in libsass.\n. @Nabellaleen I think you'll find there's more ruby in the \"scss parts\" than you might expect. That said, I will have time in the next few months to start working with @akhleung on making libsass and compass play nicely together.\n. @akhleung The data structure that is received for variable length arguments is not a list. It is an arg_list. The argument list object has a reference to any keyword arguments that are not bound to a named positional argument and when we add maps in 3.3 keywords($arglist) can be used to receive the keyword arguments and operate on them.\nI agree this is strange, but it was the best approach we could come up with at the time. Post-3.3 I am open to revisiting how this works and potentially deprecating the magical keywords approach in favor of something more obvious.\n. Ruby Sass preserves the whitespace around operators.\n. This is intentional behavior. Arguments to functions and mixins are defined left to right, so the lookup of $a find the global until the local is defined. As such, subsequent uses of $a in the arglist would refer to the local.\n``` scss\n$a: red;\n@mixin f($a: $a, $b: $a) { a: $a; b: $b;}\nno-arguments { @include f; }\none-argument { @include f(blue); }\ntwo-arguments { @include f(blue, black); }\n```\nproduces:\n``` css\nno-arguments {\n  a: red;\n  b: red; }\none-argument {\n  a: blue;\n  b: blue; }\ntwo-arguments {\n  a: blue;\n  b: black; }\n```\n. These are definitely bugs. I'm not sure why you say this isn't something people should do. They seem like legitimate use cases. In any respect, this is what you you'd expect by the definition of extend:\nA { @extend B; } means style all elements matching the complex selector A as if they matched the simple selector B.\n. This is explicitly not a feature of sass. So it should not be merged. \nOn Sep 3, 2013, at 5:48 AM, Hampton Catlin notifications@github.com wrote:\n\nHey, always up for a patch! ;) +1 \nThough, might have to be in the driver due to OS differences, etc. \nOn Monday, September 2, 2013, welch wrote: \n\n+1 \n\u2014 \nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/156#issuecomment-23687563 \n. \n\u2014\nReply to this email directly or view it on GitHub.\n. LibSass can and should implement a similar abstraction to Sass's importer system. On that framework, a globbing plugin can be created for libsass similar to sass-globbing.\n. #NotAllDevelopers\n. This feature has been fully debated and rejected as a Sass feature. At this\npoint, adding +1's is not going to change our mind. It adds only marginal\nbenefit and introduces large debugging costs for users who make incorrect\nassumptions about ordering or fail to understand the cascade's importance.\n\n\nOn Thu, Aug 14, 2014 at 12:47 PM, Marcel Greter notifications@github.com\nwrote:\n\n@renestalder https://github.com/renestalder The ordering of glob per se\nis IMHO not predictable\nhttp://stackoverflow.com/questions/8977441/does-readdir-guarantee-an-order.\nTherefore it may have been pure luck that you haven't run into any issues\n(or you made sure that the include order doesn't matter). It really depends\non the OS and probably the filesystem (reiserfs, ext3, ntfs, fat32, etc.).\nUnfortunately glob is not a c++ standard and implementations differ from\nsystem to system. So I can see why it would be a \"pain\" to add this to\nlibsass (since each OS may need a different/specific implementation to\nguarantee the same result). I guess ruby sass can hide behind the glob\nimplementation of ruby, which does all the normalization behind the scene\nto get the same results on windows, linux, mac, etc. (not even sure if ruby\nguarantees that).\nI would personally not vote against this feature, if implemented properly!\nI guess a c++ glob library that works consistently on all platforms\nhttp://stackoverflow.com/questions/5211752/implementing-a-platform-independent-glob\nmight help to get this implemented.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/156#issuecomment-52233775.\n. @mgreter The open issue is, IMO, is for libsass to create an importer abstraction like Ruby Sass has so that this can be a plugin.\n. This feature is not shipping with 3.3 now. Instead, a minor tweak to our handling of & in selectors will be made. See that issue for more details. \n\nChris Eppstein\n Sent via Intro for iPhone\n. The most details are here: https://gist.github.com/nex3/8050187\n. Does it make sense to have a 3.2 branch and a 3.3 branch and separate\nreleases for each? Then patches that land on 3.2 could get rolled into 3.3\nbut not the other way around.\n. CC: @nex3 @hcatlin @akhleung @ericam @snugug @bdkjones\n. @ericam @Snugug I think you can both help a lot with testing and sass-spec tools. No ruby or C/C++ knowledge should be needed for that once we have the infrastructure in place.\n. >  hard for me to decide what's a discrete feature, versus what's a fundamental property of the language\nThis is something I can help with :)\n\nSass is that, as a language, it doesn't seem to have a comprehensive or precise specification written up anywhere.\n\nA formal specification is a lot of work. @nex3 and I have talked about making one, but it's a ton of work and offers very little benefit compared to just collaborating with the few viable implementations. \n\nI definitely want to make some kind of comprehensive grid, but does Sass itself have such a thing? ... It would be very helpful if some kind of official feature table were available for recent Sass versions.\n\nNot in that form. The language reference does document every feature, but the edge cases are only covered in our tests. Turning this into a properly named list of features is a task that needs to happen as part of this effort. Fortunately, @nex3 is a nazi about the CHANGELOG, so it shouldn't be hard to create a 3.2 baseline and start creating a clear list of 3.3 features based on it.\n\nthis 3.3 feature (!global) is expected to be widespread enough such that I've been encouraged to implement it even before finishing the remaining 3.2 features. I'm open to suggestions as to how to reconcile these issues.\n\nI agree. This is a conundrum and it's actually what prompted me to start this thread. I don't know what the answer is. But whatever the answer that is decided, I think it should be communicated clearly so that users can know what to expect and how to manage their decision about when to upgrade. Personally, I think feature detection is the best way instead of trying to create perfect reproductions of specific releases. But I just don't know how feasible that is in a error-generating compiler (CSS itself is more forgiving by having well defined parse-error recovery rules as a future-proofing capability -- i'm told this makes a CSS Parser implementation much more complicated than it would be otherwise).\n\nsomething about getting Sass to output its AST?\n\nSo I tried to build something to do this, but it turned out to be much more complicated than I expected. So what I'm thinking now is to have a pure css parser that can simply read in any sass implementation output and normalize the output back out as a string using the same pretty-printer and doing whatever simple normalization steps we feel are necessary to avoid false negatives. E.g. sorting comma-delimited selectors.\nFYI: Release Velocity\nGoing forward ruby sass's release velocity is going to increase. We're going to start shipping every few months with fewer features in every release. I can ensure that we keep sass-spec up-to-date as we develop there, but it does create issues for libsass.\n. This isn't a bug. The nested output mode does this. The expanded output mode is what you want to use. \nHunt & pecked on my iPhone... Sorry if it's brief!\n\nOn Feb 12, 2014, at 5:56 AM, xvoidee notifications@github.com wrote:\nHi,\nFormat of output does not match to original.\nSASS file:\n$my-col: #806040;\n.window1 > .text1 {\ncolor: #00FF00;\nfont-size: 32px;\nbackground-color: $my-col;\n}\nOutput:\n.window1 > .text1 {\ncolor: #00FF00;\nfont-size: 32px;\nbackground-color: #806040; }\nExpected output:\n.window1 > .text1 {\ncolor: #00FF00;\nfont-size: 32px;\nbackground-color: #806040;\n}\nIdent is OK but bracket aren't - the should stay on new line.\nPlease fix it in output_nested.cpp, line 103 (add new line before closing bracket):\n..........\n--indentation;\nbuffer.erase(buffer.length()-1);\nif (ctx) ctx->source_map.remove_line();\nappend_to_buffer(\" \\n}\\n\");\n}\n..........\n\u2014\nReply to this email directly or view it on GitHub.\n. The previous compilers you used are not the reference implementation. Sass does not allow this.\n. For now. In a future release of sass, we will expose & to Sass script so that you can manipulate it arbitrarily.\n. This is not valid code in Ruby Sass as of 3.3.0.rc.3.\n. Neither of these functions should be in libsass. Sass doesn't provide them.\n. @sym3tri I'd gladly welcome patches to compass to make these functions work in libsass when compass is available. That's where they live and where they belong in libsass as well.\n. Sass cannot support arbitrary hacks like CSS can because Sass has a feature that it gives an error when syntax errors are encountered instead having error recovery and ignoring unknown syntax like CSS does.\n\nThat said, the Sass language does support a small subset of css hacks. https://github.com/sass/sass/blob/stable/test/sass/engine_test.rb#L863-L883 and if libsass doesn't support these, it should.\n. Sass 4.0 will have import-once as a language feature.\nBut if libsass is so fast, does this really even matter?\n. omg. random(10) * 1px this returns a number instead of a string.\n. No sass-based definition of image-url in compass since compass requires ruby, there's no point. Any given project can probably implement a trivial image-url() helper for that project.\n. @hcatlin There is. This will be one of them :)\nI wouldn't say this though:\n\nimage_path has been removed from libsass till it becomes part of the Sass spec.\n\nBecause it's not something that Sass itself would ever add. Maybe this:\n\nimage_path has been removed from libsass because it's not part of the Sass spec.\n. Right. In Sass 3.3 we added generic support for destructuring assignment in @each and plan to add it to the language at a broader level soon. So you can do\n\n@each $key, $value in $map because each iteration of $map is a pair.\nIn general Sass supports @each $arg1, $arg2, ..., $argN in $list-of-lists where each element in list of lists would bind the arguments in order and assign the rest as null. Since any single element is a list of 1, if one of the list elements is just a single value, then only $arg1 would be set.\n. Hmm. I think this is a bug in Ruby sass. Order is important for maps. \nHunt & pecked on my iPhone... Sorry if it's brief!\n\nOn Oct 18, 2014, at 1:08 AM, Eric M. Suzanne notifications@github.com wrote:\nRuby Sass doesn't compare the order of key/value pairs.\n// input\n$test: (\n  one: 1,\n  two: 2,\n);\n$expect: (\n  two: 2,\n  one: 1,\n);\n.test {\n  equal: $test == $expect;\n}\n// ruby output\n.test {\n  equal: true; }\n// libsass output\n.test {\n  equal: false; }\n\u2014\nReply to this email directly or view it on GitHub.\n. FYI: This was added in Sass 3.3.\n. This is a bug in libsass. Sass does have a feature planned to support cross media extends but it does not have the output you see here. The correct output requires Sass to keep the @media context when the extend is performed. The feature enhancement is being tracked here: https://github.com/sass/sass/issues/1050\n. @HugoGiraudel The information at http://sass-compatibility.github.io/#cross_media_extend is not accurate. LibSass doesn't \"get this right\". It gets it very wrong just like sass got it very wrong back when we allowed it.\n. The presentation implies there is a feature that libsass has and other implementations don't. It's impossible for Ruby sass 3.4 anything other than 100% because it is the reference implementation. \n\nHunt & pecked on my iPhone... Sorry if it's brief!\n\nOn Jan 12, 2015, at 3:01 PM, Hugo Giraudel notifications@github.com wrote:\nSass Compatibility has no \"get it right\" or \"get it wrong\". It has support or no support.\n\u2014\nReply to this email directly or view it on GitHub.\n. @HugoGiraudel Then the sense of the discrepency is wrong. The feature should be \"forbids @extend in @media\" and Sass should have it checked and libsass should not have it checked.\n. @HugoGiraudel Anyways, I really like the presentation of your compatibility guide. It would be awesome if we could data-drive it from sass-spec. are you open to working with us on that?\n. > It already is\n\nExcellent. Where is the mapping of tests to features?\n. > configurable to add additional extensions to the lookup\nPlease, make the default behavior for libsass match the default behavior for ruby sass. As you point out, it's trivial to add this capability to sass, but it creates an inconsistency in that the behavior of having an extension is different from when it is omitted. We don't like that kind of unpredictable behavior. If people opt-in, they will understand why the behavior is what it is. Because docs.\n. If you want to expose configuration that enables this, like sass does, I think that's ok. \n. Sourcemap links outside the \"served\" directory are not a problem when using chrome (not sure about firefox). When you set up a \"development workspace\" it lets you map a resource that is served over HTTP to a resource on disk, then relative paths in sourcemaps are resolved on the filesystem relative to the filesystem resource instead of the http resource.\n. I am opposed to the custom headers feature. One of the philosophies that Sass has is that we do not support things \"magically being available\". Only explicit declarations can and should bring in code dependencies. This is why there's no way to set a global variable from the sass command line despite numerous requests. Custom importers are a great way to bring in code that is constructed on the fly. That is how compass sprites worked. They imported the sprite images. IMO, we don't need a new abstraction here, the custom importer concept is enough.\n. Load paths is just a simple way to make a filesystem importer. In this way, importers are actually the first class citizens and it allows importers and filesystem paths to be intermixed. Furthermore, the resolution order should just be a list IMO. I don't understand why we need priority.\n. I get that custom functions violate the \"magically available\" principle that I mentioned. As such, I've been proposing that we move away from that pattern (https://github.com/sass/sass/issues/1608#issuecomment-72289559) so that even functions have to be loaded explicitly to be available in a sass file's compile.\nI get that you find it useful, but it's moving libsass in a direction that sass itself is moving away from. I don't understand why you think libsass needs \"custom mixins\". Mixins come from imports. If you want to provide a mixin, you either provide a sass file or you provide a custom importer. The reason we need custom functions is to do things that pure sass cannot do, like filesystem access, or integration with build systems, etc. These functions can return whatever information the mixins need.\n. @mgreter OK, I get that native plugins have this issue, but the priority value is really unintuitive to me. There's no agreement what any priority value means and any scheme that may arise would likely be better implemented in a less granular way. IMO, the priority from native plugins should be limited to HIGH and LOW where high priority plugins are guaranteed to be considered before the load path and low priority plugins are guaranteed to be considered after the load path. Then, any further resolution should belong to the implementer's API.\n. Clarification about Ruby Sass:\n\nIf all importers skip the given path Ruby Sass falls back to the Filesystem Importer.\n\nThis is not actually true. The load path is normalized so that it is an array of importers. Strings on the load path are used to construct a filesystem importer as the root directory. The only fallback behavior is that there's a default load path array if not provided. The :filesystem_importer option exists to allow a user to provide a different class than the Sass default importer.\n\nAn @import can only return only a single Engine. However since an Engine contains a Sass string, that string can be the concatenated results of many files i.e. sass-globbing\n\nActually, the way sass globbing works is by returning a file that is just a bunch of import statements.\nThe tricky thing that we have in ruby sass is the ability to tap into all instances of importers by way of ruby's class callbacks. This is how I was able to implement import-once that applies to all importers. since importers do not chain themselves in ruby. As such, it may make sense to have importers accept a continuation function that they can call when they need to delegate the lookup to the next importer.\n. # Relative resolution\nSass has the semantics of importing that any import statement is first interpreted relative to the current file. This makes files very portable even across different importers. For instance you can write and test a bunch of Sass files locally but then consume them over http because the imports themselves are local to the current file (This semantic is similar to how urls on the web works).\nMaybe I'm missing it, but I don't see how relative importing is working in libsass.\nIn ruby sass we know which importer instance was used to import each file and we ask that importer to resolve any imports relative to it first. failing that, the normal importer resolution algorithm kicks in.\n. @drewwells What I mean is that an importer can be made to import over HTTP. The file doing the importing from my local project may have an import statement like @import \"bootstrap.com/bootstrap\";\nThe sass file that is returned from that URL might then have an import statement like @import \"config\";. This import statement must necessarily resolve to \"bootstrap.com/config\"; but only the importer that understands http semantics can know how to properly resolve that relative import.\n. @mgreter the main difference I see is that Sass guarantees that relative resolution happens first. This is really important. Because the file on that webserver should resolve it's local file before some file \"config.scss\" on my local filesystem, even if my local filesystem has a higher precendence in the resolved list of importers.\n. @mgreter I feel like you're missing my point here. Did you read the part where I explained how relative resolution precedes the normal lookup logic? This isn't a matter of \"giving the importer enough priority\". A low priority importer takes precedence over a high one for the relative resolution phase. \n. Related: https://github.com/sass/libsass/pull/1227\n. damn you're fast.\n. @mgreter Right. As you can see in the source code: https://github.com/sass/libsass/blob/master/sass_values.cpp#L39-L42\nA string only has a value. So quoted strings include the quotes in the value. But since the semantics of Sass are that strings are equal regardless of whether they are using single, double, or no quotes. As such, the value object should not include the quotes in the value of the object. This will prevent native function code interacting with the sass values from having to remember to disregard the quotes in equality checks, hash values, etc.\n. > So IMO it's correct for sass_values to not be unquoted by default.\nNo, this is wrong. The value of Sass string should have the same equality semantics as the string has in sass itself. Without this, client code will consistently break expected semantics by accidentally considering the quotes as part of the value of the string instead of an aspect of how it is output into the css file.\n\nand I don't want it to unquote the value everytime I do this\n\nAgree. The client code should not include the quotes in the value set into the object.\nIt's not hard to do the unquote operation. It's hard to know you should. It's easy to forget and break sass's semantics.\n. :+1: \n. Ok. It turns out I was mistaken about what was happening here. The quotes from the sass value are indeed stripped off -- this is a good thing. But this API is definitely broken.\nUsing node-sass I wrote a test case like this:\njs\n  it(\"should not change whether strings passed through are quoted\", function (done) {\n    var input = \"#test1 { uquoted: testing(foo); }\\n\" +\n                \"#test2 { squoted: testing('bar'); }\\n\" +\n                '#test3 { dquoted: testing(\"baz\"); }\\n';\n    var options = {\n      data: input,\n      functions: {\n        \"testing($value)\": function(value) {\n          console.log(value.getValue());\n          return value;\n        }\n      }\n    };\n    var expected = \"#test1 { uquoted: foo; }\\n\" +\n                   \"#test2 { squoted: 'bar'; }\\n\" +\n                   '#test3 { dquoted: \"baz\"; }\\n';\n    testutils.assertCompiles(options, expected, done);\n  });\nI get the following failure:\n```\nActual:\ntest1 { uquoted: foo; }\ntest2 { squoted: bar; }\ntest3 { dquoted: baz; }\nExpected:\ntest1 { uquoted: foo; }\ntest2 { squoted: 'bar'; }\ntest3 { dquoted: \"baz\"; }\n```\nAnd the console prints:\nfoo\nbar\nbaz\nSo yes, the quotes are not passed from Sass to the host language. But as @mgreter said, there's no way to return a quoted string back unless you put quotes in the value itself. Furthermore, passing a value through should not change it like it does here.\n. Agree. This fixes my issues. Thank you @mgreter :heart:!\n. I read the API changes, I'm not a direct consumer but it seems good to me.\nhttps://github.com/sass/sass/blob/stable/lib/sass/script/value/helpers.rb is the nicest ruby sass API I could devise and it also provides different creation methods for unquoted and quoted strings.\n. @mgreter If you meant:\n```\nExpected:\ntest1 { uquoted: foo; }\ntest2 { squoted: \"bar\"; }\ntest3 { dquoted: \"baz\"; }\n```\nThen we agree.\n. Sass only unquotes strings when they are output via interpolation. Our policy has been to let the author decide when a string is quoted or not, any other behavior requires Sass to have intimate knowledge of what the css context is and that is a direction we actively avoid for future compatibility reasons.\n\nAs I said, to get this behaviour would make it much more complex for me and perl-libsass, since I would need to attach the is_quoted flag internally to native perl strings, which adds a lot of complexity.\n\nYou can make things as simple as they are, but not more simple. This is essential complexity.\n\nWe also have to choose when to retain this flag i.e. on concatenation.\n\nSass's handling of string concatenation (the + operator) keeps the quoted state of the string on the left side.\n\nWe would also need to upgrade the flag, once we introduce spaces etc.\n\nNot even Sass does this.\n$ echo \"div{ something: a + 'b c'; }\" | scss\ndiv {\n  something: ab c; }\n\nThat's why an automatic way sound most appealing to me if the result is still valid css.\n\nI get why you think it's appealing, but in my experience dumb code with obvious rules is easier for users to work with than smart code when the smart code cannot be guaranteed to be correct. \n. @mgreter They do expose a js class for each type but those classes are written in c++ because it allows them to keep a hidden reference to the libsass struct and to use it as a backing store for the objects' values. It's actually how JS is meant to be used in an embedded way like this.\n. @hcatlin units? you lost me.\n. @mgreter The semantics of the strings are different, they cannot be the same type. Specifically, the equality semantics of quoted vs. unquoted strings. Also it would be very strange API to sometimes pass a native type and sometimes pass a wrapper type. It's much more consistent to always pass a sass value that can be unwrapped. This would allow us to implement common methods that are part of a Sass Value contract API.\n. Sass units are a pain in the ass. The ruby API exposes two arrays numerator_units and denominator_units for each number.\nI wrote a unit parser to decompose a unit string (same form as above) into two arrays. It's part of the value helpers api.\nhttps://github.com/sass/sass/blob/stable/lib/sass/script/value/helpers.rb\n. I don't think so. It seemed that complex units worked fine except when my custom function was involved. \nHunt & pecked on my iPhone... Sorry if it's brief!\n\nOn Apr 29, 2015, at 5:48 PM, Marcel Greter notifications@github.com wrote:\nProbably related #1049 ... to funny, your issue is 1149 :)\n\u2014\nReply to this email directly or view it on GitHub.\n. CSS cheats by using property specific parsing rules so they can disambiguate when a color is a color etc. SassScript has to work the same everywhere in a document so we basically have to choose to treat color identifiers as colors everywhere.\n. Here's a couple of use cases:\n1. sass-based configuration. A sass file should be able to be used to configure a project instead of using an external configuration file. This can only work if you have some concept of where that sass configuration file is on the filesystem.\n2. API scoping. In eyeglass, a sass file that is in an NPM module can access the sass files and assets for only those modules for which is has a direct dependency. We are able to control that access for importing because we are given the current sass file that is doing the import, but when functions try to access an asset, I cannot tell whether the asset is accessible to the current sass file unless I know what npm module it is in.\n. inspect should always return a string.\n. :+1: \n. More fun stuff about @debug:\n\nscss\n$m: (foo: 1px, null: 2px, false: 3px, true: 4px);\n@debug $m;\n@debug map-get($m, null);\n@debug map-get($m, false);\n@debug null;\nprints out:\nstdin:1: DEBUG: (foo: 1px, true: 4px)\nstdin:2: DEBUG: 2px\nstdin:3: DEBUG:\nstdin:4: DEBUG:\nShould print out:\nLine 2 DEBUG: (foo: 1px, null: 2px, false: 3px, true: 4px)\nLine 3 DEBUG: 2px\nLine 4 DEBUG: 3px\nLine 5 DEBUG: null\n. I'd really like to make sass-spec agnostic of non-semantic differences like this. The order doesn't matter and I don't think libsass should work very hard to achieve that level of consistency when there are bigger fish to fry.\n. Interpolation always returns a string. Sass does not have type coercion. So you'll need to avoid using interpolation for arguments expecting a number. Libsass should throw an error. \n. > Ok I had a look at the Ruby source. They explicitly unquote the results of interpolations in ruleset selectors.\nIt's more general than that. Interpolation always unquotes any quoted string regardless of context.\n. @mgreter I think maybe you misunderstand the unquote function. A string has a value and a quoted state. Unquoting a string changes the quoted state to false -- it never changes the value of the string itself. Escaped quotes are part of the string's value so they would not be unquoted by the unquote operation no matter how many times you pass the output of unquote back into unquote.\n. I'm fairly certain that all interpolation removes quotes. But we can double check with @nex3.\n. @mgreter I dunno. I saw a patch that had specific handling for selectors. It may be that you now have point fixes in all the right places and can just refactor that now.\nAlso: There's a change coming to interpolation in Sass 4.0 so it may not be worth it to refactor something that's about to change considerably. See https://github.com/sass/sass/issues/1778 for more info.\n. That's a ruby bug, not a high priority one, but definitely a bug. \n. @extend is applied after nesting is resolved. &baz creates a new class built from the classname represented by & so @extend doesn't match against it. If the parent selector is a placeholder, it creates a new placeholder that never gets extended and that is then dropped from the output.\nDoes this resolve the confusion?\n. > @chriseppstein any suggestions if this should be extendable at all or if it should error?\nIt should error. But the reason it is erroring is that you have two element selectors and so there is no way to extend one element by another because every selector can match at most one element name.\n\nI think I get it now, so %foo is actually a selector in ruby sass.\n\nBingo. Before we called them placeholders we called them \"silent classes\".\nWhen in doubt, replace the % with a . because placeholders have the exact semantics as class names except selectors containing a placeholder are stripped from the final output. \n\nThis will probably mean a complete refactor of how we do @extend.\n\nI don't see why. Just remove any special handling of placeholder selectors. Treat them exactly like class names. After extend, you remove all selectors that have a placeholder as any selector component.\n\nIs this the expected behavior? Still not very intuitive IMHO!\n\nYes, this is expected. If we did the operation in the order you suggest, then @extend would not be stable against refactoring the selector hierarchy. This should never happen, nesting is just another way of forming CSS selectors and should never change the semantics of those final selectors. E.g. if someone has written .foobar { ... } .foobaz { ... } and later refactors this to .foo { &bar {...} &baz {...}} why should these suddenly become extended by some .something { @extend .foo}? In both cases, there is not any such selector .foo. Now, I get that people who are writing with BEM methodology do see something special about that parent selector in that it forms a namespace for them. Since they conceptualize it as \"special\" they expect Sass to see it as special as well, but Sass is a general authoring tool and we cannot assume that the user is writing with BEM or some other namespacing methodology.\nYou're not the only one who is confused by this. A lot of people have a hard time understanding @extend. They think it is a kind of \"search and replace\" but it's not. Extend has very specific meaning. A { @extend B; } says \"style everything matching selector A as if it matched selector B\".\n. This should be an error unless the @extend directive contains the !optional modifier.\n. The logic for whether to give an error from @extend is the following: \nhttps://github.com/sass/sass/blob/master/lib/sass/tree/visitors/extend.rb#L49-L66\n. Ruby Sass added this feature before sourcemaps existed. Now that we have sourcemaps, they are a much better solution providing even more detail. Is there a reason you prefer line comments to sourcemaps?\n. @mgreter the example above errors in ruby sass but succeeds in libsass. The expected result is an error message is something like:\nError: You may not @extend an outer selector from within @media.\n       You may only @extend selectors within the same directive.\n       From \"@extend %btnBase\" on line 13.\n        on line 1 of standard input\n. Sass maps are ordered. As such, the pairs within them have an intrinsic index based on insertion order. \n. *:before and :before are semantically identical. There is no bug here.\n. Merged as 10d82926d3683752bd64705ab93b4a812a2c7747\n. There was a bug in the new spec runner that caused tests that needed to be \"cleaned\" to not be. That and some tests with a todo in their name weren't marked as pending yet in the metadata. Once those were sorted out, all the specs appear to be passing now.\n. merged as 10d82926d3683752bd64705ab93b4a812a2c7747\n. > I guess this is hardcoded now and we figure out later when and how we gonna update/use it?\nI mean somewhere you have to write down \"this is the version we're implementing\". I assume it will be updated when development branch for 3.5 starts. I don't see how it can be data-driven or what value that would provide. Am I understanding correctly?\n\nIt probably should also be documented\n\nI will look around and add docs where it seems warranted.\n. @mgreter I'm no expert in the extend code. But it seems like this is the reason:\nhttps://github.com/sass/sass/blob/stable/lib/sass/selector/simple_sequence.rb#L193-L195\nThis is a non-semantic difference in a corner case where the @extend is pointless (it's extending itself). I wouldn't even bother to write a test for this. Just whistle and walk away.\n. > implementation is a one to one conversion from ruby sass code\nIf it's a 1-1 impl why is it hard to trip it up? Maybe we've been fixing bugs since then and the specs haven't caught up. If you can tell me when the port was done, I can try to write specs for changes to the extend algorithm since that point.\n. a lot of the Sass code was written when @nex3 and I were quite naive regarding the official CSS spec. As time has passed we've preferred to match the CSS naming as closely as possible and as @mgreter mentioned it's the preferred naming in the dart impl. I think the css names are more correct than what we use in ruby. honestly wouldn't get too hung up on matching the ruby impl names.\n. It would be good to figure out how we're going to land Sass 3.5 features into libsass. Is there going to be a 3.5 branch? Does libsass want to do trunk development with compile time flags? or maybe even a runtime flag? \n. This seems like a good cleanup. The memory usage at linkedin is very high and it would be great to see an improvment in this area. It also seems like this infrastructure will be pretty critical to making first-class functions from sass 3.4 work well. . @mgreter yes, I don't think sass should have any specific handling for @value like I see in https://github.com/sass/libsass/pull/2602/files#diff-950f6260135ab0fef6f27e24ebd6e863R605\nWhen Sass encounters an at-rule it doesn't know, it should parse the remainder of the at-rule to the first ; or { (ignoring leading or trailing whitespace and accounting for matching quotes and parenthesis) capturing that argument as a string and allowing only for interpolation via #{} to inject SassScript values.\nhttps://github.com/sass/sass/blob/stable/lib/sass/scss/parser.rb#L215-L217. Re-opening so this doesn't get lost, but maybe better to close this and file a new issue?. This should be an error, per the reference implementation:\nError: Base-level rules cannot contain the parent-selector-referencing character '&'.\n        on line 3 of standard input, in `mixin'\n        from line 10 of standard input. >  Disallowing imports of CSS files altogether seems overly-restrictive, since SASS is a superset of CSS and a SASS parser should be able to handle all CSS input without problems.\n@tcchau We agree. The superset feature of Sass is exactly why this is a problem. The early decision to change the behavior of a CSS feature (@import) broke the superset guarantee by creating an alternate implementation. Right now, there's legal CSS that works differently when used with Sass than when used as CSS. Even if that's what you want when you use Sass, it violates the superset contract. . This is probably a bug for sublime then. We need a way to reproduce any issue without sublime being involved in the steps to reproduce it. Please work with them to file a support issue against libSass or node-sass as appropriate once the root cause is understood.. ",
    "ianstormtaylor": "+1 on the .sass syntax :)\n. ",
    "goodtimeaj": "I think this may be a major factor in the adoption of libsass by non-Ruby shops, and libsass is obviously the future of Sass.\n. I'll second that one. This is one of the issues in getting https://github.com/jlong/sass-twitter-bootstrap to work with libsass out of the box. I had to replace all @include box-shadow and @include transition having multiple arguments into multiple includes.\n. The other popular port is https://github.com/thomas-mcdonald/bootstrap-sass but I think they have a lot of the same issues/content. You might want to check that out. I think that being able to use these out of the box with libsass could really fuel interest in libsass.\n. Craig - note that you can get these to work by surrounding them with unquote such as unquote(\"hack \\9\")\n. ",
    "rockwood": "+1 Our shop writes entirely in .sass format. Let me know if we can help implement this.\n. ",
    "saschamt": "+1 for this :+1: \nThe Sass syntax is great for lots of frontend-only work.\n. ",
    "dbrgn": "Support for .sass would be great.\n. ",
    "aexmachina": "+1\n. Yeah big +1 for me. I'd be happy to dive into this, anyone else interested in getting involved? I don't have a lot of time and don't really know C. Is it possible to do this using Mozilla's source map module (written in JS)?\n. Yep, I'd be willing to contribute and help promote the campaign.\n. Any progress on this issue?\n. I'd just like to add a big +1 to this issue :+1: \n. Is there any update on this issue? What can people do to help move this along?\n. Thanks for the detailed response. I really hope that you can get some help\nfrom the maintainers because the current solution is really flawed. Keep up\nthe good work @am11!\n. Yeah @svnieuw, we'd all really appreciate your help getting source maps right!\n. Wishing you all the best of luck @svnieuw :)\n. I've added the source files and Travis is happy. There's people asking for this, any chance we can move this forward?\n. Sure @akhleung, no problem. Look forward to hearing from you.\n. I'd love to help here but I've got a few things that prevent me from doing so:\n1. I know zero about C++ and wouldn't have any idea how to write tests for this\n2. I've changed my mind about how to handle this, and this is no longer a solution that I'd use\n3. I won't be able to work on this until after November\nThese are pretty simple changes, is there anybody else who can put together some tests so this can be merged in?\n. Thanks @joeyadams, I've removed the extra square brackets. How can I resolve the memory leak? Forgive my ignorance but I know basically zero about C :)\n. Thanks @joeyadams, I've made those changes. @hcatlin I've rebased now as well. Pretty sure the merge is correct, but I suggest this needs tests and I'm not the person to write them.\n. Thanks @mgreter, really glad that someone who knows C++ is looking at this :)\n. The line comments are still included for me when source_comments is set to map.\nI'm using node-sass via broccoli-sass, and the options that are being passed to node-sass are:\n{ file: '/Users/simonwade/dev/Workspace/franq/dashboard/tmp/tree_merger-tmp_dest_dir-bkPrg5Jr.tmp//app/styles/app.scss',\n  includePaths:\n   [ '/Users/simonwade/dev/Workspace/franq/dashboard/tmp/tree_merger-tmp_dest_dir-bkPrg5Jr.tmp',\n     'bower_components/foundation/scss',\n     'bower_components/foundation-icon-fonts' ],\n  outFile: '/Users/simonwade/dev/Workspace/franq/dashboard/tmp/sass_compiler-tmp_cache_dir-RhluQU2W.tmp/assets/dashboard.css',\n  success: [Function],\n  error: [Function],\n  imagePath: undefined,\n  outputStyle: undefined,\n  sourceComments: 'map',\n  sourceMap: 'dashboard.css.map',\n  precision: undefined }\n. I've created an issue for appending to a provided source map and a summary of the status of source maps in broccoli-sass, which may be of interest to this discussion.\n. Are we currently using this library in libsass? Also, be aware that I know basically nothing about C++ :smile: (even though I did write the initial sourcesContent implementation for libsass!).\n- What do we use to create the source maps in libsass?\n- Would it be possible to simply parse a provided source map into our in-memory source map and then add to it from there?\n. Okay great, thanks. Your guess is exactly right, so it looks like remap is what we want to use. I'm not a C++ developer, so it will be difficult for me to do this myself :(\nIf I understand correctly:\n- We could use sourcemap.cpp to create two SrcMap instances - one from the preprocessor source map and the one for the libsass source map\n- Use the remap function to combine the two source maps into one\nIt looks to me that the natural place for this to live would be libsass itself. Ideally I'd like to be able to provide a source map to libsass and have it perform this remap on the source map that it produces. Do you agree? How would this fit into the roadmap? What can I do to help?\n. Awesome, thanks for that. Totally understand that you've got higher priorities, but definitely looking forward to seeing this when it arrives.\n. I can confirm that specifying sourceMapEmbed: true does not produce an embedded source map unless sourceMap: true is also specified. Is this expected behaviour or should this be fixed?\n. Can I get clarification on my earlier question please: is it expected that specifying sourceMapEmbed: true does not produce an embedded source map unless sourceMap: true is also specified? I think this is unexpected and should be fixed, but let me know if this is the desired behaviour so consumers can handle it.\n. IMHO the correct solution to this problem is #668, in which libsass appends to a provided source map. This allows broccoli-sass to provide a source map that maps back to the source files, and libsass adds the mappings for the SASS to CSS transformation. This also has the added benefit of solving the write problem as well.\n. ",
    "askucher": "+1\n. I have a hack script which converts sass syntax into scss by adding \"{}\" .\ndo you need it?\nOn Mon, Dec 16, 2013 at 5:16 PM, Ilan Frumer notifications@github.comwrote:\n\n+1\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/16#issuecomment-30667969\n.\n. I have implemented script which converts indented script to braces. It works for me. You can get it here. And by the way you can propose your variant. \n\nhttp://develton.com/#/research/indent_to_braces_function\n. @lozandier Actually no because this script is hack. I imagined that indented syntax easily can be converted into braces syntax by adding braces in correct places.\nBut I can implement replacing of (=) and (+) into sass include and mixin if I get 5 votes. \n. @ArnaudWopata great job. Your plugin can open new way of improvement. \n. ",
    "chrisspiegl": "+1 Also I'd be happy to pay a little if there would be a kick-starter like thing.\n. +1 Also I'd be happy to pay a little if there would be a kick-starter like thing.\n. +1\n. ",
    "justnorris": "+1, and +1 for the Kickstarter like thing too. \n. I see people +1'ing this thing. +1s hold little weight. Pitch in to the bounty!\nIf all the +1's contributed 10$ there would be a 250$+ bounty now...\n. +1 for this to be added.\nI don't care if it's \"not pure sass\", if it makes Sass better, why not ?\nIf this isn't merged, does libsass offer the same way of extending Sass like \"Ruby Sass\" (gems) does ? If not, then libsass isn't pure Sass, is it ?\n. Yeah, I misunderstood at the beginning the \"always up for a patch\". Still it would be nice to see this implemented.\n. ",
    "usrix": "+1 for .sass\n. ",
    "EvanPurkhiser": ":+1: for .sass. Definitely prefer the meaningful whitespace over curly braces for writing style sheets.\n. ",
    "IlanFrumer": "+1\n. Yes, Thanks a lot.\nI never thought I'll see those ugly braces again.\n. ",
    "andrewmartin": ":thumbsup: for .sass. Huge fan of writing less code, and it always is easier to read and understand. The shorthand syntax for mixins (= or +) is also super nice.\n. Just for everyone on this thread (including me), I think they've found this cannot be done without some large efforts, something about the way the parsing library works.\nAlso, the maintainer of libsass, @hcatlin himself said: \"We have no plans to support meaningful white space with libsass.\u201d\nTrust me, I want it just as much as you guys!\n. Just thought I'd ask\u2013\u2013I had seen this a little while ago. Is this issue fully resolved and working out of curiosity after the pull request 119?\n. Just realized I put this in the wrong repo. My mistake!\n. ",
    "janhalfar": "+1\n. ",
    "mgreter": "I implemented a perl script to convert indented sass syntax to scss:\nhttps://github.com/mgreter/OCBNET-CSS3/blob/master/bin/sass2scss\nUnfortunately the specification given at http://sass-lang.com/documentation/file.INDENTED_SYNTAX.html is far from complete. I also haven't tried it on any real world examples. Can comments be indented? What to do when a line after a trailing comma has less indentation than the one before? I tried to do good guesses in those cases. Well formated files should convert fine. It's also unclear how whitespace should be interpreted in case of tabs and spaces. My implementation checks the number of chars for indetations. Maybe it's usefull for some people!\nBest regards\nMarcel Greter\n. IMO it has been stated multiple times, that it should not be too hard to convert sass syntax to scss syntax. A few people (including me) already showed some approaches to convert sass to scss in different languages. I did a converter in perl, which I knew would not be too hard to port to c++. Took me a few hours to actually port my perl script, as my c++ is extremely rusty. It probably is horribly broken, but it could be a base to get this working with libsass.\nhttps://github.com/mgreter/sass2scss/blob/master/sass2scss.cpp\n@akhleung, @hcatlin: Do you think this would be too much effort, once we have a working sass2scss converter in c++? My code currently wants to be fed line by line. So calling the converter step shouldn't be too hard to implement for either a filehandle or a given string? I guess libsass loads the whole file into memory anyway!?\n. I've refactored my code a little bit to expose: string sass2scss (string sass, int pretty)\nAs I said my c++ is very rusty, so I'm not aware if the changes now make it re-entrant or not. But I guess it should be easy to fix that for someone that knows what he is doing ;)\n. I did some more refactoring. My C++ is really very bad and I don't feel comfortable to push anything in this perspective without any proper review. But from this point on, given that actual converting works correctly, one should be able to use this function to convert sass to scss.\nhttps://github.com/mgreter/sass2scss/blob/master/sass2scss.h\nhttps://github.com/mgreter/sass2scss/blob/master/sass2scss.cpp\nMaybe someone from this thread could verify if my implementation works correctly? I have created a repository which also contains a basic commandline tool:\nhttps://github.com/mgreter/sass2scss\n. Thxs @kennethormandy, added the tests from https://github.com/ArnaudRinquin/sass2scss also to https://github.com/mgreter/CSS-Sass and they pass. Also added a few more tests there.\n. The code at https://github.com/mgreter/sass2scss is backed and tested by https://github.com/mgreter/CSS-Sass (https://github.com/mgreter/CSS-Sass/blob/master/t/05_sass2scss.t). If you would like to contribute more test cases, take a look at https://github.com/mgreter/CSS-Sass/tree/master/t/inc. I guess if we can show that the conversion works correctly, this might get integrated at some point. To run the test suite: git clone && git submodule init && git submodule update && perl Build.PL && ./Build test\n. @kennethormandy To be honest, I don't think I can/will do that. My knowledge in this area is very limited and I'm not even sure if this is feasible in a c++/c/makefile environment (would probably add a lot more code than there currently is). If anyone knows how to do it, so it will still pass on linux and windows, please open a pull request. IMO it's ok to test the c++/c code via perl Unit Tests. If they pass, the code behind behaves correctly. And it's actually not very hard to run the perl test suite.\n. I've added a minimal implementation to my local libsass repository and updated my local perl implementation to test it (see project page for CSS::Sass for install instructions):\n```\npsass t\\inc\\sass\\pretty.sass\nouter inner {\n  color: red; }\n```\nThere are still a few more implications. Includes/Imports will not yet look for files with .sass extensions and it will only convert the contents if the filename ends with .sass. So passing a string will always mean scss (although one could use sass2scss directly in this case).\n. I've added an implementation with tests to my other pending pull request #181.\nTest can be run via CSS::Sass. (see readme and comment in #181).\n. @akhleung has merged my changes into the master branch. So libsass should now be able to handle (convert) indented sass files (and also support the previous c interface correctly). But until some of you people that gave a plus 1 take the effort to verifiy it via SassC or CSS::Sass, this Ticket will stay open. Btw, If I do get the bounty, I want to put it forward to https://github.com/hcatlin/libsass/issues/281.\nFor the record: my implementation will only handle indented sass files if the filename ends with .sass. There is no way, if you load the content yourself and pass it to libsass, to tell that libsass should treat it as indented syntax. But you can convert it via sass2scss yourself beforehand!\n. A source should always have a path/filename associated, since this is what we use to create source-map information. In regard to source-maps the whole thing becomes even more complex, as a preprocessor that alters the original data will make the mappings invalid.\nSo IMO a proper implementation should be able to return:\n- ['filename'] - libsass will load the file itself\n- ['filename', 'filesource'] - libsass will use the source\n- ['filename', 'filesource', 'srcmapdata'] - futureproof\nBeside that case, an implementer may also want to add multiple files from one import!\nSo IMO it should also be possible to return a array of the above entries:\n[\n  ['filename'],\n  ['filename', 'filesource'],\n  ['filename', 'filesource', 'srcmapdata']\n]\nIMO this would cover all possible use cases! Or did I miss anything?\nThe srcmapdata could be used to incorporate that information back into the the final source-map. This is not a very easy task, but I've done it already in perl (POC). I also started to add some pieces of it into a c++ library to handle source-maps.\n. I guess someone might want to implement a globbing importer.\nOr a preprocessor might load additional files (header/footer).\nSo just in case, I guess this way it feels more \"complete\".\n. IMO this is not implemented yet, so re-opening.\nAlready got it to the point where I can inject custom importers.\nNow I \"only\" need to parse the return result and implement it as described above!\n. I have a working implementation in my local branch!\nIt should implement what I propesed earlier in this thread.\nBut more testing is needed to verify that is works correctly!\n. To implement it someone definitely has to know C, there is no way around.\nBut I can give you a hint from my initial test how such a function would look like:\nNote that source will be owned and freed by sass, so make a copy if necessary!\nc\nstruct Sass_Import** sass_importer(const char* url, void* cookie)\n{\n  struct Sass_Import** includes = sass_make_import_list(1);\n  includes[0] = sass_make_import_entry(\"path\", strdup(\"source\"), 0);\n  return includes;\n}\nThis C function is then registered with the sass context:\nc\nsass_option_set_importer(sass_options, sass_make_importer(sass_importer, *importer_sv));\nNote that importer_sv can be a pointer to anything (you get it back on the call).\nI use it to store the perl function reference that should be invoked by sass_importer.\nBy the way, the most recent version you find in #635\n. Since commit https://github.com/mgreter/libsass/commit/df5b7c36773b5e3b3342b942867012f16b280bf6 this should be possible!\nThere is a wiki page with some API Documentation.\n. Unfortunately most information is scattered around in various issues. I'll try to explain the basics.\nYou get called for every import statement libsass sees (and get passed the url). If you return NULL, libsass should treat it as if the custom importer would not have existed. Alternatively you return a import_list back to libsass, which can have zero or more import_entry items. Each of this entry can have a file_name, a source_content and a source_map_content.\n1. If only the file_name is given, libsass will try to load it as any normal import statement (so I guess it will also use the same lookup methods as libsass normally does, like resolving partials etc.).\n2. If the content is also given, we will skip the loading from disk and use that data instead.\n3. The source_map is already there, as I'm planning to implement to map the resulting source map back (I already do this in another project and it works pretty well, but code needs to be ported from perl to C++, which I plan to do in a sperate project for now).\nC\nstruct Sass_Import** sass_importer(const char* url, void* cookie)\n{\n  struct Sass_Import** incs = sass_make_import_list(2);\n  incs[0] = sass_make_import_entry(\"virtual.scss\", strdup(source), 0);\n  incs[1] = sass_make_import_entry(\"include.scss\", 0, 0);\n  return incs;\n}\nI hope this clears it up a little? But full ACK that the documentation could still need a lot of more examples and more detailed information, but I hope it's still better than what we had before ;)\n. I don't think I understand the concerns correctly? If you pass back a relative path to libsass, it should take care of that, as it should still see that import within the context of the current file (or how is it different from normal relative import resolution libsass already does?). But maybe you mean that the implementor would have to know what the current file beeing processed is, so it can actually make the imports relative from there? Not sure if this is already possible ...\n. This might have something to do with the pull request https://github.com/hcatlin/libsass/pull/283. IMO this change makes the parser to recognise the BOM as alpha characters and therefore seeing it as an expression? But I guess libsass should just \"throw away\" the BOM once it has determined there is one (this is also very true for imports, as you do not want the BOM to be inserted in the source document). But from the age of this bug I would have guessed that this has already been solved?\n. This should be fixed with the merge of https://github.com/sass/libsass/pull/635!\nThere is a wiki page with some API Documentation.\n. I had to rename the free functions to delete to avoid name clashes with the old interface. To free the context you simply need to call sass_delete_file_context or sass_delete_data_context. You actually should never use both interfaces at the same time, since the data structures are not compatible.\n. I hope I'm allowed to mention https://github.com/mgreter/webmerge, which basically has all the features that @emagnier mentions (sprite sets, inline data urls, etc.). It's of course not a drop in replacement to Compass, but I guess the scss part of Compass could be adopted. If people are needing a framework that uses libsass, I would suggest to checkout webmerge. I hope @akhleung will excuse this advertisement! Keep up the great work with libsass (although my pull request regarding the c_interface is still open, but take your time to finsih the @extend feature)!\n. I've also added code coverage (coveralls.io) for CSS-Sass. With a few tweaks I was able to include the libsass sources in the code coverage and since I'm running the full spec test suite on it (plus some perl specific tests), I thought it might be usefull for some people.\nUnfortunately, coveralls.io does not seem to be able to display sources from submodules (which libsass is for CSS-Sass). I created a test branch with all the sources included and it does produce quite interesting results (i.e. libsass/functions.cpp).\n. I already have some IMO valid reports here: https://coveralls.io/jobs/2978650\nBut I only seem to be able to get valid results for gcc and autotools=no.\nNot sure why gcc and autotools=yes is not producing any results.\nWith clang I seem to get an expected error with gcov: version '402*', prefer '408*'.\nI guess that to parse clang coverage data one would need to use llvm-cov.\nThere also seems to be a known bug with coverage and clang 3.3.\nWill prepare a clean pr tomorrow to only upload the coverage report that is working.\n. Code coverage has been in place for some time now :)\n. I wonder why nobody hasn' yet mentioned sorting the list of files returned by glob, so you can predict the order. I always tend to prefix my css files with numbers anyway (%02d-file.css), so I get the correct order in any file listening. Was that already suggested for ruby sass? IMO that could be a usefull and well defined feature (at least for those who want to use it).\n. @nex3 I agree, although I think one could argue if that is really a big problem (I mean if you document it properly, this is the behaviour you would expect). As long as there is no undefined behaviour possible (which would be true if you would not sort it), I would personally not vote against this feature (even if I have no use case for it, as I really like to reference the needed files explicitly). But that's just my personal opinion :)\n. @renestalder The ordering of glob per se is IMHO not predictable. Therefore it may have been pure luck that you haven't run into any issues (or you made sure that the include order doesn't matter). It really depends on the OS and probably the filesystem (reiserfs, ext3, ntfs, fat32, etc.).\nUnfortunately glob is not a c++ standard and implementations differ from system to system. So I can see why it would be a \"pain\" to add this to libsass (since each OS may need a different/specific implementation to guarantee the same result). I guess ruby sass can hide behind the glob implementation of ruby, which does all the normalization behind the scene to get the same results on windows, linux, mac, etc. (not even sure if ruby guarantees that).\nI would personally not vote against this feature, if implemented properly! I guess a c++ glob library that works consistently on all platforms might help to get this implemented.\n. @chriseppstein maybe the feature label/tag should then be removed/changed to won't do ;)\n. @QuLogic I took your code and adapted it to the current build in #724!\nIf anything is missing, please comment on that PR and thanks for this PR!\n. Hello\nFirst I want to thank you all, specially akhleung for working hard on the @extend implementation, for the ongoing work. I see you already fixed the \"alpha opacity\" with a much shorter patch. I just would like to ask about some feedback about this pull request. As I see it was not yet closed, but did not get any comments at all.\nThere are a few bugs addressed in this pull request that havent yet been reported IMO. If you'd like I could also open issues for each one of these (like the \"expression\" bug, which is another IE specific thing)? We really would like to use libsass via our perl deployment!\nA quick feedback would be greatly appreciated!\nKind regards\nMarcel Greter\n. I rebased my patches to the latest libsass version here: https://github.com/mgreter/libsass/tree/rebase-02. Added another patch that enables the use of sourcemaps with data not directly loaded by libsass. I also updated my branch for the perl Module CSS::Sass to handle source maps.\n. I have pushed all my changes which I use for CSS::Sass. The latests commits should solve https://github.com/hcatlin/libsass/issues/16. Just be aware that this has not been tested in the wild at all!\nI've included a small testcase in CSS::Sass to test the imports of indented sass files:\nhttps://github.com/mgreter/CSS-Sass/blob/master/t/inc/sass/test-incs.sass\n https://github.com/mgreter/CSS-Sass/blob/master/t/inc/sass/themes/dark.sass\n https://github.com/mgreter/CSS-Sass/blob/master/t/inc/sass/test-inc-01.sass\n  https://github.com/mgreter/CSS-Sass/blob/master/t/inc/sass/test-inc-02.sass\n-> https://github.com/mgreter/CSS-Sass/blob/master/t/inc/scss/test-incs.scss\n. Would be really cool if this would be finally merged in! The pull request is now open for half a year and I tried to keep up with the master branch. I also added the official spec tests, which give the same results before and after adding my changes. It would allow us to release a new version for perl and I guess all others trying to use the c_interface will profit from it. I really would love to see it (at least partially) be merged in! Don't get me wrong, but It starts to feel a bit like working for the bin.\n. Thanks for the feedback! Otherwise I'll bump it up again in a few weeks :)\n. Woohoo! What great news and I really hope I didn't break anything for anyone else! If I did I already appologise for that. And please excuse my last \"rude\" comment about working for the bin, but yeah, I myself need some kick in the ass sometimes to get things done :)\nAnyway, IMO the only commit that I'm not too sure about is in https://github.com/hcatlin/libsass/commit/691e1012a3e7cdf4484f60bc3f5a01a9e6800ac6. I've just now added a comment for the specific change which I'm not sure if it will behave correctly (it does not seem to break with any existing test).\nThanks @akhleung for the merge!\n. This has been addressed in https://github.com/sass/libsass/commit/fc6d19799313ecd54a6e3001afb0c88db1411970\nUse free_sass_value to free any memory associated with a Sass_Value.\n. This was addressed in https://github.com/sass/libsass/pull/591\n. Hi there\nAs I was corious I tried your example with the latest version I got laying around (Perl CSS::Sass Module). I get exactly the same output as you posted for ruby sass. So this problem seems to be resolved already (at least for me). It looks like libsass does no longer try to resolve rgb colors to named color. I guess that your behaviour is introduced in context.cpp:setup_color_map (the last occurence in color_names will take precedence, which would be the grey variant).\nFor me libsass does not seem to try to replace rgb colors with named colors. This would be possible, but only for any color names other than LightGr[ea]y. One should resolve any other \"grey\" shade to \"gray\" spelling. But IE before 8 does not understand LightGray, as they unfortunately mispelled it to LightGrey. It seems to be save to use any other color in the \"gray\" spelling, but \"lightGray\" is not understood by IE browsers prior v8.\nBest regards\nMarcel Greter\n. The new API exposes all available information now!\nThis information is also available in json (whish by node sass)!\nSome messages still add a Backtrace which is no longer needed!\nThere is a wiki page with some API Documentation.\n. I'm closing this since it is IMO only about the error reporting?\nThis has been addressed by https://github.com/sass/libsass/commit/7a6a51625328404cd0409623e83dbfb72641f861\n. Added another commit to https://github.com/sass/libsass/pull/724 to include these changes!\n. As akhleung pointed out, the real difference begins when you interpret unicode stuff as strings (as asking for the length ... or differently put \"how many chars\"). I don't see why libsass would need to really understand utf8 (at this point). The main chars for css to care about are ;:{}. But a possible problem, that could arise, is if you have these asciii codes in the second/third/... byte of the uincode char. So yeah, it would be nice if libsass is unicode aware.\nThere are UTF-BOMS (pretty much a \"must\" for UTF-16, but \"annoying\" for UTF-8). Beside that, text editors do some sophisticated guessing in what encoding a text file was saved. I guess that unicode has its main use in :content pseudo selector; because that pretty much is the only reason to write css in \"unicode\".\nIf I'm not wrong that sign is a greek capital Phi (ce a6). As a workaround, you could replace that char with it's html entity \"&Phi;\".\nIMO Unicode handling is not something you implement yourself. Either your environment supports it or not. For C++ I guess it should be \"as easy\" as to change all CHAR types to WCHAR.\n. What I mean is: a colon has the hex value of \"3A\" (Ascii, or any other codepage, afaik). If I looked it up correctly, this char \"\u433a\" should have the hex value of \"43 3A\". As you see the octal value 3A is the same (for the second byte), and if the string handling is not aware of unicode, this could be falsely been interpreted as a colon.\n. @QuLogic: You are correct, sir! Seems like I still haven't figured out unicode completely! Although I guess it's still a valid point if we're talking UTF-16 :) Is wchar_t  portable?\n. I just tested the example the OP has posted.\nWhen saved in ANSI I got the same error \"error reading values after :\"\nWhen saved in UTF-8 I got another error \"error reading values after \u00d4\"\nWhen I put the unicode char into quotes ('\u29f2'), everything works as expected.\nI also tested them against ruby sass which only showed one difference in the second test, which would compile with ruby sass (unqoted identifier with unicode chars don't seem to work in libsass).\nSo for me it looks like UTF-8 is (pretty much) already working (and IMO this makes sense, as @QuLogic already pointed out). Maybe someone else can confirm that?\nMaybe something like this could solve this difference between ruby sass and libsass (prelexer.cpp)?\nconst char* alpha(const char* src) { return std::isalpha(*src) || !isascii(*src) ? src+1 : 0; }\nconst char* alnum(const char* src) { return std::isalnum(*src) || !isascii(*src) ? src+1 : 0; }\n. I actually just tried it with a basic example (which did compile fine with the \"hack\"):\nSELECT\u00d6R { par\u00e4m: val\u00fce; }\n. Created pull request (https://github.com/hcatlin/libsass/pull/283). I guess this should be save (as chars above 127 should not have any other meaning then alpha character). Maybe someone knows what the css specification says about unicode for selectors or property names? I also don't know how portable isascii is (I guess if it is it should be the safest test, as I've read that chars may be signed or unsigned; and I'm a bit unsure if that really can be predicted). To make it short, others probably can tell better if this is a good solution or not.\n. I would say that's correct, so the fix should pretty much be in line with the css specs:\nhttp://www.w3.org/TR/css3-syntax/#token-diagrams (under <ident-token>)\nJust retested the original reported problem:\n$someVari\u00e4ble: \u29f2;\nhtml, body { par\u00e4m: $someVari\u00e4ble; }\nResulted in:\nhtml, body {\n  par\u00e4m: \u29f2; }\nIMO this bug can be closed.\n. IMO this is still an issue and should not be too hard to fix.\nWe should add an option to Context to make it configurable!\n```\nFind '\\n' in 'libsass\\cencode.c' (20.11.2014 20:48:26; 20.11.2014 20:48:26):\nlibsass\\cencode.c(98):  *codechar++ = '\\n';\nFound '\\n' 1 time(s).\n\nFind '\\n' in 'libsass\\context.cpp' (20.11.2014 20:48:26; 10.12.2014 01:21:21):\nlibsass\\context.cpp(240):           output += \"\\n\" + format_source_mapping_url(source_map_file);\nFound '\\n' 1 time(s).\n\nFind '\\n' in 'libsass\\extend.cpp' (20.11.2014 20:48:26; 20.11.2014 20:48:26):\nlibsass\\extend.cpp(774):         newline ||= !!ops1.shift if ops1.first == \"\\n\"\nlibsass\\extend.cpp(775):         newline ||= !!ops2.shift if ops2.first == \"\\n\"\nlibsass\\extend.cpp(781):         return (newline ? [\"\\n\"] : []) + (ops1.size > ops2.size ? ops1 : ops2)\nlibsass\\extend.cpp(793):     // newline ||= !!ops1.shift if ops1.first == \"\\n\"\nlibsass\\extend.cpp(794):     // newline ||= !!ops2.shift if ops2.first == \"\\n\"\nlibsass\\extend.cpp(805):     // return (newline ? [\"\\n\"] : []) + (ops1.size > ops2.size ? ops1 : ops2)\nlibsass\\extend.cpp(884):     // ops1.reject! {|o| o == \"\\n\"}\nlibsass\\extend.cpp(885):     // ops2.reject! {|o| o == \"\\n\"}\nFound '\\n' 8 time(s).\n\nFind '\\n' in 'libsass\\inspect.cpp' (20.11.2014 20:48:26; 10.12.2014 01:21:21):\nlibsass\\inspect.cpp(18):       append_to_buffer(\" {\\n\");\nlibsass\\inspect.cpp(25):       if (block->is_root()) append_to_buffer(\"\\n\");\nlibsass\\inspect.cpp(26):       append_to_buffer(\"\\n\");\nlibsass\\inspect.cpp(36):       if (l > 2 && buffer[l-1] == '\\n' && buffer[l-2] == '\\n') {\nlibsass\\inspect.cpp(116):         append_to_buffer(\"\\n\");\nlibsass\\inspect.cpp(152):       append_to_buffer(\"\\n\");\nFound '\\n' 7 time(s).\n\nFind '\\n' in 'libsass\\json.cpp' (20.11.2014 20:48:26; 20.11.2014 20:48:26):\nlibsass\\json.cpp(63):     fprintf(stderr, \"Out of memory.\\n\");    \\\nlibsass\\json.cpp(358): #define is_space(c) ((c) == '\\t' || (c) == '\\n' || (c) == '\\r' || (c) == ' ')\nlibsass\\json.cpp(861):           *b++ = '\\n';\nlibsass\\json.cpp(1081):   sb_puts(out, \"[\\n\");\nlibsass\\json.cpp(1088):     sb_puts(out, element != NULL ? \",\\n\" : \"\\n\");\nlibsass\\json.cpp(1120):   sb_puts(out, \"{\\n\");\nlibsass\\json.cpp(1129):     sb_puts(out, member != NULL ? \",\\n\" : \"\\n\");\nlibsass\\json.cpp(1173):       case '\\n':\nFound '\\n' 10 time(s).\n\nFind '\\n' in 'libsass\\output_nested.cpp' (20.11.2014 20:48:26; 09.12.2014 20:56:48):\nlibsass\\output_nested.cpp(31):       rendered_imports += \"\\n\";\nlibsass\\output_nested.cpp(42):       if (i < L-1 && old_len < buffer.length()) append_to_buffer(\"\\n\");\nlibsass\\output_nested.cpp(76):       append_to_buffer(\" {\\n\");\nlibsass\\output_nested.cpp(105):           append_to_buffer(\"\\n\");\nlibsass\\output_nested.cpp(111):       append_to_buffer(\" }\\n\");\nlibsass\\output_nested.cpp(147):     append_to_buffer(\" {\\n\");\nlibsass\\output_nested.cpp(155):       append_to_buffer(\" {\\n\");\nlibsass\\output_nested.cpp(163):           append_to_buffer(\"\\n\");\nlibsass\\output_nested.cpp(170):       append_to_buffer(\" }\\n\");\nlibsass\\output_nested.cpp(193):         if (!stm->is_hoistable()) append_to_buffer(\"\\n\");\nlibsass\\output_nested.cpp(200):     append_to_buffer(\" }\\n\");\nlibsass\\output_nested.cpp(223):     append_to_buffer(\" {\\n\");\nlibsass\\output_nested.cpp(231):       append_to_buffer(\" {\\n\");\nlibsass\\output_nested.cpp(239):           append_to_buffer(\"\\n\");\nlibsass\\output_nested.cpp(246):       append_to_buffer(\" }\\n\");\nlibsass\\output_nested.cpp(269):         if (!stm->is_hoistable()) append_to_buffer(\"\\n\");\nlibsass\\output_nested.cpp(276):     append_to_buffer(\" }\\n\");\nlibsass\\output_nested.cpp(303):     append_to_buffer(\" {\\n\");\nlibsass\\output_nested.cpp(311):         append_to_buffer(\"\\n\");\nlibsass\\output_nested.cpp(321):         append_to_buffer(\"\\n\");\nlibsass\\output_nested.cpp(332):     append_to_buffer(\" }\\n\");\nFound '\\n' 21 time(s).\n\nFind '\\n' in 'libsass\\prelexer.cpp' (20.11.2014 20:48:26; 09.12.2014 23:50:28):\nlibsass\\prelexer.cpp(63):         exactly<'\\n'>,\nlibsass\\prelexer.cpp(64):         sequence< exactly<'\\r'>, exactly<'\\n'> >,\nlibsass\\prelexer.cpp(617):       return alternatives< exactly<'\\n'>,\nlibsass\\prelexer.cpp(618):                            sequence< exactly<'\\r'>, exactly<'\\n'> >,\nFound '\\n' 4 time(s).\n\nFind '\\n' in 'libsass\\sass2scss.cpp' (20.11.2014 20:48:26; 09.12.2014 23:50:28):\nlibsass\\sass2scss.cpp(52):             \"\\n\" + INDENT(converter) + \"}\";\nlibsass\\sass2scss.cpp(60):             \"\\n\" + INDENT(converter) + \"{\";\nlibsass\\sass2scss.cpp(371):         size_t pos_right = sass.find_last_not_of(\"\\n\\r\");\nlibsass\\sass2scss.cpp(412):         converter.whitespace += lfs + \"\\n\";\nlibsass\\sass2scss.cpp(457):             converter.whitespace += sass + \"\\n\";\nlibsass\\sass2scss.cpp(486):                     // if (KEEP_COMMENT(converter)) scss += \"\\n\";\nlibsass\\sass2scss.cpp(753):                 case '\\n':\nlibsass\\sass2scss.cpp(756):                     if(sb->sgetc() == '\\n')\nFound '\\n' 8 time(s).\n\nFind '\\n' in 'libsass\\source_map.cpp' (20.11.2014 20:48:26; 20.11.2014 20:48:26):\nlibsass\\source_map.cpp(119):     const ptrdiff_t new_line_count = std::count(str.begin(), str.end(), '\\n');\nlibsass\\source_map.cpp(122):       current_position.column = str.size() - str.find_last_of('\\n');\nFound '\\n' 2 time(s).\n\nFind '\\n' in 'libsass\\output_nested.hpp' (20.11.2014 20:48:26; 20.11.2014 20:48:26):\nlibsass\\output_nested.hpp(37):             rendered_imports += \"\\n\";\nFound '\\n' 1 time(s).\n\nFind '\\n' in 'libsass\\parser.hpp' (20.11.2014 20:48:26; 09.12.2014 23:50:28):\nlibsass\\parser.hpp(136):           source_position.line += count_interval<'\\n'>(position, after_whitespace);\nlibsass\\parser.hpp(153):         source_position.line += count_interval<'\\n'>(position, after_token);\nlibsass\\parser.hpp(158):           if (*ptr == '\\n')\nFound '\\n' 3 time(s).\n\nFind '\\n' in 'libsass\\prelexer.hpp' (20.11.2014 20:48:26; 09.12.2014 23:50:28):\nlibsass\\prelexer.hpp(57):       while (src && src != '\\n') ++src;\nFound '\\n' 1 time(s).\n\nFind '\\n' in 'libsass\\test\\test_node.cpp' (20.11.2014 20:48:26; 20.11.2014 20:48:26):\nlibsass\\test\\test_node.cpp(94):     cout << \"\\nTesting Done.\\n\";\nFound '\\n' 1 time(s).\nSearch complete, found '\\n' 68 time(s). (13 file(s)).\n```\n. I have added a commit which should allow implementors to change this. I would consider this alpha since it could introduce subtle edge cases which we are not yet aware of.\n. I've also hit the problem that I had to name the source files to be compiled explicitly to build CSS::Sass (Perl libsass module). But I had no big trouble to do so. The file names can easily be fetched from the Makefile. I agree with all of you that commenting out code and leaving stale files behind is a bad thing. But IMO this is how development goes, specially with refactorings. If I look at which speed libsass is evolving and the numbers of active developers, I think they are doing an incredible job. IMO this issues can wait till libsass catches up to the ruby sass implementation (feature wise). Just my 2 cents!\n. Just made a short test and unfortunately I get the same wrong output as the OP. So I guess this one is not really fixed yet (used Perl CSS-Sass with Libsass from https://github.com/mgreter/libsass/commits/c5e75b79791cae071a210fe016336977f8de69a6).\n. @akhleung, you may close/cash this in whenever you want! Have a nice dinner with someone you care or exchange it to beer. Thank you once again!\n. Thanks @akhleung! I already implemented it for the Perl Module and basic test is working correct!\n. Hey guys! Do you think this would still be a valuable addition to libsass, since we've added MSVC 2013 project files? Since MSVC 2013 is the only compiler that can compile libsass, I'm not sure if CMake would add much benefit. Currently I don't see much pain to handle all the different makefiles, since we are only adding a file to the build here and then. But we are laking a target to build a dll on MSVC currently though! So it still seems to be interesting ...\nAre you guys up to rebase this to latest master? IMO it should be a bit easier and I agree that an out of source build would be better. I actually would volunteer to adjust the other build files accordingly. Shouldn't be too hard, since they are quite modular already. \n. I have picked up on this work and successfully built the dll with cmake and msbuild (https://github.com/sass/libsass/pull/1352). Bot sure if it will make it to master anytime soon, but getting the first results was rather easy! But there are still some open things, like versions and header location. Maybe somebody wants to continue from there ...\nGoing to close this once I can create a clean PR with my changes!\n. I'm going to close this since it is superseded by #1359.\n. Be aware that nested media rules are a CSS3 feature and not supported by CSS2.\n. This seems to work with latest master! //CC @xzyfer \n. Not really. IMHO I recovered this via perl-libsass when sassc did not yet have the ability to discover passing tests itself. So I just moved that folder from todo!\n. This is also error related!\nYou may not @extend an outer selector from within @media.\nYou may only @extend selectors within the same directive.\nFrom \"@extend %foo\" on line 7.\n. What's the status on this? If I'm correct we can implement to load css files at least with non-standard imports, like @import \"file\";? This would not touch the way how @import url(\"file.css\"); would be handled. Therefore people at least could use it in this way to include raw css files.\n. OK, so PR at https://github.com/sass/libsass/pull/754 should be good to go!?\n. https://github.com/sass/libsass/pull/754 has been merged!\n. This issue should (hopefully) be addressed/fixed by https://github.com/sass/libsass/pull/792.\nPlease try with latest master and open a new issue if the problem still exists.\nThank you!\n. Well, we have one regression with this fix in #930, so I'm not yet sure if we can keep this in for 3.2!\n. I can confirm that with CSS::Sass. Did some more tests:\n{ - \"works\"\n{} - crashes\n{}X - \"works\"\n. I'm closing this since we have other open issues for sourcemaps which include more details! If you want you can open a new issue and provide a minimal use-case! Other than that we are aware that source-maps need more work! Thank you!\n. This seems to break the custom precision feature: https://github.com/hcatlin/libsass/issues/364\n. Just tested with perl bindings and it seems that custom precision is stil broken (https://github.com/nsams/libsass/commit/e231c6c995e97ba6a8eb42ff484f4ef8c24e96b1).\n. Reversed the logic @akhleung proposed and added a status bool to context, to flag this situation. Feels hackish, but IMO still better than breaking custom precision. Hope it works as intended.\n. Sorry, I dont really understand what you mean? Is custom precision not a feature of sass 3.4?\n. Closing this issue as it is fixed in https://github.com/sass/libsass/commit/12dbd03be97a306485720b3c430a2d68e1f25e5c\n. I saw this warning too. I have re-ordered it in my current WIP branch: https://github.com/mgreter/libsass/commit/66e1b4b085d12affc7e2fd4a445370621a8839ba#diff-f2d6a4d46b2aeaccd8ce40e4d3ea753dR68. I fail to see why this should be an issue? Can someone from node-sass team (@am11) test if reversing the order for subset_map and _skip_source_map_update fixes the issue?\n. I'm pretty confident that this will solve the issue. I have already commited the change to master as it at least gets rid of the clang warning.\n. Hi @rivy \nI'm the \"maintainer\" of sass2scss and just updated my repository with your suggestions!\nAlthough I replaced all the ints with size_t, as IMO this should be the correct type.\nI'm really not a real-world c++ coder, so I hope that this compiles without warning!\nhttps://github.com/mgreter/sass2scss/commit/0dbfb8fe7fa724776e01844ac565a16653ad2162\nhttp://www.cplusplus.com/reference/cstring/size_t/\nhttp://www.cplusplus.com/reference/string/string/npos/\nBest regards\nMarcel\n. Hey @akhleung and @rivy \nThat's my \"Boo-Boo\". Somehow when I copy the patch/diff from above it will always paste as only one line, so I just made the changes by hand and overlooked that you had actually commented out that line. I have now removed pos_right and also enabled warnings when compiling the standalone sass2scss, so I actually was able to see the same warnings. Somehow thought they would be on by default.\nhttps://github.com/mgreter/sass2scss/commit/221e36cefa860f1775bd164f2791a2a961a8f296\nThanks for your input and have a nice day!\nMarcel\n. I wonder if we should close this and preserve the information in a wiki page?\n. I created a wiki page to document the findings.\nIMO we will not have full support in the foreseeable future!\n. @akhleung Can you give more details what your specific idea was?\n. I found another optimization for prelexer sequence and alternatives with variadic templates:\n``` C\n// Tries the matchers in sequence and succeeds if they all succeed.\ntemplate \nconst char alternatives(const char src) {\n  const char* rslt;\n  for (prelexer mx : { mxs... }) {\n    if ((rslt = mx(src))) return rslt;\n  }\n  return 0;\n}\n// Tries the matchers in sequence and succeeds if they all succeed.\ntemplate \nconst char sequence(const char src) {\n  const char* rslt = src;\n  for (prelexer mx : { mxs... }) {\n    if (!(rslt = mx(rslt))) return 0;\n  }\n  return rslt;\n}\n``\n. @xzyfer IMO this is a [pretty neat improvement](https://github.com/mgreter/libsass/commit/5e0031813dbb37957fc784330f1e8118a40769cd) since it removed about 100 lines of codes and made thesequenceandalternatives` prelexer accept any number of arguments. If it blows up we always can revert and go back to create those functions by hand when needed.\n. According to https://gcc.gnu.org/projects/cxx0x.html variadic templates have been included since gcc 4.3, so changes are good that it will compile with pretty old gcc and c++0x (which we do with CentOS patch).\n. @akhleung I'm going to close this! Please feel free to open a new issue if you have more details!\n. Unfortunately it seems that github has no option to include the submodules inside the source.zip it offers to download on the releases page (I guess you downloaded it from there?).\nhttp://stackoverflow.com/questions/12936014/include-a-github-submodule-automatically-in-download\n. This is also a sass2scss issue. The code above gets converted to\nscss\n::selection {\n  color: rebeccapurple; }\n::-webkit-selection {\n  color: rebeccapurple; }\n:-webkit-selection,: ::selection {\n  color: rebeccapurple; }\nAs you can see, the last selector is treaded as indented sass property syntax. It's quite tricky to get this right, as the syntax can be pretty ambiguous here. The code above fails, because sass2scss was looking for another colon in the line (which it found at ::selection) which was then treated like a indented property syntax. Take this example:\nsass\n:hover SPAN // probably a selector\n:color red // probably a property\nThis seems impossible to distinguish without knowning that \":hover\" is actually a pseudo selector and not a css property. I've added a pretty extensive list of pseudo selectors to sass2scss (https://github.com/mgreter/sass2scss/commit/1f8ada76dbf2fea530c739dd8616116506f041c7) with some test cases (https://github.com/mgreter/CSS-Sass/commit/7c8b343feedd7ae8b81636a20c6a46905014a1a1).\n. This should be fixed with the latest sass2scss version! Maybe you can try it by updating the sass2scss submodule in your local version to the latest master? I also added some test cases to CSS-Sass that seem to compile correctly now! Thank you for the report!\n. @am11: I dont think so! #433 is about custom functions; and the sass2scss update only matters if you feed .sass (indented syntax) files to libsass, which IMO is not the case here?\n. I guess this is because sass2scss converts that to:\n.selector0 {\n    .selector1 {\n      color: black; }\n    .selector2;\n    .selector3 {\n      color: green; } }\nI've already implemented this here https://github.com/mgreter/sass2scss/commit/74171917366dee17296722681862006af1ea3e19 (plus test cases here https://github.com/mgreter/CSS-Sass/commit/df0618faaaff8126ff475400abc5e46cc1f2b5f2).\n. This is not supported by sass2scss and I cannot find any indication that this is valid indented sass syntax. This would not be easy to implement, as we cannot simply search for \"//\" and be sure that it will be a comment, since this could also be inside a quoted string.\n. This should be fixed by https://github.com/mgreter/sass2scss/commit/ebdf51addafbb1f6810ef494bc351f9cd0994d57 (Test cases: https://github.com/mgreter/CSS-Sass/commit/4b532b5df4d2a7171fd10186001eceb5cd96df9f)\n. Hey @paazmaya \nThis seems to be another issue with sass2scss which IMO got introduced by the latest changes. Looks like you're the first person to really try out the sass2scss stuff. Missed the @content keyword (it was handled like an empty selector, to which sass2scss adds now an empty scope block instead of a semicolon). Added a special clause just for the '@content' keyword (https://github.com/mgreter/sass2scss/commit/59c7a1fc31fd1d37c7530a6bdb1019875538e328). Maybe you know some more keywords that look like selectors but should be treated like single properties instead? Also added test cases to CSS-Sass (https://github.com/mgreter/CSS-Sass/commit/a68b5ef971427ce360342480b9d1f504d5f34de5).\nBest regards\nMarcel\n. Thanks! Already made the changes for sass2scss (https://github.com/mgreter/sass2scss/commit/ed6497645d78a9bf6c14ae52cb44fc4d19f07274) plus test cases (https://github.com/mgreter/CSS-Sass/commit/ac2ceb68af5bb7f065aea75b12d4dc5f7ab4422d).\n. You're right, sorry, overlooked your comment above. Commit (https://github.com/mgreter/sass2scss/commit/b61837ab1030d15ed1044288b45adf25bf802e08) and Test Case (https://github.com/mgreter/CSS-Sass/commit/65648874c9e5c33bfe5874cd96d8ac057712d364) added!\n. This should be fixed by https://github.com/mgreter/sass2scss/commit/f2a044b358be8f4fa6896537668a6cda97e84b51 (Test cases: https://github.com/mgreter/CSS-Sass/commit/80733a2d470ac17f05f7ec5700eb53a06c65e393)\n. This should be fixed by https://github.com/mgreter/sass2scss/commit/e2fda7d1db30bd7afb7a1fc22634693995c2a01a (Test cases: https://github.com/mgreter/CSS-Sass/commit/6ab3780dbc3a2d661f651aa40d642db864511851)\n. Maybe also take a look at https://github.com/sass/libsass/pull/433 which seems to be (IMO) about the same issue.\n. Btw. I currently get these results for libsass 3.2.4 and ruby sass 3.4.13 (stripped down):\ncss\nul > li:first-child, ul > li:first-child + ul > li + li, ul > li:first-child + li + li + ul > li + li, ul > li:first-child + li + li + li + li + ul > li + li, ul > li:first-child + li + li + li + li + li + li + ul > li + li // libsass\nul > li:first-child, ul > li:first-child + li + li, ul > li:first-child + li + li + li + li, ul > li:first-child + li + li + li + li + li + li, ul > li:first-child + li + li + li + li + li + li + li + li // ruby sass\nI'm pretty sure that this is solved once we implement is_superselector correctly.\n. I was able to further reduce the test case. Once I followed all the calls by comparing to ruby sass, I was able to locate the error, which was a simple copy paste error from converting that sass code.\n``` scss\n@mixin odd() {\n    %test { background: #ccc; }\n    P {\n      #{'UL > div + DIV'} { @extend %test; }\n    }\n}\nUL > {\n  @include odd();\n}\n``\n. I have a regression with this merge in my unit tests ([Perl Binding CSS-Sass](https://github.com/mgreter/CSS-Sass)). Since this merge libsass will always include the sourceMappingURL ifomit_source_map_urlis not set. I wonder if this makes sense ifsource_map_file` is not set to anything at all?\nCurrently appended to the resulting css:\n/*# sourceMappingURL= */'\nChanging\nif (!omit_source_map_url) output += format_source_mapping_url(source_map_file);\nto\nif (source_map_file != \"\" && !omit_source_map_url) {\n  output += format_source_mapping_url(source_map_file);\n}\nfixes my unit tests\n. I have a regression with this merge on windows.\nlibsass\\file.cpp: In function 'std::string Sass::File::resolve_relative_path(const string&, const string&, const string&, bool)':\nlibsass\\file.cpp:91:71: error: no matching function for call to 'transform(std::basic_string<char>::const_iterator, std::basic_string<char>::const_iterator, std::basic_string<char>::iterator, <unresolved overloaded function type>)'\nSee the <unresolved overloaded function type>.\nProblem is explained here: http://stackoverflow.com/questions/1679245\nThe fix is pretty easy. Just change tolower to ::tolower.\n. IMHO this is a pretty difficult issue since it involes parse_list, which we currently always expect to be at least space separated. I have added a debugger.hpp file which contains a debug_ast function:\ninput:\nfoo { bar: (10/10)#{rem}; }\noutput:\nfoo { bar: 1 rem; }\ndebug_ast:\nBlock 0x2630200 0\n Ruleset 0x22652c0 0\n  Selector_List 0x26302e0 - -\n   Complex_Selector 0x26e6300 - - -> { } <> X < >\n    Compound_Selector 0x23993c0 - - <> X < >\n     Selector_Reference 0x2991a20 @ref 0\n   -Complex_Selector 0x26e61a0 - - -> { } <> X <>\n   - Compound_Selector 0x23992d0 - - <> X <>\n   -  Type_Selector 0x2991980 <<foo>> - <> X < >\n  Declaration 0x2b27dc0 0\n   prop: String_Quoted : 0x26e63b0 [bar] < > X <>\n   value: List 0x2b27cf0 [Space] [delayed: 0]  [interpolant: 0]\n   value:  Binary_Expression 0x26e65c0 [11]\n   value:   left:  Textual  [NUMBER]0x26e6460 [10]\n   value:   right: Textual  [NUMBER]0x26e6510 [10]\n   value:  String_Schema 0x2b30d90 4 {has_interpolants}\n   value:   String_Quoted : 0x26e6670 [rem] {delayed} <> X <>\nAs you can see this gets parsed as a space separated list, and that's the reason why it fails! IMHO this needs to be parsed and render completely different, so this doesn't look like an easy fix!\nAlso consider this example:\ninput.scss\n// interpolated-urls\nfudge { walnuts: blix\"fludge\"#{hey now}123; }\nruby sass output:\nfudge { walnuts: blix \"fludge\"hey now123; }\nlibsass output:\nfudge { walnuts: blix\"fludge\"hey now123; }\nThe differences are very subtile and I have no idea yet what the actual rule behind it is (and if it actually makes sense or if it should be considered a ruby sass bug).\n. IMO we should re-scope this to Milestone 3.3\n. Hadn't had a close look at the sources, but the travis build only seems to break because you didn't add the source files for the json lib to the automake build system (makefile.am). Maybe you could give us more info when it segfaults (how to reproduce).\n. This has to be fixed as it IMO introduces some memory leaks. I also don't like that it stores the complete source twice (there is also a sources vector). Will see what I can do:\n-> https://github.com/mgreter/libsass/tree/source-map-sources\n. Closing this in favor of https://github.com/sass/libsass/pull/591.\n. IMO this can be closed!\n. Just tested this and I get a more usefull error message (I may be missing some of the latest commits): \nsource string:7: error: invalid selector after\nI also checked what the sass2scss output is for the given indendet sass code:\n```\n$selector: body;\n.#{$selector} {\n  display: none; }\n@each $color in red, green, blue {\n  .#{$color} {\n    color: rebeccapurple; } }\n```\nIMO the problem is that the keywords (red, green, blue) get changed to their hex encoding. I guess libsass tells me that .#{$color} is not a valid selector (which is true if it looks like .#ff0000).\n. @xzyfer I'm confused. The spec test seems to be passing!? Can this be closed again?\n. @am11: Libsass already resolves sources relative to the source map file. I have added some additonal commits which should do what you have asked for (sourceMappingURL relative to output_path).\nYou got lucky since I probably need this feature soon :)\n@akhleung: With these changes paths are internally always represented with forward slashes. The make_canonical_path function should be used to sanitize paths when they come from outside or the system. It should normalize . references and repeated slashes. The result will always have forward slashes. I also added some more details to the corresponding commit messages.\n. @am11 Can you confirm that your issues are fixed by this pull request? @akhleung Not sure if you missed this one, or are there any objections regarding this?\n. This issue should (hopefully) be addressed/fixed by https://github.com/sass/libsass/pull/792.\nPlease try with latest master and open a new issue if the problem still exists.\nThank you!\n. Took the liberty to replace the native utf8 code with a well known unicode implementation. Added try/catch blocks for unicode errors in internal sass functions. Renamed some utf8 helpers to a more consistent naming (IMHO).\nhttp://www.codeproject.com/Articles/14637/UTF-With-C-in-a-Portable-Way\n. Sorry for the mess! Figured using the native windows functions are safer to use as shortnames may not be available in the future. This is also the only way if libsass should ever need to write files with unicode paths IMO.\n. Added a commit to update sass2scss to the latest tagged version (0.9.1).\n- Fixes imports with single quotes (https://github.com/mgreter/sass2scss/commit/73089d5b7828caa236a20d1808e015ead2f2c4ab)\n. I guess this should be the test case:\nInput.css\ncss\ndiv {\n  display: block;\n  @keyframes {\n    from {\n      foo: bar;\n    }\n  }\n}\nExpected output (sass 3.4.9)\nCSS\ndiv {\n  display: block; }\n@keyframes {\n  from {\n    foo: bar; } }\nActual libsass output\nCSS\ndiv {\n  display: block;\n  @keyframes {\n    from {\n      foo: bar; } }\n }\nSo this seems a valid bug. Maybe someone has the time to convert the above into a spec test!?\n. I think this has been fixed in https://github.com/sass/libsass/pull/685! Please re-open if not!\n. Maybe I'm not able to wrap my head around it, but this doesn't (IMHO) look right:\nresolve_relative_path(real_path, source_map_file, File::dir_name(source_map_file))\n```\nstring make_absolute_path(const string& path, const string& cwd)\n{\n  return (is_absolute_path(path) ? path : join_paths(cwd, path));\n}\nstring resolve_relative_path(const string& uri, const string& base, const string& cwd)\n{\n  string absolute_uri = make_absolute_path(uri, cwd);\n  string absolute_base = make_absolute_path(base, cwd);\n...\n```\nThis basically translates to (for make_absolute_path(base, cwd)):\n```\nstring absolute_base = make_absolute_path(srcmap_file, dir_name(srcmap_file));\nif srcmap_file is not an absolute url => join_paths(dir_name(srcmap_file), srcmap_file);\n=> srcmap_file = \"path/to/file\" -> absolute_base => path/to/path/to/file (what I would expect)\n```\nI tested your changes against my unit tests (only contains a very limited set of tests for source maps) and it didn't break. I'm probably missing something here! It's also not very clear what the \"Ubuntu issue\" actually is. Do you have some unit tests I could run to see the behaviour. If not, maybe you could add some to CSS-Sass!?\nHad not much time at hand to go through it, but still wanted to give some feedback!\n. I had some time today to run your failing test cases with node-sass.\nI've added some code to context.cpp to see/debug the internal variables:\ncerr << \" === \\n\";\ncerr << \" ==   cwd: \" << cwd << \"\\n\";\ncerr << \" ==   out: \" << output_path << \"\\n\";\ncerr << \" ==  smap: \" << source_map_file << \"\\n\";\n```\n ==   cwd: /tmp/node-sass/\n ==   out: /tmp/node-sass/test/out.css\n ==  smap: foo.css.map\n  1) render to file should save the sourceMap to a specified file name:\n     Uncaught AssertionError: false == true\ngot: \"../foo.css.map\"\nexpected: \"foo.css.map\"\n```\nYour patch changes the behaviour to resolve source maps relative to the output_path directory. IMO this could be a valid option, but should be discussed further! All other files are resolved to cwd currently. IMO your patch could lead to other problems since the third argument for resolve_relative_path should be already an absolute path, since it is passed as the second argument to make_absolute_path. This is not the case with File::dir_name.\n// if real_path is not yet absolute, it will be resolved from source_map directory \nresolve_relative_path(real_path, source_map_file, File::dir_name(source_map_file))\n// same logic applies for the `format_source_mapping_url`\nresolve_relative_path(file, output_path, File::dir_name(output_path))\nHope this makes it a bit more clearer. I personally think the current behaviour feels more natural, as all other files are referenced from cwd. Implementors should still be able to resolve relative source-map paths to the output directory if they want. IMHO the new behaviour would not feel very intuitive (i.e. on the command line). But that's just my 2 cents, so the decision is for the project owners to make (@akhleung). There might be a cleaner coding approach, If this behaviour is prefered.\noutput_path: ./target/out.css\nsrc_map_path: ./maps/out.map\n  currently => ./maps/out.map\n  with path => ./target/maps/out.map\nBest regards\n. IMO you would only need to check if src_map_path is not absolute, and if it is not, make it absolute in relation to dirname of output_path. Therefore libsass should never try to make it relative to cwd on its own. All other files will resolve to cwd, and the cwd could be changed by implementor before invoking libsass. Or do I miss something? The paths for sourceMappingUrl and sources in source maps are still relative to each other.\n. :+1:\n. If you know that you have indented sass syntax in your string, you should be able to call sass2scss yourself to make the conversion before feeding it into libsass.\n. What is the status on this? Would a sass implementation suffice? As I'm thinking, it might be a good idea to add a function to the C-API to set/get variables from the context? That way we could add the image path @xzyfer mentioned.\n. What is the status on this? Would a sass implementation suffice? As I'm thinking, it might be a good idea to add a function to the C-API to set/get variables from the context? That way we could add the image path @xzyfer mentioned.\n. Custom C functions currently lack the possibility to be called by \"mapped\" arguments. So I guess this could be a drawback. Other than that I don't see any reason this should not be possible to implement by custom C functions. Although I guess the current code is in C++ (function.cpp)!?\n. I'm all in for this! Maybe @hcatlin can pull some strings to get this finally done!? These features should be possible to implement via custom functions now IMO!? I can offer my help to give advice on how to do it via custom functions! But we'd need someone who actually uses this feature to work with us!\n. Maybe make your own commit of the final result.\nTried the github edit feature for the first time ;)\n. This may be related (I guess node-sass also uses sass_interface.cpp):\nhttps://github.com/sass/node-sass/issues/378\n. Yeah, sorry, I should have pointed out more clearly that I intended to add more commits to test how the build behaves. It's a bit hard to anticipate so I figured I could use this pull request to see what travis ci is doing with it. It seems that the spec suite is not running correctly (not compiled to report coverage) and thus no coverage is reported. Looking into it right now.\nAt least it's already reporting something, coverage can only improve from that point on :)\n. From my local tests it indicates that sassc would need some option to have it compiled with these flags enabled: --coverage --no-inline. Do you know how the commited Makefiles are generated?\n. OK, thanks for the info. I will prepare a patch for sassc and will add more commits here. I guess it is ok to implement this via an env variable EXTRA_CFLAGS in the Makefile? So far I only added it to the automake build of libsass, so will also try to add this to the libsass Makefile.\n. @coveralls you're a bit late to this party :laughing: \n. Basically everything has been implemented beside\nalways absolute file URIs\n. I'm going to close this since IMHO the usefull options are already implemented.\nI may come around to implement the complete ruby sass option set someday. But until then let's see if there is a need for the not yet implemented options (so please open an new issue if you are really missing some option)!\n. Please see the discussion on the bottom here: https://github.com/sass/sassc/pull/69\n. If you merge the other PR now, I will prepare the correct commit here ;)\n. I have started to document in here on a wiki page\n. This probably introduces a memory leak, since sass2scss will allocate new memory for the result, so I guess we have to free the data after calling compile_file.\n. Closing this issue since we the wiki page to document this now!\n. While I think this is a usefull feature, I pretty much agree with @xzyfer on this. It is not really a high priority currently. I personally also postprocess urls with another tool (I need to have this possibility anyway in my postprocessor). But I guess we would not be against it if anybody would like to take a lead here to get this implemented properly!?\n. I created a collective ticket to keep track this and other \"non-urgent\" feature requests, in order to keep the issue tracker a bit more clean for the more 1st aid issues. I would like to encourage everybody interested in this particular feature to add their comments into this closed issue anyway.\nThanks for your understanding and your contribution!\n. The basic problem is that either + 0 and - 0 is not parsed correctly. Maybe the spec should be updated to include that case too!? IMHO this could be treated like an op with left hand side set to 0.\n. The @warn statements can now be intercepted via a custom function.\nAlthough imlementation is not the easiest, since it will pass Sass_Values!\nCurrently documentation for this is sparse, but I plan on adding more.\n. Realized that not all cases were covered! Should now also work for negative numbers that get cut of by the precision option. Updated spec test too.\n. I agree with @michaek, we will not add this kind of custom behaviour. But we are working hard to provide the necessary hooks for third-parties to implement custom solutions! IMO this should already be possible with latest master, but of course somebody would need to create such a project first!\n. This nuance is found here, if anyone cares to fix it: https://github.com/sass/libsass/commit/b860361d6a2a117244d2e803ab06145472fbd5fa#diff-cfe40fe6863b6bef68e57af57bca1155L324\n. PRs are always welcome :)\n. this \"feature\" is enabled by setting \"source_comments\" to true by the implementors. The api has sligthly changed, so I guess your implementation hasn't kept up to this change. But it is defenetly configurable by implemtors!\n. This looks like a documentation bug in node-sass. As I just checked they still say in their main readme: If your sourceComments option is set to map, sourceMap allows .... The c_interface has been cleaned up, since it didn't make any sense to have two options to enable source maps. Internally source_comments is now a boolean and only enables, you may have guessed it, the source comments you are seeing. It's enough now to just set source_map to generate them.\nYou probably can just not set sourceComments to get the desired result!\n//CC @am11 \n. Actually with the latest ruby sass this compiles to \nCSS\na {\n  b: c; }\nYour example looks like you're compiling it in expanded mode!?\n. Already done in  #910 \n. This should be solved by #910!\n. This seems to be fixed by latest master? @xzyfer maybe you can check?\n. Build fails because there is a regression in the spec-test suite for:\nsass-spec/spec/maps/map-merge (which was added pretty recently?)\nI guess it will compile once PR #563 is merged ...\n. I added another change to the new quote/unquote functions. I guess returning string.c_str() back to C is not such a good idea. Therefore the caller now has to free the returned memory (which makes totally sense).\n. Sure thing :+1: ! Of course I cannot guarantee any fixed amount of time for this project as life gets in the way from time to time and my main focus is mostly on the binding aspects (C interface) of libsass :-)\n. Can we also get rid of the size_t hash_ = 0 initialization in ast.hpp? It breaks my travis-ci builds for perl-libsass (I'm compiling with -std=c++0x). Don't know where to initialize them properly though.\n. The tip by @QuLogic gave me the right directions, please see here for a IMO proper fix: https://github.com/mgreter/libsass/commit/4fa3014856da856f4d31e0cf81062e409cac8822\n. Maybe someone could review it? Would really like get this off the list!\n// CC @xzyfer, @am11 \n. ACK! I guess issue https://github.com/sass/libsass/issues/324 may also be related? IMO source maps are not yet working perfectly, but unfortunately not many people (including me) seem to understand what the code really does ...\n. Since there was no more feedback I'm going to merge this!\n. I was about to merge #572 just now, any objections?\n. @am11 I remember that I actually tried to do that at some point, but ran into some problems since resolve_and_load also returns char *. So I figured it wasn't worth the hassle. But in general you're correct, it should better return a string. I guess we cannot get rid of the stdcpy, as we probably have to do it in resolve_and_load then.\n. IMO this is closely related to https://github.com/sass/libsass/issues/489\n. @am11 maybe you can manually apply bits by bits of https://github.com/sass/libsass/commit/ca5f271883db61ccd1d1e1b84dd4830a2564896f and compile again to see when this issue is triggered. Maybe it's that we are now passing ctx again to To_String to_string(&ctx);? I don't see why the introduction of the bool _skip_source_map_update should couse a crash!?\n. I hope you don't mind, but I deleted the comment you said we can disregard . At least we now know that the issue is in the realm of the actual source map generating! I may can take a look at it tomorrow! But as @xzyfer already said, the source map generating is somehow a black box to us!\nIMO it rather looks like the call to ctx->source_map.update_column(text); is needed. I don't think that the real culprit is the ! ctx->_skip_source_map_update check, or did you test that independenly? Maybe you can elaborate a bit more on your last comment, since I don't really get it why commenting out a line causes a crash!?\n. Really great you could find the culprit, wasn't really in the mood the setup yet another compiler env :) Are you planning to add a PR to include appveyor for libsass? Because I think we could really benefit of a windows CI env!? This is somewhat on my todo list, but you may already got something working?\n. So lets shoutout to the libsass-net crew (@darrenkopp). Can you bless us with a CI config for appveyor, because you are probably the first ones to profit off of that :) The perl-libsass crew has this to show: http://matrix.cpantesters.org/?dist=CSS-Sass%20v3.0.1 ;)\n. I guess this can be closed since #591 has been merged!\nPlease re-open if the problem still exists! Thanks!\n. :+1:\n. Let's see if we can improve that code coverage score :)\nDon't think that we want to include our external libraries!\n. Is it possible to test this kind of stuff with sassc easily?\nNot sure if there is anything setup to do it at the time beeing?\nIMO most interface stuff is not yet tested directly by sassc/libsass!?\n. Is there a upstream repository for this json library on github?\nWe probably should raise also an issue there about windows compilation!?\n. I guess we got the main technical problems covered (which still need to be fixed), but what about the naming of the options?\n+ // embed include contents in maps\n+ bool source_map_contents;\n+ // embed sourceMappingUrl as data uri\n+ bool source_map_embed;\nAny better ideas (since I'm not really convinced that these are the best)?\n. @am11: IMO snprintf is only needed to create error messages. Maybe you can come up with something that will compile on windows (_snprintf ??). I guess we could also live with a solution that uses conditionals (#ifdef).\n. Honestly the current json lib feels much leaner than jsoncpp. And it's a pitty that only the error reporting is a problem and not the actual implementation ... but yeah, it may be the only viable solution. But IMHO the author of the current json lib is on github, so we may can get this that way working!? As always, feel free to make a PR ;) // CC  @joeyadams\n. :+1: Lets see what travis ci has to say :)\n. I guess we have solved all issues for this PR!\n@am11 can you confirm that for windows (node-sass)?\n@xzyfer, @hcatlin: Any objections to get this merged?\nLast call to discuss the naming of the new options!!\n. OK, so I'll hold this PR till this is solved. Thanks for the report @am11 \n. A search over the whole node-sass project for sources only yields the test-cases. Therefore I wonder how these could ever work? Maybe I'm missing something here!!? But there was a small change to sources internally, as we now also store the original include on this vector.\nI also store the initial include on to these vectors ...\n. OK, that JSON.string() was the bit I missed :)\nSo where do have we regressions left? Can you put together a branch with all the fixes you need to get it running on windows?  Does the json library compile now for you?\nThe lines where sources is filled is here: https://github.com/mgreter/libsass/commit/ac224c685720bec5484d09b5a8d333a473e01747#diff-1b89ae920e2c7ee0f3a580e9ea4f1fe9R33\n. Maybe try to edit this line https://github.com/mgreter/libsass/commit/ac224c685720bec5484d09b5a8d333a473e01747#diff-1b89ae920e2c7ee0f3a580e9ea4f1fe9R28 to use file again (see diff for old version, maybe just try with file).\n. IMO I found a bug I have introduced with this PR, I really hope this satisfies your unit tests!\n. ~~I start to believe that your test fails because I've fixed a minor bug in source-maps:\nhttps://github.com/mgreter/libsass/commit/ac224c685720bec5484d09b5a8d333a473e01747#diff-f2d6a4d46b2aeaccd8ce40e4d3ea753dL156~~\n~~IMO sources should be empty, since you do not include any other file in index.scss. And it should definitely not contain the same file as the input (which is stored on file property).~~\nPlease forget the above, it's too early for me ;)\nWill take another look at it now!\n. Last commit should fix the empty sources issue.\nBut I don't see why mappings is empty, as we still use the same function serialize_mappings to produce that string!? Also cannot reproduce that with perl-libsass ...\n. So I've bitten the bullet and isntalled MSVC 2013 to debug the last issue with empty mappings and I think I found the last issue, at least all node-sass tests run correctly beside the mentioned issue with \"stdin\" for the included files. Will now investigate that. I guess I could always throw away the first entry on that list, or do you expect your own input file to show up in included_files?\n. It should now behave as before (at least for the node-sass tests). Will now create some unit tests of my own for perl-libsass and will then check it against before and after.  @am11 as a side note, the watch test does not exit on my machine and leaves the node process running.\n. Got it to pass all unit tests on my machine (Win7):\nhttps://github.com/mgreter/node-sass/tree/fix/libsass-windows-issues\nThere were some other minor issues:\n- Some expected files had different linefeeds than generated by libsass\n- I had some weird unit test failed because of process.chdir(__dirname);:\n```\n  1) compile file should throw an exception for bad input:\n     AssertionError: Missing expected exception..\n      at Function._throws (assert.js:300:5)\n      at Function.assert.throws (assert.js:317:11)\n      at Context. (D:\\temp\\node-sass\\test\\test.js:189:17)\n      at Test.Runnable.run (D:\\temp\\node-sass\\node_modules\\mocha\\lib\\runnable.js:217:15)\n      at Runner.runTest (D:\\temp\\node-sass\\node_modules\\mocha\\lib\\runner.js:373:10)\n      at D:\\temp\\node-sass\\node_modules\\mocha\\lib\\runner.js:451:12\n      at next (D:\\temp\\node-sass\\node_modules\\mocha\\lib\\runner.js:298:14)\n      at D:\\temp\\node-sass\\node_modules\\mocha\\lib\\runner.js:308:7\n      at next (D:\\temp\\node-sass\\node_modules\\mocha\\lib\\runner.js:246:23)\n      at Object._onImmediate (D:\\temp\\node-sass\\node_modules\\mocha\\lib\\runner.js:275:5)\n      at processImmediate [as _immediateCallback] (timers.js:345:15)\n2) render to file should raise an error for bad input:\n     Uncaught AssertionError: success() should not be called\n      at sass.renderFile.success (D:\\temp\\node-sass\\test\\test.js:228:9)\n      at D:\\temp\\node-sass\\lib\\index.js:288:16\n      at Object. (D:\\temp\\node-sass\\test\\test.js:203:7)\n      at Function.invoke (D:\\temp\\node-sass\\node_modules\\sinon\\lib\\sinon\\spy.js:157:59)\n      at Object.proxy (eval at createProxy (D:\\temp\\node-sass\\node_modules\\sinon\\lib\\sinon\\spy.js:70:86), :1:39)\n      at options.success (D:\\temp\\node-sass\\lib\\index.js:282:8)\n      at options.success (D:\\temp\\node-sass\\lib\\index.js:165:7)\n```\nThe watch process is still not terminating correctly!\n. There are two commits. I just used the test.js from some other node-sass. I did not create those tests ;) Anyway, that's why I made two commits. The first one is only adding fixes, while the second adds the additional unit tests.\nAnyway, probably the wrong thread to discuss this any further!\n@am11 feel free to take over anything you can use to node-sass!\nIMHO this PR is ready to get merged! // CC @am11, @xzyfer, @hcatlin \n. I cleaned up the commits and also added a guard for the problem reported in #601.\nI will merge this in soon if no other issues are reported in the meantime!\n. This is directly related to https://github.com/sass/libsass/issues/823\n. This actually seems to be simpler than expected, as it probably has nothing to do with interpolation\nCSS\nh1:nth-of-type(2n + 1) {\n    color: red;\n}\nThis shows the same difference between ruby sass and libsass. For me it looks like ruby sass parses the 2n + 1 as a static value, since I saw pretty much the same thing with other static values.\nIMO we should add some rules to static value parsing to include the plus sign when it's safe. IMO @xzyfer has done some work with static value parsing. IMO we need something like this:\n```\nsequence<\n  alternatives <\n    identifier,\n    static_string\n\n,\n  zero_plus < sequence<\n    optional_spaces,\n    exactly < '+' >,\n    optional_spaces,\n    alternatives <\n      identifier,\n      static_string\n\n(src);\n``\n. Duplicate of https://github.com/sass/libsass/issues/551! Please update to the latest version or make your implementor aware of the api changes by referencing the mentioned issue! Thx!\n. Sorry, then I did not understand your original report correctly.\nMaybe you can provide some more details (probably with some example code/output)!?\nThanks!\n. IMO this was fixed in https://github.com/sass/libsass/pull/600.\n. I have commited your changes to upstream [sass2scss](https://github.com/mgreter/sass2scss/commit/2dcc09960817ed4c8efb2c125f5ea466f7052e6d) and to [libsass`](https://github.com/sass/libsass/commit/5bdb8214b2369aa0f217dc158ab2c5ec5396acbd)\n. @am11 you are the one to call this one solved on windows, because nobody else was able to reproduce. If no one else sees any regressions with this I'm all for merging this! Great work @am11, and yeah, I don't really see why this was really causing any issues in the first place! What do you say @xzyfer?\n. I just rebased my [WIP] branch to your latest changes. Lets see what travis ci has to say about it :) My local perl-libsass also compiles fine (strawberry perl on windows with mingw gcc).\n[update] Travis-CI is still ok with your PR!\n\n\nIMO source maps do need some better testing. I may include more sophisticated tests in perl-libsass (which I basically already use to test the C interface) for source maps, but it would be much better to have this tested directly by libsass. Maybe we should open anissue to track all source map related issues!??\n. Feel free to open a more genric issue about source maps!\nI actually have done a lot in this area (mostly in perl for webmerge). I have seen a lot of different approaches to generate source maps. Some tools even decide to map every byte of the input to the output. But I fully ACK that it should mention every token that is relevant. Unfortunately there is no documentation what so ever how source maps were intially implemented in libsass (no blame to anyone)!\nIMP my [WIP] branch actually implements these less options:\n--source-map-less-inline puts the less files into the map instead of referencing them\n --source-map-map-inline  puts the map (and any less files) into the output css file\n. I can now confirm the issue on node-sass and windows. Also that this PR \"fixes\" it.\nI also got a local node-sass branch to compile and pass the full test suite.\n. Closing this in favor of https://github.com/sass/libsass/pull/591\n. By the way I think I now understand what the problem was:\nremove_line gets called too often (locigally removing more lines than added). This lead to an overflow on output_position.line. It then probably tried to add 18446744073709551615 semicolons to the source map. I will add the fallowing guard to the remove_line function. But this indicates another problem with source maps, as this should not happen.\nvoid SourceMap::remove_line()\n  {\n    if (output_position.line > 1) {\n      output_position.line -= 1;\n      output_position.column = 1;\n    }\n  }\n. The actual source of the problem is that remove_line is called to often in output_nested.cpp. I don't think that will be an easy one to fix! I've added the guard from above to the code and it at least does no longer crash (but it indicates that the line numbers in the mappings may not be reported correctly).\n. Looks like a duplicate of https://github.com/sass/libsass/issues/553? Have you tried with latest master?\n. OK, thanks for taking the time to test it :+1: \n. It does not directly adress that issue, but I already changed/fixed some bits there:\nhttps://github.com/sass/libsass/commit/7c682a88f7c9c26717ad659fc939ca8b28903147#diff-24f01ab36b9575fb048acd94dc0abc1fL109\nBut I have no idea if that coincidentally also fixes this issue!?\n. This is actually far from ready ;) I'm currently in the process to get an overall view of the big picture. There are a lot of nitty gritty details, that have to be considered! Once I get this done, I hopefully can decide on a clean design to have this correctly implemented! The ETA for this WIP is \"some day in the future\" ;) I mainly did this PR to make my current work transparent to others.\n. I think we need to add some way to make this a collaborating effort ultimately, since it is basically impossible for me to test all variations myself. It boils down to have something like the sass-spec test suite, but for source mappings. It also is more complex than one might think in the first place.\nThe first findings that I'm pretty sure needs to be adressed, is which informations are stored for AST_Node. Currently it only stores the begining of a \"token\", but the ending might also be interesting to output. Libsass currently doesn't remember the position where it has found colons or brackets. But these informations are vital to create a more complete mapping! I so far have added the end position of each \"Token\" to AST_Node. Next on my list is to add some info of what type a mapping is (which should be handy to decide what to render in source maps and also for debugging purposes).\nUnfortunately this already gets very verbose in term of code lines added. So I probably have to add some more middleware to get rid of this (which is what I meant by \"getting a view of the big picture\").\nI will try to keep https://github.com/sass/libsass/wiki/Source-Map-Internals updated with my latest findings, but I probably won't have much time to work on this the next weeks!\n. I'm making some progress here. Had to add some status information to AST_Nodes just for debugging (can probably be removed once I figured out how exactly I want to add the mappings). Currently I'm figuring out how libsass generates it's output to get an idea how I could appropriately implement it cleanly. For this I'm using a perl module I had laying around to read the source-map json and generate some debug information. This is what it currently produces:\nSCSS Input\n@media (max-width: 600px) { A { color: foobar; } }\nCSS Input\n```\n@media (max-width: 600px) {\n  A {\n    color: foobar; }\n }\n/# sourceMappingURL=test.map /\n```\nSource Map Debug\n0:0:0:0:0:310 => Statement* Expand -> Media_Block (open)\n  0:7:0:0:0:104 => Expression* Eval::operator()(List* l) -> List (open)\n    0:7:0:0:0:7329 => Expression* Eval::operator()(Media_Query* q) -> Media_Query (open)\n      0:7:0:0:8:7330 => Expression* Eval::operator()(Media_Query_Expression* e) -> Media_Query_Expression (open)\n        0:8:0:0:8:854 => Expression* Parser -> String_Constant (open)\n        0:17:0:0:17:10854 => Expression* Parser -> String_Constant (close)\n        0:19:0:0:19:7325 => Expression* Eval::operator()(Textual* t) -> Number (open)\n        0:24:0:0:24:17325 => Expression* Eval::operator()(Textual* t) -> Number (close)\n      0:25:0:0:25:17330 => Expression* Eval::operator()(Media_Query_Expression* e) -> Media_Query_Expression (close)\n    0:25:0:0:6:17329 => Expression* Eval::operator()(Media_Query* q) -> Media_Query (close)\n  0:25:0:0:6:10104 => Expression* Eval::operator()(List* l) -> List (open)\n  1:2:0:0:26:3106 => Expression* cval_to_astnode -> Map (open)\n    1:2:0:0:0:717 => Selector_List* Parser::parse_selector_group() -> Complex_Selector (open)\n      1:2:0:0:0:801 => Complex_Selector* Parser::parse_selector_combination() -> Complex_Selector (open)\n        1:2:0:0:26:802 => Compound_Selector* Parser::parse_simple_selector_sequence() -> Compound_Selector (open)\n          1:2:0:0:0:805 => Compound_Selector* Parser::parse_simple_selector_sequence() -> Type_Selector (open)\n          1:3:0:0:1:10805 => Compound_Selector* Parser::parse_simple_selector_sequence() -> Type_Selector (close)\n        1:3:0:0:27:10802 => Compound_Selector* Parser::parse_simple_selector_sequence() -> Compound_Selector (close)\n      1:3:0:0:1:10801 => Complex_Selector* Parser::parse_selector_combination() -> Complex_Selector (close)\n    1:3:0:0:1:10717 => Selector_List* Parser::parse_selector_group() -> Complex_Selector (close)\n  1:3:-1:-1:-1:13106 => Expression* cval_to_astnode -> Map (close)\n  1:3:0:0:30:123 => Statement* Expand::operator()(Block* b) -> Block (open)\n    2:4:0:0:32:667 => Statement* Expand::operator()(Declaration* d) -> Declaration\n      2:4:0:0:32:835 => Declaration* Parser::parse_declaration() -> String_Constant (open)\n      2:9:0:0:37:10835 => Declaration* Parser::parse_declaration() -> String_Constant (close)\n      2:9:0:0:37:837 => Declaration* Parser::parse_declaration() -> String_Constant (open)\n      2:11:0:0:38:10837 => Declaration* Parser::parse_declaration() -> String_Constant (close)\n      2:11:0:0:39:854 => Expression* Parser::parse_value() -> String_Constant (open)\n      2:17:0:0:45:10854 => Expression* Parser::parse_value() -> String_Constant (open)\n    2:17:0:0:45:10667 => Statement* Expand::operator()(Declaration* d) -> Declaration (close)\n  2:20:0:0:48:10123 => Statement* Expand::operator()(Block* b) -> Block (close)\n3:2:0:0:50:10123 => should be 10310 ????\nThere are still a lot of issues, but IMO it's already a start. Thought I'd share that here :)\n. Hehe, yeah, that is how my default editor is setup, I actually like smarttabs and allman style ;)\n\nI will pretty sure release this as a standalone library, since I want to use it to speed up my perl source map library too. And it may also be handy if we want to test source-maps via sassc!\n. No, sorry, I really don't think so. This needs a lot more work!\n. I have a second WIP branch which tackles this problems from another side.\nThis fixes source-maps when selectors get expanded:\nhttps://github.com/mgreter/libsass/tree/source-map-test\nThat Branch already seems to produce better results than the current implementation, but it needs a lot more re-factoring and better testing (which I have started with the help of perl-libsass).\n. Closing in favor of #792!\n. I'm closing this in favor of https://github.com/sass/libsass/issues/381!\n\"... a charset rule should be added to the output\"!\n. I have checked off two features, since they should be implemented by #591, which is now included in master. As you already referenced, I've started to implement more mappings and already got something working. But to call this complete, it needs a lot more work. I guess we should keep this issue clean and have more detailed discussions in seperate threads!\n. @am11 can we close this and make more clear targets from this?\nIMHO points like \"Capture mapping for each token\" are not really satisfiable, since \"each\" is a very wide goal. Maybe you could factor out the concrete stuff that is still missing in libsass! IMO with my latests PR for source-maps we are at a point where we will need full whitespace parsing to make it even more correct! So my latest PR does not include bracket mappings etc.\n. This issue should (hopefully) be addressed/fixed by https://github.com/sass/libsass/pull/792.\nPlease try with latest master and open a new issue if the problem still exists.\nThank you!\n. Here is one of the builds that failed to generate the coveralls report. The problem is comming from gcov. I also compared the build commands from autotools no to yes and could not find any difference beside a sightly different output oder (probably due to parallel execution).\nfunctions.gcno:version '402*', prefer '406*'\nSegmentation fault\nI actually was able to install gcov from gcc 4.2 via llvm-gcc-4.2/lucid. Altough it got rid of the prefer another version warning, but had the same problems in the end and failed at too.\n. I have incorporated all changes @QuLogic suggested and have tested it pretty intensively.\nI am going to merge this now if the travis-ci build gives me a green light :)\nBeside cleaning up a lot of stuff in the build I added a way to link sassc dynamically to libsass.\nAs already mentioned this is dropping -std=c++11 in favor of -std=c++0x.\nThis speeds up the ci build dramatically, as we can now use the native compilers again!\nI really hope I catched all cases and that it will not break for anybody!\nThere are two regressions with code coverage (all related to automake and clang):\n1. Linking dynamically yields: sass-tester: hidden symbol 'atexit'\n   -> because libtool links additional libraries (crti crtbeginS crtendS crtn -nostdlib)\n2. Linking statically yields errors in code coverage\n  -> probably due to incompatibility with gcov and generated data\n  -> AFAIK this was working before the map stuff was added\nIMO it's not worth digging much deeper, as there are other successfull code coverage builds!\n. :+1: \n. Good catch and thank you for the PR!\n. As a side note: A proper implementation should release the memory of the variable as soon as it goes out of scope (I guess we don't have to deal with references and counting). AFAIK my last tests showed that ruby sass also does not do this, and libsass of course neither yet! This could IMO lead to potential DOS, since a simple very big @for loop will allocate at least one additional variable on each iteration. I thought about a memory limit for [ctx.mem] allocations, but for that we would need to have stats about all allocated memory sizes.\n. What's the status on this?\n. @xzyfer Added a comment to https://github.com/sass/sass/issues/1512, IMHO you're correct on this one!\n. I'm convinced now that this is a ruby sass bug. @xzyfer if you agree we can IMO close this (maybe see the example I posted in the issue you've opened). I already added it to the 3.2 milestone :wink: \n. There is an interesting difference in @support and @media when it comes to this. Added another comment to the ruby sass issue to document it. Not sure what to make of it though. Maybe we could alert the user of possible unwanted errors, but lets see what ruby sass has to say.\n. This should be solved by #910!\n. It certainly wasn't intended to be embedded by default and with my tests it did not seem to do that by default? But cannot re-test until later today! I guess I didn't see the behaviour because I always set that option to something in my bindings. Are booleans in C++ initialized to true by default??\n. Sorry, I didn't actually mean if it is initialized on declaration (which it obviously is not as you correctly stated above). But I had in mind that I saw the context beeing explicitly beeing intialized:\n(sass_context*) calloc(1, sizeof(sass_context))\nBut this is of course only done for the C interface, which may explain why I did not see this problem before. So I guess you're using libsass directly via the C++ interface?? I will now debug a little further to see if that is logically even possible (if C++ is not initing the context).\nIf that is the case I fully ACK that this should be fixed and properly initialized!\n. OK, this is probably a real issue when using libsass via C++ interface.\nIMO the options should get a default value in context.hpp like this:\n```\n// string with source to compile\nconst char* source_c_str = NULL;\n// for the image-url Sass function\nstring image_path = \"\";\n// for relative paths to the output\nstring output_path = \"\";\n// for inline debug comments in css output\nbool source_comments = false;\n// output style for the generated css code\nOutput_Style output_style = NESTED;\n// path to source map file (enables feature)\nstring source_map_file = \"\";\n// embed in sourceMappingUrl (as data-url)\nbool source_map_embed = false;\n// insert included contents into source map\nbool source_map_contents = false;\n// disable source map comment in css output\nbool omit_source_map_url = false;\n// treat source string as sass\nbool is_indented_syntax_src = false;\n// precision for outputting fractional numbers\nsize_t precision = 10;\n// status flag to skip source map updates\nbool _skip_source_map_update;\n```\nMy compiler did not complain, so I guess the header is the correct place for this!?\n. Good catch! :+1: Corrected it above. \nShould be interesting to checkout how libsass internally sets/enforces the default value for precision.\n. Unfortunately I cannot reproduce the reported behaviour!\n. http://stackoverflow.com/questions/11152160/initializing-a-struct-to-0\nIMO __block struct sass_options options = {0}\nSo can this bug be closed then?\n. Just tested it with perl-libsass and latest master.\nThis commit adds a fix for sources property: https://github.com/sass/libsass/commit/c33353d937704e6a0ac09ac62388aef3bfac70a1\nI removed some newlines from the outputs below!\n```\ncat test.scss\n@import \"include\";\nA { color: red; }\n```\n```\npsass is the cli for perl-libsass\npsass -m test.map test.scss > test.css\n```\n```\ncat test.css\nDIV { display: block; }\nA { color: red; }\n/# sourceMappingURL=test.map /\n```\n```\ncat test.map\n{\n        \"version\": 3,\n        \"file\": \"test.css\",\n        \"sources\": [\n                \"test.scss\",\n                \"include.scss\"\n        ],\n        \"sourcesContent\": [],\n        \"mappings\": \"ACAA;EAAM,SAAS;;ADEf;EAAI,OAAO\",\n        \"names\": []\n}\n```\nThis looks pretty much correct for me!?\nWhich bindings did you use to get the incorrect results?\nMaybe they do not set the correct options on the interface?\nWill now test when the files are in different folders!\n. OK, now the same test with subdirectories:\npsass -m out/test.map -o out/test.css in/test.scss\n```\ncat out/test.css\nDIV { display: block; }\nA { color: red; }\n/# sourceMappingURL=../test.map /\n```\n```\ncat out\\test.map\n{\n        \"version\": 3,\n        \"file\": \"test.css\",\n        \"sources\": [\n                \"../in/test.scss\",\n                \"../in/include.scss\"\n        ],\n        \"sourcesContent\": [],\n        \"mappings\": \"ACAA;EAAM,SAAS;;ADEf;EAAI,OAAO\",\n        \"names\": []\n}\n```\nAnother test with source-map in working directory:\npsass -m test.map -o out\\test.css in\\test.scss\n```\ncat out\\test.css\nDIV { display: block; }\nA { color: red; }\n/# sourceMappingURL=../test.map /\n```\n```\ncat test.map\n{\n        \"version\": 3,\n        \"file\": \"out/test.css\",\n        \"sources\": [\n                \"in/test.scss\",\n                \"in/include.scss\"\n        ],\n        \"sourcesContent\": [],\n        \"mappings\": \"ACAA;EAAM,SAAS;;ADEf;EAAI,OAAO\",\n        \"names\": []\n}\n```\nSeems everything in order here!\n. FYI: libsass does not write the output file itself, your binding does. So it is not guaranteed that your bindings actually passes that information down to libsass, where it is solely used for preparing the correct information in source maps !\n. It would be ideal if you could give a minimal test case. Best would be a simple css you feed to ruby sass and libsass and then both source-maps that get fed into autoprefixer!\n. By the way your example gives me:\nSyntax error: File to import not found or unreadable: foundation/functions.\n              Load path: D:/qweasd/css (DEPRECATED)\n        on line 58 of ..\\scss\\_settings.scss\n        from line 1 of ..\\scss\\app.scss\n  Use --trace for backtrace.\n. And are you sure it is not adding app.scss, you keep writing it adds app.css? I only see app.scss!?\nMy guess is the mappings which looks like this for me:\n\"mappings\": \";;;;;;;;;;;;;;;;;;;;;;;0+gDyCoVA,XXXX,....;\"`\nThis is very suspicious (I know the format pretty well). Unfortunately this is the only thing that I did not touch while reworking the source maps! It is still the same string, still produced by the same function.\nI may re-test this with my latest WIP branch, but for now I don't think I can do much more here!\n. This issue might (hopefully) be addressed/fixed by https://github.com/sass/libsass/pull/792.\nPlease try with latest master and open a new issue if the problem still exists.\nThank you!\n. Issue #549 seems to be another issue but might be related to https://github.com/sass/libsass/issues/623\n. I'm closing this since we have added appveyor windows CI and also created some new documentations for building on windows. Please consider the windows build files experimental! New Bug Reports are welcome but should be a bit more specific and have more details!\n. The \"weird issue with unquote(0xf00)\" seems to have been fixed in ruby sass!\n. By the comment of @am11 I'm going to close this for now! Re-open if validated to be a libsass issue!\n. IMO there is still some place for improvement with the include paths :)\nI also just found that there is another IMO obsolete api to compile in sass.cpp!\nRemoving it completely did not have any impact in perl-libass? Maybe someone can clarify!?\n. I'm pretty sure there are other places (like ast.cpp) where more complex makros are used.\nI just confirmed that it would be possible to move the complete C API to sass.h.\nIMO this would be the logical header if there was a shared libsass.so around!\n. @QuLogic maybe you could clarify this for me. I guess I have to return a pointer from all the make_sass_value functions. Which means I'll have to allocate the memory on the heap (which I guess makes a lot of sense, since this is what makes it very robust, as we only pass around a pointer, correct?). Otherwise I don't seem to be able to move all the structs to the main file.\nunion Sass_Value make_sass_boolean (int val);\n. I made some progress and was able to move all structs and other implementation details into sass.cpp, while only leaving functions that deal with pointers in sass.h. There are IMO some minor flaws with how the specific Sass_Values have to be accessed. I guess this area leaves some room for more improvement! Beside that the code in perl-libsass is much better readable with this!\nIMO I could change all setters/getters for Sass_Values to accept the generic value, instead of needing the fetch the specific struct first. But this may lead to crashes if people are passing it the wrong Sass_Value type. But the same applies to getters/setter for list values if you give it an index that is out of bound. So the question is if this is acceptable, as the user is able to check the length or type before calling the function? I could also add safe guards and do the checks everytime, but I do not like this idea!\nold: sass_color_get_r(struct Sass_Color* v);\nnew: sass_color_get_r(struct Sass_Value* v);\nI'm not yet sure if I should go for a typedef for Sass_Values. IMO it does not work to use the same name as @QuLogic suggested. I would probably need to create other names. But libsass seems to hide the pointer for Sass_C_Function too, so it might be a good idea to follow suit.\n. Next update\nRe-added sass_interface to support the old API side by side with the new API. IMO this will make the transition much easier for most bindings (ie. node-sass). For now I have splitted up the functionality into seperates headers and code files.\nsass_values - Sass_Value implementation\nsass_functions - Sass_C_Function_Descriptor\nsass_context - New context interface\nsass_interface - Old context interface\n~~I have also creates a separate sass_structs.h or should other internal code also only access the structs via the API functions? Well, there is just context.cpp that is still accessing the options directly. It should be trivial to move values.h and functions.h back to sass.h. Once the old sass_interface is gone, the rest could also be moved there!~~\nThere is no other place than sass_context that uses the struct directly, and that is exactly where it belongs :)\n. I got everything ready for a PR in another local branch.\n- Hide all implementation details in the new C API defined in sass_context.h\n- Split up Sass_C_Function, Sass_Value and Sass_Context in their own code files. This means we also have more (system) header files than before, but IMO that doesn't really matter.\n- Added new API beside the old. Include sass_interface.h for the old; sass_context.h for the new \n- New API context structs \"inherit\" from each other (unfortunately I was not able to forward declare this inheritance without exposing the struct again, should be possible IMHO). But you can cast them down youself or use the accessor functions of the API (recommended).\n- Removed automatic inclusion of sass2scss.h\n- Added \"load only once\" guards inside the header files (why is this not done with all header files?)\n- Normalized api struct names to camel case to match Sass_Value and Sass_C_Function\n- Added typedefs for Sass_C_Function_List and Sass_C_Function_Callback\nIf the implementor does not use C_Functions and Sass_Values it should work as before. \nThis should probably also improve memory usage, as Sass_Value is now only a pointer.\nWill need to update the docs before doing the PR!\nLooking into returning error status plus better include path handling now!\nHope you guys like it!\n//CC @am11 Would you be willing to try to compile it against node-sass?\n. I basically meant that it should still compile as before if you do not use functions or values in the binding! Would be interesting to know if this is really the case! Beside that feel free to try to adapt node-sass to use the new interface, but I'll add some more documentation once it is finished :)\n. Hmm, strange, will try on linux, as I can get this one running :)\nBy the way, sassc builds fine, but not sure if it is actually using sass_interface!\n@hcatlin : Not sure what you mean by \"generic\", but yeah, there is the possibility to hook functions into libsass pretty easy via C.\n. @QuLogic I was thinking about the consts and to be honest I am not really sure where they make sense and where not. Maybe you could give some pointers I could fallow?\n@hcatlin It actually was ripped out with a refactoring about a year ago, I added them back (also about a year ago) since perl-libsass already supported them (and they are IMO quite usefull). But a more generic solution seems even better (I guess this could even co-exist). I may have a look and see how difficult it would be to add something (I already wanted to check if overloading imports etc. would be feasable).\n. @QuLogic I guess -Wextra pointed me in the same direction!\nI am now checking if I can get node-sass to compile on linux!\n. @am11 Got it compiled on linux, was just some header missing as @QuLogic pointed out correctly!\nmake: Entering directory `/root/node-sass/build'\n  CXX(target) Release/obj.target/binding/src/binding.o\n  CXX(target) Release/obj.target/binding/src/sass_context_wrapper.o\n  CXX(target) Release/obj.target/binding/src/libsass/ast.o\n  CXX(target) Release/obj.target/binding/src/libsass/base64vlq.o\n  CXX(target) Release/obj.target/binding/src/libsass/bind.o\n  CC(target) Release/obj.target/binding/src/libsass/cencode.o\ncc1: warning: command line option '-std=c++11' is valid for C++/ObjC++ but not for C [enabled by default]\ncc1: warning: command line option '-std=c++11' is valid for C++/ObjC++ but not for C [enabled by default]\n  CXX(target) Release/obj.target/binding/src/libsass/constants.o\n  CXX(target) Release/obj.target/binding/src/libsass/context.o\n  CXX(target) Release/obj.target/binding/src/libsass/contextualize.o\n  CXX(target) Release/obj.target/binding/src/libsass/copy_c_str.o\n  CXX(target) Release/obj.target/binding/src/libsass/error_handling.o\n  CXX(target) Release/obj.target/binding/src/libsass/eval.o\n  CXX(target) Release/obj.target/binding/src/libsass/expand.o\n  CXX(target) Release/obj.target/binding/src/libsass/extend.o\n  CXX(target) Release/obj.target/binding/src/libsass/file.o\n  CXX(target) Release/obj.target/binding/src/libsass/functions.o\n  CXX(target) Release/obj.target/binding/src/libsass/inspect.o\n  CXX(target) Release/obj.target/binding/src/libsass/json.o\n  CXX(target) Release/obj.target/binding/src/libsass/node.o\n  CXX(target) Release/obj.target/binding/src/libsass/output_compressed.o\n  CXX(target) Release/obj.target/binding/src/libsass/output_nested.o\n  CXX(target) Release/obj.target/binding/src/libsass/parser.o\n  CXX(target) Release/obj.target/binding/src/libsass/prelexer.o\n  CXX(target) Release/obj.target/binding/src/libsass/remove_placeholders.o\n  CXX(target) Release/obj.target/binding/src/libsass/sass.o\n  CXX(target) Release/obj.target/binding/src/libsass/sass2scss.o\n  CXX(target) Release/obj.target/binding/src/libsass/sass_values.o\n  CXX(target) Release/obj.target/binding/src/libsass/sass_functions.o\n  CXX(target) Release/obj.target/binding/src/libsass/sass_interface.o\n  CXX(target) Release/obj.target/binding/src/libsass/sass_util.o\n  CXX(target) Release/obj.target/binding/src/libsass/source_map.o\n  CXX(target) Release/obj.target/binding/src/libsass/to_c.o\n  CXX(target) Release/obj.target/binding/src/libsass/to_string.o\n  CXX(target) Release/obj.target/binding/src/libsass/units.o\n  CXX(target) Release/obj.target/binding/src/libsass/utf8_string.o\n  CXX(target) Release/obj.target/binding/src/libsass/util.o\n  SOLINK_MODULE(target) Release/obj.target/binding.node\n  SOLINK_MODULE(target) Release/obj.target/binding.node: Finished\n  COPY Release/binding.node\nmake: Leaving directory `/root/node-sass/build'\ngyp info ok\nJust don't forget to add the new source file sass_values.cpp and sass_functions.cpp ;)\nBy the way, how do I run the test suite once I got it compiled??\n@QuLogic dropped most of the consts (only left the ones for char*)!\n. I added the following includes to all C headers.\nBeside them no other system headers are used!\n```\ninclude \ninclude \n```\nFor the node-sass warning see here.\n. Updated the documentation wiki page for a better overview!\n. And added json error reporting for the new context API! //CC @am11\n. @hcatlin Regarding generic callback function:\nGot some time left and implemented a generic callback for unknown functions.\nUnfortunately I was not able to prepend the original function name to the arguments!\nIn my bindings I can now define a function named * to get called for all unknown functions!\nIMO we could use this interface also to overload @import and @warn statements!?\n. Next commit adds possibility to overload @warn statements.\nInstead of printing to cerr a custom function is called instead!\n. Thanks for all the feedback. If no one objects I'm going to create a PR now!\n@am11 For the errors in json, please see this commit here:\nhttps://github.com/mgreter/libsass/commit/584932c9f28838c4d92cf03e7bf43e18d88abd09#diff-9bb0436549f98af72f08f10e1695a7caR256\nI also tried to overload import, but that seems to be a bit more difficult as this is happening in parser, which does not seem to have access to env, where the custom functions are stored. Otherwise it would probably have been trivial to add import overloading!\n. You have to use the new API then (or you port that part back to sass_interface yourself).\nSorry, but I have to give some incentive to switch over to the new API :)\n. IMO we can/will keep the old libsass_interface around for some time!\nThis should ease the process of getting all implementors (sassc) to the new API!\nThe option name have all stayed the same. Just replace sass_interface.h with sass_context.h.\nThen it should not be very hard to update to the new API, mostly just do what the compiler says :)\nMost importantly you need to replace all direct access to structs with one of the new function calls.\nWould be cool if you could document your problems and findings to create some \"API upgrade\" doc!\n. Pull request has been placed: https://github.com/sass/libsass/pull/635\nPlease give your thumbs up if you like to have this merged!\nSorry to also include the other commits, but I'm too lazy right now to take them apart ...\n. > So creating a totally fail-safe API at the expense of performance (no matter how small the decline in performance) isn't a good deal in my opinion\nThe API is only used to setup the context and has no influence on the libsass compilation speed. \n. @QuLogic Maybe you could explain why this leads to a more robust ABI? I _ guess_ I know why, but some clarification would be greatly appreciated (specially regarding libtool)!\n. My guess was, that if we add more stuff (functions) to the header and that library get installed over an old one in the system lib folder, software that was built against the old library (dynamically linked), will still work/link happily with the newly installed one. Correct? IMO this would also be true if we always added stuff the end end of the structs, but not if something got added in between ...\n. Good point with uninitialized structs because of wrong initialization.\nI remember one bug report that was caused by this missuse of the API.\n. Thanks for all the Feedback!\nI have merged the changes into master branch!\n. ACK, it probably shouldn't be on that array. Sorry, I was not really passing included_files back till lately in perl-libsass, therefore I haven't had any unit tests for this! Unfortunately the array gets sorted before returning, therefore you'll get stdin on that position. Since it is only a status array and not used internally it should be trivial to add a check before adding it to the array (also because the other paths are absolute, which means \"stdin\" is not a valid path for any other file).\nOn another issue, I have removed num_included_files in favor of using a null terminated \"array\". But sass_interface is still using it. I probably just have to copy the updated code from the new sass_context to fix this!\n. Was a bit more complex! Aded some more info to this commit message!\n. This should be fixed by https://github.com/sass/libsass/commit/9b984fae60849764f2425a82751f138ef80b3509\n. Thanks @craigbarnes for trying it out. Good news it is still working with the old interface!\n. By the way, the commit with the custom import overloading also slipped through.\nDid a lot of basic tests with it, so I guess it can stay as it also is part of the C API.\n. Had some time to merge and clean-up the commit history!\nIn the spirit of @hcatlin (if I remember correctly), I'm giving this a :+1: ;)\n. By the way, I've updated perl-libsass to support the complete new API (incl. importer).\nHave not yet added unit tests or documentation there, but might be usefull for some people.\nhttps://github.com/sass/perl-libsass/blob/api/c-interface/lib/CSS/Sass.xs\n. Seems like there is always something than can be further improved :)\nIn the mean time I have adjusted sassc to use the new api in a local branch.\nJust to mention I also did some basic memory leak stress tests with perl-libsass!\n. Rebased to latest master!\nAny more comments on this PR?\nWould like to merge this soon, as rebasing could get difficult.\nIMO we can still tweak the API further after it has been merged!\n//CC @hcatlin, @akhleung, @xzyfer, @am11, @QuLogic \n. Since nobody spoke up, I guess I can merge this, in about one hour!?\nnode-sass and perl-libsass are ready to move over to the new API.\n. No, of course it will not segfault under that condition. And it should do exactly the same thing as with normal imports if you pass it only a file path. It will not try to load it if you also pass some content with it, then it is IMO only used for source-map path generating.\n. Hmm, seems like you found the first bug in the new API since I merged it.\nToo strange it returned the correct error when I tried it with perl-libsass!?\nHotfix is here: https://github.com/mgreter/libsass/tree/hotfix/skip-compile-on-error\nApology for the inconvenience!\n. Hmm, in case of sass_file_context there is no data or source_string, that is only available for sass_data_context, so I wonder if you really created the correct context!? I kept it apart as in the original implementation there was also a folder context declared (but never implemented).\n. I guess what you actually want is to query that list before the compile step is taking place. This way you could retrieve that information without triggering any compiling issues. Am I right? Be aware that this could still fail, but only if there are problems resolving the imports etc. and not with compilation issues.\n@akhleung Can you confirm that imports are fully resolved before compilation? Or is there some way to add more includes during the compilation phase? If not I would propose the fallowing:\n- Split compile_file/string (in context.cpp) into parse and compile steps. Add some API functions to just call the parse step to query the included files afterwards.\n- Set the included files array on the result before the compilation step, so it contains something even in case of compilation errors.\n. Added a commit to the C API refactoring PR!\nThis should enable implementors to do what @akiran was asking for!\n. This should be fixed by https://github.com/sass/libsass/commit/2a57715e30f2399638353ab7cfda90014754db3f\nAdded example to the API Documentation\n. This should be solved by #910!\n. I'm closing this since we have added appveyor windows CI and also created some new documentations for building on windows. Please consider the windows build files experimental! New Bug Reports are welcome but should be a bit more specific and have more details!\n. Can you rebase and put everyhing in one commit so it passes all CI builds? If so I guess we gladly will merge this! You can force push anything to your local branch to get this PR updated!\n. Looking forward to it :+1: \n. Going to close this in lack of interest. Although I liked the idea to have more DRY code! @avoliva Please open a new PR based on latest master if you would like to have this included! Thanks!\n. FYI: I get a success for this test with https://github.com/sass/libsass/pull/1600 ??\n. I got a positive result with my test runner with that branch!\nWondering why now or put different, why did it not pass before?\n. Me neither, that's why I posted here, since it seems this is still in todo?\nAnd now I see this is a PR and not an issue ticket (wrong number for todo test?)\nHmm, maybe something was off with my test suite, cannot check right now ...\n. I tested your original file against ruby sass and it fails to compile also!\nIt is also not properly parsed with CR line endings, since it reads everything in as one line!\nI fixed the latter in sass2scss to also support mac line endings, but that does not solve this issue!\nYou should give your files proper extensions and since ruby sass does not seem to support this scenario either, I'm going to close this.\n. Can you give some more hints what you're trying to do?\n. This is supported by libsass, not sure about node sass though!\n. https://github.com/sass/libsass/commit/622e586a8905c17c5191fd3e63fe9cef44a9c2e7\n. From your code I guess you are mixing old and new API?  Sass_C_Import_Descriptor will only work with the new API and sass_compile_file(sass_file_context * c_ctx) seems to be from the old API. \nMaybe we should add something to avoid beeing able to include both API headers at the same time ...\nOn your remarks on copy_strings you are right, it should use parentheses. It should not make much of a difference for the second allocation (since the size of one char is pretty much always one byte). But for the actual pointer array, it could make a difference (I would guess it should be short of 3 to 7 bytes, either if you have 32 or 64 bit pointers). Added a commit to address this.\nIMO calloc is not needed as all the allocated memory is overwritten properly in that function.\nFunny that nobody ever had this issue, since the function is pretty much called for every compile!\n. When I compile this on linux I get:\nError: File to read not found or unreadable: test.scss\nIs this still an issue with latest master?\n. Works for me!?\ntest.scss:\n@import \"inc\";\ninc.scss\na { color: red; }\n# ./main\na {\n  color: red; }\n. Thanks for digging into the issue :+1: I will have a look and add your fix.\nAnything speaking against adding both fixes (IMO it shouldn't hurt much)!?\n. Looks fine for me :+1: \n. Uh, that issue is the devil! Good thing there's no typo in angles rofl\n. I have ported some perl code to c++ in a side project to get something going.\nSo far I can read source maps (V3) and have the basic classes in place.\nI guess what you are looking for is a remap function!?\nhttps://github.com/mgreter/sourcemap.cpp\n. You need to be more specific what you mean by \"add\" or \"append\"!? This is not really possible with source-maps!?? But I'm pretty sure what you are looking for is something I already implemented for webmerge (I called it remap). But no, this is not yet part of libsass!\n| What do we use to create the source maps in libsass:\nYou give libsass some input and we will create some output. The source-map will map tokens in the output back to the input, simple as that. Unfortunately I do not really understand the second question! But I guess I know what you want to do. Let me give an example:\nYou (as the pre-processor) have two input files which you combine to one output file. You create a valid source-map for this operation. Now you give your output to libsass, which will generate the final css and another source-map. the libsass source-map will only point back to the \"intermediate\" input file (the one the pre-processor generated), but in reality it should point back to the two original input files, right!? This would be exactly the use case for my \"remap\" function. This is really just an operation on two source-map (it just \"connects\" the pointers from source-map b to a).\nThe custom importers already have an argument to pass a srcmap for exactly this reason, but so far we do not have anything implemented (it is just already defined on the API). As you may see, I'm currenty developing a C++ library to abtract most of this stuff for libsass. Once this is in place it should be much easier to work with source-maps from a coding stand-point.\n. That's exactly what my intensions are. It's just much easier to develop this as a standalone library first, and I can re-use it for webmerge to replace my slow perl implementation. For libsassinput files, it should IMO check if there is a sourceMappingUrl. If so, it should automatically remap it. We still have a few problems with source-maps themselve in libsass, so don't expect anything soon!\n. I created a collective ticket to keep track this and other \"non-urgent\" feature requests, in order to keep the issue tracker a bit more clean for the more 1st aid issues. I would like to encourage everybody interested in this particular feature to add their comments into this closed issue anyway.\nThanks for your understanding and your contribution!\n. This was a bug in sass2scss and should be fixed by https://github.com/mgreter/sass2scss/commit/15ee498f8354af4748381641545d8a47fd4ca2dd and https://github.com/sass/libsass/commit/21688e1979bff089a13d9a44ad0608357b2a91cc.\nI have added a unit test for it in perl-libsass.\n. I have slightly changed your commit to be more inline with the naming of the other functions!\n// Setters and getters for callbacks on function lists\nSass_C_Function_Callback sass_function_get_list_entry(Sass_C_Function_List* list, size_t pos);\nvoid sass_function_set_list_entry(Sass_C_Function_List* list, Sass_C_Function_Callback cb, size_t pos);\nHopefully shouldn't be too much work to rename your existing code.\n. This is addressed by https://github.com/sass/libsass/pull/685!\nPlease re-open if not working!\nThanks for the report!\n. You will also need to account for quoted strings!?\nSo a simple balancing of () will not work, IMO?\nI still think that we could postpone that for expressions (it's javascript!).\nFor progid and all other param like structs, this should work pretty well IMO!\n. Do you want to hold this PR? I'm +1 for merging it, since it does not change the old behaviour for expressions and the proposed enhancements can be added later. It covers a reported bug, so I would like to get this merged in! IMO performance is not a real issue, since it only changes the parsing for progid properties (and they should be parsed correctly anyway, as in emmitting source-map entries).\n. I'm also on the run, so will do this sometime this weekend :)\n. So can this be merged? Or any objections?\nI guess you can re-use random for PR 664\n. For me this seems to work correctly!?\nAre you sure you tried with lastest master?\nI'm pretty sure that this change should have fixed that issue already!\nThere are some reduntant tests here, but IMO that does not really matter!\nAs a side note, your PR is not very optimal. You should only cover one issue per PR!\nAs it is now, I cannot merge the test for only this issue, which would IMO be usefull!\n. Not sure if we really can call this a bug, since you should make a copy of that Sass_Value. How do you know what the lifespan of s_args is? You only know for sure, that it will be valid for the time that your function is executed. The return value itself will be freed later, since you give ownership of it back to libsass. So by returning the same instance, you tell libsass to free it twice (That's what I guess is happening). We should probably have made the input argument a const, but I'm not a native c++ developer, so I have to make educated guesses here!\n. I still think this is somewhat a valid bug report. But I don't know what's the best way to address this (should the arg be const?). I guess a sass_clone_value would be handy in this case (whatever the reason is to return the input value back). To be honest, it would not be the simplest function to implement (as it is recursive ... but feasible).\nCan this issue be closed beside the mentioned improvements? If so, feel free to open separate issues!\n. I don't really understand your last comment. The thing is that implementors do not have to free anything, but we expect you to create a new variable to return in custom functions. Adding const seems to only issue a warning for this case (which is better than nothing IMO). Not sure if we can do much more, other than documenting it properly and relying on implementors to handle it correctly.\nI also added a sass_clone_value function to the API, so you could do:\nunion Sass_Value* CustomFunc( const union Sass_Value* s_args, void* cookie ) {\n    return sass_clone_value(s_args);\n}\n. Maybe the chunk parsing could be used here too, as with the url parser!?\n. @xzyfer I guess we can close this minor issue. IMO I have changed the parsing with my latest commit anyway! What do you think? I'd say let's wait if someone screams that it is really broken!\n. I'm actually OK with merging this. The feature should work and I would like to get the API changes for the importer in ASAP. I initially thought about unifying all the needed info directly into sources (which seems to be the main storage variable for loaded files),  so import_stack could just reference it.\nBasically that would get rid of this:\nC++\nsources.push_back(contents);\nincluded_files.push_back(abs_path);\nqueue.push_back(Sass_Queued(load_path, abs_path, contents));\nsource_map.source_index.push_back(sources.size() - 1);\ninclude_links.push_back(resolve_relative_path(abs_path, source_map_file, cwd));\nBut this can be postponed to a later point!\nContent is only referenced by pointers (freed via sources)!\n. Yep, updating the docs is on my todo list. There was a small change in that API: https://github.com/sass/libsass/commit/34a5752bcaad6c401c641897f352ca7c59f4c252\nC\ntypedef struct Sass_Import** (*Sass_C_Import_Fn) (const char* url, const char* prev, void* cookie);\nYou probably only need to add const char* prev to your importer. This was added since you should do imports relative to the parent context. This will provide you the needed information to the path or url or whatever you gave it with the previous import.\n. I wouldn't call the variable prefix, since it contains also the filename of the previous import.\nI guess it is not very obvious what this \"feature\" is about, so I try to give a small example:\nLets say we have this local scss file \"import.scss\":\n```\n@import \"http://assets.example.com/styles.scss\";\ncustom importer gets called with:\n\"http://assets.example.com/styles.scss\", \"import.scss\", *cookie\n```\nThe file on the server has this content:\n```\n@import \"partial.scss\";\ncustom importer gets called with:\n\"partial.scss\", \"http://assets.example.com/styles.scss\", *cookie\n```\nSomce the second import is relative, it should be relative to its parent (which is on a remote server in this case). We added this string to make this information accessible to implementors.\nWith second thoughts it might have been better and easier to just have a function to query the import stack. IMO this feature is pretty important for custom importers, so I would like to ship it with the first release that includes the new API. Your opinions @am11, @xzyfer ?\n. Good point, I guess the sample is still incomplete :)\n```\n@import \"partial.scss\";\ncustom importer gets called with:\n\"partial.scss\", \"http://assets.example.com/styles.scss\", *cookie\n@return \"http://assets.example.com/partial.scss\", *loaded_data\n```\nNext import looks like this:\n```\n@import \"second-partial.scss\";\ncustom importer gets called with:\n\"second-partial.scss\", \"http://assets.example.com/partial.scss\", *cookie\n@return \"http://assets.example.com/second-partial.scss\", *loaded_data\n```\nIt may should be noted that you must include loaded_data in this case, since libsass will not know what to do with the url. I guess it currently will just try to load it from the filesystem.\nIt's not as sophisticated as the original ruby sass importer; but it's a start.\n. I don't think I can follow where you want to go with that. Can you come up with a use case or example!?\nI'm thinking about reverting the additional callback parameter and use functions to query the stack:\nsize_t sass_importer_get_stack_size();\nconst char* sass_importer_get_stack_url(size_t idx = 0);\nI actually like this a lot better! Sorry for the detour @am11, but I really think I should have done it that way in the first place. Oh well, rome wasn't built in a day either ;)\n. I don't think libsass will support this anytime soon (probably never). And this is quite reasonable, since we want to concentrate on the sass part and not how to \"interface\" with the outside world. We like to have our tiny and well defined API and let the outside world mess up things :) \nUnfortunately again I have to abandon my previous idea with the additional API functions.\nProblem is, that this information is only stored in C++ currently. And it would take quite some time to make that available to the C-API. It might happen once the mess with all the status variable in sass context has been cleaned up.\nSo for now I will leave it as it is. IMHO you can do the correct stuff now with \"nested\" import calls in any way your context suits you. But I agree that this makes it impossible to access any \"grand-parent\" imports. Not sure if this really is a common use case!? For now we let the implementors do all the hard work, we only provide the raw information. I guess it's better than nothing!\n. Thanks for checking it out. Will add your example to my other perl integration tests. If you are right this needs some more work. Will have time in some hours ...\n. I tested your sample with perl-libsass and unfortunately it works correctly here:\n- https://github.com/mgreter/perl-libsass/blob/api/c-interface/t/07_custom_importer.t\n- https://travis-ci.org/mgreter/perl-libsass/builds/44367196\nAre you sure you return the right thing from the importer? Looks like you don't!\nAs for the path, I would guess \"c:/.../.../\" is not a valid windows path (forward slashes).\n. OK, I just pushed a commit to master which probably fixes at least some parts of the problem you have. I noticed you do not return a filename and this caused some problems on linux (which I wasn't aware off).\n. As I said, you need to make a copy via sass_clone_value in this case. The compiler will issue a warning if you told it to do so. But it will still let you do insane things.\n. If no one has any more objections I'm going to merge this soon!\n. IMO this is ready to be merged!\nThen sassc/pull/81 can be merged!\n. These are C macros which can be defined and overruled in various ways.\nThis is part of the libsass build, which gets the version from the local git repo.\nOverruling the version on compile:\nLIBSASS_VERSION=\"x.y.z\" make ...\nIf you compile it yourself, make sure the macro is defined correctly:\ng++ -Wall -fPIC -O2 -DLIBSASS_VERSION=\"\\\"x.y.z\\\"\" ...\nI guess that's what you meant by fallback option?\nNo way around to define it at compile time beside hardcoding (and constantly updating) it!\nSince macros are pretty common there probably should be an option for your build tool!?\nBy the way, you get [na] because we have this in sass.h\n```\nifndef LIBSASS_VERSION\ndefine LIBSASS_VERSION \"[NA]\"\nendif\n```\nHTH!\n. The logic here seems pretty simple. If the string contains double quotes and no single quotes, it is wrapped in single quotes. This seems to be true for all output styles (I checked).\nBy the way, I used this test to verify the behaviour:\n``` css\n$str01: \"{\" + '\"' + \"}\";\n$str02: '{' + '\"' + '}';\n$str03: '{' + '\"' + \"}\";\n$str04: \"{\" + '\"' + '}';\n$str05: \"{\" + \"\\\"\" + \"}\";\n$str06: '{' + \"\\\"\" + '}';\n$str07: '{' + \"\\\"\" + \"}\";\n$str08: \"{\" + \"\\\"\" + '}';\n$str11: \"{\" + \"'\" + \"}\";\n$str12: '{' + \"'\" + '}';\n$str13: '{' + \"'\" + \"}\";\n$str14: \"{\" + \"'\" + '}';\n$str15: \"{\" + '\\'' + \"}\";\n$str16: '{' + '\\'' + '}';\n$str17: '{' + '\\'' + \"}\";\n$str18: \"{\" + '\\'' + '}';\n$str21: \"{\" + \"\\\"'\" + \"}\";\n$str22: '{' + \"\\\"'\" + '}';\n$str23: '{' + \"\\\"'\" + \"}\";\n$str24: \"{\" + \"\\\"'\" + '}';\n$str25: \"{\" + '\"\\'\"\"\"\"\\'' + \"}\";\n$str26: '{' + '\"\\'\"\"\"\"\\'' + '}';\n$str27: '{' + '\"\\'\"\"\"\"\\'' + \"}\";\n$str28: \"{\" + '\"\\'\"\"\"\"\\'' + '}';\n.interpolation-test {\n  test01: \"#{$str01}\";\n  test02: \"#{$str02}\";\n  test03: \"#{$str03}\";\n  test04: \"#{$str04}\";\n  test05: \"#{$str05}\";\n  test06: \"#{$str06}\";\n  test07: \"#{$str07}\";\n  test08: \"#{$str08}\";\ntest11: \"#{$str11}\";\n  test12: \"#{$str12}\";\n  test13: \"#{$str13}\";\n  test14: \"#{$str14}\";\n  test15: \"#{$str15}\";\n  test16: \"#{$str16}\";\n  test17: \"#{$str17}\";\n  test18: \"#{$str18}\";\ntest21: \"#{$str21}\";\n  test22: \"#{$str22}\";\n  test23: \"#{$str23}\";\n  test24: \"#{$str24}\";\n  test25: \"#{$str25}\";\n  test26: \"#{$str26}\";\n  test27: \"#{$str27}\";\n  test28: \"#{$str28}\";\n}\n```\nResults in\ncss\n.interpolation-test {\n  test01: '{\"}';\n  test02: '{\"}';\n  test03: '{\"}';\n  test04: '{\"}';\n  test05: '{\"}';\n  test06: '{\"}';\n  test07: '{\"}';\n  test08: '{\"}';\n  test11: \"{'}\";\n  test12: \"{'}\";\n  test13: \"{'}\";\n  test14: \"{'}\";\n  test15: \"{'}\";\n  test16: \"{'}\";\n  test17: \"{'}\";\n  test18: \"{'}\";\n  test21: \"{\\\"'}\";\n  test22: \"{\\\"'}\";\n  test23: \"{\\\"'}\";\n  test24: \"{\\\"'}\";\n  test25: \"{\\\"'\\\"\\\"\\\"\\\"'}\";\n  test26: \"{\\\"'\\\"\\\"\\\"\\\"'}\";\n  test27: \"{\\\"'\\\"\\\"\\\"\\\"'}\";\n  test28: \"{\\\"'\\\"\\\"\\\"\\\"'}\";\n}\nEdit: Added another test which IMHO shows a minor ruby sass bug. IMO `\"{\\\"'\\\"\\\"\\\"\\\"'}\" should be quoted in single quotes, at least in compressed output, since it is shorter than using double quotes. This would of course need additional logic, but such logic exists for i.e. color names.\n. This should be solved by #910!\n. I would like to get https://github.com/sass/libsass/pull/691 merged before the next release, since it contains some minor API updates. It already works, but it should be implemented a bit cleaner IMO. BTW. the old API is still in place and should not stop working (if no Sass_Values are used). I also have a branch around for sassc to update to the new API. Beside that there's nothing on my side against 3.0.3 :+1: \n. OK, I guess/hope I can get my open things sorted out till this weekend!\n. @xzyfer, @am11 Nothing speaking against it from my side.\nIMO there are two other PRs which could be merged before:\nhttps://github.com/sass/libsass/pull/718 - Improve color token operations\nhttps://github.com/sass/libsass/pull/724 - Add tap reporter to test targets\n. @xzyfer I've ammended your original post. Hope you don't mind!?\nIMO most open issues are only a question if we want to ship it or not!\nI'll push my changes for the perl examples when all PRs are merged/decided!\nAs for the open Tasks (aka Documentation)\nFirst I want to give some props to @drewwells for his contributions to the API wiki pages!\nIn the spirit of \"momentum rolling\", I would love to see if we could gather a bit more documentation for the next release. I will have my share with updating the API docs to make sure it matches the latest. If anyone needs some ideas what could be documented :wink: \n- what does is_delayed mean?\n- what does is_hoistable mean?\n- how does the lexer/parser work?\n- what are the roles of inspect and eval?\n- how is unicode handled?\n- what is a environment?\n- what is a context?\nOr what is your opinion on the documentation situation? IMO I really hope people will continue to contribute to the wiki pages and the documentation! It's very much appreciated from my side!\n. perl-libsass is ready!\nI only have two build related PRs open:\n- https://github.com/sass/libsass/pull/742\n- https://github.com/sass/sassc/pull/85\nThe windows build part should be considered experimental!\nIMO updating the build instructions in the readmes should be next todo!\nThere is also a regression open which I just created a PR for:\n- https://github.com/sass/libsass/pull/749\n. Merged all the PRs above and will now start to update/write documentation how to build libsass/sassc!\n. Damn, appveyor created this url for the \"official\" libsass:\nhttps://ci.appveyor.com/project/mgreter/libsass-513\nMaybe only \"owners\" can enable the correct url!?\nhttps://ci.appveyor.com/project/sass/libsass\n@hcatlin Could you try enable libsass on appveyor with your account?\n. Maybe someone has some time to review these:\n- https://github.com/mgreter/libsass/wiki/Building-Libsass\n- https://github.com/mgreter/libsass/wiki/Building-with-makefiles\n- https://github.com/mgreter/libsass/wiki/Building-with-autotools\n- https://github.com/mgreter/libsass/wiki/Building-on-Windows\n- https://github.com/mgreter/libsass/wiki/Building-shared-system-library\nFeel free to edit the pages on my local repository!\n. Autotools has a --disable-shared option!\nAnd you can set --prefix to install it somewhere else :wink: \nBut these are all standard features of autotools, not libsass!\n. Oh, and I'm looking for someone who could document how to build libsass on Mac OS X ...\n. That would be great. I also guess you need to install the compiler somehow (homebrew?). Would be great if you could write that down. I already tried to cover some parts by mentioning how to use clang instead of gcc (virtually untested). By the way I'm migrating the wiki now to libsass repo.\n. See https://github.com/sass/libsass/wiki/Building-Libsass#building-on-different-operating-systems :wink: \n. Added a few more item! :boat: :rocket: \n. I'm logging off now for a few days to enjoy my holidays!\nWell, I might check the messaged here from time to time :wink: \nWish you all a merry x-mas and a happy new year!\n:tada: :christmas_tree: :meat_on_bone: :fireworks: \n. @hcatlin Could you try enable libsass on appveyor with your account? I don't seem to have enough rights to enable the correct url: https://ci.appveyor.com/project/sass/libsass\n. @nschonni I thought that @hcatlin should have the right since he is a owner of the sass org, I'm only a commiter. Maybe @hcatlin you can check again if you can get it done via your account at \"top-right-corner\"->\"Team\"->\"GitHub teams\"? Other than that I'm out of ideas ...\n. @hcatlin btw. we still have \"update Readme.md for new API\" on the ToDo list. IMO we could get rid of that part in the readme and just link to the wiki instead? Seems redundant to copy information from the wiki back there!?\n. I still get \"Project not found or access denied\" on https://ci.appveyor.com/project/sass/libsass, which is the ultimate goal, since it corresponds to the github repo address!?\n. :+1: next ToDo to check off :smile: thx!\nWell, if it compiles correctly :wink: \n. Hmm, can someone give me the token to create the appveyor badge url? Seems to be a md5 hash or something, which I'm not able to retrieve on my own ...\nie. https://ci.appveyor.com/api/projects/status/fygd59bg9neny8qt/branch/master?svg=true\n. Thx @nschonni for your help!! I have deleted my local appveyor repository. Hope everything will just work as before, but now with the correct appveyor url!\n. Looks like the PRs are now built against the repo @hcatlin activated on appveyor. So I guess once @hcatlin deletes his repo (on appveyor), the PRs will then go to the correct url. Anyway, the url we got from @nschonni seems to build master anyway (slowely), so no big deal for now! \n. #789 should be fixed by #791! So lets get that version out! I guess it will not be long till 3.2, since we have a lot of interesting PRs pending already for that! Happy new year to everybody! :fireworks: \n. Can you confirm your bug is solved? If so go on an merge it in. It seems that appveyor did not pick up the changes for sassc somehow (well only for one target). I'll try to ammend that commit to try it again!\n. Sassc is always built to run the tests in our CI, so it should always be compatible with latest libsass! There is actually no need to have the same release cycles for sassc, since we don't release binary anyway!\n. No idea without actually trying it out! Chances are it still works!\n. #715 was merged which should fix this!\n. Is there some spec that defines how the functions can be invoked? I guess we currently only support straight lists as function arguments. How does ruby sass handle this!?\n. My bad, sorry! Changed the title to make it more obvious to me what this bug is about.\n. Actually this works for me:\n- https://github.com/sass/perl-libsass/commit/8fbbf678d7e23695896787f5c26c1ee859a3ede2\n- https://github.com/sass/sass-spec/pull/187/files\nPlease re-open if you still have the issue with latest master!\n. :+1: \n. @drewwells thanks for verifying! Glad it works!\nThe other issue you reported will be a bit harder to solve!\n. This should be covered by https://github.com/sass/libsass/pull/715\nBtw, THX for the wiki update :+1: \n. This seems to be node-sass related and not libsass!\nLooks somewhat related to https://github.com/sass/node-sass/issues/517!\n. There is a struct Sass::Error which was the main reason I hijacked Warning. So I guess we should rename that struct to something else. I would propose Sass::Sass_Error, since we have now pretty much all structs in the C-API prefixed with Sass_.\nEdit: Just checked and this makes a lot of sense. This struct is only used in parser.cpp and sass_context.cpp and sass_interface.cpp. I will prepare another commit for that!\n. What do you mean by \"explicitly asked for it.\"?\n. :+1: Thanks for the info! So I guess this implementation is on par with ruby sass! If we see a char above 127 we will output the utf-8 charset declaration, simple as that!\n. Unfortunately the link @xzyfer posted makes this related to https://github.com/sass/libsass/issues/381 :speak_no_evil: \nSince we probably will not have other encodings than Unicode (utf8 and maybe utf16) antime soon, I guess we can go on with the current implementation!? IMO this could be a task for implementors to resolve. I know this would be fairly easy with perl-libsass and custom importers, since I have all the necessary encoding/decoding rules available in perl.\n. OK, how do we proceed here? IMO we could ship this as-is with 3.0.3. To use less copy & paste we will need to create a common class for each output style. I already did that, but I think this needs a lot more work and fits perfectly into the source_map task, which I also have started some time ago.\nSo I would propose to ship this as-is and open two new issues:\n- Add option to make utf8 charset output optional\n- Create a parent class for compressed and nested output styles to unify common code\nThe second issue will be a pretty big task, since I think we should unfiy all the source mapping code into this class, so the actual implementation only passes \"stuff\" the be in the output to it. It basically should handle the buffer and create the source map automatically.\nThe only downside with the current code is that it repeats the same code block 5 times and that the feature is not optional (does ruby sass have a switch for that?). But it will not break working css!\nI guess I let you decide on this one!? But I don't think I can get this in in time otherwise!\n// CC @xzyfer, @hcatlin \n. Just fixed a bug I haven't seen. Charset should be the very first thing in the css, so it should be after regular css imports. Therefore I had to move the place where the charset is added to the get_buffer function, since otherwise generated_imported would be the first in output.\n. I also don't understand what has_non_hoistable really means! Some hints in this direction would be appreciated (beside the questions by @xzyfer )! //CC @akhleung \n. I cleaned up the commit and removed all references to is_delayed. Had to add normalize_color to exactly match the output of sass 3.4.9. @xzyfer do you think this is clean enough to be merged?\n. Indeed spec/basic/16_hex_arithmetic needs to be updated. I regenerated it with sass 3.4.9 and had to add the normalize_color call to match the expected output perfectly. The corressponding changes to sass-spec are here: https://github.com/mgreter/sass-spec/commit/5f070511c18631ac8ea8bcee4a28dd801d4146e6\n. Yep, there seem to be two edge cases that have changed in sass. One is the shortining of the color and the other is the \"weird issue with unquote(0xf00)\". Both issues are also related to 3.4 support blockers! and should be fixed by this.\n. Unfortunately your quote showed me another regression, and not sure how easy this is to fix. To do it properly I probably have to add and pass a few more tests that currently are not even in place. Souldn't be extremly hard, but this will take at least a few days till I can come up with a solution for this.\nOr do you think we should still ship it in the current state? It is still better than before but not on par with the current sass implementation!?\n. What is your definition of \"break\" :) The output format of colors is not preserved as per your previous comment. I guess I should revert the normalize_color, since it does not really do the right thing. Looks like we have to store the original format to check how to output it. But it looks like we currently do not really have any unit tests for that and the existing \"test\" uses the short form (and there is no test if it preserves the long form). So, no, IMO it does not break anything, since both formats are still valid css.\nOnly problem I see is that we have two separate things going in spec/basic/16_hex_arithmetic. One is fixed by this PR, but the other one does not yet match current sass behavior and I would need to adjust the test manually. But I probably have to take another look to be 100% sure why I had to adjust that test in the first place!\n. This was pretty much a piece of cake once it was obvious I had to preserve the input format. \nI also tested a few more things with sass and found it a bit strange that it does this:\nCSS\nt01: #abc; // => #abc\nt02: #aabbcc; // => #aabbcc\nt03: rgb(170, 187, 204); // => #aabbcc\nt04: rgba(170, 187, 204, 1); // => #aabbcc\nI thought I would also need to look into these, but they seem to convert as before. So this made it a lot easier and it looks like this is now actually on par with current sass implementation. Yeah! :boat: \n.  Ok, so travis-ci showed a regression with the second test this PR adresses in spec/basic/16_hex_arithmetic (the weird one involving 0xf00). I restarted the compile when I merged the sass-spec PR. I was able to track it down, but could not come up with a really clean solution yet. I think the last commit should at least get travis-ci going again (and actually fix that issue). But it's really not clean.\nhttps://travis-ci.org/sass/libsass/jobs/44259916#L336\nThe issue was that 0xf00 is actually interpreted as a number with a dimension. This is equal to ruby sass (I checked). Unfortunately this whole string (and not only the number) is passed to atof, which will convert it to a double with the value of 3840 (since it is a valid hex representation of f00). Therefore we should probably extract the number according to our rules before passing it to atof.\n. So travis is happy and spec/basic/16_hex_arithmetic yields the same result as ruby sass 3.4.9 (with a few patches here and there). I'm still positive to ship it that way as I'm pretty confident that the fix should do the right thing. But it's not pretty or very clean, I agree on that. But we cannot rely on atof to split the number and unit for us anyway.\n@xzyfer feel free to hit the merge button if you agree!\n. Would be nice if you could show us your example. Best would be a minimal test case! Thank you!\n. Thank you for taking the time to produce a minimal test case!\nIt surely helps us to get to the root cause faster; but I cannot promise any ETA!\n. Maybe someone could try the fix at https://github.com/mgreter/libsass/tree/fix/source-map-issues?\nUnfortunately we have no source-map tests, so I'm not sure if this breaks anything else, but IMO it is more correct than before! Maybe we can land this in the next release if somebody can confirm it works.\n. Your feedback improved that chance by a lot. Thx! Anyone else!?\n. I'm going to close this, since we have merged a possible fix!\nPlease re-open this only if the problem with leading ; occurs again!\n. Have you tried with latest master?\nTransparent was added pretty recently in https://github.com/sass/libsass/issues/700!\n. I'm closing this since I have added some new documentations for building libsass.\n. I'm sorry that we cannot be of any help here, but it seems like your compiler is not setup correctly. From the error message it is missing the string header, which should clearly be available!? Maybe you should try to resolve this issue with the support/forum for your linux distribution.\n. This issue should (hopefully) be addressed/fixed by https://github.com/sass/libsass/pull/792.\nI have created a common Output class from which nested/compressed inherit!\n. There were some changes to the build. Can you please post the complete command chain from starting with an empty folder? Libsass itself does not contain sassc ... but I guess you cloned master from the sassc repository first? Maybe try to run ./script/ci-build-libsass, this is how travis-ci builds are made  ...\nWe include the git version now in the compiled binary, that's what the new flag (actually it is a macro that gets defined) is doing. You can then query it via sassc -v.\n. Looks good to me! Should come in handy in future error reports!\nAnd there is an open task to update the wiki and the readme before the real release :wink: \n. I think you can just edit the pages and it will create revisions, so we could revert it if we need.\n. Have you tried this with latest master?\nel {\n  /* With a function, LibSass returns false, which is unexpected: */\n  content: true;\n  /* Using a mixin, LibSass returns true, as expected: */\n  content: true; }\npsass 0.3.0 (perl sass (scss) compiler)\n  libsass: 3.1-alpha-11-g379d\n  sass2scss: 1.0.3\n. @darrenkopp I hope you don't mind that I have taken over your project files from https://github.com/darrenkopp/sassc-win? I think it should work correctly now. Took me quite some time to figure out why it was giving me strange results with the test runner (seems ruby 1.9 was the cause). Beside that everything seems to work now. Once the PR on sassc is merged I can remove the reference to my local sassc repository!\nAlso the debug target on msvc throws some debug assertions, which seem to keep the build on hold forever till it times out. So I disabled the test-runner on that target.\n. I would speak against using the full feature set of cpp11, it already intoduced some headaches for the node-sass people since they provide prebuilt binaries. Some people still seem to be on systems which only provide gcc 4.4. ... \n. Pretty funny that this emerges the day I tried to compile it with gcc 4.4.4 => https://github.com/mgreter/libsass/commit/14e1d7ac3542fecdbac4198b135c77e0c0346cf0\nWe would be able to replace pretty much anything with std ~~C~~ C++ beside uniform_real_distribution and unordered_map (with the latter beeing available for gcc 4.4.4). \n. Sorry, should be std c++ 99 :wink: But I know, C++11 has some nice syntax sugar. Specially looping over containers, which is what we mostly use beside the other two features, which are much harder to replace (I guess).\n. IMO this is somewhat related to https://github.com/sass/libsass/issues/248\nI agree that it would not hurt much to make the indentation also configurable. IMO both options could/should be implemented to accept some arbitrary string to be used. This would make it very versatile and \"outsource\" the burden to decide for reasonable options.\n@am11 I also agree on the \"compressed output\" issue. IMO currently that mode is not working correctly anyway, and https://github.com/sass/libsass/issues/734 is basically trying to get this somewhat more in sync!\n. I have added a commit which should allow implementors to change this. I would consider this alpha since it could introduce subtle edge cases which we are not yet aware of.\n. I will also not include this in perl-libsass 3.1. and will do it the same way as you wrote (with the options). I thought about having all these options directly in libsass, but thought that I should not limit any implementors, since the basic option is really just a \"string\". I hope you agree on that? Therefore you have to provide a \"static string\" for this options, pretty much different from other \"string\" options!\n. Libsass will not free these strings! You have to make sure these strings live as long as the context. I advice implementers to use static strings (const char* lf = \"\\r\\n\") for these options. We do not make a copy, as we do with most other small strings (like output_path)!\n. Hmm, sorry, but not sure if you mean it's ok or not!?\n@chriseppstein wrote: \"libsass can handle this like Sass does, right now. Additionally, there's really no issue with either Ruby sass or libsass resolving @import \"foo/bar\" to a css file. The only issue is when the explicit css extension is specified. We would break backwards compat.\"\nThat's how I have implemented it in this PR!?\n. :+1: \n. @xzyfer I meant this one https://github.com/sass/sass/issues/556\n. It's not in sass currently IMO, but @hcatlin and IMO @chriseppstein haven spoken for adding it in this form. I'm also for it, since it does not really change the syntax significantly. It's just that we also check for .css extensions, when we also check for .scss and .sass. Which by itself is \"altering\" the syntax of css, btw. As I said, we can also make this optional and it's not hard to maintain (It's basically just one line).\nIt seems that sass will implement all these new import features with a @use statement ...\n. I more or less agree, but I don't see why we would have to remove it. I agree that this has to stay in, once it is in. But it's merely having another extension to query (which we will have to support forever anyway).\nThis seems already pretty easy in ruby sass: https://github.com/sass/sass/issues/556#issuecomment-64730080\n. I can only repeat, that this seems already very easy to do in ruby sass. I guess that's the reason why it's not enabled by default.\nclass CSSImporter < Sass::Importers::Filesystem\n  def extensions\n    super.merge('css' => :scss)\n  end\nend\nSass::Plugin.options[:filesystem_importer] = CSSImporter\nBut it's pretty hard to do in libsass when we only would need to add another extension to the lookup. But I'm OK with whatever the decision is here! IMO we could make it optional or even configurable to add additional extensions to the lookup!? //CC @hcatlin \n. Yes, only @import \"file\" will import a file.css (or _file.css).\nSomething like @import \"file.css\" still outputs a @import statement.\n. Actually the behaviour of #469 would not change since\n``` CSS\n/!\nTheme URI: http://mywebsite.com\nDescription: my theme description\nAuthor: whatwedo GmbH\nTemplate: Meola\nVersion: 0.1\n/\n// Parent Theme\n@import url(\"../meola/style.css\");\n```\nWill still become:\nCSS\n@import url(\"../meola/style.css\");\n/*!\nTheme URI: http://mywebsite.com\nDescription: my theme description\nAuthor: whatwedo GmbH\nTemplate: Meola\nVersion: 0.1\n*/\nSo I'm not sure where exactly your concerns are!?\n. It's not only the url, but also the explicit .css file ending!\nIt only works if the .css extension is NOT specified!\n@import \"file\"; // load partial file.(s[ac]ss|css)\n@import \"file.css\"; // create @import on top\n@import url(\"file\"); // create @import on top\n@import url(\"file.css\"); // create @import on top\n. I updated to last commit to keep the whole backtrace for warnings. Although it seems that libsass does not implement it correctly yet. None the less, I have adjusted the output format for warning backtraces to match ruby sass (tested it by manually adding an intermediate backtrace). I also moved the static get_cwd function to Sass::File (usefull if you want to call resolve_relative_path).\n. Sorry, removed the second commit! This one should compile fine, but feel free to assign another milestone for this one! Will create a second PR once and if I can fix the other issue!\n. Interestingly this commit changes the output for https://github.com/sass/libsass/issues/733 to\nCSS\nfoo {\n  content: 41px;\n  content: 41px;\n  content: 41px;\n}\n. @hcatlin how do we want to proceed with this open Issue. IMO it's not something we will ever do as part of this project. This has to be handled by package maintainers of the specific ditributions. I already added ebuilds for gentoo to the wiki, so they will probably find their way into the official portage tree somehow, but that is just for gentoo linux. Do you think we should leave this issue open? //CC @xzyfer \nBtw. the gentoo example shows pretty nicely how easy it should be for an experienced package mainainer to create such a package. Since gentoo is a source-based distribution, the nearly empty package files indicate how standard compliant libsass should be to pack for other distributions!\n. Yep, that seems to be redundant. IMO even src_prepare() { eautoreconf } might be redundant. Not sure from which template I copied off that code. But it works :smile: Not sure how much you know the gentoo build/portage system, but we could also create \"slots\" for different library versions. So this is definitely not the perfect ebuild, but it's at least a starting point!\n. I think that has something to do with readline, which will only see LF as valid line-feeds. I have added a CR compatible readline for sass2scss, so maybe we can use this code to imporove the readline all in libsass too!?\n. LGTM! :+1: \n. This issue should (hopefully) be addressed/fixed by https://github.com/sass/libsass/pull/792.\nPlease try with latest master and open a new issue if the problem still exists.\nThank you!\n. LGTM! :+1: \n. This should be fixed and you should now get a proper error on the context!\n. Nope, this should behave the same as before!\n. Hey welcome!\nJust wanted to give some feedback, since you obviously took the time to write all that up!\nI'm aware that the state of quote and unquote is not very good. Currently these functions are not sanitized, since we expect the callers to do the checks if the string should be unquoted or not. Once you pass it in it is unquoted no matter what. As a sass implementation we have to follow the way of ruby sass, and I'm actually not 100% aware what the unquote rules are. But make sure you create your tests against ruby sass behavior!\nOther than that I can just say: knock yourself out!\nBut to have PRs accepted you should make it pass the CI!\n. Unfortunately most of these cases are also covered by #910, so  I'm going to close this. Sorry @smikes, but if you see anything I have missed in that commit, feel free to open more PRs! Thank you!\n. I don't think this is something we want to include in our build scripts. But I also don't see the actual problem. Is there a problem when building with autotools? If you like you may add a chapter to the Building Wiki about how to build libsass against dietlibc, but I do not really see the reason for this, as IMO libstdc++ will also require libstdc:\nldd /usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/libstdc++.so.6\nlinux-vdso.so.1\nlibm.so.6 => /lib64/libm.so.6\nlibc.so.6 => /lib64/libc.so.6\n/lib64/ld-linux-x86-64.so.2\nlibgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/libgcc_s.so.1\n. Actually I doubt that ruby sass produces correct source-maps itself. I actually do not trust them, so I always compare them manually. I started to implement some tests via perl-libsass which I honestly trust more to be correct. IMO we cannot really mess them up more, so I would propose to take some risks here. Or does anybody rely on libsass source-maps to work currently? IMO they are plain broken anyway, for anything more complex than a few lines of sass code!\nSorry, maybe if misread your comment \"with sourcemaps in CI\". Actually we do not test any source-map stuff in CI, so I guess you mean, change it at will, as long as we pass the spec tests?\n. Well, actually the testing is possible and should be IMO pretty much at the core of this issue. The mappings you expect are pretty obvious, so writing tests for it is not that hard, but certainly tedious! As I said I already have a test routine that expects certains maps, while skipping/ignoring additionals. Actually most if this testing boils down if we want to create a more advanced test runner than we can currently get with sassc. Maybe it would be worth thinking about shipping a minimal test-runner with libsass, beside sassc, which we could use and abuse to our testing needs!?\n. IMO the state of this branch is currently at a point which is far better than the current implementation. So I think we can include this in libsass 3.2 actually! I also started to create a c++ library for aiding in sourcemap related tasks. I guess to takle this issue ultimately we need to have a way to have source-maps testes by unit-tests (which I've started as part of perl-libsass)! But it always boils down to a manual decision how the mappings should look like (do you want to create a mapping for every AST node, or only for some Nodes?) The whole thing is just very very complex!\nBut I'm actually positive that we can deliver some major improvements for the next version!\n. Closing in favor of #792!\n. Definitely not in the specs (we cannot test different options, beside output style) and also not in perl-libsass (just looked). Why? Are you having problems with them? If so it should not take much time to add a test case to perl-libsass?\n. I just added the options to perl-libsass and it works as expected, so not sure what is going wrong with your implementation. As a reference you can find the PR for my work in https://github.com/sass/perl-libsass/pull/10\n. Merged since this is still better than having out of date information on the main page!\n. @HugoGiraudel Thanks for the heads up. IMO this is still a valid report as it should not crash! Or could you not reproduce the crash @xzyfer ?\n. Actually I also still get this crash with perl-libsass. Since everything else is working ok, I guess this is a real problem. And since I can reproduce it I might be able to find out what's the cause for this!\nIMO it's not really a regression since it is pretty probable that it never worked anyway!\n. This was a problem/bug with the C API. Should be fixed by #791!\nI now also get the error message: 2px*px is not a valid CSS value!\n. Btw. the different behaviour could be a system specfic one, since it boils down to an unhandled C++ exception in C code. For me it was previously crashing with the message terminate called after throwing an instance of 'Sass::Sass_Error' ...\n@xzyfer please review and merge at your discretion :wine_glass: \n. :+1: \n. :+1: \n. Did you add your new source files to Makefile.am?\n. I guess CI is failing because of changes in the spec test suite!?\n. I guess CI is failing because of changes in the spec test suite!?\n. There is still a lot of debug stuff included in this PR which should be removed before merging!\n. I have added a simple \"test runner\" to perl-libsass while developing this feature to keep at least some track of what I was doing. @am11 you probably know how hard it is to debug this kind of stuff. I currently (not published yet) store this directory structure as the \"sourcemap tests\":\n- config\n- input.s[ca]ss\n- output.css\n- output.css.map\nThe config file is a map to context options (C-API options in a colon separated map), while the rest should be self explanatory. The output.css.map file is parsed and the stuff like included paths should be compared. I currently only implemented to compare the mappings, which does a search for expected mappings only, while ignoring additonal ones! This proved to be pretty effective during developement, since I was able to update the expected file incrementally (after inspecting and verifying the specific cases/mappings manually!).\nBasically this topic is endless since one could discuss about how a mapping should be done is pretty open (how do you map a calculation? Include every operator, number and so on?). This PR is already at a point where I would say is at least 50% better than before. Some code is certainly not optimal (reparse/remap part), but I don't really know how to improve it much more!  And it gets tedious to maintain such a big commit! This particular feature (remap) would not have worked before anyway; so I guess I'm willing to take the risk that it will now only work a few percent better. This might be 100% or 0.05%!\nI guess not many people really want to try it out and report back specific issues here! So I only can encourage the \"first scream\" approach! Just get it merged into 3.2 and let's see :banana: \nBtw. this inquiry by the original(?) implementor of source-maps seems to be handled here!\n. This should (hopefully) fix:\n- https://github.com/sass/libsass/issues/324\n- https://github.com/sass/libsass/issues/621\n- https://github.com/sass/libsass/issues/605\n- https://github.com/sass/libsass/issues/771\n- https://github.com/sass/libsass/issues/469\n- https://github.com/sass/libsass/issues/734\n. Thx all! Just to be perfectly clear, this does not magically fix all of our source-map problems. This is merely a step in the right direction to provide a base to make this happen. I only verified a few common complicated cases. Most of the rest should behave as before plus a few additional perks.\n. Just use http://mingw-w64.sourceforge.net! Please include more details in future bug reports! We cannot really give hands on instructions for every possible build scenario! And we always welcome new/additional info on our Wiki pages!\n. Appveyor seems to cache the sassc commit it uses somehow when I just ammend the message:\n```\nappveyor mingw build\nsassc: 3.0.2-7-gdcd5\nlibsass: 3.1.0-beta.2-8-g85af\ntravis-ci builds\nsassc: 3.0.2-16-gfbdc\nlibsass: 3.1.0-beta.2-8-g85af\n``\n. OK, facepalm to myself. Appveyor.yml still contained the url to my local sassc branch ...\n. Nope, no permission to do that, already checked :wink: Also @hcatlin probably needs to delete his \"hcatlin\" repo on appveyor so the now setup official one kicks in (hopefully)!\n. The basic problem was that mkdir on windows reported an error when the directory already exists, and there seems to be no other solution beside not calling the command if the directory already exists (this really only matters on windows/mingw!). Next problem is that this check is not really possible in a portable way (maybe the-` prefix as mentioned could come handy here, but I'm not convinced that this is supported by mingw32-make or dmake!?). Naming the directory as a target seems to fix it with all implementations. \"Seems\", since I never read a statement that this would be guaranteed! Just to make it clear, what I mean is this:\ndirectory: \n  mkdir directory\nall: directory\n  make\nSo the directory would only be created once if it did not already exist!\n. So here my 2 cents on this:\nI guess you're all talking about http://techblog.md-systems.ch/tutorial_howto/git-branching-model !?\nThat's the model I am used to work with, but IMO it's not usefull if we do not have any \"stable\" definitions beside having it to pass the spec test suite (which seems to be a moving target anyway)! So IMO before we do not have any goals that define \"stable\", the whole exercise is pretty pointless!\nIMO we should not yet adapt such a workflow, since it will increase burdens to introduce new features! As we already have a pretty good coverage with CI, this does not seem to bring much benefit! And since we are pretty careful to commit stuff directly on master, I feel the current way is sufficient ATM.\nIMHO the basic question boils down to: \"do we want to preserve the current state of the code base?\". Which I would say no! We still want to improve it significantly, which needs us to be able to push and include major changes to to current code. One of this points would be source-maps, which need to change dramatically to work correctly. Stuff like this will add new regressions, but I don't see any other way to get it to the state we want it to be in!\nEdit: What I basically want to say: I dont see any reason to have a master behind develop, Just for the sake of being sure we have a stable master (again, what means \"stable\"). IMO currently we ensure \"stable\" with CI! And since PRs run against the CI service, I don't see any need so far to split up our developement in several branches. If you want/need a specific version, take a tag or a certain commit id!\nFinal Note: If we want to talk about stable libsass, we should at least first provide a stable ABI!\nAs a side note: I'm also for killing stale branches, but most seem to be by @akhleung, and I don't want to purge stuff that might be valuable (most branches seem to have at least one unique commit).\n. @xzyfer IMO such branches only make sense if we have some kind of long term support for a specific version. And IMO we are far away to even consider something like that since even ruby sass does not have such a thing. We also have a pretty good CI now, so I also don't see a reason to split develop and master, since we do not have and cannot lift and support any integration testing stage to verify the transition of the code between develop and master (beside CI that we already have).\nWe have one master which has to pass CI, which means that every commit that returns green light on CI could be a stable release. I myself do some more extended tests with perl-libsass to verify some stuff on the C-API which isn't yet covered by our CI, once we get ready to tag a release. So that is IMO the next pain point after we have now error spec testing and can also test different precision options (in case you missed that). Testing the C-API via CI would be the next big goal here ...\nSo I don't see a reason why we would need additional branches beside developing in feature branches and bringing the changes into master via PRs, which are CI tested!? As I initially said, this would IMO only change if we would need to support LTS releases.\nSo in my opinion this issue could be closed!\n. Just wanted to give you some feedback on your work after a short review:\n- I really like the refactoring in parser.cpp!\n- If we move quote/unquote, I would move it to utils.cpp! 1\n- I like that you used TDD, but we have some other issues with testing 2\n*1: I guess we want to keep the fragmentation at least down to a certain level. I agree that seperation is a good principle, but it also increases compile time. I think quote/unquote would fit very well into utils.cpp!\n*2: This is a bit more complicated and there have been already a lot of discussions about this. AFAIK we do not want to integrate another test framework without further considerations, so this seems IMHO not acceptable for this PR! Prefered solution in this case would be that you could re-create most of the test cases as spec-tests!\nWe definately want to add more and better testing and are open for further PRs, but we need quite a bit to cover all cases:\n- output modes\n- context options\n- source-maps\n- exit states\n- error/warn output\n- stderr output\n- ...\nCurrently the core developers are mostly on bringing the code up to sass 3.4 parity! So the testing seems to get little attention. I use perl-libsass to test more advanced features that are not covered by the sass spec test suite (like my recent developement with source-maps).\nTo do this properly we will need to have a test-runner in C that can test all the above scenarios. Once we have that, it could also include more basic tests like the once you have in this PR!\n. I agree that we are in desperate need of better testing. We do have a very good test-suite, which ensures pretty well that we do not break existing compiles. But when it comes down to tiny details, we are in lack of any testing! I also have my \"own\" tests in the perl-bindings to test stuff on the C-API which we do not currently test inside libsass itself. The same goes for the node-sass test-suite. But be aware that a sufficient test suite for libsass should include source-maps, exit-codes, error-msgs, warnings, importers and more!\nWe would (AFAIK) love to replace the current ruby spec runner with a native C++ implementation. This would IMO be a great opportunity for somebody who would like to get to know the libsass internals :wink: \nEdit: Just a wild idea, but I think you could put your C unit tests into an own repository with a Makefile and links against libsass!? That way we might could adopt it as an alternative test runner someday!?\n. Unfortunately most of these cases are also covered by #910, so  I'm going to close this. Sorry @smikes, but if you see anything I have missed in that commit, feel free to open more PRs! Thank you!\n. :+1: Don't forget to check off any solved issues at https://github.com/sass/libsass/issues/629\n. I'm going to close this. We are open for PRs to improve MSVC build (either .sln and/or wiki) for libsass!\n. FYI: I have activated \"status\" recently in the hope it might solve this ... beside that I have no idea. @xzyfer do you have admin access at appveyor for that repository? Maybe we need some setting there?\n. @FeodorFitsner The issue is that \"CI reports\" for PRs are not included. As you can see right below this comment, only Travis-CI reports it's status to the PR: \"The Travis CI build passed\". Before it read something like \"2 out of 2 ...\"!\n. Thanks for the hint, seems like that did it! https://github.com/sass/libsass/pull/925\n. Please read https://github.com/sass/libsass/wiki/Building-Libsass#including-the-libsass-version\n. Duplicate of https://github.com/sass/sassc/issues/63\nAlso I don't know where you read \"easy\" on that stackoverflow page. As you see there are 4 different APIs for every different OS. And I don't think we want to be depeding on Qt!\n. I am about ready to merge my work on source maps. Want to wait for that first, since it also touches a lot of files. @xzyfer Do you want me to wait till you merge the stuff for @at-root too? Just want to prevent too many conflicts when rebasing!\n. :+1: \n. I'm also going to remove the guards in all cpp files! That could give some conflicts!\n. OK, I guess I will merge source-maps now; so I can get right to it!\n. The changes are pretty simple IMO, you mostly just need to replace path, position with pstate for AST_Node creation. Some parts might be trickier, but IMO there is no chance to get the source-map part merged in a 100% state (it's still better than current). If you want I can rebase your branch and make a PR to your local repo (maybe take this to gitter?)\n. Good point, will update this PR now!\n. First thanks for taking the initiative here!\nIMO the build file for sassc should depend somehow on the libsass build. I don't know very much about MSVC, so I don't know how this is normally done. But IMHO best would be if we could mimic the BUILD variable somehow (BUILD=static|shared). I fully agree that the MSVC build for sassc should go into sassc repo itself. But you need to make sure that AppVeyor CI still compiles (which is a bit of a pain to do, since you have to test it with a local repo that checks out the sassc dependency also from your local repo).\n. Actually I don't think that we want to reference each libsass source file in sassc MSVC build!\nIsn't there a way to at least depend on the parent build file or to link to the library otherwise?\nEdit: This would mean that everytime we add a new source file to libsass, the CI build would fail for such PRs, without changing sassc project too.\n. I guess you are facing the same underlying problems as the linux build. The linux builds uses a SASS_LIBSASS_PATH env variable to tell the sassc build where to look for libsass. This is only different with autotools and shared (system) library. I guess there is no clean approach in regard to system libraries on windows, so you should be save to make some assumptions on where the libsass and sassc code is checked out to. If this would be configurable somehow, even better :smile: \n@darrenkopp: FYI: https://github.com/sass/libsass/wiki/Building-on-Windows\n. I guess the wildcard solution is better than nothing :smile:  CMake should be able to create build files for native Makefiles (linux/mingw), autotools and MSVC. FYI: There is a old PR (https://github.com/sass/libsass/pull/292) that we keep around that could be used as a base to get CMake working.\n. I have merged your sassc PR. IMHO the wildcard solution is not optimal but still a step forward. Would be very nice of you if you also could update and verify the building steps at the wiki, once everything is merged. :stuck_out_tongue_winking_eye: \n. OK for me! I probably will not have much time the next weeks to do some substantial work. But I guess there is already enough in the pipeline :smile: I personaly think we should enforce the testing issues a bit more, since it could bite our ass, since we have a few features that are currently not tested.\n. IMO we are pretty much ready once we agree how to merge #927.\nSo IMHO we probably should plan to release 3.2 in the next days/weeks!?\nThe only issue left in 3.2 Milestone is https://github.com/sass/libsass/issues/871 and I'm not sure if I'm able to fix this (@xyfer maybe you want to give it a try, documented my findings in that issue). Otherwise I agree that we could re-scope that issue to 3.3 if needed, since it is a minor improvement anyway. @xzyfer are you willing to compile the changelog once again for the next release? Also should we do a beta release first? @am11 what would you're prefered scenario be for your upcoming major node-sass release? Would really like to get the improvements out ASAP! I have already a prepared branch for perl-libsass to support the latest changes. I also already updated some wiki pages to include some of the recent changes!\nJust wanted to get this rolling!\n. :golf: I guess we're ready, since I merged #927 :exclamation:\nSome code can be considered \"hotfixes\", but better than failing specs IMO!\nSo I pass the :soccer: to you (@xyfer) to compile the changelog for the release :smiley: \n. BTW. we're down to 21 open issues and closed 83 issues with Milestone 3.2 :100: \n. @xzyfer @hcatlin I took the liberty to create a (non public) release draft!\n. OK, from my side we are ready to ship anytime now ...\n. I've updated the wiki for the C-API.\nNow there are basically only two minor issues open:\n- https://github.com/sass/libsass/pull/935 - don't like to have version hardcoded in the git repo\n- https://github.com/sass/sass-spec/pull/270 - would increase code coverage by quite a bit \nI guess the second one if not really urgent (nice to have), since I know it works correctly on my maschine :wink: But I would like to merge the first one (rpm specfile), if nothing strictly speaks against it.\n. Oh, and I guess we're going first with an alpha release (3.2.0-alpha)? \n. OK, will now clean the commit for the new sass-specs and check that CI still works. There will be about 3000 new spec tests, if you count them individually :smile:. If OK for you, I will ship 3.2.0-alpha.1 right after CI gives green light after the two merges !??\n. Beta release 3.2.0-beta.1 is out :rocket:\n3955 runs, 10701 assertions, 0 failures, 0 errors, 388 skips\n. I guess this got resolved on its own. Unfortunately we cannot really give specific examples for each and every use case. Beside sassc there are also other (even more complete) implementations listed on the wiki: https://github.com/sass/libsass/wiki/API-Documentation#real-world-implementations\n. This might be solved by #910! By the way the AAAA are basically just duplicates (two mappings at the same point). So I don't think this should itself have caused any issues, but they should be gone with the latest commits on master!\n. Please re-open if this is still an issues!\n. Please give at least some example input and output, thanks!\n. OK, I tested your example with latest master and it gives completely different results than you posted?? I also see \"sourceRoot\" in your output.css.map, which is not from libsass?? So what are you actually pasting here?? For me this is an invalid report, sorry!\noutput.css.map\n{\n        \"version\": 3,\n        \"file\": \"output.css\",\n        \"sources\": [\n                \"input.scss\",\n                \"_test.scss\"\n        ],\n        \"sourcesContent\": [],\n        \"mappings\": \"ACAA,CAAC,AAAC,CACE,MAAM,CAAE,CAAE,CACV,OAAO,CAAE,CAAE,CACX,iBAAiB,CAAE,SAAU,CAC7B,wBAAwB,CAAE,IAAK,CAJhC,AAOH,CAAC,CAAE,CAAC,ADPD,OAAO,CCOG,CAAC,ADPF,MAAM,ACOG,CACjB,eAAe,CAAE,UAAW,CAC5B,kBAAkB,CAAE,UAAW,CAC/B,UAAU,CAAE,UAAW,CAHL\",\n        \"names\": []\n}\n. This should be solved by #910!\n. Just a heads up. I currently have a (very dirty) WIP branch that is pretty much 99.5% on par with ruby sass for extended, expanded and compressed output style :sunny: I currently only need to normalize multiple linefeeds to one (/\\n+/\\n/), since I did not yet get the logic how ruby sass does it.\nThere are also some issues with whitespace preserving on extended selectors (actually it is more a line-feed preserving). After manually analyzing the input vs. output, I came to the conclusion that this is a very small ruby sass bug (I will eventually open a bug report to discuss that more later).\nAnyway, I'm currently trying to extract some already useable parts, since I IMO fixed quite a few other bugs. One such PR is https://github.com/sass/libsass/pull/847, which improves handling for interpolates and some static value parsing. Ruby sass actually mostly just preserves whitespace for static values (which make absolute sense, even if it could be considered a bug in compressed output).\n. So let's go with another heads up. I have been hacking through the code like wild to get the test suite working in case of how strings and interpolates etc. are represented in the output (single/double quotes or not quoted at all). Was really not that much fun ... but it seemed easier to fix it once and for all(?) than implementing even more hacks around the real issue.\nNow to the interesting parts, the latest WIP branch:\nhttps://github.com/mgreter/libsass/tree/wip/ugly-but-working\nI also published the test-suite I used to run against with perl-libsass (the test runner part is not published on github). To make it clear, the WIP branch bellow disables some Improvements I have in another branch for white space preserving. This here is really about interpolation and the output. It now even accepts some (IMO valid) interpolations, which ruby sass chokes on :smile: \nhttps://github.com/mgreter/sass-specs/tree/wip/ugly-but-working/suite/parser\nhttps://github.com/mgreter/sass-specs/blob/wip/ugly-but-working/suite/parser/escaping/interpolate/input.scss\nUnfortunately I had to debug the code quite intensively, which made the resulting code very dirty. So next step would be to extract the important parts from the latest WIP branch, which will probably take quite some time. I already extracted some improvements in PR #847. IMO this is a pretty significant change and improvement, so I thought I'd share the latest status.\nP.s. the whole excercise at some point felt like this here :smile: \n\n. I finally got my WIP branch to pass the auto-generated tests for interpolants:\nhttps://github.com/mgreter/libsass/tree/wip/ugly-but-working\nhttps://github.com/mgreter/sass-specs/tree/wip/ugly-but-working/suite/parser/interpolate\n. Closing in favor of https://github.com/sass/libsass/pull/910\n. Please auto autotools to create shared/system libraries!\nhttps://github.com/mgreter/libsass/wiki/Building-with-autotools\n. LGTM!\n. Another improvement I was able to pull out of my WIP branch. Fixes another todo issue:\n- libsass-todo-tests/selector_interpolation_in_string/input.scss\n. I'm going to merge this now. I already have some other PRs pending, which will adress/improve the naming of the prelexer functions (which @xzyfer correctly pointed out with smart_del)\n. We need at least OS and Compiler version!\n. From the output, this looks like a downstream error. Please only report build problems to libsass that are directly related to the build system supported by libsass. So please try to reproduce with the official libsass build, or report to node-sass (they might already be aware of this issue)!\n. IMO from the error it seems like a #ifndef around these uchar_t typedef declaration should fix it too?\n. That's correct. The old sass_interface was changing a lot without further notice. So using it as a system library would not have been a wise idea, since you would be pretty much asking to break your inked app once a new library is installed!\n. @drewwells the API has change slightly (Function_Call was renamed), please consult #1000\n. LGTM :+1: \n. I already had that idea, but it's really a very very low priority for me. IMHO this issue here is only about the file reading part and has not much to do with the custom importers. You already can return back filenames to libsass with custom importers, which libsass will then read like normal imports (\"import rewriter\"). If the file does not exist, it will error out as with normal unreadable imports!\nhttps://github.com/sass/libsass/wiki/API-Sass-Importer\nSo I would suggest to open an issue (or rename this one) for \"custom readers\", as you put it. I don't think removing the possibility to return data right away with custom importers is a good idea. Other than that, I don't see the relation to custom importers.\n. I created a collective ticket to keep track this and other \"non-urgent\" feature requests, in order to keep the issue tracker a bit more clean for the more 1st aid issues. I would like to encourage everybody interested in this particular feature to add their comments into this closed issue anyway.\nThanks for your understanding and your contribution!\n. @anlutro Could you come up with a test case which includes all edge cases? If so please add another PR to https://github.com/sass/sass-spec!\n. It actually should be a | instead of a +\nSASS2SCSS_PRETTIFY_1 | SASS2SCSS_KEEP_COMMENT\nOther than that I guess we would merge it in!\n. It is actually purposely not constant, since the memory you pass as source_string is not copied by libsass; the ownership transfers to libsass, while we do make copies of const chars*. To be honest I'm still confused where to make it const or not, but @QuLogic always gave good advices in this direction!?\n. You seem to have a point here, but IMHO we want to go in the other direction.\nThe one remaining confusion is IMO fixed with this commit: https://github.com/sass/libsass/commit/496f4f956e1addd80a090bb52159174d54b2fb98\nUnfortunately this is a breaking change for implementers (//CC @am11)\nYou should always be able to pass libsass the whole memory and libsass will take care to free the memory. We currently keep copies of the pointers in various locations, but finally all these pointers should also be in Context::sources, which will be freed by libsass. So in case your implementation does not allow you to let libsass \"overtake\" that memory, you have to make a copy yourself before passing it to libsass (the costs should be pretty minimal, what's 1MB of RAM?). We do it that way, because we a) want to allow implementors to only allocate the memory once and pass it to libsass as is and b) we do not trust the outside world with the lifespan of that data (we want to make sure we can keep it around as long as we need, so that libsass is in control of the memory).\nI hope this makes sense. If libsass doesn't free the memory, please open a new bug about that. Although my latest memory tests indicate that everything is clear in that direction!\nBTW. this was/is also reflected in the C-API:\nsass_make_data_context(char* source_string)\n. This may already be solved by my current WIP branch: https://github.com/sass/libsass/pull/839\nWill have time in a few hours to run your test against it.\nEdit: Sorry, looks like I did not catch this case after all ...\n. OK, will have a little time tomorrow to debug this issue a little more. But I already have some good news. As I said, I thought I have adressed this issue already, but as it turns out, only if the lists are declared inside the interpolations directly and not via variables. So here's a little peak:\nInput:\n``` CSS\n.csv {\n  output: \"alpha\", \"beta\", 'gamma', 'delta';\n  output: #{\"alpha\", \"beta\", 'gamma', 'delta'};\n  output: \"[#{\"alpha\", \"beta\", 'gamma', 'delta'}]\";\n  output: \"#{\"alpha\", \"beta\", 'gamma', 'delta'}\";\n  output: '#{\"alpha\", \"beta\", 'gamma', 'delta'}';\n  output: \"['#{\"alpha\", \"beta\", 'gamma', 'delta'}']\";\n}\n.ssv {\n  output: \"alpha\" \"beta\" 'gamma' 'delta';\n  output: #{\"alpha\" \"beta\" 'gamma' 'delta'};\n  output: \"[#{\"alpha\" \"beta\" 'gamma' 'delta'}]\";\n  output: \"#{\"alpha\" \"beta\" 'gamma' 'delta'}\";\n  output: '#{\"alpha\" \"beta\" 'gamma' 'delta'}';\n  output: \"['#{\"alpha\" \"beta\" 'gamma' 'delta'}']\";\n}\n```\nResults:\n```\n+---+--------------------------------------------------+--------------------------------------------------+\n| Ln|Got                                               |Expected                                          |\n+---+--------------------------------------------------+--------------------------------------------------+\n|  1|'.csv {                                           |'.csv {                                           |\n|  2|  output: \"alpha\", \"beta\", \\'gamma\\', \\'delta\\';  |  output: \"alpha\", \"beta\", \\'gamma\\', \\'delta\\';  |\n|  3|  output: alpha, beta, gamma, delta;              |  output: alpha, beta, gamma, delta;              |\n|  4|  output: \"[alpha, beta, gamma, delta]\";          |  output: \"[alpha, beta, gamma, delta]\";          |\n|  5|  output: \"alpha, beta, gamma, delta\";            |  output: \"alpha, beta, gamma, delta\";            |\n*  6|  output: \\'alpha, beta, gamma, delta\\';          |  output: \"alpha, beta, gamma, delta\";            *\n|  7|  output: \"[\\'alpha, beta, gamma, delta\\']\"; }    |  output: \"[\\'alpha, beta, gamma, delta\\']\"; }    |\n|  8|.ssv {                                            |.ssv {                                            |\n|  9|  output: \"alpha\" \"beta\" \\'gamma\\' \\'delta\\';     |  output: \"alpha\" \"beta\" \\'gamma\\' \\'delta\\';     |\n| 10|  output: alpha beta gamma delta;                 |  output: alpha beta gamma delta;                 |\n| 11|  output: \"[alpha beta gamma delta]\";             |  output: \"[alpha beta gamma delta]\";             |\n| 12|  output: \"alpha beta gamma delta\";               |  output: \"alpha beta gamma delta\";               |\n* 13|  output: \\'alpha beta gamma delta\\';             |  output: \"alpha beta gamma delta\";               *\n| 14|  output: \"[\\'alpha beta gamma delta\\']\"; }       |  output: \"[\\'alpha beta gamma delta\\']\"; }       |\n| 15|'                                                 |'                                                 |\n+---+--------------------------------------------------+--------------------------------------------------+\n```\nSo this already seems to do the right thing (with one very minor exception). But the output with your actual test (with the lists comming from variables) is still off by quite a lot:\n```\n+---+------------------------------------------------------------------------+------------------------------------------------+\n| Ln|Got                                                                     |Expected                                        |\n+---+------------------------------------------------------------------------+------------------------------------------------+\n|  1|'.csv {                                                                 |'.csv {                                         |\n|  2|  output: \"alpha\", \"beta\", \"gamma\", \"delta\";                            |  output: \"alpha\", \"beta\", \"gamma\", \"delta\";    |\n*  3|  output: \"alpha\", \"beta\", \"gamma\", \"delta\";                            |  output: alpha, beta, gamma, delta;            *\n*  4|  output: \\'[\"alpha\", \"beta\", \"gamma\", \"delta\"]\\';                      |  output: \"[alpha, beta, gamma, delta]\";        *\n*  5|  output: \\'\"alpha\", \"beta\", \"gamma\", \"delta\"\\';                        |  output: \"alpha, beta, gamma, delta\";          *\n*  6|  output: \\'\"alpha\", \"beta\", \"gamma\", \"delta\"\\';                        |  output: \"alpha, beta, gamma, delta\";          *\n*  7|  output: \"[\\'\\\"alpha\\\", \\\"beta\\\", \\\"gamma\\\", \\\"delta\\\"\\']\"; }  |  output: \"[\\'alpha, beta, gamma, delta\\']\"; }  *\n|  8|.ssv {                                                                  |.ssv {                                          |\n|  9|  output: \"alpha\" \"beta\" \"gamma\" \"delta\";                               |  output: \"alpha\" \"beta\" \"gamma\" \"delta\";       |\n* 10|  output: \"alpha\" \"beta\" \"gamma\" \"delta\";                               |  output: alpha beta gamma delta;               *\n* 11|  output: \\'[\"alpha\" \"beta\" \"gamma\" \"delta\"]\\';                         |  output: \"[alpha beta gamma delta]\";           *\n* 12|  output: \\'\"alpha\" \"beta\" \"gamma\" \"delta\"\\';                           |  output: \"alpha beta gamma delta\";             *\n* 13|  output: \\'\"alpha\" \"beta\" \"gamma\" \"delta\"\\';                           |  output: \"alpha beta gamma delta\";             *\n* 14|  output: \"[\\'\\\"alpha\\\" \\\"beta\\\" \\\"gamma\\\" \\\"delta\\\"\\']\"; }     |  output: \"[\\'alpha beta gamma delta\\']\"; }     *\n| 15|'                                                                       |'                                               |\n+---+------------------------------------------------------------------------+------------------------------------------------+\n```\nBut I hope this test actually gets me a little bit closer to the really correct solution. But IMHO the first output I showed is already quite a big improvement :smile: But be aware that I really cannot give any ETA on this big refactoring, since it involes the parser, the evaluation and the output part of the code!\n@xzyfer I will probably have quite a lot of tests to add, once I get this all working ...\n. It looks like sass \"forgets\" the original quotes when interpolating lists. Once I disabled that in my code, your example actually passes perfectly with my local branch :smile: Now I need to test how this behaves with nested interpolates inside or outside quotes and other variations to be sure about the rules ...\n. Added a few auto generated tests to cover this issue a bit more in-depth.\nhttps://github.com/mgreter/sass-specs/tree/master/suite/parser/interpolate\nAnd with a few tweaks in my current WIP branch I was able to pass them all!\nJust don't get too excited! Still a lot of work to clean up the mess I made in that branch!\n. I'm currently (re-)generating the expected results with ruby sass 3.4.9. Another thing I have not solved 100% correctly yet is handling of escape sequences and it seems as soon as I fix one side it breaks on the other (or interpolation fails). So there is still a lot to do until I want to get this all merged. By the way, I also found some cases where ruby sass chokes on the input, while my WIP branch happily processes it:\n.result { dquoted: \"#{#{literal}}\"; }\n. This should be solved by #910!\n. This one is also trickier than expected. @xzyfer you added the 3.2 Milestone for this, so do you have an idea how to fix this? I was able to tackle the missing error when extending across media queries, but this one seems more difficult, since extend seems to be run twice, which makes my check in the WIP branch fail on the second run. Otherwise I don't think I can fix this for 3.2!\n. Rescoping to 3.3, since it is a non trivial refactoring and we consider this issue a minor one, because it only happens with \"invalid\" input. As a drop-in replacement, libsass does not break, since ruby sass would not create any output anyway! We still consider it a bug, but will not have a fix in 3.2!\n. IMHO it should not be a problem to implement this via custom imports. Just return an empty string when the file is included twice. I guess this could even be done without implementing any actual reading on the custom importer side. Just return the filename on the first occurence (with content beeing a null pointer) and on any further occurence return an empty string (a pointer to \"\\0\"). This is not tested, but should work in theory!\n. Actually your example doesn't even compile on linux or windows mingw, but got this compiled and works:\n``` C++\ninclude \"sass_context.h\"\ninclude \nstatic void foo() {\n    return;\n}\nstatic union Sass_Value custom_func(const union Sass_Value args, void* cookie) {\n    return sass_make_error(\"hello world\");\n}\nint main() {\n    struct Sass_Data_Context context = sass_make_data_context(\"a { content: foo(); }\");\n    struct Sass_Options options = sass_data_context_get_options(context);\nSass_C_Function_List fn_list = sass_make_function_list(1);\nSass_C_Function_Callback fn = sass_make_function(\"foo()\", custom_func, (void*)&foo);\nsass_function_set_list_entry(fn_list, 0, fn);\nsass_option_set_c_functions(options, fn_list);\n\nsass_compile_data_context(context);\nstruct Sass_Context* ctx = sass_data_context_get_context(context);\nstd::cout << sass_context_get_error_status(ctx) << std::endl;\nstd::cout << sass_context_get_error_message(ctx) << std::endl;\nsass_delete_data_context(context);\nreturn 0;\n\n}\n```\n$ g++ -Wall main.cpp -o lsass -Llib -lsass && lsass\n1\nstdin:1: error in C function foo: hello world\nBacktrace:\n        stdin:0, in function `foo`\n        stdin:0\n:question: \n. Since interpolants can be nested, this is kind of the key point. I already merged some improvements in the prelexer and currently working on extracting more stuff from my WIP branch, which includes a lot more of these improvements, but there are also a lot of places where those need to be applied correctly.\n. This should be solved by #910!\n. No replacement! You can i.e. load custom functions via plugins (one or more).\nhttps://github.com/mgreter/libsass/blob/feature/plugin-functions/plugin.cpp\nThere is more stuff that could be usefull for plugins to do; but it's a start!\n. You should be able to use it since a few minutes if you apply #919 :wink: \n. Started to document it: https://github.com/mgreter/libsass/wiki/Creating-Plugins\n. We are aware of the issue and unfortunately source-maps are pretty unreliable in the current state. A lot of refactoring needs to be done to fix all issues related to source-maps. We already started to tackle this, but there is no ETA when this will finally be fixed. In the mean time it might be easier to just remove the charset with another postprocessor if you really need source maps working!? \n. I made a PR with a possible solution: https://github.com/sass/libsass/pull/915\n@chriseppstein maybe you could give it a try if it solves your issue?\n. Merged #915\n. @xzyfer I'm fine with merging this, although I didn't test it!?\n. IMO this would mostly just mean to implicitly enable source_map when either source_map_contents or source_map_embed are enabled. IMO this can easily been done by implementors, but I don't have personaly anything against such a change. What's your opinion @xzyfer?\n. I have made sourceMapEmbed independent from source_map_file since they are just two different ways to \"output\" the source-map and the filename wasn't event used when embedded, so both options should enable the source-map generating!\n. Maybe it is linking against an old libsass system library?\n. What does ldd sassc show?\n. I already suspected such a thing. I'm closing this as an upstream bug. Homebrew should do its homework and update that version when the package version is bumped. Preferably in an automated fashion. I guess the source tree has to be updated too, which implies that this version must be updated accordingly. I do it the same way when releasing perl-libsass (getting the version via git and writing it to a file; to be used later when the bindings get compiled).\n@drewwells I actually had a look at some homebrew sassc/libsass repos today (googled it), but wasn't able to dig up anything suspicious. Maybe you could provide a link to support/libsass.pc?\n. OK, there seems to be a problem in the autotools build (looks like homework for libsass too), but I'm not convinced that this is actually the cause for the original report. I'm pretty sure the actual shown version is defined here, as it really just shows the LIBSASS_VERSION makro, defined on compile time!\nhttps://github.com/sass/libsass/wiki/Building-Libsass#including-the-libsass-version\n. Got it now, looks like we are falling back to $VERSION in configure.ac. I guess this VERSION is pointing to what @drewwells pointed out earlier (in configure.ac line 5). So for now the only solution would be for homebrew to provide the libsass version when compiling (as an environment variable, that autotools will pick up, instead of falling back to $VERSION).\n. We basically do not want to have any version numbers checked in into the libsass repo, since git itself should provide the version information. All official build \"solutions\" (beside MSVC I guess) can fetch the version from git directly or fallback to the env variable or finally fallback to a hardcoded string ([na] in the code). Now autotools seems to fallback to the version of the package, which has the be static (and is 3.0.3 currently). But I will try to replace that too with an automated part (m4_esyscmd seems to be the friendly helper here). So in the long run, if you do not have the git repo around, you will need to provide the version from outside. I could be willing to add an additional fallback to get the version from a file (which should make it a little bit easier to automate this from third party sides).\nBut yeah, the way it was compiled, it actually should have reported [na] in the original report!\n. I could probably create a fallback to a VERSION file (for autotools). But I honestly do not want to have such a file checked in into the libsass repo. As I wrote earlier, I also do it that way when I release the perl bindings. I will probably change the autotools build to fall back to [na] when no version is passed, but I need to check first if autotools will behave correctly (otherwise I will probably just set it to 0.0.0).\nBtw: the fallback is happening here\n. Actually ruby sass seems to compile to the same output:\nCSS\n.row {\n  margin: -20px; }\nAlso verified on http://sassmeister.com/. It also seems to be true for ruby sass down to version 3.2.19 (oldest available on sassmeister). Closing this as not reproducible.\n. This should be solved by #910!\n. Sorry, wrong branch. My bad :wink: \n. Thanks for the review! I'm making progress with the fallow up PR:\nhttps://github.com/mgreter/libsass/commits/refactor/output-preparation\n. I've nearly finished the merge of my WIP branch. Although it currently only supports nested output and it probably is off by quite a bit. But everything is prepared to implement different output styles inside the Emitter class. Next I hope I can refactor my last part of my working WIP branch, becuase that was actually the most dirty one. But I know it is doable via Emitter class!\nhttps://github.com/mgreter/libsass/commits/refactor/output-preparation\n. Just checked which tests pass with the output-preparation branch:\n- libsass-todo-issues/issue_615\n- // libsass-todo-issues/issue_639\n- libsass-todo-issues/issue_694\n- libsass-todo-issues/issue_870\n- libsass-todo-issues/issue_884\n- // libsass-todo-tests/libsass/image-url\n- libsass-todo-tests/libsass/mixin\n- libsass-todo-tests/scss-tests/172_test_parsing_decimals_followed_by_comments_doesnt_take_forever\nI guess some also pass on current master! Maybe you have time to move them?\n. I have squashed the whole refactoring into two commits (the first one beeing exactly this PR) at:\nhttps://github.com/mgreter/libsass/commits/refactor/output-preparation\nNow the work needs to be done in Emitter class. Maybe you want to review it already? To have the full work finally merged I need a correct Emitter implementation first!\nI will make sure to add a third commit once it is ready!\n. Got a first implementation for nested output rendering at: https://github.com/mgreter/libsass/commit/3a983e1716703be7d385deef88b4cb19a638201a\nThat branch passes the following additional tests:\n- libsass-todo-issues/issue_615\n- libsass-todo-issues/issue_639\n- libsass-todo-issues/issue_694\n- libsass-todo-issues/issue_870\n- libsass-todo-tests/scss-tests/172_test_parsing_..._take_forever\nIt also passes all but 31 spec test exactly to ruby sass output (I only normalize multiple linefeed to one linefeed). Next is to refactor the whitespace/linefeed preserving for selectors and lists.\n. Mixed in the line-feed preserving from my WIP branch at: https://github.com/mgreter/libsass/commit/1210dfa5e3cbea93068e405f95b39feccd7346e4\nWith this it additionaly seems to pass one more spec test (only fails 2 nested spec tests):\n- libsass-todo-tests/186_test_newlines_removed_from_selectors_when_compressed\n. I have pretty much a finished implementation in another WIP branch:\nhttps://github.com/mgreter/libsass/commits/test/emitter-implementation\nStill need to clean up quite a few edges, but it already implements all 4 output modes!\nI had to ignore white-space or skip some tests for now:\n- 3 tests in compact mode\n- 7 tests in compressed mode\n- 6 tests in in expanded mode\n- 6 tests in in nested mode\nSome of these seem to be bugs in ruby sass.\nAll other tests only normalize multiple linefeeds to one linefeed.\nSo I'm positive that I will be able to finish the refactoring pretty soon!\n. @xzyfer :+1: Btw: you can think if String_Quoted as a replacement for needs_unquote, since I will now unquote strings when parsing. This seems to be the right thing to do and is needed for interpolation. If ok for you, I'll squash this whole PR into one commit and merge it and post other PRs accordingly!\n. Closing in favor of #910 \n. Just tested this and I get the same results in ruby sass (3.4.12) as with your \"generated css\", so I don't know if ruby sass behavior has changed, but looks like libsass does it correctly!\nRuby Sass:\n``` CSS\ndiv.branch div.leaf {\n  color: leaf; }\ndiv.branch {\n  color: branch; }\n```\nPlease re-open if you can re-produce the issue with latest ruby sass!\n. Sounds pretty much like a duplicate of #880?\n. That's exactly the point. And $VERSION is defined by the second argument to AC_INIT! I tested it on linux and windows, so it seems to work. Not sure if it is even possible to have conditionals before setting AC_INIT (and using the result for it).\n. @drewwells it's not the idea to carry this file around in the git repo. It should only be added for libsass releases (like the homebrew one). @QuLogic you're right, and echo \"\" || ... doesn't seem to do it either. Problem is that shell code tends to break system compatibility quite easy (mingw, bash, ...).\n. @drewwells how does the brew formula get the libsass source? I guess they are either copied in or a specific commit is referenced somewhere? The idea is that as soon as you update the sources inside your release (or the reference), you have to update the VERSION file. We cannot really increment the file for each commit and I do not want to have a VERSION file around not indicating if it is the actual tagged version or if more commits have been added! And this can IMHO easily be automated!\n. @QuLogic I added another commit that should hopefully fix the issues you correctly pointed out. I just tested it on mingw32 and travis seems to be happy too. I hope it is all correct now and it IMO looks already a lot cleaner.\n. @QuLogic incorporated you're latest remarks :+1: I also squashed all commits down to one!\n. @drewwells so why can't you just set LIBSASS_VERSION to the version encoded in that url. I mean you already have to update the string in one location. Hope you see my point ... I mean I would even prefer a LIBSASS_VERSION and construct the url with it ...\nhttps://github.com/Homebrew/homebrew/blob/master/Library/Formula/libsass.rb line 20:\nENV[\"LIBSASS_VERSION\"] = '3.1.0'\nWhenever you update the url on line 3 you also update the version on line 21. IMO it cannot get much simpler than that and is exactly how it is intended. You probably can even reduce that even more if you can use variables etc. Just took me a couple of minutes to pull together a working ebuild for gentoo:\nwww-misc/libsass-3.1.0.ebuild\n``` ebuild\nCopyright 1999-2014 Gentoo Foundation\nDistributed under the terms of the GNU General Public License v2\n$Header: $\nEAPI=5\ninherit eutils autotools\nDESCRIPTION=\"A C/C++ implementation of a Sass compiler.\"\nHOMEPAGE=\"http://libsass.org/\"\nSRC_URI=\"https://github.com/sass/libsass/archive/${PV}.tar.gz\"\nLICENSE=\"MIT\"\nSLOT=\"0\"\nKEYWORDS=\"~amd64 ~x86\"\nIUSE=\"\"\nDEPEND=\"\"\nRDEPEND=\"${DEPEND}\"\nDEPEND=\"${DEPEND}\"\npkg_pretend() {\n    # older gcc is not supported\n    local major=$(gcc-major-version)\n    local minor=$(gcc-minor-version)\n    [[ \"${MERGE_TYPE}\" != \"binary\" && ( $major > 4 || ( $major == 4 && $minor < 5 ) ) ]] && \\\n        die \"Sorry, but gcc earlier than 4.5 will not work for libsass.\"\n}\nsrc_prepare() {\n    export LIBSASS_VERSION=\"${PV}\"\n    echo \"${PV}\" > VERSION\n    eautoreconf\n}\n```\nThe Variable ${PV} is actually derived from the package file name (gentoo ebuild specific).\n. I guess this way it will also work with compatible compilers (like clang). Also DEPEND will probably just check if such a gcc package is installed, and not if it is the currently active compiler version.\n. IMO this is clearly a job for postprocessors.\n\nRunning standard-output.js to compile styles/app.scss into dist/assets/app.css ...\nWhen we serve dist using a web server ...\n\nThis gives it away that the source file \"app.scss\" is indeed not accessible if you only serve dist. This is not really something libsass can solve. From your example I don't see how either Asset can actually be accessed, if you only serve \"dist\"!? Also, If we would support this, it would break the paths for other postprocessors! AFAIK the whole source-path stuff has also been verified by @am11 to work correctly the way it is now.\n. IMHO OP is \"moving\" files after the compilation (even if virtually via httpd configs). That's why I suggested that this is a job for a post-processor. I'm sorry but I probably going to close this as \"wontfix\". \nYou have this file structure on compile:\n- dist/ (empty)\n- styles/app.scss\n- vendor/bootstrap.scss\nyou compile this to\n- dist/assets/app.css\nNow you serve dist and of course the links to the other assets don't work, because they are not accessible if you only serve dist. You do not even give away under which url you expect i.e. styles/app.scss to be accessible (is it even somehow accessible)! If your assets would be under dist when you compile everything, it should actually work!\nI'm going go close this until we get further information!\n. @xzyfer IMHO this is ready to be merged! Anything speaking against it from your side? What do you think about the changes in the spec-test? Really hope everything is still in order :sweat_smile: \n. @am11 I've added the additional header you mentioned in your comment above, but output_nested and output_compressed have been removed actually (or I did not understand your comment)!\n. Thanks for the help with the appveyor ci build! :rocket: \n. Maybe someone that actually uses MSVC could create a patch to solve these warnings? Beside a struct is principally just a class with all variables defined as public ... but wouldn't hurt to get rid of these. We also do have a copy_c_str function which could act as a replacement for strdup.\n. Since nobody has any objections against it, I'm going to hit \"merge\" here in a few minutes!\n. Closing since it produces expected result with master (at least when #910 applied)!\n. The implementor could have a context, like testing if the content it is loading conforms to the rules it expects. IMO it could give more details where the actual error occurred, so I'm not really convinced to remove it. But you may be right that it is a bit over engineered. I guess it's no harm in leaving it in for now?\n. I added a switch, so if you set line and col to -1 (string::npos), it will throw the error on behalf of the parent context. This way you can just set the error message and leave the rest to libsass.\nC.sass_import_set_error(ent, errMessage, -1, -1)\n. Then you probably need to use string::npos, actually it is the biggest number possible, but mostly -1 should overflow to the biggest number (AFAIK) :wink: seems to work in C ...\n. You could return a list with one entry, where you only set the filename (no data). Libsass will then try to load that file through it's loading code, which would emit the error @am11 probably meant. But IMO you should only do that if you are sure the file does not exist, otherwise it could have strange side effects!\n. C\nsass_make_import_entry(\"non_existing_file\", 0, 0);\n. Should be fixed by https://github.com/sass/libsass/commit/9a3899afc31fa197f06dcbad59888aaa37064ad5\n. IMHO this is ready to be merged since it compiles fine in all CI build!\nI would like to mark this feature as experimental and include it in 3.2!\n. Actually I intended to remove it before I remove the WIP tag ...\n. I've removed the sample files. Will add the code to the wiki once this is merged!\n. Yep, you could create a dll with various custom (math) functions to be loaded by libsass.\n. a) No idea what you're doing wrong and b) no, sorry, works correctly here!\nBy the way you could have checked this via http://sassmeister.com/ yourself!\nJust make sure you select the libsass engine under options!\n. Going to close this as cannot reproduce.\n. Can you try the fix I have pushed to my current WIP branch!\nI did not test it myself, but I guess it should solve your issue!\n. Can you confirm that the latest master fixes this issue? If not I will have to take deeper look and test this more thoroughly. I just \"hope\" the fix I've added does what it should (and if it doesn't, it should be easy to correct it once and for all)!\n. Fixed some left over issues with interpolate parsing:\nAdded some more spec tests to https://github.com/sass/sass-spec/pull/270\n. I hope the following explains your question\nC\nstruct Sass_File_Context* sass_make_file_context (const char* input_path);\nstruct Sass_Data_Context* sass_make_data_context (char* source_string);\nSo we do make a copy of the path, since we expect it to always be a pretty cheap operation.\n. @xzyfer I know it's a bit messy, but it's easier this way to have a linear commit history. I can create single PRs for each issue. But it adds quite a lot of additional work, that is basically not giving any value to the final code base! So I hope we can merge this \"en gros\". I also assigned myself to all issues that are covered by this PR, so you should be able to get a list of issues I'm working on/have fixed!\n. My spec-runner tells me that the following test will now pass:\n- todo-issues/issue_346\n- todo-issues/issue_535\n- todo-tests/scss-tests/126_test_media_interpolation_with_reparse\nMost other fixes address issues that are either missing spec tests, source map related or about error reporting, which is not yet tested by the sassc spec runner (I have some tests in perl-libsass)!\n. OK, I'm merging this then! The code in this PR is probably not always the cleanest, but we need to get things going in a direction, so better than failing spec tests IMO. And there is a lot of existing code that could need improvement, and I basically just trust the spect tests and CI here :rocket: \n. Would be helpfull to have a specific commit to pin your issue!\n. Yep, you need to make clean if some header structures have changed, which was definitely the case!\n. Closing this as downstream (node-sass) error!\n. LGTM! Thanks for your contribution! Will wait for CI (appveyor) to return results before I merge it!\n. Thanks for the report. Could you add a simple spec test PR, since it looks like we are missing this case! Otherwise this would already have been catched by CI. Thanks!\n. IMO the second test (import_within_selector) cannot be tested currently, since it actually should fail (and we cannot yet test any errors).\n. Going to close this since it seems to be already resolved on master and it is currently the last open issue in our 3.2 Milestone!\n. comment moved, wrong issue :tired_face: \n. Got the first results back from travis-ci :smile: \nFinished in 45.557478s, 86.8134 runs/s, 234.8901 assertions/s.\n3955 runs, 10701 assertions, 0 failures, 0 errors, 388 skips\nWaiting for updated coverage report now ... not much (+0.76%), but there are a lot more \"relevant\" lines now, so all in all a progress in the right direction (I'm sure that with testing the new output styles we are using a lot more code paths, that we didn't use before; but I expected a bit more) ...\n. We provide all the information needed to let implementers do this as they like. IMO we don't want to create such \"text pointers\" inside libsass, since once probably wants it in this style, while other prefer it in a completely different style.\n. OK, I guess this probably is a usefull feature and you're lucky since we have a field that we \"mangle\" anyway in sass_context (//CC @am11). We now actually provide two \"messages\" for errors on the context error_text contains the original error message and error_message will contain a \"decorated\" message, in the original ruby sass style, plus the new arrow indicator.\n```\nError: invalid attribute name in attribute selector\n        on line 1 of test.scss\n\n\nfoo [ { bar: baz; }\n   -----^\n```\n\n\nCurrently we have a minor mess at how we report errors, since we do not really report them in the same way as ruby sass does (and we don't test them), at some points we even give more detailed error messages. I added some code in preparation to streamline this in the PR for this issue, so at least the output format is the same, although this PR adds something that is not in ruby sass, but the implementor can still chose to get the original text to format it as he sees fit!\n. This does not touch json_err, only the raw objects on the context. Not sure in what format it would make sense to pass further down, you can always get it via C-API, it's just not part of the json. Actually the \"message\" on json is the same as err_text on context, only err_message on context is \"decorated\".\n. It's an example how to implement a plugin. Just had it laying around so I thought better to include it in the new contrib folder, than to have it wasted (I used it to verify the plugin implementation).\n. Are you using latest master (3.2 beta)? Because there was a breaking change in this direction:\nChange in sass_make_data_context - libsass now really takes memory ownership\nThe interface always was intended to be char*, but we messed that up and actually made a copy ourself (which would have meant the arg should have been const char* #869). The intention always was that implementors can pass the memory ownership to libsass, since we want to avoid a copy if possible. This basically just means that you probably have to provide a copy to libsass yourself.\nC\n// ctx = sass_make_data_context(source_string); // old\nctx = sass_make_data_context(strdup(source_string)); // new\nBTW. we have sassc on the radar for 3.2, but I thought it was still working since CI didn't break?\nhttps://github.com/sass/perl-libsass/commit/3b342465bce9eff9629e84ab0bda2560e7c7b8d2#diff-5b390435e30d16e259818ad6b65d1dafL620\n. Are you using latest master (3.2 beta)? Because there was a breaking change in this direction:\nChange in sass_make_data_context - libsass now really takes memory ownership\nThe interface always was intended to be char*, but we messed that up and actually made a copy ourself (which would have meant the arg should have been const char* #869). The intention always was that implementors can pass the memory ownership to libsass, since we want to avoid a copy if possible. This basically just means that you probably have to provide a copy to libsass yourself.\nC\n// ctx = sass_make_data_context(source_string); // old\nctx = sass_make_data_context(strdup(source_string)); // new\nBTW. we have sassc on the radar for 3.2, but I thought it was still working since CI didn't break?\nhttps://github.com/sass/perl-libsass/commit/3b342465bce9eff9629e84ab0bda2560e7c7b8d2#diff-5b390435e30d16e259818ad6b65d1dafL620\n. Ok, so all you're saying is we should change delete[] sources[i] to free sources[i]? Since it is indeed a c string I agree, this would be the more logical thing to do. Seems like we got away with it so far ...\n. Sources is the main array/vector for all loaded content (libsass also adds the sources for files it loads via import to that vector, which should definitely be freed), We keep copies to those char* pointers in various locations, but they are only freed via sources. IMO the API makes sense now and is consistent, but as mentioned, it is a breaking change. Sassc hasn't been updated yet, and the segfault is pretty much expected, since now sassc and libsass will both try to free that memory! Either sassc has to pass ownership to libsass (and not free it on its own) or pass a copy to libsass!\n. Thanks for the hint @xzyfer. I guess we should promote the following command set in the future:\nbash\nsass --unix-newlines --sourcemap=none -t nested -C \"input.scss\" \"expected_output.css\"\nsass --unix-newlines --sourcemap=none -t compact -C \"input.scss\" \"expected.compact.css\"\nsass --unix-newlines --sourcemap=none -t expanded -C \"input.scss\" \"expected.expanded.css\"\nsass --unix-newlines --sourcemap=none -t compressed -C \"input.scss\" \"expected.compressed.css\"\n. As @am11, myself and others already have put it, we should probaly create a dedicated spec runner inside libsass repo (in C/C++). That way we could include tests for sourcemaps and errors/warnings (and other more API consumer specific issues). IMO it's not worth the time to update the current ruby runner to support many more features, since the bindings there are pretty much lacking any real integration with the available API! With 3.2. we can probably provide a plugin to implement something I already proposed in https://github.com/sass/sass-spec/issues/136#issuecomment-66577402. But I like your feature suggestion! I currently have to adjust the path by hand inside perl-libsass spec-runner!\n. I currently use UnitTest++ in sourcemap.cpp.  IMO we could keep the current spec runner and only add an additional native spec runner for API tests. But in the long run a native runner seems the best option!\n. We now have a passing spec test since #1249 was merged :balloon: \n. Libsass now much more correctly parses escaped chars. Maybe ruby sass has a special rule for lines with trailing backslashes, which I probably didn't encounter when I did the refactoring. Anyway, seems easy enough to support. But in term of CSS the backslash there does not make much sense IMO!\n. Unfortunately I, Travis-CI and Appveyor cannot reproduce the issue.\n@am11 I'm going to close this since we have this CI tested!\nPlease open a new issue with your output if problem persists!\nP.s. I'm also always testing specs with perl-libsass on windows :wink: \n. Can you open a new issue for that with expected and actual output! Thanks!\n. LGTM and CI seems to agree :smile: \n. @am11 it simply did not complete the spec tests in debug mode, so I simply switched that off! Seems like we have fixed it in the mean time and you were the first one to stumble up on it!\n. Actually we parse something ... an empty list :smile: \nBlock 0x29b5680 0\n Ruleset 0x21e77a0 0\n  Selector_List 0x2332e90 [block:0x29b5680] [root] [@media:0] - - -\n   Complex_Selector 0x21e76e0 [block:0x29b5680] [root] [@media:0] - - - -> { } <> X < >\n    Compound_Selector 0x22dfcd0 [block:0x29b5680] [root] [@media:0] - - - <> X < >\n     Selector_Reference 0x285efa0 @ref 0\n   -Complex_Selector 0x21e7620 [block:0x29b5680] [root] [@media:0] - - - -> { } <> X <>\n   - Compound_Selector 0x22dfbd0 [block:0x29b5680] [root] [@media:0] - - - <> X <>\n   -  Type_Selector 0x285f100 <<foo>> - <> X < >\n  Declaration 0x2dbf1d0 0\n   prop: String_Quoted : 0x285f1b0 [bar] <> X <>\n   value: List 0x2dbf100Space  [delayed: 0]  [interpolant: 0]\nBTW. it is returned explicitly empty from parse_comma_list ...\n. I can confirm that this bug exists on latest master.\nTest case can probably be shortened to:\nCSS\nfoo { bar: 10 * 5#{px}; }\n. @xzyfer I gave it a try, but it is a bit more complicated than expected. Actually with my first approach it started to accept stuff like this (which I found quite neat, but is not what ruby sass does):\nCSS\n10f#{o}o + 20foo -> 30foo\nIt also correctly complained when units where off for calculations. Not sure what the reasons are for ruby sass to not evaluate interpolated stuff into numbers again (there was actuall only one failing spec test with function type returning number instead of string). IMO ruby aborts the Binary_Expression parsing when it sees some interpolated stuff, which seems not that easy to implement currently (I suspect this has also something to do with our \"everything is a space list\" issue).\n. We now have a passing spec test since #1249 was merged :balloon: \n. This is the selector groups may not be extended error, which is simply a missing feature. I renamed the title since you didn't include this in your report, so the search can find this issue. @xzyfer feel free to assign a milestone, since I think you have more expertise in this area!\n. Actually this already works, once we remove the check that throws the error. Made a blame check and it was in place since the expand source file was introduced. So I just removed it, added a loop around the existing code and it does the right thing at least in this case. So I would like to ship this with 3.2.0. I honestly have no idea how well the feature is supported, but I guess we'll see :smile: \n. This is fixed on latest master (probably https://github.com/sass/libsass/pull/888)\nCSS\ntest {\n  underscore-error: false;\n  mixin-exists-1: true;\n  mixin-exists-2: true;\n  /* Fails ought to be true */\n  mixin-exists-2: true;\n  /* Fails ought to be true */\n  mixin-exists-3: true;\n  /* Include works in all cases */\n  content: 'block included';\n  content: 'block__element included';\n  content: 'block__element included';\n  content: 'block--modifier included'; }\nPlease try to verify issues against latest master before posting them and you should always include the version of libsass you're currently using (plus OS and other related information) ... thanks!\n. :+1: for the new specs!\n. @xzyfer do you think you can come up with a better solution in a reasonable timeframe for the 3.2.0 release? IMO I'd rather include this PR as is than not including a fix for the reported issue. Would really like to include this fix in the next beta! Or do you see any obvious regressions in the changes?\n. Merged it beside the concerns given by @xzyfer. IMO this seems to be an improvement and we can add a more precise implementation later. Just want to have this included in the next release!\n. @xzyfer IMO this is a pretty important fix, so we should probably include in 3.2? We might see more similar errors in the future, since we now try to preserve all block comments as ruby sass does, which is pretty much impossible, if any lexer or peek just skips over them (I guess we only need to preserve comments directly in Blocks, but can ignore all other cases (like in declarations or values).\n. There are alternatives that are compatible, just dumb I need to rebase that many commits :disappointed: \n. Holy moly, AppVeyor returned before Travis-CI :astonished: @am11 IMO it would be more usefull to split the stderr into its own file (2>output.stderr). Basically we expect the same error for all four output styles, so if the test runner sees such a stderr file, it only has to do one test (at least that's how I probably would implement it today).\n. @xzyfer This could either be 3.2 or 3.3 IMO, but since it fixes one bug, we may want to include it in 3.2 anyway. I could also remove the new error output and only move that to 3.3 (I added some more text to the first post in this PR). IMO we should at least address the error itself!\n. @xzyfer\n\nWe might see more similar errors in the future, since we now try to preserve all block comments as ruby sass does, which is pretty much impossible, if any lexer or peek just skips over them (I guess we only need to preserve comments directly in Blocks, but can ignore all other cases (like in declarations or values).\n-- from #955 \n\nSo lex_css is basically the same as lex was before my major refactoring on output and interpolation. New lex function is the same as it was after my refactoring (which fixed a few issues where block comments where wrongly thrown away). This introduces regressions like we are seeing in #938. So lex_css basically does a lex < block_comment > before it tries to parse the actual token. This also has the benefit, that source-maps will get more accurate. We should never use something like lex < optional_block_comment, token >, because the source-map position will point to the position of the block_comment. IMO we had a few such cases. Other than that I just tried to clean up those function, but they should behave the same!\nIMO it's quite an important fix, since there are more places where block comments will currently fail (IMO). This PR does improve that, but is for sure not covering everything. IMO fixes for such issues should become pretty easy, as you should only need to change lex/peek to lex_css/peek_css.\n. @xzyfer Due to your request I tried to be even more specific, but I already added comments for all new relevant functions. Maybe I didn't understand your concerns, but it was pretty well annotated already!\n. So you're ok to include in 3.2?\n. This basically boiled down to have custom headers. I implemented something experimental in #1000 to support custom headers. I will paste the relevant parts from the linked issue:\nCustom headers (#960) act like importers, but only run once at the beginning of each compilation. They are primarily meant to define custom mixins (via plugins or context options). Beside that they might be usefull for other cool things I currently cannot think of :smile: Opposite to custom importers, all custom headers will be executed in priority order and all imports will be accumulated (so many custom headers can add various custom mixins or css-code).\nHere a little preview from my perl-libsass test:\nperl\nheaders => [\n  [sub { return [['header-02', 'div { b: .5; }']]; }, .5],\n  [sub { return [['header-03', 'div { c: .1; }']]; }, .1],\n  [sub { return [['header-01', 'div { @include mixme; }']]; }, .9],\n  [sub { return [['mixin-01', '@mixin mixme { a: .9; }']]; }, 1009],\n],\n. Merged #1000 which contains a first experimental implementation!\n. The benefit if we provide our own implementation is mostly toward c++/c plugins (which can also be used by node-sass or any other libsass consumer btw). IMO it makes sense to have one API for this, since otherwise plugins may not be interoperable. But from an implementation standpoint, this functionality could be offloaded to a plugin, which in turn would handle the loading and calling of other plugins (they would only interact with the first plugin and not with libsass directly). IMO it makes more sense to bake this directly into libsass, since this layer of abstraction would not give much benefit. The current implementation would basically work the same, just adding one function that would signal it wants to handle every import it is given (and having the highest priority).\nThe idea is that you could create a http_imports.dll, which then could be used by node-sass, perl-libsass, sassc and every other consumer. We could have added css imports, sass imports etc. with such a dll. IMHO it makes absolute sense to evolve the current custom importer system in this direction!\n. Each importer will first be asked if it is able to handle a certain url we encounter in imports (like plugin[0].canHandle('http://...')). This check is the function we would need to expect each importer to implement (so it can tell libsass which imports it can handle). I hope this makes it more clear!\n. The canHandle function is part of the plugin itself. Libsass asks the plugin, if it can handle a certain url. So the import may look like this **/*.ccss (custom css). Your plugin could now say, ok, I can handle that url/path. Now it is in charge to actually do something with that url. IMO you could just expand that to a list of imports where you only set the filename, so libsass would take care of any further loading!\n. Merged #1000, which contains a first experimental implementation!\n. @onedayitwillmake sure, if you made some substantial progress, do a WIP PR!\n. I have the base work done by @onedayitwillmake included in my latest WIP branch!\n. We are now passing most spec tests since #1249 was merged :balloon: \n. :+1: \n. Congrats @ekskimn for such a great contribution. Hope you stay around and would love to see more contributions of that quality. One major feature off the checklist, great stuff!\n. I need at least a sample SCSS code, OS and compiler version to debug this any further! To be honest, I don't even get OPs problem, since without returning an error he seems to get Error status: 0 and when returning an error you get Error status: 1. Doesn't that be what you'd expect. Maybe I haven't understood the problem actually!\n. Ah, now I understand, but I wonder if this is the expected behavior. I guess this also should be part of our roadmap to support error spec tests (we should somehow include the expected exit status there). Just to let everyone know, mingw has a problem when it throws native errors (like runtime_exception), which is a known bug and will not be catched by any implementor (when compiled with mingw!). Actually the fix for this seems pretty easy, as we only would need to call exit in custom errors explicitly!\nIMO this is a pretty minor bug and I'm not sure if we can address this in 3.2 beta.\nBTW. both features are still marked as experimental (mainly importers and less functions)!\n. I ACK that this is probably not working as expected, but as I said, you're using experimental features here. In order to be able to stabilize such features, we need users like you that run into such traps we didn't anticipate! IMO we have more important regressions to address in this beta and I'm pretty sure this bug was existing since its introduction. I hope this doesn't offend you, since it only means a re-scoping for that issue. And by your original examples, I would guess you have a pretty good knowledge of c/c++! So would like to encourage you to take look at the code, maybe you're able to solve you're problem on your own and provide a PR to libsass!\n. @xzyfer we are IMO only talking about returning errors from custom functions! So this should not touch sassc by any means!\n. You're sure that wasn't the same before?\n(Just want to know if it is a bug or regression?)\n. @xzyfer you mean for custom functions, or by actual \"first appearance\"?\n. OK, got it now :) IMO let's first asses how difficult it is to fix, before adding a milestone again! But yeah, it should be a pretty trivial fix in this case :wink: (error status is set in sass_context ...).\n. I do agree, but to be honest I would expect a company to have one guy submitting a PR to solve their problem. IMO we now have a very active merge policy, so we should encourage participation by companies in exactly this way. That's probably my personal opinion, but if companies want to use this software, they should at least be willing to contribute a little back; If they encounter a problem they can solve in one or two days, they should just do that and submit a PR!\n. :+1: that's great news! And if you need any further help, feel free to ask. I would start somewhere in sass_context, since this is the first layer which sassc interacts with and where the actual error status should be passed to sassc (aka the implementor)!\n. To be honest, manually! We don't have any other means to test this currently (and exit code probably is second prio after beeing able to spec test error messages on stderr). The only thing I could offer is that you put your test into perl-libsass.\n. No idea what this is actually about, since I'm not really a fan of fruits that others already took a bite off :smile: Since it doesn't touch any other files, I'm ok with it, just wonder if it would be better suited under the new contrib folder, since we probably cannot support this \"officially\"!\n. By the way, by adding the plugin API it probably got even harder to compile libsass as a pure static library! I had to remove the -static flag to get it to compile on CI, since the libdl dependency was throwing errors when compiled static (since it is expected to load other libraries on runtime dynamically for plugins). It might be possible, but my gcc/make foo was not good enough to keep the real static compilation in the Makefiles!\n. @onedayitwillmake Maybe I could also \"force\" you to create a small wiki page to describe what you expect people to do with these files :wink: \n. Currently every line of documention is probably a 1% increase in documentation :+1: \n. @onedayitwillmake Thanks a :100: ! IMO this adds a lot of value to these files! As I said, I would rather see this under the new contrib directory, so maybe you could ammend your commit to put these filese there (//CC @xzyfer)!? Not sure, but could this be tested by a CI service?\n. I saw the update on the UI which indicates linux builds, but I didn't find anything about opening mac support (maybe we would be eligable anyway, if we applied for mac os builds).\n. @xzyfer so you're willing to \"maintain\" these build files as I do the mingw stuff? If so, I'm also ok to include it in the main directory (we actually should move the source/header files to different directories, as the makefiles are ok there). And maybe someone could just ask travis-ci about that (and no I didn't just volunteer, I'm away the next 5 days). I'm just asking, but let @onedayitwillmake have a chance to make it right, so we can merge it :stuck_out_tongue_winking_eye: \n. @onedayitwillmake you can create a space on travis-ci for your own libsass fork, where you can play with the config file (.travis.yml). I use that workflow when I work on feature branches!\n. @onedayitwillmake Each build should actually just build one library, so not sure why you seem to compile two libraries at once. IMO you will need to add a new compiler type, like we currently have for gcc and clang, and you may have to use env vars (in travis.yml) to do it. It could help if you post the url to some travis build, since I'm not familiar with Xcode at all.\n. travis.xml just sets some env variables and calls others scripts (as you already found out), so you need to put the xcode stuff somehow into those scripts. It may need some refactoring to do this properly!\n. As I said before, it would help if you could show us your work in progress ...\nTravis currently starts 4 processes, each starting with a clean state. Currently we have no mac support on travis, so once this would be added (is it even available for all on travis?), we will probably have about 4 more processes on travis. In the build scripts you actually find:\nif [ \"x$AUTOTOOLS\" == \"xyes\" ]; then\nSo you need to test for your variable or arch, or whatever fits your needs here. Maybe it will be more efficient to add another build script for your use specific use case and add a switch to travis.yml which scripts gets called. But since I have no idea what you actually need to do either, I'm just guessing!\n. It's pretty confusing indeed, I can see that job 1379.5 has an \"Apple\" icon, while the others have a \"tux\", but is still reported as \"worker-linux-3da96de7-1.bb.travis-ci.org:travis-linux-6\" !? I have no ideas about Mac OS X, but is brew installed by default or not (should be worth a try to install as @xzyfer suggested).\nI would also add a uname -r call (or something else that works in Mac OS X)!\n. My tests indicate that it works as intended: https://travis-ci.org/sass/libsass/builds/56759363\nHere the travis.yml it is using:\n``` bash\nlanguage: cpp\nos:\n  - linux\n  - osx\ncompiler:\n  - gcc\n  - clang\nenv:\n  - AUTOTOOLS=no COVERAGE=yes BUILD=static\n  - AUTOTOOLS=yes COVERAGE=no BUILD=shared\nmatrix:\n  exclude:\n    - compiler: clang\n      env: AUTOTOOLS=yes COVERAGE=yes BUILD=static\nscript: uname\n``\n. @onedayitwillmake as you may have seen the compilation via Makefiles and Autotools works as expected on OS-X without a hitch (#1024). So I wonder what the benefit of this xcode build is? Some of the files you added seem to contain md4 hashes of the source files? Or are they static (like the GUIDS in MSVC build)? They also seem to be mentioned in multiple places. My main concern here is that we have to maintain these files after all if we include it in our CI process, and I'm currently not sure what the benefit of it would be, since we have Travis-CI and OS-X now working with clang and the existing build scripts.\n. Does xcode use clang under the hood? If so, I really don't see any benefits in including it in the CI process. But we may still include them in the contrib directory or you could create a separate repository on github to include them (you may even be able to add your own CI process there). I just don't understand why the source files are mentioned multiple times, seems silly to me, but I guess xcode is not really for console lovers :wink: @xzyfer what's your opinion here?\n. Ah I see, they are all in comments but one. So that clears this up. Now the only thing is that they are actually referenced multiple times. Well for MSVC we have to add them in two places/files, so it seems doable, but still quite a bit more difficult, as it seems. I'm not sure what the best place would be to put these files in. They should IMO all be in a separate folder and we should probably add a readme there indicating that we do not really keep those files in sync etc.\n. @xzyfer If you are using the files yourself I see it much more positive, since I hope in that case they will not get stale very soon. I guess you personally don't get any benefit if we add it to the CI process? So I think it should go either into./xcode/or./contrib/xcode/`. The first one would be more similar to how we have MSVC builds in the tree. And for their alphabetical neighbourhood, I'm actually in favor of that. IMO the tree structure is a mess already, so no harm done :smile: \n. I don't really understand your concerns. It is indeed a breaking change as documented in the release notes (related issue https://github.com/sass/libsass/pull/925). This actually only means that you have to pass libsass a copy of the source, it you are not able to tell you garbage collector, that you've given the control over to someone else!\nTo be clear, you have to call strdup if available, or you can use sass_strdup from libsass (if using c++, not sure about c). If you don't have them, yes, you need to implemented a function with malloc and friends. So if you have a string in c, you now have to pass strdup(string.c_str()). IMHO not really that much of a concern. https://github.com/sass/node-sass/pull/764 and https://github.com/sass/perl-libsass/commit/589d490347e20df6038e34e77183506b65aba303#diff-5b390435e30d16e259818ad6b65d1dafR651\nOK, saw your example code and I guess that is all you need sigh\ncontext = sass_make_data_context(strdup(string));\n. I don't really understand your concerns. It is indeed a breaking change as documented in the release notes (related issue https://github.com/sass/libsass/pull/925). This actually only means that you have to pass libsass a copy of the source, it you are not able to tell you garbage collector, that you've given the control over to someone else!\nTo be clear, you have to call strdup if available, or you can use sass_strdup from libsass (if using c++, not sure about c). If you don't have them, yes, you need to implemented a function with malloc and friends. So if you have a string in c, you now have to pass strdup(string.c_str()). IMHO not really that much of a concern. https://github.com/sass/node-sass/pull/764 and https://github.com/sass/perl-libsass/commit/589d490347e20df6038e34e77183506b65aba303#diff-5b390435e30d16e259818ad6b65d1dafR651\nOK, saw your example code and I guess that is all you need sigh\ncontext = sass_make_data_context(strdup(string));\n. Don't allocate via c++ (new), just pass memory allocated via malloc or any other function you know the semantics of. I don't know any other way, but the sources vector has this contraint, since it frees (not delete) the memory is has assigned (meaning it has to be allocated via malloc before, and not via new). The easiest fix seems to make a copy, as with a c++ string: strdup(string.c_str()), to be sure to comply to this constraint. Actually we get reports in whatever direction we go, but since it is a char* pointer, the C semantics for memory allocation seem to make sense!\n. Sorry but a clear no here, because we want to allow optimal performance. Why should you want to make a copy if you only loaded it for libsass. It might be minimal, but that what the interface always was designed for (this would then need to change a lot of char* to const char*). It was an error on our side to make the copy in libsass 3.1. I don't see why this is such a big issue, or asked otherwise, why can't you give libsass control over your loaded memory (do you really still need it -> make a copy)?\n. Still not sure what the problem is, before libsass made the copy (always), now you can decide if you can move the memory to libsass and if not, you now have to make the copy yourself! Nothing more, nothing less! So in your situation you either need to tell your GC that it is no longer in control of that memory or you simply create a copy (which again, before libsass was always doing a copy for you, so disallowing the move of memory, which is now possible)!\n. Whitespace was not \"actively\" lexed, so position still points to the position it is reporting. Maybe we should move the parser when an error is thrown (we attach the prefixed whitespace to each lexed token, so we should not just munch away whitespace on it own).\n. OK, the actual bug is caused by the way lex works together with the error function in parser.cpp. Normaly when we report errors, it is about the thing we actually lexed. But with this error we actually already lexed the whitespace (and that's why the error \"somehow correctly\"  points there). One easy fix is to set before_token to after_token before calling the error (both are members of the Parser class and contain line/col positions).\n. I was pretty sure it was fixed, but it looks you're correct => #1002\n. Added a new commit which will hopefully solve it now (https://github.com/sass/libsass/commit/8d8dc08fdff06e33ccde3725003837968d3f1ae0)!\n. Unfortunately this breaks my build on windows with msys and autotools.\nWill check now if I can find the culprit and see if there is a workaround.\n. I have cloned and ammended your branch so it compiles again on mingw/windows. @saper Maybe you want to give it a review? Then I could either create a new PR or you update your branch with mine.\n. Since I did a lot of refactoring in the parser, I guess this is no longer really relevant!\n. LGTM :+1: ! Maybe we want to include this in the next beta as is? IMO you can still take it from there!\n. Merged it beside the concerns given by @xzyfer. IMO this seems to be an improvement and we can add a more precise implementation later. Just want to have this included in the next release!\n. I IMO have a valid fix for this in https://github.com/mgreter/libsass/tree/bugfix/issue_976\n. This is fixed by https://github.com/sass/libsass/pull/990, hope you don't mind @xzyfer :wink: \n. IMO this is superseeded by https://github.com/sass/libsass/pull/990. That PR implements word boundary assertions for all keywords. I also refactored the prelexer quite a bit and was able to improve the performance quite a bit. I guess your pretty busy right now, but I hope we can get this included in 3.2!\n. @xzyfer I hope you don't mind, but this should be fixed by #990 !\n. IMHO the bug occurs because fallback somewhere is returning parent which is null in this case. Bit I wasn't able to further debug into it, so not sure if this really is the problem. Edit: this is happening in Contextualize::fallback_impl.\n. I guess this has changed in ruby sass without us noticing. I just had to remove the existing check and everything seems to work correctly (#981). I took the liberty to adjust the test case from @davidkpiano above and I hope someone would volunteer to create a PR on sass-specs for this, thanks!\n. Pretty much an oversight. Maybe you're willing to create a PR in this regard yourself? Should be pretty easy to add this function. I will probably not come around to do it before the weekend!\n. @rodneyrehm I guess you already have tested it? I guess it should be ok, but I'm a bit worried because it's a char** in this case ...\n. I come to the same conclusion as you with char**, it's just that it is slightly different than all the others and it often tends to bite me in the ass if I just blindly trust my logic :wink: Going to merge this since you confirmed that it at least works in your context. Impacts are pretty slim with this function anyway!\nThanks for the contribution @rodneyrehm !\nBTW. On my todo list also to update sass.link.js :smile: \n. First thanks for your detailed report (I wished more people used links the way you did!) and secondly, I hope you are aware that custom importers are considered a highly experimental feature. I agree that the handling for @imports may should not skip the http part, but the only real benefit I see is that you are able to emit @imports, that will be moved to the top of the css by libsass automatically.\nFor the behavior I disagree that custom importers should just act as a fallback. Maybe you want to have some preprocessor for files libsass would otherwise just process on its own. Currently you can return null from importers, which should actually completely \"skip\" the custom importer (IMO returning null in custom importers should give you your desired result). Maybe you missed that one? I just added a sentence in the wiki right now to document this.\nFor the V8 stuff you better ask the node-sass guys (AFAIK they use libuv for that).\n. The API was exactly made public/available for that purpose :wink: By moving imports to the top I mean that you can emit/have @imports in the middle of a sass file and libsass will take care to move it to the top (as it has to be for css and as ruby sass does AFAIK).\nOK, I guess I see what your trying to say (sorry, your original post was a bit long to distil the important parts correctly). So you would like to access the function libsass uses to resolves the filename to an absolute path or get access to the import paths itself. Correct? IMO this was already acknowledged in another ticket to be missing and I agree with that (IMO both options make sense, and we may also want to give access to other options).\nWe also have another ticket open about custom importers, so the whole API will probably get quite a big change with the next or so release. Maybe you want to give some feedback there too? IMO if I didn't miss anything else in this ticket I would like to take this over to the other ticket!\n. Feel free to add to the wiki if you have verified examples! Any help is welcome!\n. @drewwells I'm actually quite surprised that you see such an improvement. My benchmark test was really not a real-wold case and I was more concerned with the memory usage there (DOS). I would also like to implement memory limits for allocations as it should be trivial inside memory manager.\n. Btw. related issue https://github.com/sass/libsass/issues/613\n. I actually have another optimization pending in https://github.com/mgreter/libsass/tree/refactor/prelexer. With that branch, my spec runner reports a pretty nice improvement :smile: So stay tuned!\nin 14 wallclock secs (14.24 usr +  0.47 sys = 14.71 CPU)\nin 12 wallclock secs (10.94 usr +  0.58 sys = 11.51 CPU)\n. @xzyfer maybe you want to review? IMO it's ready to be merged!\n. IMO this is about two seperate issues - one was fixed quite some time ago, but there is a new regressions in #988, that this sample also suffers from. With the PR in #989 this should be solved!\nGoing to close this as a duplicate of #988 !\n. I already have this on my radar and a proper fix will need some more re-factoring, as it will cause another spec-test to fail otherwise. Altough I have a hotfix which I probably will include in 3.2.\nin functions.cpp line 945\nC\n- return new (ctx.mem) String_Constant(pstate, newstr);\n+ if (newstr == \"\\\"\\\"\") new (ctx.mem) String_Constant(pstate, newstr);\n+ return new (ctx.mem) String_Quoted(pstate, newstr);\n. If you can, please test with PR #989 applied and report if it fixes your issues! Thanks!\n. @drewwells maybe you can confirm the performance improvements!? Thanks :wink: \n. This belongs to downstream node-sass!\n. IMO it's easier to just replace nullptr with 0, I see no real need for it, we use 0 all over the place.\n. Good catch and sorry for the inconvenience!\n. We do not provide compiled binaries. We expect distributions (like rpms for linux) or implementers (like node-sass) to provide those if necessary. This would rather be a question for sassc actually, since libsass would only provide a dynamic library (so or .dll) and nothing really usable on its own.\n. @drewwells you are probably looking for included_files, which is already documented in the wiki!\n. @am11 yup, spot on. Also check out custom headers, which are registered exactly the same way as importers. Only difference is that all custom headers will be called and their imports get accumulated. It's really just an array of importers that get called at the start of each compilation. As for the priority, you may be able to attach a priority property to the js function? Like so:\njs\nfunction importer(...) {\n  return ['filename', 'div { ... }'];\n}\nimporter.priority = 99;\nvar options = {\n  // old and obsolete\n  // importer => importer,\n  importers => [\n    importer, // = importer.priority || 0\n    [ importer, 5 ] // = 5 || importer.priority\n  ]\n}\nIn perl I opted for a simple array ref:\nperl\nheaders => [\n  header1, // will get default = 0\n  [ header2, 1] // gets specific prio\n]\nWhat priorities people give to their importers is pretty much out of this scope, but I could propose these very personal guidelines, which are probably really just a bad first guess:\n```\n\n0 : headers that only define stuff\n<=0 : headers that output css code\n1 - 100 : for personal stuff\n100 - 1000 : for framework stuff\n1000 + : for distributed frameworks\n``\n. Be aware that the priority has to be passed to libsass before the importer gets called (you cannot include it in the return of the importer). And yes, I could merge this PR and create another beta, so node-sass can catch up and do another beta on its own, so things can get settled! IMO you should be able to copy pretty much all code from custom importers for custom headers.\n. It looks like it was renamed tosass_import_set_list_entry...\n. Maybe helpful: [commit needed forperl-libsass` to bring it on par with 3.2.0-beta.4](https://github.com/sass/perl-libsass/commit/85fbc0573609ec5e22270ba0160c6fb8fc41800b)!\n. We have two ways to add custom functions, headers and importers in libsass. Via the C-API options for implementers or by loading native libsass plugins. So the priority is needed since we have more than one array to consider. From the libsass implementation it's just a slightly different use of custom importers, so the feature was quite cheap and I do see the benefits in regard to native plugins.\n. @chriseppstein I agree that it is probably over engineered to expose the priority to the \"options\" C-API (which is what implementers use). From our point it is just convenient to have exactly the same transfer C objects for both C-APIs. IMO it doesn't make much sense to create new functions in the C-API just to maneuver around this. Instead we should indeed give some guidance which ranges are for what use. I already posted something in that direction:\n\n```\n\n0 : headers that only define stuff\n<=0 : headers that output css code\n1 - 100 : for personal stuff\n100 - 1000 : for framework stuff\n1000 + : for distributed frameworks\n```\n\nWe also could enfore certain ranges for plugins. But I don't know what you mean by \"before the load path\". IMO the use case where you simply have a list of importers/headers is possible, as libsass should execute same priorities in registration order (but I have to confess, I didn't really test this).\n@chriseppstein is this a showstopper for you for the upcoming 3.2.0 release? The API is still marked highly experimental, so IMO it should be ok for now. IMO we can further discuss this to get to an agreement on a high and low value after we released a first \"draft\". \n. IMO it's actually not very hard :wink: \nC\nchar** incs = sass_get_included_files;\nwhile (*incs) { process(*incs); ++incs; }\n. If you need to compute the length beforehand you could use plain C:\nC\nsize_t l = 0; while (*incs) { ++l; ++incs; }\n. Sass_Interface is obsolete and will be removed soon! I'd rather have a function return the result from the snippet I posted above in the API, than keeping a counter in sync with the null terminated array. I don't see any benefit to have this cached on our side! We would also need to take care of updating it when sass_context_take_included_files is called etc.\n. A shorter and future-proof (but slightly slower, if called multiple times) equivalent would be:\nC\nADDAPI size_t ADDCALL sass_context_get_included_files_size (struct Sass_Context* ctx);\nsize_t ADDCALL sass_context_get_included_files_size (struct Sass_Context* ctx)\n{ size_t l = 0; auto i = ctx->included_files; while (i && *i) { ++i; ++l; } return l; }\n. Please check #1000 as I have a commit there which includes the code from my latest comment!\n. Libsass doesn't guarantee it (ie. if you call it too eraly, before compilation has taken place). I would say play safe here, as it doesn't really imrpove the performance anyway!\n. This also fails in mingw (I know that AM_PROG_AR will not work for me)!\n. Thanks for the usefull report! Fix is in #1008!\n. CI seems finally happy! IMO this is ready to be merged!\n. @xzyfer should we include this in next 3.2.0-beta.5 release?\n. I wanted to have the real feature freeze when the next node-sass beta is out. As I have written in #1020, we should create a new beta once node-sass is ready to release its next beta. IMO we can add a few more bugfixes until then. But from then on I would say we close the window and really only commit bugfixes. BTW. the original issue was marked as a bug, so technically this is a bugfix :wink: \n. Why is it called at-root in the PR and at-error in the code/test ?\n. OK, guess most important is the commit message :)\n. I thought I was going insane, since I kept removing dead code paths, but somehow the coverage score still managed to decrease. Turns out pretty much the whole isPrintable code is actually not needed for the spec tests. Maybe we are missing some tests or I don't see the reason why so much code seems to be unnecessary, but results seem to be valid!?\n. This is the last issue (beside regressions) marked for 3.2.0. IMO we should re-scope to 3.2.1!\n. IMO this is now obsolete (although we dont yet support interpolation) ...\nIf you find time please open an issue for interpolation and reference combinators!\n. Please be so nice to include more information (some or all of: used versions, used tool, sample input, sample output, expected output, actual sourcemap, expected sourcemap). Thanks!\n. @onedayitwillmake I have fixed a bug in #1033 regarding is_superselector_of function. Maybe you could verify if that fix works correctly with your WIP?\n. > from @am11: I am almost ready. Can you please release a beta with the Sass_Compiler fixes, so our submodule points to libsass release, instead of some random commit hash? I will wind up the two open PRs soon and publish the next beta. \n\n-- https://github.com/sass/node-sass/pull/832#issuecomment-89608707\n\nI will release the next beta (rc2) in a few hours so node-sass can reference it for their next beta. Will just check if I there are some more easy fixes for some of the newly opened issues. @am11 please scream if you desperately need the beta right now!\n. We have atm fixed (PR ready) all reported regressions. Thanks to all the testers and issue reporters! The reported issues are somewhat in the expected areas. Good news is that we had no real major regression, thanks to the extensive test suite and CI. We have broken one main feature due to missing spec tests (@elseif). Actually I remember that I saw this code path not beeing tested in a coveralls report; so always worth a look to check in which areas we lack testing!\nSo we had only a few more \"major\" regression reports from the latest beta round (ie. srcmaps) and some less severe reports about debug info that was off. Those issues should noew have a proper spec tests, so they don't re-appear (one good for the bad). Reports seem to get more into specific implementation details now, so I don't anticipate any real blocker issue to be reported from here on.\n@xyfer: There are 4 PRs ready to be merged which can be peer reviewed. And there is one last issue open (#1016) which I think makes sense by now to de-scope to 3.2.1! Other than that I think we are pretty much ready to release the next and maybe last beta for 3.2.0 :bomb: \nBtw. you may have seen that I added another tag PR ready to indicate that it can be reviewed and merged (and others are just pending for 3.2.1). I also found another use for this when I started to reset the tag on merged PRs/issues. We could use this to make it easier to compile the changelog. What I mean is that it's not that easy to see which PR/Issue was already included in a previous release. We could keep the flag on merged PRs/issues until we compile the changelog. Afterwards we should reset the flags. This way we could easily filter all PRs/issues that need to be mentioned.\n. Already fixed in latest master and 3.2.0-beta.4 (node-sass 3.0.0-beta.4 uses libsass 3.2.0-beta.2) !\n. Already fixed in latest master and 3.2.0-beta.4 (node-sass 3.0.0-beta.4 uses libsass 3.2.0-beta.2) !\n. Actually I'm tempted to just merge this now, since it compiles correctly on Mac OS-X with native Makefiles and Autotools build with very minimal changes (2 chars removed) :sunglasses: Actually we should probably try to disable gcc build, since gcc seems to be just an alias for clang on OS-X (which makes sense).\n//CC @xzyfer, @hcatlin \n. We are aware of the newline differences, but currently we are not planning to address these anytime soon, since they are very easy to spot in diff tools and you probably can tell your diff tool to just ignore them. If you want, please open a more generic issue that double linefeeds differ from ruby sass. I did not understand the logic behind what ruby sass does there, as it is not really consistent while libsass is pretty consistent (therefore the diffference). Once to logic is clear we may be able to solve it!\n. The output in libsass contains a double linefeed after the div, while ruby sass does not. Ruby sass normaly does it after a block in the root, but not here. As I said, please open a more generic issue about that, since there are quite a lot of other places where this occurs. We just don't know why ruby sass does it, so we cannot really fix it!\n. This could be related to https://github.com/sass/libsass/issues/592\n. This seems to be related to how we eval Selector_Placeholder ... seems to involve refactoring!\n. Analized the test today and found out that the underlying problem is quite simple to solve.\nThis issue is caused by a discrepancy in the modulo operator, as in this example:\ncss\nfoo { test: #{-1 % 2}; }\nfoo { test: -1; } // libsass\nfoo { test: 1; } // ruby sass\n@xzyfer I will cherry pick this fix and PR it separately later, so this can be included in 3.2.5!\n. @xzyfer sorry, no, but the commit could be cherry picked from https://github.com/mgreter/libsass/commit/81a373b3fa0660baece17a83ab61c645a63dfa3d\n. I think I got a little further here (I actually missed that @support is indented in your example)\n``` scss\ndiv {\n  a {\n    top: 10px;\n    @supports (will-change: transform) {\n      will-change: transform;\n    }\n  }\n}\ndiv {\n  a {\n    @supports (will-change: transform) {\n      will-change: transform;\n    }\n    bottom: 10px;\n  }\n}\ndiv {\n  a {\n    @supports (will-change: transform) {\n      will-change: transform;\n    }\n    @supports (will-change: transform) {\n      will-change: transform;\n    }\n  }\n}\n```\nRuby sass will output this:\ncss\ndiv a {\n  top: 10px; }\n  @supports (will-change: transform) {\n    div a {\n      will-change: transform; } }\ndiv a {\n  bottom: 10px; }\n  @supports (will-change: transform) {\n    div a {\n      will-change: transform; } }\n@supports (will-change: transform) {\n  div a {\n    will-change: transform; } }\n@supports (will-change: transform) {\n  div a {\n    will-change: transform; } }\nSo it seems that ruby sass adds indentation only if the original block contains some other declarations. It is quite likely that this also indicates when to insert a double linefeed!\n. @xzyfer this is basically all happening in cssize. The @support rule is bubbled up and should remember from where it bubbled up to get the right indentation in the output. It should set the \"tabs\" option accordingly, but I was not able to implement it in cssize. Maybe you can give some hints how the whole thing works (like what does debubble do, what are Bubble statements, etc). I think this will be the key to get the last output bits in sync with ruby sass!\n. Is there any update on this issue?\n. Thanks, fixed. Btw. it was not github, I was actually that dumb and wrote the dot into the link ...\n. @xzyfer should we include this in next 3.2.0-beta.5 release?\n. @xzyfer should we include this in next 3.2.0-beta.5 release?\n. I actually thought it would make sense to have it merged before selector functions, since it could possibly have an impact there (they may suffer from the same bug). So I thought it would be good to already have it merged. Otherwise chances are that this bug will be fixed twice !?\n. Pinged @onedayitwillmake so he maybe can verify this changes to be sane. I guess he should have a few additional spec tests by now, so maybe he can test if this brakes any existing behavior.\n. OK, just made some tests with the WIP branch and it seems to alter results for the new selector function tests. So I will leave this PR open for now for further feedback and references!\n. OK, lets wait for selector-functions and the new spec tests which should cover this topic better.\nIMO the selector functions cannot be merged without a proper superselector handling anyway!\n. There is a very strange and IMO wrong logic at work with ruby sass and is_superselector. I fail too see why ruby sass produces different results for these two tests:\n``` css\ntest-a {\n  // false\n  $a: \"a + c + d\";\n  $b: \"a + b + c + d\";\n  a: is_superselector($a, $b);\n}\ntest-b {\n  // true\n  $a: \"a + c + d + e\";\n  $b: \"a + b + c + d + e\";\n  a: is_superselector($a, $b);\n}\n```\nIMO I found the code part in ruby sass that is mainly responsible for this behavior:\n``` ruby\n.foo > .baz is not a superselector of .foo > .bar > .baz or .foo >\n.bar .baz, despite the fact that .baz is a superselector of .bar >\n.baz and .bar .baz. Same goes for + and ~.\nreturn if seq1.length == 3 && seq2.length > 3\n```\nWith this info I might be able to re-produce the IMO \"strange\" behavior ...\n. This is included in my WIP branch for 3.3!\n. @chriseppstein You can query the import stack which will get you the resolved (absolute) and relative paths. From there on it is currently left to the implementor to create the desired location from that info. But we now also expose the file resolving algorithm via another C-API function (not documented yet). \nC++\nsass_importer(const char* cur_path, Sass_Importer_Entry cb, struct Sass_Compiler* comp)\n{\n  void* cookie = sass_importer_get_cookie(cb);\n  struct Sass_Import* previous = sass_compiler_get_last_import(comp);\n  const char* prev_path = sass_import_get_path(previous);\n}\nThe continuation is signaled by returning null (which is differnt from returning an empty import list). And importers are not \"chained\", they are just called in order until one returns not null.\nAnother use-case is the ability to pre-process imports (sass2scss could have been done as an importer for *.sass files). Currently libsass will not treat the initial load from a file_context like an import, so it is not possible to intercept this load atm. This would allow us to implement the interal importer like any other importer plugin (with the lowest priority). Would IMO be more correct from a \"seperation of concerns\" standpoint.\nA word about the importer priority: Mainly needed because we can have more importers from multiple plugins. We could come up with another scheme, like IDs for plugins with some kind of dependency system. IMO this will get overly complex quite fast. I agree that consumers like node-sass or perl-libsass should rarely make use of the priority feature, so I suggest them to use a regular array for this option. Plugins should play nicely with this rule by always using a high priority (we could enforce this if desired), so they run before any \"local\" custom importers.\nI guess the priority discussion will be continued in the \"custom headers\" RFC ...\n. @chriseppstein I'm not 100% sure on this, but it might be possible to achieve your use-case. Importers should return the resolved/absolute location, so the next import has all the information needed to resolve any relative links inside it. When a http importer is invoked, it should see that its parent context was a http url and should create a new absolute link from the given (optional) relative import path. If any more imports occur in the returned content, the next run will get that previously created absolute link as its previous/parent path. If I understand correctly, ruby sass basically does the resolving in a seperate step and probably passes the already resolved path to the importer. In our current implementation each importer has to create the final location on its own.\nThis does need more testing, but that's why the whole thing is marked experimental!\n. This is possible, since importers are queried first if they want to handle an import url. But they need to do the url mangling by themself in the same step. The http importer should have a higher priority and only accept links that have a http protocol after previous path is applied to possible relative import. Libsass only gets active if all importers return null.\nA http importer should do something like\n- check if import url is a http link\n- check if previous context was a http link\n- return null if no http link is found\n- create absolute url from current and prev uri\n- load url and return content and new location\n. @chriseppstein I did read that part more than once and I think I understand your use-case. But I still think this is supported by libsass. We do not separate the url resolving and loading, we combine them in one step. I don't see a use-case where this should cause any issues!\nThe url resolving is actually a chain, since the content returned by one importer can have more imports, which will then be resolved by another (or the same) importer. The prev_path will always point to the absolute import location of the previous importer. So lets take the example with a file importer:\ncss\necho \"@import \"inc.scss\";\" >> test.scss\necho \"div { color: green; }\" >> inc.scss\nWithout any custom importers involved, the file \"inc.scss\" get resolved relative to \"test.scss\", which is resolved to cwd. Now lets imagine we move these files to a webserver and create an local \"loader\":\ncss\necho \"@import \"http://www.test.com/test.scss\" >> load.scss\nThe http importer has a high priority, so it is queried first in this example. It gets http://www... as the cur_path. It now knows that it can handle that location, fetches it via http (returns the content @import \"inc.scss\";). Now libsass will parse the returned content and sees another @import. It will again call all importers in order and first is the http importer. It will get \"inc.scss\" as cur_path and it can lookup the last import path, which would be http://www.test.com/test.scss. Now from this info we expect the http loader to know that it should load http://www.test.com/inc.scss (it has to handle the path mangling by itself). The mangled path is part of the expected/returned importer struct. You actually query exactly those structs via the importer stack.\nSo you can actually access the whole import chain, which will get you access to the actual import path (as it was mentioned in the import statement) and the resolved location (which is the location returned by the importer that \"resolved\" the import). We expect importers to return a absolute path if it has resolved a import, so the next importer knows what the loading root was (it could be reconstructed from the whole stack, but we expect each importer to return the resolved absolute location).\nI hope we talk about the same thing, but if not you may post some more specific use-cases!\n. IMHO the current implementation should support the use cases discussed here pretty well. I was able to quite easily implement a custom url importer with perl-libsass (as shown at http://libsass.ocbnet.ch/srcmap/) once I fixed a few path handling related bugs (included in 3.3.0). //CC @chriseppstein \nFor completeness I will attach the perl implementation for the url importer:\n``` perl\nsub fetch_url\n{\n  my ($uri) = @;\n  foreach my $tmpl (\"%s\", \"%s.scss\", \"%s.scss\") {\n    my $variant = new URI::URL $uri->abs;\n    my @paths = $variant->path_components;\n    $paths[$#paths] = sprintf($tmpl, $paths[$#paths]);\n    $variant->path_components(@paths);\n    my $ff = File::Fetch->new(\n      uri => $variant->abs,\n      tempdir_root => '/tmp'\n    );\n    my $where = $ff->fetch( to => \\my $scalar );\n    unlink $where if defined $where; # unlink tmp\n    next unless (defined $scalar && $where);\n    return [ [ $variant->abs, $scalar ] ];\n  }\n  return undef;\n}\nsub importer\n{\n  # root is the absolute path of the previous import\n  my ($import, $root) = @_;\n  # create a new url (root will only apply to relative imports)\n  my $uri = URI::URL->new($import, $root)->abs;\n  # check if we have a url scheme to handle\n  if ($uri->scheme && $uri->scheme ne 'file') {\n    my $result = $cache->get($uri->abs->as_string);\n    unless ( defined $result ) {\n      $result = fetch_url($uri) || 0;\n      $cache->set($uri->abs->as_string, $result, $expiration);\n    } else {\n      # print STDERR \"GOT CACHED \", $result, \"\\n\";\n    }\n    return $result;\n  }\n  else {\n    if (!($uri =~ m!^\\Q$chroot\\E!)) {\n      # abort if access points outside of chroot directory\n      return [ [ $uri, 'IMPORT { ERR: \"Access violation!\"; }' ] ];\n    }\n  }\n  # try other importers\n  return undef;\n}\n```\n. IMHO the current implementation should support the use cases discussed here pretty well. I was able to quite easily implement a custom url importer with perl-libsass (as shown at http://libsass.ocbnet.ch/srcmap/) once I fixed a few path handling related bugs (included in 3.3.0). //CC @chriseppstein \nFor completeness I will attach the perl implementation for the url importer:\n``` perl\nsub fetch_url\n{\n  my ($uri) = @;\n  foreach my $tmpl (\"%s\", \"%s.scss\", \"%s.scss\") {\n    my $variant = new URI::URL $uri->abs;\n    my @paths = $variant->path_components;\n    $paths[$#paths] = sprintf($tmpl, $paths[$#paths]);\n    $variant->path_components(@paths);\n    my $ff = File::Fetch->new(\n      uri => $variant->abs,\n      tempdir_root => '/tmp'\n    );\n    my $where = $ff->fetch( to => \\my $scalar );\n    unlink $where if defined $where; # unlink tmp\n    next unless (defined $scalar && $where);\n    return [ [ $variant->abs, $scalar ] ];\n  }\n  return undef;\n}\nsub importer\n{\n  # root is the absolute path of the previous import\n  my ($import, $root) = @_;\n  # create a new url (root will only apply to relative imports)\n  my $uri = URI::URL->new($import, $root)->abs;\n  # check if we have a url scheme to handle\n  if ($uri->scheme && $uri->scheme ne 'file') {\n    my $result = $cache->get($uri->abs->as_string);\n    unless ( defined $result ) {\n      $result = fetch_url($uri) || 0;\n      $cache->set($uri->abs->as_string, $result, $expiration);\n    } else {\n      # print STDERR \"GOT CACHED \", $result, \"\\n\";\n    }\n    return $result;\n  }\n  else {\n    if (!($uri =~ m!^\\Q$chroot\\E!)) {\n      # abort if access points outside of chroot directory\n      return [ [ $uri, 'IMPORT { ERR: \"Access violation!\"; }' ] ];\n    }\n  }\n  # try other importers\n  return undef;\n}\n``\n. IMO this can be closed. Until someone points out why we should separate the path resolution and loading! We do support relative path resolutions as ruby sass does, as my tests and sample implementations should show.\n. OK, I can confirm that this is a bug if you usesass_compile_xxx_context. It works correctly if you usesass_make_xxx_compiler`. I will be able to create a PR to fix this. Sorry for the inconvenience!\n@am11 this is the same bug you mentioned in https://github.com/sass/node-sass/issues/827#issuecomment-88571782?\n. Please try to provide runable code sample. Otherwise it is tedious to reconstruct the missing bits!\nAnyway, your correct with your observation, but that's also how ruby sass does it. So I'm going to close this, but will add a spec test, so we catch it if ruby sass ever decides to change its behavior here!\nhttps://github.com/sass/sass-spec/pull/301\n``` CSS\n@mixin all-vip() {\n  test: vip;\n}\n@mixin gold() {\n  test: gold;\n}\n@mixin platinum() {\n  test: platinum;\n}\n@mixin icons-sprite($icon-name){\n    @if $icon-name == 'all-vip' {\n        @include all-vip();\n    }\n    @else if $icon-name == 'gold' {\n        @include gold();\n    }\n    @else if $icon-name == 'platinum' {\n        @include platinum();\n    }\n}\ndiv {\n  @include icons-sprite(\"platinum\");\n  @include icons-sprite(\"all-vip\");\n  @include icons-sprite(\"gold\");\n}\ndiv {\n  @include icons-sprite(platinum);\n  @include icons-sprite(all-vip);\n  @include icons-sprite(gold);\n}\n```\nRuby Sass 3.4.13:\n``` CSS\ndiv {\n  test: platinum;\n  test: vip;\n  test: gold; }\ndiv {\n  test: platinum;\n  test: vip; }\n``\n. Technically this translates to beeing able to access theParserState` of the currently invoked function.\nThis is pretty much the same as the API for accessing the import stack (just return a new sruct type).\n. This is pretty much possible now, beside fetching line and column numbers!\n. Some ground work was already done and included in libsass, but not that we could yet craft a good and future proof API (we need to further refactor how we internally account for these states).\n. Both warn and debug already take the same path as other custom functions. So no, it would rather be more difficult to handle warn etc. different that other custom functions.\nQuoting from corresponding node-sass issue: https://github.com/sass/node-sass/issues/895#issuecomment-218315504\nI don't think that sass_compiler_get_last_import will work reliably for custom functions. I stated before that the main problem is that libsass does not preserve the information needed ATM. The problem is that we read/parse/resolve the input/import files into an AST tree that will contain a function call op. Once we evaluate/execute that function call, the context of the actual import is no longer available (we only have one ast tree). That is what sass/libsass#1037 is all about. As I also wrote above IMO there is currently only one way to actually get that info via fb->pstate().path already. But that would be just a \"crutch\" for now, as the import stack should be available to custom functions (as other stuff). But nobody yet came around to actually solve/implement the missing pieces for libsass.\nThe easiest way I currently see is to add a new \"import\" stub ast node to the ast tree, so we can re-create the actual import stack in the eval phase where custom functions are actually executed. Once that is done, it should be straight forward to implement the rest. Biggest part here is probably to design a forward compatible and future proof C-API.\n. This was implemented with https://github.com/sass/libsass/pull/2251. Thanks @rodneyrehm for the positive news! Again sorry for messing that one up! Going to merge this now, since I can confirm that node-sass does not segfault anymore (@am11 only one test failing) !\n. @am11 use the latest master to update node-sass to. When you are ready to release a new beta for node-sass please, ping us and we will make another libsass beta!\n. AFAIR this was also reported by someone to node-sass (//cc @am11). Looks like we add absolute paths in one place and relative/resolved paths to the input file in the other. Will investigate next!\nFor your other question, you simply return it with some loaded content, like\nC\nsass_make_import_entry(\"http://example.org/foo.scss\", content);\nThis will then parse the content and report errors etc. with the url you have given. If more imports are found inside content, the previous path you can query will say http://example.org/foo.scss.\n. I gave it a try, but it's more complicated than I thought. Might give some more info here when I have time,. Will re-scope this to 3.2.1 for now (still marked experimental, so not release critical).\n. Hey @rodneyrehm! I merged some commits that should address IMO the issues with get_included_files. I'm going to close this for now, but feel free to re-open this or a new one if you think there are still some problems! Btw. thanks for your work on sass.link.js!\n. The function sass_import_get_base has been renamed to sass_import_get_abs_path. I also fixed quite a few issues with how we report included files. Since so much has changed between this report and current master, I'm going to close this now. But please feel free to re-open or preverably open a new bug if you find any other problems! Thanks!\n. @afaye Please open a new report! I can confirm that this issue exists, but only if applied inside @at-root, otherwise your example would to work correctly.\n. @ekskimn you may add the WIP tag, so we know that someone may already working on it!\n. @ekskimn you may add the WIP tag, so we know that someone may already working on it!\n. @ekskimn FYI I actually already have a WIP branch which passes this (an other at-root) issues ...\n. https://github.com/sass/libsass/pull/1249: Not sure if I already pushed all the latest work. But it's really in a WIP state, so no, it's not yet pushed and needs more refactoring from my side ...\n. We now have a passing spec test since #1249 was merged :balloon: \n. IMO we have two issues reported here!\n@joelworsham your output looks very old. I know we had that bug in previous version, where too many lines are counted (which is the reason why you get so many ;;;;;). Please test with latest beta and open a new issue if the problem persists.\n@dwightjack Thanks for your really usefull and complete bug report (I wished all of them looked like that). IMO the message by -1 tells that it is probably a duplicate of https://github.com/sass/libsass/issues/1056!\n. How about relaxing the error in 3.2.1 to a warning and removing it completely in 3.3.0 (3.2.2)?\n. When did we introduce that error message (was a version already released with that message included)? IMO it does make sense to make people aware that the behavior has changed! But personally I don't really have a preference here ...\n. > I believe it was introduced in 3.2.0. \nSo we haven't even released the \"deprecated\" error yet. Problem is that the error will disallow the use of custom functions named \"compact\". But we IMHO still want to inform the user that his code will no longer work the way it did. The errors seems to be a bit too much, but warnings might get overlooked by users. So IMHO it makes sense to first use an error (failing hard), then emit a soft warning and finally ignore it altogether. This should make a nice transition for users that use this function, but an error also disallows any \"polyfill\" implementation, so maybe going with a warning is the best option?\nActually I don't see why \"warn > error > gone\" would make any sense at all?\n. Another report from @dwightjack in https://github.com/sass/libsass/issues/1052#issuecomment-90569918\nScenario:\n``` scss\n//SCSS\n%test {\n    font-size: 10px;\n}\na {\n    background-color: red;\n}\np {\n    @extend %test;\n}\n```\n``` css\n//CSS\np {\n  font-size: 10px; }\na {\n  background-color: red; }\n/# sourceMappingURL=style.css.map /\n```\n//Generated sourcemap\n{\n    \"version\": 3,\n    \"file\": \"style.css\",\n    \"sources\": [\n        \"style.scss\"\n    ],\n    \"sourcesContent\": [],\n    \"mappings\": \"AAAO,AACN,AAAW,AAGZ,AACC,AAAkB\",\n    \"names\": []\n}\nWhen I inspect the p tag the Dev Tool refers to the a tag rule (line 6). In my build workflow a similar scenario is causing autoprefixer sourcemaps to break with an error:  No element indexed by -1\n. @Snugug without seeing any examples we cannot really give any usefull comments on that! And no, libsass does not discard any leading whitespace. Actually parsing position was never really a problem. Problem with source-maps stem from output (prefixing things like charset headings) and AST_Node manipulations (like in extend or eval)! So this is fixed by https://github.com/sass/libsass/pull/1062 then?\nBtw. you write that without the 3 lines on top you get 35:5, with those 3 lines 38:5 :confused: :question: \n. @Snugug please don't take this wrong, but we prefer samples that can be run on their own without any guessing from our side. Your example above actually doesn't work since it is missing a closing bracket. It seems to compile correctly on http://sassmeister.com/ (although it produces no output, but I guess that's ok for this report). Please open a new issue with reproducible steps for the error message issue you described. Thanks!\n. @Snugug please don't take this wrong, but we prefer samples that can be run on their own without any guessing from our side. Your example above actually doesn't work since it is missing a closing bracket. It seems to compile correctly on http://sassmeister.com/ (although it produces no output, but I guess that's ok for this report). Please open a new issue with reproducible steps for the error message issue you described. Thanks!\n. This has been merged with #1249!\n. Will be fixed by https://github.com/sass/libsass/pull/1051. IMO libsass/url will do as a test case here, since this has not been passing before that fix and it contains several data-urls, as the OP reported.\n. I'm pretty sure all reported issues have been fixed in latest master!\nPlease test with latest master if you can and report back! Thank you!\n. Test case never hurts. IMO there is another test that shows this behavior, since I came across it when I did the output emitter refactoring. I hope you understand that these details are really lowest prio atm!\n. We now have a passing spec test since #1249 was merged :balloon: \n. You can test for regressions with http://sassmeister.com/ (this one is a plain bug)\n. Hey @onedayitwillmake great work so far :+1: \nI guess it is already passing quite a few todo tests? I also expect a few other extend bugs to be solved by this work, since it should fix/improve the is_superselector function. Maybe you have such a list? Otherwise I could add it since I have pretty much everything in place to generate it automatically with perl-libsass (IMO it should also be possible via sassc, but I never use it)!\nWill definitely give it a thorough review after we released 3.2 :fireworks: \n. Gave it a whirl and these tests pass now on my side :smiley: \n- selector-functions/extend\n- selector-functions/parse\n- selector-functions/replace\n- selector-functions/extend/nested\n- selector-functions/is_superselector/any_is_not_superselector_of_different_prefix\n- selector-functions/is_superselector/complex_superselector\n- selector-functions/is_superselector/compound_superselector\n- selector-functions/is_superselector/current_is_superselector_with_identical_innards\n- selector-functions/is_superselector/current_is_superselector_with_subselector_innards\n- selector-functions/is_superselector/descendant_is_superselector_of_child\n- selector-functions/is_superselector/following_sibling_is_superselector_of_next_sibling\n- selector-functions/is_superselector/leading_combinator\n- selector-functions/is_superselector/matches_is_not_superselector_of_any\n- selector-functions/is_superselector/matching_combinator\n- selector-functions/is_superselector/not_is_not_superselector_of_non_unique_selectors\n- selector-functions/is_superselector/reflexivity\n- selector-functions/is_superselector/selector_list_subset\n- selector-functions/is_superselector/trailing_combinator\n. @xzyfer each ast node has a parserstate which keeps track of leading whitespace ... \n. @xzyfer not that complicated IMHO. We have a capable json library at hand to generate some versatile output format. Other than that it is basically just another debug_ast, just to output everything into a json object. If the result is really useable, is a completely different story. @Snugug not sure if you know about libsass internals, but IMO what you're asking for a export of the ast tree before it is rendered.\nWhat I see problematic is that we tend to change and add more ast nodes, since we have a lot of internal ones for calculations etc. Most of these types should be expanded/evaluated/cssized, but you currently will get stuff like Function_Call in that tree, since libsass is able to render that directly. We do not really compile everything down to a real css ast tree. We probably could add another intermediate step to first produce a css tree, but that would need quite some effort!\nI guess those are really the only two options currently available! IMO the second one could lead to a stable API that could actually be used by consumers. We can IMO expose the ast tree as is without that much effort (still quite a bit), but we cannot guarantee any stability with that one!\nIMHO it sounds like a good way to start with this (just manage expectations). This way consumers like @Snugug could get some hands on experience with it. Will probably also help to define a first stable export format, once libsass is ready to support it.\n. I created a collective ticket to keep track this and other \"non-urgent\" feature requests, in order to keep the issue tracker a bit more clean for the more 1st aid issues. I would like to encourage everybody interested in this particular feature to add their comments into this closed issue anyway.\nThanks for your understanding and your contribution!\n. It can't get much faster than opening the PR to fix the issue before the referenced issue is opened :grinning: :lollipop: \n. First part would have been enough :wink:  Once I knew what to look for it was a pretty easy fix.\nProbably took less time to fix it (https://github.com/sass/libsass/pull/1066) than to write this.\nNow I'll have a :beer: and checkout the sourcemap issues.\n. I like and fear that idea :smiling_imp: On this account I think I still have not enabled windows linefeeds on windows by default. Would be a good time to actually try it out. Although I'm not sure if the spec runner really is that picky about lineending types currently.\n. Example from prelexer.cpp:\ncurrent:\nC\nreturn sequence< optional<sign>,\n                       optional<digits>,\n                       exactly<'n'>,\n                       zero_plus < space >,\n                       sign,\n                       zero_plus < space >,\n                       digits >(src);\nI would write it as:\nC\nreturn sequence<\n         optional < sign >,\n         optional < digits >,\n         exactly < 'n' >,\n         zero_plus < space >,\n         sign,\n         zero_plus < space >,\n         digits\n       >(src);\nI mainly mean two things. The optional<sign> goes on its own line and indentation is two from previous matcher/lexer. If more than one arguments is in <...>, they shall go on separate lines.\n. Error seems to happen in expand, since it seems to be parsed correctly:\nString_Schema 0x2c322b0 (0@[0:6]-[1:0]) 4\n String_Quoted : 0x2a41dc0 (0@[0:6]-[1:0]) [.foo] <>\n Unary_Expression 0x2a41e40 (0@[0:6]-[0:7]) [1]\n  operand: Variable 0x2c84be0 (0@[0:7]-[0:9]) [$i]\nMy guess is the unary expression is not correctly or not at all evaluated!\nEdit: seems to be a problem in interpolation in eval.cpp (my bad).\nAnother usefull spec test discovered I would say ahem :smile: \n. LGTM! IMO I changed the positions internally to start from 0, as it always is in C. Was pretty confusing to me otherwise and we don't want to waste a single bit :smile: Guess I missed to adjust that one!\n. This might be fixed with https://github.com/sass/libsass/pull/1180 ... can someone test?\n. Closing this since I get this result with latest master:\n```\nError: unterminated argument to hdr(...)\n        on line 1 of sass.scss\n\n\nhdr(2, 5){\n   ----^\n``\n. Ruby sass seems to preserve the order of appearance. Seems like we need to have a more genericvector top_elements` instead of specific ones for each type (comment/import). Since this is not a regression I will assign it to 3.2.1.\n\n\nCSS\n/** comment 1 */\n@import url(\"import-1\");\n/** comment 2 */\n@import url(\"import-2\");\n/** comment 3 */\nfoo { bar: baz; }\nruby sass:\ncss\n/** comment 1 */\n@import url(\"import-1\");\n/** comment 2 */\n@import url(\"import-2\");\n/** comment 3 */\nfoo {\n  bar: baz;\n}\nlibsass:\nCSS\n@import url(\"import-1\");\n@import url(\"import-2\");\n/** comment 1 */\n/** comment 2 */\n/** comment 3 */\nfoo {\n  bar: baz; }\n. Actually had nothing to do with the import :wink: (PR: https://github.com/sass/libsass/pull/1084, Tests: https://github.com/sass/sass-spec/pull/314)\n. We know source maps are sometimes off, so I'm going to close this since it provides no additional info to us! You may re-open if you can provide a specific isolated test-case we can work on. And please remember to include at least some version numbers of the used software :exclamation:  Thanks!\n. This is actually not a regression, although that exact case was working before. The reason for this is, that things like the following did not work in libsass 3.1.0 either (which is the root bug for it):\nscss\n$map: (0 - 1px: 12);\nfoo { bar: inspect($map); }\nWe changed the way we parse negative numbers to wrap them into an unary_operator. This is more in line with the actual meaning and solved problems in other places, but unfortunately brings up another problem to the surface here. IMO we need to evaluate the keys before \"using\" them.\n. This specific issue (and a few more) should be fixed by #1090. I'm quite sure that we have more subtile problems with map handlings, but this should at least fix quite a lot of the more common use-cases!\n. This is a duplicate of https://github.com/sass/libsass/issues/1086\n. What's the status here?\n. Closing this due to invactivity.\n. @volodos Maybe try with the correct syntax. Yours doesn't compile in ruby sass either which you should always check before posting new issues. IE filter opacity alpha uses an equal sign, not a colon:\ncss\ninput.File { width: 100%; position: relative; text-align: right; -moz-opacity: 0; filter: alpha(opacity=0); opacity: 0; z-index: 30; cursor: pointer; }\n. IMO it's related to our way to parse every list as a space or comma separated list. Not sure how ruby sass handles this internally. Since this syntax is used as a IE css hack, we could make sure that the way we output it currently will still be valid for those old IE UAs. If that is the case, it is IMO not a real blocker for the next release. We do allow escaped sequences in identifiers (static_value), but all the above cases are not valid identifiers. IMO a hotfix for certain use-cases is possible, but to support this correctly we need the non-spaced list parsing (which is IMO not possible in the scope of the current beta).\n. This seems to be fixed on latest master (tested @xzyfer example) -> https://github.com/sass/libsass/commit/79e8d32e05f8b6fce0dc60c62f6b8cabcc8dc92b!\n. Looks like duplicate of https://github.com/sass/libsass/issues/1030\n. Closing this in favor of https://github.com/sass/libsass/issues/1030 since upstream confirmed a bug how double line endings are handled. The behavior here is seen because we tried to emulate that buggy behvaior. So lets wait and see what upstream sass will do.\n. I created a collective ticket to keep track this and other \"non-urgent\" feature requests, in order to keep the issue tracker a bit more clean for the more 1st aid issues. I would like to encourage everybody interested in this particular feature to add their comments into this closed issue anyway.\nThanks for your understanding and your contribution!\n. This is pretty strange behavior by ruby sass IMO:\n``` css\nfoo { bar: \"x\\79\"; } // => x\\79\nfoo { baz: \"#{x}\\79\"; } // => xy\nfoo { bar: \"x\\a\"; } // => x\\a\nfoo { baz: \"#{x}\\a\"; } // => x\\a\n```\n. @xzyfer I fully agree, but the handling by ruby sass is pretty complex and AFAIR I was able to get rid of quite a few flags with my last refactoring. But I pretty much gave up to understand how ruby sass internally handles interpolations and escape sequences (We keep finding new edge cases all the time). So for the time beeing I really only see the way to implement specific code paths for these cases, until we have a good enough spec suite to tackle another refactoring. My last commit should solve the reported issues, but it is far away from beeing pretty. I'm having problems coming up with ideas how to name all those different escape/unescape functions, but I currently don't see a way to get rid of them.\n. Btw. I have used this extended test case:\n``` scss\nfoo {\n    content: \"x\\79\";\n    content: \"#{x}\\79\";\n    content: \"x\\0\\1\\2\\3\\4\\5\\6\\7\\8\\9\\7a\";\n    content: \"#{x}\\0\\1\\2\\3\\4\\5\\6\\7\\8\\9\\7a\";\n    content: \"x#{\\0\\1\\2\\3\\4\\5\\6\\7\\8\\9}\\7a\";\n    content: \"x\\a\\A\\b\\B\\c\\C\\d\\D\\e\\E\\f\\F\\g\\G\\7a\";\n    content: \"#{x}\\a\\A\\b\\B\\c\\C\\d\\D\\e\\E\\f\\F\\g\\G\\7a\";\n    content: \"x#{\\a\\A\\b\\B\\c\\C\\d\\D\\e\\E\\f\\F\\g\\G}\\7a\";\n}\nbaz {\n    // another regression\n    content: \"xy#{\\7a}\";\n}\n```\n. This gives this output for me:\ncss\n.button--green--alt, .button--with--text {\n  color: green; }\nSo this seems to be fixed on latest master!\n```\npsass -v\npsass 0.4.0 (perl sass/scss compiler)\n  libsass: 3.2.0-beta.6-4-g8963\n  sass2scss: 1.0.3\n```\n. I get the expected result?\ncss\np {\n  content: \"ABCD\";\n  content: \"ABCD\";\n  content: \"ABCDefg\";\n  content: \"ABCD\"; }\n```\npsass -v\npsass 0.4.0 (perl sass/scss compiler)\n  libsass: 3.2.0-beta.6-4-g8963\n  sass2scss: 1.0.3\n```\nBtw. I'm testing this on windows 7.\n. I don't have any personal preference here, but the Bug is very obvious and the fix should not have any side-effects. Saturation/lightness must have a value between 0 and 100 and hue has to be between 0 and 360 degrees. But feel free to descope if it makes you feel uneasy :)\n. I would say so :+1: Just left it open for proper peer review ;)\n. You saw the changes in this PR? They are very trivial!\n. :+1: :ship: \n. Valid, see the same with perl-libsass:\n```\npsass --precision 0 test.scss\ndiv {\n  line-height: 2px; }\npsass -v\npsass 0.4.0 (perl sass/scss compiler)\n  libsass: 3.2.0\n  sass2scss: 1.0.3\n```\nIMO it should be quite trivial to fix this \"edge\" case!\nGot any expected behavior for negative precision :smile:  ?\n. The default value is 5 (was changed some time ago from 3) and no, you cannot tell libsass to use the default again, since it is really only set when the context gets initialized (so you cannot \"unset\" a config option currently, once it is set), If we would add such a functionality I rather would add specific sass_option_[unset/reset]_presicion or sass_option_get_default_precision. The later would make it possible for host languages to query the default value (which is null for most options).\n. Plugin compiles fine for me:\ng++ plugin.cpp -shared -o plugin.so -fPIC -L../lib -I.. -lsass\nAlso read the info about includes in angle brackets:\n\nThis method is normally used to include standard library header files.\n\nSo IMO it would be wrong to write them with angle brackets :confused: !\n. @drewwells negative, since this would break it if you want to compile against system wide installed libsass, where you can get rid of explicitly declaring the locations when compiling (-L../lib -I..):\ng++ plugin.cpp -shared -o plugin.so -fPIC -lsass\n. Seems to be fixed by #1130 (included in 3.2.0)\ncss\n.test {\n  content: \"result\"; }\n```\npsass -v\npsass 0.4.0 (perl sass/scss compiler)\n  libsass: 3.2.0\n  sass2scss: 1.0.3\n``\n. I guess you're talking aboutsass_values` (C-API)? Can you give a short code example, because I'm not sure I understand the problem correctly!?\n. IMO it depends from where the string comes from. I.e. in perl-libsass I can put a perl-string into a sass_string value, and I don't want it to unquote the value everytime I do this. So IMO it's correct for sass_values to not be unquoted by default. But IMO this depends on your application logic. To be clear: if I have a programatically allocated string, I don't want it to be unquoted when used as a Sass_String value. The C-API exposes the quote/unquote functions, so you can use them if you need to unquote before creating a Sass_Value. IMO it doesn't matter if single or double quotes are used, as this will only be preserved on static values. Quote will automatically chose the best quotemark.\nBTW. libsass internally always unquotes strings in the parsing state and only quotes them, when emitting previousely quoted string (String_Quoted vs String_Constant). I agree that the current C-API does not expose this information (if a string was previousely quoted or not).\n. I'm pretty confused because I don't know if you are talking about strings comming from an AST_Node or by creating one via the C-API. IMO the ones from the parser (AST_Node) will be unquoted already, but the C-API does not unquote it by itself. IMO if we unquote strings in the C-API when Sass_Strings are created, we need to quote anything we want to be taken literally (we may have another quoted string inside a quoted string which will get further unquoted with every new Sass_String instance).\n@hcatlin yep, we keep that one around, altough we (AFAIR) only use it in a boolean context. But yes, should be pretty easy to add and expose this flag at the C-API level.\n@chriseppstein I hope I got your point now. You cannot set if the Sass_String you create should be quoted or not when emitted. That should be solved by adding the flag mentioned above (so you could set it to have libsass add quotes when emitting the string). I agree that this was overlooked and it starts to make sense what you have written above and your reference to the output seem to make it clear!\n. @hcatlin if you define such a compare function and call it via scss code, the parser will unquote \"a\" to a, so it should already do that. I still don't see the actual point, beside not beeing able to tell libsass that it should quote a string when emitting it in the resulting css (which I do consider a bug).\nI just checked this is true, and the ast debug for compare(\"a\", a) looks as this:\nFunction_Call 0x268dc80 (0@[5:9]-[5:16]) [compare]\n args: Arguments 0x2bf9b40 (0@[5:9]-[5:16])\n args:  Argument 0x268db60 (0@[5:17]-[5:20]) [0x293cbc0] [name: ]  [rest: 0]  [keyword: 0]\n args:   value: String_Quoted : 0x293cbc0 (0@[5:17]-[5:20]) [a] {qm:*} <>\n args:  Argument 0x268dbf0 (0@[5:22]-[5:23]) [0x293cc40] [name: ]  [rest: 0]  [keyword: 0]\n args:   value: String_Quoted : 0x293cc40 (0@[5:22]-[5:23]) [a] <>\nThe interesting part is [a] {qm:*} vs [a], which shows the values we keep internally.\n. Glad we could figure this one out. I was pretty sure we had a misunderstanding somewhere. I'm currently considering, if we really need this option and use autodetection only. At least I'm going to do this in perl-libsass, as keeping this flag around, introduces problems on the host language side, since I want to have this Sass_Value beeing represented as a native perl string (which has no \"native\" way to attach this flag). There would be ways to do it (Tie'ing the scalar i.e.), but that would hurt performance quite a bit. IMO it should be enough for my implementation to check if quotes are needed and set the flag automatically when I pass a string back from perl to libsass. This should probably work well enough, so the API can IMO stay that way (I probably will expose another function to check if quotes can be omitted for a given string, completing the quote/unquote function family). I've choosen to add a new constructor sass_make_qstring since we cannot easily add a flag the existing sass_make_string function, since it would break the API. If you have any wishes for refactorings in this regard, feel free to post them here or in its own issue and I will consider it before the next major upgrade is due.\n. @chriseppstein I think I know what's happening in node-sass. The API has changed in this regard and I also forgot to adjust for it in the lastest perl-libsass release (already preparing next update). As I've written, the parser now unquotes the string if needed, so internally the representations are the same. Previousely I had an unquote step built into my bindings when converting strings between host languages, not sure if node-sass had something similar.\nAlso for your example I would argue that\n```\nExpected:\ntest1 { uquoted: foo; }\ntest2 { squoted: bar; }\ntest3 { dquoted: baz; }\n```\nIs also a valid result. From my findings, we also only preserve the original quotemarks if the string involved is a static value, which is IMO never true for function arguments. As a side note, it only uses single quotes if the string contains double quotes, but no other single quote. See this example:\ncss\n@function test($a) {\n  @return $a;\n}\ndiv {\n  foo: test(a);\n  foo: test('a');\n  foo: test(\"a\");\n  foo: test(\"\\\"\");\n}\nWhich compile to this with ruby sass:\ncss\ndiv {\n  foo: a;\n  foo: \"a\";\n  foo: \"a\";\n  foo: '\"';\n}\n. I agree that this would be the best way, but IMHO both are semantically the same in css context, but maybe I'm wrong? As I said, to get this behaviour would make it much more complex for me and perl-libsass, since I would need to attach the is_quoted flag internally to native perl strings, which adds a lot of complexity. We also have to choose when to retain this flag i.e. on concatenation. We would also need to upgrade the flag, once we introduce spaces etc. That's why an automatic way sounds most appealing to me, as long as the result is still valid css. Hope I got my point accross. \nAnd to make it clear, this is perl-libsass specific behavior I'm talking now!\nAn automatic way really just solved a lot of complex things \"out\" of the box for me!\nIn node.js you might be able to extend the String object to carry that flag around ...\n. That's why I asked :) Two new things I learned with your last comment. Somewhat counter intuitive for me, but that's why I like to see code examples, makes it much easier to understand the issues at hand (specially for non native english people)! I will see if and how I can add this to perl-libsass, since the concatenation rules obviously behave different than automatically adding quotes would.\nBTW. I wonder why node-sass hasn't choosen to use the native js data-types for most sass values, since with Null, Boolean, Number, String, Array, Object and Error they seems to have everything ready to be converted to native data types ... so far I only had to differentiate between two list types, which basically only differ by beeing separate classes, inheriting from the base array implementation (in perl-libsass). Now with the quotemark I probably will do the same, since the type of the class is something I can attach easily to the native data type, if I use a reference. In a real object oriented language I would expect to have specific sass value classes, that inherit from the base object classes (and probably also from a base sass_value class, if polymorphysm is possible).\n. @chriseppstein what I mean is I don't understand why a Sass_String is not really a js String object, which would then natively behave correctly for equal or concat operations AFAIK (more on that below). It looks to me like you get an instance of an object, where you have to call getValue(), or am I missing something? I would expect to get a native data type there, IMHO this might be the only way to get convenient and native behavior as you IMO written in another issue. IMO you currently would need to call a.getValue() == b.getValue(), but if a and be would be a native instance (or something that directly inherits from it if possible), you should be able to write a == b. IMHO node-sass will probably hit a wall with numbers, since it adds a units, which cannot be represented easily by any native data type. Also at some point you may have to pass two values to another library, which does the compare operation. Therefore I've opted for perl-libsass to \"delegate\" any deep equality checks to the \"toString\" function (all overloaded equal ops check if a.toString() == b by default, implemented in base class).\nMaybe give it a thought. If that's technically achievable, I would prefer it that way. Otherwise you probably will not get around to use syntax like a.equals(b). In perl-libsass I implemented both worlds. You can work with the explicit objects, but you can also return native types from sass functions. All objects overload operators, so they behave like native data types, which you IMO only get via prototype overloading in node.js, but maybe also via prototype inheritance. Really blunt native data types (created outside the sass context) get automatically upgraded to certain sass types. This basically means that js arrays become comma separated lists and strings will probably have their quote flag automatically set, since we cannot get any css context out of a native string object.\nSince I talked about code examples, I would like to be able to return this from custom functions:\njs\nreturn null; // sass_make_null();\nreturn 2; // sass_make_number(2, 0);\nreturn false; // sass_make_boolean(false);\nreturn 'a b'; // sass_make_qstring(\"a b\"); => autodetect q(uote)mark\nreturn { a: 1, b: 2 }; // sass_make_map(..); => recursive resolve keys, values\nreturn ['a', 3, false, '2px']; // sass_make_list(comma) => recursive resolve values\n// this might be against core sass principles?\nreturn '2px'; // sass_make_number(2, 'px')\nreturn '#000'; // sass_make_color(0, 0, 0, 1)\nI hope you agree with most parts!? IMO node-sass will probably not be able to support native stuff like c = a + b, since operator overloading doesn't seem to be available for custom objects. But node-sass should at least be able to use native hash-maps (js Objects). There is only the question what meta information keys have to retain (IMO the native implementation really just can store a string, but what about a list as a key?). I'm pretty sure the rule is also a bit different in ruby sass here. Since IMO the map-keys are in the context of sass, we could apply automatic quotes for serialized output, same goes probably for the value itself? I also guess it's different with lists again, since they do appear in css context, and we know that libsass has some open issues with handling certain lists (specially list without whitespace between elements).\nSorry for the long post. In the end it got more like a brain-storming, but it documents quite a bit of the sass_value internals from the perl-libsass implementor perspective. Let's see how node-sass can improve in this area and I hope they can manage to bring it to a usefull and good level! But I somehow believe that it is not possible to support a + b in node.js, while respecting the quotemark rules you established a few comments above.\n. IMO this issue here can be closed. It has been noted that we currently don't expose enough functionallity to implement all sass value related tasks in bindings neatly. It doesn't make much sense to hack all the features together from existing code, since it is scattered around our code base (and even using different input types, ast_nodes vs sass_values). So a refactor seems to be the right way to solve this correctly, which I cannot give any ETA (I currently plan to do this as one major change for 3.3)\nTo be clear: Bindings should be able to implement all OPs themselve, the information is there, but it makes a lot of sense to let libsass do the whole work (so you get the same logic as libsass uses).\n. Probably related https://github.com/sass/libsass/pull/1049 ... to funny, your issue is #1149 :)\n. PR #1338 should bring a big improvement in regard of value handling and the C-API.\nProbably still not 100% complete, but we're slowly getting there!\nDoes this problem still exist? Can you give some other examples how it fails for you? THX!\n. I'm going to close this since there has been a lot of work done regarding C-API and value and number handling. IMHO you should be able to exchange numbers with complex units with libsass now. We also expose a sass_op function now that can be used to access all binary operations.\nUnits are indeed expected to be exchanged as strings. We do keep them as separate vectors for nominators and denominators in C++, but we need to convert this data somehow for the C-API anyway. Since C has no real support for arrays with strings of variable length, it doesn't make a big difference for the C level if we pass the unit in the current string form or use two \"null terminated pseudo arrays\". So if you think it makes sense to have these arrays available for numbers in node-sass, I would suggest to implement that in the binding code directly.\nPlease open a new issue if you find more problems! Thanks!\n. @saper sass accepts anything as units, not just the ones specified in css, so the max length is unknown. I don't see any benefit in this, as parsing the given unit string is as straight forward in C as any other exchange format I could possibly think of (instead of null terminated, it is '*' and '/' terminated now). Btw. the following are valid units for sass:\nscss\ntest: (1\\65 _em--_--e0 - 2\\65 _em--_--e0);\n. Do you want to include the queued and ready PRs for 3.2.1. I basically just wanted to rebase them all when I get to it, but otherwise they should be ready! But we can also do two short follow up releases.\n. We have the following PRs pending:\n- #1055 - Relax compact error to warning -> how long we want to keep it an error?\n- #1049 - Fix mathematical operations with different/complex units -> probably #1149\n- #1047 - Fix str-slice function to work with utf8 strings -> Code looks cleaner and passes tests\n- #1138 - Fix order of top nodes -> Actual fix is rather trivial\n- #1046 - Implement handling of nested :not pseudo selectors -> minor feature to pass a spec\n- #1050 - Fix separator preserving with rest args -> needs check since we did some work there IMO\nIMO we should at least consider the first 4 PR for the next minor release!\nThere is basically just one main change comming with #1049, but that is an actual bug fix and implements something that did not work previousely, and it seems related to #1149.\n. I can rebase to get a new CI run ...\n. Once again, the logix seems to be more complicated then anticipated and again not sure if wanted behavior or just a ruby sass bug? //cc @xzyfer \ninput.css\ncss\nfoo { \n  bar: (0);\n  bar: (.0);\n  bar: (0.0);\n  bar: (-0);\n  bar: (-.0);\n  bar: (-0.0);\n  bar: (42);\n  bar: (-42);\n  bar: (43.0);\n  bar: (-43.0);\n  bar: (44.0000);\n  bar: (-44.0000);\n  bar: (45.00001);\n  bar: (-45.00001);\n  bar: (42.84);\n  bar: (-42.84);\n  bar: (42.24);\n  bar: (-42.24);\n  bar: (42.845555);\n  bar: (-42.845555);\n  bar: (42.245555);\n  bar: (-42.245555); }\nRuby sass output:\ncss\nfoo {\n  bar: 0;\n  bar: 0;\n  bar: 0;\n  bar: 0;\n  bar: 0;\n  bar: 0;\n  bar: 42;\n  bar: -42;\n  bar: 43;\n  bar: -43;\n  bar: 44;\n  bar: -44;\n  bar: 45.0;\n  bar: -45.0;\n  bar: 43.0;\n  bar: -43.0;\n  bar: 42.0;\n  bar: -42.0;\n  bar: 43.0;\n  bar: -43.0;\n  bar: 42.0;\n  bar: -42.0; }\nSeems to be a special case if the value was actually rounded. IMO we have a similar expection already in that function, so I might be able to implement it \"correctly\" ...\n. LGTM :+1: IMO would also be ok to assign 3.2.2 for this!\nOnly con is that depth will probably be recursive too (minor performance degradation).\n. I can confirm that I also get the expected output!\nPlease re-open if the problem still persists with latest master!\n. The memory leaks should be fixed by https://github.com/sass/libsass/pull/1330.\nAFAIR there were no changes on the C-API needed for this!\n. @saper can you give an update what real issues are still relevant at the time beeing? Thanks!\n. Any updates here?\n. Closing this due to inactivity, problems should be resolved. Re-open if not!\n. The PR should solve the problem that libsass segfaults. But the test also shows another issue, since #{0/0} returns Infinity for libsass, while it stays untouched in ruby sass.\n. Refactored the code and incorporated the feedback from @xzyfer. Made the code much more explicit. I think I cannot really improve much on it anymore. Hope CI build passes this times. IMHO appveyor sometimes fails for one build (with random errors it seems) ...\n. I have a half backed branch around for this. Thought to include it with the other number related refactoring! Let me see if I get something working in a few hours!\n. For the time being you should be able to use\n``` css\n$namespace: 'test-';\n$column: 1;\n.#{$namespace}#{$column}#{\\/}#{$column} {\n  width: 100% !important;\n}\n```\n. Here come my findings. See this scss example:\n``` css\n$map1: ( red: 'literal' );\n$map2: ( 'red': 'quoted' );\n$map3: ( #{re}#{d}: 'interpolated' );\nfoo {\n  content: inspect($map1);\n  content: inspect($map2);\n  content: inspect($map3);\n}\n$merge1: map-merge($map1, $map2);\n$merge2: map-merge($map1, $map3);\n$merge3: map-merge($map2, $map3);\nbar {\n  content: inspect($merge1);\n  content: inspect($merge2);\n  content: inspect($merge3);\n}\n```\nResults in:\n``` css\nfoo {\n  content: (red: \"literal\");\n  content: (\"red\": \"quoted\");\n  content: (red: \"interpolated\"); }\nbar {\n  content: (red: \"literal\", \"red\": \"quoted\");\n  content: (red: \"literal\", red: \"interpolated\");\n  content: (\"red\": \"interpolated\"); }\n```\nAs you can see, the interpolated value has the same key as the quoted string, although they have different output. This makes sense, since both are internally strings. Colors seems to be color key, no matter what. The following example show a bit more what I mean:\ncss\nbaz {\n  content: inspect(( yellow: 'bar' ));\n  content: inspect(( 'yellow': 'bar' ));\n}\noutput nested:\ncss\nbaz {\n  content: (yellow: \"bar\");\n  content: (\"yellow\": \"bar\"); }\noutput compressed (reformatted):\ncss\nbaz {\n  content:(#ff0: \"bar\");\n  content:(\"yellow\": \"bar\") }\nYou can see that keys get the same output representation like all other Sass Values.\nSo to me it looks like OP is saying that transparent is not recognised as a color, but as a string literal? Will no investigate on that issue, since I can reproduce that.\n. This still does not seem to be fixed properly!?\n``` scss\n$map: (\n   red: 'bar',\n  'red': 'foo',\n);\n.foo {\n  content: inspect($map);\n}\n```\nAnother case that does not work:\n``` scss\n$map: (\n  random(): 'bar',\n  random(): 'foo',\n);\n.foo {\n  content: inspect($map);\n}\n```\nI think we cannot use a hash map in the parser directly and have to delay the map creation to the eval stage, since we cannot eval the keys in the parser stage. With the second example it should be clear that we definitely need to eval the keys before we can add them to a map.\n. IMO & doesn't work in this context, since even when inside a list, the expected result is not correct (given the test above). So I think we actually do not handle Parent_Selector correctly in Binary_Operation (which is what if will be using). But that really is just a wild guess ...\ndebug_ast from Expression* Eval::operator()(Binary_Expression* b)\nBinary_Expression 0x2a03d40 (0@[1:8]-[1:9]) [EQ]\n left:  Parent_Selector 0x2f734f0 (0@[1:8]-[1:9]) <>\n left:  ->Selector_List 0x23c8820 (0@[1:9]-[1:10]) [block:0x2fa5df0] [@media:0] - - -\n left:  -> Complex_Selector 0x2a03b90 (0@[1:12]-[1:12]) [block:0x2fa5df0] [weight:100] [@media:0] - - - -> {+} <>\n left:  ->  Compound_Selector 0x2d87490 (0@[1:12]-[1:15]) [block:0x2fa5df0] [weight:0] [@media:0] - - - <>\n left:  ->   Selector_Reference 0x2ce8cb0 (0@[1:12]-[1:15]) @ref 0\n left:  -> -Complex_Selector 0x2a03b00 (0@[1:12]-[1:12]) [block:0x2fa5df0] [weight:100] [@media:0] - - - -> { } <>\n left:  -> - Compound_Selector 0x2d873c0 (0@[1:10]-[1:11]) [block:0x2fa5df0] [weight:100] [@media:0] - - - <>\n left:  -> -  Type_Selector 0x2ce8c30 (0@[1:12]-[1:15]) <<'a'>> - <>\n right: Parent_Selector 0x2f73560 (0@[1:21]-[1:22]) <>\n right: ->Selector_List 0x23c88e0 (0@[1:22]-[1:23]) [block:0x2fa5df0] [@media:0] - - -\n right: -> Complex_Selector 0x2a03cb0 (0@[1:25]-[1:25]) [block:0x2fa5df0] [weight:100] [@media:0] - - - -> {+} <>\n right: ->  Compound_Selector 0x2d87630 (0@[1:25]-[1:31]) [block:0x2fa5df0] [weight:0] [@media:0] - - - <>\n right: ->   Selector_Reference 0x2ce8db0 (0@[1:25]-[1:31]) @ref 0\n right: -> -Complex_Selector 0x2a03c20 (0@[1:25]-[1:25]) [block:0x2fa5df0] [weight:100] [@media:0] - - - -> { } <>\n right: -> - Compound_Selector 0x2d87560 (0@[1:23]-[1:24]) [block:0x2fa5df0] [weight:100] [@media:0] - - - <>\n right: -> -  Type_Selector 0x2ce8d30 (0@[1:25]-[1:31]) <<'aqwe'>> - <>\n. We now have a passing spec test since #1249 was merged :balloon: \n. First issue is covered by the PR. Maybe we should create a new issue for the second, since it is related to how we handle lists. IMO the second sample can probably be shortened down to:\ncss\nfoo {\n  test-01: inspect(( (1, 2), (3, 4) ));\n}\nruby sass:\ncss\nfoo {\n  test-01: (1, 2), (3, 4); }\nlibsass:\ncss\nfoo {\n  test-01: 1, 2, 3, 4; }\nSeems like we join/flatten lists too often ...\n. If you can confirm the first one is gone, sure! Close this one then and create a separate issue for the list append bug (which is caused by the sample I posted above, I'm very sure about that).\nRuby sass appends 3 to this list (1, 2), which results in (1, 2), 3, which has a length of 2.\nLibsass appends 3 to the list 1, 2, which results in 1, 2, 3, which has a length of 3.\nIf I get your comments right, this has changed in ruby sass and we probably missed that!\n. This fixes the issues mentioned in #1169, but there are more cases where we differ from ruby sass. IMO we need to refactor Sass_Value handling internally to streamline all related things. Currenty different parts (binary operations, inspection, equal operator, etc) are scattered around our code base. We should put that all under a streamlined API, but I guess this will not be ready before 3.3.\nSo this is a start, but as I said we have more issues like:\n``` css\n$colors: (\n    \"transparent\": \"string\",\n    transparent: \"color\"\n);\ncolor { content: map-get($colors, transparent); }\nstring { content: map-get($colors, \"transparent\"); }\ninterpolate { content: map-get($colors, #{trans}#{parent}); }\n```\nruby sass:\n``` css\ncolor {\n  content: \"color\"; }\nstring {\n  content: \"string\"; }\ninterpolate {\n  content: \"string\"; }\n```\nlibsass:\n``` css\ncolor {\n  content: \"color\"; }\nstring {\n  content: \"string\"; }\ninterpolate {\n  content: \"color\"; }\n```\nSo we seem to evaluate that string somewhere unnecessarily into a color again ...\n. @AlbertoElias Can you confirm that the PR fixes your issues?\n. Ah, the pstate stuff makes sure the Map object source map is pointing from parenthese to parenthese, since we don't lex it with one call ... Just saw it was off , so I thought I'd fix it while beeing at it ...\n. I renamed the flag to keep_linefeed_whitespace. I have no idea why ruby sass does what it does here. So I really can only describe what the flag is actually doing. It seems to be some discrepancy between interpolation, quoted string, strings to css or something else. And I'm out of clues and guesses.\n. I somewhat agree, but I can explain quite clearly what that flag does. It removes all whitespace from the string if it is emitted to css in compressed mode. This is not really familiar with any other node. So not sure what to do with it. I thought about a specific ast node for binomials, but I still would need to preserve the full parsed string, since ruby sass really preserves the whitespace (it does not just add one optional space as other nodes). Or it would basically be another string type doing exactly what the new \"compress\" flag is doing ...\nI somewhat disagree to postpone this. The result seems promising to be on par with ruby sass. I tend to search the code for these specific flags to see where they are used. So far this flag is really specific to binomials. As you see I pretty much fixed all other white space issues, so we probably can label the next bugfix release a \"white-space\" release, so I vote to include this.\nOf course I'm always open to have the option named differently and/or add some description!\n. Renamed the flag to can_compress_whitespace. I don't think it case much to do with selectors, I has specifically to do with those binomials. For me it even looks somewhat like a bug in compressed mode, which this flag reproduces (so we match ruby sass). But that is really just me guessing ...\n. By sheer accident I seem to have fixed #823, #1063 and #1091 :grinning: \nPlus we pass a lot more of the is_superselector spec tests added in #963\nIMO we should be able to include the improvements for 3.2.4, since they are clear bugfixes.\n@xzyfer would you want to hold off the is_superselector function for 3.3!? I would ship it.\n. OK, just a few moments ... let me clean up some white-space and comments ...\n. Also let's wait for CI here, then activate all spec tests and re-start the CI to check again ...\n. As always, I just create a big activate patch for the next release.\nhttps://github.com/sass/sass-spec/pull/379\n. Merged spec activation patch and restarting CI rebuild now ... \n. Closing this since ruby sass produces the same output.\nIf you want to know why it does that, open an issue with ruby sass directly.\n. Fix seems to be simple (in bind.cpp):\nc++\nfor (size_t i = 0, L = as->length(); i < L; ++i) {\n  if (auto str = dynamic_cast<String_Quoted*>((*as)[i]->value())) {\n    // force optional quotes (only if needed)\n    if (str->quote_mark()) str->quote_mark('*');\n  }\n}\n@xzyfer: I already have this in my latest (local) refactoring branch which I will updatein a few hours/days!\n. We now have a passing spec test since #1249 was merged :balloon: \n. We now have a passing spec test since #1249 was merged :balloon: \n. Well, it should help to make more sense out of the actual code. I actually did not understand why it was doing what it was doing. So yes, it could help with that, since it is more obvious where and which parent selector we are referring to IMHO. But it really depends on the underlying problem :)\n. Took a look at your linked issue and I guess I know how we can fix it. IMHO we need another selector type beside Parent_Selector, namely Root_Selector. Currently I thought I could just use NULL to represent that, but this would need quite some refactoring, since we have a lot of places where we would need to check for that potential NULL pointer. Parent selectors now only \"live\" in the selector_stack, so you can more easily tamper with it. I used this technique to implement Parent_Selector rendering (pop one selector off the stack, render recursively and push it back once finished). So in theory we just should need to add a Root_Selector to that stack when rendering/expanding root nodes. At least that's what I would guess. I'm currently focusing in another area, which will take quite some time (values/nodes and memory management, plus some basic performance considerations; currently catching up with the latest tricks in mark and sweep GC implementations). So I have absolutely no ETA if/when I will come around to implement this, so I thought I document it here for future references.\n. OK, we have no spec now (reverted) for this and if I run the original issue with latest ruby sass I get some output! Therefore it seems we should re-add the spec test and close this issue!\n. OK, I guess someone should point out that the error is about using the file-ending .css with scss content. Ruby sass seems to default to sass (indented) in that situation. Not sure if we can replicate that behavior easily, since we depend on sass2scss for this kind of syntax.\n. Changing this is rather easy (at least on the \"surface\") and leads to a similar error:\n```\nError: invalid property name\n        on line 2 of foo.css\n\n\n@media screen and (min-width:0\\0) { {\n   -----------------------------------^\n```\n\n\nThe \"strange\" output (double bracket) is due to the processing by sass2scss!\n. I think we should close this. IMO this would first need to be supported by ruby sass.\n. If it is then my bad! Can someone confirm?\n. I created a collective ticket to keep track of this and other \"non-urgent\" feature requests, in order to keep the issue tracker a bit more clean for the more 1st aid issues. I would like to encourage everybody interested in this particular feature to add their comments into this closed issue anyway.\nThanks for your understanding and your contribution!\n. We don't actually release any archives. If you create one, you decouple the source files from git control and have to add a VERSION file. I have this automated with perl-libsass, since I also include the full sources with the distribution: http://cpansearch.perl.org/src/OCBNET/CSS-Sass-v3.2.2/libsass/VERSION. We really don't want to have the version baked into git either!!\n. We need that header at build time, since it will be baked into the library. Thinking about it, I see that we should not really install sass_version header, since it serves no purpose for implementors (you should never include it, always call libsass_version function of the library)!\nThe file is overwritten by the configure step, so I guess if you modify it after that step, it should be picked up. But I really have a hard time to follow your steps. Your makefile is incomplete and the version target is never called or used as a dependency!? So it's hard to tell what is going wrong, but it should certainly work, as I just tested locally!\n. Closing this. We are moving in the direction to have more context information available on the C-API. But we need to take step by step. We already have other open issues regarding similar issues, so this PR serve no real use anymore. Exposing the import context is probably one of the next things to do ...\n. I'm pretty sure a real solution involves much more work. Closing this since there are other open issues regarding that problem and this PR serves no real purpose anymore.\n. Please rename your file to structure.scss (it's sass now).\n. The adjancent string is parsed literally and the comment node is part of it. Related to At_Rule parsing (I already did some improvements for values). This sample shows the behavior:\ncss\n@-moz-keyframes        animatetoptop       /* Firefox */         line 429   {\nfrom {width:0%}\nto {width:100%}\n}\nruby sass:\ncss\n@-moz-keyframes animatetoptop       /* Firefox */         line 429 {\n  from {\n    width: 0%; }\n  to {\n    width: 100%; } }\nRelated to https://github.com/sass/libsass/issues/1263\n. This issue is also covered by my latest WIP branch, which seems to fix most if not all @at-root related bugs (ETA unknown, targeted 3.3): https://github.com/sass/libsass/pull/1249\n. The DEBUG output is not correct, but the spec test only tests the actual output. Rescoping to 3.3.1.\n. We now have a passing spec test since #1249 was merged :balloon: \n. Hey @mzgol first of all thanks for the test case! I tried to dig into the problem, as I thought with my latest refactor I had enough knowledge of most code to understand it. With the help of this test case and by comparing the output of ruby sass, I was able to narrow down the problem, but unfortunately my knowledge is not enough to have it fixed (@xyfer maybe you know more about the internals of extend, specially in regards to sources attached to compound selector, haven't really seen that one before?).\nSo I thought I document my findings here. First the code files involved as reference:\n- extend.cpp (main extend code)\n- node.cpp (crutch for extend?)\n- sass_util.cpp (flatten and paths)\n- ast.cpp (ast node related stuff)\nThere are a few todo notes in extend and a few indicate in the right direction IMHO. For me it looks like a compound selector in the second extend has incorrect sources. At least that's how far I got by comparing ruby sass to libsass. I attached two raw debug outputs of the test case, which does show a few differences (sorry, don't know any free and good compare view hoster and was too lazy to create something on github for this, just copy pase into your favourite compare tool :wink: ).\nRuby:\n+++++++++++++++++++++++++ .a\nextended_not_expanded: [[[.a]]]\npaths: [[[.a]]]\n++TRIM: [[[.a]]]\nSEQS1: [[.a]]\nSRCS: #<Set: {.a}>\nmax spec 1000\nSEQS2: [[.a]]\n--TRIMMED: [[[.a]]]\n[.a]\n++TRIM: [[[.a]]]\nSEQS1: [[.a]]\nSRCS: #<Set: {.a}>\nmax spec 1000\nSEQS2: [[.a]]\n--TRIMMED: [[[.a]]]\n+++++++++++++++++++++++++ .a.b\nDO EXTEND\nDO EXTEND\n+++++++++++++++++++++++++ .a\nDO EXTEND\n+++++++++++++++++++++++++ .d\nextended_not_expanded: [[[.a]], [[.d]]]\npaths: [[[.a], [.d]]]\n++TRIM: [[[.a, .d]]]\nSEQS1: [[.a, .d]]\nSRCS: #<Set: {.a .d}>\nmax spec 2000\nSEQS2: [[.a, .d]]\n--TRIMMED: [[[.a, .d]]]\n[.a .d]\n++TRIM: [[[.a, .d]]]\nSEQS1: [[.a, .d]]\nSRCS: #<Set: {.a .d}>\nmax spec 2000\nSEQS2: [[.a, .d]]\n--TRIMMED: [[[.a, .d]]]\n+++++++++++++++++++++++++ .c\nextended_not_expanded: [[[.a.b], [.a]], [[.c], [.a, .d]]]\npaths: [[[.a.b], [.c]], [[.a], [.c]], [[.a.b], [.a, .d]], [[.a], [.a, .d]]]\nSUBW SEQ1: [.a.b]\nSUBW SEQ2: [.a]\nINNER OPS1: []\nINNER OPS2: []\ntable: [[0]]\nx: [nil]\ny: [nil]\nlcs: []\nMERGED: []\nSUBW INIT: []\nSUBW FIN: []\nSUBW TWO SEQ1: [[.a.b]]\nSUBW TWO SEQ2: [[.a]]\ntable: [[0, 0], [0, 1]]\nx: [nil, [.a]]\ny: [nil, [.a.b]]\nlcs: [[.a.b]]\nRESULT: [[.a.b]]\nSUBW SEQ1: [.a]\nSUBW SEQ2: [.a]\nINNER OPS1: []\nINNER OPS2: []\ntable: [[0]]\nx: [nil]\ny: [nil]\nlcs: []\nMERGED: []\nSUBW INIT: []\nSUBW FIN: []\nSUBW TWO SEQ1: [[.a]]\nSUBW TWO SEQ1: [[.a]]\ntable: [[0, 0], [0, 1]]\nx: [nil, [.a]]\ny: [nil, [.a]]\nlcs: [[.a]]\nRESULT: [[.a]]\n++TRIM: [[[.a.b, .c]], [[.a, .c]], [[.a.b, .d]], [[.a, .d]]]\nSEQS1: [[.a.b, .c]]\nSRCS: #<Set: {.a.b .c}>\nmax spec 3000\nSEQS2: [[.a.b, .c]]\nSEQS2: [[.a, .c]]\nSEQS2: [[.a.b, .d]]\nSEQS2: [[.a, .d]]\nSEQS1: [[.a, .c]]\nSRCS: #<Set: {.a, .a.b .c}>\nmax spec 3000\nSEQS2: [[.a.b, .c]]\nSEQS2: [[.a, .c]]\nSEQS2: [[.a.b, .d]]\nSEQS2: [[.a, .d]]\nSEQS1: [[.a.b, .d]]\nSRCS: #<Set: {.a.b .c, .a .d}>\nmax spec 3000\nSEQS2: [[.a.b, .c]]\nSEQS2: [[.a, .c]]\nSEQS2: [[.a.b, .d]]\nSEQS2: [[.a, .d]]\nSEQS1: [[.a, .d]]\nSRCS: #<Set: {.a .d}>\nmax spec 2000\nSEQS2: [[.a.b, .c]]\nSEQS2: [[.a, .c]]\nSEQS2: [[.a.b, .d]]\nSEQS2: [[.a, .d]]\n--TRIMMED: [[[.a.b, .c]], [[.a, .c]], [[.a.b, .d]], [[.a, .d]]]\n[.a.b .c, .a .c, .a.b .d, .a .d]\n++TRIM: [[[.a.b, .c]], [[.a, .c]], [[.a.b, .d]], [[.a, .d]]]\nSEQS1: [[.a.b, .c]]\nSRCS: #<Set: {.a.b .c}>\nmax spec 3000\nSEQS2: [[.a.b, .c]]\nSEQS2: [[.a, .c]]\nSEQS2: [[.a.b, .d]]\nSEQS2: [[.a, .d]]\nSEQS1: [[.a, .c]]\nSRCS: #<Set: {.a, .a.b .c}>\nmax spec 3000\nSEQS2: [[.a.b, .c]]\nSEQS2: [[.a, .c]]\nSEQS2: [[.a.b, .d]]\nSEQS2: [[.a, .d]]\nSEQS1: [[.a.b, .d]]\nSRCS: #<Set: {.a.b .c, .a .d}>\nmax spec 3000\nSEQS2: [[.a.b, .c]]\nSEQS2: [[.a, .c]]\nSEQS2: [[.a.b, .d]]\nSEQS2: [[.a, .d]]\nSEQS1: [[.a, .d]]\nSRCS: #<Set: {.a .d}>\nmax spec 2000\nSEQS2: [[.a.b, .c]]\nSEQS2: [[.a, .c]]\nSEQS2: [[.a.b, .d]]\nSEQS2: [[.a, .d]]\n--TRIMMED: [[[.a.b, .c]], [[.a, .c]], [[.a.b, .d]], [[.a, .d]]]\n.a.b .c, .a .c, .a.b .d, .a .d {\n  top: 0; }\nLibsass\n```\n+++++++++++++++++++++++++ SOURCES WITH NEW SOURCE: SourcesSet[[.a]]\nEXTENDED NOT EXPANDED: [[[.a]]]\nPATHS: [[[.a]]]\nSUB: [[]]\nWEAVED: [[[.a]]]\n++TRIM: [[[.a]]]\nSEQS1: [.a]\nadding from head\nSEQ1 SOURCES: SourcesSet[[.a]]\nMAX SPECIFICITY: 65536\nSEQS2: [[.a]]\nPUSHING: [.a]\n--TRIMMED: [[[.a]]]\n+++++++++++++++++++++++++ SOURCES THIS EXTEND: SourcesSet[]\n+++++++++++++++++++++++++ SOURCES WITH NEW SOURCE: SourcesSet[[.a, .d]]\nEXTENDED NOT EXPANDED: [[[.a]], [[.d]]]\nPATHS: [[[.a], [.d]]]\nSUB: [[]]\nSUB: [[.a]]\nWEAVED: [[[.a, .d]]]\n++TRIM: [[[.a, .d]]]\nSEQS1: [.a, .d]\nSEQ1 SOURCES: SourcesSet[[.a, .d]]\nMAX SPECIFICITY: 131072\nSEQS2: [[.a, .d]]\nPUSHING: [.a, .d]\nEXTENDED NOT EXPANDED: [[[.a.b], [.a]], [[.c], [.a, .d]]]\nPATHS: [[[.a.b], [.c]], [[.a], [.c]], [[.a.b], [.a, .d]], [[.a], [.a, .d]]]\nSUB: [[]]\nSUB: [[.a.b]]\nSUB: [[]]\nSUB: [[.a]]\nSUB: [[]]\nSUBW seq1: [.a.b]\nSUBW seq2: [.a]\nINNER OPS1: []\nINNER OPS2: []\nVERY VERY VERY VERY SMELLY\nLCS CALLED WITH NOW: X=[nil] Y=[nil]\nLCSTABLE: X=[nil] Y=[nil]\nLCSBACK_IN: X=[nil] Y=[nil] I=0 J=0\nRETURNING EMPTY\nINIT: []\nFIN: []\nSUBW TWO SEQ1: [[.a.b]]\nSUBW TWO SEQ2: [[.a]]\ngot from her\nLCSSS: X=0x2e0db80,  Y=0x2e0da40,\nRETURNING AFTER ELEM COMPARE\nRETURNING EMPTY\nLCS: table=:0:0,:0:1,\nSEQLCS: [[.a.b]]\nFLATTENED: [[.a.b]]\nSUB: [[.a.b]]\nSUB: [[]]\nSUBW seq1: [.a]\nSUBW seq2: [.a]\nINNER OPS1: []\nINNER OPS2: []\nVERY VERY VERY VERY SMELLY\nLCS CALLED WITH NOW: X=[nil] Y=[nil]\nLCSTABLE: X=[nil] Y=[nil]\nLCSBACK_IN: X=[nil] Y=[nil] I=0 J=0\nRETURNING EMPTY\nINIT: []\nFIN: []\nSUBW TWO SEQ1: [[.a]]\nSUBW TWO SEQ2: [[.a]]\ngot from her\nLCSSS: X=0x2e0e580,  Y=0x2e0e440,\nRETURNING AFTER ELEM COMPARE\nRETURNING EMPTY\nLCS: table=:0:0,:0:1,\nSEQLCS: [[.a]]\nFLATTENED: [[.a]]\nSUB: [[.a]]\nWEAVED: [[[.a.b, .c]], [[.a, .c]], [[.a.b, .d]], [[.a, .d]]]\n++TRIM: [[[.a.b, .c]], [[.a, .c]], [[.a.b, .d]], [[.a, .d]]]\nSEQS1: [.a.b, .c]\n\nComplex_Selector 0x2e0ec60 (18446744073709551615@[0:0]-[0:0]) [weight:30000] [@media:0] - - - --  <>\n Compound_Selector 0x2e121c0 (18446744073709551615@[0:0]-[0:0]) [weight:0] [@media:0] - - - <>\n  Parent_Selector 0x2e19460 (18446744073709551615@[0:0]-[0:0]) <>\n{ }Complex_Selector 0x2e0ed00 (0@[0:2]-[0:4]) [weight:30000] [@media:0] - - - --  <>\n{ } Compound_Selector 0x2c2e760 (0@[0:0]-[0:0]) [weight:20000] [@media:0] - - - <>\n{ }  Selector_Qualifier 0x29b46a0 (0@[0:0]-[0:2]) <<.a>> - -\n{ }  Selector_Qualifier 0x29b4730 (0@[0:2]-[0:4]) <<.b>> - -\n{ }{ }Complex_Selector 0x2e0eda0 (0@[0:5]-[0:7]) [weight:10000] [@media:0] - - - --  <>\n{ }{ } Compound_Selector 0x2c2e840 (0@[0:2]-[0:4]) [weight:10000] [@media:0] - - - <>\n{ }{ }  Selector_Qualifier 0x29b47c0 (0@[0:5]-[0:7]) <<.c>> - -\n\nAbort - something smells fishy - seqs1 has no sources\nSEQ1 SOURCES: SourcesSet[]\nMAX SPECIFICITY: 0\nSEQS2: [[.a.b, .c]]\nSEQS2: [[.a, .c]]\nFOUND MORE SPECIFIC\nYEPP MORE SPECIFIC\nSEQS1: [.a, .c]\nadding from head\nadding from head\nSEQ1 SOURCES: SourcesSet[[.a]]\nMAX SPECIFICITY: 65536\nSEQS2: []\nSEQS2: [[.a, .c]]\nSEQS2: [[.a.b, .d]]\nSEQS2: [[.a, .d]]\nPUSHING: [.a, .c]\nSEQS1: [.a.b, .d]\nadding from head\nadding from head\nSEQ1 SOURCES: SourcesSet[[.a, .d]]\nMAX SPECIFICITY: 131072\nSEQS2: []\nSEQS2: [[.a, .c]]\nSEQS2: [[.a.b, .d]]\nSEQS2: [[.a, .d]]\nFOUND MORE SPECIFIC\nYEPP MORE SPECIFIC\nSEQS1: [.a, .d]\nadding from head\nadding from head\nSEQ1 SOURCES: SourcesSet[[.a, .d]]\nMAX SPECIFICITY: 131072\nSEQS2: []\nSEQS2: [[.a, .c]]\nSEQS2: []\nSEQS2: [[.a, .d]]\nPUSHING: [.a, .d]\n--TRIMED: [[], [[.a, .c]], [], [[.a, .d]]]\n.a.b .c, .a .c, .a .d {\n  top: 0; }\n```\nFollowing things seem to be wrong:\n- SEQS1: [.a.b, .c] has no sources and therefore a specificity of 0\n- ... which will lead to the removal of said selector (hence this bug)\n- last extend has different SourceSet for every sequence\n- ... libsass: [], [.a], [.a, .d], [.a, .d] vs ruby: {.a.b .c}, {.a, .a.b .c}, {.a.b .c, .a .d}, {.a .d}\n- we miss a ++++ SOURCES WITH NEW SOURCE early in libsass\nMaybe @akhleung or @xzyfer have more ideas what could be going wrong!? If it is of any use, I could also provide the modifications for ruby sass to get the debug output as posted above.\n. Probably one of the most occult things I have ever debugged. But finally after probably the third different stab at it: \"mission impossible accomplished\" -> https://github.com/sass/libsass/pull/1501\n. @onedayitwillmake Thanks a lot for your feedback! I didn't actually do much work in the parser/eval before, so I had the get myself familiar with it first too. I see some more work in pseudo selectors, since they trigger specific \"is_superselector\" behavior. But we may postpone this after an initial release.\n@xzyfer I'd say lets set a due date and I will see how much I can get in. I'm now at a stage where I think I have parent selectors covered quite well (took me about 3 days to get it right and to wrap my head around it). Unfortunately I will not have that much time over the next weekends.\n. Made some major break thoughs by removing the re-parsing step in ruleset expander. Basically re-implemented the complete selector parsing, expanding and evaluating part. Big performance improvements in the loop and number evaluation code parts and also a lot of smaller performance improvements from parser, expand and eval refactoring.\nThis branch should now pass the following open issues:\nhttps://github.com/sass/libsass/issues/941, https://github.com/sass/libsass/issues/948, https://github.com/sass/libsass/issues/1029, https://github.com/sass/libsass/issues/1043, https://github.com/sass/libsass/issues/1061, https://github.com/sass/libsass/issues/1170, https://github.com/sass/libsass/issues/1207, https://github.com/sass/libsass/issues/1210, https://github.com/sass/libsass/issues/1214, https://github.com/sass/libsass/issues/1219, https://github.com/sass/libsass/issues/1227, https://github.com/sass/libsass/issues/1230, https://github.com/sass/libsass/issues/1240, https://github.com/sass/libsass/issues/1253, https://github.com/sass/libsass/issues/1255, https://github.com/sass/libsass/issues/1257, https://github.com/sass/libsass/issues/1258, https://github.com/sass/libsass/issues/1260, https://github.com/sass/libsass/issues/1263, https://github.com/sass/libsass/issues/1269, https://github.com/sass/libsass/issues/1273, https://github.com/sass/libsass/issues/1281, https://github.com/sass/libsass/issues/1283, https://github.com/sass/libsass/issues/1285, https://github.com/sass/libsass/issues/1291, https://github.com/sass/libsass/issues/1297\nNow also passes these is_superselector tests:\n- has_is_superselector_of_subset_host\n- host_context_is_superselector_of_subset_host\n- host_is_superselector_of_subset_host\n- matches_is_superselector_of_subset_matches\n- nth_match_is_not_superselector_of_nth_last_match\n- nth_match_is_not_superselector_of_nth_match_with_different_arg\nThere is one minor white-space issue, that prevents\n- https://github.com/sass/libsass/issues/1214 and basic\\38_expressions_in_at_directives\nExample:\ncss\n@mixin dummy {\n  @keyframes {\n    @content;\n  }\n}\n@include dummy {\n  foo, bar { baz: test; }\n}\nRuby sass output (compressed!):\ncss\n@keyframes{foo, bar{baz:test}}\nCurrent libsass output (compressed!):\ncss\n@keyframes{foo,bar{baz:test}}\nIMHO libsass is correct here to remove the space after the comma separator.\n@xzyfer if you agree here, I will commit the spec changes once the PR is merged!?\n. @xzyfer cleaned up the most obvious stuff but all in all I'm pretty much done for the first step. So this is pretty much open for review and comments now. I added a few crutches to solve a few edge cases for now. A complete solution for these edge cases will need some more work. These are namely:\n- wrapper argument for is_superselector evaluating\n- use of remove_parent_selectors in is_superselector\n- passing of is_root with block parsing function\n- few parsing functions are not coded very optimal\nOther than that I feel pretty confortable with the final result!\nShould be a solid base to work towards the next 3.3 release!\nToDo: need to check if parser errors out correctly for missing scope brackets and semicolons ...\n. Hey @ekskimn ATM I'm not sure when I have time to re-arange this PR once again. @xzyfer I know it's a bit messy, but it's also a lot of work to have it clean all the time while doing such development (I guess you know that). @ekskimn just put your fixes somewhere on github (I also have nothing against a PR into my branch). But at least make sure we can cherry pick your commit somehow ...\nI guess the code is good enough now, but there are some open remarks by @xzyfer. I already did some tests and fixes for bad input. But since we have no tests for errors, it's hard to tell how good the code quality is there. Maybe I have some time today to address the remarks by @xzyfer ...\n. I heavily rebased this PR to improve the history. Also moved a lot of the simpler fixes/commits to the top, so they should be possible to apply to master first. But I didn't check if each one actually compiles!\n@xzyfer if you think it's good enough, I'd say hit merge :rocket: \n. @xzyfer the feature query parsing has been pulled out as requested.\n. @xzyfer There is still the issue with compressed mode (I'll copy the example from above):\ncss\n@mixin dummy {\n  @keyframes {\n    @content;\n  }\n}\n@include dummy {\n  foo, bar { baz: test; }\n}\nRuby sass output (compressed!):\ncss\n@keyframes{foo, bar{baz:test}}\nCurrent libsass output (compressed!):\ncss\n@keyframes{foo,bar{baz:test}}\nThis seems related to https://github.com/sass/sass/issues/1296. Therefore I propose to update the sass-specs affected by this edge case, since libsass is IMO correct and should pass those tests.\n. Pulled out the commits as requested and put them into https://github.com/sass/libsass/pull/1330\n. Another regression:\n``` css\n%foo1 {\n\nbar > bam &:before,\nbar > bam &:after {\n    bar: baz;\n  }\n}\n\ntest1 {\n  @extend %foo1;\n}\n```\nResult before the fix:\n``` css\n\nbar > bam &:before, > bar > bam &:after {\n  bar: baz; }\n```\n\nResult after additional fix:\n``` css\n\nbar > bam test1:before,\nbar > bam test1:after {\n  bar: baz; }\n```\n\nIMO the additional line-feed makes sense and improves readability (and is more what I would expect from the given input). So I vote to leave it that way and call it a ruby sass bug!? IMHO once everything is more stable it should be possible to simplify the code even more. There are quite a few duplicated code points.\n. Waiting for AppVeyor then ... :rocket: :guitar: \n. We now have a passing spec test since #1249 was merged :balloon: \n. We now have a passing spec test since #1249 was merged :balloon: \n. Hey @onedayitwillmake, already took a quick look yesterday and looks very nice and clean. Unfortunately appveyor doesn't yet pass, which is pretty much the only thing that I see as a blocker before merging this PR as is. @xzyfer I think at this point it will be best to merge this PR to master and I will then realign my WIP branch for the 3.3 release. I guess we need a few beta rounds anyway with 3.3.\nShould we create a separate release coordination issue as I did for 3.2?\n. I have incorporated most of your changes in my latest WIP branch: https://github.com/sass/libsass/pull/1249 - maybe check if I have missed anything! It seems to pass most of the tests and I tried to replace some functionality with more generic functions, which I added during the refactoring!\nIMHO we now mostly need to tackle is_superselector in regard to :not (and other) pseudo selectors!\nAnd once again, thanks for your contributions!\n. I guess this can be closed since #1249 has been merged :tada:\n. This should be fixed by #1528!\nI get now this do_import order:\n-- foo.scss\n-- foo1\n-- foo1a\n-- foo1b\n-- foo2\n. Minimized test case:\ncss\nfoo {\n  @--bar(--baz);\n}\nExpected result:\ncss\nfoo {\n  @--bar (--baz); }\n. The original issue is solved with my latest WIP 3.3 branch, but there seems to be a side issue when the custom at_rule block is not preceded by some other declaration. Need to investigate further!\n. We now have a passing spec test since #1249 was merged :balloon: \n. Minimal test case:\ncss\ntest {\n  src: url(test.eot#{if(true, '?#{42}', '')});\n}\nexpected:\ncss\ntest {\n  src: url(test.eot?42); }\n. Closing since it seems to works with 3.2.5 (http://sassmeister.com/gist/20e918b8c1a4f2718e4e).\n. This will be fixed once the parser refactoring is merged!\n. We now have a passing spec test since #1249 was merged :balloon: \n. Compact is not part of ruby sass, therefore it was removed in libsass.\nPlease see https://github.com/sass/libsass/pull/588 or use the search to find out more!\nClosing as invalid.\n. Spec test should also include test for to-lower-case!\n. Duplicate of #1281 \n. This is actually easy to fix. We actually have a specific code part for exactly that faulty behavior?\nin functions.cpp type-of($value)\nC\n- if (ctx.names_to_colors.count(str)) {\n-   return new (ctx.mem) String_Constant(pstate, \"color\");\n- }\n. Duplicate of #1280\n. Checked latest master and this change seems to have gotten into somehow!\n. Thxs for the report @davidkpiano! I can confirm this issue and also have a fix ready!\nIn ast.hpp class List virtual size_t hash():\nc++\n- hash_ ^= (elements()[i])->hash();\n+ hash_ ^= (elements()[i])->hash() + (i + 1);\n. First solution approach was too naive, should use this instead:\ntemplate <typename T>\n  void hash_combine (std::size_t& seed, const T& val)\n  {\n    seed ^= std::hash<T>()(val) + 0x9e3779b9\n             + (seed<<6) + (seed>>2);\n  }\n...\n      for (size_t i = 0, L = length(); i < L; ++i)\n        hash_combine(hash_, (elements()[i])->hash());\n. If I refresh compilation on your sassmeister gist I see the same expected output!?\n. This will be fixed once we release my latest refactoring for parser and at-root, which should have the first beta rounds in a few weeks (if everything goes as planned).\n. We now have a passing spec test since #1249 was merged :balloon: \n. @saper I guess we currently mostly use debug_ast and I recently started to use debug_node. IMO none of our debugging stuff is really documented. So let me give you an intro from what I know:\ndebug_ast was introduced by me and is contained in debugger.hpp which you explicitly need to include if you want to debug something (and yes, I keep pulling this in and out a lot!). The end PR should not be dependent on this file! You can pass it any AST_Node and it will print a debug tree.\ndebug_node is the sister of debug_ast and can be used to debug Node collections used by the extend facility. Latest version is probably not yet on master!\nI guess you already found out how the DEBUG flag works, so I won't go into any details here.\nI'm also not really in favor of adding this kind of debug facility. You now added trace calls for every string creation, but why not add it for every type of AST_Node? IMO the debug output shortly becomes less and less usefull once we trace more and more stuff. So I'm also hesitant to add this to master.\n. IMHO you could've used debug_ast.\n``` c++\ninclude \"debugger.hpp\"\nString_Quoted* s = new ...\ndebug_ast(s, \"message: \");\n```\nOutput might be a bit crypric for some state details.\nAnd it's still evolving, so it may not yet handle everything!\n. @saper Not sure how good you're knowledge is about the CRTP pattern libsass uses. The reason why void Output::operator()(String_Constant* s) is called is a \"bug\" in operations.hpp, which is missing a default visitor for String_Quoted. I fixed this just now in https://github.com/mgreter/libsass/commit/f1938e5e95ba9a2a092419ce51d6016ef8523b10\n. There is an ATTACH_OPERATIONS defined in ast_def_macros.hpp which is added to every AST_Node class. This sets up the perform visitor. I'm no expert at this either, but I guess due to the missing visitor in operations.hpp the compiler was only able to find the most common visitor for String_Quoted which was indeed String_Constant. In there we have a static_cast which probably is the reason why only that visitor gets called (and I guess the dynamic_cast we had there fixed this at runtime).\n. LGTM for a first fix! I am aware that we need a better and more complete API for Number and String handling. My goal is to also have operations available to the C-Bindings, so they don't need to implement addition, multiplication, concat etc. themselve. But not sure when/if I or someone else will come around to actually do it ...\n. @saper not sure what you mean? I'm talking about C functions like sass_number_subtract, sass_string_concat, sass_value_compare, sass_value_lt ... So don't see where the problem is?\n. LGTM :+1: \n. Latest ruby sass gives the following warnings, which is why libsass does not support this (yet?)\nDEPRECATION WARNING: Passing 3, a non-string value, to unquote()\nwill be an error in future versions of Sass.\n        on line 2 of foo.scss, in `spec1'\n        from line 16 of foo.scss\n. @xzyfer since it was easy I refactored the unquote function to match current latest ruby sass (also reporting a deprecation warning). IMO we currently support this for Lists, so IMO it's more correct this way. As a side note: Ruby sass quote function already errors out on other types than strings.\n. Seems to work for me:\n``` C++\ninclude \ninclude \ninclude \"sass_context.h\"\nSass_Import_List sass_importer(const char path, Sass_Importer_Entry cb, struct Sass_Compiler comp)\n{\n  // get the cookie from importer descriptor\n  void cookie = sass_importer_get_cookie(cb);\n  Sass_Import_List list = sass_make_import_list(2);\n  const char local = \"local { color: green; }\";\n  const char* remote = \"remote { color: red; }\";\n  list[0] = sass_make_import_entry(\"/tmp/styles.scss\", strdup(local), 0);\n  list1 = sass_make_import_entry(\"http://www.example.com\", strdup(remote), 0);\n  return list;\n}\nint main( int argc, const char* argv[] )\n{\n// get the input file from first argument or use default\n  const char* input = argc > 1 ? argv1 : \"styles.scss\";\n// create the file context and get all related structs\n  struct Sass_File_Context file_ctx = sass_make_file_context(input);\n  struct Sass_Context ctx = sass_file_context_get_context(file_ctx);\n  struct Sass_Options* ctx_opt = sass_context_get_options(ctx);\n// allocate custom importer\n  Sass_Importer_Entry c_imp =\n    sass_make_importer(sass_importer, 0, 0);\n  // create list for all custom importers\n  Sass_Importer_List imp_list = sass_make_importer_list(1);\n  // put the only importer on to the list\n  sass_importer_set_list_entry(imp_list, 0, c_imp);\n  // register list on to the context options\n  sass_option_set_c_headers(ctx_opt, imp_list);\n  // context is set up, call the compile step now\n  int status = sass_compile_file_context(file_ctx);\n// print the result or the error to the stdout\n  if (status == 0) puts(sass_context_get_output_string(ctx));\n  else puts(sass_context_get_error_message(ctx));\n// release allocated memory\n  sass_delete_file_context(file_ctx);\n// exit status\n  return status;\n}\n```\nbash\ngcc -c importer.c -o importer.o\ngcc -o importer importer.o -lsass\necho \"body { color: gold; }\" > importer.scss\n./importer importer.scss\n``` css\nlocal {\n  color: green; }\nremote {\n  color: red; }\nbody {\n  color: gold; }\n``\n. Going to close this then. Good luck with your hunt :wink: \n. I guess this has to do with how we \"store\" imports on the c++ side of libsass. This is also related to https://github.com/sass/libsass/issues/1160!\n. This is related to String_Quoted and also related to https://github.com/sass/libsass/issues/1026. Since we need a different parser for 1026, this will probably be fixed at the same time! The problem is the backslash before the newline.\n. @xzyfer IMO this is not related to #1096, they seem to trigger two different parse paths. Comments need a new parse path, since block comments undergo a strange indent normalization!\n. It sounds like @davidkpiano is right, but without an actual test case I unfortunately cannot tell you if it really fixes your issue. Can you provide a shortened and compilable (with ruby sass) example?\n. I can confirm it's the same issue, altough it exhibits a little different behavior. Had to update the hash function to something more sophisticated to get this passing too. \n. @thebestako35 there are some explanations in https://github.com/sass/libsass/issues/1283 (changed the hashing function for these objects)\n. Duplicate of https://github.com/sass/libsass/issues/1210 and will be fixed once my latest refactoring is merged: https://github.com/sass/libsass/pull/1249!\n. We now have a passing spec test since #1249 was merged :balloon: \n. LGTM!\n. This works as expected with #1249 ... not sure which commit actually contains the fix!\n. We now have a passing spec test since #1249 was merged :balloon: \n. The fix (by @ekskimn) is included in #1249 ...\n. We now have a passing spec test since #1249 was merged :balloon: \n. The fix (by @ekskimn) is included in #1249 ...\n. IMHO we would need corresponding VS project files for sassc as we have for libsass. Before that I don't really want to remove sassc, since we need sassc for our CI process.\n. Closing this since @am11 added some commits that addresses this issue.\n. Seems valid; the memory accessu[npos]` will pretty sure be out of bound!\n. Please check the referenced commits: https://github.com/xzyfer/libsass/commit/c45a702a8042389b70dc4632278a492c0a3a5330 (or on master: https://github.com/sass/libsass/commit/093998473a6124ab86b7b5fef213a1c5f6de93b7)\n+        string unit(u.substr(l, r == string::npos ? r : r - l));\nThen if you are worried about passing r (npos) to substr, see:\nhttp://www.cplusplus.com/reference/string/string/substr/\nA value of string::npos indicates all characters until the end of the string.\nLooks safe enough for me :wink: \n. Tried to add the suggestion from @djensen47 in https://github.com/sass/libsass/commit/b523c9e6cf226a7923d35af61be53c8761baad54 (also in https://github.com/sass/libsass/pull/1249).\n. Can somebody confirm if commit https://github.com/mgreter/libsass/commit/73022b3d019f73437baf7e55946d984abdf9d885 in #1330 fixes this issue :question: \nThis is a minimal hotfix to get this issue closed. Further optimizations may follow ...\n. IMHO https://github.com/sass/libsass/pull/1367 should fix this for real, since it does not longer export the full std namespace by default.\nBut we have no access to SUB OS, so we cannot test it ourself!\n. IMHO this should wait for https://github.com/sass/libsass/pull/1338\n. The error was that we did not evaluate the media queries in import statements. But there is another strange discrepancy. I would like to change the spec test to:\ncss\n$foo: 400px;\n$bar: \"min-width: 400px\";\n@import url(foo.css) (min-width:400px);\n@import url(foo.css) (min-width:$foo);\n@import url(foo.css) (min-width:#{$foo});\n@import url(foo.css) ($bar);\n@import url(foo.css) (#{$bar});\nJust added a space, since libsass really just adds the string from the variable. It seems ruby sass does a re-interpretation when something is inserted there. See this example:\ncss\n$bar: \"min-width:2+400px\";\n@import url(foo.css) ($bar);\n@import url(foo.css) (#{$bar});\nOutput:\ncss\n@import url(foo.css) (min-width: 2 (+400px));\n@import url(foo.css) (min-width: 2 (+400px));\nNot sure why ruby sass is doing that!??\n. Fix has been merged! Maybe we should open a new one for the remaining white-space issue!\n. I guess this can be closed since #1249 is merged :tada: \n. Closing as the hotfix has been merged. A better fix might still be applied later!\n. Superseeded by https://github.com/sass/libsass/pull/1330\n. This seems already fixed with my latest refactoring branch (//CC @xzyfer)\n. it seems that the fix for this is somewhere burried in one of my refactorings ...\n. IMO this is not fixed yet, waiting for that fix to come up ...\n. It seems this problem only happens if you use windows linefeeds ...\n. The whole thing was a lot weirder and has indeed to do with how we parse css strings (@xzyfer this is actually where the differences between static and quoted strings come into play). Anyway, I think I have a proper fix in https://github.com/sass/libsass/issues/1349!\n. I'm pretty sure this is superseeded now by https://github.com/sass/libsass/pull/1330\n. @xzyfer my other PR #1338 contains these commits. These are IMHO the most important ones. I guess we still can merge @saper un'std branch later (I guess it should fix the SUB OS problems for now). This one should be easy to review, so I hope we can get this into master ASAP!\n. @saper regarding the AM_PROG_AR. It works if I also add m4_pattern_allow([AM_PROG_AR]) which I guess will tell it to ignore the error about not existing macro 'AM_PROG_AR' not found in library. So does my commit actually fix the original problem? Other than that, I'm not too excited about getting rid of using namespace std. It just makes it more tedious to code around ...\n. @xzyfer This should be merged next for 3.3! Should not be too big for a review ;)\n. List of fixed open issues:\n- https://github.com/sass/libsass/issues/1246\n- https://github.com/sass/libsass/issues/1259\n- https://github.com/sass/libsass/issues/1298\n- https://github.com/sass/libsass/issues/1305\n- https://github.com/sass/libsass/issues/1332\n. Gave it another review and for me this is ready to :ship: \n. Rebased branch to have requested commit to be the first in list (github did not update the list in this PR here) and created another PR #1342 that only includes that specific commit. \n. So this PR is ready once the other PR is merged! And yeah, messed up by using another client, bah.\n. Removed as requested!\n. This is partially fixed by #1330 ... but quoted strings get inserted unquoted.\n. This is now in a state where I have access to all sass value operations in the C-API via exposed sass_op function. But it needs more tests if all operations behave as expected (basic tests work so far).\n. I have it at a state now where we handle memory much nicer. Temporary values allocated in functions and loops are released after their block goes out of scope (or if another variable overwrites its spot in the environment). The following sample now runs at a stable memory usage of ~15MB (via perl-libsass). Previousely it ran pretty fast out of memory (multiple gigs) ...\ncss\n@for $x from 1 through 5000000 {\n  $a: 2px;\n  $b: 1*1;\n  $c: foobar;\n  $d: foo bar;\n  $e: \"asd\"+\"qwe\";\n  $f: \"asd\"+\"qwe\";\n  $g: (1, asd, \"qwe\");\n  $h: (a: 1, \"b\": asd, 3: \"qwe\");\n}\nMemory allocation so far is not optimal, as we always directly free and allocate memory from the system. Looks like we will need a block allocator and maybe some shared pointer logic ...\nNote: unordered_map has performance regression in gcc 4.7\n. This is basically superseeded by https://github.com/sass/libsass/pull/1338!\nWill leave this open, since the other PR does not include custom memory handling!\n. We now have a passing spec test since #1249 was merged :balloon: \n. @saper can we move that discussion to https://github.com/sass/libsass/pull/1330, thx!\n. If have split the first part of this PR into 3 different PRs: ~~https://github.com/sass/libsass/pull/1346~~ , ~~https://github.com/sass/libsass/pull/1345~~  and https://github.com/sass/libsass/pull/1342. I hope they are sliced ok and have a good size to give it a proper review (//CC @xzyfer). They should all be uncritical since they do not really change any code logic. Will split out more PRs once they are merged!\n. Next PRs pulled out from here: https://github.com/sass/libsass/pull/1348, https://github.com/sass/libsass/pull/1347 and still https://github.com/sass/libsass/pull/1342 (//CC @xzyfer)\n. Ruby sass relies on the extension, so we probably should keep it that way. I agree there are smarter solutions, but so far we always follow the ruby sass way. So in that sense this change would be legit!\n. This fixes the error when multiplying values that would result in invalid css values. This check has been moved to the Output phase, but for other operations we still want to error right away. This is what the strict flag is for (it basically is true for DIV and MUL afair). Reason is that multiplications should be valid when assigned to a variable, since it could still be divided so it results in a valid number to output!\n. So the surprise is that I created a project to create an MSI installer for libsass. Pretty much a rip-off from one of my other projects, so it was not really too difficult to make this happen :smile: :tophat: \n:package: http://webmerge.ocbnet.ch/libsass/installer/\n:slot_machine:  https://github.com/mgreter/libsass-msi-installer\nNot sure if it would be better to create the library and utility via autotools!\n. Would be nice if people who tried it out could report if it works. I'm not 100% certain, since I probably have dlls around for most things. So not sure if it contains everything to work on a new system ...\n. @xzyfer this should be merged next ...\n. Thanks, good catch! Finally this whole thing should be const, but for now this is not possible. It should be once the whole sass_op PR is merged! \n. Wating for CI :traffic_light: to report back ...\n. Will merge this if CI goes green :rocket: \n. Basically String_Constant are literals, while String_Quoted are actual strings with semantics. Internally we store the latter in unquoted form and decide on output if we should quote them again (usefull for comparison to literals or concatenation). AFAIR, we previousely had the flag needs_unquote, which basically represented the same as these two string classes. I basically just introduced them for interpolation; but I guess there is a difference between actual sass string values and i.e. static expressions (where ruby sass even preserves block comments).\nAs you know interpolation is still a mess, and fixing that will definitely help clearing up the mess with the string classes. BTW: the list without spaces is String_Schema, but output (escaping) is off to ruby sass ...\n. There is still one case which does not work:\n``` css\n@function baz() {\n    @return \"baz\";\n}\nfoo {\n    bar: #{' !important'}baz();\n}\n``\n. @xzyfer this could be merged ... doesn't fix all cases, but is an improvement!\n. The only headers you should include are the ones that will be inincludesubfolder (only C-API headers). I really hope you don't import any of thehppheaders, since they are not meant for consumers to be included. Also don't see how this could cause much problems, since you just need to pass the new include path to the compiler (mostly-I include`).\nI guess it will take me 5 minutes to update perl-libsass to use the new file structure!\nsass_context.h should include all available headers!\nhttps://github.com/sass/libsass/blob/master/sass.h#L45\nhttps://github.com/sass/libsass/blob/master/sass_context.h#L6\nI'm also thinking about moving the headers into a libsass subdirectory, since this is how pretty much all other system libraries handle/install their headers (#import <libsass/sass_context.h>).\n. perl-libsass builds it from source too. Can't you just pass another include directory to the invoked compiler? Seems to be one of the most common cases IMO! Or I don't understand your concerns!!\n. @xzyfer this should all be unproblematic!\na) there is one commit that just moves the files. So we don't lose history or anything!\nb) it is how pretty much all other projects are organized and it helps keeping root clean!\nc) Compilation only needs two changes: new path for sources and additional include directories!\n. Here the commit needed to adjust perl-libsass: https://github.com/sass/perl-libsass/commit/cdb2c4429d84c4331b226a5b5c5e008b41ded0ea\n. Merged changes needed for sassc spec runner to pass CI ... let's wait and see :traffic_light: \nBTW. changes in sassc are backward compatible, so it also works with the old source tree :wink: \n. @saper \n1) I don't see a way around it without getting rid of either one. Since mingw does not support autotools easily (and it is also pretty slow to generate the makefiles, if you ofter start with an empty tree). So I don't want to get rid of it. So I don't see a solution for this annoyance. \n2) which lib directory are you talking about. The lib will be built in build/lib and installed to $prefix/lib. Not sure what you mean by \"not used\"? Simply define the correct prefix and do make install, then tell node-sass to use the lib from there!?\n3) Agree, but one step at a time. I've read this is not that easy with autotools!\n4) Also agree, but cannot fix everything at once :wink:\n. @saper I don't really see why 1) is such a big problem. The only annoyance I have with it is that I have to be carefull when changing the makefile without commiting and later running autoreconf (which would overwrite any previous unstaged changes). I also accidentaly commit it once or twice, but nothing a rebase/ammed could fix. Other than that I don't see any issues!?\n. Pretty sure CI is going :green_heart: in a few minutes and I'll :ship: this. It has been tested on mingw (makefiles via CI) under cmd, mingw under msys (makefiles and autotools), gcc and clang on linux (makefiles and autotools via CI), clang on mac (makefiles and autotools via CI) and MSVC under windows via CI. Also tested building sassc directly under windows in all variations (plus CI tests on linux). Each for shared and static!\n. I guess not much we can do about that for now, I only consider it an annoyance. Maybe you can tell autotools to build the Makefile somewhere else for you? Or use the plain makefiles!?\nBTW: https://github.com/sass/libsass looks much better, doesn't it?\n. @saper if git is not available it will probably fail. We mainly use these files for CI and they are not polished enough anyway to build all possible combinations (static/shared). Heck they even have a hard reference to sassc.cpp, since we need that to run the spec test suite.\n. Yep, breaking change, that's why I want to include it in 3.3, otherwise we have to wait for 3.4. And we are not following semver for now, but we try to add only breaking changes with bigger version increments!\n. I will do this once the other PRs are merged, too much moving right now!\n. After looking a bit more into this task I think we should do this when we remove obsolete sass_interface.h. So the question is do we want to remove it for 3.3 or wait to 3.4?\n. I agree and I would be in favor of dropping it for 3.3 ...\n. Will be fixed in https://github.com/sass/libsass/issues/1362 by removing that function :wink: \n. We cannot really fix everything correctly at once. This would need a major refactoring of all string types! So we either go with the hacky one or leave it open for the next months or year! It also helps to start to figure out what really are the different use cases. A lot has been cleared up lately because we started to work in the right direction (often with hacky stuff and flags first). Once everything works with spec test a correct refactoring and putting these options in the right place is much easier IMHO!\n. BTW. this should probably be done when creating String_Quoted instances, but currently we also parse comment into a String_Quoted, meaning we can only add this to the right place after i.e. the block comments are pared correctly (and probably other objects). That's why I opted for a flag on output. It should be removed once it can be added to the String class itself!\n. In principle $(RM) -r is not portable. Might not be that big of an issue as ie. mkdir -p, but what if we have del set for RM! Might not be a problem now, but if we use specific options, it makes no sense to use variables for the calls! We can try to remove the directory, but I don't like the -r option!\n. Del has no such support! Other solutions on windows like \"rd\" are not available on all versions!\nI say just go with $(RMDIR), if it is not empty we probably should not remove it anyways!?\n. Actually del did not have this option from the begining. But I see that more and more of my knowledge gets obsolete :older_man:  Seems like win98/me was the last win OS that did not implement this flag (I remember we used deltree in the old times). Looks like it got introduces with windows 2000.\n. I mean mostly for ie. blame commands, since it changed a lot of existing lines. From looking at the commits, it looks like values.hpp file was added and removed before (2012), but I also don't see an actual remove commit. But from the changes it is clear that there was one in between! The files actually was newly added with the source-move commit! \n. Resolved the nitpicks ... I'm pretty sure there are much more redundant header includes. But IMHO It is just not really worth the time to hunt them all down!\n. Would like to move forward with this so we can prepare the first beta releases!\n@saper do you think this is good enough to solve the initial issue? \n. So here my short feedback:\n1) I guess it's already clear that my personal opinion is against needing std:: for most common types.\n2) Probably true, but IMHO really just minor things and there are probably counter arguments!\n3) IMO it should be valid to import stuff into our own namespace (which is what the new header is doing, importing std::string and a few others into Sass namespace. I agree we should not pollute global namespace via any headers, IMHO it's a different story for cpp files!\n4) We could include this in another header, we don't have to introduce a new one. But IMO it very easily shows you what we import by default from the std namespace into the Sass namespace. So if you are using Sass namespace, you know what to expect IMHO. Also sass2scss.h now imports the symbols into the Sass namespace, so no global pollution!?\nI will be pretty much away for 2 weeks now!\n. I don't really see a benefit to have a prefilled \"virtual filesystem\". First thing is that I think that mostly anyone doesn't know beforehand which files are needed, so a on demand loading seems natural after all. Caching of compiled files could also be implemented easily with the existing interface (if wanted at some point, but I think could be something once we have a much more stable and clean code-base).\nAny objections to close this one?\nDon't see a point to keep these open forever?\n. The point would be to not call a custom importer for the same file twice, even between different compiles and effectively re-use the already parsed AST tree. This would probably need some kind of check mechanism to see if the source can be served from cache or not. And as I said, this is IMO currently too far away to even consider it. But who knows where this all will lead ...\n. The parsed AST tree has a variable node in that case. What you are refereing to is the evaluation stage. We parse the source into an AST \"as is\". So this could be cached. It's really like php zend does caching with the parsed op tree (which is the equivalent of our ast tree before evaluation and expanding).\n. I created a collective ticket to keep track this and other \"non-urgent\" feature requests, in order to keep the issue tracker a bit more clean for the more 1st aid issues. I would like to encourage everybody interested in this particular feature to add their comments into this closed issue anyway.\nThanks for your understanding and your contribution!\n. With #1477 it renders now:\ncss\n.test {\n  display: inline-block;\n  background: url(i/icon.png);\n  background-repeat: no-repeat;\n  width: 100px;\n  height: 100px; }\n. This seems just another specific detail we haven't caugth yet!\n. Thanks for the report! I messed this up in this commit. (operator() was called from there). Unsure if we should go back to how it originaly was (separate allocation and giving memory under its control) ...\n. I probably need the seperation once I implement the correct memory handling (scoping). At some point we may move items from an inner scope to the global scope. But I agree that it could be a normal method and doesn't have to overload the () operator (was there before my time).\n. Hope you don't mind but I've opted to leave it separated for now and merged the other fix to revert to as it was before my mistake. Not sure if you have seen https://github.com/sass/libsass/pull/1335 which implementes memory scoping. So memory handling is on the road-map, but I think there needs more base work to support it properly.\n. Already on it at https://github.com/sass/libsass/pull/1374, seems read was not made reentrant ...\n. No idea exactly, but considering we are a library, we have to support this anyway. IMO we only have this system call, so everything else should be ok.\n. Consider the implementor has sigalarm set, it will interrupt our syscall, but should we really fail or just continue? Maybe implementor only emits some status information ... well it seems the read fix is not enough, still getting Error 4 ...\n. I think I finally found and fixed the issue in https://github.com/mgreter/libsass/commit/6cc693c564de825e7a5ac94966d60c3dbeb5c6f6 ... I guess it was misleading me with the Error 4 first, the actual problem was a segfault:\n0   tester                              0x0000000101f560b1 segv_handler + 33\n1   libsystem_platform.dylib            0x00007fff93f705aa _sigtramp + 26\n2   ???                                 0x00007fb803c076d0 0x0 + 140428313654992\n3   libsass.0.dylib                     0x0000000101fe794f _ZN4Sass4Node9naiveTrimERS0_RNS_7ContextE + 751\n4   libsass.0.dylib                     0x0000000101f60dcb _ZN4Sass16Complex_Selector10unify_withEPS0_RNS_7ContextE + 1179\n5   libsass.0.dylib                     0x0000000101f62d89 _ZN4Sass13Selector_List10unify_withEPS0_RNS_7ContextE + 185\n6   libsass.0.dylib                     0x0000000101fd9aae _ZN4Sass9Functions14selector_unifyERNS_11EnvironmentIPNS_8AST_NodeEEES5_RNS_7ContextEPKcNS_11ParserStateEPNS_9BacktraceE + 190\n7   libsass.0.dylib                     0x0000000101f99281 _ZN4Sass4EvalclEPNS_13Function_CallE + 3009\n8   libsass.0.dylib                     0x0000000101fa3b5c _ZN4Sass6ExpandclEPNS_11DeclarationE + 60\n9   libsass.0.dylib                     0x0000000101fa2b9b _ZN4Sass6ExpandclEPNS_5BlockE + 587\n. Closing this since https://github.com/sass/libsass/pull/2222 has been merged. We now use a reference counted memory model, where objects get deleted once nobody keeps hold on to it. This allows for a flexible and elegant memory management, with dynamic life cycles.. IMO this could help understand the problem, but I repect your call!\n. Have seen this one already, IMO it only happens with circular extends ...\n. @chriseppstein maybe you have any pointers as to how the ordering works?\n. This is another interestingly similar issue:\nscss\n.thing[disabled] {\n    @extend .thing;\n    background: blue;\n}\nruby sass:\ncss\n.thing[disabled] {\n  background: blue; }\nlibsass:\ncss\n[disabled].thing {\n  background: blue; }\n. @xzyfer you pointed out that \"by @andybenedict in #1539 this can actually cause broken code when attribute selectors are involved.\" Can you provide an example of this? I agree with @chriseppstein that it should not make any difference!?\n. Thanks for the clarification, so it's basically a whitespace issue ...\n. Thanks for the clarification, so it's basically a whitespace issue ...\n. Closing as dart-sass also exhibits inconsistent order with extend and doesn't seem to care.. IMHO the original issue can be boiled down to\nscss\ndiv {\n  color: foo(0); /* foo(0) */\n  color: #{bar}(1); /* bar1 */\n  color: #{b}az(2); /* baz(2) */\n  color: b#{a}r(3); /* bar(3) */\n  color: #{b}a#{z}(4); /* baz4 */\n  color: #{b}a#{z} (5); /* baz 5 */\n}\nI guess the underlying reason is that an interpolation directly followed by a parenthese \"stops\" the parsing (seems like parentheses must be preceded by something identifier like). IMO it's related to the issues with \"list is always space delimited\". Not sure if ruby sass is correct here, but I think I start to see the pattern.\n. With #1474 it now renders to:\nscss\ndiv {\n  color: foo(0);\n  color: bar 1;\n  color: baz(2);\n  color: bar(3);\n  color: baz 4;\n  color: baz 5; }\nSo it still adds a space that is not needed!\nIMO this can now be closed in favor of #1396!\n. As I see it the only difference left is that we do not preserve line-feeds and spaces inside the list. Quite possible that there are other lists where we should preserve white-space!? Maybe want to close this and open a new one?\n. This might be fixed by https://github.com/sass/libsass/pull/1868 (partially, the issue in this ticket is ok)\n. Closing in favor of https://github.com/sass/libsass/issues/1596\n. The order for searched extensions is \".scss\", \".sass\", \".css\", ruby sass IMO has \".sass\", \".scss\" (css has to be enabled by some options I guess). Lookup order goes like this:\n- $file\n- _$file\n- _$file.$exts\n- $file.$exts\nLatest ruby sass (at least 3.4.15) will give an error if it finds multiple files that could be imported:\nError: It's not clear which file to import for '@import \"imp\"'.\n       Candidates:\n         imp.sass\n         imp.scss\n       Please delete or rename all but one of these files.\n        on line 1 of foo.sass\n. https://github.com/sass/libsass/pull/1341\n. Other than the extension order we do match the ruby behavior exactly AFAIK!?\nAnd latest ruby sass gives an error in that case (and the order is visible in that error) ...\nTo put it clear, ruby sass prefers sass even if original file is scss (from my testings)!\n. If we change to .sass beeing the default extension, we probably should also default to sass syntax for unknown extensions. That's all ...\n. Main use cases are passing now and will be in 3.3!\nLast minor issue is tracked in https://github.com/sass/libsass/issues/1526\n. I guess https://github.com/sass/libsass/pull/1475\n. There are a few use cases where we could profit a little from a streaming parser, but in most cases we need to keep a copy around anyway. This is mostly related to source-maps, since there is an option to even embed all inputs into the source-map. Even when we generate source-maps without embedding the inputs directly, we need to keep copies around for each identifier token (which could be optimized, so it would not use as much memory as keeping the whole input around and just use start and end pointers, as we do now).\nSo I don't think we will ever support this, also since we do not offer any C++ API. Although the CSS specs clearly state that you always know what to parse by looking at the \"next\" two bytes ...\nAs for encoding, C++ streams do not give encoding out of the box. They will give a nice interface, but you still need to some proper implementation like iconv. Once we are that far it is also not very hard to do the encoding/decoding on the in memory buffer.\n. I vote to close this, since we will probably never implement it. \n. From https://drafts.csswg.org/css-syntax-3/\n\nConsume as many hex digits as possible, but no more than 5. Note that this means 1-6 hex digits have been consumed in total. If the next input code point is whitespace, consume it as well.\n. Closing because there is not enough information here to proceed.\nPlease re-open once you can provide working sample code. Thank you!\n. IMO this was fixed by adding the directory as a target, so it gets created on demand without needing the -p flag, which is how this should be handled. Please re-open if you can reproduce with latest master.\n. @am11 are they overwritten/updated on consecutive compiles? If so we could leave them and add them to .gitignore. If they stay the same once they got generated, they should be cleaned up. Reason is that they should be updated if you add a commit and re-compile!\n. @am11 thanks for this nice addition, looks like more and more people are actually using MSVC since it has become freely available. I have only one minor nitpick with the documentation:\n\n- \"X:\\Program Files (x86)\\MSBuild\\12.0\\Bin\\MSBuild\" libsass\\win\\libsass.sln\n+ \"%programfiles(x86)%\\MSBuild\\12.0\\Bin\\MSBuild\" libsass\\win\\libsass.sln\nI guess this way the line would be better for copy & paste (since the progam folder may be named different on other locales than english) and I hope that people will understand what they need to change if they installed VS in another path (is that even possible?).\n. The actual problem was ARGR(\"$alpha\", Number, 0, 1)->value() IMHO. We need to check the returned value first (in this case ARGR does not seem to return anything).\n. Was just documenting what the actual culprit was, nothing you have to do!\n. Cannot reproduce on current master with mingw and perl-libsass!?\n. Maybe related to https://github.com/sass/libsass/pull/1462 ??\n. This is quite a special case since this is done during Function_Call evaluation. So the List never gets to the Output visitor, which would error in that case. Not sure how to solve this, but we should probably aim to return a function call from the eval step, with evaluated arguments, so output can do it's job. Tried this and it looks promising, but there were some other regressions.\n. Just checked and I see I implemented that error in Output, which worked for:\n$a: (());\nfoo {\n  foo: $a;\n}\nBut not for the originally reported case, so maybe it's worth creating two issues here ...\n. What's the status here?\n. I'm pretty sure this should be solved by a commit I made for cygwin quite some time ago (seems to be the same problem as reported with round not in std:: but in in the root :: namespace).\n. Any progress here? Not sure if it's worth to keep this open, as Solaris 9 had its EOL October 2014?. I can reproduce this issue and also confirm that #1462 fixes it. @hmoffatt can you compile from source and confirm? I will re-try once I re-base after the PRs got merged ...\n. mgreter:bugfix/msvc-memory-manager\n. > Yes that works for me.\n:+1: \n. As I explained, there would only be a way if we would \"abuse\" the same memory as the object occupies, but this is not guaranteed to work by any standards (it would rely on the fact that the first bytes are not zero after the object has been initialized, which should be true for virtual classes). The macro is IMO the safest way, since we need to be invoked as soon as the object is initialized, so we know when it is safe to call delete on it. I cannot think of any other way without performance penalty!\n. We need new to initialize the object (call the constructor) ... not sure how you want to ditch that? And yes, we may use the additional memory space to add in object memory reference counting at a later point.\n. We may want to use an actual custom allocator at a later stage, so keeping it that way we only need to change the actual implementation later. This PR fixes the problem at hand, so I'm happy with the current state. We can discuss shared_ptr and what not when we actually think about using them.\n. It fixes the issues seen with MSVC without changing anything else. This is what I see (shrug). It handles the memory correctly, without leaking if an error occurs after initial memory allocation, before the object is really constructed/initialized. It releases it via delete correctly afterwards.\n. There is no real micro memory management implemented yet. I guess there is now a basic foundation to get the next steps done (for example you can now pass a Memory_Manager reference in most places, where memory gets allocated, a few still take a Context, which is sometimes not available). So far we only use the Memory_Manager on the global Context object. So every AST_Node has a guaranteed life span as long as the Context is available.\nI can see that for normal AST_Nodes a tree may be well suited, but a Value may be assigned to the global variable scope, so it may should life longer than it's actual parent. Also Parameters are passed around very often and need to be available in the evaluation phase. So a refcounted implementation seems the most logic to me. But long story short, there is still a lot of heavy lifting to be done to properly support something like this. And btw. the real paint point are variable assignments, as a loop can easily chew up all the memory. I had a working experimental branch that released memory from assignments correctly, but that has become unmergable with latest master.\n. We will use custom allocators in the future! Having it there already means that the basics are already tested. Once we add micro memory management we can do various experiments to figure out what kind of allocator fits bests. A very easy optimization will be to keep a certain amount of memory container around for re-use. So I don't see the point to remove it now just to add it back later. I don't think it adds much overhead (if any at all).\n. rebased to master\n. BTW. it's very simple to update to the new macro:\nc++\n- new (ctx.mem) Class(x, y, ...);\n+ SASS_MEMORY_NEW(ctx.mem, Class, x, y, ...);\nI will keep rebasing ...\n. This change can be seen in action at http://libsass.ocbnet.ch/srcmap/\n\n. Something is missing then or went wrong along the way. Will check once everything else is merged!\n. OK, found the problem ... does now pass the spec locally!\n. IMO this can still be merged as it improves current behavior a lot and is only failing one last edge case.\n. Continued in https://github.com/sass/libsass/issues/1526\n. The error status has some meaning and there are different types, but for downstream it is not of much use. Basically it will tell you the type of error that occured inside the libsass process.\n- 1: normal errors like parsing or eval errors\n- 2: bad allocation error (memory error)\n- 3: \"untranslated\" c++ exception (throw std::exception)\n- 4: legacy? string exception (throw const char* or std::string)\n- 5: Some other unknown exception\n. This is fixed on master and will be in 3.3\n. Please checkout #1509 ... I think this should fix this issue!\n. This should be fixed by #1512\n. I guess we could just move it to utils?\nEdit: Does that fix the warning -> https://github.com/sass/libsass/pull/1511\n. Is this still a thing?\n. There were some changes under the hood to support urls better. Other than that everything should behave as before (perl-libsass unit tests also triggered and are now working again).\n. What is resolved_imports? That's not from libsass directly!? Are you sure you use abs_path and not imp_path? Can you reproduce with a plain C sample!?\n. You're case should be covered now. Please open new bugs if I broke anything else!\n. This is by design and I would argue that it doesn't make much sense to include them there (it is included in the source-maps though, as you can see when you enable \"Custom Header Test\" in srcmap inspector). I guess @import statements in the header should be included but not the headers themselve. Most implementors use IMO that array to get info which files they need to watch and headers should be generated by code, so they cannot be watched. If they actually can, you should probably just use an import (either in the headers or in the main source file). Does that make sense?\n. Hopefully this time ... and we urgently need some way to have these unit tested, otherwise it's nearly impossible to refactor this kind of thing!\n. https://github.com/sass/libsass/pull/1510\n. Can you please try https://github.com/sass/libsass/pull/1515\n. Yes, source-mapping was slightly updated and improved ...\n. Have you tried my source-map inspector? With it I was able to confirm the validity in 1 minute :ambulance: \n. > Wow, The inspector is super helpful! :100:\nYeah, I needed something that works, otherwise source-maps are nearly undebugable ...\nAs it turns out it's also helpfull debugging the different options on the C-API (added this moment) ...\nCan you give a short confirmation in https://github.com/sass/libsass/pull/1515 so it can be merged? Thanks!\n. @saper have you tried \"[Analyze]\". The whole UI and functionality is just hacked together, so from this point I would need to refactor it quite a bit to add more features. Also the UI is very much static and not that easy to change from this point on (it's really just a POC), but I may be able to hack some more specific js together to close the left panel ...\n. It should analyze the output, so you should be able to paste your own results into the output textarea.\n=> http://libsass.ocbnet.ch/srcmap/about.html\n\nPaste some \"Output\" yourself (make sure it has sources embedded)!\nHit the \"Analyze\" link and everything should be setup to start the inspection!\n. Also added the epsilon test for number values, so the other sample should now also work. As I said, there are probably more edge cases like this, but this should at least fix the most important ones.\n. Not sure if it is really that unreasonable for libsass to produce debug output when DEBUG compile flag is set. Each implementer that compiles libsass can set that option accordingly if desired. So I feel it's ok the way it is now, although a more sophisticated debug interface would be desirable (PR always welcome, but as such not a high prio).\n\nI added this to the wish-list ticket, since I think this issue is actually more about a better and more configurable debug build itself. Currently the DEBUG flag only really debugs the extend step and nothing else ...\n. I guess it's related and it was unknown to me we already had something for starters in debug.hpp. But I'm still pretty sure this is only used in extend step, so only covers a small bit of what can be debugged (I mostly use debugger.hpp for \"on demand\" debugging).\n. I can confirm that this segfaults. Fix seems simple as we just need to error when we extend '&'\nCan't extend &: can't extend parent selectors\n@bassplayer7 thanks for the report! I just don't understand why quite a few people actually like to post pictures of code instead of just pasting the code (it keeps us from transcribing the test case) :confused: \nscss\nfoo {\n  @extend &;\n}\n. Not sure if you expect this to compile, but ruby sass gives this error (and libsass segfaults):\nError: Can't extend &: can't extend parent selectors\n        on line 9 of foo.scss\n  Use --trace for backtrace.\nSo we need add this check to libsass, but the given code is not valid sass ...\n. Ah, I guess I got you now. The error seems to repeat what you tried to extend. Ie. @extend &.xyz will lead to Can't extend &.xyz.\n. Fix was merged and will be in 3.3\n. Can you resolve the conflicts? Otherwise LGTM!\n. This is fixed in latest master and will be in 3.3.\n. Is there a \"definition of done\" for this Bug? I didn't see this warning so far myself? Maybe you could give some more information of used compiler and environment?\n. We don't see this on the Travis Mac OSX CI build and I don't have access or connection to any Mac, so someone else needs to step in here to analyze this further ...\n. Fixed in https://github.com/sass/libsass/pull/1707\n. This should be covered by https://github.com/sass/libsass/pull/1527\n. This should be fixed on master for release 3.3.3.\n. Errors have never been exactly like ruby sass. I only lately added a similar error reporting than ruby sass, so I guess this error just hasn't been upgraded, or did it say anything else before!?\n. I cannot reproduce with perl-libsass, my spec tests with custom importer didn't show any regression!\nCan you provide a sampe that shows the behavior? Also custom url importer sill works in source-map inspector, so I cannot see that the importers are not called as you said!\n. Not sure when I get around to look into it. If you could provide another standalone C example it would greatly help me to get a fix faster, as I will have to produce a test case for myself too. IMHO it is not a release-blocker since the feature in question is still marked experimental.\n. https://github.com/sass/libsass/wiki/API-Sass-Importer-Example (slightly out of date)\n. Thanks for the sample. Should be fixed with https://github.com/sass/libsass/pull/1533\n. This is fixed in latest master and will be in 3.3\n. Cannot reproduce on latest master !?\n. Added another small commit that fixes https://github.com/sass/libsass/issues/1271\n. And another commit added that fixes #1231\n. Cannot reproduce on latest master!\n. Closing this as this will be fixed in upcoming 3.3 release!\n. @mknadler your findings are pretty much spot on, but actually libsass seems allow lists as keys.\n. I opened an issue with ruby sass, since I think this is inconsistent and libsass does the right thing.\n. We already install libsass.so (linked as -lsass), so IMO we've already taken up that name ...\n. I get the same results for the following sample in ruby sass and latest master!?\n``` scss\n.foo{\n  &[disabled]{\n    display: none;\n  }\n}\n.bar {\n  @extend .foo;\n}\n```\n. @xzyfer can you please re-check? IMHO this is invalid or upstream bug, as ruby sass never produces:\ncss\n.foo.disabled, .bar.disabled {\n  display: none;\n}\n. Had to do some research concerning the claim that the following is invalid CSS\ncss\n.foo[disabled], [disabled].bar {\n  display: none;\n}\n\nA simple selector is either a type selector or universal selector followed immediately by zero or more attribute selectors, ID selectors, or pseudo-classes, in any order. 1\n\nIf one looks further down, we can see 5.8 Attribute selectors and 5.8.3 Class selectors, indicating they are equal. With these two statements it's pretty clear that the above is valid css.\n. Closing this as resolved! Thanks!\n. I have ammended your commit slightly and commited it to master directly after a Travis-CI run!\n. It's a false positive with -Wextra: https://gcc.gnu.org/bugzilla/show_bug.cgi?id=36750\nWe could probably silence it by saying Lookahead rv = Lookahead(); ...\n. See comments further below ... it also happens for c++11 and struct x = { } yields the same warning for me (and apparently for others too). I only can silence it with https://github.com/mgreter/libsass/commit/69d87100fd7bc1b8c807a4e86fe20529089c03b6 (https://github.com/sass/libsass/pull/1542)\n. Nope, everything else I try will still print that warning:\nlibsass\\src\\parser.cpp: In member function 'Lookahead Sass::Parser::lookahead_for_value(const char*)':\nlibsass\\src\\parser.cpp:2281:21: warning: missing initializer for member 'Lookahead::found' [-Wmissing-field-initializers]\n     Lookahead rv = {};\n                     ^\nlibsass\\src\\parser.cpp:2281:21: warning: missing initializer for member 'Lookahead::error' [-Wmissing-field-initializers]\nlibsass\\src\\parser.cpp:2281:21: warning: missing initializer for member 'Lookahead::position' [-Wmissing-field-initializers]\nlibsass\\src\\parser.cpp:2281:21: warning: missing initializer for member 'Lookahead::parsable' [-Wmissing-field-initializers]\nlibsass\\src\\parser.cpp:2281:21: warning: missing initializer for member 'Lookahead::has_interpolants' [-Wmissing-field-initializers]\nor\nlibsass\\src\\parser.cpp: In member function 'Lookahead Sass::Parser::lookahead_for_include(const char*)':\nlibsass\\src\\parser.cpp:2262:19: error: missing initializer for member 'Lookahead::found' [-Werror=missing-field-initializers]\n     Lookahead rv {};\n                   ^\nlibsass\\src\\parser.cpp:2262:19: error: missing initializer for member 'Lookahead::error' [-Werror=missing-field-initializers]\nlibsass\\src\\parser.cpp:2262:19: error: missing initializer for member 'Lookahead::position' [-Werror=missing-field-initializers]\nlibsass\\src\\parser.cpp:2262:19: error: missing initializer for member 'Lookahead::parsable' [-Werror=missing-field-initializers]\nlibsass\\src\\parser.cpp:2262:19: error: missing initializer for member 'Lookahead::has_interpolants' [-Werror=missing-field-initializers]\n. #1542 merged and we could compile with -Wextra -Wno-unused-parameter now ...\n. I may find more stuff once I get around to add more unit tests to perl-libsass. Otherwise this is good to go!\n. Can you create a PR also for https://github.com/mgreter/sass2scss?\n. yes, I think it is!\n. @akhleung I see the point, but the same also applies for long running processes that repeatedly create new contexts. I vote to bite this bullet since we do not add new functions very often, it is still not overly complex and this now really is the lowest hanging fruit to further improve performance. We still need to \"old\" prototype string for error reporting. We might could improve readability by using macros to declare the parameters, but I really would like to move this from runtime to compile time!\nAnd as I said, the old way is still available, so if you have existing code relying on this, it should still work (I think I removed to old register_function prototype, but you simply can pass 0 for Parameters).\n. Another compelling reason for me to do this: currently it's harder than needed to debug the parser. One can not just add print statements to the parser functions, since it will not only be invoked for the code you try to debug, but also to parse the prototypes of these functions. So you end up with way too much output and you either have to implement another guard (not hard, but I already did this about 5 times the last month, so I keep doing this over and over). So this would actually have helped me to speed up my development, despite adding a little bit of complexity. The code also didn't change a bit since then.\n. I voice strongly for including this. I have not seen any hard evidence for the claimed problems. I can work easily with it, it's optional, doesn't really change anyway (code is pretty much static for months or years now) and has lots of cases, so it should be easy to setup new functions once needed (and to repeat, old way is still there, so completely optional).\nIt's help me when debugging parser and brings some small performance benefits!\n. I'm going to make this call here and will merge this after the next release is made. @xzyfer I guess you may want to make 3.3.7 before releasing node-sass? I also want to split functions.cpp into multiple compile units, therefore I want to base that on the changes from here. Sorry that I could not convince you guys of the benefits, but I don't feel that the \"redundancy\" is a problem or lines of code per se.\nAnd I just lost too much time during last work on parser due to this!\n. I will put this simple. If you guys would contribute more actual code to libsass it would be easier for me to accept your opinions here. But since I'm pretty much the only guy doing the heavy lifting on the code base for 3 years now (ok, I need to except @xzyfer here, since he does occasionally contribute bigger amounts of code).\nThe parsing of prototypes with internal parser on runtime hasn't tripped my workflow off for the first time. This would solve the issue I as a developer have from time to time. I agree it's not a very elegant solution, but it does work and nobody has to worry about it, as it just works (its dead simple). This is frankly one of the topics I sometimes wonder why I'm even putting in the hours I do!\n. Pretty sure this is related to 32 vs 64 bit builds and rounding behavior! => https://github.com/sass/libsass/pull/1621\n. @xzyfer didn't find any spec test in the sass-spec repo, although you added the test written tag?\n. Specs in issue_1093\\argument\\function already have been merged! Another one that got missed because it doesn't have a designated spec test in libsass-(todo|closed)-issues.\n. Thanks for the report, can confirm this is a regression!\nI guess we need to differ between comma and space separated lists when handling arglists.\n. More complete test case:\nscss\n/* any */@media/* first */\n/* screen */screen /*something */ , /* else */\n/* not */not/* print */print /* final */ {  /* whatever */\n    body { line-height: 1.2 }\n}\n. @xzyfer yep: https://github.com/mgreter/sass2scss/commit/ff1b819f535419f510a957036d784b4847852acb\n. This looks like a ruby sass bug to me!?\nOtherwise this should at least yield the same!?\nscss\nfoo, bar {\n  string: inspect(nth(&, 1));\n  length: str-length(inspect(nth(&, 1)));\n}\ncss\nfoo, bar {\n  string: foo;\n  length: 3; }\n//CC @chriseppstein \n. ~~Further investigation show that this is only happening with selector_lists and not with regular lists.~~\n~~That's why I'm not sure if that really makes sense or simply an oversight in ruby sass?~~\nscss\n$ls: ((foo,));\nfoo {\n  baz: length($ls);\n  baz: type-of($ls);\n  baz: inspect($ls);\n}\nbar {\n  baz: length(&);\n  baz: type-of(&);\n  baz: inspect(&);\n}\nResults in\n``` css\nfoo {\n  baz: 1;\n  baz: list;\n  baz: (foo,); }\nbar {\n  baz: 1;\n  baz: list;\n  baz: (bar,); }\n```\nI guess with https://github.com/sass/libsass/pull/1858 this should be easy now (I suspect to_sass to be at work, since I already verified that ruby sass uses to_sass for the inspect function and not inspect, who would have thought).\n. Confirmed that with #1858 this is pretty easy to implement.\n. @xzyfer can you post a WIP branch for this?\n. I cherry picked this in https://github.com/sass/libsass/pull/1609. Thanks for your contribution @unmole!\n. Just retested and latest ruby sass seems to give:\na {\n  b: url(data:image/png;base64,iVI=);\n}\nSo this might be fixed already!?\n. @xzyfer this is marked need test? Can you produce those?\n. Scoping this to 3.3.3 as I think this has been fixed?\n. OK, that is not fixed yet, rescoping again. Since you seem to know the use cases, can you add a spec test for this?\n. Closing in favor of https://github.com/sass/libsass/pull/1626\n. Doesn't pass for me with ruby sass 3.4.18 (windows):\n```\nsass test.scss\nError: expect query to have a length of 4\n        on line 5 of test.scss, in assert'\n        from line 10 of test.scss, inmedia'\n        from line 13 of test.scss\n  Use --trace for backtrace.\nsass -v\nSass 3.4.18 (Selective Steve)\n```\n. This seems related to https://github.com/sass/libsass/issues/1733\n. @xzyfer can we close this one? IMO libsass is more correct/consistent than ruby sass!?. Just needed to restart appveyor. Can you wait until I've run my extended regression tests with perl-libsass (like memory leak tests etc). Will report back in a few ticks ...\n. OK, no memory leak found, plugins and custom functions seem to work :rocket: :roller_coaster: \n. This is fixed in latest beta and will be in 3.3.0!\n. This is already fixed in latest libsass beta!\n. This now needs https://github.com/sass/sass-spec/pull/555 to pass!\nLibsass now passes the specs for x86 and x64 builds (it failed on x86)!\nI checked by using cygwin32 and cygwin64, will now check mingw32 and mingw64!\n. It seems to fix the discrepancy between latest ruby sass and libsass ...\nThis is what I was observing on mingw32 and cygwin32:\nC\ndouble r = ...\nstd::cerr << r << \"\\n\"; => 25.5\nstd::cerr << round(r) << \"\\n\"; => 25\nSo using the double did not work correctly anyway ...\n. Btw. I'm currently debugging libsass through the perl test matrix:\nhttp://matrix.cpantesters.org/?dist=CSS-Sass%203.3.0_02\nThis clearly indicates we currently have a problem on 32bit.\nWill publish a beta release today to see if things improve with this.\nTested MinGW32 and MinGW64 and they both pass also now!\n. The problem is about rounding, not comparing numbers !? :confused: \n. Nope, they go through the hsla conversion, which uses double\n. Sorry, thought you meant float explicitly ...\n. Results should gradually come in over the next few days:\nhttp://matrix.cpantesters.org/?dist=CSS-Sass%203.3.0_03\nHere a previously failing example that I expect to be fixed by this:\nhttp://www.cpantesters.org/cpan/report/78876e2f-6bfa-1014-b462-4afa105bbce2\n. Actually the real fix on the ruby side seems to be https://github.com/sass/sass/commit/4e3e1d5684cc29073a507578fc977434ff488c93.\nSo feel free to add to this PR to implement it the same way.\nSeems like truncating it to a float was enough to pass the specs.\nLooks like we could just add/subtract 0.00001 before passing it through round.\n. Made some more tests and indeed ruby sass uses some IMHO strange rounding magic:\ncss\nfoo {\n  pos-1: round(0.500001);\n  pos-2: round(0.50001);\n  pos-3: round(0.49999);\n  pos-4: round(0.499999);\n  neg-1: round(-0.500001);\n  neg-2: round(-0.50001);\n  neg-3: round(-0.49999);\n  neg-4: round(-0.499999);\n}\nSass 3.4.19 yields:\ncss\nfoo {\n  pos-1: 1;\n  pos-2: 1;\n  pos-3: 0;\n  pos-4: 1;\n  neg-1: 0;\n  neg-2: 0;\n  neg-3: 0;\n  neg-4: 0;\n}\nThis PR IMHO correctly yields:\ncss\nout: foo {\n  pos-1: 1;\n  pos-2: 1;\n  pos-3: 0;\n  pos-4: 0;\n  neg-1: -1;\n  neg-2: -1;\n  neg-3: 0;\n  neg-4: 0;\n}\nI guess with 3.4.20 (https://github.com/sass/sass/commit/4e3e1d5684cc29073a507578fc977434ff488c93) the negative side will be fixed. Anyway, it feels like this epsilon should at least consider the precision set in the options?\n. OK, seems easy enough to get what ruby sass does:\nc\nif (val < 0) val -= std::pow(0.1, 6);\nelse if (val) val += std::pow(0.1, 6);\nreturn ::round(val);\nNot sure why ruby sass does it the way as seen in https://github.com/sass/sass/commit/4e3e1d5684cc29073a507578fc977434ff488c93, but this should IMO give the same results:\ncss\nout: foo {\n  pos-1: 1;\n  pos-2: 1;\n  pos-3: 0;\n  pos-4: 1;\n  neg-1: -1;\n  neg-2: -1;\n  neg-3: 0;\n  neg-4: -1;\n}\n. @xzyfer I have simplified the handling of custom spec test runs with CI. Also added the same logic to appveyor. I also made the epsilon respect the precision option. IMO this is ready to be merged!\n. IMO this is quite important since we currently fail the specs for 32bit builds\n. It does fail reliably for me on 32bit and Travis / Appveyor only provide 64bit envs as far as I know.\n. This should now pass with specs set at 4.9.16! Didn't yet try to go higher, can be done later.\nhttps://github.com/mgreter/sass-spec/commit/4795e4348d3b10458cea2d0048a65d439dc24c8c\n. I was able to get it to compile with gcc 4.4.2, so it seems it had proper support for variadic templates. Tested it via various old strawberry perl portable installs for windows (which come with different gcc toolchains). Might be that I use different cflags on the perl-libsass install, because I think this posed a problem when I tried some time ago.\nFor documentation here how I compile in the perl portableshell:\ncmd\ngit clone http://www.github.com/sass/perl-libsass --branch=latest\ncd perl-libsass\ncpan . # only needed once for deps\nperl Makefile.PL\ndmake -P9 test\n. I have rebased this to latest master and fixed the remaining issue with mac clang. I pretty much would like to get this merged, as it would allow perl-libsass to autodetect this and apply the last \"patch\" in form of the script in the second commit to the source tree. To get the git tree 4.4 compatible, we would need to get rid of all for(auto el : container) loops, and I actually like that feature a lot. So for me an automated way to \"unroll\" these loops is good enough. \n@ArcticSnowman would that be good enough to support your use case? It does add the dependency on the perl script, but perl should be widely available or you can always generate the gcc 4.4 compatible source tree somewhere else and transfer it (or generate a patch to apply).\nSince the proof is in the pudding (libsass via strawberry perl and gcc 4.4.3 on windows):\n``` cmd\nmkdir libsass-gcc-4.4\ncd libsass-gcc-4.4\nwget -c http://strawberryperl.com/download/5.12.3.0/strawberry-perl-5.12.3.0-portable.zip\nmkdir perl\ncd perl\nunzip ..\\strawberry-perl-5.12.3.0-portable.zip\nportableshell.bat\ngit clone https://github.com/sass/perl-libsass.git\ncd perl-libsass\ngit submodule update --init\ncd libsass\ngit remote add mgreter https://github.com/mgreter/libsass.git\ngit fetch mgreter\ngit checkout -b compat/gcc-4.4 mgreter/compat/gcc-4.4\nperl script\\replace-range-for-loops.pl\ncd ..\nperl -MCPAN -e \"CPAN::Shell->notest('install', 'ExtUtils::CppGuess')\"\nperl -MCPAN -e \"CPAN::Shell->notest('install', 'Test::Differences')\"\nperl -MCPAN -e \"CPAN::Shell->notest('install', 'Encode::Locale')\"\ngcc -v\ncpan .\n``\n. IMO any code change may add something gcc 4.4 incompatible (I did so with ltrim/rtrim). I guess there are always chances we need to fix up these incompatibilites at a later stage, and I don't see the short for loops as an exclusion here. And as a developer I really would like to keep the convenience.\n. I'm regularly releasing [perl-libsass][1] with [gcc 4.4 support][4]. The [archive][2] contains gcc 4.4 compatible [libsass sources][3] (this branch with unrolled for loops). On compatible systems it should also automatically compile and install sassc plus libsass plugins. Unfortunately I wasn't able to convince other libsass maintainers to get this merged into master (see their comments/reasoning above), but you could try to apply the patches in this branch on any implementation (i.e. node-sass). Then you only need to executeperl script\\replace-range-for-loops.pl` (see example in one of my earlier comment) and compile/install the given implementation.\n4: http://matrix.cpantesters.org/?dist=CSS-Sass%203.3.6. This is pretty much ready, but could use some more testing. My poor memory leak tests seem to indicate that everything is freed as needed. There is room for more improvements though.\n. Just to repeat how to access the import stack during custom functions now:\nc++\nunion Sass_Value* call_sass_function(const union Sass_Value* s_args, Sass_Function_Entry cb, struct Sass_Compiler* compiler)\n{\n  struct Sass_Import* import = sass_compiler_get_last_import(compiler);\n  const char* prev_abs_path = sass_import_get_abs_path(import);\n  const char* prev_imp_path = sass_import_get_imp_path(import);\n  ...\n}\n. //CC @xzyfer @chriseppstein to fix eyeglass import once issue\n. Will do, actually the main commit is https://github.com/mgreter/libsass/commit/1a68364ea703b1152f5303efa64ac6e541bab46d which is still rather big.\n. There is nothing to update in docs for this PR??\nBTW. the wiki should be disabled now I guess ...\n. Disabled the wiki, since info is outdated and master is now in libsass repo ... maybe we could use git 2.6 subtree feature to get wiki visibility on github back ... still think submoduling gh-pages would also work.\n. Rebased, but will probably result in merge conflicts with the other \"rounding\" PR ...\n. @xzyfer IMO rouding PR is quite important since we currently fail the spec tests when compiled for 32bit.\n. Headers were move to sass subfolder, so change sass_context.h to sass/context.h (and other sass headers accordingly). You may also need to give the proper include paths to compile, since they are no longer in the same folder as the source files. The master docs are now included in the main git repo.\nBtw. sass/interface.h is no longer supported and you should upgrade it to use the new API!\n. Already done in https://github.com/sass/libsass/pull/1639\n. I was pretty sure that last time I debugged a similar issue (#1566), I got pretty convinced that we need to differ between comma separated lists and space separated lists. https://github.com/sass/libsass/issues/1566#issuecomment-142018092\n. yep, saw it too, thought nobody had seen it yet, already removed it ... need to do more tests.\n. @mirisuzanne could you please create a separate issue and if possible a spec test. Looking at the code and inspecting the AST I believe this specific case has never worked in any previous libsass versions. Thanks.. Do I understand correctly, that #{#{'\\\"\\'\\\"foo\\\"\\'\\\"'}} should result in '\"foo\"' then? Doesn't seem to be the case (I get \"'\\\"foo\\\"'\")? AFAIR I implemented it so only interpolations into declarations do unquotes? I tried to understand these rules many times, but still fail the see the overall logic (specially with nested interpolations). Unquoting interpolations always doesn't seem right in all situations either.\nAt least the example you gave seems to work correctly :confused: ??\ncss\n@foo directive {\n  .foo {\n    foo-prop: foo-val; } }\n. OK, this perfectly matches the is_quoted member of Quoted_String in libsass then. This probably explains why in this given sample, b-itpl is not being unquoted ... but I still don't see the issue at hand in this ticket? I get the same results from libsass as you posted?\n. Yep, we are aware of that! And thanks for the background info on quote/unquote, that was new to me and also a bit counter intuitive IMO!\n. All specs have been activated so it looks like this is passing!\nIf not please re-open and provide clear info what is still missing! \n. Spec tests added by @mgreter: https://github.com/sass/sass-spec/pull/573\n. OK, this is pretty odd.\nscss\n:nth-of-type(2n-1),\n:nth-of-type(2n-  1),\n:nth-of-type(2n  -1),\n:nth-of-type(2n  -  1),\n:nth-of-type( 2n  -  1 )\n{ color: red; }\n:nth-of-type(2n+1),\n:nth-of-type(2n+  1),\n:nth-of-type(2n  +1),\n:nth-of-type(2n  +  1),\n:nth-of-type( 2n  +  1 )\n{ color: red; }\nIn compressed mode this produces:\n``` scss\n:nth-of-type(2n-1),\n:nth-of-type(2n-  1),\n:nth-of-type(2n  -1),\n:nth-of-type(2n  -  1),\n:nth-of-type(2n  -  1)\n{color:red}\n:nth-of-type(2n+1),\n:nth-of-type(2n+1),\n:nth-of-type(2n+1),\n:nth-of-type(2n+1),\n:nth-of-type(2n+1)\n{color:red}\n```\nMy current fix which gets it parsed correctly outputs:\n``` scss\n:nth-of-type(2n-1),\n:nth-of-type(2n-1),\n:nth-of-type(2n-1),\n:nth-of-type(2n-1),\n:nth-of-type(2n-1)\n{color:red}\n:nth-of-type(2n+1),\n:nth-of-type(2n+1),\n:nth-of-type(2n+1),\n:nth-of-type(2n+1),\n:nth-of-type(2n+1)\n{color:red}\n```\nNo idea why ruby sass does not apply the same logic here. Looks like a bug to me ...\n. @chriseppstein thanks for the confirmation, I guess it's a one byte fix on the ruby side ...\n. This should be fixed on master for release 3.3.3.\n. Looks like we never really supported without syntax correctly. I personaly see it the first time ...\n. Related to https://github.com/sass/libsass/issues/2444 and https://github.com/sass/libsass/issues/1890. Ruby sass bug confirmed: https://github.com/sass/sass/issues/1874\n. This looks like a ruby sass bug to me, please see this sample:\n``` scss\n%foo {\n  border: none;\n  &bar {\n    display: block;\n  }\n  &.bar {\n    display: block;\n  }\n}\n.zoo {\n  @extend %foo;\n  &baz {\n    display: block;\n  }\n  &.baz {\n    display: block;\n  }\n}\n```\nResults in ruby sass to:\n``` css\n.zoo {\n  border: none; }\n  .bar.zoo {\n    display: block; }\n.zoobaz {\n  display: block; }\n.zoo.baz {\n  display: block; }\n```\nFrom the semantics I don't see why libsass should be wrong here?\n//CC @nex3 @chriseppstein \n. What's the reason for having ...\ncss\n  &__bar {\n    display: block;\n  }\n... when it is never output? I mean you seem to expect it to be never output?\nAlso you did not post anything with &-- in your sample, so not sure how that's relevant.\nThe ruby sass behavior is definitely not consistent, so I consider it a bug on their side ATM.\nLets see if anyone from their side can give some insight here ...\n. As you can see in my sample posted above, the \"prefix\" doesn't matter at all.\n. You all see that ruby sass is not consistent between extend, regular parent, type selector and class selector? @xzyfer from the quoted docs I don't see why in the sample above &__bar should be hidden? And as one can see it is shown when inside a \"regular\" ruleset. Also note that this interestingly changes when you use a class selectors (which is the bug I suspect to be on ruby side).\n. Not really, why does it work different for &.bar and &bar? And why is it only different for @at-root cases and not for regular rulesets?\n. OK, I think I need to repeat my sample from above, since I'm not sure you see the difference!?\nscss\n.zoo {\n  &baz {\n    display: block;\n  }\n  &.baz {\n    display: block;\n  }\n}\ncss\n.zoobaz {\n  display: block; }\n.zoo.baz {\n  display: block; }\nvs.\nscss\n%foo {\n  &bar {\n    display: block;\n  }\n  &.bar {\n    display: block;\n  }\n}\nzoo {\n  @extend %foo;\n}\ncss\nzoo.bar {\n  display: block;\n}\nThis doesn't seem consistent!?\n. I think I get it now, so %foo is actually a selector in ruby sass. Too bad, this seems to be handled completely different in libsass. This will probably mean a complete refactor of how we do @extend. So what you are saying is: ruby sass resolved it to: %foobar, which is not found, while %foo.bar is.\n@xzyfer AFAIK you made that implementation. Any thoughts on that one?\n. IMO that's pretty funky and not as I intuitively expected it to be. I always thought of it like \"add the optional placeholder postfix and the block where the @extend happens\". Didn't think the placeholder block would be \"parentized\" in its own context first. Here another test case:\nscss\n%foo {\n  &bar {\n    display: inner;\n  }\n  &.bar {\n    display: outer;\n  }\n}\nzoo {\n  @extend %foobar;\n}\nRuby Sass result:\ncss\nzoo {\n  display: inner; }\n. The actual reason is that we parentize selectors after the evaluation step. Ruby sass seems to do it before, but I still try to get together more spec test, so we don't implement it wrongly again. I wonder why this sample does not give any errors nor can I figure out what the correct extend name should be:\nmoo {\n  &%foo {\n    &bar {\n      display: inner;\n    }\n    &.bar {\n      display: outer;\n    }\n  }\n}\nzoo {\n  &foo {\n    @extend %moofoobar;\n  }\n}\n@chriseppstein any suggestions if this should be extendable at all or if it should error?\n. OK, got some something:\nscss\nmoo {\n  &%foo {\n    &bar {\n      display: inner;\n    }\n    &.bar {\n      display: outer;\n    }\n  }\n}\nzoo {\n  &foo {\n    @extend moo%foobar;\n  }\n}\nresults in \ncss\nzoofoo {\n  display: inner; }\nIs this the expected behavior? Still not very intuitive IMHO!\n. I think the wording is a bit misleading. We only allow imports of css partials (stuff ending with .css will left as an actual import in the code). Also Ruby Sass does not allow this by default, but a few tools (AFAIK compass too) enable this by default for Ruby Sass. I'm also not sure if we really want to disable it by default, since this would be another potentially breaking change.\nclass CSSImporter < Sass::Importers::Filesystem\n  def extensions\n    super.merge('css' => :scss)\n  end\nend\nSass::Plugin.options[:filesystem_importer] = CSSImporter\n. I guess it's clear that I'm in favor of having this feature and just wanted to point out that the breakage is mainly only because I've implemented the error message for ambigous imports for libsass 3.3.0. Beside that we only differ by default in partial resolving (also includeing css extension), and I would argue that normally you don't generate or have a css with the same name beside a partial import. Unsure when I will come around to implement that as an option on the C-API. Contributers welcome ;)\n. We don't have any nullptr left-over? What's the definition of done for this issue?\n. LGTM :+1: \n. IMO we should refactor to make Has_Block directly inherit from Block (basically replacing class AST_XY : public Has_Block to class AST_XY : public Block. Reason for this is that we currently cannot push At_Root_Blocks etc. to the import_stack. Therefore we loose some information when later querying the current block context. But I guess this will introduce difficulties for cssize.\n. @xzyfer: waiting for your parser refactor before I'll start tackling this. Probably needs another major refactoring, since my first naive try to do this was shorty stopped by some complications in cssize!\n. First debug indicates that we don't update the hashed-key-value for the number somewhere.\n. Closing this as we should only differ in the error message text now.\nThere are currently more important error messages that we should get right first.\n. @xzyfer IMHO 0.00001 means that it has an epsilon for precision of 5 and should be different for other precision options. IMHO this is a ruby sass bug ... (//CC @chriseppstein)\n. https://github.com/sass/sass/issues/1883\n. @xzyfer you are aware that this token gives write access to the repo!?\n. https://github.com/afragen/github-updater/issues/109 and https://developer.github.com/v3/oauth/#scopes\nrepo: Grants read/write access to code, commit statuses, collaborators, and deployment statuses for public and private repositories and organizations.\n. I didn't try, and I don't know how you set it up exactly. But I was under the impression they are pretty much all read/write ... https://help.github.com/articles/creating-an-access-token-for-command-line-use/: Remember to keep your tokens secret; treat them just like passwords! They act on your behalf when interacting with the API. Don't hardcode them into your programs. Instead, opt to use them as environment variables.\n. I'm restarting my server, so the fallback proxy should work in a few ticks ... unfortunately embedded libsass process brings it down from time to time, trying to track the reason for that for quite some time.\n. Feel free to set something up! My proxy is a perl psgi application and I can share that code if you need. For now it is at least another possibility before failing anyway. And the down-times should not happen, but one thing after another (currently it seems to happen once in about two weeks).\n. Any ETA when this will be ready to be merged?\n. Is this fixed? I wonder because the spec test seems to be active (I get a fail in https://github.com/sass/libsass/pull/1736). But strange enough CI for master seems ok even if I restart it. I also get this problem locally!?\n. IMO this should be closed since no longer relevant (last IE version to support filters was IE9). IMO there is no merit to support this in future version of libsass. Feel free to re-open if you see it otherwise. //CC @xzyfer.. So far I have advised implementors to use sass2scss themselve for that situation (available via C-API).\n. I do agree on the overall case that an option would be nice. But you could add this option already to node-sass API and just convert the data from sass to scss in the custom importer bridge, if you know you have indented sass syntax. Just saying that it's already possible for implementors to do it.\n. Ruby sass seems to do it pretty much the same way as we do it (just checked). For ruby sass the importer has to instantiate the correct parser engine, so it does decide if the content has to be treated as indented syntax or not. I have previousely advised implementors to use sass2scss on their own. We could add an option like ruby sass to do the conversion internally, but it will not really change the logical position where that decision is made, so from a logical standpoint, it works the same! So IMHO this is really just a convenience option!\n. This seems to work as expected on latest ruby sass and libsass master!\n. Please include at least the versions you are using. I cannot reproduce the original report, I just get Undefined variable: \"$candy-blue\" and I also cannot reproduce the second one by @randallmeeker with latest ruby sass (3.4.19). Please provide self-contained examples, so we can actually reproduce the same results!? Please re-open if you can re-produce with latest versions!\n. Please always include at least the version you are using!\nClosing this since I cannot reproduce it on latest master.\n. That produces File to import not found or unreadable: foo ...\n. Works again as expected IMHO: https://coveralls.io/jobs/9510294. Guess you did fix it!\n. As confirmed by ruby sass dev team, this was a bug. Not sure why we should withold a bugfix that doesn't affect our spec tests! We have a lot of other edges that are not 100% compatible with ruby sass output. It does not break existing spec tests, so for me this is ready to be merged!\nAs for the tests, we currently don't support tests with custom (precision) options!\n. Yes it is.\n. Started some initial progress, but fixing all different cases will take a bit longer.\nMy WIP 3.4 branch currently yields (had to reduce seconds args to numbers)\ncss\n.test {\n  a: calc(1px * 1);\n  b: custom;\n  c: calc(9px); }\n. Do you know with which version it was still working as intended? Maybe you would be able to do a git bisect to find the commit that breaks it for you?\n. Thanks for the info @rodneyrehm. You don't need to test \"each\" commit with bisect, that's actually the trick of bisect. It will basically do a \"binary search\" for the bad commit, but yes, you need to compile and test it for every bisect step and then tell git if the result was \"good\" or \"bad\". If you never have done it I recommend to give it a try, pretty usefull feature one should know :stuck_out_tongue_winking_eye:\n. I'm pretty sure this was fixed and I haven't seen anything similar. Please re-open if problem persists.\n. This can be simplified to:\nscss\n$qwe: transition;\n$prefix: '-webkit-';\n$prefixed: #{$prefix}$qwe,;\nfoo { bar: $prefixed; }\n. @sheinzle that is a different bug and has already been fixed.\n. /*! This is an important comment, never removed by sass */\n. Is this still needed with latest master?\nI checked with MSVC 2013 community!\n. Closing this since I can compile master with MSVC 2013. Plase re-open otherwise!\n. This was one of the major fixes in the milestone 3.4 branch and I've added a pretty extensive test suite to back up this feature! Code for it is a bit dirty in some places, but specs do pass!\n. This is fixed on latest master (specs are already activated). @saper @xzyfer IMO we should have a test in libsass-todo-tests for each issue. I don't mind adding more tests to the suite in other folders, but these tend to get overlooked when there is no test in the issues folder (as with this one).\n. Bare bone spec would be:\n``` scss\n%place-to-go {\n  font-size: 1em;\n}\n:nth-child(1){\n  @extend %place-to-go;\n}\n:nth-child(2){\n  @extend %place-to-go;\n}\n:nth-child(3){\n  @extend %place-to-go;\n}\n```\n. Spec test I used to check my implementation:\n``` scss\n%place-to-go {\n  font-size: 1em;\n}\na::foo(1){\n  @extend %place-to-go;\n}\na::foo(2){\n  @extend %place-to-go;\n}\nb::foo(1){\n  @extend %place-to-go;\n}\nb::foo(2){\n  @extend %place-to-go;\n}\n:bar(1){\n  @extend %place-to-go;\n}\n:bar(2){\n  @extend %place-to-go;\n}\n:bar(3){\n  @extend %place-to-go;\n}\n[foo]{\n  @extend %place-to-go;\n}\n[bar]{\n  @extend %place-to-go;\n}\n[baz]{\n  @extend %place-to-go;\n}\n[bar=\"1\"]{\n  @extend %place-to-go;\n}\n[bar=\"2\"]{\n  @extend %place-to-go;\n}\n[bar=\"3\"]{\n  @extend %place-to-go;\n}\n```\n. Closing as irrelevant since dart-sass a lot of error messages have slightly diverted from ruby sass implementation. IMO the current error message indicator is good enough. Both error messages have diverted anyway in the meantime:\n```\nsass test.scss\nError: Invalid CSS after \"}\": expected \";\", was \"\"\n        on line 3 of test.scss\n  Use --trace for backtrace.\npsass test.scss\nError: Invalid CSS after \"  a: a#{b\": expected expression (e.g. 1px, bold), was \"//}c;\"\n        on line 2 of test.scss\n\n\na: a#{b//}c;\n   ---------^\n```. This is a bit more complicated since the check cannot be done in parser, since the following is valid:\n\n\nscss\n@mixin a {\n  b: c;\n}\nfoo {\n  @include a();\n}\nSo we need to do this check after the mixin is expanded.\n. WIP to fix this in https://github.com/sass/libsass/pull/1900\n. Looks like a ruby sass bug to me:\nscss\nfoo {\n  color: #FFFFFF;\n  color: #FFFFFF\n}\nResults in:\ncss\nfoo{color:#FFFFFF;color:#fff}\nPrelexer @ 1083 (breaks #1098):\nc++\n- alternatives< exactly<';'>, exactly<'}'> >\n+ exactly<';'>\n. //CC @chriseppstein \n. This seems related to https://github.com/sass/libsass/issues/1612\n. @xzyfer can we close this one? IMO libsass is more correct/consistent than ruby sass!?. Stripped down version:\nfoo {\n    bar: #{'\\\\X'};\n    baz: #{'\\\\#{X}'};\n}\nLibsass:\nfoo {\n  bar: \\X;\n  baz: \\\\X; }\nSass:\nfoo {\n  bar: \\X;\n  baz: \\X; }\nI wonder if this has changed over time on ruby sass or it may break other cases once I fix this one ...\n. As expected this is one of the interpolation behaviors I don't get and I'm therefore unable to produce a fix that will not break anything else. It might have to do with a rule I've picked up somewhere, that quoted string can only be unquoted once, even if you call unquote multiple times. IMO we don't do that for interpolations. If I make the changes to make this spec pass all double interpolations with escapes seem to fail.\n. This seems to be fixed with https://github.com/sass/libsass/pull/1841\nAdded needs test since there is no issue_1734 spec test!?\n. Seems like this was only halve fixed. Rescoping the rest to 3.3.4\n. I'm closing this as the only reason the specs fail (only on some CI configs) is because of https://github.com/sass/libsass/issues/1786.\nIf you think that is not correct, please re-open!\n. I've implemented the missing details in https://github.com/sass/libsass/pull/1754. The commit in here already fixes the most urgent bug, so I leave this one as is. With the interpolation refactoring and the one I've linked we're getting IMHO pretty close to a more sane and easier to use internal API.\n. Spec test I'm currently using to test binary expressions with interpolations:\n``` scss\nfoo {\n  bar: 10 * 5;\n  bar: 10 / 5;\n  bar: 10 + 5;\n  bar: 10 - 5;\n}\nfoo {\n  bar: 10 * #{5};\n  bar: 10  /  #{5};\n  bar: 10 + #{5};\n  bar: 10 - #{5};\n}\nfoo {\n  bar: 10 * 5#{px};\n  bar: 10 / 5#{px};\n  bar: 10 + 5#{px};\n  bar: 10 - 5#{px};\n}\nbaz {\n  baz: #{5} * 1;\n  baz: #{5} / 1;\n  baz: #{5} + 1;\n  baz: #{5} - 1;\n}\nbaz {\n  baz: #{5px} * 1;\n  baz: #{5px} / 1;\n  baz: #{5px} + 1;\n  baz: #{5px} - 1;\n}\nbar {\n  width: #{1+2}+4;\n  width: #{1/2}/4;\n  width: #{1+2}+4;\n  width: #{1-2}-4;\n}\nfoo {\n  bar: 10/5;\n  bar: 10/ 5;\n  bar: 10 /5;\n  bar: 10 / 5;\n  bar: 10  /  5;\n}\ndiv {\n  baz: #{4/5}/1;\n  baz: #{4/  5}/  1;\n  baz: #{4  /5}  /1;\n  baz: #{4  /  5}  /  1;\n}\nmul {\n  baz: #{45}1;\n  baz: #{4  5}  1;\n  baz: #{4  5}  1;\n  baz: #{4  *  5}  *  1;\n}\nadd {\n  baz: #{4+5}+1;\n  baz: #{4+  5}+  1;\n  baz: #{4  +5}  +1;\n  baz: #{4  +  5}  +  1;\n}\nsub {\n  baz: #{4-5}-1;\n  baz: #{4-  5}-  1;\n  baz: #{4  -5}  -1;\n  baz: #{4  -  5}  -  1;\n}\n```\nExpected result:\n``` css\nfoo {\n  bar: 50;\n  bar: 10 / 5;\n  bar: 15;\n  bar: 5; }\nfoo {\n  bar: 10 * 5;\n  bar: 10 / 5;\n  bar: 10 + 5;\n  bar: 10 - 5; }\nfoo {\n  bar: 50px;\n  bar: 10/5px;\n  bar: 15px;\n  bar: 5px; }\nbaz {\n  baz: 5 * 1;\n  baz: 5 / 1;\n  baz: 5 + 1;\n  baz: 5 - 1; }\nbaz {\n  baz: 5px * 1;\n  baz: 5px / 1;\n  baz: 5px + 1;\n  baz: 5px - 1; }\nbar {\n  width: 3+4;\n  width: 1/2/4;\n  width: 3+4;\n  width: -1-4; }\nfoo {\n  bar: 10/5;\n  bar: 10/ 5;\n  bar: 10 /5;\n  bar: 10 / 5;\n  bar: 10  /  5; }\ndiv {\n  baz: 4/5/1;\n  baz: 4/5/ 1;\n  baz: 4/5 /1;\n  baz: 4/5 / 1; }\nmul {\n  baz: 201;\n  baz: 20 1;\n  baz: 20 *1;\n  baz: 20 * 1; }\nadd {\n  baz: 9+1;\n  baz: 9+ 1;\n  baz: 9 +1;\n  baz: 9 + 1; }\nsub {\n  baz: -1-1;\n  baz: -1- 1;\n  baz: 4 -5 -1;\n  baz: -1 - 1; }\n```\nWhat this WIP currently produces:\n``` css\nfoo {\n  bar: 50;\n  bar: 10 / 5;\n  bar: 15;\n  bar: 5; }\nfoo {\n  bar: 10 * 5;\n  bar: 10 / 5;\n  bar: 10 + 5;\n  bar: 10 - 5; }\nfoo {\n  bar: 50px;\n  bar: 10/5px;\n  bar: 15px;\n  bar: 5px; }\nbaz {\n  baz: 5 * 1;\n  baz: 5 / 1;\n  baz: 5 + 1;\n  baz: 5 - 1; }\nbaz {\n  baz: 5px * 1;\n  baz: 5px / 1;\n  baz: 5px + 1;\n  baz: 5px - 1; }\nbar {\n  width: 3+4;\n  width: 1/2 / 4;\n  width: 3+4;\n  width: -1-4; }\nfoo {\n  bar: 10/5;\n  bar: 10/ 5;\n  bar: 10 /5;\n  bar: 10 / 5;\n  bar: 10  /  5; }\ndiv {\n  baz: 4/5 / 1;\n  baz: 4/5 / 1;\n  baz: 4/5 / 1;\n  baz: 4/5 / 1; }\nmul {\n  baz: 20 * 1;\n  baz: 20 * 1;\n  baz: 20 * 1;\n  baz: 20 * 1; }\nadd {\n  baz: 9+1;\n  baz: 9 1;\n  baz: 9 + 1;\n  baz: 9 + 1; }\nsub {\n  baz: -1-1;\n  baz: -1- 1;\n  baz: 4 -5 -1;\n  baz: -1 - 1; }\n```\nAs far as I can see this now would only differ in whitespace, but I had to do some very crude checks to get this behavior. @xzyfer IMO you said you want to takle this too? It seems that binary expressions somehow remember the whitespace around operators. IMO this needs to be addressed first before I could clean up the binary expression part of this refactoring.\n. @xzyfer so will your refactor solve all the issues in the sample I posted above?\nAlso is there a WIP PR where I can check in what direction you're going with that?\n. This was fixed in a recent version. Please always include the versions you are testing against:exclamation: \n. Thanks for the report. Handling of the :not pseudo selector is somewhat special and incomplete in libsass, as the following samples illustrate (I know we also need to add some implementation somewhere in and around unify_with). Basically we don't eval stuff inside wrapped selectors. Once you add an interpolation to a selector, we will evaluate and re-parse it (which btw. gives me a headache for source-maps), so in this case the parent selector will actually be resolved (see second sample).\nscss\nfoo#{b+ar} {\n  :not(&#{'.bar'}) {\n    color: #{baz};\n  }\n}\nSo this will actually work somewhat (libsass keeps the .header selector):\nscss\n.header {\n  .nav-text-link:not(#{&}.popover-link) {\n    margin: 10px;\n  }\n}\nI could probably patch just that issue by explicitly parentize wrapped selectors in the eval stage. But I really would like to understand why :not does what it does.\nSome excerpt from current w3c specs: \"The negation pseudo-class, :not(X), is a functional notation taking a simple selector (excluding the negation pseudo-class itself) as an argument. It represents an element that is not represented by its argument. Negations may not be nested; :not(:not(...)) is invalid. Note also that since pseudo-elements are not simple selectors, they are not a valid argument to :not().\" ... \"A simple selector is either a type selector, universal selector, attribute selector, class selector, ID selector, or pseudo-class\"\nBasically what ruby sass produces is invalid css and browsers should ignore it (Firefox emits this warning for me, sorry it's german: \"Abschlie\u00dfende ')' fehlt in Negations-Pseudoklasse '['.  Regelsatz wegen ung\u00fcltigem Selektor ignoriert.\")\nSo the question is why you really want to use something like this in the first place.\n//CC @chriseppstein what is the stand here for ruby? IMO the only way to get a valid selector is when we only have one parent selector (also attribute selector will not work) that merges into another typeselector, as with foo { :not(&bar) ... }, which should in my intuition result in foo :not(foobar) ..., but will currently yield :not(foobar) ... in ruby sass!? Btw. AFAIK we have similar issues with :has \"pseudo selector\".\n. Fixes on latest master and will be in 3.3.3.\n. LGTM\n. Got some results (aka more problems) from a debug session. The following sample should show the problematic behavior (certain scopes seem the behave slightly different):\nscss\n$continue: true;\n$while_global1: initial;\n$while_global2: initial;\n$other_global1: initial;\n$other_global2: initial;\n// bleads into global\n@while $continue {\n    $while_global1: assigned;\n    $while_global2: assigned !global;\n    $continue: false;\n}\n// does not blead into global\nfoobar {\n    $other_global1: assigned;\n    $other_global2: assigned !global;\n}\n// different results for global\nglobals {\n    while1: $while_global1;\n    while2: $while_global2;\n    other1: $other_global1;\n    other2: $other_global2;\n}\nResult by ruby sass 3.4.19\ncss\nglobals {\n  while1: assigned;\n  while2: assigned;\n  other1: initial;\n  other2: assigned; }\nI guess we need a flag on Environment for this.\nHere another currently failing spec test which shows a related problem:\n``` scss\n$var: 7;\n.selector {\n  $var: 13;\n  var: $var;\n  .inner {\n    $foo: \"dummy\";\n    $var: $var + 3;\n  }\n  foo: variable-exists(foo);\n  var: $var;\n}\n.other-selector {\n  content: $var;\n}\n```\nDev Info: Need flag on env to check in set_lexical. Push a new env to env_stack in ruleset expanding.\nAlso note that we have code for For, Each etc. in both expand and eval phase. Could use more specs.\n. I do see your point. But unfortunately libsass technically does the correct thing and in some way chrome also reports the correct thing. It actually shows where the first selector in the sequence is declared. And this is basically not what one would probably expect, specially given that chrome doesn't use much of the information that would be available via the source-map. BTW. with less you also get that line reported.\nAlso be aware that sourcemaps v3 are still just a proposal, so any implementation could be questioned. Unfortunately for libsass it seems that all browsers that support css sourcemaps agree to report this information that way. IMHO this is not really correct, since in that situation I would expect them to report where the scope/ruleset for the styles is opened (and we actually have a sourcemap pointer there).\nI'm reluctant to remove all mappings we currently have, since they are technically correct and could be very usefull for more advanced inspector tools. But I see the pain point and currently no such advanced tooling exists, so I'm willing to add a crutch to make this more usefull in the meantime (#1759). Btw. the v3 proposals were lately extended with some notions of Multi-level Mapping Notes, which is pretty much what we try to do with sourcemaps already.\n. Here are the corresponding bug reports for less (https://github.com/less/less.js/issues/1492) and the one for chromium (https://code.google.com/p/chromium/issues/detail?id=287382).\n. @tehOPEologist I would advise people to just ctrl click on the actual (ie. first) style rules :wink: \n. \nNot sure if we add the crutch mentioned before, since it is a browser issue and there is a way in chrome to get to the correct place by ctrl+click (see screenshot, you could also ctrl+click on the color). Just to be clear, hold ctrl and click on background (or red) will bring you to the right position.\n. Just a note: this is not possible in firefox currently, but I hope they will adapt the behavior of chrome (and I'm pretty positive since the dev tools in firefox are pretty new and quite actively developed atm).\n. @xzyfer ruby sass sourcemaps are lacking a lot according to previous discussions with @am11. I decided to do better than that and therefore libsass has much more detailed source-maps than ruby sass does (not sure if this is still true, since those discussion are over a year old). The question is really if we want to merge the crutch in https://github.com/sass/libsass/pull/1759 into master or not. That change is techically not correct, but will make chrome and firefox report a more usefull mapping. But it could confuse more advanced tools, since that mapping is technically not correct. \n. Should be fixed in master, see https://github.com/sass/libsass/issues/1846\n. This is fixed on latest master and will be in 3.3.3.\n. Minimal case:\nscss\n@mixin some-fn($args...) {\n  @each $item in $args {\n    @debug($item);\n  }\n}\n.foo{\n  @include some-fn( () ); // segmentation fault\n}\n. Closing this as not reproducible. Re-open if you can provide a working self contained example. Thanks!\n. Once green this is also ready to be merged. It's the base work to reunite all stringification functions again. They deviated because I often could not use the visitor classes due to the dependency on context. With this now gone, we can implement a visitor class that only has a bare minimum of internal dependecies (bascially what inspect visitor class is now with the new option for ruby inspect).\n. We don't want to have two visitor classes for this, so we need one option to pass to one visitor class. I added an additional \"output style\" for that puropse. We have 4 to_css and 1 inspect option on the same visitor class. That's the goal.\nReason we do not want to have 2 visitor classes: Once we fall back from to_css to inspect all further calls are within inspect. So one visitor class fits bests, and with that 5th option we have everything covered.\n. For that purpose I introduced struct Sass_Output_Style, which holds all options for stringification (output style and precision). I could have added a bool inspect to it, but that would basically give 8 variations in regard to output style, so adding an additional type seemed most consistent. It does not have much purpose on the API, but it doesn't hurt either. Not sure if consumers like node-sass should expose that output mode, but could be handy to have a ruby equivalent for sass values.\n. Also worth noting: the approach I chose with adding virtual to_string to AST_Nodes was mainly to circumvent the fact I could not use to_string visitor. Now that it is no longer directly dependent on context we can start to use it for everything. The approach with the virtual to_string is suboptimal, as the more nested nodes are involved, the more unnecessary string operations we do (since we do stuff like \"(\" + node->to_string() + \")\", which can create a lot of unnecessary intermediate strings).\n. I hope that makes sense, I do not take these changes lightly either!\nBut to remove the dep of the visitor classes from context was needed!\nAnd with the last commit I was able to do the first fix of this kind!\n. To clarify the goal: We should have one to_string (probably non virtual to ensure compile time resolution) method implemented in the base class AST_Node. That function should invoke a To_String visitor class and just pass the Sass_Output_Option struct. This will alleviate the need to create an instance of To_String over and over again. One problem currently is that the underlying inspect visitor class insists to create source-mappings. From a performance stand-point this is also not very optimal, but I guess we can overlook this for now.\n. test should probably be extended to also include comments after the operator\n. Thx @rodneyrehm!\n. With the new to_sass mode this one became easy :smile:\n. This should be fixed on latest master, test might be redundant, but the more the merrier\n. @jonasjonas you could create a native plugin for this. Please check https://github.com/mgreter/libsass-math to get some ideas how this can be done. You probably need to extract and copy the base64 base parts though.\n. You should be able to define a custom function like @warn to handle these.\n. Closing this since it IMO should work by overloading the functions I mentioned some time ago. \n. AFAIR this is correct, you should get passed a sass string value for each call to @debug or @warn.\n. I guess that's where the experimental part really starts. You don't need to return something in these functions (you should be able to return 0). The magic is actually done in the eval stage. I also just checked to_c converter and you probably get Custom_Warning and Custom_Error values.\nAs already noted, it's still pretty much experimental.\n. No, you get a sass value of type custom warning or custom error. A sass string also would be a kind of sass value, but seems I opted to create specific types for warn and error (it still just contains a std::string).\n. You should just check the kind of values you get via the sass values api. I guess you probably get the type you pass during the calls. So if you call @debug(1, \"asd\") you probably get a s_args list with two arguments with one of type number and the other of type string. I don't know really.\n. Check what?\n. Since the functions are called like regular sass functions, I'm pretty positive you get a list of sass values in s_args as with all other functions. Return value is ignored. Feel free to re-open if this is not the case :wink:\n. 10em + 12em should resolve to a number of 22em, so yes, I expect you get a number there (what if you would want your own sprintf like debug version ). Thought this was obvious, @debug(1px+2px, \"foo\" + bar, 5 > 3) should IMO give a list of 3px, \"foobar\", true which are of type number, string, boolean.\nAs for the parser information (line numbers etc), this would be a duplucate of https://github.com/sass/libsass/issues/1037\n. Already looked into that syntax last year, but it was too hard and complicated, since it looks very similar to pseudo selector. Not even sure what the heuristics should be to differentiate those two cases.\n. If someone is up for the challenge, feel free to create a PR for sass2scss!\n. Closing this and tracking upstream at https://github.com/mgreter/sass2scss/issues/26.\nI have it on the radar but currently very low priority.\n. Closing as not reproducible (I checked against latest WIP branch)\n. Pretty sure this has something to do that \\a is interpreted as \\x0A which is \\r.\n. I think the main bug is fixed with https://github.com/sass/libsass/pull/1880.\nBut there is another strange one which I fail to see the logic:\nscss\ntest {\n    test-1: \"#{'\\a'}\";\n    test-1: \"#{x '\\a'}\";\n    test-1: \"#{x + '\\a'}\";\n}\nRuby sass:\ntest {\n  test-1: \"\\a\";\n  test-1: \"x  \";\n  test-1: \"x\\a\"; }\nLibsass\ntest {\n  test-1: \"\\a\";\n  test-1: \"x \\a\";\n  test-1: \"x\\a\"; }\nMight be a ruby sass bug ...\n. The Source Map Revision 3 Proposal says that about Resolving Resources: \"If the sources are not absolute URLs after prepending of the sourceRoot, the sources are resolved relative to the SourceMap (like resolving script src in a html document).\".\n. - [ ] Issues with inconsistently compresses  floating points (part. fixed by 3.4.20+)\n- [x] Issues with escaped semicolon beeing wrongly omitted (fixed by 3.4.20+)\n- [x] Selector starting with dashes get compressed (fixed by 3.4.20+)\n. Closing in favor of https://github.com/sass/libsass/pull/1841\n. The compiler is not the important part here, but the used make utility and the shell. I think I have once tested it with: mingw32-make, make and dmake. Either in cmd.com, msys and cygwin shell. Finally compiler can also differ from native gcc on windows via cygwin, mingw32, clang, etc. I tried to apply some educated guesses what to expect under which circumstances. I suspect that this removal may be the culprit here. But it was probably removed because it broke something else. Maybe we just need to change the order of the detection.\nWe will not be able to support all combinations with one native makefile. For that reason we also provide autotools build files, which can be used via cygwin (although cmake would be nicer on the windows side).\n. Should hopefully be fixed by https://github.com/sass/libsass/pull/1882\n. I merged #1882, please re-open if problem persists.\n. They are the same issue though, we need to error once we know the output will end up in css.\n. More thorough spec test would be:\n@media/*outer*/(/*head*/max-width/*before*/:/*after*/500px/*foot*/) {\n    a {color:red}\n}\n. Anyone up for the task to clean this up?\n. Fixed with https://github.com/sass/libsass/issues/1757\n. I cannot reproduce the segfault. The rest should be fixed by https://github.com/sass/libsass/pull/1830. There probably are more similar cases, this only touches the case with parsing an interpolated selector list. So more spec tests would be welcome ...\n. IMO it is okay as it is now. So far only C-API stuff is prefixed with SASS_, since we have a Sass namespace on the C++ side. The issues we had were due to using namespace std which has been dropped, so it should be ok now. I really would like to encourage to work with namespaces in C++ (i.e. Units now live in SassUnit namespace). There will always be compiler quirks as ie. the one with std::round that surfaced on cygwin when we prefixed all identifiers from std.\nEdit: According to google the correct way to avoid these non-standard defines/macros (as the SEC macro on smartos), we could set _POSIX_C_SOURCE before including any system header files. I suspect that the SEC problems stems from time.h and this should solve it, but no idea how that plays together with the c++11 stuff and various compilers. \nI really don't think we need to to overly pro-active here. \n. I absolutely would hate that, but I guess that's already clear. So we would have Sass::SassUnit::LIBSASS_SEC just because one ~~compiler~~ system can't keep it together? I say let's keep it as it is with the #undef SEC since that macro should never be defined in the first place!\n. So I took the pleasure to install smartos on a virtual machine, which took me 3 hours due to a bug in their installer :facepunch: Once I had it running it took me another hour to figure out how to install gcc (pkgin in scmgit-base gcc47; export PATH=\"$PATH:/opt/local/gcc47/bin/\"). Once I was that far it took me a couple of minutes to figure out how to avoid these macros to be exported:\nIn src/units.cpp:\n```\nundef EXTENSIONS\ninclude \ninclude \"units.hpp\"\n```\nThis makes all #undef obsolete and the file compiles correctly. This needs to be place into every compile unit before any system header includes. This is much easier to apply and I think we should create a common sass.hpp header that must be the first include in every compilation unit.\nWill try to find out what that __EXTENSIONS__ define actually is ...\n. @QuLogic we already export stuff under the SASS_ prefixes with the C-API, so mixing C and C++ here would even be worse, since we ie. already have a SASS_STRING or SASS_ERROR on the C-API.\n. I have create a PR which fixes the issue when I test it on SunOS smartos 5.11 joyent_20160108T173524Z i86pc i386 i86pc. I suspect this bug or some similar stuff going on:\n\nC++ options for C++0x / GNU-extended C++0x (-std=c++0x, -std=gnu++0x) \nshould probably be treated like those for c99/gnu99, since C++0x uses the \nC99 library (whereas C++98/C++03 uses the C90+AMD1 library).\n\nWe pass -std=c++0x so it should probably not use any gnu extensions!?\nStill have no idea why __EXTENSIONS__ is defined by the compiler on solaris??\n. I'm closing this as it should not be needed. I jumped through hoops to ensure this is fixed now!\n. #1793 is the same issue though, we need to error once we know the output will end up in css.\n. Just a note: not sure if we are guarenteed to always have something usefull in e.pstate. Which is basically the reason why we only provide it for parser error (AFAIR).\n. Not really, 3.3.4 might follow shortly after (need to wait for 3.4 before all API changes are ready).\n. @xzyfer I thought you would first prepare the notes? Waiting for these, then we can freeze.\n. Went ahead and created them via:\n``` perl\nuse strict;\nuse warnings;\nuse pQuery;\nmy $loop = 1;\nmy $page = 0;\nmy $count = 0;\nmy $tag = \"3.3.3\";\nwhile ($loop) {\n$loop = 0;\n  $page ++;\npQuery(\"http://github.com/sass/libsass/issues?page=$page&q=milestone%3A$tag+is%3Aclosed\")\n    ->find('LI[id^=\"issue_\"]')\n    ->each(sub {\n        $loop = 1;\n        $count ++;\n        my $i = shift;\n        my $doc = pQuery($);\n        my $title = $doc->find('.issue-title-link')->text;\n        my $user = $doc->find('.table-list-cell-avatar IMG')->attr('alt');\n        my $id = $doc->attr('id');\n        $id = $1 if $id =~ m/issue(\\d+)/;\n        print \"- \", $title, \" (\", ($user ? $user : \"XXX\"), \", #$id)\\n\";\n});\n\n}\n``\n. @xzyfer can you release and test sassc? I will not have time this weekend!\n. @xzyfer can you release and test sassc? I will not have time this weekend!\n. Any progress here?\n. I guess it doesn't really hurt, but I would prefersass_copy_c_string`. Makes it a bit more standing out and IMO even describes the purpose a bit better. And I guess I will have to badger you to also update the documentation for the C-API :wink: \nAgain thanks for your contributions!\n. LGTM (beside the notes I've added)! Thanks a lot!\n. Added a few comment, sorry to nitpick further. But I cannot give my blessing for the change in sass_context for sass_strdup(e.pstate.src). And we should also have a sass_free_c_string.\nHope you got some time to also add these? Should be copy paste mostly while ammending this commit! You may also want to elaborate why you added the string copy in context?\n. Might be wort to split into two commits. Would love to see one adding copy and free functions, while the second fixes the \"premature\" de-allocation issue (2 PR would be even better).\n. The point of sass_copy_c_string is to copy a c string, but you don't know for sure how to free it. To have a 100% sane API we need the counterpart, so we can implement and change whatever we use in the copy function. This also is true for every \"take\" function, since those internaly also come from the same copy call. That's why I also want a free counterpart. Hope that made more sense!\nOne use case would be if we decided to use a ref-counting mechanism. Copy would increase the counter, while free would need to decrease it. In that case a free call by the consumer could be fatal.\nI guess I need to review this again once I have the milestone branch merged :smile: \nI think we should make it mandatory to call sass_free_c_string to release memory from the take function family. All they should do is to ensure the lifetime of the memory for the caller until he calls free. But I'm not too sure if the API would be sane enough to actually take some use of it.\n. Will need to think about it a bit more. But from a gut standpoint (and AFAIR) we currently try to do b) in all cases with one big exception. We want you to overturn the source string for data context to libsass. The reason is that this makes sense in pretty much all use cases, because you normaly are done with that memory after you have passed it to libsass. But I also have wondered if we want to allow consumers to tell us if we should free the string or not. Problem is that caller now has the obligation to keep the memory alive as long as libsass needs to use it, so passing it seemed the best choice (and was IMO consistent with the old sass_interface). So that option now would only serve a purpose when the caller actually wants to hold on to the source string, which I doubt has any use cases at all (well I guess you have given one when we pass that pointer back to the caller for the error object).\n. I don't really like that option, since it is pretty redundant to specify an option to have libsass do something,, as you know exactly what to do. I will need to think about the big picture more deeply.\nIt also came to my mind that you probably destroy the context object before accessing that memory, since libsass should keep the memory alive until you call sass_delete_context. So from that standpoint we do have a defined life-cycle. But I agree that is not very obvious. We also lack a take function for the error object in regard to the file source. Need to check these, as I cannot tell with certainty.\n. I just replied to @saper on slack regarding https://github.com/saper/sass-crash-test and since my answer is closely related to this, I will post the same here for future reference. \n\n@saper: Checked out your samples in that sass-crash-test repo and compiled and tried them all and AFAICS all that fail (002 works ok for me) are a result of \"wrong usage\" and I will try to explain why, but will need some paragraphes to do so fully. I fail to see how our API should be broken if used correctly.\n001 and 003 fail because ie char data[60] is on the stack which will be automatically deallocated once the stack variable goes out of scope. Libsass must hold on to that memory, since we might need it to stay around for error reportings. And we cannot delegate that duty to the implementer. There are IMO only two ways to solve this. Always make a copy when the string is first passed to libsass, to make both sides independent of each other, which will mean we have two copies of the full source around in memory. The other possibility is to take over ownership of the memory. And that only works if the memory is on the heap (we need to have control over when that memory is deallocated). So by that API contract you have to pass a heap variable to libsass, since you cannot delegate/pass ownership/life-cycle of a stack variable.\nMain reason I choose the second approach, and AFAIR it the same way as the previously and now obsolete interface worked, is as following: There is simply no real use case where you would have the source input in a stack variable (beside made up cases). To have the source variable on the stack you need to know how much space you need for it on compile time. If you know that I'm pretty sure you also know what sass code you will have. In other words having it on the stack pretty much translates to knowing it is static (at compile time). If you know the source you pass on compile time, you would also know the expected result on compile time, so why even bother to pass it to libsass? Normal use\ncase is implementer loads the source and really just wants to pass it to libsass, and the API was mainly built for exactly that use case. You must not deallocate the source memory on your own, once you passed it to libsass, ever, that is one contract the libsass API has.\nHaving the source input on the stack implicitly violates that contract.\nhas a leak in strdup(\"file.css\"). Only the input source life-cycle is passed to libsass. Libsass takes a copy of all other strings you pass (as with the filename). In that case the strdup is superflous and leads to the memory leak. I actually haven't tested it, but from reading the code I'm very confident that is the problem there.\n\nstruct Sass_File_Context* sass_make_file_context (const char* input_path);\nstruct Sass_Data_Context* sass_make_data_context (char* source_string);\n\nAs you can see one expects a const char* while the other expects char*. And finally 005 also seems to work:\n\nImporting(#0): lala\nImporting(#1): delta\n/* import */\n/* import */\n/* First */\na {\n  color: red; }\nSo in the end I seem to come to the conclusion that we are already doing the right thing, but need to communicate the contracts more clearly. We cannot either depend on implementer to keep the source input memory around for us, since he can't know how long we will need to have it around. And once we pass it back to implementer via ie. error object, implementer cannot trust us to keep that memory alive as long as he needs it (so he should make a copy in that case). I guess the contract that we keep that memory alive until implementer calls sass_destroy_context is a fair and well defined border. We may could offer a similar function like I did with the other \"take\" functions. So implementer could request owenership of memory via reported errors.\n. @am11 I don't see a compelling reason or use case why we would need to copy source input memory. I really don't see any use case. And it would be a breaking change for all implementors. And it will increase memory footprint. And it shouldn't be too hard to make a copy by implementer if really needed (i.e. if input memory is on the stack).\n. I created a proposal in https://github.com/sass/libsass/pull/1983. Waiting for feedback!\nThanks for the contributions and feedbacks here (@am11 et al)!\n. I don't see much we can do here, as the implementation of the custom function str-replace is actually recursive. I guess this was mainly done as sass seems to lack an offset argument for str-index. But the function can still be implemented with one loop only, altough it needs a bit more logic then.\nscss\n@function str-replace($string, $search, $replace: '') {\n  @if $search == '' {\n    @return $string;\n  }\n  $remainder: $string;\n  $string: '';\n  $index: str-index($remainder, $search);\n  @while $index {\n    $string: $string + str-slice($remainder, 1, $index - 1) + $replace;\n    $remainder: str-slice($remainder, $index + str-length($search));\n    $index: str-index($remainder, $search);\n  }\n  @return $string + $remainder;\n}\nI have not really tested this much, but seems to yield the same results as the recursive implementation.\n. To repeat: this would have been much easier to implement if ruby sass would accept an optional offset for str-index (as pretty much all programming languages offer). Maybe it would be a nice addition and worth mentioning to the ruby sass team (//CC @chriseppstein @nex3).\n. Opened https://github.com/sass/sass/issues/1955. Closing this as no action will be taken from our side.\n. Reason why __ works, is because the following is valid\nscss\n__ {\n  foo: bar;\n}\nWhile the following is not:\nscss\n-- {\n  foo: bar;\n}\nKnowing that a fix should be pretty simple.\n. Hmm, could be, but no real way to test it with libsass. Saw it from a perl-libsass integration test ...\n. BTW. bug in join_paths was introduced with https://github.com/sass/libsass/commit/5f9bc0528785c0dca106ff3e10d1c932e74c3ffe.\nIt might be that we triggered it with some recent changes.\n. Waiting for :traffic_light: \n. It's mostly just usefull for issues, but I tend to flag PRs that I feel can be \"blindly\" merged if needed. Just a minor nitpick, a comment in the source for such conditionals would be usefull. Other than that :+1: \n. Is this still needed with latest master?\nI checked with MSVC 2013 community!\n. 2) should be easy to extend ci scripts to checkout some arbitrary git hash\n1) IMO it should be the other way around. Libsass repo should know which version of sass-spec it passes against. I would be in favor of doing this in the form of a submodule, if we do it. The same would basically also be true for sassc. So beside the tagging in sass-spec :+1: \n. Is this of any concern anymore?. Ruby sass does not merge these either, so nothing libsass could do here!\nI'm also very sure that this is logically not possible, since we don't know where to put the selectors in between the two to be merged media query blocks. Where should header { font-size: 17pt; } go? Before or after the merged media-query block? This is because the header selector has the same specificity in all three occurrences, so the order is very important!\nscss\nheader {\n    @media (max-width: 40em) {\n        font-size: 13pt;\n    }\n}\nheader {\n    font-size: 99pt;\n}\nheader {\n    @media (max-width: 40em) {\n        font-size: 15pt;\n    }\n}\n``` css\n@media (max-width: 40em) {\n  header {\n    font-size: 13pt;\n  }\n}\n// Where should this go?\n// Below or after merged block?\nheader {\n  font-size: 99pt;\n}\n@media (max-width: 40em) {\n  header {\n    font-size: 15pt;\n  }\n}\n```\nAlso by merging the blocks we do not really gain much (only one media query block definition in the case above). You probably still want to use a more sophisticated minifier for the resulting css. So far sass compressed output mode is not meant as the ultimate compression utility.\n``` css\n@media (max-width: 40em) {\n  header {\n    font-size: 13pt;\n  }\n  header {\n    font-size: 15pt;\n  }\n}\n// we now have put it below\n// has no longer same logic!\nheader {\n  font-size: 99pt;\n}\n```\n. We got :green_heart: against ruby sass master (upcoming 3.4.21)\n. Rebased branch and renuked latest sass-specs PR ... \n. Libsass takes ownership of the memory you pass, so make a copy of your constant string.\nc++\nchar* input = strdup(\"html { a { float: right; } }\");\nI guess we should put this info more prominently in the docs (PRs welcome :wink:).\n. Was this against master? Cannot find any indication which libsass version?\n. Might be fixed then, can you try latest master?\n. ~~The last commit reverts the SunOS specifics in the Makefile:~~\n~~1) We need to have libtool installed and ginstall is not available by default too!~~\n~~2) We install to / on all platforms (use PREFIX=\"/opt/local\" make to override).~~\n~~SmartOS needs: pkgin install automake autoconf libtool!~~\n~~Then we can also build libsass via autotools as documented.~~\n. Looks like ginstall would still be the correct one to use. libtool install doesn't seem to do the right thing, was asuming it would. But no idea how to get gnu-install on to SmartOS. Maybe if someone can argue why we cannot install into / on Solaris, please enlighten me.\nBtw. install from libtools outputs:\nfind: cycle detected for /lib/crypto/32/\nfind: cycle detected for /lib/secure/32/\nfind: cycle detected for /lib/32/\nfind: cycle detected for /usr/lib/elfedit/32/\nfind: cycle detected for /usr/lib/libp/32/\nfind: cycle detected for /usr/lib/link_audit/32/\nfind: cycle detected for /usr/lib/lwp/32/\nfind: cycle detected for /usr/lib/secure/32/\nfind: cycle detected for /usr/lib/32/\ninstall: libsass.a was not found anywhere!\n\u00af_(\u30c4)_/\u00af\n. Verfied both install methods and documented my findings. Very very sure this chapter can be closed!\n. I'm going to merge this on my responsibility. Beside CI I have tested it with Visual Studio 2013 Community, SmartOS 5.11, Gentoo Linux, Cygwin and MinGW. Not all combinations, but a fair share.\nWant to move forward and concentrate to bring sass 3.4.21 parity!\nAs always feel free to open issues when problems arise.\nHave a nice day!\n. Will merge this as soon as ci is :green_heart: \nIf any of these error checks regress we can still just uncomment them. I hope we have gathered enough specs to cover pretty much all cases, although I'm not to sure about At_Root and Media_Blocks. But it should also be quite easy to adjust the conditions, since we now can query the parent scope type in parser. I also added a few of my own spec tests to cover the main use cases I could come up with.\n. This does not happen in normal build since unit.cpp does not need windows headers (please always include the info that you're doing a unity build). I want to avoid the #undef crutch if possible. We need to tame these \"misbehaving\" headers by telling them not to define these in the first place.\n. Commited directly to master! Thanks!\n. Commited directly to master! Thanks!\n. In this case you have to open a bug report with ruby sass. Libsass does not implement features that are not in ruby sass. But I'm pretty sure that there is a reason the space is not allowed, since css allows stuff like font: arial (10px / 20px) and that should probably not be a function call ...\n. This should be fixed by https://github.com/sass/libsass/pull/1875, but spec tests show an issue with the spec runner and unicode, so the specs cannot be merged at that point. https://github.com/sass/sass-spec/issues/714\n. @xzyfer I'm thinking about renaming Inspect visitor class to Stringify, because the name is IMO a bit confusing, since it handles all the stringification now. In terms of ruby sass it never did what ruby sass internaly does with inspect. We should use to_string, to_sass and inspect methods on AST_Node instances. These correspond to ruby sass perform, #{node.to_sass(opts)} and #{node.inspect}.\nI also want to add an emitter that does not create a sourcemap, since for these methods it's not necesarry (but that's really just a performance optimization). Things start to come together.\n. All thanks to the decoupling of context from the inspect visitor, took me quite some time and refactorings to finally make these happen.\n. Closing in favor of https://github.com/sass/sass-spec/issues/707\n. This was disabled in https://github.com/sass/libsass/commit/ea573488891ed34342d56d41cc5cc388c27859ef, but I don't remember why ...\n@am11 are you sure it works the way you're writing? I'm not sure if include_paths and sass_option_push_include_path are related. I think that include_paths was only available for the obsolete interface and that I replaced it with sass_option_push_include_path on the new context api?\n. Error throwing should be at the right position in the code by now.\nI rather think we do not implement with/without in css bubbling.\n. Seems we do have an issue with Appveyor MSVC Debug build. We should check how we can make the process not block when debug assertions are thrown (on spec for 1793):\n\n. Sorry, forgot to mention I already merged https://github.com/sass/sassc/commit/5cb56f37096214b2ec797918994427c556cd39ea\n. Now hunting down the issue which seems some memory corruption. Quite a hunt I can say so far ...\nBasically we seem to have a buffer overflow somewhere, which corrupts that memory ... :bug: :ambulance: \n. Issue is we pass a c_str() to Parser::from_c_str from a temporary when expanding Media Blocks. \n. Added a fix to keep the memory alive until context is deleted. This exposes a funky issue with error reporting. We re-parse some things after ie. interpolation. An error there will not show the real source, but the interpolated thing we tried to re-parse (also note that the line number is off):\n```\nError: 10in*px isn't a valid CSS value.\n        on line 1 of spec/libsass-closed-issues/issue_1793/input.scss\n\n\n(max-width: 10in*px)\n   ------------^\n```\n\n\nUnsure how to handle this, best would be to be sure we don't error when we re-parse something (error on parse or after evaluation step, ie. with the above we could allow it to parse). I would like to remove all re-parse steps, since we should be able to evaluate the already parsed stuff directly.\nAnyway, for now this seems to work ...\n. @am11 I think we cannot prevent that popup in libsass directly, and somehow that makes sense. We don't know if the consumer is a GUI app or a console app, so the consumer should enforce that behavior. But I don't know how to apply this to ie. perl-libsass bindings for now. I actually wasn't able to include the statements I added in sassc directly into libsass, so I'm not even sure if we technically could enfore that from libsass side. Anyway this only seems to be related to debug builds, so I guess it doesn't make much sense to put too much effort into this.\n. Sorry, but I have to say appveyor sometimes acts like b****. Makes it difficult to tell who is to blame for a failed CI! It \"failed\" this PR because I closed https://github.com/sass/libsass/pull/1883 (AFAICS), which contained the same commit as this PR. Restarting CI now with hopefully :green_heart: in 20 Minutes.\n. This is basically a duplicate of https://github.com/sass/libsass/issues/1661 and https://github.com/sass/libsass/issues/1873\n. Related to https://github.com/sass/libsass/issues/2444 and https://github.com/sass/libsass/issues/1651. Should work from libsass side: https://github.com/sass/libsass/blob/master/src/output.cpp#L72-L75, please open an issue with the implementor you are using. Thanks!\nEdit: It may be important that you note if you write the file by stream redirection or tell the implementor to save it directly to a file (aka. if you call -o output.css or > output.css).\n. Yes, you never stated which upstream tool you use, so if you use node-sass open an issue with them.\n. No, we only support utf-8 output and we auto-detect if such a charset is needed or not. If one is present in input and is not really needed, we would strip it. I think that ruby sass does it the same way (it supports importing different charsets though, libsass has no means to convert ie. latin1 to utf8).\n. @xzyfer that would be https://github.com/sass/libsass/issues/1656, let's keep these seperated.\n. Any progress here? Not sure if it's worth to keep this open, as Solaris 9 had its EOL October 2014?\n. @saper can you provide a VM of such an ancient solaris or can you come up with a fix for it?\n. Was this a No on VM or fix? Can you provide a VM so I can implement a fix? VirtualBox preferred!\n. Any progress here? Not sure if it's worth to keep this open, as Solaris 9 had its EOL October 2014?\n. URLs by sass don't seem to be relative to CWD. That makes it harder to implement correctly ...\n. Retested again and it seems to be inline with ruby sass. Original test case here was not very clear where the import is as the contents of each file were not given in this issue.\n. @xzyfer Is it possible to switch on the line-comments flag via options.yml?\n. @xzyfer we need to move the parentization to the cssize stage, since we otherwise \"freeze\" it too early. Extends happen after the eval stage and therefore parent references will be wrong.\n. Yeah, sometimes I also wonder who has all that time to do all this shit!?\nCan you provide some specifics that would suffice your trust issues?\n. I created a collective ticket to keep track of this and other \"non-urgent\" feature requests, in order to keep the issue tracker a bit more clean for the more 1st aid issues. I would like to encourage everybody interested in this particular feature to add their comments into this closed issue anyway.\nThanks for your understanding and your contribution!\n. I started to include the msi installers built via https://github.com/mgreter/libsass-msi-installer on the github releases (built via mingw, not via msvc). So I consider this issue to be closed for now. It should be rather simple to create dlls with other build-chains if needed by following the docs.\n1: https://github.com/sass/libsass/blob/master/docs/build.md. Will see if I can tackle this one too. Sometimes I wonder if we will ever run out of \"edge\" cases ...\n. Can this be closed (I don't see a specific \"definition of done\")?\n. @stevenvachon the phrase \"having a plugin to access it\" is very vague. If you want an open source project to go in a certain direction, the only way to really do it is to either sponsor someone to do it or do it yourself. But I guess that's pretty much what you were saying already. We would gladly take your input for our \"wish-list\" if there were some difintive actions we could take out of it that we think would benefit some people. But unfortunately I have not been able to distill any from this issue so far.\n. Again, that is pretty vague and I'm not able to distill what that actually would mean. How do you want to do this? How should something like this work in your opinion? What means \"containing such features\". What are the implications? Custom parsing? Custom processing? Custom output?\n. Fixed in https://github.com/sass/libsass/commit/a8a3a0e79978ed635a0cbc8fa1a38109bc42ac91 (thx @tony)\n. @xzyfer did you verify https://github.com/sass/libsass/issues/1262 does still work as expected? On a quick glance I don't see any obvious problems, but I also don't see how it could go out of order. I guess that was happening in call_importers? Might have some time this weekend to test it via perl-libsass.\n. Just to ask, but do we have an actual test case for #1262 in sass specs (or do you have one in node sass). Not sure I do in perl-libsass. Anyway, will try to get some time this weekend to check this! Beeing busy with another project atm.\n. My existing spec tests still work, so LGTM!\n. Closing due to inactivity. Feel free to re-open once the requested information is provided! thanks!\n. Sure! ;)\n. Closing since I simply don't know what the expected result for the second example should be: @kenyakodaira please provide a concise input example and the expected output. Feel free to re-open once you have provided the requested standalone input example and its expected output. Thanks!\n. Pretty sure that this is closely related to https://github.com/sass/libsass/issues/1927\n. Have you tried compiling it against ruby sass?\nAlso always at least provide the used version of libsass!\nThanks\n. So have you tried compiling it against ruby sass yet?\nAnd please RTFM https://www.npmjs.com/package/node-sass#version-information--v200\nThanks\n. Closing this as invalid. Segfault cannot be reproduced and sample does not compile on ruby sass.\n. This seems to be fixed in 3.3.4 already! //CC @xzyfer \n. Pretty sure that this is closely related to https://github.com/sass/libsass/issues/1923\n. I do see the difference, but wonder if this is actually indended behavior. IMHO this is quite a \"funky\" feature so to speak (never seen any similar \"index\" function with \"hash-maps\") //CC @chriseppstein \n``` scss\n$test-map : (\n  key : 20px,\n);\nfoo {\n  bar: index($test-map, (\"key\" 20px) );\n  baz: index($test-map, (\"key\", 20px) );\n  ibar: inspect(index($test-map, (\"key\" 20px) )); // 1\n  ibaz: inspect(index($test-map, (\"key\", 20px) )); // null\n}\n```\nYields in ruby sass:\nfoo {\n  bar: 1;\n  ibar: 1;\n  ibaz: null; }\n. Would be great if someone could come up with a complete list, or better spec test suite for all related functions, since this doesn't seem to be related to index only (I don't think nth has that support)!?\n. We ~~already~~ currently implement them as std::unordered_map, but not sure what performance implications are for indexed access (when changed to ordered map). In the worst case we have to keep an additional vector, but I guess that's pretty much how std::map is implemented in the first place.\nEdit: sorry, I though it was an ordered map. I changed that one once, but we can easily go back to an ordered map. We \"just\" need to implement the indexed access in libsass functions.\nAmend: from a short check it seems that we need to add a ~~vector~~ deque to our map object to support fast indexed access. Not super nice to add the memory overhead, but also not very hard to implement.\n. Please check https://github.com/sass/libsass/pull/1736, hope this answers your questions.\n. Ruby sass does the same as we do. I agree that this could be usefull since you should be able to reach the mixin body by following a property (AFAIK only possible in chrome so far).\n. @paulirish do you have any recommendations how we should handle this? My last conclusion was that we could wrap the resulting selector (.foobar-ext) with another mapping for the actual @include call (we actually will have to apply that to every selector inside the mixin). I guess that should be interpreted as wished by OP in each browser. In chrome we can still quite easily get to the correct selectors/blocks by following the properties in the inspector. But I think this will not work in any other browser so far (might have changed in the meantime). So there we would loose the mapping to where the selector (and its properties) are defined. That's why I haven't progressed this issue yet ...\nFYI: Here the equivalent \"visualization\" in libsass sourcemap inspector - live.\n. @paulirish do you have any recommendations how we should handle this? My last conclusion was that we could wrap the resulting selector (.foobar-ext) with another mapping for the actual @include call (we actually will have to apply that to every selector inside the mixin). I guess that should be interpreted as wished by OP in each browser. In chrome we can still quite easily get to the correct selectors/blocks by following the properties in the inspector. But I think this will not work in any other browser so far (might have changed in the meantime). So there we would loose the mapping to where the selector (and its properties) are defined. That's why I haven't progressed this issue yet ...\nFYI: Here the equivalent \"visualization\" in libsass sourcemap inspector - live.\n. Cannot reproduce with 3.3.3 and 3.3.4?\n. Fix might be quite simple?\ndiff\n--- \"a/functions-c6921c4-left.cpp\"\n+++ \"b/functions.cpp\"\n@@ -902,6 +902,10 @@ namespace Sass {\n     BUILT_IN(sass_quote)\n     {\n       AST_Node* arg = env[\"$string\"];\n+      if (String_Quoted* qstr = dynamic_cast<String_Quoted*>(arg)) {\n+        qstr->quote_mark('*');\n+        return qstr;\n+      }\n       std::string str(quote(arg->to_string(ctx.c_options), String_Constant::double_quote()));\n       String_Quoted* result = SASS_MEMORY_NEW(ctx.mem, String_Quoted, pstate, str);\n       result->is_delayed(true);\nSeems to fix the double quote problems and selector interpolations looks better too?\n``` css\n/ this is ok /\n.foo--bar {\n  c: d; }\n/ this is not ok /\n.foo--bar {\n  c: d; }\n/ this is just weird /\n.foo--bar {\n  c: d; }\n``\n. Can you check if https://github.com/sass/libsass/pull/1979 fixes this issue?\n. This was implemented with https://github.com/sass/libsass/pull/2251. Not sure and it doesn't seem to fix any open issues ATM, so rescoped for now.\nNot closing it now just to have it on the radar, probably later if nothing turns up.\n. Closing as propably obsolete. The segfault happens becauseremove_parent_selectors` will set a selector to NULL at some point with extend. This is not the main cause but merely a symptom of an underlying bug/missing feature. When I sanitize that part, it yields the following:\ncss\nfoo:not(.missing, bar) {\n  a: b; }\n  & {\n    c: d; }\nFor future reference, this is the change I did in ast.cpp (~1270):\nc++\nif ((*this)[i]->tail() != NULL) {\n  (*this)[i] = (*this)[i]->tail();\n}\nAre you sure this was working as expected before? It looks like :not has a special code path here (other pseudo selectors seem to work very different with extend). Anyway, not sure we can fix this for 3.3.5 as it seems to involve a lot more than anticipated, but we could get rid of the segfault.\n. Continued in https://github.com/sass/libsass/issues/2031\n. Might be that sassc destroys the context too early before actually priniting the error message?\n. Closing this a duplicate of https://github.com/sass/libsass/issues/2046 since chances are high you are exactly seeing this here. If not feel free to re-open and to take some inspiration from said bug report, specially since @asottile provided a repo for easy reproduction of the problem.\n. Looks quite ok too me, but instead of creating a specific option for another extension (.css) I would prefer to have the full std::vector<std::string> exposed as far as possible. This means bridging between C-API and C++ will be a bit more complicated. But we may can work with a similar apporach as with push_include_dir (IMO we don't need full manipulation support on the C side).\nThe C-API part would then look something like this:\nsass_option_push_import_extension($options, \"css\");\nThis would be very close to ruby sass, as they also allow to alter the list of extensions it will try to resolve.\n. Looks quite ok too me, but instead of creating a specific option for another extension (.css) I would prefer to have the full std::vector<std::string> exposed as far as possible. This means bridging between C-API and C++ will be a bit more complicated. But we may can work with a similar apporach as with push_include_dir (IMO we don't need full manipulation support on the C side).\nThe C-API part would then look something like this:\nsass_option_push_import_extension($options, \"css\");\nThis would be very close to ruby sass, as they also allow to alter the list of extensions it will try to resolve.\n. The reason this is that your function starts with calc. Calc has a special parser path and we wrongly recognize calcNavbarTextColor as such. Simple fix for now is to change calc prefix to something like get. Sorry about that. Fix and PR is underway.\nMaybe if you have time you could come up with a Pull Request for sass-spec, so this doesn't happen again? Would be greatly appreciated!\n. Closing as duplicate of https://github.com/sass/libsass/pull/1821. I can say that I personaly also prefer a way to avoid unnecessary memory copies and I already came to pretty much the same conclusion that we need to expose our memory allocator somehow. So it seems to make sense to even expose the lowest level sass_allocate_memory. The use case would be so implementors allocate the buffer first and can fill it with data themselve before passing it to libsass.\n. BTW. the C-API changes are scheduled for the next middle version increase (3.4.0). We are not following semver strictly as we want to keep version numbers to match with ruby sass (so we basically have one try left to get it right for 3.4).\n. I think there was a compelling reason I disabled these, but I can't remember exactly what it was. @xoofx can you say how widely you tested it? We need to make sure it works with both APIs and preferably doesn't break if someone is funky enough to use both (IMO that we have a fixed order here is fine as doing so should not be encouraged anyway).\nOther than that LGTM!\n. I don't even consider this one a breaking change but additional feature? But need to test this first. I hope I have some unit tests in perl-libsass for this. Maybe you can see and give feedback if node-sass is happy with the changes?\nBTW. I was under the impression we make another iteration with the C-API in 3.4 (which might could be a rc for 4.0 IMO). I also would like to get rid of the obsolete C interface in 3.4. But there are a few todos open before that (access to current file, import stack etc.).\n. Sorry to be a bit nitpicky @xoofx. Any chance you have made an \"end to end\" test with sassc that requres the include path via cmd line? \n. Would like to wait for feedback from node-sass before merging (//CC @xzyfer, @am11, @saper) if their tests still pass. Other than that I don't see a reason we cannot give it a spin in 3.3.5 as incubating feature.\n. @xoofx can you rebase this to latest master so CI passes. Thanks!\n. Duplicate of https://github.com/sass/libsass/issues/1901 and already fixed in 3.3.4\n. Another similar failing case that works with #1978 \n``` scss\n\u00e4\u00f6\u00fc  {\ncolor: reds;\n}\n```\n. Closing as not reproducible. Might be already fixed, but you did not state which node-sass or libsass version you (embed-cli-sass) are using! Please always state the used libsass version in issues. Thanks!\n```\nError: Illegal nesting: Only properties may be nested beneath properties.\n        on line 2 of foo.sass\n\n\ndisplay: flex {\n\n-----------------^\n``\n. I opened [an issue](https://github.com/mgreter/sass2scss/issues/29) upstream at sass2scss.\nThe behavior doesn't seem to be [documented](http://sass-lang.com/documentation/file.INDENTED_SYNTAX.html) ...\n. @xzyfer ahem, this has not really anything to do with sass2scss!?\nSounds more thatstd::hash(false) == std::hash(0)` ...\nWhile this alone is easy to fix, we still do not handle hash collisions ...\n. ~~Created a simple fix that pushes the problem out of the way without really fixing it ...~~\nInvestigated a little more and we were only lacking the proper compare fn for c++11 maps.\n. Please provide more information on your env.\nYour make command seems not able to handle:\n\n\ncss\n$(DESTDIR)$(PREFIX):\n    $(MKDIR) $(DESTDIR)$(PREFIX)\nWhich should act as an \"ensure_exists\"!\nAnd you should use automake for system install, the make install is not really supported and mostly only there for convenience.\n. Please just use the automake build ...\nBTW. you didn't include any information at all like OS etc!\n. I recently tried it with mingw and native gcc/linux and it worked as expected. Closing this as it is unfortunately not possible to support each and every combination. We try to provide workarounds where possible, but it also is not so uncommon in general that Makefiles get patched for certain distributions. And as stated, for \"productive\" install we always recommend autotools!\n. This seems to be fixed on latest master.\n. Thanks for your report.\nWe didn't anticipate this edge case in selector schema evaluation.\nCheck out https://github.com/sass/libsass/pull/1999/commits/41ca027b40a209ff8462b9540bf257722370b580 and you may see why it failed ;-)\n. If you check the commits this is exactly what is happening here (see prelexer)!\n. If you check the commits this is exactly what is happening here (see prelexer)!\n. Just assumed, because the main reason why this change is that massive is because it is following ruby sass closely in the first place :wink: \n. Just assumed, because the main reason why this change is that massive is because it is following ruby sass closely in the first place :wink: \n. Just to be clear, I agree to follow ruby sass closely when it comes to the parser and the internal ast in general. But we can (and should) do better in libsass with manipulation and processing. I guess ruby sass choose to do quite a few operations (I'm specially refering to extend) in a monolithic approach. This makes sense in a language with dynamic function dispatching, since adding to many method calls in tight loops (code hotspots) can lead to bad performance. We don't have this constraint in c++ and should embrace the possibility of micro functions for selector manipulations. Another reason for that is that writing big monolithic functions in C++ (or any strict types language for that matter) tends to get tiresome, specially when a lot of loops are involved. But so far extend works and I don't want to touch any of that directly ported Node class if possible. Which reminds me of https://github.com/sass/libsass/issues/1392 ...\n. Never running out of edge cases sigh\n. Duplicate of https://github.com/sass/libsass/issues/1969 (found via search - please try to use it before opening new issues) and already fixed!\nBTW: your posted sample contains an small error and therefore doesn't compile!\n. I'm sorry, but I cannot reporoduce it\n. I would suggest to try to compile it with official ruby sass as it yields the same error!\nAnd it would have helped if you had included the link to your repo in the initial post!\n. This works correct for me if I save the input as valid utf8.\nI only see this if I save it with wrong encoding, so what should be done here?\n. The error happens because the byte sequence is found to NOT be valid utf8. So what should we do? This can happen because of invalid input but also if we do a substring not accounting for utf8 sequence (meaning there is a chance a multibyte utf8 character gets \"split in half\"). We cannot do much about the first and I only would count the later as a bug (fixed a few of them already, as with i.e. with error reporting).\nEdit: looks like we should just print Internal Error: Invalid UTF-8 but not segfault. This is the case if you create a file with the following content \\xB4 (\u00b4 encoded in latin1).\n. I got Internal Error: deque::_M_new_elements_at_front on the first run (now getting segfault too)\n. The segfault was easy to fix as most of the time (another missing check).\nIt was triggered by a recent refactor of mine and the results look \"promising\".\nlibsass 3.5.5+\ncss\nfoo {\n  bar: baz; }\nfoo a:not(.btn, foo) {\n  color: red; }\nfoo a:not(.btn, foo) {\n  color: red; }\nlibsass 3.3.2 (sassmeister)\ncss\nfoo {\n  bar: baz; }\nfoo a:not(.btn) {\n  color: red; }\nfoo a:not(.btn) {\n  color: red; }\nexpected\ncss\nfoo {\n  bar: baz; }\nfoo a:not(.btn):not(foo) {\n  color: red; }\nfoo a:not(.btn):not(foo) {\n  color: red; }\nSo it was silently dropping the :not(foo) selector, which means it could potentially break the expected css (if compared to ruby sass). Therefore I consider the now invalid css that is output more accurate, since it basically also shows that we now have the right selectors, but not in the correct form yet. And I'm pretty sure that is a duplicate of https://github.com/sass/libsass/issues/1960. I guess we simply need to expand wrapped selectors that contain a list (maybe restricted to some specific type).\n. Continued in https://github.com/sass/libsass/issues/2031\n. This is correct and intentional to match the output of official ruby sass compiler!\nBTW. & is a list and inspect converts it to a string (in a way it can be convert back).\n. OK, now you are on to something ...\nThe following is a bug in libsass:\nscss\nform {\n  sel: inspect(nth(&, 1));\n}\nCheck https://github.com/sass/libsass/issues/2020 for a workaround\n. Your sample (once I added the missing pieces) compiles correctly!\nClosing since no version was stated, so I guess it was not the latest!\n. Now take that snippet and enter into http://www.sassmeister.com/ to see what official ruby sass thinks about the code snippet (hint: the same as libsass does now). So this was fixed in libsass recently.\n. IMO I already seen the root for this before and I still consider it inconsistent behavior by ruby sass:\n```\nlist {\n  $p: (1,);\n  type: type-of($p);\n  parents: inspect($p);\n  $selector: nth($p, 1);\n  sel: inspect($selector);\n  type: type-of($selector);\n  $selector: nth($selector, 1);\n  sel: inspect($selector);\n  type: type-of($selector);\n}\nselector {\n  $p: &;\n  type: type-of($p);\n  parents: inspect($p);\n  $selector: nth($p, 1);\n  sel: inspect($selector);\n  type: type-of($selector);\n  $selector: nth($selector, 1);\n  sel: inspect($selector);\n  type: type-of($selector);\n}\n```\nlibsass vs ruby sass\n```\nlist {                   list {               \n  type: list;              type: list;        \n  parents: (1,);           parents: (1,);     \n  sel: 1;                  sel: 1;            \n  type: number;            type: number;      \n  sel: 1;                  sel: 1;            \n  type: number; }          type: number; }      \nselector {               selector {           \n  type: list;              type: list;           \n  parents: (selector,);    parents: (selector,);\n  sel: (selector,);        sel: selector;     \n  type: list;              type: list;        \n  sel: selector;           sel: selector;     \n  type: string; }          type: string; }    \n```\nIt looks like a special rule that complex selectors (converted to strings btw) are of type list, but are not printed as (%s,) as with other lists. I think I should be able to patch this, but we need a status flag on lists to indicate that special behavior. //CC @chriseppstein \n. I'm talking about\nscss\nselector {\n  inspect: nth(&, 1);\n  type: type-of(nth(&, 1));\n}\nwhich is rendered as\ncss\nselector {\n  inspect: selector;\n  type: list; }\nThe rule ought to be a list with one item is wrapped in (,). IMO that is an edge case to lists?\nThe rest should be exactly working as you eloquently put together above.\nSo once a selector list is listized we don't know if we need to wrap or not ...\n. Pretty much, so since selector lists go through listize and are converted to List, due to the fact that Selector_List does not have a compatible type with List for all operations, so it must be \"dumbed\" down at some point. So this lead me to https://github.com/sass/libsass/pull/2027/files#diff-e32073f4493a6826002eb5445599b762R875 to \"remember\" if a list is a listized Selector_List. This is also one indicator that it would probably make sense to refactor all list types (inclusive map) in one or more common base class(es). So we could actually attach this behavior to Selector_Lists in Output.\n. I guess this is hardcoded now and we figure out later when and how we gonna update/use it?\nIt probably should also be documented in https://github.com/sass/libsass/blob/master/docs/api-doc.md\nNote: I didn't search for other places it should be added in the documentation (was the first I found).\n. So this was also the root cause for https://github.com/sass/node-sass/issues/1464\n. Issue is marked accordingly, will do them all in a batch later\n. @xzyfer by the way how are new spec tests supposed to be added with the new spec test structure? I just saw that we now have multiple folders for libsass-closed-issues? //CC @chriseppstein \n. That's how I handled it for the missing spec tests (there are still some open with closed issues, but I should have covered all the simpler ones).\n. The following sample gives some insight what's happening behind the scenes:\nscss\ntest {\n  content: selector-extend(\":not(.foo)\", \".foo\", \".bar\");\n}\nyields\ncss\ntest {\n  content: :not(&.foo, &.bar); }\n. @xzyfer yes one, https://github.com/sass/libsass/pull/2001 should also be ready, there was only one issue with MSVC that I already fixed locally. Waiting for CI to catch up.\n. @xzyfer just to make sure, you are aware of the \"breaking\" change here? https://github.com/sass/sass/issues/2036. Reminds me I need to split the spec test I created.\n. This is because an early check was added in function call evaluation, since it was needed to avoid the evaluation of the arguments for calc functions (call(calc, ...)). The normal function evaluation has a very messed up logic to deduct the arguments for the ast node (Argument_List, restargs, etc). It probably makes sense to refactor the whole list handling including https://github.com/sass/libsass/issues/1930#issuecomment-213189134, instead of reimplementig the whole argument deduction logic for call invokations.\n. Bug happens here: https://github.com/sass/libsass/blob/master/src/eval.cpp#L842\n. This is a more complete spec test:\n``` scss\n$args: mix, #fff, #000, 20%;\n$params: #fff, #000, 20%;\n.foo {\n  test: call($args...);\n  test: mix(#fff, #000, 20%);\n  test: call(mix, #fff, #000, 20%);\n  test: call(mix, $params...);\n}\n```\nCurrently yields:\n.foo {\n  test: mix, #fff, #000, 20%...();\n  test: #333333;\n  test: #333333;\n  test: #333333; }\nExpected is:\ncss\n.foo {\n  test: #333333;\n  test: #333333;\n  test: #333333;\n  test: #333333; }\nSo we can probably get away here with one additional check. @xzyfer I also do not like to add such patches, but I see it as a legit way to add the needed behavior until someone (mostly me) gets around to do the actual refactoring. And it has proven to help to have these patches in place, specially if they are documented accordingly. The only small thing that worries me a little is that this pattern may break lazy evaluation as fixed in https://github.com/sass/libsass/pull/1986. To put it short we tend to get away with those patches quite far (and I do keep cleaning up after them).\n. Nice, that one seems to come together as anticipated:\nhttps://travis-ci.org/sass/libsass/jobs/125147994\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_100\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_1021\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_103\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_108\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_1086\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_1101\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_112\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_131\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_154\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_1583\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_1612\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_1651/with\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_167\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_1733\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_1803/nested\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_1898\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_192\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_1940\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_2009\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_201\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_2020\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_2023/id-selector-id\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_2023/id-selector-nr\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_2023/pseudo-selector-id\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_2023/pseudo-selector-nr\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_231\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_239\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_246\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_254\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_257\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_267\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_274\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_289\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_309\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_312\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_424\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_435\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_45\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_54\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_558\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_56\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_58\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_59\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_6\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_628\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_63\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_64\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_67\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_673\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_70\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_72\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_73\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_77\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_86\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_87\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-issues/issue_91\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-tests/errors/unicode/report/after\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-tests/errors/unicode/report/before\n/home/travis/build/sass/libsass/sass-spec/spec/libsass-todo-tests/zero-compression\n/home/travis/build/sass/libsass/sass-spec/spec/parser/interpolate/44_selector/double_escape/12_double_escaped_interpolated_value_todo\n. I wonder how much this increases coverage score ...\n. Pretty funky that we got 5 CI checks here :confused: \n. Damn, hit the wrong merge button. Well, nothing broken ...\n. ah, you're right, thanks :bulb: \n. Closing for now since all urgent issues are fixed atm.\n. This was quite probably changed with https://github.com/sass/libsass/pull/1986. Sorry about that regression, but as we can see this has not been covered by our spec test yet (failing is always a painful and steady way to progress).\n. Closing as this is now with upstream official sass.\nThis can be reconsidered by libsass once it is resolved with official sass.\nThanks for your understanding!\n. First :clap: for that bug report, pretty much on spot as we want them. If you take the time to replace D:\\Programs with ProgramFiles(x86) and install visual studio in a standard path (Microsoft Visual Studio 12.0 AFAIK) next time, I will officially nominate it for the bug report of the year :grinning: \nAlready getting late here, but will take a quick peek ...\n. Seems removing /GL (program optimization) makes the issue go away ...\nTo clarify, I'm getting segfault when optimization is enabled .. ok, see you have the same.\nSince you say it came with the newly added try, I suspect stack unwinding problems.\nThis is often related to compiler options, but too soon to say anything definite.\n. Yeah, because memory is probably more scrambled, so it is probably also easier to get segfaults via dangling pointers or buffer overruns etc. But I can already report that it is a dreaded, hard to spot \"issue\" we are actually not facing for the first time. Fix is underway, will write a bit more in the PR.\n. Yep, saw that one before with the memory management, where destructor was called in an odd ordering that lead to basically the same issue (same compiler).\n. Ah, now I remember, that is exactly the reason (AFAIR) why we have the SASS_MEMORY_NEW macro for allocation of new objects. That was this PR: https://github.com/sass/libsass/pull/1462 ... not 100% sure, but my gut says they have both the same common root.\n. When I enter your example into sassmeister, I get\ncss\na {\n  background: #00cdcb; }\nBut you seem to say you get\ncss\na {\n  background: #00cdcb;\n  color: #51a351; }\nCan you please re-check!\n. I opened an issue with sassmeister I think could have lead OP to assume output for sass 3.4.21.\n. Can you please describe a bit more in detail what you think exactly is broken with sourcemaps?\n. Your issue title says \"breaks soucemap\". I guess the other thing you mean has been answered multiple times here (search fontawesome) and is correct (please test against official ruby sass!).\n. This exhibits a tricky one that seems somewhat related to #1392:\nIt can also be triggered by this valid code:\nscss\n:not(.thing) {\n    color: red;\n}\n:not(.thing[disabled]) {\n    @extend .thing;\n    background: blue;\n}\nruby sass:\n:not(.thing) {\n  color: red; }\n:not(.thing[disabled]):not([disabled]:not(.thing[disabled])) {\n  background: blue; }\nThe problem is that libsass tries to extend .thing of the wrapped selector itself (and finds another @extend inside), so it goes in an endless loop until the call stack is exhausted.\nA related test case would therefore be:\nscss\n.thing {\n    color: red;\n}\n.thing[disabled] {\n    @extend .thing;\n    background: blue;\n}\nIt exhibits a similar problem as reported in #1392:\nruby sass:\ncss\n.thing, .thing[disabled] {\n  color: red; }\n.thing[disabled] {\n  background: blue; }\nlibsass:\ncss\n.thing, .thing[disabled] {\n  color: red; }\n[disabled].thing {\n  background: blue; }\n. The failing test can also be written as:\nscss\n:not(.thing) {\n    color: red;\n}\n:not(.bar) {\n    @extend .thing;\n    background: blue;\n}\nProduces:\ncss\n:not(.thing):not(:not(.bar)) {\n  color: red; }\n:not(.bar) {\n  background: blue; }\nBut should be:\ncss\n:not(.thing) {\n  color: red; }\n:not(.bar) {\n  background: blue; }\nI wonder if ruby sass actually just removes the invalidly nested :not selector.\nOtherwise from what I know about extend, the result in theory doesn't look incorrect!?\n. I forked out various tickets and this one now basically boils down to https://github.com/sass/libsass/issues/2056 !\n. This should now also fully pass\nscss\n:not(.thing) {\n    color: red;\n}\n:not(.thing[disabled]) {\n    @extend .thing;\n    background: blue;\n}\n@xzyfer I'm in favor of merging this in lack of any other solution. Sassmeister seems to indicate that this has segfaulted even at node-sass 3.3.6. This patch here at least seems to enable to most common cases with :not selector. As I said, I cannot really estimate the impact of the changes, beside trusting our spec tests. If you agree feel free to hit merge.\nhttps://ci.appveyor.com/project/sass/libsass/build/1.0.2426/job/5laspavt0upkreqb#L278\nThe following tests pass but were marked as TODO for libsass:\nC:/projects/libsass/sass-spec/spec/libsass-todo-issues/issue_2054\n. Input:\nscss\n.bar.baz {\n  @extend .bar;\n  background: blue;\n}\nExpected:\ncss\n.bar.baz {\n  background: blue;\n}\nCurrent:\ncss\n.baz.bar {\n  background: blue;\n}\nReason:\nruby\nif modified_original || !replace || groups.empty?\n  # First Law of Extend: the result of extending a selector should\n  # (almost) always contain the base selector.\n  # See https://github.com/nex3/sass/issues/324.\n  original = Sequence.new([SimpleSequence.new(members, @subject, source_range)])\n  original.add_sources! sources\n  groups.unshift original\nend\ngroups.uniq!. @chriseppstein @xzyfer I guess there are a few todo specs for this already in sass-spec, but probably not for very complex cases. To implement this properly (which will not be easy) we pretty sure need a more complete test set, containing tests as the following:\nscss\n:not(.thing) {\n    color: red;\n}\n:not(.thing[disabled]) {\n    @extend .thing;\n    background: blue;\n}\n:has(:not(.thing[disabled])) {\n    @extend .thing;\n    background: blue;\n}\nAt the moment it is very easy to trip off libsass with anything beside the most basic cases with wrapped selectors. This may even warrant a rewrite of extend, as it currently does not fit the rest of the libsass code base (implementation is a one to one conversion from ruby sass code)\n. Additional examples\n- https://github.com/sass/libsass/issues/2139\n- https://github.com/dlmanning/gulp-sass/issues/583\n. @chriseppstein hope it's ok to cc you here, but you might be able to come up with a few good spec tests to cover the parsing of pseudo selectors here!? Once we have that it should be quite simple to implement. It looks like an error we can directly raise in the parser. Of course the normal way for me is to look this up in ruby code directly, but then it mostly doesn't get additonal tests ;)\n. Probably a duplicate of https://github.com/sass/libsass/issues/2034\n. You are basically seeing https://github.com/sass/node-sass/issues/1460, read https://medium.com/@xzyfer/why-node-sass-broke-your-code-and-semver-1b3e409c57b9#.rzc21prvk for a more in depth explanation why we do not assume these to be breaking changes. Your sass was invalid and would not have compiled with official ruby sass either. Every release contains changes that have the potential of breaking your build if you do not make sure it compiles correctly and equaly with ruby sass and libsass. Some are just much more visible while others can silently happen without you noticing.\n. The message given is exactly the same as ruby sass. This project is an implementation of the Sass language. Our goal is to be 100% compatible with Sass. If you wish to suggest features or file bugs in the Sass language please open an issue with Sass - https://github.com/sass/sass\n. Seems to need some work on the autotools side. Have to test localy.\nMSVC should work with https://github.com/sass/sassc/pull/171\n. Note: with automake 1.15 we get a new warning:\nautomake-1.15: warning: possible forward-incompatibility.\nautomake-1.15: At least a source file is in a subdirectory, but the 'subdir-objects'\nautomake-1.15: automake option hasn't been enabled.  For now, the corresponding output\nautomake-1.15: object file(s) will be placed in the top-level directory.  However,\nautomake-1.15: this behaviour will change in future Automake versions: they will\nautomake-1.15: unconditionally cause object files to be placed in the same subdirectory\nautomake-1.15: of the corresponding sources.\nautomake-1.15: You are advised to start using 'subdir-objects' option throughout your\nautomake-1.15: project, to avoid future incompatibilities.\nThis happens also on before this PR. Unfortunately building sassc/tester fails if I enable subdir-objects also for the main makefile. For now I only enabled it on the src directory, since it is needed to build correctly for this patch as it makes sense to use a folder structure when spliting up big source chunks.\nI also looked at another warning, which seems to be a bug with autotools and GNUMakefile.am:\nhttp://www.archivum.info/bug-libtool@gnu.org/2008-11/00081/Re-libtool-version-2.2.6-only-checks-Makefile.am-for-ACLOCAL_AMFLAGS.html\n. As I said, haven't put much thought into the header includes.\nFor now I just made it work, so I agree this should be refined further.\n. IMO this can be moved over once such a CheckNesting visitor exists. I don't see a reason why this should not be correct, or can you come up with a non failing test?\n. Superseeded by https://github.com/sass/libsass/pull/2062\n. Other than my comments, LGTM!\n. LGTM!\n. This would probably also fix https://github.com/sass/libsass/issues/1585 if the check is added after the extend phase. I wonder why this check is called after each phase, shouldn't one at the end be enough?\n``` diff\n      Extend extend(*this, subset_map);\n      // extend tree nodes\n      root->perform(&extend);\n    }\n+    // check proper nesting of ast nodes\n+    root = root->perform(&check_nesting)->block();\n// clean up by removing empty placeholders\n// ToDo: maybe we can do this somewhere else?\n\n```\nEdit: made a short test and #1585 passes. Also verified that at least ATM the check seems only be needed at the end as a final phase (not sure if before or after removing empty placeholders makes more sense). I guess ruby sass probably has them in place after each phase, but I would like to know why exactly. I'll leave it up to you if you want to leave them in active or comment them out for now.\n. @xzyfer Can you elaborate where \"we maintain the ordering by keeping the keys ordered in a vector on insert\". I did not find any vector where we \"keep\" the insertion order, that is exactly why I have added \"deque\".\nEdit. Guess I should have looked more closely. Found it sigh\n. I also added the values to the \"vector\", since it should make it faster to iterate over values then by fetching each key from the hash map itself. It may also be more effecient to use deque instead of a vector. We can also easily implement optimal iterators over values and keys. To access keys or values you just have to multiply the index by two (and adding 1 for values).\n. I agree that direct key look up is the most important one, but I would like to guarantee that it doesn't degrade too much in worst case scenario. I need to make some performance assessments first, to determine if this is the case with repeated key access vs. random access via deque. IMO the memory overhead is very little compared to the actual data that is stored (4 to 8 additional bytes per item, so 1MB should fit 128k items on x64 arch). We do not have many places where this is currently used. On a first glimpse it seems to only be the case in map destructors and we could probably refactor that to use the iterator (no need to destroy in insert order).\nOn the other hand there are the C-API functions that basically have to traverse a map in this way if they need to do so. It seems that i.e. sass_map_get_value etc. are broken anyway currently, since it returns v->map.pairs[i].value (i of type size_t). It looks the performance implications for access by key are \"Average case O(1), worst case O(size()).\". I figure that depends on how well our hash function avoids collisions. On the other hand each access via keys has to go through the hashing function. So there is always a constant overhead for that. But as I said, not sure how that translates to real world scenarios, so again not sure if the memory/cpu tradeoff is worth it.\nBut I think it probably makes sense to use \"deque\" instead of vector in \"Hashed\", as appending stuff is cheaper for deque and random index access is also O(1). There are always pros and cons.\n. ~~You are missing a function added in https://github.com/sass/libsass/pull/2021 and is not related to LIBSASS_VERSION. It seems you try to link against an older library version than your source is expecting. But you give too little info to speculate why.~~\n. Missread the original post to mean libsass_language_version. Sorry about that confusion, so it seems to be some linking problem. I suggest you open an issue with them directly and provide the requested information as per their contribution guide, there is nothing we can do on libsass side here.\nBTW. I don't know why you mention \"autotools\", but that has nothing todo with node-sass AFAIK.\n. LGTM, but as I wrote earlier, It doesn't serve much use for libsass ATM, until we start to actually implement different language versions. Although we are pretty close to sass 3.4, the underyling code is really not ready to move on to 3.5 atm. (let aside suporting multiple versions of the language) There are just too many places where implementiation differs from sass implementation. We do try to get these in line with ruby sass, but here are a lot of subtile differences where I personaly don't know how to implement the behavior 100% correctly in libsass (even after looking at the sass/ruby code). So for these cases we either need someone who knows the sass specs inside out and can provide fixes for the C++ code. But for now I think we'll be stuck with sass 3.4 for quite a long time ... so LGTM!\n. @xzyfer https://github.com/sass/libsass/issues/1392 for example ... I don't know why this is different than in ruby sass ...\n. Seems I messed this up when updating the documentation pages. Thanks @am11\n. Tried your sample, but cannot reproduce:\n- rem mixin is missing in your sample\n- libsass 3.5.5 does not exist (latest is 3.3.6)\n- Dumbed down sample does not exhibit what you report.\nFeel free to re-open when you can post a reproducable sample. Thanks.\nNote: just remembered that I deliberately had put 3.5.5 into the issue template, so I can recognize if people do not adjust/update that info accordingly. Probably should do the same for sass version.\n. This is already fixed on master and will be in the next LibSass release.\n. Overall: LGTM.\nFrom what I see in the code, the Trace AST is pretty tightly coupled to mixins, so maybe TraceMixin would be a bit more clear about that. And it might make sense to only store the pointer to the mixin c instead of a string from c->name()?\nI will add some additional minor nitpicking directly to the code in this PR ...\n. @xzyfer so the name is actually not used so far? Leaving the Trace to basically be a Block node with some special meaning (as in being a result of a mixing call)?\n. @xzyfer I fail to see what the \"metadata\" is ... maybe you can elaborate a bit more on that.\n. OK, so it is pretty much the same thing I need for exposing import stack on C-API. After imports are resolved (in eval) we have the full AST Tree with Function_Call and once that call is evaluated, the context from where these calls were imported is lost (since it is not preserved in the AST Tree). So the easiest approach that came to my mind was to add an AST Node just to preserve that information, which is basically the same as here from what I get from your explanation ...\n. OK, that clears some things up. I will see if I can re-use the Trace Node for what I need with imports. BTW I'm aware of the situation with the various StackTraces. We have something in Env and also various stack objects in various phases. I think we should refactor and unify all these cases in one smart class that can be easily handled and queried. But I think we first need to add the traces feature for the imports and (custom) functions. This work should also include the --trace cli option then.\n. Nice work! Thx for that PR!\n. This will be fixed in upcoming version. For reference, here the test I've run:\nscss\ngit clone https://www.github.com/mgreter/libsass --branch bugfix/source-mappings\ngit clone https://www.github.com/sass/sass-spec\ngit clone https://www.github.com/sass/sassc\nCC=clang CXX=clang++ CFLAGS=\"-fsanitize=address -fno-omit-frame-pointer\" CXXFLAGS=\"-fsanitize=address -fno-omit-frame-pointer\" LDFLAGS=\"-fsanitize=address\" make -C sassc -j8\nruby sass-spec/sass-spec.rb -V 3.4 --impl libsass -c sassc/bin/sassc -s sass-spec/spec\nNo error were reported after applying https://github.com/sass/libsass/pull/2216\n. IMO this should be reverted.\na) previously we used the names as given by the css spec\nb) comments and variables still refer to the original name (i.e. https://github.com/sass/libsass/pull/2101/commits/97e62000ea13317462f19c2c48f07015d4e8dc9c#diff-538f09861f9c693b01b52256a90829c9R1821)\nc) sass dart also opted to use the official names: https://github.com/sass/dart-sass/blob/master/lib/src/ast/selector/complex.dart#L25\nd) CommaSequence_Selector is really not an intuitive replacement for Selector_List\n@xzyfer do you agree on this? Please don't do this already. I'm currently trying to implement a reference counted memory implementation and will do the renaming in that commit. If we do it now on master it will give me a major re-basing headache! Thx!\n. @xzyfer I think we do not have the same understanging of what a \"hindrance\" is. For me changing/renaming the 4 main selector classes is really like learning a new language patois. I've become used to the original names and had to lookup which new name represents what class pretty much every time. That's why one of the first things I did to pull off https://github.com/sass/libsass/pull/2222 was to rename these to their names as they have always been in libsass. I pretty much beg you to return to the original way as it always has been in libsass. I really don't see any benefit to keep it \"closer to the reference implementation.\"! Thanks!. Works as expected with\n``` cmd\nsassc --version\nsassc: 3.3.6-8-g1949\nlibsass: 3.3.6-28-g9a3f\nsass2scss: 1.0.6\n```\n. Closing as not reproducible.\n. Thanks for the report, this should be fixed with next upcoming version!\n. This does not compile in ruby sass either:\nError: Invalid CSS after \"(only screen \": expected \")\", was \"and (min-width:...\"\n        on line 6 of foo.scss, in `aspect-ratio'\n        from line 12 of foo.scss\nPlease reopen if you can provide a sample that compiles in ruby sass but does not so in libsass. Thanks.\n. http://www.cpantesters.org/cpan/report/276835f4-40a5-11e6-8807-814d1da4c10f\nhttp://www.cpantesters.org/cpan/report/739e97e8-4068-11e6-8807-814d1da4c10f\nhttp://www.cpantesters.org/cpan/report/958a4a1e-402c-11e6-8807-814d1da4c10f\n. @xzyfer this is a compiler edge case and only happens if the hash table implementation puts both keys in the same bucket for some reason (it should not). This is not the case in any of libsass' CI envs. I only saw it with some compilers and perl cpan \"CI\" (see links above).\n. I don't really agree that it is invalid for libsass to output multiple source mappings for the same token, as such a token could be passed through multiple functions. Furthermore the \"duplicate\" you see is another \"feature\" we've added in response to https://github.com/sass/libsass/issues/1747 (if you mean the ones before a b {).\nThe draft for SourceMap V3 unfortunately leaves a lot open in this regard ...\n. Agree with your conclusions. Not much libsass can do for now.\nThanks for your time to research and debug this.\n. Fixed by https://github.com/sass/libsass/pull/2387. Libsass doesn't do anything with the srcmap parameter yet. It was added so we don't have to deprecate the C-API once we start using the srcmap parameter. The idea behind would be to re-map the actual sourcemap with the provided ones. Unfortunately that is not yet implemented in libsass. Agree that it could be more clearly documented (as a lot of other stuff).\n. The c-string you pass is actually stored in https://github.com/sass/libsass/blob/master/src/sass_functions.hpp#L18. srcmap_links contains paths to source files for the current sourcemap AFAIR.\n. @schneems does the info by @am11 above resolve your issue?\n. Thanks @IanMitchell for this patch. I found that it still fails the following cases:\nscss\nfoo {\n  test-11: str-slice('a\u00f6c', 0, -3);\n  test-12: str-slice('a\u00f6c', 1, -3);\n}\nThis should be addressed by https://github.com/sass/libsass/pull/2136\n. Closing as duplicate of https://github.com/sass/libsass/issues/2055. I'm aware that extending wrapped selectors, :not is only one example, was never handled correctly by LibSass so far! We just started to \"somewhat\" support it.. This needs more work on how we internally handle options. AFAIR we free some resources from options in context, which can lead to other (rather small) memory leaks.\n. Fixed with https://github.com/sass/libsass/commit/73395b3477c060f864f12f3de5ee8ea474812577\n. This issue doesn't seem to be handled 100% correctly by ruby sass either. At least our spec runner does not seem to be able to catch it correctly (//CC @chriseppstein @xzyfer).\n. Duplicate of https://github.com/sass/libsass/issues/2143\n. Thanks for the report. This is already fixed on master. \n```\n$ psass sass.scss\nError: Illegal nesting: Only properties may be nested beneath properties.\n        on line 3 of sass.scss\n\n\n@media (min-width: 30em) { top: 1em; }\n\n----^\n\n\n$ psass -v\npsass 0.4.0 (perl sass/scss compiler)\n  libsass: 3.3.6-87-gf96ec465\n  sass2scss: 1.0.6\n```\n. IMHO this is to be expected. The char you get in the compiled output is equivalent to the escape sequence. This has IMO come up multiple times also in original Sass, as in https://github.com/sass/sass/issues/1395. I'll close this issue as the output is the same as with ruby sass!\n. Closing with https://github.com/sass/sass-spec/pull/1232. Seems to be a duplicate of https://github.com/sass/libsass/issues/2153\n. The main rendering is done by the output emitter (see the render function in context.cpp). Maybe you have better luck by posting this to stackoverlow. This here is a bug tracker, so I hope you're not mad if I close this.\n. @xzyfer thanks, didn't see it. IMO it would be worth to ammend the original issue report with such information or additional test cases, since it was not that easy to spot.\n. I ended up removing the hoistable flag completey. I don't know what the purpose of hoistable was or why it would be needed. I couldn't find anything \"hoist\" related in ruby sass code ...\n. IMO exit status is signaled by sassc: https://github.com/sass/sassc/blob/master/sassc.c#L62\n. Implemented with https://github.com/sass/sassc/pull/215. The mapping to OS semantics should be done in sassc. The code 65 means \"ERROR_NETWORK_ACCESS_DENIED\" in windows. Therefore this should go completely to sassc (just return 65 as exit code there if a libsass error occured). \n. IMO we should keep it as it is in libsass (it is already agnostic). I think this is something implementers have to do. I think we can give the recommendation, that if libsass return an error code of 1, the corresponding OS exit codes should be 65 on POSIX compatible OSs (*nix) and 13 on Windows.\n. Closing for now. Please provide more precise information about the issue in question. Thanks!\n. This would be ready but is currently blocked by https://github.com/sass/sassc/issues/187 (local MSVC tests pass)\n. Closing since ruby sass 3.5.6 output is the same:\nscss\n.button-left:after,\n.button-right:after,\n.button-plus:after,\n.button-min:after, .banner:after, .calculator .btn-down:after,\n.calculator .btn-up:after {\n  text-indent: -999em; }. The problem is the following line in the CSS:\n@import 'C:\\Users\\hbetts\\Workspace\\node-sass-windows\\app\\components\\components.scss';\nThe whole issue can be simplified to:\nmain.scss:\nscss\n@import '.\\inc.scss';\ninc.scss\nscss\nresult { success: true; }\nsassc:\n``` cmd\nsassc main.scss\nError: File to import not found or unreadable: .inc.scss\n       Parent style sheet: d:/lbstst/main.scss\n        on line 1 of main.scss\n\n\n@import '.\\inc.scss';\n```\n\n\nruby sass:\n``` cmd\nsass main.scss\nError: File to import not found or unreadable: .inc.scss.\n        on line 1 of main.scss\n  Use --trace for backtrace.\n```\nClosing as we behave as ruby sass does. I don't think it makes sense to have special parsing grammar just for unwrapped import statement (since it would contradict basic css parsing rules for escape sequences). But feel free to open a Feature Request with ruby sass if you think this should be possible.\n. Updated the test to also include all? other similar statements:\n``` scss\n$bar: true;\n@mixin mixin() {\n    mix: in;\n}\n@mixin include() {\n    @content;\n}\np {\n    @at-root {\n        @if $bar {\n            #if {\n                height: 100px;\n            }\n        }\n        @if (not $bar) {\n        } @elseif($bar) {\n            #elseif {\n                width: 100px;\n            }\n        }\n        @if (not $bar) {\n        } @else {\n            #else {\n                width: 100px;\n            }\n        }\n        @for $i from 1 through 1 {\n            #for {\n                foo: bar#{$i};\n            }\n        }\n        $i: 0;\n        @while ($i == 0) {\n            $i: $i + 1;\n            #while {\n                foo: bar#{$i};\n            }\n        }\n        @each $i in (1) {\n            #each {\n                foo: bar#{$i};\n            }\n        }\n        #inc {\n            @include mixin();\n            @include include() {\n                inc: lude;\n            }\n        }\n        @supports (display: flex) {\n            display: flex;\n        }\n        @foo {\n           bar: bat;\n        }\n    }\n}\n```\n. My bisect shows the regression happened much earlier in 734668f1803bc7ad5315f05bc026a1a2d593349a\nIt basically boils down that I did not anticipate the following sass behavior (3.4.22):\nscss\nh1 {\n  delayd: #{5% / 2};\n  delayd: #{+5% / 2};\n  evaled: #{-5% / 2};\n}\ncss\nh1 {\n  delayd: 5%/2;\n  delayd: 5%/2;\n  evaled: -2.5%;\n}\n. My bisect shows the regression happened much earlier in 734668f1803bc7ad5315f05bc026a1a2d593349a\nIt basically boils down that I did not anticipate the following sass behavior (3.4.22):\nscss\nh1 {\n  delayd: #{5% / 2};\n  delayd: #{+5% / 2};\n  evaled: #{-5% / 2};\n}\ncss\nh1 {\n  delayd: 5%/2;\n  delayd: 5%/2;\n  evaled: -2.5%;\n}\n. In terms of json this is a noop. From http://www.rfc-editor.org/rfc/rfc7159.txt:\n\nAn object is an unordered collection of zero or more name/value\n  pairs, where a name is a string and a value is a string, number,\n  boolean, null, object, or array.\n\nSo this should not have any impact on stuff that works according to the json specs. The current srcmap spec draft (SourceMaps V3 is IMO still just a proposal/draft) only mentions the version explicilty to be the first entry (which by itself goes kind of counter the json specs), but AFAIR libsass should adhere to this as IMO our json generator keeps the ordering of keys.\n. Code is much slower in debug mode (no code optimizations), therefore the tests take too long. I guess the fluctuations are due to the shared resources of the appveyor CI hosts (they probably also tweak the settings from time to time). Normally we sit this out; otherwise we need to disable the test.\n. As i said the code is really really really much slower in O0 vs O2 ;) It really just timed out, pretty positive about that.\n. If you really want to check you need to run the debug build against the spec yourself. The only other reason could be some assertion that is triggered, but AFAIR this should no longer halt the CI (I remember that I fixed that some long time ago).\n. Got me thinking and this might be again https://github.com/sass/libsass/pull/1883 \ud83d\ude44 \n. @xzyfer I think we just don't see the dots progressing as the output is probably buffered ...\n. @xzyfer if you want to merge this later anyway, you might as well merge it right now! I have nothing against it, as it doesn't make a difference, and the new order seem reasonable regarding the sepcs-drafs-proposal.\n. I've added the necessary bits to libsass in https://github.com/sass/libsass/pull/2220\nbool sass_option_get_source_map_file_urls (struct Sass_Options* options);\nvoid sass_option_set_source_map_file_urls (struct Sass_Options* options, bool source_map_file_urls);\n. @nex3 @chriseppstein is there a reason why ruby sass 3.5.5 still has this \"unexpected\" behavior? I believe this stems from static value parsing in ruby sass? Any plans if this will change in future versions? And if so, in what direction, leave it as is, or evaluate it as libsass currently does?. I wrote a lengthy response for your pull request in https://github.com/sass/libsass/pull/2208.\nAgree that this is a valid issue as it is probably more usefull to point inner scope and not the outer here. As mentioned in the linked response I could imagine even more detailed mappings as wrapping the whole selector first and then have mappings for each part (parent and postfix). The possibilites would be nearly endless. But for now libsass cannot handle this anyway, as each token can only hold one start and end mapping (via ParserState). Once the final selector .foo-bar is created we have to decide which mapping we want to keep around. Which is also the place where to fix this issue.\n. I tried your provided archive and got no error: \"app works!\"\nMaybe you are exhausting your memory (Seems to be https://github.com/sass/libsass/pull/2171)?\nSo for me this is not reproducible ...\n. Going to close this for now, as I have successfully tested it on windows and linux.\n. I can confirm this is an upstream problem with the provided binary by node sass.\n=> https://sourceforge.net/projects/vbimages/?source=typ_redirect\n```\napt-get update\ncurl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -\napt-get install git curl nodejs g++\nwget https://github.com/sass/node-sass/files/503210/reduced-test.zip\nunzip reduced-test.zip\ncd myproject\nnpm install\nnpm start # fails\ncd node_modules/node-sass\nnode scripts/build -f\ncd ../..\nnpm start # works\n```\n. First thanks for your contributions. For some background info on sourcemaps. They were first implement in https://github.com/sass/libsass/pull/207. I have then further improved it begining with https://github.com/sass/libsass/pull/591. Since then no real cleanup has been done, as the initial applied architecture proved to have some unexpected issues, therefore the state of sourcemaps have always been kind of unknown.\nI guess you mostly relate your expectations regarding sourcemap according to how gemini-coverage behaves? IMO sourcemaps V3 is still just a draft/proposal and I'll try to explain why libsass creates the sourcemaps as it currently does. We had lengthy discussions (//cc @am11) if we want to create just a very basic sourcemap (as ruby sass does) or a more elaborated one (as less does). We decided to try the second.\nI also already want to point out that sourcemap has no concept of opening and closing mappings. AFAIR there is no concept of \"enclosing\" ranges for sourcemaps. Libsass does not output evenly distributed pairs of start-end mappings (explanations why this is follows).\nscss\n.foo { // maps to line 1\n  background: red;\n  &-bar { // also maps to line 1\n    background: green;\n  }\n}\nSourceMap Inspector (click [inspect] and use keyboard arrows to navigate)\nGoing to try to explain the mappings libsass produces (see it in the inspector linked above): As @xzyfer already pointed out, we added one crutch to libsass (you can read up that in the linked issue) which causes a duplicate starting mapping (AAAA). Afterwards we have a start-end mapping for the .foo selector (AAAA,IAAI). Last comes a single mapping for the scope opening bracket (CAAC). Next line is a simple declaration (EACH,UAAU,EAAE,GAAI,GAIjB;). Third line has the parent selector. This is actually also just a duplicate start mapping (the first one is the duplicate: EALD, the second one the start mapping: AAAA). Then comes the closing map back to .foo selector (parent reference: QAAI). Last mapping (CAEI) again is a single scope opening bracket. Last line is just another simple declaration (IACJ,UAAU,EAAE,KAAM,GACnB).\nI agree that we could argue if the mapping for the parent selector should point to where the & was or from where the actual selector in the output is comming from (libsass does the second).\nIMHO this is a perfectly valid mapping according to the specs. We tried to do our best to get the best support for browsers. And different tools may take different assumptions. So why does libsass not output even sizes start-end position mappings? One reason is ie. how we could map variables. In theory we could add mappings for every variable, number etc. that was involved in creating the final output\nresult. Same analogy goes for parent selectors. I don't see a reason why the SourceMaps V3 proposal would not allow that, but I clearly see the problem that arises with it for tools that try to interoperate with each other. And since the SourceMap V3 draft is really just a proposal for now (and still evolving), we have the tendency to keep it as is for now, until the specs are final.\nI just re-scanned the proposal and it seem that at least the following was added since a last read it (not sure if it addresses the issues we face here, namely that a lot is still not specified):\n\nIndex map: supporting post processing:\nTo support concatenating generated code and other common post processing, an alternate representation of a map is supported ... The sections must be sorted by starting position and the represented sections may not overlap.\n\nAnother example why getting it right is difficult: Take the selector &-bar (becomes .foo-bar). After evaluation we could have a mapping for & to .foo and one for -bar. If we would do that, the first mapping would point to the outermost scope, which would lead to https://github.com/sass/libsass/issues/1747 (unuseful mapping in browsers).\nUnfortunately your other examples can also be explained and do IMO not violate against the current SourceMap draft. IMO you can only call the behavior of libsass buggy under certain assumptions which are IMO not given by the current spec. Not sure if one interpretation of the current proposal by one tool is enough to change the current behavior by libsass (since the mappings are IMO technically correct, beside the mentioned crutch we had to add for browsers, and beside the few obvious missmaps, but they are mostly just in col and not in line).\nscss\n$color: green;\n.foo {\n  background: $color; // starts in line 3, ends in line 1\n}\nSourceMap Inspector (click [inspect] and use keyboard arrows to navigate)\nThis one might actually contain one wrong mapping\nscss\n.foo {\n  background: red;\n  .bar {\n    background: green;\n  }\n}\nSourceMap Inspector (click [inspect] and use keyboard arrows to navigate)\nThis one has a wrong col offset mapping for \"screen\".\nscss\n.foo {\n  background: red;\n  @media only screen {\n    background: green;\n  }\n}\nSourceMap Inspector (click [inspect] and use keyboard arrows to navigate)\nIn regard to @return, @warn, @debug: they should never make their way to the output phase. This is just in place if an AST is rendered before the final cssize stage. It's just consistent with all the other items that can be inspected.\nSorry to not have any better news. I really really appreciate your effort. I know that going through libsass source code is not an easy thing and we are in need of good c++ coders here, so I would have hoped for a better outcome. Of course feel free to rebuttal, but I hope we can agree that the main ground should be the SourceMap V3 Proposal. We do tend to follow what browsers do if necessary, as they are really the 1st customers of sourcemaps. So unfortunately I have to decline this PR. Maybe @xzyfer or @am11 see it different. IMO to consider this, the tool in question would need to have a very broad user base, which gemini-coverage doesn't seem to have yet.\nThis pretty much sums up all the information I have about the state of libsass sourcemaps.\nI thought you deserved a thorough answer for your effort!\nWith my very best regards\nMarcel\n. I have create https://github.com/sass/libsass/pull/2216 which should address your issues.\n\nThis is perfectly fine and I understand the concept. Maybe I did not make it clear enough in my explanation. However, the name of the functions add_open_mapping and add_close_mapping might be irritating to the unaware reader.\n\nThese make sense in terms of how we parse stuff, as there we always have a start and end position, that's why these methods were named that way. Since then the code has evolved and doesn't fit well together in all ends. This works well for tokens that are parsed with one lex call. But doesn't work so well for containers. That's why I said that the whole thing would need a refactoring so everything makes sense together again. Nonetheless it is quite workable and stable, if one knows where to look exactly (debug_ast ist a big help as it shows you the mappings for every node).\n\nThis is wrong, because .foo-bar does have nothing to do with .foo - those are two entirely different selectors. For this reason the way libsass does it currently is wrong.\n\nI disagree, since .foo-bar was generated from &-bar, so technically two tokens (.foo and &-bar) are the sources for the final output. Therefore it seems valid to map the .foo part to .foo and the -bar part to &-bar. But this is not possible for libsass atm, since the generated node .foo-bar can only hold a start and end mapping in libsass. But I think the general idea is valid and I could imagine browsers to support this one day (see the following screen that illustrates the same idea for back#{$ground} - ctrl click on properties in chrome inspector):\n\nI think with https://github.com/sass/libsass/pull/2216 all the reported issues should be solved. There are probably quite a few other places that would need similar fixing. I guess https://github.com/sass/libsass/pull/2216 should show a few ways how to fix such sourcemap issues. Most should have similar causes as either not having the right mapping after parsing or that we don't update the mappings after operations.\n. Merged https://github.com/sass/libsass/pull/2216\n. Here you go: https://github.com/sass/perl-libsass/wiki/Standalone-Executable-and-MSI-Installer\n. Libsass and sassc installer is here => http://libsass.ocbnet.ch/installer/\nArtifacts directly from CI => https://ci.appveyor.com/project/sass/libsass-msi-installer\nBuilt via => https://github.com/mgreter/libsass-msi-installer\n. Seems reasonable. @parhs Mind PRing and testing sassc too?\n. Currently running valgrind over all spec tests (could take a while):\n``` perl\nuse strict;\nuse warnings;\nuse IPC::Run3;\nuse File::Find::Rule;\nmy $root = \"libsass/sass-spec/spec\";\nmy @files = File::Find::Rule->file()\n            ->name('input.scss')->in($root);\nforeach my $file (@files) {\n  my $cmd = sprintf('libsass/sassc/bin/sassc %s', $file);\n  my $check = sprintf('valgrind --leak-check=yes %s', $cmd);\n  run3($check, undef, \\ my $out, \\ my $err);\n  next if $err =~ m/in use at exit: 0 bytes in 0 blocks/;\n  warn \"got a leak $? !!\\n\", $err, \"#\" x 80, \"\\n\";\n}\n```\n. No further leaks detected via valgrind (ran all spec tests via the script from above). Doesn't say there still exist some more leaks on the C-API level or anywhere else for that matter \ud83d\udc1b \n. IMHO to slow for CI, probably even takes too long for CI to complete.\n. I think we might need one or two fixes from here as I saw some regressions not catched by CI.\n. > As for 869a51a, is there a spec for what this is addressing? I should be in it's own PR.\nSorry, but I don't understand this? Did you mean issue? If so, no there is not!\n. It may address the same as you fixed lately though ... it's tagged WIP for a reason\n. thx @nschonni. Fixed the formatting and typo!\n. Hmm, https://github.com/sass/libsass/commit/f8d9decfdf860d4c91a4ec29cc17b62c80c445db saves me 1 minute compile time. But whatever ...\n. @xzyfer the order is not really important as long as all files are listed. If a file is missing it will fail in CI as functions will be missing in the executable. I don't see any danger at all here!\n. And it was as unclear where to add files before as it is now. The order is now even a bit more logic as I grouped the related stuff together where possible. I just needed to move the bigger files more to the top, so I don't end up with one as the last compile unit.\n. I'm ok with adding a comment, but the order is the best as it is now. It is a compromise between having the biggest compile units on top without generating a too heavy memory peak (it's distributed more evenly).\n. ~~Paths by sass don't seem to be relative to CWD. That makes it harder to implement correctly ...~~ \n. Retested again and it seems to be inline with ruby sass. Original test case here was not very clear where the import is as the contents of each file were not given.\n. Well, it looked like a compiler bug to me from the begining. You might be right about the inlining though. Somewhat didn't think of it when I created the \"sass_copy_string\" function. Maybe you can change it somehow to not expose this issue (eg. __declspec(noinline))? I somewhat suspect this strange behavior to be related to try catch, as I think I've only see this in error cases (similar stuff happened when we got an exception in overloaded new operator).\n. If the fix by @asottile works (https://github.com/sass/libsass/issues/2221#issuecomment-255781546) we should just do that. I (and I'm pretty sure @asottile too) have tried quite some time to understand why this is happening. I fail to see why this even should/could happen (as statet, it looks like a compiler bug to me). Maybe a MSVC guru could enlighten us, but so far none has shown up.\n@am11 IMHO debug mode does not only output pdb files, but also enables i.e. assertions in STL containers. Therefore I highly recommend to use release mode for actual releases, due to possible massive performance decrease by debug builds.. @am11 I agree and actually like the debug assertion checks for testing, but unfortunately this seems to be quite a heisenbug. It's hard to trigger reliably and even harder to do so in a reduced test case. I myself am more familiar with GCC, so we pretty much lack the expertise here. Not sure if it is a compiler bug, just saying that my gut feeling sofar tells me that :)\nMy educated guesses for this issue are based on that they tend to crop up when some error is catched and I've sofar (AFAIR) only saw it in relation to sass_context, which could indicate some issue with \"extern C\" and/or dll boundaries (I don't see how, but that at least would somewhat explain the strange behavior). But in the end this doesn't really make sense to me. I would expect a lot of other places where this should have cropped up.\nAnyway, we did similar fixes in the past. Although I was able to see the logic in the ones we've made before. So we should at least change the pattern in said cpp file to take an explicit stack variable for the string from a stringstream before passing it into a function.. @am11 \ud83d\udc4f I have confirmed with 4 compiles (2 with /Ox /O2, 2 with /O1) and can confirm your observations. Really appreciate your effort. I really started to doubt my understanding of how C++ is supposed to work. So thanks for saving my sanity by finding the culprit. Still strange/interesting to find out why it manifests in the issue we see here.\nEdit: Running VS2015 Update 3.. I have probed some more compiler option variations:\nfails:     /Zi /c /O2 /W3 /GL /DNDEBUG /EHsc /MT\nworks:     /Zi /c /O2 /W3 /GL /Ob0 /DNDEBUG /EHsc /MT\nworks:     /Zi /c /O2 /W3 /DNDEBUG /EHsc /MT\nworks:     /Zi /c /O2 /W3 /GL /EHsc /MT\nFrom the pattern above it seems that it has to do with function inlining (/Ob0) but can also be fixed by keeping debug assertions (/DNDEBUG), which seems to make sense when we also generate debugging information (/Zi). It also works if global optimization accross compile units is removed (/GL).\nThe conclusion for me is that you should not optimize debug builds too much. This can be usefull if you i.e. want to do performance profiling for actual release builds. But for regular debug builds I normally disable optimization explicitly, as I want to be able to step through every function call and not have certain calls optimized out.. Progressed at https://github.com/mgreter/libsass/tree/poc/memory-ref-count\nGot a working end to end POC for the following sample:\nscss\nfoo {\n  @for $i from 0 to 1000000 {\n    $q: $i !global;\n  }\n  bar: $q;\n}\nThis now uses a constant amount of memory (~14MB), while the old version had a peek ~210MB.\n. This is getting close the be ready to be merged. Put a lot of effort into it for the last month (100h+) and it seems feasible now. I changed a lot of stuff on the road and still have some major refactoring on the roadmap until this work is ready.\n. @chriseppstein the memory usage will improve significantly. Other than that there is not much more benefit to it, as we currently just record each memory allocation and delete it once the whole context is gone (therefore accumulating a lot of temporary and intermediate memory chunks, but not leaking any memory either). This may also have some minor performance drawbacks, since keeping the reference counter does involve some costs. But I hope in the long run we can re-gain that by having a more clear memory management (i.e. by avoiding unecessary cloning).\nBTW. the current state of this PR is stable in terms of the spec-tests. According to my internal memory tracking, there are no leaks and there shouldn't be any dangling pointers. Nonetheless I'm quite sure there are still some edge cases that may leak some memory. Indicating that we lack a spec test for these cases.. Created a first draft for some documentation.\nLibSass smart pointer implementation\nLibSass uses smart pointer very similar to shared_ptr known\nby Boost or C++11. Implementation is a bit less modular since\nit was not needed. Various compile time debug options are\navailable if you need to debug memory life-cycles.\nMemory Classes\nSharedObj\nBase class for the actual node implementations. This ensures\nthat every object has a reference counter and other values.\nc++\nclass AST_Node_Impl : public SharedObj { ... };\nSharedPtr (base class for SharedImpl)\nBase class that holds on to the pointer. The reference counter\nis stored inside the pointer object directly (SharedObj).\nSharedImpl (inherits from SharedPtr)\nThis is the main base class for objects you use in your code. It\nwill make sure that the memory it points at will be deleted once\nall copies to the same object/memory go out of scope.\nc++\nClass* pointer = new Class(...);\nSharedImpl<Class> obj(pointer);\nTo spare the developer of typing the templated class every time,\nwe created typedefs for each available AST Node specialization.\nc++\ntypedef SharedImpl<Number> Number_Obj;\nNumber_Obj number = SASS_MEMORY_NEW(...);\nCircular references\nReference counter memory implementations are prone to circular references.\nThis can be addressed by using a multi generation garbage collector. But\nfor our use-case that seems overkill. There is no way so far for users\n(sass code) to create circular references. Therefore we can code around\nthis possible issue. But developers should be aware of this.\nThere are AFAIR two places where circular references could happen. One is\nthe sources member on every Selector. The other one can happen in the\nextend code (Node handling). The easy way to avoid this is to only assign\ncomplete object clones to these members. If you know the objects lifetime\nis longer than the reference you create, you can also just store the raw\npointer. Once needed this could be solved with weak pointers.\nAddressing the invalid covariant return types problems\nIf you are not familiar with the mentioned problem, you may want\nto read up on covariant return types and virtual functions, i.e.\n\nhttp://stackoverflow.com/questions/6924754/return-type-covariance-with-smart-pointers\nhttp://stackoverflow.com/questions/196733/how-can-i-use-covariant-return-types-with-smart-pointers\nhttp://stackoverflow.com/questions/2687790/how-to-accomplish-covariant-return-types-when-returning-a-shared-ptr\n\nWe hit this issue at least with the CRTP visitor pattern (eval, expand,\nlistize and so forth). This means we cannot return reference counted\nobjects directly. We are forced to return raw pointers or we would need\nto have a lot of explicit and expensive upcasts by callers/consumers.\nSimple functions that allocate new AST Nodes\nIn the parser step we often create new objects and can just return a\nunique pointer (meaning ownership clearly shifts back to the caller).\nc++\ntypedef Number* Number_Ptr;\nint parse_integer() {\n  ... // do the parsing\n  return 42;\n}\nNumber_Ptr parse_number() {\n  Number_Ptr p_nr = SASS_MEMORY_NEW(...);\n  p_nr->value(parse_integer());\n  return p_nr;\n}\nNumber_Obj nr = parse_number();\nThe above would be the encouraged pattern for such simple cases.\nAllocate new AST Nodes in functions that can throw\nThere is a major caveat with the previous example, considering this\nmore real-life implementation that throws an error. The throw may\nhappen deep down in another function.\nc++\nint parse_integer() {\n  ... // do the parsing\n  if (error) throw(error);\n  return 42;\n}\nWith this parse_integer function the previous example would leak memory.\nI guess it is pretty obvious, as the allocated memory will not be freed,\nas it was never assigned to a SharedObj value. Therefore the above code\nwould better be written as:\nc++\ntypedef Number* Number_Ptr;\nint parse_integer() {\n  ... // do the parsing\n  if (error) throw(error);\n  return 42;\n}\n// this leaks due to pointer return\n// should return Number_Obj instead\n// though not possible for virtuals!\nNumber_Ptr parse_number() {\n  Number_Obj nr = SASS_MEMORY_NEW(...);\n  nr->value(parse_integer());\n  return &nr;\n}\nNumber_Obj nr = parse_number();\nThe example above unfortunately will not work as is, since we return a\nNumber_Ptr from that function. Therefore the object allocated inside\nthe function is already gone when it is picked up again by the caller.\nThe easy fix for the given simplified use case would be to change the\nreturn type of parse_number to Number_Obj. Indeed we do it exactly\nthis way in the parser. But as stated above, this will not work for\nvirtual functions due to invalid covariant return types.\nReturn managed objects from virtual functions\nThe easy fix would be to just create a new copy on the heap and return\nthat. But this seems like a very inelegant solution to this problem. I\nmean can't we just tell the object to treat it like a newly allocated\nobject? And indeed we can. I've added a detach method that will tell\nthe object to survive deallocation until the next pickup.\nc++\ntypedef Number* Number_Ptr;\nint parse_integer() {\n  ... // do the parsing\n  if (error) throw(error);\n  return 42;\n}\nNumber_Ptr parse_number() {\n  Number_Obj nr = SASS_MEMORY_NEW(...);\n  nr->value(parse_integer());\n  return nr.detach();\n}\nNumber_Obj nr = parse_number();\nCompile time debug options\nNote: not yet finalized\n\ncompile time option to add file/line for each allocation\ncompile time option to track all allocated/leaked memory\ncompile time option to trace (specific) memory life-cycles\n\nWhy reinvent the wheel when there is shared_ptr from C++11\nFirst, implementing a smart pointer class is not really that hard. It\nwas indeed also a learning experience for myself. But there are more\nprofound advantages:\n\nBetter GCC 4.4 compatibility (which most code still has OOTB)\nNot thread safe (give us some free performance on some compiler)\nBeeing able to track memory allocations for debugging purposes\nAdding additional features if needed (as seen in detach)\nOptional: optimized weak pointer implementation possible\n\nThread Safety\nAs said above, this is not thread safe currently. But we don't need\nthis ATM anyway. And I guess we probably never will share AST Nodes\nacross different threads.. This PR is ready in technical terms. The code only needs more cleanup and API polishing. I'm quite sure I can get this ready before X-Mas. I also tested performance and it is on par with LibSass before this change, but has a dramatically better footprint than before. I only compared spec test runtimes, but I would guess that more complex use cases might profit from this performance wise. . This could be merged right now as it is. I want to make more refactorings and split at least certain compile units into more fine grained ones. But I guess this PR is already big enough. Prolonging this just binds me to put more effort into maintaining the commits than doing productive improvements to the code base.\nI would also like us (LibSass) to follow the naming conventions normally used (ie. google c++ style guide) to rename our classes to be camel case (i.e Binary_Expression => BinaryExpression). There might be some rules for special memory objects (ie. BinaryExpression_Ptr).  Methods should also be CamelCase, while private things can still be \"in underscrore representation\". But honestly I don't care too much about very strict code convertions, as long as it has some consitency.\nAnd I just want to stress that english is only my third language, so please bear with me!\nRegards\nMarcel. //CC @xzyfer @am11 @chriseppstein @hcatlin @nex3 @drewwells @saper @akhleung . Rebased to master. Addressed pretty much all of your comments. Thanks for the pre-review.\n\n\nThe XYZ_PTR_CONST are needed as the code would no compile otherwise and giving const XYZ_PTR is not the same. I guess it something for further investigations. But it works ok as it is now and there seem bigger things to look for at this initial stage.\n\n\nRenamed surivive to detach. Will update documentation when I have time.\n\n\nSASS_MEMORY_CAST - I would just change it as we go along. Not really that important IMO.\n\n\n\nYou've expanding some operations which in many cases has had the code harder to grok. Is this for technical reasons, to debug, or personal taste?\n\nThere is a technical reason. Chances are that we would otherwise not pick-up all objects. But it depends on the root object. I think by now pretty much all lists also hold reference counted objects. So this may no longer needed in all places. I can see if I see some obvious spots.\nGCC 4.4 - FYI: I do release perl-libsass in gcc 4.4 compatible form since a few versions. So I do have some interest to keep it compatible if possible. Anyway, I believe this implementation leaves us much more freedom that we would get with raw shard_ptr. The implementation is also rather short (must is debugging mode stuff).\n\nIs it worth changing the error handling model of the parser in order to simplify this implementation? It shouldn't be difficult to change the parser to not throw unexpectedly.\n\nI don't really see the point. IMO throwing is the right way and I don't know how it would be easy to change it to anything else. Beside we still need to account for our memory allocations now. With detach there is the right tool to solve this quite easily (assign to obj, call detach if you need to return ptr).\nFurther ToDo: debug mode needs some more work to be really useable. I think I've lost some bits on the way.. I'd rather rebase #2134 afterwards. Doesn't look too hard (100 lines) .... > @mgreter heads up master is failing due to sass/sass#2211. You can safely ignore the failing spec for spec/libsass-closed-issues/issue_2132\nIs there anyone looking into these? It's a pitty that master is broken ATM!. Updated documentation a little and added my valgrind test script too.\nMade 2 valgrind test runs on linux (Atom CPU and Virtualbox - both x86_64).\nWill merge this in a few hours if nothing more pops up.. Thanks for the thorough bug report. I can see the issue clearly in the sourcemap inspector. I suspect the error to stem from reparsing the interpolated selectors on the eval stage (unconfirmed).\n. @rodneyrehm can you tell on which versions you saw this error. Wondering if it got introduced with some latest sourcemap changes in 3.4-RC1. I specially would like to know if 3.3.6 already had this issue!? Thx!\n. I have updated my sourcemap inspector to PR #2268. @nschonni can you check it to see if #2268 fixes the most urgent issue. As laid out in said PR, the mappings for the selector schema parts are still garbage, but at least to following mappings should no longer be off!\n1: http://libsass.ocbnet.ch/srcmap/#JHByZWZpeDogenVsdTsKCi5hbHBoYSwKLmJyYXZvLAouY2hhcmxpZSB7CiAgY29sb3I6IHJlZDsKfQoKLmRlbHRhIHsKICBjb2xvcjogYmx1ZTsKfQoKLiN7JHByZWZpeH0tYWxwaGEsCi4jeyRwcmVmaXh9LWJyYXZvLAouI3skcHJlZml4fS1jaGFybGllIHsKICBjb2xvcjogcmVkOwp9CgouI3skcHJlZml4fS1kZWx0YSB7CiAgY29sb3I6IGJsdWU7Cn0KCi5lY2hvIHsKICBjb2xvcjogZ3JlZW47Cn0=. I have merged #2268. It should fix the most urgent problems here! . @IrvingArmenta I cannot reproduce a problem with your code!?\nI also tested your code snippet locally in sass format without any problem!?\nNote: I did not use node-sass to test this!\n1: http://libsass.ocbnet.ch/srcmap/#JHByaW1hcnk6ICMwMDAwMDA7CiRzZWNvbmRhcnk6ICM5NTk1OTU7Cgpib2R5IHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAkcHJpbWFyeTsKICBjb2xvcjogJHNlY29uZGFyeTsKfQ==. Closing as we need a more specific test case to reproduce!\nPlease re-open if you can provide such a case! Thanks!. This will probably never work with sass2scss. For that we would need a lot of code to generate sourcemaps in sass2scss first, pass it to libsass and have some re-mapping algorithm there.. Since when did ruby sass start to support ~~CSS3~~ nested imports? The empty output is just a \"isPrintable\" problem, but IMO sofar imports have always been \"bubbled\" up to the top of the document, as CSS2 requires!?\n\nThe @import CSS at-rule is used to import style rules from other style sheets. These rules must precede all other types of rules, except @charset rules; as it is not a nested statement, @import cannot be used inside conditional group at-rules.\n\nfrom https://developer.mozilla.org/en-US/docs/Web/CSS/@import. diff\n@@ -244,6 +244,9 @@ namespace Sass {\n         if (dynamic_cast<Has_Block*>(stm)) {\n           stm->perform(this);\n         }\n+        if (dynamic_cast<Import*>(stm)) {\n+            stm->perform(this);\n+        }\n       }\n       return;\n     }\ndiff\n@@ -606,6 +606,7 @@ namespace Sass {\n       incs_(std::vector<Include>()),\n       media_queries_(0)\n     { statement_type(IMPORT); }\n+    virtual bool is_invisible() const { return false; }\n     std::vector<Expression*>& urls() { return urls_; }\n     std::vector<Include>& incs() { return incs_; }\n     ATTACH_OPERATIONS()\nresults in\ncss\n@import url(\"https://example.org\");\nhttps://github.com/sass/libsass/blob/master/src/output.cpp#L33-L36. Even a simple\n```scss\nfoo { \n  @import url(\"https://example.org/asdasd.css\");\n}\n```\nyields a different result in ruby sass and libsass!?. I'm not even sure the output of ruby sass is valid CSS3?\nhttps://drafts.csswg.org/css-cascade-3/#at-ruledef-import\n\nAny @import rules must precede all other at-rules and style rules in a style sheet (besides @charset, which must be the first thing in the style sheet if it exists), or else the @import rule is invalid.\n\nFrom a quick glance it seems imports do support media queries, but still only on top and directly attached/appended to the import statement itself. Therefore it might be possible to extract these rules from parent media query at-rules. But I still read the specs the way that they must be on top of the document.\n//CC @chriseppstein @nex3 . Without too much thinking I would expect the following:\nscss\n@media all and (min-width: 100px) {\n  @media all and (max-width: 800px) {\n    @import url(\"test.css\");\n  }\n}\nShould become:\ncss\n@import url(\"test.css\") all and (min-width: 100px) and (max-width: 800px);\nAll other nesting cases (i.e. in a selector) should yield an error or be ignored (as the specs states).\nCurrent ruby sass output:\ncss\n@media all and (min-width: 100px) and (max-width: 800px) {\n  @import url(\"test.css\");\n}\nMe is confused .... I agree that we should error out on invalid cases (as per CSS specs). Can you already give the error message libsass should print in this case? I think it should be easy to implement the necessary checks on the libsass side.\nI guess the case where a valid import in root scope(s) of media queries is a new feature. I would also argue that hoisting such imports may could lead to unexpectd behavior (specificity of selectors may not match to the intention, if the actual import is done before all other css styles). So I'm not sure if the example I posted in me previous comment makes much sense to implement after all!?. I would agree (the error msg seems appropriate)! But I'm not sure if you mean that we would dissalow any @import inside @media. As I pointed out, we could hoist those to the top, but it could change expected behavior if any other ruleset preceed the import that would be hoisted! We have fallowed ruby sass in any decission so far, so just make up the rules and we'll follow! IMO erroring out would make the most sense, but as stated, we'll implement it as ruby/dart sass does!. Thanks for the report. I've update your sample to include more cases with different signs.\nhttps://en.wikipedia.org/wiki/Modulo_operation#Remainder_calculation_for_the_modulo_operation. Thanks for the report. This was fixed in https://github.com/sass/libsass/pull/2135 and will be in the next version!\n1: http://libsass.ocbnet.ch/srcmap/#LmZvbyB7CiAgIGh1ZTE6IGh1ZShoc2woMjEwLDAlLDkwJSkpOwogICBodWUyOiBodWUoaHNsKDIxMCwxJSw5MCUpKTsKfQ==. @xzyfer in principle yes, it could be merged before. It just makes maintaining that one more and more complicated (read: needs more time from my side to keep up to date). Honestly, I would rather like to see the release notes for 3.4-rc1 done before merging/reviewing this!\nBtw. not sure you are aware that libsass also has an ABI version to take care of?\nUnsure what your plan on that front is??. Thanks for the schedule heads-up, looking forward to it!\nBy ABI compatibility I meant this sucker here:\nhttps://github.com/sass/libsass/blob/master/src/GNUmakefile.am#L37\nWhen are we going to release the first stable LIBsass version (in terms of a shared lib)?\nEdit: win https://github.com/sass/libsass/blob/master/res/resource.rc#L23\nBtw. AFAICS I did not change C-API to be ABI incompatible (not 100% sure about the change with passing compiler pointer to custom functions, but that is experimental anyway) since it was set to 0.9.0. But some of the pending refactorings probably will result in a few ABI breaking changes. That's why I would have preferred to do this before any new major release .... Superseded by https://github.com/sass/libsass/pull/2251. Thanks for the report. This edge case was not yet covered by our spec tests.\nThis will be fixed with https://github.com/sass/libsass/pull/2247 (waiting for CI to be fixed first). Fixes https://github.com/sass/libsass/issues/1037 and https://github.com/sass/libsass/issues/1950\nCorresponding commits in perl-libsass:\n\nimport stack queries\ncall stack queries (functions and mixins)\nsass variable environment access\n\nSample perl program\ntest.pl\n```pl\nuse strict;\nuse warnings;\nuse CSS::Sass qw(get_callee_stack_size);\nuse CSS::Sass qw(get_callee_type);\nuse CSS::Sass qw(get_callee_name);\nuse CSS::Sass qw(get_callee_path);\nuse CSS::Sass qw(get_callee_line);\nuse CSS::Sass qw(get_callee_column);\nuse CSS::Sass qw(get_callee_var);\nuse CSS::Sass qw(set_callee_var);\nmy $sass = CSS::Sass->new(\n  sass_functions => {\n    'get-callee-stack-size()' => sub { get_callee_stack_size() },\n    'get-callee-type($back : 0)' => sub { get_callee_type($[0]) },\n    'get-callee-name($back : 0)' => sub { get_callee_name($[0]) },\n    'get-callee-path($back : 0)' => sub { get_callee_path($[0]) },\n    'get-callee-line($back : 0)' => sub { get_callee_line($[0]) },\n    'get-callee-column($back : 0)' => sub { get_callee_column($[0]) },\n    'get-callee-var($name, $back : 0)' => sub { get_callee_var($[0], $1) },\n    'set-callee-var($name, $val, $back : 0)' => sub { set_callee_var($[0], $1, $2) },\n    'get-callee($back: 0)' => sub {\n      return sprintf(\"(%d) %s at %s (%d/%d)\",\n        get_callee_type($[0]),\n        get_callee_name($[0]),\n        get_callee_path($[0]),\n        get_callee_line($[0]),\n        get_callee_column($_[0]),\n      );\n    }\n  }\n);\nprint $sass->compile_file(\"test.scss\");\n```\ntest.scss\n```scss\n@function baz($back: 0) {\n  @return get-callee($back);\n}\n@function bar($back: 0) {\n  @return baz($back);\n}\n@function foo($back: 0) {\n  @return bar($back);\n}\n@mixin foo($back: 0) {\n  @content;\n}\nA {\n  $foo: \"foo\";\n  @include foo {\n    callee-5: foo(5);\n    callee-4: foo(4);\n    callee-3: foo(3);\n    callee-2: foo(2);\n    callee-1: foo(1);\n    callee-0: foo(0);\n    foo: get-callee-var(\"$foo\");\n    foo: set-callee-var(\"$foo\", \"new\");\n    foo: get-callee-var(\"$foo\");\n  }\n}\n```\nresult\ncss\nA {\n  callee-5: (0) foo at D:/.../perl-libsass/test.scss (19/12);\n  callee-4: (0) @content at D:/.../perl-libsass/test.scss (14/3);\n  callee-3: (1) foo at D:/.../perl-libsass/test.scss (21/15);\n  callee-2: (1) bar at D:/.../perl-libsass/test.scss (10/11);\n  callee-1: (1) baz at D:/.../perl-libsass/test.scss (6/11);\n  callee-0: (2) get-callee at D:/.../perl-libsass/test.scss (2/11);\n  foo: foo;\n  foo: new; }. Needs a rebase after https://github.com/sass/libsass/pull/2267 is merged!. ## A few C-API remarks \nThe C-API has grown quite a bit and we now expose quite a few arrays. Implementation for them is often very different. Since the whole C-API is behind function calls and pointers now, we can use C++ behind those functions. Therefore we could just use std::vector instead of our own primitive implementations (as i.e. for include_paths, which is really a linked list in order to grow dynamically). But due to where we came from, most things on the C-API are still just structs (which are allocated via calloc and deleted via free). In order to support C++ containers, those structs need to be upgraded to real classes and allocated via new and freed via delete (otherwise we leak). So this task would basically boil down to design and implement a C++ API for LibSass (which would be a nice addon).\nMore CI tests (plugins)\nI've added my libsass plugins to the CI process (Travis only so far). This allows most of the C-API to be tested via CI. I created a specific libsass-tests plugin to expose most C-API features as custom functions (work in progress). I was hoping to include a small sass-spec suite for each plugin, but unfortunately ran against https://github.com/sass/sass-spec/issues/1025. So for now each plugin contains just one spec test that is run and compared via diff in libsass Travis CI.\nFor reference, these are the tested plugins:\n\nhttps://github.com/mgreter/libsass-glob\nhttps://github.com/mgreter/libsass-math\nhttps://github.com/mgreter/libsass-digest*\nhttps://github.com/mgreter/libsass-tests\n\n*digest needs this PR to compile/work!\n1: https://github.com/mgreter/libsass-tests. As stated, this looks like a false positive (therefore meaning probe-todo is still broken) .... FWIW: made some performance assesments accross different implementations:\n```scss\n.clearfix {\n  &:after {\n    content: \"\";\n    display: table;\n    clear: both;\n  }\n}\n@for $n from 1 through 100 {\n  @for $i from 1 through 100 {\n    .foo#{$i} { @extend .clearfix; }\n  }\n}\n```\ncmd\n$ bin/sassc.exe -v\nsassc: 3.4.1\nlibsass: 3.4.0-19-g414b\nsass2scss: 1.1.0\nsass: 3.4\n$ time sassc test.scss\nreal    0m0.279s\nuser    0m0.000s\nsys     0m0.015s\ncmd\n$ sass -v\nSass 3.4.23 (Selective Steve)\n$ time sass test.scss\nreal    0m2.560s\nuser    0m1.984s\nsys     0m0.561s\ncmd\n$ dart-sass --version\n1.0.0-alpha.6\n$ time dart-sass test.scss\nreal    0m45.833s\nuser    0m0.000s\nsys     0m0.000s\n//CC @xzyfer @nex3 \nEdit: dart sass output is off, so timing is not saying much here.. This is a rounding error within reasonable margins. The calculation 5 / 64 results in exactly 0.078125. Not much we can do due to the nature of how floats are stored on computers. I was already aware of this and I mostly saw it with 32 vs 64 bit builds.\n1: https://en.wikipedia.org/wiki/Floating_point#Accuracy_problems. FWIW. this is the underlying \"issue\":\nc++\nstd::stringstream strm;\nstrm.precision(5);\nstrm << std::fixed << (5.0 / 64.0);\nstd::cerr << strm.str() << \"\\n\";\n// prints 0.07812. @gauteh the commit you mention (https://github.com/sass/libsass/commit/6a5444b2e7420b79fb53da4afec05db524c1b3ef) is not part of libsass 3.4.0? So I'm confused if your report is against master or libsass 3.4.0 (as you stated in your first post)? Also does your example above exhibit the problem or is that just for illustration? Thanks!. OK, I was able to verify the issue on linux. Could not reproduce on windows with mingw64 and msys2.. Can you try out the fix in https://github.com/sass/libsass/pull/2259 ?\nBtw. your code can also be fixed to work with current version:\n```diff\n    struct Sass_File_Context file_ctx = sass_make_file_context(scsspath);\n    struct Sass_Context context = sass_file_context_get_context(file_ctx);\n    struct Sass_Options* options = sass_file_context_get_options(file_ctx);\n    sass_option_set_precision(options, 1);\n    sass_option_set_source_comments(options, true);\n\n\nsass_file_context_set_options(file_ctx, options);\nint status = sass_compile_file_context (file_ctx);\n```\n\n\nNo need to set options again. They are infact the same object. You mostly just need that function if you create options via sass_make_options (which can be usefull if you want to set it up before file or data contexts). If you look at sass_file_context_get_options you'll find it only does return (Sass_Options*) this.. Closing as resolved. Is there any official statement about 3.4 branch? It's news to me!??. Thanks for your report. This will be fixed with https://github.com/sass/libsass/pull/2262.. Merging this soon to progress https://github.com/sass/libsass/pull/2251. That would not have helped in any way here, as the (delayed) selector schema parsing was exactly the one that was broken in regard to source-maps. We may need to loose the inner mappings for selectors that are re-parsed (as ruby sass does), but I have not yet come to a final conclusion here. FWIW: IMO the core issue with at-root was that the following was never anticipated:\n```scss\nfoo {\n  @at-root {\n    bar {\n      baz: baz;\n    }\n  }\n}\nfoo {\n  @at-root {\n    & bar {\n      baz: baz;\n    }\n  }\n}\n```\nResults in:\ncss\nbar {\n  baz: baz; }\nfoo bar {\n  baz: baz; }\nAs one can see, the explicit parent selector (&) seems to reach accross at-root rules. This pretty much explains all the headaches we had with parent selectors.. @xzyfer I did not get your point? Your sample does not contain any &?\nPlease see this example closely:\nscss\nroot {\n  @at-root {\n    & foo bar {\n      baz: baz;\n    }\n  }\n}\nThis results in ruby sass:\ncss\nroot foo bar {\n  baz: baz; }\nWhich is what I mean by \"reaching across at-root\"! This exactly explains why we needed the differentiation of explicit and implicit parent selectors!. > I'm fine with making this a breaking a change as long it's document the change accordingly, which they will be. API breakages were expected in 3.5 and 4.0.\nThen you should also increase ABI version number as AFAIK this is the first time we break ABI.\nI guess you'll add the documentation also to this PR?. You forgot to increment for windows:\nhttps://github.com/sass/libsass/blob/master/res/resource.rc. Looks fine for me. I actually expected some warnings in clang or gcc, but they all seem to agree. Not sure if some older compilers will warn missing return when a throw is in place. But CI seems to agree here!. Rebased and cherry picked in https://github.com/sass/libsass/pull/2316. Closing this as most has been merged with https://github.com/sass/libsass/pull/2316. Thanks @nschonni!. A simpler reproduction of the error:\n```js\nvar sass = require('node-sass');\nfunction render() {\n  sass.render({\n    data: [\n      \"@mixin test2() {\",\n      \"  foo: bar;\",\n      \"}\",\n      \"@mixin test() {\",\n      \"  @for $i from 1 to 100000 {\",\n      \"  }\",\n      \"}\",\n      \"foo {\",\n      \"  @include test2;\",\n      \"  @include test;\",\n      \"  @include test2;\",\n      \"}\",\n    ].join(\"\\n\"),\n  }, function(error, result) {\n    if (!result) console.log('error ', error);\n  });\n}\nfor (var i = 0; i < 100; i ++) {\n  setTimeout(render, Math.random() * 1000);\n}\n```\nFWIW: I always aim to be thread safe in regard of contexts. Multiple contexts/compilers should be safe to use even on the same thread, which is what node-sass obviousely does. Since we don't share anything between them, this should be quite easy to achieve, but nonetheless there is no real guarantee that no side effects hide in the source code! This one was really just badly implemented!. Thanks for your report, I can confirm this issue.. The problem is how we handle String_Schema, or to be precise, that Selector_Schema internally uses a String_Schema. Please see the adjusted spec test below for illustration:\nscss\nA {\n  .b, .c, .d {\n    #{&}-foo {\n      parent: &bar;\n      itpl: #{&}bar;\n    }\n  }\n}\nThe selector #{&}-foo is a Selector Schema, while &bar and #{&}bar are String Schemas. As being said, internally a Selector Schema uses a String Schema, so when it gets evaluated, it produces the same result for both (which is only \"correct\" for the later).\nExpected result:\ncss\nA .b-foo, A .c-foo, A .d-foo {\n  parent: A .b-foo, A .c-foo, A .d-foo bar;\n  itpl: A .b-foo, A .c-foo, A .d-foobar; }\nActual result:\ncss\nA .b A .b, A .b A .c, A .b A .d-foo, A .c A .b, A .c A .c, A .c A .d-foo, A .d A .b, A .d A .c, A .d A .d-foo {\n  parent: A .b A .b, A .b A .c, A .b A .d-foo, A .c A .b, A .c A .c, A .c A .d-foo, A .d A .b, A .d A .c, A .d A .d-foo bar;\n  itpl: A .b A .b, A .b A .c, A .b A .d-foo, A .c A .b, A .c A .c, A .c A .d-foo, A .d A .b, A .d A .c, A .d A .d-foobar; }\nI think this is a regression from fixing the second use case (parent selector in properties). And I think I should be able to come up with a fix for that. Probably just needs a flag for String Schema to differ slightly when coming from a Selector Schema.. Note that sassmeister for libsass 3.3.6 produces:\n```css\n.a .b, .a .c, .a .d {\n  color: blue;\n}\n.a .b, .a .c, .a .d-foo {\n  color: red;\n}\n```\nSo this does not seem to be a regression. Fix is comming up!. Also worth noting that the behavior of ruby sass is expected, as one can see with the following sample :\nscss\nA, B {\n  #{&}-foo#{&}-bar {\n    color: blue;\n  }\n  #{\"A, B\"}-foo#{\"A, B\"}-bar {\n    color: blue;\n  }\n}. Thanks @asottile. I've updated the release notes!. This is probably related to https://github.com/sass/libsass/issues/2256. I have closed the previous issue report, since there is not much we can do about this. But I'll keep this open, as there maybe is a way to get this more closely to the original ruby sass implementation. Afterall the differences between those two colors are so minimal that probably nobody could make out a difference by eye anyway, so this is not a high prio issue.. Closing as insignificant. The math for rounding floats can be tricky and I would argue that no human can really tell the difference between #343434 and #343333.. @nex3 @chriseppstein @xzyfer can somebody come up with some comprehensive spec tests? I think implementing it should be pretty trivial. Thanks!. Thanks for the report! This seems already fixed on master!. Thanks for the confirmation! Have a nice weekend!. Thanks for the report! This seems already fixed on master!. Thanks for the confirmation! Have a nice weekend!. Took me nearly four days on and off to finally find the culprits. In the end I actually was able to reproduce some issues localy, but testing against travis CI is really no fun nowadays, specially when it involves the mac osx builds \ud83d\udc4e Kinda works if you do laundry or dishes while waiting. I've tried to speed them up a bit so they hopefully will no longer timeout, if they even start in a timely fashion.\nThis PR includes one fix that was needed to satisfy the clang-3.7 address-sanitizer (which indeed was a very minor memory leak). This PR also brings a bit more variety of compilers, since I've learned how to configure them properly with travis. Seems like a nice addition. We are also back to 3 ci runs that produce coverage reports. With the latest cleanups and additional spec-tests, plus the tests via plugins, the coverage went from 80% to 85%, which is quite a big step given our codebase!\n. Waiting for osx builds to start. Will \ud83d\udea2 when \ud83d\udc9a \nBacklog ATM: 276 jobs -> https://www.traviscistatus.com/. Great, now appveyor seems stuck. @xzyfer I can no longer cancel appveyor jobs. Might be because my collaborator role is just user for the sass account on appveyor. Pretty sure I was able to cancel them before. Looks like I have to let them time out until \ud83d\udc9a . Thanks @nschonni. I still do have access to the \"sass\" account, but I'm only user. Not sure how the permissions work for AV, I'm just pretty sure I had the rights to cancel or restart jobs. Anyway, the one job that got stuck timed out and this PR should get green in a few minutes :). @xzyfer thx, confirmed, I see the options now again! Shows me as \"Power User\" now.. Thx for the report! This will be fixed by https://github.com/sass/libsass/issues/2317. I've updated some parts a bit. Please provide alternative wording or paragraphs for the open things. Otherwise it's difficult to improve it without specific feedback. Thanks!. @xzyfer still not heard back from you on this one!. OK. Btw. I suspect a compiler (buggy toolchain) issue on alpine linux. I debugged it down to the heisenbug on the assembler level, but couldn't see why accessing a function jmp fails after the same jmp/function was called successfully before many times at the same memory location. I verified that the memory location is not overwritten. So for me this is a \"wont fix\" until we see similar issues on other platforms!. FWIW. The only difference between node-sass and sassc is that node-sass seems to flag some memory pages as non-executable (as seen when running with strace), which could be a reason why the jmp could fail. But I wasn't able to really make a connection (the raw memory addressess don't seem to overlap).. And in the end musl libc is a very young libc implementation (initial release is less than 5 years old, so chances are that it is simply a bug in said musl libc implementation) .... Thanks for the test case, I can confirm the issue live from your repo with my sourcemap inspector. \n\n1: http://libsass.ocbnet.ch/srcmap/#QGltcG9ydCAiaHR0cDovL2Nkbi5yYXdnaXQuY29tL2NlcGgzdXMvYnJlYWstZ3VscC1zYXNzL21hc3Rlci9hcHAvYXNzZXRzL3Nhc3MvbWl4aW5zLnNjc3MiOwo=. Hmm, that exposes quite a few unexpected side effects. Need to investigate further.. Interestingly the failures from #2315 in https://ci.appveyor.com/project/sass/libsass/build/1.0.3068/job/ih3by0c12b0fc0jv seem to be the same. I have now deactivated the memoization for complex selectors and that seems to work. This could indicate that some equality tests are not giving the same result as when compared via to_string. Good thing is that it seems to be reproducible via MSVC.. OK, got a green light from CI. As expected the (equal and less than) compare functions are not yet 100%. But we need them for our hashing already, so better expose more bugs by (ab)using them.. And got it also working on the compound selector level. This should bring the most in case the selectors differ slightly. Caching now starts at the best level possible, as all levels have some heavy calculations involved. The cache structure living in the Extend class (which only lives during the extend phase) are very slim. They are really just maps with size_t as key to a shared object (which is a bit more than a pointer). Of course all given that the assumption it is sane to cache these results.. Well, good thing one does performance tests before making assumptions into facts. It seems the overhead on the compound level is too high. I think the problem might be that we store a \"Node\" object in the hash map here (since that is the return type). I'll comment this out and add a comment so it can be re-evaluated once we return a true selector from this function.. This has some unexpected failures in https://ci.appveyor.com/project/sass/libsass/build/1.0.3068/job/ih3by0c12b0fc0jv! Needs further investigations .... It seems I was able to fix the issue. Not it is failing only the expected spec test.. Up on further review this needs some more changes as it is not equivalent to ruby sass now. There seems to be some path in unify_with that does not properly use the == operator.. The space \"gets eaten\" as described in the css specs:\nhttps://www.w3.org/TR/css-syntax-3/#consume-an-escaped-code-point\n\nConsume as many hex digits as possible, but no more than 5. Note that this means 1-6 hex digits have been consumed in total. If the next input code point is whitespace, consume it as well. Interpret the hex digits as a hexadecimal number. If this number is zero, or is for a surrogate code point, or is greater than the maximum allowed code point, return U+FFFD REPLACEMENT CHARACTER (\ufffd). Otherwise, return the code point with that value. . This is fixed on latest master (or in 3.4.5) after 3.5.0.beta.2 was tagged!\n\n3: https://github.com/sass/libsass/releases/tag/3.4.5. I see you already started fixing this. I did the same and came up with this hotfix:\ndiff\n@@ -167,8 +167,15 @@ namespace Sass {\n       else if (a->is_rest_argument()) {\n         // normal param and rest arg\n         List_Obj arglist = Cast<List>(a->value());\n+        if (!arglist) {\n+          if (Expression_Obj arg = Cast<Expression>(a->value())) {\n+            arglist = SASS_MEMORY_NEW(List, a->pstate(), 1);\n+            arglist->append(arg);\n+          }\n+        }\n+\n         // empty rest arg - treat all args as default values\n-        if (!arglist->length()) {\n+        if (!arglist || !arglist->length()) {\n           break;\n         } else {\n           if (arglist->length() > LP - ip && !ps->has_rest_parameter()) {\nArglists is one of those classes that need an urgent refactoring.\nBut there are many like these on the todo list (ie. all vectorized classes)!. OK, will make a PR. Note that I believe the other segfault in Alpine to be a heisenbug. I don't think you will be able to reduce the test case while still exposing the same bug. So far it looks like we are overwriting memory where we should not. Only explanation I could come up so far is that we rely on some undefined behavior somewhere, which only breaks in that certain case. It somewhat looks like stack memory is overwritten, which leads to invalid jmp address.\nTo be clear, the segfault in my case happens when the executable tries to jump into the \"parse_expression\" function. But interestingly it is called from \"parse_arguments\", so this might be related. I know that we do store strange variations of AST nodes in these containers. But I haven't finished my assessments, so this could also be the wrong assumption.. Fixed in https://github.com/sass/libsass/pull/2323. Just my 2 cents: I'm not a fan of autmated code formatting. IMO humans can format code better than machines to point out the relevant bits. None the less I agree that we should stick to a certain code style, but I personally don't believe it should be too strict. I personally like to work with smart tabs and linux kernel styles in general, but I sometimes also vary this if it makes sense in the given context (ie. putting a block opener on a new line if that block carries important lexical variables).. Closing due to inactivity, feel free to open again, preferably with a working PR. Thanks!. http://www.cpantesters.org/cpan/report/07d9547c-d95a-11e6-91f1-a230ca8448b3. This is already fixed on master. We need more information to debug this!\nOS Info, command you use to compile etc.\nOtherwise this issue will be closed. Thanks!. We need more information to debug this!\nOS Info, command you use to compile etc.\nOtherwise this issue will be closed. Thanks!. Closing this as no new info was provided yet!\nFeel free to re-open once additional info presented!\nThanks!. Thanks @nschonni for this. It actually pointed out more than I expected! I looked through the list and it catched 2 memory leaks (due to the new memory handling) and one possible out of bound access. The rest were mostly undefined behaviors due to possibly uninitialized values. Most of them were unproblematic with the given behavior of gcc/clang/msvc. None the less I fixed most of them with #2335. The rest seem to be false positives, but I have to see the updated report after said PR is merged (I pushed these changes also to the coverity branch). The rest was mostly cosmetic (i.e. \"logical dead code\")!. Thanks for your bug report! I can confirm this issue and your observation with \"referenced iteration var\" seems to be correct. But I'm not sure if the proposed fix is accurate. The open question is if map-merge does a deep clone or not. I guess it probably should. I believe we lack tests when merging two existing arrays and then change a sub-item. Should this change also be reflected on the other assignment, or are all deep structures independent once assigned?\nThe initial issue is fixed by #2332 but I know that this adds a pretty big overhead for tight loops (since we need to allocate a new \"number\" object for every iteration)! Maybe somebody could come up with more spec tests to cover all cases? That would greatly help to improve this area!. Ran leak-test.pl for this branch and valgrind didn't report anything beside the segfault for issue 2307.. IMO the unessecary AST Node copies are one of the main remaining bottlenecks.\nBut I'm curious to hear what you had in mind where the bigger perf fishes are?!\nI started to optimize these copies a long time ago. I.e. the number eval visitor was always returning copies in previous versions. This was adding up to 25% unenessary runtime overhead in certain cases. I also believe that the right place to make copies is on assignment and not when we \"prepare\" the ast variable. The flag would probably be better placed at the Number Class directly, but it is actually more efficient to add it to the existing booleans in the base class. Most dynamic languages would probably implement this with a copy on write (COW) mechanism, but we are not there yet.. Added some comments to make it clear that this is a very special flag for now!. Pretty sure you are hitting stack size limitations (and therefore getting a stack overflow exception, which we can't really catch). This can happen on any function call, i.e. as with exp.backtrace() in your case. I guess the default on your platform is 1MB stack size (or even less). Your given sample works (errors) correctly (verified on windows) when the stack size is increased to 4MB (e.g. with MSVC /STACK:\"4194304\"). So please make sure to increase the stack size to a reasonable amount when compiling your implementation!\n2: http://libsass.ocbnet.ch/srcmap/#QGltcG9ydCAiaHR0cDovL3d3dy5vY2JuZXQuY2gvYnVncmVwb3J0L2xpYnNhc3MvaXNzdWUtMjM0NS5zY3NzIjs=. I'm actually talking about the linker option -stack_size. Are you sure you increased that?\nSince I can reproduce your findings with MSVC and sassc, I'm pretty sure this is your issue!?\n1: http://stackoverflow.com/a/18912422/1550314. FWIW: I might be wrong here, but I would expect setrlimit to be a limit on top of the linked flag. I don't think (at least would not assume) that this works, so make sure you actually linked with that flag and make sure all other possible limits (ulimits, selinux etc) are big enough. Maybe you get something in a error.log?\nI can see if I can update the version of the srcmap inspector ... done\n1: http://libsass.ocbnet.ch/srcmap/#QGltcG9ydCAiaHR0cDovL3d3dy5vY2JuZXQuY2gvYnVncmVwb3J0L2xpYnNhc3MvaXNzdWUtMjM0NS5zY3NzIjs=. Sound very similar to https://github.com/libuv/libuv/issues/669, maybe that'll help! Good luck!. > Dunno how to combat it yet. Have I told you guys how much I love programming recently!\nNot sure if it helps, but that is how you know that you are on a frontier, where no one else has been before. When I implement new things I always expect to find these kind of bugs in dependencies, as I did recently with webgl (took me around 3 days to figure out the real issue). When I started coding in 1994, browsers had bugs no one would ever expect or accept nowadays, and the only debugging we had was alert! None the less we were able to code around it and still produce nice results! So hang in there!\n. This should be fixed by https://github.com/sass/libsass/pull/2390. Fixed by #2354. The callee stack and import stack are two seperate things. Please always provide the used libsass version! I've added more API functions in this regard very recently, so I'm not sure you already got that changes!\n1: https://github.com/sass/libsass/pull/2251. In that case your approach seems to be correct AFAICT! . I can't tell you that on top of my head. It may also depend if you are querying it during the import phase or during execution phase. Doc PRs are always welcome!. Generally speaking abs_path could be anything and not only a \"path\" (eg. a url). It contains the string custom importer returns (which should be built from the parent abs_path and the given imp_path, if imp_path is not yet absolute itself). Btw. you haven't really clarified if you access this info from an importer or from a function! During imports the \"currrent\" is not yet put on the import stack AFAIR.. For globbing please refer to this implementation:\nhttps://github.com/mgreter/libsass-glob. > It would appear that abs_path contains the path of the file that has the @import statement, at least during the \"resolve imports\" stage.\nYou don't give enough details for me to understand which abs_path you actually mean. From the passed import to the custom importer or from the import stack, etc. As I said, we cannot know if you want to work with filepaths or any other scheme. So the abs_path is not a path (directory) but the full file path, so in case you want to work with filepaths, you need to remove the filename from the path (i.e. dirname).\n1: https://github.com/mgreter/libsass-glob/blob/develop/src/glob.cpp#L22-L23. Should be fixed by https://github.com/sass/libsass/pull/2388. I've tested this in ruby sass 3.4.23 and it seems to behave the same!\nI suggest to search their repo for similar issue/request or open a new one!\nThanks!\n1: https://github.com/sass/sass. I can't reproduce this with either libsass 3.4.4 or 3.5.0-beta-3\n1: http://libsass.ocbnet.ch/srcmap/#QGZ1bmN0aW9uIGZvbygpIHsKICAkdmFsdWU6IGZhbHNlOwoKICBAZm9yICRpIGZyb20gMSB0aHJvdWdoIDUgewogICAgQGlmICRpIDwgNSB7CiAgICAgICRpOiAkaSArIDE7CiAgICAgICR2YWx1ZTogJ2Jyb2tlbic7CiAgICB9CiAgfQogIAogIEByZXR1cm4gJHZhbHVlOwp9CgouZm9vIHsKICB3aWR0aDogZm9vKCk7Cn0=. Closing as not reproducable. Might be a duplicate of https://github.com/sass/libsass/issues/2330. ~~Closed via https://github.com/sass/libsass/pull/2602~~. Seems the scss part is still missing, thought it passed locally .... Fixed this specific edge case but there are probably more with @at directives.. Closing as insignificant and we also match ruby sass. Please re-open once ruby sass adjusts this!. This is fixed by https://github.com/sass/libsass/pull/2389. Segfault has been fixed in libsass, but output does not match ruby sass.. This is basically also a duplicate of #2055 (missing specific pseudo selector behavior). Closed via #2531. Closing as not reproducable. Added a spec test none the less.. This is a duplicate of https://github.com/sass/libsass/issues/2123 and fixed by https://github.com/sass/libsass/pull/2387. Closing as no action required by libsass.. This is related to https://github.com/sass/libsass/issues/2055 and IMHO already supported (at least for the generic cases, not sure if ruby sass has specific superselector rules for this as for :not or :has). In general peudo selector are not very specifically handled in libsass yet (specially in case of extending the wrapped selectors) => #2055.\nNot sure it's worth keeping open here.\nIMO a ticket in sass-spec would make more sense.\nThen open specific tickets as special cases crop up.\n1: http://libsass.ocbnet.ch/srcmap/#OjpzbG90dGVkKGlucHV0OmFjdGl2ZSkgewogIGZvbzogYmFyOwp9Cjo6c2xvdHRlZChpbnB1dFtkaXNhYmxlZF0pIHsKICBmb286IGJhcjsKfQ==. Should be fixed by https://github.com/sass/libsass/pull/2388. It was the only one failing on my compiler. And std::to_string is not the same as AST::to_string, or did I miss something?. Thanks for the report. This is already fixed on latest master.\n1: http://libsass.ocbnet.ch/srcmap/#QGZ1bmN0aW9uIHRlc3QoKSB7CiAgICAkcmVzdWx0OiAwOwoKICAgIEBmb3IgJHRlc3QgZnJvbSAxIHRocm91Z2ggMyB7CiAgICAgICAgQGlmICR0ZXN0ID09IDIgeyAvLyB3aGVuIGNvbmRpdGlvbiBub3QgbWV0Li4uCiAgICAgICAgICAgICRyZXN1bHQ6ICR0ZXN0OyAvLyB0aGlzIHdpbGwgYmUgZXhlY3V0ZWQuLi4KICAgICAgICAgICAgQGRlYnVnICdsb29wJyAkcmVzdWx0OyAvLyBidXQgdGhpcyB3aWxsIGJlIGlnbm9yZWQgYXMgZXhwZWN0ZWQKICAgICAgICB9CiAgICB9CgogICAgQGRlYnVnICdyZXN1bHQnICRyZXN1bHQ7CiAgICBAcmV0dXJuICRyZXN1bHQ7Cn0KCi5teS10ZXN0IHsKICAgIHdpZHRoOiB0ZXN0KCkgKyBweDsKfQ==. This is how (original) ruby sass behaves. Unknown function are left untouched in the css code. Libsass is only a compiler for sass and issues with original syntax should be addressed to https://github.com/sass/sass. But I'm pretty sure this will not be changed, as it is integral for things like var(), calc() and other functions that are \"unknown\" to sass/libsass.. This seems to be a duplicate of https://github.com/sass/libsass/issues/2055 (in some other form). No, because basic stuff works and we don't want to break that. Maybe if specifically targeting :not, but I think a correct patch would be hard to come up. As it is difficult to get correct :not extend behavior. I guess you might be better off with some specific post-processing in this case, if the bloat really bothers you. Not even sure why you would want to disable that feature, couldn't you just remove the line in scss then? Of course we always welcome PRs that improve libsass and do not break any existing spec tests.. Took me 2 hours to come up with a hotfix to at least hide nested :not selectors. This will probably cover about 70% of real world use cases (including this one) and should not give any \"wrong negatives\". Will take me some moments to create needed spec test and PR .... Cool, great, thanks for the feedback!. @marticongost this is not reproducable with latest master and gives your expected result.\n1: http://libsass.ocbnet.ch/srcmap/#I3NlYXJjaEZvcm0gewogIGZsZXg6IDEgMSBhdXRvOyB9CiAgOmhvc3QoOm5vdChbc2VhcmNoRW5hYmxlZD0ndHJ1ZSddKSkgI3NlYXJjaEZvcm0gewogICAgZGlzcGxheTogbm9uZTsgfQ==. I'm pretty sure this is due to too small stack size. This is a compile time or/and runtime option which is not under libsass control. So nothing we can do here. Please follow upstream tickets about alpine linux support.\n1: https://github.com/sass/node-sass/labels/OS%20-%20Alpine%20Linux. Not sure how you got this result.\n1) sassc does not have a \"-g\" option\n2) with the correct \"-m\" option, I get:\n/*# sourceMappingURL=style.css.map */\nAlbeit tested on windows .... OK, thanks for clarification. One reason why it's usefull to include as much info in a bug report as possible :). Libsass is definitely not rearanging your parameters. I know this because I know we do not even have a proper parser for urls. There must be something else in your toolchain that is causing this!. Similar issues have cropped up before for this behavior. Official ruby sass only emits the \"This selector doesn't have any properties and will not be rendered.\" if the source is indented sass. It does not emit such a message for scss code. Since libsass uses sass2scss to convert from sass to scss, it is not really possible to handle correctly until we carry around a flag what the original source type was, or we implement a sass parser directly in libsass, which will unlikely happen. There is no way for sass2scss to propagate any errors to libsass.\nSimilar ticket already exists in whishlist => https://github.com/sass/libsass/issues/2229.\n1: https://github.com/sass/libsass/issues/1892. Once this is done, we can remove ZeroDivisionError exception!. Media queries are not very flexible with the \"not\" operation, see https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries. Sass should probably error in this situation, although we may be able to convert the logic in certain cases (e.g. inverting the min-width to a max-width statement, to invert the intention, albeit I did not really think hard if that makes sense).. Confirmed as duplicate of #2429 - thanks for the report @camflan and for the triage @asottile !. Closing as duplicate of https://github.com/sass/libsass/issues/2055. Can you post them here? I don't see a problem if it is only null pointer accesses.\nI also don't seem to have any clue how to get access to the reports there!. OK, well, than I cant help here. @xzyfer where did that invite land??\nI just created an account today:\nhttps://hackerone.com/mgreter. Well, I still don't see or have access to anything ... feel free to copy the report over here!. Access denied!. This has been addressed by one of the recent extend edge cases fixes.. @nschonni I deliberatly left the \"needs test\" out, since segfaulting test cases disturb my spec runner :)\nI'm also not sure if it even needs one, since it may or may not trigger the segfault!\nIn that sense we could have millions of test cases to address possible memory issues .... I may submit some specific cases from hackerone once I'm through them.\nMost cases are just throwing (unicode) garbage to the engine.\nErrors will therefore often not be the same.\nWe shouldn't segfault though .... This has been fixed by https://github.com/sass/libsass/commit/39bda458967c27c687082ec7ab1ca2834325517f. Cannot reproduce locally against https://github.com/sass/sass-spec/tree/b744c1036a47681c45b3a2b0eee915ae24166e5e (3.4 seems to be removed in latest specs). Also pretty unlikely to be the cause for the failing at-root-alone-itpl/basic-alone-itpl tests. We also use the same default argument assignment in https://github.com/sass/libsass/pull/2438/files#diff-3f483a2c484893970bcb41dc1c2dac79L29 for quite some time .... Debugged it to the main memory corruption: https://github.com/sass/libsass/pull/2484\n. I hope this also works under MSYS/CYGWIN and windows cmd.com cmake/dmake/mingw32-make etc.. Related to https://github.com/sass/libsass/issues/1890 and https://github.com/sass/libsass/issues/1651. Can you try it again with latest master?! I believe this has been fixed by https://github.com/sass/libsass/commit/7664114543757e932f5b1a2ff5295aa9b34f8623. Thanks!\nI get with master:\nError: Code too deeply neested\n        on line 1 of POC4. Can you try it again with latest master?! I believe this has been fixed by https://github.com/sass/libsass/commit/7664114543757e932f5b1a2ff5295aa9b34f8623. Thanks!\nI get with master:\nError: Code too deeply neested\n        on line 1 of POC4. Can you try it again with latest master?! I believe this has been fixed by https://github.com/sass/libsass/commit/7664114543757e932f5b1a2ff5295aa9b34f8623. Thanks!\nI get with master:\nError: Code too deeply neested\n        on line 1 of POC4. Can you try it again with latest master?! This seems related to https://github.com/sass/libsass/commit/7664114543757e932f5b1a2ff5295aa9b34f8623, but input looks a bit too short. From the input I suspect stack size is/was the problem. Thanks!. Can you try it again with latest master?! I believe this has been fixed by https://github.com/sass/libsass/commit/707e326525117cba20211d39b0a936f0a95c1094. Thanks!. I am in favor of keeping it as is as long as it is only deprecated and not removed. Better compatibiliy with older compilers.. LGTM, since colors should always only contain ASCII characters. THX!. This is already fixed on latest master. It also seems that sass 3.5 does not support this (beside 3.4 and 4.0 looking ok, only checked via sassmeister)\n1: http://libsass.ocbnet.ch/srcmap/#Omhvc3QoOm5vdCguZm9vKSkgewogIGxlZnQ6IDA7Cn0=. Thanks for checking, can confirm this regressed once more. Unfortunately we probably will not be able to fix it without regressing other more common use cases in a forseeable future. See https://github.com/sass/libsass/issues/2055. As said in my initial comment, this does not seem to be supported by original ruby sass 3.5, although it seems to be in 3.4 and 4.0 (as checked via sassmeister).. This is not supported by ruby sass (according to sassmeister it fails the same way in ruby sass 3.4, 3.5 and 4.0) and libsass tries to stay as close to ruby sass as possble. Therefore, if you think this is a bug, you would need to open an issue at their repo. Thanks.\n1: https://github.com/sass/sass. Pretty sure the reason is that the return type of join is a list in both (and in that sense I would argue that libsass error is even a bit more \"understandable\" with the trailing comma), you can check it yourself with:\nscss\ntest {\n  type: type-of(join((), 0.5rem));\n}. @mirisuzanne this seems to error in ruby sass now:\nscss\nError: -5 is not a keyword argument for `adjust_color'\n        on line 6 of 2472.scss\nCan you still somehow reproduce this issue?. Closing as this seem to be invalid syntax as confirmed with ruby sass and dart sass. Please re-open if you can reproduce the issue. Thanks!. This is the way how ruby sass does it, and libsass tries to mimic ruby sass behavior whenever possible. The .c2 case is not changed to a unicode code-point because it's a static optimization by ruby sass (input is keept untouched). If you think this is a bug, please open an issue on upstream ruby sass directly. I think there is already a similar ticket open to get rid of the static optimization, since it also complicates other cases (like trailing semicolons etc.).\nscss\n$var: \"\\f045\"; \n.c1 { content: $var; } \n.c2 { content: \"\\f045\"; }\n.c3 { content: (\"\\f045\"); }\ncss\n@charset \"UTF-8\";\n.c1 { content: \"\uf045\"; }\n.c2 { content: \"\\f045\"; }\n.c3 { content: \"\uf045\"; }. LGTM, thanks!. This is a pretty well known limitation of the underlying OS functions we use:\nhttps://msdn.microsoft.com/en-us/library/aa365247(v=vs.85).aspx#maxpath\nNone the less it is possible to use longer paths if one uses an alternative Windows API.\nUnfortunately it is hard to predict if this change causes other regressions.\nCould you check (build node-sass from source) if https://github.com/sass/libsass/pull/2478 would fix it for you?\nThanks. Hmmm, that doesnt really make sense ... can you try with sassc? . FWIW: made a local test with perl-libsass and a path with at least 1500 chars sucessfully!\n@import 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/test.scss';. Lets merge and see if we get any regression reported .... Closing as this should be reported downstream to node-sass, thanks!\n1: https://github.com/sass/node-sass. This was indeed done deliberately as I assumed that a custom importer should also be able to intercept imports for relative paths to i.e. apply its own preprocessing (if wanted). I wasn't aware that ruby sass does not allow to overrule these imports and it feels a bit counter-intuitive to me, since it would mean that a custom importer is called/not called if a certain file does or does not exist (without any chance to intercept it if it does). My premise was that if you add a custom importer you are in charge, and if a custom importer does not want to handle an import it can return null which will trigger a regular import lookup by libsass. With that in mind one should be able to model the behavior you mention by using one of the new sass(_compiler)_find_(file|include) functions (/docs/api-context.md).\n. @nex3 could you elaborate what \"import paths\" means? Is this the same as \"include paths\"? I still don't understand it exactly. In my implementation every importer may access include paths and act accordingly via various methods. If I understand it correctly you would get the same behavior by checking sass(_compiler)_find_(file|include) first before doing your own logic. IMO my original point still stands, as I understand it that \"include/import paths\" take precedence over any custom importer then? What I was aiming for is i.e. custom pre-processing of a file that is indeed found as a real file within the \"include paths\". If the file-importer takes precedence you have no chance to alter that file with custom importers?\nEdit: one use case would i.e be to implicitly inline url assets within scss files that are in an \"import path\"?. The libsass library versioning schema does not indicate which sass version it uses, it only indicates libsass API/ABI compatibility, which makes the interfaces forward compatible for consumers like sassc. There was a change in the API/ABI compatibility between 3.4.5 and 3.4.6, which is the reason @xzyfer bumped it to 1.0.0.\nhttps://autotools.io/libtool/version.html\nhttps://www.akkadia.org/drepper/dsohowto.pdf\nBTW. if you want to tightly couple your consumer (e.g. sassc) with libsass version, use static compile option instead of shared. Otherwise sassc will \"just\" use the installed libsass version (which you can query via sassc --version).. Added this topic to the whishlist. Feel free to re-open once there is some progress. Closing to keep the issue tracker for more urgent stuff. Hope you don't mind. Thanks!\n1: https://github.com/sass/libsass/issues/1892. Closing due to inactivity and there has no reproduction code been given.\nPlease re-open once you can provide some code to reproduce. Thanks.. Found another interesting issue with ruby sass 3.4.23:\n```scss\n:not(.thing) {\n  color: red;\n}\n:not(.bar) {\n  @extend .thing;\n}\nfoobar {\n  :host(:not(.other)) {\n    left: 0;\n  }\n}\n```\nresults in\nNoMethodError: undefined method `do_extend' for :not(.other):Sass::Selector::Pseudo\nDid you mean?  extend\n  Use --trace for backtrace.. > Dart sass is now the reference implementation. It's somewhat diverged from ruby sass. We should compare against that instead from now on.\nIs there an official announcement that it is already the new reference implementation? //CC @nex3 . Fair enough ... the mentioned example doesn't give any result on any ruby sass version at least on sassmeister ... no time to test locally with all ruby versions .... @xzyfer btw 3.4.6 is still missing release notes :-/. FYI I already verified with dart-sass and libsass output now matches, I only wanted to mention the strange behavior of ruby sass, nothing more ... looking forward to the pending release notes .... @nex3 here is one for a starter (ruby sass 3.4):\n```scss\n:not(.foo2):not(:not(.ext2)) {\n  color: red;\n}\nfoo {\n  :not(.foo2):not(:not(.ext2)) {\n    color: red;\n  }\n}\n```\n```css\nsass test.scss\n:not(.foo2):not(:not(.ext2)) {\n  color: red; }\nfoo :not(.foo2) {\n  color: red; }\nsassc test.scss\n:not(.foo2):not(:not(.ext2)) {\n  color: red; }\nfoo :not(.foo2) {\n  color: red; }\ndart-sass.bat test.scss\n:not(.foo2):not(:not(.ext2)) {\n  color: red;\n}\nfoo :not(.foo2):not(:not(.ext2)) {\n  color: red;\n}\n```\nAnother one:\nscss\n:not(:not(.baz1)) {\n  left: 0;\n}\n:not(.foo) {\n  @extend .baz1;\n}\n```scss\nsass test.scss\n:not(:not(.baz1)) {\n  left: 0; }\nsassc test.scss\n:not(:not(.baz1)) {\n  left: 0; }\ndart-sass.bat test.scss\nUnexpected exception:\nInvalid argument(s): components may not be empty.\n``\n. This PR is as good as it gets. IMO extending pseudo selectors is pretty brittle as it is. This PR implements current 3.4 behavior as closely as I can get it to work without regressing anything that we had in earlier versions. It should support the most common use cases, but I think extending wrapped selectors should be discouraged, since it is hard to predict what behavior you want/get. It is nearly impossible to debug the code-path in libsass due to the multiple conversion betweenNodeandSelector` instances .... Your version info seems strange, but your code works with latest libsass master and stable-3.4 branch.\n```bash\nsassc -v foo.scss\nsassc: 3.4.7\nlibsass: 3.4.7\nsass2scss: 1.1.1\nsass: 3.4\nsassc foo.scss\n.my-class:has( > select:disabled):after {\n  foo: bar; }\n```\n1: http://libsass.ocbnet.ch/srcmap/#Lm15LWNsYXNzIHsKICAgICY6aGFzKD4gc2VsZWN0OmRpc2FibGVkKTphZnRlciB7CiAgICAgIGZvbzogYmFyOwp9IH0K. Closing as resolved, although error message could be better. Ruby sass gives:\nError: Properties are only allowed within rules, directives, mixin includes, or other properties.\n       If \":root\" should be a selector, use \"\\:root\" instead.. Closing as duplicate of https://github.com/sass/libsass/issues/2453\nUpstream bug was https://github.com/nodejs/node/issues/14076. FWIW. ruby sass quits with the following error:\nErrno::ENOENT: No such file or directory - getcwd\n  Use --trace for backtrace.. Closed via #2529. Closed via https://github.com/sass/libsass/pull/2602. Closing as probable duplicate of https://github.com/sass/libsass/issues/2312\nPlease provide some working reproduction code to verify. Thanks.. Thanks @saper for the bisect, hope the fix is according to your findings.. Thanks for the thorough bug report. The issue actually lies in at-root as can be seen with:\nscss\n.root {\n  @at-root .child1, .child2 {\n    &[class*=\"--dodo\"] {\n      @debug '-------------------------';\n      @debug &;\n      @debug '-------------------------';\n      foo: bar;\n    }\n  }\n}\nI can hopefully come up with a fix that doesn't break other cases.. IMO this is also not supported by ruby sass, tested with Sass 3.5.5 (Bleeding Edge).\nError: \"env(safe-area-inset-left)\" is not a number for `max'. This should probably be reported upstream //CC @nex3 @chriseppstein . FWIW. the following doesn't emit any warning at all in ruby sass 3.5.5\n.and-and {\n  value: true &&&& false;\n}\nForget about it, seems it doesn't emit one once the result is \"cached\" .... Closed via #2530 . You're welcome. Btw. thanks for your nice python integration and constant good bug reports!\nLibSass could probably handle this error more gracefully, but I think a hard error is ok in this case \ud83d\ude03 . \ud83d\udc4d . Sass files are compiled before they are put on any host, so no, you cannot \"dynamically\" use the path of your website inside sass. Only way is to hardcode it with some variables. In the future please post questions like these to stackoverflow instead. Thanks.. I'd like to keep it in for now in case we get any regressions due to this. I'm pretty sure I've added this for a reason, but due to lacking of any tests regarding source maps I can't really remember why.. Improved parser to check for unicode issues first to report a better and sanitized error message. LGTM. Can you please squash or remove the first commit from the history?. I can't really reproduce the issue!?\n1: http://libsass.ocbnet.ch/srcmap/#QGZ1bmN0aW9uIHRlc3QgKCkgewogICRyZXN1bHQ6IDE7CiAgQGZvciAkaSBmcm9tIDEgdGhyb3VnaCAxMCB7CiAgICBAaWYgJGkgJSAyICE9IDAgewogICAgICAkcmVzdWx0OiAkaTsKICAgIH0KICB9CiAgQHJldHVybiAkcmVzdWx0Owp9CmZvbyB7CiAgcmVzdWx0OiB0ZXN0KCk7Cn0=. This is a duplicate of https://github.com/sass/libsass/issues/2244 and already fixed on latest master.\n1: http://libsass.ocbnet.ch/srcmap/#Ci5mb28gewogICAgLS1odWU6IDcwOwoKICAgIGJhY2tncm91bmQtaW1hZ2U6IGxpbmVhci1ncmFkaWVudCgKICAgICAgICBoc2wodmFyKC0taHVlKSwgMTAwJSwgNTAlKSwKICAgICAgICBoc2woMCwgMTAwJSwgNTAlKQogICAgKTsKfQ==. Good catch! It should use sass_delete_function_list. . AFAICS this was not correctly resolved for this case ...\n1: http://libsass.ocbnet.ch/srcmap/#LmZvbyB7CiAgY29sb3I6IHJnYmEodmFyKC0tY29sb3J2YXIpLCAxKQp9. Sorry to close this, but without a reproducible use case without a samba mount involved I need to assume this is more related to your network setup than libsass itself. Feel free to repoen if you can provide a reproducible case! thanks!\n1: https://social.technet.microsoft.com/Forums/lync/en-US/7518b810-f5f6-4c81-b646-77ba4a3247e0/0xc0000005-access-violation-running-app-from-mapped-drive-but-no-problem-from-unc-or-local?forum=w7itpronetworking. Did you check that the same issue is not present in hsla and/or similar functions?. Might be related to https://github.com/sass/libsass/issues/1026. Can you elaborate a bit how the formatting works? I fail to see the logic behind it! \nno intial indentation\nscss\ndiv { a {\n/*************\n       * a\n       * multiline\n       * comment\n       */\n      top: 10px;\n} }\n- result has nine spaces\ncss\ndiv a {\n  /*************\n         * a\n         * multiline\n         * comment\n         */\n  top: 10px;\n}\nthree spaces as indentation\nscss\ndiv { a {\n   /*************\n       * a\n       * multiline\n       * comment\n       */\n      top: 10px;\n} }\n- result has six spaces\ncss\ndiv a {\n  /*************\n      * a\n      * multiline\n      * comment\n      */\n  top: 10px;\n}\nfive spaces indentation\nscss\ndiv { a {\n     /*************\n       * a\n       * multiline\n       * comment\n       */\n      top: 10px;\n} }\n- result has four spaces\ncss\ndiv a {\n  /*************\n    * a\n    * multiline\n    * comment\n    */\n  top: 10px;\n}\nseven spaces indentation\nscss\ndiv { a {\n       /*************\n       * a\n       * multiline\n       * comment\n       */\n      top: 10px;\n} }\n- result has two spaces\n```css\ndiv a {\n  /**\n  * a\n  * multiline\n  * comment\n  /\n  top: 10px;\n}\n````\nAs you can see the lines following the initial comment have different indentation every time! But I have no clue what logic this follows!. BTW. the test were made with scss syntax! sass2scss preserves original input as much as possible!. I tested with dart-sass and ruby sass and it mostly seem to correspond:\nOne case where it differs is with ten spaces initial indentation:\nscss\ndiv { a {\n          /*************\n       * a\n       * multiline\n       * comment\n       */\n      top: 10px;\n} }\n- ruby sass\ncss\ndiv a {\n   /*************\n* a\n* multiline\n* comment\n*/\n  top: 10px; }\n- dart-sass:\ncss\ndiv a {\n  /*************\n  * a\n  * multiline\n  * comment\n  */\n  top: 10px;\n}. AFAIR LibSass only adjusts the initial line to indent according to the scope and keeps the rest as is.. This is not trivial since it is unclear how we should handle mixed encodings, e.g. when the main file is utf-8 and some import is another encoding, thus we can't really just put one into the other without properly converting it. It is also not really recommended by W3C to use anything else than utf-8 nowadays.\nIt's also worth noting that single bytes encodings before basically were undefined behavior, since they could lead to issues under certain circumstances (e.g. segfaults) and sometimes just seemed to work ok.\nIt will also mean that we need to have conversion tables for all supported single byte encodings.\n. FWIW: https://github.com/sass/libsass/blob/master/docs/unicode.md. @nex3 if I read your statement correctly, you're ok with limiting input and output to UTF8 only? For me that seems ok, since you should always store your files with UTF8 nowadays and refrain from using any other encoding if you have the need to use anything else beside standard ASCII in you css!? Btw. ASCII compatible IMO means char codes < 127, everything between 127 and 255 is already a specific single byte encoding table (which could be mapped perfectly to Unicode char codes though).. BTW. this is one use case where the way how libsass calls custom importers can come in handy, in regard to https://github.com/sass/libsass/issues/2483. A custom importer could sniff the charset and return a converted input in UTF8 encoding for libsass.. Thanks for the clarification, I therefore removed the \"Bug\" labels and left it as a \"feature request\" only.. Is it possible that webpack runs libsass compilers concurrently?\nIt seems related to a static variable and I can't reproduce it with sassc.\nI also don't see why it should be an issue beside when running concurrently.. Just made a simple test and the above assumption seem to be true!. This was deliberately changed in sass 3.5, please see http://sass-lang.com/documentation/file.SASS_CHANGELOG.html under backwards Incompatibilities.\n1: http://sass-lang.com/documentation/file.SASS_CHANGELOG.html#3_5_0__12_July_2017_. Short answer: no, not really => https://github.com/sass/sass/issues/1422#issuecomment-54389407. Works ok with sassc.exe index.scss -I include!??. node_modules\\.bin\\node-sass index.scss --include-path include works too??. OK, found the issue, seems windows UNC paths do not support ./ or ../ .... After some more API doc reading and try and error I figured out, that contrary to the MSDN docs some functions do support dot and dotdot references in UNC paths, namely GetFullPathNameW. There are many open questionmarks on my side, e.g. thread safety, why don't they just allow it with CreateFileW or GetFileAttributesW, how does it handle symbolic links in the path. It now uses at least the official win API. No suprise why so few programs (even windows Explorer) fail to implement all this properly .... I believe they mean it's unsafe to use if something is changing the current directory, anything else would surprise me, as the implementation would IMO pretty suck otherwise, although e.g. realpath on Darwin seems to do (has done?) exactly that. It should IMO anyway only be relevant if we feed it relative paths, which we dont. And BTW. since we already rely on CWD nothing really changes.\nAdditionally there are more confusing remarks for _getdcwd and _wgetcwd:\n\nThis function is thread-safe even though it depends on GetFullPathName, which is itself not thread-safe. However, you can violate thread safety if your multithreaded application calls both this function and GetFullPathName. For more information, go to MSDN Library and then search for GetFullPathName.\n\nThe link provided by @xzyfer seems to support my assumption that GetFullPathName only does a naive logical path cleanup, therefore violating how symlinks and dotdot references (should) work, but since symlinks and windows are very seldomly used, I'm fine with that and it's propably no different to my initial approach. It's also unclear if win APIs even support this in the regular case.\nFurther Note: We do not support UNC paths, we only use them to get around the path length limitations and my main beef being that MS does not offer some simple API to do that.\nAll in all I agree with @am11: ... it's probably enough until the next issue is reported. We could opt to only use UNC paths if the given path exceeds a certain limit, but it would only shadow errors in certain use cases and make them difficult to reproduce.\n2: https://msdn.microsoft.com/en-us/library/7t2zk3s4.aspx#Remarks. On a side note, the link by @xzyfer makes one wrong assumption:\n\non Unix, /home/peter/foo and /home/peter/src/../foo are the same file\n\nThis is not true when /home/peter/src is a symlink to e.g. /opt/src, then /home/peter/src/../foo would actually point to /opt/foo and not /home/peter/foo. \nTo repeat the note from perls canonpath at https://perldoc.perl.org/File/Spec.html#METHODS:\n\nNote that this does not collapse x/../y sections into y. This is by design. If /foo on your system is a symlink to /bar/baz, then /foo/../quux is actually /bar/quux, not /quux as a naive ../-removal would give you. If you want to do this kind of processing, you probably want Cwd 's realpath() function to actually traverse the filesystem cleaning up paths like this.\n. AFAICT ruby sass 3.5 (and latest dart-sass) gives the same error!\n\nhttp://sass-lang.com/documentation/file.SASS_CHANGELOG.html#3_5_0__12_July_2017_\n\nThe way CSS variables are handled has changed to better correspond to the CSS spec. They no longer allow arbitrary SassScript in their values; instead, almost all text in the property values will be passed through unchanged to CSS. The only exception is #{}, which will inject a SassScript value as before.. Not really if we want to keep make check from automake. Although it seems that target has been broken for a long time. Can you elaborate why you think this is an issue? This is an auxiliary script solely used for running the spec tests and should IMHO not violate any license constraints. In fact it is unfortunately recommended by automake themselves to include this script in ones source repo itself. Since the final LibSass library or any derived work is not based on it, I don't really see an issue to have it included in the source distro, as long as we retain their license header in the said script.\n\n1: https://www.gnu.org/software/automake/manual/html_node/Use-TAP-with-the-Automake-test-harness.html. MSCV and mac osx had some errors, therefore I included the fixes also here. I can split the PRs into smaller chunks if really needed, but it doesn't really change the commit history, so in order for me to safe some time I'll keep going here. Being cherry picking, merging, rebasing and cleaning commits for the last 6 hours from a branch that compiles fines on my local repo that has 100+ commits in the history.. Feel free to branch off a 3.5 stable branch. IMHO we can target this refactor for a libsass 3.6+ release, since sass has no version between 3.5 and 4.0, and the C-API will probably increment too. I expect that 3.5 is pretty stable already! Given that it took node-sass nearly a year to adopt 3.5 and LibSass waiting for that, I want to move this forward a bit faster this time. We need to clean out a lot of legacy stuff for that and naturally this means that we might break stuff that isn't covered with spec tests. . FWIW this PR should contain all improvements from my first WIP branch. I'll try to do the same with the next WIP branch tomorrow, as I have a few more ready on my local repo.. Yay, CI says \ud83d\udea2 IT. FWIW I forked of https://github.com/sass/libsass/tree/3.5-stable from current master.\n. Unfortunately this is not possible as it would fail if sassc is built out of source tree. Since it is just a warning we can live with it until we find a proper way to deal with sassc needed for running the spec tests.. It fails the following:\n```bash\ngit clone https://github.com/sass/sassc\ngit clone https://github.com/sass/libsass\ngit clone https://github.com/sass/sass-spec\ncd libsass\npatchin configure.ac to include subdir-objects\n./configure   --enable-tests   --enable-shared   --prefix=/usr --with-sassc-dir=../sassc --with-sass-spec-dir=../sass-spec\nmake -j12\n```\nFails with\nGNUmakefile:698: ../sassc/.deps/tester-sassc.Po: No such file or directory\nmake: *** No rule to make target '../sassc/.deps/tester-sassc.Po'.  Stop.. Should be fixed with https://github.com/sass/libsass/pull/2601. Just made a quick test with a clean repo and can't reproduce:\nbash\ngit clone https://github.com/sass/libsass\ncd libsass\nautoreconf --force --install\n./configure --disable-tests --prefix=/usr\nmake -j12\nAre you sure your repo is clean and does not contain old .dep stuff from previous autoconf runs?\n. I know it creates the file, but my make does not complain it could not find the file!?\nPlease try with a clean directory and show me the commands you're running!. Thanks, here a better test case showing the underlying issue:\nscss\ntest {\n  $col: desaturate(#fcfcfc, 15.7%);\n  test-col: desaturate(#fcfcfc, 15.7%);\n  test-hue: hue(lighten($col, 33.5%));\n  test-sat: saturation(lighten($col, 33.5%));\n  test-lig: lightness(lighten($col, 33.5%));\n  test-hsl: darken(hsl(0deg, 0%, 100%), 14.625%);\n  combined: darken(lighten($col, 33.5%), 14.625%);\n} \nRuby Sass:\ncss\ntest {\n  test-col: #fcfcfc;\n  test-hue: 0deg;\n  test-sat: 0%;\n  test-lig: 100%;\n  test-hsl: #dadada;\n  combined: #dadada; }\nLibSass:\ncss\ntest {\n  test-col: #fcfcfc;\n  test-hue: 180deg;\n  test-sat: 100%;\n  test-lig: 100%;\n  test-hsl: #dadada;\n  combined: #b4ffff; }. Interpolations will always yield strings, and strings can't be multiplied. This is and was always the case with sass and errors the same way in ruby sass. So using $em * 1em is actually the correct way to do this.\nhttps://stackoverflow.com/questions/8254941/math-with-interpolated-variables. Missed nth-of-type and nth-last-of-type and also that CSS draft 4 now has a \"of selector\" appendix. Probably means that we need some kind of \"nth-condition\" class to handle all this properly.. Duplicate of https://github.com/sass/libsass/issues/2585. I compiled it just now with MSVC 2017 and can't reproduce, the change is definitely not dangerous, since it only affects error reporting if CRTP implementation is missing some types. But as I said, can't reproduce .... Seems to be fixed with latest master: http://libsass.ocbnet.ch/srcmap/#YShiKHgpKSB7CiAgY29sb3I6IHJlZDsKICBAZXh0ZW5kIHg7Cn0=. Seems this is already fixed by https://github.com/sass/libsass/commits/1f56197e (Using libsass version: 3.5.2-36-g1f56197e) as my srcmap inspector shows. I have since updated to the latest version (3.5.3) and it shows the same output as the expected result from above!?!\ncss\n.something__child {\n  /* nothing */ }\n  .something__child:hover {\n    /* nothing */ }\n    .something__child:hover {\n      /* nothing */ }\n1: http://libsass.ocbnet.ch/srcmap/#LnNvbWV0aGluZyB7CiAgQGF0LXJvb3QgLnNvbWV0aGluZ19fY2hpbGQgewogICAgLyogbm90aGluZyAqLwogICAgICAgIAogICAgJjpob3ZlciB7CiAgICAgIC8qIG5vdGhpbmcgKi8KICAgICAgCiAgICAgICRub29wOiBzZWxlY3Rvci1uZXN0KCYsICcuc29tZXRoaW5nX19jaGlsZC0tbW9kJyk7CiAgICAgIAogICAgICAmIHsKICAgICAgICAvKiBub3RoaW5nICovCiAgICAgIH0KICAgIH0KICB9Cn0K. > If the sources are not absolute URLs after prepending of the \u201csourceRoot\u201d, the sources are resolved relative to the SourceMap (like resolving script src in a html document).\nThis is what libsass does, so we do adhere to the v3 draft. Since they are relative they are also valid relative \"posix\" paths. Hth. Probably duplicate of https://github.com/sass/libsass/issues/2743. Should not be to hard given that we already have Sass::Util::read_hex_escapes .... I think the use case has some merit, but on the other hand I think that it kinda defeats the merits of being really \"random\". Marking it as a feature request, but given that this would need to populate down to wrappers don't expect anything anytime soon.. Closing as we emit the same error as ruby and dart sass. If you think this is wrong you should take this issue to https://github.com/sass/dart-sass (or https://github.com/sass/ruby-sass).. Closing as a duplicate of https://github.com/sass/libsass/issues/1065. We don't expose the AST since it is internal knowledge and subject of often subtle and rarely heavy changes. Therefore we are not willing yet to expose this to the outside. Hope I understood your question right, because simply compiling libsass alone on android or iOS should be or might be straight forward!. This seems to be fixed by now (probably by https://github.com/sass/libsass/pull/2789). IMO static values cannot gain anything from being evaluated. I believe this is indirectly reporting the same bug as @nex3 did in https://github.com/sass/libsass/issues/2788. I currently get the following for you linked example:\n```css\nmyDiv {\nwidth: 1.234858939558593rem;\n  height: 1.4482873633;\n  margin-top: 5.58585938428; }\n```\nPlease reopen if you can reproduce with latest master.. Maybe something like this could be used to detect clang vs gcc (seems to work on windows):\nCOMPILER=$(if $(filter $(shell $(CC) -v 2>&1),clang),clang,gcc)\nIn the worst case we could add a small c file using compiler macros to do the detection, which needs to be compiled first and can then be executed to return the used compiler. Although I don't really like to go down this route, since we still have the autotools way ...\n```\nif defined(clang)\n/* Clang/LLVM. ---------------------------------------------- */\n\nelif defined(__ICC) || defined(__INTEL_COMPILER)\n/* Intel ICC/ICPC. ------------------------------------------ */\n\nelif defined(GNUC) || defined(GNUG)\n/* GNU GCC/G++. --------------------------------------------- */\n\nelif defined(__HP_cc) || defined(__HP_aCC)\n/* Hewlett-Packard C/aC++. ---------------------------------- */\n\nelif defined(IBMC) || defined(IBMCPP)\n/* IBM XL C/C++. -------------------------------------------- */\n\nelif defined(_MSC_VER)\n/* Microsoft Visual Studio. --------------------------------- */\n\nelif defined(__PGI)\n/* Portland Group PGCC/PGCPP. ------------------------------- */\n\nelif defined(__SUNPRO_C) || defined(__SUNPRO_CC)\n/* Oracle Solaris Studio. ----------------------------------- */\n\nendif\n``\n. I'm fine with any solution. Since @glebm already provided a PR for the second approach (thx), I'd say just go with that. It should also be more robust than parsing/matching the version output.. @alyssais the Makefile is also used on windows when compiling with mingw-gcc without msys2/cygwin environment. I don't think there is any native windows autotools buildchain.. P.s.git clone https://github.com/glebm/libsass.git --branch patch-2. Seems coverage reporting by the target(AUTOTOOLS=no COVERAGE=yes BUILD=static)has broken. Maybe we should set coverage for this target to no (we still have two valid results). @glebm maybe you could adjust.travis.yml?. Yep, I know, sorry, didn't want to blame your commit :) But maybe you'd have time to clean it up :). Ok, we just need to change COVERAGE=YES to NO in travis.yml. I'll see if I have time to make a PR. . Just checked this and libsass returns the correct line-feeds in the resulting css if the option is passed correctly. So this seems to be an issue with node-sass. @xzyfer can you transfer this issue?. OK, I see, AFAICT comments and other AST nodes do preserve the input 1 to 1, so this seems valid. Although this is very lowest priority to fix from our standpoint, since it doesn't change the semantics. I would really suggest to use a [.gitattributes](https://github.com/sass/perl-libsass/blob/develop/.gitattributes) file to solve your immediate problem!. Hi @glebm, will do once I get back home from knee surgery, might take a few more days. Best regards and thanks for your work. . @glebm Merged all your PRs so you can continue to get ASAN build green :) Thanks for your work and looking forward to confirm it all myself once I'm a bit more mobile again \ud83d\udc4d . Is this still valid? Why do we not get an error from appveyor?. I don't really care about the bump, but I would keep the compiler workaroundifdef` just in case somebody needs them, since IMO @am11 took quite some effort to figure it out and it doesn't really hurt to keep it in.. Btw. https://github.com/sass/libsass/pull/2648 seems closely related.. Can't reproduce either, please reopen if you can provide more information about why it fails on your side!?. Closing as it is not really an issue. I guess we will do another release around X-Mas/New-Year's Eve.. Note: we may should keep an eye out for performance regressions due to missing inline opportunities for the compiler. But I think we should not pre-optimize and have everything implemented in the header files. Only once we can prove that certain implementations really profit from being in the headers. This split should also slightly improve compile time since the compiler does not have to parse the heavy headers for every compile unit and we could still provide a \"unified compile unit\" (where all sources/headers are included in one big compile unit, IMO there was some discussion a few years ago about this...).. OK, seems this does produce quite a few clang warnings ... time to fire up my linux VM \ud83d\ude14 . Hopefully clang and MSVC are happy now ... waiting for CI .... > \n\nDoes make test_probe return the same result as before?\n\nWasn't this spec test already merged/activated!?. > \n\nWell, make test_probe returns a list of over a dozen specs that used to fail but now pass on master\n\nhttps://github.com/sass/sass-spec/pull/1312 ??. Did this also show up on CI? Btw. once you pointed out the missing change from you, I saw how I can reuse OrderNodes for std::includes: std::includes(rset.begin(), rset.end(), lset.begin(), lset.end(), OrderNodes());, sometimes C++ just doesn't feel natural to me :) Adjusting the commit now.. Rebased and amended once more to include the lost changes from @glebm again and also found out how to reuse struct OrderNodes::operator() for std::includes. @glebm care to take a look again?. @xzyfer any objections to move this forward?. Rebased on parent PR, kinda starting to loose the overview ... Ci is our friend ...\nEdit: I think I've lost one commit in the rebase process, trying to recover ... OK, I probably squashed it unexpectedly with a previous commit. History seems now OK again!. Rebased on master after roundhouse-cleanup-02 merge.. Rebased to fix another clang warning.. From coverage report it seems I've implemented quite a few edge cases for selector comparison that are never triggered. Some unit tests would be good, but so far we only have spec-tests to trigger those. Also implementing bullet prove equality and order operators are much harder than one might think .... Rebased after merging last PR.. Rebased since I forgot to update MSVC project files .... Fixed more clang warnings ... hopefully this is it for today rebase marathon.. Yay, no clang warnings and CI seems to get green ... still waiting for appveyor though .... The side-kick with swiss cities was more or less just a joke! And I'm aware this is only meant for libsass releases, but we do somehow need some versioning for our releases, also in regard to API/ABI compatibility.. Just to mention it: I really want to get https://github.com/sass/libsass/pull/2557 working for a 3.6.0 release. I really want to get rid of all those pesky node->ast conversions, maybe also converting the complex_selector implementations, since they are a pain to alter due to the linked tail. Got another week of \"free\" time due to my recovery from knee surgery ... not sure I can do it though.. Around X-Mas/Silvester probably, if I can't get this refactoring working till then I probably will never .... The API does have some weak spots, e.g. @glebm worked around some but they should be fixed properly.. Can be boiled down to:\nscss\ntest {\n  eq: ((1 + (11 / 1000)) * 1000) == 1011;\n}. Seems that our NUMBER_EPSILON is too high for this case; it seemed to work well on all other cases. Only way I see to solve this is to decrease the epsilon for another magnitude to 1e-12. Unfortunately I did not yet find a way to infer the epsilon reliably for all compilers. Maybe @glebm knows a better and portable way to compare floats/doubles for equivalency!?\nFor reference: https://www.quora.com/How-do-I-compare-two-floats-in-C++. We can't query precision option easily since it would require a global variable. Since the default shifted from 5 to 10 I assume an e-11 epsilon should do the job for most cases! At some point we will always see differences, simply due to how float comparison works!. I agree with what @nex3 said, sass functions are closer to real programming logic, so it is indeed possible that any input file creates endless loops, thus consuming memory ad infinite. Unfortunately in c++ this means it will segfault at some point due to exhausting the stack (depending on the underlying stack memory limitations). IMO we can't catch this type of errors in a portable way (heap out of memory should already be catched though). Adding a counter and enforcing an upper limit may work for most scenarios, but it does only hide the underlying issue, while crippling the maximum on most envs and also has a performance impact. IMO this should be closed as \"will not fix\" due to \"as designed, user input issue\".\nOn a side note: these kind of issues seem more important for eg. sassmeister or libsass srcmap inspector, since it allows some kind of DOS for remotely available system. But we always had this issue, and I personally use GRSEC/SELINUX to circumvent it.. I'm not really pro or con this change. My initial reason to introduce these types was to be able to check (search) which types I already converted during the conversion from global memory handling to reference counted memory handling. What I don't like are the Const_Ptr types, but I didn't find another solution to solve the issues at hand. And I guess it's rather cosmetics and personal choice what one prefers.\n@xzyfer not sure I got your comment right, but the difference is pretty easy. *_Obj is something that is reference counted and will be deleted when it goes out of scope, a *_Ptr is just a pointer to that object and it will not automatically be cleaned up if it is not assigned to an *_Obj later on .... That should be fixed by https://github.com/sass/libsass/pull/2789 which was merged earlier. Btw. feel free to add spec tests for those cases .... @nex3 I don't see any references to them in this issue? Can you be more specific?\nEdit: I checked them locally but no \"passing tests\" did show up on CI .... Somewhat still open if we want to expose HSL colors also to the C-API.. > \n\n@mgreter do you want to update this to match #2778 (comment)?\n\nWe don't keep and pass the setting for precision around everywhere, so this is not easily possible. . They are different and I'm open if anyone wants to detangle arglist vs. lists!? So far we have quite some workaround code to mimic how ruby sass does it, but I haven't figured out yet how (wrapped) arguments are different from regular lists. We do have quite some code in place just to handle those cases properly.. http://libsass.ocbnet.ch/srcmap/#dGVzdCB7CiAgY29udGVudDogc3RyLXNsaWNlKGFiY2RlZiwgLTEwLCAyKQp9. OK, I will have a look at how I can write this as a multiline command and will change it back to long flags again!\n. IMO this is not correct and should look like that instead (??):\nresult += std::string(generated_line - previous_generated_line, ';');\n. Nope, it should be that way, as ruby sass outputs it with a leading zero if it is comming from a variable (even in you've written it without). This is exactly what makes libsass behave the same way and the spec tests include this one!\n. Will ammend the PR later and remove this one :)\n. Hmm, It would need more changes as I would to add the zero flag to the Textual type too.\nIMO it's ok that way as other code in eval also parses the lexed input for more information!\nAnything speaking strictly against doing it this way?\n. I really tried, but I couldn't figure out how I could do it. Underlying it is a Vectorized Object and only the << operator seems overloaded. I tried to access the vector directly to insert it, but there is too much magick going on there. IMO it would feel more natural to prepend the original function name, but adding it to the end is also working (just feels a bit bad). Maybe I'll give it a shot again later!\n. OK, figured it out, I did not find a way to prepend to an existing Arguments list, but I was able to create a new one with first adding the name and then appending the rest of the arguments:\nArguments* new_args = new (ctx.mem) Arguments(c->path(), c->position());\n*new_args << new (ctx.mem) Argument(c->path(), c->position(), str);\n*new_args += args;\nargs = new_args;\n. I did not implement these as I'm not sure if they should have getter functions, as there is no real use case to fetch it back once it is set. Just left it there so I would not have to write it again if we chose to implement it later.\n. It's the same as before, just now only for expression (previously it was also the way how progid was parsed). So I just improved that part. expression is a whole other story, since it can be javascript, and therefore be pretty much anything!??\npreviousely:\nC\nreturn sequence< alternatives < ie_expression, ie_progid >, delimited_by<'(', ';', true> >(src);\n. Yep, thanks for spotting :)\n. This is how ruby sass prefixes them! \u00af(\u30c4)/\u00af\n. There already exists a error method for Parser ...\n. Was a question to where to make the split, so I went with DRY here (therefore two commits)\n. Good point, will take a look. IMO I only tested one level of includes, will make a more elaborate test case! Will also check how debug does report in this situation!\n. Unfortunately mkdir -p does not work on windows. But maybe you can confirm if it is legal/ok to have directories as targets in makefiles. Problem was that mkdir on windows reports unsuccessful exit status when it tries to create the same directory again ... still not sure what the best portable way is.\n. The problem is that mkdir returns a failed exit state if it tries to re-create an already existing directory (IMO that is 100% messed up by Windows/MS). And there doesn't seem to be an easy portable way to test for existing directories! But it seems that we can also use directories as targets within makefiles, which would make the check for existing directories obsolete! If anyone has a better solution for this, please enlighten me!\n. Nope, we do not care if the directory already exists, but the make process aborted if it tried to \"re-create\" an already existing directory. And there is no direct option to surpress it (the -p option lead to create directories named \"-p\" on windows). For now I resolved to create targets for the directory in the makefile. AFAIK these targets will only be executed if the path/file does not exist. I know that this is ok for files, but I'm not sure if this is also true for directories by definition! At least this PR seems to work on linux, mingw (windows) and mac os x!\nJust tried your suggestion with @$(MKDIR) lib || true and it seems to be supported by windows! Seems like another possible solution to this problem. But still not sure what the best and most portable solution is!\n. Review Note: Revert!\n. This is just temporary. Will have to do the compressed mode first and than add back source-maps. At least I got some unit test for this part!\n. The needs_unquoting flag will not be needed with the full refactoring. I my WIP this flag is needed to have the same behavior as ruby sass (https://github.com/sass/sass/issues/1291) which will be deprecated. Which means the sass_fix_1291 can probably be removed once sass has it deprecated. But you're right, currently it doesn't make sense as needs_unquoting is still in the code. Please see comment below about String_Constant vs. String_Quoted. I would favor to ignore it for now.\n. Yes, it probably produced wrong output in my WIP branch and unit tests don't seem to fail. I will need to check nested/compressed rendering anyway in the end. The goal is to get 100% equal output as ruby sass (which my WIP branch currently does).\n. It produces an error with my source-map unit tests, therefore I just marked it with a comment. Will need to check source maps after output rendering is stable.\n. In my WIP branch I set a flag in between. So this is just to get better diffs.\n. In the end String_Quoted will contain an unquoted value (it means the parsed string might has been a quoted string), while String_Constant is taken as is. \n. String_Constant will not be unquoted, never. This way we can preserve escape sequences (which is not the case if you unquote/quote it). To be honest it's also quite confusing to me. Be aware that this PR has no real implementation yet for String_Quoted. This will be added later. Maybe this helps to clarify it a bit more: ast.hpp and inspect.cpp. A String_Quoted will be added with quotes to the output if quote_mark is set (has no effect on String_Constant).\n. How can I use a variable inside AC_INIT (for version)?\n. I guess a shell script is easier and more clear at this point:\nSH\nif [ \"$LIBSASS_VERSION\" = \"\" ]; then\n  LIBSASS_VERSION=`git describe --abbrev=4 --dirty --always --tags 2>/dev/null`\nfi\nif [ \"$LIBSASS_VERSION\" = \"\" ]; then\n  LIBSASS_VERSION=`cat VERSION 2>/dev/null`\nfi\necho $LIBSASS_VERSION\n. Actually it is meant to be replaced manually (the file should just serve as a template). I just thought it is worth a try that way, but I have no idea if this actually works or has any benefits. We just don't want to have any fixed version numbers in files under source control, but I don't want to remove the whole file neither. Could use better documentation though!\n. Should use append_delimiter since it will add optional space in certain output modes!\n. If there should be an optional space, be sure to call append_optional_space() too!\n. I would suggest to use peek< alternatives < spaces, exactly<';'> > >() instead!\n. White-Space\n. Code left overs?\n. Code left overs?\n. Code left overs?\n. Actually it should only remove escaped newlines (a backslash before an actual linefeed). The implementation should be pretty correct and should support windows linefeeds to (but not old mac style). There is IMO only a very small \"issue\", that it will also actually remove /\\\\\\r*\\n/.\nFrom https://github.com/sass/sass/issues/1237#issuecomment-42056762\n\nFYI http://www.w3.org/TR/CSS21/syndata.html#characters\nFirst, inside a string, a backslash followed by a newline is ignored (i.e., the string is deemed not to contain either the backslash or the newline). Outside a string, a backslash followed by a newline stands for itself (i.e., a DELIM followed by a newline).\n. My tests seems to indicate that ruby sass allows pretty funny units for numbers, so yes, it should IMO be quite correct. But I think it might be usefull to explicitly define a prelexer for number units. Basically its the same as number + units. This fixes following case:\n\n1px    /     2px\n. Yes, that would be great. Let me know if you find something useful in their source!\n. Maybe it would be more correct to have a word-boundary match (like regex has with \\b)?\nOther than that I fully agree that this should be a step in the right direction!\n. I actually just saw that we already have the word boundary check implemented and in use for extend keywords. I just re-factored it a little bit and added a word prelexer to match a full word by a given kwd constant. Spec tests all pass and it should be more robust this way.\n-> https://github.com/mgreter/libsass/commit/2a05583cde482c42bd78edf148cb4a53703e8d48\n. Looks like your using debug_ast too :wink: I hope you like it as much as I do :smile: It actually decreased my time hunting bugs dramatically! I also thought about creating a nicer debug_env function, but I was able to use existing one (altough the output could be better there).\n. IMO it should be spot on now. The test I removed is obviously wrong, since rest parameters can come after a parameter with optional (default) value (as you can see has_optional_parameters_ is set when we had a preceding default_value. Or can you come up with a sample that doesn't behave correctly?\n. No, but kwd_or is forced to have word boundaries :wink: \n. No, it will be used as a size_t anyway. But the value passed by value() is a double, so I thought this makes it more clear that there is a conversion (and we may have to add correct behavior according to ruby sass what happens if non integers are passed in).\n. Shouldn't it be (untested):\nreturn word <\n         sequence<\n           exactly< else_kwd >,\n           optional_css_comments,\n           exactly< if_after_else_kwd >\n         >\n       >(src);\nThe word matcher only checks if it is not followed by a alnum character. So it doesn't care if the thing inside has any spaces (I guess this might be confusing). IMO your solution does exactly the same, but IMO indentation is off. And btw. I don't know, but I actually prefer to write each lexer on its own line, it's much better readable to me, specially with the correct indentation. Just wanted to ask as I tend to re-write them and wanted to get consens!?\n. I also saw that, but wasn't sure how to better address it. But we surely can move that to some more appropriate place. IMO we might be able to add a specific if clause just before internal functions are resolved, and if the name is compact emit this warning!?\n. Would make more sense IMO to use to arg variable and avoid fetching it twice from env ... maybe you want to move the To_String inside the if cases that actually uses it ...\n. A number can eval to something that is not valid, like:\n$a: 2px * 2px; // ->invalid\ndiv { margin: $a / 2px; } // ->valid\n. Unoftunately every bit (even the number 12) seems to be exactly needed this way.  But I guess this one loop can be rewritten with find_first_of ...\n. Do you really want to be that strict? Seems to work fine and not sure how ruby sass really does it ... this way it also accepts certain escape sequences (which I guess is correct). Feel free to create a more specific spec test ;)\n. OK, I see you're point!\n. Didn't yet come around to look more into it. But it's the reason why I added WIP again. Again I don't really know if we need to move the code part that uses this flag to another function. Will have another look after work :smile: \n. Good catch, seems valid, can be gone ...\n. The check for duplicates keys was moved to the eval stage. The reason for this is, ie. when we have variables as keys, we would check like $a == $b for duplicate keys. But we actually need to check it only after the keys have been evaluated ... I was not sure if we really can get rid of the first check, but it seems so ...\n. contextualize doesn't seem to be used?\n. if/else would be more consitent IMHO\n. Minor indentation / white-space mismatch\n. Good catch, will change to length and remove size\n. Would like to keep this since it is working, but I think I got some problem within a certain source file, so I commented it out (since it is for debugging I vote to leave it in at least for now).\n. I guess it doesn't really matter. Only has any effect if DEBUG is on, and I needed to debug that information at some point, so I started to uncomment them (there are already other such statements that are uncommented). IMO it can stay that way (more debug info enabled)\n. Would like to keep it for some time, since it could be needed (and has no performance impacts).\n. Would like to keep it for some time, since it could be needed !?\n. Will do!\n. Will do!\n. I already got a fix for the first issue ... they don't seem related much ...\n. I read on that page: CFLAGS for the C compiler, CXXFLAGS for C++ compiler and CPPFLAGS for the C or C++ preprocessor ... seems not to be exactly the same!??\n. Be aware we are in a Makefile, so we are in control of these vars and use them ourself. There is no actual connection (beside the name) to gcc or so until we pass them to the command line:\n%.o: %.c\n  $(CC) $(CFLAGS) -c -o $@ $<\nbuild-static: $(OBJECTS) $(LIB_STATIC)\n  $(CC) $(LDFLAGS) -o $(TARGET) $^ $(LDLIBS)\n. As I said, the current lines are well tested on many systems, so I rather don't change them just to fix cosmetics. But I agree it could be further consolidated and streamlined!\n. Why should this be removed? It debugs the associated media queries?\n. Why is there a dash before the variables/command? And I somehow would rather put the rmdir into the clean target itself, but I guess that's just a personal preference, but maybe you can see where I'm going ...\n. Bindings are only in the C space, nothing from outside should interface with the C++ internals! There is no stable API on that side!!\n. This declaration doesn't seem to match the implementation?\n. Why are they not static as the others?\n. This is just how XML works and IMO has nothing to do with VS.\n. leftover\n. Skip the prototype parsing if Parameters are passed to us to gain performance.\n. We now pass the static Parameters for each function (&rgb_params)\n. function with rest arguments: , false, true and parameter is marked is_rest 3 lines above\n. It might lead to memory leaks and it's also not really defined what should happen since importer could return different content for the same url this way.\n. Not 100% sure, but I feel char* without const would be more appropriate here, since you are responsible to delete (implying non const) it. Thinking about it, we may should also provide a sass_free_c_string function then?\n. Are you sure about this? Who is freeing it?\n. Just checked and it should be char* since ie sass_context_take_error_message also return a char* without const, and the have the same purpose. Seeing this, a sass_free_c_string actually should be there to free these.\n. Not sure if I follow? If you request a copy it's your reponsability to free it!?\nDon't see why libsass would free the new memory returned by strdup!?\n. Ah I see. Did you check if it's the only property affected by this?\n. I don't feel too confortable to copy the whole source if avoidable. We should see if we can delay the de-allocation then. I do see the point that it's propably only affecting error cases. But I would like to check first if we can delay it.\n. The if would no longer be needed (same while clause below)\n. The if would no longer be needed (same while clause below)\n. Maybe you konw/can explain why this is no longer needed?\nI'm also a bit worried about https://github.com/sass/libsass/issues/1871#issuecomment-172405988\nLast check should be if there are any memory leaks.\nBut it doesn't break perl-libsass, so LGTM so far.\n. Well there is std::vector<std::string> plugin_paths in context.hpp and struct string_list* plugin_paths in sass_context.hpp. But yes, normally we can expect memory to be alive until the main context is freed. There were also a lot of refactorings in the C++ part to re-use more of the C structs directly.\n. Is it really necessary to make another copy? I figure this should not be needed since we do not really alter anything here? Creating too many clones is the main reason why libsass is slower than it could be (I already removed some cloning in eval some time ago, which lead to the big performance gain). The other reason we are slower than needed is that we visit too many visitors, but I guess there is not much too avoid that and it should not have a big impact ...\n. IMHO if it should never mutate than the append_block is also superflous. Doesn't it always replace the children with itself anyway under that condition? Otherwise good work!\nProbably something like that should do it:\nc++\nStatement* CheckNesting::operator()(Block* b)\n{\n  for (auto child : b->elements()) {\n    child->perform(this);\n  }\n}\n. :+1: \n. Ordered Map doesn't seem to support it anyway, so I guess this has resolved itself.\n. has bool signature but only returns false?\n. same as above and also applies to functions below\n. You should be able to write that as LOCAL_FLAG(at_root_without_rule, false);\nThe macro will create a small stack object that will ensure the flag is reset once it goes out of scope. IMO that is much safer than resetting the flag on your own, since it will also handle cases where we exit via a throw. I have added that Macro (and the helper class) some time ago.\n. ACK. But wouldn't it be more sane to just make them void then? Not really a big deal, but signature just indicates something it is not actually doing this way.\n. I case you need better control you could create a variable scope local enough for your use-case.\n. ~~After a second look, shouldn't it be reset on line 100 too?~~\nSorry, see you only take the old value above, but set it below ...\n. On a third look I don't see why it shouldn't work here if you add the LOCAL_FLAG call here ... Since you seem to reset it just right before you exit the function (and therefore this variable scope).\n. Agree. It probably would make sense to just name it \"check_mixin_definition_parent\" etc. That would also make it more clear that they actually do throw an error (I don't really expect that from something prefixed \"is_\").\n. There is a caveat with at: http://stackoverflow.com/questions/3269809/stdvectorat-vs-operator-surprising-results-5-to-10-times-slower-f. Did not do any realworld performance assessements yet. We could also opt to use [] in our at implementation. But this would make most sense with a complete refactor of List handling in our AST nodes. Already did some tests in that direction.\nIMO in the end we should aim to use OO style as RVO should optimize these calls.. Yes, no copy needed there, can append directly. Yes, no copy needed there, can append directly. Fixed. Removed. remainder from performance tests with different container formats. Re-activated .... We use these all over the place. Big deal?. removed. Leaks fixed. Re-added caching. Had to go until I had Env running correctly.. MSVC debris. fixed.. Fixed. Used during dev since I had to replace each class with an updated one without breaking stuff.. Used during dev since I had to replace each class with an updated one without breaking stuff. Left for now (will rename sortly before PR finally ready). Used to differentiate regular selector from Keyframe_Rule. Easier to track where variables are passed and used.. I see, removed dead code. Not sure. I was under the impression current master is going for 3.5. Side note: we could use a runtime test for 3.4 vs 3.5 behavior, but a compiler directive is not simple, since we have a string in that constant (string compare is not really supported by #if preprocessor directives).. Same behavor as before, also see https://github.com/sass/libsass/pull/754\n1: https://github.com/sass/libsass/blob/master/src/file.cpp#L308-L310. Yep, commented due to unused var compiler warning.. Yep, commented due to unused var compiler warning.. Just realized that this change was done in ruby sass 3.4, not 3.5, therefore I think we should already have that removed. So to speak this is a bug in libsass 3.4. Or I did not get your comment?. I created a seperate commit for it, so it's better visible in this PR (for cherry-pick). IMO implementers are still free to add this on their own if the want to keep compatibility.. IMO it should move into C-API to be configurable. This is just a small step in that direction.. This is actually a bugfix as ruby sass 3.4 removed this behavior and we did not yet .... I'm not too excited about the wording \"delimiter\". I only use delimiter for stuff that goes between things and not around. Maybe that's just me? But I would have preferred something as Sass_List_Type. IMO it is confusing to have a delimiter and a separator.. Since this changes the function prototype anyway, I would prefer to have the \"official\" arguments before the \"libsass\" specific ones (size, sep, del, argl).. Can you provide an alternative paragraph?. Can you provide an alternative paragraph?. Not sure what you mean exactly? IMO it adds a bit more information than the old wording. And I don't think the old wording was any less confusing? IMO the whole paragraph does not make much sense, but I've left it in since it already was there.. Can you provide an alternative paragraph?. Interestingly there seems to have been a reason for these superflous returns .... I included the url. I separated it into two lines with \"current mainters\" and \"original creators\". Tried the rewrite it a little and be more \"humble\". I really would like to keep the emphasize on the speed, because that is IMO one of the core and key assets of libsass.. ~~No, the Macro is called as NESTING_GUARD(nestings), therefore it will in turn insert a call to LocalOption<size_t> cnt_nestings(nestings, nestings + 1). Meaning it will store the previous value and then increase it by one (reverting once local variable cnt_nesting goes out of scope).~~ \nSorry, read your statement the reverse way. Yeah, the second line should be name I guess.. IMO the check below will produce a segfault if the check above is not true, since the check below is only hit when value_ is NULL? Should this be a && logic?. The new property is not copied when cloning here.. Maybe use LOCAL_FLAG macro to ensure it is reset automatically when scope is left (e.g. due to thrown error). . Use url_kwd or maybe introduce a urlfn_kwd for reuse (seems we need both).. Use url_kwd or maybe introduce a urlfn_kwd for reuse (seems we need both).. Thx for the tip, I'll see that I can incorporate it in a later commit!. Can you elaborate a bit more? BTW. I struggled quite a bit here since I tried to reuse struct OrderNodes but failed miserably. Not sure if the way one defines the order for a std::set is incompatible to pass to std::includes, it feels like it should be possible to use the same way somehow??. Need to check if it is possible though, not sure we \"always\" want to construct it with those items.. It might be possible that due to the rebase it will come in a later PR (I remember that I manually re-added this change to some commit). But thx for checking, I will check myself again. Let me first see that CI is green, I promise I will check those again once I have all my changes green on CI. Don't want to loose your improvements for sure!. Found it, one can pass OrderNodes() directly. Looks like I already found this one a few months ago for std::sort but forgot about it. Reverted it in my other PR.. Those previous changes should be part of this PR now too!. It seems that we can't use default constructor due to the if clause. Do you think we could profit from creating a local instance here via the mentioned constructor arguments? I assume the constructor also just calls insert under the hood!?. @glebm looks like it got reverted again with the previous commit and added here again (as I thought, due to the rebasing). Please check again that it is included in the final result. Sorry about the mess. I will also keep an eye out that the spec you mentioned will pass after all the refactoring!. CI still passing sass-spec/spec/core_functions/color/hsla/error/one_arg .... After reviewing again, this check could regress if abspath = '\\0`. Maybe we should also check for size >= 2.. ",
    "lozandier": "@askucher Does this way support the shorthand way of declaring mixins (=) and including mixins (+). From the version of the script I saw, it didn't seem like it did. \n. Praise the sun!, I mean nice work, @mgreter!  I was in the same boat as @robmunro...\n. @mgreter Why is the minimal test case not the following (unless it implicitly also allowing the following to be legal):\nMinimized test case:\nsass\nfoo {\n  @bar(--baz);\n}\nExpected result:\nsass\nfoo {\n  @bar (--baz); }\n. ",
    "dogancelik": ":thumbsup: for .sass support.\n. @drewwells, you need to rename your file extension to .sass not .scss\nlibsass detects your format (indentation or braces) based on file extension.\n. ",
    "maiis": ":thumbsup: +1 for .sass support\n. ",
    "noahrc": "+1\n. ",
    "ArnaudWopata": "FYI, I ported @askucher code to a grunt plugin so you can convert your .sass files to .scss. I included the + \\ = convertion to @include \\ @mixin. It's a 0.1.0 version so feel free to report issues.\n. ",
    "afknapping": ":+1: for .sass support\nAnd thx, @ArnaudWopata!\n. ",
    "robi-wan": "+1 for .sass support\n. ",
    "monstersintokyo": "+1\n. Any idea, if this will get fixed? Thanks!. ",
    "ruedap": "+1 for .sass\n. ",
    "robmunro": "+1 :)\n. Nice work @mgreter! :thumbsup: Probably more excited than I should be about this - the lack of .sass support is one the reasons we haven't moved to SASS as all the languages we use are whitespace sensitive (Jade, Coffeescript, Stylus) but I'm keen to get the speed increase on build times from libsass. This would be a massive win:)\n. ",
    "jaketrent": "+1 yay, .sass!\n. ",
    "topfunky": "Sass user from the very first release here. Can't live without it, but I hate the SCSS curly brackets and semicolons version. That's what Sass saved us from! Would love to see this happen.\n. ",
    "qdsang": "@mgreter ! :thumbsup: +1 yay, .sass!\n. @mgreter Failed?\n. Always believe that something wonderful is about to happen.\n. ",
    "ryankshaw": "+1, would love to see @mgreter's stuff merged.\n. ",
    "sorahn": "More +1s.  This and switching JSON to CSON will be the end of all my semicolons!\n. @jackmahoney brings up a good point.  @mgreter does your interpreter handle both types of .sass syntax?\n. +1.  Just found this in our code.  Using an !optional in a loop where the first extend won't exist, but the rest will.  I worked around it by making a nearly empty selector for the first ones to be extended off of.\n. The current master version of libsass exhibits this behavior as well, It also puts in spaces after commas in RGBA declarations.\n. ",
    "kraftwer1": "+1\n. ",
    "igregson": "+1\n. +1\n. +1\n. ",
    "also": "In the meantime, is this documented somewhere?\nI spent a while trying to track down this error, as it's just a little counterintuitive that a library called \"libsass\" does not parse the .sass examples from sass-lang.com which is linked from the homepage and the README.\n. ",
    "abstracthat": "Thanks @mgreter! +1 for merging this.\n. I could really use this merged so I can implement it as a Hexo (node static site generator) plugin ASAP. It's tricky using ruby in this environment so indented sass support would be fantastic!\n. ",
    "jackmahoney": "+1\nI'd love to see .SASS file support with libsass. .SASS was the original syntax and a lot of people still use it or are even migrating from .SCSS because they feel it offers more expressive syntax. I wish I could help but my C skills are not great.\n. ",
    "drewwells": "Does this work? I'm unable to get any of the examples on http://sass-lang.com/guide to work with the Sass versions.\nhttps://gist.github.com/drewwells/86f147c30c20dcfea610\nAhh, I see that comments above that this only works with files.\n. How do you free the context with the new interface?  The code says that the old interface already does this, so.... should I include both interfaces to use this feature?\n. Check out Wellington, it is a drop in replacement for Compass but is built with libsass. There's benchmarks comparing it to Compass and https://github.com/wellington/grunt-wellington for integrating Wellington with Grunt. \nOn OS X, install it with brew\nbrew install wellington\nwt -h\n. I created Wellington as a libsass powered replacement for the spriting\naspects of compass. You can install it with brew, more info here:\nhttps://github.com/wellington/wellington\nFor the compass mixins, there are sass libraries that emulate those ie.\nhttps://github.com/Igosuki/compass-mixins\nOn Tue, May 5, 2015 at 2:35 PM Jerome Covington notifications@github.com\nwrote:\n\n+1 for this issue in general. But in the specific, I am looking for drop\nin replacements for these:\n@import \"breakpoint\";\n@import \"compass/css3\";\n@import \"compass/css3/user-interface\";\n@import \"compass/css3/transform\";\n@import \"compass/utilities/general/clearfix\";\nDoes anybody know about compass support in general, to date? Is there\nsupport for the above?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/82#issuecomment-99172341.\n. I'm adding new keywords on top of sass.  The primary goal is spriting and relative paths for assets (images, fonts). It would be great to be able to leverage libsass more for adding these commands.\n\nhttps://github.com/drewwells/sprite_sass#list-of-available-commands\n. Thanks to @mgreter this is now possible: https://github.com/sass/libsass/wiki/Custom-Functions-internal\nPerl implementation: https://github.com/sass/perl-libsass/blob/api/c-interface/lib/CSS/Sass.xs#L510\nGo (partial) implementation: https://github.com/drewwells/sprite_sass/blob/customfuncs/context/context.go#L110\n. @mgreter are there sass specs for the accuracy of error line numbers?\n. Thanks @xzyfer have a beer on me @changetip\n. I'm not totally sure how to do that since I'm dynamically linking it in my code. \u00a0Do errors send to stderr right now?\nOn Wed, Oct 15, 2014 at 7:49 AM, Adeel Mujahid notifications@github.com\nwrote:\n\nDoes redirecting stderr to file help; something like this:\nbash\nsassc input.scss 2> libsass-errors.log\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/539#issuecomment-59199742\n. To help explain why I like the error string currently being used, I'll link to my error string tokenizer: https://github.com/drewwells/sprite_sass/blob/master/error.go#L23\n\nThis takes the normal error object and looks for relevant info Backtrace, line number, file, etc.\n. @mgreter I've been trying to link environment.hpp via Golang's cgo but am having issues with linking to C++.  Is the Environment map something that makes sense to be added to extern available in sass_context?\n. Warnings are working!  Only one caveat, I'm not seeing backtraces in my custom callback.  Is there any trick to getting backtraces?\n. Interesting, I'm planning on building this into my libsass implementation.  I feel like file I/O could be better handled by impmentation rather than libsass directly.  File watcher for instance would be better handled by the libsass implementation.\n. This is awesome! @mgreter have a beer on me @changetip\n. @mgreter good catch on the size_t.  I'm noticing my custom callback is only working for the first function in the function list.  The 2nd or more don't get called.  Are you experiencing the same issue?\n. I think you hit the nail on the head.\nOn Fri, Dec 5, 2014 at 7:30 PM Marcel Greter notifications@github.com\nwrote:\n\nNot sure if we really can call this a bug, since you should make a copy of\nthat Sass_Value. How do you know what the lifespan of s_args is? You only\nknow for sure, that it will be valid for the time that your function is\nexecuted. The return value itself will be freed later, since you give\nownership of it back to libsass. So by returning the same instance, you\ntell libsass to free it twice (That's what I guess is happening). We should\nprobably have made the input argument a const, but I'm not a native c++\ndeveloper, so I have to make educated guesses here!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/689#issuecomment-65879697.\n. Yeah I think it should. It would be far better that this variable is freed\nthan to expect the implementation code to free it.\nOn Fri, Dec 5, 2014 at 9:00 PM Marcel Greter notifications@github.com\nwrote:\nI still think this is somewhat a valid bug report. But I don't know what's\nthe best way to address this (should the arg be const?). I guess a\nsass_clone_value would be handy in this case (whatever the reason is to\nreturn the input value back). To be honest, it would not be the simplest\nfunction to implement (as it is recursive ... but feasible).\nCan this issue be closed beside the mentioned improvements? If so, feel\nfree to open separate issues!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/689#issuecomment-65882955.\n. Sorry I was typing on a cell phone.  I was trying to say that I agree with your implementation.  It's better that libsass frees these variables by default.\n. Hmm, I'm still getting pointer being freed was not allocated when returning the variable passed to me.  cgo may not be warning on this constraint.\n. what wiki updates are you looking for?  https://github.com/sass/libsass/wiki/API-Documentation and https://github.com/sass/libsass/wiki/Custom-Functions-internal\n. I'm still unable to get inline warnings (on master) with CSS output with either situation valid SASS prior to the warning or valid SASS after the warning.  Is anybody else having this problem?\n. Nice guys!  https://github.com/wellington/wellington is ready.  Once 3.1 is\nready, I can ship wellington as a homebrew project.  Nice work!\n\nOn Mon Dec 22 2014 at 6:34:31 AM Michael Mifsud notifications@github.com\nwrote:\n\nI decided to also get #748 https://github.com/sass/libsass/issues/748\nover the line since it appear to be important to framework authors.\nI'll do the release notes in the morning.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/697#issuecomment-67832238.\n. @mgreter excellent writeup!\n\nI had a lot of trouble preventing shared libraries from being generated by make install.  I had to delete the dylib files generated during make install in order to enable static building.  Based on your wiki docs, I think my homebrew script here should not generate shared libs: https://github.com/drewwells/homebrew-wt/blob/master/wellington.rb#L36 Is there anything required to disabled shared lib building?\n. I think I got it all sorted out now, great docs!  I'll add OS X, it's not much different from linux except the shared libs generated are .dylib instead of .so\n. Added some instructions for setting up homebrew.  The default OS X build (clang?) never caused issues for me, so the defaults seem to work just fine on OS X.  The libsass formula on homebrew has been working for a while, I'll update the build instructions for this formula when we're ready for 3.1.  https://github.com/Homebrew/homebrew/blob/master/Library/Formula/libsass.rb\n@mgreter One last thing, does libsass require c++11?  There were some build errors in homebrew when I turned off requiring c++11.\n. I got a little excited and updated the homebrew recipe(s).  Waiting to push the button on merging to mainline homebrew!\n. Is sassc getting a 3.1 release?  Will sassc 3.0.2 be broken against 3.1?\n. So homebrew is pointing at 3.0.2 sassc (not head).  If I update libsass to\n3.1.0, will this break sassc installs via brew?\nOn Sun Jan 04 2015 at 11:41:43 PM Marcel Greter notifications@github.com\nwrote:\n\nSassc is always built to run the tests in our CI, so it should always be\ncompatible with latest libsass! There is actually no need to have the same\nrelease cycles for sassc, since we don't release binary anyway!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/697#issuecomment-68670432.\n. Thanks, that makes the homebrew release a lot easier.  I'm updating brew\ntest to support the new interface and will add sassc as well.\n\nOn Sun Jan 04 2015 at 11:55:44 PM Michael Mifsud notifications@github.com\nwrote:\n\nIt is done https://github.com/sass/sassc/releases/tag/3.1.0\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/697#issuecomment-68671099.\n. :+1: \n. Is this fixed? The referenced commit doesn't address this issue.\nOn Tue, Dec 16, 2014 at 6:39 PM Marcel Greter notifications@github.com\nwrote:\nClosed #708 https://github.com/sass/libsass/issues/708.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/708#event-208678296.\n. Yep, working for me.  thanks!\n. LGTM\n\nVerified optional arguments were populating values.\n. Thanks, I'll run my warnings test branch against your code.  Hopefully, it addresses the wonkiness I saw in my pr.\n. Warnings are correctly populating the error object from the compiler.  However, sass_context_get_output_string(compiler) is returning an empty string if the compiler ever encounters a warning.\n. As the issue says, \n```\nThe old behaviour is still active:\n@import \"file.css\";\nWill result in:\n@import url(file.css);\n```\nThis doesn't inline, CSS resolves the path by issuing a get request for the CSS file.\n. Awesome! Shouldn't this point to the official sass/libsass repo\nOn Thu, May 28, 2015 at 11:21 PM mockturtl notifications@github.com wrote:\n\nhttps://bugs.debian.org/cgi-bin/bugreport.cgi?bug=694730\n[image: :fireworks:] https://tracker.debian.org/pkg/libsass\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/757#issuecomment-106680543.\n. I'm reproducing this on sha 420d7fb4e578857150e15d80c966e5cac779d932\n\n```\ndiv {\n    $a: 1px;\n    $b: 2px;\n    foo: $a * $b;\n}\nterminate called after throwing an instance of 'Sass::Sass_Error'\nSIGABRT: abort\nPC=0x7f6ce215f107\nsignal arrived during cgo execution\n```\n. I'm reproducing on OS X and linux:\nApple LLVM version 6.0 (clang-600.0.56) (based on LLVM 3.5svn)\nTarget: x86_64-apple-darwin14.0.0\nThread model: posix\n. I'm running the following Sass.  What command did you want me to try?\ndiv {\n    $a: 1px;\n    $b: 2px;\n    foo: $a * $b;\n}\n. Ahh, I'm not running Sassc I'm running my implementation of libsass.\n-> % cpp --version\nApple LLVM version 6.0 (clang-600.0.56) (based on LLVM 3.5svn)\nTarget: x86_64-apple-darwin14.0.0\nThread model: posix\n-> % cd libsass; git rev-parse HEAD\n420d7fb4e578857150e15d80c966e5cac779d932\n. I'm working through setting up gdb debugging on OS X.  I'm not having much luck getting it to work with cgo (golang linker) though.\n. Aha, this is why I'm having so much trouble: https://github.com/golang/go/issues/5221\nOn linux, \n```\nrogram received signal SIGABRT, Aborted.\n0x00007ffff7029107 in __GI_raise (sig=sig@entry=6) at ../nptl/sysdeps/unix/sysv/linux/raise.c:56\n56  ../nptl/sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n(gdb) bt\n0  0x00007ffff7029107 in __GI_raise (sig=sig@entry=6) at ../nptl/sysdeps/unix/sysv/linux/raise.c:56\n1  0x00007ffff702a4e8 in __GI_abort () at abort.c:89\n2  0x00007ffff7b31b3d in __gnu_cxx::__verbose_terminate_handler() () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n3  0x00007ffff7b2fbb6 in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n4  0x00007ffff7b2fc01 in std::terminate() () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n5  0x00007ffff7b2fe19 in __cxa_throw () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n6  0x00000000007cf481 in Sass::error (msg=\"2px*px is not a valid CSS value\", path=\"stdin\", position=...) at error_handling.cpp:15\n7  0x0000000000767acf in Sass::Inspect::operator() (this=, n=0xd2ad80) at inspect.cpp:372\n8  0x0000000000760ebc in Sass::Inspect::operator() (this=0x210, dec=0x210) at inspect.cpp:94\n9  0x0000000000779c6f in fallback_impl (n=0xd2ae20, this=0x7fffffffea60) at output_nested.cpp:22\n10 fallback (x=0xd2ae20, this=0x7fffffffea60) at output_nested.hpp:102\n11 Sass::Operation_CRTP::operator() (this=0x7fffffffea60, x=0xd2ae20) at operation.hpp:93\n12 0x0000000000778e78 in Sass::Output_Nested::operator() (this=0x7fffffffea60, r=) at output_nested.cpp:115\n13 0x00000000007774e9 in Sass::Output_Nested::operator() (this=0x210, this@entry=0x7fffffffea60, b=0x210, b@entry=0xd2a1b0) at output_nested.cpp:52\n14 0x00000000006f5837 in perform (op=0x7fffffffea60, this=0xd2a1b0) at ast.hpp:290\n15 Sass::Context::compile_block (this=this@entry=0xd08fd0, root=0xd2a1b0) at context.cpp:244\n16 0x00000000006eaf81 in sass_compiler_execute (compiler=0xd08fa0) at sass_context.cpp:549\n17 0x000000000044dc77 in _cgo_22273bb0d233_Cfunc_sass_compiler_execute (v=0xc208085998) at /go/src/github.com/wellington/wellington/context/context.go:52\n18 0x000000000048b3f5 in asmcgocall () at /usr/src/go/src/runtime/asm_amd64.s:665\n19 0x000000c208085950 in ?? ()\n20 0x0000000000000008 in ?? ()\n21 0x000000c20804cbc0 in ?? ()\n22 0x000000000044fd19 in runtime.cgocall_errno (fn=0x489d25 , arg=0x0, ~r2=4758828) at /usr/src/go/src/runtime/cgocall.go:117\n23 0x0000000000480054 in runtime.mstart () at /usr/src/go/src/runtime/proc.c:836\n24 0x0000000000489d2c in runtime.rt0_go () at /usr/src/go/src/runtime/asm_amd64.s:106\n25 0x0000000000000001 in ?? ()\n26 0x00007fffffffeca8 in ?? ()\n27 0x0000000000000001 in ?? ()\n28 0x00007fffffffeca8 in ?? ()\n29 0x0000000000000000 in ?? ()\n```\n. Yep, @error parsing works great:\n@error(\"foo\");\ncss\nError: foo\n         stdin:6\nOn Tue Dec 30 2014 at 6:52:35 PM Michael Mifsud notifications@github.com\nwrote:\n\nThanks for that!\nIt looks like Libsass is returning the correct error\n6 https://github.com/sass/libsass/issues/6 0x00000000007cf481 in\nSass::error (msg=\"2px*px is not a valid CSS value\", path=\"stdin\",\nposition=...) at error_handling.cpp:15\nAre you sure wellington is dealing with the Sass_Error objects correct?\nDo you still get segfaults with this code?\n@error(\"foo\");\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/789#issuecomment-68415072.\n. working for me too, thanks @mgreter !\n\nError > stdin:9\n2px*px is not a valid CSS value\n. For C examples, check out the sassc source\nhttps://github.com/sass/sassc/blob/master/sassc.c#L271 for setting source maps\n. :100: yay!\n. I already maintain a Go implementation that links to libsass: https://github.com/wellington/wellington/tree/master/context\nI've been looking for a while to wrap/compile it better into Go, so that I don't have to build and link libsass separately anymore.\n. I made a little more progress on this, swig is throwing errors processing what looks like c++11 syntax:\nSwig error:\nast_factory.hpp:25:11: error: expected member name or ';' after declaration specifiers\nThe code causing the error:\nImport<Function_Call*>* new_CSS_Import(string p, size_t l, Function_Call* loc);\n. No, the problems are going to be target language dependent ie. Go can't handle having multiple variables with the same names. So I'm closing this in favor of directly building/linking the C API that is already provided & documented.\n. So how do you make use of it? Compile libsass, then use this to generate python native code from those C API headers?\n. What's the purpose of a custom reader? It understands additional import paths, it translates one syntax to another syntax ie. .sass to .scss?\n. From Wellington, I do the grunt work of reading in files concat together then pass the big string of files to the libsass data compiler. It's done this way as you mentioned to achieve better caching, and to support multiple input streams (stdin, file, HTTP). In the process of this, libsass has no context for what filename/line number is being processed, so those have to be resolved in the implementation. Custom reader would be a HUGE improvement.\nBear with me, as this comment is getting long. If implementors could build up a config object for the data compiler, it would add considerable flexibility to the reader.\nToday to do custom reading:\n1. generate big string\n2. set string to data compiler config\n3. execute data compiler\n4. Process sass maps, line numbers, and error line numbers manually\nCustom Reader:\n1. Create data compiler with array of inputs (structs) \n2. implementation reads string from file, process\n3. Create input object, add definition (filename), position (line number), content (scss)\n4. Append input object to array of inputs\n5. Repeat 3-4 for each input stream\n6. Execute data compiler\nOr is this already possible with custom importers?\n. I'm seeing the same problem:\n-> % sassc --version\nsassc: 3.1.0\nlibsass: 3.0.3\nsass2scss: 1.0.3\n-> % brew upgrade libsass\nError: libsass 3.1.0 already installed\n-> % brew link libsass\nWarning: Already linked: /usr/local/Cellar/libsass/3.1.0\nTo relink: brew unlink libsass && brew link libsass\nIt's possible the brew bottle has the wrong version baked into it, but it is in fact libsass 3.1.0.\n. Okay, the libsass brew bottle has the incorrect version in it. It's building with the correct version of libsass, but libsass.pc has 3.0.3 in it.\n```\nprefix=@@HOMEBREW_CELLAR@@/libsass/3.1.0\nexec_prefix=${prefix}\nlibdir=${exec_prefix}/lib\nincludedir=${prefix}/include\nName: libsass\nURL: https://github.com/sass/libsass\nDescription: A C implementation of a Sass compiler\nVersion: 3.0.3\nLibs: -L${libdir} -lsass\nCflags: -I${includedir}\n```\nChecking out tree/3.1.0, I see it does print the version 3.0.3 in support/libsass.pc.\n```\nautoreconf -fvi && ./configure --disable-shared --prefix=$(pwd) --disable-silent-rules --disable-dependency-tracking\n-> % cat support/libsass.pc\nprefix=/Users/drew/code/libsass\nexec_prefix=${prefix}\nlibdir=${exec_prefix}/lib\nincludedir=${prefix}/include\nName: libsass\nURL: https://github.com/sass/libsass\nDescription: A C implementation of a Sass compiler\nVersion: 3.0.3\nLibs: -L${libdir} -lsass\nCflags: -I${includedir}\n```\nSo long story short, it's printing the wrong version but the correct version of libsass is in use. Given that homebrew doesn't support versioning, I don't recommend we bother fixing this.\n. We currently have to manually tag the releases of libsass when doing homebrew releases. This is why the version being reported by homebrew is correct, but sassc thinks it is invalid. The autotools were still tagged as 3.0.3!\nI checked out the 3.1.0 release and it reported itself as 3.0.3 that's what my above comment is about. I'm not sure how autotools in C work, but it appears to be creating libsass.pc from this: https://github.com/sass/libsass/blob/3.1.0/configure.ac#L5\n. homebrew doesn't define this version at all. Is there a fallback when the environment variable isn't defined?\nhttps://github.com/Homebrew/homebrew/blob/master/Library/Formula/libsass.rb#L21\nENV[\"LIBSASS_VERSION\"] = \"HEAD\" if build.head?\nSo on brew install --head libsass LIBSASS_VERSION=HEAD is reported as the libsass version, otherwise LIBSASS_VERSION is not set. When I did my run above, I didn't have LIBSASS_VERSION defined, and 3.0.3 was reported as the version in use.\n. Hmm that is weird, I wonder why 3.0.3 is getting picked up.\nA VERSION file would be ideal for homebrew that's how homebrew maintainers prefer to keep up with the current version. Personally, I don't have much of an opinion on how this should be done. I have been happy baking the version into wellington https://github.com/wellington/wellington/blob/master/.libsass_version. It works much better than many other alternative way of tracking upstream versions.\n. Here's an example using the custom importer: https://github.com/wellington/wellington/commit/11c24e7\n. Duplicate of #880 \n. LGTM homebrew now returns Version: na when I build it. \nhomebrew will need updating to pass the version in prior to building. At least people won't think they have outdated versions now!\n. Ah okay, thought it was looking in the environment for VERSION. I need to LEARN 2 READ!\n. can you add VERSION file to the PR?\n. I misread.\nThis is putting the burden of versioning on the homebrew maintainers which is not the intention of homebrew. libsass should track its own version and make it so that even a novice of libsass can update the brew formula.\n. @mgreter homebrew gets it via the url: https://github.com/sass/libsass/archive/3.1.0.tar.gz\nWhen installing from head, the version is set to head so that is not the issue. On official stable releases, the version number needs to be provided somehow. Typically homebrew projects do that via a file with version info in it. This makes release maintenance simple and doesn't require messing with build instructions just to update a release.\n. Updating line 21 is not required and there won't be any indication of a bug until someone installs sassc and runs sassc -version. I searched around for examples of inferring version from the formula url in the project and found no examples.\nLeaving the formula as is will enter [na] in the version which imo is better than having it tagged as an outdated version. Homebrew itself keeps track of the version, I think that is good for now. See this output from brew info on the 3.1.0 bottle (that reports 3.0.3 from sassc).\nbrew info libsass\nlibsass: stable 3.1.0 (bottled), HEAD\nhttps://github.com/sass/libsass\n/usr/local/Cellar/libsass/3.1.0 (12 files, 4.1M) *\n  Built from source\nFrom: https://github.com/Homebrew/homebrew/blob/master/Library/Formula/libsass.rb\n==> Dependencies\nWhen I find some time , I'll continue digging to see if I can expose the version programmatically from the formula definition. There has to be a way! \n. It works, awesome @mgreter !\nSo I'm trying to understand your discussion about context. Right now, libsass expects the implementor passes along the error line number/column. Would it be possible to provide error line number of where the @import line is? If that's already being passed, apologies for missing that.\nI'm asking if sass_import_set_error is only passed a import list entry and a message (really no message would be fine with me \"import not found: {name}\" is all I will be putting in there. Here's the change I'm asking about:\nC.sass_import_set_error(ent, errMessage)\n. Can size_t be negative? I'm getting an error assigning -1.\nconstant -1 overflows C.size_t\n. string::npos is C++, I used C.UINTMAX_MAX to get -1 in a size_t (in case anybody else comes across the same situation).\n@am11 the error isn't mandatory, but returning any non-empty entry list uses that as the missing import. Returning an empty list or size 1 with nothing in it, results in a runtime exception. So I'm returning an error to override the blank import entry that seems to be required to do this.\nHere's the code, if there's a better way to do it: https://github.com/wellington/wellington/blob/importer/context/export.go#L41\n. I'm not great at C, what do I pass to sass_make_import_entry() to do that?\nI'm currently passing empty char* but that is succeeding as a successful\nimport of an empty file.\nOn Sat, Mar 7, 2015 at 12:03 PM Marcel Greter notifications@github.com\nwrote:\n\nYou could return a list with one entry, where you only set the filename\n(no data). Libsass will then try to load that file through it's standard\nloading code, which would emit the error @am11 https://github.com/am11\nprobably meant. But IMO you should only do that if you are sure the file\ndoes not exist, otherwise it could have strange side effects!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/915#issuecomment-77701298.\n. Thanks for your patience, it's working great. Sending nil did the expected behavior\n\nerror > stdin:1\n    file to import not found or unreadable: non_existing_file\n. FYI: I'm getting runtime exceptions with these changes\n. I wasn't sure how to bisect a merge, but appears you can!\nhttps://github.com/sass/libsass/commit/b5235ec54021b49411bd2c8db6584c9a5e97659a\nintroduced the exception.\nOn Mon, Mar 9, 2015 at 7:30 PM Marcel Greter notifications@github.com\nwrote:\n\nWould be helpfull to have a specific commit to pin your issue!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/927#issuecomment-77973806.\n. Sorry, I'm not easily reproducing the problem. I'll keep digging and file an issue if I can find the problem. After cleaning and rebuilding several times on latest master, I'm not reproducing this. Maybe it was just a build problem.\n. That's probably it, thanks for the info.\n\nOn Tue, Mar 10, 2015 at 2:38 AM Marcel Greter notifications@github.com\nwrote:\n\nYep, you need to make clean if some header structures have changed, which\nwas definitely the case!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/927#issuecomment-78007829.\n. A test runner would be awesome for filing bugs :+1:. Currently, it is challenging to properly file issues (with tests) for these types of errors.\n. :+1: commit fixed @extend errors \n. That is AWESOME! Exactly what I was looking for!\n. Looking at your examples. BTW, thanks for adding these!\n\nhttps://github.com/sass/libsass/wiki/API-Sass-Importer-Example/_compare/e4632bbb5d318d762eff989d0deea8ecfca3d944...01033b0eaa6cec7e84409368670b3390a87e96a6#diff-5afb5882bce1cf2d786d8766101cdbe6R86\nReturning nothing will cause libsass to throw file to import not found or unreadable: {name}. The wiki should describe that.\nhttps://github.com/sass/libsass/wiki/API-Sass-Importer-Example/_compare/e4632bbb5d318d762eff989d0deea8ecfca3d944...01033b0eaa6cec7e84409368670b3390a87e96a6#diff-5afb5882bce1cf2d786d8766101cdbe6R95\nIn my experience returning a 0 size array causes runtime exception as the code is expecting a non-empty array, did you try this and see something different? I ran this again and got the following Go error:\nfatal error: unexpected signal during runtime execution\n[signal 0xb code=0x1 addr=0x10 pc=0x426fc34]\nhttps://github.com/sass/libsass/wiki/API-Sass-Importer-Example/_compare/e4632bbb5d318d762eff989d0deea8ecfca3d944...01033b0eaa6cec7e84409368670b3390a87e96a6#diff-5afb5882bce1cf2d786d8766101cdbe6R99\nAgreed, this should probably throw some sort of error, since it does nothing and never will.\n. Seeing ~0.8% speedup on project compile time vs 3.2.0-beta.2\n. Yeah I thought 0.8% was really impressive. The performance graph does show\na lot of time is spent compiling and freeing the compiler context vs OS\ntasks like file I/O.\nOn Thu, Mar 26, 2015 at 1:52 PM Marcel Greter notifications@github.com\nwrote:\n\n@drewwells https://github.com/drewwells I'm actually quite surprised\nthat you see such an improvement. My benchmark test was really not a\nreal-work case and I was more concerned with the memory usage there (DOS).\nI would also like to implement memory limits for allocations as it should\nbe trivial inside memory manager.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/985#issuecomment-86668645.\n. rock on :100: !\n. @mgreter pr #989 fixes this issue :+1: \n\n/* line 19, stdin */\n.foo {\n  content: \"Foo-Bar-Baz-Qux\"; }\nRebuilt: test.scss\n2015/03/27 13:16:39 main.go:94: Compilation took: 8.654ms\n. My initial run showed things were slower with this change vs 3.2.0 beta2.\nMy real world benchmark has a lot of things going on, so this is probably just noise. I'll try again later tonight and see if I can do a more targeted benchmark.\n. tried benchmark against master, crazy fast! 1 second off 24.5s normal compile time. nice job!\n. just as a sanity check, b/c this has been changing a lot lately. Here's the params I pass to build libsass\n-lsass -lsdc++ -lm -ldl -std=c++11\nlm is removed by this PR and I think ldl was removed in another. Which of these params should I be passing now?\n. My problems, but I'm dead in the water without this fix: https://circleci.com/gh/wellington/wellington/328\n. No problem thanks for being on top of this!\nOn Sat, Mar 28, 2015 at 7:25 AM Marcel Greter notifications@github.com\nwrote:\n\nGood catch and sorry for the inconvenience!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/998#issuecomment-87218033.\n. Possibly related. Is it possible to get a list of files used by the file compiler? This would be super handy for implementor building a file watcher. That rebuilds correctly based off imported file changes.\n. Also, sass_context_get_included_files_size (struct Sass_Context* ctx) added to API!\n. I'm getting cannot find errors on sass_importer_set_list_entry. I'm kinda dumb, so I grepped to find answers.\n\nsass_make_importer_list has an entry in sass_functions.cpp, but sass_importer_set_list_entry does not. Is that why it's not working?\n. Custom functions is the new way of supporting the import overrides in Ruby\nSass. These work very well and less confusing in my opinion. From code I've\nseen, it was quite rare for anybody to actually understand the various code\nimports Compass supported. They just @import \"compass\" and hope for the\nbest. I think the explicit overriding of functions is a far better way to\nsupport these mechanisms.\nSince libsass has no custom mixin support, headers fill that gap quite\nnicely. I understand your hesitation about custom headers. It does place\nmagic into the end user code that may have undesirable affects. See the\ndiscussion on https://github.com/sass/libsass/issues/489. True people could\nput code in there, but it's not a developer detail it's an implementor\ndetail. Removing custom headers wouldn't prevent implementors doing it\nanother way like I've had to for a while now. I am quite happy to now have\ncustom headers to do this with.\nOn Wed, Apr 1, 2015 at 5:17 PM Chris Eppstein notifications@github.com\nwrote:\n\nLoad paths is just a simple way to make a filesystem importer. In this\nway, importers are actually the first class citizens and it allows\nimporters and filesystem paths to be intermixed. Furthermore, the\nresolution order should just be a list IMO. I don't understand why we need\npriority.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1000#issuecomment-88651387.\n. Loading specific functions would be rather tedious. Maybe packages that\ndefine sets of functions would be an affective way of making functionality\navailable. The imports are a good idea for a library of functionality. The\nonly issue I see is that errors would not give any indication of what went\nwrong. Function not available couldn't be tracked back to a missing package\nas libsass would no idea what package the function comes from.\n\nThinking of this problem like most modern language. IDEs provide support\nfor manipulating the import selection based on the code. This isn't\nsomething Sass users can lean on. Calling \"package-function\" would add the\nnecessary compass import. It would actually be easier to track these things\ndown if rather than @function {function name} was referenced from a package\n@function {package}.{function name}. This connects the functions back to\npackages and relies less on the 'just works' principle that custom headers\nand custom functions provides.\nOn Wed, Apr 1, 2015 at 6:18 PM Chris Eppstein notifications@github.com\nwrote:\n\n@mgreter https://github.com/mgreter OK, I get that native plugins have\nthis issue, but the priority value is really unintuitive to me. There's no\nagreement what any priority value means and any scheme that may arise would\nlikely be better implemented in a less granular way. IMO, the priority from\nnative plugins should be limited to HIGH and LOW where high priority\nplugins are guaranteed to be considered before the load path and low\npriority plugins are guaranteed to be considered after the load path. Then,\nany further resolution should belong to the implementer's API.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1000#issuecomment-88661704.\n. for perl :p. cgo isn't so gentle!\nhttps://github.com/golang/go/wiki/cgo#turning-c-arrays-into-go-slices\n\nOn Sat, Mar 28, 2015 at 8:08 PM Marcel Greter notifications@github.com\nwrote:\n\nIMO it's actually not very hard [image: :wink:]\nchar** incs = sass_get_included_files;while (_incs) { process(_incs); ++incs; }\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1001#issuecomment-87336395.\n. I thought about doing:\n\nfor i := range sass_get_included_files {\n  if sass_get_included_files[i] == nil {\n    length = i\n  }\n}\nbut this might cause bad runtime exceptions\n. True!, but this makes it available in the API which felt like a good service to others coming across the same issue. Also, num_included_files was already in the interface but not used anywhere: https://github.com/sass/libsass/blob/master/sass_interface.h#L58\n. Closing in favor of #1000. Thanks @mgreter \n. :+1: :+1: existing tests are all looking good and a nice little speed boost too!\n. @chriseppstein I'm confused on the mention of the relative http importing.\nIt appears Ruby Sass ignores imports with http in them and instead uses CSS to resolve these declarations: http://sass-lang.com/documentation/file.SASS_REFERENCE.html#import \nCan you clarify what you mean by relative imports for non-files? As in, is this where you think it should be or where it is today?\n. Each import engine is passed the current raw import string cur_path and previous import Sass_Import_Entry. Relative import would be sass_import_get_base(previous) + cur_path, which any importer can implement.\nGlobal relative resolution on every import would cause unintended problems. For instance, if we're 3 directories deep and call @import \"myplugin\", myplugin would get translated to full/path/dir/myplugin which would require complex path parsing or ignored by a high priority plugin importer expecting to be passed \"myplugin\". The priority system and passing raw import information to the engine avoids these problems and is a clean way of negotiating imports across multiple engines while supporting specialized operations like relative resolution.\n. The prev_path returns the parent which contains the import currently being requested at cur_path.\nIf I'm understanding you correctly, you are using the data compiler. When using the data compiler, the prev_path is set to stdin as there is no file path it can be connected to. I've never gotten empty string for this property. If that file goes onto list another import, prev_path will be the current file.\nHere's code thats used with the file and data compiler, if that helps: https://github.com/wellington/wellington/blob/master/context/importer.go#L9\ndata compiler\nprev_path == stdin cur_path == import\nfile compiler\nprev_path == file cur_path == import\n. Thanks for adding your input, that helps me figure out a lot!\nWhich compiler are you using? I assume when you say you're switching Context objects, you're also using the appropriate compiler. I modified my importer to do the same prints as yours.\n```\npath: testfile\nprev.path: stdin\nprev.base: stdin\npath: sub/deeptest\nprev.path: testfile\nprev.base: testfile.scss\n```\nAs you can see I never get empty strings or null pointers, always file path or stdin. Which commit hash of libsass are you on? I'm using sass/libsass@d215db5\n. There is an issue with sass_import_get_base when used with the data compiler. The file compiler reports the absolute path to the import, the data compiler is reporting only the filename relative to working directory.\n. Ahh! This makes more sense now.\n. This is how I do it\nhttps://help.github.com/articles/checking-out-pull-requests-locally/\nOn Thu, Apr 2, 2015 at 4:36 PM Rodney Rehm notifications@github.com wrote:\n\nLooks like this PR fixes the problem!\ntested the following way:\ncd libsass\ngit checkout master && git fetch --prune && git pull --rebase\ngit remote add mgreter git@github.com:mgreter/libsass.git\ngit fetch mgreter\ngit merge mgreter/bugfix/issue_1035\nbuilding my stuff\nis there a simpler way to locally merge a PR manually adding all PRs to\n.git/config:\n[remote \"origin\"]\n  url = git@github.com:sass/libsass.git\n  fetch = +refs/heads/:refs/remotes/origin/\n  fetch = +refs/pull//head:refs/remotes/origin/pr/\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1038#issuecomment-89050901.\n. Would love to see these updated. I find it easier to run my own tests than\nwrite and run ones for libsass just because the confusion of using the test\nsuite . Also some tips or forum on building practices would be nice. I have\na lot of questions on bad things I encounter while building :)\nOn Sat, Apr 11, 2015 at 10:54 AM Martin Ausw\u00f6ger notifications@github.com\nwrote:\nThe Developing section https://github.com/sass/libsass#developing of\nthe readme currently suggests:\nAs you may have noticed, the libsass repo itself has no executables and no\ntests. Oh noes! How can you develop???\nWell, luckily, SassC is the official binary wrapper for libsass and is\nalways kept in sync. SassC uses a git submodule to include libsass. When\ndeveloping libsass, its best to actually check out SassC and develop in\nthat directory with the SassC spec and tests there.\nI\u2019m not sure if this information is still correct. AFAIK SassC dropped the\nlibsass submodule in sass/sassc@7ecebb2\nhttps://github.com/sass/sassc/commit/7ecebb2b951d17760ed43a9011847a888546d43b\nand the tests are in sass/sass-spec https://github.com/sass/sass-spec\nnow. From the readme of SassC the workflow seems to be something like this:\n1.\nCreate a directory for the project, e.g. /Users/you/dev/sass.\n   2.\nClone libsass, sassc and sass-spec into subfolders of the project\n   directory.\n   3.\nAdd environment variables for paths to these folders:\nexport SASS_SPEC_PATH=/Users/you/dev/sass/sass-spec\n   export SASS_SASSC_PATH=/Users/you/dev/sass/sassc\n   export SASS_LIBSASS_PATH=/Users/you/dev/sass/libsass\n4.\nRun the tests via cd /Users/you/dev/sass/libsass and ./script/spec.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1095.\n. I run these commands when building a static version of libsass for linking to my project:\n\nautoreconf -fvi && ./configure --disable-shared --prefix=$(pwd) --disable-silent-rules --disable-dependency-tracking && make && make install\nIt generates the following compiled assets\n-> % find include lib -type f\ninclude/sass.h\ninclude/sass2scss.h\ninclude/sass_context.h\ninclude/sass_functions.h\ninclude/sass_values.h\ninclude/sass_version.h\nlib/libsass.a\nlib/libsass.la\nlib/pkgconfig/libsass.pc\nA couple caveats:\nIt modifies Makefile and sass_version (not sure why the latter is even checked in). This is a bit inconvenient when committing to libsass, so be careful not to commit these files.\nWhen switching branches/versions, you should be able to just make && make install. The modifications to the makefile make this challenging though.\nOften, I'm looking at just one test not all 1000s of them so I don't use sass-spec very often. Sass-spec takes 17seconds to run after compiling everything required when an isolated test can be linked and tested in milliseconds for me. So to cut down the develop/test/repeat process, I write a sass file and run it through Wellington to check output.\n. Requested invite!\nOn Thu, Apr 16, 2015 at 5:38 AM Michael Mifsud notifications@github.com\nwrote:\n\nTurns out due to changes in the API this is currently a non-started.\nrauchg/slackin#38 https://github.com/rauchg/slackin/issues/38\nrauchg/slackin#16 https://github.com/rauchg/slackin/issues/16\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1110#issuecomment-93704533.\n. Where should I send my email?\n\nOn Thu, Apr 16, 2015 at 6:07 PM Michael Mifsud notifications@github.com\nwrote:\n\nUnfortunately as per my follow up comments this doesn't work. If you send\nme your email address I can invite you.\nOn 17 Apr 2015 02:27, \"Drew Wells\" notifications@github.com wrote:\n\nRequested invite!\nOn Thu, Apr 16, 2015 at 5:38 AM Michael Mifsud <notifications@github.com\nwrote:\n\nTurns out due to changes in the API this is currently a non-started.\nrauchg/slackin#38 https://github.com/rauchg/slackin/issues/38\nrauchg/slackin#16 https://github.com/rauchg/slackin/issues/16\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1110#issuecomment-93704533.\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1110#issuecomment-93777866.\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1110#issuecomment-93859229.\n. I'm not able to reproduce this using commit: fec7377. Perhaps this has already been fixed on master. Copy/pasted from SassMeister\n\n```\ngo run wt/main.go test.scss\n/ line 74, /Users/drew/src/github.com/wellington/wellington/test.scss /\n.customer-grid-item {\n  float: left;\n  margin: 0 0 0 2.12766%;\n  width: 6.38298%;\n  width: 24.93617%;\n  margin: 0 0 20px 0; }\n  / line 31, /Users/drew/src/github.com/wellington/wellington/test.scss /\n  .customer-grid-item:first-child {\n    margin-left: 0; }\n  / line 35, /Users/drew/src/github.com/wellington/wellington/test.scss /\n  html.flexbox .customer-grid-item {\n    float: none; }\nRebuilt: test.scss\n2015/04/22 12:43:12 main.go:95: Compilation took: 9.808ms\ndrew@dumass [12:43:12] [~/src/github.com/wellington/wellington] [master *]\ndrew@dumass [12:43:19] [~/src/github.com/wellington/wellington] [master *]\n-> % go run wt/main.go -v\n   libsass: 3.2.0-beta.6-2-gfec73-dirty\n```\n. Can you provide a shortened example that illustrates the problem. Removing\nany variables that aren't needed to reproduce this.\nOn Thu, Apr 23, 2015 at 9:33 AM David Fox-Powell notifications@github.com\nwrote:\n\n@xzyfer https://github.com/xzyfer @drewwells\nhttps://github.com/drewwells my mistake, it is a media query in the\nmain bootstrapped smart-grid.scss that is calling the column-set mixin\nthat is causing the problem\nif you add\n@media (min-width:$columns-break-point) {\n    @include column-set;\n}\nnode-sass will throw the error I'm referencing\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1122#issuecomment-95607021.\n. @xzyfer I've also had problems with this, but didn't know the solution was this simple! There are several situations where the header is included with double quotes, but aren't found in the current directory.\n\nhttps://github.com/sass/libsass/blob/master/contrib/plugin.cpp#L4\nhttps://github.com/sass/libsass/blob/master/test/test_node.cpp#L4-L6\nAnd every other file in the test directory.\nI'm not actually sure how these compile properly, I modified the source to get these compiling outside of the libsass makefile/autotools setup.\n. It would be fantastic if they could be removed or made compilable then :).\nOn Tue, Apr 28, 2015 at 9:14 AM Michael Mifsud notifications@github.com\nwrote:\n\n@drewwells https://github.com/drewwells to my knowledge those files are\nunused.\nThe contrib directory is essentially an \"examples\" directory. We never\ncompile them for Libsass.\nI believe the folder was added a part of the initial @extends\nimplementation, but afaik we do nothing with it. Maybe @hcatlin\nhttps://github.com/hcatlin can shed some more light on this directory?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1141#issuecomment-97077263.\n. @mgreter agreed, it should be linked to directly https://github.com/sass/libsass/blob/master/contrib/plugin.cpp#L4\n\nIMO, should read \n```\ninclude \"../sass_values.h\"\n```\nSince this file isn't in the current working directory. It looks like -I.. is locating the header for you.\n. True, ../header wouldn't find system libraries, not sure what use case this file is aiming to be used for then. The general issue I was raising is these files are checked into sub directories contrib/* test/* but expect to be compiled in the libsass directory.. Both directories include headers that do not exist in the current directory. So these files require modifying include paths or adding libraries system wide which breaks portability.\n```\ninclude \"file\"\nThis variant is used for header files of your own program. It searches for a \nfile named file first in the directory containing the current file, then in the same \ndirectories used for <file>.\n\n```\nhttps://gcc.gnu.org/onlinedocs/gcc-3.0.2/cpp_2.html#SEC6\nIf these are examples, should they be in an examples directory? ...Named something besides .cpp? It's not very clear how to use them without some tinkering into libsass. For instance, neither g++ comment in plugin.cpp worked (without installing libsass as a system library). The command that did work for me was:\ng++ -shared plugin.cpp -o plugin.so -fPIC -L../lib -I../include -lsass\n. Would it help if that issue was broken up into different tasks? There seems to be a lot of different bugs filed under one all encompassing issue. This might help carve off some of the bugs into actionable items.\nFor instance, demonstrates how two string results from the importer override each other;. That sounds like an isolated problem from some of the others mentioned.\n. It's available via brew \nbrew install sassc\n. You can inspect that with brew info I believe. You won't be able to install\nold versions via brew, it doesn't support versioning.\nOn Thu, May 14, 2015 at 8:25 PM Antti notifications@github.com wrote:\n\n@drewwells https://github.com/drewwells is the 3.1 libsass on tap?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1205#issuecomment-102157242.\n. I can confirm in my project, libsass is still roughly same speed as before on a 3.3meg sass project. So this is likely an issue with node-sass.\n. http://sassmeister.com/gist/de3195efdb01319e4cf7 confirms regression\n. It is cool that it will read a VERSION file, good to know!\n\nThis is not for generating archives, it's for making custom configured versions of libsass. configure is designed to allow for this behavior. You could for instance do.\ncd ../shared-libsass; ../libsass/src/configure --enabled-shared\ncd ../static-libsass; ./libsass/src/configure --disabled-shared\nThis already works properly, but the versioning is missing. A build rule or changing the order of things happening would fix this though... This is the recommended way of working on implementation projects that want to maintain a pristine source. However, when you do either of these the sass_version.h file still gets modified in the source. It should instead modify the target location.\n. src refactor fixed this issue, It is now working. \nmkdir -p $(NEWDIR);\ncd $(LIBSASS_SRC); autoreconf -fvi\ncd $(NEWDIR); $(LIBSASS_SRC)/configure\nsass_version.h in NEWDIR has the correct version information.\n. Apparently not? I get errors without autoreconf\n```\ngit submodule update --init\ngenerate version header from configure script\ncd libsass-src; /Library/Developer/CommandLineTools/usr/bin/make clean\nrm -f lib/.a lib/.so lib/.dll lib/.la\nrm -f   src/cencode.o src/ast.o src/base64vlq.o src/bind.o src/color_maps.o src/constants.o src/context.o src/cssize.o src/emitter.o src/environment.o src/error_handling.o src/eval.o src/expand.o src/extend.o src/file.o src/functions.o src/inspect.o src/json.o src/lexer.o src/listize.o src/memory_manager.o src/node.o src/output.o src/parser.o src/plugins.o src/position.o src/prelexer.o src/remove_placeholders.o src/sass.o src/sass_util.o src/sass_values.o src/sass_context.o src/sass_functions.o src/sass_interface.o src/sass2scss.o src/source_map.o src/to_c.o src/to_string.o src/to_value.o src/units.o src/utf8_string.o src/values.o src/util.o\nmkdir -p libsass-tmp\nconfigure libsass\ncd libsass-tmp; ../libsass-src/configure --disable-shared \\\n            --prefix=/Users/drew/src/github.com/wellington/go-libsass --disable-silent-rules \\\n            --disable-dependency-tracking\n/bin/sh: ../libsass-src/configure: No such file or directory\nmake: *** [libsass-tmp] Error 127\n```\nI'm super happy to see a pristine libsass-src after this runs now though :dancers: :dancers: :dancer: \n. No problem I'm still not great with auto tools but I am reading through the\nbook on it! :)\nOn Tue, Jul 21, 2015 at 11:30 AM Marcin Cie\u015blak notifications@github.com\nwrote:\n\n\nApparently not? I get errors without autoreconf\ncd libsass-tmp; ../libsass-src/configure --disable-shared \\\n--prefix=/Users/drew/src/github.com/wellington/go-libsass\n--disable-silent-rules \\\n--disable-dependency-tracking\n/bin/sh: ../libsass-src/configure: No such file or directory\nmake: *** [libsass-tmp] Error 127\n\nI am sorry, I misunderstood the issue! Of course we don't ship ./configure\nscript in the git repository. What I meant is that ./configure should be\nenough\nto create the version information, but of course you need to have\nthat script first :)\nSorry for noise!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1223#issuecomment-123393690.\n. Oh nice, bookmarked\n\nOn Tue, Jul 21, 2015 at 1:18 PM Marcin Cie\u015blak notifications@github.com\nwrote:\n\n\nNo problem I'm still not great with auto tools but I am reading through\nthe\nbook on it! :)\n\nThis is highly recommended: http://www.dwheeler.com/autotools/\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1223#issuecomment-123423492.\n. works, awesome! :trophy: \n. I agree markdown files would be more useful. Thanks for the advice on this\nOn Wed, May 20, 2015 at 2:27 AM Michael Mifsud notifications@github.com\nwrote:\nwrappers and out of date wrappers? Should the non-functional ones just be\nremoved from this page entirely?\nI think it would make sense to visibly group wrappers by the Libsass API\nversion.\nMaybe there's an easy way to link last committed code on the wiki page?\nI would just opt for a link to the GitHub page. This works well enough for\nnpm.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1226#issuecomment-103792188.\n. Haha yeah I saw where this was going =). I'll use this issue to track\nprogress of this. Maybe take the wiki pages and link them to markdown files.\nOn Wed, May 20, 2015 at 8:33 AM Michael Mifsud notifications@github.com\nwrote:\nIf you want to take the initiative to start the migration you [image:\n:100:] [image: :+1:] from me [image: :wink:] [image: :wink:]\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1226#issuecomment-103890397.\n. yay! :fireworks: :fireworks: \n. Maybe detailing what use cases this solves would help illuminate why this is necessary. I'm a big believer in only exposing the amount of information needed to extensions to keep them sane. For instance, I do not need to keep track of where I am in the import stack and I don't see a reason custom functions would need that information. The best use case for that is throwing coherent errors. If a custom function returns an error SassValue, libsass locates the error and builds a stack trace for me. Not something I'd care to do myself.\n. Perhaps there's an alternative way of doing this. https://github.com/wellington/wellington#functions supports all the compass image operations. Just like Compass, file i/o calls like sprite-map('../') are based on global configuration, not the sass file in which the function is called. This makes Sass refactoring very simple, since the function calls are independent of the context in which they are called.\n\nIt's not entirely clear to me if this level of context information is available to custom functions in Ruby Sass http://sass-lang.com/documentation/Sass/Script/Functions/EvaluationContext.html. It looks like you may able to derive the current template from the http://sass-lang.com/documentation/Sass/Engine.html options passed via the Environment to a Ruby Custom Function.\nHowever, storing files relative to sass is not something I see often. Web projects, especially as they grow, organize similar resources into distinct directories ie. images/, fonts/, or node_modules/eye-glass-module/.\nThoughts?\n. I'm not too worried about where this sits in sorting order since we'll be\nlinking to it from the README and wiki rather than hunting for it in the\nsource tree.\nOn Tue, May 26, 2015 at 12:45 PM, Peter Jas notifications@github.com\nwrote:\n\nRenaming docs to Documentation will stick the directory always on top\n(unless, of course, you have some directory like BAM which doesn't happen\nvery often).\nReferences:\n- https://github.com/torvalds/linux\n- https://github.com/dotnet/coreclr\n- https://github.com/dotnet/corefx\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1234#issuecomment-105616107.\n. Linux uses text files, that's not something we should encourage to go viral\nOn Tue, May 26, 2015 at 2:31 PM Peter Jas notifications@github.com wrote:\nNevertheless I suggested in the spirit of \"better convention should go\nviral\": keeping docs on top, then goes the rest of the repository assets. [image:\n:crossed_flags:]\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1234#issuecomment-105642405.\n. brought this back to life. Added tasks to show progress. We are close to getting this done!\n. Okay, this should cover all the pages I have. @xzyfer we probably want to get this in before the docs change for 3.3 :)\n. squashed to single commit\n. Thanks for looking through these. I probably won't get to making these\nchanges for a while. You can send a PR to this branch and I'll merge it in\nwith this.\n\nOn Thu, Oct 8, 2015, 8:28 AM Una Kravets notifications@github.com wrote:\n\nThe docs look good to me, just did a few copy edits/notes to watch out for [image:\n:smile:] thanks for doing this!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1234#issuecomment-146545149.\n. Holy balls that's an amazing speed up! Great work!\nOn Fri, May 29, 2015 at 7:15 PM Marcel Greter notifications@github.com\nwrote:\nPushing my latest refactoring work to public since it is currently at a\nworking state that solves all open @at-root issues, plus a few other open\nissues. PR is still too dirty too actually commit the work to master\nbranch. It also introduced a minor whitespace (linefeed preserving)\nregressions (from issue 1208), since the fix we added for it doesn't seem\nto be 100% correct. I will try to tackle the linefeed preserving again at a\nlater stage (the logic for this seems to be clear so far).\nThe following issues should pass with this WIP branch:\n- Error with & selector interpolation in @at-root blocks (#1043\n  https://github.com/sass/libsass/issues/1043)\n- & + '' needs to be wrapped in parentheses (#1170\n  https://github.com/sass/libsass/issues/1170)\n- @at-root https://github.com/at-root and #{&} produces incorrect\n  output (#1210 https://github.com/sass/libsass/issues/1210)\n- Regression in parsing @at-rules (#1214\n  https://github.com/sass/libsass/issues/1214)\n- Dynamic division with interpolation not compatible with libsass (#948\n  https://github.com/sass/libsass/issues/948)\n- Two more tests for is_superselector functions (#963\n  https://github.com/sass/libsass/issues/963)\n- libsass-todo-test/38_expression_in_at_directive\nThis branch also includes quite a few performance optimizations.\nIt brought my sass-spec test suite runtime from 27s down to 7s!\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/sass/libsass/pull/1249\nCommit Summary\n- Refactor contextualize into eval [WIP]\n- Cleaning up [WIP]\n- Make more sense of functions and environments [WIP]\n- Clean up some constructor arguments [WIP]\n- Fix some MSVC warnings (and mute some others)\n- Remove eval snapshot feature [WIP]\n- More clean ups [WIP]\n- Add performance improvements [WIP]\n- Fix windows build (leaks memory) [WIP]\n- Test alternative memory managing model [WIP]\n- Refactor scss parser [WIP]\n- Pass 941 and 948 (regression on 1208) [WIP]\n- Refactor supports/feature query parsing [WIP]\nFile Changes\n- M Makefile https://github.com/sass/libsass/pull/1249/files#diff-0\n  (8)\n- M Makefile.am\n  https://github.com/sass/libsass/pull/1249/files#diff-1 (8)\n- M ast.cpp https://github.com/sass/libsass/pull/1249/files#diff-2\n  (85)\n- M ast.hpp https://github.com/sass/libsass/pull/1249/files#diff-3\n  (123)\n- M ast_def_macros.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-4 (24)\n- M ast_factory.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-5 (4)\n- M ast_fwd_decl.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-6 (9)\n- M bind.cpp https://github.com/sass/libsass/pull/1249/files#diff-7\n  (12)\n- M constants.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-8 (8)\n- M constants.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-9 (6)\n- M context.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-10 (221)\n- D contextualize.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-11 (148)\n- D contextualize.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-12 (46)\n- D contextualize_eval.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-13 (93)\n- D contextualize_eval.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-14 (44)\n- M cssize.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-15 (40)\n- M cssize.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-16 (7)\n- M debugger.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-17 (39)\n- M emitter.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-18 (2)\n- M environment.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-19 (39)\n- M eval.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-20 (441)\n- M eval.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-21 (56)\n- M expand.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-22 (319)\n- M expand.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-23 (34)\n- M extend.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-24 (17)\n- M extend.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-25 (2)\n- M functions.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-26 (29)\n- M inspect.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-27 (33)\n- M inspect.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-28 (7)\n- M json.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-29 (5)\n- M lexer.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-30 (61)\n- M listize.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-31 (5)\n- M listize.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-32 (2)\n- M node.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-33 (2)\n- M operation.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-34 (14)\n- M output.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-35 (10)\n- M output.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-36 (2)\n- M parser.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-37 (2204)\n- M parser.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-38 (65)\n- A parser_feature.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-39 (101)\n- A parser_functions.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-40 (322)\n- A parser_media.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-41 (95)\n- A parser_scss.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-42 (396)\n- A parser_selectors.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-43 (459)\n- A parser_values.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-44 (688)\n- M position.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-45 (6)\n- M position.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-46 (8)\n- M posix/getopt.c\n  https://github.com/sass/libsass/pull/1249/files#diff-47 (5)\n- M prelexer.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-48 (61)\n- M prelexer.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-49 (16)\n- M sass2scss.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-50 (5)\n- M sass_context.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-51 (26)\n- M sass_functions.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-52 (2)\n- M sass_interface.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-53 (4)\n- M test/test_node.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-54 (44)\n- M test/test_selector_difference.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-55 (2)\n- M test/test_specificity.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-56 (2)\n- M test/test_superselector.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-57 (4)\n- M test/test_unification.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-58 (2)\n- M to_string.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-59 (2)\n- M util.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-60 (46)\n- M util.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-61 (2)\n- M win/libsass.filters\n  https://github.com/sass/libsass/pull/1249/files#diff-62 (24)\n- M win/libsass.vcxproj\n  https://github.com/sass/libsass/pull/1249/files#diff-63 (10)\nPatch Links:\n- https://github.com/sass/libsass/pull/1249.patch\n- https://github.com/sass/libsass/pull/1249.diff\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1249.\n. Confirmed the import ordering is a problem (results below), but compilation is correct. Good catch @pkmiec !\n\nThe custom importer is being pinged for every import breadth first. It will require a more complex process where the parser sends every import encountered to the custom importer, waits for the response, then continues. Going on and on until it finds no more imports.\ngo run ../wt/main.go component.scss\nimporting button\nimporting color\nimporting color\nRebuilt: component.scss\n2015/06/11 13:44:31 main.go:95: Compilation took: 8.049ms\nThe latter example...\n```\nimporting _one.scss\nimporting _three.scss\nimporting _two.scss\n/ example.scss /\n/ line 1, /Users/drew/src/github.com/wellington/wellington/example/_two.scss /\n.one {\n  color: #200; }\n/ line 2, /Users/drew/src/github.com/wellington/wellington/example/_one.scss /\n.one {\n  color: #100; }\n/ line 1, /Users/drew/src/github.com/wellington/wellington/example/_three.scss /\n.one {\n  color: #300; }\nRebuilt: example.scss\n2015/06/11 13:53:24 main.go:95: Compilation took: 8.932ms\n```\n. @mgreter :100: to exposing operators, we could very much use that\n. :+1: This removes 100s of build warnings.\n. You're right, I'll keep beating on it then\n. Ahh, I see the problem. Each header needs a unique identifier. This shows the problem.\n```\ninclude \ninclude \ninclude \"sass_context.h\"\nSass_Import_List sass_importer(const char path, Sass_Importer_Entry cb, struct Sass_Compiler comp)\n{\n  // get the cookie from importer descriptor\n  void cookie = sass_importer_get_cookie(cb);\n  Sass_Import_List list = sass_make_import_list(2);\n  const char local = \"local { color: green; }\";\n  const char* remote = \"remote { color: red; }\";\nSass_Import_Entry imp;\n  imp = sass_make_import_entry(\"\", strdup(local), 0);\n  sass_import_set_list_entry(list, 0, imp);\n  imp = sass_make_import_entry(\"\", strdup(remote), 0);\n  sass_import_set_list_entry(list, 1, imp);\n  return list;\n}\nint main( int argc, const char* argv[] )\n{\n// get the input file from first argument or use default\n  const char* input = argc > 1 ? argv[1] : \"styles.scss\";\n// create the file context and get all related structs\n  struct Sass_File_Context file_ctx = sass_make_file_context(input);\n  struct Sass_Context ctx = sass_file_context_get_context(file_ctx);\n  struct Sass_Options* ctx_opt = sass_context_get_options(ctx);\n// allocate custom importer\n  Sass_Importer_Entry c_imp =\n    sass_make_importer(sass_importer, 0, 0);\n  // create list for all custom importers\n  Sass_Importer_List imp_list = sass_make_importer_list(1);\n  // put the only importer on to the list\n  sass_importer_set_list_entry(imp_list, 0, c_imp);\n  // register list on to the context options\n  sass_option_set_c_headers(ctx_opt, imp_list);\n  // context is set up, call the compile step now\n  int status = sass_compile_file_context(file_ctx);\n// print the result or the error to the stdout\n  if (status == 0) puts(sass_context_get_output_string(ctx));\n  else puts(sass_context_get_error_message(ctx));\n// release allocated memory\n  sass_delete_file_context(file_ctx);\n// exit status\n  return status;\n}\n```\nOutputs:\n```\nremote {\n  color: red; }\nremote {\n  color: red; }\nbody {\n  color: gold; }\n```\nIt doesn't totally make sense to me why headers need names, but I can generate random strings for now.\n. oh I see it is, that is a hard issue to parse.\n. This is awesome!\n. SourceForge probably down upgrading mingw32 zip files with new spyware :-1: \n. Is the memory leak mentioned here https://github.com/sass/libsass/pull/1335#issuecomment-120753718 supposed to be fixed by #1338?\nMemory usage is down from 16gb (all memory) to 3-4gb and a nice speed up Compilation took: 132234.797ms I think it took 2x as long before.\n. Fixed by one of the 3.3 fixes\n. :100: \nThe code won't help, but here's what I do in wellington. It reads the the input stream looking for non-sass tokens ; {, etc, then convert https://github.com/wellington/wellington/blob/master/import.go#L47-L81\nThe extension matcher wasn't sufficient to handle stdin or http streams.\n. This was happening a lot for me too. I made a mirror of the binary and shaved off a 7minute download from sourceforge :)\nhttps://github.com/wellington/wellington/commit/5bb710ada\nHopefully, somebody can convince appveyor that mingw64 is better than 32bit... http://help.appveyor.com/discussions/questions/372-build-setup-for-a-c-program#comment_34629599\n. Apparently, SourceForge has had lots of issues with serving content. msys's package manager has detailed tests to make sure SourceForge is serving up packages.\nerror: failed retrieving file 'mingw32.db' from downloads.sourceforge.net : Connection timed out after 10873 milliseconds \nerror: failed to update mingw32 (download library error)\nerror: failed retrieving file 'mingw64.db' from downloads.sourceforge.net : Operation too slow. Less than 1 bytes/sec transferred the last 10 seconds\n. make works locally on darwin for me. I can give the brew path a run with brew install --HEAD test after this is in master.\nFortunately, if any of these static flags bled into darwin, it would just :hankey: the bed. So finding problems should be easy :+1: \n. Love seeing packaged built versions of libsass. Hope we start seeing this\nfor more platforms :)\nOn Tue, Jul 14, 2015 at 7:16 PM Marcel Greter notifications@github.com\nwrote:\n\nSo the surprise is that I created a project to create an MSI installer for\nlibsass. Pretty much a rip-off from one of my other projects, so it was not\nreally too difficult to make this happen :)\n[image: :package:] http://webmerge.ocbnet.ch/libsass/installer/\n[image: :slot_machine:] https://github.com/mgreter/libsass-msi-installer\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1344#issuecomment-121433521.\n. This is going to cause a lot of problems for me. Is there a specific entrypoint to include c/h files? Writing a cpp file like\n\nmega.cpp\nimport ast.cpp\n...\nimport sass_value.cpp\nJust creates a broken compile time situation. Can as part of this some sort of import source/header that includes all files in the correct order?\n. I build libsass from source since it makes the Go binary more portable.\ngo get github.com/wellington/wellington/wt compiles libsass C/C++, links\nC-API to Go, then builds the final Go binary. I've tried amalgamating\nlibsass, but it ends up with namespace conflicts.\nOn Thu, Jul 16, 2015 at 1:20 PM Marcel Greter notifications@github.com\nwrote:\n\nThe only headers you should include are the ones that will be in include\nsubfolder (only C-API headers). I really hope you don't import any of the\nhpp headers, since they are not meant for consumers to be included. Also\ndon't see how this could cause much problems, since you just need to pass\nthe new include path to the compiler (mostly -I include).\nI guess it will take me 5 minutes to update perl-libsass to use the new\nfile structure!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1352#issuecomment-122040227.\n. I'll check out your perl-sass setup and see if it helps. Thanks!\n. Point 3 sounds related to https://github.com/sass/libsass/issues/1223. It would be nice if this was generated by the build rather than modifying it and creating git submodules changes. Or if there was a standalone make rule to update it without performing a build.\n. It's also an order of operation problem. Sass version is modified in the\nsource directory not the build directory as the issue above mentions. So\nversion doesn't work when targeting a new build directory.\nOn Sun, Jul 19, 2015 at 6:40 PM Marcin Cie\u015blak notifications@github.com\nwrote:\n1358 https://github.com/sass/libsass/pull/1358 moves Makefile.am to\nGNUmakefile.am (plus fixes some issues with .gitignore)\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1352#issuecomment-122718074.\n. Building Go from source required a VERSION file whenever git was\nunavailable. Looks like a decent approach.\n\ngo tool dist: FAILED: not a Git repo; must put a VERSION file in $GOROOT\n. Sounds good, I fear leaving around outdated headers for libsass all the\ntime. Would be nice to have them all in one place\nOn Mon, Jul 20, 2015 at 2:18 PM Marcel Greter notifications@github.com\nwrote:\n\nPretty much all libraries install their headers in a subdirectory. We\ncurrently just drop multiple headers into the include folder directly (\n/usr/include on most systems). IMO we should change this and put all of\nour C-API headers in a libsass sub-folder (/usr/include/libsass).\nSince this is actually a breaking change for implementors, I wanted to\ndiscuss this here. The update is very simple, since you really only need to\nchange all include from #include \"sass.h\" to #include \"libsass/sass.h\"\n(and for all other C API headers).\nI would really like to ship this change also with 3.3, since implementors\nalready have to adjust their builds, so both needed changes could be done\nin one go!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1360.\n. :+1: \n. I'm a little confused. How is this different than custom importers?\n\nThe biggest performance bottleneck I have experienced is having libsass do file I/O. I had started by reading the Sass files in the implementation, tokenizing/parsing the Sass for imports then sending the concatenated Sass to the data compiler. Switching to the file compiler increased compile time by nearly 50%. It would be nice to have some APIs that made doing file I/O in the implementation easier. I'm not sure how this adds benefits over what the custom importer already makes available though.\n. I'm not quite sure I see the benefit of this push method. Like @mgreter said, it's difficult to know which files will be necessary. However, what caching mechanism are you referring to? Is this referring to a custom importer that matches all strings?\nFor instance, \nA.scss --depends on--> a.scss\nB.scss --depends on--> a.scss\nlibSass is called twice here, so it opens a.scss twice rather than using a caching mechanism. I used to parse @import, resolve imports (cache them), then send the final strings along to libSass. When switching to libSass's file compiler, compile times increased by 33%. It would be a significant upgrade to compile times if there was a way to handle file access for libSass to support just such a caching method. \n. Well that does sound far off, since variables could be different depending on what global variables a file needs. Unless those are resolved after AST tree is parsed.\nFor my use case, it would have been sufficient to allow source notations to control which file/line number is resolved by libSass. The same thing that Chrome does with CSS/JS source which sounds less complex than reusing AST tree between compiles.\nie.\n// A.scss\ndiv { p { color: red } }\n// a.scss\np { color: black }\nOutput\n// output.css\n/* A.scss:line 1 */\ndiv p {\n  color: red; }\n/* a.scss:line 1 */\np { \n  color: black; }\nThen source could be added however you want while preserving sourcemaps and error file/line numbers.\n. sourceforge!\n. :+1: Odd that I was getting some build failures with static bool on some OSes. I guess the changes to how the arguments are dereferenced fixed that.\nI wasn't sure how much we wanted to change this, but makes sense to own this as it is. Unless we want to locate a different json lib for this tiny portion of the API it is involved in :)\n. I got the same error with Sass::IN. I'm only seeing these on Windows so my ability to debug this is really slow (appveyor).\nIn function 'Sass::SassUnit Sass::string_to_unit(const string&)':\nunits.cpp:72:40: error: expected unqualified-id before ';' token\n     else if (s == \"in\") return Sass::IN;\n                                        ^\nunits.cpp: In function 'const char* Sass::unit_to_string(Sass::SassUnit)':\nunits.cpp:101:20: error: expected unqualified-id before ':' token\n       case Sass::IN: return \"in\"; break;\n                    ^\n. Nope, still seeing the same error\nunits.cpp: In function 'Sass::SassUnit Sass::string_to_unit(const string&)':\nunits.cpp:72:46: error: expected unqualified-id before ';' token\n     else if (s == \"in\")   return SassUnit::IN;\n                                              ^\nunits.cpp: In function 'const char* Sass::unit_to_string(Sass::SassUnit)':\nunits.cpp:101:24: error: expected unqualified-id before ':' token\n       case SassUnit::IN:      return \"in\"; break;\n                        ^\n. It appears a windows header includes this (I guess that's obvious). Not sure of a better way to get around this though :\\\n. Ahh, here's the culprit: http://sourceforge.net/p/mingw-w64/code/HEAD/tree/stable/v3.x/mingw-w64-headers/include/minwindef.h#l57\n. Might have found a better way to handle this, trying it out locally first.\n. This worked for me! Sort of the same thing, but removes all fake modifiers mingw32 creates.\nSide not, very little on the internet about the purpose of these: http://lmgtfy.com/?q=W32_PSEUDO_MODIFIERS\n. It only needs the define.\nI wanted to get your thoughts on that before I rebased the other out. The downside here is that this may be a race condition. _NO_W32_PSEUDO_MODIFIERS would need to be defined before windows headers are loaded. The first commit will just work no matter the order.\n. Because windef isn't included units.cpp. This error will pop up if units.cpp is included with anything that includes windows headers ie. file.cpp, functions.cpp or plugins.cpp.\nGoing to clean up the branch and describe the problem better in the commit, then should be ready!\n. No, IN has to be #undef or not #define in the first place. #undef is a cleaner approach though: https://github.com/sass/libsass/pull/1410#issuecomment-125458730\n. #1310 doesn't address the use of IN and #include  doesn't define IN.\nundef approach is used because #define _NO_WIN32_PSEUDO_MODIFIERS would have to be added in many places and their define serves no purpose for libsass. https://github.com/sass/libsass/pull/1410#issuecomment-125453374\n. If namespacing was an issue, https://github.com/sass/libsass/pull/1411 would have fixed it (but doesn't). \n. Are you experiencing build errors as a result of these changes? If so,\ncould you reproduce it on the appveyor test suite because all builds are\npassing.\nOn Tue, Jul 28, 2015 at 2:59 PM Marcin Cie\u015blak notifications@github.com\nwrote:\n\nWell, there is no build error on our code as-is (just checked with\nVS2013). This is a consequence of combining all our files into one, which\nis not a supported build configuration. Unfortunately, Win32 API is full of\nfunny symbols and one of the reasons to split files is to isolate affected\nfiles.\nI'd recommend adding an additional file with a workaround code in the\nadditional header file included as the first one, prior to merging the\nfiles. Or somewhere in between.\ndefine _NOWIN32_PSEUDO_MODIFIERS does not work Visual Studio,\nunfortunately #define IN is embedded in many core headers and it is\nimpossible to somehow #define it out\nHaving said that, I'm happy to work on streamlining our header files to\nmake compilation process faster, but I don't think we should support that\nmode of compilation.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1410#issuecomment-125736346.\n. Personally, I think we should not use IN, OUT, OPTIONAL because those have special meaning in windows. I initially fixed this by renaming IN to INCH, but if you give windows an inch it'll take a mile :)\n. Something is very appealing about this PR...!\n. Sassmeister link: http://sassmeister.com/gist/560bc02d4a53355640fc\n\nLooks to be reproducing on master as well.\n. Appveyor sure is paying a lot to download mingw32 over and over. It's about time they started including 64bit version.\n. I'm joining the cpp files, so I'm finding conflicts in files that don't explicitly include headers. units.cpp is using SIZE which is already used by windows. If units needed to include the windows headers, it would get an ambiguous definition error.\n. :beers: :beers: \n. This is okay for now.\nOn Thu, Aug 20, 2015 at 5:10 AM Marcin Cie\u015blak notifications@github.com\nwrote:\n\nI just came to conclusion we should rename all constants and enums either\na prefix...\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1458#issuecomment-132964479.\n. Are you seeing crashes for errors too? Invalid input ie div { is throwing errors for me\n. Figured I'd put my code where my mouth was :)\n. Also added the 4.9.2 mingw to bintray. The versioning of bintray is confusing, I'll add proper versioning to the 5.1.0 on there if we want to upgrade at some point.\n. Works for me, I believe it's unlimited for open source software.\n. Confirmed it is, reverting https://github.com/mgreter/libsass/commit/139ca8d3ab3a763d905f582916445b1a34dbe91e fixes this issue\n. Does this break any existing functions or have just these two functions\nmoved to new names?\nOn Mon, Aug 31, 2015 at 6:11 PM Marcel Greter notifications@github.com\nwrote:\nThis is a breaking C-API change, altough only minor and in an experimental\nfeature!\nRenamed two API functions to be more close to their actual use:\nsass_import_get_path -> sass_import_get_imp_path\nsass_import_get_base -> sass_import_get_abs_path\nThis PR also reworks and should make path handling better understandable.\nStill far from perfect under the hood, the IMO the API is slowly getting\nthere. It should now support urls correctly.\nThis also fixes another bug introduces by a fix commited a few days ago.\nHeaders were all stored under the same virtual file-name. Therefore the\n\"cache\" always returned the same header. We now add an index to the virtual\nfile-name if multiple headers are included in the same file.\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/sass/libsass/pull/1509\nCommit Summary\n- Improve importer C-API and path handling\nFile Changes\n- M include/sass_functions.h\n  https://github.com/sass/libsass/pull/1509/files#diff-0 (6)\n- M src/context.hpp\n  https://github.com/sass/libsass/pull/1509/files#diff-1 (4)\n- M src/parser.cpp\n  https://github.com/sass/libsass/pull/1509/files#diff-2 (28)\n- M src/sass_functions.cpp\n  https://github.com/sass/libsass/pull/1509/files#diff-3 (18)\nPatch Links:\n- https://github.com/sass/libsass/pull/1509.patch\n- https://github.com/sass/libsass/pull/1509.diff\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1509.\n. @mgreter most of my header tests are passing now.\n\nI found one last oddity. If you include a header then do a file compile, the only file that shows up in resolved imports is the header not the file being compiled. Previously, the resolved imports included only the file being compiled and not the header. If I remove the header and do a file compile, the resolved imports includes an absolute path to the file being compiled.\nInput\nimport_entry_....(\"/path/to/header\");\nsass_make_file_context(\"/path/to\");\nPrevious:\nresolved_imports -> \"/path/to\";\nNow:\nresolved_imports -> \"header\"\nImo, correct:\nresolved_imports -> [\"/abs/path/to/header\", \"/abs/path/to/file\"]\n. sass_context_get_included_files. Yeah I switched to abs_path/imp_path, it\ndidn't compile until I did that :).\nOn Tue, Sep 1, 2015 at 2:50 AM Marcel Greter notifications@github.com\nwrote:\n\nWhat is resolved_imports? That's not from libsass directly!? Are you sure\nyou use abs_path and not imp_path? Can you reproduce with a plain C\nsample!?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1509#issuecomment-136618726.\n. This shows what I'm talking about\n\n```\ninclude \ninclude \ninclude \"sass_context.h\"\nSass_Import_List sass_importer(const char path, Sass_Importer_Entry cb, struct Sass_Compiler comp)\n{\n  // get the cookie from importer descriptor\n  void cookie = sass_importer_get_cookie(cb);\n  Sass_Import_List list = sass_make_import_list(2);\n  const char local = \"local { color: green; }\";\n  const char* remote = \"remote { color: red; }\";\n  list[0] = sass_make_import_entry(\"/tmp/styles.scss\", strdup(local), 0);\n  list[1] = sass_make_import_entry(\"http://www.example.com\", strdup(remote), 0);\n  return list;\n}\nint main( int argc, const char* argv[] )\n{\n// get the input file from first argument or use default\n  const char* input = argc > 1 ? argv[1] : \"../test/scss/main.scss\";\n// create the file context and get all related structs\n  struct Sass_File_Context file_ctx = sass_make_file_context(input);\n  struct Sass_Context ctx = sass_file_context_get_context(file_ctx);\n  struct Sass_Options* ctx_opt = sass_context_get_options(ctx);\n// allocate custom importer\n  Sass_Importer_Entry c_imp =\n    sass_make_importer(sass_importer, 0, 0);\n  // create list for all custom importers\n  Sass_Importer_List imp_list = sass_make_importer_list(1);\n  // put the only importer on to the list\n  sass_importer_set_list_entry(imp_list, 0, c_imp);\n  // register list on to the context options\n  sass_option_set_c_headers(ctx_opt, imp_list);\n  // context is set up, call the compile step now\n  int status = sass_compile_file_context(file_ctx);\n// print the result or the error to the stdout\n  if (status == 0) puts(sass_context_get_output_string(ctx));\n  else puts(sass_context_get_error_message(ctx));\nchar** imps = sass_context_get_included_files(ctx);\n  size_t size = sass_context_get_included_files_size(ctx);\n  for (int i=0; i<size; i++) {\n    printf(\"%s\\n\", imps[i]);\n  }\n// release allocated memory\n  sass_delete_file_context(file_ctx);\n// exit status\n  return status;\n}\n```\nOutput:\n//www.example.com\nShould be:\n//www.example.com\n/abs/test/scss/main.scss\n. So is it considered a bug that the headers are still left out of imports on the file compiler?\n. That is fine, I don't have a use case for watching headers just noticed that the unit tests are failing. It might be worth documenting somewhere that headers are not included in the resolved imports list. I did notice these before so that it would be a breaking change from 3.2.5 behavior.\n. I've been thinking the same. It must be very hard to develop on the API\nwithout any unit tests.\nOn Wed, Sep 2, 2015 at 5:43 AM Adeel Mujahid notifications@github.com\nwrote:\n\nThanks! This seems to be fixed with 8861bc1\nhttps://github.com/sass/libsass/commit/8861bc1e9b41db60c94788143895a7d2cb7523ab\n.\nOn a slightly related note, with ruby-sass the exception message reads as\nfollow:\nvagrant@trusty64:~$ ruby -v\nruby 2.2.3p173 (2015-08-18 revision 51636) [x86_64-linux-gnu]\nvagrant@trusty64:~$ sass -v\nSass 3.4.18 (Selective Steve)\nvagrant@trusty64:~$ cat blah.scss\ndiv {\n  height: 10px;\nvagrant@trusty64:~$ sass blah.scss\nError: Invalid CSS after \"  height: 10px;\": expected \"}\", was \"\"\n        on line 3 of blah.scss\n  Use --trace for backtrace.\nwithout ... part. Is it something which will be changed in libsass at\nsome point?\nRegarding testing errors and other special / internal feature of libsass,\nas per sass/sassc#90 https://github.com/sass/sassc/issues/90, in my\nhumble opinion, we should invest effort only once and get rid of the Ruby\ndependency in favour of C++ testing framework. I will try to prototype\nsalient aspects of testing in C++ using some slim framework (whichever is\ntrending in other repos on GitHub) pretty image: :soon:, in effort to make it a drop-in replacement\nfor ruby test runner for sass-spec (like we have in node-sass). IMO, first\nthree points focus on would be:\n- Running spec tests (keeping it TODOs and non-TODOs aware).\n- Generating lcov compatible report for coverage.\n- Using proper exception detection semantics, to test the error\n  messages against the hardcoded ones.\nOn top of that, we can build infrastructure for source-map, memory\nmanagement and performance tests etc. in a long run. :)\nI realize that this is a lot of work and there is risk of things getting\nmore delayed to develop the robust replacement, but IMVHO, there will be\neven more tech debt we would have do pay otherwise.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1512#issuecomment-137024555.\n. It only affects the file compiler \n. This is definitely a blocker for me as it makes impossible to handle virtual imports that don't point to real files. It also worked just fine before this refactor.\n\nIs there an example of using a custom importer. It would take me a long time to rewrite this behavior in c.\n. Possibly related, using the following as styles.scss in that example:\n@import \"/tmp/styles.scss\";\nResults in\n```\nremote {\n  color: red; }\nremote {\n  color: red; }\n```\n. Running this example, you can see the custom importer is never executed. It will work if you switch to data compiler (untested in C).\nstyles.scss\n@import \"nope\";\nfile.c\n```\ninclude \ninclude \ninclude \"sass_context.h\"\nSass_Import_List sass_importer(const char path, Sass_Importer_Entry cb, struct Sass_Compiler comp)\n{\n  // get the cookie from importer descriptor\n  void cookie = sass_importer_get_cookie(cb);\n  Sass_Import_List list = sass_make_import_list(1);\n  printf(\"loooking up %s\\n\", path);\n  char nope = \"nope{ color: blue; }\";\n  if (strcmp(path,\"noop\")!=0) {\n    list[0] = sass_make_import_entry(\"nope.scss\", strdup(nope), 0);\n  } else {\n    printf(\"no match\\n\");\n    list[0] = sass_make_import_entry(\"\", strdup(\"\"), 0);\n  }\n  printf(\"exit\\n\");\n  return list;\n}\nint main( int argc, const char* argv[] )\n{\n// get the input file from first argument or use default\n  const char* input = argc > 1 ? argv[1] : \"styles.scss\";\n// create the file context and get all related structs\n  struct Sass_File_Context file_ctx = sass_make_file_context(input);\n  struct Sass_Context ctx = sass_file_context_get_context(file_ctx);\n  struct Sass_Options* ctx_opt = sass_context_get_options(ctx);\n// allocate custom importer\n  Sass_Importer_Entry c_imp =\n    sass_make_importer(sass_importer, 0, 0);\n  // create list for all custom importers\n  Sass_Importer_List imp_list = sass_make_importer_list(1);\n  // put the only importer on to the list\n  sass_importer_set_list_entry(imp_list, 0, c_imp);\n  // register list on to the context options\n  sass_option_set_c_importers(ctx_opt, imp_list);\n  // context is set up, call the compile step now\n  int status = sass_compile_file_context(file_ctx);\n// print the result or the error to the stdout\n  if (status == 0) puts(sass_context_get_output_string(ctx));\n  else puts(sass_context_get_error_message(ctx));\n// release allocated memory\n  sass_delete_file_context(file_ctx);\n// exit status\n  return status;\n}\n```\n. I thought I saw something recently related to this, you're right it's working on master.\n. :+1: fixed my regressions\n. Data compiler looks good, Current dir messages are gone\nBefore\nError > stdin:1\n        file to import not found or unreadable: branch\n        Current dir:\n        @import \"branch\";\n        div.branch {\n          @extend %branch;\n          div.leaf {\n            @extend %leaf;\n          }\n        }\nAfter\n```\nError > stdin:1\n        File to import not found or unreadable: branch\n        Parent style sheet: stdin\n        @import \"branch\";\n        div.branch {\n          @extend %branch;\n          div.leaf {\n            @extend %leaf;\n          }\n        }\n```\n. File compiler looks good too.\n. I like the part about all memory is kept until sass_delete_context. Does it\nnot work that way currently?\nOn Fri, Jan 22, 2016 at 12:23 PM Adeel Mujahid notifications@github.com\nwrote:\n\n@mgreter https://github.com/mgreter, sure, alright. I will figure out\nsome other way to handle my use case.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1821#issuecomment-173999678.\n. Thanks for the help @mgreter ! :trophy: \n. \ud83d\udc4d \n. great work @mgreter this looks awesome!. I believe you can put this in CPPFLAGS and it covers CFLAGS and CXXFLAGS. Ref: https://en.wikipedia.org/wiki/CFLAGS\n. Yeah it sends to whatever compiler is being used. So no matter the language, the same params are sent. SO: http://stackoverflow.com/a/495646/217965 \n\nThe language in the wikipedia page is super confusing. The CGO docs are way more clear (handles C/C++ compiling/linking for Go)\n\nAll the cgo CPPFLAGS and CFLAGS directives in a package are concatenated and used to compile C files in that package. All the CPPFLAGS and CXXFLAGS directives in a package are concatenated and used to compile C++ files in that package.\n. True, these are just make variables. It is a nice way of keeping the Makefile dry for duplicated flags like these.\n\nIt would require changing the object rules to this:\n```\n%.o: %.c\n    $(CC) $(CPPFLAGS) $(CFLAGS) -c -o $@ $<\n%.o: %.cpp\n    $(CXX) $(CPPFLAGS) $(CXXFLAGS) -c -o $@ $<\n```\n. In what way? I declared it as static bool and some of the windows and os x\nbuilds failed. This declaration passed all builds though.\nOn Sun, Jul 26, 2015 at 10:16 PM Marcel Greter notifications@github.com\nwrote:\n\nIn src/json.cpp\nhttps://github.com/sass/libsass/pull/1373#discussion_r35503582:\n\n@@ -357,9 +357,8 @@ static void to_surrogate_pair(uint32_t unicode, uint16_t uc, uint16_t lc)\n   *lc = (n & 0x3FF) | 0xDC00;\n }\n-#define is_space(c) ((c) == '\\t' || (c) == '\\n' || (c) == '\\r' || (c) == ' ')\n-#define is_digit(c) ((c) >= '0' && (c) <= '9')\n+bool is_space        (const char c);\n+bool is_digit        (const char c);\n\nThis declaration doesn't seem to match the implementation?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1373/files#r35503582.\n. Ahh good catch, I'll PR a fix.\n. You're almost there please submit PR this branch to fix these.\n\nOn Thu, Oct 8, 2015, 9:21 AM Charlie Park notifications@github.com wrote:\n\nIn docs/setup-environment.md\nhttps://github.com/sass/libsass/pull/1234#discussion_r41518814:\n\n++export SASS_LIBSASS_PATH=/Users/you/path/libsass\n+\n+\n+...where the latter part is to the libsass directory you've cloned. You can get this path by typing pwd in the Terminal\n+\n+## Running the Spec Against Ruby Sass\n+\n+Go into the sass-spec folder that should have been cloned earlier with the \"bootstrap\" command. Run the following.\n+\n++bundle install\n+./sass-spec.rb\n+\n+\n+Viola! Now you are testing against Sass too!\n\nViola => Voila\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1234/files#r41518814.\n. :+1: \n. \n",
    "eevee": "I figured it must or someone would've noticed by now.  :)  I'm on Arch using g++ 4.7, if you're interested.\n. ",
    "Igorbek": "I also agree with the issue. It would be great to have some interface that implement custom importers.\n. I have implemented this functionality in my fork: https://github.com/Igorbek/libsass/tree/SourceProvider\n. @pistolero http://habrahabr.ru/post/147567/ =)\n. @pistolero yep, I'll do it today after take some code cleaning.\n. Sure!\n...ah. How to attach a file here? Can't find ((\n. I've sent it via email.\nI writing the .Net wrapper for libsass, so I compiled the sources with MS C++ compiler in CLR mode.\nThe error occured when source file specified by filename (in sass_compile_file), or if it specified by @import directive.\n. Updated.\n. Thanks a lot!\n. It is not require any 3rd party libraries to manipulate wchar_t. It is simple as using char. All functions for char is also available for wchar_t.\n. Thanks, @QuLogic, I would agree with you.\nBut the library incorrect loads (only ANSII and UTF-8 without BOM encodings) and saves with encoding.\nIt is still the problem.\n. I think the problem is not just in encoding. If library interface takes a UTF-8 encoded char*, I'll convert to it from any encoding.\nBut, if my code imports some file (via @import derective), I can't specify the encoding of that file, and the libsass always interpretate it as UTF-8 without BOM.\nIn some cases, I can't control of the encoding of the files. But I can know what encoding is in every file (by detection algorithms, user settings or transport-specifiec information, in by ex. HTTP Content-Type).\nI think the best solution for this is introduce ability to provide some interface, that would be able to resolve file paths and file contents.\nSomething like this:\nclass SourceContext\n{\npublic:\n    virtual std::string get_content() = 0;\n    virtual std::shared_ptr<SourceContext> resolve_path(std::string path) = 0;\n};\n. Same issue in other cases: \"quoted\" + unquoted = \"quoted\"unquoted instead of \"quotedunquoted\"\n. Thank you, I'll update my tool.\n. I found in parser, that is interpolation in uri was not made.\nThere's a commented line of string constant parsing:\nc++\nif (lex< uri_prefix >())\n{\n  const char* value = position;\n  const char* rparen = find_first< exactly<')'> >(position);\n  if (!rparen) throw_syntax_error(\"URI is missing ')'\");\n  Token contents(Token::make(value, rparen));\n  // lex< string_constant >();\n  Node result(context.new_Node(Node::uri, path, line, contents));\n  position = rparen;\n  lex< exactly<')'> >();\n  return result;\n}\n. Thank you, I'll update my tool.\n. ",
    "pistolero": "Wow, that is fantastic\n. @Igorbek nice. Do you plan to send pull request with your changes to @hcatlin for review?\n. ",
    "jhnns": "Is this feature still planned? I could need it too :smile: \n. @BPScott that's exactly the use-case :+1: \n. @hcatlin I'd assume that the callback provides the rewritten path. Basically I want to configure somewhere (e.g. using node-sass):\njavascript\n    ...\n    resolveImport: function (path) {\n         // do some magic rewrite or throw an error if the path is illegal\n         return path;\n    }\n    ...\n. Agreed :+1: \n. Awesome! I'm glad to see progress on this issue. :+1: \n. I'm just wondering how node.js would be able to load the file asynchronously in the custom importer...\nI'm not a c-programmer and don't know much about libuv. Any suggestions?\n. Awesome, thx! :+1: \n. > Should this conversation be moved upstream to sass/sass?\nYes :+1:, but the last time they were not happy about it...\nImho this feature is absolutely necessary to publish components that don't assume anything about the project structure.\n. If I wanted to publish a css library and reference assets (like bootstrap does), this can't be solved solely with post-processors imho.\n. :+1: \n. Nice :+1: \n. Ok thank you. So, this behavior is not actually intended...\n. @xzyfer Do you know why :global is not valid Sass? It's a valid CSS selector and will probably become more common in the future as soon as more people are using the :host selector when writing web components.. ",
    "BPScott": "Hi @hcatlin, I've had a look through the source code and while I've found code to allow adding a vector of custom include paths, I haven't spotted the ability for tools that bind to libsass (e.g. node-sass) to provide a custom @import resolver. Could you point me to where I could find that?\nThe use-case I'm thinking of is that binding libraries could provide hooks into that ecosystem's package manager. For instance node-sass could provide an @import resolver that transverses npm's node_modules folder. This is would be similar to Rework providing an npm loader. In the same vein, the ruby bindings could provide a resolver to transverse the rubygems folder structure.\nThanks.\n. I think it would need to be the first thing to try. This functionality feels like an override rather than a fallback coping mechanism.\nI believe @import 'foo/bar; would need to look within the foo package first, then if that fails it should use the default resolver to try the relative file path ./foo/bar.scss (though it could be up to the binding library to skip trying the default resolver). Otherwise you could end up with oddness where files relative to the current file take precedence over the files from the package manager which would be undesirable.\n. A quick nose around the rework importer and the npm docs suggests that npm dodges this problem by saying that imports are only considered to be relative if they start with /, ../ or ./.\nSo with npm-style importing rules @import 'foo/bar'; would be considered invalid even if the relative file ./foo/bar.scss exists. So if node-sass wanted to allow npm-style importing then it would have to kick in before (and disable) the default resolver.\nOther package managers may treat these paths differently so I think this needs to solved by each binding library depending on their platform's package manager.\n. @mgreter: that is fantastic. Thank you for your work and the time you put into this <3\n. ",
    "oncletom": "Following the Node module resolver heuristic, @import 'foo/bar'; would mean import the file bar.scss from module foo. Which means @import './node_modules/foo/bar.scss';.\nIn other terms Sass modules could be shipped and consumed as npm dependencies; thus making a very explicit graph of relationships between BEM blocks (for example).\n. \\o/\n. ",
    "callumlocke": "@hcatlin, @jhnns \u2013 I want to be able to provide a callback to actually returns the SCSS code to be imported, not just to return a resolved path. So by providing this callback, I could ensure Sass never touches the disk at all.\njs\n  ...\n  importer: function (name, cb) {\n    // look up `name`, load it, and maybe do some custom preprocessing...\n    // then call back with the SCSS\n    cb(null, scssString);\n  }\nThis would allow me to properly use libsass in a transform pipeline. Current applications of this are hacky and limited, due to the fact that libsass wants to access the disk directly when it needs to import something.\nImagine I want an extra preprocessing step before rendering my SCSS. I can have main.scss.foo, and I can set up a pipeline that does my 'foo' rendering (maybe injecting some config from environment variables) and then the resulting SCSS code is fed into node-sass. This is already possible because libsass lets me feed in the SCSS code at the start. libsass doesn't need to know that main.scss doesn't actually exist on disk. This is good.\nBut what if my SCSS contains @import 'partial';? Suddenly libsass wants to access the disk directly. Maybe there is no file called _partial.scss, but instead I've got _partial.scss.foo, and I want to put it through the same pipeline. There is currently no way to do this.\nThis is why I want to be able to provide a callback that takes care of all file reading. Because it's not just about controlling disk access or resolving paths, but also about importing from a non-disk source, such as an in-memory pipeline.\n. Good point, I didn't think of sourcemaps.\nBut I don't get why an importer would want to add multiple files from one import?\n. Same here. I'd like to help test, but I don't know C. @mgreter can you explain how I would test your branch? Presumably I would make a custom sassc build using your libsass branch, but then I don't know how I would run that executable in such a way that I can respond to its requests to load imports... or even if that makes any sense\n. Thank you! :+1:\n. Note: I only use node-sass and don't know anything about how it talks to libsass, so I don't know if this feature would have a significant overhead (calling a custom callback multiple times per import)... if it's not feasible perf-wise then close this :)\n. The purpose is for preprocessing, or just for performance (reading files from your own in-memory cache). Either way, it's just a way to prevent Sass accessing the disk directly.\nThis is already (mostly) possible with custom importers, but those aren't great if you just want to use libsass's default logic for resolving an @import statement to a list of potential file paths (i.e. relative to all the configured load paths, and including different variants like _-prefixing and different extensions etc, in a particular order of precedence...)  \u2013 you have to replicate all this logic yourself.\n. ",
    "emagnier": "I'm using Sassc on Windows, and with many files created by Visual Studio I get the same error: \"invalid top-level expression\".\nI made the test with the latest versions of libsass and sassc.\nHere is an example of a file that does not compile:\nhttp://files.etiennemagnier.com/public/test-encoding.zip\nThanks,\nEtienne.\n. Thanks Craigbarnes for your comment!\nThis problem prevents me from using Sassc on several of my projects, and unfortunately I don't have an enough good level in C++ to provide a fix.\nI keep my fingers crossed hoping this issue will be solved soon ;-)\n. Yes, but as the default files created by Visual Studio are with BOM, it will be dificult to ask all my team members to manually change the encoding each time they create a new scss file.\nAnd if I change the encoding of the existing scss files, I will break the \"compare\" and \"merge\" features of our source control (TFS) with the previous versions & branches.\n. Hi Aaron,\nI know you are very busy, but are you going to have time to fix this one?\nBecause of this bug I still can't consider using LibSass on our projects on Windows.\nThanks.\n. I did a test with your latest commit, and all the encoding errors have disappeared.\nA great thanks for your work, it's really appreciated! :+1: \n. Recently with the addition of the @extend and Sourcemap features, I have the feeling that Libsass is becoming increasingly popular (there is also a nice community around node-sass, and it also start to be integrated in some IDEs!). Therefore a Compass port will be also more and more requested (notice the Bounty on this thread) :+1: \n@hcatlin, @akhleung and/or @chriseppstein, do you have any plan for the coming \"LibCompass\"? Is the Compass port should be prioritized/separated by modules? For example, I personnaly use a lot Sprites, Image Dimensions and Inline Data modules (almost never the others). \nPerhaps by creating an official repo with some basis code, the community could then help.\nI don't know C/C++ well enough, but where I can I would love to contribute!\n. Great, thanks!\n. I'm using inuit.css (a great OOCSS framework) on my latest projects, but because there are Placeholder Selectors inside the library, it doesn't compile with Libsass.\nThe placeholder selectors are more and more used on the latest CSS libraries & frameworks, and are a great way to write reusable and scalable code as well as CSS patterns.\n. Since the placeholder selectors feature is now implemented, I will close this issue.\nA great thanks @akhleung!\n. You are right, the bug you mention is a bit blocking, so the placeholder is not totaly implemented.\nBut should I keep this issue open if we have another one specificaly for this bug?\n. +1 for this one, can't Compile Bourbon because of that.\n. There is already an opened issue and a workaround for this one: https://github.com/hcatlin/libsass/issues/72\n. This is a workaround but it will work:\nbackground-color: darken($endColor, 10%) unquote(\"\\\\9\");\n. Already opened here https://github.com/hcatlin/libsass/issues/85\nFor me too this feature I really miss it in Libsass.\n. I'm trying to compile inuit.css (a great OOCSS framework) with Libsass, but it also block on this kind of code:\ncss\n$open-quote: \\201C;\n$close-quote: \\201D;\n. Just for the follow up, all examples listed above works now.\nExcept this:\n``` css\n[data-icon='test-1']:before {\n    content:'\\';\n}\n[data-icon='test-2']:before {\n    content:'\\'';\n}\n[data-icon='test-3']:before {\n    content:\"\\\"\";\n}\n```\n. FYI this code also doesn't work:\ncss\n$open-quote:    \u00ab;\n$close-quote:   \u00bb;\n. Thanks!\n. 1. Version / Feature equivalency\nOn the Ruby-Sass official project, @chriseppstein has just implemented a feature detection.\nE.g.: feature-exists(sourcemap) will return true or false.\nMore details here: https://github.com/nex3/sass/pull/796\nWith this function in Libsass and a complete detection list in both projects, we could easily create a comparison chart for all features implemented in Ruby-Sass & Libsass.\nThen in the future, it might be a good idea to create a wiki containing for each feature: quick information (for IDE), full information + examples (from the existing Sass reference), and implementation specification (for all ports of the official Sass project). This idea should be probably a new issue on the official Sass repository.\n2. Sourcemap\nThere is already an open issue for this one: #122. Can you rename the title to have only one topic per issue?\n. Oh yes this feature will be very handy!\nEspecially since Chrome have a built-in support, and probably Firefox in a near feature.\n. The debug info implemented in this PR isn't Sourcemap, it's Sass Debug Info (the title of this PR is confusing).\nAlso, a sourcemap is a separate .map file (instead of generate extra info directly in the CSS).\nAs @paulirish explains here:\n\nThe sourcemap can map all lines/columns from original sources into their destination CSS.\nWhat this enables on the tool side: ctrl-click any property/value/selector and go to the location in the sass/scss where that originates: the expression, mixin, variable where it was birthed or computed. This makes the editing experience of working with sass and tweaking CSS much more enjoyable.\n\nMore details on the Ruby-Sass implementation:\nhttps://github.com/nex3/sass/pull/569\n. FYI sourcemap is also coming in Firefox.\nhttps://wiki.mozilla.org/DevTools/Features/SourceMap\nBut I also understanding your point, we should first focus on the Sass 3.2 features before the Sass 3.3.\n. I also added a bounty for this one. Hope this will help :)\n. Thanks a lot for your great work @svnieuw!\nThis is really awesome to have sourcemap now in Libsass!\nHowever it seems there a latest thing to implement. It's documented in this issue: https://github.com/hcatlin/libsass/issues/212.\n. Good idea!\nYes I think the Wiki section of this repository should be the best place.\n. @akhleung thanks for the review, and no problem for the delay :wink: \n. +1. Same for me.\n. I also added a bounty for this one. Hope this will help :)\n. Cool, that's great news! Thanks for all the hard work!\n. I vote for the 3.3, because this version will probably be released this month.\n. It's great. But we should do the same in the active extend branch to help @akhleung to then merge it into master.\n. Cool, thanks :)\n. +1, would love to see the map data-type built-in in Libsass.\nHere is the latest documentation about it:\nhttps://github.com/nex3/sass/blob/master/doc-src/SASS_CHANGELOG.md#sassscript-maps\n. It seems to be similar to https://github.com/hcatlin/libsass/issues/140 (I had made a repro project for this issue).\n. FYI, the explanation from the Sass 3.3.0 changelog:\n\nAs part of a migration to cleaner variable semantics, assigning to global variables in a local context by default is deprecated. If there's a global variable named $color and you write $color: blue within a CSS rule, Sass will now print a warning; in the future, it will create a new local variable named $color. You may now explicitly assign to global variables using the !global flag; for example, $color: blue !global will always assign to the global $color variable.\n. I have created a small bounty on this issue.\nI use the BEM syntax on many of my projects, so I'd love to see this feature implemented in Libsass.\n. :+1: Thanks a lot!\n. \n",
    "techniq": "I ran into this issue today using gulp-sass/node-sass/libsass that was due to creating the .scss file in Visual Studio 2012, which created a UTF-8 encoded file.  Opening the file in notepad and changing the encoding to ANSI solved the invalid top-level expression error for me.\n. I'm currently using node-sass which I believe lags a good deal with updates from libsass.  I also have sassc installed via brew.  Do you know how often sassc is updated via brew, or do I need to pull the sassc source (and thus the libsass git submodule) to confirm?\n. Ok, thanks\n. ",
    "QuLogic": "The top-level expression is probably the BOM, so it sounds like gulp-sass/node-sass are using an older version of libsass. You might be able to save it as UTF-8-without-BOM and that might work. No guarantees that non-Latin characters might not be a problem without updating libsass though.\n. There's no need to change to wchar_t if you pick a nice encoding like UTF-8 and stick with it (which I recommend). GLib uses char everywhere and only when you specifically need to deal with some Unicode peculiarities do you need to use any other functions.\n. I just tried a file with actual UTF-8 characters and it works just fine. But it doesn't have a BOM because it's not necessary in UTF-8. I think all that needs to be done is to ignore the BOM (assuming the code's going to work with UTF-8 only, that is).\n. Ah, if only everyone just used UTF-8. But yes, I forgot about the @import issue.\nI think if libsass says \"I assume UTF-8 everywhere\", then we fix up issue #21 nicely (in some way similar to what you propose), libsass could just have the application/bindings deal with the encoding.\n. > Does grunt-sass or node-sass use threads? The backtrace starts and ends with pthread calls but it's not clear where they're coming from. Also, in your node-sass issue you said it happens \"roughly once in every 10 runs\". That sounds consistent with a race condition to me.\nNote the output mmap(size=1152921504876556288), and that the pthread calls actually go down to a throw() in basic_string. It looks like Sass::Node::to_string is called on a Token with begin and end that are wildly incorrect. Now, whether that's due to a parsing issue or some thread corrupting things, I have no idea, but I thought I'd just point that out.\n. Dupe of #64.\n. You should place code blocks in triple backticks.\n. For Python, there's also:\n- SassPython\n- python-scss\n. I've copied these onto a Wiki page: https://github.com/hcatlin/libsass/wiki/Implementations\n. You must be running with the latest libsass. If you use the revision that is currently linked with sassc (submodule-wise, I mean), then imports work correctly.\n. Also, as I mentioned in hcatlin/sassc#34, the existing (though slightly broken) test does not work.\n. You'll also need to apply hcatlin/sass-spec#2 because I added --skip to Travis (It makes more sense there).\n. I've updated this to also use automake's test driver framework. This doesn't change a whole lot since there's already a framework in place, but it enables automake to setup parallel tests (at least at the top level, in the way I've currently got it working). Then it can print a proper summary at the end as well.\n. I can, but I'm basically just going to undo it. It works, but it's not really the automake-y way.\nBTW, also need to merge hcatlin/sass-spec#2 to make things work better.\n. Yea, that was merged, but there were some other changes to the build, so I'm not sure it will run out-of-the box right now.\n. Yea, you also need to compile with the right flags and upload results to coveralls. It looks like @mgreter is on top of it, though.\nPS, you may want to turn off coveralls' posting on PRs until the work is done, otherwise you'll get a lot of \"coverage is still 0%!\" posts...\n. You can check my previous attempt which seemed to work with autotools. It's a little outdated, but I think the ideas are there. I think the problem may be that you might need to compile statically.\n. Are you compiling your final application with a C++ compiler?\nThe libsass.a is a static library and thus contains no information about dependencies. You need to supply them when linking. The easiest way to do that is to link with a C++ compiler.\n. I think the only other dependency is the standard math library (libm.so).\n. Travis failed with autotools. You need to update Makefile.am with your new files as well.\n. > the build failure probably has nothing to do with your pull request; we've just been lax in keeping the Travis script up to date!\nNo, @svnieuw added new files to Makefile but not Makefile.am.\n. > Hmm, I thought Travis had already been choking on something else....\nTrue, there seems to be only about 50% passing, so it should probably be looked into at some point.\n. > Oh yeah, we're running the entire test suite (including the \"to-do\" tests), so that's expected to fail ...\nBut the \"to-do\" tests don't make up 50% of the tests, so something definitely needs to be checked there. (FYI, the TAP driver in PR #169 correctly understands TODO items.)\n\nbut I thought that Travis wasn't even able to compile for some other reason (like, we were passing the wrong flag to autotools or something).\n\nSeems to be working fine so far.\n. libsass has its own tests. Just run make test.\nIf that's no longer working, that's a different issue.\n. OK, but he just added this:\n+test: $(SASSC_BIN) libsass.a\n+  ruby $(SASS_SPEC_PATH)/sass-spec.rb -c $(SASSC_BIN) -s $(LOG_FLAGS) $(SASS_SPEC_PATH)\nwhich amends the original make test, meaning you'd probably run tests twice (once using autotools to run sass-spec.rb with sassc++, and once using sass-spec.rb to use sassc).\nIt appears that the Makefile no longer builds sassc++? In that case, the Makefile.am is still not correct.\n. > It appears that the Makefile no longer builds sassc++? In that case, the Makefile.am is still not correct.\nD'oh, that's correct. I added it myself! I've been away too long...\n. #166?\n. Somebody fixed this already.\n. > if you have these asciii codes in the second/third/... byte of the uincode char\nUTF-8 is specifically designed so that that is impossible, unless you are referring to characters above 127, which are not standardized at all (hence the various incompatible code pages).\n. No, 0x433A is the code point for that character, but when encoded in UTF-8, no ASCII characters less than 128  will occur in the second and higher bytes. That character encoded in UTF-8 is 0xE4 0x8C 0xBA.\n. > @QuLogic: You seem to be correct, sir! Seems like I still haven't figured out unicode completely!\nIt's probably a very common mistake to think that for multi-byte characters, you can just set the MSB for bytes that need to be continued. But in UTF-8, every single byte in a multi-byte character has the MSB set. This has several advantages, one of which being you'd never see a lower ASCII character \"by mistake\".\nAnyway, another advantage is that you can just treat UTF-8 as \"a bunch of bytes\" so long as you don't need to count actual characters. You don't accidentally see other characters, and you don't have embedded NULs to worry about.\n. Similar/related to #166?\n. The Automake setup still uses sassc for real testing, so if sassc++.cpp is unused/outdated, it could be removed easily.\n. Yea, if you don't want sassc++ anymore, you can remove lines 16-20.\n. BTW, you seem to have left autotools in, this time around.\n. Also, can CMake be configured to disable testing (because maybe someone doesn't want to install Ruby)?\n. > ```\n\nAlso, can CMake be configured to disable testing (because maybe someone doesn't want to install Ruby)?\n```\nYup, that's what i did here https://github.com/hcatlin/libsass/pull/292/files#diff-15547c54d3d4898a882b4ab7b3cee381R21\n\nAh right, for some reason, I thought I saw a REQUIRED there.\n. libsass.a is static, and must be built into everything that uses it. If you had a libsass.so, then you could load it dynamically. I think CMake should take care of that stuff for you, though.\n. I see a few warnings with Doxygen 1.8.6:\nWarning: Tag `SYMBOL_CACHE_SIZE' at line 40 of file Doxyfile has become obsolete.\nTo avoid this warning please remove this line from your configuration file or upgrade it using \"doxygen -u\"\nWarning: Tag `SHOW_DIRECTORIES' at line 71 of file Doxyfile has become obsolete.\nTo avoid this warning please remove this line from your configuration file or upgrade it using \"doxygen -u\"\nWarning: Tag `HTML_ALIGN_MEMBERS' at line 130 of file Doxyfile has become obsolete.\nTo avoid this warning please remove this line from your configuration file or upgrade it using \"doxygen -u\"\nWarning: Tag `USE_INLINE_TREES' at line 153 of file Doxyfile has become obsolete.\nTo avoid this warning please remove this line from your configuration file or upgrade it using \"doxygen -u\"\nWarning: doxygen no longer ships with the FreeSans font.\nYou may want to clear or change DOT_FONTNAME.\nOtherwise you run the risk that the wrong font is being used for dot generated graphs.\n. You should try testing an out-of-source build. (Lots of CMake-using projects prefer/mandate it.)\nmkdir build\ncd build\ncmake ..\nmake\nDocumentation, for example, ends up in the source directory instead of the build directory. I'm not sure if the full test suite works (I don't have Ruby on this computer).\n. > RUN rm /usr/bin/python && ln -s /usr/bin/python26 /usr/bin/python # This centos install is probably toast at this point... It will break yum and other things from here out.\nWouldn't it make more sense to run something like scl enable python26 bash? Well, I mean that's how it should work in newer CentOS; I'm not really sure about 5...\n. Automake's make dist could produce the tarball/zips for you, although it will need some tweaking (i.e., #237) since it's a bit out-of-date.\n. Looks like you're missing some headers or at least namespacing.\n. ../libsass/utf8_string.cpp:111: error: call of overloaded \u2018abs(int&)\u2019 is ambiguous\nDupe of #388 and/or #399. node-sass probably needs updating.\n. > I guess it was assumed that std::toupper and std::tolower would only work on ascii characters. I have no idea why this is not the case on my platform\ntoupper and tolower depend on the locale which, on Windows, is not UTF-8 and probably includes some random accented characters in the >127 range that match with UTF-8 leading bytes.\n. > I wish we could re-run these damn things.\nThere's a restart button on Travis (admins only).\n. > So far I only added it to the automake build of libsass, so will also try to add this to the libsass Makefile.\nThe tests are always the same, regardless of automake or hand-built, no? I would guess it's sufficient to just upload coverage reports for one of them.\n. @am11: sass2scss is no longer a submodule.\n. Huh, mathematically speaking, I'd have thought that - was a unary minus and applied to the 54, not the entire expression...\n. @hcatlin: This is tangentially related, but since it's in the release notes: you may be able to support older GCC versions by setting the standard to c++0x. Unfortunately, one does not work on the other, so you will just have to suggest it to people who are absolutely 100% stuck with an old version.\n. BTW, this created an extra branch that you likely do not want to keep around.\n. > Can we also get rid of the size_t hash_ = 0 initialization in ast.hpp? It breaks my travis-ci builds for perl-libsass (I'm compiling with -std=c++0x). Don't know where to initialize them properly though.\nProbably have to move it to the initialization list in the constructor (after the name and : but before the {).\n. Integer division?\n. Can you give an example of the failing coverage reporting? Can you\nreproduce locally?\n. > Here is one of the builds that failed to generate the coveralls report. The problem is coming from gcov.\nThat build actually failed in cpp-coveralls here. It appears to be attempting to open a directory as a file. It's possible that something incorrectly has a directory in some list of files. Maybe that causes a crash in gcov (but why it doesn't always happen, I don't know). Perhaps try asking the cpp-coveralls people about the crash there?\n. Yea, that definition will return the union by value, which means the stuff from the structure needs to be copied from the function's copy to the caller's copy. That means the compiler needs to know the actual size of it. Using a pointer would reduce that copying to just the pointer (which may fit in a register even).\nYou could do:\ntypedef union Sass_Value *Sass_Value;\nin the header and then just use Sass_Value everywhere. As long as you don't have to dereference the union in the header, there should be no need for the full layout.\n. That make_sass_null should be (void).\n. @mgreter I haven't had a chance to look at what you did, but just based on the log, it looks like you need to include a header to get size_t in sass_values.h. Also, I think you don't need quite so many const. I don't think it makes too much sense for a return of an integral type, and there are quite a few warnings about it.\n@am11 Complete side note, but you shouldn't have to run g++ version through sudo.\n. @mgreter Well, in C, I don't think it's as necessary as C++. It makes no real difference for integral types, and there are no classes. It really only makes sense with pointers, e.g., const char * (meaning a pointer to a constant character string).\nThe usual contract is const means the code that gets it doesn't own it (i.e., a function with a const argument would copy the argument if it wanted to hang on to it and also would not free the argument, with similar ideas for the return value).\n. CC(target) Release/obj.target/binding/src/libsass/cencode.o\ncc1: warning: command line option '-std=c++11' is valid for C++/ObjC++ but not for C [enabled by default]\ncc1: warning: command line option '-std=c++11' is valid for C++/ObjC++ but not for C [enabled by default]\nFor this one, -std=c++11 should be in CXXFLAGS not CFLAGS/CPPFLAGS? (Not sure how you're compiling it.)\n. > I'm not really a fan of using a ton of functions just to set options on a struct. That's a lot of wasted overhead.\nIs it really? GLib and GTK+ did this for every structure they had, and they don't seem to be complaining.\n\nI think a better approach would be to implement a single function that returns a sass_options struct initialized with sane defaults.\n\nThere's no reason there couldn't be helper functions like this alongside the lower-level getter/setters.\n\nAlso, there's really only a handful of implementors that are going to use this API, right? sassc, myself and maybe a few others. All the higher-level implementors are just going to call sassc, no?\n\nNo, absolutely not. Everyone (binding-wise) should use the API. Shelling out to sassc is a going to lead to a very broken and possibly stagnant interface.\n. @mgreter Yes, good point, I was debating whether to mention that because it can be long to explain...\nBasically, it means the underlying implementation is uncoupled from the API. If downstream users have access to the structure fields, those fields must stay the same forever (or at least until you create a 4.0.0 or something, and explicitly notify people). Theoretically, if you wanted to add stuff, you couldn't, because a downstream user might be allocating the structure themselves, and when libsass code goes to access the new field, you get a segfault because the structure is not big enough. (I don't think that has stopped libsass developers before, but I chalk that up being more \"beta\" before. Now that many people use it, it's more important to avoid that.)\nOnce the structure fields are hidden, all the downstream user has to worry about is a pointer. They can't accidentally allocate it too small, or forget to initialize a new field, or whatever... The libsass developers are free to change the underlying setup entirely, e.g., instead of a structure, it could actually just be a pointer to the C++ class. But downstream doesn't have to know or care. They stay happy as long as nothing's removed from the API, i.e., it gives you forward compatibility.\n. > My guess was, that if we add more stuff (functions) to the header and that library get installed over an old one in the system lib folder, software that was built against the old library (dynamically linked), will still link happily with the newly installed one. Correct? IMO this would also be true if we always added stuff the end end of the structs, but not if something got added in between ...\nYou are correct, except in the case where someone allocates the structure themselves. Then the field you added may or may not be initialized. In fact, the structure may not even be big enough to contain the new fields.\n. .sass files should use the indented syntax. As such, whitespace is very important there, so your use of braces is unnecessary and will cause issues. I do not know what difference the line endings make.\n. I'm not a Ruby person, but this doesn't sound right:\n\nsudo chmod -R go+w /Library/Ruby/Gems/2.0.0\ngem install minitest\n\nThere must be some --user argument to gem you could use?\n. What's the error? It appears that alternatives is defined for up to 8 arguments. But the 7 and 8 versions include rslt = src which the lesser argument versions don't. Maybe that's all that could fix it?\n. @mgreter Small question about that ebuild: It seems you have a redundant line DEPEND=\"${DEPEND}\", or is that DEPEND supposed to be a different name?\n. Since dietlibc is a C standard library replacement, I don't think it implements anything in the C++ standard library...\n. Also, you should remember to use dietlibc when linking, which doesn't work for me. Either you mix the two:\ncc -O2  -o bin/sassc sassc.o /home/elliott/code/libsass/lib/libsass.a -lstdc++ -lm\nsassc.o:(.note+0x10): undefined reference to `__you_tried_to_link_a_dietlibc_object_against_glibc'\n/home/elliott/code/libsass/lib/libsass.a(cencode.o):(.note+0x10): undefined reference to `__you_tried_to_link_a_dietlibc_object_against_glibc'\nOr it fails because there's no C++ library:\n~/code/dietlibc-0.33/bin-x86_64/diet gcc -O2  -o bin/sassc sassc.o /home/elliott/code/libsass/lib/libsass.a -lstdc++ -lm\n/usr/bin/ld: cannot find -lstdc++\n/home/elliott/code/libsass/lib/libsass.a(json.o): In function `emit_string(SB*, char const*)':\njson.cpp:(.text+0x5f6): warning: warning: your code still has assertions enabled!\n/home/elliott/code/dietlibc-0.33/bin-x86_64/dietlibc.a(sprintf.o): In function `sprintf':\nsprintf.c:(.text+0x83): warning: warning: Avoid *sprintf; use *snprintf. It is more secure.\n/home/elliott/code/dietlibc-0.33/bin-x86_64/dietlibc.a(vsnprintf.o): In function `vsnprintf':\nvsnprintf.c:(.text+0x8d): warning: warning: the printf functions add several kilobytes of bloat.\n/home/elliott/code/dietlibc-0.33/bin-x86_64/dietlibc.a(stderr.o): In function `__fflush_stderr':\nstderr.c:(.text+0x8): warning: warning: your code uses stdio (7+k bloat).\ncollect2: error: ld returned 1 exit status\nMakefile:35: recipe for target 'build-static' failed\nDistro packages would be built against the standard libraries in the distro, so using dietlibc would have no benefit there. Most distros would not want you bundling things, so it'd be more work to take it out instead.\n. dietlibc is a replacement mostly for memory-constrained systems; I'm not sure I'd call it a fix, per se.\nBut I agree with @mgreter; I'm not sure there's any need to be putting anything in libsass itself. You could just set the CC and CXX variables when you compile, if you really need it (and if it actually worked ;).\n. Fails in Windows as well:\ncontext.obj : error LNK2019: unresolved external symbol\n\"private: class Sass::Statement * __thiscall Sass::Cssize::fallback_impl(class Sass::AST_Node *)\"\n(?fallback_impl@Cssize@Sass@@AAEPAVStatement@2@PAVAST_Node@2@@Z) referenced in function\n\"public: class Sass::Statement * __thiscall Sass::Cssize::fallback<class Sass::AST_Node *>(class Sass::AST_Node *)\"\n(??$fallback@PAVAST_Node@Sass@@@Cssize@Sass@@QAEPAVStatement@1@PAVAST_Node@1@@Z) [C:\\projects\\libsass\\win\\libsass.vcxproj]\nso maybe this points you in the right direction.\n. As long as there's only one rule that creates the directory, I think there should be no problems due to race conditions. However, there is still the minor issue that the targets now depend on the timestamp of the directory and not merely its existence. But apparently you can use an order-only prequisite which should convey that intent. \n. > We could then either cherry-pick those patches (my preference) or merge stable into master (this makes for a messy git history IMHO).\nContrarily, I think your preference is messier here. It's simpler and 'DRY'er to have only one commit for a bugfix. Since the stable branch has only bugfixes, it should be a pretty simple merge in general. There's no need to ask \"did we include that bug fix from last year in the next major release?\" because all you'd have to do is ensure that stable is merged. Built-in tools like git branch --contains abc1234 will list both stable and master and people won't have to go looking for the cherry-picked version. I'm sure there are other examples...\nEverything else makes sense in general.\n. > I completely agree. My concern is the need to merge stable -> master and master -> stable. Generally speaking it's cleaner, and less error prone to merge in one direction.\nIdeally, there should be only one time that there's a merge from master -> stable: after a minor release. And since you've just made a release, you've also just merged stable -> master, so the master -> stable operation is just a fast-forward.\nOf course, sometimes when you're working on a feature, you find yourself fixing a bug and you might need to cherry-pick that, but I'd say try and avoid it.\n. You have fallback_impl defined as inline in the .cpp file, but declared without inline in the .hpp file. The inline definition is used in the .cpp, but since the .hpp doesn't have the definition, it's undefined for anything that uses it, e.g, the fallback method.\nIn short, drop the inline and it works ~~, though I'm uncertain why it doesn't affect eval.?pp...~~ If you check the symbols, then you see that the one from Eval doesn't exist:\n$ nm .libs/libsass.so | c++filt | grep 'fallback_impl'\n000000000008af80 T Sass::Contextualize::fallback_impl(Sass::AST_Node*)\n0000000000161be0 T Sass::To_C::fallback_impl(Sass::AST_Node*)\n00000000000cd6a0 T Sass::Cssize::fallback_impl(Sass::AST_Node*)\n00000000000b3ae0 W Sass::Expand::fallback_impl(Sass::AST_Node*)\nso I think it's unused and then optimized out.\n. I don't use Windows, but it appears the solution has the sassc executable in the build. You also need sassc sources: https://github.com/sass/libsass/wiki/Building-on-Windows#building-via-visual-studio-community-2013\n. Hmm, no AppVeyor? That's really what I was interested in...\n. Since @xzyfer mentioned that this passed on AppVeyor, I guess we can merge this, the missing CI results notwithstanding.\n. You might want to suffix the names with _H or similar (just because something like SASS_CONTEXT seems a bit generic.)\n. I don't know about Swig, but aren't there already a few Go implementations?\n. Actually, scratch that; it appears you're swig'ing the entire code base, when all you need are the two or three .h headers.\n. Ah, in that case, you should be aware that only the .h files are necessary to define the interface. Your swig warnings/errors are coming from the C++ files. I'm not sure how, but you'd need to configure swig to not attempt to parse them.\nI'm not even sure whether the C++ side is guaranteed to be a public API; you'd have to check proper maintainers' thoughts on that one.\n. It looks like the related functions also don't clamp results, e.g., saturate does not limit the result to 100. Maybe you could add those fixes too.\n. > libsass currently doesn't seem to free source_string. Unless I'm missing something?\nYes, but line 471 is ctx->source_string = source_string;, i.e., the string is not duplicated. Which means it should continue to exist once the function exits. This is usually signified by leaving off the const (not a hard rule, though.) But you are correct that libsass should probably be freeing it if it owns it.\n. echo 1 | git describe --abbrev=4 --dirty --always --tags 2>/dev/null | cat VERSION 2>/dev/null | echo \"[na]\" does not print 1.\nYou can place any shell script before AC_INIT; you (probably) can't use autoconf macros.\n. > IMO looks already a lot cleaner.\nYep, looking good.\n. On that ebuild, couldn't you have DEPEND=\"gcc>=4.5.0\" without the pkg_pretend? (using the correct package name for Gentoo, which I don't remember.)\n. Was that second commit intended for this branch?\n. You know, I'm not even sure what makes dlopen necessary...\n. > You know, I'm not even sure what makes dlopen necessary...\nAh, my master checkout was outdated. plugins.hpp uses dlopen, so it's a necessary thing. Probably just add the -dlopen flag to libsass_la_LDFLAGS?\n. You don't even need the if:\nc++\nfor (; *included_files != nullptr; included_files++) {\n // do something\n}\n. No, wait, actually, there might be a case where the array is NULL, if parsing fails. Might be safer for you to leave the condition in then, if you're still checking it in all cases.\n. No, wait, actually, there might be a case where the array is NULL, if parsing fails. Might be safer for you to leave the condition in then, if you're still checking it in all cases.\n. libtool 2.4.3 is really new. I think you'll have to reduce the requirement there.\n. Travis is the least of the problems; since most distros don't even have 2.4.3, it's much much too early to be depending on it.\n. Strictly speaking, the _t suffix is reserved in POSIX, so since you're changing it everywhere, best to remove it entirely.\n. @xzyfer Did you forget to close as well?\n. FYI, if you add Fixes #1105 to the commit message, GitHub will auto-close this ticket once it's merged to master.\n. This repo is for the C libsass, not the Python wrapper; I think you have the wrong one.\n. Good idea. Unintentionally dirty workspaces are very annoying with git.\n. > Never merge in the upstream master. Always rebase.\nDepends on the project though. If you've already opened a PR, some prefer waiting until you're completely finished.\n\nBe very careful when force pushing. There is no undo.\n\nThat's when it's time to learn about git reflog. (But in all seriousness, it's probably easier to create a temporary branch at the original point if you're at all worried in the slightest.)\n. Uh, snprintf is used right here.\n. So if I understand this correctly, it's trying to read the PR text and see if there's a sass/sass-spec reference to pull? How about moving that reference into the git commit message? Then you can just check locally and not hit the API at all.\n. I'm not so sure; just pick the latest one: git log --grep -1 'sass/sass-spec' master..origin/pulls/$TRAVIS_PULL_REQUEST (Sorry, I forgot the exact branch name Travis uses of the top of my head.)\nIf contributors don't mention that they updated (or plan to) sass-spec in their message, then just have the build fail. Actually, I think there's a CI that checks that...\n. I guess the Makefile stuff depends on how much OS-specific stuff you want; as you say you can use make INSTALL=ginstall PREFIX=/opt/local.\n. Is the LIB part really necessary though?\n. Why does this end here and not at the end?\n. The usual idiom is:\n```\nifdef __cplusplus\nextern \"C\" {\nendif\n...\nifdef __cplusplus\n}\nendif\n```\nthough I am not sure why. I can only assume it's because of weird compilers, or from everyone just copying everyone else :stuck_out_tongue:.\n. These should be (void) to be correctly C-compliant.\n. In C, () means you don't know what the parameters are, but (void) means there are no parameters.\n. This is a bit weird. I think you mean [test \"x$enable_coverage\" != xno].\n. This one should be enable_coverage=\"$enableval\". You should be able to pass --disable-coverage, or even --enable-coverage=no (though that's a bit weird.)\n. behave like a...?\n. This is where the function name ends up as the last argument, right? Could you create a new Arguments with the function name and += the original arguments? (I'm assuming you really wanted the function name first from your other comment.)\n. Maybe I'm missing something, but I don't see the << being overloaded by the Arguments class. I do see << in Vectorized, but there's also +=.\n. Parens are unnecessary, BTW. * is nearly highest priority, and && is practically the lowest.\n. Should these be uncommented now (without consts, maybe)?\n. Since the function names are no longer aligned in this group, probably the extra whitespace between the name and parameters can be removed.\n. Ah, maybe just change the comment then...\n. I'm confused why it's base 36? You print the number in hex, which is base 16.\n. That Ruby code has value.to_s(36); yours has << std::hex << (long)dis(gen).\n. That branch is applied unconditionally a little farther down.\n. Without -p, this would fail when the directory already exists.\n. Usually the problem with creating directories in makefiles is that it's\nracy. But since you have a separate rule for it, that might be okay (I\nforgot to mention that initially; sorry if I made it sound too big). I\nthink there should not be a problem with having makefile targets depend\non the directory (as long as there's only one), but I normally just put\n.keep in them to ensure they exist.\nPS, the @ prefix suppresses output; the - prefix ignores errors.\n. Probably make this public or protected, I think?\n. This is fairly unsafe. Use #if 0 if you absolutely must comment out a block (but removal is better).\n. Hmm, this is += now for desaturation?\n. This is subtly different, but maybe that's intended. Originally for negative input -X% saturated by Y%: -X% -> 0% -> Y%, but now -X% -> (-X+Y)% (which is likely not the same as Y%).\n. I've no idea, but someone must have written the check for some reason! :P\n. Does this actually work? I wouldn't expect git to copy its stdin to stdout even if it failed.\n. Also, I suggest putting this in a variable before the AC_INIT call, just to make it clearer.\n. Looks like you need to use m4_define.\n. Yea, I think you're right.\n. %{version} is defined by what's in Version:, so I'm not sure how this works out. Maybe you can define it when building, like rpmbuild --define 'version 1.2.3', but I'm not sure how it will work when the two things are clashing like this.\n. According to this:\n\nAutomake always uses two of these variables when compiling C sources files. When compiling an object file for the mumble target, the first variable will be mumble_CPPFLAGS if it is defined, or AM_CPPFLAGS otherwise. The second variable is always CPPFLAGS.\n\nSo, you should still need $(AM_LDFLAGS) here.\n. > -O level\n\n\nIf level is a numeric values greater than zero ld optimizes the output. This might take significantly longer and therefore probably should only be enabled for the final binary. At the moment this option only affects ELF shared library generation. Future releases of the linker may make more use of this option. Also currently there is no difference in the linker's behaviour for different non-zero values of this option. Again this may change with future releases.\n\n\nSo yes, it appears to make a difference; not sure how much.\n. That's not how you spell exclude... ;)\n. Does it really need to be double, and not something integral?\n. Maybe set *array to NULL as an equivalent to the exception?\n. ",
    "jbutko": "Got this same error today. Found out I had a redundant expression in my gruntfile.js file: 'css/ie.css': 'css/ie.scss' Deleted this and now it works like a charm. So always double check if you are referencing only real files.\n. ",
    "georgiosd": "Guys, have you decided what do on this? As already mentioned, it breaks with files that include a BOM. \nI used to do C++ before I discovered C# and wchar_t was a big pain to use back then because it meant different OS support (I think Unicode was supported after Windows 2000/XP) and you have to use compiler flags to produce ANSI and Unicode versions specifically. \nIn this day and age when all OSes support Unicode, changing wchar_t should be trivial. The only \"problem\" is that the memory usage will double automatically - though this is not really a big problem given the size of computer memory and SCSS files. \nLet me know what you think.\n. Seriously?? Then it must be because this guy hasn't rebased in 3 months.\nAnyhow, this was my fix: https://github.com/TBAPI-0KA/NSass/pull/1\n. If you get stuck anywhere with wchar_t, feel free to comment here and I'll try to help\n. LOL. Fair comment but at I least I went for \"should\" vs \"will\" :)\n. This is related to: https://github.com/hcatlin/libsass/issues/72\n. Yes, fantastic! Thank you for taking care of this!\n. ",
    "dorny": "Hi, is there any progress on this issue? I've found this can be very useful.\nEspecially since chrome supports sass sourcemaps: http://bricss.net/post/33788072565/using-sass-source-maps-in-webkit-inspector\nCheers,\nMichal\n. Thanks for reply. Maybe if i will have som free time i'll look into code a try to help with it. Performance of your c++ implementation is great. Lack of sourcemap support and sass syntax (whitespace) are only reasons why i'm still using ruby version.  +1 for this project.\n. Yes I submit pull request immediately after i have hotfixed it. But it cannot be merged now. There's little problem on windows - maybe just one missing \"#include\". I was very busy last days, i will fix it soon and than we will see if @hcatlin or @akhleung  will merge it. Hotfix is still hotfix, i didn't study much about sourcemaps but this simple solution seems to work.\n. I'm not sure what exactly do you mean by \"exposed viac C interface\".\nI have already done it by:\n``` c\ndefine SASS_SOURCE_COMMENTS_NONE 0\ndefine SASS_SOURCE_COMMENTS_DEFAULT 1\ndefine SASS_SOURCE_COMMENTS_MAP 2\n```\nIn similar way there are defined SASS_STYLE_NESTED,SASS_STYLE_EXPANDED,... as parameters for output style.\n. ",
    "danactive": "Hi @dorny I'm hoping your fix will make into libsass.  Did you submit a pull request to @hcatlin ?\n. ",
    "dahlia": "I sent a pull request (#37) instead.\n. Works again.\n. :+1:\n. Great job!  :+1:\n. It would be better if any parameter for it is exposed via C interface (sass_interface.h).\n. @dorny Oh I exactly meant such thing, cool.\n. ",
    "deanmao": "Looks good here.\n. Any progress on this one?  We still use compass for some stuff, but would be nice to remove the ruby dependency.  I wouldn't even mind writing C code if it lets us extend the features of libsass to do stuff, the same way that ruby's sass lets you write extensions.\nI don't even use most of the features of compass, I just want it for the sprite handling.  Of course there are other alternatives to sprite handling in node, but they don't use sass (stylus & less have some options I think)\nI put the $50 bounty on it, but I guess I made the bounty anonymous, oh well.\n. FYI node-sass is updated to use the latest libsass as of today.\n. I guess we can close this out\n. it works for me?  give us something to work from...  if I can't reproduce your error, I can't fix it.\n. Also, don't post in this issue -- create a new one or your plea will get lost.  Post the issue to node-sass because I assume that's the one that is segfaulting, unless you're building directly from libsass.\n. ",
    "ebersac": "Confirmed.\n. ",
    "kadishmal": "Yes, I don't actually care about encodings either. All I want is the successful build.\n. ",
    "djensen47": "What's the status of this bug? Thanks.\n. Nice, thank you! Now I just need those changes to get into node-sass. :-)\n. :ok_hand: :+1: \n. It appears that libsass is failing to compile again \u2026\n```\n$ sudo npm install -g node-sass\n/opt/local/bin/node-sass -> /opt/local/lib/node_modules/node-sass/bin/node-sass\n\nnode-sass@3.2.0 install /opt/local/lib/node_modules/node-sass\nnode scripts/install.js\n\nCannot download \"https://github.com/sass/node-sass/releases/download/v3.2.0/sunos-x64-14_binding.node\": HTTP error 404 Not Found\n\nnode-sass@3.2.0 postinstall /opt/local/lib/node_modules/node-sass\nnode scripts/build.js\n\nBuilding: /opt/local/bin/node node_modules/pangyp/bin/node-gyp rebuild --libsass_ext= --libsass_cflags= --libsass_ldflags= --libsass_library=\ngyp WARN EACCES user \"root\" does not have permission to access the dev dir \"/root/.node-gyp/0.12.0\"\ngyp WARN EACCES attempting to reinstall using temporary dev dir \"/opt/local/lib/node_modules/node-sass/.node-gyp\"\nmake: Entering directory '/opt/local/lib/node_modules/node-sass/build'\n  CXX(target) Release/obj.target/libsass/src/libsass/ast.o\nIn file included from ../src/libsass/ast.hpp:34:0,\n                 from ../src/libsass/ast.cpp:1:\n../src/libsass/units.hpp:39:5: error: expected identifier before numeric constant\n../src/libsass/units.hpp:39:5: error: expected '}' before numeric constant\n../src/libsass/units.hpp:39:5: error: expected unqualified-id before numeric constant\n../src/libsass/units.hpp:62:3: error: 'SassUnit' does not name a type\n../src/libsass/units.hpp:63:30: error: 'SassUnit' was not declared in this scope\n../src/libsass/units.hpp:63:30: note: suggested alternative:\n../src/libsass/units.hpp:22:8: note:   'Sass::SassUnit'\n../src/libsass/units.hpp:64:3: error: 'SassUnitType' does not name a type\n../src/libsass/units.hpp:66:34: error: 'string' does not name a type\n../src/libsass/units.hpp:66:40: error: ISO C++ forbids declaration of 'parameter' with no type [-fpermissive]\n../src/libsass/units.hpp:66:49: error: 'string' does not name a type\n../src/libsass/units.hpp:66:55: error: ISO C++ forbids declaration of 'parameter' with no type [-fpermissive]\n../src/libsass/units.hpp:69:3: error: expected class-name before '{' token\n../src/libsass/units.hpp:72:34: error: expected ')' before 'a'\n../src/libsass/units.hpp:87:1: error: expected declaration before '}' token\nsrc/libsass.target.mk:128: recipe for target 'Release/obj.target/libsass/src/libsass/ast.o' failed\nmake: *** [Release/obj.target/libsass/src/libsass/ast.o] Error 1\nmake: Leaving directory '/opt/local/lib/node_modules/node-sass/build'\ngyp ERR! build error\ngyp ERR! stack Error: make failed with exit code: 2\ngyp ERR! stack     at ChildProcess.onExit (/opt/local/lib/node_modules/node-sass/node_modules/pangyp/lib/build.js:271:23)\ngyp ERR! stack     at ChildProcess.emit (events.js:110:17)\ngyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1067:12)\ngyp ERR! System SunOS 5.11\ngyp ERR! command \"/opt/local/bin/node\" \"/opt/local/lib/node_modules/node-sass/node_modules/pangyp/bin/node-gyp\" \"rebuild\" \"--libsass_ext=\" \"--libsass_cflags=\" \"--libsass_ldflags=\" \"--libsass_library=\"\ngyp ERR! cwd /opt/local/lib/node_modules/node-sass\ngyp ERR! node -v v0.12.0\ngyp ERR! pangyp -v v2.2.1\ngyp ERR! not ok\nBuild failed\nnpm ERR! SunOS 5.11\nnpm ERR! argv \"/opt/local/bin/node\" \"/opt/local/bin/npm\" \"install\" \"-g\" \"node-sass\"\nnpm ERR! node v0.12.0\nnpm ERR! npm  v2.5.1\nnpm ERR! code ELIFECYCLE\nnpm ERR! node-sass@3.2.0 postinstall: node scripts/build.js\nnpm ERR! Exit status 1\nnpm ERR!\nnpm ERR! Failed at the node-sass@3.2.0 postinstall script 'node scripts/build.js'.\nnpm ERR! This is most likely a problem with the node-sass package,\nnpm ERR! not with npm itself.\nnpm ERR! Tell the author that this fails on your system:\nnpm ERR!     node scripts/build.js\nnpm ERR! You can get their info via:\nnpm ERR!     npm owner ls node-sass\nnpm ERR! There is likely additional logging output above.\n``\n. I opened a bug on libsass. I'll open another one here.\n. Where do findast.cpp`?\nDo you have a SmartOS instance for testing or is this just happening on my instance(s)?\n. Do you have VMWare Player? There's a VM you can download for SmartOS or you can start an instance for a couple of hours should cost under well under $1 USD.\nI'll run that compiler command now.\n. Hrmm, I think I have to clone node-sass. When npm install fails, it cleans up the node-sass dir?\n. https://gist.github.com/djensen47/37735df7cdd68d99425f\n. I'll take a look today.\nAlso, did you see this: https://gist.github.com/jperkin/4b88403da41f556e540d\n. > No, thank you!\nDon't thank me, thank @jperkin :wink: \n. ",
    "litek": "Apparently only works for Visual C++ 2012, not 2010 (andrew/node-sass/issues/28)\n. ",
    "mingodad": "After playing a bit with the code I tried this modification but it now gives another error:\nIt seems that this parser is generated by hand. How it works ?\nIf some explanation about of the logic of this parser is provided it can allow other people to help improve it, I plan to integrate a lua interpreter on it and knowing a bit how it is supposed to work will make things easier.\nNode Document::parse_propset()\n  {\n    lex< identifier >();\n    Node property_segment(context.new_Node(Node::identifier, path, line, lexed));\n    lex< exactly<':'> >();\n    lex< exactly<'{'> >();\n    Node block(context.new_Node(Node::block, path, line, 1));\n    while (!lex< exactly<'}'> >()) {\n      if (peek< sequence< identifier, optional_spaces, exactly<':'>, optional_spaces, exactly<'{'> > >(position)) {\n        block << parse_propset();\n      }\n///////new code start\n      else if(peek< exactly'@' >()) {\n          block << parse_block(block);\n      }\n//////new code end\n      else {\n        block << parse_rule();\n        lex< exactly<';'> >();\n      }\n    }\n    if (block.empty()) throw_syntax_error(\"namespaced property cannot be empty\");\n    Node propset(context.new_Node(Node::propset, path, line, 2));\n    propset << property_segment;\n    propset << block;\n    return propset;\n  }\n. My idea is to be able to also create functions with lua to be used inside scss probably something like:\n@-lua {\n--any lua code here\n--maybe having a global object sass where we can create new functions on it\n--that will be searched when an identifier is not found elsewhere\nfunction sass:resize_image(img_name, new_size)\n  os.execute(\"imagemagick ...\")\n  ...\nend\n}\n.menu {\n  background-image : @include resize_image('some_image', 30px);\n}\n. ",
    "drinchev": "When will this be fixed? Is there any trick to make @-webkit-keyframes work ?\n. ",
    "joeytrapp": "What is the status on this issue? I'm loading the Zurb Foundation css (not their sass as it requires compass) and I'm getting error: top-level blockless directive must be terminated by ';'\n. ",
    "jfrux": "+1\n. :-1: No other solution possible?\n. Was this re-introduced in newer node versions?\n. ",
    "enriclluelles": "I tried to solve this in my pull request #93, would love some feedback on it\n. Actually that bug was solved, the correct bug is #54, the parser can't compute @keyframes and similar\n. Awesome thanks\n. ",
    "vjpr": "+1\n. ",
    "kumavis": "+1\n. ",
    "franckbret": "Hi,\nAny news on this feature ?\n. Thanks for your answer. Btwi don't get why i can't see this option when I run ./bin/sassc --help\nI've seen this merge, quite old but with stdin support at the sassc level, so I supposed it was ok... https://github.com/sass/sassc/pull/44\nNow I really miss something...\nLooks like I run sassc version 0.4.2\n```\n./bin/sassc --version\nsassc 0.4.2\n./bin/sassc --help\nUsage: sassc [options] SCSS_FILE [OUT_CSS_FILE]\nOptions:\n  --version             show program's version number and exit\n  -h, --help            show this help message and exit\n  -s STYLE, --output-style=STYLE\n                    Coding style of the compiled result.  Choose one of\n                    compact, expanded, compressed, or nested. [default:\n                    nested]\n   -m, -g, --sourcemap   Emit source map.  Requires the second argument (output\n                    css filename).\n   -I DIR, --include-path=DIR\n                    Path to find \"@import\"ed (S)CSS source files.  Can be\n                    multiply used.\n   -i DIR, --image-path=DIR\n                    Path to find images. [default: ./]\n   -w, --watch           Watch file for changes.  Requires the second argument\n                    (output css filename).\n```\nObviously if i give something from stdin or if I use --stdin arg, it fails. Why do ./bin/sassc doesn't give the same options as I can see there ?  https://github.com/sass/sassc/blob/master/sassc.c \nThanks in advance \n. Sure, thanks for your response.\nhttps://github.com/sass/sassc/issues/76\n. ",
    "bitc": "Sorry, my bad. I was playing around with the libsass source code and must have messed something up. After doing a clean build everything works fine. I'll close this issue.\n. As a workaround you can use unquote:\n@mixin opacity($opacity) {\n  opacity: $opacity;\n  filter: unquote(\"alpha(opacity=#{$opacity * 100})\");\n}\n. Column numbers are optional. libsass and the original sass currently don't output column numbers (which in my opinion is fine; just having the line number is almost always enough to be able to find the error).\nSo an example error message is something like:\ntmp.scss:16: error: error reading values after blue\nwhich most editors can immediately recognize. Note that the current libsass is already very close to this. This pull request just slightly changes it to make it fully compatible.\n. Sorry, you are correct. This seems to be fixed in latest master.\n. ",
    "gregtillbrook": "Hi again, sorry for slow reply, I was away the past few days. \nI don't believe grunt-sass or node-sass use threads, they're both just very thin javascript wrappers around libsass. Ive not compiled LibSass either, all Im doing is using grunt-sass in my automated grunt build, this then includes node-sass which wraps a built libsass I believe (I'll double check that - havent poked around inside them too much yet).\nHere's a new trace using 'thread apply all backtrace'.\n\nThread 3 (process 6593):\n0  0x00007fff8aa99ce2 in __pthread_kill ()\n1  0x00007fff859787d2 in pthread_kill ()\n2  0x00007fff85969a7a in abort ()\n3  0x00007fff83fa77bc in abort_message ()\n4  0x00007fff83fa4fcf in default_terminate ()\n5  0x00007fff8539a1cd in _objc_terminate ()\n6  0x00007fff83fa5001 in safe_handler_caller ()\n7  0x00007fff83fa505c in std::terminate ()\n8  0x00007fff83fa6152 in __cxa_throw ()\n9  0x00007fff87962255 in std::__throw_length_error ()\n10 0x00007fff8798884e in std::string::_Rep::_S_create ()\n11 0x00007fff8798a2fa in std::string::_S_construct ()\n12 0x00007fff8798a4a8 in std::basic_string, std::allocator >::basic_string ()\n13 0x0000000100f690f8 in Sass::Token::to_string () at :68\n14 0x0000000100f690f8 in Sass::Node::to_string (this=0x7fff85992711, inside_of=Sass::Node::none) at ../libsass/node_emitters.cpp:68\n15 0x0000000100f6c5d1 in std::string::data () at ../libsass/node_emitters.cpp:390\n16 0x0000000100f6c5d1 in std::string::_M_data () at /usr/include/c++/4.2.1/bits/basic_string.h:2413\n17 0x0000000100f6c5d1 in std::operator<< , std::allocator > () at /usr/include/c++/4.2.1/bits/basic_string.h:1542\n18 0x0000000100f6c5d1 in Sass::Node::emit_nested_css (this=0x100a5c088, buf=@0x100ff7708, depth=1, at_toplevel=false, in_media_query=true) at ../libsass/node_emitters.cpp:390\n19 0x0000000100f6ca13 in std::operator<< std::char_traits () at /usr/include/c++/4.2.1/ostream:427\n20 0x0000000100f6ca13 in Sass::Node::emit_nested_css (this=0x10101d528, buf=@0x100ff7708, depth=, at_toplevel=, in_media_query=false) at ../libsass/node_emitters.cpp:428\n21 0x0000000100f6c4df in Sass::Node::emit_nested_css (this=0x100ff7c58, buf=@0x100ff7708, depth=0, at_toplevel=true, in_media_query=false) at ../libsass/node_emitters.cpp:379\n22 0x0000000100f46787 in std::basic_stringstream, std::allocator >::str () at /usr/include/c++/4.2.1/sstream:133\n23 0x0000000100f46787 in Sass::Document::emit_css (this=, style=) at ../libsass/document.cpp:141\n24 0x0000000100f70581 in std::string::_M_rep () at ../libsass/sass_interface.cpp:51\n25 0x0000000100f70581 in std::string::_M_data () at /usr/include/c++/4.2.1/bits/basic_string.h:605\n26 0x0000000100f70581 in std::string::size () at /usr/include/c++/4.2.1/bits/basic_string.h:287\n27 0x0000000100f70581 in process_document (doc=@0x100ff7c20, style=0) at ../libsass/sass_interface.cpp:52\n28 0x0000000100f70157 in sass_compile (c_ctx=0x100e00530) at ../libsass/sass_interface.cpp:65\n29 0x00000001000462a8 in etp_proc ()\n30 0x00007fff859768bf in _pthread_start ()\n31 0x00007fff85979b75 in thread_start ()\nThread 2 (process 6593):\n0  0x00007fff8aa986b6 in semaphore_wait_trap ()\n1  0x000000010027484a in v8::internal::RuntimeProfiler::WaitForSomeIsolateToEnterJS ()\n2  0x000000010027495a in v8::internal::RuntimeProfilerRateLimiter::SuspendIfNecessary ()\n3  0x00000001002fb9bd in v8::internal::SamplerThread::Run ()\n4  0x00000001002fb384 in v8::internal::ThreadEntry ()\n5  0x00007fff859768bf in _pthread_start ()\n6  0x00007fff85979b75 in thread_start ()\nThread 1 (process 6593):\n0  0x00007fff8aa9a7e6 in kevent ()\n1  0x000000010004c2a9 in kqueue_poll ()\n2  0x0000000100043828 in uv__run ()\n3  0x0000000100043763 in uv_run ()\n4  0x00000001000090c3 in node::Start ()\n5  0x0000000100001144 in start ()\n. I cant provide the exact same sass as technically my client owns it and its not mine to share. I'll make a generic sample that reproduces the same problem (bare with me though as this week is looking like a busy one..)\n\nHow would like me to send it to you? Email or just paste it here?\n. Sorry about the lack of response. I did at the time try to create a simplified case but without success. Since then Ive moved project and then job so this issue is no longer affecting me - so i'll close this issue.\nThanks a lot for all your help!\n. Good to know as a workaround - thanks!\n. btw, many of my issue examples have come from sass-twitter-bootstrap, (the scss port of sass from bootstrap). Well worth a look if you've not seen it already.\n. ",
    "fspillner": "Awesome! Thank you!\n. ",
    "EmilStenstrom": "Very annoying bug, I'm guessing that everyone that tries to use libsass stumbles over this one.\n. I stumbled on this too. Very time consuming to have to go thorugh all the .scss files and fix them manually.\n. ",
    "jeffpatzer": "@akhleung Blocks being able to easily use libraries like Bootstrap. Its a massive pain in the rear to have to go and try to add unquote everytime I want to use a library that potentially has it. \n. Good to know its opened. However, I don't want to have to unquote everything. I'll close at its a duplicate.\n. Same as #78 should still be fixed because of being able to drop in libraries. \n. ",
    "hrbonz": "Any progress/ETA here?\n. ",
    "web36m": "Example: https://github.com/jlong/sass-twitter-bootstrap/blob/master/lib/\nerror reading values after opacity:\n_mixins.scss#L383\nerror reading values after progid:\n_mixins.scss#L419\n_mixins.scss#L429\n_mixins.scss#L447\n_mixins.scss#L458\n_mixins.scss#L479\n_mixins.scss#L522\nerror reading values after auto:\n_reset.scss#L82\nerror reading values after dotted:\n_forms.scss#L129\nerror reading values after 1px:\n_forms.scss#L139\n_forms.scss#L544\n_forms.scss#L546\n. I'm sorry. Really, I used the old version.\n. ",
    "LaurentGoderre": ":+1: \n. @jpdevries I have the same problem\n. @kennethormandy I did take a look at all of those related to extend. @jpdevries code ressembles most the one we are trying to achieve.\nI would really love to help out on this since we need it but I'm afraid my C/C++ is rather weak\n. @andrew, can we keep this on the radar to implement in node-sass when it lands?\n. :+1: was about to suggest the same\n. Hmmm, I was wondering why the CI build failed but then again all of the previous build failed as well. Not very helpfull\n. Hmm, it seems to me like some of the build failure are compiling errors\n. :+1:\n. It appears this fix is incomplete and it still fails on Heroku. This fix probably need to be applied to this file as well\nhttps://github.com/sass/libsass/blob/483124834a75b1ad269e2555272ab96ad3296706/functions.cpp\n. So I have been told. Maybe it wouldn't be a bad idea to have it just in case but I leave it up to you\n. /cc @nschonni !!\n. ",
    "nex3": "I'm not opposed to supporting this. It's worth noting that it's more complicated than just a format change:\n\nCalculate column numbers assuming that space and all ASCII printing characters have equal width, and assuming tab stops every 8 columns. For non-ASCII characters, Unicode character widths should be used when in a UTF-8 locale.\n. For SCSS, Sass does know the line number, it just doesn't provide it numerically.\n. The reference implementation of Sass doesn't and will not support globbing, for the reasons @bdkjones outlined. It makes the order that rules are emitted very difficult to reason about and contingent on non-local factors. There does exist a Ruby plugin for it, but I personally discourage its use.\n. @mgreter An alphabetic sort would mean that renaming a file could affect the styling of your site in subtle and difficult-to-track ways. This is just the sort of non-local effect that we don't want.\n. Why not use the Ruby Sass parse tree?\n. @lunelson I'm not sure I understand the behavior you're discussing.\n\n@mgreter can you file an issue for that?\n. When you write #{$foo} anywhere, the normal conversion of $foo to a CSS string takes place with the caveat that if $foo or anything recursively contained in $foo is a string, its quotes are removed and any newlines are folded into spaces.\n. libsass doesn't add features that the reference implementation doesn't have. We do want this in the language at some point, but it shouldn't go into libsass first.\n. Sass parses strings according to the CSS spec, including resolving escape sequences. It doesn't keep around the original representation of strings, so when emitting them back to CSS it makes decisions about whether to emit an escape or a literal character independent of the original format. In general it tries to emit the literal character except in cases where that would break parsing, like newlines or quotes. This behavior sometimes weirds people out, but I haven't seen any evidence that it causes problems for browsers.\nThe reason this varies based on interpolation has to do with an unrelated optimization in Ruby Sass. Most properties in a stylesheet, even one using Sass, are static; they don't involve any variables or other special SassScript stuff. When Sass detects a property that it can prove is static, it doesn't even parse it; it just stores its original value as a string and emits that to the stylesheet. This means that artifacts that would usually be removed in the parse-and-emit process can remain if nothing dynamic is going on. Libsass shouldn't feel obligated to duplicate this behavior; as long as the output is semantically identical, it's fine.\n. It would be nice to have a way to verify semantic equivalence without byte-for-byte comparisons :-/.\n. I just came across this as part of fixing https://github.com/sass/dart-sass/issues/537. LibSass's behavior here is incorrect, and Dart Sass is going to start implementing this correctly once https://github.com/sass/dart-sass/pull/539 lands. I'm going to re-open this so I have an issue to link to in the options.yml file.\nFYI, if stuff like this comes up again where the reference implementation's behavior is clearly wrong, please do file an issue against http://github.com/sass/sass! We could have fixed this three years ago!. This was, more or less, intentional. It's an artifact of the long-ago move from explicitly invoking SassScript (e.g. color= $color) to having it always implicitly active (e.g. color: $color). Before that move, many people used interpolation as the primary way to insert variables into properties. That was purely textual interpolation, though, like for selectors, which meant that putting it near any arbitrary text was valid. In order to preserve backwards-compatibility with this as much as possible when switching to always-on SassScript, we did everything we could to make free interpolation in weird situations just work like string interpolation.\nI agree that this is a gross status quo, though. This is why I filed sass/sass#1778 to track the removal of this bizarre behavior. It'll be gone in 4.0.\n. Writing a full specification is a huge amount of effort. It's something I'd like to do at some point in the future, but currently design and implementation take up all my available time.\n. I'm pretty sure the new behavior here is incorrect\u2014according to the spec, ID names may only be identifiers.\n. This is no longer the intended behavior; see sass/sass#2120.. > I suggest the relevant specs are updated to match the expected behaviour and ruby-sass todo'd.\nDone in sass/sass-spec@b92a53b19a5ac029f24cb156765fa9c6b1be00d6.. > I suggest the relevant specs are updated to match the expected behaviour and ruby-sass todo'd.\nDone in sass/sass-spec@b92a53b19a5ac029f24cb156765fa9c6b1be00d6.. It depends if you're using the 3.X interpolation parsing scheme or the 4.0 scheme. Under 3.X, $prefix#{\"-\"}#{suffix} converts $prefix to a string (in this case, the unquoted string containing two double quote characters) and concatenates it with the string -bar. Under 4.0, the fact that the $prefix variable is next to #{\"-\"}#{$suffix} doesn't matter, so it's instead parsed as a list containing two values: an empty quoted string and the unquoted string -bar.\nDon't forget I wrote up a whole thing about interpolation parsing in https://github.com/sass/sass/issues/1778.. > a lot of the Sass code was written when @nex3 and I were quite naive regarding the official CSS spec.\nIn defense of our past selves, the spec has also changed its terminology to be clearer and more consistent over time. \n. It just hasn't been a high priority to fix\u2014as far as I know, it hasn't come up in any real code. -5%/2 is the correct output, so that's what libsass should target.. So the logic here is that we parse a media query expression as \"(\" expression [ \":\" expression ]? \")\" and then basically just shove that into an interpolation. After parsing, as far as the later stages know, this was written with explicit #{}-based interpolation, which means any quotes need to be removed. Hence this behavior.\nI'm not super happy with it\u2014in general I don't like that certain types of at-rules are more generous with where SassScript is allowed than others\u2014but it is more or less intended.\n. This just isn't a use-case we've considered\u2014Ruby Sass is falling back on the default behavior of allowing everything in @media that's allowed at the top-level. We should probably just error out.. I guess the error message would be something like \"@ import is not allowed within @ media\"?. Yes, all @import statements in @media queries should be disallowed, at least for now. You can feel free to disallow them in LibSass only for now; since they produce invalid CSS anyway, there's more flexibility for cross-implementation differences.. Intentional, sorry! I thought this was ready since its specs were passing.. @mgreter The spec changes in https://github.com/sass/sass-spec/commit/4e9edaa84609f882ca4352b1c5d5afe10be50ac6 should encompass these changes.. The indented syntax doesn't support multiline properties. You'll have to write\nsass\nbody\n    padding: 10px\n    display: grid\n    grid-template-columns: repeat(3 1fr)\n    grid-template-rows: repeat(3 1fr)\n    grid-template-areas: header header header section section section footer footer footer\nIt's not great, but it's the best I can offer right now.. This is complicated. I can say for sure that Dart Sass is wrong: @media A {@media B { ... }} should match media for which both A and B are true, and if A = not print, not print and B matches media where A is true and B is false. That's why Ruby Sass produces no output: because there wasn't any way to create a query that means the right thing.\nHowever, the most recent media query spec is more flexible in the syntax it supports for queries. It allows @media (not print) and (min-width: 600px), which does express the correct semantics. But I'm not sure how broad the browser support for this syntax is, or how stable it's going to be going forward, both of which determine whether it's safe to target. Perhaps @tabatkins can provide insight?. I talked to @tabatkins, who says\n\nsyntax is stable, but currently unsupported.\n(so as usual, take \"stable\" with a grain of salt until webcompat actually freezes it in, but I don't expect any changes and it's been the same for a while)\n\nI think we should follow Ruby Sass's behavior here and just emit nothing until some browser actually supports more advanced queries.. Looking closer at the spec, it looks like it's irrelevant for this specific case anyway\u2014(not print) and (min-width: 600px) isn't actually valid, since the <media-type> production can only appear at the top level of the parse tree.. ...although I suppose not print and not (min-width: 600px) would work.. @xzyfer The Dart/Ruby output is intended. The issue isn't that @supports ($prop: $val) doesn't work (it does); the issue is that the $prop: $val; in the body is a variable assignment, not a property declaration. If you wrote instead\n```scss\n$prop: display;\n$val: flow-root;\ndiv {\n  @supports ($prop: $val) {\n    #{$prop}: $val;\n  }\n}\n```\nRuby and Dart Sass will both produce\ncss\n@supports (display: flow-root) {\n  div {\n    display: flow-root;\n  }\n}. Ruby and Dart Sass model filesystem imports using importers as well. We treat the import paths option as a shorthand for constructing a filesystem importer for each path. If a user wants total control over how all imports are resolved, they can avoid passing in any import paths and use only custom importers.. > could you elaborate what \"import paths\" means? Is this the same as \"include paths\"? \nYes, Node Sass's includePaths option refers to the same thing.\n\nWhat I was aiming for is i.e. custom pre-processing of a file that is indeed found as a real file within the \"include paths\". If the file-importer takes precedence you have no chance to alter that file with custom importers?\n\nIn Ruby and Dart Sass, import paths are just a special case of importers. If a user wants full control over how all @imports are resolved, they can just avoid passing in include paths at all and leave all resolution\u2014including finding files on the filesystem\u2014up to their custom importer. But this is an edge case. In most cases, authors need to be confident that their relative imports won't get clobbered by some downstream importer, especially since importer authors may not be diligent about ensuring that all their imports are well-namespaced.. @just-boris I suggest having some way of explicitly indicating in the import string that your imports are meant to be overridable. For example, you could have @import \"theme:button\" know to look for button.custom.scss if the custom theme is being used, and button.scss otherwise. This is also more user-friendly, because it's clear to the reader that something other than normal import semantics are being used.. > Is there an official announcement that it is already the new reference implementation?\nNo, since the notion of a \"reference implementation\" isn't super relevant to most users. I will say that Dart Sass is generally more in line with our goals for the eventual behavior of Sass, though, since it makes some backwards-incompatible changes relative to Ruby Sass (see the README for details).\n\n```scss\n:not(.foo2):not(:not(.ext2)) {\n  color: red;\n}\nfoo {\n  :not(.foo2):not(:not(.ext2)) {\n    color: red;\n  }\n}\n```\n```css\nsass test.scss\n:not(.foo2):not(:not(.ext2)) {\n  color: red; }\nfoo :not(.foo2) {\n  color: red; }\nsassc test.scss\n:not(.foo2):not(:not(.ext2)) {\n  color: red; }\nfoo :not(.foo2) {\n  color: red; }\ndart-sass.bat test.scss\n:not(.foo2):not(:not(.ext2)) {\n  color: red;\n}\nfoo :not(.foo2):not(:not(.ext2)) {\n  color: red;\n}\n```\n\nDart Sass is correct here. We shouldn't be simplifying user-authored styles, especially outside of the presence of @extend.\n\nAnother one:\nscss\n:not(:not(.baz1)) {\n  left: 0;\n}\n:not(.foo) {\n  @extend .baz1;\n}\n```scss\nsass test.scss\n:not(:not(.baz1)) {\n  left: 0; }\nsassc test.scss\n:not(:not(.baz1)) {\n  left: 0; }\ndart-sass.bat test.scss\nUnexpected exception:\nInvalid argument(s): components may not be empty.\n```\n\nI've filed https://github.com/sass/dart-sass/issues/191 to track this.\nIt's worth noting in general that our approach here should probably change soon, since :not() now allows full selector lists and Safari already implements that.. This is a duplicate of https://github.com/sass/sass/issues/2378. The issue here isn't really env(), it's that CSS introduced max() and min() functions that work very differently than the existing Sass functions with the same names.. Don't forget to remove the TODOs from the corresponding specs!. It's worth noting that these are aesthetic rather than semantic concerns, so if you feel like your output is better you're allowed to leave it as-is. But it's probably better to align the implementations where possible.. For loud comments that come from SCSS, the relative indentation of each line of the comment should be preserved. In your examples in https://github.com/sass/libsass/issues/2566#issuecomment-373906449, the subsequent lines of the comment are indented seven, four, two, and zero levels deeper than the opening line, and that relative depth is preserved in the output when the entire comment is re-indented so that the shallowest line appears at the current indentation level.\nIn cases like https://github.com/sass/libsass/issues/2566#issuecomment-373906863, where the first line is deeper than the subsequent lines, it looks like neither Ruby nor Dart Sass handle that ideally. I'd expect this output:\ncss\ndiv a {\n     /*************\n  * a\n  * multiline\n  * comment\n  */\n  top: 10px; }\nwhich preserves the relative indentation and places the shallowest line at the current indentation level. But I think these types of comments are unlikely to appear in practice, so I wouldn't sweat their formatting too much.. As much as possible, implementations should follow the CSS spec for determining the encoding. However, implementations aren't expected to support every ASCII-compatible encoding under the sun; the only hard and fast requirement is that UTF-8 is used when the spec says it should be used as a fallback encoding.\nWhen it comes to determining the default encoding, the spec's guidance is specific to HTML, so it's kind of up to the implementation to determine a reasonable option. Ruby Sass used Ruby's notion of the system encoding; Dart Sass just uses UTF-8.. I'd say it's valid for an implementation to only support UTF-8 input, although if possible it's encouraged for them to support more.\n\nBtw. ASCII compatible IMO means char codes < 127, everything between 127 and 255 is already a specific single byte encoding table (which could be mapped perfectly to Unicode char codes though).\n\nWhat I meant by \"ASCII-compatible\" above is \"an encoding where bytes <127 have the same meaning as they do in ASCII\".. Implementations are always free to define their own error messages.. I'd like to at least add a warning for this as soon as possible. Dart Sass will not be implementing this behavior, so I'd like to strongly warn people away from it.. I'm not sure what you mean by \"an empty set\", but any interpolation that would cause the value of the custom property to be empty should be an error.. Heads up: the spec for this is changing slightly. Follow https://github.com/sass/sass/issues/2590 for updates.. No, I think this can be left up to the host language's API.. @nschonni The answer to that question is multi-layered! Strap in!\nHow an implementation chooses to serialize its final AST to CSS is up to that implementation, as long as the CSS is semantically identical to the specified CSS. As far as CSS is concerned, 3.0px and 3px are the same value, so implementations are free to switch between them as they choose.\nRuby Sass does this too! For example, Ruby Sass will compile a { b: (3.0px); } to a { b: 3px; }. However, Ruby Sass has special logic for \"static\" property values that look like they don't include any SassScript. As a mitigation for Ruby Sass's incredible lack of speed, it avoids fully parsing or interpreting static values and instead passes them on as-is to the CSS output. So if you don't include parentheses, Ruby Sass won't change the input at all and you'll get 3.0px.\nDart Sass, on the other hand, is much faster than Ruby Sass and as a consequence has no special handling for static property values. It fully parses every value and converts it to CSS using its normal logic, which means that its numbers always have trailing zeroes trimmed.\nSo it's not a bug, but it's not exactly a feature either. I guess I'd call it a \"non-semantic implementation difference\".. This is expected; the + operation by default converts its arguments to strings and concatenates them. Whether it should be so permissive is an open question, but even if not I don't think it's worth breaking backwards-compatibility to fix.. @zyingp Sass functions more like a programming language interpreter than a compiler, in the sense that it directly runs users' programs rather than compiling them to an intermediate format before running them. A more direct comparison would be to what a C, C++, or Java program would do if you ran a loop that continually allocated more and more memory. For C and C++, it would certainly crash in the same way LibSass is doing here. Java is more sophisticated about its memory management and would probably throw a more graceful error once its memory ceiling was reached, but it would still produce an error of some kind.. @glebm Dart Sass is correct here. As of https://github.com/sass/sass/issues/2250, the expected behavior for an @extend that matches a target selector but fails to create a new selector is to raise no error. Ruby Sass is in error here... can you file an issue against it?\nI believe x {@extend x} is a sufficient reproduction here.. @mgreter does #2790 also fix the 10000/3 issue?. There are existing specs, they're marked with links to this issue.. Alternately, you can run git grep 'sass/libsass#2788' to find all the options.yml files I annotated with this issue number.. I think $string there is just the parameter name. This line indicates that it converts other values to strings, rather than rejecting them:\n https://github.com/sass/libsass/blob/4f9f66262d0ec7b3993907f9363d5cc6ebba8e05/src/fn_strings.cpp#L71. Yeah, exactly.. Spec added in https://github.com/sass/sass-spec/pull/1343. It seems that, no matter the precision setting, LibSass will always truncate decimals so that there are at most 12 total number of digits in the number (including digits before the decimal point). For example, 123456789.123456789 is emitted as 123456789.123.. I'm adding a spec for this in https://github.com/sass/sass-spec/pull/1345.. The only operator that can behave differently depending on whitespace is -. 1fr/ repeat(2, 1fr) is valid.. Upon consideration, it's possible that CSS will decide to use this syntax natively, so we should probably preserve the slash here. LibSass's behavior is correct, but the documentation needs to be updated.. I've filed https://github.com/sass/sass-spec/issues/1358 to add specs. That said, I think edge cases like this are much lower priority right now than starting work on the module system. Did you get my email about that?. https://github.com/sass/sass-spec/pull/1360 adds specs for this.. ",
    "ronnix": "Did not realize that some parts of Compass depended on custom ruby extensions. I guess this means I cannot use libsass if I want to use Compass? Or do you know if the Compass people plan to make it more portable?\n. Thanks for the explanation!\n. ",
    "gdotdesign": "Hey, any progress on this?\n. ",
    "dennisjlee": "+1 on this, would be great if this could be fixed to match the Ruby implementation\n. ",
    "dberkson": "+1, would love to use this but extended classes are a requirement for my current project.\n. ",
    "jina": "Bummer. Just ran into this, too.\n. ",
    "kaelig": "I use bourbon as well (and thought I would be able to use libsass to compile the project), but unfortunately it chokes on this piece of code:\nscss\n@mixin box-shadow ($shadows...) {\n    @include prefixer(box-shadow, $shadows, webkit spec);\n}\nERROR -- views/legacy/utils/../../vendor/bourbon/css3/_box-shadow.scss:1: parameter list for box-shadow requires a ')'\nCf #73 \n. For sprite generation you can use grunticon: https://github.com/filamentgroup/grunticon\n. @mikew, I confused grunticon with being a sprite generator because at the Guardian we use a modified version of it that generates a sprite image fallback: https://github.com/guardian/frontend/tree/master/tools/sprites\n. Thanks, no more comments appear now :)\n. Maybe this will help: http://sassmeister.com/gist/3e30a4ee6cab083648c9\nscss\n$colors: (\n    \"transparent\": transparent,\n    transparent: transparent\n);\nThrows \"Duplicate key \"transparent\" in map (\"transparent\": transparent). on line 3 at column 27\" using LibSass but not in Sass.\n. I wouldn't recommend to do this but there is a workaround:\n``` scss\n$map: (\n  'transparent': foo,\n  rgba(0, 0, 0, 0): foo\n);\n// Both work in Ruby Sass and LibSass\n$foo: map-get($map, transparent);\n$foo: map-get($map, 'transparent');\n``\n. Interesting. We managed to compile our codebase successfully since that partial fix, so for us it's all good.\n. If a workaround exists I'd be interested to know about it.\n. Thanks Hugo, although LibSass renders the actual unicode char (content: \uf102;`). Is that what is supposed to happen? Does it work everywhere?\n. ",
    "sroussey": "Something like a libcompass to go with libsass would be awesome.\n. Awesome! I am working on theme generation for various frameworks that use Sass+Compass, and would love to do it client side (if I can get them as NaCL for Chrome for example), rather than have my poor server churn on stuff for 100,000 users with the browser extension. :/ \n. ",
    "kud": "Nothing interesting but I'd really love to see compass support too. ;) :+1: \n(or finding a way to generate sprite without compass...?)\n. Yeah I know, I already have a good process for svg to sprite but on desktop version, we still have a sprite coming from some png... :/\nEither I still continue to use compass either I have to do a refacto on all our icons. The second one should/could be the solution but it ain't the right time.\n. ",
    "lessallan": "@hcatlin, my love, let's make this happen. I'm wanting to use http://usetakana.com + compass on our projects.\n. ",
    "Aurontwist": "+1\n. ",
    "mikew": "@kaelig Maybe I'm missing something in grunticon, but right in the first paragraph of their README it states\n\nFrom a CSS perspective, it's easy to use, as it generates a class referencing each icon, and doesn't use CSS sprites.\n\nAlso their lack of generated dimensions makes it a no-go for me. Something like sprite-brunch might help some people though.\n. ",
    "miki-soichiro": "+1\n. ",
    "clifton": ":+1: \n. ",
    "javoire": "+1\n. ",
    "RobinQu": "Is it possible to rewrite compass using node with node-scss, which is a binding of libscss?\n. I came across some code of compass project, and found that it's pretty hard to implement the whole compass using node-scss: \n1. Custom functions like inline-image have to be written in C/C++\n2. Custom functions have to be registered with SCSS context. That means, if you are going to implement function in nodejs, you have to figure out how to teach C/C++ code to talk with javascript (Type conversion, scope) . I know this is possible with v8 and node binding API, but it's difficult. And I don't know why we should make such efforts to do so.\nDespite the clues given above, there might be other options:\n1. make void register_function(Context&, Signature sig, Native_Function f, Env* env); to support V8 JS function in node-scss.\n2. Write a scss compiler in purely Javascript. (EST. one weak at least). As a result, the whole compass stack could be rewritten in Javascript, quick and clean.\n. ",
    "F21": ":+1: This would be awesome for us as we are finding the ruby scss with compass to be quite slow for some of our larger projects.\n. @frederikbosch I believe that's a copy of the scss mixins from compass (ruby stuff removed) so that you can use libsass.\n. No it doesn't, because compass has a lot of ruby bits (for example spriting, etc), which can't be used with libsass at the moment.\n. Yes, that's right.\n. ",
    "zachlatta": ":+1: Would also be appreciated. I will <3 everyone here if this happens.\n. ",
    "andrejmlinarevic": "+1 For the idea. Would be a great performance enhancement and workflow speedup. \n. ",
    "gisu": "I think it makes more sense to bring Libsass on the same level off ruby-sass (Maps, List Improvements, root selectors etc), and than find a way to implement Compass Features in Libsass. The only thing that i miss from Compass is the Image Handling - but i have a grunt task for. Sprite Generation is nice but for me is not super important - we have several Grunt Tasks to build Sprites (with SVG support - compass didn't have SVG Sprites).\nThe most important is to hold the Compiletime - is the best thing off Libsass )\n. It works on Sassmeister in the URL must be a string.\n``` scss\n$one: 'haha';\n$two: 'blibb';\n.works {\n  background: url('#{$one}-#{$two}.png'); // Works because is a string\n}\n.works-not {\n  background: url(#{$one}-#{$two}.png); // Doesn't work\n}\n```\nResult: \n``` css\n.works {\n  background: url('haha-blibb.png'); }\n.works-not {\n  background: url(#{$one}-#{$two}.png); }\n```\n. Its not a real problem to fork an existing framework and make modifications to make it compatible with Libsass. Thats developers life - find creative solutions for existing problems :)\nBut a more detailed feedback from the compiler would be a big helper.\nI am only sad that i don't have no skills for c/c++ so i can't help.\n. Is a feature from Ruby-Sass 3.3. Will not work with Libsass at this time.\n. ",
    "MueR": "I just tried libsass (I was using ScssPhp) and wow. It's blinding fast. The only thing I had to fix to get compass working (so far) is this function, which I have to include before I can use compass:\nsass\n@function -compass-list-size($list) {\n    $compassListSize: 0;\n    @each $i in $list {\n        $compassListSize: $compassListSize + 1;\n    }\n    @return $compassListSize;\n}\n. You will want to pass the paths to your compass and breakpoint directories via the -I (as in Isaac) parameter, and separate multiple paths with a colon (:)\n/path/to/sassc -I /path/to/compass:/path/to/breakpoint myfile.scss\n. I personally do it in the class that handles SCSS files within our framework, by calling the compiler directly via proc_open (in PHP). But regardless, this would be something better suited on a site like StackOverflow rather than in this issue.\n. There is no way to achieve this then, other than adding an extra block of code outside the .cmfWindowContent ?\n. ",
    "ConneXNL": "I used bower to add this repo https://github.com/Igosuki/compass-mixins which contains the compass mixins to libsass (via grunt-sass). I came across the same problem as MueR were the a function like -compass-list-size was not working. This and some other functions seem to come from ruby code instead of pure scss.\nThey can be found here https://github.com/chriseppstein/compass/blob/stable/lib/compass/sass_extensions/functions/lists.rb file.\nI'm afraid there might be more functions that are used by regular mixins. The fact that libsass doesn't throw erros doesn't mean its doing what its supposed to do.\n. ",
    "polikin": "+1 libcompass\n. Thanks!\n. ",
    "amcc": "For the newbie can someone tell me how to get compass working with libsass using possibly the bower https://github.com/Igosuki/compass-mixins method above.\nI have an existing project that uses compass and breakpoint - i'd love to be able to get it to work with libsass, but dont know how to tell libsass where the compass-mixins or breakpoint directory is (i've also downloaded the breakpoint package)\n. thanks for the help - is that something i do in the gruntfile, or elsewhere. Is there some documentation on that. \n. great gives me something to go on - thanks again\n. using grunt-sass with compass-mixins as a Bower package worked well for me. See this how to, then look at comment #27 on this page:\nhttp://benfrain.com/lightning-fast-sass-compiling-with-libsass-node-sass-and-grunt-sass/\nSeems to work fine as far as i can tell\n. ",
    "rey": "+1\n. ",
    "JoshuaSoileau": "+1 for libcompass\n. ",
    "pheadeaux": "+1\n. ",
    "Maidomax": ":+1: \n. ",
    "laurentperroteau": "+1\n. ",
    "jimmyjamieson": "I've got the same thing as compass-mixins that I'm using https://github.com/jimmyjamieson/compass-libsass. I'm trying to write a framework for myself but based on everything running off libsass. It's just getting my head around susy-next now.\n. Yeah, it's the mixins. Not everything. I've reverted to susyone for the grid also until libsass can catch up with the features of susynext.\n. Compiling of ms now instead of the 30 secs with ruby, or even longer over a network.\n. Would this not be the correct format?\n.box {\n    & em { text-decoration: underline; }\n}\n. ",
    "frederikbosch": "Jimmy, could you tell me what that repository does?\n. But then that fixes this issue?\n. AH, I get it. So, it only fixes the mixins?\n. ",
    "jsg2021": "+1\n. ",
    "lamosty": "this would be really helpful. Can't work without compass\n. ",
    "frewsxcv": "@chriseppstein Do you need any help with making Compass compatible with libsass?\n. ",
    "ronilaukkarinen": "I also would like to libsass (to go with gulp) to support Sass 3.3 and preferably Compass. Would make my life so much easier. Because of so many caveats using with libsass only I'm now using gulp-ruby-sass.\n. +1 getting error: expected 'in' keyword in @each directive when using gulp-sass.\n. ",
    "twhitbeck": "@chriseppstein am I right in thinking the latest version of libsass (3.0) which targets Sass 3.4 should be sufficient for making Compass compatible?\n. ",
    "stffndtz": "+1\n. ",
    "ChrissiQ": "How's this doing?  I'd be very excited to use libsass with compass.  Compile times with ruby are killing me on Windows.\n. I was not able to run with libsass directly.  But I found out through other means what the problem was.\nFor anyone coming here for future reference:\nError: Attempted a typeid of NULL pointer! seemed to occur when a variable has not yet been defined and tries to reference itself.  i.e.\n$font-family-sans-serif: \"Open Sans\", #{$font-family-sans-serif};\nThis code compiled in ruby sass because $font-family-sans-serif was previously defined, but did not compile in libsass because of modifications I had to make to get libsass to work, ended up removing the code that had previously defined $font-family-sans-serif for me.  So when I tried to reference it, it was null.\nThe error message was decidedly unhelpful without a line number, but with a line number, it would have made some sense.  :)\n. +1\n. I will try and see if I can use sassmeister, but it's a large project with 70+ files not including bower components for several libraries, and it's going to be hard to extract what might be causing the issue.  I can't possibly put the entire thing in.  Sassmeister sounds like a great idea, but it isn't practical to try to replicate large projects with it... it would be great if I were able to identify the error and isolate it better, but I can't currently.\nDo you know why grunt-sass is using an old version?  Should I be trying to get them to upgrade instead?\n. Ah, a problem with dependency chains.  :)\nNot much to do here but wait I guess.  Thanks.\nBy the way, the code that causes it seems to be along these lines:\n``` scss\n$font-size: 1rem;\n$big: pow(2,2);\n$big-font-size: $font-size * $big;\n.big {\n  font-size: $big-font-size;\n}\n```\nI'm not sure if this type of error is already known.  It works fine in ruby sass but does not compile in libsass. I also checked it in sassmeister - does not work for libsass, but works for ruby. Is a workaround known to be able to multiply a unit by a power?\n. Does sassmeister use compass by default?  The code works as written, without including compass, on sassmeister.\n. Ah, that makes sense and resolves everything!  Thank you so much.\n. ",
    "tommmyy": "+1\n. ",
    "sheadawson": "+1\n. ",
    "bcallaars": "+1\n. ",
    "JingleChannel": "+1\n. ",
    "mikeya": "+1\n. ",
    "Zauberfisch": "wow, that looks really interesting as a temporarily solution until compass has been ported over.\nthanks for sharing @drewwells \n. I have posted my implementation as a workaround on the issue that @kjbbb mentioned. \nI do not know the full extend/functionality of the original compact method, but for my purposes the compact method in pure sass seems to be sufficient: https://github.com/Igosuki/compass-mixins/issues/34#issuecomment-77728576\n. ",
    "jeromecovington": "+1 for this issue in general. But in the specific, I am looking for drop in replacements for these:\n@import \"compass/css3\";\n@import \"compass/css3/user-interface\";\n@import \"compass/css3/transform\";\n@import \"compass/utilities/general/clearfix\";\nDoes anybody know about compass support in general, to date? Is there support for the above?\n. ",
    "Snugug": "The official direction of the Libcompass project is a pivot from C to a Node Sass compatible core called Eyeglass\nMost of the most popular Compass extensions will likely be ported to Eyeglass. Breakpoint will be (and is available now as a Bower install). With the Node pipeline, CSS3 mixins are generally handled through Autoprefixer. There are other Clearfix mixins, like the one provided by Toolkit (likewise Bower available, will be Eyeglass available).\n. I'm in a similar position to @ericam. We could probably help by writing generic tests and with the final website?\n. Potential duplication with importing placeholder selectors (unless this behavior has changed in Sass 3.3?)\n. Now that maps are available in 3.0rc1, Eric and I can start writing tests against libsass. Unfortunately, libsass still doesn't support list-separator (although we just wrote the test for it!) so Breakpoint, which powers the responsive grids for Singularity, won't work until then.\n. This belongs in the Singularity issue queue, not the libsass one. Singularity 1.5.0 is initially certified with libsass 3.1\nhttps://github.com/at-import/Singularity/releases/tag/v1.5.0\n\nOn Feb 3, 2015, at 2:21 PM, Michael Mifsud notifications@github.com wrote:\nThe latest versions of suzy, and breakpoint currently work with Libsass 3.1 which is available in the node-sass 2.0.0-beta. This means singularity should work, but it is as yet untested.\n\u2014\nReply to this email directly or view it on GitHub.\n. Yay! I'm going to take a look at getting everything working! \nOn Oct 6, 2014, at 11:55 AM, Hampton Catlin notifications@github.com wrote:\nMerged #507.\n\u2014\nReply to this email directly or view it on GitHub.\n. It's also a 3.3 function, not a custom one, so more feature parity! \nhttp://sass-lang.com/documentation/Sass/Script/Functions.html#list_separator-instance_method\nOn Oct 6, 2014, at 11:55 AM, Hampton Catlin notifications@github.com wrote:\nMerged #507.\n\u2014\nReply to this email directly or view it on GitHub.\n. Running in to this issue too, although in a slightly different syntax: using it inside of if statements.\n\n``` scss\n$EQ-Selectors: ();\n@mixin eq-pts($states) {\n  &:before {\n    display: none;\n    content: '#{str-slice(inspect($states), 2, -2)}';\n  }\n@if not index($EQ-Selectors, &) {\n    $EQ-Selectors: append($EQ-Selectors, &) !global;\n  }\n}\n```\nIt's choking on @if not index($EQ-Selectors, &) (and if I were to guess, probably the next line too, but doesn't get that far).\n. @xzyfer Will do.\n. As a heads up, it looks like the user may be running in to the issue related to sass/sass#363 in that colors as map keys aren't strings, but colors.\n. @mgreter Great, thanks. That's exactly where it's choking, on \\\". I've got a URL Encode function I'm using and the error I'm getting happens when I'm trying to encode that bit.\n. I'm not entirely sure if I'm able to do that on pure Libsass :\\ I compile through node-sass and not entirely sure what the process is for testing Libsass updates through that.\n. @xzyfer This is actually a regression from 3.2.0-beta.2. I just ran into this issue having upgraded to 3.2.0-beta.5. I'll get you a reduced use case in a few.\n. Changing the @elseif to @else if resolves this issue, although raises other questions.\nFirst, how did Libsass come to this error message?\nSecond, the file begins with two lines of comment plus an extra return. If you take those out, the error magically appears exactly on 35:5, but with those in it appears on 38:5. Does LibSass discard leading whitespace? If so, this may (very likely) account for why the line numbers were reported wrong, and may account for some source map misalignment people are seeing with large projects (speculating on the last part though)\n. @mgreter As linked above, the example is the ms-merge function from Modular Scale. Sorry if that link wasn't clear. Here's a copy of the function:\n``` scss\n@function ms-merge($A, $B) {\n$Return: ();\n// Some empty lists get passed through\n  // so just pass the other list throguh\n  @if length($A) == 0 {\n    @return $B;\n  }\n// If lists fit next to each other, just merge them\n  // This helps performance skipping the need to check each value\n  @if nth($A, length($A)) < nth($B, 1) {\n    @return join($A, $B);\n  }\n  @if nth($B, length($B)) < nth($A, 1) {\n    @return join($B, $A);\n  }\n// Counters start at 1\n  $A-counter: 1;\n  $B-counter: 1;\n// Start looping through all numbers in array\n  @while $A-counter <= length($A) and $B-counter <= length($B) {\n// Check if the A value is smaller\n// Uses or equal to avoid duplicate numbers\n@if nth($A, $A-counter) <= nth($B, $B-counter) {\n  $Return: join($Return, nth($A, $A-counter));\n  $A-counter: $A-counter + 1;\n}\n\n// Check if the B value is smaller\n@elseif nth($A, $A-counter) > nth($B, $B-counter) {\n  $Return: join($Return, nth($B, $B-counter));\n  $B-counter: $B-counter + 1;\n}\n\n}\n```\nTrying to compile that as-is throws an error, changing the @elseif to @else if no longer throws that error.\n. And yes, I think this specific instance will probably be solved by that, but maybe keep this open to figure out why the error line and message were wrong.\n. Well maybe it should \ud83d\ude1d \nI still think this would be useful. As a side, I think I have some time this weekend to work on this again\n\nOn Apr 7, 2015, at 7:04 PM, Michael Mifsud notifications@github.com wrote:\nHey @snugug I rules out using the Libsass AST because it's significantly\ninadequate for the task of linting. For example we don't keep track of\nwhitespace at all.\nOn 8 Apr 2015 04:26, \"Sam Richard\" notifications@github.com wrote:\n\nI'm in the process of writing a Sass linter along with @xzyfer\nhttps://github.com/xzyfer (and have a few ideas about some really funky\nimporters that only will import parts of a file, say ignoring selectors or\nonly importing mixins, etc\u2026) and have found a need to have the AST for Sass\nfiles available. We've been looking at Gonzales\nhttps://github.com/tonyganch/gonzales-pe/tree/dev but realize it would\nprobably be more accurate and future-friendly if the AST was produced by\nthe same thing doing the actual compiling.\nWith this in mind, I'd like a way for Libsass to expose its AST to\ndevelopers instead of just compiling CSS files from the AST.\n(unrelated to #430 https://github.com/sass/libsass/issues/430)\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1065.\n\u2014\nReply to this email directly or view it on GitHub.\n. I don't know much about the internals of Libsass but I've just started (as I'm sure you've seen) started really digging into it. I saw that there was a mention of AST in there, so I thought this may be do-able.\n\n\nI think your second option (a proper css ast tree) would be more useful than the raw one. Something to get started is better than nothing though!\n. I happen to know quite a bit about Singularity, and I'm not entirely sure what's going on. I believe the problem is related to argument handling for dynamic call function.\nThe file in question is here, but I believe the operative lines are L35-47 and L59 where the actual call takes place.\nIf I were a guessing man, I think the problem is we're passing a map in to the arguments for a dynamic call function and that map is being converted to arguments instead of being passed as a single argument that is a map.\nHere is a working SassMeister using Ruby Sass, it'll fail when using the current beta of Libsass (and interestingly works with Libsass 3.1.0) so this should be a regression.\n. Duplicate of #1145\n. ",
    "xzyfer": "Compass will never be compatible with Libsass. Compass pokes around in the Ruby Sass internals for some things which simply isn't possible with Libsass.\nIf you're just using the css3 and/or utility mixins then you can bower install compass and use the mixins directly. Alternatively I would recommend:\n- Bourbon for convenience mixins and helpers.\n- Autoprefixer if you just need vendor prefixing.\nAs @Snugug points out, over time more and more Compass functionality will be made available in node-sass via Eyeglass which is run by the author of Compass. More information in https://github.com/Compass/compass/issues/1916#issuecomment-95646204.\n. @xtianus79 as stated above this does not belong in LibSass, but in the adaptors. For instance it has recently been added to node-sass.\n. @sebastianschnock please create a new issue with a reproduction case. Calc support has landed. \n\nI can confirm that it breaks when using calc in gradiants\n\n@sebastianschnock issue is about a specific case. I've begun investigating this which lead me to updated the spec to better address the issue at play https://github.com/sass/sass-spec/pull/189.\n. This is fixed in 3.1.\n. I'm getting a bunch of coverall emails as of late. Is there more work to be done here?\n. Is it possible for you to create a test case reproducing the issue?\nOn 1 May 2015 17:28, \"Richard Butler\" notifications@github.com wrote:\n\nLooks like it - I'm seeing this issue again on Node 0.12.2\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/157#issuecomment-98065946.\n. Is it possible for you to create a test case reproducing the issue?\nOn 1 May 2015 17:28, \"Richard Butler\" notifications@github.com wrote:\nLooks like it - I'm seeing this issue again on Node 0.12.2\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/157#issuecomment-98065946.\n. +:100: believe it or not this is a show stopper for my company\n. I've started looking into this. It's one of the few major blockers IMHO.\n. This fixed via #800 and will be in 3.2.\n. @msikma it's hard to say at the moment. You can https://github.com/sass/libsass/issues/812 to keep up to date on the 3.2 release.\n. This has been implemented in 3.1.0-beta via https://github.com/sass/libsass/pull/755\n. Firstly great work @am11 and @mgreter on all the recent sourcemaps, and cli work.\n\nI work primarily on sass language features so much of this stuff is out of my wheel house. Changes that are intended for authors of bindings and such is much more in your wheel house as such I defer to your best judgement. \nIt's certainly worth looping @hcatlin and @akhleung in on these types changes IMHO.\n. :+1: \n. Happy to help\n. @ogbaoghene Libsass 3.1.0 has full maps and @each support. Please use http://sassmeister.com/ to verify your use case works. Feel free to open specific issues if you encounter bugs.\nIf you use node-sass the 2.0.0-beta has Libsass 3.1.0.\n. FWIW Sass 3.3 has now shipped. Assigning or modifying global variables now causes a deprecation warning in Sass 3.3.\n. If I understand correctly #409 adds !global support to the parser. Meaning that libsass won't break when it encounters global.\nI don't think it implements to wider variable scoping that comes with the !global feature. \n. libsass compatibility is a hot topic internally at the moment since we've invested heavily in sass over the last 12months and build times are a big issue.\nI'm looking at building a compatibility chart akin to http://html5test.com/ backing off sass-spec. I think that would a big win for consumers to wanting to asses the viability of libsass (or other implementations in the future). I'd be happy to work with @ericam and @Snugug to build this as it will require a considerable investment in sass-spec.\n. > So I tried to build something to do this, but it turned out to be much more complicated than I expected. So what I'm thinking now is to have a pure css parser that can simply read in any sass implementation output and normalize the output back out as a string using the same pretty-printer and doing whatever simple normalization steps we feel are necessary to avoid false negatives. E.g. sorting comma-delimited selectors.\n@chriseppstein if I'm understanding correctly, this may be close to what you're after https://github.com/reworkcss/css-parse\n. I'm not sure I'm following. Please create a github gist with the source Sass file so we can test locally. Do not post the Sass file in this issue.\n. @Nevraeka please make all Sass feature requests to the Sass project.\nYou can alternative implement this function via our experimental custom function API in C/C++\nhttps://github.com/sass/libsass/wiki/API-Sass-Function\nhttps://github.com/sass/libsass/wiki/Custom-Functions-internal\nOr via eyeglass in JavaScript.\n. ~~Kind of not really @mgreter . The latest master produce the expected output~~\ncss\n@media screen and (min-width: 300px) {\n  body {\n    max-width: 80%; } }\n~~But not the correct output which is an error message.~~\n. Never mind my previous comment I was confusing this issue with https://github.com/sass/libsass/issues/317\n. The spec for this is in https://github.com/sass/sass-spec/tree/master/spec/regressions. Do you know what the folder is about @mgreter ?\n. I returned the regression specs to their appropriate folders https://github.com/sass/sass-spec/pull/246.\n. This is fixed and will be 3.2.\n. @mgreter since you've confirmed this is fixed is there an existing spec to cover this case?\n. Yep, my bad!\n. @ronilaukkarinen can you please create a sassmeister.com gist with the code that's producing that error? It does not appear to be related to the BEM syntax. It's worth updating to latest gulp-sass because I believe that error has been resolved now. \n. This appears to work in Libsass 3.0.2. Closing this for now.\n. @am11 I'm vaguely aware of what's happening there. My hunch would be that the r->selector()->path()/position() is potentially being set incorrectly by the parser. Try using r->path()/position() instead to see if the mappings still drift. \n@svnieuw it'd be great if you could do a write up on how you're debugging and verifying the correctness of sourcemaps so one the maintainers can try dealing with these issues in the future.\n. @hcatlin does your sass-spec 3.4 branch bring in all the current ruby specs, if not it be time to do another round of imports.\n. A big chunk of this is related to https://github.com/sass/libsass/issues/185.\n. Specs added https://github.com/sass/sass-spec/pull/175\n. Yep. I've started work in this today. It'll be in 3.2.\nOn 2 Jan 2015 22:28, \"wintercounter\" notifications@github.com wrote:\n\nSassMeister was using 3.1 beta for a little bit and tried it.\nTest Code:\n.outer {\n  content: 'outer';\n@at-root {\n    .inner {\n      content: 'inner';\n    }\n  }\n}\nWrong Output:\n.outer {\n  content: 'outer';\n  @at-root {\n    .inner {\n      content: 'inner'; } }\n }\nExpected:\n.outer {\n  content: 'outer';\n}.inner {\n  content: 'inner';\n}\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/353#issuecomment-68520809.\n. This is implemented on master. It'll be in 3.2.\n. This will be in the next version on Libsass.\n. Fixed via #767. Will be in Libsass 3.2.\n. According to the changelog the --precision flag was introduces in 3.1.8 and defaulted to 3. In 3.2.0 it was defaulted to 5. Custom precisions via the --precision flag is still in a thing in ruby sass master.\n. @mgreter there are reports that this change set is affecting compiling on Windows https://github.com/sass/libsass/issues/586, https://github.com/sass/node-sass/issues/487#issuecomment-60902761.\n\nI'm also see compilation warnings on clang\ncontext.cpp:66:5: warning: field 'subset_map' will be initialized after field '_skip_source_map_update' [-Wreorder]\n    subset_map              (Subset_Map<string, pair<Complex_Selector*, Compound_Selector*> >()),\n    ^\n1 warning generated.\nCould you please look into this issue?\n/cc @am11 \n. Thanks for that @mgreter \n. @am11 are you able to compile master on Windows now? @mgreter has pushed the _skip_source_map_update patch directly to master in 2fae47a2913\n. Thanks for taking a look. I've reopened #586 to track this issue.\n. The not operator has been implemented on master. \nAddressing the confusion between the not operator and function, there is no function.\n``` scss\n// is $foo falsy?\n@if not $foo {}\n// is a list of one element $foo falsy\n@if not($foo) {}\n``\n. Thenot` operator fix has been reverted for the time being. Re-opening this.\n. This is related to https://github.com/sass/libsass/issues/660.\nEssentially parsing of the not expression needs to have contextual awareness.\n. This is now fixed (for reals this time) by #679 and #680.\n. I'm not sure if this is related but it was recently reported to be that our str-slice specs are disabled, presumable due to utf-8 tests in the spec\nscss\nstr-slice(\"\u00f8\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\u00f1\u00bf\u00e9\u00e0\u0164\u01c5\u01c2\u024a\u0271\u02ad\u02ac\u046a\u0488\u0753\", -80, -200);\nIs this related to utf-8 handling or a bug with string-functions and utf-8?\n. I'm all for this stuff :+1: but as you said @mgreter \n\nI would speak against using the full feature set of cpp11, it already intoduced some headaches for the node-sass people since they provide prebuilt binaries. Some people still seem to be on systems which only provide gcc 4.4. ...\nsource https://github.com/sass/libsass/issues/745#issuecomment-67813306\n\nIf we head down this track we're quickly going to hit a point of no return for old centos\n. I'm 100% for this. Just concerned how we'll deal with you're CentOS patch for node-sass /cc @am11 \n. Cool, great news. Just playing devil's advocate :)\n. @am11 generally speaking the only reason we're not adopting more C++ 11/14/17 features is for node-sass' CentOS support.\n. I've done some quick looking into this, and it sounds it should be possible if the binary is compiled on a system with gcc >= 4.5 (http://stackoverflow.com/questions/13636513/linking-libstdc-statically-any-gotchas).\nAlso looks like problem may be node-sass specific? (not sure, maybe)\n$ libsass % ldd lib/libsass.a\n        not a dynamic executable\n. /cc @Vektah\n. Fixed by https://github.com/sass/libsass/pull/571\n. ~~It might be worth prioritising function-exists for this use case.~~\nNevermind, this has already been implemented.\nGuarding your code that rely potentially unimplemented functions is good practice but rarely done. If we recommend it to users it could start a seachange.\n. There's no issue for unique-id. Creating a spec for it might be an issue.\n. This spec for this issue is passing, however it does not cover the issue at hand. I've update the now failing spec https://github.com/sass/sass-spec/pull/242.\n. It's worth mentioning unique-id has now been implemented but it is not the cause of the issue.\n. I've moved this to 3.2 because it's appears to be non-insignificant fix and 3.1 is just about ready for release.\n. Agreed I've looked into this a couple times and it's non trivial. Ruby Sass handles this my having a separate SassScript parser.\nI also think our approach to \"everything is a list\" is a bit overzealous and is the cause some tricky bugs.\n. :+1:\nOn 4 Mar 2015 08:43, \"Marcel Greter\" notifications@github.com wrote:\n\nIMO we should re-scope this to Milestone 3.3\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/442#issuecomment-77042243.\n. I don't think we should merge something that's failing master. Having master fail impedes progress on other features. \n\nAlso from other sourcemap related discussion it seems that few of us (myself included) really understand sourcemaps to make the call here. I would defer to @akhleung and @hcatlin on this one.\n. @AndyOGo import once is not part of the Sass language. There are community implementation in sass, or JavaScript. Alternative it will land in the Sass v4 module system.\n. For reference this is the Selectors Level 4 Reference combinator\n. I'd started work on this bug haven't come back around to it.\nIt required a decent amount of changes to how we handle selectors. The proper fix for this will also address some other issues. i.e. #593\n. This is more involved than than the current implementation. I've started work on this but got distracted.\n\nFor intents and purposes the /deep/ combinator acts like the direct sibling combinator except for the shadow dom. 3.2.4 Selecting Through Shadows: the /deep/ combinator.\n\nEssentially /deep/ needs to be treated exactly the same as +. \nThis is a relevant specs - https://github.com/sass/sass-spec/blob/master/spec/libsass-todo-tests/scss-tests/175_test_reference_combinator_with_parent_ref/input.scss\n\nAlso /deep/ is a reference combinator as defined in CSS Selectors Level 4.\n\nThe reference combinator consists of two slashes with an intervening CSS qualified name, and separates two compound selectors, e.g. A /attr/ B.\n\nWe need to handle generic reference combinators, not just /deep/.\nThis is a relevant spec - https://github.com/sass/sass-spec/blob/master/spec/libsass-todo-tests/scss-tests/117_test_selector_interpolation_in_reference_combinator/input.scss\n. This can be closed. It has been fixed in 3.3.\n. Thanks we're aware, however it's a part of a spec, code exists with it that\nwe need to support and most importantly Ruby Sass supports so we must also.\nOn 17 Jul 2015 17:45, \"Micha\u0142 Go\u0142\u0119biowski\" notifications@github.com wrote:\n\n/deep/ is deprecated. Only Chrome has implemented it and it plans to\nremove it soon (just see the console on the new tab page in Chrome Canary).\nThey've tried to change the combinator from /deep/ to >>> but no form has\nbeen accepted by other browser vendors and it has been removed from the\nspec.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/452#issuecomment-122206577.\n. The latest versions of suzy, and breakpoint currently work with Libsass 3.1 which is available in the node-sass 2.0.0-beta. This means singularity should work, but it is as yet untested.\n. @mgreter you can activate the spec for this now! Nice work https://github.com/sass/sass-spec/blob/master/spec/libsass-todo-issues/issue_469\n. I'll address this with my bubbling work.\n. Spec added https://github.com/sass/sass-spec/pull/243.\n. This is fixed and will be in 3.2.\n. It'd be ideal @akhleung could get his feedback in before Sunday US time. \nI have company allotted hack time to work on this coming up this Monday AU time (Sunday US time). \n. I've updated the Map casting boilerplate with a get_arg specialised for maps as discussed. It's much nicer now :100: \n\nI think this is pretty much good to go.\n. This is fixed in 3.1.0-beta. Please reopen if run into this again.\nSpec added https://github.com/sass/sass-spec/pull/211.\n. Another thing to consider is that with the addition of function-exists in Ruby sass 3.3 it's now possible to do something like function-exists(\"image-url\").\nWe do this in our framework to determine whether we can rely on the compass' image-url function or use our own Sass one. The issue we're facing now is that Libsass' native image-url is making this check return true, causing all our image urls to be incorrect (because it's using neither the compass or our sass image url path).\nIMHO image-url should be removed. A sass implementation is entire possible by adding the image path to a sass variable.\n. IMO this has to be removed as per our roadmap to reach Sass feature parity.\nThe concerns around breaking the behaviour for people who rely on this are legitimate. @mgreter is the custom function interface capable enough that this feature can be implemented as-is as a custom C function?\n. If we need to keep this in some form my vote would be to move this out into\nan officially supported custom function.\nOn 11 Dec 2014 17:13, \"Marcel Greter\" notifications@github.com wrote:\n\nCustom C functions currently lack the possibility to be called by \"mapped\"\narguments. So I guess this could be a drawback. Other than that I don't see\nany reason this should not be possible to implement by custom C functions.\nAlthough I guess the current code is in C++ (function.cpp)!?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/489#issuecomment-66577701.\n. Unless there are any objections I'm going to make image-url produce a deprecation warning in 3.1.1. Then let's figure out what we are going to do about it for 3.2.\n. Ok cool. I'm going to remove the guts of this and add a deprecation message. 3.2. Is pretty close atm so this is a good a time as any.\n. Hi @callumacrae, we work very closely with the node-sass team. I believe this change was clearly communicated, and there were several beta releases.\n\n\nAs it stands Libsass does not follow semver, and will not until 3.4. We did soft deprecate this feature in 3.2.0 and subsequently removed in a later patch since the deprecation was causing more troubles to users.\n. Lets consolidate any remaining discussion in https://github.com/sass/node-sass/issues/965. \n. No it does not.\nOn 26 May 2015 08:37, \"danielrz\" notifications@github.com wrote:\n\nwhat about the $cache-buster parameter? does LibSass supports cache\nbusting with images?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/489#issuecomment-105570285.\n. You need to implement your own image-url function. It's very straight forward to do. \n. > In general Sass supports @each $arg1, $arg2, ..., $argN in $list-of-lists where each element in list of lists would bind the arguments in order and assign the rest as null.\n\nIs it worth adding a separate bug for this case? These two use cases would likely be two separate patches to libsass.\nAlso the current test https://github.com/sass/sass-spec/pull/54 only cover the maps use case.\n. Awesome @ericam thanks!\n. I agrees @each with multiple assigns is important. FWIW it can be easily worked around though. It's not ideal, but it's doable. \n``` sass\n$map: (foo: bar, bar: baz);\n// before\n@each $k, $v in $map {\n  // ...\n}\n// after\n@each $k in map-keys($map) {\n  $v: map-get($map, $k);\n  // ...\n}\n```\n\nFWIW IMHO the more critical issue with maps is their performance (#536). I've dropped my work on feature queries (#261) and reference combinator (#452) to focus on map performance.\n. Can you please post the code you used to get that error @andreasisaak ?\n. @andreasisaak hmm I'm not sure why you'd get that error, can you please create a sassmeister gist for me to debug?\nHere is my PoC https://gist.github.com/xzyfer/adff8699236bd470afbd\n. Sounds like you might be running libsass 2.0. Map support was added in 3.0.\n. grunt-sass added libsass 3.0 in version 0.16.0. Check the version in node_modules/grunt-sass/package.json and node_modules/node-sass/package.json\n. No worries @andreasisaak. Glad you got it sorted. I'm currently working on bring this to libsass.\n. Oh em ge! My bad. I've got the patch in #500\n. Thanks @mgreter! I saw that PR but accidentally thought it had been merged. This can be closed I suppose.\n. Thanks @hcatlin ! It's a big improvement. \n. This appears to still be failing in 3.1.0-beta\n. I know 3.0 is closed for features but I had some time today for this.\n. I've been digging into this and there's a subtle parsing bug when maps are used for values (and maybe keys?) of maps, which is a perfectly legit use case. I'm most of the way to a patch. I'll have it ready tomorrow.\nMy bad.\n. Sorry I didn't see your bug. Closing this.\n. Between #572 and #576 we got a minor performance increase. Nice work!\n. :+1: these discussions are a big step forward.\nI'd also like to put some emphasis on restoring some order to sass-spec. Currently it feels rather chaotic and lacks clear contributing guidelines. Sass spec (or something of it's kind) is integral to moving libsass forward in sync with ruby sass. IMHO it's worth building a community around sass spec with clear goals. I'm happy to put my hand up to help out here.\nThis probably a discussion best to be had on the sass-spec project, and it's one that I think needs to be had.\n. Hi @HansUXdev. This roadmap is specifically targeted at our goal to reach Ruby sass feature parity.\nThe Ruby sass project is the reference implementation for all other sass implementations. This means all new features, and feature discussions happen on that project https://github.com/sass/sass. That would be the appropriate place to ask since we don't have much involvement in the direction of the Sass language.\n. This build will fail until https://github.com/sass/sass-spec/pull/86 is merged.\n. I can confirm that trailing ; were not being stripped in compressed output before this patch.\n\nPlease correct me if I'm wrong but iIt appears to me that the test you've linked to asserts that the trailing semi-colon in present. Which would correctly result in a failure on the current libsass master.\n``` js\nvar expectedSampleCompressed = '#navbar{width:80%;height:23px;}\\\nnavbar ul{list-style-type:none;}\\\nnavbar li{float:left;}\\\nnavbar li a{font-weight:bold;}';\n// snip\ndescribe('cli', function() {\n  it('should compile with the --output-style', function(done) {\n    var emitter = cli(['--output-style', 'compressed', sampleScssPath]);\n    emitter.on('error', done);\n    emitter.on('write', function(err, file, css) {\n      assert.equal(css, expectedSampleCompressed);\n      fs.unlink(file, done);\n    });\n  });\n});\n```\n. Yep just noticed the error. Looking into it atm.\n. Ok, turns how I just forgot how to computer momentarily. Rebased a fix.\n. Oh wow this really broke something (everything). I'll see if I can reproduce locally.\n. Master is currently failing. FWIW git bisect says the culprit commit is fe8ae97b03d5bbdb53039462f74c2bd59c62daf3\n. Should this conversation be moved upstream to sass/sass?\n. My rational is that our number 1 priority is sass feature parity. This may happen one day, but it won't be for a long while.\nTo be honest I'm currently of the opinion that this is the just job of a post processor. Alternatively I believe this or equivalent functionality is offered s by compass and the compass team have decided to support Libsass.\n. There are currently no specs in Libsass, but @mgreter has some in perl-sass. There's more information in this thread https://github.com/sass/libsass/pull/786#issuecomment-68321508\n. I'll take a look at this this week. There appear to still be a couple kinks with maps, but this was not one I expected.\n. Ok this was an easy fix. I wasn't correctly parsing map keys if the were numbers.\n. The original issue is fixed in #540. I've opened #555 to address the previous comment.\n. ~~This doesn't work in ruby sass 3.4~~\nConfirmed https://gist.github.com/xzyfer/6c396ae79e4de601edc9\n~~Please open the issue on https://github.com/sass/sass~~\n. ~~This doesn't work in ruby sass 3.4~~\nConfirmed https://gist.github.com/xzyfer/6c396ae79e4de601edc9\n~~Please open the issue on https://github.com/sass/sass~~\n. @AndyOGo sorry you're correct. I failed at copy-paste.\n. Spec added https://github.com/sass/sass-spec/pull/102\n. @lunelson https://github.com/sass/libsass/pull/563 is where I've gotten to on this.\n. Fixed by https://github.com/sass/libsass/pull/563\n. ~~I'm not sure what was up with this all seems fine now. I think master was failing for a short while.~~\nNevermind, there was a regression here. I've fixed it.\n. Spec added https://github.com/sass/sass-spec/pull/103\n. If you're willing to wait I plan to tackle this over the weekend.\n. The general idea is you want want parse_value to lex just the & symbol (we don't care about selectors) and return a reference selector AST node. Then the visitors will take care of the selector substitution for you.\nIf you want to give it a shot I'll take a look at the PR.\n. Yeah I had a look, it's a little more complicated than expected. You need to expand the Selector_Reference with contextualize. \nThis gets tricky because parse_value wants to return an Expression, and Expressions are evaluated in the eval visitor which doesn't know about the selector stack.\nSome wire will need to be crossed to get crossed. My gut feeling is that the selector expanding logic will need to be factored out of the Ruleset expand visitor into it's own operator.\n. If you take a look at the Ruleset operator in the expand visitor you'll\nsee how selectors are resolved (via the contextualize class). That\nresolution process takes the current selector stack and figures out the\nvalue of &.\nOn 21 Jan 2015 17:47, \"Eric Kimn\" notifications@github.com wrote:\n\nAh, okay so that's what I thought. I was hoping for a simpler answer,\nwhich was simply returning the right value in parse_value, but like you\nsaid, there was no way to access the member I needed, or rather, the member\nsimply doesn't exist.\nWhen you say expand the Selector_Reference with contextualize, what do\nyou mean? Do you mean have Selector_Reference have a reference to a\ncontextualize member or to inherit from it?\nI can work on refactoring the selector expanding logic into its own\noperator.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/548#issuecomment-70792131.\n. Unfortunately it's not assignments. The & is an expression that evaluates\nto a list of selectors. As a result it can be used many places a list can\ni.e. assignments, selectors, function arguments\nOn 21 Jan 2015 19:05, \"Eric Kimn\" notifications@github.com wrote:\nWouldn't I have to\na) make Selector_Reference inherit from Expression\nb) Have the expand visitor apply the Contextualize to the\nSelector_Reference for the Assignment visitor method?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/548#issuecomment-70798736.\n. You should need to create a single operator on the the expand and eval\nvisitors for handling Selector and some wrapper Expression node. This\nis mostly guess work, I know more when I dig into it.\nOn 21 Jan 2015 19:34, \"Eric Kimn\" notifications@github.com wrote:\nah...the spec that was written only seemed to account for the assignment\ncase....so this means that I'd have to apply this to ALL the visitor\nmethods??? that kinda sucks....there should be a better way.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/548#issuecomment-70801435.\n. Exactly. Only the expand visitor know how to hydrate the & expression. My\ngut feeling is you'll need a new Expression subclass node in the mix.\nOn 21 Jan 2015 19:47, \"Eric Kimn\" notifications@github.com wrote:\nAh, that's what you mean by the stacks being different...the eval visitor\nis for expressions primarily and the expand visitor is primarily for\nStatements?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/548#issuecomment-70802776.\n. No I haven't. I forgot it was a long weekend here so I've been away.\nOn 25 Jan 2015 22:31, \"Eric Kimn\" notifications@github.com wrote:\nHi xzyfer,\nOut of curiosity, did you manage to get to this at all this weekend?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/548#issuecomment-71367848.\n. Hi @ekskimn, apologies I've been busy with other things.\n\nCould you please open a PR with your current work? That would be the ideal place to discuss implement details.\n. @Snugug it would be awesome if you could whip together a sass-spec of the place & can be used as a value i.e. interpolation, function arguments, mixin arguments, variable assignments (?)...\n. Bump. @ekskimn can you please open a PR with your work so far? I'd hate to have to duplicate effort on this.\n. No worries @ekskimn I'm rather pre-occupied myself atm.\nWe appreciate all your work.\n. I'm sorry but it's just really hard to visualise with out seeing the code\nso far. It's perfectly fine to put up a PR that's not perfect.\nOn 26 Feb 2015 19:23, \"Eric Kimn\" notifications@github.com wrote:\n\nHey @xzyfer https://github.com/xzyfer\nJust to let you know where i am with things...i have the first test case\nfigured out but when the parent selector is in another statement such as an\ninterpolation, i'm having a hard doing that without the contextualizer\nbeing in the eval visitor. The problem is that the contextualizer takes the\neval as a parameter.\nWhat do you recommend?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/548#issuecomment-76139132.\n. Thanks for your work, we really appreciate it. FWIW there's a comprehensive spec suit for this feature now at https://github.com/sass/sass-spec/tree/master/spec/libsass-todo-tests/selectors.\n. Spec added https://github.com/sass/sass-spec/pull/104.\n. Spec added https://github.com/sass/sass-spec/pull/105.\n. This doesn't pass on master for me. I get\n\nInput\n```\na,\ndiv {\n    top: 0;\n}\n.a,\n.b {\n    &.c {\n        color: red;\n    }\n}\n```\nLibsass output\n```\na, div {\n  top: 0; }\n.a.c, .b.c {\n  color: red; }\n```\nRuby sass output\n```\na,\ndiv {\n  top: 0; }\n.a.c,\n.b.c {\n  color: red; }\n```\n. My guess is the spec is passing due to this issue in sass-spec https://github.com/sass/sass-spec/issues/131\n. Fixed by https://github.com/sass/libsass/pull/563\n. Fixed by https://github.com/sass/libsass/pull/563\n. I thought that was the case originally. If this behaviour changes in Ruby sass updating Libsass is trivial.\n. I can confirm the latest master returns the following output\n``` css\n.btn-red {\n  background-color: #ff0000; }\n.btn-blue {\n  background-color: #0000ff; }\n.btn-green {\n  background-color: #00FF00; }\n.btn {\n  background-color: #ccc; }\n``\n. It's worth noting#00FF00isn't normalised to#00ff00` but that's its own issue IMO.\n. Thanks for this @benesch .\nAs you mention backing maps onto a hash table is the better fix here. I have a PoC branch for this which currently passing all the specs as well as the ones mentioned here https://github.com/xzyfer/libsass/pull/3. \nI'm currently working some extra performance tweaks, but will open an official PR this week in time for 3.1\nMap currently suffer from some performance issues in map heavy code which I fear this will exacerbate.\n. I've opened the PR now :) https://github.com/sass/libsass/pull/563\n. If you merge or rebase sass/libsass#master the tests should now pass\n. This has since been fixed.\n. To be honest I'm not sure where all time is going. I did some profiling with colleagues but couldn't get a clear picture. Our hunch is that there might be something else going on that's not directly related to maps.\nFor example our bootstrap process does some recursive merging of maps long and deep maps.\nAlmost all the map functions are 2-3 lines now (thanks hash tables!). The majority of time spent on map map operations is hashing related and that's cached pretty heavily.\nI do have some ideas for squeezing some extra speed out of maps but I wanted to limit the scope of this PR.\n. I'll try to isolate the code I was benchmarking against this week when I have time.\n. Hmm looks like I have some gcc issues. Sounds like a problem for tomorrow me.\n. If you merge or rebase sass/libsass#master the tests should now pass\n. I believe I have a fix here https://github.com/xzyfer/libsass/tree/fix/compressed-media-queries\nIf you are able to, please compile this version yourself and confirm you're getting the expected output.\nYou can do so (on osx/linux) by following these instructions:\nbash\n$ git clone git@github.com:xzyfer/libsass.git\n$ cd libsass\n$ git checkout fix/compressed-media-queries\n$ export SASS_LIBSASS_PATH=`pwd`\n$ git clone git@github.com:sass/sassc.git\n$ cd sassc\n$ export SASS_SASSC_PATH=`pwd`\n$ make\n$ bin/sassc -t compressed /path/to/file.scss\n. Glad you found it useful. @hcatlin recently added some better dev docs in the wiki that are worth checking out https://github.com/sass/libsass/wiki/Setup-Dev-Environment\n. Follow https://github.com/sass/node-sass/issues/487 to know when this fix in available in node-sass.\n. If you merge or rebase sass/libsass#master the tests should now pass\n. Oh whoops I think this was passing yet :) It was still a work in progress\n. Yep, sorry I though I had. I'll have a fix up shortly. Funnily enough the test failure answered my todo question.\n. Looks like this was more WIP than I thought. If there's no objection I think it's best to revert this merge for the time being.\n. That also means reopening https://github.com/sass/libsass/issues/492 (which I cannot do).\n. Count me in :+1: I'm fairly invested in getting libsass to where it run handle my teams framework.\n. :+1:\n. I suspect you'll need to revert https://github.com/sass/sass-spec/pull/96 as well to get the green light.\n. There's been a bit of activity tonight. I'm going to let this rest until tomorrow.\n. I'd prefer to limit the scope of this PR. Focused PRs make for better auditing and regression tracking.\n@am11 thanks for opening that PR. Looks fine from a cursory glance. I'll take a closer look after work.\n@mgreter @QuLogic I'll look at how I can move the hash_ initialisation. It's used for most Expressions not just lists, but is tied into Vectorized and Hashed. My feeling is that there will need to be a better interface to handle hash caching. Again I'd prefer to handle this in another PR since it's related to different feature.\n. Thanks @ericam ! The map api should work as expected on the current master as of about 12hrs ago :tada: \nAny edge cases you stumble across in @each would be great to test.\n. Looks sane to me! Can you put that in a PR?\n. This now passes all the specs. I'll wait for the above spec to be merged before merging this.\n. LGTM :ship:\n. I agree it's rather hacky. It'd be great to get some context on what the original breakage was. Ideally we could more this fix into inspect.\n. In the interest of increasing ruby sass compatibility I'm ok with merging this as long we open another issue to come back around to cleaning this up.\n. My concern with this (and previous) implementation is that there's no context as to what's happening. This reflects the lack of clear understanding of the problem. We're building a house of cards here which worries me.\nI'm pretty confident on the parser's internals, but a bit vague on the sourcemaps integration. IMHO there's going to dedicated time for dealing with sourcemaps and a good test suite. It would be worth finding an advocate for sourcemaps to help us build that required test bed.\n. Cool I'm currently testing this and https://github.com/sass/libsass/pull/572 locally.\n. All green on my end :ship:\n. I assume this is running against my branch @ericam ?\n@akhleung correct. I haven't implemented the Eval visitor for maps in @each yet hence my tweet last night :)\n. Thanks for the detailed explanation @akhleung. I was confused by the way eval bails out of the @each i.e. https://github.com/sass/libsass/blob/master/eval.cpp#L127\nCan you quickly explain why it's bails out early like this?\n. Great that makes perfect sense! I really appreciate your insight\n. This is ready to go thanks to @akhleung info above. Just waiting for the https://github.com/sass/sass-spec/pull/89, https://github.com/sass/sass-spec/pull/99 to be merged so I activate the relevant specs.\n/cc @michaek @hcatlin :cake:\n. Fixed in f55b2d50342f97228a56a513b4cabf40996d6092\n. Thanks for you work on this @avoliva !\nI've left some minor feedback. I've also requested the spec author to add a case for negative indexes https://github.com/sass/sass-spec/pull/99#issuecomment-60742709.\n. Thanks @ericam \n. I've activated the spec for set-nth (https://github.com/sass/sass-spec/pull/101) so future CI builds should be testing against it.\n. Nice work. Are you able to squash these commits into one?\n. Nice work @avoliva !\nLooks like something weird has happened to the commits, now there are 5 instead of just one. It's cool I'm merge 354de3e into master.\n\n. No worries! Love your work\n. Closed via 5e86443.\n. This is significant regression that makes libsass unusable for a lot of people. I think releasing a 3.0.1 patch release is called for.\n. Sounds good. I'm just doing some quick spec munging.\n. I've activated the specs for #571. We should be good to go!\n. I wonder why this didn't build in travis\n. There seems to be a decently backlog in travis atm. Probably because US is coming online. It's 3am here so I'm checking out til the arvo.\n@hcatlin if you run into any issues that block the 3.0.1 release ping me and I'll take a look in the morning.\n. As discussed on twitter this belongs in custom importer until modules lands in Sass next.\n. Thanks again @am11 :ship:\n. It'd be great to have an automated to tool like jscs or go-format that held the code to some agnostic coding standard. The caveat being those kinds of tools usually require an initial commit to comply with their formatting, which can make traversing git history difficult.\n. My editor is also configured to replace tabs with spaces so I imagine this will just magically happen over time.\n. I agree. This feature however would seem to have less adoption, and there a pure sass implementation is trivial. I'm ok with merging #588 to remove this.\n. @davidangel that's the compact output style. This is in regards to a native compact function that Sass currently does not have http://sass-lang.com/documentation/Sass/Script/Functions.html\n. No there is not. We only support nested and compressed. Feel free to open an issue to support that output style.\nFor the moment it's a low priority. We recommend using PostCSS is you want to manipulate the output styles.\n. @am11 can you please provide the sassc cli command that spec runs, the input and expect output? \nIt'd be great if we could reproduce the error directly without node-sass.\n. Thanks for your help @am11 . Apologies for my naivety I'm not familiar with either the sourcemaps implementation or node-sass so I'm trying to track down where the issue maybe it.\nWith this new information are you still certain the error was introduced in f55b2d5? Could it possibly be a sassc or node-sass issue?\n. Hmm I annoyingly can't reproduce this on osx :-1: \n. I like where your head is at. I would move the helpers into new ARG functions i.e. ARG_RGB and ARG_RGBA. See:\nhttps://github.com/sass/libsass/blob/master/functions.cpp#L23\nhttps://github.com/sass/libsass/blob/master/functions.cpp#L94\n. As is stands this code will cause some regressions because the list functions don't necessarily require a List be passed in. In sass every expression is a list of length one, hence most Expressions can be coerced into List.\n. In regards to lists the better helper would be like\n``` cpp\ndefine ARGL(argname) get_arg_l(argname, env, sig, path, position, backtrace)\nList get_arg_l(const string& argname, Env& env, Signature sig, const string& path, Position position)\n{\n  List val = get_arg(argname, env, sig, path, position, backtrace);\n  if (!val) {\n    val = new (ctx.mem) List(path, position, 1);\n    *val << get_arg(argname, env, sig, path, position, backtrace);\n  }\n  return val;\n}\n```\nSince this would reduce bloat in all list functions and centralise list coercion and error handling e.g.\ncpp\nSignature nth_sig = \"nth($list, $n)\";\nBUILT_IN(nth)\n{\n  List* l = ARGL(\"$list\");\n  Number* n = ARG(\"$n\", Number);\n  if (n->value() == 0) error(\"argument `$n` of `\" + string(sig) + \"` must be non-zero\", path, ion);\n  if (l->empty()) error(\"argument `$list` of `\" + string(sig) + \"` must not be empty\", path, position);\n  double index = std::floor(n->value() < 0 ? l->length() + n->value() : n->value() - 1);\n  if (index < 0 || index > l->length() - 1) error(\"index out of bounds for `\" + string(sig) + \"`\", path, position);\n  return l->value_at_index(index);\n}\nThe reason I say this is better is because you get more reuse out of it.\n. You apply that same idea to ARG_RGB and ARG_RGBA helpers as well :+1: \nAs for the nth logic, it'd be great to eventually move that into the List object and just throw and out_of_range exception if the index is invalid.\n. Superseded by https://github.com/sass/libsass/pull/835\n. I've updated the description with more information. I appears coercions to compatible types for equality operations aren't happening.\ni.e. 1/2 == 0.5 is being treated literally as 1/2 == 0.5.\nThe coercion is happening as expected for other arithmetic expressions .i.e. 1/2 * 2 correctly produces 1;\n. Nice find @am11 . IMO specs should aim to be more granular. I'd build a series to specs addressing the exact use cases where numbers are and aren't being handled correctly. There are a lot of different use cases which will likely be addressed incrementally.\n. It's worth noting fixing this behaviour will fix ~6-10 currently failing specs.\n. I can confirm this issue is fixed in 3.2 @ericam \ncss\n.test {\n  integer: true;\n  decimal: true;\n  fraction: true; }\n. I'm not overly familiar with sourcemaps but there's nothing here that jumps out at me :+1: \n. I wonder if it's possible for travis to run our builds against Windows so we can catch these issue sooner.\n. I've been fairly quiet here because sourcemaps really isn't my area, so I'm happy to trust in your judgement. \nHowever the drum you'll often hear my bang on is performance. I'd like us to be aware of the performance impacts, if any of these (or any) changes. Since we're now able to support foundation (and possibly bootstrap?) it'd be great to check we're not introducing compilation time regressions.\nI mention this here because this is starting to feel like a more significant change to a fundamental part on Libsass. Thoughts?\n. Looks like this made it into 3.2.0. Updated the milestone.\n. Thanks for reporting this! Normalising these things is certainly within the scope of sass-spec.\nCould you please add a spec in https://github.com/sass/sass-spec ?\nHere's an example of a good spec PR for reference https://github.com/sass/sass-spec/pull/89/files\n. This will require refactoring to how we handle combinators. Conveniently it's the same refactoring required for https://github.com/sass/libsass/issues/452. My feeling is these two will be happen at the same time.\n. Could you please add a spec in https://github.com/sass/sass-spec ?\nHere's an example of a good spec PR for reference https://github.com/sass/sass-spec/pull/89/files\n. This is really great detective work!\n. @benflodge Could you please add a spec in https://github.com/sass/sass-spec ?\nHere's an example of a good spec PR for reference https://github.com/sass/sass-spec/pull/89/files\n. Spec added https://github.com/sass/sass-spec/pull/116\n. @am11 thanks for the heads up. I left some feedback on the spec.\n. Seems appropriate to cc @akhleung on this.\n. Fixed by https://github.com/sass/libsass/pull/611\n. Sorry I'm not following @supports (foo: bar) or (foo: bar) or (foo: bar) and (foo: bar) and @supports ((foo: bar) or (foo: bar) or (foo: bar)) and (foo: bar) have two very different meanings.\nYou're example worked in my original implementation (https://github.com/sass/libsass/pull/612) but my case failed as described in the issue description.\nAccording to the grammar supplied by the w3c my example is correct http://www.w3.org/TR/css3-conditional/#at-supports\nIt feels like this may be bug in Ruby sass. ~~It also appears that Ruby sass does not support negation http://sassmeister.com/gist/7503101e47d9b4e1a65b~~\n. I've opened an issue on Ruby sass to track this https://github.com/sass/sass/issues/1512\n. Yeah I'm certain it's a bug in Sass https://github.com/sass/sass-spec/commit/c58ab229ddeb209761e98cb8b22672305884ec06. :Ship:\n. Yeah it essentially boils down to interpolation inside an interpolation. Updated the issue title accordingly. FTR this also works\n``` scss\n$foo: \"bar\";\n%#{\"foo--\" + $foo} {\n    foo: bar;\n}\na { \n  @extend %foo--bar; \n}\n```\n. /cc @mzgol\n. I agree with @bdkjones this is certainly a bug. We should be mimicking Ruby sass' behaviour.\n. Interesting. This does appear to work in some cases i.e. http://sassmeister.com/gist/669b4f5645c46296e317\nWhat version of Libsass are you using?\n. Ah I see, there appears to be difference depending on whether the @-rule has a selector\n``` css\n.link {\n    @media (foo: bar) {\n        display: flex;\n    }\n}\n@media screen {\n    a {\n        color: red;\n    }\n}\n```\nProduces\n``` css\n@media (foo: bar) {\n  .link {\n    display: flex; } }\n@media screen {\n  a {\n    color: red; }\n }\n```\nhttp://sassmeister.com/gist/669b4f5645c46296e317\n. Accidentally closed by spec PR comment.\n. This is similar (but I think unrelated) to https://github.com/sass/libsass/issues/549\n. Keep this bool flag in the AST node makes sense. I don't see any reason to modify the C API for this. I took a run at this last week but eventually got caught on https://github.com/sass/libsass/issues/549.\n. This may help https://github.com/darrenkopp/sassc-win\n. I thought this had been addressed previously. My bad. Good catch.\n\nhowever, libsass can also do better than ruby-sass \n\nI like the idea, but as far as Libsass is concerned Ruby sass is the \"right way\". Our goal is to act exactly as they do. If you want this feature in Libsass I would the suggestion on the Ruby sass repo.\n. We can't currently test this case. See https://github.com/sass/sass-spec/issues/136\n. IMHO it's work creating issues for each of these and assigning them to a 3.4 milestone as per our roadmap. As is stands this issue doesn't feel actionable or approachable.\nThoughts?\n. Welcome back @hcatlin! Thoughts on my previous comment?\n. I've created https://github.com/sass/libsass/pull/772 which I'll ship in 3.1.next.\nIt addresses spec/libsass-todo-tests/libsass/div.\n. @hcatlin I'd say it's work updating all todo specs on master so we don't end up patching against 3.3 functionality. I don't see any harm if they're already being skipped.\n. This is correct as of the current master with regards to major language features. If you want a more specific list of issues look at the github issues.\n. All of the supplied specs are passing as of current master. All outstanding failing specs have been converted to issues. There is now a Bug - Confirmed issue for ever known LibSass bug.\nhttps://github.com/sass/libsass/issues?q=is%3Aopen+is%3Aissue+label%3A%22Bug+-+Confirmed%22\n. This should be fixed in 3.0.2\n. This is the same underlying issue as https://github.com/sass/libsass/issues/185\n. This fixed via #800 and will be in 3.2.\n. As mentioned in https://github.com/sass/libsass/issues/439#issuecomment-61893291 writing a sass-spec for a random string generator is going to be interesting. Any bright ideas @hcatlin @akhleung ?\n. > They don't necessarily have to be random.\nunique-id needs to return a unique CSS identifier, so it does need to be random. \n\nIt has to return strings matching [a-z][a-z0-9]+\n\nBecause the test suit is in sass we can't do pattern matching, so we can't assert the returned values are valid identifiers.\nThe only assertion we can make, as you mention, is that n calls to unique-id don't produce any collisions. Then cross our fingers noone uses it more than n time in a compilation target. A single compilation target can be 1 or a 100 sass files (because of imports chains) so the threshold will need to be high enough that noone runs into it, but low enough that it doesn't slow down test suite time noticeably.\n. I think you're misunderstanding me. The feature itself is trivial, I agree. I was simply stating that writing a test case for it our test suite will be tricky.\n. This is an unsupported feature in Ruby sass. Currently Libsass' goal to emulate Ruby sass hence it's unsupported in Libsass as well.\nThe issue of extending nested selectors has come up on the Ruby sass issue tracker a couple times but there are no plans to directly support it. https://github.com/sass/sass/issues/609#issuecomment-11742711 explains why.\nThe recommended work around is to instead extend a %placeholder selector. See https://github.com/sass/sass/issues/1442 for more information.\n. A simplified test case FTR\nscss\nfoo {\n  foo: #{\"foo\", \"bar\", \"baz\"};\n}\n. Thanks for this @lunelson . This appears to be a different issue than the one originally reported.\nCould you please create a new issue and spec?\n. I managed to reduce the test case down to what's causing the issue and it's exactly as you pointed out.\nscss\n.#{\"foo\"}--1 { a:a }\nLooks like <interpolant>--<number> isn't handled correctly.\n. Thanks for reporting this!\nCould you please add a spec in https://github.com/sass/sass-spec ?\nHere's an example of a good spec PR for reference https://github.com/sass/sass-spec/pull/89/files\n. Makes sense. Interpolations (#{}) and numbers are treated differently. Thanks for this, I'll dig into it.\n. it appears that interpolation with url() is mishandled. Simplified test cases FTR\nscss\nfoo {\n  background-image: url(foo/#{\"bar\"}/baz.jpg);\n}\n. This is because css style comments /* */ are still parsed (somewhat). The errors described are likely due to the commented out code being invalid sass. Ideally we would fail gracefully though.\nIf you want to truly comment sass code you need to use sass line comments //.\n. Sassmeister gist for reference: http://sassmeister.com/gist/b83650c20ec46ac1246b\n. Reduced test case\n``` scss\n@function foo() {\n  / $bar: 1; /\n @return true;\n}\na {\n  a: foo();\n}\n```\nThis cases Libsass to hang indefinitely.\n. Spec added https://github.com/sass/sass-spec/pull/241.\n. This is fixed and will be in 3.2.\n. @mgreter I'm not sure what you mean.\n. I'm confused because the spec should have always passed. I'm not following\nwhat your PR has to do with this old feature.\nOn 15 Oct 2015 8:04 pm, \"Marcel Greter\" notifications@github.com wrote:\n\nI got a positive result with my test runner with that branch!\nWondering why now or put different, why did it not pass before?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/647#issuecomment-148323957.\n. As far as I can tell this spec (https://github.com/sass/sass-spec/pull/134) as activated 11 months ago.\n. The code supplied above appears to work with Libsass 3.0.1 in both sass, and scss formats. See http://sassmeister.com/gist/e2ce2a091f42ee2ccde6\n\nCan you please supply a sassmeister gist of this bug?\n. @pismenny yes you'll need a newer version of node-sass in order to get Libsass 3.0.1 which will have this fix.\n. ~~I dug into this and it appeared to be because map-get($palettes, $palette) is returning null. It seems as though map-get incorrectly distinguishes between quoted and unquoted string keys.~~\n. I've added this to the 3.0.3 milestone it should make it into the next release.\n. It appears my initial thoughts were wrong. The issue is because the map key is a color name. Libsass has some issues when it comes to parsing strings that are color names i.e. https://github.com/sass/libsass/issues/558\nReduced case: http://sassmeister.com/gist/d2be1def3619bd6c3a54\n. I believe this is somewhat true. I think the map key is being treated as a colour rather than a string, although I'm not sure why this is a problem.\nIt's worth noting the reduced test case works fine on Ruby sass.\n. The issue is that we're treat purple in the map key as a string and purple in the function call as a color. When we call map-get we're asking for the value associated with the color purple, but it's stored under the string purple. Theses two things are not equivalent - http://sassmeister.com/gist/77ae29d46ebecd0823ed\nI've got a fix I'll ship in a couple hours.\n. This build only failed because github is having some technical issues atm.\n. I believe the cause of your issue is this line because Libsass doesn't currently have a unique-id function. \n$unique-id: unique-id();\nClosing this as a duplicate of https://github.com/sass/libsass/issues/636.\n. I'm hoping to land random and unique-id in the next release.\n. This PR address the specs (https://github.com/sass/sass-spec/pull/140) for https://github.com/sass/libsass/issues/368.\nSince https://github.com/sass/sass-spec/pull/95 was never passing this is an incremental improvement.\nI'll open a new issue to directly cover the case not is currently failing.\n. You're correct. My mistake.\n. This has been reverted and sass/sass-spec#95 has been enabled in https://github.com/sass/sass-spec/pull/142\n. Make sense. I've notice a couple other cases where this would be useful i.e.\nscss\nbackground-size: #{10}% 10%;\nThe parser treats the above as a modulo operation rather than two distinct values 10% 10%\n. In Ruby sass, when a declaration's value is evaluated to null the declaration is not outputted. Libsass follows this behaviour. However when that behaviour produces an empty block, the block is still incorrectly outputted.\nCompare these to Ruby Sass:\nhttp://sassmeister.com/gist/40b92fb0a73177ac383b\nhttp://sassmeister.com/gist/9788dfaf2fba2a7428bd\n. > As far as I know, to speed up compilation times Sass does not evaluate all CSS values. It does some kind of quick match to see whether a value should be evaluated as SassScript or not.\n@HugoGiraudel  is correct. I recently added this is the same smarts to Libsass.\n\nFor this test I had to create a function that returns null\n\nBoth functions that return null and variables with the null value should have this behavior.\n. This works for the spec, but I don't like the solution. It also doesn't account for cases like alpha(opacity=$foo). Closing this.\n. Haha yeah I know a bad idea when I see one. It's easy to get caught up in getting specs passing rather than fixing the problem.\n. Any thoughts and/or feels @mgreter @akhleung ? This and https://github.com/sass/libsass/pull/664 are requested semi-regularly.\n. @am11 :tada: :birthday: \n. Nice :+1:\n. Thanks for reporting this @SWGFL. On the surface this does appear to be bug in Ruby sass.\nLibsass' current goal is to 100% match the behaviour Ruby sass, I suggest opening this issue on https://github.com/sass/sass.\n. Yes this was fixed in 3.0.1. \n. If you're using a language binding (i.e. node-sass, perl-sass, grunt-sass, gulp-sass) updating to the latest version should give you latest Libsass.\n. If you're using a language binding (i.e. node-sass, perl-sass, grunt-sass, gulp-sass) updating to the latest version should give you latest Libsass.\n. I believe you can manually depend a version of node-sass by adding the version you want to your dependencies above grunt-sass.\nThen rm -r node_modules and npm install.\n@sindresorhus is any reason for not upgrading to latest node-sass?\n. Can you please post the contents of your package.json\n. Could you please add a spec in https://github.com/sass/sass-spec ?\nHere's an example of a good spec PR for reference https://github.com/sass/sass-spec/pull/89/files\n. Thanks @jakob-e . I've left some feedback on those PR. Ideally one PR would be best, as well as sticking the existing convention of putting specs for issues in libsass-todo-issues. It's part of the Libsass development workflows and makes our lives easier when fixing these issues.\n. Looks good! Thanks for your help\nOn 24 Nov 2014 19:37, \"jakob-e\" notifications@github.com wrote:\n\nThanks @xzyfer https://github.com/xzyfer I've moved the files to\nissue_672 in libsass-todo-issues and made a new PR\nI hope I did close the old ones correctly \u2013 sorry in advance \u2013 Thanks for\nteaching me [image: :+1:]\nsass/sass-spec#149 https://github.com/sass/sass-spec/pull/149\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/672#issuecomment-64164397.\n. Spec added in https://github.com/sass/sass-spec/commit/a164ef0da3fec8922c928cc210c90fa088d66760\n. Thanks for reporting this.\n\nCould you please add a spec in https://github.com/sass/sass-spec ?\nHere's an example of a good spec PR for reference https://github.com/sass/sass-spec/pull/89/files\n. Specs added in https://github.com/sass/sass-spec/commit/28351d9cba1673f19df43e989dcc8682221a4870\n. After taking a moment to look into this is turns out this is actually two separate issues. \nIssue 1 - url(..)'s signature cannot be redefined\nAlthough you can create an alternate function definition for url(..) the new function signature will be ignored.\nscss\n@function url($foo/*, this will never matter */) {\n     // i can be changed\n    @return \"doh!\";\n}\nhttp://sassmeister.com/gist/8d40797d5cf10a1774cf\nThis is because there is special treatment of url(..) in the parser.\nIssue 2 - printed lists are mangled\nThis is a known issue https://github.com/sass/libsass/issues/639.\nYour second parameter isn't ever passed to url(...) due to issue 1. Instead url(...) is getting one parameter $src which is a list. The list is then being interpolated by + causing it to be mangled.\nhttp://sassmeister.com/gist/b6a8b677239082b190ae\n\nI've update the issue title to better reflect this as a case of issue 1.\n. This issue has been reintroduced. A bisect shows the offending commit to be 51b0bf03ac0eb88ef8e91193d4f6a9763af0799c\n. I have a fix for this. Will publish when I'm home.\n. Did you mean to close this issue @Marabyte ?\n. You can supply a precision preference to sassc\nbash\nsassc --precision 10 /path/to/my/file.scss\n. There appears to be a misunderstanding. When you import bourbon the\nlinear-gradient call is actually calling the bourbon function.\nThis means the issue isn't with plain old CSS but simply an incompatibility\nwith bourbon.\nOn 26 Nov 2014 04:34, \"Matt Van Andel\" notifications@github.com wrote:\n\nAlthough this isn't a critical issue, this may be indicative of a bigger\nproblem with mixin handling. It appears that libsass is incorrectly\nidentifying standard CSS functions (without using @include\nhttps://github.com/include) as SASS functions and outputting raw\nvariables.\nTo Reproduce:\n1. Create a project that is using Bourbon and compiled with libsass.\n2. Define a property with a \"normal\" css linear-gradient background.\n3. The regular CSS property is mangled on compile.\nSASS FILE\n@import \"bourbon\";\nelement {\nbackground-image: linear-gradient(#000,#fff);\n}\nEXPECTED CSS\nelement {\nbackground-image: linear-gradient(#000,#fff);\n}\nACTUAL CSS\nelement {\nbackground-image: linear, false, #000, #fff;\n}\nSwitching to Ruby Sass fixes this problem, as does removing Bourbon. Note\nthat Bourbon includes a background-image() function, but that is not\nbeing used here.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/676.\n. If you look on this page http://bourbon.io/docs/#complete-list you'll see there is a linear-gradient defined ~~, even though it's not shown in the docs~~. This function overrides the css linear-gradient function.\n. Thoughts @mgreter ?\n. Thanks @gorakhargosh \n. Thanks for the report @lunelson . Could you please open a new issue and spec?\n. I believe this is a duplicate of #590.\n. This is a bug in how we parse ie expressions. For reference:\n\nc++\nconst char* ie_stuff(const char* src) {\n    return sequence< alternatives < ie_expression, ie_progid >, delimited_by<'(', ';', true> >(src);\n}\n. Thanks for reporting this. It was fixed in 11ec9bb3c2b0b0982a813f56288e5f6988ca1f25. It'll be in the next release.\n. This looks like it should work, but i'm not sure pushing the ie parsing logic into the prelexer is good way to solve the issue for a couple reason:\n- complex sequence operations in the prelexer slow down parsing\n- the proposed prelexer tree is complex and hard to grok\n- it's going to be really hard to account for all the edge cases this way\nThe way I would propose addressing this issue would be to improving the currently parsing logic.\nRather than using delimited_by we should do simple naive balancing of (,). It'll by much faster, the code will be simpler, we don't have to worry about edge cases or quirks in the expression syntax.\nThoughts?\n. Yeah by balancing I meant the contents of quote strings would be ignored.\n. We could replace the currently delimited_by call with a naive recursive parser that terminated when the ( ) count was 0 (ofcause ignoring the contents of quoted strings, and escaped '()`). Everything else could be left unchanged.\n. I'm ok for merging this but please open an issue to come back to this and\ntag it internal. It's late here and I'm not near a computer.\nOn 6 Dec 2014 02:29, \"Marcel Greter\" notifications@github.com wrote:\n\nDo you want to hold this PR? I'm +1 for merging it, since it does not\nchange the old behaviour for expressions and the proposed enhancements\ncan be added later. It covers a reported bug, so I would like to get this\nmerged in! IMO performance is not a real issue, since it only changes the\nparsing for progid properties (and they should be parsed correctly\nanyway, as in emmitting source-map entries).\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/685#issuecomment-65805080.\n. Thanks for this. I mentioned it in the initial implementation as a potential performance issue.\n. I'll make sure to update https://github.com/sass/libsass/pull/664\n. :ship:\nOn 6 Dec 2014 02:24, \"Marcel Greter\" notifications@github.com wrote:\nSo can this be merge? Or any objections?\nI guess you can re-use random for PR 664\nhttps://github.com/sass/libsass/pull/664\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/686#issuecomment-65804304.\n. Do you have an example sassmeister? sassmeister.com\n\nIt appears to work as expect. http://sassmeister.com/gist/b391e47fc3ae9dcb1985\n. I believe this is fixed in recent versions. Please update your Libsass/node-sass/grunt-sass/gulp-sass. Re-open this if the problem persists.\n. :+1: \n. Please open a new issue @al3jo.\n. \nThe C API is out of my wheel house so I completely trust your opinions here. Feel free to merge C API related changes/updates at will!\n. :heart_eyes:  :sob: :sparkles: \n. You're on fire!\nOn 9 Dec 2014 03:06, \"Hampton Catlin\" notifications@github.com wrote:\n\nOh man. This has been a sorely needed addition.\nOn Mon, Dec 8, 2014 at 8:04 AM, Marcel Greter notifications@github.com\nwrote:\n\nMerged #693.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/693#event-204269993\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/693#issuecomment-66137964.\n. Specs added https://github.com/sass/sass-spec/pull/184\n. Not really #615. \n\n615 is related to parsing interpolants, this is about preserving quotes styles.\n. @P233 that's fixed and will be 3.2.0 https://github.com/sass/libsass/issues/639\n. Want to update the spec @mgreter https://github.com/sass/sass-spec/tree/master/spec/libsass-todo-issues/issue_694?\n. I think those things are worth waiting for. I've added a checklist to the issue to track progress.\n. No need to rush :)\nI think we're at a point where the remaining issues are significant chucks of work so future releases may be further spread out. It'd be good to get out some of the good stuff on master in the mean time is all.\n. @drewwells I'm not 100% sure. It was a reference to the still changing C API that @mgreter is working on. Just a reminder to reflect any upcoming changes in the docs.\n. How are you feeling about a pre-release @mgreter ?\n. @mgreter I'd prefer we didn't #718 until we're able to fix the regression with hex arithmetic.\nAlso, has sassc been updated with the latest API changes? We're trying to keep to sassc releases in sync with Libsass.\n. @mgreter thanks for updating the description. I see you've given yourself a lot to do :wink: \nAs for documentation I think for time being our the best value for time investment will come from gearing it towards integrator i.e. node-sass, perl-sass\nAs for documenting internals i.e. parser, lexer, visitors.. I like the Ruby sass approach of having nice descriptive code comments. I know there's a lot of debate about the reliability of code comments, but moving them out into a separate system like wiki makes them hard/impossible to version control with features.\nIMO I don't think it's worth holding up the current features on master for documentation that doesn't that doesn't block existing implementors.\nThoughts?\n. @hcatlin I'm happy to handle releases. Is there anything I need to do besides create the appropriate gh releases? Do we compile binaries?\n. Thanks for the info. I've tried to assign all the PR shipping since 3.0.2 to the 3.0.3 milestone to help with the write up.\n. Today I managed to clear the remaining tricky issues from the the 3.1 milestone. There were a couple significant issues which I moved to 3.2 (https://github.com/sass/libsass/issues/442, https://github.com/sass/libsass/issues/353, https://github.com/sass/libsass/issues/185). The latter two are actually related, and I've started work on these for 3.2.\nIMHO now is as good a time as any to feature freeze 3.1 and prep for a beta release.\n@mgreter / @am11 can you confirm if all is good on the node-sass front regarding new C API?\n. Nice!\n. I decided to also get https://github.com/sass/libsass/issues/748 over the line since it appear to be important to framework authors.\nI'll do the release notes in the morning.\n. @mgreter FWIW I develop solely using clang. I believe OSX alias gcc to clang by default (at least in recent versions).\n. I've created a draft release for the 3.1-beta with release notes. Please add anything I've missed. I've love to release ASAP :smile: :tada: \n. @am11 you're correct, I've updated it to 3.1.0-beta\n@mgreter thanks for updating the release notes.\nHave a great xmas season everyone. A huge thanks for all your work and support! The holidays are time for me to work my open source projects so I'll be floating around.\n. I've created a draft release for 3.1.0-beta.2 to track features/fixes.\n. I've just published the 3.1.0-beta.2 release https://github.com/sass/libsass/releases/tag/3.1.0-beta.2\n@am11 this has @mgreter C API patch.\n. ~~I'm on board (in theory) but I think it's worth making sure we ship https://github.com/sass/libsass/issues/789 since we know it causes a crash. Ill to knock it out shortly!~~ Nevermind this was a false alarm!\nLet's do it!\nI've created a draft 3.1.0 release with change the (massive) curated changelog. I'll leave the honours of the catchy title and preamble to @hcatlin because timezones.\n. I've been giving @HugoGiraudel some guidence on this sass-compatibility project. He recently dropped this stat on me\n\nLibSass 3.0.2 -> 44% Sass-Compatibility tests passing.\nLibSass 3.1.0 -> 64.64% Sass-Compatibility tests passing.\n. Sorry I should have been clearer. The significance of sass-compatibility is that it specifically targets inconsistencies between implementations. An increase of 20% means that of all the difference between out implementations there are now 20% less. It's by no means an indication of overall feature coverage.\n. @mgreter is it possible to get https://github.com/sass/libsass/pull/794 shipped soon? https://github.com/sass/sassc/issues/88 essentially makes Libsass unusable for me (and anyone else using sassc).\n\nhttps://github.com/sass/sassc/issues/88 is the final blocker to 3.1 IMO.\n. I'll give it a shot in a couple when I'm by a computer.\n. The problem appears to be solved. Once CI passes I'll create the 3.1.0 release!\n. 3.1.0 is live! https://github.com/sass/libsass/releases/tag/3.1.0\nGreat work team!\n. We should correct this @drewwells . I'll do a sassc 3.1.0 release shortly. I remember @hcatlin wanted us to do simultaneous releases of Libsass and sassc.\n. It is done https://github.com/sass/sassc/releases/tag/3.1.0\n. LGTM :+1: \n. LGTM :+1: \n. LGTM :+1: \n. LGTM\n. @warning shouldn't stop the compiler. @error behaves like @warning but does stop the compiler. At the moment @error isn't implemented. See https://github.com/sass/libsass/issues/704\n. @HugoGiraudel could you please create a spec representing the correct behaviour?\n. @mgreter have you confirmed the (unmerged) spec https://github.com/sass/sass-spec/pull/261 passes?\n. Nevermind, that spec requires capturing errors.\n. Looks like a regression in 3.3. This was fixed in 3.2.0.\nError: You may not @extend an outer selector from within @media.\n       You may only @extend selectors within the same directive.\n       From \"@extend .foo\" on line 35 of test.scss\n        on line 29 of test.scss\n. Tracking the regression in https://github.com/sass/libsass/issues/1562\n. Spec added https://github.com/sass/sass-spec/pull/167\n. This behaviour changed in Sass 3.3.9 - http://sass-lang.com/documentation/file.SASS_CHANGELOG.html#339_27_june_2014\n\nDefining a function named \u201cand\u201d, \u201cor\u201d, or \u201cnot\u201d is now an error at definition-time. This isn\u2019t considered a backwards-incompatible change because although these functions could be defined previously, they could never be successfully invoked.\n. Nice write up @mgreter.\n\nIMO it's important that our lexer -> parser -> AST flow be representative of the Sass language and not the idiosyncrasies with our implementation. \nIf we're running into naming collisions is other parts of the compiler this is a good time refactor/rename those areas. We should take the time to clean up the less polished parts as we come across them. \nAlso in light of all your recent work on the C API this is as good a time as any to be making BC breaks if need be.\n. Thanks! I think that's much better :)\n. LGTM :+1: \n. Really nice work on this @mgreter !\n. LGTM :+1:\n. FYI as of Sass 3.4.\n\nSass now follows the CSS Syntax Level 3 specification for determining a stylesheet\u2019s encoding. In addition, it now only emits UTF-8 CSS rather than trying to match the source encoding.\n. There's more detailed information here - https://github.com/sass/sass/blob/28ce632750571de900a4471c4c97d268d1f847a2/doc-src/SASS_REFERENCE.md#encodings\n\n```\nWhen running on Ruby 1.9 and later, Sass is aware of the character encoding of \ndocuments. Sass follows the CSS spec to determine the encoding of a stylesheet, \nand falls back to the Ruby string encoding. This means that it first checks the Unicode \nbyte order mark, then the @charset declaration, then the Ruby string encoding. If none \nof these are set, it will assume the document is in UTF-8.\nTo explicitly specify the encoding of your stylesheet, use a @charset declaration just \nlike in CSS. Add @charset \"encoding-name\"; at the beginning of the stylesheet (before \nany whitespace or comments) and Sass will interpret it as the given encoding. Note \nthat whatever encoding you use, it must be convertible to Unicode.\nSass will always encode its output as UTF-8. It will include a @charset declaration if \nand only if the output file contains non-ASCII characters. In compressed mode, a UTF-8 \nbyte order mark is used in place of a @charset declaration.\n``\n. AFAIK Ruby sass offer no options regarding@charset`. It simply emits the utf-8 charset if it detects utf-8 characters. IMO this doesn't need to be configurable via a context option.\nAs for the state of the code I'm fine with it. I agree we should create an internal issue to come back around to this. Presumable when we tackle the expanded output mode.\n. LGTM\n. > I don't know what the implications are by \"abusing\" needs_unquoting and by removing the !lhs->is_delayed() check!\nI ran recently ran into this aswell - https://github.com/sass/libsass/pull/695\n@akhleung can you please give us some background on the intent and affect of is_delayed on AST nodes? Best I can tell it's used to short-circuit some evaluations. Is it purely a performance measure or are the edge cases to be aware of?\n. Thanks for clarifying is_delayed @akhleung. Looking at the code that was pretty much what I had expected. As you mentioned my recent tokenizer updates should make it safe to remove delayed evaluations as we come across them.\n. Does this still break spec/basic/16_hex_arithmetic ? Generally speak I'd rather avoid introducing regressions especially since we're gearing up for new release.\n. The PR itself looks good to me though! Nice work\n. Ah so it's the spec that's incorrect, not the implementation? If that's the case :+1: :ship: \n. Sounds good! Ship it!\nFTR: the first edge case is due to changes in 3.4.0\n\nWhen using colors in SassScript, the original representation of the color will be preserved wherever possible. If you write #f00, it will be rendered as #f00, not as red or #ff0000. In compressed mode, Sass will continue to choose the most compact possible representation for colors.\n. Can you be more specific about the regression? Does it break existing\nbehaviour? If so I'd say we wait for shipping this.\n\nIt's important we show stability so people aren't afraid to depend on us.\nI'll almost always err on the side of stability over new features.\nOn 15 Dec 2014 20:22, \"Marcel Greter\" notifications@github.com wrote:\n\nUnfortunately your quote showed me another regression, and not sure how\neasy this is to fix. To do it properly I probably have to add and pass a\nfew more tests that currently are not even in place. Souldn't be extremly\nhard, but this will take at least a few days till I can come up with a\nsolution for this.\nOr do you think we should still ship it in the current state? It is still\nbetter than before but not on par with the current sass implementation!?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/718#issuecomment-66967541.\n. If it's purely a matter of output formatting I'm fine with shipping with. AFAIK we never preserved output formatting and Sass only just introduced it as a 3.4 feature.\n. We should make another issue to track the \"preserve color formatting\" feature :+1: \n. Nice I'm surprised Ruby sass doesn't preserve rgba formats. \n\nLooking through the Ruby sass issues tracker I found this explanation.\n\nIn general, we try to preserve the user's input format for colors, but rgb(), rgba(), hsl(), and hsla() are kind of special cases. The Sass functions support a superset of the input their CSS counterparts do, and in some cases allow users to use new CSS syntax and have it compiled to a form that older browsers will understand. Although there are probably some cases where preserving the input format of these functions is safe, in general it would be risky and inconsistent, so we just don't do it at all.\n. :+1: :ship: :rocket:\n. Done!\n. Thanks!\n. Duplicate of https://github.com/sass/libsass/issues/700\n\nThis is fixed on master and will be out in 3.0.3.\n. Thanks @benesch. I believe this is related to #652 and #540. This is fixed on master and will be out in Libsass 3.0.3.\n. Spec added https://github.com/sass/sass-spec/pull/176\n. I've had a quick a look into this. The problem is in the parser.\ngetter()-1 => list(getter(), -1)\ngetter()- 1 => getter() - 1\ngetter() -1 => list(getter(), -1)\n. I have a fix for this in #733 but I'd prefer to wait til 3.1.0 is stable because it has potential to introduce subtle regressions.\n. Thanks @lunelson ! This is fixed and will be 3.1.\n. Yep the spec was wrong. It was fixed in a later commit.\nOn 18 Dec 2014 23:30, \"Micha\u0142 Go\u0142\u0119biowski\" notifications@github.com wrote:\n\nWait; the OP said that the output is supposed to have three out: 'found\ntrue'; rules; the attached output is describing current incorrect\nbehavior. Meanwhile, the test case added to sass-spec in\nsass/sass-spec#180 https://github.com/sass/sass-spec/pull/180 codifies\ncurrent behavior.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/736#issuecomment-67479631.\n. Specs added https://github.com/sass/sass-spec/pull/186\n. @pierremanceaux grunt sass is still using an older version of Libsass. This is fixed in Libsass 3.1.0.\n. Grunt-sass uses node-sass. You'll have to wait for node-sass 2.0.0 to go\nstable and open an issue with the grunt-sass team to update.\nOn 9 Jan 2015 21:02, \"Pierre Manceaux\" notifications@github.com wrote:\n@xzyfer https://github.com/xzyfer thanks for you quick answer :)\nJust to know, is it possible to update the version of libsass used by\ngrunt-sass?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/738#issuecomment-69314832.\n. Spec added https://github.com/sass/sass-spec/pull/197\n. This the intended behaviour as per the documentation - http://sass-lang.com/documentation/file.SASS_REFERENCE.html#variable_defaults_. This was fixed a couple days ago https://github.com/sass/libsass/pull/737.\n\nIt'll be in next RC of 3.1\n. Duplicate of https://github.com/sass/libsass/issues/736.\n. I presume where ignoring the AppVeyor build failures atm?\n. No error, it would just fail to match. I took a (really?) quick look for difference between the 6 and 7 arg versions.\nYou're probably right. I'll give it a shot.\n. We're committed to unordered_map at least for the foreseeable future so it's probably worth going all in on cpp11\n. Cool. It'd be good to have guidelines on what will cause pain for people in gcc <= 4.4.\n. Needless to say replacing things with C does not thrill me.\n. Thanks for bringing this up. @lunelson originally reported this in https://github.com/sass/libsass/pull/680#issuecomment-66451288 and kindly wrote specs https://github.com/sass/sass-spec/pull/170.\n. From https://github.com/sass/node-sass/issues/578\n\nOn that note, would be nice to have two options: output_indent_use_tabs (bool, default: false .. switches between \\t and ), output_indent_count (int, default: 2) and which are not mutually exclusive! Both options should be ignored in case of compressed output.\n. > But, does libsass implement features which aren't in ruby sass???\n\n@CaesarSchinas technically our current goal is to reach Ruby sass feature parity. We're even considering to remove non-standard Libsass only features in future releases to meet this goal.\n\nIf it's not particularly difficult I don't see anything setting this back from a feature on the next commit.\n\n@AndyF we're really focused on matching 3.4 feature parity. So although this feature may not seem too difficult it takes time away from that goal. That's not to say we won't do it, it's just not a priority at the moment. If you (or someone else) however creates a pull request it would go a long way to the consideration of this feature.\n\nFWIW I expect this could easily be achieved with a post processor like PostCSS or rework.\nAs with @hcatlin and @am11 I don't understand the usefulness of this feature, but if it's something people are asking for it's worth discussion IMHO.\n. @am11 I agree re: compressed output. It's worth considering though that Sass pre-dates CSS optimisers by a couple years so the feature made complete sense at the time.\n. ~~For reference:~~\n\n@import takes a filename to import. By default, it looks for a Sass file to import directly, but there are a few circumstances under which it will compile to a CSS @import rule:\nIf the file\u2019s extension is .css.\nIf the filename begins with http://.\nIf the filename is a url().\nIf the @import has any media queries.\nIf none of the above conditions are met and the extension is .scss or .sass, then the named Sass or SCSS file will be imported. If there is no extension, Sass will try to find a file with that name and the .scss or .sass extension and import it.\n\n\nNot related. Ignore.\n. Where is the previous discussion on this you've mentioned? I'm struggling to find documentation on how Ruby sass implements this functionality.\n\nIt's been officially roadmapped for Sass 3.4\n\nWas stated in https://github.com/sass/libsass/issues/318#issuecomment-39524306 but I see nothing related in the 3.4 changelog. Does Ruby sass have this feature without https://github.com/chriseppstein/sass-css-importer ?\n. Does that means it's in Sass at the moment? If so does this go against our road map for 3.4 compat, especially since the Ruby sass team has illuded that a new module system is on the cards for the next version. https://github.com/sass/sass/labels/%40import%20v2\nMy concern is that if we add this feat in this fashion it's going to become extremely difficult to deprecate, and become non-standard.\n. I guess my concern is not how easy it is to maintain or the size of the change, as much as it is diverging from Ruby sass. More so since Ruby sass may soon solve this in a different way. We are then stuck with supporting to two ways of doing similar things which will invariably be subtly different. \nThis sounds like a highly demanded feature which will mean people will depend on it. Once people are dependant on a feature removing it is a massive pain.\nGenerally speaking I try to have the mentality that any feature we add is essentially there forever.\nMy preference would be to start the discussion on with @chriseppstein and @nex3 on what imports v2 look be like and get a head start on implementing that. The demand for better imports is greater than say 3.4 query selectors (and probably less work) so it makes sense to prioritise IMHO.\nThoughts?\n. I think switching between Libsass and Ruby sass should be trivial for developers.\nWe should set the expectation that anything that works in Libsass works in Sass (and vice verse). This is why we're removing compact() (https://github.com/sass/libsass/issues/585) and image-url() (https://github.com/sass/libsass/issues/489).\nGenerally speaking if this were a feature Ruby sass was adamant to not implement and we wanted to it would be a different discussion. It's purely because that Ruby sass is seriously considering a solution to this that I'd encourage us to do it the one true way.\n. A compromise could be outputting a depreciation warning to the console when the CSS loading branch is reached, rather than transparently passing through.\nIt's another discussion, but we should figure out where the line in the sand is for nonstandard (read: not in sass) features.\n. :rocket: :shipit: \n. This has been niggling at me. The big reason being it introduces unexpected behaviour for people moving from Ruby sass to Libsass. I think we should definitely make this behaviour optional. \nI know this is not the behaviour I would want in my sass work, and I would need to opt out. I also stumbled across https://github.com/sass/libsass/issues/469 which indicates people are @importing .css files and not expecting inlining\n\nIn addition, It seems like in compressed mode, instead of the import statement I get the code of the source file. Is this the wanted behaviour?\n. My mistake I didn't notice the import was a url().\n\nOk I think I'm misunderstand this. I'm going show myself out now :)\n. I don't believe Libsass is bundled as a ruby gem. If it is it is done so by\nsomeone else.\nOn 8 Jan 2015 10:40, \"Marcelo Eden\" notifications@github.com wrote:\n\nwhen will this change be published on the sass gem?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/754#issuecomment-69112887.\n. @manuelro you'll a recent version of Libsass or node-sass@beta installed to use this feature.\n. Seeing ~ suggests your using an importer or webpack loader. I suspect\nthat's what is producing the error. I recommend strongly against rely on\nthis behaviour. It will be removed in future versions.\n\nOn 19 Aug. 2017 11:33 pm, \"Rex\" notifications@github.com wrote:\n\nI can see this was merged but it's not really working on my side.\nI'm using node-sass 4.5.3 which uses libsass 3.5.0.beta.2 and\n@import \"~vue-wysiwyg/dist/vueWysiwyg.css\"; works fine but\n@import \"~vue-wysiwyg/dist/vueWysiwyg\"; does not, saying\nError: File to import not found or unreadable:\n~vue-wysiwyg/dist/vueWysiwyg.\nParent style sheet: E:/project/assets/scss/vendor/_vendor.scss\non line 3 of assets/scss/vendor/_vendor.scss\n@import https://github.com/import \"~vue-wysiwyg/dist/vueWysiwyg\";\nAm I doing something wrong?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/754#issuecomment-323523441, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWNy-rs7z8Tpx3KvSNlQvCp2AGm8hks5sZuQygaJpZM4DLXct\n.\n. LGTM besides loosing the backtrace in @warning\n. :+1: :rocket:\n. I would opt for leaving this out of 3.1 because it feels ripe for introducing regressions we don't test for.\n. I'd feel more comfortable moving this to 3.2 (or 3.1.x) and stabilising 3.1. \n\n3.1 is already a massive update and I know there are a lot of subtleties around parsing - which worry me. I'll assign this to 3.2 if you don't mind.\n. The failure looks unrelated to cdbs. It looks like you don't have automake\ninstalled.\nOn 4 Jul 2016 10:21 PM, \"bhat3\" notifications@github.com wrote:\n\n@benjaoming https://github.com/benjaoming Just tried to backport it,\nbut cdbs comes in the way and when i blindly lower the version dependency\nin debian/control i got the following error. So it seems that we would need\nto backport cdbs as well, but for today i can't spend more time on it :(\nI: Building the package\nI: Running cd /build/_/ && env PATH=\"/usr/sbin:/usr/bin:/sbin:/bin\" HOME=\"/nonexistent\" dpkg-buildpackage -us -uc -rfakeroot\ndpkg-buildpackage: source package libsass\ndpkg-buildpackage: source version 3.3.4-1~trusty1~trio1\ndpkg-buildpackage: source distribution trusty\ndpkg-buildpackage: source changed by BHat3 bhat3@trio-group.de\n dpkg-source --before-build libsass-3.3.4\ndpkg-buildpackage: host architecture amd64\n fakeroot debian/rules clean\nsed -e 's/LIBPKG/libsass0/g' debian/control.in\ntest -x debian/rules\nrm -f debian/stamp-makefile-build debian/stamp-makefile-install\n/usr/bin/make  -C .  -k distclean\nmake1: Entering directory /build/libsass-3.3.4'\nmake[1]: *_\\* No rule to make targetdistclean'.\nmake1: Leaving directory/build/libsass-3.3.4'\nmake: [makefile-clean] Error 2 (ignored)\nrm -f debian/stamp-makefile-check\nrm -f debian/stamp-autotools\nrmdir --ignore-fail-on-non-empty .\nrmdir: failed to remove '.': Invalid argument\nmake: [makefile-clean] Error 1 (ignored)\nrm -rf autom4te.cache\nrm -f script/config.guess script/config.sub script/ltmain.sh m4/libtool.m4 m4/ltoptions.m4 m4/ltsugar.m4 m4/ltversion.m4 m4/lt~obsolete.m4 aclocal.m4 configure script/compile script/install-sh script/missing script/depcomp ./Makefile.in script/test-driver config.h.in config.log\nrm -f debian/copyright_newhints\nrm -f debian/cdbs-install-list debian/cdbs-package-list debian/stamp-copyright-check\nrm -rf \"debian/upstream-cruft\"\nrm -f debian/stamp-upstream-cruft\nrm -f debian/stamp-autotools-files\ndh_clean\nrm -f debian/stamp-local-shlibs-libsass\nrm -f script/config.guess script/config.sub\ntest ! -d script || rmdir --ignore-fail-on-non-empty script\nrm -f Makefile.am\n dpkg-source -b libsass-3.3.4\ndpkg-source: info: using source format3.0 (quilt)'\ndpkg-source: info: building libsass using existing ./libsass_3.3.4.orig.tar.gz\ndpkg-source: info: building libsass in libsass_3.3.4-1~trusty1~trio1.debian.tar.gz\ndpkg-source: info: building libsass in libsass_3.3.4-1~trusty1~trio1.dsc\n debian/rules build\nsed -e 's/LIBPKG/libsass0/g' debian/control.in\ntest -x debian/rules\nmkdir -p \".\"\n/usr/share/cdbs/1/rules/buildcore.mk:109: WARNING:  DEB_DH_STRIP_ARGS is a deprecated variable\nScanning upstream source for new/changed copyright notices...\nlicensecheck -c '.*' -r --copyright -i '^debian/(changelog|copyright(|_hints|_newhints))' -l '99999' * | /usr/lib/cdbs/licensecheck2dep5 > debian/copyright_newhints\n10 combinations of copyright and licensing found.\nWARNING: The following (and possibly more) new or changed notices discovered:\nLicense: UNKNOWN\n  Hampton Catlin, Nathan Weizenbaum, and Chris Eppstein and \u2026\n  2014-2015, Google Inc.; contributed by Alexey Sokolov <\u2026\nTo fix the situation please do the following:\n  1) Fully compare debian/copyright_hints with debian/copyright_newhints\n  2) Update debian/copyright as needed\n  3) Replace debian/copyright_hints with debian/copyright_newhints\ntouch debian/stamp-copyright-check\nmkdir -p \"debian/upstream-cruft\"\nmv Makefile debian/upstream-cruft/Makefile\ntouch debian/stamp-upstream-cruft\ncp -f GNUmakefile.am Makefile.am\ncd . && libtoolize -c -f\nlibtoolize: putting auxiliary files in AC_CONFIG_AUX_DIR, script'.\nlibtoolize: copying filescript/ltmain.sh'\nlibtoolize: putting macros in AC_CONFIG_MACRO_DIR, m4'.\nlibtoolize: copying filem4/libtool.m4'\nlibtoolize: copying file m4/ltoptions.m4'\nlibtoolize: copying filem4/ltsugar.m4'\nlibtoolize: copying file m4/ltversion.m4'\nlibtoolize: copying filem4/lt~obsolete.m4'\ncd . && aclocal-, -Im4 --install --force\n/bin/sh: 1: aclocal-,: not found\nmake: *** [debian/stamp-autotools-files] Error 127\ndpkg-buildpackage: error: debian/rules build gave error exit status 2\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/757#issuecomment-230278122, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe/AAjZWL9M3bccTGMEmpoS9xTzHtv-Gl8aks5qSPqzgaJpZM4DLsLG\n.\n. Spec added https://github.com/sass/sass-spec/pull/196.\n. Spec added sass/sass-spec#194\n. I'm unable to reproduce this issue in either Libsass 3.0.2 or the latest 3.1.0-beta.\n\nI believe node-sass@1.2.3 using Libsass 3.0.2. This may be a node-sass issue, please open an issue with https://github.com/sass/node-sass/issues.\n. Are you testing against master? This patch has not made it into an official release yet.\n. :+1: \n. :+1:\n. @mgreter can you please hold off on merging this for the time being. I'm in the process of making significant updates to the spec suite (https://github.com/sass/sass-spec/pull/207)\n. Ok sass-spec has been update! Rebuild this branch in CI and you're good to go!\n. I can also confirm spec/libsass-todo-tests/bourbon now passes with this patch. \nHowever spec/libsass-todo-tests/libsass/at-stuff was out of date. It's since been updated and is no longer fixed by this patch.\n. @mgreter do you want to merge your latest work and we'll ship 3.1.0-beta.2?\n. This is fixed and will be available in the first patch release of 3.1.\n. I agree sourcemaps need a lot of work. I also think we should have a way to ensure we're not introducing regressions with sourcemaps in CI. \nMaybe even something as simple and comparing the ruby sass sourcemap to the libsass sourcemap during spec runs...\n. To be clear I'm 100% onboard with your work improving sourcemaps. As far as I'm concerned you're the expert so go crazy!\nAs for ensuring sourcemaps stability in CI that is a pie in sky idea that I wanted you to be thinking about for when sourcemaps are stable. Messing up sourcemaps is something I worry about every time I work on a feature so a little peace of mind would be amazing.\n. :+1:\n. No. It will be in the first patch release 3.1.1 which will be out shortly\nafter 3.1.0 stable. I expect that release will be in the next week or two\nsince we already have PR scheduled for that release.\nOn 2 Jan 2015 05:00, \"Adeel Mujahid\" notifications@github.com wrote:\n\nWill this be available for v3.1.0?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/787#issuecomment-68493212.\n. Within the next day I'd say ;)\n\n(edited)\n. We have one final blocker for 3.1 IMO https://github.com/sass/libsass/issues/697#issuecomment-68502905\n. @mgreter you're correct. Sorry I got a bit overzealous\n. @mgreter I've had a look at this and after a clean recompile I can't reproduce the crash. It errors as expected with the following \n\n2px*px is not a valid CSS value\n. Interesting, I cannot produce this on that commit. I'm on OSX 10.9.5\n\nshell\n$ cpp --version\nApple LLVM version 5.1 (clang-503.0.40) (based on LLVM 3.4svn)\nTarget: x86_64-apple-darwin13.4.0\nThread model: posix\nshell\n$ sassc --version\nsassc: 3.0.2-14-g65d2\nlibsass: 3.1.0-beta.2-2-g420d\nsass2scss: 1.0.3\n``` shell\n$ (cd sassc; git rev-parse HEAD)\n65d2bdbb48987acb1e68dd926ed23d4f19ccc271\n$ (cd libsass; git rev-parse HEAD)\n420d7fb4e578857150e15d80c966e5cac779d932\n. @drewwells can you please run the commands in my previous message and update the output in your comment.\n.\n$ cpp --version\n$ sassc --version\n$ (cd sassc; git rev-parse HEAD)\n$ (cd libsass; git rev-parse HEAD)\n```\n. Could you please produce a gdb backtrace. Instructions on how to do so are here https://unix.stackexchange.com/questions/132192/running-application-ends-with-segmentation-fault/132193#132193?newreg=429090a85808440692bd71de25468216\n. Thanks for that!\nIt looks like Libsass is returning the correct error\n\n6  0x00000000007cf481 in Sass::error (msg=\"2px*px is not a valid CSS value\", path=\"stdin\", position=...) at error_handling.cpp:15\n\nAre you sure wellington is dealing with the Sass_Error objects correct?\nDo you still get segfaults with this code?\nscss\n@error(\"foo\");\n. Interesting. Cool sounds like @mgreter is on the case. I've gotten about as far as I can with it. Thanks for all your help @drewwells \n. Thanks @am11. Looks like @mgreter got to the bottom of it.\n. I appear to be having issues with the autotools builds https://travis-ci.org/sass/libsass/jobs/45523757\n. You're right I missed that file. That got me closer now I'm getting\n\n./.libs/libsass.so: undefined reference to `Sass::Cssize::fallback_impl(Sass::AST_Node*)'\n\nwith the AUTOTOOLS=yes COVERAGE=no BUILD=shared build. I'm not sure what I'm missing. I'll keep digging.\n. This is as good as it is gets. It's ready to go in 3.2 as soon as I can track down the compilation error in AUTOTOOLS=yes COVERAGE=no BUILD=shared\n. Superseded by https://github.com/sass/libsass/pull/800.\n. :+1:\n. Nice work!\n. @mgreter you can rebase out your commits and rebase of master instead to get those commits\n. This appears to be fixed in my tests :+1:\n. I have access to change the webhook. Do you know the correct webhook URL? I can't find anything in the appveyor ui.\n. OK updated!\n. Wow 1hr AppVeyor builds is a serious problem :-1: \n. It picked up the build fine. It actually just takes an hour to run all the tests.\n\n. Oh wow I just realised that's not even this branch :sob: \n. @am11 it appear altering that webhook url has broken our AppVeyor integration. Where did you find the that webhook URL in the AppVeyor interface?\n. Hmm I don't appear to have access.\nIt's building the releases but not pinging back to github and showing up in PRs.\n. @hcatlin can you please add myself and mgreter to the github sass team so\nwe can administer AppVeyor?\nOn 5 Jan 2015 06:39, \"Hampton Catlin\" notifications@github.com wrote:\n\nI just checked and the settings for libsass webhooks seem to match this.\nIs there anything you need me to do as an admin?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/794#issuecomment-68645738.\n. From gitter chat with @am11 \n@xzyfer, there is permission tab, which says administrators have full access (and no way to invite anyone). I think it is inheriting permissions from GitHub. Which makes sense because I can't find you guys here https://github.com/orgs/sass/people\n@andrew @hcatlin, guys please add @xzyfer and @mgreter to the Sass, the same way you added us; so their membership is visible via GH API.\n. Aha, success! Thanks @andrew it appear to have access now.\n. @QuLogic \nIt's simpler and 'DRY'er to have only one commit for a bugfix. Since the stable branch has only bugfixes, it should be a pretty simple merge in general. \n\nI completely agree. My concern is the need to merge stable -> master and master -> stable. Generally speaking it's cleaner, and less error prone to merge in one direction.\n@am11 I don't know that nightlies make a sense, but I'm happy to be convinced otherwise. AFAIK master should always be a passing build so it would essentially be the nightly branch.\n. Yeah either way works. I'm simply not a fan of merge commits (on busy branches). They increase the signal to noise ratio and make things like bisects (and other git forensics) a little more complicated than need be.\nI'm happy to try either approach. An alternative would be to have shorter lived branches per release i.e. 3.1.1 then merge that branch into master for the release.\nSass-spec makes things a littler tricker because once a spec has been activated all dev branches too have the patch/feature for that spec to pass builds.\n. @am11 I'm all for killing off old branches.\n@HugoGiraudel yeah that's pretty much the same thing. We can change the default branch to stable.\n. I guess I can boil down my concern to the following scenario.\nI'd done a major feature for bubbling media queries. Now that 3.1 is out I'd like to merge to so I can build on that work for at-root. However if when node-sass 2.0 is released, and a simple one line bug is patched, I don't want that massive feature being rolled out in say 3.1.1.\nDoing so risks introducing totally new regressions. One step forward and two steps back.\n. Considering the progress we've made on the 3.2 and 3.3 milestones this may be a moot topic for the time being. Closing.\n. We've recently seem demand for some way to back port patches to older versions. This is currently difficult to do.\nhttps://github.com/sass/libsass/issues/850#issuecomment-93575539\nhttps://github.com/sass/node-sass/issues/858#issuecomment-93570201\nAlternatively we could aim to do smaller incremental release which minimise the likely hood and severity of regression.\n. :+1:\n. Those lines cause errors which we cannot assert yet. I've left them in with\nthe appropriate error message for when we can.\nOn 2 Jan 2015 06:33, \"Adeel Mujahid\" notifications@github.com wrote:\n\n[image: :+1:]\n@xzyfer https://github.com/xzyfer, (just curious) what about those\ncommented lines in the test? Are they part of the spec?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/797#issuecomment-68495663.\n. I agree with @mgreter . I like the intent here but adding a new dependency isn't viable at this point in time.\n\nThere may very well be internal inconsistencies at times, but that doesn't matter as long as the output is correct for input supplied. All these use cases can and should be covered by sass spec.\n. As it stands I think this PR's commits need a tidy up. Two or three well written commits should get the job done whilst preserving appropriate forensic git information. I can assist with this is you need.\n. This is currently passing all the at-root specs. I'll do some clean but otherwise it's ready.\n. I managed to rebase this post-sourcemaps-mega-merge with relatively little pain. I now have a failing at-root spec though. Once that's resolved I'll ship this.\n. This is ready to go pending CI. I corrected some issues with nested output.\n. Thanks for catching the output stuff @mgreter I amended that commit. That has also broken generic at-rule output (more than I expected).  I was going to address at-rule bubbling and output in a different PR but I'll have to handle it here.\n. @mgreter any ideas why the AUTOTOOLS=yes COVERAGE=no BUILD=shared would be failing? \nI'm not familiar with autotools, and it onl fails on the shared build. This is the only thing holding this PR up.\nhttps://travis-ci.org/sass/libsass/jobs/45832632\n. Success!! Thanks for the find @QuLogic!\nI'll clean up this PR tomorrow.\n. This will land in 3.2 likely some time in Feb.\n. I spent about an hour looking into this. Our setup is exactly the same as node-sass. AppVeyor is pickup the builds, it's just not update the build status. I think issue may be on GH's end... maybe? i dunno\n. \n. FWIW @QuLogic this appears to have passed in AppVeyor https://ci.appveyor.com/project/sass/libsass/build/1.0.57\n. FYI: I confirmed our settings are the same as node-sass in both GH and AppVeyor yesterday.\n. @mgreter you'll need to log out of AppVeyor and re-login then select sass from the dropdown that appears.\n. https://ci.appveyor.com/project/sass/libsass/settings\n\n. Yes please! I've been doing it as I touch files\nOn 6 Jan 2015 06:54, \"Aaron Leung\" notifications@github.com wrote:\n\nYeah, I had been meaning to make this change -- I didn't know what the\nconvention was when I started the project!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/808#issuecomment-68766564.\n. Yes please! I've been doing it as I touch files\nOn 6 Jan 2015 06:54, \"Aaron Leung\" notifications@github.com wrote:\nYeah, I had been meaning to make this change -- I didn't know what the\nconvention was when I started the project!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/808#issuecomment-68766564.\n. That would be great. I'll be merging at-root in an hour or two.\n. Actually.. If you're not changing indentation of files I don't expect any\nconflicts with this. Just do it and I'll deal with it\nOn 6 Jan 2015 09:26, \"Marcel Greter\" notifications@github.com wrote:\n[image: :+1:]\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/808#issuecomment-68793448.\n. Should be fine. They're easy yo resolving and I have some rebasing to do\nany way.\nOn 6 Jan 2015 09:38, \"Marcel Greter\" notifications@github.com wrote:\nI'm also going to remove to guards in all cpp files! That could give some\nconflicts!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/808#issuecomment-68795086.\n. Ah ok. I thought you were talking about shipping the guards. I don't think sourcemaps will conflict too much since at-root is mostly new code, but it may break sourcemaps :/\n. Hmm your selector stuff might be an issue for at-root. Do you want to hold off on sourcemaps until I merge at-root? I'm going to be at a bit of a loss at how to get my stuff up to date with you change.\n\nIt'd be worth doing a wiki page about how to work with sourcemaps (in code) and typical gotchyas.\n. :+1: \n. This is a thing of beauty.\n. :+1: \n. @michaek it's be great to get some spec coverage over #548 and generally where & can be used as a value.\n. @sp90 it's hard to say at the moment. You can track the 3.2 progress here: https://github.com/sass/libsass/milestones/3.2\n. > IMO we are pretty much ready once we agree how to merge #927.\n:ship::rocket:\n\nSo IMHO we probably should plan to release 3.2 in the next days/weeks!?\n\nSounds great. @hcatlin and @am11 will be happy about this.\n\nThe only issue left in 3.2 Milestone is #871 \n\nI've had a look over the weekend. I know how to fix it but it requires some non-trivial refactoring of the extend visitor. I simply don't have time until April, and it's not a major issue. I'm ok with bumping it to 3.3.\n\n@xzyfer are you willing to compile the changelog once again for the next release\n\nYep, I'll knock it out in the next day or so.\n\nAlso should we do a beta release first? \n\nIIRC node-sass will be doing betas since their releasing a new major version. We should piggy back on this. /cc @am11 \n\nJust wanted to get this rolling!\n\n:rocket: :boom:\n. Also worth a mention, we added 66 new specs with ~270 extra assertions and skip 26 less specs.\n```\nmaster\n800 runs, 2115 assertions, 0 failures, 0 errors, 95 skips\n3.1.0\n733 runs, 1833 assertions, 0 failures, 0 errors, 122 skips\n```\n. Also worth a mention, we added 66 new specs with ~270 extra assertions and skip 26 less specs.\n```\nmaster\n800 runs, 2115 assertions, 0 failures, 0 errors, 95 skips\n3.1.0\n733 runs, 1833 assertions, 0 failures, 0 errors, 122 skips\n```\n. Thanks @mgreter! Sorry I haven't had the time to do it yet, will try to do so shortly\n. OK I've updated the release notes.\n. I've added some formatting to the release, emphasising the cool new features.\nI think we can release a 3.2.0-beta. Alpha doesn't make a lot of sense since very few people will use Libsass until it's hits the node-sass@3.0.0-beta\n. IMO :ship: those two outstanding issues.\nI suspect sass-spec will largely be re-written soon when the sass-spec directory structure changes.\n. 3.2.0-beta :wink: but otherwise :+1:\nSassC also needs a new release as well.\n. @scamden do you know which version of libsass you're using? Are you using it via sassc or a 3rd party like node-sass, grunt-sass, gulp-sass etc..\n. I believe the node-sass CLI has a version flag now.\nIf you could create a test case on http://sassmeister.com that'd be great.\nOn 7 Jan 2015 09:58, \"Sterling Camden\" notifications@github.com wrote:\n\ni'm using gulp sass, but i manually installed node-sass@2.0.0-beta, to\nget\nsome of your latest features, not sure which version they're using since\nit's not a node package, where could i find that info?\nOn 6 January 2015 at 14:56, Michael Mifsud notifications@github.com\nwrote:\n\n@scamden https://github.com/scamden do you know which version of\nlibsass you're using? Are you using it via sassc or a 3rd party like\nnode-sass, grunt-sass, gulp-sass etc..\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/813#issuecomment-68949953.\n\n\nSterling Camden\nSoftware Engineer\n502 Emerson Street | Palo Alto, CA 94301\n303.520.2968 | sterling@relateiq.com\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/813#issuecomment-68950334.\n. @scamden I can't reproduce this. Everything appears to be working in your gist. Try compiling the 3.1.0 stable release.\n. I can't reproduce it either locally or on sassmeister - http://sassmeister.com/gist/855ff3f3c38808f6fcdb\n\nI think you mean be running in to a bug with sassmeister. Try creating a new gist with Libsass.\n. I've confirmed the supplied code produces \ncss\n.myClass {\n  left: 3px;\n  bottom: 1px; }\nin Libsass 3.1.0-beta, 3.1.0-beta.2, and 3.1.0 stable.\n. - goto http://sassmeister.com\n- click the cloud icon > reset\n- click the cog > select Libsass\n- paste your scss\n. What is the expected output? \n. Apologies, I was running into the Sassmeister bug. It was showing me Libsass output to Ruby sass.\n. I've update the issue description to clarify the problem.\n. Thanks @am11 it was reported https://github.com/sass/libsass/issues/824 and closed a duplicate.\n. It gets tricky because our current practice is to name a spec after the issue.\n. Also the code supplied is generally not idea for a spec. The root cause has to be narrowed down and the spec made as simple as possible. This is important since we often debug tricky issues against spec so the less sass code the better.\n. This fixed and will be 3.2.\n. I've confirmed this issue is present on master.\nSpec added https://github.com/sass/sass-spec/pull/260.\n. This is a duplicate of https://github.com/sass/libsass/issues/813. Please follow the progress there.\n. You're best bet would be compile your sass files with Libsass directly to\nfind out which file it crashes on. Libsass should give some kind of error\nmessage. You can use gdb to get more information.\nAlternatively you could hold out for grunt-sass to update to Libsass 3.1.0.\nThey're waiting on node-sass which is currently in 2.0.0-beta so it\nshouldn't be long now.\nOn 8 Jan 2015 13:34, \"ChrissiQ\" notifications@github.com wrote:\n\nI'm using libsass with grunt-sass 0.17.0 and node-sass 1.2.3. I'm trying\nto port some code from ruby sass and compass, to libsass and bourbon, on\nWindows.\nI've come to this one which is a stumper.\nError: Attempted a typeid of NULL pointer!\nThere is no other information in this error. Is there a way to show a\nstack trace or anything... even just a line number. If this is all there\nis, it's going to be hard to debug this.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/825.\n. I'm closing this issue since there has been no reply. Feel free to re-open if the above doesn't help.\n. Spec added https://github.com/sass/sass-spec/pull/238.\n. This is fixed and will be 3.2.\n. Any objections to shipping this?\n\nPlease read the discussion in https://github.com/sass/libsass/pull/834\n. > The most efficient CSS minifier IMO and in my experience is\nThere's no right answer here, but this is certainly worth checking out. YMMV. https://github.com/GoalSmashers/css-minification-benchmark\n. This all sounds great. I'll take a closer look over the weekend. It'd be great to start merging bits and pieces of this work before it get stale.\n. Great work here @mgreter. I recommend rebase off master before this diverges much more. It'll also give a clearer indication as to which specs this fixes.\n. Please open this issue with in the grunt-sass issue tracker.\n. Can you please create a http://sassmeister.com/ the shows the issue?\n. Thanks for the clarification @umyeah. I can confirm that this issue is still present on master.\n. I've confirmed this is still an issue on master.\n. Spec added https://github.com/sass/sass-spec/pull/264\n. This is fixed and will be in 3.2\n. This is a known issue. It's fixed on master and will be 3.2.0.\n. @am11 @charset UTF-8 is omitted if there are no utf-8 characters in the output. This is by design.\n. @molily thanks for the bug report we'll aim to fix this in 3.2\n. Nice catch @mmaxim ! Was this code causing you actual issues? I ask because it'd be great to add a test spec that catches this crash.\n. Thanks for working on a test case. We really appreciate it.\nOn 22 Jan 2015 03:39, \"Mike Maxim\" notifications@github.com wrote:\n\nYeah this did cause a problem, which is how I stumbled upon it. It could\nmean there is a deeper bug int he parser to even get to that block of code\nin the first place, but I didn't look that hard (since this fix just made\neverything work for me). I'll work on getting a minimal test case.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/846#issuecomment-70871410.\n. @mgreter does this conflict with your work? If not lets get it shipped.\n. :+1: \n. Thanks!\n. It enables us to reach the largest audience. In our experience people tend\nnot to update their compilers. More often than not we're dealing with the\nOS default. Notably older CentOS users have very old compilers, lower than\neven we support.\nOn 20 Jan 2015 21:57, \"patlecat\" notifications@github.com wrote:\nCan I ask why libsass wants to be compatible with such an old compiler?\nWhat is the point?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/848#issuecomment-70636918.\n. The supplied code doesn't work in Ruby sass 3.4.9 - http://sassmeister.com/gist/705c078b1fba56e26077\n\nProduces the following error \n\nInvalid CSS after \"  @include \": expected identifier, was \"#{$asdf};\"\n. Can you please produce the entire output generated by npm install --verbose node-sass?\n. @mgreter this appears to be an issue with our json library as per https://github.com/sass/libsass/pull/1094\n. Thanks @Candid and @saper for your work!\n\nI merged @saper's because I thought there was value in keeping this comment, and since he rebased @Candid commit your both credited with the contribution.\n. Unfortunately Libsass isn't currently managed in a way that would make back porting patches possible without some major kludging. However we're about to release a new beta which will include this patch. I'll then promptly update node-sass.\nWe'll aim to address our process post 3.2.0 as per https://github.com/sass/libsass/issues/796\n. Thanks for reporting this @misscs. At root has only recently been implemented and won't be officially available until Libsass 3.2.0 is released.\nYou can compile master yourself if this is something you need urgently.\n. I believe this has been addressed in recent releases. grunt-sass is still using an older version of Libsass.\nYou can try putting your code into http://sassmeister.com/ to see if the error message are correct. If they're not please supply the save gist so we can investigate further.\n. grunt-sass is using the latest stable release of node-sass. That release of node-sass is compiled with an old version of Libsass.\nnode-sass has 2.0.0-beta which is using the latest release of Libsass. gulp-sass has update to this beta but grunt-sass has not. You can try to encourage the grunt-sass team to update to the node-sass beta. Unfortunately there API changes so just npm installing the latest node wont work.\nThere are some hold ups on the node-sass 2.0.0 stable release so it may still be some time before it's ready. https://github.com/sass/node-sass/issues/602\n. The problem with that code it that the pow function is a compass function, not a sass function.\n. Unfortunately it does - https://twitter.com/xzyfer/status/537481036687372288\n. Glad to help!\n. @anlutro could you please put together a http://sassmeister.com/ of the behaviour you're describing?\n. ~~Confirmed this still results in a segmentation fault on the latest master.~~\nThis appears to be fixed on the latest master and will be in 3.2.\n. I can confirm this error exists for the given code\n```\n@mixin vendor($property, $value...){\n    -webkit-#{$property}:$value;\n       -moz-#{$property}:$value;\n        -ms-#{$property}:$value;\n         -o-#{$property}:$value;\n            #{$property}:$value;\n}\n@include vendor(border-radius, 50%/20px);\n```\nHowever it's also errors in (differently) Ruby Sass 3.4.9 with Compass 1.0.1.\nhttp://sassmeister.com/gist/aaabebe4415533d805d5\n. I've confirmed this is an issue on the latest master\nscss\n@media screen {\n  .two {\n    @at-root .one {\n      background: blue;\n      .three {\n        color: red;\n      }\n    }\n  }\n}\n. It would appear so.\nOn 29 Jan 2015 01:49, \"Hugo Giraudel\" notifications@github.com wrote:\n\n@xzyfer https://github.com/xzyfer Does this mean I missed a case with\nmy @at-root test suite?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/859#issuecomment-71846052.\n. I've got a fix https://github.com/sass/libsass/pull/861.\n\nI don't have time to create the spec now, but when I do this is ready to go.\n. Spec added https://github.com/sass/sass-spec/pull/248\n. This is fixed and will be 3.2.\n. Spec added https://github.com/sass/sass-spec/pull/249\n. @anlutro I've merged your specs which now causes this PR build to fail. Could you please investigate?\nhttps://travis-ci.org/sass/libsass/jobs/48892884\n. Great work @anlutro \n. Thanks @asottile !\n. Are you using the latest gulp-sass? If not could you please update\ngulp-sass and see it the error continues.\nOn 2 Feb 2015 08:57, \"Reinier Kaper\" notifications@github.com wrote:\n\nI'm getting a \"bad allocation\" error when running gulp-sass, which uses\nlibsass.\nThis only occurs on my windows 7 machine (64-bit), but not on my iMac\nrunning Yosemite.\nI have a feeling it has something to do with maps. Is there any way for me\nto provide more details? The error message itself isn't very helpful.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/868.\n. Can you please post the code that was erroring? I think it's still a bug\nOn 2 Feb 2015 10:06, \"Reinier Kaper\" notifications@github.com wrote:\nOkay got it, it seems when looping through a map with @each, I need to\nspecify two variables, so the correct code would be:\n@mixin display-mq() {\n@each $name, $query in $media-queries {\n@media #{$query} {\n  content: '#{$name}: #{$query}';\n}\n}\n}\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/868#issuecomment-72390092.\n. Ah sorry I didn't see the edit via email. Thanks\n. Thanks @craigbarnes . You're correct the failure can be ignored for now.\n\nMerge this at your discretion @mgreter\n. Specs added https://github.com/sass/sass-spec/pull/252\n. Thanks for the reports. I'll try to get this into our next release.\n. @mgreter the way to handle this is by setting metadata on the extends in the cssize visitor. This isn't a difficult fix to the looks of it, I'm just not sure if I'll the time before 3.2.0. I'm pretty much out of action this month.\nYou can see the Ruby sass implementation in the cssize visitor and the actual error in the extend visitor.\nIMO this is non-critical and can be delayed to 3.3 if it's the only 3.2 blocker.\n. Rescoped to 3.4 since this doesn't prevent people migrating to LibSass from Ruby Sass.\n. Pardon my naivety, I work exclusively on language features.\nIt was my mistake above, but I believe we encourage using the Sass Importer API for overriding @import. I think this will get you most of the way there if I'm not misunderstanding.\n. Ah man sorry about that. Unfortunately I'm rather clueless about the API side of things. @mgreter should be able to answer any questions you have. Feel free to jump into the gitter also https://gitter.im/sass/libsass\n. @robbi5 this case is fix on master and will be 3.2.\n@rawalter21 this appears to still be an error. Can you please create a sass-spec? Here's an example of a good sass-spec PR https://github.com/sass/sass-spec/pull/239\n. Spec added https://github.com/sass/sass-spec/pull/255\n. This is fixed and will be in 3.2.\n. Ruby Sass 3.4.11 produces an error\n\nError: Invalid CSS after \"...in-height * 1.3\": expected \"{\", was \"\"\n\nI guess you could say the bug is that we don't throw an error here.\n. Yep you're right. There was a bug in my test script. Closing this.\n. I believe @mgreter has start heavily refactoring interpolation parsing and quote normalisation. Pieces of this work have already shipped in https://github.com/sass/libsass/pull/847.\n. Can anyone confirm whether this _ normalisation happens for other statement types i.e. mixins, variables, list keys/values, map keys/values, function/mixin arguments and parameters\nI'd rather fix these all at once.\n. This is the only reference I can find regarding this behaviour. \n\nSince the named arguments are variable names, underscores and dashes can be used interchangeably.\nhttp://sass-lang.com/documentation/file.SASS_REFERENCE.html#keyword_arguments\n\nI've found an old Sass issue (https://github.com/sass/sass/issues/334) and asked for clarification before I address this patch. \n. I've got an initial patch for this behaviour https://github.com/sass/libsass/pull/888\n@lunelson / @HugoGiraudel could one of you please create spec(s) address the dash-to-underscore behaviour? I expect this is only one of many cases we handle incorrectly.\n. I'll address this for mixins, functions and variables for now.\nOn 15 Feb 2015 21:04, \"Hugo Giraudel\" notifications@github.com wrote:\n\nI discussed this with @chriseppstein https://github.com/chriseppstein\non Hangouts a couple of days ago. At first, he told me variables only,\nbut I pointed out that it works for functions and mixins as well.\nPlaceholders being tied to usual CSS identifiers rules are not impacted.\nMap keys and values can be of any data-type so should not be impacted\neither.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/877#issuecomment-74411321.\n. Spec added https://github.com/sass/sass-spec/pull/258.\n. This is fixed and will be 3.2.\n. :+1:  this might also interested @chriseppstein for https://github.com/sass-eyeglass/eyeglass \n. Would this be a replacement/extension for custom functions? \n\nSeems like there is a lot of over lap between the two concepts, is there a clear differentiation?\n. Cool. This seems perfect for eyeglass. I can't wait to use it ;)\n. :+1:  I'll wait for 3.2.0. My first order of business is creating map-merge-recursive function! I'm excited!\n. Hi @phlorie \nThis is a known issue with node-sass https://github.com/sass/node-sass/issues/653. Currently node-sass@2.0.0-beta and below are not compatible with node 0.12.x or io.js.\nNode 0.12.x and io.js support will come in node-sass@2.0.0 stable.\n. If you down grade to node 0.10.x or use nvm to manage multiple node versions you you should be able to use grunt-sass. Otherwise follow https://github.com/sass/node-sass/issues/602 for when the 2.0.0 stable is released.\n. @GawainLynch I believe gcc 4.7 is the minimum required. Can confirm you had gcc 4.6 on the environments you tested this on?\nOtherwise LGTM.\n. I thought the 4.6 was the minimum but according @am11 it's 4.7. Update that\nfield and it's good to go.\nOn 6 Mar 2015 17:20, \"Gawain Lynch\" notifications@github.com wrote:\n\nDerp! The CentOS 6 build machine I used a patch similar to the one that\n@am11 https://github.com/am11 linked! I just retried on a vanilla\ninstall (gcc-* 4.4.7), and it indeed won't build.\nAs for CentOS 7, that comes with GCC 4.8. I think I put GCC 4.6 as the\nminimum from something in the docs somewhere, and don't have a 4.6 install\nhandy to test.\nShould I just bump this to 4.7?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/882#issuecomment-77512716.\n. @mgreter can we automate these version numbers like the make file?\n. @mgreter can we automate these version numbers like the make file?\n. Spec added https://github.com/sass/sass-spec/pull/253.\n. This is fixed and will be in 3.2.\n. Spec added https://github.com/sass/sass-spec/pull/254\n. This is fixed on master and will be in 3.2\n. I agree with @am11, I believe I may have originally instigated this report. IMHO it's poor UX to have to enable source_map if you've explicitly declared which type of sourcemap you want.\n\nDo we even need source_map? Is there a use case for declaring source_map that we cannot infer from other options?\n. Please confirm which version of grunt-sass and node-sass you have.\nOn 14 Feb 2015 04:37, \"Peter Keogh\" notifications@github.com wrote:\n\nI'm running libsass with grunt and I'm getting a segmentation fault:\ngrunt sass --trace\nRunning \"sass:dist\" (sass) task\nSegmentation fault: 11\nThis occurs after adding this to my main.scss file:\nimg {\n  filter: grayscale(0.5);\n}\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/886.\n. That version of node-sass uses a very old version of libsass that is no\nlonger supported. It's likely this issue has been in fixed in newer\nversions. Please update to the latest grunt-sass and try again.\n\nIf the latest grunt-sass is not using node-sass 2.0.1 please also open an\nissue on their issue tracker suggesting they update.\nOn 15 Feb 2015 02:52, \"Peter Keogh\" notifications@github.com wrote:\n\ngrunt-sass: 0.14.2\nnode-sass: 0.9.3\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/886#issuecomment-74380127.\n. I can confirm this error is present in Libsass master.\n. Spec added https://github.com/sass/sass-spec/pull/265/files\n. This is fixed and will be in 3.2.\n. Can you please provide a sassmeister gist showing the expected output of this code? Running this with Sass 3.4.9 locally produces the following error\n\nError: Invalid CSS after \"\": expected media query list, was \"\"(min-width: 48...\"\n        on line 14 of test.scss, in `respond-to'\n        from line 25 of test.scss\n  Use --trace for backtrace.\nThis code currently compiles on Libsass master, so there may in fact be a bug that prevents an error being caused.\n. Can you please provide a sassmeister gist showing the expected output of this code? Running this with Sass 3.4.9 locally produces the following error\nError: Invalid CSS after \"\": expected media query list, was \"\"(min-width: 48...\"\n        on line 14 of test.scss, in `respond-to'\n        from line 25 of test.scss\n  Use --trace for backtrace.\nThis code currently compiles on Libsass master, so there may in fact be a bug that prevents an error being caused.\n. Turns out this is a bug with your usage of the respond-to mixin. It expects the breakpoint values to be maps, not strings as shown in http://sass-guidelin.es/#naming-breakpoints. If you unquote your breakpoints it will work fine.\nI've opened an issue with sass-guidelines to track possible update to this documentation https://github.com/HugoGiraudel/sass-guidelines/issues/150 /css @HugoGiraudel .\n. Turns out this is a bug with your usage of the respond-to mixin. It expects the breakpoint values to be maps, not strings as shown in http://sass-guidelin.es/#naming-breakpoints. If you unquote your breakpoints it will work fine.\nI've opened an issue with sass-guidelines to track possible update to this documentation https://github.com/HugoGiraudel/sass-guidelines/issues/150 /css @HugoGiraudel .\n. Hi @camflan pardon my naivety around brew. I think sassc binds to whichever version of Libsass you have installed. I could be that your brew was out of date when pulling Libsass.\nPlease uninstall both Libsass and sassc, update your brew, and reinstall. After updating brew you should get these versions from brew info.\nbash\n$ brew info libsass\nlibsass: stable 3.1.0 (bottled), HEAD\nhttps://github.com/sass/libsass\nNot installed\nFrom: https://github.com/Homebrew/homebrew/blob/master/Library/Formula/libsass.rb\n==> Dependencies\nBuild: autoconf \u2714, automake \u2718, libtool \u2718\n$ brew info sassc\nsassc: stable 3.1.0 (bottled), HEAD\nhttps://github.com/sass/sassc\nNot installed\nFrom: https://github.com/Homebrew/homebrew/blob/master/Library/Formula/sassc.rb\n==> Dependencies\nBuild: autoconf \u2714, automake \u2718, libtool \u2718, pkg-config \u2714\nRequired: libsass \u2718\n\nIf you problem persists please let us know.\n. Thanks for the report @callmecavs . I can confirm this is still present on master.\nCould you please open sass-spec PR? Here's a good example to get you started sass/sass-spec#260\n. Thanks for the report @asottile . I can confirm this is still present on master.\nCould you please open  sass-spec PR? Here's a good example to get you started https://github.com/sass/sass-spec/pull/260\n. @asottile sorry I was under the mistaken impression a would be removed in non-compressed modes as well. You're correct we don't support compressed for specs. \nThere is currently work happening to better deal with output modes so hopefully this will be fixed as part of that. It's hard to say when that'll land though since these minor stylistic issues tend to be a low priority. \n\nAs an aside in my opinion compressed mode is best avoided (even in ruby sass) in favour proper css minifiers like http://cssshrink.com/. The compressed mode output is rather naive and leaves a lot on the table.\n. > just figured I'd be a good sumaritan and report\nThanks <3 !\n. Hi @kjbbb \nThe current stable release is 3.1 (https://github.com/sass/libsass/releases/tag/3.1.0) released on the Jan 2nd.\nThe compact() was removed a couple days ago and won't take affect until the 3.2.0 release. We will do what we can communicate breaking changes prior to the 3.2.0 stable release. However the removal of compact shouldn't affect you if you're using a stable release.\n. Hi @kjbbb, thanks for bringing this up. There's a couple things I'd like to address.\n\nI was recently thrown off by a change in the 3.0.1 which removed the compact() function\n\nThe compact() is still in stable Libsass. It wont be removed until 3.2.0 (the next release) and we will do everything we can to communicate the breaking changes.\n\na large interface change warrants a larger version bump\n\nAs per our roadmap (https://github.com/sass/libsass/issues/521) we're aiming for our 3.4 release to match the Ruby Sass 3.4. Unfortunately this means bumping the major version isn't an option for us, albeit appropriate thing to do.\n\nUntil we reach 3.4 it would be prudent to assume each new release is a potentially breaking change. We do beta releases to help mitigate issues with downstream consumers. If you want to be kept up to date on release you can watch this repository.\n. Thanks for the report. This is a duplicate of https://github.com/sass/libsass/issues/873\n. Please squash these commits before merging :)\n. Can you provide a list of specs that now pass due to this change? You may need to rebase master.\n. I think there's room to reduce the number of string types in the near\nfuture. It's getting a bit confusing. Do what you need to do and we'll come\nback and evaluate the situation when you're done.\n:+1:\nOn 22 Feb 2015 14:08, \"Marcel Greter\" notifications@github.com wrote:\n\nI finished the merge of my WIP branch. Although it currently only supports\nnested output and it probably is off by quite a bit. But everything is\nprepared to implement different output styles inside the Emitter class.\nNext I hope I can refactor my last part of my working WIP branch, becuase\nthat was actually the most dirty one. But I know it is doable via Emitter\nclass!\nhttps://github.com/mgreter/libsass/commits/refactor/output-preparation\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/899#issuecomment-75416890.\n. Some of these pass on master, however a few appear to be interpolation related and pass because of this PR :+1: \n\nI'll enable the passing tests on master. They're due to my recent normalization PR.\n. Enabled the specs that pass on master https://github.com/sass/sass-spec/pull/263.\n. @mgreter feel free to just do what you need to do, and merge at will. I'd prefer you just merge you changes incrementally (as long as specs are passing).\nFrankly there is no much going on here that it can't really be reviewed as is. At this point the best way forward is to merge as you feel comfortable and we can address an incremental work, or refactors as they come up. \n. >  If ok for you, I'll squash this whole PR into one commit and merge it and post other PRs accordingly!\n:+1: I'm keen to get this work over the line. Long lasting branches make me uneasy :)\n. Thanks for the report @febLey . This is a duplicate of https://github.com/sass/libsass/issues/548\n. IMHO for us it comes down to \"what does Ruby Sass do\" our aim is to be a drop in replacement for Ruby Sass. If this behaviour differs it should be addressed.\n. This has been fixed in and will be 3.2.0.\n. The only think that jumped out at me is https://github.com/sass/sass-spec/pull/270#issuecomment-76639465.  Otherwise :+1: \n. Amazing work @mgreter !!\n. Gosh VS is so picky ;)\n. Master fails to compile with clang now. This appears to partially fix this.\nfatal error: too many errors emitted, stopping now [-ferror-limit=]\n. Thanks for the report @soundstep. This is fixed and will be 3.2.\n. \\o/\n. I think you should move the example plugin out of root i.e. /examples/plugin/basic.cpp\nOtherwise :+1: \n. That'll work also\nOn 6 Mar 2015 16:57, \"Marcel Greter\" notifications@github.com wrote:\n\nActually I intended to remove it before I remove the WIP tag ...\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/919#issuecomment-77510964.\n. Awesome work @mgreter \n. Awesome work @mgreter \n. Thanks for the report @mdix. This has been fixed and will be 3.2.\n. I've looked further into it. This specific problem has been fixed in 3.1.0. If you update node-sass to 2.0.1 this will be fixed. Alternatively you could try inverting the @if\n\n``` scss\n@function z($layer) {\n  @if map-has-key($z-layers, $layer) {\n    @return map-get($z-layers, $layer);\n  }\n@warn \"No z-index found in $z-layers map for #{$layer}. Property omitted.\";\n  @return null;\n}\n```\n. Duplicate of #873\n. @blackfalcon you could implement this yourself with the custom importer API if you want to experiment with the idea\nhttps://github.com/sass/libsass/wiki/API-Sass-Importer\nhttps://github.com/sass/libsass/wiki/API-Sass-Importer-Example\n. :+1:\n. It's worth breaking this up into multiple PRs. Having PRs that fix multiple issues is messy IMHO and it means all these fixes can't be merged because of a single failing commit. This is also makes it difficult for me to figure out what I should be working without accidentally re-doing work you've done.\n. Yeah sure, it's just worth keeping in mind in the future. Since we're in different timezones we're likely to step on each others toes. It's worth just merge PR with small discrete chucks rather than large multi-purpose PRs IMHO.\nNice work on this!\n. After this is merged I'll update https://github.com/sass/sass-spec/pull/271 with those specs.\n. Agreed.\n. I've been thinking about this over night and I agree. The second case is\nclearly an error.\nOn 11 Mar 2015 08:58, \"Marcel Greter\" notifications@github.com wrote:\n\nClosed #930 https://github.com/sass/libsass/issues/930 via #932\nhttps://github.com/sass/libsass/pull/932.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/930#event-249703336.\n. The import example won't work in Ruby Sass because & have to be inside a\nblock eg. nested selector, mixin\nOn 11 Mar 2015 18:10, \"Andreas Lutro\" notifications@github.com wrote:\nDoes it work in ruby sass? I don't feel strongly either way about it\nworking or not, I only included it because I know it worked in previous\nversions of libsass.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/930#issuecomment-78215036.\n. Have you confirmed what you're trying to so is valid Sass?\n\nhttps://medium.com/@xzyfer/why-node-sass-broke-your-code-and-semver-1b3e409c57b9\nOn 28 Apr 2016 2:25 AM, \"Wills Bithrey\" notifications@github.com wrote:\n\nI've also been seeing this issue. Looks like the point at which this broke\nwas 3.3.5.\nI've been using gulp with node-sass and my test case compiles file with\nnode-sass 3.4.2 which I believe uses LibSass 3.3.2.\nWhen I switch to using node-sass v3.5.1(which uses LibSass 3.3.5)\ncompiling fails.\nHere is my minimal test case:\nhttps://github.com/WillsB3/node-sass-issue/tree/master.\n\u2014\nYou are receiving this because you commented.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/930#issuecomment-215138258\n. What are you expecting the result of html & to be?\nOn 28 Apr 2016 9:03 AM, \"Michael Mifsud\" xzyfer@gmail.com wrote:\nHave you confirmed what you're trying to so is valid Sass?\nhttps://medium.com/@xzyfer/why-node-sass-broke-your-code-and-semver-1b3e409c57b9\nOn 28 Apr 2016 2:25 AM, \"Wills Bithrey\" notifications@github.com wrote:\n\nI've also been seeing this issue. Looks like the point at which this\nbroke was 3.3.5.\nI've been using gulp with node-sass and my test case compiles file with\nnode-sass 3.4.2 which I believe uses LibSass 3.3.2.\nWhen I switch to using node-sass v3.5.1(which uses LibSass 3.3.5)\ncompiling fails.\nHere is my minimal test case:\nhttps://github.com/WillsB3/node-sass-issue/tree/master.\n\u2014\nYou are receiving this because you commented.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/930#issuecomment-215138258\n. Thanks for the report Hamish. This is a bug with the not keyword. It's\nfixed and will be in the 3.2.0 release.\n\n\nFor now quoting the key might work.\nOn 11 Mar 2015 20:32, \"Haemoglobin\" notifications@github.com wrote:\n\nOn node 0.12, Windows 7, with latest version of gulp-sass\nThe following works:\n$map: (\ntest: 1\n);\nThe following FAILS:\n$map: (\nnotest: 1\n);\nIf you have a sass map, where a key in the map starts with 'no' - then you\nwill see the following error:\ninvalid unordered_map key\nWhat would cause this? Can this be fixed but even better could the error\ngive more information?\nThanks,\nHamish\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/934.\n. I think you nailed it :wink:\n\n\n. Could we use more descriptive members. text vs message aren't really useful. Can call it formatted or fancy (joking, not joking) ?\n. Thanks for the report @anlutro. I can confirm this is still an issue. Please pay close attention to the new sass-spec issue format i.e. https://github.com/sass/sass-spec/tree/master/spec/libsass-todo-issues/issue_823\n. We should bake this into sass-spec cli?\nsass-spec init --path ....\nsass-spec init --issue 123\n. Spec added https://github.com/sass/sass-spec/pull/277\n. Although the error condition was fixed in 3.2. the output is still incorrect. The upcoming 3.3. will pass the spec for this issue.\n. Spec added https://github.com/sass/sass-spec/pull/278\n. There used to be a couple specs dealing with windows line ending but I fear that may have broken since we've auto generated the specs a couple times recently.\n. The fix for this is only in Libsass >= 3.2.0-beta.3, and not in any node-sass release.\nIf you can reproduce this issue in Libsass@3.2.0-beta.4 please let us know and we will reopen this issue.\n. @ajjublr please don't comment on closed issues. Create a new issue showing the extend code that isn't working.. LGTM! also...\n\n28 min 53 sec\n:sob: \n. :heart_eyes: :heart_eyes: :heart_eyes: \n. Is this ready to go @am11 ?\n. :boom: great work!\n. Interesting looks like there is no spec that covers this.\nOn 15 Mar 2015 02:20, \"Adeel Mujahid\" notifications@github.com wrote:\nTest http://sassmeister.com/gist/3e38a9c489a9627ffa9d:\n.a {\n  b:c;\n  d:\n}//  see^ even the markdown notifies that something is wrong! (8\nlibsass 3.2.0-beta.1 outputs:\n.a {\n  b: c; }\nruby-sass 3.4.12 errors:\nInvalid CSS after \"  d:\": expected expression (e.g. 1px, bold), was \"}\"\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/945.\n. Spec added https://github.com/sass/sass-spec/pull/276\n. Yeah we don't trap specs, but it's nice to have those spec around so we have an idea of how important feature it is. Also there's work happening to re-do sass-spec so having these issues open is good for feature completeness. \n. Hi Denis,\n\nWhich version of Libsass are you using?\nI believe this is fixed in 3.2.0-beta.1 but I'll have to wait til I'm at a\ncomputer to confirm.\nOn 15 Mar 2015 05:44, \"Denis Mir\" notifications@github.com wrote:\n\nThe result of string-slice(\"scale-0\", 7) is an empty string. When using string-slice(\"scale-0\",\n6) I'm getting back the correct -0.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/946.\n. I can confirm this is fixed in the current 3.2.0-beta.\n. Thanks for the report @mechanicalduck.\n\nI'm unable to reproduce this in 3.2.0-beta.1\n\u279c  libsass git:(master) \u2717 sassc -v\nsassc: 3.1.0-13-g4e9a\nlibsass: 3.2.0-beta.1-3-gdea2\nsass2scss: 1.0.3\n\u279c  libsass git:(master) \u2717 sassc test.scss\n10% {\n  color: red; }\nCould you try you try a fresh compilation (make clean && make) and see if this issue still persists?\nIf so please provide the environment you're running on.\n. You're correct, apologies. I was using the sample code supplied.\nCould you please create a [sass-spec](https://github.com/sass/sass-spec] for this issue? You can use the following as a good template https://github.com/sass/sass-spec/tree/master/spec/libsass-todo-issues/issue_823\n. For reference this is the @keyframes grammar\n```\nkeyframes_rule: KEYFRAMES_SYM S+ IDENT S '{' S keyframes_blocks '}' S*;\nkeyframes_blocks: [ keyframe_selector '{' S declaration? [ ';' S declaration? ] '}' S ]* ;\nkeyframe_selector: [ FROM_SYM | TO_SYM | PERCENTAGE ] S [ ',' S [ FROM_SYM | TO_SYM | PERCENTAGE ] S ];\n@{K}{E}{Y}{F}{R}{A}{M}{E}{S}   {return KEYFRAMES_SYM;}\n{F}{R}{O}{M}                   {return FROM_SYM;}\n{T}{O}                         {return TO_SYM;}\n```\nFrom http://www.w3.org/TR/css3-animations/\n. I'm not surprised this is difficult. My initial impression was that this is related to https://github.com/sass/libsass/issues/442.\n. This fix was a false positive due to https://github.com/sass/sass-spec/pull/380. The spec still fails.\n. Hi @1xProgrammer ,\nThe parser has three noteworthy points of interested.\nparse - the initial entry point. This looks at document level (unnested) blocks like mixin declaration, function declaration, rulesets, directives, and comment blocks (to name a few)\nparse_block - the entry point for blocks that are nested. Very similar to parse but covers more cases.\nparse_list - this is the entry point for most values. In Sass all values are lists i.e. a number is a list of 1 number value. All values are essentially decorated into a list on the way out of the parse_list call stack. \nSo for primitive values you'll see stack like parse_list -> parse_.... -> parse_value. As the stack unwinds the AST node will be decorated into a list.\nI hope this helps you on your way!\n. Feel free to jump into the Libsass gitter to discuss internals further https://gitter.im/sass/libsass\n. @archgrove thank you for this report. Let me clear a couple things up.\n\nit compiles well on codepen\n\nCodepen uses Ruby Sass not Libsass which is why your code works there.\n\nI can't understand why, a couple of months ago, I was able to compile it.\n\nIt sounds you were using Ruby Sass, not Libsass. Libsass is not yet at feature parity.\n\nYou can close the issue\n\nI've reopened this issue because as @mgreter pointed out this is a missing feature. \nWe will keep this issue open until it has been added in Libsass.\n. Yep, good catch @mgreter.\n. Spec added https://github.com/sass/sass-spec/pull/258\n. I don't think this is correct. @keyframes do not have selectors, they have a value/label that is a string. \nWe should just resolve the interpolate value.\n. @mgreter I say leave it for now. I'll take a pass doing naive interpolation expanding. If it works as expected I'll use that otherwise I'll ship this.\n. I'll take a look at this over the weekend. I think it's rather straight forward.\n. :+1:\n. I think this is fine to ship in 3.2. it'll give us a chance to fix any gotchya in 3.3. :ship:\n. Can you document the changes to the lexer? peek vs sneak vs peek_css vs lex_css.\nIf it's just about handling the \"consume all whitespace/comments\" behaviour then I would opt to keep peek and lex, and instead remove this frustrating behaviour.\n. Yeah I agree this is important. Could you add comments to the function signatures describing when to one over the other? \nIt's something I know I'm likely to forget, and it'll certainly trip up new contributors.\n. I think it's more clear now :+1:  nice work!\n. Yep :ship:\n. You can't understand my excitement to see movement on this @ekskimn. I'll dig into it soon.\nThis may be of interest to you @1xProgrammer.\n. > how concerned should I be that the coverage decreased\nThis is almost certainly because you've added more code that is covered by our current active specs.\n. I don't have a whole bunch of time atm, it's conference season for me. I'll take a look over the weekend at the latest.\n. Some of the specs for this feature are segfaulting. \nSome are only failing due to whitespace issues (:tada:).\nThese tests wont run in CI because they're disabled.\nYou can run them locally checking out sass-spec and running the following\nruby sass-spec.rb -c /path/to/sassc -s spec/libsass-todo-tests/selectors\n. Apologies for the nitpicks. \nIMHO conventions are hugely important, more-so in open source code bases where people have limited time to contribute and want to know \"the right way\" to do things.\n. I'm off for now. I'll take a closer look at the contextualize changes ASAP.\n. Could you tell me the thinking behind subclassing contextualize? \nI haven't looked at the implementation yet\n. @ekskimn the specs for this feature (spec/libsass-todo-tests/selectors) aren't run in CI because they're disabled. Specs with todo in their path aren't run. It's not an ideal flow, but once the specs are passing we activate the spec to run in CI.\n. @ekskimn thanks for the clarification. \nSounds like the two contextualize classes could be merged with the addition of a messy if branch. Not saying we should branch.\n. @ekskimn I don't disagree. I am however weary of having the two classes coexisting, and no clear distinction in when to use on over the other. It's the kind of that'll trip people up, especially new contributors. Honestly I'm not 100% clear myself just yet.\nI'd prefer it was clearer when to prefer one over the other. I don't have a solution atm :)\n. ~~Apply this patch get all specs baring the mixin-argument passing (minus the debug include)~~\nUpdated below\n. I got the test passing with this patch. It needs some cleaning up but it's 2am here. \nThen I'd feel pretty comfortable getting this shipped if you\n- apply my patch\n- squash commits\n- do some tidy up\n/cc @hcatlin (this may interest you)\n. @ekskimn can you please squash this commits.\nAFAIK I see the outstanding todos:\n- [ ] listize to handle the rest of the selector nodes\n- [ ] determine if we can simplify the contextualizers.\n. I tried a couple strategies for squashing this branch but the merge commits caused too many conflicts.\nFor the sake of simplicity I've created a fully squashed patched rebased off the latest Libsass master.\n```\ncd libsass\nSync you master with the latest Libsass master\ngit remote add libsass https://github.com/sass/libsass\ngit pull --rebase libsass master\ngit pull --rebase\ngit push -f  # to rewrite the history\nUnstage your changes and create a new commit\ngit checkout parent-selector\ngit reset --hard master\ngit clean -fd\ngit apply /path/to/complete.patch\ngit add .\ngit commit -m \"Support parent selector & in values / and/or interpolations\"\nrewrite history\ngit push -f parent-selector\n```\n. Yeah the merge commits really mad a mess of the branch. To be honest I'd just create a new branch and apply the patch from my previous comment. \nMake sure you sync you master with the latest Libsass master first.\ngit remote add upstream https://github.com/sass/libsass\ngit fetch upstream\ngit merge upstream/master\ngit push\n. Also, congrats on the new place.\n. Superseded by https://github.com/sass/libsass/pull/965\n. Great work @onedayitwillmake! I left some feedback\n. @am11 https://github.com/sass/libsass/releases/tag/3.2.0-beta.2\n. Great! There's still some clean to do, but I can deal with that once this is merged.\n. Specs activated https://github.com/sass/sass-spec/pull/280.\n. Off the top of my head:\n- my listize class still needs work. \n- I still want to look at consolidating the contextualizers.\nYou've done great work here.\n. Just triggered a rebuild of this PR with the specs activated. This should give us updated coverage metrics.\n. Mm looks like something has gone weird with the patch. Looks like branch is backing out some recent changes on master.\n. Merge commits really make a mess of things. I'm not sure any amount of git magic is going to put this right.\nHate to be a pain @ekskimn but can you to make a clean branch and just manually create a new commit with your changes (and my listize patch) from this diff? \nThere's a bunch of stuff on the branch now that shouldn't be there i.e. changes to appveyor and relative path fixes.\n. This also doesn't belong https://github.com/sass/libsass/pull/965/files#diff-f2d6a4d46b2aeaccd8ce40e4d3ea753dL114\nMaybe you can cherry-pick then squash these commits into this commit?\n76b5ef7355eb840127b7ce3d77364028c6ab06b3\n8f36c759d7192738e7fee0706008a91abddc4cd6\n. Looks like it's just the changes that hit master after I created my patch.\n. If you know how to interactive rebase, you could just edit that commit and remove the following changesets 76b5ef7, 8f36c75.\n. Did you update the commit, or did opening and closing the issue cause CI to kick off again?\nI still see those unwanted changes.\n. You have two options.\n1) do an edit, undoing those changes, and commit.\n2) create a new commit undo those changes, the do a fixup\n. FWIW cherry-picking wont work because of the rebase. Git knows you've already got those commits so it wont re-add them.\n. If you give me commit access to your fork I can fix it up for you :)\n. Apologies for all the mess.\n. Oh it looks like you've added a new merge commit instead of squashing. I've opened a new PR https://github.com/sass/libsass/pull/966 with everything squash and your author info intact.\n. Once again great work here @ekskimn! I'll merge this once CI passes.\n. No worries! Feel free to join our gitter (https://gitter.im/sass/libsass) and we can catch about how to avoid merge commits :)\nUnfortunately the really mess up the git history and make it have to back out changes or forensically figure when something broke.\n. /cc @am11 can you please check I've Visual Studioed correctly w.r.t Listize?\n. @am11 me neither. I just greped for cssize and did the same. I'm pretty sure when I wrote cssize I just greped for expand... etc..\n. #963 would be great! I'd make sure to start with a thorough spec suite first.\n. This should probably be fixed for 3.2.0. Is that possible @mgreter ?\n. If I'm understanding correctly.\nExecuting the following via the C API produced the expected Sass @error but sass_context_get_error_status returns 0.\ncss\na { @error 'foo'; }\nHowever creating a custom function which throws a sass_make_errornow sass_data_context_get_context returns 1. \na { content: foo(); } // foo is a custom function;\nIt appears that @error does not return a valid error exit code. I can reproduce this sassc as well.\n``` bash\n$ sass test.scss\nError: bar\n        on line 2 of test.scss\n  Use --trace for backtrace.\n$ echo $?\n65\n$ sassc test.scss\nError: bar\n    on line 1 of test.scss\n$ echo $?\n0\n```\n. I agree with @asottile this is really important. People using Sassc in their CI environments need to know if their Sass failed to compile. That almost always done by looking for non-zero exit code. I don't think the code itself matters, as long as it's non-zero.\n. At the very least the sassc example I showed is critical IMO.\n. Sorry for not being clear, this is a problem in sassc with the latest Libsass.\ncss\nfoo {\n  @error(\"bar\");\n}\n``` bash\n$ sass test.scss\nError: bar\n        on line 2 of test.scss\n  Use --trace for backtrace.\n$ echo $?\n65\n$ sassc test.scss\nError: bar\n    on line 1 of test.scss\n$ echo $?\n0\n```\nMaybe it's a separate issue, but at the very least I see this use case as critical.\n. Looks like it's always been that way, but @error was only introduced in the last version.\n. The sass @error directive was introduced in 3.1.0. It never returned the correct (non-zero) error code. That's the bug I'm concerned about.\nAs you said custom functions are experimental so I'm not concerned. SassC however isn't.\n. IMO we should aim to get this in 3.2.0. Without it SassC is pretty much useless for companies with CI environments, because there's not clear way to determine if compilation failed.\nBut yes, if it's too difficult to fix we'll have to figure out a way forward for SassC at least.\n. No objections from me /cc @mgreter \n. I've tried getting Xcode to play nice with Libsass to no success. I see this as no different the Visual Studio files we have. If this works I'll be over the moon! :+1: on the wiki page also\n. I believe Travis no has beta OSX support we may be able to use.\n. It exists but you have to directly apply and they may let you use it. The node-sass team tried but their OSX builds don't support node (IIRC). It might be easier for us since we're C++ but even so I'm not sure we can test Xcode directly. http://docs.travis-ci.com/user/osx-ci-environment/\nTBH if this works I'll probably switch to using Xcode so I'll know if it breaks.\n. I've requested OSX support for the sass/libsass repo.\n. We now have osx support enabled. In theory it should \"just work\".\n. @onedayitwillmake if you revert your latest travis changes and just add the osx os it should work now with the objective c hack.\n. I've emailed the Travis team to confirm that building against multiple OSes\nis actually possible. Will update when I get a reply.\nOn 1 Apr 2015 11:30, \"Mario Gonzalez\" notifications@github.com wrote:\n\n@mgreter https://github.com/mgreter Any advice, it appears that for now\nwe cannot satisfy Travis (cannot trigger OSX unless lang is set as\nobjective-c, not setting the language to cpp causes build failure for\nlinux)?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/968#issuecomment-88293075.\n. ~~@onedayitwillmake yeah I get that. However ideally we want to be able to run both Ubuntu and OSX CI builds.~~ \n\n~~Correct me if I'm wrong, but triggering OSX builds is current an all or nothing deal right?~~\nNevermind, we appear to be getting both OSX and Ubuntu CI builds atm. Is the current OSX build failure legitimate? https://travis-ci.org/sass/libsass/jobs/55675938\nLooks like ./script/ci-build-libsass needs to install brew\n. I'm all for this, largely for this reason\n\nThe benefit is more for users on OSX, to be able to contribute to the project using xcode along with the LLDB debugger by simply pulling the repo down and opening the project file.\n\nI know I have tried to get this working myself. My xcode-fu is terrible. We essentially do this already for MSVC. As for where the files go I don't any opinions as long as it just works. Ideally xcode is treated as a first class citizen like MSVC. \nIf this works I would use is immediately.\n. :-1: to ./xcode/ for consistency\nOn 3 Apr 2015 09:13, \"Marcel Greter\" notifications@github.com wrote:\n\n@xzyfer https://github.com/xzyfer If you are using the files yourself I\nsee it much more positive, since I hope in that case they will not get\nstale very soon. I guess you personally don't get any benefit if we add it\nto the CI process? So I think it should go either into ./xcode/ or\n./contrib/xcode/. The first one would be more similar to how we have MSVC\nbuilds in the tree. And for their alphabetical neighbourhood, I'm actually\nin favor of that. IMO the tree structure is a mess already, so no harm done [image:\n:smile:]\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/968#issuecomment-89059819.\n. Looks legits. Really bums me out we can't test these things.\n. Am I correct in remembering that error give us the backtrace trace that you've removed?\n. Yeah cool just wanted to make sure backtraces were maintained. It's hard to tell from the example since there's not nesting to unwind.\n\nI have confirmed this is the case - https://github.com/sass/libsass/blob/master/error_handling.cpp#L14-L21\nGreat work! Thanks!\n. @mgreter any ideas here?\n. This appears to be failing CI\n. Listize turns selectors into Sass lists. It's needed when selectors are being used as Sass values i.e. variables, function/mixin arguments etc.\n. :+1: I have more work to do here but this is a good start\n. I started looking at this last week. I've been bogged down this week but I think I'm close. I'll take a look this weekend.\n. We need to be careful here. Optional and variable-length parameters can be mixed, but only in specific orders i.e. variable-parameters can follow optional parameters but not the other way around.\n. Sorry I've been offline running a conference. I'll catch up today.\n. LGTM, nice one\n. @mgreter I looked into this a while ago, it's much more involved than what has been done here.\n\nFor intents and purposes the /deep/ combinator acts like the direct sibling combinator except for the shadow dom. 3.2.4 Selecting Through Shadows: the /deep/ combinator.\n\nEssentially /deep/ needs to be treated exactly the same as +. \nThis is a relevant specs - https://github.com/sass/sass-spec/blob/master/spec/libsass-todo-tests/scss-tests/175_test_reference_combinator_with_parent_ref/input.scss\n\nAlso /deep/ is a reference combinator as defined in CSS Selectors Level 4.\n\nThe reference combinator consists of two slashes with an intervening CSS qualified name, and separates two compound selectors, e.g. A /attr/ B.\n\nWe need to handle generic reference combinators, not just /deep/.\nThis is a relevant spec - https://github.com/sass/sass-spec/blob/master/spec/libsass-todo-tests/scss-tests/117_test_selector_interpolation_in_reference_combinator/input.scss\n. @saper is this still relevant? If so please rebase off master.\n. @saper is this still relevant? If so please rebase off master.\n. Ping ^\n. I think agree with @mgreter. We don't have the issues nullptr is intended to fix.\n. Tracking in https://github.com/sass/libsass/issues/1657\n. Apologies if I've missed something, I'm just catching up on all the recent changes.\nI think we may have prematurely over-engineered the extensibility points. I think it's worth stepping back and questioning do we really need custom functions, importers, and headers? And what are the real world usecases they solve?\nI'm struggling to see what the usecase for custom headers is? As @chriseppstein has mentioned custom mixins don't really make sense.\n. For the time being it's my opinion we should disable custom headers in 3.2.0. \nLet's open an RFC to discuss the intention, usecases, and implementation of this feature. The C API is quickly becoming a major feature of Libsass and it's worth doing the due diligence on changes and features - this is especially important in cases where there is no Ruby Sass / Compass equivalent.\nIt's probably worth also opening an RFC regarding importer weights. I agree that it should be a list, rather than weighted. The pragmatist in me sees this quickly becoming a race to the top ala z-indexes.\n. Since this has been merged lets continue the custom import discussion to https://github.com/sass/libsass/issues/1034\n. :+1: \n. Could you add a spec for this to prevent future regressions?\n. I think this can wait. It's an edge case case. Now is probably a good time\nfor a feature freeze, thoughts?\nOn 3 Apr 2015 09:25, \"Marcel Greter\" notifications@github.com wrote:\n\n@xzyfer https://github.com/xzyfer should we include this in next\n3.2.0-beta.5 release?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1010#issuecomment-89063179.\n. Lol technicalities. Ship it.\nOn 3 Apr 2015 21:17, \"Marcel Greter\" notifications@github.com wrote:\nI wanted to have the real feature freeze when the next node-sass beta is\nout. As I have written in #1020\nhttps://github.com/sass/libsass/issues/1020, we should create a new\nbeta once node-sass is ready to release its next beta. IMO we can add a few\nmore bugfixes until then. But from then on I would say we close the window\nand really only commit bugfixes. BTW. the original issue was marked as a\nbug, so technically this is a bugfix [image: :wink:]\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1010#issuecomment-89246864.\n. Yeah my bad :)\n. Haha the code was right which is the important part :) I've amended the commit message.\n. If you've got the time go for it :)\nOn 4 Apr 2015 06:24, \"Eric Kimn\" notifications@github.com wrote:\n@xzyfer https://github.com/xzyfer Want me to take this?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1016#issuecomment-89396861.\n. Sure thing, updated to 3.2.1\n. @onedayitwillmake the build is failing because the branch in unmergable. Rebase of the lastest sass/libsass#master and it should work. \n\nPlease do not merge master into your branch, it messes up the git history and makes git forensics nearly impossible.\n. Superseded by https://github.com/sass/libsass/pull/1064\n. @mgreter and I agreed to a feature freeze today so I guess that means we\ncan ship the rc.\nOn 5 Apr 2015 00:34, \"Hampton Catlin\" notifications@github.com wrote:\n\nI'm at Camp Sass right now in Atlanta, and it would be the COOLEST THING\nEVER, to announce rc2. ;)\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1020#issuecomment-89578432.\n. @mgreter I've run into a regression due to the variable scoping feature. I'm trying to create a test case now. AFAIK that's the last blocker.\n. Okay gang, update time. I've spent the weekend clearing out the recently reported regressions. \n\nWe're now down to one remaining issue #1115. It has an outstanding PR #1118 which is not currently passing the spec.\n. 3.2.0 has been released.\n. Nice!\n. > Actually we should probably try to disable gcc build, since gcc seems to be just an alias for clang on OS-X (which makes sense).\nAgreed.\n. Rescoped to 3.4 since this only affects insignificant whitespace and as such doesn't prevent people migrating to LibSass from Ruby Sass.\n. @mgreter good news!\n. @mgreter did you end up making a PR for this? Looking to get 3.2.5 out the door ASAP.\n. Done in https://github.com/sass/libsass/pull/1299\n. cssize is pretty much a one to one port of the sass cssize.rb. I'm very hesitant to make changes to cssize that cause it to diverge from the reference implementation until we have parity.\n. @chriseppstein has suggested this may be a bug in the Ruby Sass implementation. We'd be better served fixing the issue on their end.\n. @chriseppstein has confirmed the double newlines are a bug in Ruby Sass but a low priority. We'll wait for this to addressed upstream.\n. I don't think there is anything we need to do here. These new lines have no semantic meaning. Sass spec normalises new lines which means this spec is currently passing.\n. Ideally yes. In reality some things aren't possible without matching the\nRuby Sass data structures which some times isn't practical in c++. In this\ncase the duplicate new lines happen some what unpredictably. With matching\nthe Ruby Sass AST we'd never get it 100% correct.\nOn Mar 21, 2016 9:49 AM, \"Micha\u0142 Go\u0142\u0119biowski\" notifications@github.com\nwrote:\n\nThese new lines have no semantic meaning.\nThat's true but the idea was that libsass should match Ruby Sass output\neven with whitespaces, wasn't it?\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1030#issuecomment-199054185\n. Seems to work :+1:\nOn 3 Apr 2015 09:25, \"Marcel Greter\" notifications@github.com wrote:\n@xzyfer https://github.com/xzyfer should we include this in next\n3.2.0-beta.5 release?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1032#issuecomment-89063137.\n. Maybe this is best left for when selector functions lands.\nOn 3 Apr 2015 09:25, \"Marcel Greter\" notifications@github.com wrote:\n@xzyfer https://github.com/xzyfer should we include this in next\n3.2.0-beta.5 release?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1033#issuecomment-89063059.\n. Cool, go for it. I just thought it might be a risky change but it seems fine\nOn 3 Apr 2015 21:03, \"Marcel Greter\" notifications@github.com wrote:\nI actually thought it would make sense to have it merged before selector\nfunctions, since it could possibly have an impact there (they may suffer\nfrom the same bug). So I thought it would be good to already have it\nmerged. Otherwise chances are that this bug will be fixed twice !?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1033#issuecomment-89240914.\n. We have no plans to further this until we reach Sass compatibility it 3.4. This increases the maintenance surface area and our hands are full atm.\n. @darrenkopp please join us in Slack https://libsass-slack.herokuapp.com/. Thanks for the report @stol. The two examples you've supplied don't appear to work with Ruby Sass 3.4. If I'm wrong please correct me.\n\nSince Libsass is just a port of Ruby Sass we will not be implementing features it doesn't yet have. Please open all feature requests with the Ruby Sass project.\n. Thanks! I believe this is fix in the latest beta. I'll confirm when I'm at\na computer.\nOn 3 Apr 2015 20:13, \"afaye\" notifications@github.com wrote:\n\nSorry, I got confused while testing things with less.\nHere is a usecase (tested this time:) ) working with Sass 3.4.13, but not\nwith libsass v3.0.3 :\n.component{\n    color: red;\n    @at-root{\n        #{&}--foo#{&}--bar {\n            color: blue;\n        }\n    }\n}\n.test{\n    @at-root{\n        .selector#{&} {\n            color: blue;\n        }\n    }\n}\n// Outputs \"file.scss:4: error reading values after \"\n// Expected result (with sass 3.4)\n.component {\n  color: red; }\n  .component--foo.component--bar {\n    color: blue; }\n.selector.test {\n  color: blue; }\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1042#issuecomment-89231296.\n. @ekskimn looks like issues can only be assigned to core members\n. This still fails the spec.\n. Apologies, it looks like my local sass-spec is having issues.\n. This fix was a false positive due to https://github.com/sass/sass-spec/pull/380. The spec still fails.\n. The plan is to @mgreter PR and selector functions with 3.3. As for when that'll be it's hard to say.\n. Hi @corysimmons \n\nWe're not familiar with lost, please provided sample input and expected output that produces the broken behaviour .\n. This issued linked to seems to suggest the nth-child() clause is being changed\n\nlibass:\nfigure:nth-child(n)\n...\nfigure:nth-child(n+1)\nvs.\nCodePen:\nfigure:nth-child(2n)\n...\nfigure:nth-child(2n + 1)\n\nWithout knowing the coded used to generate the above output we cannot progress this issue.\nThank you @Panya but this is not related #593 which is only related to whitespace being lost.\n. Thanks @corysimmons. Please provide a fully working (copy-pastable) code sample that produces the problem? sassmeister.com is very helpful for this.\n. Thanks @corysimmons. I can confirm this is fixed in 3.2.0-beta.5. My guess is it was related to some str-slice issues we had.\n\n. It's currently in it's second RC. We've noticed some sourcemaps issues, but otherwise things are looking good. We'll hopefully in the coming week or two.\n. You can follow the 3.2 milestone\n. :+1: \n. My preference is we simply just drop this error/warning completely. Mentioning it as a breaking change should be enough IMO. I don't see the benefit in keeping this code debt around.\n. Sure thing!\n. Thinking about this does it makes sense to go form error -> warning -> gone?\nShip this in 3.2.0 instead?\n. I believe it was introduced in 3.2.0. \nIMO error -> warning -> gone make no sense. Either\n- warn -> error -> gone\n- error -> gone\n. > So we haven't even released the \"deprecated\" error yet.\nCorrect.\n\nwarnings might get overlooked by users\n\nI expect they'll notice when their code doesn't work :)\n\nActually I don't see why \"warn > error > gone\" would make any sense at all?\n\nwarn > error > gone and error -> gone are patterns used by the Ruby Sass team.\n\nan error also disallows any \"polyfill\" implementation\n\nThis makes erroring a non-starter for me. I had assumed native (libsass) functions would have the lowest priority in the function resolution process.\n\nmaybe going with a warning is the best option\n\nI think warning -> gone is the best option here unless we change the resolution order of function calls.\n. @mgreter I think I have misunderstood the issue here. \n\nOtherwise the function cannot be used by user-code\n\nI thought you meant the current master made it impossible for users to define their own compact method. This does not appear to be the case as this code execute fine.\n``` scss\n@function compact() {\n  @return foo; }\nfoo {\n  bar: compact(); }\n```\n\nMakes a few spec tests to pass now\n\nThe specs you've mentioned are invalid and should be deleted as compact has never been a supported function in Ruby Sass - https://github.com/sass/sass-spec/pull/326\n\nI think we should leave the current behaviour and remove the error completely 3.2.1/3.3. Thoughts?\n. Hi @imathis \nPlease provide a fully working example that produces the error you mention.\n. Great thanks, without a test case we can't really begin fixing the issue :)\n. FWIW the @elseif issue has since been fixed https://github.com/sass/libsass/issues/1060\n. Let me try answering your questions @Snugug \n\nChanging the @elseif to @else if resolves this issue, although raises other question.\n\nThis was reported a couple hours ago #1060 and fixed #1062.\n\nFirst, how did Libsass come to this error message?\n\nThe nature of the previous bug meant that @elseif was not being recognised a control directives and hence was being treated as an @at-directive like @media or @supports. Given that the error message makes sense and is inline with Ruby Sass e.g. http://sassmeister.com/gist/1db38d074e50ed9697a8\n\nSecond, the file begins with two lines of comment plus an extra return. If you take those out, the error magically appears exactly on 35:5, but with those in it appears on 38:5. \n\nThis appears to be a real problem. For some reason error tracking is drifting. @mgreter \n\nThis issue is resolved as of #1062, but there is a new issue in the incorrect error line reporting. \nIf someone could kindly find the generated a sample of runnable Sass code via http://sassmeister.com/ that reproduces the incorrect error line and open the issue it'd be really appreciated.\n. Specs added https://github.com/sass/sass-spec/pull/306\n. This is fixed and will be 3.2.0\n. > Sure. As long as you find those white-space-related issues valuable\nWe do :) ideally we have the exact output as Ruby Sass by 3.4.\n\nI may report what I find whether you plan to fix those issues soon or not\n\nThis would be great. Any whitespace related issues and specs are valuable for the final release.\n. > Did that happen because of word matcher?\nYes. Essentially Sass allows both @else if() and @elseif (). Due to the word boundary the old check failed.\nif (lex< kwd_else_directive >()) { //@else\n  if (peek< exactly<if_after_else_kwd> >()) { // should match @elseif but only matches @else if\n. Now that I'm looking at it again (and it's not 2am) the alternatives in elseif_directive should be removed since the semantics of @else are different to @else if\n. I can confirm this issue is present in Libsass 3.2.0-beta.5\n. Spec added https://github.com/sass/sass-spec/pull/320\n. This appears to be a problem with deduping selectors during extending. This test case can be simplified to\n``` scss\n%foo {\n  & > x { display: block; }\n}\na {\n\nb { @extend %foo; }\nb > c { @extend %foo; }\n}\n```\n\nGiven this code we appear to be incorrectly deduping a > b and a > b > c down to a > b\n. @onedayitwillmake if you apply this change you should be good\n\n. @onedayitwillmake yes please rebase on master and resolve any conflicts. \nIt also looks like this branch has had a lot of merges with master which means it cannot be merged in it's current state. A rebase may help push out the unwanted commits, otherwise we'll need to find another way to clean up this branch.\nWe rely heavily on git forensics to track down bug and regressions. This requires a clean commit history.\n. I can see commits from myself and @mgreter which don't belong here. These were presumably introduced in a merge.\n\n\n. @onedayitwillmake have you had a chance to clean up this PR? You can probably squash this down to a few commits.\n. @onedayitwillmake yes I do. However I expect you will into issues due to the merge commits.\n. Impressive git work to fix this branch.\nPlease remove the debug code.\n. @onedayitwillmake I've left some nitpick feedback for now. This will be a closer look when we're ready to start working on 3.3. Thanks heaps for all your work here, it's really appreciated.\nOne suggestion I have is to try to make the diff as clean as possible so we can focus on the changes that are relevant i.e. avoid unnecessary white changes, remove debug or commented out code\n. Superseded https://github.com/sass/libsass/pull/1261\n. Hey @snugug I rules out using the Libsass AST because it's significantly\ninadequate for the task of linting. For example we don't keep track of\nwhitespace at all.\nOn 8 Apr 2015 04:26, \"Sam Richard\" notifications@github.com wrote:\n\nI'm in the process of writing a Sass linter along with @xzyfer\nhttps://github.com/xzyfer (and have a few ideas about some really funky\nimporters that only will import parts of a file, say ignoring selectors or\nonly importing mixins, etc\u2026) and have found a need to have the AST for Sass\nfiles available. We've been looking at Gonzales\nhttps://github.com/tonyganch/gonzales-pe/tree/dev but realize it would\nprobably be more accurate and future-friendly if the AST was produced by\nthe same thing doing the actual compiling.\nWith this in mind, I'd like a way for Libsass to expose its AST to\ndevelopers instead of just compiling CSS files from the AST.\n(unrelated to #430 https://github.com/sass/libsass/issues/430)\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1065.\n. I don't see a reason not to do this, but it would take significant effort on top of it to address the problem @snugug wants to solve :)\n\nI've started work on a pure js scss parser which will better suit our use case :)\n. :+1: \n. :+1: \n. /cc @mgreter :)\n. > Shouldn't it be [..] word<>\nGood question. I wonder what's more in line with Ruby Sass. As it stands this is behaves correctly. but the error message when something like @elseif-foo is encountered is worth comparing.\n\nIMO indentation is off\n\nYep my bad.\n\nI actually prefer to write each lexer on its own line [..] Just wanted to ask as I tend to re-write them and wanted to get consens!\n\nHave you got an example? The style you had with the IE filter refactor is generally what we do. I'm aim for more lines rather than less. Code can never been too readable IMO.\n. Sounds good. The current convention is to line up children with first child. I find this weird.\nreturn sequence< optional<sign>,\n                 optional<digits>,\n                 exactly<'n'>,\n                 zero_plus < space >,\n                 sign,\n                 zero_plus < space >,\n                 digits >(src);\nIt's gets super unwieldy with mildly complex patterns like identifier. :+1: \n. :+1: \n. I need this for my own work so I'm going to squeeze it into 3.2.0\n. Agreed. That function is scary. Maybe even breaking it into an interpolation visitor could be an elegant solution.\nI also agree it can wait til 3.4+\n. Merged this because I need it for my stuff. Great work @mgreter \n. :+1:  thanks!\n. Merged this because I need it for my stuff. Great work @mgreter \n. This is also causing issues for https://github.com/sass-compatibility/sass-compatibility.github.io/pull/36#issuecomment-94145993\n. Spec added https://github.com/sass/sass-spec/pull/321\n. Fixed in 3.2.1\n. I've label this as a regression because even though we didn't have variable scoping in 3.1.0, !default was previous being respected causing this code to run as expected.\n. Interestingly removing the !global (which are being used incorrectly here) fixes the issue.\n. Cool!\n. I can confirm this is still present in 3.2.0-beta.5\n. Thanks for the clarification @dandehavilland.\n. A git bisect shows the regression was introduced in https://github.com/sass/libsass/commit/fd1814c58da94497142d929a5dd5be7c39d1ab70\n. Specs added https://github.com/sass/sass-spec/pull/313\n. :+1: \n. :+1: \n. :+1: \n. Spec added https://github.com/sass/sass-spec/pull/322\n. Spec added https://github.com/sass/sass-spec/pull/323\n. Confirm this has regressed in 3.3\n. I have a fix for this. Will publish when I'm home.\n. Applying #1094 resolves this issue for some users - https://github.com/sass/node-sass/issues/858#issuecomment-92386749\nI'm happy to ship this in 3.2.0\n. @Candid please do  .\n@saper your PR is currently failing out Windows CI, I've commented there.\n. Superseded by #1099. Thanks for you work @Candid !\n. My bad, I thought I did.\n. We're open to PRs on the subject! Please do.\nIt can be tricky for us to get this right as many of the little gotchyas become second nature. We're also a custom to many of the rough edges which would trip up new comers.\n. Some notes from a recent issue with @hugogiraudel.\nRunning sass-spec\nWe have a convenience script at ./script/spec. It bootstraps an environment for running sass-spec from a clean Libsass checkout. Currently is misses a few things, it shoul\n- default SASS_LIBSASS_PATH=$(pwd)\n- bundle install sass-spec after checking it out\n. Specs added https://github.com/sass/sass-spec/pull/345\n. This still fails the spec.\n. Apologies, it looks like my local sass-spec is having issues.\n. This fix was a false positive due to https://github.com/sass/sass-spec/pull/380. The spec still fails.\n. Related https://github.com/sass/libsass/issues/1294\n. Interesting. I just tested with 0f929a5 and got identical output (minus deprecation warnings)\nsass\n/* url-test1: without quotes */\n@import url(a b);\n/* url-test1: with quotes */\n@import url(\"a\\a b\");\n/* url-test2: with quotes */\n\\\\\\\\d\\a     c t n \\\\t \\\\n \\\\t \\\\n \\\\\\\\t \\\\\\\\n\");\n/* url-test2: without quotes */\n@import url(a \\d \\\\d \\\\\\d \\\\\\\\d c \\t \\n \\\\t \\\\n \\\\\\t \\\\\\n \\\\\\\\t \\\\\\\\n);\n. @am11 sorry I'm not following your previous comment. Please be more explicitly.\nCan you please post the output you're seeing on Windows, and how it differs from Mac.\nInterestingly I'm unable to get the Ruby Sass output you've provided locally (on Mac), but I do see it on sassmeister.\n. @am11 nothing comes to mind. Also I don't think this patch affected quoted\nimports. Can you confirm whether this issue existed before this patch?\nOn 30 Dec 2015 8:23 pm, \"Adeel Mujahid\" notifications@github.com wrote:\n\n@xzyfer https://github.com/xzyfer, I have confirmed that \\r (hex: 0D)\nis added before both \\a occurrences, by placing printf(\"size >>> %lu\\n\",\nstrlen(output_string)); before:\nhttps://github.com/sass/sassc/blob/94838a9/sassc.c#L46.\nWhen compiling this input sample\nhttps://github.com/sass/libsass/issues/1096#issuecomment-167531680 on\nMac it prints: size >>> 308 while on Windows: size >>> 310.\nAny ideas where this \\r it is coming from?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1096#issuecomment-167964707.\n. Also if you include debugger.cpp in context.cpp and add\n\ndebug_ast(root);\non line 657 the AST tree will be dumped to the console just before the output phase begins.\n. Interesting. Looks like it's worth creating an issue for. Not exactly sure how I'll debug it though haha\nYou can debug_ast(root) after each previous assignment of root to see if it's the parser, or eval step that introduces the \\r.\n. Sorry @listepo but this does not help us track down the bug. Please supply a set of copy paste instructions that reproduces this error. The latest foundation currently compiles fine with libsass@3.2.0-beta.5\n. Can you please show any other relevant package manager configs i.e. bower so we can replicate this issue. I don't know what @import \"github\"; refers to, or what version of foundation and font-awesome you are using.\n. Are you supplying a load path? i.e. how does sass know that \"foundation\" is infact bower_components/foundation/scss/foundation.scss?\nWhat does \"settings\" point to? Is it relevant to this issue?\n. Running this command with your bower settings on node-sass@2.1.1 produces no error\n\u279c  issue_1097  ./node_modules/.bin/node-sass --version\n2.1.1\n\u279c  issue_1097  ./node_modules/.bin/node-sass --include-path bower_components/foundation/scss --include-path bower_components/fontawesome/scss index.scss\nRendering Complete, saving .css file...\nWrote CSS to /Users/michael/tmp/issue_1097/index.css\nThis suggests issue is in some customisation you have made.\n. Ok great, I'm able reproduce this now :)\n. OK I can confirm this is fix on master and will be in the next beta of Libsass and node-sass.\nThanks@jrobeson for your help!\n. The Libsass@3.0.0-beta.6 has already been released. The node-sass beta will follow shortly - https://github.com/sass/node-sass/issues/873\n. @perplexes you code sample does not work with Ruby Sass. Please open an issue with them if you believe this to be a mistake.\n. Thanks for the report @atdrago. Could you please also provide a test case in sass-spec? Here's a good example of one https://github.com/sass/sass-spec/pull/315.\n@mgreter this is a regression from 3.1.0. I'll do a bisect shortly.\n. Specs added https://github.com/sass/sass-spec/pull/331. Turns out this regression is more server then first suspected.\nscss\ndiv { \n    opacity: 1\\9;\n    width: 500px\\9;\n    color: #f00\\9\\0\\;\n}\nRuby Sass\ncss\ndiv {\n  opacity: 1\\9;\n  width: 500px\\9;\n  color: #f00\\9\\0\\;; }\nLibsass 3.1.0\ncss\ndiv {\n  opacity: 1\\9;\n  width: 500px\\9;\n  color: #f00 \\9\\0\\;; }\nLibsass 3.2.0-beta.5\ncss\ndiv {\n  opacity: 1 \\9;\n  width: 500px \\9;\n  color: #f00\\9\\0\\\\; } // extra /\n. @mgreter I've started a WIP https://github.com/sass/libsass/pull/1111 before I noticed the other error cases.\nI'm not tied to this PR so if you think you can fix this quickly go for it. I'm really want to ship the final beta asap :tada: \n. > IMO it's related to our way to parse every list as a space or comma separated list.\nThis is true.\n\nIMO not a real blocker for the next release\n\nAssuming what we output still has the desired affect I also agree. I'll make sure the \"hack\" is still repected with the space.\n. @saper this current fails to compile with mingw - https://ci.appveyor.com/project/sass/libsass/build/1.0.613/job/6s2q44etjkbowiug\n```\ng++ -Wall -O2 -DLIBSASS_VERSION=\"\\\"3.2.0-beta.5-34-g57a25\\\"\" -std=gnu++0x -I .. -c -o json.o json.cpp\nmingw32-make : json.cpp:153:1: warning: \"/*\" within comment [-Wcomment]\nAt line:2 char:3\n+   mingw32-make -j4 sassc\n+   ~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : NotSpecified: (json.cpp:153:1:...ent [-Wcomment]:String) [], RemoteException\n    + FullyQualifiedErrorId : NativeCommandError\n/*\n ^\n```\n. I've boiled down your example to executable Sass.\nscss\n$foo: #ffffff;\nfoo {\n  bar: adjust-color($foo, $hue: -6deg, $lightness: -16, $saturation: -7);\n}\nWhich gives the output as expected\ncss\nfoo {\n  bar: #d3d9d8; }\nYou can confirm this behaviour yourself on sassmeister - http://sassmeister.com/gist/66b7f11f8e72e620d85c\nNode-sass 2.1.1 is using Libsass 3.1.0 which is the same as sassmeister (click the cog in the top right for more info) - https://github.com/sass/node-sass/blob/226861c6a186291f9e957697f1115e1ddb4a4202/package.json#L3-L4\n\nI am currently unable to reproduce this issue. Can you please create an executable example that shows this issue in action on sassmeister? Without that we simply cannot make progress here.\n. Interesting, white is still a valid value for adjust-color().\nscss\n$foo: white;\nfoo {\n  bar: adjust-color($foo, $hue: -6deg, $lightness: -16, $saturation: -7);\n}\nRuby Sass\ncss\nfoo {\n  bar: #d6d6d6; }\nLibsass\ncss\nfoo {\n  bar: #d3d9d8; }\n\nThere does however appear to be a difference in how we calculate the adjusted colour.\n. I would still like to get to the bottom of your issue.\n. Tracking the difference in adjust-color() in https://github.com/sass/libsass/issues/1101\n. Running via node-sass@3.0.0-beta.5 and node-sass@2.1.1 produce the following output\nfoo {\\n  bar: #d3d9d8; }\\n\nWhat version of gulp-sass are you using?\n. Install gulp-sass@^2 to get this fix.\n. @anlutro you may be correct. This code was tested and failed after that PR was merged so the issue still persists.\n. Related to https://github.com/sass/libsass/issues/690\n. Specs added https://github.com/sass/sass-spec/pull/344\n. Thanks for the report @andfinally. We're scheduling whitespace related issue for the 3.4 release since they're non-critical.\nRelated https://github.com/sass/libsass/issues/1030\n. Specs added https://github.com/sass/sass-spec/pull/348\n. Technically yes but it's a specific case we can test against.\n. Thanks for the report @timhettler. There has been a fix for this bug which as caused a different bug with random. I've labelled this a regression and update the specs - sass/sass-spec#328.\nThis will be fixed in 3.2.0.\n. Fixed by https://github.com/sass/libsass/pull/1105\n. Thanks @QuLogic. We usually do it in the PR rather than cluttering the git history. I simply forgot as I was multi tasking whilst writing that PR.\n. Still seeing this in 3.0.0-beta.6. I'll work on a reduced test case today.\n. ``` scss\n$foo: red;\n$bar: unquote(null);\n.baz {\n    foo: $foo;\n    foo: $bar; }\n.bax {\n    foo: $bar; }\n.bay {\n    foo: $foo; }\n```\nRuby Sass\n``` css\n.baz {\n  foo: red; }\n.bay {\n  foo: red; }\n```\nLibsass 3.1.0\n``` css\n.baz {\n  foo: red; }\n.bax { }\n.bay {\n  foo: red; }\n```\nLibsass 3.2.0-beta.6\n``` css\n.baz {\n  foo: red;\n  foo: ;}\n.bay {\n  foo: red; }\n``\n. This appears to be due a difference inunquote`\nscss\nfoo { \n  bar: type-of(unquote(''));\n  baz: type-of(unquote(null)) }\nRuby Sass\n``` css\nfoo {\n  bar: string;\n  baz: null; }\n```\nLibsass\n``` css\nfoo {\n  bar: string;\n  baz: string; }\n``\n. Although the current patch solves the issue of not showing empty rulesets, due to https://github.com/sass/libsass/issues/1124 in the special case ofunquote(null)` this breaks if there another non-null declaration in the ruleset.\nscss\n$foo: null;\nfoo {\n  a: $foo;\n  b: $foo; }\nbar {\n  a: b;\n  b: unquote($foo); }\nRuby Sass\ncss\nbar {\n  a: b; }\nLibsass 3.1\ncss\nbar {\n  a: b; }\nLibsass 3.2.0-beta.6\ncss\nbar {\n  a: b;\n  b: ;}\nI have update the spec to reflect this new information - https://github.com/sass/sass-spec/pull/336\n. Fixed by https://github.com/sass/libsass/pull/1194\n. :+1: \n. Turns out due to changes in the API this is currently a non-started.\nhttps://github.com/rauchg/slackin/issues/38\nhttps://github.com/rauchg/slackin/issues/16\n. Unfortunately as per my follow up comments this doesn't work. If you send\nme your email address I can invite you.\nOn 17 Apr 2015 02:27, \"Drew Wells\" notifications@github.com wrote:\n\nRequested invite!\nOn Thu, Apr 16, 2015 at 5:38 AM Michael Mifsud notifications@github.com\nwrote:\n\nTurns out due to changes in the API this is currently a non-started.\nrauchg/slackin#38 https://github.com/rauchg/slackin/issues/38\nrauchg/slackin#16 https://github.com/rauchg/slackin/issues/16\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1110#issuecomment-93704533.\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1110#issuecomment-93777866.\n. My GH handle on twitter or at gmail.\n\nOn 4/17/15, Drew Wells notifications@github.com wrote:\n\nWhere should I send my email?\nOn Thu, Apr 16, 2015 at 6:07 PM Michael Mifsud notifications@github.com\nwrote:\n\nUnfortunately as per my follow up comments this doesn't work. If you send\nme your email address I can invite you.\nOn 17 Apr 2015 02:27, \"Drew Wells\" notifications@github.com wrote:\n\nRequested invite!\nOn Thu, Apr 16, 2015 at 5:38 AM Michael Mifsud\n<notifications@github.com\nwrote:\n\nTurns out due to changes in the API this is currently a non-started.\nrauchg/slackin#38 https://github.com/rauchg/slackin/issues/38\nrauchg/slackin#16 https://github.com/rauchg/slackin/issues/16\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1110#issuecomment-93704533.\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1110#issuecomment-93777866.\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1110#issuecomment-93859229.\n\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/1110#issuecomment-93862304\n\n\nRegards,\nMichael\n. With some finagling I've managed to get this working. We're back in business!\n. Thanks for the report @mechanicalduck. This feature is supported of Libsass 3.0.0-beta.\n$ sassc test.scss\ntest.scss:2: DEBUG: .container .test\n. Hi @ste-m, thanks for the report!\nI'm glad to say this issue has been resolved in the current 3.2.0 beta release.\n. I've confirmed this is a regression the 3.2.0-beta.5. A git bisect shows the regression was introduced in https://github.com/sass/libsass/commit/7877cfa872b036d55344db5d12ea908bb70f3705 /cc @mgreter \n. Thanks for the report @kbullaughey. Could you please submit a sass-spec for this issue?\nThis is a good example to follow https://github.com/sass/sass-spec/pull/330/files\n. @mgreter I agree it's strange for Sass to treat \\79 as a hex value, and cast it back to y.\n@chriseppstein @nex3 is this known issue/feature? I see no mention of it in the sass documentation , or an existing bug report.\n. Thanks for the information @nex3. \nLibsass recently implemented the static value optimisation as well. Without it we found parsing and emitting static values resulted in too many unpredictable subtle differences. I expect any implementation attempting completely mimic the Ruby Sass output, as required by sass-spec, will need to have a similar optimisation. \n. Specs added https://github.com/sass/sass-spec/pull/340\n. This fix was a false positive due to https://github.com/sass/sass-spec/pull/380. The spec still fails.\n. Thanks for the info @realityking /cc @mdo\n. Unfortunately this issue appears to be someone environment specific. I have been update to reproduce this myself. I don't believe this is a high priority right now.\n. I've looked into this further. The originally reported issue regarding UTF-8 corruption is a red herring. That was actually a Ruby error when trying to parse the stdout output of Libsass 3.2.0-beta.5. The issue here is that sometimes Libsass outputs garbage characters .\n```\nError: unterminated argument to selector-nest(...)\n        on line 1 of tests/selector_manipulation_functions/input.scss\n\n\n\ufffd$4\ufffd\ufffd\n   --------------^\n```\n\n\nThat makes this issue a duplicate of https://github.com/sass/libsass/issues/1079\n. :+1:\n. :+1:\n. I've created the spec for this issue - https://github.com/sass/sass-spec/pull/340\nThis PR is an improvement on the current behaviour, however it still fails this spec.\n. So I've spent all weekend getting my head around our string handling code, and feel it's already over complicated. I'm super reluctant to add another flag to our String AST nodes i.e. String::sass_fix_1291\nI wonder if we can tackle this case entirely in the Eval phase instead?\n. Thanks for the report @gijsroge. We're unable to debug entire frameworks we're not familiar with.\nPlease supply a copy and pastable Sass snippet the produces the issue in question. I recommend using http://sassmeister.com/ to do so.\n. @mgreter if you're able to tackle this I think it'll clean up my patch for #1127.\n. Never mind looks like my patch takes care of this as well.\n. I am unable to reproduce this issue with Libsass@3.0.0-beta.6.\nPlease try compiling this code directly with a fresh node-sass and see if the problem persist.\nsh\nmkdir ~/tmp/node-sass\ncd ~/tmp/node-sass\nnpm install node-sass@3.0.0-beta.7\nnode -e \"console.log(require('node-sass').renderSync({file:'path/to/file.scss'}))\"\nnode -e \"console.log(require('node-sass').renderSync({file:'path/to/file.scss'}).css.toString())\"\n. ``` sh\n\u279c  tmp  node -e \"console.log(require('node-sass').info)\"\nnode-sass   3.0.0-beta.7    (Wrapper)   [JavaScript]\nlibsass     3.2.0-beta.6    (Sass Compiler) [C/C++]\n\u279c  tmp  node -e \"console.log(require('node-sass').renderSync({file:'test.scss'}).css.toString())\"\n.customer-grid-item {\n  float: left;\n  margin: 0 0 0 2.12766%;\n  width: 6.38298%;\n  width: 24.93617%;\n  margin: 0 0 20px 0; }\n  .customer-grid-item:first-child {\n    margin-left: 0; }\n  html.flexbox .customer-grid-item {\n    float: none; }\n```\n. @dtothefp as @drewwells points out, we cannot progress this issue as it stands. Noone one the Libsass team is familiar with project in question.\nPlease supply a copy-pastable snippet of Sass code that produces the issue you're encountering. Only then can we begin to understand the actual problem at work here.\n. @dtothefp thanks heaps for creating that test case. I can confirm this is fixed in Libsss 3.2.0 and will be in node-sass 3.0.0.\n. Soon. You can track the progress of 3.0.0 in https://github.com/sass/node-sass/issues/904\n. @jpdesigndev tracking that issue in https://github.com/sass/libsass/issues/1208\n. @filmic I can confirm this is an issue. Please open a new issue, this one is closed.\n. I believe this is a duplicate and fixed in 3.2. Can't link on phone.\nOn 23 Apr 2015 18:00, \"Hugo Giraudel\" notifications@github.com wrote:\n\n$string: 'Hello world!';\n// Expected: last character of string// Ruby Sass 3.4 [OKAY] returns \"!\"// LibSass 3.1   [FAIL] returns \"\".foo {\n  content: str-slice($string, str-length($string));\n  content: str-slice($string, -1);\n}\nRef: http://sassmeister.com/gist/622a760397796db2fb74.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1123.\n. Duplicate https://github.com/sass/libsass/issues/988. Fixed in 3.2.0\n. Fixed by #1125\n. I can confirm this is a regression in 3.2.0. Libsass 3.1.0 produced the expect output.\n\nCorrection Libsass 3.1.0 produced semantically correct output, but failed to normalise to double quotes.\n. Specs added https://github.com/sass/sass-spec/pull/341\n. A git bisect shows this regression was introduced in https://github.com/sass/libsass/commit/7877cfa872b036d55344db5d12ea908bb70f3705\n. I get the reported result on master on OSX\ncss\np {\n  content: '\"ABCD\"';\n  content: '\"ABCD\"';\n  content: '\"ABCD\"efg';\n  content: \"ABCD\"; }\n\u279c  libsass git:(master) \u2717 sassc -v\nsassc: 3.2.0-beta.2\nlibsass: 3.2.0-beta.6-4-g8963\nsass2scss: 1.0.3\n. I've got a working fix for this. Required a decent amount of refactoring. I'll PR something tomorrow after I've cleaned it up.\n. Hi @OnkelTem thanks for the report.\nUnfortunately we're not able to progress on this issue in it's current state. Noone on the Libsass team is familiar with Signularity, nor do we have time to debug their entire code base.\nPlease supply a copy-pastable snippet of Sass code that produces the error you're encounter. Only then can we begin to understand the actual problem you're encountering.\n. Appreciate it @OnkelTem \n. You're absolutely correct @Snugug. I've opened a new issue to better track this https://github.com/sass/libsass/issues/1133\n. This was fixed in https://github.com/sass/libsass/pull/1135 and will be in the next release.\n. Specs added https://github.com/sass/sass-spec/pull/343\n. Add a spec then :ship:\n. Specs added https://github.com/sass/sass-spec/pull/343\n. Confirmed this passes the spec :shipit: \n. Thanks for the report @FStop. I've confirmed this is an issue.\n~~Please create a sass-spec test case for this. This is a good example to follow https://github.com/sass/sass-spec/pull/343~~\n. Specs added https://github.com/sass/sass-spec/pull/347\n. Ended up squeezing this into 3.2 because I knew what was wrong and hoped it would also fix https://github.com/sass/libsass/issues/1101 (which it did not)\n. @mgreter I owe you a beer for debug_ast!\n. Might be a sass-spec issue because the output is certainly incorrectly\n```\n$ sassc test.scss\n/ comment 1 */\n@import url(\"import-1\");\n@import url(\"import-2\");\n/ comment 2 /\n/ comment 3 /\nfoo {\n  bar: baz; }\n$ sass test.scss\n/ comment 1 */\n@import url(\"import-1\");\n/ comment 2 /\n@import url(\"import-2\");\n/ comment 3 /\nfoo {\n  bar: baz; }\n```\n. I think this can wait to 3.2.1. We've cleared out the 3.2.0 regressions, we should ship it ASAP.\nWe don't have great test coverage here, and this isn't a regression.\n. Ok cool, lets merge this and ship 3.2.0?\n. I haven't had a chance to look into the issue, but I trust your judgement :) lets do it!\n. :smile: merged\n. I'll put together the complete release notes for 3.2.0 and get started on node-sass 3.0.0 stable.\n. Fixed in 3.2.1\n. Are right, yes that's a bug, but it doesn't change the semantic of the code which certainly an improvement.\n. @rodneyrehm I can't reproduce this with give code. Are you sure you're on 3.2.1?\nsh\n$ sassc --precision=0 test.scss\n.m {\n  width: 123.0px; }\n$ sass --precision=0 test.scss\n.m {\n  width: 123.0px; }\n$ sassc --precision=5 test.scss\n.m {\n  width: 123.4px; }\n$ sass --precision=5 test.scss\n.m {\n  width: 123.4px; }\n. > I don't think adding .0 is a good idea.\nYes and no. Ruby Sass adds the .0 if there would have otherwise been a decimal.\nThe bug here is that we're adding to all numbers regardless.\n. precision sets the maximum precision (number of digits after a decimal) to truncate to i.e. 0.5 will not become 0.5000 when precision is 5.\nIf this what you desire there is no config or flag to achieve this.\n. As @mgreter said the default is 5 the same as Ruby Sass. We copy Ruby Sass where possible.\nThere is talk of this changing in the future though - https://github.com/sass/sass/issues/1122\n. No problem. Apologies for the confusion. We're tracking the extra .0 regression in https://github.com/sass/libsass/issues/1153\n. > For #include \"filename\" the preprocessor searches in the same directory as the file containing the directive. This method is normally used to include programmer-defined header files.\nThis is the intended behaviour. We have no plans to change this.\n. If I understand correct the header files will be read from the current directory? This is the intended behaviour for us.\n. Unless there is a compelling reason, with real world effects, for make this change I don't see a reason to atm.\nWe'll be open to re-addressing this if there proven that\n- there is use case where our current approach posed a problem to users\n- there are measure performance gains to be had\n. @drewwells to my knowledge those files are unused.\nThe contrib directory is essentially an \"examples\" directory. We never compile them for Libsass.\nI believe the test folder was added a part of the initial @extends implementation, but afaik we do nothing with it. Maybe @hcatlin can shed some more light on this directory?\n. I agree with regards to the test dir.\nThe contrib dir needs a README explaining it's purpose and description of the files with in it /cc @mgreter \n. Sass_String::is_quoted has been exposed in 3.2.1\n. Am I correct in understanding this issue is now solved 3.2.1?\n. This was also reported in https://github.com/sass/node-sass/issues/892 prevent compilations on FreeBSD\n. Fixed in 3.2.1\n. Fixed in 3.2.1\n. Fixed in 3.2.1\n. I know were planning to ship 3.2.1 in a couple weeks with some minor features and patches but IMHO #1145 and https://github.com/sass/sassc/pull/105 are kinda show stoppery. Should we push out a hotfix asap?\n. Opened a discussion in https://github.com/sass/libsass/issues/1150\n. Tracking this in https://github.com/sass/libsass/milestones/hotfix\n. I'd rather wait til the dust settings before shipping the 3.2.1 PRs. I'd created a hotfix milestone to track these critical issues.\n. I think we should abandon #1055 in favour of removing all traces to compact. I expect the amount of people relying on this is approaching 0.\nI'm :+1: to shipping the other three. The last two can wait IMO.\n. I've renamed the 3.2.1 milestone to 3.2.2\nI've renamed the hotfix milestone to 3.2.1\nI've reassigned #1049, #1047, #1138 to the 3.2.1\n. :ship:\n. @mgreter whilst I have your attention can you please jump into Slack and check my message? :)\n. @onedayitwillmake this a hotfix release to address some critical issues that came up in 3.2.0.\nSelectors will land in our next major release.\n. @mgreter thoughts?\n. > Seems to be a special case if the value was actually rounded\nYes. When I recently refactored this code I applied to \"special cases\" always because it was semantically equivalent and the old behaviour wasn't. \nThis issue specifically refers to making the special case only apply to rounded numbers.\n. Thanks @carsonmcdonald \n. Sassmiester is still in Libsass 3.1.0. Could you please try reproducing\nthis on 3.2.x?\nIf you're on osx you can get 3.2.1 via brew.\nbrew update\nbrew install sassc\nsassc path/to/file.scss\nOn 2 May 2015 03:12, \"Eric M. Suzanne\" notifications@github.com wrote:\n\nFraction number-comparisons are still broken when the fraction is\nretrieved from a map.\n$numbers: (\n  integer: 4,\n  decimal: .25,\n  fraction: 1/4,\n);\n.test {\n  @each $key in map-keys($numbers) {\n    $number: map-get($numbers, $key);\n    #{$key}: if($number > 0, true, false);\n  }\n}\n// Expected Output.test {\n  integer: true;\n  decimal: true;\n  fraction: true; }\n// Actual Output// ERROR: may only compare numbers on line 10 at column 14\nSee the SassMeister Demo\nhttp://sassmeister.com/gist/343bdc4fca70f77007ca\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1159.\n. Tracking the infinity issue in https://github.com/sass/libsass/issues/1206\n. :+1: \n. Add a spec?\n. :+1: \n. :+1: \n. HI @shaunbent thanks for the report. You're correct this is a regression.\n\nCould you please open a sass-spec PR to help us fix this as soon as possible. Here's a good template to follow https://github.com/sass/sass-spec/pull/343/files\n. Sorry, I'm confused. The example you've given fails on Ruby Sass 3.4.12.\n``` scss\n$colors: (\n    \"transparent\": #000000,\n);\n.c {\n  color: map-get($colors, transparent);\n  foo: type-of(map-get($colors, transparent));\n}\n```\nRuby Sass\ncss\n.c {\n  foo: null; }\nLibSass\ncss\n.c {\n  foo: null; }\nWhat behaviour are you expecting?\n. scss\n$colors: (\n    transparent: #000000,\n    \"transparent\"\": #000000,\n);\nRuby\ncss\nInvalid CSS after \" \"transparent\"\": expected \":\", was \"\": #000000,\"\nLibSass\ncss\nerror reading values after \"transparent\" on line 3 at column 2\n. ``` scss\n$colors: (\n    transparent: #000000,\n);\n.c {\n  color: map-get($colors, transparent);\n  foo: type-of(map-get($colors, transparent));\n}\n```\nRuby\ncss\n.c {\n  color: #000000;\n  foo: color; }\nLibSass\ncss\n.c {\n  color: #000000;\n  foo: color; }\\\n. As far as I can tell the behaviour is the same as Ruby Sass.\n. Thanks for the clarification.\nThe issue appears to be specific to setting map keys. AFAIK we, correctly, treat colour stings as colours. Marked this for the next small release.\n. ~~This is also an interesting exception~~\n``` scss\n$map: (\n  'red': 'foo',\n);\n$map: map-set(red, 'bar');\n.foo {\n  content: inspect($map);\n}\n```\nRuby and LibSass\ncss\n.foo {\n  content: map-set(red, \"bar\"); }\n~~Makes perfect sense considering the string 'red' will be cast to a colour object.~~\n~~This may actually be a bug in Ruby Sass? /cc @chriseppstein~~\n. Ah my bad, too many langauges.\n``` scss\n$map: (\n  'red': 'foo',\n);\n$map: map-merge($map, (red: 'bar'));\n.foo {\n  content: inspect($map);\n}\n```\nRuby and LibSass\ncss\n.foo {\n  content: (\"red\": \"foo\", red: \"bar\"); }\nThe inconsistency here does kinda bug me, I wonder what the rationale is here.\n. I've looked into this further and it appears I'm mistake. As far as I can tell Ruby Sass will always treat a quoted colour as a String. This is the crux of our issue.\nscss\n.foo {\n  a: type-of(\"red\");\n  b: type-of(red);\n}\nRuby Sass\n``` css\n.foo {\n  a: string;\n  b: color; }\n```\nLibSass\ncss\n.foo {\n  a: color;\n  b: color; }\n. Thanks everyone. This is a tricky one, the colour ones always are. We'll aim to get this in the next small release. A sass-spec will really speed up the process hint hint :smile:\n. This fix was a false positive due to https://github.com/sass/sass-spec/pull/380. The spec still fails.\n. Looks like it was partially working on 3.2.3, but is now broken in 3.2.4 from 2eef52a6d083e84318635fc8e3907f59c6a870e0.\n. I can see why this fails. The & + '' is an attempt to make Sass coerce the Selector into a String. It would this isn't happening in LibSass.\nThe reason it works with the () is because it is now a List. The LibSass engine will evaluate the list values individually, the as a list. That second look at the value is likely where we turn it into a string.\n. This fix was a false positive due to https://github.com/sass/sass-spec/pull/380. The spec still fails.\n. Spec added https://github.com/sass/sass-spec/pull/364\n. @davidkpiano is this part of SassDash?\n. Ok cool, prioritizing this to 3.2.3.\n. This fix was a false positive due to https://github.com/sass/sass-spec/pull/380. The spec still fails.\n. We're bummed as well. I've patched the test runner so there shouldn't be\nanymore false positives.\nOn 14 May 2015 01:48, \"David Khourshid\" notifications@github.com wrote:\n\n:(\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1171#issuecomment-101721612.\n. :+1: \n. :+1: \n. :+1: \n. :+1: \n. :+1: \n. Closed by #1191\n. Could you please narrow down the Sass code that produces the issue. We've had it reported a couple times but with workable Sass code that produces the error our hands are tied.\n. @jsma is your application using bootstrap by any chance?\n. Thanks. This a known issue which has been fixed in Libsass 3.2.3.\n. Duplicate https://github.com/sass/libsass/issues/1162\n. Spec added https://github.com/sass/sass-spec/pull/373\n. Spec added https://github.com/sass/sass-spec/pull/372\n. Specs added https://github.com/sass/sass-spec/pull/372\n. :+1: \n. Spec PR https://github.com/sass/sass-spec/pull/375\n. :+1:\n\nAlso I wonder if parsing these ie expressions is worth the effort (and perf hit?). Could we get away with going back to treating these as String_Schemas?\n. :+1: \n. For some more context on the original error message. It was added to address the issue that we weren't throwing duplicate key issues, I expected we'd eventually need it in eval as well. It was added here to match the Ruby behaviour.\nIIRC Ruby validates duplicate keys when adding keys to a Map AST node. However it only validates static values. The ideal way to handle this would be to have the Map AST either throw the error or have it return an int > 0 on failure (only for String_Constant and String_Quoted).\n. Ah right, it's because the close ) is lexed by parse_value ?\n. Spec activated https://github.com/sass/sass-spec/pull/656\n. Update the specs https://github.com/sass/sass-spec/pull/374\n. Are just handling url values poorly? The Ruby Sass behaviour seems intuitive to me. \nIf the url value is a quoted string and the newline is escaped then it's removed.\nIf the url value is not a quoted string it's a Sass list.\n. I noticed another thing\nscss\n@import url(\"foo\nbar\");\nProduces a deprecation warning in Ruby Sass\n```\nDEPRECATION WARNING on line 2, column 13 of test.scss:\nUnescaped multiline strings are deprecated and will be removed in a future version of Sass.\nTo include a newline in a string, use \"\\a\" or \"\\a \" as in CSS.\n@import url(\"foo\\a bar\");\n```\nBut not Libsass\ncss\n@import url(\"foo\\a bar\");\nLibsass does however produce the deprecation warning if there is more content after the @import\nscss\n@import url(\"foo\nbar\");\n// foo\n. Given this new information it would seem I was incorrect in thinking Ruby turned multi-line strings into lists. It appears to native support multi-line strings but normalises the newline to a space in the output phase.\n. My issue with this is that it's unclear when/if compressed should be used. It's another undocumented mystery flag that noone understands. \nIMHO this issues isn't of any importance atm so we can defer it until 3.4 with the rest of the whitespace issues. By then we should have a better idea of if there are more usecases for compressed (I don't think there are from reading the Ruby code).\n. The concerns here are too mixed up IMO. Fixing an issue with binomials-like expressions in selectors by changing how we output strings?\nAt the very least the output logic should be scoped to selectors, at which point we could use context, rather then some mystery flag. This at least signals to the reader what the intent is.\n. Even renaming the flag to signal that it's about selectors, would be a big improvement.\n. This is an improvement :+1: \n. This would be rad.\n. Rebase and :ship: \n. Can you please confirm which version of Libsass you're using? I believe\nthis issue has been fixed for a while.\nOn 12 May 2015 00:16, \"Pawe\u0142 Kowalewski\" notifications@github.com wrote:\n\nExample:\n$foo: not-allowed; //$foo = false$bar: notfalse; //$bar = true$foobar: notnottrue; //$foobar = true\nIt differs from other implementations of SCSS.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1199.\n. Output from Libsass 3.2.0\n\n``` scss\n$foo: not-allowed;\n$bar: notfalse;\n$foobar: notnottrue;\na {\n  foo: $foo;\n  bar: $bar;\n  foobar: $foobar;\n}\n```\ncss\na {\n  foo: not-allowed;\n  bar: notfalse;\n  foobar: notnottrue; }\n. Thanks for this @tysongach. I've brought up the issue with the Sass team in regards to how to best follow the Sass branding, and intuitive as a C lib.\n. Although it's not my preference the consistency is an improvement. Thanks @tysongach.\n. Sounds like you're on an old version of Libsass. Please update.\n. @linnett can you please give the output of the following commands\nnpm -v              \nnode -v\nnode -p process.versions\nnode -p process.platform\nnode -p process.arch\n./node_modules/.bin/node-sass --version\n. For reference, running Libsass 3.2.0\n``` scss\n$numberOfColumns: 2;\n$margin: 5%;\n$columnWidth: 20px;\n@for $i from 1 through $numberOfColumns {\n  .col-#{$i}-#{$numberOfColumns} {\n    $columnWidth: (100% - (($margin * 2) * $numberOfColumns)) / $numberOfColumns;\n    width: ($i * $columnWidth) + (($margin * 2) * ($i - 1));\n  }\n}\n```\n``` css\n.col-1-2 {\n  width: 40%; }\n.col-2-2 {\n  width: 90%; }\n```\n. Apologies\n./node_modules/gulp-sass/node_modules/.bin/node-sass --version\n. Interesting. Can you supply the values you've set for $numberOfColumns, $margin, $columnWidth?\n. It would be good to have more context here, ideally we'd give a less cryptic error.\n. It would be good to have more context here, ideally we'd give a less cryptic error.\n. If you think it's ready we can ship it now. I'm keen to tag 3.2.4 in the\nnext hour or so.\nOn 13 May 2015 09:28, \"Coveralls\" notifications@github.com wrote:\n\n[image: Coverage Status] https://coveralls.io/builds/2548983\nCoverage decreased (-0.15%) to 79.97% when pulling ea659cd\nhttps://github.com/sass/libsass/commit/ea659cd20a798a2937b26390a2c0905d92d711ef\non mgreter:feature/selector-functions-basic into 28ee088\nhttps://github.com/sass/libsass/commit/28ee0884243820a34c3458e26b36fc59ccefd9b3\non sass:master.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1202#issuecomment-101459421.\n. Great. I think there are some specs that need to be activated from the\nrecent PRs as well.\nOn 13 May 2015 09:39, \"Coveralls\" notifications@github.com wrote:\n[image: Coverage Status] https://coveralls.io/builds/2549041\nCoverage decreased (-2.53%) to 77.59% when pulling ff3f8a0\nhttps://github.com/sass/libsass/commit/ff3f8a0692c16cfd0fb043eb76c985950c8a7e68\non mgreter:feature/selector-functions-basic into 28ee088\nhttps://github.com/sass/libsass/commit/28ee0884243820a34c3458e26b36fc59ccefd9b3\non sass:master.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1202#issuecomment-101460549.\n. Thanks for the report @suisho.\n\nThis code now compiles in Libsass 3.2.4 (node-sass@3.1.0), but it produces the wrong output.\nI've created a new issue to track the incorrect output https://github.com/sass/libsass/issues/1210\n. What was the previous Libsass version you're comparing to?\n. We don't actively benchmark Libsass, however I've just compared our test suite times between 3.1.0 and 3.2.4 and there is no noticeable difference.\n. If there is a speed regression my guts says it'll be in node-sass. I'd be interested in seeing your compile times from gulp-sass vs node-sass vs sassc\n. This data would suggest that the speed regression has happened in node-sass which used  in gulp-sass and grunt-sass. It would seem that's where we'll need to address this issue.\n. I figured as much. I'll be looking to this shortly with in node-sass. Tracking this in https://github.com/sass/node-sass/issues/970\n. @DenisMir I'm sorry but without a copy-pastable code sample we cannot begin to investigate this issue. Please take the time to find what part of your code is causing this issue.\n. @DenisMir the quickest way for use to address this issue is if you create a http://sassmeister.com gist showing the problem.\nWe simply don't have the time to reconstruct the code to test every bug. \n. Specs added https://github.com/sass/sass-spec/pull/381\n. @johnhunter what version of Libsass are you using? This works as expect in 3.2.4.\n. Apologies I missed that you were using Libsass 3.1.0. This is a very old version, please update.\n. /cc @suisho\n. Spec added https://github.com/sass/sass-spec/pull/382\n. Base on @danielguillan new information I dug in a big further and found this is a regression introduced in 3f536a99d322542487c6d04c75361e4812846a20 in #1183.\nI'll see about getting a patch for this into 3.2.5 since there's significant demand for it.\n. I've had a quick look into this and unfortunately there are a lot of edge cases. We need significantly more coverage in sass-spec before we're able to tackle this.\n. I've had a quick look into this and unfortunately there are a lot of edge cases. We need significantly more coverage in sass-spec before we're able to tackle this.\n. It's hard to know all of the cases. You can pretty much take any piece of the following and rearrange to hit a different code path.\nfoo {\n  foo: bar;\n  @at-root {\n    bar {\n      bar: baz;\n    }\n  }\n}\nSome examples off the top of my head are as follows.\nfoo {\n  foo: bar;\n  @at-root {\n    #{&} {\n      bar: baz;\n    }\n  }\n}\nfoo {\n  foo: bar;\n  @at-root {\n    #{&} baz {\n      bar: baz;\n    }\n  }\n}\nfoo {\n  foo: bar;\n  @at-root {\n    baz #{&} {\n      bar: baz;\n    }\n  }\n}\nfoo {\n  foo: bar;\n  @at-root bar {\n    bar: baz;\n  }\n}\nfoo {\n  foo: bar;\n  @at-root bar #{&} {\n    bar: baz;\n  }\n}\nfoo {\n  foo: bar;\n  @at-root #{&} bar {\n    bar: baz;\n  }\n}\nfoo {\n  foo: bar;\n  @at-root bar #{&} {\n    bam {\n      bar: baz;\n    }\n  }\n}\n. A good example of what these specs should be like is out at-root specs (ignore the directories starting with numbers).\nhttps://github.com/sass/sass-spec/tree/master/spec/libsass/at-root\n. Spec updated in https://github.com/sass/sass-spec/pull/403\n. This is fixed and will be 3.3\n. @chetzof no. We're not expecting 3.3 to land until some time in August.\n. ~~CI is currently failing due a regression in Ruby Sass https://github.com/sass/sass/issues/1724~~\n. This is fixed and will be 3.2.5.\n. I appear to have misunderstood this issue.\n. @Chocanto It no longer errors, however it acts different to Ruby Sass.\n. I'm closing this issue since the OP was regarding an error being thrown, which has been addressed.\nI've opened https://github.com/sass/libsass/issues/1253 to track the difference in output.\n. Spec added https://github.com/sass/sass-spec/pull/397\n. Apologies for the radio silence @ericam. This will be fixed in 3.2.5.\n. Hmm that doesn't sound right. There were some refactors around number output in the previous release.\nWe'll try get this into the next patch. Since this difference doesn't change the semantics of the output it's not a high priority, but should be an easy enough fix.\n. > more of a match-ruby\nThis is important to us. A deviation from this behaviour in a new version is still a regression.\n. Needs a clean up but generally speaking it looks sane\n. Does your parent selector refactor help with https://github.com/sass/libsass/issues/1210 by any chance?\n. Can this be applied without https://github.com/sass/libsass/pull/1249?\nIt looks like https://github.com/sass/libsass/pull/1249 does a bunch of this work as well.\n. Spec added https://github.com/sass/sass-spec/pull/390\n. Thanks for the report @cvrebert. There some case where Libsass is more forgiving that Ruby Sass. It's important for us to be aware of these cases.\n. IMO Ruby Sass shouldn't error here since this is relatively common, and works in CSS. In either case we're producing the wrong output.\n. We appreciate it. I think it'd be worth opening an issue to Ruby Sass to see if the error case can be addressed upstream.\n. Legend.\n. We're certainly open to making it more accessible to uninitiated and open to feedback and improvements.\nSass_Map maps to a Sass map value, so like Sass Maps, it's keys can be of any Sass type.\n. > In what Situation would I even work with a map (as opposed to a list)?\nSass Maps are probably the single most requested features in Sass' history. Their infinitely useful and it's becoming good practice to use them for managing set of variables. This article goes into it a bit but I can't remember the last time read a Sass article that didn't use maps - http://www.sitepoint.com/using-sass-maps/\n. This doesn't appear to be bug. Closing.\n. No plans at the moment.\n. Currently you are the only person asking for this. This issue is the first time I've heard of this feature. These two things tell me this is a very low priority. Certainly lower than getting feature parity with Ruby Sass.\nWe may eventually get to this but it's not a priority for anyone. We're open to pull requests.\n. This issue description suggests this is in Ruby Sass. Haven't confirmed.\n. Please a copy pastable sample that reproduces the issue you're describing. Use sassmeister.com. As it stands we cannot progress this issue because we cannot reproduce it with the code supplied.\n. Please use http://sassmeister.com in the future. This code provided produces no output in Sass. Technically the bug here is that we produce any output at all.\n. No output is produced because all and screen only are incompatible and cannot be merged in a semantically accurate way.\nscss\n@media all and (max-width: 768px) {\n  @media only screen {\n    a { b: c; }\n  }\n}\n. Spec added https://github.com/sass/sass-spec/pull/396\n. Libsass is an implementation of the Sass language. The Sass language to not\nallow for combining these media queries. If you think it should please open\nan issue with the official library http://github.com/sass/sass/issues.\nAs far as the language is concerned the bug here is that we supported this\nbehaviour, however broken it was.\nOn 28 May 2015 00:53, \"Callum Macrae\" notifications@github.com wrote:\n\nWhat?\nOf course they can be merged. It works as nested media queries as raw CSS,\nbut then doesn't work in IE8 because it doesn't support nested media\nqueries.\n\"only screen\" matches both \"all\" and \"only screen\".\nTry it as CSS. It works. SASS breaks it.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1224#issuecomment-106218624.\n. Seems straight forward to me. @mgreter please take a look and pull the trigger.\n. Since you're here I see no reason not to also add the getter. Can you please do so?\n. bump @tristanlins \n. :heart_eyes: \n. I have issues with GitHub wikis in general. My preference would be move all the docs into the repo. Doing so should really help us with keep our docs up to date.\n\nDocuments in repos are better for a bunch of reasons\n- it's available offline when you checkout the repo\n- it can be version controlled\n- it can be part of PRs\n@sindresorhus has written on the topic and I completely agree - https://plus.google.com/+sindresorhus/posts/QSS2du26Mg4\n. > wrappers and out of date wrappers? Should the non-functional ones just be removed from this page entirely?\nI think it would make sense to visibly group wrappers by the Libsass API version.\n\nMaybe there's an easy way to link last committed code on the wiki page?\n\nI would just opt for a link to the GitHub page. This works well enough for npm.\n. If you want to take the initiative to start the migration you :100: :+1: from me :wink: :wink: \n. You're a hero! I think just linking to a /docs/README.md is fine. In my experience linking directly to specific doc will results in stale links as noone will maintain the wiki. Having a TOC on the docs index is plenty.\n. If you're looking for somewhere to start, I'd suggest https://github.com/sass/libsass/wiki/Building-Libsass\nThis information needs more exposure.\n. Thanks for the suggestion @tristanlins.\nThis probably affects @chriseppstein and @drewwells the most. Would also like your feels here @mgreter.\n. @tristanlins is a dead end then? Should this issue be closed?\n. @tristanlins can you supply an example where this fixes source map issues? From a cursory look I would have expected the current behaviour to be correct.\n. Thanks for the report @indrekpaas.\n. Fixed via #1534\n. I am unable to reproduce this specific error. However I have noticed we incorrectly remove the comment and adding maintaining the authors whitespace.\nscss\n@-moz-keyframes animatetoptop /* Firefox */ line 429\n{\nfrom {width:0%}\nto {width:100%}\n}\nRuby Sass\nscss\n@-moz-keyframes animatetoptop /* Firefox */ line 429 {\n  from {\n    width: 0%; }\n  to {\n    width: 100%; } }\nLibsass\nscss\n@-moz-keyframes animatetoptop line 429\n{\n  from {\n    width: 0%; }\n  to {\n    width: 100%; } }\n. We'll stick with docs. It's more node-y\n. :heart_eyes: \n. I have noticed this aswell, however in my experience this doesn't affect the browsers's behaviour. Please confirm this actually causes an issue?\n. Duplicate of #1231.\n. I've assigned this to 3.3. A spec would be appreciated. Possibly related to https://github.com/sass/libsass/issues/1210 \n. Looking at this closer it's actually just an @at-root problem. The selector functions have nothing to do with.\nThis is a duplicate of https://github.com/sass/libsass/issues/1210.\n. I have noticed this aswell, however in my experience this doesn't affect the browsers's behaviour. Please confirm this actually causes an issue?\n. Duplicate of #1231.\n. This looks mildly suspicious. Haven't had time to look into it further.\n@function unicode($str){\n  @return unquote(\"\\\"\") + $str + unquote(\"\\\"\");\n}\n. Please try with gulp-sass@^2. Many issues were addressed in node-sass@3.0.0.\n. You can test code directly with sassmeister.com to confirm whether it's an issue or not.\n. Related https://github.com/sass/libsass/issues/1246\n. This requires a deep refactor. Putting it on ice for now.\n. This is a bug in how we parse ~~spaced~~ lists. A simplified test case is\nscss\n$a: 1\n2\n. Specs added https://github.com/sass/sass-spec/pull/395\n. Thanks @mzgol we're looking into it.\n. Great work. I'll dig into this over the next couple days.\nI noticed some changes to cssize I need to look at closely. Currently it's\na direct port of the ruby version and I would prefer we don't drift. (On my\nphone, I haven't looked at the code yet)\nOn 29 May 2015 18:37, \"Drew Wells\" notifications@github.com wrote:\n\nHoly balls that's an amazing speed up! Great work!\nOn Fri, May 29, 2015 at 7:15 PM Marcel Greter notifications@github.com\nwrote:\n\nPushing my latest refactoring work to public since it is currently at a\nworking state that solves all open @at-root issues, plus a few other open\nissues. PR is still too dirty too actually commit the work to master\nbranch. It also introduced a minor whitespace (linefeed preserving)\nregressions (from issue 1208), since the fix we added for it doesn't seem\nto be 100% correct. I will try to tackle the linefeed preserving again\nat a\nlater stage (the logic for this seems to be clear so far).\nThe following issues should pass with this WIP branch:\n- Error with & selector interpolation in @at-root blocks (#1043\n  https://github.com/sass/libsass/issues/1043)\n- & + '' needs to be wrapped in parentheses (#1170\n  https://github.com/sass/libsass/issues/1170)\n- @at-root https://github.com/at-root and #{&} produces incorrect\n  output (#1210 https://github.com/sass/libsass/issues/1210)\n- Regression in parsing @at-rules (#1214\n  https://github.com/sass/libsass/issues/1214)\n- Dynamic division with interpolation not compatible with libsass (#948\n  https://github.com/sass/libsass/issues/948)\n- Two more tests for is_superselector functions (#963\n  https://github.com/sass/libsass/issues/963)\n- libsass-todo-test/38_expression_in_at_directive\nThis branch also includes quite a few performance optimizations.\nIt brought my sass-spec test suite runtime from 27s down to 7s!\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/sass/libsass/pull/1249\nCommit Summary\n- Refactor contextualize into eval [WIP]\n- Cleaning up [WIP]\n- Make more sense of functions and environments [WIP]\n- Clean up some constructor arguments [WIP]\n- Fix some MSVC warnings (and mute some others)\n- Remove eval snapshot feature [WIP]\n- More clean ups [WIP]\n- Add performance improvements [WIP]\n- Fix windows build (leaks memory) [WIP]\n- Test alternative memory managing model [WIP]\n- Refactor scss parser [WIP]\n- Pass 941 and 948 (regression on 1208) [WIP]\n- Refactor supports/feature query parsing [WIP]\nFile Changes\n- M Makefile https://github.com/sass/libsass/pull/1249/files#diff-0\n  (8)\n- M Makefile.am\n  https://github.com/sass/libsass/pull/1249/files#diff-1 (8)\n- M ast.cpp https://github.com/sass/libsass/pull/1249/files#diff-2\n  (85)\n- M ast.hpp https://github.com/sass/libsass/pull/1249/files#diff-3\n  (123)\n- M ast_def_macros.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-4 (24)\n- M ast_factory.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-5 (4)\n- M ast_fwd_decl.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-6 (9)\n- M bind.cpp https://github.com/sass/libsass/pull/1249/files#diff-7\n  (12)\n- M constants.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-8 (8)\n- M constants.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-9 (6)\n- M context.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-10 (221)\n- D contextualize.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-11 (148)\n- D contextualize.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-12 (46)\n- D contextualize_eval.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-13 (93)\n- D contextualize_eval.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-14 (44)\n- M cssize.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-15 (40)\n- M cssize.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-16 (7)\n- M debugger.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-17 (39)\n- M emitter.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-18 (2)\n- M environment.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-19 (39)\n- M eval.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-20 (441)\n- M eval.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-21 (56)\n- M expand.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-22 (319)\n- M expand.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-23 (34)\n- M extend.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-24 (17)\n- M extend.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-25 (2)\n- M functions.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-26 (29)\n- M inspect.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-27 (33)\n- M inspect.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-28 (7)\n- M json.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-29 (5)\n- M lexer.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-30 (61)\n- M listize.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-31 (5)\n- M listize.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-32 (2)\n- M node.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-33 (2)\n- M operation.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-34 (14)\n- M output.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-35 (10)\n- M output.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-36 (2)\n- M parser.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-37 (2204)\n- M parser.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-38 (65)\n- A parser_feature.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-39 (101)\n- A parser_functions.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-40 (322)\n- A parser_media.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-41 (95)\n- A parser_scss.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-42 (396)\n- A parser_selectors.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-43 (459)\n- A parser_values.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-44 (688)\n- M position.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-45 (6)\n- M position.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-46 (8)\n- M posix/getopt.c\n  https://github.com/sass/libsass/pull/1249/files#diff-47 (5)\n- M prelexer.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-48 (61)\n- M prelexer.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-49 (16)\n- M sass2scss.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-50 (5)\n- M sass_context.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-51 (26)\n- M sass_functions.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-52 (2)\n- M sass_interface.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-53 (4)\n- M test/test_node.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-54 (44)\n- M test/test_selector_difference.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-55 (2)\n- M test/test_specificity.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-56 (2)\n- M test/test_superselector.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-57 (4)\n- M test/test_unification.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-58 (2)\n- M to_string.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-59 (2)\n- M util.cpp\n  https://github.com/sass/libsass/pull/1249/files#diff-60 (46)\n- M util.hpp\n  https://github.com/sass/libsass/pull/1249/files#diff-61 (2)\n- M win/libsass.filters\n  https://github.com/sass/libsass/pull/1249/files#diff-62 (24)\n- M win/libsass.vcxproj\n  https://github.com/sass/libsass/pull/1249/files#diff-63 (10)\nPatch Links:\n- https://github.com/sass/libsass/pull/1249.patch\n- https://github.com/sass/libsass/pull/1249.diff\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1249.\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1249#issuecomment-106971210.\n. Looked at the cssize changes, they're fine.\n. @mgreter if you can get this ready for review in a week I'm cool with\nshipping 3.3 soon.\nOn 5 Jun 2015 00:10, \"Mario Gonzalez\" notifications@github.com wrote:\nReally liking the changes in this branch, everything is really making a\nlot more sense as someone less familiar with the code base!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1249#issuecomment-109184487.\n. @mgreter can you look to stablize this PR this week. We should move future iterations to a new PR. This PR is already way too big.\n\n~~Once it's stable I'll commit some time to digging through it.~~ I want to start getting some early 3.3 betas out in the next two weeks. I suspect we're going to have some pain getting 3.3 out like we did with 3.2.\n. @mgreter can you look to stablize this PR this week. We should move future iterations to a new PR. This PR is already way too big.\n~~Once it's stable I'll commit some time to digging through it.~~ I want to start getting some early 3.3 betas out in the next two weeks. I suspect we're going to have some pain getting 3.3 out like we did with 3.2.\n. I can confirm sass-spec runs ~2x as fast.\n. I can confirm sass-spec runs ~2x as fast.\n. I've had a look through the code. It mostly looks good to me. My main points of contention are\n- I still have no idea what the distinction between String_Constant and String_Quoted is. \n  - We should update the underlying data model to better reflect their use case in a new refactor.\n- The changes to how we parse feature queries make the code less readable and diverge from the spec.\nIn general we should try to avoid having heaps a bunch of if/else if switches. These severely impact code readability, where as a concise function focuses context and adds semantics (via the function name).\n. I've had a look through the code. It mostly looks good to me. My main points of contention are\n- I still have no idea what the distinction between String_Constant and String_Quoted is. \n  - We should update the underlying data model to better reflect their use case in a new refactor.\n- The changes to how we parse feature queries make the code less readable and diverge from the spec.\nIn general we should try to avoid having heaps a bunch of if/else if switches. These severely impact code readability, where as a concise function focuses context and adds semantics (via the function name).\n. I'd also like to see where we can cherry-pick out isolated fixes into their own PRs. Anything we can do to cut down the size of this PR will be a benefit to us as we move forward with 3.3 betas and bug fixes.\n. @ekskimn please do not add any more to this branch. It's already so unwiedly that GitHub wont show diffs :)\nI'll be slicing of parts of this PR that don't belong. We'll aim to merge to then merge this PR at which point we can continue to iterate. If you wish to continue local development you can checkout @mgreter fork and branch of this branch. Once this is merged you can cherry pick your commits into a PR.\n. @mgreter I'll be pulling out some of those smaller commit and merging to master tonight. You should be able to do a rebase in the morning (12hrs after this message).\nI still want to address the changes to feature query parsing. I haven't taken another look at the PR since your rebasing this morning.\n. Great. I'll take a look soon. I'll let you know when to rebase and merge.\nGive me a couple days :)\nOn 1 Jul 2015 17:12, \"Marcel Greter\" notifications@github.com wrote:\n\n@xzyfer https://github.com/xzyfer the feature query parsing has been\npulled out as requested.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1249#issuecomment-117496169.\n. @mgreter regarding the compressed mode issue. ~~I don't believe what you're seeing there is related to sass/sass#1296.~~ However AFAIK that CSS isn't valid so I don't believe we are under any expectations here. \n\nThe spec would appear to agree with me. (Emphasis mine)\n\nThis attribute represents the keyframe selector as a comma-separated list of percentage values. The \u2018from\u2019 and \u2018to\u2019 keywords map to \u20180%\u2019 and \u2018100%\u2019, respectively.\nsource\n\nI'd be curious to see a PR for the affected specs.\n. #### Status update\nI've done some work on separating the concerns in this PR. I have this branch down to 12 commits (half!) after rebasing master.\nI've update the todo list in this PR description with steps to clean up this PR by separating some of the extra concerns mixed in here.\nThere's more work to be done, but it's we're getting closer.\n. It's so pretty! :heart_eyes:!\nI'll start dropping some feedback on the parser refactor over the next 48hrs. So much good stuff here!\n. @mgreter I got overly exciting and reviewed this now. All in all it's huge improvement in readability!\nI'm going to run this branch over my code companies code base. If all is well I say we :ship: !!\n. Heads up I've run into some segfaults and broken output when dealing with &. I'll work on some test cases. /cc @mgreter \n. @mgreter as per out chat, I've found some regressions in this PR. I'll create some sass-specs and list them here. \nThis is the first regression I've found\nscss\nfoo > bar {\n    &:baz {\n        baz: true;\n    }\n}\nscss\nfoo bar:baz {\n  baz: true; }\nThe > is getting dropped\n. scss\nfoo {\n    &:bar > baz {\n        bam: true;\n    }\n}\nscss\nfoo:bar &:bar > baz {\n  bam: true; }\n. It turns out we have very little spec coverage for & usage. I've added some spec coverage for the popular use cases in https://github.com/sass/sass-spec/pull/435. \nThere are current 12 failing specs that pass on the current master.\n. I can confirm the final two todo items fixed in your latest commit. \nCan you please rebase case Complex_Selector::REFERENCE:   cerr << \"{@} \"; break; out of 9f5ef6da0e8ec9287cd800bf98174f049591b286. I ran into it when doing a bisect today. I see you removed it in 3af051e anyway but lets remove it from the source.\n. It's midnight here. I'll rerun this branch over our code base in the morning. If there are no other regressions I'll ship it!\n. I've done some quick testing and I'm see regressions in newlines in selectors. A quick example\n```\n%foo {\n  bar > bam &:before,\n  bar > bam &:after {\n    bar: baz;\n  }\n}\ntest {\n  @extend %foo;\n}\n```\nResult\n```\nbar > bam test:before,\nbar > bam test:after {\n  bar: baz; }\n```\nmaster\nbar > bam test:before,\nbar > bam test:after {\n  bar: baz; }\nRuby Sass\nbar > bam test:before, bar > bam test:after {\n  bar: baz; }\nRemoving the & fixes the output.\n```\n%foo {\n  bar > bam:before,\n  bar > bam:after {\n    bar: baz;\n  }\n}\ntest {\n  @extend %foo;\n}\n```\nResult\ntest bar > bam:before,\ntest bar > bam:after {\n  bar: baz; }\nmaster\ntest bar > bam:before,\ntest bar > bam:after {\n  bar: baz; }\nRuby Sass\ntest bar > bam:before, test bar > bam:after {\n  bar: baz; }\n. Also seeing new lines in selectors appearing after combinators\n```\nfoo {\n\nbar {\n    > baz,\n    > bam {\n      bar: true;\n    }\n  }\n}\n```\n\nResult\nfoo > bar > baz, foo >\nbar > bam {\n  bar: true; }\nMaster & Ruby Sass\nfoo > bar > baz,\nfoo > bar > bam {\n  bar: true; }\n. > So I vote to leave it that way and call it a ruby sass bug\n:+1: I don't care much for matching Sass' whitespace semantics perfectly because they're too unpredictable. Like you say as long as the output is readable it's fine.\n. If CI goes green :ship: it\n:tada: :fireworks: :pizza:\n. Duplicate https://github.com/sass/libsass/issues/1210\n. @chetzof I've reduced this down to the core issue in https://github.com/sass/libsass/issues/1583\n. This may have the same underlying cause as https://github.com/sass/libsass/issues/1171\n. Fixed by #1318.\n. Fixed by #1318.\n. Fixed by https://github.com/sass/libsass/pull/1312\n. @vaanwd we do not use compass. Please track down the function causing the issue and produce a copy-pastable http://sassmeister.com gist that produces this error.\n. @vaanwd we do not use compass. Please track down the function causing the issue and produce a copy-pastable http://sassmeister.com gist that produces this error.\n. Thanks for the report @adambair. Where you using a particular Sass library or framework when you got this error?\n. Ok I've been able to confirm that although the imports are being resolved depth-first (i.e. the output is correct), the custom importers are being execute breadth-first. This looks like an issue with custom importers.\n. This issue is independent of any import-once functionality. To be clear Libsass is resolving the imports in the expected order, so all code works as expected.\nHowever the custom importers aren't not fired as expected. I have a proof of concept I'm iterating on. First I need to determine if the issue is on the node-sass side or the Libsass C API side.\n. The docs so appear to be out of date. I believe we require a minimum of GCC\n4.7.\nI'm curious however if you're able to install and run node-sass as an\nexperiment. As far as I know node-sass has CentOS 5 support.\nOn 9 Jun 2015 08:34, \"Mikael Fridh\" notifications@github.com wrote:\n\nCompiling libsass on CentOS 6 fails these days ...\nYour build documentation says:\nWe do use some C++11 features, but are so far only committed to use\nunordered_map.\nIt doesn't seem to be true, there are unfortunately range-based for loops\nused now in libsass, they don't work on GCC 4.3+ which EL6 uses. I wondered\nif this slipped your scrutiny or you just didn't update the docs yet?\nI managed to fix a few range-based for by replacing them with \"regular\nones\".. but some were too complicated for me to fix so I couldn't get it to\nbuild.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1265.\n. From the readme\nLibSass requires GCC 4.6+ or Clang/LLVM. If your OS is older, this version may not compile.\nOn Windows, you need MinGW with GCC 4.6+ or VS 2013 Update 4+. It is also possible to build LibSass with Clang/LLVM on Windows.\n. You're correct this is due to & not being evaluated as a function parameter. As a work around you can use #{&}.\n. Closing as this is a duplicate of #1260.\n. This is fixed in 3.2.5.\n. Fixed via #1534\n. Specs added https://github.com/sass/sass-spec/pull/416\n. Specs added https://github.com/sass/sass-spec/pull/413\n. Specs added https://github.com/sass/sass-spec/pull/412\n. We'll take a look @VadimGit. We're not expecting a release before 3.3 next month. There has also been a lot of work refactoring the internals, so it's hard to say if this will still be relevant then.\n. Specs added https://github.com/sass/sass-spec/pull/414\n. This is fixed and will be in 3.3.\n. This works as expected in 3.2.5.\n. Specs added https://github.com/sass/sass-spec/pull/420\n. Thanks @saper.\n\nPlease pull the logger into a separate PR. We need the string fix but I'm hesitant to add yet another (undocumented) logger. We should discuss and implement a single debugging interface.\n. @saper aside from style cleanups this is ready for 3.3. We'll be starting betas for 3.3. shortly as it's a massive update.\n. LGTM\n. Specs added https://github.com/sass/sass-spec/pull/411\n. Duplicate https://github.com/sass/libsass/issues/1281\n. The latter declaration example is consistent with Ruby Sass.\n. Specs added https://github.com/sass/sass-spec/pull/415\n. Related https://github.com/sass/libsass/issues/1096\n. @mgreter  you're correct. I spent some trying to fix this issue and as you say this requires significant work. This is a major corner case and isn't a priority for 3.3 given the amount of work required.\n. Rescoped to 3.4 since this only affects insignificant whitespace and as such doesn't prevent people migrating to LibSass from Ruby Sass.\n. Thanks @marek-saji I've confirmed this is a bug.\n. Specs added https://github.com/sass/sass-spec/pull/418\n. Merging this into #1283\n. @thebestako35 you need to wait until we ship 3.3.\nAs a work around for now you should be able to quote the map keys.\n. > what did i miss here\nThis is a 3.3 feature that hasn't been released yet.\n. It's different depending on the case. Usually quoting your keys will fix it. Alternatively don't use keys that that are also colours.\n. Specs added https://github.com/sass/sass-spec/pull/419\n. Specs added https://github.com/sass/sass-spec/pull/417\n. Superseded by #1313\n. :trophy: OMG I've wanted this for ages.\n. Spec added https://github.com/sass/sass-spec/pull/442\n. For clarification this new behaviour only happens for Travis Linux builds.\n. Spec added https://github.com/sass/sass-spec/pull/441\n. Spec added https://github.com/sass/sass-spec/pull/439\n. Since this is a regression I've activated the spec. This will prevent #1249 being merge without the patch applied.\n. Spec added https://github.com/sass/sass-spec/pull/438\n. I would a test case for this. I was unable to reproduce it with the latest foundation.\n. @driekus77 can you please confirm which version of foundation you are using. It should be in the bower.json or package.json in the foundation folder.\n. This is blocked on waiting for a test case.\n. I was able to compiled every 5.x release of foundation, include the latest master with LibSass 3.2.5 without this error.\n. The upstream issue https://github.com/darrenkopp/libsass-net/issues/25 suggests they did not.\n. My guess is we're not going to able to reproduce. I tried everything I could of to hit the code path in question. I believe there should be a memory out of bond bug here as @mgreter points out. \nThe patch in #1319 seems perfectly valid to me. Either way it's an improvement. Let's just :ship:. \n. Assuming this is fixed by https://github.com/sass/libsass/pull/1310\n. @jaredmorrow which version of libsass were you trying to compile?\n. We'd be open to PRs. If nothing else they might set us on the right track to making a workable fix.\n. The core issue for us is that we have no way to test SmartOS so regressions happen frequently.\nIf you know of way to have a Travis CI like solution for SmartOS we'd love integrate it.\n. Thanks. \nIt's largely due to the barrier of testing on those systems. A lot of projects are beholden to online solutions like Travis and Circle. They do allow you to bring your own agents (machines) but that requires a sponsor to host and maintain that machine. If someone was invested enough in those OS to help out in that way we'd love to support it officially.\n. Fixed by #1782. This will be in 3.3.3. Subscribe to #1808 for updates on that release.\n. @saper what's the relationship between this and #1310?\n. Looks like #1310 includes this patch. Closing.\n. Your description in #1310 suggested this was not a sufficient for for #1308. If that's incorrect I'm happy to ship this.\n. @saper can you please rebase this off master.\n. I'd merge this changeset into #1310 and lets :ship:\n. Does #1310 make this moot now?\n. woo!\n. woo!\n. Currently blocked on #1249 \n. @saper did you want to rebase this now\n. Sorry for the delay here @saper. This seems perfectly reasonable to me. I'll :ship: this once the conflicts have been addressed.\n. :boom:\n. ^^ I find this alarming\n. Fixes #1258\n. https://github.com/sass/libsass/pull/1324 fixes the error, but interpolation fails.\nscss\n@import url(foo.css) (min-width: 400px);\n@import url(foo.css) (min-width: $foo);\n@import url(foo.css) (min-width: #{$foo});\n@import url(foo.css) ($bar);\n@import url(foo.css) (#{$bar});\n. Should this be reopedn @mgreter ?\n. Sounds good.\n. I've seen a couple reports of this. It'd be good to have a failing test case to ensure this doesn't regress. I'll work it.\n. Spec added https://github.com/sass/sass-spec/pull/446\n. For what it's worth I was able to reproduce this 100% on OSX\n. I'm not sure about some of the number changes. I need to give it a closer look. The semantics of strict aren't clear. It feels like a bit of a hack to me.\n. Please pull out f37cd95aef6aba4dd07f41b58b03b6eed1b938d9 into it's own PR. I want to take a closer look. \nThe rest looks good to me.\n. Wow yeah something is up with the commit list. Github think there were two different authors on the commits.\n. > Rebased branch to have requested commit to be the first in list\nWhy make it first? Please just remove the commit from this branch. It'll live on in your other PR.\n. :ship: when CI is green!\n. Thanks @chriseppstein this should be a straight forward fix.\n. As an aside I've noticed the following now produces an error\nscss\n$m: (foo: 1px, null: 2px, false: 3px, true: 4px);\n```\nError: Duplicate key \"false\" in map (foo: 1px, true: 4px).\n        on line 1 of test.scss\n\n\n$m: (foo: 1px, null: 2px, false: 3px, true: 4px);\n```\n. Spec added https://github.com/sass/sass-spec/pull/437\n. This is fixed, and will be in 3.3. \n\n\nAn additional aspect to this issue has been broken out into #1336\n. Thanks @terje we've confirmed this is still an issue.\n. Spec added https://github.com/sass/sass-spec/pull/445\n. Thanks @Frexus I can confirm this is still an issue.\n. Spec added https://github.com/sass/sass-spec/pull/444\n. Blocked #1249.\n. Spec added https://github.com/sass/sass-spec/pull/443\n. From Slack chat\n\nhey @ajh long story short, no\nI help @hugogiraudel maintain https://sass-compatibility.github.io/\nReporting incompatibilities between different Sass engines.\nWhich lists compatibility data for most major Sass features, and some important cases where we differ\nThe goal of LibSass is to be a drop in replacement for Sass. However we're still in active development so there are some difference, and some missing features.\nFor the most part we're compatible with Sass 3.3.x (with some bugs)\nThe goal is to be at 100% parity by the end of the year.\nI don't expect anyone will maintain a compatibility chart because it doesn't really make sense given that we're aiming to be drop in replacement. Also we're moving too fast to keep the data up to date.\n. I'd like to hear @chriseppstein thoughts on this.\n. I'll take a closer look at this over the weekend.\n. Sorry it took so long. I've dug into this and :+1: .\n. LibSass' goal is to be a drop in replacement for Ruby Sass. Since in this case we're doing exactly what Ruby Sass does there is nothing to be done here. Closing.\n. I have no input on Makefile changes. Do what you think is best @mgreter :rocket: \n\nI only ask you make the requires upstream changes to the homebrew formula should they be needed.\n. Looks like a header definition mismatch. Otherwise :ship:\n. LGTM\n. \\o/ (hooray!)\n. Happy to merge this!\nI'd love a quick explanation though as to why this fixes the issue. I am not clearer on when to a quoted string vs a constant.\n. Thanks for the explanation.\n. Yeah it's an improvement. This part of eval needs some major refactoring soon. I expect https://github.com/sass/sass/issues/1778 will have a big impact on this going forward.\n. @mgreter I'd prefer to avoid this for now. WE should come back to this after 3.4 when we have parity. For I the over head this is going to introduce when going through git history to find issues/regressions has more cost than benefits here.\n. @mgreter I'd prefer to avoid this for now. WE should come back to this after 3.4 when we have parity. For I the over head this is going to introduce when going through git history to find issues/regressions has more cost than benefits here.\n. :ship: when :traffic_light: is ready\n. @mgreter create a PR for the spec activation and put a link to it in the PR description. This way we never forget specs, and CI can assert the spec passes :)\n. LGTM\n. @robocoder thanks for report\n. LGTM\n. LGTM. @mgreter you've been playing with the build stuff lately, any thoughts here?\n. I've read the conversation in https://github.com/sass/libsass/pull/1352. :ship: this. Thanks @saper.\n. Why was this closed @mgreter ?\n. :+1:\n. @mgreter did you want to get this into 3.3.?\n. Lets wait for 3.4. I'm keen to feature freeze 3.3 ASAP\n. My concern was purely with regards to getting a feature freeze so we can get 3.3 RC out asap.\nGenerally speaking I agree with @am11 points. If this can be sorted ASAP I'm :+1: for 3.3\n. Please add an error-spec\n. Otherwise :ship:\n. IMHO this is a little hacky. We should figure a our a proper fix for this which will also address https://github.com/sass/libsass/issues/1294. They're the same issue IMO\n. Makes sense to me.\n. I have no specific feedback. I'm more interested in @saper's thoughts.\n. I've been following all the discussion around this, and giving it some thought. I'm in agreement with @saper here. The minor overhead of typing std is massively outweighed but he improved code clarity it provides.\nOn a personal note: I'm not a career c++ dev. As a result I've learned on the fly by googling. To me the explicitness std is a huge help. \nOn a community note: This project is gain massive popularity and our contributor base is going. Sticking to some form a best practice or styleguide will be a big boost to helping new contributors get up to speed. Things are much better than they where a year ago, and IMHO explicit namespacing makes things better again.\n. Thanks @saper\n. Our url() has some big issues. I'm not sure how defined the behaviour exhibited above is but it's probably worth tracking. I'm not aware of a duplicate to this issue.\n. The incorrect quoting is being tracked in https://github.com/sass/libsass/issues/1480\n. Thanks @drewwells \n. Thanks @drewwells\n. Thanks @drewwells \n. Thanks for the report @driekus77. Could you please pull request from your fork?\n. Fixed via https://github.com/sass/libsass/pull/1423\n. Fixed via https://github.com/sass/libsass/pull/1389\n. @LoganLehman thanks for the report. I can confirm this is fixed on master and will be the next version of LibSass.\nscss\n$width: 10;\n.container.\\31 25\\25        { width: 100%; max-width: $width * 1.25; min-width: $width; }\n.container.\\37 5\\25         { width: $width * 0.75; }\n.container.\\35 0\\25         { width: $width * 0.5; }\n.container.\\32 5\\25         { width: $width * 0.25; }\nLibSass master\n``` scss\n.container.\\31 25\\25 {\n  width: 100%;\n  max-width: 12.5;\n  min-width: 10; }\n.container.\\37 5\\25 {\n  width: 7.5; }\n.container.\\35 0\\25 {\n  width: 5; }\n.container.\\32 5\\25 {\n  width: 2.5; }\n```\n. @driekus77 some of these fixes have been cherry-picked onto master. Could you please base this PR off master?\n. Hmm ok looks like things got a little messed up here. I've created https://github.com/sass/libsass/pull/1408 to track this from now on. This will allow me to fix the git history myself whilst maintaining @driekus77 authorship!\n. @driekus77 a couple rules of thumb when contributing PRs.\n- Never PR from your forks master. Always create a new branch\n- Never merge in the upstream master. Always rebase.\nIt's good practice to add the upstream repo as a git remote when you fork\n$ git remote add upstream https://github.com/sass/libsass.git\nBefore creating a branch, sync your master with the upstream master.\n$ git fetch upstream\n$ git merge upstream/master\n$ git push\nCreate your branch\ngit checkout -b my-branch\nTrack your branch\ngit push -u origin my-branch\nNow work on your branch. When you're ready to PR make sure all your work is pushed\ngit push\n\nSometimes changes will happen on the upstream master whilst you've been be working on your branch. In this case you'll sometimes be asked to \"rebase your branch off master\". You can do so by syncing your fork's master with the upstream as described above.\n$ git checkout master\n$ git fetch upstream\n$ git merge upstream/master\n$ git push\nThen rebasing your branch off your updated master\n$ git checkout my-branch\n$ git rebase\nThis is sometimes result conflicts during the rebase process. Once they are resolved you'll need to force push you branch since you've now rewritten the previous commits.\n$ git push -f\nBe very careful when force pushing. There is no undo.\n. @QuLogic sure force pushing can be recovered from. These are just general rules.\nI'll almost never merge a PR that contains a merge commit. It's hell on git forensics in the future.\n. Thanks for surfacing this @saper \n. Please add a description to this issue @mgreter \n. Thanks @driekus77\n. I also took a look at this issue last week. I agree we need to re-refactor strings for this to work.\nAs you say this issue is non-critical, and big corner case. I vote for not merging this, until we fully understand the problem.\n. Thanks @driekus77\n. As pointed out by @andybenedict in https://github.com/sass/libsass/issues/1539 this can actually cause broken code when attribute selectors are involved.\n``` scss\n.foo{\n  &[disabled]{\n    display: none;\n  }\n}\n.bar {\n  @extend .foo;\n}\n```\nLibsass\n.foo[disabled], [disabled].bar {\n  display: none;\n}\n. You're both correct. I realised my mistake but hadn't removed the comment. This is why I removed the milestone as per #2174\n. Correct.\n. Correct.\n. Once we have semantic equivalence in sass spec, as opposed to exact matching, this will be \"fixed\".\n. Once we have semantic equivalence in sass spec, as opposed to exact matching, this will be \"fixed\".\n. Fixed in 3.3\n. I've added a second commit which makes the these methods more consistent with the rest of the file. I have not strong feelings about this particular change since this is essentially a 3rd party library.\nHowever the lack of attribution makes it hard to track back upstream so we essentially own this now and internal consistency would be nice.\n. This relates directly to https://github.com/sass/sass/issues/1778\n. This is partially fixed in #1474. The remainder of this issue is being tracked in #1396.\n. I found this issue randomly. Noone has since reported or supported this issue so I don't think it should block 3.4.\nThis also requires a decent amount of work to do right since we don't yet have an interpolation AST node.\n. Fixed by #2572. Handling of url-prefix has been fixed in #1466. There remaining aspect of @-moz-document support are outstanding.\n. I believe this behaviour is a hold over from before we supported the .sass syntax.\n. @mgreter I believe the issue is that our search order differs from Ruby Sass. Seems like a legitimate issue to me.\n\ncss has to be enabled by some options I guess\n\nRuby Sass does not support css imports and IMO this is a mistake we made.\n. I don't see what #1341 has to do with the look up order for imports?\nIf foo.sass and foo.scss exist the cwd then we should match the import resolution behaviour of Ruby Sass.\n. > Other than the extension precedence\nBut that's what this issue is about. \nWhy wouldn't we match this behaviour? It seems inconsequential from a code point of view.\nAdmittedly it's an edge case, but this could affect code portability between the two engines.\n. @andrew-skybound thanks for the report. This issue has been fixed and will be in 3.3.\nLibSass master\nError: Incompatible units: 'px' and 'vh'.\n        on line 12 of test.scss\n  Use --trace for backtrace.\n. @andrew-skybound thanks for the report. I can confirm this issue exists on the latest master.\n. @andrew-skybound thanks for the report. I can confirm this issue exists on the latest master.\n. LibSass is an implementation of the Sass language spec, of which Ruby Sass is the reference implementation. This means we aim to match Ruby Sass 100%.\nThis behaviour is intended. Otherwise we would need to maintain a white list of valid @-directives which would be out of date quickly.\n. @chriseppstein thanks for the report. This has been fixed and will be 3.3.\n. Duplicate https://github.com/sass/libsass/issues/1298\n. Superseded by https://github.com/sass/libsass/pull/1423\n. @Prince-Raul the code you have supplied is not valid Sass. It does not compile with Ruby Sass.\nI assume you meant the following\n```\n.test {\n  content: 'test';\n@at-root #{&}_c {\n    content: 'test_c'\n  }\n}\n```\nIn which case this is a duplicate or https://github.com/sass/libsass/issues/1210 and has been fixed. It will be in the next version of LibSass.\n. In the next month or so.\n. I think it be better to fully namespace the case conditions. Thoughts?\n. I was thinking something like this https://github.com/sass/libsass/pull/1411/files. It passes AppVeyor. Does it fix your issue?\n. Ahh bugger. Something about undef random things makes me uneasy, but it seems pretty standard.\n. Yeah I'm not sure of a work around either. I guess we'll ship it and see how it goes. Could you please add a comment above your change so we know why this exists. Please squash the commit.\n. Legend!\n. Do you still need both commits?\n. You're right about the race condition, which isn't great. Now that we understand the origin of conflict I'm fine with your original commit with a comment and link back to the source of the define.\nAs an aside do you know why AppVeyor wasn't failing on this?\n. Thanks @drewwells!\n. @thasmo as @saper points out, we're simple an implementation of the Sass language. We don't define the language. Any language feature suggestions need to be made upstream with Ruby Sass.\nhttps://github.com/sass/sass/issues\n. @andrew-skybound I'm having trouble following your issue. Please produce copy-pastable code that show the difference between Ruby Sass and LibSass so we can plainly see the difference and debug it.\n. @mgreter which PR addresses this?\n. Confirmed #1475 fixes this.\n. Agreed.\nOn 7 Nov 2015 12:53 pm, \"Marcel Greter\" notifications@github.com wrote:\n\nI vote to close this, since we will probably never implement it.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1414#issuecomment-154597109.\n. @saper can you please confirm your bisect. My bisect points to either 583eac12a7ac1056e932bebc84b93e780bf0bb1d or 9f5ef6da0e8ec9287cd800bf98174f049591b286 which is far more likely.\n\n583eac1 frustratingly a compilation error so I can't easily determine which is the cause.\n. Looking the commits in question is almost certainly 9f5ef6da0e8ec9287cd800bf98174f049591b286\n. Minimal test case\n```\n$parent: &;\n@if $parent {\n  .foo {\n    foo: bar;\n  }\n}\n```\n. This variant also causes a segfault\n@if & {\n  .foo {\n    foo: bar;\n  }\n}\n. > The first half exposed by the mixin case is that we have the selector stack is empty while it should not be \nI'm not sure I'm following. Given this code, the selector stack should be empty, which is causing the error in my first example.\n@include prepend-foo {\n    .bar {\n        color: red;\n    }\n}\n. We can see that the selector scope is being passed to the mixin\n.baz {\n    @include prepend-foo {\n        .bar {\n            color: red;\n        }\n    }\n}\nProduces\n.foo .baz .bar {\n  color: red; }\n. That fix seems fine to me. I'll create the specs so can ship this.\n. If anything I'd say both, since & can be passed as function argument for things like selector_append\n. Returning null from the parent selector eval seems correct to me.\n$list: selector_append(&, bar);\nShould produce\nError: $selectors: null is not a valid selector: it must be a string,\n       a list of strings, or a list of lists of strings for `selector_append'\nWe don't currently produce this error, but it implies having & expanding to null is the correct thing to do.\n. Spec added https://github.com/sass/sass-spec/pull/468\n. @davidkpiano thanks for the report. This is fixed on master and will be 3.3.\n. Spec added https://github.com/sass/sass-spec/pull/462\n. Spec added https://github.com/sass/sass-spec/pull/463\n. Looks like the original patch never fixed the dynamic case.\n. Spec added https://github.com/sass/sass-spec/pull/464\n. Fixed in 3.3\n. Please open this issue in node-sass after running the commands TROUBLESHOOTING.md.\n. The inconsistency in names is a bummer but it seems like the least worst solution for now :+1: \n. Yeah I was thinking rename them for better consistency. Alternatively we use an ENUM on the AST_Node class instead of a constant.\n. Spec added https://github.com/sass/sass-spec/pull/465\n. This has been fixed and will be 3.3\n. This is great @driekus77! I wonder how we can make AppVeyor pick these issues up for us?\n. This is fixed and will be libsass 3.3.\n. This is a Sass feature and as such has been implemented in LibSass.\nscss\na { \n  b: $foo-bar__baz;\n}\nRuby Sass output\nUndefined variable: \"$foo-bar--baz\". on line 2 at column 6\n\nFor historical reasons, variable names (and all other Sass identifiers) can use hyphens and underscores interchangeably. For example, if you define a variable called $main-width, you can access it as $main_width, and vice versa\nSource\n. Please produce a copy pastable working code. We don't have to dig around into other people's libraries.\n\nI believe this is likely a duplicate of https://github.com/sass/libsass/issues/1297 and will be fixed by next LibSass release.\n. Seems legit to me. It's what I would have done.\n. Please also add this patch @saper \ndiff --git a/src/functions.cpp b/src/functions.cpp\nindex 099948d..62cbcd3 100644\n--- a/src/functions.cpp\n+++ b/src/functions.cpp\n@@ -1655,6 +1655,9 @@ namespace Sass {\n       vector<Selector_List*> parsedSelectors;\n       for (size_t i = 0, L = arglist->length(); i < L; ++i) {\n         Expression* exp = dynamic_cast<Expression*>(arglist->value_at_index(i));\n+        if (exp->concrete_type() == Expression::NULL_VAL) {\n+          error(\"$selectors: null is not a valid selector: it must be a string,\\na list of strings, or a list of lists of strings for `selector_append'\", pstate);\n+        }\n         string exp_src = exp->perform(&to_string) + \"{\";\n         Selector_List* sel = Parser::parse_selector(exp_src.c_str(), ctx);\n         parsedSelectors.push_back(sel);```\n. Leave the error for now. I've got a separate patch.\n. Spec added https://github.com/sass/sass-spec/pull/468\n. Spec added https://github.com/sass/sass-spec/pull/469\n. This has come up before. The concern has been that -p is not portable. See discussion in https://github.com/sass/libsass/pull/795\nWe're open to workarounds.\n. @toastal can you be more specific on where it failed? I was not able to produce this on a fresh checkout and make of libsass master.\n. Spec added https://github.com/sass/sass-spec/pull/470\n. \\o/\n. Thanks as always @saper\n. Thanks @indrekpaas. I've confirmed this issue is still present on master. These discrepancies are important, but since doesn't change the semantics of the output CSS this is a low priority atm.\n. Thanks @hyunchulkwak. I can confirmed this is fixed on master and will be 3.3\n. I thought this was an interesting usecase, and I know we have work on the url function coming up so I added a spec https://github.com/sass/sass-spec/pull/474\n. I was wondering the same as @saper. Is there any reason to not support both somehow? \nShould we expect people to be on the latest hotness to be able to build LibSass?\n. Aside from my comment this is mostly whitespace changes so I'm cool with it.\n. I'm happy to ship this when the Windows folk (@am11, @saper) give the go ahead\n. Looks like you're still working on this @am11. Let me know when you're finished and the commits are cleaned up :)\n. Go nuts. just catching up on email! At the very least this release is blocked on https://github.com/sass/libsass/pull/1447 so you've got time. \nI'll be AFK for the next 24hr(ish)\n. @am11 can you also please update the building libsass wiki page for windows?\nOn 17 Aug 2015 05:20, \"Adeel Mujahid\" notifications@github.com wrote:\n\n@saper https://github.com/saper, I used LIBSASS_HEADERS_DIR and\nLIBSASS_SRC_DIR in .targets, .vcxproj.filters and .vcxproj files after\nreading @mgreter https://github.com/mgreter's proposal: #1360\nhttps://github.com/sass/libsass/issues/1360. At the moment, they have\nsame values in [libsass/sassc].vcxproj, but the point was to make the\nproject future refactor compatible. I also used LIBSASS_DIR and\nLIBSASS_STATIC_LIB (user-defined env var which is used in\nlibsass.vcxproj).\nIt will definitely be a good idea to align these build-time variables\nnaming convention across the board (including those we used in node-sass),\nbut that will probably require major overhaul covering gyp, Makefile and\nvcxproj files in libsass and node-sass. IMO we should have an RFC-issue\ntracking that kind of cleanup in libsass issue tracker.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1439#issuecomment-131609816.\n. @am11 go fourth and assume it'll be merged :) \n\nAt this point I'm mostly waiting for docs (https://github.com/sass/sassc/pull/132#issuecomment-131622092) or until I'm back at my computer. Which ever comes first. Hopefully both :)\n. @am11 This still after sass/sassc#132 has been merged\n. @saper I like the sound of that.\n. Frankly if this is working as expected I'm happy to get it shipped. @am11 has put in a lot of great work here and a split although nice, is nitpick a this point IMHO.\n. @am11 I saw it was building in CI so I assumed you were still working on it. If you think you can clean the commit history it more logically then yes please.\nI do see that one of the commits failed to compile, which although I don't use Windows for debugging, is not something we'd generally allow because it makes bisecting more difficult.\n. \n. Thanks for the report @hyunchulkwak. I've confirmed this bug is still present on master.\n. Thanks for the investigation @saper and @mahtd \n. Spec added https://github.com/sass/sass-spec/pull/471\n. Fixed in #1465\n. This is fixed in 3.3.\n. Which versions of libsass and sassc are you compiling?\n. I am able to reproduce this on master.\n. This appears to a regression in 222d8c0856f11a39b3925d45d2a87e86b2e65446\n. I can confirm reverting 222d8c0 fixes the issue. Do have a time to take a look @mgreter? I can't see the issue but I'm not feeling the greatest atm.\nAs as aside we shouldn't be throwing an error here, but removing the error doesn't fix the real issue.\n. Interesting. Looks like you're compiling LibSass master with node-sass. Is that correct? \nIf so, these kinds of errors are expected.\n. Yeah not sure how that could happen.\nMy understanding is that Node Sass shouldn't compile in travis with iojs latest. Node Sass doesn't support iojs 3 yet.\n. This is fixed in 3.2.5. Please update.\nhttps://github.com/sass/libsass/pull/1239\n. Couldn't we just assign the constructor arguments to locally scoped variables before calling the Color constructor? That way the error is thrown before we construct.\nAs as aside the we shouldn't error in this case at all as mentioned in https://github.com/sass/sass-spec/pull/472#issuecomment-131481610\n. I have refactored the colour functions in #1449.\n. @am11 should https://github.com/sass/libsass/pull/1446/files#diff-3f8f7ba253c6298d2c1de8bfdd63c389R53 also be updated to free?\n. Thanks for the clarification @am11. I'll need to school up on memory managers.\n. @saper I agree. This is a rare edge case. The one known occurrence has been patched. I've reverted this in https://github.com/sass/libsass/pull/1450.\n. From @am11 research this isn't isolated to VS \nhttps://github.com/sass/libsass/issues/1443#issuecomment-131463458\n. Thanks @am11. I'll wait til I have the spec suit ready. Since you've made the change in the marco and not in the Color ctor itself we need to sure that all colour functions respect this behaviour. It could be that some color functions do infact throw if the arg is out of range.\n. I think the right solution here is to leave the marco as is and put the clamping in the Color ast node's ctor.\n. Superseded by #1449\n. Thanks @gligoran you're correct the output should be the same in both case. The output CSS is valid and semantically equivalent so this is a low priority bug for the time being.\n. Partly https://github.com/sass/libsass/pull/1446#issuecomment-131817270, and largely because I don't understand the change enough to make the right call here.\n. I can confirm this issue exists in 0ae11a4 on OSX with clang.\n$ clang -v\nApple LLVM version 6.0 (clang-600.0.56) (based on LLVM 3.5svn)\nTarget: x86_64-apple-darwin13.4.0\nThread model: posix\n. Possible. I've left feedback on #1462. \n. I can confirm after applying #1462 locally the segfault is solved. The following is now produced.\n```\nError: may only compare numbers\n        on line 29 of test.scss\n\n\n@if \"foo\" > 0 {}\n```\n. This first RC looks to be immanent. I'll start on the release notes tonight.\n. I've just noticed that some recent LibSass changes have broken SassC. This is a blocker form 3.3. I'll investigate when I have a some time.\n\n\nhttps://github.com/sass/sassc/issues/139\n. @mgreter can we feature freeze now so we can ship the first RC and release notes?\n. I'll have the release notes and RC ready to go for Monday. We're still blocked on sass/sassc#139 however.\n. @mgreter I've completed the release notes. Feel free to ship the release when you've merged your outstanding PRs.\n. Argh a new blocker was just reported (#1546).\n. #1546 is resolved.\n. Taking your word for it :)\n. This is fixed and will be in 3.3\n. This is a known issue https://github.com/sass/libsass/issues/871\n. I guess we need a fix for the SunOS folk.\n. I'd like to have SunOS solved for 3.3\n. If someone wants to submit a patch we'll take a look. Nice work @drewwells. Any clues as to why our CI hasn't been failing on this?\n. I'm sold\n. @darrylhein thanks for the report. We were not aware of this issue. I've added this into the list for the next release since it break the input CSS.\n. Although I cannot reproduce this on OSX I agree with the conclusion. In the future please provide enough system information for a reproduction.\n$ gcc -v\nConfigured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/usr/include/c++/4.2.1\nApple LLVM version 6.0 (clang-600.0.56) (based on LLVM 3.5svn)\nTarget: x86_64-apple-darwin13.4.0\nThread model: posix\n. Not thrilled about the new AST node construction syntax. Is it necessary?\n. I'm happy to move forward with. We all agree there is room for improvement but it fixes the critical issue at hand.\n@mgreter appears to have plans for memory management moving forward, as well as the relevant context.\n\nLet's ditch (mgr.allocate(...)) only.\nPlus I don't see the reason of keeping 80+ lines doing nothing.\n\n@saper makes good points, but I agree with @mgreter with leaving these for now. However I do think we should provide a user error in this code path. It'll help us track any missed news and prevent contributors incorrectly using this method.\n. This will conflict with #1475\n. Shipping this since #1475 is still not quite correct.\n. LGTM we need tests though.\n. :+1: \n. Proti: Fixes only closes one issue at a time.\nCloses just #1434\nFixes #1434 and #1441\nCloses both\nFixes #1434\nFixes #1441\n. :+1:\n. :+1: \n. :+1:\n. :+1:\n. @mgreter I can confirm this passes the current #1405 test case. However some of the cases you've provided in the PR description fail (likely due to conflicting fixes on other recent PRs).\n. -  test-1: -1-em;\n-  test-1: -1-em;\n-  test-2: 1 --em-2--em;\n-  test-2: 1 --em-2 --em;\n-  test-3: -1-em;\n-  test-3: -1-em;\n-  test-4: -1-A-em;\n-  test-4: -1-A-em;\n+  test-1: 1-em-2-em;\n+  test-1: 1-em-2-em;\n+  test-2: 1--em-2--em;\n+  test-2: 1--em-2--em;\n+  test-3: 1-\\\"0-em-2-0-em\\\";\n+  test-3: 1-\\\"0-em\\\"-2-0-em;\n+  test-4: 1-A-em-2-A-em;\n+  test-4: 1-A-em-2-A-em;\n   test-5: -1_em--_--e;\n   test-5: -1_em--_--e;\n   test-6: -1_em--_--e0;\n   test-6: -1_em--_--e0;\n   test-7: -1_em--_--e0__;\n   test-7: -1_em--_--e0__;\n-  test-8: -1\\\\65 _em--_--e0;\n-  test-8: -1\\\\65 _em--_--e0;\n+  test-8: 1\\\\65 _em--_--e0-2\\\\65 _em--_--e0;\n+  test-8: 1\\\\65 _em--_--e0-2\\\\65 _em--_--e0;\n }\n. Cherry picking 99dd3237231651ee310b6a08eb88b3f9fc63e7f0 onto master produced this output\ntype-3: number;\n   type-4: number;\n   type-5: number;\n-  test-1: -1-em;\n-  test-1: -1-em;\n-  test-2: 1 --em-2--em;\n-  test-2: 1 --em-2 --em;\n-  test-3: -1-em;\n-  test-3: -1-em;\n-  test-4: -1-A-em;\n-  test-4: -1-A-em;\n+  test-1: 1-em-2-em;\n+  test-1: 1-em-2-em;\n+  test-2: 1--em-2--em;\n+  test-2: 1--em-2--em;\n+  test-3: 1-\\\"0-em-2-0-em\\\";\n+  test-3: 1-\\\"0-em\\\"-2-0-em;\n+  test-4: 1-A-em-2-A-em;\n+  test-4: 1-A-em-2-A-em;\n   test-5: -1_em--_--e;\n   test-5: -1_em--_--e;\n   test-6: -1_em--_--e0;\n. Getting closer! With f69364b applied I get\n-  test-2: 1 --em-2--em;\n-  test-2: 1 --em-2 --em;\n+  test-2: 1--em-2--em;\n+  test-2: 1--em-2--em;\n. Agreed. I just need need to rework the spec for this issue, and open a new issue for the edge case. Will do it today.\n. :+1:\n. :+1:\n. :+1:\n. @mgreter please address the merge conflicts.\n. Confirmed this is :+1: locally. Will ship when CI is green.\n. :+1:\n. :+1:\n. :+1:\n. The spec for #1370 tracks this.\n. I was about to do this. Thanks @drewwells \n. Probably going to steal this for node-sass as well if you have no objections.\n. :+1:\n. Spec added https://github.com/sass/sass-spec/pull/486\n. This has been fixed and will be in 3.3\n. Spec added https://github.com/sass/sass-spec/pull/483\n. @cahnory thanks the report. In the future please ensure the supplied code sample is valid against the Ruby Sass issue. I've update the issue description with a working reproduction.\n. I believe you are describing @extend - http://sassmeister.com/gist/c657a36fae3c43accfb4\nLibSass is just an implementation of the Sass language. If you wish to request features to the Sass language please open an issue with Sass.\n. @mgreter the machine!\n. Nice find!\n. I expect this is related to https://github.com/sass/libsass/pull/1496\n. I believe this was closed by #1521. Can you please confirm @saper.\n. No objections from me.\n. My 2c on this is that it makes sense to separate the c++ test runner from\nthe sass specs themselves. It's worth remembering that although we're the\nprimary user of sass spec, it exists to serve all Sass implementors. It\nwon't be long before Ruby Sass is using sass spec.\nOn 3 Sep 2015 02:12, \"Marcin Cie\u015blak\" notifications@github.com wrote:\n\nTo test an API you do integration testy. Unit testing requires\ndecomposition of the code internally to test particular pieces. There are\nsome stub tests in\nhttps://github.com/sass/libsass/tree/202a4ea098c6f99ed70344135dbe3d4720e0c681/test\nwhich afaik are not connected to the CI. Getting them to work would be a\ngood first step.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1512#issuecomment-137147984.\n. I noticed this broke in 3.3.3. I use DEBUG_PRINTLN a lot. This made me sad.\n. Maybe I'm misunderstanding, and this is not related to the DEBUG_LVL used by debug.hpp.\n. Spec added and activated in https://github.com/sass/sass-spec/pull/689\n. @brookjordan LibSass just implements the Sass language. Questions and suggestions about the language should be raised with Sass - https://github.com/sass/sass\n. Interesting that I don't see this is clang. We must have different versions.\n. This is fixed on master and will be the next version of LibSass.\n. Spec added https://github.com/sass/sass-spec/pull/489\n. Specs added and activated in https://github.com/sass/sass-spec/pull/689\n. :+1:\n. Nice on @mgreter \n. Created a spec for the declarations that are passing because of this PR - https://github.com/sass/sass-spec/pull/490\n\nfoo {\n    test: type-of(1--em);\n    test: (1--em-2--em);\n    test: (1--em- 2--em);\n    test: (1--em -2--em);\n}\nI've excluded the last declaration because it still fails\ntest-2: (1--em - 2--em);\n. Thanks for the report @mknadler. I can confirm this issue is still present on the latest master.\n. LGTM\n. This is a duplicate of https://github.com/sass/libsass/issues/1392, however we're not aware of the breaking with regards to attribute selectors. Thanks for the report @andybenedict \n. :+1:\n. Is this good to go @mgreter?\n. :+1: \n. Is this good to go @mgreter?\n. Thanks for the report @anlutro. I can confirm this is a regression 3.2.5\n. @anlutro I've had a closer look at this issue. The problem isn't with parsing of @include.\n\nError: Mixin \"f\" does not accept a content block.\n\nThis error suggests this is related https://github.com/sass/libsass/issues/1487.\nLooking closer at the sass2scss conversion, the code supplied is incorrectly being converted to \n```\n@mixin f() {\n  color: red; }\n.foo {\n  @include f() {} }\n```\nWhich in fact is invalid SCSS, and should trigger the error you're seeing. This means he bug is in our conversion process.\n. I've narrowed down the issue to https://github.com/sass/libsass/blob/master/src/sass2scss.cpp#L500\n. Spec added https://github.com/sass/sass-spec/pull/492\n. Will do @mgreter \n. @mgreter done - https://github.com/mgreter/sass2scss/pull/25\n. @mgreter is this related to https://twitter.com/rodneyrehm/status/641610148524478464 ?\n. /cc @rodneyrehm\n. Tested locally, all seems well.\n@rodneyrehm can you confirm whether this fixes the Sass.js issue?\n. Ready for this to ship when you are @mgreter \n. This is fixed in 3.3. You can follow it's release progress by subscribing to https://github.com/sass/libsass/issues/1453\n. Other notable cases where we should, but don't throw this error.\nscss\n@mixin foo() {\n  @function foo() {\n    @return 'foo';\n  }\n}\nscss\n$i: 1;\n@while $i == 1 {\n  @function foo() {\n    @return 'foo';\n  }\n  $i: $i + 1;\n}\nscss\n@each $i in (1) {\n  @function foo() {\n    @return 'foo';\n  }\n}\nscss\n@for $i from 1 through 2 {\n  @function foo() {\n    @return 'foo';\n  }\n}\n. I like it, but it's not Sass :(\n. Turns out this also affects mixins\n``` scss\n@mixin foo() {\n  @mixin bar() {\n    @return 'foo';\n  }\n}\n```\n. https://twitter.com/chriseppstein/status/643584546298986496\n. I agree with @akhleung and @saper. I don't think this is worth it.\n. As stated by everyone else in this issue this is adding 900 virtually pointless LOC to, as you stated yourself, avoid occasionally adding a guard when debugging.\n@saper @akhleung  and myself agree this change makes the code unnecessarily significantly harder to reason about, without adding any real benefit.\n\nI have not seen any hard evidence for the claimed problems\n\nYou have also not backed up your own claims. As @akhleung the spec runner is not indicative of real work use cases.\n\nold way is still there, so completely optional\n\nHaving the old way being completely optional is not a good a thing. Having two ways to do something is a bad thing.\n\nbut I don't feel that the \"redundancy\" is a problem \n\nRedundant code is a problem.\n. This current node-sass release will be addressing a Node 6 compatibility issue. We won't be conflating that with LibSass update also. Node Sass will land 3.3.7 in an upcoming release.\n. Thanks for the report @vsxed. In the future please provide copy-pastable test code eg. https://github.com/sass/libsass/issues/1392\n. @vsxed can you please provide the version of Sass you're using\nsass -v\nUsing Sass 3.4.14 I get following error\nError: Invalid CSS after \".test-1/\": expected identifier, was \"2\"\n. I've confirmed this does not work with latest Ruby Sass.\n. This a known issue of sorts. Recent version of Ruby Sass implemented a subtle rounding in colour functions to compensate. We have not applied the same fix yet.\n\nImprove rounding of the results of color operations.\n- 3.4.14 changelog\n  http://sass-lang.com/documentation/file.SASS_CHANGELOG.html\n. Original upstream issue https://github.com/sass/sass/issues/1690\n. I'm going to do some big updates to how we do colours 3.4. This will be fixed as part of that.\n. Don't worry about a test for this. Technically we already have it with our\ncurrent colour function test coverage. We've essential disabled the rest by\nlocking to a version of ruby without the colour rounding.\nOn 24 Sep 2015 09:08, \"Marcin Cie\u015blak\" notifications@github.com wrote:\nIt is impossible to write a test for this; if we are (and it is so\nspecified) using floating point arithmetic - I'd need to check values\nagainst \u025b. I think in this case some fixed-point integer-like arithmetic\nshould suffice, but that's on our reference implementation to settle on\nsomething.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1554#issuecomment-142835846.\n. This should be fixed in 3.3.2. Please reopen if the problem persists.\n. @conceptdeluxe you've run into an interesting caveat of how we build LibSass.\n\nWe currently test against Ruby Sass 3.4.16 which returns #fde8e8;. However this appears to have changed by 3.4.20 which now returns #f2f2f2.\nThis will be fixed once we're testing against the version that introduced this fix.\n. Do you have an example. Locally it looks like Libsass and Ruby Sass but use 8 space. Could be something about my maching\n```\n// Ruby Sass\nError: Invalid CSS after \"...nt 'Comic Sans'\": expected \"{\", was \";\"\n        on line 30 of test.scss\n  Use --trace for backtrace.\n\n// Libsass\nError: property \"font\" must be followed by a ':'\n        on line 30 of test.scss\n\n\nfont 'Comic Sans';\n   --^\n```\n. > You can easily see this with\n\n\nI could not. I did however see that for warning there is 9 spaces, which appears to be purely aesthetic for alignment.  However this change is not just for warnings.\n. > takes only god first line for comparison\n:+1: this has been my approach in the past\n. It's entirely likely this documentation is just out of date. The SassC docs are much more recent which would explain why they worked.\nThere is work to migrate docs from the wiki to the codebase to help keep it up to date https://github.com/sass/libsass/issues/1226.\n. This is due to our lexer being case sensitive for keywords like and, or and new.\n. Sorry missed this. Tracking in https://github.com/sass/libsass/issues/1563 instead.\n. @saper please provide copy-pastable code samples in the issue, not in the title.\n. @nkovacs no that is not related. Your issue is fixed in the 3.3.0-beta.\n. ~~I cannot reproduce on 997c86d0f479b11da8abf87b62cadcd06f915288~~\n. My mistake.\n. I have a fix for this. Will publish when I'm home.\n. Waahh! I'm super excited about the nginx module. I've been talking about\nbuilding it for months!\nOn 26 Sep 2015 14:56, \"Lawrence Meckan\" notifications@github.com wrote:\n\nJust letting you know there's 2 new LibSASS implementations now in the\nwild:\n- https://github.com/mneudert/sass-nginx-module\n- https://github.com/DerPapst/sasshhvm\nI'm currently working on updating the various PHP / Nginx / HHVM\nimplementation with the full LibSASS 3.2.5 featureset\nI will do pull requests for the Nginx & HHVM implementations once I've\nfinished it. My 3.2.5 pull request for the PHP implementation is done, but\noutstanding & awaiting merge.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1572.\n. Thanks @khchanel we really appreciate your contribution :)\n. Thanks for the report @jorrit \n. Spec added https://github.com/sass/sass-spec/pull/530\n. Thanks for the report @cimmanon. \nSpec added https://github.com/sass/sass-spec/pull/529\n\n/cc @mgreter this could be a bug with sass2scss\n. Specs added https://github.com/sass/sass-spec/pull/527\n. This was fixed by #1588\n. No.\n. I don't understand @mgreter and @joneff. You examples act as I would expect.\n. I think my initial example is misleading. The issue here is how we output lists in inspect\n```\nfoo {\n  string: inspect(&);\n  str-length: str-length(inspect(&));\n  list-length: length(&);\n}\nfoo, bar {\n  string: inspect(&);\n  str-length: str-length(inspect(&));\n  list-length: length(&);\n}\n```\nRuby Sass\n```\nfoo {\n  string: (foo,);\n  str-length: 6;\n  list-length: 1; }\nfoo, bar {\n  string: foo, bar;\n  str-length: 8;\n  list-length: 2; }\n```\nLibSass 3.3.2\n```\nfoo {\n  string: foo;\n  str-length: 3;\n  list-length: 1; }\nfoo, bar {\n  string: foo, bar;\n  str-length: 8;\n  list-length: 2; }\n```\n. Update the issue title and spec https://github.com/sass/sass-spec/pull/636\n. I'm still curious about this. I'll take a look at it separately from #2064.\n. I have a WIP for that may also solve #2006.\n. I'm pretty close on this. Should have something soon.\n. Made a lot of progress on this. Down to a couple failings due us incorrectly handling propsets.\n. @mgreter I'm at work atm but I'll be shipping this over a handful of PRs this week. It required touching more code than I had expected.  \n. @mgreter WIP PR in #2086. It's super messy but works as expected is like for like port from Ruby Sass.\n. Hi @djam90, please provide a fully working, copy-pastable Sass snippet that produces the issue you're experiencing.\nI suggest using sassmeister.com. Given the limited information you've provided I cannot reproduce your issue. http://sassmeister.com/gist/dc3403067eb23f65c3bf\n. Thanks for the report. Could you please provide a minimal snippet of Sass\ncode that exhibits this problem so we can debug it?\nOn 9 Oct 2015 8:51 am, \"Peter Wilson\" notifications@github.com wrote:\n\nIt's very minor but a valid comparison in rubySass required refactoring\nfor libSass.\nrubySass: @if ( & == $sel ) {\nlibSass: @if ( \"&\" == $sel ) {\nFull mixin follows:\n@mixin last-child($sel: null){\n    // for use with the miniselectivzr code in the polyfill JS\n    // standard file uses :last-child psuedo class\n    // IE file uses the u-last-child utility class\n    @if ( \"&\" == $sel ) {\n        @if ( true == $is_ie8_file ) {\n            &.u-last-child {\n                @content;\n            }\n        } @else {\n            &:last-child {\n                @content;\n            }\n        }\n    }\n    @else {\n        @if ( true == $is_ie8_file ) {\n            #{$sel}.u-last-child {\n                @content;\n            }\n        } @else {\n            #{$sel}:last-child {\n                @content;\n            }\n        }\n    }\n}\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1590.\n. Thanks @unmole. I'm happy with either approach.\n. The spec currently failing is with regards to insignificant whitespace. Not entirely sure how to handle this yet.\n\nscss\na {\n  b: url(data:image/png;base64,iVI= );\n}\nRuby Sass\nscss\na {\n  b: url(data:image/png;base64,iVI= );\n}\nLibSass\nscss\na {\n  b: url(data:image/png;base64,iVI=); // no whitespace\n}\n. This was fixed in 3.3. \n\nreplace uri functions / variables with their real_ prefixed versions\n\nIs fixed in 3.3.3.\n. > determine / implement the correct semantics for @import url()\nIs fixed in 3.3.3.\n. A trivial example from MDN.\ncss\n@document url(http://www.w3.org/),\n               url-prefix(http://www.w3.org/Style/),\n               domain(mozilla.org),\n               regexp(\"https:.*\")\n. Yeah I'll sort this out for 3.4.\n. Tests for this now pass, added the spec in https://github.com/sass/sass-spec/pull/872\n. Fixed by #1809\n. LGTM, please update the test case as mentioned in https://github.com/sass/libsass/issues/1567#issuecomment-147875058 before merging.\n. Updated specs in https://github.com/sass/sass-spec/pull/540\n. Spec activated in https://github.com/sass/sass-spec/pull/542\n. Spec activated - https://github.com/sass/sass-spec/pull/546\n. This appears to be the same issue as https://github.com/sass/libsass/issues/1604. Close this in favour of that report.\n. I also cannot make this pass in Ruby 3.4.18\n. Thanks for the report @davidkpiano. This appears to be a duplicate of https://github.com/sass/libsass/issues/1602 but I'm going to make this authoritative because it's clearer.\n. Specs added https://github.com/sass/sass-spec/pull/544\n. Thanks for the report @mknadler, and clarification @chriseppstein \n. Spec activated - https://github.com/sass/sass-spec/pull/545\n. Spec currently failing on compressed output. I'll looking it in the morning.\n. ~~Currently blocked on https://github.com/sass/libsass/issues/1612~~\n. Agreed.. Spec activated https://github.com/sass/sass-spec/pull/571\n. Spec activated https://github.com/sass/sass-spec/pull/561\n. :+1:\n. Be sure to activate the spec.\n. Spec activated https://github.com/sass/sass-spec/pull/552\n. :+1:\n. :+1: \nPlease avoid further changes to the lexers and parser. I have a WIP with heavy refactors for 3.3.1.\n. @mgreter I'm going to tag 3.3 stable when this is merged.\n. If getting this stable require more changes than this, I say leave it. This code has already been heavily refactored in my WIP branch.\n. Sure, just say when!\n. Spec activated https://github.com/sass/sass-spec/pull/562\n. The cause of the failing colour specs is that Ruby Sass added epsilon rounding (as @saper suggested) in 3.4.15. We should do the same thing. We added epsilon round for the random function in 3.3.\n. Wen shouldn't use std::round for rounding in colour conversions. It won't predictably pass tests.\nhttps://github.com/sass/sass/commit/2c537b14a290215c6e869cf4a8a86f5f67102da8\nhttps://github.com/sass/sass/commit/14ec0d077bcc57f480f482c4fab6b9042153c047\n. https://github.com/sass/sass-spec/pull/555 is problematic. It cannot be merged until we bump sass-spec to at least 3.4.15. Otherwise sass-spec will fail on every PR.\nThis could really blow out the scope of something should in 3.3.2. We need to look into many active specs break under 3.4.15, before moving forward here. I'll look into this tonight.\n. @mgreter please rebase this off master and squash the remaining two commits. I'm evaluating the feasibility of this landing in 3.3.2.\n. Thanks @mgreter. Bumping to 3.4.19 doesn't fail many tests based on output. However many now fail on  due to added deprecation warnings. This seems like a big job. Might be better scoped to 3.4.\n. These specs don't fail the 32bit builds in CI. Merging this would fail all our CI builds for either LibSass or Sass Spec. We can't merge this yet.\n. My mistake. Presumably the failures are just rounding errors. If so they affect is imperceivable to users. The point still stands that merging this would break CI for us. This has been this way for a long time, it can wait until we're ready.\n. Thanks for the report @davidkpiano I can confirm this is a regression 3.3. We'll be releasing 3.3.1 in the next couple days as regressions are being reported.\nSpec added https://github.com/sass/sass-spec/pull/557\n. How so? I routinely build LibSass on centos 5. Updating GCC is trivial\nenough.\nOn 30 Apr 2016 12:53 AM, \"Steven Arnott\" notifications@github.com wrote:\n\nThis is essential to use this module on Centos6 based hosts, in corporate\nenvironments\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1623#issuecomment-215743515\n. IMHO we cannot do this without also running GCC 4.4 in CI as well\n. Please a documentation page for compiling with gcc 4.4 which at the very\nleast documents the Python dependency, the purpose of the Python script,\nand it's caveats i.e. naive parsing.\nOn 2 May 2016 7:11 AM, \"Marcel Greter\" notifications@github.com wrote:\n\nIMO any code change may add something gcc 4.4 incompatible (I did so with\nltrim/rtrim). I guess there are always chances we need to fix up these\nincompatibilites at a later stage, and I don't see the short for loops as\nan exclusion here. And as a developer I really would like to keep the\nconvenience.\n\u2014\nYou are receiving this because you commented.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1623#issuecomment-216072995\n. I'm open to a PR for cpplint style check in CI. With cinema level\nguarantees I don't feel comfortable attempting gcc 4.4 support.\nOn 2 Jul 2016 7:21 AM, \"James Brown\" notifications@github.com wrote:\n\n+1 most production environments aren't going to support gcc5 for a while,\nit would be nice to keep Saas working without requiring crazy-bleeding-edge\nversions of things. Enterprise life-cycles are measured in years, not\nmonths...\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/1623#issuecomment-230050116, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe/AAjZWHUHOUHRhcCZWDgIXueTHp2TQwNtks5qRYT1gaJpZM4GVJlz\n.\n. This seems at odds with interpolations always returning a quoted string. \nMaybe @chriseppstein can shed some light on the exact semantics here.\n. Ok I had a look at the Ruby source. They explicitly unquote the results of interpolations in ruleset selectors.\n. Thanks for the clarification. I mis-remembered our previous discussion and mistaken though the opposite. \n\nTracking in https://github.com/sass/libsass/issues/1647.\n. @mgreter I pulled out a bunch of the code that wasn't relevant larger refactor into #1662, #1663, #1664, #1665, #1666\nThis also appears to include the rounding refactor from #1621.\nCould you please rebase off master, and also remove those sass rounding commits? \nThen I'll dig into this refactor. The scope now look small enough that this could land in 3.3.2.\n. I'll work through it over the next couple days. Nothing has jumped out at me yet. This is probably one of the last things before 3.3.2. Could you also update the markdown docs as well?\n. Sorry https://github.com/sass/libsass/pull/1626#issuecomment-151022461 made me think there was \n. Can you also rebase out the rounding commits? They don't belong here.\n. That's ok. The rounding PR wont land in 3.3.2 because updating sass-spec to a new Ruby Sass breaks too many specs. (mostly on error messages / deprecation warnings)\n. LGTM. I'm not sold on the names of the new classes, purely because without the comments their purpose is unclear.\nI would like to see https://github.com/sass/libsass/pull/1626#issuecomment-151022461 added to documentation somewhere as part of this PR. Then feel free to :ship:\n. I don't think we're ever going to get this 100% right until we move resolving of operations to be the AST nodes themselves.\n. Thanks for the report @LizzieCohaesus. I can confirm this a regression. We'll be getting a fix out asap.\n. Spec added https://github.com/sass/sass-spec/pull/566\n. Spec added https://github.com/sass/sass-spec/pull/565\n. This is trickier than I expected. I'll take another look tomorrow.\n. We're consistent with Ruby Sass. We don't intend to diverge on this. Please open a feature request with Ruby Sass https://github.com/sass/sass/issues\n. LGTM\n. Specs added https://github.com/sass/sass-spec/pull/568\n. Thanks for the report @chriseppstein \n\nThis can be reproduced by running the tests in eyeglass on the node-sass-3-4 branch\n\nThank you for this!\n\nThis is fixed by #1626 though a smaller point fix could also be made\n\nI'm keen to get this out in 3.3.2\n. Spec added https://github.com/sass/sass-spec/pull/569\n. Spec activated https://github.com/sass/sass-spec/pull/570\n. This was fixed in 3.3.1 which was released today. Please try again on that\nversion to see if the problem persists.\nOn 27 Oct 2015 8:30 pm, \"\u0412\u0438\u043a\u0442\u043e\u0440 \u0412\u0438\u043a\u0442\u043e\u0440\" notifications@github.com wrote:\n\nThe following code:\n.some-block {\n    background: transparent url(\"image.jpg\") 50% 50% / cover no-repeat;\n}\nResults in the following with sass\n.some-block {\n    background: transparent url(\"image.jpg\") 50% 50% / cover no-repeat;\n}\nBut the following with libsass:\n.some-block {\n    background: transparent url(\"image.jpg\") 50% 50%/\"cover\" no-repeat;\n}\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1642.\n. Thanks for the report @HeadOnAPlate. We're looking into it.\n. The previous behaviour was a bug. This code should error because there is no parent selector to replace & with.\n\nError: Base-level rules cannot contain the parent-selector-referencing character '&'.\n        on line 30 of test.scss, in `@content'\n        from line 22 of test.scss, in `grid-media-query'\n        from line 29 of test.scss\n  Use --trace for backtrace.\n. Give that the output is essentially invalid CSS the current behaviour is more correct than the previous behaviour. As such I'm moving this to 3.3.3.\n. Since & is just a list you can test length(&) to see if you're current context has a parent selector.\nThis may be buggy in LibSass atm. I would develop against Ruby Sass then see if it works on LibSass.\n. I've got a patch for this locally.\n. Quiet possibly. I'm working on this fix. It'll be in the next release.\nOn 20 Nov 2015 6:16 am, \"E. Miriam Suzanne\" notifications@github.com\nwrote:\n\nI just ran into this issue today\nhttp://sassmeister.com/gist/06cc198106af785c61f9, and wonder if it's\nthe same thing?\n$function: 'hsl';$hue: 360;$value: (30%, 40%);\n.test {  // This doesn't work in libsass (works in ruby sass)\n  background-color: call($function, $hue, $value...);\n  // This works great\n  $call: join(($function, $hue), $value);\n  color: call($call...);\n}\n// ERROR: required parameter $lightness is missing in call to function hsl on line 7 at column 21\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1645#issuecomment-158162349.\n. Spec added https://github.com/sass/sass-spec/pull/621\n. I have a passing branch for this. It's not pretty but it works for now. I've decided to extend this issue encompass \"sassdash test suite passing\".\n\nAll sassdash tests that aren't segfaulting are passing. I think most of the segfaults are due to #1813 so I think we're close.\n. I know it's been a while @mirisuzanne but the usecase you reported last month is also covered by this patch.\n. I think there is something to be done here. We need to make sure in Eval that String_Schema and Selector_Schema always remove quotes from interpolants. This clearly isn't happening hence by hacky patch.\nAt the time I was under the wrong impression that interpolants always resulted in quoted strings, and that selectors were a special case. It's clear that I was incorrect.\n. As part of this fix https://github.com/sass/libsass/pull/1633 should be reverted.\n. @mlarcher not yet. We welcome small, isolated test cases that show where we fail to respect this rule.\n. Reduced test case\n```\n$map: (foo: 'b', bar: c);\n$list: ('d', e);\na {\n  #{map-get($map, foo)} & {\n      foo: bar;\n  }\n  #{map-get($map, bar)} & {\n      foo: bar;\n  }\n#{nth($list, 1)} & {\n      foo: bar;\n  }\n#{nth($list, 2)} & {\n      foo: bar;\n  }\n}\n``\n. Created https://github.com/sass/sass-spec/pull/646 to track cases where we know we're currently failing to unquote interpolation. The coverage could be expanded if someone as willing to take that task on.\n. The white space being preserved looks like the work of a static value parser.\n. Looks like Ruby Sass'almost_any_value_tokenmethod is the cause.\n. Scratch that, we do support with/without. As previously state this issue is due to the parser attempting to assert things it cannot know. The nesting checking for@extends` must be done in eval or later. \n. Looks like in compressed more Ruby Sass does some minor selector rewriting which accounts for the difference noted in https://github.com/sass/libsass/issues/1650#issuecomment-151645209.\nhttps://github.com/sass/sass/blob/stable/lib/sass/tree/visitors/to_css.rb#L300\nWe should be able to emulate this behaviour.\n. Thanks for the report @andrew-skybound \n. Spec added https://github.com/sass/sass-spec/pull/618\n. Updated specs https://github.com/sass/sass-spec/pull/645\n. @mgreter IMHO this is a bug. It's work noting that &-- and &__ had their own semantics. This behaviour was introduced in Ruby Sass 3.3.0.\n\nThe parent selector, &, can be used with an identifier suffix. For example, &-suffix and &_suffix are now legal. The suffix will be added to the end of the parent selector, and will throw an error if this isn\u2019t possible. & must still appear at the beginning of a compound selector \u2013 that is, .foo-& is still illegal.\nSource\n\nMaybe @chriseppstein can give more information on the exact semantics.\n. I didn't know that about %placeholders. @mgreter the extends implementation\nwas written by a third party just before I joined.\nIMHO it would be worth while doing a line by line reimplementation of the\nRuby version. The Ruby extend code is relatively self contained. I believe\nthis is how the original implementation was done.\nOn 29 Oct 2015 6:20 am, \"Marcel Greter\" notifications@github.com wrote:\n\nIMO that's pretty funky and not as I intuitively expected it to be. Here\nanother test case:\n%foo {\n  &bar {\n    display: inner;\n  }\n  &.bar {\n    display: outer;\n  }\n}\nzoo {\n  @extend %foobar;\n}\nRuby Sass result:\nzoo {\n  display: inner; }\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1654#issuecomment-151962432.\n. Ok so this is more complicated than it seems.\n\nWe support without and there is good test coverage for it, but the at-root logic happens in the cssize step.\nWe should throw the extend error during the extend step not in the parser. Only then can we know for sure that the @extend is valid. \nThis is how Ruby Sass does it.\n. This patch slated for 3.3.3 but it isn't sufficient. Closing as this approach doesn't address the underlying issue.\n. Full disclosure I still think this feature should be removed. Our directive is to do what Ruby Sass does. Anything deviation from their implementation breaks portability, and is indistinguishable from a bug.\n\nAlso Ruby Sass does not allow this by default, but a few tools (AFAIK compass too) enable this by default for Ruby Sass\n\nThis isn't our job. This belongs in the realm of tools like wellington and eyeglass.\n\nI'm also not sure if we really want to disable it by default\n\nI vehemently believe it should. \n\nthis would be another potentially breaking change\n\nThe current behaviour is broken as far as Sass users are concerned. \n. > You should be able to switch from libsass to ruby sass in theory without anything breaking\nExactly.\n\nThe next best thing would be as @xzyfer says and to at least have them be consistent\n\nThis is what we will do.\n. Sass 4.0 will bring in a way to do this properly.\n. @mgreter I've talked to @chriseppstein and @nex3 about this problem. We've decided that even though inline of CSS imports breaks Ruby Sass compatibility in a big way, removing this feature is likely to upset users. This has been a long requested feature in Ruby Sass which wasn't possible due the limitations of being a CSS superset. As a result almost certain people are depending on this behaviour.\nLet's instead aim to remove this in 4.0 since users are more accepting of breaking changes in major releases, and because we'll have an official way to inline CSS imports.\n. > What version of libsass was this bug introduced?\nI can't be certain. I think it was around 3.3.0 which is in node-sass@v3.4.0.\n\nWhat version is the fix going into - 3.5? 4.0?\n\nThis will be fixed in 4.0 once @use lands. It will allow people explicitly opt-in to CSS imports.\n\nWhen is that version scheduled to release?\n\nImpossible to say unfortunately. Not likely to be this year.\n\nAs an aside if you're using node-sass you can write a custom importer to noop imports for .css files. \n. Looks like you're correct. If we're happy to go with 0 over NULL we're done here.\n@saper suggested we should prefer NULL. He can speak to this more.\n. I didn't realise this root issue was specific to just src/util.cpp. We use 0 in place of NULL a lot.\n. I believe that is why @mgreter wanted to leave it as is. My understanding of NULL in C++ is that it's functionally equivalent to 0 (at least in out use case)\n\nIn C++, the definition of NULL is 0, so there is only an aesthetic difference. I prefer to avoid macros, so I use 0. Another problem with NULL is that people sometimes mistakenly believe that it is different from 0 and/or not an integer. In pre-standard code, NULL was/is sometimes defined to something unsuitable and therefore had/has to be avoided. That's less common these days.\nIf you have to name the null pointer, call it nullptr; that's what it's called in C++11. Then, nullptr will be a keyword.\nSource\n. > Ok, so this is not \"wrong\" just \"I don't like it\".\n\nThis distinction is good to know.\n\nstroul(buffer, 0, 16); looks like 0 was just an ordinary number\n\nCool. So generally speaking I'm with @mgreter. We should stick with 0 for now.\nHowever understand what you're saying in this case, and I think it makes sense to use NULL where 0 is ambiguous.\nIMHO we should ship #1660.\n. Fixed by #1660\n. > IMO we should refactor to make Has_Block directly inherit from Block\nThe Ruby implementation does what you're suggesting AFAIK.\n\nBut I guess this will introduce difficulties for cssize.\n\nI don't think this will be an issue. The cssize is a direct line-for-line port from the Ruby implementation.\n. Should be\n. @alanhogan yes, I hadn't triaged this issue yet.\n. @yisibl about an hour ago https://twitter.com/nodesass/status/695218642212945921\nnpm install gulp-sass@beta\nor\n\"gulp-sass\": \"beta\",\n. Spec added https://github.com/sass/sass-spec/pull/578\n. @aarongeorge this is fixed in 3.3.0. Make sure you're running an up to date version of LibSass.\n. @joecritch it's not clear what your issue is from the code supplied. However it does not appear to be related. In the future use working, copy pastable examples that we can run locally to see the issue for ourselves.\n. @aarongeorge I've added a test case to make sure this does not break in the future. https://github.com/sass/sass-spec/pull/592\n. Regression happen, it's unfortunate. We did extensive beta testing and this\nwas not reported.\nOn 4 Nov 2015 12:58 am, \"Joe Critchley\" notifications@github.com wrote:\n\n@xzyfer https://github.com/xzyfer I'll try and put a test scenario\ntogether, but my point is that a new version of libsass caused a regression\non my codebase, which required the two above workarounds. (Surely\nexplicitly quoting something and then immediately unquoting it should be\nthe same as something that's not initially quoted.)\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1672#issuecomment-153362093.\n. See https://github.com/sass/sassc/issues/153#issuecomment-155092107\nOn 8 Nov 2015 5:38 pm, \"Aaron George\" notifications@github.com wrote:\n@xzyfer https://github.com/xzyfer Any reason brew will only pull down\nv3.2.5 on El Capitan?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1672#issuecomment-154899216.\n. Fixed by https://github.com/sass/libsass/issues/1675. Creating a spec for good measure.\n. Spec added https://github.com/sass/sass-spec/pull/596\n. Thanks @penman !\n. :+1:\n. Is there a test to assert this behaviour doesn't regress?\n. It exists but it hasn't been activated.\n. The algorithm I have for determining which path to show isn't perfect, but it's closer than it was and it makes sass-spec happy. I've opened https://github.com/sass/sass/issues/1880 to help get us on the same page moving forward.\n. Thanks for the report @BPScott \n. @mgreter I'm pretty much done with this work. Leave it to me. We won't bump to 3.4.19 in this release since that conflicts with the static parser refactor I'm working on. We'll aim for 3.4.16 so we can get the sass colour rounding in place.\n. ~~Interestingly this is failing on OSX builds.~~\n\nThis was due to API rate limiting.\n. @mgreter AFAIK Sass::Util::round doesn't care about precession. That is for the output stage. I've removed it from this PR. Feel free to add it back if there is a specific need for it. I'm not aware of one.\n. That's not our decision to make. Ruby Sass bugs are LibSass features.\nOn 4 Nov 2015 6:53 am, \"Marcel Greter\" notifications@github.com wrote:\n\n@xzyfer https://github.com/xzyfer IMHO 0.00001 means that it has an\nepsilon for precision of 5 and should be different for other precision\noptions. IMHO this is a ruby sass bug ...\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1688#issuecomment-153469019.\n. Does it? It's meant to be read only.\n. I don't follow. He claims it give write access, with no evidence even though GH allows for read-only tokens. Are you able to use this to write to the repo?\n. You appear to be correct. rage\nGrants read/write access to code, commit statuses, collaborators, and deployment statuses for public repositories and organizations. Also required for starring public repositories.\n. I am significantly frustrated by having been blocked in CI issue for the last couple hours. We should go back to just running the sass-spec PR code on the minimal set of combinations.\n. If we're going to stay down the proxy approach we should find a 3rd party proxy service. I have no issues giving someone money to make this problem go away. We need something myself or @saper can also manage without needing to get a hold of you. Timezones and all that.\n. @QuLogic this becomes problematic when you have multiple commits in a PR. It's also practically impossible to get contributors to follow any kind of guidelines when it comes to git.\n. No eta as of yet. Focusing on a bind refactor for https://github.com/sass/libsass/issues/1645\n. Been chatting with the Sass folk. There's no longer a need to match Ruby Sass quirks that arise from static value parsing see https://github.com/sass/sass-spec/issues/1075. Thanks for the @andrew-skybound \n. Agree.\n\nOn 12 Jan. 2018 9:56 am, \"Marcel Greter\" notifications@github.com wrote:\nIMO this should be closed since no longer relevant (last IE version to\nsupport filters was IE9). IMO there is no merit to support this in future\nversion of libsass. Feel free to re-open if you see it otherwise. //CC\n@xzyfer https://github.com/xzyfer.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/1694#issuecomment-357088811, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWMyP-G3LRSejL4wCSakntooMVQbTks5tJpGUgaJpZM4GbEgB\n.\n. This isn't really an option in node-sass. We need to solve this.\n. > IMHO this is really just a convenience option!\nI disagree. This is our job.\n. This is a duplicate of https://github.com/sass/libsass/issues/1645. Please subscribe to that issue for updates.\n. Thinking about this a bit more, it might make sense to return a string_schema from the parser if an operand is also a string_schema. I'll investigate this tomorrow. I expect the interpolate() to cause headaches.\n. Ish.. It does create build but doesn't push to GH which is annoying me.\n. Let's leave this until sass spec is 3.4.20/ready. I assume there's a test\ncase for this new behaviour?\nOn 7 Nov 2015 12:03 am, \"Marcel Greter\" notifications@github.com wrote:\n\nUpdate rounding behavior for upcoming ruby sass 3.4.20\nhttps://github.com/sass/sass/issues/1883.\nMy implementation should return the same results but avoids the fmod\ndivision operation.\nWe may also want to calculate the epsilon only once at startup and store\nit in options.\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/sass/libsass/pull/1704\nCommit Summary\n- Fix static value parsing for numbers with units\n- Implement precision for Sass::round function\nFile Changes\n- M src/ast.cpp\n  https://github.com/sass/libsass/pull/1704/files#diff-0 (12)\n- M src/functions.cpp\n  https://github.com/sass/libsass/pull/1704/files#diff-1 (16)\n- M src/prelexer.cpp\n  https://github.com/sass/libsass/pull/1704/files#diff-2 (2)\n- M src/util.cpp\n  https://github.com/sass/libsass/pull/1704/files#diff-3 (17)\n- M src/util.hpp\n  https://github.com/sass/libsass/pull/1704/files#diff-4 (2)\nPatch Links:\n- https://github.com/sass/libsass/pull/1704.patch\n- https://github.com/sass/libsass/pull/1704.diff\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1704.\n. Spec added https://github.com/sass/sass-spec/pull/608\n. IIRC Ruby Sass opts out of evaluating arguments for certain special functions like calc. I think this is ideal approach. https://github.com/sass/sass/blob/stable/lib/sass/scss/parser.rb#L932\n\nThere is ongoing discussion in Ruby Sass about how to best handle calc - https://github.com/sass/sass/issues/818 \n. I'm on my phone so can't verify but my intuition is that -foo-calc isn't\nparse because it looks like a vendor prefix.\nOn 4 May 2016 7:52 PM, \"Lu Nelson\" notifications@github.com wrote:\n\nSo is this the spec then? I have a group of functions that operate on\ncalc() expressions\u2014would be good to know what the future-proof naming\nconvention is\n@function calc(){ @return 'hello world'; }@function -foo-calc(){ @return 'hello world'; }@function foo-calc(){ @return 'hello world'; }@function calc-foo(){ @return 'hello world'; }\n.test {\n  out: calc(); // won't be processed\n  out: -foo-calc(); // won't be processed\n  out: foo-calc(); // ok?\n  out: calc-foo(); // ok?\n}css.test {\n  out: calc();\n  out: -foo-calc();\n  out: \"hello world\";\n  out: \"hello world\";\n}\n\u2014\nYou are receiving this because you commented.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1706#issuecomment-216815694\n. @rodneyrehm if you could create a GH repo with demo code that shows this issue I can do the bisect figure out where this broke.\n. Spec added https://github.com/sass/sass-spec/pull/610\n. Pretty sure this is a duplicate of https://github.com/sass/libsass/issues/1645\n. Comparing Ruby Sass with the latest LibSass\n\n@charset \"UTF-8\";\n@media \ufffdscreen {\n  .vjs-default-skin.vjs-user-inactive.vjs-playing .vjs-control-bar :before {\n    content: \"\"; } }\nLibSass 3.3.2\n@charset \"UTF-8\";\n@media \ufffdscreen {\n  .vjs-default-skin.vjs-user-inactive.vjs-playing .vjs-control-bar :before {\n    content: \"\"; } }\n. I'm sorry, but we must do what Ruby Sass does. Please open an issue with them at https://github.com/sass/sass/issues.\n. Thanks for the question @LeusMaximus. We have to do what Ruby Sass does. Please file an issue with Ruby Sass at https://github.com/sass/sass\n. The bigger issue is how do assert we don't break it again the future?\nOn 12 Nov 2015 3:14 am, \"Marcin Cie\u015blak\" notifications@github.com wrote:\n\nIf this change does not break VS2015, we should go for it I think.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1719#issuecomment-156040583.\n. Please provide more information.\n. Thoughts @saper @am11?\n. Thanks for the clarification. This is a known issue. Follow the discussion in https://github.com/sass/libsass/pull/1719\n. Thanks @Taritsyn, you rock! Thanks @am11 for your input.\n. Spec added https://github.com/sass/sass-spec/pull/607#event-463586014\n. Fixed by #1739.\n\nThis will be in 3.3.3. Subscribe to https://github.com/sass/libsass/issues/1808 for updates on that release.\n. Spec activated https://github.com/sass/sass-spec/pull/657\n. @ezekg this is separate issue which is being tracked in https://github.com/sass/libsass/issues/1757.\nLet please try to keep this issue focused on one problem.\n. Spec added https://github.com/sass/sass-spec/pull/602\n. This error isn't about what you're importing, but where you're importing. The error is telling you that you cannot use @import inside a mixin or control directives like @if/@else/@for/@each etc..\n. This is a tricky issue, and one that LibSass doesn't get 100% correct. Technically there are two kinds of imports, Sass imports and CSS imports. What kind of import an @import is depends on what you're importing.\nIf you're obviously importing another Sass files then it's a Sass import. Sass imports are not allowed in mixins and control directives. This is the case you're running into so the error is correct.\nIf you're importing something from an URL or file with a .css extension then it's a CSS import, and it can be used in mixins and control directives.\nThis bug was regarding us incorrectly erring when CSS import (because it's a remote font url) is used in a mixin. Unfortunately it appeats this behaviour has once again broken.\n. Hi @asottile this is a known issue in 3.3.2, please see https://github.com/sass/libsass/pull/1719\nWe have unintentionally broken Visual Studio 2013 support. We weren't sure if it was still being used. Please chime in there.\n. Spec added https://github.com/sass/sass-spec/pull/603\n. > I wonder if this is intended behaviour or just some byproduct of Ruby Sass implementation...\nDoes this matter? We need to do what Ruby Sass does.\n. Spec added https://github.com/sass/sass-spec/pull/606\n. It would be good to @nex3's thoughts.\n. Spec added https://github.com/sass/sass-spec/pull/609\n. Thanks for the report @ezekg.\n. Spec added https://github.com/sass/sass-spec/pull/613\n. Reassiging this to 3.4. This doesn't prevent people to from migrating to LibSass I suspect browsers will simply ignore these erroneous properties.\n. Update spec in https://github.com/sass/sass-spec/pull/658\n. Filed an upstream bug https://github.com/sass/sass/issues/1946\n. Agreed.. Specs for this were added in https://github.com/sass/sass-spec/pull/615\n. Spec activated https://github.com/sass/sass-spec/pull/639\n. Part of this code will be addressed with my static value refactor which\nwill introduce a basic sass script parser. Doing so will reduce the scope\nof string schema which is at the root of our interpolation issues.\nOn 15 Nov 2015 5:21 am, \"Marcin Cie\u015blak\" notifications@github.com wrote:\n\nLibsass is also not accepting asterisk glued to numbers and\ninterpolations, maybe this is related?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1738#issuecomment-156802895.\n. I'm not planning to directly address them. My work is focusing on improving\nhow we parse declaration values. This means some cases where we currently\nuse string schema will go away potentially improving these issues as a\nconsequence.\n\nAs far as my approach I'm simply changing our parser to better match the\nRuby implementation.\nOn 15 Nov 2015 9:40 am, \"Marcel Greter\" notifications@github.com wrote:\n\n@xzyfer https://github.com/xzyfer so will your refactor solve all the\nissues in the sample I posted above?\nAlso is there a WIP PR where I can check in what direction you're going\nwith that?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1738#issuecomment-156820644.\n. Spec activated https://github.com/sass/sass-spec/pull/657\n. This make sense to me.\n. \\o/ thank you, this hurting me psychically.\n. Spec added https://github.com/sass/sass-spec/pull/625\n. Although I agree with @mgreter that we're likely technically correct, the fact that we differ from Ruby Sass in this is a enough to provide a fix.\n. Spec added sass/sass-spec#625\n. Thanks for the report @raphaelschroiff. This appears to be a duplicate. Closing in favour it https://github.com/sass/libsass/issues/1644.\n. I'm unable to reproduce this locally.\n\n|-- test.scss\n|-- foo/\n  |-- test.scss\n  |-- bar/\n    |-- test.scss\n/* test.scss */\n@import \"foo/test\";\n/* foo/test.scss */\n@import \"bar/test\";\n/* foo/bar/test.scss */\n\nRuby Sass\n/* test.scss */\n/* foo/test.scss */\n/* foo/bar/test.scss */\nLibSass 3.3.2\n/* test.scss */\n/* foo/test.scss */\n/* foo/bar/test.scss */\n. @mgreter can you please provide a spec for this?\n. Spec for this current fails due to https://github.com/sass/libsass/issues/1768\n. Spec PR https://github.com/sass/sass-spec/pull/632\n. I'm unable to reproduce locally. This suggest the issue is with the values within $mappy-map. Please provide a small working example Sass file that produces this error.\n. > It's the base work to reunite all stringification functions again. \nKeen in mind we should aim to have two stringification functions. One for inspect (@debug), and one for css. In Ruby Sass these are to_css and to_sass/inspect (depending on the node type) methods on the AST nodes.\n. This appears to be a bug with @each and &. The following changes fixes your issue.\ndiff\n-  @each $list in & {\n+  @for $i from 1 through length(&) {\n+    $list: nth(&, $i);\n. Yea please.\n. Spec added https://github.com/sass/sass-spec/pull/637\n. Added to the 3.4 milestone since there is a viable workaround.\n. :+1:\n. As @Panya points out this is the correct behaviour. The LibSass version used in sassmeister is old, and has a bug where this not throwing an error.\n. LibSass in a implementation of the Sass language created by Ruby Sass. Since Ruby Sass acts the same way we're doing the correct thing. If you think this is a bug with Sass please open an issue with Ruby Sass https://github.com/sass/sass/issues.\nSassmeister uses an older version of LibSass that incorrectly failed to error in this case.\n. LibSass is an implementation of the Sass language created by Ruby Sass. As @pdaoust points out since Ruby Sass also throws this error we're doing the correct thing.\n. Thanks for the report @andrew-skybound. I've confirmed this issue exists in 3.3.2.\n. Spec added https://github.com/sass/sass-spec/pull/635\n. This is a duplicate of https://github.com/sass/libsass/issues/1597\n. Closing in favour of https://github.com/sass/libsass/issues/1597\n. Thanks for the report @halt-hammerzeit. I can confirm this is an issue in 3.3.2.\n. Spec added https://github.com/sass/sass-spec/pull/634\n. @googol7 I have confirmed this issue and opened #2233 to track it. In future please create a new issue rather than commenting on old issues.. Thanks!\n. I am unable to reproduce this problem on 3.3.2. Please update your LibSass.\n. Thanks for the report @petebrowne. I can confirm this issue is present on master.\n. Spec added https://github.com/sass/sass-spec/pull/638\n. This is fixed and will be in the upcoming 3.3.3. Subscribe to #1808 for future updates on that release.\n. I am unable to reproduce your issue on the latest LibSass (node-sass) release.\n```\n.class-name {\n  &:nth-of-type(1),\n  &:nth-of-type(3) {\n    a: b;\n  }\n}\n.class-name {\n  &:nth-of-type(1), &:nth-of-type(3) {\n    b: c;\n  }\n}\n.class-name {\n  &:nth-of-type(1) {\n    c: d;\n  }\n  &:nth-of-type(3) {\n    e: f;\n  }\n}\n```\nProduce the following on both Ruby Sass and LibSass.\n```\n.class-name:nth-of-type(1), .class-name:nth-of-type(3) {\n  a: b; }\n.class-name:nth-of-type(1), .class-name:nth-of-type(3) {\n  b: c; }\n.class-name:nth-of-type(1) {\n  c: d; }\n.class-name:nth-of-type(3) {\n  e: f; }\n```\nPlease check that you have the latest node-sass installed. You do this with npm ls node-sass.\n. This already exists in LibSass. In sassc it's the --line-numbers or --line-comments CLI flag. In node-sass (and grunt/gulp sass) it should be controlled but the sourceComments config option.\n. Or --source-comments CLI flag for node-sass.\n. CI is happy and I trust your judgment @am11. Thanks again!\n. @am11 is it possible create a test case for this?\nI'm guessing you'll need to import a file in a directory with cyrilic characters, maybe?\n. @am11 can you please update the appveyor.yml as you've suggested?\n. Merged sass/sass-spec#640 and sass/sassc#156 \n. :ok_hand: perfect! Thank you\n. Thanks for the report @jakob-e. This is fixed in 3.3.2.\nRuby Sass\nul li:nth-child(4), ul li:nth-child(3n) {\n  background-color: tomato; }\nLibSass 3.3.2\nul li:nth-child(4), ul li:nth-child(3n) {\n  background-color: tomato; }\n. Please provide a copy pastable working code sample that works with Ruby\nSass but produces the error in LibSass.\nOn 8 Dec 2015 7:01 pm, \"David Meir-Levy\" notifications@github.com wrote:\n\nI want to move from ruby-sass to libsass, but using 'calc' the same way is\nnow impossible and shows an error: Incompatible units: 'px' and '%'.\nI can wrap 'calc' with \"unquote\" function, but it seems like an ugly\nworkaround..\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1776.\n. Thanks @davidmeirlevy which this sample I can confirm this is a known issue. Sass has special handling of some functions including calc which we haven't implemented yet.\n. Thanks for the report @tristanlins. I'm investigating and will post updates.\n. The following fails with Ruby Sass.\n\n.item4 {\n    background: func(item4.jpg);\n}\nError: Invalid CSS after \"...und: func(item4\": expected \")\", was \".jpg);\"\n        on line 11 of test.scss\n  Use --trace for backtrace.\nThis means LibSass is correct in it's current behaviour.\n. For reference I'm testing with the following equivalent Sass code\n```\n@function url($url) {\n  @debug \"call function with \" + $url;\n  @return $url;\n}\n@function func($value) {\n  @return url($value);\n}\n.item1 {\n    background: url(item1.jpg);\n}\n.item2 {\n    background: url('item2.jpg');\n}\n.item3 {\n    background: url(\"item3.jpg\");\n}\n// .item4 {\n//     background: func(item4.jpg);\n// }\n.item5 {\n    background: func('item5.jpg');\n}\n.item6 {\n    background: func(\"item6.jpg\");\n}\n```\n. I get the follow output\nRuby Sass\n```\nDEPRECATION WARNING on line 1 of test.scss:\nNaming a function \"url\" is disallowed and will be an error in future versions of Sass.\nThis name conflicts with an existing CSS function with special parse rules.\ntest.scss:2 DEBUG: call function with item2.jpg\ntest.scss:2 DEBUG: call function with item3.jpg\ntest.scss:2 DEBUG: call function with item5.jpg\ntest.scss:2 DEBUG: call function with item6.jpg\n.item1 {\n  background: url(item1.jpg); }\n.item2 {\n  background: \"item2.jpg\"; }\n.item3 {\n  background: \"item3.jpg\"; }\n.item5 {\n  background: \"item5.jpg\"; }\n.item6 {\n  background: \"item6.jpg\"; }\n```\nLibSass 3.3.2\n```\nDEPRECATION WARNING on line 1 of /Users/michael/Projects/Sass/libsass/test.scss:\nNaming a function \"url\" is disallowed and will be an error in future versions of Sass.\nThis name conflicts with an existing CSS function with special parse rules.\n/Users/michael/Projects/Sass/libsass/test.scss:2 DEBUG: call function with item2.jpg\n/Users/michael/Projects/Sass/libsass/test.scss:2 DEBUG: call function with item3.jpg\n/Users/michael/Projects/Sass/libsass/test.scss:2 DEBUG: call function with item5.jpg\n/Users/michael/Projects/Sass/libsass/test.scss:2 DEBUG: call function with item6.jpg\n.item1 {\n  background: url(item1.jpg); }\n.item2 {\n  background: \"item2.jpg\"; }\n.item3 {\n  background: \"item3.jpg\"; }\n.item5 {\n  background: \"item5.jpg\"; }\n.item6 {\n  background: \"item6.jpg\"; }\n```\n. Since LibSass' output matches Ruby Sass I'm marking this as resolved.\nAs to why url is not being called for .item1 in 3.3.2, this is because we fixed a bug with how we parse url to match Ruby Sass. In Sass url is a special function. If the argument passed to it looks like a static value Sass ignores it and treats the whole url function call as string. This is why your custom function isn't being called.\n. No. The convention is to have an asset-url function for thus purpose.\nUnfortunately you were relying on a bug that has since been patched.\nOn 11 Dec 2015 6:46 pm, \"Tristan Lins\" notifications@github.com wrote:\n\nThis is realy bad, because we deliver the assets from a VFS and need a\nspecial rewriting for url(...) urls. Is there another way / callback to\nmanipulate how libsass handle url(...) 's?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1777#issuecomment-163867041.\n. Thanks for your initiative. Although we cannot accept this pull request we\ngreatly appreciate your contribution.\n\nAs you state this is not a native Sass function. As such it's not something\nwe cannot have in LibSass.\nI suggestion opening a feature request issue on the Ruby Sass issue tracker\nfor this function. IMHO it could be useful function and a Sass\nimplementation would be slow.\nOn 9 Dec 2015 2:00 am, \"Frank Hellenkamp\" notifications@github.com wrote:\n\nI don't know if you would merge this, because the base64-encode is not an\noriginal sass function and has to be imported through ruby when using\nnormal sass.\nBut in most of my workflows this is one of the essential functions missing\nfrom libsass when e.g. generating svg background or icons from other sass\nvariables, that are used in layouts.\nFortunately libsass already contains a base64 encoder that that this merge\nwould be minimal.\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/sass/libsass/pull/1778\nCommit Summary\n- added base64-encode as sass function\n- Merge branch 'master' of https://github.com/sass/libsass\n- Merge branch 'master' of https://github.com/sass/libsass\nFile Changes\n- M src/context.cpp\n  https://github.com/sass/libsass/pull/1778/files#diff-0 (1)\n- M src/functions.cpp\n  https://github.com/sass/libsass/pull/1778/files#diff-1 (18)\n- M src/functions.hpp\n  https://github.com/sass/libsass/pull/1778/files#diff-2 (5)\nPatch Links:\n- https://github.com/sass/libsass/pull/1778.patch\n- https://github.com/sass/libsass/pull/1778.diff\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1778.\n. Overloading these functions feels hacky. IMHO we should expose a dedicated interface for user defined @debug, @error, and @warn that multiple listeners can be registered to be notified when called.\n. Thanks @asottile!\n. @QuLogic and @saper are probably best suited to make the call on this.\n. Great thanks. Give the scope of the changes I'm happy to merge this when CI is happy.\n. > I think we should just rename all constants and prefix them with something like LIBSASS_ to avoid issues like the SEC one. Otherwise it'll be the endless chase...\n\nMakes sense to me. Should be its own PR though.\n. @jaredmorrow can you answer @saper's question?\n\nWhich \"install\" is now default on Solaris? Or more precisely, which part breaks when using traditional SysV \"install\"?\n\nWe want to get Makefile compatible with SmartOS. If manual intervention is required then we're not really supporting SmartOS.\n. I'm ok with merging this the community can start compiling LibSass from master.\nI've created #1802 to track prefixing constants.\n. @MelonHTML5 please define breaks?\nRuby Sass 3.4.20\n@charset \"UTF-8\";\na {\n  content: \"?\"; }\nLibSass 3.3.2\n@charset \"UTF-8\";\na {\n  content: \"?\"; }\n. @MelonHTML5 you said \n\nThis breaks\ncontent: $fa-var-glass;\n\nBut didn't explain how it is broken. As I've shown in my previous comment LibSass does the same as Ruby Sass.\n. I'm sorry but the code you've supplied does not compile.\n```\nError: Undefined variable: \"$fa-var-glass\".\n        on line 9 of test.scss\n\n\n    content: $fa-var-glass;\n\n```\n. I'm currently away for the weekend. Does Ruby Sass throw an error? We must\ndo what they do.\nOn 11 Dec 2015 10:10 pm, \"Christiaan Tigelaar\" notifications@github.com\nwrote:\n\nWhen you use @extends .someclass instead of @extend .someclass, no error\nis returned. Even if you use @foobar .someclass it will not give me an\nerror on running sass. This way I can't see if the result of my build is as\nI expected it would be. I would expect it would give me a syntax error or\nsomething like that.\nI tested it using node-sass@3.4.2 which uses libsass. I think it's a\nlibsass issue, as node-sass is just a libsass wrapper for node.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1784.\n. I am unable to reproduce this with LibSass 3.3.2.\n\nhttp://www.sassmeister.com/gist/a7c156b600be028b73a1\n. Thanks for the report @andrew-skybound. \nSpec added https://github.com/sass/sass-spec/pull/647\n. @am11 @saper would love your input here\n. @blabute I'm confused. The supplied code does not compile with Sass.\n. @blabute I'm confused. The supplied code does not compile with Sass.\n. Thanks for the update. This is a duplicate of https://github.com/sass/libsass/issues/1294. Subscribe to that issue for future updates.\n. Spec added https://github.com/sass/sass-spec/pull/648\n. Spec added https://github.com/sass/sass-spec/pull/648\n. Spec added https://github.com/sass/sass-spec/pull/649\n. Split this into two issues - https://github.com/sass/libsass/issues/1804\n. Spec added https://github.com/sass/sass-spec/pull/651\n. @mgreter feel free to update the spec\n. This isn't ready. Feels stalled.\n. Thanks for the report @cimmanon. I can confirm this issue exists on master.\nWe're in need of a more specific test case. \n. Thanks for the report @andreev-artem. I can confirm this is an issue in 3.3.2.\n. Spec added and activated in https://github.com/sass/sass-spec/pull/690\n. Sometimes I wonder what kind of Sass you're writing @andrew-skybound .\nSpec added https://github.com/sass/sass-spec/pull/652\n. This is fixed on master and will be in 3.3.3.\n. Fixed by https://github.com/sass/libsass/pull/1748. The incorrect output was due to variable scope not being respected in some case causing variable to be overwritten.\n. We recently dropped VS2013 support. You now need VS2015.\nOn 23 Dec 2015 6:43 pm, \"lobinga\" notifications@github.com wrote:\n\nIn Windows\uff0cthere are undeclared identifier errors about \"uint_fast32_t\"\nand \"uint64_t\" when compiling the library,\n\\src\\functionscpp(216): error C2146\n\\src\\functionscpp(1918): error C2065\nAfter including \uff0cthe library is compiled sucessfully\nMy system: Win10\uff0c Visual studio 2013 update 5\nwhat is the problem?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1800.\n. You can apply this patch as a work around https://github.com/sass/libsass/pull/1719\n. Thanks for the report @nathanielw. This is a duplicate of #1729 which has been fixed on master and will be 3.3.3.\n\nSubscribe to https://github.com/sass/libsass/issues/1808 for track the release of 3.3.3.\n. Thanks for the report @BboyKeen, however I am unable to reproduce this with the node-sass / LibSass versions specified.\nYou can see the results with this handy online node-sass compiler - http://www.sassmeister.com/gist/2c883b2327e12ea2e55d\n. Maybe you've mistake the node-sass version being used, or there is another tool in your pipeline that is breaking the CSS after node-sass runs. \nI'm closing this issue because I cannot reproduce it. If new information comes up I can reopen it.\n. Added a release todo list /cc @mgreter @saper \n. @mgreter @saper I've confirmed both eyeglass and sassdash have fully passing test suites with node-sass compiled against @a559139.\nI'm happy to call this release ready and start cutting release notes. Objections?\n. Tying up some loose ends on the node-sass side of things. I'll tag the release in the next 48hrs.\n. @mgreter we need to feature freeze before I can cut the release. Let me know when you're done.\n. Will do. I need to spend some time getting my node sass releases working again also.\n. Released SassC 3.3.3\n. I'll take your word for it :)\n. I have no objections.\n. Thanks for the report @antmorozov. I've confirmed this issue is present on the latest master.\n. Thanks for the update @am11. The current LibSass master throws an error which is an improvement.\n```\nError: error reading values after foo\n        on line 25 of test.scss\n\n\n@svg-load     test    url   blah      (foo.svg)     {\n``\n. Removing thedebug` results in an undefined variable error\n\n\nscss\n@function foo($value) {\n  $a: bar($value);\n  @return $value;\n}\n```\nError: Undefined variable: \"$value\".\n        on line 5 of test.scss\n\n\n@return $value;\n   ----------^\n```\n. Spec added https://github.com/sass/sass-spec/pull/661\n. Ended up being an easy fix.\n. This is probably ready to go.\n. Thanks for the report @matt3224. I can confirm this has been fixed and will be the upcoming 3.3.3 release. Please subscribe to #1808 for future updates on that release.\n. Nice find @am11 \n. I wonder how we can test this since the spec for #1096 includes this test case and passes on Windows.\n. Sounds unreliable. Especially give that we periodically regenerate all the specs (usually on osx or linux).\n. We'll leave this for the time being to see what happens with this in Ruby Sass.\n. sass/sass#1425 is the correct place for that discussion.\n. It's worth creating an issue there to discuss.\nOn 6 Jan 2016 1:04 am, \"Marcel Greter\" notifications@github.com wrote:\n\nTo repeat: this would have been much easier to implement if ruby sass\nwould accept an optional offset for str-index (as pretty much all\nprogramming languages offer). Maybe it would be a nice addition and worth\nmentioning to the ruby sass team (//CC @chriseppstein\nhttps://github.com/chriseppstein @nex3 https://github.com/nex3).\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1823#issuecomment-169009441.\n. > EditorConfig was no longer enforcing style of GNUmakefile.am as of fc2d8b3a70a42891e2ada0dc921bd94bc435c896\n. Nice catch @numeraltwo\n. Please activate the spec @mgreter \n. Is this related to #1750?\n\nIf not do you think you can look into it? Feels like it might be a regression in the recent context refactor.\n. Interesting. Ship when ready.\n. More generally & changes the selector ident lexer so that it's an alternate to the first character.\n. Spec added and activated in https://github.com/sass/sass-spec/pull/690\n. Spec added and activated in https://github.com/sass/sass-spec/pull/690\n. I'm all for this. We've talked bout VS2013 before. The only reason we haven't addressed it yet is that we don't have a plan for testing it in parallel with VS2015.\nhttps://github.com/sass/libsass/pull/1719#issue-116363736\n. Rebuilding. If CI is still happy :ship: \n. I started to tagging sass-spec with LibSass releases but didn't keep it up. I did this mostly for tracking down regressions with bisect.\nThe ci scripts used to be able to fetch an arbitrary sass-spec hash but was later simplified. I'm ok with change it again.\nIMHO we should follow the Ruby Sass development model as outlined in https://github.com/sass/libsass/issues/796\n. We haven't needed to this yet. We'll looked at something when the situation arises. For now sass-spec builds against gitish for libsass.. Partially related to https://github.com/sass/libsass/issues/1812\n. @manuel-di-iorio propose this feature to the Ruby Sass team if you think it should implemented.\n. There's really no way I can do a meaning review on a PR this big :(\nDo what you need to do I guess.\n. @jaredmorrow @djensen47 I'd like to hear your thoughts here\n. Spec for #1670 activated in https://github.com/sass/sass-spec/pull/684\n. Spec for #1675 activated in sass/sass-spec#685\n. Spec for #871 activated in sass/sass-spec#686\n. Remaining spec for #1653 activated in sass/sass-spec#687\n. Spec for #1550 activated in sass/sass-spec#688\n. :+1:\n. Thanks @pra85 \n. @mgreter Ruby Sass calls it the ToCss visitor. Seems like an ideal name to me?\n. > Now every AST_Node has a to_string, to_sass and inspect method, and all return a std::string. \nThis is a great change. I wasn't expecting to implement this until 3.4. Nice work.\n. @saper is that error still happening on b6841ed? I'm unable to reproduce.\n. So much nicer.\n. IIRC problem is that throw this error the wrong time. It's impossible know if something can be extended to after eval is complete.\n. :+1:\n. For context: https://github.com/sass/node-sass/issues/1283\n. Thanks for the report @matori \n. I've compared our at-root implementation with Ruby Sass. The at-root is being resolved correctly in this case. The problem here is that the .box selector is not fully resolved (parentized) in the expand/eval stage.\n. :+1: :100: :100:\n. This is probably a good opportunity to disable .css importing by default and put it behind a flag.\n. Sorry meant to close this not merge it.\nWe've decided not to change the existing behaviour until 4.0. See https://github.com/sass/libsass/issues/1656#issuecomment-220745629\n. @saper is this new to 3.3.3? If so please add the regression label, and assign this to 3.3.4 milestone.\n. Agreed, until we have an official support stance on SunOS we'll just need to tackle these issues as they arise.\n. @saper is this new to 3.3.3? If so please add the regression label, and assign this to 3.3.4 milestone.\n. Agreed, until we have an official support stance on SunOS we'll just need to tackle these issues as they arise.\n. Agreed, until we have an official support stance on SunOS we'll just need to tackle these issues as they arise.\n. Thanks @drewwells \n. @mgreter it is not. I would say it's out of scope for sass spec, much like sourcemaps and alternate output formats (except special compressed cases).\n. Libsass 3.2.1 is old, please update.\nMost importantly if you can't take the time to supply some sample Sass code to produce the error, we can't possible begin to debug the problem. We will not take the time to debug an entire framework to find a bug that may not exist.\n. Closing since a reproduction was not supplied.\n. Can you please reference the issues this fixes?\nFor the record we currently support with/without and there test coverage. it'd be good to clear about what specifically this is aiming to fix.\n. I'm pretty sure this is fixed in #2089. We can look at at-root again when we have a specific known failure.\n. After some further investigation there are still problem related to at-root but they stem from broken parentizing, not the at-root implementation itself. Specific issues are #2006 and #1890 both of which are incorrectly parentized before reaching CSSize.\nThe issue is certainly with our parentizing, so any fix should not touch the cssize visitor since it is line for line compliant with Ruby Sass.\n. Thanks for the report @asottile. This will be addressed in 3.3.4.\n. This was fixed in 3.3.4. The output in 3.3.6 matches Ruby Sass.\na:not(c), b:not(c) {\n  d: e; }\n. Where is .tablesorter-pager defined. Looks like you have an extend you're\nnot showing. The easiest way to know if there is a bug is to compare the\nLibSass output to Ruby Sass 3.4.* on sassmeister.com.\nOn 5 May 2016 12:10 AM, \"Joel Perry\" notifications@github.com wrote:\n\nHere is my SASS and the output. Is this the same issue as this ticket\ndescribes? I am getting it on libsass 3.3.3+\nSASS\n[class*=\"button-\"] {\n&:hover:not(.button-disabled) {\ntransform: translate(0, 1px);\n}\n}\nInvalid CSS (libsass >=3.3.3)\n[class*=\"button-\"]:hover:not(.button-disabled):not(.tablesorter-pager\n.button.disabled) {\n-webkit-transform: translate(0, 1px);\ntransform: translate(0, 1px);\n}\nValid CSS (libsass <=3.3.2)\n[class*=\"button-\"]:hover:not(.button-disabled) {\n-webkit-transform: translate(0, 1px);\ntransform: translate(0, 1px);\n}\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1901#issuecomment-216876831\n. Thanks\n. @mebjas thanks but no thanks. We have interest in maintaining or integrating with more 3rd parties. THe only todos that matter are our GitHub issues.\n. Bisected the regression to 592ff47442d0f7bfa8e3d2b3b6e7f8f33e78841e\n. I am unable to reproduce this error with\n\n``` sass\n$str: '(min-width: 40em)';\n@media screen and #{$str} {\n  a { foo: bar; }\n}\n```\n. Without a working sample of code that reproduces this error there isn't anything we can do. We will not debug your entire app.\n. Turns out if I get bored enough I will debug a framework. This is a regression in 3.3.3.\nscss\nfoo {\n  bar: 'test' + '1 #{2} 3';\n}\nLibSass 3.3.2\ncss\nfoo {\n  bar: \"test1 2 3\"; }\nLibSass 3.3.2\ncss\nfoo {\n  bar: \"test'1 \"2 3'; }\n. Spec added https://github.com/sass/sass-spec/pull/725\n. @bdkjones we don't currently have a patch available. I'll take a look after dinner. If we don't release 3.3.4 in the next 8hrs I would rollback back to 3.3.2.\nIn the future we'll add foundation to our release checklist.\n. A simplied test case\nsass\nfoo {\n  bar: '#{b}' + az;\n}\n. It's been replaced with https://github.com/sass/sassc-ruby\nFeel free to update the link.\n. This appears to have upset our CI. LGTM.\n. This will be unnecessary in the next version of Sass. Sass 4 will namespace\ninternal functions so they cannot clash with global CSS functions.\nOn Feb 6, 2016 5:58 AM, \"Steven Vachon\" notifications@github.com wrote:\n\nWould it be possible to write something like less-plugin-future-compat\nhttps://npmjs.com/less-plugin-future-compat for libsass?\nWant to back this issue? Post a bounty on it!\nhttps://www.bountysource.com/issues/30585198-plugins-for-future-css-features?utm_campaign=plugin&utm_content=tracker%2F283068&utm_medium=issues&utm_source=github\nWe accept bounties via Bountysource\nhttps://www.bountysource.com/?utm_campaign=plugin&utm_content=tracker%2F283068&utm_medium=issues&utm_source=github\n.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1911.\n. It's hard to say. Work is in progress. Follow the Ruby Sass 4.0 milestone\nto track its progress.\n\nhttps://github.com/sass/sass/issues?q=is%3Aopen+is%3Aissue+milestone%3A4.0\nOn Feb 6, 2016 11:53 AM, \"Steven Vachon\" notifications@github.com wrote:\n\nawesome! when is it due?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1911#issuecomment-180639292.\n. Please beware of spreading misinformation. Ruby Sass was in a feature\nfreeze in 2015so that LibSass could catch up. Active feature development\nhas begun again on 4.0.\nOn Feb 6, 2016 1:33 PM, \"Steven Vachon\" notifications@github.com wrote:\nRuby Sass? Uh-oh -- that thing is so behind on bug-fixes.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1911#issuecomment-180660847.\n. @yamlfd this matches the output generated by Ruby Sass. LibSass must copy Ruby Sass. If you believe this to be a bug in Ruby Sass please open an issue with them.\n\nhttps://github.com/sass/sass/issues\n. This is fixed in 3.3.3.\n. LGTM.\n. This is potentially related to https://github.com/sass/libsass/issues/1891\n. Thanks for the report @bwbuchanan. I've confirmed this is a regression in 3.3.3.\n. Spec added https://github.com/sass/sass-spec/pull/739\n. Fixed by #1953.\n. PR https://github.com/sass/libsass/pull/1942\n. Thanks @usta but please follow the existing code-style.\n. Thanks @usta but please follow the existing code-style.\n. Much better, thank you.\n. LGTM. Thanks @usta \n. @mgreter \n\ndid you verify #1262 does still work as expected? \n\nYes. All our specs and node sass specs pass.\n\nI also don't see how it could go out of order. I guess that was happening in call_importers? \n\nCorrect. In the case of @import \"foo\", \"bar\" where bar is handled by a custom importer. It gets out of order because foo is pushed onto the to_import vector, and bar is pushed on to the import queue in call_importers. Only later when when is foo pushed onto the importer queue from the to_import vector.\nIn the case that neither or both files are handled by custom importers the files are pushed on to the import queue or to_import vector in the correct order.\n. > Might have some time this weekend to test it via perl-libsass\nYeah I pinged you so you could test this with perl-libsass because you have better test coverage for custom importers than node sass and LibSass.\n. Hmm good point, add one should be trivial.\nWe have a test in PR in node-sass that hasn't been merged. I'll look into getting it up to date and test this patch this arvo.\n. I've confirmed this patch still passes #1262. In my investigation I noticed some other issues with custom importers. I'll create some new issues and PRs later today.\n. Please provide a working copy pasteable snippet of Sass code that produces\nthis error. The code supplied is incomplete.\nOn Feb 18, 2016 5:19 AM, \"Felix Laurie von Massenbach\" \nnotifications@github.com wrote:\n\nI'm using libsass-python and since they updated to 3.3.3 I've been\nhitting the following error:\nsass.CompileError: b'Error: Undefined variable: \"$target\".\\n        on line 8 of indigo/static/styles/mixins/_units.scss\\n>>     @return calc-rem($target, $context);\\n   ---------------------^\\n'\n_units.scss is:\n@import 'styles/variables/defaults';\n@function calc-rem($target, $context: $root-font-size) {\n    @return $target / $context * 1rem;\n}\n@function cr($target, $context: $root-font-size) {\n    @return calc-rem($target, $context);\n}\nThis was originally reported in dahlia/libsass-python#122\nhttps://github.com/dahlia/libsass-python/issues/122.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1922.\n. This should error. The success is a bug. You can't @extend %foo inside\n@media if %foo is defined outside the @media.\nOn Feb 19, 2016 2:33 PM, \"kenyanke\" notifications@github.com wrote:\nSorry!!!\nI have poor English.\nLook so described the problem under.\n%btnBase {\n  display: none;\n}\n// Scope error\n@media only screen and (min-width:300px) {\n  a {\n    @extend %btnBase;\n  }\n}\n@mixin mobile {\n  @media only screen and (min-width:300px) {\n    @content;\n  }\n}\n// Why Success??\n@include mobile {\n  a {\n    @extend %btnBase;\n  }\n}\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1923.\n. Remember to activate these specs before merging. Otherwise looks good. We need to come back around to how to do interpolation and binary operations. The Ruby Sass approaches are nice.\n. This doesn't fully patch #1907. The follow still produces the incorrect output.\n\nfoo {\n  bar: '#{b}' + az;\n}\n. This also appears to fix #1926\n. I've cherry-picked all but a9c42150802f into separate PRs. I wasn't sure what issue that in regards to.\n. Superseded by #1958\n. @mgreter correct, I noticed this at the time (https://github.com/sass/libsass/pull/1925#issuecomment-187668885) but must not have updated this issue.\n. Does it compile on the more recent 3.3.3?\nOn Feb 25, 2016 8:14 AM, \"bastei\" notifications@github.com wrote:\n\nThe following scss does not compile since version 3.3.0-beta3:\n@media screen {\n  $variable: dynamic;\n  .foo-#{$variable} {a: b}\n  .bar {\n    @extend .foo-dynamic\n  }\n}\nThe error is:\nError: You may not @extend an outer selector from within @media.\nYou may only @extend selectors within the same directive.\nFrom \"@extend .foo-dynamic\" on line 5 of test.scss\non line 3 of test.scss\nWith libsass 3.3.0-beta2 the output is correct:\n@media screen {\n  .foo-dynamic, .bar {\n    a: b; } }\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1927.\n. Thanks for the report @bastei. I can confirm this issue.\n\nBisect shows this regression was caused by 61b6d568762b78993d7a8dafe891ea67dd15d9d9.\n. Thanks @Haroenv \n. For context, when a map is used with index (instead of a list) it's treated a list of lists. i.e. (foo: bar, bar: baz), is (foo bar, bar baz).\nThis applies for all list functions. This is documented in the Sass changelog for 3.3.\n\nAll the existing list functions also work on maps, treating them as lists of pairs. For example, nth((foo: 1, bar: 2), 1) returns foo 1. Maps can also be used with @each, using the new multiple assignment feature (see below):\nsource\n. Thanks for the report @sunkan. I can confirm this issue. We heavily refactored url() handling in recent versions which may have caused this issue.\n. Thanks for the report @antmorozov. This has been fixed in 3.3.3. You can test it out with \n\nnpm install node-sass@beta\n. @bmvantunes thanks for the report. This has been fixed in recent versions. Please update.\n. Duplicate #1901\n. Sorry we will not be making any changes to help with compass migrations. We aim to be a 100% port of Ruby Sass so this is simply not an option. I suggest looking into eyeglass as modern compass port to libsass via node-sass.\n. Please compare this to Ruby Sass. If it's significantly different we can look into. We have no intention of differing from the Ruby Sass behaviour.\n. More discussion in https://twitter.com/ksylor/status/971774023964250112. @kyaido thanks for the report. I've confirmed this is an issue. For now you can work around this by assigning the function result to a variable first.\n``` sass\n$foo :map-get($prefix, bar);\n{$foo} .baz {\ncolor: red;\n}\n```\nOr using unquote.\n``` sass\n{unquote(map-get($prefix, bar))} .baz {\ncolor: red;\n}\n```\n. Confirmed this is fixed in 3.3.4.\n. I have however noticed that the error message doesn't take into account if the error is due to a function or a mixin i.e. it will always produce the following error.\nError: Functions may not be defined within control directives or other mixins.\nWhere Sass will sometimes produce\nError: Mixins may not be defined within control directives or other mixins.\n. Spec added https://github.com/sass/sass-spec/pull/737\n. Thanks for the report @sveetch. I've confirmed this is regression in 3.3.3.\nMinimal test case\nsass\nfoo {\n  bar: #{\"\\\\\"}#{\"baz\"};\n}\n. Thanks for the report @humphrey. This is a duplicate of #1916.\n. This appears to be a combination of both #1901 and #1907. Will confirm.\n. I am unable to reproduce the out of order selectors on 3.3.3. However the broken quoting is reproducible.\n. The patch to #1907 doesn't appear to fix the quoting issue seen here. This is a different issue.\n. This is another instance of #{} no stripping quotes. Reduced test case\nsass\n.a-#{quote('' + b)} {\n  c: d;\n}\n. Spec added https://github.com/sass/sass-spec/pull/735\n. This originally suspected this has actually been implemented and has test coverage.\n. No. LibSass is a like for like port of the official Ruby Sass. Like Ruby Sass we allow users to define custom functions for use cases like this.\n. Please provide a minimal, copy pasteable, Sass example that causes this error. Without that we cannot begin to debug this issue.\n. I've confirmed this issue with 3.3.3 and 3.3.4. This the minimum test case I could generate.\n``` sass\nfoo:not(.missing) {\n  a: b;\n&:hover { c: d; }\n}\nbar {\n  @extend .missing;\n}\n```\n. @bdkjones work has not started on 3.3.5 so it's hard to say.\n. I'll look at some of the more critical regressions this weekend to get a gauge on how much work is involved.\n. You're probably after https://github.com/sass/sassc\n. Sorry @brandonprry I'm finding your report hard to follow. Please produce a copy-pastable sample of code that produces this problem so I can debug locally.\n. Are you reporting that the following Sass code produces a segfault?\nsass\n:000000#{00}000000{//\n}\nIf so, I am unable to reproduce with 213339a. What is your environment?\n. I get the following output\n```\nError: Invalid CSS after \":\": expected pseudoclass or pseudoelement, was \"00000000000000{\"\n        on line 11 of test.scss\n\n\n^\n```\n\n\nRunning OS X 10.11.4. What compiler are you using?\n$ gcc -v\nConfigured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk/usr/include/c++/4.2.1\nApple LLVM version 7.0.2 (clang-700.1.81)\nTarget: x86_64-apple-dar\n. Is this the path of the file you're compiling?\n\nid:001088\\,sig:06\\,src:002784+006448\\,op:splice\\,rep:2.min\n\nIf so, that may be the issue. Can you try something more standard like /tmp/test.scss?\n. I am still unable to reproduce this.\nsass\n// test.scss\n@im+ w\\dth:5clner #{n: w\\dth:5>0Qx;\n  }button {\n  //levxe buttons mixin\n  @inclner #{n: w\\dth:500Qx;\n  }\n}\n```\n$ CFLAGS=\"-fsanitize=address -O1 -fno-omit-frame-pointer\" CXXFLAGS=\"-fsanitize=address -O1 -fno-omit-frame-pointer\" LDFLAGS=\"-fsanitize=address -fno-omit-frame-pointer\" make clean build-shared\n$ bin/sassc test.scss\nError: Invalid CSS after \":\": expected pseudoclass or pseudoelement, was \"5clner nbutton{\"\n        on line 2 of test.scss\n\n\n----------^\n```\n. Ok I've finally been able to reproduce this with the follow reduced test case\n\n\n@a b:1 #{;} {}\n. We have decided keeping the current behaviour, and not breaking the code for people who now depending on this, is the lesser evil. \nThis will be addressed in 4.0.\n. @TxHawks in future please check that your code works as expected with Ruby Sass before opening an issue. LibSass' goal is to be a 100% compatible implementation of Ruby Sass. Since Ruby Sass produces the same output as we do I'm closing this issue.\nHowever I agree the behaviour is strange. I suggesting opening an issue with the Ruby Sass team (https://github.com/sass/sass/issues).\n. Thanks for the report @mikehdt. We've had some issue with #{} incorrectly returning quoted strings. The good news is this is fixed 3.3.3+. You can get it by installing node-sass@beta. We're still ironing out some kinks with 3.3.3 and 3.3.3 before updating the stable node-sass.\n. This is fixed in 3.3.4.\n. @haschek Test your code against Ruby Sass 3.4.x on Sassmiester to confirm your Sass is valid. Looks like a bug in your code.\n. @haschek without a copy-pastable code sample I cannot confirm you issue. If you think there is a bug please create new issue with enough code for me to see this error myself.\n. Thanks for report @robsonsobral. We have a fix ready for the next release.\n. Thanks @tony \n. @xoofx if I'm understanding correctly this seems related to #1821. Can you please take a look and confirm whether that would address your issue?\n. @xoofx if I'm understanding correctly this seems related to #1821. Can you please take a look and confirm whether that would address your issue?\n. @xoofo I think it'd be better to contribute your usecase to the existing issue. There's already a lot of discussion there I'd prefer to have a single \"right way\" to address this problem.\n. @xoofx thanks for this. My gut tells me we may need both implementations for the sake of upstreams that already implement the old char interface.\nCould you also please PR how this would look with SassC?\n. @xoofx never mind my previous comment, I'm hungry.\n@am11 PTAL?\n. We have scheduled breaking API changes for 4.0 so I'm :+1: to shipping this and getting userland feedback.\n. I'm going to be AFK for the next week. @mgreter please ship this if you have no objections. \n. I won't have time this week, maybe @saper will. The SassC change looks promising (https://github.com/sass/sassc/pull/166/files)\n. @mgreter I've updated node-sass to LibSass master + this patch. Test pass. I am not using the updated interface however because include paths as a delimited string is much cleaner for us.\n. I'm happy to merge this and ship 3.3.5.\n. I plan to release 3.3.5 this week. I'd do it sooner but I'm at a conference. \n@mgreter can you please get started on some release notes for this change?\n. FYI we can into an similar issue reported by the python binding team in 3.3.4.\n. This PR has introduced a regression with the sassdash library. I'm currently working on a reduced test case. Given old this issue is I'd prefer to revert this patch and rescope the fix.\n. @DehraX that version of node-sass uses an older version of LibSass where this issue had not been fixed.\n. @mgreter this is possibly a sass2scss bug\nOn 12 Apr 2016 7:34 PM, \"Hugo Giraudel\" notifications@github.com wrote:\n\n0 seems to be considered as false when used in map keys (maybe some place\nelse as well).\n$tests: (  0: 'foo',\n  false: 'bar',\n);\nDuplicate key \"false\" in map (0: \"foo\", false: \"bar\"). on line 2 at column 3\nInterestingly enough, when reverting the order of both keys, false seems\nto be treated as 0:\n$tests: (\n  false: 'bar',  0: 'foo',\n);\nDuplicate key \"0\" in map (false: \"bar\", 0: \"foo\"). on line 2 at column 3\nRuby Sass does not display this behaviour.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1991\n. @mgreter sorry wrong issue, I meant to comment on https://github.com/sass/libsass/issues/1990\n. The test failures appear to be related to changes in whitespace/new line normalisation.\nAppVeyor appear to be running sass-spec@master which is why it's passing. You'll need to update appveyor.yml to checkout your branch.\n. Interesting, AppVeyor failed sass-spec (invalid -V flag) but didn't fail the build. We'll need to look in to that separately.\n. I'm not sure this is valid Sass. Please confirm by trying it with Ruby Sass\nin sassmeister.com\nOn 15 Apr 2016 6:04 PM, \"VPenkov\" notifications@github.com wrote:\nI have\n%m__exhibit-header--medium {\n    @extend %q__font__exhibit-header;\n    @extend #{&}--plain;\n    &--plain {\n        @extend %q__font--uppercase;\n        font-size: $b__headers__header--size;\n    }\n}\nI'm getting\n\n\nError: \"%m__exhibit-header--medium\" failed to @extend \"--plain\".\n       The selector \"--plain\" was not found.\n       Use \"@extend --plain !optional\" if the extend should be able to fail.\n        on line 57 of ../path/to/file/_m.exhibit.scss\n\n\n@extend #{&}--plain;\n-----------^\nWarning:  Use --force to continue.\n\n\n\n\nAborted due to warnings.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/2000\n. If you're going to make this massive of a change I suggest doing your best to move more inline with Ruby Sass implementation like with cssize.\n\nThe closer our internal data flow and logic is to Ruby the easier it's going to be keep features in sync, and prevent weird edge cases.\n. I wasn't insinuating it wasn't what you were doing. I just wanted to make sure we were on the same page.\n. I wasn't insinuating it wasn't what you were doing. I just wanted to make sure we were on the same page.\n. I agree. I tend to avoid the extend code this exact reason.\n. You'll probably have to rebase your sass-spec branch of master.\n. I'm pretty close on this. Should have something this weekend.\n. I thought this may be fixed a side effect of correcting our cssizg'ing of at-root in #2089 but that wasn't the case.\n. I've compared our at-root implementation against Ruby Sass. Our implementation is correct in this case.\nThe problem here is that the nested selector is being resolved (parentised) when it shouldn't have been.\nThis appears to related to #1890.\nThis is the AST when entering CSSize.\nAt_Root_Block 0x7fcdc0d139a0 (0@[7:2]-[7:10]) 0\n :At_Root_Query 0x7fcdc0d12cb0 (0@[7:2]-[7:10])\n  Block 0x7fcdc0d12d70 (0@[7:11]-[9:3]) [root] 0\n   Trace 0x7fcdc0d12ff0 (0@[8:13]-[8:17]) [name:main]\n    Block 0x7fcdc0d12f40 (0@[8:13]-[8:17]) 0\n     Ruleset 0x7fcdc0d13900 (0@[1:2]-[3:3]) [indent: 0]\n     >Selector_List 0x7fcdc0d130d0 (0@[1:2]-[1:5]) <8166671770794171514> [@media:0x0] - - - -\n     > Complex_Selector 0x7fcdc0d13310 (0@[6:0]-[6:3]) <8166671593091081176> [weight:200] [@media:0x0] - - - - --  <>\n     >  Compound_Selector 0x7fcdc0d133b0 (0@[6:0]-[6:0]) <8166660432830525886> [weight:100] [@media:0x0] - - - - - <>\n     >   Type_Selector 0x7fcdc0d01610 (0@[6:0]-[6:3]) <8166660258955216540> <<foo>> - - - - <>\n     > { }Complex_Selector 0x7fcdc0d135c0 (0@[1:2]-[1:5]) <8275265288974811151> [weight:100] [@media:0x0] - - - - --  <>\n     > { } Compound_Selector 0x7fcdc0d00a70 (0@[1:2]-[1:2]) <8275253853970583923> [weight:100] [@media:0x0] - - - - - <>\n     > { }  Type_Selector 0x7fcdc0d00b40 (0@[1:2]-[1:5]) <8275253679961073361> <<bar>> - - - - <>\n      Block 0x7fcdc0d137b0 (0@[1:6]-[3:3]) 0\n       Declaration 0x7fcdc0d13860 (0@[2:4]-[2:7]) 0\n        prop: String_Constant 0x7fcdc0d01020 4 (0@[2:4]-[2:7]) [baz] <>\n        value: String_Constant 0x7fcdc0d01150 4 (0@[2:9]-[2:11]) [1] <>\n. I'm finding these by trying to compile foundation.\n. @saper any action to be taken here? Please ship it or close it :)\n. VS build files have seen a lot of changes recently. Is this still relevant?. LibSass is an implementation of the Sass language. Our goal is to be 100$ compatible with Sass. We're closing this issue since Ruby Sass produces the same output. In the future please confirm that LibSass' output differs from Ruby Sass before opening an issue. \nIf you wish to suggest features of file bugs in the Sass language please open an issue with Sass - https://github.com/sass/sass\n. For reference this is a feature of Sass. Sass functions have the same syntax and CSS functions so if the function you're calling doesn't exist in Sass we assume you meant to call a CSS functions i.e. url(), rgb(), etc...\n. @emyarod how are you calling this function that produce the error?\n. I'm not sure to be honest. IIRC Ruby Sass has some logic around file encodings i.e. if it encounters a unicode character it inserts @charset \"utf-8\"; automatically.\nI wonder if it assumes all files are utf-8 by default... @chriseppstein may have some insight.\n. @mgreter this not an inconsistency in Sass, it's an important part of Sass semantics around selector lists. \nselector {\n  $p: &;\n}\nIn this $p is a list of selector lists, which are themselves lists. \n``` sass\nselector {\n  $p: &;\na: $p;\n  b: length($p);\n  c: nth($p, 1);\n  d: length(nth($p, 1));\n  e: nth(nth($p, 1), 1);\n}\nselector1, selector2 {\n  $p: &;\na: $p;\n  b: length($p);\n  c: nth($p, 1);\n  d: length(nth($p, 1));\n  e: nth(nth($p, 1), 1);\n}\nselector1 subselector1, selector2 subselector2 {\n  $p: &;\na: $p;\n  b: length($p);\n  c: nth($p, 1);\n  d: length(nth($p, 1));\n  e: nth(nth($p, 1), 1);\n}\n```\nShould produce\n``` css\nselector {\n  a: selector;\n  b: 1;\n  c: selector;\n  d: 1;\n  e: selector;\n}\nselector1, selector2 {\n  a: selector1, selector2;\n  b: 2;\n  c: selector1;\n  d: 1;\n  e: selector1;\n}\nselector1 subselector1, selector2 subselector2 {\n  a: selector1 subselector1, selector2 subselector2;\n  b: 2;\n  c: selector1 subselector1;\n  d: 2;\n  e: selector1;\n}\n```\n\nGive this information the following makes sense.\nselector {\n  a: nth($p, 1);\n}\nselector {\n  a: selector;\n}\n$p is a list of lists ((selector,),).\nnth($p, 1) is the first list (selector,)\nwhich when print to css is selector\n\nI'm happy to work you answering any questions about Sass semantics if you're unsure why something is happening. It's better to take the time to fully understand an issue so an appropriate fix can be implemented. Add small hacks just results is more edge cases that aren't really edge cases.\n. As I understand it type-of can only return on of the following values.\narg_list\nbase\nbool\ncolor\nlist\nmap\nnull\nnumber\nstring\nAs a result the selector is coerced to list.\n. That's true, but Sass allows it and \"do what says does\" has been our guiding principal.\n. Please add test\n. My understanding is that we've gone back to one input and the output for the nested syntax. The other libsass-closed-issues folders are for different output styles which are treated separately.\n. This project is an implementation of the Sass language. Our goal is to be 100% compatible with Sass. We're closing this issue since Ruby Sass produces the same output. In the future please confirm that LibSass' output differs from Ruby Sass before opening an issue.\nIf you wish to suggest features of file bugs in the Sass language please open an issue with Sass - https://github.com/sass/sass\n. This code was never valid Sass. It previously worked due to a bug, that bug has been fixed.\n. Without any code there isn't any thing I can say to you. If code compiles with Sass but not LibSass then it is a bug, please open a issue. Before doing so make sure code compiles with the latest LibSass which is available via www.sassmeister.com\n. @mgreter any objections to releasing 3.3.6 after this is merged?\n. @mgreter once these land I'll make sure major projects like foundation, and sassdash still compile as expected.\n. I wasn't aware, thanks for the link.\n. I refactored the argument logic to match Ruby Sass in 3.3.3. It should be correct. The issue is more likely which how we're evaling call.\n. You get 5 checks with you don't PR from a fork.\n. Nice catch y'all\nOn 25 Apr 2016 9:29 AM, \"Marcel Greter\" notifications@github.com wrote:\n\nClosed #2046 https://github.com/sass/libsass/issues/2046 via #2048\nhttps://github.com/sass/libsass/pull/2048.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/2046#event-639249983\n. I can confirm the code supplied does not work as expected in Ruby Sass. It may have previously erroneously worked in LibSass due a to a bug that has since been fixed.\n\nUpdate your color function as shown below for get the behaviour you expect.\nsass\n@function color($keys...) {\n    @return get($colors, $keys...);\n}\n. Given the updated color() I get the expected output in LibSass 3.3.5\ncss\na {\n  background: #00cdcb;\n  color: #51a351; }\n. I'm confused, there is no node-sass 3.8.3. Please read their documentation\nto determine your correct version.\nOn 27 Apr 2016 8:26 AM, \"Cameron Knight\" notifications@github.com wrote:\n\nnode-sass version: 3.8.3, using included libsass\nOn Mac OS X 10.11\nUsing either Node.js 4.2 or 5.6\nConfigured to use local CSS modules by default.\nInput code:\n:global(.thing) {\n    color: red;\n}\n:global(.thing[disabled]) {\n    @extend .thing;\n    background: blue;\n}\nResult: Bus error: 10\nBoth the following work without issue:\n:global(.thing) {\n    color: red;\n}\n:global(.thing[disabled]) {\n    @extend :global(.thing);\n    background: blue;\n}\n.thing {\n    color: red;\n}\n.thing[disabled] {\n    @extend .thing;\n    background: blue;\n}\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/2051\n. Thanks for the report @ckknight. You're correct that the first example causes a segfault.\n\nIt's also worth noting that neither of your examples are valid Sass. When we patch this segfault both your examples will return the expect error.\nError: Invalid CSS after \":global(\": expected pseudo_expr, was \".thing)\"\n        on line 13 of test.scss\n  Use --trace for backtrace.\n. For more information on why this will stop working please read medium.com/@xzyfer/why-node-sass-broke-your-code-and-semver-1b3e409c57b9\nIf you think this should be supported in Sass please open an issue with the official Sass project.\n. I'll run this through my citgm if all goes well we can ship it. This\nprobably won't land in time for the next node-sass.\nOn 28 Apr 2016 9:48 AM, \"Marcel Greter\" notifications@github.com wrote:\n\nThis should now also fully pass\n:not(.thing) {\n    color: red;\n}:not(.thing[disabled]) {\n    @extend .thing;\n    background: blue;\n}\n@xzyfer https://github.com/xzyfer I'm in favor of merging this in lack\nof any other solution. Sassmeister seems to indicate that this has\nsegfaulted even at node-sass 3.3.6. This patch here at least seems to\nenable to most common cases with :not selector. As I said, I cannot\nreally estimate the impact of the changes, beside trusting our spec tests.\nIf you agree feel free to hit merge.\nhttps://ci.appveyor.com/project/sass/libsass/build/1.0.2426/job/5laspavt0upkreqb#L278\nThe following tests pass but were marked as TODO for libsass:\nC:/projects/libsass/sass-spec/spec/libsass-todo-issues/issue_2054\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/2052#issuecomment-215266304\n. Rescoping this to 3.4.1 since it shouldn't block 3.4.0.\n. IMHO we shouldn't worry about non-semantically different output anymore. Dart Sass already produces semantically equivalent but different output. In sass-spec we can added libsass specific output with expected_output-libsass.css. I personally don't think implementing this sorting behaviour is worth the performance, and maintainer overhead.\n\nUp to you @mgreter if you think this is worth investing in. I'm happy to close it.. @mgreter the value for a pseudo selector the following\n```\nlex< one_plus< \n  sequence< \n    alternatives<\n      exactly<'+'>, \n      exactly<'*'>,\n      exactly<'-'>,\n      quoted_string, \n      identifier,\n      sequence<\n        unsigned_number,\n        optional< sequence<\n          alternatives< exactly<'e'>, exactly<'E'> >,\n          optional,\n          digits, \n        > >,\n        optional\n      >\n    >, \n    optional_css_comments \n\n\n()\n```\n. @nex3 we'll need to figure a plan for how to handle sass-spec in these cases. It turns out @mgreter has incidentally \"fixed\" this issue as a side affect of other extends work #2253.\n\n\nI suggest the relevant specs are updated to match the expected behaviour and ruby-sass todo'd.. As explained in the medium post we simply are not able to warning  about changes to break invalid code. That would mean adding a warning for every little bug fix becuase maybe some one was relying on if.\nWe outline all the changes in the release notes and link to respective issue for more information. That's the best we can do.\n. I need time to look over this. Going to bed now. Will make time tomorrow.\n. All in all :+1:\nNot sold on containers but we change easily change it later if it's annoying enough.\n. Yep just leaving some thoughts here so that they're somewhere.\n. Let's not do this. This check does not belong in cssize. The cssize class is a 1-1 port from Ruby, no need to change that.\nRuby solves this a CheckNesting visitor. We an equivalent since there is an entire class of nesting errors we cannot catch properly atm.\n. This bug doesn't prevent Sass code being ported to LibSass so IMHO it's a high priority. IMO a fix for this bug is not worth the tech debt. \nIf you really want to fix this it's trivial to add a CheckNesting visitor before cssize runs.\n. Beefed out the specs in https://github.com/sass/sass-spec/pull/857\n. Ruby Sass only checks nesting before and after eval. I expect this to prevent unnecessary duplication and guarding in the parser and eval.\nYou're correct adding check after extend would fix #1585 but Ruby Sass doesn't do it. That issue is indicative of a bigger issue. Since it's an edge case and doesn't prevent people adopting LibSass it's not worth introducing technical debt for.\n. lgtm\n. lgtm\n. Spec activated in https://github.com/sass/sass-spec/pull/869\n. > it doesn't seem to support a custom hasher\nThis is why unordered map is used. We maintain the ordering by keeping the keys ordered in a vector on insert.\n. Can you elaborate why you need the ordered vector? Hashed is already ordered. The has itself is an unordered list but the insert order of the keys is tracked.\nIt looks like Hashed's iterator has been broken. It should iterate over the list_ vector and look up the value in the elements_ hash.\n. FWIW I don't get email updates when editing comments. It's worth just posting a new comment so I'm not email back out of context replies. Timezones \ud83d\ude1e \n. The extra memory doesn't seem worth it. Is there a use case for iterating over values?\n. The overwhelming majority of map usage in Sass is direct key look up. We should optimise for that use case above all else.\n. I'm \ud83d\udc4d  for make list_ a deque\n. The tradeoff in code complexity is also something to consider. I'll take slight less efficient, user friendly, maintainable code instead of overly complicated, over optimized code any day.\n. With that said adopting deque isn't necessary to fix the issue at hand. I'd\navoid conflating the two is this PR.\n. node-sass 3.4.2 cannot be compiled with LibSass 3.3.6.\nYou'll need atleast node-sass@3.6.0.\n. Started working on this. I think this is last real blocker to a stable 3.5.. @mgreter feel free to ask me in these cases. I know the language spec very well and know my way around the Ruby code base. \n. These failures are strange.\n. Rebuilding the failed build to see if it's a blip.\n. CI looks better \\o/\n. Please open this PR against the sass2scss repository.\nOn 11 May 2016 12:47 AM, \"Carlos Eduardo Melo\" notifications@github.com\nwrote:\n\nI'm not an expert in C++, but, since this problem has been annoying me for\na while, I decided to create a patch to libsass in order to support\nmultiline declarations.\nThis patch creates a preprocess function that concatenates a line with\nits subsequent when one of the following situations occur:\n- the line ends with a backslash;\n- the line ends with a comma;\n- the parenthesis for that declaration aren't balanced.\n\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/sass/libsass/pull/2079\nCommit Summary\n- Added support to multiline declarations in indented syntax\nFile Changes\n- M src/sass2scss.cpp\n  https://github.com/sass/libsass/pull/2079/files#diff-0 (64)\nPatch Links:\n- https://github.com/sass/libsass/pull/2079.patch\n- https://github.com/sass/libsass/pull/2079.diff\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/2079\n. @cemelo no worries, we appreciate your work. If you could PR sass2scss we could get this into the next release.\n. This project is an implementation of the Sass language. Our goal is to be 100% compatible with Sass. Something is considered a bug if we produce different output to the official Sass compiler.\n\nIn this case the official Sass compile errors with your code. \n\nI don't believe this to be a bug\n\nTechnically there is a bug in LibSass that allows this code to compile. As for the quote issue, I can't determine if there is a bug with handling quotes because I cannot get your code to compile with official Sass compiler to compare the output.\n\nhow the string interpolation [...] has changed in newer versions\n\nEvery new release of LibSass brings us closer to behaving like the official Sass compiler. The release notes for each release covers the specific changes.\n\nIt's worth being aware that you should always assert that your code is valid Sass as far as the official Sass compiler is concerned. I cover this extensively in a recent blog post - https://medium.com/@xzyfer/why-node-sass-broke-your-code-and-semver-1b3e409c57b9#.6jh3adpe0\n\nIf you wish to suggest features of file bugs in the Sass language please open an issue with Sass - https://github.com/sass/sass\n. You might be interested to know I was able to derive two separate LibSass issues from your code sample - #2081 and #2082\n. You might be interested to know I was able to derive two separate LibSass issues from your code sample - #2081 and #2082\n. The correct fix for code is\ndiff\n-$string: $string#{$separator}#{$item};\n+$string: #{$string}#{$separator}#{$item};\nYou should always #{} your variables when outputting them to css i.e. in properties of selectors.\n. The correct fix for code is\ndiff\n-$string: $string#{$separator}#{$item};\n+$string: #{$string}#{$separator}#{$item};\nYou should always #{} your variables when outputting them to css i.e. in properties of selectors.\n. A work around for this is Interpolating $prefix because interpolation should always return an unquoted string.\nsass\n$class: #{$prefix}#{\"-\"}#{$suffix};\nProduces\ncss\n-bar {\n  foo: bar;\n}\n. @nex3 can you please confirm what the expected output of this is? I'm getting contradicting results from Ruby Sass 3.4, 3.5, and 4.\n```\n$prefix: \"\";\n$suffix: bar;\n$class: $prefix#{\"-\"}#{$suffix};\n{$class} {\nfoo: bar;\n}\n```. This currently has a test that fail due to an incomplete implementation of the check nesting visitor which is resolved in #2086.\n. This PR currently has 2 failings test, 1 is fixed by #2085, which currently has it's own failing test which depends on this PR.\n. > so maybe TraceMixin would be a bit more clear about that\nI decided to keep it Trace because that's the Ruby name. I would also like to come back to renaming Declaration to Prop. It helps if we're all speaking the same language.\n\nAnd it might make sense to only store the pointer to the mixin\n\nThe implement doesn't care about the mixin itself, just it's name and pstate. I presume the name for displaying error messages somewhere I haven't seen yet.\n. @mgreter I explain in more detail in #2086 \n\nThe Trace node is a simple wrapper around the result of a mixin call \nand @content. It exists as a way to group the resulting properties\nas a block but maintain some metadata about the initiating mixin call \nor @content block.\nIt also plays an important rule is bubble those blocks with @at-root \nand nested property sets. This required implementing the final\n missing cssize methods. As a result we should a complete @at-root \nimplementation.\n. I'm not 100% sure myself. As far as I can tell the Trace is a block\naround the resulting output of a mixin call. Instead of appending\nthe individual resulting nodes to the parent block, the Trace block \nis appended. The Trace node keeps a reference to the pstate of\nthe mixin that created and it's name.\n\nThe primary usecase appears to be in maintaining a backtrace in\ncase the resulting nodes end up in a location that's invalid. FWIW\nI don't believe I'm correctly handling the backtrace in this PR. Since\nit's not covered by specs it's a manual process.\nThis is the explanation I got from @nex3 \n\nit allows us to reconstruct a stack trace that includes mixin invocations even after mixins have been resolved\nit wraps the output of a mixin invocation and remembers that mixin's name and line/filename information\nso that if, later on, we run into an error in that output\nwe can tell the user \"this was caused by including this mixin\"\n. That's my understanding. The node was originally called MixinTraceNode in Ruby Sass but was renamed to TraceNode but is still so far only used for mixins.\n. > I will see if I can re-use the Trace Node for what I need with imports\n\nI would avoid this. Ruby Sass is explicit about it's usecase.\n\nA solely static node left over after a mixin include or @content has been performed.\nIts sole purpose is to wrap exceptions to add to the backtrace.\nSource\n\nThere are various assumption made in places like check nesting and cssize visitors around this.\n. I addressed the feedback, and did some additional clean up.\nIt's late here so I'm not going to wait up for CI. \nI'll ship this in the morning.\n. I've also made sure the respective PRs this references are up to date with the changes made here so they serve as an accurate reference to the intentions of this merge.\n. https://github.com/brandonprry/sass-fuzz\n. Thanks @glen-84 I've confirmed this is a bug with defining mixins within @media. The work around for now is moving the @mixin outside the @media.\n. Thanks @glen-84 I've confirmed this is a bug with defining mixins within @media. The work around for now is moving the @mixin outside the @media.\n. > previously we used the names as given by the css spec\nIn this case being accurate to spec was a hindrance not a help. This change was a made to move use closer to the reference implementation.\n\ncomments and variables still refer to the original name\n\nThis is easy to fix.\n\nsass dart also opted to use the official names\n\nThis is a good argument for eventually doing this. Now is now not the time.\n\nCommaSequence_Selector is really not an intuitive replacement for Selector_List\n\nMay be not, but being close the reference implementation has many benefits.\n\n@xzyfer do you agree on this?\n\nI agree we should eventually move to match Dart Sass. IMO it's too early. With 3.5 feature ready to land we should stay close to Ruby Sass until we're committed to making Dart Sass our reference. I don't see this being reasonable until after we ship 3.5.\n\nwill do the renaming in that commit\n\nPlease don't do this on your branch. Lets keep feature PR focused on one problem at a time.\n. The reason for this change was to match the reference implementation. Our selector handling and extends code is in bad shape. I spent a couple weeks trying to resolve some issues with at-root which was slowed significantly but the disparity in selector node names.\nI'm in favour of adopting the naming scheme from dart-sass, but against bespoke naming. We're going to be moving closer the reference implementation, especially in light of dart-sass dropping some inconsistent behaviour that we're hacked into libsass.\n1: https://github.com/sass/dart-sass/blob/master/differences.md. This is on purpose and is a core part of Sass unit maths. In fact this is\nalmost always the behavior you want.\nSass is smart enough apply the unit maths when with nth or calc. However\nbecause you're the doing the math before passing the list into nth we can't\nknow that you're going to later use it in nth so we the math when creating\nthe list.\nOn 1 Jun 2016 10:49 PM, \"Carl-Erik Kopseng\" notifications@github.com\nwrote:\n\nUnitless numbers are promoted to have units in arithmetic\nAfter trying out nth in SassMeister I see that all Sass engines produce\nthe same weird output\nhttp://www.sassmeister.com/gist/8b352671c54cde4285b4d79a0510dc4b for\nthe nth() function. For some reason Sass decides to promote the unitless 4\nto 4n so that it can add it to 3n. I cannot find this behavior documented\non the Sass site\nhttp://sass-lang.com/documentation/file.SASS_REFERENCE.html#number_operations,\nwhich just has this to say on adding incompatible units\njust like in real life, you cannot work on numbers with incompatible units\n(such as adding a number with px and em)\nI would normally think that 3n and 4 would be incompatible, but this does\nnot align with Sass' views, unfortunately. Is this a bug or a feature?\ninput.scss\n$list1 : (1, 2, 3, 3n + 4, 5);\n// string concatenation hack to avoid arithmetic processing$list2 : (1, 2, 3, #{3n}+#{4}, 5);\n.foo {\n  content: nth($list1, 4 );\n  content: nth($list2, 4 );\n}\nlibsass 3.3.6-34-ge330\nhttp://libsass.ocbnet.ch/srcmap/#dGVzdCB7CiAgY29udGVudDogYmFyOyB9Cg==\n.foo {\n  content: 7n;\n  content: 3n+4; }\nruby sass 3.4.22\nError: Invalid CSS after \"..., 3, 3n + 4, 5)\": expected expression (e.g. 1px, bold), was \";\"\n        on line 1 of test\nversion info:\n$ sassc --version\nsassc: 3.3.0\nlibsass: 3.3.4\nsass2scss: 1.0.5\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2102, or mute the thread\nhttps://github.com/notifications/unsubscribe/AAjZWK0JTuGAbeXbXSn4VzAO1-EglXuSks5qHX_GgaJpZM4Irgia\n.\n. It's important to not think of n as defined unit. Sass numbers consider any valid css identifier attached to a number as a unit. This is future proof against css adding new units in the future. Whitelisting unit would just cause users pain.\n\nInternally we track known css units for purpose of conversion, however for unknown units we trust you know what you're doing.\n. We can agree to disagree. This prevents significant more bugs than it causes. Users would be upset if 3px + 4 = 7px. I would any addition/subtraction would a unit check guard.\n. Sorry I am missing a not. 3px + 4 should be  7px.\n. > I[t] would any addition/subtraction would a unit check guard.\nI mean that any time someone wants to do + or - with a variable they would need a guard (an @if) to check the unit were the same. The behaviour I've described is overwhelming common cases, so Sass optimizes for it.\nThe situation you've run into is very rare and the exception to the rule.\n. This project is an implementation of the Sass language. Our goal is to be 100% compatible with Sass. We're closing this issue since Ruby Sass produces the same output. In the future please confirm that LibSass' output differs from Ruby Sass before opening an issue.\nIf you wish to suggest features of file bugs in the Sass language please open an issue with Sass - https://github.com/sass/sass\n. I believe this happens because the empty placeholder selector is thrown away, just like normal empty selectors, so when you're trying to extend it later on it doesn't exist.\n. Thanks for the report however without concrete examples of LibSass being\ndifferent to Ruby Sass there isn't anything we can do. Things that are/were\ndifferent to Ruby Sass have/will change because people will report those\ndifferences affecting their code.\nThis is likely why this erroneous behavior has recently stopped working.\nApologies for any inconvenience.\nIf you could spend some of your time trying to find a case where we get\nthis wrong we'd love to know about it, sassmeister.com is a great online\nfor comparing Ruby Sass and LibSass.\nOn 7 Jun 2016 12:58 AM, \"hon2a\" notifications@github.com wrote:\n@xzyfer https://github.com/xzyfer There are two interesting aspects to\nthis:\n1. I've been using this pattern for a year now (through various libsass\n   versions) without any problems,\n2. as described above, it only fails sometimes (most of the time it\n   still works fine).\nBut I've got my work-around ... so I just wanted to report it in case it\npoints to a larger issue.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2103#issuecomment-223985083, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe/AAjZWFYzACgITDL23kBn_TI3DVD82rUjks5qJDWtgaJpZM4Iu92Z\n.\n. This project is an implementation of the Sass language. Our goal is to be 100% compatible with Sass. We're closing this issue since Ruby Sass produces the same output. In the future please confirm that LibSass' output differs from Ruby Sass before opening an issue.\nIf you wish to suggest features of file bugs in the Sass language please open an issue with Sass - https://github.com/sass/sass\n. Thanks @MoritzKn \n. Thanks @mgreter.\n. Spec added https://github.com/sass/sass-spec/pull/874\n. I partially addressed this #2199. It's hard to justify continuing down this path considering how much code churn will be required. I'll have to come at this in a different way.. This has come up a couple times. There are compatibility issues with -p. We're open to a real fix but it's much more involved than this.\nhttps://github.com/sass/libsass/issues/1433\nhttps://github.com/sass/libsass/pull/1365#issuecomment-123325642\nhttps://github.com/sass/libsass/pull/795#discussion_r22396485\n. This is not possible and we have no plans to make it possible in the near future. If you want a JS based Sass linter I suggest you look at https://github.com/sasstools/sass-lint. It's currently the best around.\n. Thanks for the report @battaglr\n. This is not something that belongs in LibSass. This is an implementation detail of the gulp watcher. Unfortunately I'm not sure this is avoidable in JavaScript filesystem watchers.\n. Thanks for the report @danielguillan I can confirm this issue.\n. Spec added https://github.com/sass/sass-spec/pull/877\n. Please confirm the version of LibSass you're using.\nOn 2 Jul 2016 7:30 PM, \"Dave Green\" notifications@github.com wrote:\n\nWe've recently inherited a codebase -- a conversion from LESS to SCSS --\nthat seems to be producing the following error...\nunclosed parenthesis in media query expression on line 6 at column 4\n... with this code (and other examples throughout)...\n$over-large-displays: #{\"only screen and (min-width: 1200px)\"};\n// Aspect ratios.\n@mixin aspect-ratio($width, $height) {\n@media ($over-large-displays) {\n    padding-top: $height / $width * 100%;\n  }\n}\n.sixteen-nine {\n    @include aspect-ratio(21, 13.7);\n}\nI've seen some similar tickets floating around with the same error, but\nthe circumstances differ slightly.\nIs this a known issue with libsass and the above syntax? Or is it in fact\nthe syntax at fault?\nGrateful for you help.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2117, or mute the thread\nhttps://github.com/notifications/unsubscribe/AAjZWAj4Xbbbc9LYfEHvLTPk9IumOczrks5qRi-cgaJpZM4JDo28\n.\n. Thanks @mgreter. Looks good. I'll write a test and merge soon.\n. \ud83d\udc4d \n. Had a look into this. It's related to the selector lookahead. We don't currently have a equivalent of Sass' try_declaration. Moving this off the 3.4 critical path since it's an edge case.\n. I don't know about this. It breaks away from the Ruby Sass implementation which suggests the real bug is else where.\n. FWIW perl-libsass is probably the most accurate implementation of the C APIs, is it maintained by the author of most of the C API.\n\nOur C API is documented here. If something is unclear we welcome improvements.\n. Thanks @DerPapst \n. I can confirm in v3.6.0 there was a segfault. With latest master it produces the following incorrect output.\n.section-title, .section h2:not(.section-title):not(.section h2:not(.section-title)) {\n  text-transform: uppercase; }\nThis output is due to to a know bug https://github.com/sass/libsass/issues/2055. Closing this as a duplicate.\n. You had me at pizza. But seriously I'm excited to see this happening in sprockets. @am11 as our resident Windows expert do you have any ideas what could be happening?\n. Thanks for this. I'll look into why sass-spec is failing. I don't believe it's related to this patch.\n. Thanks @delapuente. Apologies for the silence I've had my hands full. I'll try to get to this by the weekend. I've also notice master is failing atm which will ned to be addressed.\n. @delapuente apologies on my side also. I've been busy with conference work and trying to release 3.3.7 that I haven't had a time to familiarise myself with the Ruby implementation.\nI've had a chat with the Sass team about how we'll roll out 3.5. I'll open an issue with to discussion in the next couple days.\n. @delapuente the bracketed list implementation looks good. Looks much closer to the what I've glanced from the Ruby Sass implementation.\nWe have interesting feature with our CI that might be of interest to you. If you create a Sass Spec for the and link to it in the PR description our CI will test against that PR instead of master. You can use this feature as a way to incremental enable 3.5 specs you're targeting.\n. Apologies for the slow feedback loop. The Australian timezone in unfriendly to collaboration.\nYou can see the sass spec feature in mostly closed PR i.e. https://github.com/sass/libsass/pull/2135 references https://github.com/sass/sass-spec/pull/885 which enables the spec for that bug.\nA link to a sass spec PR in a libsass PR description is parsed out in CI, and that sass spec PR branch is used instead of master.\n. The way I would approach a sass spec PR for this PR would be the following.\nSet the 3.5 tests to pending for libsass\nruby sass-spec.rb annotate --pending libsass spec/sass_3_5\nThe activate the bracketed lists specs\nruby sass-spec.rb annotate --active libsass spec/sass_3_5/bracket_lists/\nThis combined with your Makefile changes will ensure that all activated 3.5 tests are run.\n. I'm in bed atm. Going to crash now. You can join us in Slack for more real time feedback during waking hours if you'd like.\n. Very strange. You can Twitter DM me your email and I can invite you. My\nhandle is the same. DMs are open.\nOn 16 Sep 2016 1:25 AM, \"Salvador de la Puente Gonz\u00e1lez\" \nnotifications@github.com wrote:\n\n@xzyfer https://github.com/xzyfer I tried to join Slack a couple of\ntimes so far but I'm not receiving the invitation. Could you help me,\nplease?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2134#issuecomment-247360876, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWMHpICR2kI-7xOnRYMnu3l9-kPOGks5qqWNkgaJpZM4JYlsV\n.\n. @delapuente we can't merge 3.5 features until we have 3.4 stable released. We've gearing up for a 3.4RC but ran into some last minute issues.\n\nI expect this to land shortly after 3.4 stable.\n. @delapuente we can't merge 3.5 features until we have 3.4 stable released. We've gearing up for a 3.4RC but ran into some last minute issues.\nI expect this to land shortly after 3.4 stable.\n. @delapuente 3.5 features are starting to land. Unfortunately there was a lot of churn since this PR was :+1:. Can you please allow commits from maintainers so I that I can update this PR and get it :ship:. @delapuente thanks. I'll be merging this in the next 24hrs. There a couple failing tests I need to look into.. @delapuente thanks again for your work on this. I have this green in CI in #2279. There are still a handful of places where we copy lists and drop the delimiter data on the floor. I'll take a closer look at those in the morning and ship this.. It's impossible for Sass to know what the value of --red will be when it reaches lighten since it can be changed by the CSS inheritance. I don't imagine you'll ever be able to use CSS custom properties with Sass functions. You'll need to wait for CSS Level 4 colour functions to land.\n. Another example in https://github.com/dlmanning/gulp-sass/issues/583. Thanks @scottdavis \n. @mgreter I recall you looking into this. How did you go?\n. This project is an implementation of the Sass language. Our goal is to be 100% compatible with Sass. We're closing this issue since Ruby Sass produces the same output. In the future please confirm that LibSass' output differs from Ruby Sass before opening an issue.\nIf you wish to suggest features of file bugs in the Sass language please open an issue with Sass - https://github.com/sass/sass\n. Simplified reproduction\nsass\n$v: 1px;\n$b: #{$v} + #{$v} + #{$v} + #{$v} + #{$v};\nInterestingly this relies on deprecated Sass behaviour. It's possible this behaviour will be removed from Sass before it's patched in LibSass.\nSpec added https://github.com/sass/sass-spec/pull/893\n. I can confirm this issue. Spec added https://github.com/sass/sass-spec/pull/892\n. I can confirm this issue. Spec added https://github.com/sass/sass-spec/pull/891\n. I've started looking into this. I've confirmed it's a bug with the cssize visitor.\n. > Towards that end I looking to use libsass to parse the SASS into a AST\nWe actively discourage using the LibSass AST. We offer no guarantees to it's stability. There is also a lot of logic the output phase so the AST does not give a useful picture.\nIf you want to play with the AST I recommend using Ruby Sass, or looking at specific Sass parsers like https://github.com/salesforce-ux/scss-parser or https://github.com/tonyganch/gonzales-pe\n. It's worth double checking the #2153 spec. It doesn't use @debug or @warn.\nhttps://github.com/sass/sass-spec/pull/892\n. @mgreter I commented a like to the specific however I agree adding it to\nthe issue description is more visible. Will do so in the future.\nOn 2 Sep 2016 12:36 PM, \"Marcel Greter\" notifications@github.com wrote:\n\n@xzyfer https://github.com/xzyfer thanks, didn't see it. IMO it would\nbe worth to ammend the original issue report with such information or\nadditional test cases, since it was not that easy to spot.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2160#issuecomment-244268428, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWNHHeYI6Gbjkd5KsqEFSaXHxglKMks5ql4u-gaJpZM4JzSlh\n.\n. We don't make any guarantees around exit codes. Feel free to PR. I'm planning to pull the trigger on 3.4 soon so the soon the better :)\n. I'd prioritise the node sass spec runner. I have no qualms about changing exit codes without warning.\n. As mentioned in https://github.com/sass/sassc/pull/182#issuecomment-244284837\n\nWe should probably expose some agnostic error code. Possibly part to the API.\n. Make it so\n. I think I flicked the right switch. The coveralls UI isn't obvious.\n. Ok I think I have it this time for reals.\n. Huzzah! https://github.com/sass/libsass/pull/2184\n. I am unable to reproduce this with LibSass 3.3.6 on El Capitan. Unfortunately I don't have access to macOS. It's possible Apple has changed something that's affect LibSass, or there is an issue with the beta. Either way it's not something we can justify committing resources to until macOS is stable.\nAs far as I know there is no node-sass@v3.10.7. I know this because I released v3.9.0 5 minutes ago. \n. As an aside I have noticed related bug.\n``` sass\n@function test($a, $b) {\n  @return \"#{$a}\" + \"#{$b}\" + \"\" + \"\";\n}\nfoo {\n  content: test('bim', 'baz');\n}\n```\nRuby Sass\nfoo {\n  content: \"bimbaz\"; }\nLibSass\nfoo {\n  content: \"bimbazbaz\"; }\n. Apologies you're correct. I am now able to reproduce this with 3.3.6. This has been fixed in master and will be in 3.3.7.\n. Please provide real code examples. If I can't make the error happen on my\nmachine I can't fix it.\nOn 6 Sep 2016 3:26 AM, \"Taha Hassan Mujaddadi\" notifications@github.com\nwrote:\n\nSASS is not importing the content of file but just the CSS comments which\nI put on the files. Further more node-sass --version giving me error as not\nrecognized command.\ninput.scss\n@import \"variabels\"\n@import \"mixins\noutput.scss\n/_variables__/ /_mixins***/\nversion info:\n```node-sass 3.4.2\n1: http://libsass.ocbnet.ch/srcmap/#dGVzdCB7CiAgY29udGVudDogYmFyOyB9Cg==\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2170, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWA_V-XhQa7v_eQgLC9Dqk-pZ2VJMks5qnFC_gaJpZM4J1O5w\n.\n. I have a feel delayed values are not long for this earth\n. This broke a lot of eyeglass tests i.e. https://github.com/sass-eyeglass/eyeglass/blob/master/test/test_assets.js#L31-L52\n\nI need to investigate further after some sleep.\n. All 3.4 blockers have been resolved \ud83c\udf89 \nI will CITGM 3.4, and aim to have an RC this week.\n. There will not be a 3.3.7. The next release will the 3.4 release candidate.\nI can't say when it'll happen, there are currently some blockers I'm\nworking on.\nOn 7 Oct 2016 7:29 AM, \"Anthony Sottile\" notifications@github.com wrote:\n\nHi @xzyfer https://github.com/xzyfer Thanks for all the awesome work :)\nWondering when I can expect 3.3.7 so I can plan some time to follow up\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2174#issuecomment-252079100, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWNIV0ryXFjvKj2q1q3sRsUXzRHU_ks5qxVoXgaJpZM4J4BOt\n.\n. Going to re-run the CITGM and take 3.4 RC1 this weekend.\n. 3.4.0RC1 is released, please test it. I plan to make it stable in the week\nor so. You can test it via node-sass@beta\n\nOn 7 Dec 2016 11:29 AM, \"stepmr\" notifications@github.com wrote:\n\nJust checking in, are there any blockers to releasing 3.4 RC1?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2174#issuecomment-265318079, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWGXV2JehgkKRdT0irrZmxmEoHVhiks5rFf3QgaJpZM4J4BOt\n.\n. It is done! :tada:\n\nAlso cut new major releases for node-sass, gulp-sass, and grunt-sass.. Lgtm\n. This is a bug with sass2scss. I've opened an issue with them https://github.com/mgreter/sass2scss/issues/31\n. I want to build some confidence in error handling but otherwise this is pretty close.\n. @bertusgroenewegen thanks for the report. I've updated issue with working example and accurate title.\n. @bertusgroenewegen there are no immediate plans to fix this. Output style bugs are our lowest priority because they don't change the behaviour of the output.. There's almost certainly a more glamorous solution to this is what the internet suggests\nhttps://github.com/mkrufky/libdvbtee/issues/22\nhttps://github.com/Homebrew/legacy-homebrew/issues/43874\n. This caused a regression that was hidden by a bug in Sass spec - https://github.com/sass/sass-spec/issues/932\n. @mgreter do you think you'll have a chance to look into this? Otherwise I may have to back this patch out of 3.4.\n. @mgreter do you think you'll have a chance to look into this? Otherwise I may have to back this patch out of 3.4.\n. @mgreter I talked to @nex3, she confirmed the evaled case is bug in Sass.\n\nthat's a bug, the last one should be -5%/2\n. @mgreter I talked to @nex3, she confirmed the evaled case is bug in Sass.\nthat's a bug, the last one should be -5%/2\n. This an Sassc behaviour. Sassc, like node sass, is free to do what it\nlikes. IMHO this is a responsible UX choice by those projects.\n\nOn 25 Sep 2016 4:47 PM, \"Nick Schonning\" notifications@github.com wrote:\n\nNot sure if this has a solution because libsass has the assumption of SCSS\nrather than Ruby Sass, which has the opt-in for SCSS.\ninput.sass\n.basic\n  padding: 1px\nlibsass 3.5.5\n.basic {\n  padding: 1px; }\nsass --scss test/syntax/input.sass\nruby sass 3.4.22\nError: Invalid CSS after \"  padding: 1px\": expected \"{\", was \"\"        on line 3 of test/syntax/input.sass  Use --trace for backtrace.\nversion info:\n$ node-sass --version\nnode-sass       3.10.0   (Wrapper)       [JavaScript]\nlibsass         3.3.6   (Sass Compiler) [C/C++]\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2191, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWMbpzYuNeIPUz8CtbtxQ4obqrsb6ks5qthjpgaJpZM4KF1jL\n.\n. Removing this from the 3.4 milestone. I'm not comfortable fixing what isn't broken for users. Let's see what Ruby Sass does. This may be more appropriate for 4.0.\n. I've noticed this happening recently. I don't think it's related to the build time. The build completes but CI hangs for over 30minutes seemingly waiting to execute sass-spec.\n\n```\nFetching info for PR 2193\nRun options: --seed 42180\nRunning:\n```\n. You may be right. \n. :+1:\n. The sass spec bug in question is https://github.com/sass/sass-spec/issues/932\n. Patch provided upstream - https://github.com/sass-eyeglass/eyeglass/pull/145\n. Fixed in eyeglass@1.1.2\n. Looks like the regression was caused by a new feature in #2089. Hopefully this means it should be a straight forward fix.\n. Looks like the regression was caused by a new feature in #2089. Hopefully this means it should be a straight forward fix.\n. /cc @mgreter\n. Thanks\n. Interesting I didn't think this was valid, but I can see that it is. What's the use case for this syntax?\n. The behaviour exhibited by LibSass here is different from Ruby Sass, but it is no more or less inconsistent. I don't believe this should block 3.4 unless it arises as an issue during RC.\nWe'll address this for good when https://github.com/sass/sass/issues/2160 is resolved.\n. Rescoping this to post 3.4.\n. Since this is environment specific I'd say the first step to making progress on is this for one of you two create a dockerfile as a reproduction.\n. Thank you for this. I wont have time to look it over until next week. In the mean times it's worth noting we purposely differ from Ruby Sass in some cases to provide a better experience in non-spec compliant browsers.\nhttps://github.com/sass/libsass/issues/1747\n. No objections from me. @saper have thoughts?\n. We're going to leave this for now. There are some bugs in Ruby Sass that should be fixed first.\nhttps://github.com/sass/sass/issues/2160\n. I'll take a closer at this after the 3.4 RC, and aim to get this into 3.4 stable.\nAs for 869a51a, is there a spec for what this is addressing? I should be in it's own PR.\n. It's not clear to me from the PR description what role \n\nImprove extending of wrapped \":not\" selectors\n\nPlays in addressing a bug with interpolating of property values. My comment was simply that this PR appears to be addressing two unrelated issues.\n. lgtm\n. Thank you @mgreter. Please try to keep PRs focused. This PR is address 4 different issues of differing merit.\nI would prefer not merge the makefile change. The existing order is obvious and self documenting.\n. @mgreter I have cherry picked 314360e and 51ff53f on to master. Please back out f8d9dec, then feel free to ship this. \nI'll be feature freezing master after this merge so I release a 3.4 RC this weekend.\n. I understand as a power user this is of benefit to us. My reasoning is\n- it's something that we can't guarantee the correctness of, so it will regress\n- it's unclear what to do when adding new files\nGiven the opportunity I'd prefer to optimise for making life easier for new contributors.\n. Currently they're listed alphabetically so it is no brainer where a new file belongs in the list.\nI'm happy to comprise. Maintain alphabetical ordering, but move the problematic large files to the top, preferably with a comment for why it's out of order.\n. This is good. Thank you.\n. @am11 I'm not familiar with the use case for /DEBUG in VS. What are your thoughts on supporting it? Is it a common thing to do in the VS community?\n. Thanks for your input @am11. If it's not actively causing harm I'd prefer to keep it as is. I'll leave this issue open as a reminder to look into the root cause.\n. Incredible work y'all. I'm on the road for conference for another week. I won't have a chance to\ntake a look untik December. That aside I'd prefer to tag 3.4 stable before\nlanding a change set this large.\nMy plan is to tag 3.5 betas almost immediately after 3.4 because we already\nhave some 3.5 feature patches. I'd feel more comfortable landing this in\nthe 3.5 betas.\nOn 25 Nov 2016 11:55 AM, \"Marcel Greter\" notifications@github.com wrote:\n\n//CC @xzyfer https://github.com/xzyfer @am11 https://github.com/am11\n@chriseppstein https://github.com/chriseppstein @hcatlin\nhttps://github.com/hcatlin @nex3 https://github.com/nex3 @drewwells\nhttps://github.com/drewwells\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2222#issuecomment-262876345, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWLVCaDdGGgABYykFugzNGCYGoqucks5rBlwxgaJpZM4KglKm\n.\n. These massive PR are both conceptually and technically difficult to review, but I have it a shot. I took well over an hour so I've just left comments in place as I worked through the diff. Some of the questions may be been answered further down the in the diff.\n\nFirst, there are some good quality of life improvements here. Not needing to pass around ctx.mem to constructors anymore is a win in and of itself.\nFeedback\n\ndocument survive along side detach\nI'm not convinced there's value in having our DSL in  _PTR_CONST type defs\nI not bothered either way\nSASS_MEMORY_CAST is used seemingly haphazardly. \nAs much as I'd hate to see this PR grow we should go all in or not at all in this PR\n\nQuestions\nYou've expanding some operations which in many cases has had the code harder to grok. Is this for technical reasons, to debug, or personal taste?\ni.e.\nStatement_Obj stm = b->at(i);\nStatement_Obj ith = stm->perform(this);\nStatement_Obj ith = b->at(i)->perform(this);\nIn places like CSSize this IMHO has negatively affected the readability of the code.\nAsides\nThis requires further offline disucssion but I'm not convinced aiming for GCC 4.4 is worth while. We currently state GCC 4.6+ as a requirement but in practice (I think) we require 4.7 or 4.8.\nIMO there's a lot of value in adopting C++ 11 language semantics i.e. shared_ptr, and move semantics where they make sense. Is it worth changing the error handling model of the parser in order to simplify this implementation? It shouldn't be difficult to change the parser to not throw unexpectedly.. All in all this looks good to me. I won't realistically be able to re-review after you've addressed my feedback but I trust it's fine. Given the scope of this these changes, the scope of changes I need to make to get custom property support landed for 3.5 I think we should aim to merge this asap so I'm not blocked on 3.5 feature work.\nMy preference would be to merge #2134 and then this, purely because rebasing #2134 will be a PITA. What are your thoughts, are you ok with rebasing your work after #2134 or would you prefer to and this first?\n. No worries. Feel free to squash and merge when you're ready.. @mgreter heads up master is failing due to https://github.com/sass/sass/issues/2211. You can safely ignore the failing spec for spec/libsass-closed-issues/issue_2132. Fixed master. Kicked off this build again and it's green.. I have updated this issue with a more reduced test case.\n. @nex3 is the Ruby Sass behaviour intended, if so, what's happening here? \nI'm guessing it's just list to string.\n. @IrvingArmenta were able to resolve your issue? I suspect it's due to your missing includePaths config in gulp-sass.. >if i put the variable inside the same file, like on top of the same document, I get the same result, the task just ends with no error message\nCan you please provide an example I can compile myself to see this issue?. @IrvingArmenta can you please provide the gulp-sass config you're using. I'm pretty sure this is a config issue on your end.. Thanks could you also supply the output of npm ls node-sass. Sounds like you have broken Sass. Please try using gulp-ruby-sass and fix any errors it reports.. @pxl-dgn thanks for the report. I can confirm this is fixed in 3.4.0-RC1.. You'l have to do this on case by case basis using selector functions.\n. It's not clear what you're trying to achieve. Assuming you're trying to remove the nested .container selector you could do either.\nStop nesting unnecessarily\nsass\n.container .operation {\n  color: green;\n}\n.row {\n  &.is-active, &:hover {\n    .operation {\n      color: inherit;\n    }\n  }\n }\nIf you insisting on nesting you can use at-root to break out of nested rules, but can cause issue if this block is itself nested in other selectors, or used in a mixin.\n``` sass\n.container {\n  .operation {\n    color: green;\n  }\n@at-root(without: rule) {\n    .row.is-active,\n    .row:hover {\n      .operation {\n        color: inherit;\n      }\n    }\n   }\n}\n```\nBoth of these produce\n``` css\n.container .operation {\n  color: green; }\n.row.is-active .operation,\n.row:hover .operation {\n  color: inherit; }\n```\n. Can you not just combine the row selectors?\nrow.is-active:hover & {\n ...\n}\n. There is no way for Sass to magically combine selectors for you. No tool can safely do this because the CSS cascade can cause side effects depending on your DOM structure.\n. > Isn't the point of nesting selectors to combine them ?\nNo. It appends selectors, but it won't rewrite them to be \"cleaner\" because it's impossible to do safely. It will just append nested selectors to the parent.\n\nI just wanted to fix the fact that I have to write two .row selectors.\n\nrow.is-active:hover & {\n ...\n}\n. @pawlufelice the output is correct. To do what you want you can do\nscss\n.a {\n    & &-c {\n        color: hotpink;\n    }\n}\nb {\n    & &-c {\n        color: hotpink;\n    }\n}\nYou also try to get creative with the Sass selector functions.. This is a Sass feature called nested properties. See http://sass-lang.com/documentation/file.SASS_REFERENCE.html#nested_properties\nThe intention for uses like\nsass\n.foo {\n  border: {\n    width: 1px\n    color: red;\n    style: solid;\n  }\n}\ncss\nfoo {\n  border-width: 1px;\n  border-color: red;\n  border-style: solid;\n}\n. It's not a syntax error to Sass.\n```sass\ntest {\n    color: blue\n    #child {\n            color: red;\n    }\n\n}\nIs treated as\ntest {\n    color: blue #child {\n            color: red;\n    }\n\n}\nwhich as I've showed above is treated as a nested propertycss\ntest {\ncolor: blue #child\n  color- color: red;\n}\n```. This is a bug. When get a .sass file the first thing we do is convert it to .scss. LibSass doesn't handle .sass files directly. it looks like we're losing the original .sass content along the way.. According to the grammar the first 2 cases are not valid CSS. \nmedia_query_list\n : S* [media_query [ ',' S* media_query ]* ]?\n ;\nmedia_query\n : [ONLY | NOT]? S* media_type S* [ AND S* expression ]*\n | expression [ AND S* expression ]*\n ;\nmedia_type\n : IDENT\n ;\nexpression\n : '(' S* media_feature S* [ ':' S* expr ]? ')' S*\n ;\nmedia_feature\n : IDENT\n ;\nThe last case is valid because not -webkit-device-pixel-ratio matches NOT IDENT.\nI believe Ruby Sass is incorrect for not erring in this case. I have opened in issue with Ruby Sass to confirm https://github.com/sass/sass/issues/2198\n1: https://www.w3.org/TR/css3-mediaqueries/#syntax. @bwbuchanan thanks for the report. I have confirm this behaviour is broken in both LibSass and Ruby Sass.. The second issue can be seen when there is content in the media block\ncss\n@media all and (min-width: 100px) {\n  a { b: c }\n  @import \"https://example.org\";\n}\nRuby Sass\n```css\n@media all and (min-width: 100px) {\n  a {\n    b: c; }\n@import \"https://example.org\"; }\nLibSasscss\n@import \"https://example.org\";\n@media all and (min-width: 100px) {\n  a {\n    b: c; } }\n```. Is this ok to land before your memory management changes? If so I'll review\nthis weekend.\nOn 8 Dec 2016 3:06 AM, \"Marcel Greter\" notifications@github.com wrote:\n\nFixes #1037 https://github.com/sass/libsass/issues/1037\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/sass/libsass/pull/2239\nCommit Summary\n\nImplements call stack queries (functions and mixins)\nUpdates documentation for callee stack queries\n\nFile Changes\n\nM docs/api-context.md\n   https://github.com/sass/libsass/pull/2239/files#diff-0 (9)\nM docs/api-function-example.md\n   https://github.com/sass/libsass/pull/2239/files#diff-1 (2)\nM docs/api-function.md\n   https://github.com/sass/libsass/pull/2239/files#diff-2 (26)\nM docs/api-importer.md\n   https://github.com/sass/libsass/pull/2239/files#diff-3 (38)\nM include/sass/context.h\n   https://github.com/sass/libsass/pull/2239/files#diff-4 (3)\nM include/sass/functions.h\n   https://github.com/sass/libsass/pull/2239/files#diff-5 (15)\nM src/context.hpp\n   https://github.com/sass/libsass/pull/2239/files#diff-6 (1)\nM src/eval.cpp\n   https://github.com/sass/libsass/pull/2239/files#diff-7 (18)\nM src/expand.cpp\n   https://github.com/sass/libsass/pull/2239/files#diff-8 (10)\nM src/sass_context.cpp\n   https://github.com/sass/libsass/pull/2239/files#diff-9 (4)\nM src/sass_functions.cpp\n   https://github.com/sass/libsass/pull/2239/files#diff-10 (7)\nM src/sass_functions.hpp\n   https://github.com/sass/libsass/pull/2239/files#diff-11 (9)\n\nPatch Links:\n\nhttps://github.com/sass/libsass/pull/2239.patch\nhttps://github.com/sass/libsass/pull/2239.diff\n\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2239, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWLX5eMBz7Qx6-qi_UnbfUC83T1P3ks5rFtl_gaJpZM4LGxVx\n.\n. I plan to tag 3.4 stable in the next couple days. That's when I'll do the release notes for the RC and stable. Given how relatively stable 3.4 is looking I'd prefer not to land unnecessary changes.\n\n\nRoughly speaking this is my plan (hopes) for the next couple months.\nFor all intents and purpose, 3.4 will be frozen once stable is tagged and the focus will be on 3.5. Any 3.4 regression fixes will land straight in the 3.5 betas.\nMy plan for 3.5 betas is roughly\n\n3.5 beta.1\nhttps://github.com/sass/libsass/pull/2134 (3.5. Bracketed lists)\nhttps://github.com/sass/libsass/pull/2190 (3.5. Invert function)\n3.5.beta.2\nhttps://github.com/sass/libsass/pull/2222 (Reference counted AST)\n3.5.beta.3\n\n2239 (C-API: Add call stack queries)\n\n\nSince 3.5 will take a couple months to finish the betas will give people time to catch up with ABI changes. Dealing with ABI versioning is also another reason IMHO for delaying this til after 3.4. stable.\nOnce we have 3.5 feature parity we're essentially feature complete with Sass. At that time I want to spend some time cleaning up internals. The next major Sass version in 4.0, and that's still probably around 6 months away.\nSass 4.0 will be first real \"major\" version release (i.e v2). This is where I'd like to land any major breaking changes i.e. ABI, removing .css imports, and potential setting a higher min gcc version (still thinking about this).. I think it'll have to be 3.5. Originally we were aiming for 3.4 but since\nthen 3.5 was released in RC waiting for LibSass before going stable. Given\nthat we'll have a bunch of time til 4.0 is in RC it makes sense for us to\nconsider v1 to be 3.5.\nOn 9 Dec 2016 12:17 PM, \"Marcel Greter\" notifications@github.com wrote:\n\nThanks for the schedule heads-up!\nBy ABI compatibility I meant this sucker here:\nhttps://github.com/sass/libsass/blob/master/src/GNUmakefile.am#L37\nWhen are we going to release the first stable LIBsass version (in terms of\na shared lib)?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2239#issuecomment-265905672, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWCwM1ikb53IPvc9cGCA9BUtLmjVLks5rGKwNgaJpZM4LGxVx\n.\n. @nex3 was this intentional or some github magic from https://github.com/sass/sass-spec/commit/b00da4024fa1c90ef5cd9ff1503bdcee3069ec33?\n\nThis PR was not ready.. The specs were only passing because LibSass was still todo'd :) I'll finish this tonight so I wont bother reverting.. Thanks @nex3. This project is an implementation of the Sass language. Our goal is to be 100% compatible with Sass. We're closing this issue since Ruby Sass produces the same output. In the future please confirm that LibSass' output differs from Ruby Sass before opening an issue.\nIf you wish to suggest features of file bugs in the Sass language please open an issue with Sass - https://github.com/sass/sass. It was compiling with LibSass because of a bug that has been patched. This code is not valid Sass and should never have compiled. You can confirm this by testing your code with Ruby Sass.\n:global\n    .my-global-class-name\n        background-color: red\nError: Properties are only allowed within rules, directives, mixin includes, or other properties.\n       If \":global\" should be a selector, use \"\\:global\" instead.\n        on line 1 of test.sass\n  Use --trace for backtrace.\nThe Ruby Sass error message is much better than ours and suggests a work around. In order to get this behaviour changed you'd need to open a feature request with Ruby Sass. It's noting that the CSS module syntax is valid in with the scss format\n:global {\n    .my-global-class-name {\n        background-color: red\n    }\n}. @jhnns there are a couple different elements in play here. The OP is using the old indented syntax. \nsass\n:global\n    .my-global-class-name\n        background-color: red\nIn that syntax :foo selectors have special meaning. This meaning predates the inclusion of : prefixed selectors in CSS by almost a decade. As I said above, changing this behaviour is not within scope of LibSass and needs to be addressed by the offical Sass team.\nOn the other hand the newer scss syntax guarantees to (mostly) be a super set of CSS. For this reason : prefixed selectors work as expected.. Fixes master. This is green now. Ready to go when there are tests.. The core of this issue is https://github.com/sass/sass/issues/2211. I'll sort this out now, hold on.. CI should now pass against sass-spec master. . Hopefully this goes without saying but please don't start working on a C++ API before opening some RFCs to discuss the implementation and its goals.. It's noting that the expected behaviour of #2056 has changed. The bug is now incorrect, see the final comments.. Nice one. This approach is fine by me. It's worth nothing that the extends behaviour has changed slightly in dart-sass, whose behaviour is going to be the reference implementation.. Yeah. Just wanted to make sure you were aware of the difference between Ruby Sass and Dart Sass since you're working on the extends code. . You could try setting the precision setting to a small enough value.\nOtherwise you'll need to implement your own rounding function with a very\nsmall epsilon.\nOn 22 Dec. 2016 10:09 pm, \"Marcin Cie\u015blak\" notifications@github.com wrote:\n\nRounding it yourself?\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2256#issuecomment-268778132, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWOCyafkI-oSVNtq0JZqg5Ba2T1RCks5rKlpxgaJpZM4LRax-\n.\n. This makes sense. The bug fixes in 3.4.1 required changes to old specs. If you test against sass-spec@master the failures should be gone. \n\nIt's worth noting that you should not be using the sass-spec tags. They have no formal meaning and exist largely as a debugging aid, and for the npm module for node-sass.. Feel free to ship this. I'll back port this to the 3.4 release line in the morning.. Back ported this to 3.4. The discussion happened on Slack. You were pinged. \n\nI\u2019ve just released LibSass/SassC 3.4.1 with some fixes that have landed since the 3.4.0 release.\nThere\u2019s a 3.4 branch in the respective repos in case patches need to be back ported for regressions.\nThe 3.4 LibSass branch does not include the memory manger changes, so we\u2019ll ideally only be back porting regressions or compatibility fixes like the str-slice behaviour changes\nMaster is tracking 3.5. I\u2019m aiming to release 3.5.0.beta.1 this week with the recent memory manager updates, and bracketed list support.\nThere\u2019ll be a Node Sass v5 release line tracking the LibSass 3.5.0.betas for the brave. We\u2019ll be keeping Node Sass 4 and 5 in feature sync until LibSass 3.5.0 is stable.\n\nThere's a lot of background but nothing is changing about how you contribute. I'll back port things to 3.4 if they're easy enough to do, and I think they significantly affect Ruby Sass compatibility. It's mostly a measure for Node Sass because afaik it's the biggest consumer of LibSass.. Back ported to 3.4 in b7b1276a5d37be5dba53a581999b76ec719b5fa2. Spec https://github.com/sass/sass-spec/pull/1027. Back ported to 3.4 in 05769273d9bef49a60a9af337ddfe99e5e393bca. Back ported to 3.4 in 05769273d9bef49a60a9af337ddfe99e5e393bca. Back ported to 3.4 in fc048f7c71f49a970fb160a28a83c082912d870c. Back ported to 3.4. in 606a4c2. An alternative ideal solution, and the one I recommend delay the selector parsing to the eval stage all together. This is what Ruby Sass does. During parsing they parse the selector a single thunk, then do the actual selector parsing during eval.\nThis approach also solves a couple other issues with at-root and parent selectors as discussed briefly in #2199. > As one can see, the explicit parent selector (&) seems to reach accross at-root rules\nAs I'm sure you've figured out, what's happening here is that & is being resolved in eval.\ncss\nfoo {\n  @at-root {\n    foo bar {\n      baz: baz;\n    }\n  }\n}\nThen the at-root is resolved in cssize. The & isn't reaching across the at-root. The root of problems we've had with & is that we've been resolving it at the wrong time which is what #2199 was addressing.. Superseded by #2270. Back ported to 3.4 in 1b7b8dd7c797fc51cff96a6895fcaeb02d08a417. Back ported to 3.4 in d301570e6536f251b9a2d226b2c0ae7ccda7cbf1 and b5fdde7747c5db3a9bb0ba4e8b32bce56d2c7505. Thanks. Fixed in #2373. This is blocked on support get-function for now. Otherwise the deprecation message would be misleading.. Merging into #2373 since all the specs are in the same folder.. I've thought about bracketed lists a bit more. I'm going to drop to\ndelimiter all together and just tagged the list as bracketed or not. In\nwhich case maybe having a different make function for bracketed lists make\nsense. It'll still return a Sass_List just with the bracketed bool set.\nI have Wip passing tests for dropping the delimiter I'll push this week.\nOn 3 Jan. 2017 2:21 am, \"Marcel Greter\" notifications@github.com wrote:\n\n@mgreter commented on this pull request.\nTechnically this looks ok, but I have two points:\n1.\nI'm not too excited about the term \"delimiter\" here. Maybe that is\n   just me, but I only only use \"delimiter\" for stuff the goes between things,\n   not around? I know that a lot of lists call their separator delimiter.\n   So having both delimiter and separator for lists seems confusing too\n   me. I would rather have called it Sass_List_Type ...\n   2.\nThere would be a way to make this a \"non\" breaking change. I guess\n   bracketed lists will be a seldomly used feature? So is it really needed in\n   the constructor? This way we would not need to alter the constructor for\n   lists. Implementors could then use \"sass_list_set_type/delimiter\" to change\n   it when needed. IMO there are a few other flags that are not exposed via\n   the constructor directly. Alternatively there could also be an explicit\n   constructor for bracketed lists. I.e. sass_make_array; calling it\n   array vs list would sound ok for me; but would need some more thought in\n   regard of the \"sass_is_list\" tests etc.\n\u2014\nYou are receiving this because you were assigned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2282#pullrequestreview-14854169,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWEtHvqcobZKGbf5yfhjV99r3i7pfks5rORYVgaJpZM4LYzuH\n.\n. >I'm not too excited about the term \"delimiter\" here\n\nThis has been addressed in #2284. The delimiter attribute was dropped in favour of the more semantic is_bracketed property which is what the delimiter attribute was being used to infer.\n\nThere would be a way to make this a \"non\" breaking change.\n\nI'm fine with making this a breaking a change as long it's document the change accordingly, which they will be. API breakages were expected in 3.5 and 4.0. \n\nI guess bracketed lists will be a seldomly used feature?\n\nI disagree. Given the sheer amount of grid \"frameworks\" that exist, and the number of new ones that came out for flexbox, I expect this feature to get a decent workout. We shouldn't get in the way of experimentation.\n\nIMO there are a few other flags that are not exposed via the constructor directly.\n\nSeparator, and bracket are core semantics of a list. The same isn't true for most other list attributes which are largely implementation details of LibSass.\n\nAlternatively there could also be an explicit constructor for bracketed lists. I.e. sass_make_array;\n\nI don't think arrays are right here. These are lists. They share all the same semantics as lists.\n. >I'm not too excited about the term \"delimiter\" here\nThis has been addressed in #2284. The delimiter attribute was dropped in favour of the more semantic is_bracketed property which is what the delimiter attribute was being used to infer.\n\nThere would be a way to make this a \"non\" breaking change.\n\nI'm fine with making this a breaking a change as long it's document the change accordingly, which they will be. API breakages were expected in 3.5 and 4.0. \n\nI guess bracketed lists will be a seldomly used feature?\n\nI disagree. Given the sheer amount of grid \"frameworks\" that exist, and the number of new ones that came out for flexbox, I expect this feature to get a decent workout. We shouldn't get in the way of experimentation.\n\nIMO there are a few other flags that are not exposed via the constructor directly.\n\nSeparator, and bracket are core semantics of a list. The same isn't true for most other list attributes which are largely implementation details of LibSass.\n\nAlternatively there could also be an explicit constructor for bracketed lists. I.e. sass_make_array;\n\nI don't think arrays are right here. These are lists. They share all the same semantics as lists.\n. Update the documentation and bumped the ABI version to 1:0:0. Thanks I'll update it. I'm not able to find any documentation on the\nsemantics of bumping those version numbers. Sounds like everyone just does\ntheir own thing. Do you know of any good recommendations? /cc @am11\nRegards,\nMichael\nOn Fri, Jan 6, 2017 at 12:31 AM, Marcel Greter notifications@github.com\nwrote:\n\nYou forgot to increment for windows:\nhttps://github.com/sass/libsass/blob/master/res/resource.rc\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2282#issuecomment-270644422, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWAMXBI5q-_mBgvv21lz3M-0znK-jks5rPPCygaJpZM4LYzuH\n.\n. There are bits and pieces I'll cherry-pick onto to master. I'll take care\nof it this weekend. Thanks Nick.\n\nRegards,\nMichael\nOn Fri, Jan 6, 2017 at 10:43 AM, Nick Schonning notifications@github.com\nwrote:\n\n@mgreter https://github.com/mgreter I left all the commits discrete if\nyou want to cherrypick parts, or I can fastforward the branch with the\nlatest.\nPS: There were more warnings, these where just the simple stuff\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2283#issuecomment-270790873, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWIpWJiuiKyPnYindMGpSaVsY4zmPks5rPYAQgaJpZM4LaIxy\n.\n. @nschonni there has been a lot of churn on master. Want to give this another shot?. On my phone now. Iirc my main gripe was with renaming variables like lhs\nand rhs with have a semantic meaning and make the code easier to reason\nabout.\n\nOn 26 Jan. 2017 2:27 pm, \"Nick Schonning\" notifications@github.com wrote:\n@xzyfer https://github.com/xzyfer you mentioned you wanted to cherry-pick\nsome stuff. I can do specific PRs for the parts if you call them out here\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2283#issuecomment-275300075, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWEf3TO93X7vtYPiHAdHyl3QE5kk2ks5rWBKNgaJpZM4LaIxy\n.\n. @am11 omg I've been dreaming about something like .clang-format. I couldn't find docs on a prevailing convention or tool for this stuff.. Specs https://github.com/sass/sass-spec/pull/1046. Back ported to 3.4 in 06aea01. @am11 you're my hero \ud83c\udf89 \nAre there any good resource on the recommended versioning schema for Windows, or is it fine to just mirror our libtool versioning?. Thanks for looking into this @am11. I don't think we need to complicate this any further. This is the first time we've bumped the C API ABI, so the process is new to me, and undocumented.. Thanks. I'm in bed now, will take care of this in the morning.\nOn 29 Jan. 2017 11:53 pm, \"Adeel Mujahid\" notifications@github.com wrote:\n\nRebased the branch against master.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2288#issuecomment-275911922, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWA1sire1lPTmyG_awEvfWNdgJKrNks5rXIurgaJpZM4LcU4g\n.\n. Is there a version of libsass-python that works? That way we have a reduced bisect range. I confirmed the latest foundation-sites compiled correctly shortly before releasing 3.4.0.. I've confirmed a segfault with 3.4.2, but success in 3.4.1. Investigating the root cause.. A git bisect has shows 466a9c2ecc4f036e761de77e8123c17e5a8826f2 is the cause /cc @mgreter. Back ported the bug fix to 3.4.4.. Done. - if the user authored transparent is should be preserved in the output. \n- if a color ends up with a 0 alpha channel at output time, output it as rbga(r, g, b, 0). Please note the blocked label. You're correct that this change is easy, but\nit will break support for old or browsers. The plan was to release the\nblocked issues in a post 3.5 release after the distribution settled. This\nway there was a release with the big 3.5 changes that didn't break older\nbrowsers as an upgrade path for node-sass.\n\nOn 13 Jan. 2018 9:01 am, \"Natalie Weizenbaum\" notifications@github.com\nwrote:\n\n@mgreter https://github.com/mgreter The spec changes in sass/sass-spec@\n4e9edaa\nhttps://github.com/sass/sass-spec/commit/4e9edaa84609f882ca4352b1c5d5afe10be50ac6\nshould encompass these changes.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2298#issuecomment-357366566, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWEfaEZFSzF-y5Bte1AtV76fw6RK8ks5tJ9YlgaJpZM4LjhC6\n.\n. @mgreter you AppVeryor role should be fixed. I couldn't fix it until you had signed in.. @mgreter you AppVeryor role should be fixed. I couldn't fix it until you had signed in.. This has been annoying me. I don't know what is creating the mark up, or how to disable the bounty source program. I don't know who set it up originally.. How did you figure this out? I went hunting but didn't see anything obvious.\n\nI recently chatted to @hcatlin about looking into disabling, or giving me access to the account but I think maybe he forgot.. omg.... Nice work on the update. I found the language a little hard to follow in some places. I've left comments.. I'll provide some copy this week.. Sorry I've been preoccupied with tracking that Alpine issues since it's blocked 3.5.0.beta.3. Feel free to ship this if you want and I'll PR fix later. My priority atm is figuring out what's causing the memory issues with Alpine.. I suspect you're correct. However if there is something we can do to mitigate the issue I'd like to try. Alpine is becoming a very important tool within the containerisation realm.. I believe this is a duplicate of https://github.com/sass/libsass/issues/2076. Spec https://github.com/sass/sass-spec/pull/1078. Spec added https://github.com/sass/sass-spec/pull/1094. @mgreter I'm about to go to bed. If want to take this over whilst I'm sleeping feel free.\nI got distracted by making a reduced test case for https://github.com/sass/node-sass/issues/1879. I managed to come up with a relatively small reproducible test case see https://github.com/sass/node-sass/issues/1879#issuecomment-277993203.. Considering this is causing compilation failures, it's clear this isn't a simple noop like a JS linter would be.\nI have very mixed feelings, I'm all for some kind of new formatting, but I've been burnt over and over again by these massive commits.. I'd rather incrementally formatting files as we touch them rather than a big bang commit. My suggestion would be to commit the configuration, and for us to configure our editors to apply the formatting as we work.. Off topic. @am11 you might be interested in this if you haven't seen it\nhttps://github.com/medialize/sass.js/\nOn 9 Feb. 2017 6:32 am, \"Adeel Mujahid\" notifications@github.com wrote:\n\nThis is great! I actually started prototyping it that day and so far\nachieved https://gist.github.com/am11/39a65404651f310966d646932c623dd6. I\nwas using clang-format which comes packed with Emscripten (installed few\nweeks ago; was experimenting WebAssembly version of node-sass with binaryen\nwasm-sass .. which is at least theoretically very possible goal to\nachieve \ud83d\ude1c).\nTwo things that I found are:\n\nThe latest version of clang-format (which usually is not available\n   on many Unices OOTB) has most features / options, so the help from\n   google/stackoverflow is bit challenging as we need to concentrate on which\n   version the OP is using\nIt is hard to deduce the LibSass code formatting style, as in some\n   places, we have custom styles .. which is tricky (if not impossible) to\n   configure in clang-format\n\nI like your approach @nschonni https://github.com/nschonni to obtain\nlatest, greatest clang-format via npm pipeline. \ud83d\udc4d\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2324#issuecomment-278436318, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWOWJUV4P__k5CyPa-f0mg8NrRmM9ks5rahhegaJpZM4L6cRg\n.\n. I've recently been doing a bunch of research into this area. I found this talk both interesting and rather convincing - https://www.youtube.com/watch?v=sn1Vg8A_MPU&feature=youtu.be. Ah nice, I also set up a coverity last week but couldn't figure out how to make it do things.. I've invited you to the one I set up, so in theory you should have all the permissions.. I think you need to upload the code tarball. Github allows you to download a tarball of master.. Oh nope, I'm totally wrong. Sounds like their tool creates a special tarball.. @nschonni done. I suspect it'll be something we do before cutting releases. I already a routine around releases to make sure we don't break popular node-sass projects.. @nschonni lets not. It's feasible that with bugs with memory handling could expose real attack vectors.. I think can reasonable run clang static analyser in CI. It's doesn't slow down compilation much. I'll at setting up for the OSX builds. We could also run cppcheck for the linux builds.. Travis secrets won't work for PRs from forked repos. It's a security feature.. I found a hacky way to make you a contributor. Use your powers for good.. This should be in node-sass in a day or so.. Activated the spec in https://github.com/sass/sass-spec/pull/1086. Triggered a rebuild with the spec.. Build frequencies for coverity are restrictive - https://scan.coverity.com/faq#frequency\n\nWe discussed in https://github.com/sass/libsass/issues/2325 and in Slack that as a result we mostly use it in addition to my exisiting pre-release sanity check.\nI think for now there's a coverity_scan branch that will execute a new build.. The CodeKit team is keen to get 3.5 into a release. I'm planning to tag 3.5.0.beta.3 with this and #2334 today to get them over the line and get #2330 into node-sass.. Nice one!\n```\nPlease find the latest report on new defect(s) introduced to sass/libsass found with Coverity Scan.\n1 new defect(s) introduced to sass/libsass found with Coverity Scan.\n25 defect(s), reported by Coverity Scan earlier, were marked fixed in the recent build analyzed by Coverity Scan.\nNew defect(s) Reported-by: Coverity Scan\nShowing 1 of 1 defect(s)\n``\n. Kicked off another coverity scan. I'll tag 3.5.0.beta.3 pending the results of coverity and my release testing.. IMO copying the iterator is the right thing to do here. Trying to get clever about the copy could get messy ~, and potentially result in a long tail of bugs related to not checking theforce_copy` flag.~\nThere's bigger perf fish to fry.\n. Never mind the striked-out part of previous comment. I think I was getting tripped up on the missing copy in the the number visitor.. Thanks @asottile. #2350 only partially addressed this issue.\nBefore\ndiff\n-custom2, [custom2], .custom2 {\n+custom2, .custom2 {\n   display: flex;\n }\n-[custom3], custom3, .custom3 {\n+[custom3], .custom3 {\n   display: flex;\n }\nAfter\ndiff\n-custom2, [custom2], .custom2 {\n+custom2, .custom2 {\n   display: flex;\n }\n [custom3], custom3, .custom3 {. To the best of our knowledge we have full 3.4 compatibility minus the known GitHub issues. If you run into a problem that isn't already covered by a GitHub please open one.\nYou're correct, the Sass compatibility reference is very out of date.. Thanks for the report @classicmike. I'm on holidays atm so this hasn't been looked into, however I can confirm the issue with a reduced test case.\nscss\n@at-root .block {\n  &__element {\n    &--modifier#{&}--another-modifier {\n      background: #fff;\n    }\n  }\n}. This actually a feature of Sass. Interpolations (#{}) in comments are still evaluated. The error happens because the interpolation is being evaluated but the assignment is not.\nThis project is an implementation of the Sass language. Our goal is to be 100% compatible with Sass. We're closing this issue since Ruby Sass produces the same output. In the future please confirm that LibSass' output differs from Ruby Sass before opening an issue.\nIf you wish to suggest features of file bugs in the Sass language please open an issue with Sass - https://github.com/sass/sass. I'm sorry but it's not clear under which circumstances Ruby Sass and LibSass behave differently. In my tests the result is always Error: Undefined variable: \"$variable\". in both engines.. Right so the difference in that in compressed mode Ruby isn't erring? This was not clear.. I've updated the issue to better describe problem.. Thanks for the report. I am able to confirm this issue. We don't currently account for @ rules with more than one argument.. Thanks @chriseppstein. Thanks for the report. This matches the current Ruby Sass behaviour, although not ideal. Please open an issue with the Sass project at https://github.com/sass/sass/issues.\nUnfortunately Ruby Sass isn't currently under active development so I don't expect this to get resolved upstream. We'll keep this open here but since it's a non-semantic difference it will be a low priority for us.\n. CSS colour names i.e red, black, yellpw, are considered Color objects in\nSass, not strings. This is why the string concatenation isn't working as\nexpected. If you quote the maps keys is should work.\nI'll need to look into whether we're meant to be providing an error for\nthis case.\nOn 10 May 2017 8:06 pm, \"Ryan Naddy\" notifications@github.com wrote:\n\nInstall node-sass (it installs libsass 3.5.0.beta.2):\nnpm install node-sass -g\nI create a file with a map, @each and @for like this:\ninput.scss\n$colors: (\n    yellow: #ffeb3b\n);@each $name, $color in $colors {\n    $amount: 40;\n    @for $i from 0 through 9 {\n        .#{$name}-#{($i*100)} { background-color: lighten($color, $amount) };\n        $amount: $amount - 2;\n    }\n}\nOnce it is compiled I get an empty output file like this:\n[libsass 3.5.0.beta.2]\nIf I modify the $colors map by removing the w in yellow to become yello,\nI get a proper output as follows:\n.yello-0{background-color:#fff}.yello-100{background-color:#fffffd}.yello-200{background-color:#fffef3}.yello-300{background-color:#fffde8}.yello-400{background-color:#fffcde}.yello-500{background-color:#fffbd4}.yello-600{background-color:#fffaca}.yello-700{background-color:#fff9c0}.yello-800{background-color:#fff7b5}.yello-900{background-color:#fff6ab}\nversion info:\n$ node-sass --version\nnode-sass       3.3.3   (Wrapper)       [JavaScript]\nlibsass         3.2.5   (Sass Compiler) [C/C++]\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2374, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWCCL77M5RaK3CfEwg6KWkFvtVvPgks5r4fyogaJpZM4NXBou\n.\n. So I've done some digging into into this and I am unable to reproduce this issue with the code supplied on libsass 3.5.0.beta.2.\n\ninput\n```scss\n$colors: (\n    yellow: yellow,\n    red: red,\n    blue: blue,\n);\n@each $name, $color in $colors {\n    @for $i from 0 through 2 {\n        .#{$name}-#{($i*100)} { \n          background-color: lighten($color, 10) \n    };\n}\n\n}\n```\noutput\n```css\n.yellow-0 {\n  background-color: #ffff33; }\n.yellow-100 {\n  background-color: #ffff33; }\n.yellow-200 {\n  background-color: #ffff33; }\n.red-0 {\n  background-color: #ff3333; }\n.red-100 {\n  background-color: #ff3333; }\n.red-200 {\n  background-color: #ff3333; }\n.blue-0 {\n  background-color: #3333ff; }\n.blue-100 {\n  background-color: #3333ff; }\n.blue-200 {\n  background-color: #3333ff; }\n``. I can confirm this is an issue with LibSass master.. Shouldnode-modulesbenode_modules? \nI'm certain this is a grunt configuration issue and not a libsass issue. Unfortunately we cannot offer grunt support.. Support for reference combinator (i.e./deep/) was added to Sass but the>>>` alias was not. Unfortunately it's since been removed from the specification and is being removed from Sass.\nThis matches the current Ruby Sass behaviour so I'm closing the issue.. I don't know anything about angular. Do you have a link?\nOn 16 May 2017 7:11 pm, \"Carlos Esteban Lopez Jaramillo\" \nnotifications@github.com wrote:\n\nSoo the notes on the docs on Angular guide are outdated?\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2378#issuecomment-301850745, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWP6w_evpSiPU1nga7pph0IgTNv0iks5r6djcgaJpZM4Nbh2a\n.\n. So it looks like the reference combinator (/deep/) has been dropped from CSS selector level 4 in favour or scope piercing combinator >>> in CSS scoping level 1.\n\nSince the scoping spec is still a drat we'll hold off implementation until their more confident the syntax is final. I'll open an issue upstream shortly.. For now the work around is to use /deep/ because >>> won't be supported\nuntil is starts landing in browsers.\nOn 16 May 2017 7:37 pm, \"Carlos Esteban Lopez Jaramillo\" \nnotifications@github.com wrote:\n\n@xzyfer https://github.com/xzyfer Look at the last paragraph in the\n/deep/ section before the yellow encased paragraph, it's anchored so it\nshould scroll by itself:\nhttps://angular.io/docs/ts/latest/guide/component-styles.html#!#-deep-\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2378#issuecomment-301857811, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWLRT7qz0uuIIUobXbhZr55BO-PHrks5r6d7hgaJpZM4Nbh2a\n.\n. Yeah >>> wont work with any Sass until browsers start implementing it.. This sounds like a question for @nex3. That syntax causes a syntax error on that latest Ruby Sass 3.5.0 build. So it may be a support feature but the syntax may be incorrect.. All the variations of the rgb, rgba, hsl, hslafunction useto_string`. Any reason only this call site was changed?. No, you're correct. My mistake. See https://github.com/sass/node-sass/issues/1979#issuecomment-304816220. Whoa is that generating docs from parsing the C++ source?\n\nMy primary concern here is that having the internals documented implies a stability contract that we don't offer.. This is hella cool though - https://nschonni.github.io/libsass/html/class_sass_1_1_a_s_t___node.html. Aside from the C API it's all unstable, maybe indefinitely. If we could\nrestrict the parsing to just those file this could be nifty though.\nOn 2 Jun. 2017 4:09 pm, \"Nick Schonning\" notifications@github.com wrote:\n\nMy primary concern here is that having the internals documented implies a\nstability contract that we don't offer.\nRight now it doesn't even get pushed into the repo since it's gitignored.\nI just figured it was a good start to get it in place. Then the javadoc\nstyle blocks can be added to start indicating the stablity of parts before\nmaybe adding it to a CI build publish\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2408#issuecomment-305698639, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWOJNlGpEA31aRKMvH_WjYMP7Hbfzks5r_6c3gaJpZM4Nt2AE\n.\n. Please bare with me I'm trying to piece this issue together because there is conflicting information.\n\nUsing the following input\n```scss\n$white: white;\n.test-btn-#{$white} {\n    color: $white;\n}\n```\nThe output I get from Ruby Sass 3.4.21, Ruby Sass 4.0.0.alpha.1 and LibSass 3.5.0.beta.2 is identical (although undesired).\ncss\n.test-btn-#fff{color:#fff}\nWith Ruby Sass 3.5.0.pre.rc.1 I see no output.\nHowever @evilebottnawi states they were able to get Ruby Sass 3.4.21 to produce the following output. Can you please confirm you were actually able to get this output, or was it a guess of the output you expected?\ncss\ntest-btn-white{color:white}\n\nthrows the error as expected\n\nThis is a little misleading. Ruby Sass is an error because the outputted classname .#fff is not valid CSS. If the class was .foo-#fff like in the OPs example then this error would not have occured.\n\nnode-sass [..] instead just silently failing to create the classes correctly\n\nThis is an a bug we should fix.. To be 100% clear all versions of Sass (except 3.5.0.pre.rc.1) produce the same output as LibSass?. For the record the correct output is\ncss\n.test-btn-#fff{color:#fff}\nThis may not be what you expect, but it's on purpose, and expected. \nThe reason this happens is because an unquoted colour name like white is a Color object, not a String object in Sass. When Color objects are outputted in compressed mode Sass tries to output the smallest representation of that colour i.e #fff. If you want to use a colour name as a string you need to quote it i.e. \"white\".. This project is an implementation of the Sass language. Our goal is to be 100% compatible with Sass. We're closing this issue since Ruby Sass produces the same output. . This is a feature not an issue. They will tell you the same. In Sass you should quote your colours if you want to use them as strings.. ```diff\n$testMap: (\n-    white: (color: white) // white is a Color object\n+    \"white\": (color: white) // \"white\" is a String object\n);\n@each $key in map-keys($testMap) {\n    .test-btn-#{$key} {\n        $colors: map_get($testMap, $key);\n    color: map-get($colors, color);\n}\n\n}\n```. Happy to help \ud83c\udf89 . This was totally my fault. This BC wasn't meant to be in the 3.4.x releases. I'll remove it and cut 3.4.6. FWIW I recommend skipping anything after 3.4.2 and going straight to the 3.5.0 betas. Node Sass hasn't used any 3.4.x release since the first 3.5.0 beta so they're not as battle tested as earlier 3.4 releases.. The branch is 3.4-stable. You'll need to PR a revert commit for the commit\nthat changed the behaviour.\nOn 4 Aug. 2017 7:25 am, \"Anthony Sottile\" notifications@github.com wrote:\n\n@xzyfer https://github.com/xzyfer what branch is being maintained for\n3.4 (3.4-stable, 3.4, or 3.4.x)? I can make a PR against whichever\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2411#issuecomment-320094391, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWLg0FMYd4O7jUpnt6R_DSD_5fkdXks5sUjq_gaJpZM4N5YR-\n.\n. Cool. I thought I had already reverted it. I'll try to get a new 3.4\nrelease out before going away for the weekend\n\nOn 4 Aug. 2017 11:01 am, \"Anthony Sottile\" notifications@github.com wrote:\n\nOh, I see it is already reverted in fd51586\nhttps://github.com/sass/libsass/commit/fd5158647cc9c63e44450378eb9cebc79b5a3b3e\n-- just unreleased :)\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2411#issuecomment-320128783, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWBnGthuCaW6_gCP8WXk1KP45x8JKks5sUm1wgaJpZM4N5YR-\n.\n. I'm not going to get this sorted before going away sorry. I'll take another look next week.. Looking at this again. We're having some hiccup with CI but it's on my radar for this week. I expect 3.3.6 to be the EOL release for 3.4.x.. @asottile I've tags 3.4.6 for you to start consuming. Release notes will come when I have time. Apologies for the delay. . The place to discuss this feature is https://github.com/sass/sass/issues/2144. Given the relationship between sass2scss and LibSass I don't believe there is a way to communicate these deprecation warnings between the two libraries.. @nex3 I've noticed the output between Ruby and Dart Sass is different in this case. Can you please confirm the correct output.\n\nInput\nscss\n.block {\n  @media not print {\n    @media (min-width: 600px) {\n      color: green;\n    }\n  }\n}\nRuby Sass\ncss\nDart Sass\ncss\n@media not print and (min-width: 600px) {\n  .block {\n    color: green;\n  }\n}. This project is an implementation of the Sass language. Our goal is to be 100% compatible with Sass. We're closing this issue since Ruby Sass produces the same output. In the future please confirm that LibSass' output differs from Ruby Sass before opening an issue.. You can work around this with interpolation\n```scss\n$default-margin: 10px;\nbody {\n    margin: $default-margin #{-$default-margin} #{-$default-margin} #{-$default-margin};\n}\n```. I don't this there is a \"right\" way. What I would do is assign the negative value to another variable first.\n```css\n$default-margin: 10px;\n$negative-margin: -10px;\nbody {\n    margin: $default-margin $negative-margin $negative-margin $negative-margin;\n}\n```. The core issue with that there's now safe way to differentiate between \nscss\n$default-margin - $default-margin\nand \nscss\n$default-margin -$default-margin\nChanging the way to code behaves depending on the position of the whitespace would cause a lot of confusion so treat them the same way.. calc() math and Sass math are very different. Sass math also predates calc by almost 10 years.. Thanks for taking to time to contribute. \nHowever I do not believe LibSass is the right place for this change. If anything we may be reducing output options. There are just way too many edge cases to handle when dealing with output generation. \nAdditionally due to how sass-spec works this isn't a feature we can reasonably test, and such guarantee to maintain.\nFormatting operations are much easier to do as a post-process on the generated CSS. Since you're already using gulp I recommended using a post-css backed formatter.. PostCSS is a generic CSS parser and AST. There's an huge ecosystem of tools built upon it. CSSComb  or [stylelint][2] might be a good starting points.\n[2]: https://stylelint.io/. Thanks @asottile, I'll take a look this weekend.. Back ported to 3.4. @nschonni just invited you.\n@mgreter you have a pending invite from June 9th, 2015. @mgreter it says you still haven't accepted the invite.\n@gy741 null pointers can go here. Given how LibSass is used they don't pose much of a real world risk.. Thanks. I'm aware of them, but I haven't had time to take a look. Anything critical will be addressed in the next major release. \nPlease don't divide our attention over hackerone, github issues, and email it just slows us down.. Please open this on the node-sass issue tracker by following the issue template.. This commit is failing on the 3.4-stable branch, on mingw. Not exactly sure why but I've track it down to the default argument assignment of msg here\nNestingLimitError(ParserState pstate, std::string msg = def_nesting_limit, std::vector<Sass_Import_Entry>* import_stack = 0);\nSee https://ci.appveyor.com/project/sass/libsass/build/1.0.3281. Nice find. Duplicate of #2409. Please the the issue fully for an explanation and\nsolution.\nOn 14 Jul. 2017 8:47 am, \"Juli\u00e1n Landerreche\" notifications@github.com\nwrote:\n\nWhen using color keywords as keys in maps, and then trying to access them\nusing map-get, I'm getting empty output.\nIn this example, I've used white and black as keys in $badColors map.\nThey return empty on map-get.\nThe workaround is wrapping the keys with quotes (ie. \"white\" and \"black\"),\nand that's enough for map-get to work as expected.\nHere is a gist on SassMeister\nhttps://www.sassmeister.com/gist/3f27aa9b65055370fccf8da5d035ca23 to\ntest (I couldn't load the libsass.ocbnet.ch/srcmap tool, as it seems\nthere is an issue with DNS records for that page).\nJust in case, here are the input and output too.\ninput.scss\n$badColors: (\n  white: #fff,\n  black: #000\n);\n$goodColors: (\n  \"white\": #fff,\n  \"black\": #000\n);\n.test-bad {\n color: map-get($badColors, \"white\");\n background-color: map-get($badColors, \"black\");\n}\n.test-good {\n color: map-get($goodColors, \"white\");;\n background-color: map-get($goodColors, \"black\");\n}\nActual results\n[libsass 3.5.0-beta2]\n.test-good {\n  color: #fff;\n  background-color: #000;\n}\nExpected result\n.test-bad {\n  color: #fff;\n  background-color: #000;\n}\n.test-good {\n  color: #fff;\n  background-color: #000;\n}\nversion info:\n$ node-sass --version\nnode-sass 4.5.3   (Wrapper)   [JavaScript]\nlibsass   3.5.0.beta.2    (Sass Compiler) [C/C++]\nNote: I've searched the existing issues and couldn't find this particular\nissue already reported, but I've seen there were already a few other issues\nwith color name keywords.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2442, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWLP65OgZfpnPwbyZeNi0LB9C0gXHks5sNp6EgaJpZM4OXojm\n.\n. It comes do to types. A quoted color \"red\" is a string, and unquoted color\nred is a color object. As long as the map key and the key passed to\nmap-get/map-set are the same it'll work as expected.\n\nOn 14 Jul. 2017 10:21 am, \"Juli\u00e1n Landerreche\" notifications@github.com\nwrote:\nYes, I saw that issue before posting this one, and although probably caused\nby the same misunderstanding, I though it would be better to create a new\nissue.\nBy the way, I found another workaround, which you can see in this gist\nhttps://www.sassmeister.com/gist/f1c3f2e6a788a081802e627359c324ad.\nPassing an unquoted key argument to map-get is enough to work. I though\nthat the argument had to be a string, but it seems a \"naked\" key is fine,\nand probably, correct. Right?\ninput.scss\n$badColors: (\n  white: #fff,\n  black: #000\n);\n$goodColors: (\n  \"white\": #fff,\n  \"black\": #000\n);\n.test-bad\n {\n   color: map-get($badColors, white); #Unquoted key\n   background-color: map-get($badColors, black); #Unquoted key\n}\n.test-good {\n   color: map-get($goodColors, \"white\");;\n   background-color: map-get($goodColors, \"black\");\n}\nActual and expected output\n.test-bad {\n  color: #fff;\n  background-color: #000;\n}\n.test-good {\n  color: #fff;\n  background-color: #000;\n}\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2442#issuecomment-315236321, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWH5Gd-KIYh7VdovnuDLgySTEENkWks5sNrSggaJpZM4OXojm\n.\n. The issue here is that Sass does not support $variables as the prop in @supports. \n```scss\n$prop: display;\n$val: flow-root;\ndiv {\n  @supports ($prop: $val) {\n    $prop: $val;\n  }\n}\n```\nThe following works as expected.\n```scss\n$val: flow-root;\ndiv {\n  @supports (display: $val) {\n    display: $val;\n  }\n}\n```\nThere are a couple things here:\n- Dart and Ruby produce no output (@nex3 can you please comment on whether this is intended?)\n- LibSass throws an error (it should either do nothing, or do something, but not error)\n. @nex3 thanks for clearing that up. Makes total sense.. See my reply is your other issue.\nOn 4 Aug. 2017 6:17 am, \"Spunkie\" notifications@github.com wrote:\n\nIs there is an equivalent to the ruby sass-convert in libsass/node-sass?\nI can't seem to find any mention of it in docs or GH issues.\nI'm converting over old build/watch scripts based on ruby sass to npm\nscripts with node-sass and everything has been easy so far except one small\nscript. The script watches a dir for any new css files and uses\nsass-convert to convert it to a well formatted and nested scss file. I've\ntried doing cmds like node-sass input.css output.scss --output scss but\nthis does not actually transform the css in any way.\n\nversion info:\n$ node-sass --version\n    node-sass       4.5.3   (Wrapper)       [JavaScript]\n    libsass         3.5.0.beta.2    (Sass Compiler) [C/C++]\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2455, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWIL8ugQSXcspVPtsxDMaBr-IRSQcks5sUirRgaJpZM4Os8Ak\n.\n. I'm personally in favour of increasing a minimum support clang/gcc versions. We'll come back around to this after 3.5.0 stable lands.. This project is an implementation of the Sass language. Our goal is to be 100% compatible with Sass. We're closing this issue since Ruby Sass produces the same output. In the future please confirm that LibSass' output differs from Ruby Sass before opening an issue.\n\nIf you wish to suggest features of file bugs in the Sass language please open an issue with Sass - https://github.com/sass/sass. @asottile bumped the build. @nschonni I think that is a red herring. The build fails due to the proxy being down\nFetching PR 2463\nTravis rate limit on github exceeded\nRetrying via 'special purpose proxy'\ncurl: (7) Failed to connect to libsass.ocbnet.ch port 80: Connection refused\nThe command \"./script/ci-build-libsass\" exited with 7.\nEverything else is a consequence on that. I'll update LibSass to use the heroku proxy I created for node-sass to stop this ever happening again.. Backported to 3.4. Thanks for confirming this issue @nschonni. I've added the spec.. Thanks @naroga.\nI've fixed the CI issues. I have no real opinion on this change but I believe @saper might?. Thanks @rrelmy, I've confirmed this issue.. This issue tracker is all the known inconsistencies. Any inconsistenty that\ndoesn't have an issue (open or closed) is unknown.\nOn 11 Sep. 2017 4:38 pm, \"Edmund\" notifications@github.com wrote:\nI am experiencing inconsistencies between Ruby Sass 3.4, and LibSass 3.4.\nIn order to pinpoint why these inconsistencies may be happening, I took to\nthe Sass Compatibility Page http://sass-compatibility.github.io/ as\ninstructed. This page does not compare Ruby Sass 3.4 with LibSass 3.4, so\nI'm not sure where to find the \"few incomplete edges which we are aware of\"\nthat are mentioned.\nIs there a publicly accessible list of the incomplete edge cases that you\nare aware of, to see if any are the same as the edge cases I am\nexperiencing?\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2473, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWBnV7i1K-2Ce097Ix65jaaVA3zBWks5shNV6gaJpZM4PSs1Y\n.\n. This is not a libsass issue. Open an issue with iconic.. Please search for other closes issues to find discussion about this.\nOn 14 Oct. 2017 1:22 am, \"Jonathan Andr\u00e9 Schweder\" notifications@github.com\nwrote:\n\nWhen trying to build and install the library an error occurs when the\ninstall directory (on linux) \"/usr/local/lib\" already exists, I change the\nMakefile to handle this with the \"-p\" param.\n\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/sass/libsass/pull/2486\nCommit Summary\n\nadded '-p' param to mkdir to handle when directories already exists\n\nFile Changes\n\nM Makefile https://github.com/sass/libsass/pull/2486/files#diff-0\n   (2)\n\nPatch Links:\n\nhttps://github.com/sass/libsass/pull/2486.patch\nhttps://github.com/sass/libsass/pull/2486.diff\n\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2486, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWHFuE76ms1c36LqYxwa0o32gdjQ_ks5sr3INgaJpZM4P4kAK\n.\n. This is a node-sass issue, I'll follow up there.. We have no timeline yet for updating node-sass. The next node-sass update\nwill be a stable 3.5 release.\n\nOn 15 Nov. 2017 3:11 am, \"Wes Todd\" notifications@github.com wrote:\n\n@mgreter https://github.com/mgreter Bump. Sorry to bother here, but I\nwas going to follow up with what it will take to get this into node-sass,\nbut I don't know how to know when it is ready or what to do.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2488#issuecomment-344309083, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWD2_swPt6aEbpIYDWISnK-L_8K-Cks5s2butgaJpZM4QH0Fb\n.\n. Node 9 is not yet supported.\n\nOn 1 Nov. 2017 5:28 pm, \"Knollan Tanteo\" notifications@github.com wrote:\n\nThis error just popped up on our test server today. Everything was working\nfine just yesterday. Can anyone shed a light on this?\nChecksums empty\n    Now using node v9.0.0\n    Now using node v9.0.0\n    ---NPM version---\n    5.5.1\n    v9.0.0\n    ---Install Bower ---\n    npm WARN deprecated bower@1.8.2: ...psst! Your project can stop working at any moment because its dependencies can change. Prevent this by migrating to Yarn: https://bower.io/blog/2017/how-to-migrate-away-from-bower/\n    /home/travis/.nvm/versions/node/v9.0.0/bin/bower -> /home/travis/.nvm/versions/node/v9.0.0/lib/node_modules/bower/bin/bower\n    + bower@1.8.2\n    added 1 package in 1.726s\n    ---Install Gulp ---\n    /home/travis/.nvm/versions/node/v9.0.0/bin/gulp -> /home/travis/.nvm/versions/node/v9.0.0/lib/node_modules/gulp-cli/bin/gulp.js\n    + gulp-cli@1.2.2\n    added 139 packages in 5.712s\n    ---Install NPM dependencies ---\n> node-sass@4.5.3 install /build/node_modules/node-sass\n> node scripts/install.js\n\nDownloading binary from https://github.com/sass/node-sass/releases/download/v4.5.3/linux-x64-59_binding.node\nCannot download \"https://github.com/sass/node-sass/releases/download/v4.5.3/linux-x64-59_binding.node\":\n\nHTTP error 404 Not Found\n\nHint: If github.com is not accessible in your location\n      try setting a proxy via HTTP_PROXY, e.g.\n\n      export HTTP_PROXY=http://example.com:1234\n\nor configure npm proxy via\n\n      npm config set proxy http://example.com:8080\n\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2489, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWKeWUg45wXjmi3q4uwk-C3d9BHdXks5syA-lgaJpZM4QNzUK\n.\n. Dart sass is now the reference implementation. It's somewhat diverged from\nruby sass. We should compare against that instead from now on.\n\nOn 12 Nov. 2017 12:43 pm, \"Marcel Greter\" notifications@github.com wrote:\n\nFound another interesting issue with ruby sass 3.4.23:\n:not(.thing) {\n  color: red;\n}\n:not(.bar) {\n  @extend .thing;\n}\nfoobar {\n  :host(:not(.other)) {\n    left: 0;\n  }\n}\nresults in\nNoMethodError: undefined method `do_extend' for :not(.other):Sass::Selector::Pseudo\nDid you mean?  extend\n  Use --trace for backtrace.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2498#issuecomment-343707480, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWAvmb5vBRpxGOmOf6n7DH80_xGvqks5s1k02gaJpZM4QatPp\n.\n. Good question. Maybe @nex3 can shed some light on the specifics. The way I\nunderstand it,\n\n\n\nif ruby and dart diverge in behaviour we should follow dart sass (unless\nit looks a bug, then file an issue with dart sass).\n\n\n3.4.x is deprecated (it's since been removed from sass-spec) so 3.5\nbehaviour is authoritive.\n\n\ndart sass has been 3.5 from the beginning\n\n\nOn 12 Nov. 2017 12:49 pm, \"Marcel Greter\" notifications@github.com wrote:\n\nDart sass is now the reference implementation. It's somewhat diverged from\nruby sass. We should compare against that instead from now on.\nIs there an official announcement that it is already the new reference\nimplementation?\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2498#issuecomment-343707689, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWHgI1qDwghIuUoDb_r29reRyOXIyks5s1k63gaJpZM4QatPp\n.\n. I'll talk to Stu about getting sassmiester updated. npm install dart-sass\nshould get you the latest version. I think it's safe to replicate dart sass\nbehaviour unless is seems broken. I'm about to jump on a plan. I can verify\nin a couple of hours if needed.\n\nOn 12 Nov. 2017 1:02 pm, \"Marcel Greter\" notifications@github.com wrote:\n\nFair enough ... the mentioned example doesn't give any result on any ruby\nsass version at least on sassmeister ... no time to test locally with all\nruby versions ...\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2498#issuecomment-343708161, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWDeiRoES5dfkSXTJi2cKtHeGnqWPks5s1lHSgaJpZM4QatPp\n.\n. Ok I can fix that later today. Aiming to cut a new 3.5-beta release also\nfor node-sass.\n\nOn 12 Nov. 2017 1:07 pm, \"Michael Mifsud\" xzyfer@gmail.com wrote:\n\nI'll talk to Stu about getting sassmiester updated. npm install dart-sass\nshould get you the latest version. I think it's safe to replicate dart sass\nbehaviour unless is seems broken. I'm about to jump on a plan. I can verify\nin a couple of hours if needed.\nOn 12 Nov. 2017 1:02 pm, \"Marcel Greter\" notifications@github.com wrote:\n\nFair enough ... the mentioned example doesn't give any result on any ruby\nsass version at least on sassmeister ... no time to test locally with all\nruby versions ...\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2498#issuecomment-343708161, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWDeiRoES5dfkSXTJi2cKtHeGnqWPks5s1lHSgaJpZM4QatPp\n.\n\n\n. Ok cool :-)\n\nOn 12 Nov. 2017 1:11 pm, \"Marcel Greter\" notifications@github.com wrote:\n\nFYI I already verified with dart-sass and behavior matches, I only wanted\nto mention the strange behavior of ruby sass, nothing more ...\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2498#issuecomment-343708404, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWBWCZQV9p6KbPY_TrXJzftYxtcKlks5s1lO1gaJpZM4QatPp\n.\n. :+1:\n\nMaybe not directly related but I thought it was worth mentioning changes to extend recently in sass https://github.com/sass/sass/pull/2319.\n. Tested this with the latest Ruby Sass, Dart Sass, and LibSass and confirmed the output is the same.\n```css\ndiv {\n  content: true;\n  content: true;\n  content: true;\n}\ndiv {\n  content: true;\n  content: true;\n  content: true;\n}\n```\nClosing this as fixed on master.. We welcome PRs to fix support issues for unsupported OSes :)\nOn 30 Dec. 2017 10:14 pm, \"drook\" notifications@github.com wrote:\n\nYup, in some node-sass libsass bundled versions I saw the SmartOS #define\nknob just to fix this SEC macro - for some reasons it doesn't fire on\nSolaris.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2519#issuecomment-354540678, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWNdmwgJAHFtcgRHc7Dl15s39dg4Dks5tFhsfgaJpZM4RPiJh\n.\n. We don't have the capacity or hardware to support sunos. However we are open to pull requests that address compatibility issues.. Removed todo in https://github.com/sass/sass-spec/pull/1200. Nice one. There are still a couple bugs to chase down, and some clean up but this is ready for some :eyes:. CI is green. Please provide a complete Sass code sample.. This is not possible. You can only compiles one scss file to one css file. You need to run the command twice with different output styles.. Please search issues before opening a new one. . Duplicate #2509. Ruby Sass is the official Sass. LibSass is an implementation of the Sass language. Our job is to mimic the behaviour of Ruby Sass.. ```scss\n// Ruby Sass\n@print {\n  .abc .random {\n    color: red; }\n  @page {\n    .abc {\n      size: a3; } } }\n\n// Dart Sass\n@print {\n  .abc .random {\n    color: red;\n  }\n  @page {\n    .abc {\n      size: a3;\n    }\n  }\n}\n// LibSass\n@print {\n  .abc .random {\n    color: red; }\n  @page {\n    .abc {\n      size: a3; } } }\n``. If you think this behaviour is wrong please open an issue with Ruby Sass. https://github.com/sass/sass. @mgreter is correct. The short-hand signature forrgba` was not covered in #2244 by mistake. This is addressed in #2564. Yes. This function was the only one missed the first time around according\nto the reference implementations and sass-spec.\nOn 21 Feb. 2018 3:38 am, \"Marcel Greter\" notifications@github.com wrote:\n\nDid you check that the same issue is not present in hsla and/or similar\nfunctions?\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2564#issuecomment-367037571, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWPeV7hcuP9f3HXZVhdsH40S61-Hvks5tWvT4gaJpZM4SL4Uz\n.\n. This is fixed on master and will be the next stable release.. Thanks @chriscoyier. This is an issue with how we validate @else blocks. . Yep that's pretty much how it goes. Luckily I'm the maintainer of node-sass also so the turn around is pretty fast once we make a LibSass release.. Thanks for supporting LibSass :). My bad, thanks. Sass will not add media type for you. Without a type the CSS is invalid and result in a parser error. See dart-sass\n\nError: expected \"{\".\n  @media not (pointer: fine) {\n             ^\n  test.scss 2:14  root stylesheet. @nex3 may some thoughts on this?. I'm pretty sure this is same root cause as #2580.\nI randomly get either of these errors with this reproduction.. Reverting #2550 and #2563 appears to resolve this issue. Bed time for me now.. Pretty sure this is a duplicate of #2579.. The provided code produces no output. How are you calling the mixin?. I can confirm this error is correct. \nThe code in that project is invalid and should never have worked.\nIt worked due a bug that has since been fixed.\nPlease see this blog post for why this isn't a breaking a change.. Maybe you can check whether & is empty.\n```\n.is-focused { ... }\n@if length(&) {\n  &.is-focused { ... }\n}\n```. I can't reproduce this with Futura or node-sass@4.8.1. Are you sure this what's happening?\n$ node-sass --version\nnode-sass   4.8.1   (Wrapper)   [JavaScript]\nlibsass     3.5.0   (Sass Compiler) [C/C++]\n$ echo '.foo { font-size: 1 + 0em; }' | ./bin/node-sass -s\n.foo {\n  font-size: 1em; }. This appears to a bug. Likely related to recent number math changes. Thanks for the report.. The code supplied isn't valid. It only worked because of a bug in LibSass,\nso we don't consider this a semver issue.\nYou can read more in\nhttps://medium.com/@xzyfer/why-node-sass-broke-your-code-and-semver-1b3e409c57b9\nTo accomplish what you want you can interpolate the variable using #{}.\nOn 14 Mar. 2018 7:47 am, \"Marcel Greter\" notifications@github.com wrote:\n\nSort answer: no, not really => sass/sass#1422 (comment)\nhttps://github.com/sass/sass/issues/1422#issuecomment-54389407\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2585#issuecomment-372812897, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWNqdk6_ZS5SYRXRiPYLyprDQC8kIks5teDBfgaJpZM4SpEMa\n.\n. The gulp sass issue is interesting. Suggests an issue with the format of\nthe path maybe.\n\nStill requires some digging on my end. Just wanted to flag it because there\nhave multiple reports for latest node sass beta.\nOn 14 Mar. 2018 9:09 am, \"Marcel Greter\" notifications@github.com wrote:\n\nnode_modules.bin\\node-sass index.scss --include-path include works too??\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2588#issuecomment-372835780, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWIBo5iavqsq7nBGHcox7jJMMV0ufks5teEOMgaJpZM4SpglI\n.\n. Not sure if this information makes any difference.\nhttps://github.com/dlmanning/gulp-sass/issues/668#issuecomment-372963863. @mgreter if you could compose a tweet about what exactly you'd like help, or reference to, with the relevant information, then I can try to get some folks to boost the signal.. @am11 is my Goto windows expert. Maybe he can shed some light?\n\nOn 14 Mar. 2018 2:04 pm, \"Marcel Greter\" notifications@github.com wrote:\n\nAfter some more API doc reading and try and error I figured out, that\ncontrary to the MSDN docs some functions do support dot and dotdot\nreferences in UNC paths, namely GetFullPathNameW. There are many open\nquestionmarks on my side, e.g. thread safety, why don't they just allow it\nwith CreateFileW or GetFileAttributesW, how does it handle symbolic links\nin the path ...\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2589#issuecomment-372889465, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWC_8OQZ5sigrY2SWgzmI1Z5R9e-Tks5teIijgaJpZM4SprEQ\n.\n. The documentation suggest GetFullPathName might not be thread-safe\nNote  The GetFullPathName function is not recommended for multithreaded applications or shared library code. For more information, see the Remarks section.\n\n1: https://msdn.microsoft.com/en-us/library/windows/desktop/aa364963(v=vs.85).aspx. I stumbled across this which looked promising.\nhttp://pdh11.blogspot.com.au/2009/05/pathcanonicalize-versus-what-it-says-on.html\nNote: looks like it uses GetFullPathNameW.. Had a quick look at the boost absolute implementation and it appears to use GetFullPathNameW in some places.. As @am11 says I'm happy to proceed with this approach and instruct folks to not use '.' or '..' if they run into issues.. I agree on all points :+1:. According to the spec, this is allowed\n\nNote: Custom properties can contain a trailing !important, but this is automatically removed from the property\u2019s value by the CSS parser, and makes the custom property \"important\" in the CSS cascade. In other words, the prohibition on top-level \"!\" characters does not prevent !important from being used, as the !important is removed before syntax checking happens.\n\nThis is a bug in all the Sass implementations.. I filed an issue with the reference implementation https://github.com/sass/dart-sass/issues/260. This has been fixed in ruby sass and dart sass. Spec added https://github.com/sass/sass-spec/pull/1236. TIL Nim. Thanks!. No particular objects from me. I only ask we hold of merging significant changes like this until we have a stable 3.5.x for node-sass. We've only release 3.5.x to small fraction of the node-sass ecosystem as we work out any bugs/regressions.. May be Node Sass specific. This appears to be Node specific.. Which integration are you using? LibSass has no watcher\nOn 17 Mar. 2018 11:23 pm, \"Demo\" notifications@github.com wrote:\n\nWhen watching for changes, I get reports such as below. I'm missing some\ntime indications preferably on each action and down to seconds. The lack of\nthese forces me sometimes do some \"test changes\" to check sass is still\nwatching and updating as expected.\nSass is watching for changes. Press Ctrl-C to stop.\nwrite ../www/css/controls/myStyle.css [time?]\nwrite ../www/css/controls/myStyle.css.map [time?]\nChange detected to: style.scss\nwrite ../www/css/myOtherStyle.css [time?]\nwrite ../www/css/myOtherStyle.css.map [time?]\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2598, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWPq-DZex5B8i7tr0de5yoa6nCmouks5tfQBGgaJpZM4SuyKW\n.\n. Back ported to 3.5-stable. Back ported to 3.5-stable. Back ported to 3.5-stable. cc @nex3, your thoughts?\n\nOn Fri., 23 Mar. 2018, 1:14 am Brian Bolton, notifications@github.com\nwrote:\n\nGiven that, could the error output actually give a useful message there?\nOr at least a hint \"arithmetic does not work on interpolated strings\"\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2605#issuecomment-375321032, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWOvM5G8mEO14uJizUzFjcP2aDejsks5tg7HAgaJpZM4SwiKt\n.\n. Back ported to 3.5-stable. Back ported to 3.5-stable. Back ported to 3.5-stable. This has been a long running issue, and one of the biggest node sass pain points. Thean was to removed this feature/bug with the module system landed to reduce disruption.\n\nSee #754\nSee #1656\nSee #1963. PR to add a deprecation warning #2613. It was a bug not a feature. If you want to do this your code will not be\nportable. If you use sassc you can use the new import extensions flag. That\nfeature will be supported in node-sass ever.. alternatively you can use a\ncustom importer.\nOn Sun., 29 Apr. 2018, 12:51 am Tony Narlock, notifications@github.com\nwrote:\n\nI recommend adding a deprecation warning for this as soon as possible,\npossibly along with a link to an example importer that will import .css\nfiles for users for whom migrating will be difficult.\nPlease provide some examples of how to handle importing raw CSS files from\nthird party libraries. This would break a lot of behavior for me. It was an\nimportant feature.\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2611#issuecomment-385181590, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWDIN8n7yL1GeSr0DF45fHutYZmTrks5ttIHUgaJpZM4S5TFB\n.\n. See my previous comment. Thanks for this. Please maintain the alphabetic order.. I've cancelled the builds. Don't be alarmed.. Please do\n\nOn Sat., 24 Mar. 2018, 11:38 am Jakub Fija\u0142kowski, notifications@github.com\nwrote:\n\nShould I also move Java and JavaScript headings up in the list?\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2612#issuecomment-375832619, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWPz8dk3rZYLK6awBkR627WD4iaKSks5thZWGgaJpZM4S5h2B\n.\n. Thanks!. @nex3 feel free to word smith the deprecation warning. \n\nLinking to a specific custom importer implementation/documentation is tricky because LibSass is mostly used embedded into other projects.. Back ported to 3.5-stable. Rebased this off of master since it only belongs in 3.5.\nThe deprecated raw css imports are being removed in 3.6. See #2615.. >There needs to be something somewhere that tells you what to do about this warning\nThe resolution is to stop importing .css files. This is a non-standard feature that goes against the Sass language spec.\n\nThere appears to be zero documentation about sass_option_push_import_extension anywhere\n\nIt's a temporary work around in the C API for integrators. It's use is highly discouraged! It is only offered a temporary polyfill to enable  each implementation to migrate their users off of the invalid behaviour\n. Your output shows 3.3.6 not 3.6.\nOn Mon., 26 Mar. 2018, 5:40 am Walter Rodrigo de S\u00e1 Cruz, \nnotifications@github.com wrote:\n\nI've the following syntax on my scss:\nbody{\ndisplay: grid;\ngrid-template-columns:\n[full-start] minmax(1em, 1fr)\n[main-start] minmax(0, 75rem) [main-end]\nminmax(1em, 1fr) [full-end];\n}\nthis works with libsass 3.5, but not libsass 3.6.\nIf I put everything on a single line\ngrid-template-columns: \"[full-start] minmax(1em, 1fr) [main-start]\nminmax(0, 75rem) [main-end] minmax(1em, 1fr) [full-end]\";\nI got rid of the failure, but the css is invalid on the browser. \"Invalid\nproperty value\" on chrome.\nsass.compiler.info:\n'node-sass\\t3.13.1\\t(Wrapper)\\t[JavaScript]\\nlibsass \\t3.3.6\\t(Sass\nCompiler)\\t[C/C++]\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2616, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWOuQKBZ2JYg2euk1LhzI6wDMMVMMks5th-S7gaJpZM4S6QEs\n.\n. Please try the latest version of LibSass 3.5.2 available in node-sass 4.8.3\n\nOn Tue., 27 Mar. 2018, 7:21 am Chance Strickland, notifications@github.com\nwrote:\n\nLooks a lot like #2312 https://github.com/sass/libsass/issues/2312,\nperhaps not completely resolved. Also seen in #2515\nhttps://github.com/sass/libsass/issues/2515\ninput.scss\n// Top content boxes.@mixin top-content {\n  background-color: $dark-blue;\n  color: #fff;\n  padding: 15px;\n  border-radius: 4px;\n&__container { // This is the error line\n  @include squeeze;\n\n}\n}\nActual results\n/Users/cs/Desktop/local/pya/app/public/wp-content/themes/pyapc/node_modules/webpack-sources/node_modules/source-map/lib/source-map-generator.js:298\n      throw new Error('Invalid mapping: ' + JSON.stringify({\n      ^\nError: Invalid mapping: {\"generated\":{\"line\":11932,\"column\":2},\"source\":\"/Users/cs/Desktop/local/pya/app/public/wp-content/themes/pyapc/assets/scss/assets/scss/global/_mixins.scss\",\"original\":{\"line\":383,\"column\":-1},\"name\":null}\n    at SourceMapGenerator_validateMapping [as _validateMapping] (/Users/cs/Desktop/local/pya/app/public/wp-content/themes/pyapc/node_modules/webpack-sources/node_modules/source-map/lib/source-map-generator.js:298:13)\nExpected result\nruby sass 3.X.y\n.top-content {\n  ...\n}.top-content__container {\n  ...\n}\nhttp://libsass.ocbnet.ch/srcmap/#QG1peGluIHNxdWVlemUgewoKCUBtZWRpYSBzY3JlZW4gYW5kICggbWF4LXdpZHRoOiAxMjMwcHggKSB7CgkJcGFkZGluZy1sZWZ0OiA2MHB4OwoJCXBhZGRpbmctcmlnaHQ6IDYwcHg7Cgl9Cn0KCkBtaXhpbiB0b3AtY29udGVudCB7CgliYWNrZ3JvdW5kLWNvbG9yOiAjZWZlZmVmOwoJY29sb3I6ICNmZmY7CglwYWRkaW5nOiAxNXB4OwoJYm9yZGVyLXJhZGl1czogNHB4OwoKCSZfX2NvbnRhaW5lciB7CgoJCUBpbmNsdWRlIHNxdWVlemU7Cgl9Cn0KCi50b3AtY29udGVudCB7CgkKCUBpbmNsdWRlIHRvcC1jb250ZW50Owp9\nversion info:\nnode            9.6.1\nnode-sass       4.7.2\nlibsass         3.5.0.beta.2\nOn Mac HS 10.13.3\nRepo for testing can be found here:\nhttps://github.com/chancestrickland/pyapc (other Webpack/Node errors\nlikely exist, but hung up on this one at the moment)\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2617, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWCZ5UQvwM2YzxqxmZUC4dcUPYyfoks5tiU3CgaJpZM4S72HS\n.\n. Is this enough? The out_of_memory macro defined in util.cpp is under the Sass namespace. I'm ok with inlininh, or even just renaming the Sass namespaced version.\n\nOn Wed., 28 Mar. 2018, 5:45 am Andrew Stone, notifications@github.com\nwrote:\n\nIt looks like the file came from json.c\nhttps://github.com/rustyrussell/ccan/blob/master/ccan/json/json.c,\nwhich, as @nschonni https://github.com/nschonni noted, hasn't been\nupdated since 2011.\nApart from the usage in json.cpp, out_of_memory is only used once, so it\nmight be better just inline it. Thoughts?\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2619#issuecomment-376633054, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWMvJLbtKFbFIYlJqiXO1N2hTJKImks5tiojXgaJpZM4S8FZZ\n.\n. Thanks. The current behaviour is correct. Sass is not allowed to evaluate the values of custom properties. The one exception is string interpolation.\n\nscss\n:root {\n  --TEST: #{$theme-primary};\n}. Run npm ls node-sass to make sure you don't have multiple versions on node-sass in play.. This is intended.. Please read the context before stating what is and isn't reasonable. https://github.com/sass/sass/issues/1128\nAdditionally see why this wasn't explicitly mentioned in releases notes. https://medium.com/@xzyfer/why-node-sass-broke-your-code-and-semver-1b3e409c57b9. We can agree to disagree about the validity of the argument. It's frankly\nimpossible for us to account for every invalid syntax or usage. As such\nit's impossible for us to know which of these may break as bugs are fixed.\nThis is no different to relying on undocumented APIs. I'm sorry this has\naffected you adversely, but there is nothing we can do to prevent this type\nof breakage in the future. We will continue to do beta releases that will\ngive you time to catch these types of breakages.\nOn Wed., 28 Mar. 2018, 10:28 am bsmith-cycorp, notifications@github.com\nwrote:\n\nMy dispute wasn't with the syntax itself (lord knows I'm not qualified to\ncomment on that), but with the communication of it. It sounds, however,\nlike the libsass team has their hands tied given the fact that Ruby sass is\nstill considered the canonical reference, which I wasn't aware of.\nI guess the real underlying issue is that CSS custom properties are\nmentioned nowhere in http://sass-lang.com/documentation at all, as far as\nI can tell - neither the supported nor the unsupported version of the\nsyntax - even though support for them has been officially added to the\ncompiler itself. This leads one to assume - in the absence of a special\nexplanation - that the syntax is the same as for other CSS properties\n(again, I'm not arguing that requiring #{ } is unreasonable, only that\nit's reasonable to assume it isn't required, lacking documentation to the\ncontrary).\nI don't know how the relationship between the libsass and sass teams\naffects the ability to update documentation, but I think we can agree the\ndocumentation needs to reflect this API, otherwise\nRelying on bugs is no different to relying on an undocumented API and\nviolates your contract with us.\nisn't a valid argument.\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2621#issuecomment-376708552, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWHobFdmc7H5MBeGgJPqG3Fq6Ls78ks5tissJgaJpZM4S9w7_\n.\n. As for the documentation I can commit speak towards that. It is owned by\nthe official Sass project http://github.com/sass/sass.\n\nI agree this behaviour should be documented and more easily discoverable.\nPlease raise an issue with them. As for now I believe these changes are\ndocumented in the official Sass release notes.\nOn Wed., 28 Mar. 2018, 10:42 am Michael Mifsud, xzyfer@gmail.com wrote:\n\nWe can agree to disagree about the validity of the argument. It's frankly\nimpossible for us to account for every invalid syntax or usage. As such\nit's impossible for us to know which of these may break as bugs are fixed.\nThis is no different to relying on undocumented APIs. I'm sorry this has\naffected you adversely, but there is nothing we can do to prevent this type\nof breakage in the future. We will continue to do beta releases that will\ngive you time to catch these types of breakages.\nOn Wed., 28 Mar. 2018, 10:28 am bsmith-cycorp, notifications@github.com\nwrote:\n\nMy dispute wasn't with the syntax itself (lord knows I'm not qualified to\ncomment on that), but with the communication of it. It sounds, however,\nlike the libsass team has their hands tied given the fact that Ruby sass is\nstill considered the canonical reference, which I wasn't aware of.\nI guess the real underlying issue is that CSS custom properties are\nmentioned nowhere in http://sass-lang.com/documentation at all, as far\nas I can tell - neither the supported nor the unsupported version of the\nsyntax - even though support for them has been officially added to the\ncompiler itself. This leads one to assume - in the absence of a special\nexplanation - that the syntax is the same as for other CSS properties\n(again, I'm not arguing that requiring #{ } is unreasonable, only that\nit's reasonable to assume it isn't required, lacking documentation to the\ncontrary).\nI don't know how the relationship between the libsass and sass teams\naffects the ability to update documentation, but I think we can agree the\ndocumentation needs to reflect this API, otherwise\nRelying on bugs is no different to relying on an undocumented API and\nviolates your contract with us.\nisn't a valid argument.\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2621#issuecomment-376708552, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWHobFdmc7H5MBeGgJPqG3Fq6Ls78ks5tissJgaJpZM4S9w7_\n.\n\n\n. scss\n:root {\n  --primary-color: #{$primary-color};\n}. Travis OSX boxes are backed up. Cancelled the build once it passed on Travis linux.. After further clarifying the scope of the change, and the associated browser compat breakage we've decided to back port this to 3.5.. It looks like SharpScss as well as the existing .Net implementations have been dead for a while. Please remove SharpScss, and as a bonus please remove all .Net implementations besides LibSassHost.. Thanks for this. I'll prune the abandoned projects separately.. My gut reaction is that this is not valid CSS syntax. If this word\npreviously it may have been a bug that was patched. I'll confirm when I'm\nat a keyboard.\n\nOn Thu., 29 Mar. 2018, 9:32 pm James Wilson, notifications@github.com\nwrote:\n\nUsing libsass 3.5.2 (via node-sass 4.8.3), The following leads to an error:\n$ echo -e 'something\\:{ padding: 2px; }' | ./node-sass\n{\n  \"status\": 1,\n  \"file\": \"stdin\",\n  \"line\": 1,\n  \"column\": 1,\n  \"message\": \"Invalid CSS after \\\"s\\\": expected 1 selector or at-rule, was \\\"something\\\\:{ paddin\\\"\",\n  \"formatted\": \"Error: Invalid CSS after \\\"s\\\": expected 1 selector or at-rule, was \\\"something\\\\:{ paddin\\\"\\n        on line 1 of stdin\\n>> something\\:{ padding: 2px; }\\n\\n   ^\\n\"\n}\nAdding a space between the colon and opening curly bracket works, eg:\n$ echo -e 'something\\: { padding: 2px; }' | ./node-sass\nsomething\\: {\n  padding: 2px; }\nThis is a regression, and does not appear to be a problem using libsass\n3.5.0.beta.2 (via node-sass 4.5.3).\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2625, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWDVQLATnJQEr_2uRmWrpa_dXTBJ6ks5tjLhKgaJpZM4TAHEw\n.\n. Confirmed this is a regression in 3.5.0.\n. --color: #{rgba($color, .2)};. This is not a bug, it's how it must be. SassScript cannot be used within custom properties. But Sass makes an exception if it sees an interpolation.. This is the intended behaviour. Sass will ignore the value of a custom\nproperty, except for interpolations.\n\nOn Tue., 17 Apr. 2018, 8:13 pm Giacomo Zinetti, notifications@github.com\nwrote:\n\nIt seems that the compiler is not working correctly when assigning a scss\nvariable to a css custom props.\nWith string interpolation on property name or around scss variable it\nworks as expected.\nI have found the regression passing from node-sass 4.7.2 to node-sass\n4.8.1\ninput.scss\ntest {\n  $test: red;\nbackground: $test;\n  --background: $test;\n  --background: #{$test};\n  #{'--background'}: $test;\n}\nActual results\nlibsass 3.5.0\nhttp://libsass.ocbnet.ch/srcmap/#LmhlYWRlciB7CiAgJHRlc3Q6IHJlZDsKCiAgYmFja2dyb3VuZDogJHRlc3Q7CiAgLS1iYWNrZ3JvdW5kOiAkdGVzdDsKICAtLWJhY2tncm91bmQ6ICN7JHRlc3R9OwogICN7Jy0tYmFja2dyb3VuZCd9OiAkdGVzdDsKfQoK\nnode-sass 4.8.1   (Wrapper)   [JavaScript]\nlibsass   3.5.0   (Sass Compiler) [C/C++]\n.header {\n  background: red;\n  --background: $test;\n  --background: red;\n  --background: red; }\nExpected result\nnode-sass 4.7.2   (Wrapper)   [JavaScript]\nlibsass   3.5.0.beta.2    (Sass Compiler) [C/C++]\n.header {\n  background: red;\n  --background: red;\n  --background: red;\n  --background: red; }\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2635, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWAAY1NRBmsFnQPfgcqBQwPwHFp4vks5tpcA5gaJpZM4TYBHe\n.\n. Sorry this was an unintended breaking change for this patch release. \n\nMy preference is to roll forward with change and update the release notes.\nYou'll need to use the sass_option_push_import_extension API to re-enable .css imports as I see you've done in https://github.com/sass/libsass-python/pull/246. \nNote: doing so will result in deprecation warning for .css files. The deprecation warning will be removed in 3.6.0.. Apologies for not being clear. The release notes have since been updated to hopefully be more clear.\n\nI don't use ruby, I'm not going to and I couldn't care less what it does and doesn't do\n\nFirstly this isn't us vs Ruby. Sass is a language with a specification like any other. The Ruby implementation is the source of truth for the Sass language specification.\nRaw CSS imports is a feature that violates the Sass language spec, and should never have been in LibSass. It must be removed.\n\nSince people have become so dependant on it we need to remove it in a responsible way.\nAs such we're making it an opt-in behaviour via sass_option_push_import_extension. This API is not going away until there is a Sass language compliant way to do this. Such a feature is planned for the 4.0 modules system.\nThe deprecation warning was added in 3.5.x because there aren't sufficient hooks in LibSass for an implementor to performantly produces the correct deprecation warning. It is the deprecation warning that will be removed in 3.6. \nThis is where we would expect implementors to bump their majors should the desire to maintain spec compliance.\n. cc @mgreter\nOn Wed., 25 Apr. 2018, 12:35 pm Nick Schonning, notifications@github.com\nwrote:\n\nLooks like it may be related to the sass2scss bump in ca89d73\nhttps://github.com/sass/libsass/commit/ca89d73e84616a87e64febb93afaa0bd70ef181d\nNot sure, just looked through the 3.5.2 to 3.5.3 diff and it seems to be\nthe only thing related.\nAppears only to be an indented syntax issue\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2637#issuecomment-384142621, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWOZ7b4Y0Ukb6k8pPZ9slp__U_2Uaks5tr-D4gaJpZM4TiLB3\n.\n. As a work around I've released 3.5.4 which the sass2scss bump reverted since we need to get the node-sass release out.. This appears to be related to https://github.com/sass/libsass/issues/2637. As a work around I've released 3.5.4 which the sass2scss bump reverted since we need to get the node-sass release out.. Appveyor failures are just the proxy playing up.. Spec added https://github.com/sass/sass-spec/pull/1314. Test pass!. Please search issues before opening a new one.\n\ncolor: #{$red}\nOn Fri., 27 Apr. 2018, 6:36 pm MichalErlebach, notifications@github.com\nwrote:\n\nSee this example:\ninput.scss\ndiv {\n  $VAR: red;\n  --color: $VAR;\n  color: $VAR;\n}\nActual results\nlibsass 3.5.3\nhttp://libsass.ocbnet.ch/srcmap/#ZGl2IHsKICAkVkFSOiByZWQ7CiAgLS1jb2xvcjogJFZBUjsKICBjb2xvcjogJFZBUjsKfQ==\ndiv {\n  --color: $VAR;\n  color: red;\n}\nExpected result\nruby sass 3.4.25\ndiv {\n  --color: red;\n  color: red;\n}\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2641, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWHL31i5oKh6XKd7ZcGTa24qzo6ntks5tstiTgaJpZM4Tp_C-\n.\n. Thanks for the report. I'm on vacation. I'll take a look when I'm back.\n\nOn Sun., 27 May 2018, 10:46 am carnil, notifications@github.com wrote:\n\nThis issue was assigned CVE-2018-11499\nhttps://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-11499\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2643#issuecomment-392315565, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWMaSnz6qhhUgzw76FHVKJ5-4l1FTks5t2mfmgaJpZM4TurzO\n.\n. Thanks for the report. \nWe confirmed this issue shares a common root cause to other reported issues.\nWe have assigned the selector-validation to the affected issues.. Thanks!. The correct way to do this is to interpolate the whole equation.\n\nOn Wed., 9 May 2018, 2:41 pm Han van Venrooij, notifications@github.com\nwrote:\n\n@marvinhuebner https://github.com/marvinhuebner, I'm not a sass expert,\nbut I''m not sure why you're using interpolation here. That's the thing\nthat breaks the number arithmetic.\nFor what it's worth... I get the same output when using Ruby sass.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2647#issuecomment-387725245, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWMipr3nLO24rlu2AsRiA3BtvO_wHks5twuPcgaJpZM4T32ED\n.\n. If it worked before it was a bug that has since been patched. Small patches\nto behaviours can have wide ranging effects. The patch for this would have\nshown up in release notes as fixed to delayed value evaluation.\n\nOn Sat., 12 May 2018, 10:12 pm Marvin H\u00fcbner, notifications@github.com\nwrote:\n\nIf i wrote this by myself i could easily change that, but we're including\na bunch of scss from a third party package in some of our client projects.\nIt worked out really well, till i upgraded our build stack to use the\nlatest versions and node-sass@4.9.0 which depends on libsass 3.5.4.\nI'm just wondering why this has worked before?\nFor know i downgraded back to node-sass@4.7 and will get in contact with\nthe company which develops the third party package.\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2647#issuecomment-388580005, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWGKX6d2f3nVL-bICiSKT6tIbSSFMks5tx0I9gaJpZM4T32ED\n.\n. I suggest submitting a paper or issue the offending library.\n\nOn Sat., 12 May 2018, 10:21 pm Michael Mifsud, xzyfer@gmail.com wrote:\n\nIf it worked before it was a bug that has since been patched. Small\npatches to behaviours can have wide ranging effects. The patch for this\nwould have shown up in release notes as fixed to delayed value evaluation.\nOn Sat., 12 May 2018, 10:12 pm Marvin H\u00fcbner, notifications@github.com\nwrote:\n\nIf i wrote this by myself i could easily change that, but we're including\na bunch of scss from a third party package in some of our client projects.\nIt worked out really well, till i upgraded our build stack to use the\nlatest versions and node-sass@4.9.0 which depends on libsass 3.5.4.\nI'm just wondering why this has worked before?\nFor know i downgraded back to node-sass@4.7 and will get in contact with\nthe company which develops the third party package.\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2647#issuecomment-388580005, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWGKX6d2f3nVL-bICiSKT6tIbSSFMks5tx0I9gaJpZM4T32ED\n.\n\n\n. Thanks. Indented syntax is parsed by mgreter/sass2scss. Please file issues against\nthat repository.\n\nOn Thu., 24 May 2018, 11:18 pm Natalie Weizenbaum, notifications@github.com\nwrote:\n\nLibSass currently seems to allow semicolons at the end of the line in the\nindented syntax. This doesn't match the behavior of Ruby Sass or Dart Sass,\nboth of which consider semicolons unknown characters in the indented\nsyntax. Support for semicolons should be deprecated and eventually removed.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2652, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWG-KS_5COEfCIiaGug1coicpEvQ4ks5t1yONgaJpZM4UNAz7\n.\n. Thanks @HongxuChen. \nI've confirmed the issue with test_s102.txt. \nA fix has been provided in #2675.. Thanks for the report. \nWe confirmed this issue shares a common root cause to other reported issues.\nWe have assigned the selector-validation to the affected issues.. Thanks @glen-mac .\nI've confirmed the issue with test_s102.txt.\nA fix has been provided in #2676.. Thanks @glen-mac .\nI've confirmed the issue with test_s102.txt.\nA fix has been provided in #2677.. Thanks for the report. \nWe confirmed this issue shares a common root cause to other reported issues.\nWe have assigned the selector-validation to the affected issues.. Fixed in 0bc35e3d26922229d5a3e3308860cf0fcee5d1cf.\n\nThanks.. Unable to reproduce this with the PoC files.\nTested against\n- libsass@60f83915\n- sassc@aa6d5c6\n- with -fsanitize=address -fno-omit-frame-pointer. Although I cannot reproduce I can see conceptually that this error is possible.\nPatched in #2687.\nThanks!. Thanks for the update. You are confusing release version (3.5.4) with ABI version (1:0:0). The\nlatter is what describes the stability of the C API.\nTo answer your question we are not in a position to guarantee the C API\nwill not change, but any change will be reflected in an ABI version change.\nOn Tue., 12 Jun. 2018, 10:56 am Adam Conway, notifications@github.com\nwrote:\n\nThe page at https://github.com/sass/libsass/blob/master/docs/build.md\nlists \"Building a system library\" as \"experimental\" it goes on to say:\nThis should work pretty well already, but we are not yet committed to keep\nthe ABI 100% stable. This should be the case once we increase the version\nnumber for the library to 1.0.0 or higher.\nThe linked page at\nhttps://github.com/sass/libsass/blob/master/docs/build-shared-library.md\nalso says:\nThis is currently in a experimental phase, as we currently do not really\nguarantee any ABI forward compatibility. The C API was rewritten to make\nthis possible in the future, but we want to wait some more time till we can\ncall this final and stable.\nHowever, the latest release is 3.5.4 which is way past 1.0.0! And many\nother plugins/applications include libsass as a library. is this still\nexperimental or are the docs just out of date?\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2673, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWKCxokTy-Wn0BoeyroH_aM6PBEyKks5t74I-gaJpZM4UkCOI\n.\n. For instance https://github.com/sass/libsass/commit/eb0c346c99\n\nOn Tue., 12 Jun. 2018, 2:52 pm Michael Mifsud, xzyfer@gmail.com wrote:\n\nYou are confusing release version (3.5.4) with ABI version (1:0:0). The\nlatter is what describes the stability of the C API.\nTo answer your question we are not in a position to guarantee the C API\nwill not change, but any change will be reflected in an ABI version change.\nOn Tue., 12 Jun. 2018, 10:56 am Adam Conway, notifications@github.com\nwrote:\n\nThe page at https://github.com/sass/libsass/blob/master/docs/build.md\nlists \"Building a system library\" as \"experimental\" it goes on to\nsay:\nThis should work pretty well already, but we are not yet committed to\nkeep the ABI 100% stable. This should be the case once we increase the\nversion number for the library to 1.0.0 or higher.\nThe linked page at\nhttps://github.com/sass/libsass/blob/master/docs/build-shared-library.md\nalso says:\nThis is currently in a experimental phase, as we currently do not really\nguarantee any ABI forward compatibility. The C API was rewritten to make\nthis possible in the future, but we want to wait some more time till we can\ncall this final and stable.\nHowever, the latest release is 3.5.4 which is way past 1.0.0! And many\nother plugins/applications include libsass as a library. is this still\nexperimental or are the docs just out of date?\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2673, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWKCxokTy-Wn0BoeyroH_aM6PBEyKks5t74I-gaJpZM4UkCOI\n.\n\n\n. Thanks. npm update node-sass@latest --save\n\nOn Fri., 29 Jun. 2018, 5:11 pm PoornimaMCA, notifications@github.com\nwrote:\n\ninput.scss\ntest {\n  content: bar\n}\nActual results\nlibsass 3.X.y\nhttp://libsass.ocbnet.ch/srcmap/#dGVzdCB7CiAgY29udGVudDogYmFyOyB9Cg==\ntest {\n  content: bar; }\nExpected result\nruby sass 3.X.y\ntest {\n  content: bar; }\nversion info:\n$ node-sass --version\nnode-sass       3.X.y   (Wrapper)       [JavaScript]\nlibsass         3.X.y   (Sass Compiler) [C/C++]\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2680, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWIpmMbJweS0EICYpu3X5vl8YNsfVks5uBdMlgaJpZM4U8i7T\n.\n. We are typically not involved or notified of filed CVEs. We link the closed issue in the release notes. So if the researcher attaches the CVE to the issue (which they typically don't) then you can know which CVEs were resolved.\n\nWe can try to be more explicit about it in release notes but if the CVEs aren't mentioned in the issue we simply don't know.. From my understanding of the feature, and the sass language spec LibSass is correct here.\nhttps://github.com/sass/sass-spec/tree/master/spec/css/custom_properties/script. @bep tagged 3.5.5. Thanks for the report. The behaviour as described does sound incorrect. I'll investigate this week and get back to you.. I recall there changes to UNC path handling not long ago. Possibly related\nOn Thu., 19 Jul. 2018, 9:07 am Nick Schonning, notifications@github.com\nwrote:\n\nHow are you running libsass? (Node, Python, Ruby, C ...)\nDo you get the same error using an include path rather than a direct UNC\npath in the @import?\nDo you have the same problem with .scss files? .sass files need to be\nconverted by sass2scss which may be another place the loading could have\nproblems.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2692#issuecomment-406101534, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWPqJ4z1Uv6NAdqcC3q4vmipAtznwks5uH7-4gaJpZM4VHvgB\n.\n. No release yet.\n\nOn Mon., 3 Dec. 2018, 9:18 am Adam Reis <notifications@github.com wrote:\n\n@glebm https://github.com/glebm What version of libsass did this fix\nend up in?\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2697#issuecomment-443547533, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWDnKPNqM6h2Ud4cFdZphcv8lsM-Nks5u1FGtgaJpZM4VcKvK\n.\n. No plans yet. We need to wait for the current churn to slow down so that we\ncan do QA. A release now could potentially introduce new regressions.\n\nOn Mon., 3 Dec. 2018, 9:30 am Adam Reis <notifications@github.com wrote:\n\nDo you have an estimate for when it might be released?\nWe are having issues installing our build tools on a windows computer\nbecause we're forced to use a lower version of node-sass which doesn't have\nthis bug. Would be great if we could upgrade the whole stack.\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2697#issuecomment-443548423, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWCfSVEk8jPePe0AYREaOWfcAEP0hks5u1FSdgaJpZM4VcKvK\n.\n. That API has since been removed from LibSass in favour of this feature. Once this lands .css will not be compiled as Sass files by design.. LibSass is an implementation of the Sass language specification. The\nspecification prevents the behaviour you desire. Please direct all language\nfeature request to https://github.com/sass/sass\n\nOn Thu., 26 Jul. 2018, 9:07 pm Elia Schito, notifications@github.com\nwrote:\n\nNOTE: I used Sass syntax only because I'm unsure what the correct syntax\nfor imports is in SCSS\nWe use base level parent selectors a lot in partials (see below for the\n\"how\"), but found it's no longer supported upgrading from\ngem 'sass', '~> 3.4.24'\ngem 'sassc', '~> 1.11.2'\nto the latest version, I didn't find any explicit mention of this in the\nchangelog, is this intentional?\nrelated: #2304 https://github.com/sass/libsass/issues/2304\nHow we use parent selectors in partials application.sass\nheader\n@import header\n_header.sass\n&\n  position: relative\nh1\n  color: green\nresulting in something like:\nheader { position: relative; }#header h1 { color: green; }\nThis technique allows to reuse partials and move them around very easily,\ne.g. let's say I need an additional wrapper between #header and its\ncontent I can just add a  to the HTML and change\napplication.sass to be\nheader .wrapper\n@import header\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2704, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWMT-mL1c30dvMW956q3e7adL5W7oks5uKaLegaJpZM4Vhn0g\n.\n. Rebuilding CI. Kicked off a rebuild. This project is not associated with sass middleware. Please redirect your question to the correct repository.. It may use LibSass but we are not involved\n\nOn Tue., 7 Aug. 2018, 9:57 pm maki-markie, notifications@github.com wrote:\n\nOh, sorry... is SassMiddleware not part of the libsass library?\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2709#issuecomment-411031307, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWDDGm0PfEwka3s1uaJDbfcR8PZIrks5uOYDAgaJpZM4VyA9W\n.\n. I think the behaviour is intended. Can you confirm by trying with dart-sass?\n\nOn Sat., 25 Aug. 2018, 6:20 am James Alexander Rosen, \nnotifications@github.com wrote:\n\nAdding some comments shows that the CSS is being emitted by the\nplaceholder both times and never by the actual CSS rule.\nInput\n/ a /%green { color: green; }/ b /%green { color: green; }/ c /.green { @extend %green; }/ d /\nActual Output\n/ a /.green {\n  color: green; }\n/ b /.green {\n  color: green; }\n/ c // d /\nExpected Output\n/ a // b // c /.green {\n  color: green; }/ d /\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2712#issuecomment-415871837, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWDGmIeLgXnGEQI1WHg6ylCvPfdfqks5uUGAFgaJpZM4WL7X9\n.\n. Closing this since the behaviour is by design.. Thanks for the feedback. You're correct about the behaviour.\n\nEducation/messaging is really out of our hands since we're just an\nimplementation. This is really valuable feedback for the sass/sass or\nsass/sass-site repo.\nOn Wed., 19 Sep. 2018, 5:19 pm Bryan Jones, notifications@github.com\nwrote:\n\nThe Precision option appears to be widely misunderstood. Compile this\nSass with node-sass 4.9.3 and pass --precision 2:\ninput.scss\nmyDiv {\nwidth: 1.234858939558593rem;\nheight: (5/3.452353536);\nmargin-top: 5.58585938428;\n\n}\nActual results\nlibsass 3.5.4\nhttp://libsass.ocbnet.ch/srcmap/#dGVzdCB7CiAgY29udGVudDogYmFyOyB9Cg==\nwidth: 1.234858939558593rem;\nheight: 1.45;\nmargin-top: 5.58585938428;\n\nExpected result\nI think(?) this IS the correct result\u2014the precision rule only applies\nto math operations; it won't round numbers that you explicitly write with\nmore than x digits of precision.\nHowever, I routinely get people who email me complaining that Sass is\nbroken because their numbers aren't rounded. I think that's partly a\nfailure of documentation. Here's node-sass's explanation of the option:\nUsed to determine how many digits after the decimal will be allowed.\nFor instance, if you had a decimal number of 1.23456789 and\na precision of 5, the result will be 1.23457 in the final CSS.\nThat explanation makes it sound like all three numbers in the above\nexample will be rounded. The over-arching option name --precision also\nmakes it seem like all decimal numbers will be rounded. A better name for\nthe option might be --math-precision. Alternately, an option could be\nintroduced to use --precision=math or --precision=all, with the regular\n--precision option defaulting to the former for backwards compatibility.\nAt any rate, based on the feedback I get, people think precision is broken.\nversion info:\n$ node-sass --version\nnode-sass       4.9.3   (Wrapper)       [JavaScript]\nlibsass         3.5.4   (Sass Compiler) [C/C++]\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2717, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWHvGviJrHIUz0U6ZdnE4LBgG8cgbks5ucfAUgaJpZM4Wvjve\n.\n. Node Sass is also powerless to do anything here.\n\nOn Wed., 19 Sep. 2018, 5:28 pm Bryan Jones, notifications@github.com\nwrote:\n\nSure thing. I can open it on node-sass as well, but I thought I'd file an\nissue here to discuss the possibility of adding a --precision=all option\nthat does what these people want.\nIs that a feature that's worthwhile?\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2717#issuecomment-422688968, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWIKLqldXg6UGgdm1iizN1UUGlhfCks5ucfIngaJpZM4Wvjve\n.\n. Kicked off a new appveyor build. I'm heading to sleep now (Australian time) and will check back in tomorrow.. Catching up. Either approach seems reasonable to me. Is there consensus on which we should go with?. I'm not informed enough to make a call either way. Much of this either\npredates me or was driven by contributors that have since moved on.\n\nI'm open to informed recommendations.\nOn Tue., 13 Nov. 2018, 10:51 pm Gleb Mazovetskiy <notifications@github.com\nwrote:\n\nThe Makefile is provided so that it can be built without autotools. This\nis useful when this library is built for a C extension for Python or Ruby,\nwhere autotools is not a requirement of the build environment.\nAnyway, compiling a small C program is probably (just) more reliable than\ntrying to parse compiler output.\nIt's also fast (30ms compile+run), so I'd prefer we do that instead of\nparsing the compiler output.\nAlthough I wonder if it might be better to take the simpler option of just\nremoving the problematic flags entirely and avoiding the whole problem\u2026\nYeah, how useful are these flags?\nAnyway, up to mgreter@ and xzyfer@ now\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2720#issuecomment-438239392, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWOiUXetXj7eudUfgA3GbUaRRS3hcks5uurIxgaJpZM4W27Rl\n.\n. I'm fine with removing these flags.\n. Apologies GitHub's UI doesn't make it clear. We're still able to do the\nmerge for cases like this when we know there are no conflicts.\n\nOn Thu., 15 Nov. 2018, 1:48 am Alyssa Ross <notifications@github.com wrote:\n\nSide note: I keep having to rebase this PR so it can be merged, because a\nnew commit has been added to master, even though there aren't any conflicts\nor anything. Maybe have a think about whether that needs to be a hard \"no\"?\nIME it often doesn't, and in this sort of case where the change is very\nunlikely to conflict with anything else it gets annoying fast.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2720#issuecomment-438687175, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWH5lbjddFHGP6yl5BfK16jTtLe5Eks5uvC09gaJpZM4W27Rl\n.\n. Thanks for all your patience. Hopefully within a week or so. We've been cutting releases from a feature\nbranch for over a year so there is some QA needed as we migrate back to\ncutting releases from master.\n\nOn Thu., 15 Nov. 2018, 8:16 pm Alyssa Ross <notifications@github.com wrote:\n\nWonderful, thank you! Do you have any plans for a release?\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2720#issuecomment-438971494, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWEcSXw_mcp3q0Bfqnx-RcTOgXDtqks5uvTDwgaJpZM4W27Rl\n.\n. Using mkdir has come up multiple times and been rejected because it is not\nportable. We're open to solution that are portable.\n\nOn Mon., 12 Nov. 2018, 6:55 pm Stephan Beal <notifications@github.com wrote:\n\ninstall fails because $(PREFIX)/lib already exists\n[stephan@host:~/cvs/libsass]$ m install PREFIX=$HOME\nmkdir /home/stephan/lib\nmkdir: cannot create directory \u2018/home/stephan/lib\u2019: File exists\nMakefile:263: recipe for target '/home/stephan/lib' failed\nmake: *** [/home/stephan/lib] Error 1\nThe fix is trivial: use mkdir -p instead of mkdir.\nThis is the same as #1992 https://github.com/sass/libsass/issues/1992,\nbut that ticket is inexplicably closed.\nPS: when trying to use the autotools-generated build, by running autoconf\nto convert configure.ac to configure, the resulting ./configure fails\nbecause:\n[stephan@host:~/cvs/libsass]$ ./configure --prefix=$HOME\nconfigure: error: cannot find install-sh, install.sh, or shtool in script \".\"/script\nThus i'm using the makefile which is checked in to the tree, rather than\nthe one generated by autotools (a.k.a. GNU \"Auto, my ass!\" Tools).\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2727, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWC46FJREYZk3iPIdWpGiuKuKlkJ4ks5uuSlkgaJpZM4YZIEz\n.\n. Everything has been explained in detail multiple times in all the previous\nclosed issues. We'll consider a pr that address the concerns that have\npreviously been raised.\n\nOn Mon., 12 Nov. 2018, 8:13 pm Stephan Beal <notifications@github.com wrote:\n\nApropos portability: the source code uses C++0x, which means it's\ncompiling on a relatively recent platform (less than 10 years old). i'd bet\nmy left testicle that all such platforms support mkdir -p.\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2727#issuecomment-437808279, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWDztL9XVhyClKwxTr7QVoEu2Oie3ks5uuTvQgaJpZM4YZIEz\n.\n. Plenty details below. I'm not well versed on the problem but I've seen it come up over and over again.\n\nhttps://github.com/sass/libsass/pull/795#discussion_r22396485\nhttps://github.com/sass/libsass/pull/2486\nhttps://github.com/sass/libsass/pull/2109\nhttps://github.com/sass/libsass/issues/1433\nhttps://github.com/sass/libsass/pull/1365#issuecomment-123325642\n. Thank you all for seeing this through :heart:. Thanks again. Thanks!. Thanks! <3. Thanks!. I've confirmed this addresses the reported issue and passes all other tests. I've attached the spec metadata to the PR and kicked off a CI build to confirm.. This was originally reported as a regression however I couldn't find a point in the last 2 years where this behaviour worked correctly.\nThe changes seem reasonable enough to progress. Thanks again!. Added tests, test metadata, and kicked off CI. I agree the final result is preferable.. This needs to be rebased on master.. I'm heading to bed for the night. Looks like a previous change is causing\nCI to fail after landing of master. It's causing all subsequent PRs to\nfail. I'll try to investigate further tomorrow unless you beat me to it.\nOn Mon., 19 Nov. 2018, 9:28 pm Gleb Mazovetskiy <notifications@github.com\nwrote:\n\nDone\n\u2014\nYou are receiving this because your review was requested.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2738#issuecomment-439844968, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWAJK8OeH3mYBD2ZdjQo9dWUq2o9dks5uwoe8gaJpZM4Yn-Mf\n.\n. Yes however that change is intended. This suggests something troublesome\nwas introduced in the small window where the configuration was incorrect,\nbetween d09d09d9 and ab03dc00. The obvious candidate appears to be d225a09a.\n\nOn Tue., 20 Nov. 2018, 5:40 am Gleb Mazovetskiy <notifications@github.com\nwrote:\n\n@xzyfer https://github.com/xzyfer The first failing commit seems to be\nthis one:\nd09d09d\nhttps://github.com/sass/libsass/commit/d09d09d9607d7593b92ba5daf3d8d947a4267f6b\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2738#issuecomment-439997839, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWDkpFLryOmHgRoYfHFCH2V7ml8Tuks5uwvsCgaJpZM4Yn-Mf\n.\n. Sorry I'm not following why your finding explain why master only began failing recently.\nMaybe not that small, it fails on d09d09d as well.\n\nThe change in d09d09d essentially reverts ab03dc0. This why I suggested the issue crept in between those two commits - making d225a09a obvious candidate.\nIt's worth noting that all following PRs to address leaks continue to fail in the same \n- #2738 (https://travis-ci.org/sass/libsass/jobs/456898779)\n- #2739 (https://travis-ci.org/sass/libsass/jobs/456900757)\n- #2742 (https://travis-ci.org/sass/libsass/jobs/457121156)\n- #2744 (https://travis-ci.org/sass/libsass/jobs/457211061)\n- #2745 (https://travis-ci.org/sass/libsass/jobs/457215304)\n- #2747 (https://travis-ci.org/sass/libsass/jobs/457376054)\nThis suggest to me that the problem is more recent. I'm started debugging this by branching from f477cd6c and replaying the subsequent commits except my changes to .travis.yml.\n. >The first failing commit seems to be the one that disables coverage for clang: d09d09d\nAha apologies, I missed this comment.. I don't get notified of edits via email. It's easier for me to respond in a timely manner if you can avoid editing comments :). Thanks for looking into this. I agree it is weird. I'm catching up on the backlog before going to bed.. I believe I've merged all the leak fix PRs however CI still appears to be unhappy - https://travis-ci.org/sass/libsass/jobs/457400390\nI wonder if there is a config issue for that build.. Thanks, merged. @nschonni this is libsass :). I can confirm with this the ASAN are now gone :tada:\nHowever it does appear that somewhere along the way some test regressions have crept in.. I'm kicking off a master build to see if the test failures are present there. https://travis-ci.org/sass/libsass/builds/457712914. Master is failing on the same tests so let's keep moving this forward. Kicked off a rebuild if master. Looks there are compilation failures in the plugin tests. I'm out at dinner so I can't look into it any further ATM.\nhttps://travis-ci.org/sass/libsass/builds/458739532. :tada:\nOn Sun., 25 Nov. 2018, 11:51 am Gleb Mazovetskiy <notifications@github.com\nwrote:\n\nIt is finally green! #2760 https://github.com/sass/libsass/pull/2760\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2753#issuecomment-441406918, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWEJl_fHPRrD91DkuNW1UdmKNPlAjks5uyemagaJpZM4YsPwL\n.\n. Looks there are regressions on the windows builds.\n\nOn Thu., 22 Nov. 2018, 11:11 pm Gleb Mazovetskiy <notifications@github.com\nwrote:\n\nFixes #2643 https://github.com/sass/libsass/issues/2643: pstate.src may\nnot outlive stack unwind so we must copy it.\nAlso optimizes line_begin/end search in handle_error. There is no need to\nadvance by UTF-8 code points when searching for an ASCII character, because\nUTF-8 is a prefix-free encoding.\n\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/sass/libsass/pull/2755\nCommit Summary\n\nFix heap-use-after-free in Parser error handling\nOptimize line_begin/end search in handle_error\n\nFile Changes\n\nM src/error_handling.cpp\n   https://github.com/sass/libsass/pull/2755/files#diff-0 (4)\nM src/error_handling.hpp\n   https://github.com/sass/libsass/pull/2755/files#diff-1 (5)\nM src/parser.cpp\n   https://github.com/sass/libsass/pull/2755/files#diff-2 (5)\nM src/sass_context.cpp\n   https://github.com/sass/libsass/pull/2755/files#diff-3 (17)\n\nPatch Links:\n\nhttps://github.com/sass/libsass/pull/2755.patch\nhttps://github.com/sass/libsass/pull/2755.diff\n\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2755, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWEJqcJgItl36EX0XrYNe_Otig3tgks5uxpRVgaJpZM4YvOtF\n.\n. Whoa awesome work!. Correct me if I'm wrong but this isn't libsass specific? Mojave changed something with their libc++ support IIRC.. For now I'm in favour of keeping VS2013 as the default.. Node Sass still needs to compile on VS2013 for some older versions of Node. We'll be dropping support for those versions in the next major version. I'd like to see that released Dec-Jan latest, but hopefully earlier depending on my availability.. @nschonni done :+1: . There isn't a sass-spec because there wasn't a reported issue. We were producing an error in this case, but not the right error\n\nError: $selectors: \"&\" is not a valid selector: Invalid CSS after \"\": expected selector, was \"&\" for `selector-append'\n        on line 2 of test.scss\n  Use --trace for backtrace\nThe SEGV from #2663 is a known issue with reparsing selector during eval. I've previously created the https://github.com/sass/libsass/labels/selector-validation tag for related issues. The fix for that is a fairly significant refactor.. Thanks. Thanks. It's too big of a change for me to comment on without context. Feel free to proceed when you and @glebm are confident. \ud83d\udc4d. I'm ok with using cities, but would prefer not to limit to Swiss cities. I started running out of famous car names to use in later releases.\nOne a note regarding versions. Sass has decide to drop the concept of language version numbers. This extends to sass-spec which moving towards dropping the version flag. We're currently support features from 3.5 to \"3.7\" but not all of any.\nWhich isn't to say we need to change anything, other than to note that our version numbers are just for us now :)\n. Some background on Sass language version changes\n\nhttps://github.com/sass/sass-spec/issues/1223\nhttps://github.com/sass/sass-spec/issues/1297. When are you thinking we should cut a 3.6.0? Would we wait for an API/ABI break or do you have another cut off in mind.\n\nPersonally I consider the 3.4-stable and 3.5-stable branches complete now. The next release should come from master.. I'm going to continue focusing on new features so I don't any strong feels around the API and refactors unless the impact that work :+1: You and @glebm have a clearer vision for that side of things.. Note we have a paid account.\nOn Thu., 29 Nov. 2018, 7:21 pm Gleb Mazovetskiy <notifications@github.com\nwrote:\n\nShould make appveyor builds faster\nPretty sure appveyor OSS doesn't have more than 2 cores (maybe it's just\none), and looks like it doesn't have enough RAM to build in parallel.\n\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/sass/libsass/pull/2773\nCommit Summary\n\nappveyor CI: Reduce parallelism to 2\n\nFile Changes\n\nM appveyor.yml\n   https://github.com/sass/libsass/pull/2773/files#diff-0 (4)\n\nPatch Links:\n\nhttps://github.com/sass/libsass/pull/2773.patch\nhttps://github.com/sass/libsass/pull/2773.diff\n\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2773, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWPHLdtffiMLBGlrZU4-xPkR7h9P-ks5uz5kBgaJpZM4Y5KHx\n.\n. The plan is call Pro FOSS (2 jobs). I don't see the details for that\nspecific plan listed anymore\n\nOn Thu., 29 Nov. 2018, 7:25 pm Gleb Mazovetskiy <notifications@github.com\nwrote:\n\nWhat's the build configuration?\nhttps://www.appveyor.com/docs/build-configuration\nTrying to figure out how much RAM and how many cores it has, but can't see\nany information in AppVeyor UI\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2773#issuecomment-442746449, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWP3QfEH5yALtlmbm6ava76My7djlks5uz5nlgaJpZM4Y5KHx\n.\n. Sorry I've been too busy to keep up. I'll take those actions to unblock CI.. Hopefully CI is green now\n\nOn Thu., 6 Dec. 2018, 9:05 am Gleb Mazovetskiy <notifications@github.com\nwrote:\n\nThanks!\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2775#issuecomment-444669226, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWNVy36Jf-39rPJAxZ9rhOiJ_CV3Lks5u2EM4gaJpZM4Y6C1L\n.\n. Given that the referenced issue is closed, can you please provide an\nexample of exactly what this is fixing?\n\nOn Sat., 1 Dec. 2018, 2:30 am Max Cherniavskyi <notifications@github.com\nwrote:\n\nResolves: #1216 https://github.com/sass/libsass/issues/1216\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/sass/libsass/pull/2777\nCommit Summary\n\nAdd prelexer for decimal value with trailing zeroes\nMerge branch 'master' into bugfix/1216\n\nFile Changes\n\nM src/parser.cpp\n   https://github.com/sass/libsass/pull/2777/files#diff-0 (2)\nM src/prelexer.cpp\n   https://github.com/sass/libsass/pull/2777/files#diff-1 (6)\nM src/prelexer.hpp\n   https://github.com/sass/libsass/pull/2777/files#diff-2 (1)\n\nPatch Links:\n\nhttps://github.com/sass/libsass/pull/2777.patch\nhttps://github.com/sass/libsass/pull/2777.diff\n\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2777, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWN94JMLTcz4lm0CpXQW7j6BtW7OJks5u0U8FgaJpZM4Y73kc\n.\n. I'm in favour of updating the LibSass output of the spec and moving on.\n\nOn Tue., 4 Dec. 2018, 10:38 am Natalie Weizenbaum <notifications@github.com\nwrote:\n\n@nschonni https://github.com/nschonni The answer to that question is\nmulti-layered! Strap in!\nHow an implementation chooses to serialize its final AST to CSS is up to\nthat implementation, as long as the CSS is semantically identical to the\nspecified CSS. As far as CSS is concerned, 3.0px and 3px are the same\nvalue, so implementations are free to switch between them as they choose.\nRuby Sass does this too! For example, Ruby Sass will compile a { b:\n(3.0px); } to a { b: 3px; }. However, Ruby Sass has special logic for\n\"static\" property values that look like they don't include any SassScript.\nAs a mitigation for Ruby Sass's incredible lack of speed, it avoids fully\nparsing or interpreting static values and instead passes them on as-is to\nthe CSS output. So if you don't include parentheses, Ruby Sass won't change\nthe input at all and you'll get 3.0px.\nDart Sass, on the other hand, is much faster than Ruby Sass and as a\nconsequence has no special handling for static property values. It fully\nparses every value and converts it to CSS using its normal logic, which\nmeans that its numbers always have trailing zeroes trimmed.\nSo it's not a bug, but it's not exactly a feature either. I guess I'd\ncall it a \"non-semantic implementation difference\".\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2777#issuecomment-443912572, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWEXjPy9hrzYKXT792TTSvJNgYsxzks5u1bXjgaJpZM4Y73kc\n.\n. Can you please rebase this on master.. There are no plans for a new 3.5 release at this time.\n\nOn Fri., 28 Dec. 2018, 10:42 am Alexey Shmalko <notifications@github.com\nwrote:\n\nHey guys! I'm trying to fix the CVE-2018-19797\nhttps://nvd.nist.gov/vuln/detail/CVE-2018-19797 on NixOS. As far as I\nknow, this PR is the only available patch and it does not apply to 3.5.5\nrelease. (There were no src/fn_utils.cpp.)\nWould you like to backport the patch to 3.5.x? Releasing a new patch\nversion would be even more awesome \ud83d\ude42\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2780#issuecomment-450254509, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWG0BE4ECKy_pAU1fJ7gY3Ntpl55Nks5u9VrSgaJpZM4Y9dQj\n.\n. Crashing on an infinite seems like a reasonable thing to do.\n\nOn Tue., 4 Dec. 2018, 10:54 am Natalie Weizenbaum <notifications@github.com\nwrote:\n\nThis is expected; the + operation by default converts its arguments to\nstrings and concatenates them. Whether it should be so permissive is an\nopen question, but even if not I don't think it's worth breaking\nbackwards-compatibility to fix.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2781#issuecomment-443915778, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWH8R5RcXHkTysjS8mRgeOK7jNpGNks5u1bmggaJpZM4Y-ByH\n.\n. >On a side note: these kind of issues seem more important for eg. sassmeister or libsass srcmap inspector\n\nI know some services have a hard time out on compilations to mitigate DOS attacks from this vector.. I agree the comments aboves. This is essentially by design.. Thanks!. Appveyor build timed out. Kicked off a rebuild.\nOn Tue., 4 Dec. 2018, 8:26 am Gleb Mazovetskiy <notifications@github.com\nwrote:\n\nSelector stack got popped during eval, resulting in extender deletion.\nYou can view, comment on, or merge this pull request online at:\nhttps://github.com/sass/libsass/pull/2784\nCommit Summary\n\nFix #2782: heap-use-after-free in expand.cpp\n\nFile Changes\n\nM src/expand.cpp\n   https://github.com/sass/libsass/pull/2784/files#diff-0 (2)\n\nPatch Links:\n\nhttps://github.com/sass/libsass/pull/2784.patch\nhttps://github.com/sass/libsass/pull/2784.diff\n\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2784, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWDQB76UOg-AtdIXJB3_WHByXtHVCks5u1ZbrgaJpZM4Y_cim\n.\n. Thanks for following up. Is there anyway to scan or lint for this kind of mistake across th codebase. The introduction of _Obj and _Ptr types was fairly jarring and I suspect more of these have slipped through the cracks.. Oh cool. I've started hacking on a rust port a couple times but never\nreally had the time to commit to it. Excited to see where it goes.\n\nOn Thu., 6 Dec. 2018, 2:52 pm Gleb Mazovetskiy <notifications@github.com\nwrote:\n\nI'm hoping that #2785 https://github.com/sass/libsass/issues/2785 will\nat least make it obvious.\nI don't think an automatic lint is possible here (as _Ptr is better for\nperformance when it is safe).\nI'm following this Rust Sass compiler closely btw:\nhttps://github.com/kaj/rsass.\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2784#issuecomment-444739528, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWCrfq4X1b7_8Oz3OafPq0YmorRckks5u2JRvgaJpZM4Y_cim\n.\n. I am fully in favour of removing these. I continually struggle to know what types I'm dealing with at any given time.. Thank you for your contribution, could you please\n- rebase this commit on master\n- create a sass-spec PR to move this spec to libsass-closed-issues see https://github.com/sass/sass-spec/tree/master/spec/libsass-todo-issues/issue_1890. @mgreter do you want to update this to match https://github.com/sass/libsass/issues/2778#issuecomment-448966061?. Appveyor appears to still be failing after the sassc change was merged.. @glebm it's like you read my mind.. Seems reasonable to me.. Would we still want to have a static build for OSX?. Thanks!. Thanks. Honestly I think even a simple comment would go a long way to stopping this regressing again. Memories are short.. Yep, that's fine\n\nOn Fri., 1 Feb. 2019, 9:03 pm Alyssa Ross <notifications@github.com wrote:\n\n\nHonestly I think even a simple comment would go a long way to stopping\nthis regressing again. Memories are short.\n\nWhere would it go? Would it have to be repeated once per file?\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2817#issuecomment-459670293, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWNttJVCj4-TJlzER28AMIjwipKDvks5vJBDagaJpZM4Z-XuA\n.\n. Thanks. I'm on vacation through February so probably not for a couple weeks\n\nOn Sat., 2 Feb. 2019, 12:55 am Alyssa Ross <notifications@github.com wrote:\n\nThank you! While I'm here, any news on a release?\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/pull/2817#issuecomment-459729849, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWBWpEBBPn-bjASvHncwPwI0FRT8Zks5vJEdAgaJpZM4Z-XuA\n.\n. We will not be adding logging levels, nor will we enable silencing deprecation warnings. These warnings are critically important for user code to continue working.\n\nWe would however consider solutions that make it easier to find the code using deprecated behaviour.. We don't know. We don't use Xcode. If you figure it out please let us know or open a documentation PR.. I have a fix for the error reported (#2846) but not the underlying issue of executing scoped function references. \nUntil the behavioural issue is resolved erring is better than producing broken output.\n. See https://github.com/sass/sass/issues/1128\nOn Thu., 21 Feb. 2019, 8:35 pm Martijn Saly, notifications@github.com\nwrote:\n\nIf it really works as intended, then the intention is wrong \ud83d\ude03\nAgain, it works fine in Ruby Sass, and it also works fine for any\nregular property. It also works fine for properties that start with a\nsingle dash. Since CSS variables are gaining traction, they oughta be\nsupported. It currently feels like CSS variables are somehow magically\nexempted from the Sass parser.\nQuestion: what is the reasoning behind this behaviour?\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2835#issuecomment-465928788, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAjZWAJLVZa09S27FMVMu7MGDDkGO4niks5vPmhbgaJpZM4bE1aD\n.\n. It's not a bug. As the link issue explains the CSS spec is worded such that any value is a valid value for a custom property. This includes valid Sass values like Sass variables.\n\nAs such the Sass team made the choice to treat custom property values as plain CSS strings except for interpolations #{}. So if you want to assign a Sass variable to a custom property it must be inside an interpolation.. Possibly in those older versions of Ruby Sass. I suggest trying the dart sass implementation at sassmeister.com as it is now the canonical.. Is there an example or a sass spec we can verify the correct behaviour against?. Thanks. Added a spec https://github.com/sass/sass-spec/pull/1361. sass-spec failures are unrelated to this patch.. This error checking block is repeated a few times. Is there a better way?\nc\n      Expression* m = ARG(\"$map\", Expression);\n      Expression* v = ARG(\"$key\", Expression);\n      if (!(m->concrete_type() == Expression::MAP || m->concrete_type() == Expression::LIST)) {\n        error(\"$map: is not a map for `\" + string(sig) + \"`\", path, position);\n      }\n      Map* map = dynamic_cast<Map*>(env[\"$map\"]);\n. This is probably the big design decision in this PR. I tried a couple different approach to this, namely an array of Sass_Value[2]. The struct Sass_KeyValuePair felt the cleanest and made the resulting code much easier to comprehend.\nThe approach was inspired by the ruby sass implementation.\n. This equality check is naive, and could potentially be a performance issue with the right inputs. Maybe this is ok for the first iteration?\nAn alternative approach would be to maintain a has for each map or key value pair for equality comparisons. \n. Apologies, I'll clarify. The pattern with these function is they take a map, or an empty map () which is indistinguishable from a list, and is actually treated a list by the parser. \nSo in essence I'm just trying to determine an $map is infact a map with zero or more keys.\n. The caveat with this approach is that I'm not sure what'll happen with a list in fact passed in and coerced with Map* map = dynamic_cast<Map*>(env[\"$map\"]);. Sass would return an error\n\n$map: (\"foo\" \"bar\" \"baz\") is not a map for `map-get' \n\nhttp://sassmeister.com/gist/ecfdc8072ab078cbdbc3\n. You might be right. I think I ran into some issues type checking for that error message using your approach. I can't remember for sure, let me try it again locally, I think you're correct though since an empty is a valid map the coercion should be valid.\n. No worries, I appreciate the feedback. Generally speaking I think I'm doing mostly the right the things. \nI'm just not sure whether it's the correct way to do them.\n. So the issue I ran into with \nMap* m = ARG(\"$map\", Map); \nis that this \nfoo: map-get((), foo); \nwould resulting in \nerror: argument$mapofmap-get($map, $key)must be a map\nbecause ARG thinks () is a list. I suppose the correct thing to do would be to update ARG to understand that () is both an empty list and map.\n. Yep I agree that's the sane thing to do. I'll give it a go today.\n. Fixed in 57dada0\n. I considered making a custom_property_prefix token but the extra LOC didn't seem worth it for this single use case.\n. This looks like a scary change but it's simply moving a chunk of code further up in the file to resolve circular dependencies in the custom hash and equal_to functions defined below.\n. Here I define the specialisations of std::hash and std::equal_to for Sass::Expression which simple back on to class defined hash and == methods. \n. This is a thin wrapper over std::unordered_map with a std::vector for maintaining insertion order.\n. Short circuit the merge if the map is currently empty.\n. This was moved further up.\n. This was moved further up.\n. This isn't used anymore.\n. ast.hpp now uses unquote when hashing String_Constants so we need this guard.\n. Fixed, thanks\n. @akhleung I'm a bit foggy on the purpose inspect.ccp, especially in regards to control structures like @each. Could you please shed some light?\n. > Control directives such as @each aren't present in the fully expanded tree, so they'll never be rendered in the final output. But the Inspect visitor still handles them in case you really need to print them out.\nAh great this is the use case I wasn't aware of. Thanks for the clarification.\n. Please remove oor since it is unused.\n. Should l->length() + n->value() be l->length() - n->value()?\n\nNegative index values address elements in reverse order, starting with the last element in the list.\n. I'd suggest delay the adjust of index to zero-based until later. That'll make this expression easier to read, and the if statement below more congruent with the sass documentation.\n(ArgumentError) \u2014 if $n isn\u2019t an integer between 1 and the length of $list\n. List is a vector under the covers so you don't need this. List also overloads the << operator so you can simplify this block down to\n\nc++\n// style adjusted to consistency\nfor (size_t i = 0, L = l->length(); i < L; ++i) {\n    *result << (i == index - 1) ? v : (*l)[i];\n}\nreturn result;\n. Ah yes you're correct.\n. I'm seeing the following error when testing this\nfunctions.cpp:1070:33: warning: operator '?:' has lower precedence than '<<'; '<<' will be evaluated\n      first [-Wparentheses]\n        *result << (i == index) ? v : (*l)[i];\n        ~~~~~~~~~~~~~~~~~~~~~~~ ^\nThis is easily fix by wrapping the expression in parens\n*result << ((i == index) ? v : (*l)[i]);\n. nitpick: it's good manners use long flags where possible. Make it easy to grok without consulting documentation.\n. IIRC this might work\nexport FOO=\"foo --bar bar \\\n    --baz baz \\\n    --bam bam\"\n. It looks like this change is doing something very different than the original. Could you please elaborate on the reasoning here?\n. Should this be n->zero() rather than hardcoded to true?\n. nitpick: extra whitespace between )    ,\n. Thoughts on moving this logic into the parser?\n. It more so that there are a couple open issues that address ascetics.\nhttps://github.com/sass/libsass/issues/452\nhttps://github.com/sass/libsass/issues/593\nThat are similar and nature whose ascetics (extra whitespaces etc..) will need to be handled at the parser level. Seem logical to keep as much of this logic in one place\n. Arguments extends Vectorized which overloads <<\nOn 10 Nov 2014 12:38, \"Elliott Sales de Andrade\" notifications@github.com\nwrote:\n\nIn eval.cpp:\n\n@@ -381,8 +407,13 @@ namespace Sass {\n     }\n     // else if it's a user-defined c function\n     else if (c_func) {\n-      if (full_name != \"[f]\") {\n-        bind(\"function \" + c->name(), params, args, ctx, &new_env, this);\n-      } else {\n-        String_Constant str = new (ctx.mem) String_Constant(c->path(), c->position(), c->name());\n-        *args << new (ctx.mem) Argument(c->path(), c->position(), str);\n\nMaybe I'm missing something, but I don't see the << being overloaded by\nthe Arguments class. I do see << in Vectorized, but there's also +=.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/635/files#r20064005.\n. I wonder how expensive all this is, and if it's worth doing as a singleton somewhere.\n. ditto on https://github.com/sass/libsass/pull/664#discussion_r20570198\n. I wonder how expensive all this is, and if it's worth doing as a singleton somewhere.\n. I wonder how expensive all this is, and if it's worth doing as a singleton somewhere.\n. The hex pipe isn't technically required, and is probably an unnecessary performance hit. The intent was to function more like the Ruby implementation.\n\nWe can get away prepend the random number with a string ( i.e. \"u\" ) to create a valid identifier.\n. The implementation is lifted directly from sass/sass@f3be0f4 for consistency.\n. ~~FWIW the implementation has since changed. I'll update this to reflect~~ The semantics on the implementation are essentially the same.\nhttps://github.com/sass/sass/blob/stable/lib/sass/script/functions.rb#L2151\n. Looks like a Ruby trick for turning numbers into alpha numeric strings http://www.chris3000.com/ruby/ruby-how-to-turn-integers-into-base36-for-urls/\nI'll drop this to 16 since we're passing through hex anyway.\n. I feel uncomfortable with delimited_by here, but I admittedly don't have a better idea.\nIt's the core of the issue currently because it can't account for nested tokens i.e. (..foo()) will match (foo(), or token in quotes (..\"foo()\") will match(..\"foo().\n. Is this debug code?\n. Was removing this branch intentional?\n. :+1: \n. I'd rather have aparse_errormethod rather than passing a bool here. The parser should mirror the sass syntax not the idiosyncrasies with our implementation.\n. Is there a reason we can't have anErrorAST node?\n. Is removing the backtrace accurate? I believe Ruby sass outputs more that the current line for@warnings`\n\nFrom my experiments I believe what we have now is correct behaviour.\n. nitpick: alignment\n. I believe your @debug implementation is correct\n. > Since semicolons are just statement delimiters one is as good as 10.\n\n\u2014@xzyfer in https://github.com/sass/libsass/pull/774\n\n:stuck_out_tongue_winking_eye: \n. Haha nice catch, I'll fix it.\n. You might be able to use the @ prefix which will suppress any errors caused by @mkdir .. and continue on as normal. Not sure if that works on windows.\n. > The problem is that mkdir returns a failed exit state if it tries to re-create an already existing directory\nDo we care if the directory already exists? I assume if the directory exists we can just continue on as normal correct?\n\nAnd there doesn't seem to be an easy portable way to test for existing directories!\n\nAssuming the above is correct I think you can do the following @$(MKDIR) lib || true. This will just will suppress the error that the direct already (and any other errors unfortunately).\n. I'm not sure why this cause compilation to fail on only some platform though. More this file is just a modified version of eval.hpp\nWhich declares this as protected.\n. Rename this.\n. This behaviour can probably come out into it's own PR.\n. I'm opting out of this since managing the specs will be complicated.\n. && m->value() != 0 is redundant. I'll clean this up next time.\n. Nice catch\n. It's worth mentioning what makes this smart\n. IMO almost all uses of delimited_by are erroneous. We should probably aim to wholesale replace this with something smarter. \nhttps://github.com/sass/libsass/issues/615 is good example where delimited_by fails spectacularly.\n. > $amount (Sass::Script::Value::Number) \u2014 The amount to increase the saturation by, between 0% and 100%\n\n[throws] if $amount is out of bounds, or either parameter is the wrong type\n\nhttp://sass-lang.com/documentation/Sass/Script/Functions.html#saturate-instance_method\n. I don't know about this variable name\n. Did you mean to comment out these?\n. Again, this method name tells me nothing about what it's doing.\n. Should this not have (&ctx)?\n. Is there any advantage to this change? (personal curiosity)\n. Thanks I've been meaning to fix this.\n. Are you replacing all String_Constant with String_Quoted?\nThe semantics here are confusing since map keys don't have to be quoted.\n. :+1: \n. > it means the parsed string might has been a quoted string\nThe semantics here are confusing to me. String_Constant is an unquoted string where as String_Quoted is either a quoted or unquoted string?\nFeels like there should be a higher abstraction that given a string turns it into either a String_Constant or an String_Quoted?\nOr maybe String_Quoted is a bad name if the string isn't necessarily quoted?\nMy concern is not knowing which type to use in any one circumstance.\n. Shoudl be if (!l || l->length() != 0)\n. Does this need to be 3.2.0? That's when this will land.\n. 3.1.0-1 what does this version number represent?\n. Should this be 3.2.0 since that's the stable release this will land in?\n. Do we need to worry about platform difference here? Are \\r\\n line ending going to cause this to back track too many times?\n. Is this different to \nc++\nExpression* ex = var->perform();\n. In the visitors we usually call ->perform() as a way to invoke the operator for that type. \nPerform essentially calls operator()(foo) with some sugar.\nIt also mean to you can perform other visitors on a object i.e. foo->perform(&eval).\nI did notice operator()(foo) is being used above, which is strange. Ideally we'd stick to using ->perform() for consistency unless there was a reason not to.\n. Any reason not use?\nappend_string(\";\");\n. If it can be done so safely please to. I dig into why the above operator() call was done that. \nI'm a big stickler for conventions.\n. typo?\n. I was not aware of this. Good to know :)\n. Is this meant to be commented out? There are cases where we need this error.\n. Could this be something like?\nc++\nreturn n->perform(Contextualize);\nSince Contextualizes fallback is to return it's parent\n. Sorry I think I'm still confused by this class. \nc++\nContextualize_Eval::operator()(Selector_List* s) {\n  // Is there a difference between these two I'm missing?\n  return Contextualize::operator ()(s);\n  return s->preform(&instance_of_contextualize);\n}\nIf not then you can remove these operators and fallback to the Contextualize\nc++\nSelector* Contextualize_Eval::fallback_impl(AST_Node* n) {\n  return n->perform(&instance_of_contextualize);\n}\nWhich will hit Contextualize::fallback_impl if that operator type isn't defined.\n\nIs it simply that you wish to opt-out of some Contextualize operators? It's unclear from this diff alone.\n. I believe @mgreter was referring the comment below.\n. Cool, great work. I'll dig into it a bit and see what I come up with. If nothing else I'll better understand the intention here.\n. What's the use case for optional < identifier > here? Are all identifiers really valid in the context?\n. Also could this reduced to? \nreturn sequence< number, optional < identifier > >(src);\n. Interesting. It'd be worth looking at the Ruby parse to see what their rule is but for now :+1: \n. I wont get a chance to look at this anytime soon. If this fixes an issue :+1: I'll open another issue to take a look at static value parsing.\n. https://github.com/sass/libsass/issues/974\n. Is this correct? I believe this is still a valid error.\\\nThe error case mentioned in the issue is \n\n[when] optional parameter followed by a variable-length parameter\n\nThis change appears to affect the case \n\n[when] a variable-length parameter is followed an optional parameter\n\nWhich is a legal scenario.\nIf this fixes the reported issues I believe the bug is due to something before this check.\n. We should remember to mention this in the changelog.\n. Cool. I'd fixed this in a branch that I haven't PR'd yet :)\n. I saw you post debub_ast output in an issue and fell in love.\nOn 28 Mar 2015 23:05, \"Marcel Greter\" notifications@github.com wrote:\n\nIn debugger.hpp\nhttps://github.com/sass/libsass/pull/986#discussion_r27344568:\n\n@@ -69,7 +69,7 @@ inline void debug_ast(AST_Node* node, string ind = \"\", Env* env = 0)\n         case Complex_Selector::ADJACENT_TO: cerr << \"{+}\"; break;\n\nLooks like your using debug_ast too [image: :wink:] I hope you like it as\nmuch as I do [image: :smile:] It actually decreased my time hunting bugs\ndramatically! I also thought about creating a nicer debug_env function,\nbut I was able to use existing one (altough the output could be better\nthere).\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/986/files#r27344568.\n. Lol that explains why the coverage didn't change! Fixed in https://github.com/sass/libsass/pull/1015\n. Does peek_css force word boundaries? Otherwise this is a regression.\n. Aha that's new. Cool.\n. @am11 can you please open a new issue for this?\n. Would not incorrectly warn users even if they have defined their own compact function? Could we move the warning into the functions.cpp?\n. remove this?\n. I believe this is cause of the CI error. See line 501 above.\n. Legit - https://github.com/sass/libsass/pull/1129\n. debug code?\n. remove please\n. undo this change please\n. remove please\n. debug code?\n. still a todo? if not please remove\n. please re-comment out these.\n. please remove\n. please remove\n. is this still todo? open an issue?\n. debug code?\n. debug code?\n. Has code been copy-pasted or moved? \nWhy is it in this diff if it's not yours?\n. This superfluous comment. Unless you think it offers some value, I doesn't to me.\n. This superfluous comment. Unless you think it offers some value, I doesn't to me.\n. c\nbool is_int = d.find('.') == string::npos\n\n?\n. I find this code really unintuitive and hard to grok. We should aim for expressive code first, and optimize later.\nc\nbool has_decimal = ss.find_first_of(\".,\");\n. Should this be in the output phase? Surely we know if a number in valid in eval?\n. Should this be a sequence?\nsequence< exactly <'\\\\'>, alternatives< exactly <'\\r'>, exactly <'\\n'> > >\n. As is stands I believe this would allow cases Ruby Sass does not, and that aren't in the CSS Spec (which is bad)\nscss\n@import url(\"foo\\\nbar\");\n@import url(\"foo\nbar\");\n@import url(foo\nbar);\n//Errors with Ruby Sass\n@import url(foo\\\nbar);\nRuby Sass\ncss\n@import url(\"foobar\");\n@import url(\"foo\\a bar\");\n@import url(foo bar);\nWith this patch\ncss\n@import url(\"foobar\");\n@import url(\"foo\\abar\");\n@import url(foo\nbar);\n@import url(foobar);\n. Also, it looks like Ruby Sass treats the new line in the quoted string as a space delimited list.\n. What does flag mean? Is there a better name that will describe what this is for?\n. Remove this branch?\n. Remove these comments?\n. Ok cool. I'm just catching up trying to prepare for a new node-sass release.\n. Can you quickly explain this change?\n. I meant the pstate stuff. Not sure what's happening here.\nThis check cab definitely go. I knew it become an issue when I originally\nadded it.\nOn 12 May 2015 18:31, \"Marcel Greter\" notifications@github.com wrote:\n\nIn parser.cpp\nhttps://github.com/sass/libsass/pull/1195#discussion_r30113929:\n\n@@ -1073,8 +1073,15 @@ namespace Sass {\n       (*map) << make_pair(key, value);\n     }\n-    if (map->has_duplicate_key())\n-    { error(\"Duplicate key \\\"\" + map->get_duplicate_key()->perform(&to_string) + \"\\\" in map \" + map->perform(&to_string) + \".\", pstate); }\n-    // Check was moved to eval step\n-    // if (map->has_duplicate_key()) {\n-    //   To_String to_string(&ctx);\n-    //   error(\"Duplicate key \\\"\" + map->get_duplicate_key()->perform(&to_string) + \"\\\" in map \" + map->perform(&to_string) + \".\", pstate);\n-    // }\n  +\n-    ParserState ps = map->pstate();\n-    ps.offset = pstate - ps + pstate.offset;\n-    map->pstate(ps);\n\nThe check for duplicates keys was moved to the eval stage. The reason for\nthis is, ie. when we have variables as keys, we would check like $a == $b\nfor duplicate keys. But we actually need to check it only after the keys\nhave been evaluated ... I was not sure if we really can get rid of the\nfirst check, but it seems so ...\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1195/files#r30113929.\n. Please add the correct attribution to boost.\nhttps://github.com/boostorg/functional/blob/1bf379ab601eb52c97908cc2cc141fd6026bd708/include/boost/functional/hash/hash.hpp#L209-L213\n. We already have size_t length() const   { return elements_.size(); }. Please remove this.\n. There's a lot of added duplication in these nodes. Can we hoist it into a shared parent class.\n. I don't like that this has been made so shallow for a couple a reasons.\n- the heavy branching makes this code hard to read\n- the current implementation is modelled after the grammar so it's easy to spot inconsistencies.\n\nI'd opt to backing out this change.\n. IMO we should aim to mirror the CSS grammar where possible.\n. Good to see selector gone from here\n. I suppose new_Feature_Query should also renamed.\n. ditto on renaming new_Feature_Query_Condition\n. Remove this?\n. remove this?\n. remove else block\n. Is there value in leaving this uncommented now?\n. :+1: \n. :+1: \n. :+1: \n. :+1: \n. This block appears to be the cause of the broken selector output reported in https://github.com/sass/libsass/pull/1249#issuecomment-120948335 and https://github.com/sass/libsass/pull/1249#issuecomment-120950668\n. The header file defines this as const char* color_to_name(const Color* c)\n. remove this?\n. you're right\n. @drewwells \nbool is_digit (const char *c)\nvs\nbool is_space(const char& c)\nMy mistake for noticing this.\n. Yep, updated. I'm working through some inconsistencies in this as an experiment.\n. I'm working on it in https://github.com/sass/libsass/pull/1395.\nThere are other inconsistencies I want to fix.\n. Style nitpick.\nRemove new lines\nif (pr) return pr;\nelse return new (ctx.mem) Null(p->pstate());\nor add braces\nif (pr) {\n  return pr;\n} else {\n  return new (ctx.mem) Null(p->pstate());\n}\n. &gt; is that right?\n. You'd know better than I would ;)\n. Yep, I was just curious about meaningless noise diffs.\n. Nah it's cool. It just stood out.\nOn 14 Aug 2015 02:19, \"Adeel Mujahid\" notifications@github.com wrote:\n\nIn win/libsass.vcxproj\nhttps://github.com/sass/libsass/pull/1439#discussion_r36993617:\n\n\n\n\n\n-    \n\n\n\n\n@xzyfer https://github.com/xzyfer, I totally agree about the noise. It\nis just auto-formatting by VS, once we do that it won't get changed in\nfuture (just the end of file extra linefeed it omits in some cases, which\nwe should keep for git). With that said, should I revert the extra\nchanges?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1439/files#r36993617.\n. Good to see the logic slowly moving into ast.cpp :+1: \n. Unfortunately the without directive is too complex for this. For example should error.\n\n```\na { b: c }\n.d {\n  @supports (foo: bar) {\n    @media all {\n      @at-root (without: media) {\n        @extend a;\n      }\n    }\n  }\n}\n```\n. @mgreter I'm not sure if this has other consequences. Please confirm that this is safe to do.\n. Reading through the code I don't see an obvious issue with this. \n. > It might lead to memory leaks\nThis was my concern. It wasn't clear from the code that it was the case though.\n\nsince importer could return different content for the same url this way\n\nThis is feature people rely on in custom importers so we need to support it in some fashion.\n. I believe there have previously been discussion regard the portability of -p.\nhttps://github.com/sass/libsass/issues/1433\n. Should be Sass (note the uppercase S).\n. Looking through the rest of this file it looks like we generally treat \\r as a noop. I think you can drop the peek here.\n. Interesting.\n. Please follow the existing code-style and indentation.\nif (plugin_paths == 0) {\n    free(include_paths); //free include_paths before throw\n    throw(std::bad_alloc());\n}\n. Also spaces, not tabs.\n. nit: indentation looks off\n. Could be that you're using tabs?\n. This check still needs work and the test case will need to be updated.\n. No we don't need the copy. I slimmed this down a lot, fixed the check, and beefed out the spec. This visitor should never mutate the nodes.\n. Yep I've also removed that locally. Just pushed my latest. Tracking down an error mismatch atm.\n. Should this be blocks.hpp?\n. ditto?\n. ditto\n. ditto\n. I think this belongs in containers. It's critical to understanding Hashed. Not entire sure how that'll work given it's a fwd decl.\n. keys().at(i)\n. elements().at(keys(i))\n. Why does this need to change?\n. Ah I see, I the macro but wans't 100% clear on when it pop off the stack.\n. There either return false or thrown error. The Ruby Sass implement is return the error string or false which is gross in C++.\n. Unfortunately this doesn't work in all cases like here when I need to pop off that stack at a specific point. Waiting until the end of the function would alter the implementation. IMO we should aim to use macro where possible and assume if we're not it's intentional.\n. I think void might actually make the usage nicer.\n. Sorry, you're correct.\n. Made them void and removed the is_ prefix. This makes the method names the same as Ruby Sass.\n. The proper fix for this is to move the reference links below this line.\n```\n``\n. Correct, the()are a typo it should be[]. You may not even need to move the references.\n. This might be some what wasteful but it's equivalent to what Ruby Sass does and makes list functions easy to reason about for newcomers.\n. As an aside it bugs that the AST doesn't have access to the context. Not being about to create new nodes from AST methods gets rather painful. In this case it might be nicer to add aListconstructor that takes aMap` argument.\n. > In this case it might be nicer to add a List constructor that takes a Map argument.\n\nAdd a line note\n\nThis runs into the issue of not being able to create new list nodes in AST nodes.\n. dandling debugger?. delete. lets be consistent ->at or pointer arithmetic. is this correct?. is this correct?. the the remaining // Compound_Selector_Ptr cpy comments. this is not equivalent the current behaviour i.e. when name() > rhs.name() and matcher() < rhs.matcher(). copy, copy2, and clone2 need better names. what's the reason for removing this?. delete. glad to see this go. dangling debugger?. are these really required here?. are these debugger lines intended for master?. delete. does it still leak?. indent. dangling debugger?. dangling debugger?. delete. this pr isn't the place to be changing unrelated behaviour. delete?. are these needed on master?. did you switch to tabs here?. indent. what's with the 2 suffix?. what's with the 2 suffix?. > IMO in the end we should aim to use OO style\nI agree. Lets take another pass at consistency after this lands. People who contribute are going to copy whatever style they see first.. Sorry this comment is the wrong place. This return turns seems wrong because of the lines below and compared to the diff.\n\n. No problem. 3.4 is stable, so no disruptive changes will back ported.. I understand, however it's a breaking change and 3.4 is stable. The ship has sailed on breaking changes in 3.4. Back ports are only happening for small Sass fixes. . This belongs in the check nesting visitor for now. The parser should avoid validating the AST tree.. I'm looking into why the check_nesting visitor is bailing out early here. It's a direct port from Ruby Sass so tracking down the issue should be fast.. This has bugged me since I discovered this file :). It redirects to the LibSass landing page. It's worth keeping for now.. Due to issues with Node Sass we need to keep CI at VS2013.. nitpick: should this be kept since there is still the is_root flag still exists?. nitpick: typo?. >You can expect LibSass to be magnitudes faster than Ruby Sass. We would even go as far and claim that it is the fastest CSS compiler around, which should be the case given it's written in C++.\nThis bragging is unnecessary.. I'm struggling to follow this paragraph. IMHO the original was good.. With clang it's hard to know. If you're on OSX (which is where clang is prevalent) it'll just work.. The 3.4 branch isn't an official thing. It was an implementation detail because I wasn't ready to drop some large changes into Node Sass. Node Sass now has the latest 3.5 betas on master.. Additionally I believe http://sass-compatibility.github.io/  is no longer actively maintained. I did the last round of updates a long time ago.\nWe should just say that we aim to be compatible the latest Ruby Sass stable release. All known incompatibilities are in our issue tracker.. It's worth distinguishing current maintainers. People still contact Hampton directly who then proxies messages on to me.. Sass Spec is fine. The \"Sass\" capitalization is part of the Sass branding.. https://github.com/sass/libsass-net is now under the Sass org also.. Should nestings be name here?. Totally right, this was a last minute change.. Nice catch. Updated. Updated. Updated. This appears to be a style only change. If so can you please restore the previous style.. Thanks. Looks like this would regress to clang 3.5.0 - https://docs.travis-ci.com/user/languages/cpp/#clang. You're right. Apologies.. It'd be good to update Travis and appveyor configuration to run these tests in CI also. This block was a duplicate.. I agree it's not necessary but template space (at least between < >) is\nconsistent throughout much of the codebase. Can't speak for anyone else\nbut I've personally found it makes the code more easily scannable.\nCurious to know more about your objection to the style?. Updated to match the adjacent style.. I believe it's referring to css namespaces i.e. https://oreillymedia.github.io/Using_SVG/extras/ch03-namespaces.html\nThese were properly accounted for once upon a time. I expect the comment is as relevant as it has ever been.. Curious why std::string is only needed here?. Indentation is off here. That is intentional. It's a Ruby-ism that was adopted for specs to pass back in the day.. ",
    "edds": "Thats much better. Sweet. The only thing that our 8000 lines of Sass use that libsass doesn't have now are extend only selectors, but that isn't for this issue.\n. ",
    "normadize": "I believe I just posted a duplicate of this in sassc at https://github.com/hcatlin/sassc/issues/25 ... sorry.\nHowever, putting a semicolon after the @include colors content block does not fix it in my case. This is on a compiled binary from libsass and sassc pulled from the git repo one hour ago.\nThe code I used was a direct copy/paste from here: http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#variable_scope_and_content_blocks\nIs there any workaround for the current version? ... I can't seem to be able to make the error go away no matter what I try.\n. ",
    "lmartins": "Im also getting this same error for the following line:\n@-webkit-keyframes #{$name} {\n. @akhleung Im using your project indirectly, via https://github.com/sindresorhus/grunt-sass, just posted here because i thought it was a know issue. Sorry if it's not the case.\n. Would be nice to have this.\n. @benschwarz already described what id does. \nThe main benefit of the also called \"silent selectors\" is that they don't output anything, unless they are called somewhere in the code. This makes them the perfect solution to abstract code as modules that you can use in several parts of your code.\n. Thanks again @akhleung \nI've just tested it but it seems to choke with a simple \"silent class\":\n%btn  {\n   ...\n}\nThis will result in the following error in the console:\nWarning: css-src/system.scss:12: error: invalid top-level expression\n Use --force to continue.\n. I guess that's related to nodesass then. Gonna check with the devs from that tool.\nThanks.\n. @emagnier It was implemented but it isn't outputting correct code. \nI've reported the issue in https://github.com/hcatlin/libsass/issues/146\n. Sourcemaps is not the same as debug-info as explained here:\nhttps://github.com/hcatlin/libsass/issues/122#issuecomment-19852611\n. While we don't have source-maps, wouldn't be possible to add the original file/line numbers baked in the output, like the original debug-info in Sass?\n. Thanks @akhleung , that's really necessary to use things like the Bourbon library.\n. Hey @akhleung \nSorry to bump this issue, can you estimate by any chance when you believe this could be solved?\nThanks.\n. Just pulled the latest version but it's still outputting the null values. Can you confirm if it is supposed to be fixed by now. I though i've seen a commit to deal with this problem.\nThanks again.\n. Just to illustrate the issue:\nhttp://cl.ly/image/3Z39403q0k12\n. I'm currently in holidays but ill try it again. I'm running via node-sass and the last time I've tested it I upgraded libsass manually.\nThanks again.  \n\nLuis Martins\nSent with Sparrow (http://www.sparrowmailapp.com/?sig)\nOn Tuesday, 9 de July de 2013 at 18:56, Aaron Leung wrote:\n\nOkay, last night I ran libsass on the linear-gradient mixin, and it seemed to work (though the whitespace was a little off). Are you running libsass through sassc, or some other tool? If it's the latter, they might not be using the latest version of libsass.\n\u2014\nReply to this email directly or view it on GitHub (https://github.com/hcatlin/libsass/issues/113#issuecomment-20692853).\n. Really can't go back to user anything else than Libsass to compile my Sass files, still, Sourcemaps are really essential. Google released some further details that might be helpful. \n\nHoping that Libsass can have this in the near future.\nhttps://developers.google.com/chrome-developer-tools/docs/css-preprocessors\nThanks\n. Didn't know that source-maps is a chrome feature.\nI totally agree that feature parity with ruby Sass is absolutely more important than the great convenience of source-maps.\n. Haven't thought of that but yes, being unable to help with the code itself I also would help by donating. After all this is a work tool I use on a daily basis.\n. Not sure how Bounty works, but I would feel more comfortable with it if it was promoted by the repo owners themselves. \n. Im running libsass via Node Sass. I'll have to wait until they update it, but surely will give it a try then. Cant wait for it.\n. Thank you both @akhleung and @deanmao \n. The only way I can get something similar is by using mixins, but that's far from ideal.\n. @akhleung Sure, I get it. Thanks for all the hard work, wish I was able to help here.\n. Just to add to this issue, i've noticed that even regular selectors wont extend correctly:\n```\n.f-row--defaults{\nmargin-bottom: 1.5em;\n&:last-child{\n    margin-bottom: 0;\n    border: 1px solid red;\n  }\n}\n```\nand then extend any selector with:\n@extend .f-row--defaults;\nIt will only inerhit the base rule margin-bottom but not the child selector also declared on the selector used as extender.\n. Sorry to ping this, but is there any estimation on when will this be available?\n. You guys are doing an awesome job. Thank your for that and for tolerating our impatience.\nI just can't use Ruby Sass now.\n. Sorry to introduce some noise to the ticket comments but I just wanted to give thanks to @akhleung for the hard work.\n. 2 hours might be extreme, but in my experience it is quite easy to get to 10sec average compilation times with ruby sass, which is unbearable to me. That is why I approach as @lunelson suggests, by being careful with some features and give for now on others. \nTo me personally, the speed alone more than compensates for the missing (for now) features.\nOnce you get used to have instant compilation times, you won't look back I promise.\n. @epitaphmike I believe the extend abilities have since evolved and are now more in pair to what ruby sass does, but not quite the same yet. That is what's being worked on, mainly by @akhleung i think. \n. @nchafai In my personal experience, and this is only my opinion, the time saved with libsass more than compensates for the extra work for avoiding @extend. I get this is not always feasible, and in an ideal world libsass would be in feature parity with ruby sass, but that isn't the case and up until then you will most likely have to make a choice.\nAgain, for me that meant going for simpler sass code and avoiding some libraries. I am quite happy with that choice, and would do it again today.\n. Thank you all for amazing effort.\n. Having this issue too. \n. Ok, this may be a confusion of mine. I could sweat this was the behaviour before but it's not what im seing in other testing with other tools.\nClosing it.\n. Libsass sadly still doesn't support placeholder selectors \nhttps://github.com/hcatlin/libsass/issues/146\n. Since this didn't quite got any attention, and since there options available like Gulp and Grunt tasks, im closing.\n. @svnieuw Could you please comment on this?\n. Thank you @svnieuw for clarifying this.\n. I am a bit confused about the support for BEM style selectors in Libsass 2. \nIm guessing it would be something like:\n.Component{\n  font-size: 1em;\n  &--modifier{\n    border: 1px solid red;\n  }\n}\nbut that still outputs: source string:2: error: invalid property name\nDid I misread the information and the expected syntax is actually different from what I shown above?\nhttp://sassmeister.com/gist/777f4f4ba8c07f995f3b\nThanks.\n. After posting i've thought of that for Sassmeister. Locally im using gulp-sass, which was updated this morning for Libsass 2 I believe. Just wanted to make sure if the syntax I mentioned is what it is supposed to work. Thanks for the feedback.\n. Thank you @akhleung for the feedback. With that i'll look further into what might be going wrong with my local env.\nUpdate: Just to let you know that in a different project with the latest versions of gulp-sass it is working as expected. Cool!\n. Also having this issue with what I believe is the current version. \nI currently have a file with a bunch of settings:\n@import \"_settings.scss\";\nWhen I try to split that file in multiple imports:\n@import \"settings/_typography.scss\";\n@import \"settings/_colors.scss\";\n@import \"settings/_colors.scss\";\n@import \"settings/_bourbon.scss\";\n@import \"settings/_typography.scss\";\n@import \"settings/_components.scss\";\nI then start to get a lot of error such as:\n[20:04:33] Plumber found unhandled error:\n Error in plugin 'gulp-sass'\nMessage:\n    /Users/luismartins/Sites/00_LAB/wp-multisite/wp-content/themes/wip-foster/src/sass/base/_typography.scss:31: unbound variable $box-spacing-small\nNote that the files where those variables are being requested are imported after the settings mentioned above. Not sure what's going on, but this didn't happened with prior versions of libsass.\n. Cool, thanks.\n. ",
    "JasonGhent": "same here:\n@mixin features_background($name){\n. @akhleung here is a longer piece:\n```\n.row{\n  .span4{\nmargin-bottom:30px;\n\n&:nth-child(3n+4){\n  clear:both;\n}\n\nh4,p{\n  padding-left: 85px;\n}\n\nh4{\n  font-weight:100;\n  text-transform: uppercase;\n  font-size:22px;\n  margin: 0 0 10px;\n}\np{\n  font-size:16px;\n  font-weight:100;\n  margin:1em 0;\n}\n\n}\n// @todo some note here\n  @mixin features_background($name){\n    background: url('img/' + $name + '.png') no-repeat;\n    background-position: top left;\n&:hover{\n  background: url('img/' + $name + '_hover.png') no-repeat;\n  background-position: top left;\n}\n\n}\n@each $c in a, b {\n    ##{$c} {\n      @include features_background($c);\n    }\n  }\n}\n```\n. The whitespaces are missing in node-sass when compiling scss files. Perhaps the issue is there if this is working with Ruby Sass properly? \nCan anyone confirm that Ruby Sass is working properly?\n. I am not. I found a workaround to do the same thing that I wanted to with a different CSS style.\nFor any that are interested in using calc to place a static footer that extends with content to never place higher than the bottom of the viewport, I used this example.\n. ",
    "benschwarz": "I think this is one of the more under appreciated features of SASS \u2014 I use it exclusively.\nShould I add a test on hcatlin/sassc?\n. @martin-spil-reurings, the test suite is implemented via sassc, I've raised a pull-request to try to figure out whats going on there. (sassc/#19)\n. @akhleung I'll keep on trying to push the test suite along too. I'll ping you when there is a test available\n. ``` scss\n%button {\n  background: red;\n}\n.button, button { @extend %button; } \n```\nShould yield: \ncss\n.button, button { background: red; }\n. @akhleung Over the weekend I'll try run the latest against a few big sass projects I have \u2014 will log anything that falls out. \n. ps. you're awesome. \n. I just build sassc from HEAD (along with libsass) \u2014 I'm proud to report that it was able to successfully build gallery-css, which uses a variety of sass features. \nThis is a huge step for SASS, congratulations @akhleung && @hcatlin !\n. ",
    "martin-spil-reurings": "@benschwarz If you can, that'd be a major  :+1: ! I have almost 0 affinity with C so I'd be quite lost there :)\n. ",
    "bestander": ":+1: \n. ",
    "jkarsrud": ":+1: It would be great to get this feature in to libsass soon :)\n. ",
    "damln": "+1 for this feature. Thanks for your hardwork on libsass.\n. ",
    "Nabellaleen": "Is possible to give a simple example of use of a placeholder, with the result on vanilla sass ? Thanks !\n. Commit fd423d1e9e19947e00bf5bb10b56225c277d48a5 fixes #91 \n. What is the remaining problem, @akhleung ? I've just test the url.scss and it seems ok. It remain only one problem with image-url() (probably due to my windows environment).\nIs the issue still present ?\n. Starting looking at this issue, I've identified these things, in eval_apply.cpp::bind_arguments() : \n-> around line 985 (in \"// now plug in the holes with default values, if any\"), the param have a \"rest\" type (because the param is the \"$args...\"), and this case is not handled.\nIt's still hard for me to understand the exact problem, but I think it should immediatly check the type, and eval it in our case or get the param_name and eval it in other cases\nI paste the code, to better explanation : \nC++\n    // now plug in the holes with default values, if any\n    for (size_t i = 0, S = params.size(); i < S; ++i) {\n      Node param(params[i]);\n// ==> Here, check the type and eval the param in case of rest type, else, continue\n      Token param_name((param.type() == Node::assignment ? param[0] : param).token());\n      if (env[param_name].is_null()) {\n        if (param.type() != Node::assignment) {\n          throw_eval_error(bt, callee_name + \" is missing argument \" + param_name.to_string(), args.path(), args.line());\n        }\n        // eval default values in an environment where the previous vals have already been evaluated\n        env[param_name] = eval(param[1], prefix, env, f_env, new_Node, ctx, bt);\n      }\n    }\n. Well, I'm not sure that's was the problem. Clearly, it seems a bind_arguments problem, but I don't understand where it's wrong.\nThere is code, above, where there is specific cases for param.type() == variable or assignement. Maybe a case for rest should be ok ?\nBut I didn't found a solution\n. Do you have an ETA for this \"clean up\" ? We need a version working fine with compass \"quickly\", so I would know if it's better to wait a bit for your new codebase or if I have to search for fixes on the different issues without waiting it :)\n. Working on the deep of libsass for some days, I understand the need of a refactoring. Some things are powerfull, but really hard to maintain !\nFor compass, I talking about the scss part of compass. So it should be less tricky. The scss parts are, for me, the main parts. The ruby parts are the things like make a sprite from a bunch of images ... It's less \"vital\" ^^\n. As you can see using this lines on http://sass-lang.com/try.html, SASS seems understand this code and produce the appropriate result, so it seems allowed.\n. @alexzorin I see you compiled libsass on Windows. What solution do you choose to manage export of symbols in dll for symbols like \"sass_new_context\" ?\nI've a solution using VC2012 redist, but I think this is a bit restrictive. An other solution ? (If you want, we can open a specific issue for windows)\n. Ok, I'll check if my fix of the #92 do the job. If yes, just wait that @hcatlin accept my pull request ;)\n. I confirm the fix of this issue by the correction I made on #92 \n. Also fixes hcatlin/libsass#95\n. @sorccu : yeah, I've seen that. It was my first pull request, so I wasn't sure of the process. But do it permit me to learn, so in the future, I'll do pull request of branches instead of master :)\n. Expected (I note that to have an immediate comparison base to resolve this issue :))\nCSS\n.size5, .wrapper header span {\n  font-size: 20px; }\n  @media screen and (max-height: 980px) {\n    .size5, .wrapper header span {\n      font-size: 18px; } }\n  @media screen and (max-height: 768px) {\n    .size5, .wrapper header span {\n      font-size: 16px; } }\n  @media screen and (max-width: 600px) {\n    .size5, .wrapper header span {\n      font-size: 15px; } }\n. Ok, I'll add the test to sassc on monday ;)\n. I've found the spec/todo/variables_in_media/input.scss which could be a perfect test case, but I still have an error.\nBut I think it's more a \"bad use\" than a bug. What do you think ?\nSCSS\n$media1: screen;\n$media2: print;\n$var: -webkit-min-device-pixel-ratio;\n$val: 20;\n@media $media1 and ($var: $val), only $media2 {a: b}\n. If you confirm that's was a bad example, I think use an example like that : \n``` SCSS\n$viewport1: \"only screen\";\n$viewport2: \"(min-width: 700px)\";\n// Will not work\n@media #{$viewport1} and #{$viewport2} {\n  body {\n    background: #3d3d3d;\n  }\n}\n```\n(I've seen this example still have a problem, it ignored $viewport1 ... I'll try to check that tomorrow)\n. Did you clean the workspace before build ? It looks like old .o having conflict with new ones.\n. I remember that the version of GCC on Mac OS is old as the hills. So it can be the reason of the failure. But I've no idea of the solution.\nPeople on mac should look at this style of issues, I'm not sure that's a libsass problem.\n. Oups, sorry, the right code is :\n``` CSS\n$test: null;\n.test {\n  background-color: $test;\n  color: blue;\n}\n```\nI searched to resolve this myself, but the output code is a bit tricky for me ^^\n. Problem was fixed in the above pull request. But it's a quick fix, so it still remain a difference with ruby sass.\n``` CSS\n$nonEmptyVar: red;\n$emptyVar: null;\n.test {\n  background-color: #{$nonEmptyVar};\n  font-family: #{$emptyVar};\n  color: $emptyVar;\n  font-size: null;\n}\n```\nShould output\nCSS\n.test {\n  background-color: red;\n  font-size: null; }\nand input in my fix\nCSS\n.test {\n  background-color: red; }\nBut \"null\" means nothing in css, so I think this is a sass bug and so, I prefer this fix instead of the current version, printing a lot of empty declarations ;)\n. Tests added in hcatlin/sass-spec#4 ;)\n. ",
    "phamann": ":+1: for this feature! This is the only thing stopping us from using this great tool.\n. ",
    "masterbee": "@akhleung, thanks for the work on this placeholder issue. Just wondering if this was implements and committed to the build? since as @phamann states would allow us to really leverage this great tool.\n. ",
    "trevc": "Thanks to everyone involved in making this happen. I also use placeholders extensively in every project. Any updates? \n. ",
    "ebryn": "ping - any update?\n. @akhleung thanks!\n. ",
    "toolmantim": ":heart: you @akhleung \n. ",
    "nc": "+1\n. Awesome. Can't wait to see it merged in.\n. ",
    "tgecho": "Works on my end. Thanks!\n. Apologies... my little test file didn't actually include comparisons of the returned values with a manually created version of the value.\nHue works correctly (comparable(hue(red), 1deg) returns true), however lightness and saturation are still not correct...\ncomparable(lightness(red), 1%) returns false\ncomparable(saturation(red), 1%) returns false\n. Thanks!\n. The first one is due to missing support for ... variable length parameter lists. This was fixed recently, but depending on how you're using it you may not have the latest versions (all of the python wrappers are 2+ months out of date, for example).\nThe second error is caused by the bug from #83. As a short term workaround I ended up creating a custom copy of the _bourbon.scss that imported all of the modules I actually use, which happens to not include the keyframes one.\n. ",
    "twhid": "Greetings, \nUsing sassc.\nUpdating libsass submodule to point to latest master commit: 9c05850487ecc5ca187d204fcb9b1f443d66f0bf fixed the param list issue.\nContinue to see: \nbourbon/css3/_keyframes.scss:12: error: non-terminal statement or declaration must end with';'\nThanks for any help.\n. If you'd like to point me to the relevant parts of the code I may have the resources to work on it a bit.\n. Greetings!\nOn sassc and updated the libsass submodule 9fad4b76661b36c4e7fae69c655146ca24b4b4df\nTesting on bourbon. Unfortunately:\nbin/sassc -o bourbon/_bourbon.css bourbon/_bourbon.scss\nbourbon/addons/_retina-image.scss:6: error: URI is missing ')'\nThat scss looks like this:\n``` scss\n@mixin retina-image($filename, $background-size, $extension: png, $retina-filename: null, $asset-pipeline: false) {\n  @if $asset-pipeline {\n    background-image: image_url($filename + \".\" + $extension);\n  }\n  @else {\n    background-image: url($filename + \".\" + $extension);\n  }\n@include hidpi {\n@if $asset-pipeline {\n  @if $retina-filename {\n    background-image: image_url($retina-filename + \".\" + $extension);\n  }\n  @else {\n    background-image: image_url($filename + \"@2x\" + \".\" + $extension);\n  }\n}\n\n@else {\n  @if $retina-filename {\n    background-image: url($retina-filename + \".\" + $extension);\n  }\n  @else {\n    background-image: url($filename + \"@2x\" + \".\" + $extension);\n  }\n}\n\nbackground-size: $background-size;\n\n}\n}\n```\nIf I remove that add on, I get an empty file.\nThe huge.scss test seems to work fine. By that, I mean to say it outputs something that looks correct given a cursory look.\nLet me know if you'd like me to submit this as a bug or if you need more information.\nBest,\n. Sorry, my bad (I've been away from this for a while). Compiling only Bourbon the expected output is a blank file.\nMy initial simple test outputs as expected:\n``` scss\n@mixin simple-media-query($max-width, $min-width) {\n      @media only screen and (max-width: $max-width) and (min-width: $min-width) {\n        @content;\n      }\n}\n@mixin test($value) {\n    border-color: $value;\n}\nbody \n{\n    @include test(\"#ccc\");\n    @include simple-media-query(900px, 400px) {\n        border-color: black;\n    }\n}\n```\ncompiles to:\ncss\nbody {\n  border-color: \"#ccc\"; }\n  @media only screen and (max-width: 900px) and (min-width: 400px) {\n    body {\n      border-color: black; } }\nDoing more testing. Will get back to you with any findings.\n. This affects common font shorthand rules. \nTest input:\n``` scss\n$a: \"my-string\";\n$b: my-string;\n.test1 {\n    font: 12px/18px $a, sans-serif;\n    font-family: $a, sans-serif;\n}\n.test2 {\n    font: 12px/18px $b, sans-serif;\n    background: $b url($a) repeat; \n    font-family: $b, sans-serif;  \n}\n```\nExpected (Ruby Sass) output:\n``` css\n.test1 {\n  font: 12px/18px \"my-string\", sans-serif;\n  font-family: \"my-string\", sans-serif; }\n.test2 {\n  font: 12px/18px my-string, sans-serif;\n  background: my-string url(\"my-string\") repeat;\n  font-family: my-string, sans-serif; }\n```\nBad (sassc/libsass) output:\n``` css\n.test1 {\n  font: 12px/18px $a, sans-serif;\n  font-family: \"my-string\", sans-serif; }\n.test2 {\n  font: 12px/18px $b, sans-serif;\n  background: my-string url(\"my-string\") repeat;\n  font-family: my-string, sans-serif; }\n```\nClosing #106, it's a dupe.\n. Dupe of #92\n. ",
    "vaanwd": "Failed to compile on Windows with MinGW.\ng++ -Wall -O2 -fPIC -c -o node.o node.cpp\nnode.cpp:1: warning: -fPIC ignored for target (all code is position independent)\nnode.cpp: In member function 'std::string Sass::Node::debug_info_path() const':\nnode.cpp:90: error: 'realpath' was not declared in this scope\nmake[1]: *** [node.o] Error 1\n. ",
    "lbastendorff": "Is this not what the sassc -I (import) option does, or am I missing something?\nUsage: ../sassc [OPTION]... [FILE]\nOptions:\n   -o OUTFILE     Write output to specified file.\n   -t NAME        Output style. Can be: nested, compressed.\n   -l             Emit comments showing original line numbers.\n   -g             Emit source map.\n   -I PATH        Set Sass import path.\n   -h             Display this help message.\nOr was this option added in response to this issue and therefore this issue should now be closed?\n. Got it. Failed to realise we were talking about environment variables. \n. My first ever post on Git Hub went well then!\nI think I have duplicated this bug, or at least part of it.\nHowever I did post a solution, see issue #141 \n. Sure, but if it errors in read_file then resolve_and_load needs to understand that and carry on trying the adjusted paths.\nI.E. if abc/xyz is a directory and errors in read_file then resolve_and_load needs to carry on and try abc/_xyz then abc/_xyz.scss and then abc/xyz.scss\n. @akhleung thanks, I'll use a pull request next time.\nSo to keep it simple your end I presume I should fix each issue in its own commit then describe the purpose of the change in the commit message?\nI might start work on some Java JNI bindings soon (in a separate sassj project following the naming convention of sassc), I've seen it muted on here before but I'm not currently aware of an existing project. Obviously I would have ant scripts to make compilation a breeze on any platform.\n. The solution I have for this is in parser.cpp\nIn the method parse_relation the expr2 variable should be the result of parse_relation rather than parse_expression.\nThis way the right hand side of an == or != expression can be another == or != expression.\nThis is the code I have now:\n```\n  Expression Parser::parse_relation()\n  {\n    Expression expr1 = parse_expression();\n    // if it's a singleton, return it directly; don't wrap it\n    if (!(peek< eq_op >(position)  ||\n          peek< neq_op >(position) ||\n          peek< gte_op >(position) ||\n          peek< gt_op >(position)  ||\n          peek< lte_op >(position) ||\n          peek< lt_op >(position)))\n    { return expr1; }\nBinary_Expression::Type op\n= lex<eq_op>()  ? Binary_Expression::EQ\n: lex<neq_op>() ? Binary_Expression::NEQ\n: lex<gte_op>() ? Binary_Expression::GTE\n: lex<lte_op>() ? Binary_Expression::LTE\n: lex<gt_op>()  ? Binary_Expression::GT\n: lex<lt_op>()  ? Binary_Expression::LT\n:                 Binary_Expression::LT; // whatever\n\n//Expression* expr2 = parse_expression();           << Original Code\nExpression* expr2 = parse_relation();\n\nreturn new (ctx.mem) Binary_Expression(path, expr1->line(), op, expr1, expr2);\n\n}\n```\n. Your right, I didn't give that enough testing. I was focusing too much on what I want as an end goal and not enough on the quality of my change. I was a bit hasty in posting these \"solutions\". I think I should come back with a pull request for these fixes and the next ones that are already in the works after more testing.\nI'm looking to get Sencha ExtJS 4.2 compiling you see.\nI know it has a compass dependency but I'm hopeing to wean it off any compass mixins that use ruby script.\nThe goal is to integrate this with a larger java application but as a spin off I thought I might push a project that allows the Sencha build tools to use libsass (these are also written in java).\nFor the extension to Sencha's build tool (Sencha CMD) to work I would need to get my extension compiling the vanilla ExtJS scss files (the same as ruby) otherwise users of ExtJS who wanted to use my drop in extension would need to patch their ext source before trying to compile.\nHowever for making the large Java application that I am working on compatible I'm not worried about changing the ext scss files a little, I already have a patches folder with many custom changes in it, where appropriate I offer these patches to Sencha but some of them are quite bespoke and would not suit other Ext users.\nI think it might be wise for me to switch to making some Java bindings, that way I can use JUnit to keep a check on me :)\n. Nooooooo.... apparently sencha are adding their own ruby functions. My desire to get senchas extjs to compile on libsass just got even harder. thanks for spotting that I had no idea.\nDid I hear there were plans to allow plugin functions in libsass? What would that look like? Im wondering if a java wrapper could pass dynamic functions which when executed could call back into java and therefore user defined java methods...\nRegarding java bindings I have some experience compiling my own jni code but I've just come across jna which is a dynamic wrapper arround jni allowing me to skip the need to write any c code myself.\nMight not quite have the form I expected but might slash the development time.\nI'll need to think about performance of that though. \n. Thats must also be why some sencha code fails when using ruby sass when I try to compile the scss files direct without using the config.rb file!!!\n. So if you could add your own functions from c++ you could add file_join and it would be treated like a builtin? Meaning that this url brackets problem could be real?\nEdit: by real, I mean you could create the issue while sticking to the libsass framework\n. I think I've seen a very long regular expression kicking around the internet which I think a lot of applications use to identify a valid URI. I don't suppose a regex would help?\n. You probably want to look at the entry for: RFC-3986 URI component:  URI\nhttp://jmrware.com/articles/2009/uri_regexp/URI_regex.html#uri-40\nIts long though, not sure it could be easily translated into another pattern matching template.\n. 20 minutes of our 45 minute build time is down to ruby sass. Still hope we can get libsass to do the compass work oneday. Long term goal is to be able to recompile the sass based on variables customisable on the front end. Then the user would save variables relating to font styles and background colours in the web gui and the sass would need to compile in a much more sensible time frame and take effect within the application.\n. Yui compression uses the mozilla ast tree for javascript and css decoding and encoding.\nPerhaps a java tool to normalise the css is the way forward.\nA while back I was working on a java wrapper round libsass and I wrote a test library that compiled code with ruby sass via jruby (for my purpose I embedded the compass gem inside the jruby jar and got that working) ;)\nI then compiled the sass code with libsass via my java wrapping and collected junit results.\nWriting and algorithm to compare the two files without considering whitespace was ok for my simple tests.\nAll I proved was there is a long way ti go on compass support.\nI should push what I have on git hub but I'm a perfectionist and its not perfect.\n. Some corrections to my previous post! - Looks like I jumped the gun and got over excited while I didn't have access to a computer to check myself :(\nOK, I'm looking at what Java code I have and the unit tests I refer to were comparing the libsass input/output with the examples in sass-spec. I did not compare the ruby results with the libsass ones.\nBut I do have Java code that can produce results from Ruby and separate Java code that can produce results from libsass. Also I do have JUnit tests that are comparing two inputs without considering whitespace.\nRegarding normalisation I would definitely focus on a solution using a CSS Abstract Syntax Tree if there is one available but although the Yui compressor does use Rhino's AST engine for JavaScript compression I was wrong about it doing the same for CSS compression.\nIt just uses string and regex...\n. CSS Abstract Syntax Tree: https://github.com/css/gonzales\n. ",
    "xtianus79": "So what was the final outcome of this?  I feel it is should be native to using sass sheets however that is achieved \n. ",
    "metaskills": "If you are using Ruby and either Ruby Sass or SassC with SassC-Rails, we have found this little gem useful and everything just works no matter which pre-processor we use.\n. WHOOPS! Link here: https://github.com/customink/sass_paths\n. ",
    "robbschiller": "Would love a fix on this as well! \n. Still doesn't seem to be working correctly here...\nWith libsass @ 1346e04\nSass via:\ncss\n$palm-end: 480px;\n@media only screen and (max-width:$palm-end)\nCompiles to:\ncss\n@media only screen and (max-width:$palm-end)\n. @Nabellaleen awesome. Thanks for the update and my apologies for not seeing the recent commit. The grunt-sass task I was testing on is using  1346e04. \nI've got the above queries working via fd423d1.\n. ",
    "jmreidy": "+1\n. ",
    "mixonic": "I'm still seeing this @akhleung - what should have fixed it? I'm running node-sass from master.\n. Sorry, I take that back. On master of node-sass I'm seeing https://github.com/andrew/node-sass/issues/127, but I was incorrect that I was seeing this issue again on master. Thanks!\n. ",
    "sorccu": "Having converted a fairly large project from SASS to libsass, this was the number one compatibility issue. The rest of the problems were mainly due to weird usage patterns that just happened to work with the official compiler. Therefore I feel that fixing just this one issue has the potential to improve compatibility immensely.\n. This is due to #92. If possible, comment there so that we can get some attention to the issue.\n. This patch looks good to me (although I'm completely unrelated), but the pull request could be a little more clear in what it does. The description is pretty random until you read the commit messages :)\nAlso, if you used feature branches, you wouldn't have to pile different patches into a single pull request (thus reducing the chance of it getting merged)! I really do need the #92 fix though, so hopefully this will get merged soon.\n. In our case the usage was particularly bad because the .foo .zup (from case 1) wasn't even required at all in the output. Only #bar .zup was. So while it worked, it created a whole bunch of trash code.\n. ",
    "dthunziker": "+1 indeed. I feel it's very close to being able to compile Bourbon with the latest commit of libsass\n. I could be looking in the wrong place, but it looks like it was in the initial commit of sass.\n. Man that was quick, thanks Aaron! It works great!\n. ",
    "aslakhellesoy": "It would be great to have this fixed - zurb foundation uses this style: https://github.com/zurb/foundation/blob/master/scss/foundation.scss\n. ",
    "tofumanchu": "Yup.  Would love this for foundation support.  As it stands, I now have to pre-preprocess my SCSS files.\n. ",
    "pho3nixf1re": "What is the status of this?\n. ",
    "garthenweb": "Tested it with the ruby sass command line tool on windows and the online testing tool, both return:\nscss\nbody {\n  width: calc(100% - 3em); }\nSo they are working properly!\n. ",
    "msokk": "I have the same issue with node-sass, does anybody know a workaround?\n. ",
    "declantraynor": "I'm using the sassc command-line tool and ran into this same issue. While its no fix, a workaround is to use 'unquote' when writing your calc expression in SASS:\ncss\nbody {\n  width: calc(unquote(\"100% - 3em\"));\n}\n. ",
    "zakdances": "Are you still experiencing this issue?\n. Was a commit ever pushed to fix this?\n. ",
    "togakangaroo": "Did this end up getting fixed? \n. ",
    "kvakes": "@akhleung can you reference the commit where it was fixed, please? It is not included in 1.0.1 release, correct?\n. @akhleung We have a hotfix for it using unquote(), so we're good for now, but is there a hash that we can upgrade to to fix this? Are you guys planning to roll out a new release soon? Do you need any help?\n. ",
    "valentinvoilean": "Hello. I'm using gulp-sass 2.1.1 and I'm facing issues with the calc function and the \"+\" operator:\nThis min-width: calc(100%  +  5em) becomes this min-width: calc(100%+5em)\nI tried these without any luck: \nmin-width: calc(#{unquote(\"100% + 5em\")});\nmin-width: #{unquote(\"calc(100% + 5em)\")};\n. ",
    "MusicalCreeper01": "This is now an issues when using gradiants, e.g:\n$background-moz: -moz-radial-gradient(center, ellipse cover,  #333760 0%, #1f2038 0%, #151925 100%); /* FF3.6-15 */\n$background-webkit: -webkit-radial-gradient(center, ellipse cover,  #333760 0%,#1f2038 0%,#151925 100%); /* Chrome10-25,Safari5.1-6 */\n$background-others: radial-gradient(ellipse at center,  #333760 0%,#1f2038 0%,#151925 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\n$background-ie: progid:DXImageTransform.Microsoft.gradient( startColorstr='#333760', endColorstr='#151925',GradientType=1 ); /* IE6-9 fallback on horizontal gradient */\nThe spaces for things like eclipse at center and #151925 100% are removed. Using unquote does not seems to fix this either.\n. ",
    "sebastianschnock": "I can confirm that it breaks when using calc in gradiants. Can this be reopened?. ",
    "xkisu": "@xzyfer Wouldn't it be better to just re-open this ticket which already has all the relevant information and examples of the issue? . ",
    "alexzorin": "@Nabellaleen Trial and error + mingw64, see this. Not the mark of somebody who knows what they're doing but I was able to link go_sass this way without the symbol errors.\n. ",
    "jgnewman": "Yes, perfect. Thanks.\n. ",
    "donaldallen": "Is there any update on this issue? libsass appears to still be putting in null values.\n. ",
    "blackfalcon": "``` scss\n@function color($val) {\n  @if type-of($val) == color {\n    @return $val;\n  } @else {\n    @return null\n  }\n}\n.block {\n  color: color(foo);\n}\n```\nreturns \ncss\n.block {\n  color: null; }\nAny update on getting this addressed?\n. @akhleung any progress on this missing feature?\n. Congrats to everyone all around! This is the final step we needed to move forward and have the community build more trust in this version of the language. \nlibsass is ready for primetime! I am calling it!\n. Just opened (and closed) an issue about this as well. It would be nice to get this cleaned up as there is a fundamental shift of CSS to start using more and more function like syntax with overlap. \nYeah @kennethormandy, thanks for the workaround idea, but when you do that, then you kill the actual grayscale() function and that sucks! I am hoping that a real fix to this comes soon. \n. https://developer.mozilla.org/en-US/docs/Web/CSS/:any\n. This is most widely used with user agent stylesheets to set automated heading styles to fit the HTML5 outline model. \n. So it is. \n. I can respect that. \n. Regardless of use with mixin or not, the issue persists when trying to create a combination selector based off the parent in the Sass using a child selector. In this example, the desired output from rubySass is not the same as libSass.\nscss\n.parent {\n  width: 100%;\n  @at-root .child#{&} {\n    width: 50%;\n  }\n}\nrubySass\n.parent {\n  width: 100%;\n}\n.child.parent {\n  width: 50%;\n}\nlibSass\n```\n.parent {\n  width: 100%;\n}\n.parent .child.parent {\n  width: 50%;\n}\n```\nGive it a run in SassMeister to see. \n. ",
    "caldwell": "I merged this branch with #118 since they were conflicting. Closing...\n. I added a second commit here that passes the list.separator back into the Node when converting lists.\n. Ok, the commit from #116 (not #114, I was wrong in the first comment) is now included here. I think the rest should apply without conflicts.\nI saw that the C callback stuff only went in about a week ago so I was expecting it to be a bit rough around the edges. I've got it mostly working now, just a couple more things to test and it'll be basically working on the Perl side. My plan is to finish up tomorrow.\n. ",
    "tregusti": "I would really like something mentioned in question 1 too.\n. ",
    "benfrain": "So using the node-sass version of libsass is amazing. Bravo folks. Makes compiling absolutely trivial. I'm also a fan of source maps so it will be stellar if and when that feature makes it in. At present it's a choice of convenience (source maps) vs speed (libsass) so looking forward to not having to make the choice.\n. @akhleung Amazing. Thanks!\n. Luis, Hampton (@hcatlin) actually retweeted the Bounty Souce Tweet about this last night: http://twitter.com/Bountysource/status/407904771941883905\n. @LaurentGoderre you can always chip in on the bounty ;) I can't help code wise either but I'm hoping the promise of a mighty tequila for their efforts might inspire those more capable!\n. Just to echo everything Luis said :)\n. I've just added a bounty for this. I like to think it will buy those involved a beer/hot beverage/cocktail of choice whenever this gets finished. https://www.bountysource.com/issues/1057456-extend-classes-wont-compile-correctly-with-both-regular-and-silent-selectors/bounties\n. It would probably make sense to create a codepen, sassmeister or gist with your existing Ruby based Sass code. There are different approaches that can work around some of the remaining extend issues. \n\nOn 7 Aug 2014, at 10:51, nchafai notifications@github.com wrote:\nHi everyone,\nAlthough I know @akhleung has huge work to resolve this issue, does anyone know how to adapt our code in order to dodge these @extend issues ?\nI mean, Ruby-Sass is currently taking about 30sec to 1min on my (slow) computer so that I do have to use libsass. But the generated CSS is completely wrong due to these @extend.\nIs there any workaround ?\n\u2014\nReply to this email directly or view it on GitHub.\n. Brilliant. Just checked my mail and I opened the bounty on the 7th Nov 2013! It sounded like a Herculean task so Its great to see it finally closed after all these months. Great work all involved. \n\nCan't wait to use it in the wild :)\n\nOn 3 Oct 2014, at 18:22, Hampton Catlin notifications@github.com wrote:\nA year after its opening... I'm ridiculously, incredibly excited to click the close button on this issue. Thanks to @uberska @jaddessi and @michaek this mega-extends-issue can now be closed. The original test case now passes, as do many, many, many, many other new ones written by the team at @dealerdotcom. Also, super thanks to @paulirish for funding the bounty on this and never letting us forget that this was pending. So, @uberska what are you going to do with the bounty? ;)\n\u2014\nReply to this email directly or view it on GitHub.\n. Yes, I just hit this too.\n. I understand globbing it's not part of Sass 'as is' (although I wouldn't complain if it was ;)). THerefore, as there is no equivalence with the Ruby 'require' method in libsass (as I understand it) does that mean there is likely to be no way of facilitating globbing imports?\n\nOr, perhaps the better question may therefore be, is there likely to be any changes that will bring globbing support into Ruby Sass?\n. @justnorris I don't think there was ever a patch there for the taking. Don't want to speak for @hcatlin but I think he was indicating that if someone could write the patch he would be happy to pull it in.\n. @bdkjones do you mean bugs as in it actually creates compile bugs? Or do you just mean it can affect the cascade in a way that doesn't suit the way some people write CSS?\nIf the former I'd be more inclined to agree with you. \nIf the latter I'd argue it simply doesn't match the way you/that person is writing CSS. I'm using it on projects with 80+ partials, all with very flat selector specificity and hence never get any issues because I'm not reliant on cascade order - where I believe Sass globbing earns its keep. It's certainly not something to be used trivially on all projects but that doesn't mean it shouldn't be 'a thing'.\nCan you confirm what you mean by bugs in this respect?\n. @bdkjones I feel your pain but that's a case of don't hate the game, hate the player ;)\nSass globbing works exactly as it should and has clear use cases. It serves the needs of larger projects especially because it allows fragmentation of the Sass code base across many partials for better maintainability without the need to continually declare each with an @import statement.\nIf a user is getting issues, as you have pointed out, it's the way they are writing CSS and using the feature that is at fault, not the feature.\nI know the Sass devs are looking at a new @import mechanism for v4 so maybe they have a way to cater for both camps but for now I think Globbing is a great tool. I'm not sure that keeping it from users because 'some use it incorrectly' is the right thing to do.\n. It's usually accessed in Ruby Sass as a require. The plugin itself is at this repo: https://github.com/chriseppstein/sass-globbing\n\nOn 5 Feb 2014, at 18:53, Aaron Leung notifications@github.com wrote:\nJust to clarify, is a feature like this already accessible in Ruby Sass (e.g., via a custom Ruby extension or something), or is it just a Ruby feature that you'd like LibSass to support?\n\u2014\nReply to this email directly or view it on GitHub.\n. On reflection I probably asked the wrong question as the merits (or not) of Sass globbing are unlikely to agreed upon between the participants here and really not the important factor. \n\nI'll ask a different question: could a 'require' or similar plugin facility make it's way to libsass? That way it would provide the potential for plugins like globbing to be added outside of the features core Sass provides. That way those that love the feature can hopefully find a means to make use of it. \n. Not sure if this has been sorted as I'm running the most recent Grunt Sass (in turn running from Node-Sass) however interpolation isn't working for me within font-face declarations either. For example, this fails at present:\n$font: \"../css/fonts/\";\n@font-face  {\n    font-family: 'myfont';\n    src: url(#{$font}myfont.eot);\n    src: url(#{$font}myfont.eot?#iefix) format('embedded-opentype'),\n        url(#{$font}myfont.woff) format('woff'),\n        url(#{$font}myfont.ttf) format('truetype'),\n        url(#{$font}myfont.svg#myfont) format('svg');\n    font-weight: normal;\n    font-style: normal;\n}\n. Excellent. Thanks for the great work :+1: \n. ",
    "dylang": "Over 30 Node modules are using Mozilla's source map module for their source map support. I'm not sure if this will be helpful, maybe inspiration at least:\nhttps://npmjs.org/package/source-map\n. ",
    "thousand": "Any motion on this front?\n. ",
    "paulirish": "Just to correct one thing: CSS sourcemaps are not a feature that's specific to Chrome. \nFF has already implemented JS sourcemaps and Visual Studio has as well. \nBoth CSS and JS sourcemaps are built off the same language-agnostic v3 spec of sourcemaps\n. @svnieuw you're testing the cmd-click on the properties/values as well, yes? Just making sure as there's a lot more to sourcemap support than just the ruleset line mapping.  Cheers\n. Link to @svnieuw 's commit adding support: 366bc110c39c26c9267a1cc06e578beb94cd93ef\n. Huge thanks to all the supporters on Bountysource!  $2000 was raised for this feature! whoa.\nThanks to photoshelter.com via @Westbrook  who contributed $1000 of that!\nAnd big ups to @DealerDotCom who sponsored @uberska's development time on the project. Awesome work, everyone.\n. Impressed with the coordination across projects such they all release the same day! Nice work to @hcatlin and all the maintainers for making this nice for all users. :D\n. FWIW here's the visualization of this example \n. cc @aslushnikov for his guidance on handling this sourcemap issue.. ",
    "filaraujo": "+1\n. awesome, great work\n. ",
    "jrencz": "+1 for me too. I hope this feature will be added soon\n. +1\n. ",
    "gerryster": "+1.  C is hard.  Lets go shopping!\n. ",
    "nschonni": "https://www.bountysource.com/ might be an option for that. I know JSHint is using it that way.\n. @chriseppstein since the title and most of the discussion aren't about the scripting systems, maybe it should be closed and a new issue specific to the scripting system be opened (can't remember if there already is one)\n. I didn't see this and added the Clang + gcc to the Travis matrix. You may need to rebase.\n. Probably the wrong type of question for the bug tracker, you might get a better response on something like StackOverflow\n. That include is Compass/Ruby version. Can you reproduce it with a native Sass @include?\n. Dupe of #159\n. I was thinking of \"borrowing\" the docs from the Ruby version. \n- What format makes sense though? Doxygen, QDoc, etc...\n- 3.2 or 3.3 docs?\n. I was tempted to align with the Ruby version https://github.com/nex3/sass/blob/adf11a212cea43750b9ba122da7a4a647e8d98b1/lib/sass/script/functions.rb#L1326-L1341 but I wasn't sure if this version also used the 1 based lists\n. Added back the zero check. Let me know if you want me to quash (or close if you have a better way :wink: )\n. @akhleung is this still mergable or did you fix this when you merged in the extend branch?\n. Don't you feel lighter :smile: \n. Might help to split the declarations to separate lines and then run again to confirm which \"opacity\" property it is choking on.\nscss\ndiv\n{\n  -moz-opacity:.8;\n  opacity:.80;\n  filter:alpha(opacity=80);\n}\n. Yeah, I found the SassC testing broke unless I kept at least the interface files at the top level\n. @akhleung should I bother rebasing or do you want to tackle this later?\n. Rebased, but I wasn't sure about what to do with those test_* files. Also the path.hpp, trim.cpp, trim.hpp, and subset_map.hpp seem to be related to those test files only, but I moved them for now (without fixing the test files).\n. PS: failures are related to the extend stuff and not the move :wink: \n. @akhleung is this still mergable?\n. I don't think the Windows style paths are valid whether they are escaped or not. Going by the spec https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit?pli=1#! any paths need to be in URL format\n. The changes were from #329, but I still believe that this was patched in the wrong place.\nNode-sass won't be updated anytime soon because there are more regressions for @extend since the last submodule update.\n. @akhleung thoughts? I know there are bigger blockers right now around the @extend tests though.\n. OK, I'll see if I can make some time this week. I keep hitting a wall on my work PC because I can't even get it to compile with Visual Studio 2010. \n. tint is a Compass function and not a Sass built-in\n. > it broke some other build script that I was using.\nWas that for the test_* files? I didn't update the headers in those.\n. Closing since the src move was reverted\n. @akhleung yeah or nay? \nI'm looking at doing a bootstrap script for cloning the dependencies inside the project (git ignored) once I can sort out how to export the SASS_LIBSASS_PATH properly\n. Closing in favour of #258\n. @kennethormandy we haven't updated node-sass beyond the 1.0.1 tag yet so this regression shouldn't apply\n. Actually sassc++.cpp is referenced in the Automake setup, but I can't run that on my machine because of the old version of Autoconf that is used (@QuLogic pointed that out elsewhere)\n. It is referenced here https://github.com/hcatlin/libsass/blob/master/Makefile.am#L16-L18 but it doesn't look like it is called anywhere. @QuLogic since you seem to get Automake better than I do is there something I should be replacing those values with or can the lines just be removed?\n. Thanks! I've removed those lines now\n. OK, I've rebased and included only the sassc++ changes.\nI'll do a separate PR to move the test files\n. Without a copy of the SCSS, there is no way to diagnose this. The linked issue also gives no error context, but speaks to a grunt globbing issue.\n. Commenting out code in master is pretty bad too. Can you try to keep master clean???\n. What about PostCSS https://github.com/ai/postcss\n. The expanded style isn't currently implemented, see #233\n. Thanks for the feedback @QuLogic! It's been a long time since I did C building, so I appreciate the pointers.\n. PS: @QuLogic I've started to clean and rebase here https://github.com/nschonni/libsass/tree/src-files-cleanup and will push back to this PR once finished. Feel free to PR to that branch for any improvements\n. @QuLogic I've rebased down if you want to have another look.\nI still need to add back the emscripten target though\n. > Also, can CMake be configured to disable testing (because maybe someone doesn't want to install Ruby)?\nYup, that's what i did here https://github.com/hcatlin/libsass/pull/292/files#diff-15547c54d3d4898a882b4ab7b3cee381R21\n. @QuLogic is is better to repack the test exes with the libsass.a or just copy the file to the bin folder for dynamic loading?\n. > I see a few warnings with Doxygen 1.8.6:\n:+1: ran the upgrade and moved it to the build directory\n. Yeah, I think there is still value and this should be simpler now that the Emscripten stuff has been removed. This likely needs to start from scratch as I also moved the source files in this making it painful to rebase.\nPS: another good example of a cross platform lib leveraging it https://github.com/libgit2/libgit2/blob/master/CMakeLists.txt?ts=4\n. That's great @mgreter !\n. To make this easier for others once the zip invariably gets deleted\nSource\n``` scss\n$skin-name: \"CMS_Black\";\n$QUOTE: unquote('\"');\n$EMPTY_STRING: unquote( \"\" );\n$SLASH: unquote(\"/\");\n$SKINS_PATH: unquote(\"/CMS/Skins\");\n$URL_SEPARATOR: $SLASH;\n$URL_PREFIX: $EMPTY_STRING;\n$URL_SUFFIX: $EMPTY_STRING;\n$_URL_PREFIX: $URL_PREFIX + $EMPTY_STRING;\n$_URL_SUFFIX: $URL_SUFFIX + $EMPTY_STRING;\n$_URL_SEPARATOR: $URL_SEPARATOR + $EMPTY_STRING;\n$_SKINS_PATH: $SKINS_PATH + $EMPTY_STRING;\n@function webresource-image-url( $skin, $control, $file ) \n{\n    $_url: $EMPTY_STRING;\n    $_path: $_SKINS_PATH $skin $control;\n@each $_part in $_path {\n    $_url: $_url + $_part + $_URL_SEPARATOR\n}\n\n@return $_URL_PREFIX + $QUOTE + $_url + $file + $QUOTE + $_URL_SUFFIX;\n\n}\n@function global-image-url( $skin, $control, $file ) {\n    @return webresource-image-url( $skin, $control, $file );\n}\n@function skin-image-url( $control, $file ) {\n    @return global-image-url( $skin-name, $control, $file );\n}\n$actions-sprite: skin-image-url( \"Common\", \"radActionsSprite.png\" );\n.test \n{\n    background-image: url( $actions-sprite );\n}\n```\nExpected\ncss\n.test {\n  background-image: url(\"/CMS/Skins/CMS_Black/Common/radActionsSprite.png\"); }\nActual\ncss\n.test {\n  background-image: url( $actions-sprite ); }\n. Dupe of #273 which is fixed in master. You will need to wait for https://github.com/andrew/node-sass/issues/233 for a fix to bubble up to your IDE, but till then you can use the solution from the linked issue\nscss\n.test \n{\n    background-image: url('#{$actions-sprite}');\n}\n. @cooperaj can you try re-installing grunt-sass, to try and get the latest node-sass version? 0.8.3 included a bunch of the @extend work that @akhleung did over the past month.\n. The get_cwd shouldn't change, the issue is that the sourceMaps should be using a URL for sources and not file paths\n. You can get it working by wrapping it with quotes and then unwrapping it with unquote\nscss\n.selector { height: unquote(\"-webkit-calc(100% - 40px)\"); }\n. Hmm, couldn't reproduce it on http://sassmeister.com/ or node-sass. What project are you using to compile that is causing the crash?\n. @akhleung this is another regression like #342\n@Paxa node-sass uses  1122ead208a8d1c438daaca70041ef6dd2361fa0 where this was still working\n. It's a hack, but the following works\n``` scss\n$variable: 1;\n$interpolation: #{$variable}px;\ndiv {\n  top: unquote(\"\" -$interpolation);\n}\n```\nConverts it to a string, and then unquotes the value\n. See http://sass-lang.com/documentation/file.SASS_REFERENCE.html#comments as only loud comments (/*! */) survive the compressed version\n. @at-root is 3.3 syntax that libsass does not yet support\n. https://github.com/dlmanning/gulp-sass uses node-sass, which is a node wrapper for libsass (not the latest master though)\n. Related to #349\n. :wink: Someone wasn't using EditorConfig https://github.com/sass/libsass/blob/master/.editorconfig#L9\n:shipit: \n. Ha, I posted this here, forgot, then posted again as #490\n. Did you look at any of the other 3.3 related requests/discussions before posting https://github.com/sass/libsass/search?q=3.3&ref=cmdform&type=Issues or the compatibility issue #282?\n. Dupe of #151\n. It looks like you've got alot of unrelated changes in the PR\n. :+1: the longer this stays in the libarary, the more people that will start using it and making it more painful to remove from the API\n. @hcatlin I think this needs to go in the 3.0 release since it is a breaking API change\n. Yeah, the PR I threw over the wall is the nuclear option.\nI nicer in between option would be to keep the image_path option, but it have it spit out a message like\n\nimage_path has been removed from libsass till it becomes part of the Sass spec. Till then you can add this snippet to a mixin sheet\n@function image-url($url) {\n    // basic function that returns the correct url\n}\n\nI'm suggesting that we actually add the guts to the function, but my brain isn't fully cafinated yet.\n. Closing in favour of @michaek's  #489 since we must of had a race in terms of who hit the submit button first :wink: \n. Apparently I missed something or failed to commit something in context.cpp :blush:\nI also needed to make the following changes in sassc to get the local changes to run\n``` diff\ndiff --git a/sassc.c b/sassc.c\nindex 7e97ffd..e4826e1 100644\n--- a/sassc.c\n+++ b/sassc.c\n@@ -157,7 +157,6 @@ int main(int argc, char* argv) {\n     bool generate_source_map = false;\n     struct sass_options options = { 0 };\n     options.output_style = SASS_STYLE_NESTED;\n-    options.image_path = \"images\";\n     char include_paths = NULL;\n     options.precision = 5;\ndiff --git a/sassloop.c b/sassloop.c\nindex 992b594..d05d262 100644\n--- a/sassloop.c\n+++ b/sassloop.c\n@@ -4,7 +4,7 @@\n #include \"libsass/sass_interface.h\"\nint main(int argc, char argv)\n-{\n+{\n    if (argc < 3) {\n        printf(\"Usage: sassloop [INPUT FILE] [ITERATIONS]\\n\");\n        return 0;\n@@ -15,7 +15,6 @@ int main(int argc, char argv)\n        struct sass_file_context ctx = sass_new_file_context();\n        printf(\" ALLOCATED A NEW CONTEXT\\n\");\n        ctx->options.include_paths = \"\";\n-       ctx->options.image_path = \"images\";\n        ctx->options.output_style = SASS_STYLE_NESTED;\n        ctx->input_path = argv[1];\n        printf(\" POPULATED THE CONTEXT\\n\");\n@@ -31,10 +30,10 @@ int main(int argc, char argv)\n      else {\n        printf(\"Unknown internal error.\\n\");\n      }\n-     \n+\n      sass_free_file_context(ctx);\n      printf(\" DEALLOCATED THE CONTEXT\\n\");\n      sleep(1);\n    }\n    return 0;\n-}\n\\ No newline at end of file\n+}\n```\n. @mgreter this library has an EditorConfig file https://github.com/sass/libsass/blob/master/.editorconfig\nSee if your IDE has a plug-in and then you don't have to think about it anymore\n. Closing since implemented in #1359\n. @am11 I set it up originally, but the current setup was moved under Andrew's account and I removed the initial one. You should have access to log into the \"sass\" account on AppVeyor because you are part of the node-sass-owners GitHub team.\n. I added @sass/owners to the administators, but like Feodor mentioned there is no true org style object in AppVeyor so it's all under @andrew's token.\n. @mgreter I had just added the permissions only, but I enabled the hook now so your link should work\n. https://ci.appveyor.com/api/projects/status/s88o0u5qra2ng4vy/branch/master?svg=true\n\n[![Build status](https://ci.appveyor.com/api/projects/status/s88o0u5qra2ng4vy/branch/master?svg=true)](https://ci.appveyor.com/project/sass/libsass/branch/master)\n. OK, don't wait for me though, I haven't done C++ in awhile \ud83d\ude0a \n. Thinking it needs to be updated in https://github.com/sass/libsass/blob/master/src/sass_context.cpp, but I need to track down the values in Ruby Sass\n. Yeah, I can make the spec runner more tollerant to just say any exit code, but I figured I'd see if it would be simple to fix here before writing off the compatibility\n. Think the corresponding Ruby status codes are here https://github.com/sass/sass/blob/c7886e4ce87c87d1778fa89a1ff653a08595b3f9/lib/sass/exec/base.rb#L20-L40\n. Closing this one since Ruby now returns 13 on Windows. I'll update the issue to reflect this. @xzyfer you'll need to do it since you need repo admin to change the hooks\n. Looks like this came back again. Maybe it is also setup by some of the other maintainers like we had with the Appveyor duplicates\n. I think Windows sytyle paths have some workarounds in Ruby Sass, but you should use URL style paths along withe the includePaths since you're using node-sass.\n. Ugh, tried that \"Update Branch\" button but it ended up adding a merge commit. I'll rebase it properly when I'm home.\n. Not sure why Appveyor is stalling out in Debug mode.\n. It's odd because the other ones finish in 3 minutes, but it looks like that one timed out after an hour. Can't see whats actually fail though\n. https://github.com/sass/libsass/blob/master/docs/implementations.md#php\n. Do you think it's worth adding valgrind to the CI?\n. Look at it on Sassmeister, the behaviour is also different between 3.3 & 3.4+\nSass 3.3.14\ncss\n@media (\"min-width: \" 10px) {\n  /* here */\n}\nSass 3.4.21 & 4.0.0.alpha.1\ncss\n@media (min-width: 10px) {\n  /* here */\n}\n. @mgreter I left all the commits discrete if you want to cherrypick parts, or I can fastforward the branch with the latest.\nPS: There were more warnings, these where just the simple stuff. @xzyfer you mentioned you wanted to cherry-pick some stuff. I can do specific PRs for the parts if you call them out here. Rebased, but I'm going to need to go back and redo some stuff because of the switch to using Cast. Probably good to throw the \"Release - Breaking Change\" tag on this one so it gets called out in the release notes. @andrew is the other admin left (besides @xzyfer), I think I nuked myself when I handed over the AV org a long time ago. If you have a better GH team to sync as admins it would be good to get fixed going forward.. Yeah, this was more to discuss the settings, then it can be layered in. I'll go back and see about the include re-ordering since i think that might be a chunk of the failures\n. Yup, turning off the SortIncludes and re-running allowed me to build locally again. The travis failure looks like it's just a timeout, but I can't reset it.\n@am11 was there stuff from your clang-format that you want to add to this one? This was essentially just the vanilla setup with minor changes to the sort and pointer character sticking to minimize the diff.\nI'm happy to treat this PR as a WIP to just discuss the format changes, but I found that I couldn't layer on the options like you can in ESLint, since if you don't set options, it uses defaults for everything.. The other option is to adopt on of the company cofigs (style=? LLVM, Google, Chromium, Mozilla, WebKit) and do a big-bangish conversion.. \ud83d\udcaf \nWas thinking about how to trigger it, and the other way I thought of would be a special branch that could have its own CI config flags. Then just merge/push to the branch to trigger the run.\nNot sure if there are any good CI setups for C++, most of the ones I looked at don't really have the config. Just setup https://scan.coverity.com/projects/libsass to give it a try. They have a Travis-CI integration too if it looks promising. lol, might have hit the same thing as you, but I'm not sure if it's permission related. Looks like we need a coverity_scan branch https://scan.coverity.com/travis_ci. yeah, you can either do an offline and upload it, or setup the hook in Travis. just got the email, so i've deleted my copy. ah, I see \"Configure Travis-CI\" tab now. @xzyfer can you create a coverity_scan branch in the repo? I'll try and do a PR for the travis.yml to that branch to see if it picks up.  #2329, although I don't know if it is going to activate the plug-in for a pull request. Since the builds are pretty limited, I think keeping it in a separate branch makes sense https://scan.coverity.com/faq#frequency. In the end, I think the Travis config changes can land in master after they're worked out though, then the coverity_scan branch just created off master when needed. OK, we have results but we can't see them till they've approved the project \ud83d\ude1d https://scan.coverity.com/projects/sass-libsass. @xzyfer we have results now. Is there a reason not to make the results read-only to everyone?. I've got an idea for this now that Travis has cron jobs. I'll look at setting the Covirty branch to master, but only have it run if the Travis cron job flag is the trigger. I'll try and look at a PR tomorrow. What version on Clang are you running? The latest build on master with Clang 3.7 doen't have this issue https://travis-ci.org/sass/libsass/jobs/199527695. @xzyfer I think you'll need to merge this to see if it actually works since i'm not seeing the addon appearing in the PR config payload https://travis-ci.org/sass/libsass/jobs/201764378/config. True about the secrets, but i think the addon might also just be ignored for PRs since it doesn't show up in the config.. Looks like it really wants an email https://travis-ci.org/sass/libsass/jobs/201768367#L390\nI'll try mine for now, and just use a dummy in the end. Can you reproduce this with the latest node-sass? 3.13 is using an older libsass. Would you like to send a PR?. Thanks!. Can you try the either of the latest releases? 3.4.5 or 3.5.0.beta.3\nThis would likely be something from https://github.com/mgreter/sass2scss since that is what does the conversion. I think you're probably right about creating a test in sass-spec then. > My primary concern here is that having the internals documented implies a stability contract that we don't offer.\nRight now it doesn't even get pushed into the repo since it's gitignored. I just figured it was a good start to get it in place. Then the javadoc style blocks can be added to start indicating the stablity of parts before maybe adding it to a CI build publish. Commit that changed the behavour is https://github.com/sass/libsass/commit/12d8763b7f6851f0dbabdec4b47f92923a57e449\nIn node-sass, the patch to restore the behaviour was https://github.com/sass/node-sass/pull/1877. @xzyfer I just signed up https://hackerone.com/nschonni maybe you could add those that are missing.. OK, it wasn't so much about testing the segfault, just figured they unearthed some odd cases (that there are error messages for) that the other implementations might want to check too. looks like it's only called by the Autotools make, but I'll see if I can test that on my machine. Actually, since this is Autotools only, I'm not going to bother. Duplicate of #2426. Trying with Ruby 3.4.21 on sassmeister doesn't output anything.\nTo find the version of node-sass installed with gulp-sass, try npm ls node-sass. Can you also confirm the Ruby Sass version as well, since I didn't get any output when trying on Sassmeister.. I'm not :100: that the variables in the support query is supported, but using the @supports without the mixin works in both Ruby and Node so I'll update the title\nscss\ndiv {\n  @supports(display: flow-root) {\n    display: flow-root;\n  }\n}. Duplicate of https://github.com/sass/node-sass/issues/1911. This library is an implementation of the reference Ruby language spec, so unless it is implemented there, it won't be here either. Should be opened over at https://github.com/sass/node-sass, but openSSL isn't a build dependency directly, but I believe it is for NodeJS itself.. The previous behaviour was a bug that didn't match Ruby Sass behaviour and was corrected.\nYou can verify you get the same error on Sassmeister with Ruby 3.4.x. Failure seems related to https://github.com/travis-ci/travis-ci/issues/6307\nI'll try some fixes separately. https://www.w3.org/TR/2014/CR-css-syntax-3-20140220/\nRuby Sass outpust both correctly in 3.5 and 4.0, but libsass has trouble with the negative version only\nhttps://www.sassmeister.com/gist/bd4d877039b787fa24e35470eaa9c120. > 2017-08-21T19:28:29.9874926Z tunneling socket could not be established, statusCode=407\nMeans you have a proxy configured, but not properly for the vsts-agent. They changed a bunch of stuff for the proxy handling.\nClosing as this isn't the right repo. I would ask first at https://github.com/Microsoft/vsts-agent, an then https://github.com/sass/node-sass if they can't help you.. Locking since this has been asked and answered on the actual node-sass repo. Pleases search the issues there. I wonder if sniffing the registry key from https://msdn.microsoft.com/en-us/library/windows/desktop/aa365247(v=vs.85).aspx with https://stackoverflow.com/questions/34065/how-to-read-a-value-from-the-windows-registry would make sense. Although is seems like the \\\\ is pretty universal. Sorry, this is a language feature of Sass. If you want to remove them, you probably should use a CSS minifier.. Duplicate of #2109. This throws the same error with Ruby Sass https://www.sassmeister.com/gist/7da059f9a1a58586a0231d4d1d5d7388\n. @mgreter I think this would be a sass2scss thing. Duplicate of #2521. No problem, it happens. Great! Might want to take a look at https://github.com/sass/sass-site to see if there is anything to update in there as well. Did you try this with Ruby Sass?. Yes please, because if Ruby has the same behaviour, it's a feature not a bug \ud83d\ude09 . This is resolved in https://github.com/sass/libsass/issues/2244 but node-sass hasn't been updated to use a version of libsass that includes the patch. node-sass doesn't support Android, but maybe the write-up mentioned here will help you https://github.com/sass/node-sass/issues/1944#issuecomment-304627839. Duplicate of #2425. Sorry, just rleated, I was mixing it up with one I saw in dart-sass recently. This file is a copy/paste from another library, so editiing might not be the best solution. Just thinking of if we ever try to sync it again (although I think it's been static since the 2011 copyright header) \u2764\ufe0f . What implementation of libsass are you using? This is the actual shared library repo, and variants like https://github.com/sass/sassc/blob/master/docs/building/unix-instructions.md#environment-variables-for-custom-source-locations already support this. Duplicate of #2585. Looks like it may be related to the sass2scss bump in https://github.com/sass/libsass/commit/ca89d73e84616a87e64febb93afaa0bd70ef181d\nNot sure, just looked through the 3.5.2 to 3.5.3 diff and it seems to be the only thing related.\nAppears only to be an indented syntax issue. What should the behaviour be if the interpolation leads to a empty set? I saw the #{\"\"} example, but i'm thinking about #{\"$variable-evaluating-to-null\"}.. Sorry, I just meant the case when the selector evaluates to a null CSS selector like --foo:;. I didn't see the test cases covering that, and was being super literal \ud83d\ude26 .. The library is an implementation of Sass https://github.com/sass/libsass#compatibility so you'll need to raise this in https://github.com/sass/sass. Those lines look like they are compiler directives for the Microsoft C++ compiler\nhttps://github.com/sass/libsass/blob/master/src/cencode.c#L49-L51\nThat is a file from an external project if you look in the header, but I'm not sure if this is something that needs to be addressed or if it is just your toolchain. How are you running libsass? (Node, Python, Ruby, C ...)\nDo you get the same error using an include path rather than a direct UNC path in the @import?\nDo you have the same problem with .scss files? .sass files need to be converted by sass2scss which may be another place the loading could have problems.. @nex3 is this something for the language spec?. This doesn't work for Ruby Sass 3.5.6 https://www.sassmeister.com/gist/022483f4c40cbf2faaf82513f2e0ef38. If you add a space between : and # it works. This would be an issue with sass2scss. Didn't try with separate files yet, but I see the same results for the reference Ruby version (although selector order is different).. ~~@Hint-ru can you file an issue with libsass since it's compilation related, it wouldn't be something that can be fixed in this repo.~~\nPS: generally for line endings with source control it's better to deal with them using gitattributes or git config https://help.github.com/articles/dealing-with-line-endings/. ~~@Hint-ru can you file an issue with libsass since it's compilation related, it wouldn't be something that can be fixed in this repo.~~\nPS: generally for line endings with source control it's better to deal with them using gitattributes or git config https://help.github.com/articles/dealing-with-line-endings/. think we kept 2013 because of old node-sass/node compatibility, but if we're close to a new version we can probably do this @xzyfer . @xzyfer can you transfer this to libsass or sass2scss? You need to be an admin in both to move issues. @martinrisseeuw I can't reproduce this on sassmeister or locally. Do you have some hidden whitepace at the end of the line that isn't coming across in your example?. Might need a PR to sass-spec for this one. I'm guessing there are already tests that are just disabled if this error wasn't supported before that need to be enabled. @nex3 Dart seems to be pruning trailing zeros. Is that a new feature or a bug?. This is the same error as Ruby and Dart Sass. If you think the error text should change, it is better to request language changes there.. It looks like it just takes string https://github.com/sass/libsass/blob/4f9f66262d0ec7b3993907f9363d5cc6ebba8e05/src/fn_strings.cpp#L62\nBut maybe that's from some of the recent work from @glebm . I think I follow, so that second block should actually be throwing an error?. I believe the libsass version does not actually match to the old Ruby Sass version numbers. Sass-spec usually marks the tests as \"todo\" for libsass if the language feature doesn't match.\nYour 2nd example looks related to an output/line ending issue rather than a functional diff. I believe the output styles have/are being removed from the specs going forward. It looks like this was run on the last tag rather than master. These files have mostly changed/moved since the last tag. I think this might be an issue with https://github.com/sass/sassc-ruby rather than libsass since I couldn't reproducte this on sassmeister. @nex3 looks like the slash sticking to the unit causes the error here. It doesn't seem to matter about the trailing though.\nscss\n.grid-layout2 {\n  grid: 1fr/ repeat(2, 1fr);\n}\nTagging you because I believe there was some work before around making the some of those operators sticking errors, but it looks like DartSass currently compiles this. @nex3 thanks for confirming. I will if all the #ifndef SASS's are replaced in the other files\n. Good point, this is just leftover boilerplate\n. Sorry, can you point me to something for this, as it is a function that returns an int representing the version number part.\n. Ah, sorry, I thought you were talking about the return type :blush: \n. Default is actually 5, https://github.com/sass/sass/blob/2045a314e2fcd2a5f32d358a4ba57409089e6372/lib/sass/script/value/number.rb#L37\n. valuse -> values\n. Indent\n. Is it work wrapping in a complier directive for the SASS_LANG = 3.4?. Why include CSS files?. Dead code?. Dead code?. You're right that this is 3.5 now, but I was thinking for ease of backporting changes to 3.4 while they are still both being maintained. I guess it would need to be a plain definition of SASS_LANGUAGE_3_4. You're right, but isn't it going away by 4 though? Might be another one to conditional out. \"Sass Open Source Foundation\" from the license?. Nice, does this actually pick up the setting when you include it here? I was having problems when editing in VS the other day because it wasn't respecting it. Are we dropping 2013 as the base version?. libsass.org just redirects to sass-lang.com now. I'm pretty sure you're correct, since it's only the project toolsversion stuff that breaks backwards compat. Maybe AppVeyor should be updated too (separately) https://github.com/sass/libsass/blob/2847edc45d1f887277fba5cd6873435e50da6f9b/appveyor.yml#L1. \"3.4 branch\" with a link?. Think \"sass-spec\" is always lowercase. Is there a minimum Clang/LLVM version too to call out?. This would have the same issue wouldn't it?. Nevermind, read it wrong. Think this should be Empty to remove the splitting of {}. @xzyfer I think by changing this to the sass.h, and mabye the docs, it would only expose those parts. This fix isn't the same as this TODO is it?. I opened https://github.com/sass/libsass/pull/2324 awhile ago, but if you have some opinions on it feel free to help make some suggestions so it can land. OK, maybe @mgreter can chime in about it later. Might be good to PR this upstream (if you didn't already). @joeyadams did you have this code hosted somewhere for this patch to be submitted?. It was there before, but selector-append has a backtick on one side and a single quote on the other. Missing + at the end?. You're probably right, I was just looking that there is a string on the following line and this didn't have a comma or plus. Not related to your change, but it looks like this URL is malformed\nsuggestion\n| We're always needing help, so check out our issue tracker, help some people out, and read our article on [Contributing](contributing.md)! It's got all the details on what to do! | To help understand the process of triaging bugs, have a look at our [Issue-Triage](triage.md) document. | Oh, and don't forget we always follow [Sass Community Guidelines](https://sass-lang.com/community-guidelines). Be nice and everyone else will be nice too! |. ",
    "jfroom": "I've opened up a modest bounty if anyone else wants to contribute to it:\nhttps://www.bountysource.com/issues/1057274-any-plans-for-source-maps\n. ",
    "mango-david": "I've slightly upped the bounty, as I think this would be a pretty damn sweet feature. \nhttps://www.bountysource.com/issues/1057274-any-plans-for-source-maps\n. ",
    "ghost": "I am currently working on extending the compiler to support source maps. I have extended the parser to collect line and column information and can already calculate incomplete line and column information about the generated code. \nBefore I push my code to a public repository, I first want to tackle to following issues:\n- Finish calculating line and column information during code generation\n- Implement Source Map Revision 3 generation\n- Clean up and refactor the code base to get it into a mergable state.\n. I've just pushed my current work to svnieuw/libsass.\nRemaining issues to be solved:\n- Fix sources array. Currently absolute paths are generated.\n- Change sassc and the libsass interface to support source map generation.\n- Bug fixes and improvements (better mixin and variable handling, build-in function handling...)\nIn my local branch, I hacked together a binary and fixed the the sources array of the map manually. I have tested the generated source map on the default Foundation template and it seems to work fine:\n\nI hope to make some further progess by the end of this week.\n. Yes, cmd-click is working already for most cases. \nI still have to find out how I best can handle certain constructs (like variable evaluations and mixins). Is there somewhere a spec or guide how properties and values should be mapped? If not, I guess my best bet will be to compare with the Ruby implementation.\n. In case you have missed it, my changes have landed in trunk. Give it a try and let me know if you find any issues. \n. I have pushed an update. Let's hope the build will succeed now.\n. How do you create the sass_file_context struct? Do you use of sass_new_file_context()? If not, could you give me a small code sample which illustrates the crash?\n. I have submitted a pull request which fixes the unbalanced free() issue.\nI still do not understand why you have a crash when ctx->source_map_file is not set. sassc does not set it either and I cannot reproduce you crash. Can you verify what the value of the source_map_file string (line 130 of sass_interface.cpp) is just before creating the Context (cpp_ctx, line 135)? \n. :+1: \n. @am11 I have created a separate issue to track the file bug in issue #243. I'm working on a fix.\nI do not use Windows, but I will look to setup a Windows VM to look at this issue.\n. Duplicate of #217 \n. I posted a reply in https://github.com/dlmanning/gulp-sass/issues/8\nNote that libsass does already provide the source map as a string. \nlibsass currently only supports source maps with sass_file_context. The source file (input path) can only be specified as path and not as data string. But I do not see the problem because you still need to provide the input path to generate the sources line in the source map anyway.\n. I can confirm that line breaks in multiline comments are not taking into account while generating the source map. I'm working on a fix. \nThanks for reporting this bug.\n. @lucasrcosta Can you also provide the source map and output css you have got?\nDo I understand you correctly that .main-content p wrongly gets mapped to  _font.scss on line 2 instead of style.scss on line 6?\n. I will try to have a look at this issue this week, but can't promise\nanything.\nOn Sun, Oct 5, 2014 at 11:57 PM, Adeel Mujahid notifications@github.com\nwrote:\n\n@svnieuw https://github.com/svnieuw [image: :smile:][image: :+1:]\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/324#issuecomment-57953942.\n. At first sight it seems the position becomes wrong after expanding a ruleset. Is there somebody who can explain what happens at this line of code: https://github.com/sass/libsass/blob/master/expand.cpp#L49?\n. :100: % awesomely awesome\n. The only reason I agree with completing this issue is that SASS should be able to compile any valid CSS file.\n\nThat said, unless there's a very compelling reason to use native CSS variables, SASS users should avoid them for the following reasons\n1. native CSS variables have very little support at this time\n2. SASS variables are guaranteed to work in any browser after compilation\n3. compiled SASS variables will output static values which will not require senseless processing on each client\n. Created a pull request for this:\nhttps://github.com/sass/libsass/pull/854\n. it is pretty good , tks\n. I use mingw64 compiler on window 64bit , got this error:\nSaIcE'\nast.o:ast.cpp:(.text+0x3d14): undefined reference to `__ZNSs4_Rep10_M_disposeERK\nSaIcE'\nast.o:ast.cpp:(.text+0x3d84): undefined reference to `__ZNSs4_Rep10_M_disposeERK\nSaIcE'\nast.o:ast.cpp:(.text+0x3e35): undefined reference to `__ZNKSt9type_infoeqERKS_'\nast.o:ast.cpp:(.text+0x3e7a): undefined reference to `__ZNKSt9type_infoeqERKS_'\nast.o:ast.cpp:(.text+0x3ea2): undefined reference to `___cxa_bad_typeid'\nast.o:ast.cpp:(.text+0x4065): undefined reference to `__Unwind_Resume'\nast.o:ast.cpp:(.text+0x40df): undefined reference to `__ZNSs4_Rep20_S_empty_rep_\nstorageE'\nast.o:ast.cpp:(.text+0x40e6): undefined reference to `__ZNSs4_Rep20_S_empty_rep_\nstorageE'\nast.o:ast.cpp:(.text+0x40f5): undefined reference to `__ZNSs4_Rep20_S_empty_rep_\nstorageE'\nast.o:ast.cpp:(.text+0x416d): undefined reference to `__ZNSs4_Rep10_M_destroyERK\nSaIcE'\nast.o:ast.cpp:(.text+0x4189): undefined reference to `__ZNSs4_Rep20_S_empty_rep_\nstorageE'\nast.o:ast.cpp:(.text+0x41a0): undefined reference to `__ZdlPv'\nast.o:ast.cpp:(.text+0x41b3): undefined reference to `__Unwind_Resume'\nast.o:ast.cpp:(.text+0x41c6): undefined reference to `__ZNSs4_Rep10_M_disposeERK\nSaIcE'\nast.o:ast.cpp:(.text+0x41eb): undefined reference to `__ZNSs4_Rep10_M_destroyERK\nSaIcE'\nast.o:ast.cpp:(.text+0x4231): undefined reference to `__ZNSsC1ERKSs'\nast.o:ast.cpp:(.text+0x4252): undefined reference to `__Znwj'\nast.o:ast.cpp:(.text+0x42bb): undefined reference to `__ZNSs4_Rep10_M_disposeERK\nSaIcE'\nast.o:ast.cpp:(.text+0x4347): undefined reference to `__ZNSs4_Rep20_S_empty_rep_\nstorageE'\nast.o:ast.cpp:(.text+0x4398): undefined reference to `_memcmp'\nast.o:ast.cpp:(.text+0x43a6): undefined reference to `__ZNSs4_Rep20_S_empty_rep_\nstorageE'\nast.o:ast.cpp:(.text+0x43ce): undefined reference to `__ZNSs4_Rep10_M_destroyERK\nSaIcE'\nast.o:ast.cpp:(.text+0x43e8): undefined reference to `__ZNSs4_Rep20_S_empty_rep_\nstorageE'\nast.o:ast.cpp:(.text+0x44c8): undefined reference to `__ZNSs4_Rep10_M_destroyERK\nSaIcE'\nast.o:ast.cpp:(.text+0x44e1): undefined reference to `__Unwind_Resume'\nast.o:ast.cpp:(.text+0x4500): undefined reference to `__ZdlPv'\nast.o:ast.cpp:(.text+0x4511): undefined reference to `__ZNSs4_Rep10_M_disposeERK\nSaIcE'\nast.o:ast.cpp:(.text+0x4529): undefined reference to `__ZNSs4_Rep10_M_disposeERK\nSaIcE'\nast.o:ast.cpp:(.text+0x136): undefined reference to `__ZNSt8ios_base4InitD1Ev'\nc:/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/4.7.3/../../../../x86_64-w64-mingw3\n2/bin/ld.exe: ast.o: bad reloc address 0x1 in section `.text$_ZN4Sass8Selector11\nspecificityEv[__ZN4Sass8Selector11specificityEv]'\ncollect2.exe: error: ld returned 1 exit status\nmakefile:175: recipe for target `lib/libsass.so' failed\nmingw32-make: *** [lib/libsass.so] Error 1\nmingw32-make: Leaving directory `D:/Developer/workspace/libsass'\nmore detail:\n\n. I have compiled successful by using mingw64 on window 64bit , and updated wiki on https://github.com/sass/libsass/wiki/Building-on-Windows\n. i have fixed this problem by myself, modify code like this:\njava\nsass.sass_option_set_source_map_file(file_ctx, inputFile+\".map\");\nFileUtils.writeStringToFile(new File(inputFile+\".map\"), sass.sass_context_get_source_map_string(file_ctx), \"utf-8\");\nsass_file_context_set_options no effect in JNA ,should just use sass_option_set_source_map_file(file_ctx, inputFile+\".map\");\n. Awesome. I will cancel my pull request and wait for the right fix.\n. @mgreter are you thinking of parsing interpolations recursively? without recursion, we might end up chasing lots of edge cases and having boilerplate code... \n. Yup, verified. Thanks for the quick response.\n. @xzyfer I still got issues where '@extend' doesn't work while using the following \n\"node-sass\": \"^4.1.1\". Hi @mgreter, \nI can't understand why, a couple of months ago, I was able to compile it.\nI wrote an entire fluid grid framework with this feature and now I'm unable to still work on it.\nAmazingly weird.\n. You can close the issue: feature's implemented and my project is running again.\nWhy ? I really don't know.\n. OMG. What a stupid developer am I ?\nI was compiling under mac osx and I installed sass by gem.\nThis means ruby-sass and that I'm so sorry for opening this issue.\n. Renaming docs to Documentation will stick the directory always on top (unless, of course, you have some directory like BAM which doesn't happen very often). \nReferences:\n- https://github.com/torvalds/linux\n- https://github.com/dotnet/coreclr\n- https://github.com/dotnet/corefx\n. Nevertheless I suggested in the spirit of \"better convention should go viral\": keeping docs on top, then goes the rest of the repository assets. :crossed_flags: \n. I've looked at preparation for 3.3 cursory. And it looks like this will not be actual for 3.3 but like fixing regression for current release. \n. +1\n. Just tell me what to do and I will provide whatever you need or want. But please reopen the issue. I can confirm what @netmikey said - I am not running out of memory either.\nFor me, this is a very annoying problem - I had to revert some packages to quite old versions, which are now producing a lot of verbose error output (but works anyway somehow). These outputs clutter the whole output, making it nearly impossible to find the cause of a problem if anything other breaks. Also, I am tied to obsolete software as of now...\n. Awesome, thank you very much! I will immediately try this and update this comment eventually \n. ",
    "jonlow": "Bounty is now up to $100! https://www.bountysource.com/issues/1057274-any-plans-for-source-maps/bounties\n. ",
    "roncohen": "And at $150 now. Looking forward to using source maps with libsass at Opbeat!\n. ",
    "ccverg": "@svnieuw you can claim the bounty here :+1: \n. @akhleung don't forget to claim the bounty on this issue!\n. ",
    "mchambaud": "What about inline sourcemaps?\n. new issue: https://github.com/sass/libsass/issues/498\n. @mgreter @am11 I'm not sure about use cases for absolute URIs either... but\nSASS Reference\n:auto uses relative URIs where possible, assuming that that the source stylesheets will be made available on whatever server you\u2019re using, and that their relative location will be the same as it is on the local filesystem. If a relative URI is unavailable, a \u201cfile:\u201d URI is used instead. \n:file always uses \u201cfile:\u201d URIs, which will work locally but can\u2019t be deployed to a remote server. \n:inline includes the full source text in the sourcemap, which is maximally portable but can create very large sourcemap files.\n:none causes no sourcemaps to be generated at all.\n. ",
    "pilif": "for PHP, there's my fork of jamierumbelow/sassphp at sensational/sassphp which is keeping track with newer releases of libsass and adds support for setting the include paths. As more features appear in libsass, I'm trying to keep the extension up to date.\n. The first commit where this broke is\nf2051783b21cd2acbe5fc53cb767e1a63c95b421\naccording to git bisect.\n. I can confirm that current HEAD fixes this.\nThanks for the pointer to the tests. There currently seem to be quite a few failures. Is that an issue with my local config, with the tests or with the library? Anyways - as I'm finding more issues, I'll be making test cases now. Thanks.\n(as for the avatar: That's Frog from Chrono Trigger)\n. ",
    "SamWhited": "Another Go implementation: https://github.com/SamWhited/go-sass\n. Sorry for the noise, didn't notice this had been deprecated. I'm assuming leaving it out was deliberate.\n. ",
    "warmuuh": "Also there is my java-implementation as a maven-plugin: https://github.com/warmuuh/libsass-maven-plugin\n. ",
    "HarryLyu": "I checked node-sass repo and it uses not latest version https://github.com/hcatlin/libsass/tree/fd423d1e9e19947e00bf5bb10b56225c277d48a5\nWill post an issue in node-sass project to update libsass.\n. ",
    "jeroenhouben": "same here:\ngyp info spawn args [ 'BUILDTYPE=Release', '-C', 'build' ]\n  CXX(target) Release/obj.target/binding/binding.o\n  CXX(target) Release/obj.target/binding/sass_context_wrapper.o\nIn file included from ../sass_context_wrapper.cpp:1:\nIn file included from ../sass_context_wrapper.h:1:\nIn file included from ../libsass/sass_interface.h:3:\n../libsass/sass.h:88:3: error: unknown type name 'size_t'\n  size_t              length;\n  ^\n../libsass/sass.h:117:37: error: unknown type name 'size_t'\nunion Sass_Value make_sass_list    (size_t len, enum Sass_Separator sep);\n^\n. FYI: I can compile libsass as a standalone lib.\nGCC:\n```\n$ gcc -v\nUsing built-in specs.\nTarget: i686-apple-darwin11\nConfigured with: /private/var/tmp/llvmgcc42/llvmgcc42-2336.11~182/src/configure --disable-checking --enable-werror --prefix=/Applications/Xcode.app/Contents/Developer/usr/llvm-gcc-4.2 --mandir=/share/man --enable-languages=c,objc,c++,obj-c++ --program-prefix=llvm- --program-transform-name=/^[cg][^.-]*$/s/$/-4.2/ --with-slibdir=/usr/lib --build=i686-apple-darwin11 --enable-llvm=/private/var/tmp/llvmgcc42/llvmgcc42-2336.11~182/dst-llvmCore/Developer/usr/local --program-prefix=i686-apple-darwin11- --host=x86_64-apple-darwin11 --target=i686-apple-darwin11 --with-gxx-include-dir=/usr/include/c++/4.2.1\nThread model: posix\ngcc version 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2336.11.00)\n```\n. rebuilding works for me too, but when I run node-sass:\n$ ./node-sass ~/Sites/youp/web/src/sass/application.scss \nStarting Render Process...\nlibc++abi.dylib: terminate called throwing an exception\nAbort trap: 6\n. I also tried using the bundled precompiled binary (Darwin x64):\n$ bin/node-sass ~/Sites/youp/web/src/sass/application.scss \nStarting Render Process...\nSegmentation fault: 11\n. OK thanks guys for your feedback, continuing over at node-sass: https://github.com/andrew/node-sass/issues/127 as we're not sure the problem lies with libsass.\n. ",
    "sethkinast": "Chiming in to confirm that libsass itself builds fine for me on Mac, same gcc version as @jeroenhouben \n. If I move the new #include of stddef.h outside of the #ifdef (so that it's always included) node-sass and sassc/libsass both compile fine.\n```\nifdef __cplusplus\nextern \"C\" {\nendif\ninclude \n```\nTested compiliation of libsass on OS X 10.7.5 (gcc 4.2.1) and a nasty old RHEL5 box (2.6.18-164.el5 gcc 4.1.2)\nDisclaimer being that I really have no idea what I'm doing :) It works if you place the include outside the extern too, on both Mac and Linux. But it doesn't work when the #include is conditional on __cplusplus being undef.\n. @akhleung updating the submodule and rebuilding node-sass succeeded for me :)\n. ",
    "NickHeiner": "Cool, thanks for fixing it, and sorry for opening a superfluous issue. I'm excited for when node-sass will be using the latest version of LibSass.\n. :+1: This issue affects me as well.\n. @hcatlin I actually think that's a totally reasonable answer. Parity with Ruby Sass seems to clearly by priority 1 for this project, and this use case that I've brought seems to be of marginal interest at best. Besides, if I really need access to this information or other AST content, I could just use LESS.\n. Awesome. Thanks for merging this. I'm excited for the next release so I can start using this fix!\n. ",
    "jory": "This nesting is also broken for non-placeholder selectors.\n``` scss\n.foo {\n  background-color: lime;\n  a {\n    color: white;\n  }\n}\n.baz {\n  @extend .foo;\n}\n```\nshould produce\ncss\n.foo, .baz {\n  background-color: lime; }\n  .foo a, .baz a {\n    color: white; }\nbut does produce\ncss\n.foo, .baz {\n  background-color: lime; }\n  .foo a {\n    color: white; }\n. And mashing this one up with #145.\n``` scss\n.foo {\n  background-color: lime;\n  a {\n    color: white;\n  }\n}\n%bar {\n  @extend .foo;\n}\n.baz {\n  @extend %bar;\n}\n```\nshould be\ncss\n.foo, .baz {\n  background-color: lime; }\n  .foo a, .baz a {\n    color: white; }\nis\n``` css\n```\nEdit: to be clear, sassc outputs nothing in this case.\n. I'd like to add: WOOOOOOOOOOOOOO!\n. ",
    "pkieltyka": "hey guys, I was just wondering if you've had a chance to look into this issue yet?\n. @QuLogic yea, you're right, the libsass version (906a9a139a89f1a26ecd) linked to sassc works, but, thats from June 8th, which doesn't include support for placeholders which is something I need for my project. The team has already been using many sass placeholders in the source with ruby sass.\nIt looks like the include path seems to be working properly with that version of libsass too. But in any case, the current head of libsass still has both of those issues. (As well when used with node-sass). Perhaps some interface changed in libsass, and node-sass and sassc need updating, I am not sure the source of the issue, but I just wanted to let you guys know.\n. Yea, I made the example project attached to this ticket just to demonstrate these 2 bugs. Hope that helps.\nOn 2013-07-27, at 12:58 PM, Hampton Catlin notifications@github.com wrote:\n\nTotally valid. master at libsass just finished a major reworking, so this \nkind of thing isn't surprising. Can you describe a simple failing test case? \nOn Saturday, July 27, 2013, Peter Kieltyka wrote: \n\n@QuLogic https://github.com/QuLogic yea, you're right, the libsass \nversion (906a9a1https://github.com/hcatlin/libsass/commit/906a9a139a89f1a26ecd) \nlinked to sassc works, but, thats from June 8th, which doesn't include \nsupport for placeholders which is something I need for my project. The team \nhas already been using many sass placeholders in the source with ruby sass. \nIt looks like the include path seems to be working properly with that \nversion of libsass too. But in any case, the current head of libsass still \nhas both of those issues. (As well when used with node-sass). Perhaps some \ninterface changed in libsass, and node-sass and sassc need updating, I am \nnot sure the source of the issue, but I just wanted to let you guys know. \n\u2014 \nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/139#issuecomment-21667715 \n. \n\u2014\nReply to this email directly or view it on GitHub.\n. Awesome, thx!\n\n\nOn 2013-07-31, at 2:45 PM, Aaron Leung notifications@github.com wrote:\n\nSorry for the regression; I'll look into it.\n\u2014\nReply to this email directly or view it on GitHub.\n. Hey Aaron,\n\nYea, I compiled the head of sassc with the head of libsass, and pass the include path to sassc with -I. \nOn 2013-08-02, at 5:35 PM, Aaron Leung notifications@github.com wrote:\n\nWait, just re-read the issue. So you're using sassc? I'll double check there.\n\u2014\nReply to this email directly or view it on GitHub.\n. Hey Luke,\n\nNice! That certainly will cover the first issue by checking if it can actually read the file properly. Another way is to check the file stat and see if it's a directory before reading, same effect tho. If its a file and fails to read, it should return an error.\nOn 2013-08-03, at 4:00 AM, Luke Bastendorff notifications@github.com wrote:\n\nMy first ever post on Git Hub went well then!\nI think I have at duplicated this bug, or at least part of it.\nHowever I did post a solution, see issue #141\n\u2014\nReply to this email directly or view it on GitHub.\n. That makes sense. I was thinking also some syntax warning if none of the import files could be read. But whatever.. it's not needed for it to work.\n\nOn 2013-08-03, at 10:06 AM, Luke Bastendorff notifications@github.com wrote:\n\nSure, but if it errors in read_file then resolve_and_load needs to understand that and carry on trying the adjusted paths.\nI.E. if abc/xyz is a directory and errors in read_file then resolve_and_load needs to carry on and try abc/_xyz then abc/_xyz.scss and then abc/xyz.scss\n\u2014\nReply to this email directly or view it on GitHub.\n. @akhleung thanks! this seems to work. I will test it against a few more things in a few hours.\n. Double checked it, and it works great!\n. \n",
    "jpdevries": "I've also run into this issue. Here are my findings:\nWhen extending silent classes from within another silent class, grunt-sass is producing bad selectors. grunt-contrib-sass generates correct selectors.\ngist package that reproduces the issue here:\nhttps://gist.github.com/jpdevries/6350682\nthis:\n``` scss\n%visuallyhidden {\n    border: 0;\n    clip: rect(0 0 0 0);\n    height: 1px;\n    margin: -1px;\n    overflow: hidden;\n    padding: 0;\n    position: absolute;\n    width: 1px;\n}\n%focusable:active,\n%focusable:focus {\n    clip: auto;\n    height: auto;\n    margin: 0;\n    overflow: visible;\n    position: static;\n    width: auto;\n    @extend %visuallyhidden;\n}\nmydiv {\n@extend %visuallyhidden;\n\n}\n```\ngenerates:\n``` scss\n%focusable:active, %focusable:focus, #mydiv { / bad selector generated by grunt-sass (grunt-contrib-sass works correclty) /\n  border: 0;\n  clip: rect(0 0 0 0);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px; }\n```\n. ",
    "MoOx": "note: it's optional.\n. Note that if you do in original sass\nscss\nselector {\n  prop: null;\n}\nit outputs the same thing.\nIt seems related to null variable only !\n. ",
    "sthulb": "I've just come across this wanted to use this project for the BBC News site, is there an ETA on a fix?\n. I'll try and contribute too. You'll have to excuse my C though. It's a bit rusty. \n. ",
    "TomGault": "How'd the week go?  We could use this as well but I won't have a chance to look at it myself until 2014 at the earliest.\n. Awesome.  Thanks a ton!\n. @akhleung Great!  Which commit fixes it?  Is this issue ready to be closed?  Thanks!\n. Good to know.  I'll notify the node-sass crew that the alpha issue should be good at least and we can merge that in.  Thanks!\n. ",
    "getdave": "+1\n. ",
    "charltoons": "+1\n. ",
    "danielbaars": "+1\n. ",
    "samageloff": "Try adding an underscore to any files that you are importing eg: _mixins.scss _fonts.scss etc.\n. ",
    "paulmillr": "To solve: interpolate your code inside url(): url(\"#{code}\")\n. ",
    "mshwery": "+1. Really really incredibly important to the usefulness of sass.\n. ",
    "JohnONolan": "+1 this is a must-have\n. ",
    "dansowter": "Really appreciate the hard work on this, guys. I'm porting over https://github.com/net-engine/trove to use libsass, and this seems to be one of the last issues.\n. ",
    "jrabbe": "@akhleung is there a branch I can try to see if it works with our Sass?\n. Thanks for chiming in @michaek, I know it's not necessarily the correct place for it, but I was wondering if you could weigh in on the difference between the data models in libsass and Ruby Sass, and why they are different? Thanks a bunch.\n. ",
    "icasteleyn": "Just wanted to add another example where @extends doesn't work properly.\n\".Sub.myInherit\" should be \".myInherit.Sub\"\nScss\n``` css\n.myBase { \n    text-decoration: none; \n}\n.myInherit{\n    @extend .myBase;\n    line-height: 1.6;\n}\n.myBase.Sub{\n    color: #123456;\n}\n```\nSassLib\n``` css\n.myBase, .myInherit {\n  text-decoration: none; }\n.myInherit {\n  line-height: 1.6; }\n.myBase.Sub, .Sub.myInherit {\n  color: #123456; }\n```\nRuby Sass\n``` css\n.myBase, .myInherit {\n  text-decoration: none; }\n.myInherit {\n  line-height: 1.6; }\n.myBase.Sub, .myInherit.Sub {\n  color: #123456; }\n```\n. ",
    "mgol": "Another test case (taken - and simplified - from our code base):\nscss\n.common {\n    color: red;\n}\n.outer {\n    .inner {\n        @extend .common;\n    }\n}\n.outer2 {\n    @extend .outer;\n}\nCorrect output by Ruby Sass:\ncss\n.common, .outer .inner, .outer2 .inner {\n  color: red; }\nlibsass output:\ncss\n.common, .outer .inner, .outer2 {\n  color: red; }\nThe .inner part gets cut out.\n. And another, incorrect test case that gets properly shouted at by Ruby Sass:\nscss\n.common {\n    color: red;\n}\n.outer {\n    .inner {\n        @extend .common;\n    }\n}\n.outer2 {\n    @extend .middle;\n}\n(notice mismatched @extend .middle)\nRuby Sass gives:\nSyntax error: \".outer2\" failed to @extend \".middle\".\n              The selector \".middle\" was not found.\n              Use \"@extend .middle !optional\" if the extend should be able to fail.\n        on line 10 of test.scss\n  Use --trace for backtrace.\nwhereas libsass happily compiles that to the following:\ncss\n.common, .outer .inner {\n  color: red; }\nIs there a proper place to report such issues? I have about 230 mismatched rules compared to the Ruby output, I can provide test cases but maybe it's not worth giving them all since many will be fixed when those already provided are fixed.\n. @akhleung OK, thanks for the info! Do you think the implementation requires a lot more work? Not pushing, just curious if we have to wait a little longer.\nAnyway, you're doing awesome job here, I bumped the bounty. :)\n. @vaibhavkanwal Obviously not... If such a workaround existed it wouldn't really be a workaround but an implementation and it would be merged to libsass. Today you can choose between speed & reliable @extend.\n. I kindly remind anyone interested in it that there's an open bounty:\nhttps://www.bountysource.com/issues/1057456-extended-selectors-wont-compile-correctly-with-both-regular-and-silent-selectors-185\nCurrently $185, let's make it bigger! :-)\n. Ruby Sass compiles it in the same way, to .open .siteNav .dropdown{}. Where in the docs did you find the first output is expected? If the docs claim sth like that it's the bug in Sass docs, not in libsass.\n. Won't it slow everything down?\nAlso, you don't need to set up workspaces for the linking to work.\n. I think it can hamper productivity. From what I understand, this will make it impossible to edit SCSS files from within Chrome Dev Tools since the mappings will be to the copied inlined SCSS stylesheets and not to the source onces.\nCurrent situation is that:\n1) you don't have to setup workspaces for the linking to work\n2) if you do, you may not only see the source lines but also live-edit them.\nAm I missing something?\n. I realize for many folks it might be better to have the source inlined. I don't care what's the default, I just need an option to use regular source mappings. With that, it's :+1: from me.\n. The cited example is not actually a valid CSS; a more proper example would be that the following SCSS:\nscss\n.link {\n    display: block;\n    @supports (display: flex) {\n        display: flex;\n    }\n}\nshould be transformed to:\ncss\n.link {\n    display: block;\n}\n@supports (display: flex) {\n    .link {\n        display: flex;\n    }\n}\n. Related: https://github.com/sass/sass/issues/851\n. @mikeebee It wasn't. The milestone is set to 3.1.\n. I bumped the bounty but it seems the plugin doesn't work as it still shows the previous amount.\n. @ciampo This works in latest libsass, do you experience any problems?\n. @ciampo From what I see gulp-sass 2.0.1 depends on node-sass 3.2.0 i.e. the latest. It should work unless you use an outdated gulp-sass.\n. /deep/ is deprecated. Only Chrome has implemented it and it plans to remove it soon (just see the console on the new tab page in Chrome Canary). They've tried to change the combinator from /deep/ to >>> but no form has been accepted by other browser vendors and it will most likely be removed from the spec.\nIn any case, current version of the spec says about >>>, not /deep/.\nDoes libsass still plan to support this obsolete selector?\n. CSS variables are more powerful than Sass variables and their functionality cannot be implemented in a preprocessor. This is because they are basically custom properties that cascade in the same way as the rest of \"regular\" CSS properties. An example:\n``` css\nhtml {\n    --base-green-value: 100;\n}\n.class1 {\n    background-color: rgb(100, var(--base-green-value), 100);\n}\n/ way later in a different file: /\n.class2 {\n    --base-green-value: 50;\n}\n```\nAn element with the class class2 will have background-color set to rgb(100, 50, 100).\nIn the definition for .class2 we don't have the data about the red and blue component value, we also don't need to know it's background-color that is customized. And that's just basic usage, it can all be interacted with from JS (e.g. to shim new CSS stuff) etc.\nThis concept overlaps only a little with Sass variables and due to its dynamic nature cannot be implemented in a preprocessor.\nRuby Sass doesn't support it (yet), see the issue I linked to in my first post.\n. Duh, sorry, I wrote CSS variables have been available in Firefox stable for a few years, I meant a few days. :)\n. > Is this a finalized spec agreed on by the W3C?\nThe spec is here: http://dev.w3.org/csswg/css-variables/; it's written & maintained by Tab Atkins from Google.\nBy the comment: https://github.com/sass/sass/issues/1128#issuecomment-38936045 this is the final syntax since it's already shipped un-preffed in stable Firefox.\n. I don't expect libsass to fully support the syntax any time soon but it could just accept property names starting from -- as Ruby Sass does since this commit: https://github.com/sass/sass/commit/1dbbbdf9211919e915fb344dc54ebb216856bfc2\n. > The only reason I agree with completing this issue is that SASS should be able to compile any valid CSS file.\nThat's one reason.\nBesides, Firefox OS apps require only Gecko support so they're a valid target for using CSS variables.\n\ncompiled SASS variables will output static values which will not require senseless processing on each client\n\n...but, as I wrote before, they are far less powerful than CSS variables. You're comparing a computer to the calculator and complaining that the former doesn't last so long on batteries. Sure, it doesn't, sure, there are cases where using the calculator makes more sense that using the computer but that doesn't change the fact that what the computer does is useful and justifies the cost.\n. > I'm not able to reproduce the segfault ... it could be that Node-Sass is using an outdated version of LibSass.\nNope, with the newest libsass the error is the same.\n. I confirm sass/node-sass#366 fixes the issue.\n. @kennethormandy You're right; closing then!\n. @TomHarms Please close the issue when it's resolved, it takes unnecessary work out of maintainers shoulders.\nAlso, issues specific to Grunt tasks should be reported to them, not here. E.g. grunt-sass issues go to https://github.com/sindresorhus/grunt-sass/issues\n. Confirmed; in my app it's one of the remaining differences from the version compiled via Ruby Sass.\n. @hcatlin grunt-sass\n\nMicha\u0142 Go\u0142\u0119biowski\n. Ruby Sass preserves other whitespaces as well, if you e.g. have 4 spaces between selectors in SCSS, they remain 4 in the resulting CSS. libsass collapses them to 1 space.\n. What does the needs test label mean? I've provided a test case. :)\n. Another example:\nSource:\nscss\n.a,\n.b {\n    &.c {\n        color: red;\n    }\n}\nRuby Sass output:\ncss\n.a.c,\n.b.c {\n  color: red;\n}\nlibsass output:\ncss\n.a.c, .b.c {\n  color: red; }\n. A PR to sass-spec: https://github.com/sass/sass-spec/pull/114\n. BTW, what's interesting here is that if I just change ::-webkit-scrollbar in the source to, e.g., .d, Ruby Sass gives me:\ncss\n.a .d.b {\n  color: green; }\ni.e. the same what libsass does. Weird.\nEDIT: I submitted an issue to Ruby Sass about that: https://github.com/sass/sass/issues/1495\n. I'll wait with submitting a PR to sass-spec until the Ruby Sass issue clarifies on what should really be happening.\n. As Sass maintainer indicated in https://github.com/sass/sass/issues/1495#issuecomment-61189114, Sass is correct here due to pseudo-element low specificity. This is confirmed to be a libsass bug then.\nI'll submit a spec.\n. Spec submitted: https://github.com/sass/sass-spec/pull/115\n. This, BTW, is more serious than my other recent issues as it can change semantics in some cases. I wonder if a similar spec but with a class instead of a pseudo-selector shouldn't be added to show the difference between those two that libsass doesn't currently respect?\nThis is AFAIK one of the three issues that currently prevent our quite a large Sass code base from migrating to libsass (other two being @supports and @at-root support). The rest is mostly stylistic changes - a little annoying but nothing blocking.\nGreat job!\n. That's not a very important issue, obviously. It's just that I'm currently in a process of trying to migrate from Ruby Sass so I'm comparing output of both tools and those minor differences make it a little harder to find true differences.\nIs normalizing such stuff in scope of libsass code and Sass spec?\n. Done: https://github.com/sass/sass-spec/pull/113\n. Will do; thanks for the reference!\n. Done: https://github.com/sass/sass-spec/pull/112\n. \\o/\n. Thanks a lot! :)\n. Spec PR: https://github.com/sass/sass-spec/pull/127\n. Wait; the OP said that the output is supposed to have three out: 'found true'; rules; the attached output is describing current incorrect behavior. Meanwhile, the test case added to sass-spec in https://github.com/sass/sass-spec/pull/180 codifies current behavior.\nEDIT: disregard; I didn't notice the following commit. Sorry!\n. Great, thanks! :)\n. Great, thanks! :)\n. Spec submitted: https://github.com/sass/sass-spec/pull/297\n. Spec submitted: https://github.com/sass/sass-spec/pull/298\n. Sure, this is far from the most important issue. I just reported all I found (I periodically check on my rather large project what still stops me from migrating from Ruby Sass and report all differences) and I thought you plan to fix it eventually as you marked one of my other white-space related tickets (#593) as planned for 3.4.\n. > please open a more generic issue that double linefeeds differ from ruby sass\nDouble linefeeds? What do you mean? The source doesn't have consecutive \\n\\n.\n. OK, I opened #1030.\n. Spec submitted: https://github.com/sass/sass-spec/pull/300\n. > I will cherry pick this fix and PR it separately later, so this can be included in 3.2.5!\n\\o/ Thanks!\n. Spec submitted: https://github.com/sass/sass-spec/pull/299\n. > These new lines have no semantic meaning.\nThat's true but the idea was that libsass should match Ruby Sass output even with regards to whitespaces, wasn't it?\n. Thanks! :)\n. Is a test case to sass/sass-spec needed?\n. > I hope you understand that these details are really lowest prio atm!\nSure. As long as you find those white-space-related issues valuable, I may report what I find whether you plan to fix those issues soon or not. I have a project with 509 KB uncompressed CSS after compilation via Ruby Sass (324K compressed) so that's quite a good size to find various edge cases & differences between Ruby Sass & libsass. :)\n(white-space related issues are not the only ones I find anyway)\n. Spec submitted: https://github.com/sass/sass-spec/pull/316\n. The test written label is missing on this bug.\n. Possibly related: #823 \nEDIT: but maybe not related; my test case looks a little different as it extends a class that is wrapped in another selector.\n. Spec PR: https://github.com/sass/sass-spec/pull/399\n. @mgreter Thanks! \\o/\n. This still has the 3.3.4 milestone and libsass 3.3.4 seems to already have been released. Why is that?\n. ",
    "anotheruiguy": "If anyone is looking for a summary of issues I encountered with libsass' version of extends, please see this post.\nakhleung has an amazing undertaking, we appreciate all your work in this regard. \n. ",
    "vaibhavkanwal": "I switched to libsass for an existing enterprise project at work. All my @extends do not work. So, is there a workaround to get the speeds of libsass and work temporarily with extend till a good solution comes up. \n. @mzgol Sure. Makes sense. Eagerly await this fix. \n. @akhleung I understand, thanks! I use @extend with silent classes. It did not give error for me but did not compile the code in output so styles were not applied. Hope that helps. \n. ",
    "mlmorg": "+1\n. ",
    "halfdan": "@akhleung Here's another example that works fine in Ruby Sass but doesn't produce the desired result in libsass: http://sassmeister.com/gist/9482759 (you can switch the compile mode on the top right corner).\nIs there any ETA on the support for @extend?\n. ",
    "bonfish": "Hi! I am experiencing an @extend error using grunt-sass. The SCSS:\n```\n.module {\n  padding: 10px;\n  h3 {\n    color: red; \n  }\n}\n.news {\n  @extend .module;\n}\n```\nshould produce the CSS\n.module, .news {\n  padding: 10px;\n}\n.module h3, .news h3 {\n  color: red;\n}\nbut instead, it gives:\n.module, .news {\n    padding: 10px;\n}\n.module h3, .module .news {\n    color: #FF0000;\n}\nDo I get this wrong, or is the culprit really the libsass in grunt-sass ?\n. @hcatlin thanks, though I was hoping to get the opposite answer.\nSASS is sweet, the ability to work with it in such side tools as Grunt helps a lot. Extremely eager to see an update =)\nMeanwhile, thank you guys so much for your work, wish all the best to the team!\nAleksey.\n. Great news! Looking forward for the new version out, making it possible for me to move back from Ruby SASS.\nOne thing I gon't quite get. @uberska who earned all the praise as a developer - is not part of the Libsass team? And...\n\nAnd big ups to @DealerDotCom who sponsored @uberska's development time on the project. \n\n... means that this huge task was backed not only by one of the Top three biggest bounties on Bountysource? \n. @jschulte that sounds very inspiring! Thank you so much for your work!\nOne more question, if I may: is there a list of tests somewhere in the public, that at-extend is still uncapable of passing? Just to get the view of what constructs to evade in advance.\n. @chriseppstein, seems I worked it out. This: [;rule-name: rule-value;]; won't neither work in SASS nor in libsass. With the first one I made the hack run by applying a - quite hacky itself - mixin:\n```\n@mixin old-webkit($rules...){\n    $open: '[;';\n    $close: ';]';\n$rule-name:'';\n$rule-val:'';\n@each $rule in $rules{\n    $rule-name: #{$open} nth($rule,1);\n    $rule-val: nth($rule,2)#{$close};\n    #{$rule-name}: #{$rule-val};\n}\n\n}\n```\nSo the call @include old-webkit(color red, background #fff); will produce \n[;color:red;];\n    [;background:#fff;]\nBut that didn't work with libsass; moreover, it didn't give any kind of an error, just exited. After a number of attempts I figured it out that a space here $rule-name: #{$open} nth($rule,1); is crucial.\nSo, in the end it does work in libsass. Sorry for false issue an thanks for your time =)\n. @xzyfer seems I figured out what was causing the problem. The file in question had CR-based newline management (somehow, I didn't do it intentionally). Changing it to LF or CR/LF makes things work here. \nAs far as I understand, there was some issue with libsass taking into account only LF, that's why the situation wasn't obvious from the start. Maybe the other newline management options could be taken into account?\nAnyway, thank you for your time!\n. ",
    "Cinamonas": "@bonfish Sass itself has nothing to do with this issue. Until libsass is fixed, you can use slower grunt-contrib-sass, which runs on Ruby.\n. ",
    "KayLeung": "@bonfish , or change your code a bit. libsass worked with non-nested @extend & %placeholder\n. ",
    "Ilyes512": "@KayLeung I would rather use Ruby Sass, it just 2 seconds compilation at most?\nI havent looked into the problem, but I find it strange that Ruby can do something that C cant? Ruby Sass is opensource right? \n. ",
    "cjcheshire": "2 hours!  Thank god i'm not on that project! :)\nOn 28 May 2014 16:31, Hampton Catlin notifications@github.com wrote:\n\nActually, Ruby Sass can take up to 2 hours to compile on very, very complex\nprojects, but several minutes on regular large projects. Libsass is a new\nproject to try and speed up Sass compilation, and ease both integration and\nmemory usage.\nFeel free to use the main Ruby-based project if it better fits your needs.\nOn Wednesday, May 28, 2014, Lu Nelson notifications@github.com wrote:\n\n@Ilyes512 https://github.com/Ilyes512 ruby sass gets much slower than\nthat on big projects. I've seen cases with over 5 seconds compile time.\nWhich is just not workable, in this era where we're told we should\n'design\nin the browser'. Speed is the basic reason for libsass. See @benfrain<\nhttps://github.com/benfrain>'s\narticle for reference\nhttp://benfrain.com/libsass-lightning-fast-sass-compiler-ready-prime-time/\n;\nand yes as @KayLeung https://github.com/KayLeung said you can just\nsimplify your use-cases for @extend. Basic non-nested usage and\nplaceholder classes are already working.\n\nReply to this email directly or view it on GitHub<\nhttps://github.com/hcatlin/libsass/issues/146#issuecomment-44396470>\n.\n\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/146#issuecomment-44413944\n.\n. We resorted to the gem to be safe but it is take a few seconds to compile\nand then node reloading which does delay designing in the browser\nOn 28 May 2014 17:02, \"Luis Martins\" notifications@github.com wrote:\n2 hours might be extreme, but in my experience it is quite easy to get to\n10sec average compilation times with ruby sass, which is unbearable to me.\nThat is why I approach as @lunelson https://github.com/lunelsonsuggests, by being careful with some features and give for now on others.\nTo me personally, the speed alone more than compensates for the missing\n(for now) features.\nOnce you get used to have instant compilation times, you won't look back I\npromise.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/146#issuecomment-44418350\n.\n. So it seems @extend doesn't support @media and any subsequent children selectors - it all just gets ignored and not reported in the compilation? :( \n. Looks the same as #146, closing but eagerly awaiting your magic :)\n. \n",
    "restlessdesign": "Build times and variables have nothing to do with this ticket. Keep the discussion on-topic please!\n. Huge! Thanks to all who helped on this! :tada: :tada: :tada:\n. :+1:\nConfirming that darken() and saturate() are also affected. Is there a workaround?\n. @kennethormandy Have you found a work around for the SASS functions which take two parameters?\n``` sass\n@function darken($color, $amount) {\n  @return #{ \"darken(\" + $color + \",\" + $amount \")\" };\n}\n.selector {\n    border: 1px solid darken(#f0f1f4, 3);\n}\n```\nOutputs:\ncss\nborder: 1px solid darken(#f0f1f4,3\"\");\n\u2026but really it shouldn\u2019t even be outputting darken\u2014it should be a new color value entirely.\n. My mistake. I was nesting methods, and called adjust_hue instead of adjust-hue, which cascaded into darken(). Brutal, but I love that LibSass will actually report errors or give invalid output instead of silently ignoring calls! Sorry for the false alarm.\n. ",
    "Westbrook": "@hcatlin, @akhleung, really interested in getting this worked out, so I just bumped up the bounty.  If either of you know more about the time to complete, would be willing to discuss what you think might be a more appropriate number.\n. It all stems from the great work yall are doing. LibSass makes a huge\ndifference to our stack and the features we want to deliver on it, so we're\nreally looking forward to having it in a place where we can deploy it to\nproduction. Thanks again!\nOn Sat, Jun 7, 2014 at 11:30 AM, Aaron Leung notifications@github.com\nwrote:\n\n+1 to what Hampton said, and I'll add that because my employer pays me to\nwork on LibSass (sometimes), what really means a lot to us here isn't the\nmoney itself, but rather the show of serious support. This sends a very\nclear signal that people are taking the project seriously, and for that you\nhave my sincerest thanks.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/146#issuecomment-45412951.\n. I'm definitely hoping that the interest in the bounty that my contributions have/can raise will go to the betterment of the community at large, and a such a pass for all the extend-tests.\n. Great news @michaek!! Do you have any idea when people outside of your time might be able to review your fork/branch of the code? I'd love to confirm it against the specific use cases with which my team and I are working.\n. A bit of cheer went up around the office today when this came in. Many thanks @uberaka and @DealerDotCom for making this a reality.\n\nWe're super stoked for the possibilities this opens up for the LibSass community at large and are already working to get this into our stack so we can see it in our production code as soon as possible!\nOn Oct 3, 2014, at 5:07 PM, Paul Irish notifications@github.com wrote:\n\nHuge thanks to all the supporters on Bountysource! $2000 was raised for this feature! whoa.\nThanks to photoshelter.com via @Westbrook who contributed $1000 of that!\nAnd big ups to @DealerDotCom who sponsored @uberska's development time on the project. Awesome work,e veryone.\n\u0081\\\nReply to this email directly or view it on GitHub.\n. \n",
    "andrewdc": "Yes, I would like to put a word in for how important this project is, and\nthat it will hugely benefit our team to have this particular feature\nworking. We implement a hybrid oocss + smacss + bem approach to our front\nend and @extend is a huge aspect of it. It has changed the way we do\nthings. I understand @extend is very complicated, so I wanted to thank\neveryone involved. Using gulp.js I saw a compilation speed increase that\nwas magnitudes quicker than the ruby-sass equivalent, and we all look\nforward to making the switch to libsass once extends and maps are 100%.\nThanks everyone.\n. Fantastic news. This issue was a major blocker for a smacss/bem approach\nour team is using. Thanks to everyone who worked on this.\nOn Oct 3, 2014 10:22 AM, \"Hampton Catlin\" notifications@github.com wrote:\n\nA year after its opening... I'm ridiculously, incredibly excited to click\nthe close button on this issue. Thanks to @uberska\nhttps://github.com/uberska @jaddessi https://github.com/jaddessi and\n@michaek https://github.com/michaek this mega-extends-issue can now be\nclosed. The original test case now passes, as do many, many, many, many\nother new ones written by the team at @dealerdotcom\nhttps://github.com/dealerdotcom. Also, super thanks to @paulirish\nhttps://github.com/paulirish for funding the bounty on this and never\nletting us forget that this was pending. So, @uberska\nhttps://github.com/uberska what are you going to do with the bounty? ;)\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/146#issuecomment-57826378.\n. +1\n. I have a similar issue as @extend fails to chain properly.\n\n```\n .toggle {\n   position:relative;\n } \n.toggle--switch {\n    @extend .toggle;\n  }\n.toggle--switch--is-off {\n    @extend .toggle--switch;\n  }\n```\n.toggle--switch--is-off does not inherit the position:relative; properties from its double chained parent .toggle\n. ",
    "krisbulman": "Added to the bounty, great work guys. \n. ",
    "jaddie": "Hey was just wondering how this is going, as I am encountering an error and wondering if it is caused as a result of this pending work? expand.cpp:264 \"error(\"nested selectors may not be extended\", c->path(), c->position(), backtrace);\" \nDid try a tweet but thought I should post here too :)\n. ",
    "epitaphmike": "@lmartins I have been following this thread for a while, and for some reason a few days back I added an extend into my sass file and everything compiled fine. I didn't think anything of it. Then I remembered this issue because I saw a tweet from @bountysource saying @paul_irish bumped up the bounty. Long story short. I tried your above example at the beginning of this thread and got it to compile correctly. I am not 100% sure why yet, but...\n```\n%btn-style-default{\n  background: green;\n  &:hover{\n    background: black;\n  }\n}\nbutton {\n  @extend %btn-style-default;\n}\n```\ncompiled to \nbutton {\n    background: green;\n}\nbutton:hover {\n    background: black;\n}\nHere is part of my current gulpfile, hopefully this shines some light. I honestly don't feel like I did anything different.\n```\nvar bourbon = require('node-bourbon'); // Every good task requires a little bourbon! Docs can be found at http://bourbon.io/docs/\n// Include gulp plugins\nvar shell = require('gulp-shell'),\n    rename = require('gulp-rename'),\n    changed = require('gulp-changed'),\n    concat = require('gulp-concat'),\n// CSS plugins\nsass = require('gulp-sass'),\ncsscomb = require('gulp-csscomb'),\ncsslint = require('gulp-csslint'),\nminifycss = require('gulp-minify-css');\n\n// CSS Tasks\ngulp.task('sass', function() {\n  return gulp.src('src/sass/*.scss')\n        .pipe(changed('dist/css',{extension: '.css'})) \n        .pipe(sass({includePaths: require('node-bourbon').with('projects/_sass')})) \n        .pipe(csscomb()) \n        .pipe(gulp.dest('dist/css'))\n        .pipe(csslint('projects/_utils/csslint_rules.json'))\n        .pipe(csslint.reporter())\n        .pipe(rename({suffix: '.min'}))\n        .pipe(minifycss())\n        .pipe(gulp.dest('dist/css'));\n});\n\n```\n. @lmartins That is fantastic news, and makes more sense now that I think about it. I don't remember which version for gulp-sass I was running before, but now I am using 0.7.2\n. And Thanks @akhleung and everyone else who contributed.\n. ",
    "nchafai": "Hi everyone,\nAlthough I know @akhleung has huge work to resolve this issue, does anyone know how to adapt our code in order to dodge these @extend issues ?\nI mean, Ruby-Sass is currently taking about 30sec to 1min on my (slow) computer so that I do have to use libsass. But the generated CSS is completely wrong due to these @extend. \nIs there any workaround ? \n. @benfrain Unfortunately, the state of the project is that I implemented scss files with multiple @extend based on sass libraries (smartadmin, bootstrap, fontawesome, and a project library) using Ruby-Sass preprocessor. Switching to libsass, I do have to find which are the faulty @extend before debugging. I might post these cases as soon as I would have find them :) \n@lmartins Avoiding some libraries is not a workaround in my case (otherwise, I would have to stop using SASS!).\nMaybe writing simpler sass code (when extending my own classes, not library-ones) is a good directive, but i sometime feels like i will write close-to-css code. \nAnd for library-classes, i will sometimes have to specify them directly in the DOM, losing the usefullness of SASS. \nAnyway, thanks for the feedback. I'll try to apply the \"simpler sass code\" directive and see what happens !\n. ",
    "michaek": "I'm curious what would be accepted as closing this issue. Passing all the extend-tests in https://github.com/sass/sass-spec, some subset of those tests, or some other criteria?\n. Yep, that makes sense to me. I've been coming back to this issue periodically over the past year, and it seemed helpful to have the criteria stated clearly. :)\n. @sheerun Sorry I missed your comment until now!\nThe main problem is that @extend is a very complex feature, even if it doesn't seem that way when using it. See @nex3's \"How @extend works\" for a partial description of the algorithm.\nThe problem has two major parts:\n1. Most of the @extend algorithm hadn't been ported yet from Ruby\n2. The AST data model in libsass doesn't exactly match that of Ruby Sass, which adds to the complexity of the port\nCurrently, my team (primarily @uberska) is chipping away at those issues. We're working on a couple branches in a fork of libsass, implementing first the weave function then the subweave function. Simultaneously, we're triaging the tests in https://github.com/sass/sass-spec to determine which currently failing tests are related to @extend functionality, and which are failing because of other concerns such as AST parsing.\nWe can't commit to getting all @extend tests passing, but we're working hard on covering common cases - which include the complex weave/subweave behavior.\n. @jrabbe  The main difference we ran into is that when storing complex selectors, Ruby SASS stores combinators and compound selectors in separate array positions: [a, >, b, c], while libsass combines each combinator with its following combinator into a ComplexSelector object [[a, >], [b, \" \"], [c, \" \"]]. That ends up being relevant in the implementations of subweave/lcs/trim, so it made sense for us to use a structure that allowed our code to be a clearer port of the Ruby implementation.\n. Our current work on @extend is now passing all but 55 tests. Here are the remaining tests: https://github.com/DealerDotCom/sass-spec/tree/master/spec/todo/extend-tests Because they're mostly esoteric (aside from 090_test_comma_extendee) my assumption is that these are not dealbreakers for most people currently using @extend.\nThat said, we're evaluating whether we can squash the remaining 55!\n. That sounds great, @Westbrook. Our current work is on https://github.com/DealerDotCom/libsass/tree/feature/extend-support\n. @lunelson Which libsass are you testing with? The current from https://github.com/sass/libsass or the work in progress from https://github.com/DealerDotCom/libsass/tree/feature/extend-support?\nThe current libsass shouldn't be expected to work for any but the simplest cases, and I get the same output as Ruby Sass from the feature/extend-support code.\nFor housekeeping, can we avoid posting further cases with @extend on this issue? The cases in https://github.com/sass/sass-spec are pretty exhaustive. If you can't find your case there, you can make a pull request to add it. Thanks!\n. @deezahyn There are now 35 extend tests that fail/error, but they're all rare edge cases, with the exception of 090_test_comma_extendee. That's the syntax that allows @extend a, b; as a shorthand for @extend a; @extend b;.\nAnd please open new issues for those failing tests that turn out to be dealbreakers for you!\n. The node-sass project will be doing a release once libsass has its 3.0.0 release. In the meantime, it is possible to build node-sass (and thus use it) following the instructions here: https://github.com/sass/node-sass#rebuilding-binaries That said, it's not exactly for the faint of heart!\n. These are not all relevant to everyone, but the work on this issue has now been released where most consumers can \"just use it\":\nlibsass 3.0.0 is released \nnode-sass 1.0.0 is released\ngrunt-sass 0.16.0 is released\ngulp-sass 1.2.0 is released\n. The difference in the output is probably meaningful enough to be considered a bug, even if we don't hear back from @errorx666. It's an edge case, certainly, but until we know what's causing it I think we should take it seriously.\n. This looks like a partial duplicate of https://github.com/sass/sass-spec/tree/master/spec/todo/basic-extend-tests/190_test_semi_placeholder_selector, but that test does not verify output of the use of extend, just the definition of a grouped placeholder selector. Also, it is testing two things: descendant selectors and selector grouping. It may be preferable to have a test that only tests grouping.\n. Thanks, @kleinfreund. Your example is reproducible, for example  http://sassmeister.com/gist/c9217fcd6806435ab588, but there's also existing coverage for it in the sass-spec suite. (In fact, there appear to be two tests covering it - the second is here https://github.com/sass/sass-spec/blob/master/spec/todo/regressions/placeholder-mediaquery/input.scss !)\n. That's funny - we totally reported that at the same time!\n. This seems like an acceptable practice, but I don't see the reason to build it into the library. Some opinions have a clear benefit to everyone, but it seems like this is as likely to annoy someone as to help them. I'm glad it works for you, though!\n. grunt-sass has already been updated. see https://github.com/sindresorhus/grunt-sass/releases/tag/v0.16.0\n. @mgreter I've been out of the loop a bit for a few months because of other demands. If you let me know what coverage would be helpful, I'll work on getting that into sass-spec (if that's the test coverage you're referring to).\n. ",
    "rryter": "I also added a little bit to the bounty. To all involved in this: thank you so much for your effort! \nWe have just switched to libsass and dropped the Ruby on Rails asset-pipeline. It is really boosting our development speed... keep up the good work!\n. ",
    "sheerun": "@akhleung Could you describe your approach to fixing this issue, if you have any?\nWhat code is broken, what refactor could possibly help, what needs to be done at high level?\n. ",
    "thisguychris": "\n\"That said, we're evaluating whether we can squash the remaining 55!\"\n\n@michaek  Thank you for the brilliant solution! So I just want to ask, did the remaining 55 tests got squashed?\n. ",
    "albell": "Huge thanks to everyone on this. I anticipate that this will cut my day-to-day sit-and-wait-for-compile time massively. Highly appreciated.\n. Thanks. +1 for @supports feature query support, they are pretty useful for interoperability, even though Safari and IE still don't offer it.\n. ",
    "sintaxi": "This is wonderful. Thanks to all who helped make this happen. \n+1 to EOL the Ruby implementation.\n. ",
    "jschulte": "@bonfish Good questions! @DealerDotCom sponsored the development work on this (devoted full time employees to work on it for weeks!) because it is valuable for our development process efficiency. @uberska and @jaddessi had a lot of prior C++ experience, so they did the lion's share of the development work. @michaek and I helped with writing tests, fixing a few bugs and validating their work. It was a really fun project to work on and we're thrilled that it's available for others to enjoy!\n. The output of this test in the latest version is:\nbody {\n  max-width: 80%; }\nRather than:\n```\nbody {\n  max-width: 80%; }\n@media screen and (min-width: 300px) { }\n```\nWhile this is still incorrect, it's perhaps slightly better. It looks like some work still needs to be done to properly resolve this.\n. Hi Hampton, if you're referring to the \"remove placeholders\" fix I actually did that one (I work with @michaek), but not sure if you mean that or something else.\nI just tested this on our branch with all our fixes and I see this output (with the second \"odd\" mixin implementation as shown above), which seems a lot closer to the expected output, but not identical:\nul > li:nth-child(odd) {\n  background: #ccc; }\nul > li:first-child, ul > li:first-child + ul > li + li, ul > li:first-child + li + li + ul > li + li, ul > li:first-child + li + li + li + li + ul > li + li, ul > li:first-child + li + li + li + li + li + li + ul > li + li {\n  background: #ccc; }\n@errorx666: Does this solve the problem well enough, or is the output still different enough that it is causing problems?\n. Hi @alexismangin,\nI just tested this on my dev version of Libsass and I got the correct output. With the first example:\n```\n.page div header {\n  background: #123456; }\n.page div {\n  font-size: 10px; }\n.page div header {\n  color: green; }\n```\nWith the .page class removed:\n```\ndiv header {\n  background: #123456; }\ndiv {\n  font-size: 10px; }\ndiv header {\n  color: green; }\n```\nWhile I realize that isn't helpful if it's not working for you, perhaps the version of Libsass you are using doesn't have the placeholder fix? Do you see a remove_placeholders.cpp and remove_placeholders.hpp file in your Libsass instance?\nRest assured, the issue is fixed, we just need to figure out how to get it running for you!\nCheers,\nJonah\n. It looks like node-sass has updated to point at v3.0 of Libsass, so broccoli-sass will just need to update its dependency to use the new node-sass. Almost there! :-)\nhttps://github.com/sass/node-sass/releases/tag/v1.0.0\n. Good news, there is a pull request into broccoli-sass to get it using the latest Libsass:\nhttps://github.com/bakura10/broccoli-sass/commit/c66973f62e9627a9f45f823c4256bb198e306e0b\nIt should be available for you soon :)\n. The pull request has been accepted into the master branch of the original repository, so if you update now you should be able to use all of these new features. Enjoy!\n. I noticed this as well recently while working on Libsass 3.0, but decided it wasn't worth the effort to solve because there is no functional difference. Also, as you pointed out, \"a number is either an integer or zero or more integers followed by a dot, followed by one or more digits\". The way I read it, this isn't necessarily wrong, just slightly different from how it was done in Ruby Sass. It would be good to solve but shouldn't cause any issues for users.\n. Ooh, there you go. I'll work on getting a pull request in to fix that. :)\n. ",
    "renaudleo": "<3\n. ",
    "antoinelyset": ":tada: \n. ",
    "dilrajahdan": "Excellent Work!\n. ",
    "pkyeck": "thanks for the hard work. :tada: \n@hcatlin which commit closed this issue? I'm still getting wrong output from node-sass although they updated their dependencies some days ago ...\n. ",
    "sandstrom": "Awesome!! :boat: \n. I was just about to open an issue, and then I see this. :smile: A dream!\n. ",
    "gorilas": "It has been amazing what happened!!!! Thanks to everyone. Hurra y Viva!!!!\n. ",
    "jbeja": "Omg, I can't believe this is finally solve. Thanks to everyone from the bottom of my heart <3.\n. ",
    "ldexterldesign": "Apologies for the noise folks, but hoping someone will more knowledge can help me?:\nhttps://github.com/sindresorhus/grunt-sass/issues/162\nYours hopefully,\n. ",
    "dreamyguy": "Just had to say my thanks to this fix! Life-saver, just in time! :heart: \n. ",
    "terracatta": "Hitting this as well.\n. ",
    "calderas": ":+1: \n. ",
    "dimoreira": "Any news on this one?\n. ",
    "mantismamita": "+1\nAlthough the workaround works fine (thank you @kennethormandy) it would be nice if it were fixed. \n. ",
    "kleinfreund": "Is there any news on this one? Would be really nice to not obfuscate the code with the workaround provided above, although it works.\n. #460 is a duplicate of this, however a bit more detailed.\n. Reproduced this over there: https://github.com/dlmanning/gulp-sass/issues/65\nSteps to reproduce:\n``` scss\n.clearfix:after,\n%clearfix:after {\n    content: \"\";\n    display: table;\n    clear: both;\n}\n.site-nav {\n    @extend %clearfix;\n}\n```\nExpected output:\ncss\n.clearfix:after, .site-nav:after {\n    content: \"\";\n    display: table;\n    clear: both; }\nActual output:\ncss\n.site-nav:after {\n    content: \"\";\n    display: table;\n    clear: both; }\nI tested if it works with sass sass/main.scss css/test.css and it does.\n- gulp-sass v0.7.2\n- sass v3.3.9\n(Doesn't work with current versions either.)\n@michaek\nCan you reproduce this comment?\n. ",
    "arobbins": "Looking for a solution as-well =)\n. ",
    "Richard-Walton": "+1\n. ",
    "aceofspades": "+1\n. Thanks @kennethormandy for workaround\n. ",
    "kaptankorkut": "+1. By the way: Thanks @kennethormandy for the solution. \n. ",
    "tamlyn": "Another workaround: instead of filter: invert() use filter: #{\"invert()\"}. You can put whatever you want within the quotes and it will be output verbatim.\n. ",
    "cdCorey": "Thank you @tamlyn! I've been using Scout.app, which is apparently still on an old version of Sass, so your workaround is a fast, simple solution that actually works.\n. ",
    "MagicJoseph": "@function filters($filter, $value) {\n    @return #{$filter}#{\"(\" + $value + \")\"}\n}\n$prefixes: \n    \"-webkit-\",\n    \"-moz-\",\n    \"-ms-\",\n    \"-o-\",\n    null;\n@mixin prefixer($property, $value) {\n    @each $prefix in $prefixes {\n        #{$prefix}#{$property}: $value;\n    }\n}\n. ",
    "davidpatrick": "@tamlyn this was the fastest solution! Good job!\n. ",
    "signalwerk": "Ok. Kind of a Bug. But it would be saver to do it like that. Then it works.\nSCSS\n@for $i from 1 through 3 {\n  foo.bar#{$i} {\n    color: blue;\n    background-size: #{$i * 10%} 100%;\n  }\n}\n. there are workarounds. can you deliver a full example with all the variable declarations. then I can show you how.\n. sorry for the late answer. Here you go\n``` SCSS\n$serif-boolean: true;\n$font-family: if($serif-boolean, serif, sans-serif) !default; // Non-font-face font-stack\n$custom-font-family: false !default; // Custom font-face stack, if set will be added to the $font-family\n$font-size: 112.5 !default; // percentage value (16 * 112.5% = 18px)\n$line-height: 1.65 !default;\n$font-weight: normal !default;\nhtml {\n    @if $custom-font-family {\n        font: $font-weight #{1% * ($font-size/$line-height)} $custom-font-family, $font-family;\n    } @else {\n        font: $font-weight #{1% * ($font-size/$line-height)} $font-family;\n    }\n}\n```\ngives you\n``` SCSS\nhtml {\n  font: normal 68.18182% serif; }\n```\nIt's a workaround not a solution. But it works.\n. ",
    "goosechaser": "Same issue here. The following code doesn't work:\nhtml {\n    @if $custom-font-family {\n        font: $font-weight #{$font-size}%/#{$line-height} $custom-font-family, $font-family;\n    } @else {\n        font: $font-weight #{$font-size}/#{$line-height} $font-family;\n    }\n}\nPutting % inside the bracket doesn't help. Any ETA on the fix?\n. Thanks, here's the code (taken from https://github.com/typeplate/typeplate.github.io): \n$font-family: if($serif-boolean, serif, sans-serif) !default; // Non-font-face font-stack\n$custom-font-family: false !default; // Custom font-face stack, if set will be added to the $font-family\n$font-size: 112.5 !default; // percentage value (16 * 112.5% = 18px)\n$line-height: 1.65 !default;\n$font-weight: normal !default;\n. @signalwerk Hi Stefan. So what's the workaround?\nThanks.\n. Thank you, it worked.\n. ",
    "chrisirhc": "I'm getting this as well. This is very common in CSS (it's also in Twitter Bootstrap's CSS) and should be ignored by the compiler.\n. Verified that this is fixed on 7936f599cb . Thank you!! :+1: \n. ",
    "mattheworiordan": "I too have this issue.  Given a standard Twitter Boostrap CSS template cannot be parsed, I think this should be resolved if possible.  Thanks for a great lib.\n. ",
    "jrobeson": "@QuLogic : hmm this seems pretty useful. is it still valid, since #150 was merged?\nEDIT: by that i mean does it still work.\n. It would be cool to have this officially in fedora/EPEL.   In the near term we could have builds on https://copr.fedoraproject.org/ though.\n. you just need a FAS account (click the signup link), copr package  and your spec file.\n. I've never tried the CPack generated rpm files, but maybe those are worth a try? Then it could be part of the build process (once the CMake build system PR is finished)\n. I can replicate the issue on node-sass 3.0.0-beta5  (which should use libsass 3.2.0-beta.5) . Someone at  node-sass  suggest that it's fixed now though. https://github.com/sass/node-sass/issues/850\nI'm honestly not that familiar with node, so maybe this doesn't mean what i think it means:\nbash\n$ head -n 4  node_modules/broccoli-sass/node_modules/node-sass/package.json \n{\n  \"name\": \"node-sass\",\n  \"version\": \"3.0.0-beta.5\",\n  \"libsass\": \"3.2.0-beta.5\",\n. this is the only stuff i currently have in my app.scss file.\n``` css\n@import \"settings\";\n@import \"foundation\";\n@import \"font-awesome\";\n@import \"github\";\n.contact-info {\n    list-style: none;\n}\n```\n. ah truly. i meant to take github out, because it's just a css file (not sass/scss) and not relevant to replicating the issue. so pretend it doesn't exist (it's from the highlightjs package).\nbower.json\njson\n{\n  \"name\": \"site\",\n  \"dependencies\": {\n    \"foundation\": \"^5.0\",\n    \"fontawesome\": \"latest\",\n    \"jquery\": \"^2.0\",\n    \"highlightjs\": \"^8.0\"\n  }\n}\n. for some stupid reason i didn't even think about running it on the cli .. here we go:\nbash\nnode_modules/broccoli-sass/node_modules/.bin/node-sass -o build --include-path vendor/bower/foundation/scss --include-path vendor/bower/fontawesome/scss/ source/scss/app.scss \n{\n  \"message\": \"expected a variable name (e.g. $x) or ')' for the parameter list for url\",\n  \"column\": 24,\n  \"line\": 335,\n  \"file\": \"vendor/bower/foundation/scss/foundation/components/_forms.scss\",\n  \"status\": 1\n. i've made no customization to _settings.scss .. it's simply copied from foundation.. and showed the entire app.scss file i have. and i rm -rfed vendor/bower and reinstalled to make sure i had no customizations to anything in foundation.\n. oh, also it doesn't occur if i switch out libsass for ruby sass.\nEDIT: added the sass command i ran:\nbash\n$ sass -I vendor/bower/foundation/scss -I vendor/bower/fontawesome/scss/ source/scss/app.scss\n. YAY! . thank you too!\n. @jorgehatccrma : you can close this issue then.\n. ",
    "xiwcx": "+1\n. ",
    "bdkjones": "I strongly agree with @chriseppstein and @nex3 --- Sass-globbing should definitely not be a thing. \nIt introduces very subtle, very difficult-to-track bugs by affecting the cascade in unpredictable ways. I vote for closing this issue.\n. I mean the latter definition. \nThe trouble is that users are inclined to believe the former definition. They will almost always fire off an email or open an issue arguing, \"Sass is broken in X!\" And then the developer spends hours trying to track down what's going on, only to discover that the user's cascade was messed up due to globbing. It's a headache. \n. Thanks!\n. Here's another one:\nThe Ruby Sass compiler will sometimes return 'warning' messages even though a file compiled just fine. (An example would be deprecation notices.) How does libsass deal with this?\nI see the error_status int on the sass_context struct, but again there's no documentation about it. I assume a 0 here means \"everything compiled fine\" and any other code means \"compiling failed completely\". Is there a certain value here that means, \"Compiling succeeded, but there's some warnings in error_message that you may want to show to the user.\"?\n. Okay, problem partially solved!\nThe issue is that Apple's IDE only links the C++ standard library if it encounters at least one file with a C++ extension. Since I have zero of those in the project, it skips linking against the C++ standard library even though libsass.a requires it.\nI've added that link manually and now I'm down to 60 linker errors (from 81 previously). What other libraries does libsass depend on that I'll need to add? It'd be handy to have that list somewhere.\n. Nope. Linking against libm.so did not eliminate any of the errors. The ones in the image above are still present, relating to basic_streambuf.... Any idea what I'm missing? \n. Nevermind; I found the one that was missing. Thanks for your help!\n. The memory leaks appear to be real. \nHere's the trace on those: \n\nYou're calling strdup(), but I can't see any point where you free the values in this Sass_Value union. (I could just be missing it though; like I said, C++ isn't my best language.) If these ARE memory leaks, they're a huge deal for me. Most implementors of libsass (like sassc) will simply run once and quit, so if memory leaks it's not a big deal. But when libsass is integrated into a continuously-running app, memory leaks like this become KILLER because users compile Sass files hundreds or thousands of times before quitting my app. And each time, memory will leak.\n. Cool; I did not realize it wasn't currently used. \nHere's the trace on that other null pointer error. (I wrapped the line to fit it all in the shot):\n\n. The others did not generate a warning. \nBut I have traced the EXC_BAD_ACCESS exception to libsass. Here's the backtrace I get in my crash report:\n[Crash occurs]\n0   libsystem_c.dylib               0x00007fff8ca6d812 strlen + 18\n1   com.incident57.CodeKit2         0x000000010659fab4 sass_compile_file + 180\n2   com.incident57.CodeKit2         0x000000010659fab4 sass_compile_file + 180\n3   com.incident57.CodeKit2         0x000000010647ccfe __49-[LPEngineSCSS libsassCompileFile:fromTaskGroup:]_block_invoke + 91 (LPEngineSCSS.m:551)\n4   libdispatch.dylib               0x00007fff91b4e1d7 _dispatch_call_block_and_release + 12\n5   libdispatch.dylib               0x00007fff91b4b2ad _dispatch_client_callout + 8\n6   libdispatch.dylib               0x00007fff91b4d09e _dispatch_root_queue_drain + 326\n7   libdispatch.dylib               0x00007fff91b4e193 _dispatch_worker_thread2 + 40\n8   libsystem_pthread.dylib         0x00007fff84f11ef8 _pthread_wqthread + 314\n9   libsystem_pthread.dylib         0x00007fff84f14fb9 start_wqthread + 13\nUnfortunately, it's not possible for me to go deeper than this because all I have in my app is the libsass.a framework, rather than the code itself. I'm going to try swapping them out to see if I can trace the issue down into libsass's source.\n. Ok, with a bit of hacking I managed to replace the framework with all of the actual libsass source files, so my debugger can now step down into libsass's compile_file() method line by line and trace what's going on. I've narrowed the exception down to this data-setting step, here. I believe it's the last line, vector< ... >:\n\nI'm going to record a video and walk you through the debugger line-by-line so you can see what I'm seeing. \n. Figured it out. \nThe issue is that I did not set the image_path option on my sass_options struct. I had left that empty. Using the debugger, I traced the exception to the .image_path(...) line of Context::Data() in the image above, and that's what tipped me off.\nI'm leaving this issue open, however, for two reasons:\n1) It would have saved me HOURS had the .h file been properly documented to say, \"Hey; all of these option values in this struct are required. Don't leave any of them null!\"\n2) libsass should be able to deal with null options parameters either by setting defaults in their place, or throwing an error if an option is left null and can't be \"guessed\".\n. Here's the trace of the (potential) memory leaks using Clang, for reference:\n\nstrdup() returns malloc-ed memory, but I can't find anywhere in libsass where it's freed again. Wanted to confirm that this is intentional.\n. All I can tell you is that Less does it and it is lightning fast. I really can't recommend it enough. \n\nOn Dec 19, 2013, at 4:12 AM, Micha\u0142 Go\u0142\u0119biowski notifications@github.com wrote:\nWon't it slow everything down?\nAlso, you don't need to set up workspaces for the linking to work.\n\u2014\nReply to this email directly or view it on GitHub.\n. @Etienne is right: it should be an option, just as it is for Less.\n\nI think the vast majority of folks would rather edit stylesheets in a real editor than work in Chrome's Dev tools. For these people, having the original sass sources right in the map file seriously reduces headaches. \nA good example is Wordpress: it can be incredibly tricky to get source map urls to resolve to the correct path when you have Wordpress running with sub-sites. Another example is a sass file that is not part of a website's project folder. I might keep a sass file defining some basic styles on my disk and use it from a shared location across many web projects, without ever copying it into my website folder.  In this case, source mapping urls will always fail. The only way to make that work is to embed the source in the map file.\nSent from my iPhone\n\nOn Dec 19, 2013, at 10:50 AM, Etienne notifications@github.com wrote:\nMaybe this could be an option (as indicated in the spec).\nSo we could have the choice to use it or not.\n\u2014\nReply to this email directly or view it on GitHub.\n. Yep. @mzgol raises a good point with the live-editing in Chrome Dev Tools, but the reality is that most folks work in a good editor, save the file, and rely on any number of apps to refresh their browsers/devices. The reason this is very pertinent for me is that I'm about to release CodeKit 2, which will refresh browsers on everything from your Mac to your freaking kitchen refrigerator. \n\nSource Maps are a pain. Embedding the source content into the map file makes them much less painful.\n. Yes; I'm using sass_new_file_context(). Here's a screenshot of how I'm setting it up. This is Objective-C and the context is created on a background thread, but that's not the issue because once I set source_map_file, the crashes stop.\n\n. Also, I haven't looked at the implementation so there may be a good reason you're doing it the way you are, but it would be better if all the context parameters followed the same conventions. The source_map_file member should really be a const char * like input_path so that we could just do the following instead of allocating our own memory:\nctx->source_map_file = someString;\nAs it stands, there's a call to calloc() that's never balanced with a corresponding free() in the user's code. Instead, the user has to just \"know\" that libsass will free this memory when it's done. That's a bit sloppy. \n. The crash appears to have been fixed. Closing.\n. I don't think that's the case. Unicode is pretty complex. Some characters take up more than one byte, for instance, and must be handled correctly. There are several C libraries that deal with Unicode. Perhaps it would be worth looking at those? This is somewhat of an edge case: the characters that complicate Unicode are really all the Asian language ones, which are rarely used in CSS (but can be!)\nThe real issue is handling European characters such as: \u00e9, \u00fc, \u00f8, etc. Those will currently fail just as the above code does.\n. I absolutely LOVE the idea of zero-dependency. It makes me want to hug you guys. I have to deal with Jade and Stylus, which have like 7,231 nested dependencies. (Seriously, it's an absolute disaster).\nI'm fine with restricting libsass to UTF-8, but technically CSS supports all of Unicode, right? That is, it's possible for someone to specify a charset that's Unicode-16 with or without a BOM. In those situations, the above would not work.\nI require UTF-8 for my app and make no attempt to handle any other encodings, so I'm fine with it!\n. I'm not sure I've followed the above conversation correctly, but I do think it's important that libsass be able to handle non-ASCII characters such as \u00e9, \u00ef, \u0153, \u00f8 and so on. \nWith the content: property of CSS, it's quite common to run into these sorts of characters in stylesheets and libsass should, at the very least, not choke on them. As for UTF-16 and BOM... to hell with that. I suggest we make libsass UTF-8 compliant. That covers 99.9% of use cases and it is far, far easier than trying to deal with every possible character encoding, from ISO-Latin to UTF-16 BOM.\n. I don't build libsass at all. I take each .h and .cpp file and put them into my project. When I build my project, those files get compiled along with everything else.\nThe advantage here is that when libsass fails, my debugger shows me the exact line in the exact file causing the issue. If I build libsass separately and then just use the resulting library, I don't get that specific information; the debugger will simply indicate that something in libsass crashed.\nSent from my iPhone\n\nOn Feb 5, 2014, at 10:53 AM, Nick Schonning notifications@github.com wrote:\nCommenting out code in master is pretty bad too. Can you try to keep master clean???\n\u2014\nReply to this email directly or view it on GitHub.\n. I suggest making a fix for this issue a priority. A lot of Sass libraries (including Bourbon) have already been updated to use !global and I talked to @nex3 and @chriseppstein, who tell me we should be about 2-3 weeks away from a public release of Sass 3.3.\n\nIf that happens without a fix for this, a lot of libsass users are going to be in trouble!\n. Yea. Libsass needs to update to support the new 3.3 syntax; then I'll update CodeKit to resolve the problem.\nAll in good time.\nSent from my iPhone\n\nOn Mar 11, 2014, at 1:19 PM, jetlej notifications@github.com wrote:\nAlso seeing this issue with CodeKit and Foundation out of the box\n\u2014\nReply to this email directly or view it on GitHub.\n. I hope you guys didn't think I was adopting a \"why isn't this fixed!?\" tone.\n\nI'm quite happy with libsass and I've made it super clear in CodeKit's docs that if you use it, you need to be prepared to deal with a few things.\nThat said, I think it would be useful if libsass threw a little more descriptive errors. Instead of \"unrecognized syntax after...\" it could say: \"unrecognized syntax: !global ...\"\nBut I think that's sort of a general improvement to be made for all errors: better descriptions of exactly what's wrong.\nSent from my iPhone\n\nOn Mar 11, 2014, at 2:48 PM, Hampton Catlin notifications@github.com wrote:\nThat's an option. But, so far we've had minimal issues with compatibility\nbetween versions.\nI was just responding to the tone of this thread of \"WHY IS IT NOT\nFIXED?!?!?!\" and pointing\nout that the priority is to get feature parity with 3.2 first, before\nthere is concerted effort to\nmatch all 3.3 features.\nWe'll fix these as they come up, but we can't consider new features to\nSass the ultimate priority\nuntil we've fully caught up.\nThat being said, its my recommendation that tests for libsass are run\nagainst whatever the newest\nbuild is. If we are going to add a feature that was added in 3.2, I'm fine\ndoing it in a 3.3-compliant way.\nAka, imagine some spacing broke. I'd prefer to match 3.3's spacing, then\n3.2's, since we want to\ncatchup and there is no reason to re-implement.\nBut, if a feature or syntax is totally absent from 3.2 and was recently\nadded, then that is a secondary\npriority in the tickets and roadmap, generally.\n-hampton.\nOn Tue, Mar 11, 2014 at 2:38 PM, Chris Eppstein notifications@github.comwrote:\n\nDoes it make sense to have a 3.2 branch and a 3.3 branch and separate\nreleases for each? Then patches that land on 3.2 could get rolled into 3.3\nbut not the other way around.\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/278#issuecomment-37352612\n.\n\u2014\nReply to this email directly or view it on GitHub.\n. Could not agree more: the lack of !global support in Libsass is a huge pain. I get tons of email about it. \n\n\nI understand that implementing everything from Sass 3.3 is a ways off, but if we could get this one item implemented now, it would go a LONG way towards resolving issues. Most of the other 3.3 syntax stuff only affects people that are really pushing Sass to its limits. THIS issue, however, affects everyone who uses any sort of 3rd party Sass library (Bourbon, etc).\n. I'm fluent in C, but I've been hesitant to actually crank out any code for libsass for one main reason:\nI simply haven't had time to sit down and really look at the code to figure out how everything is structured, what style conventions everyone is using, etc. Plus, the existing code has very few comments in it to help --- I'd really have to go line-by-line to see what's up. That's certainly doable, but it's a lot more intensive than reading a quick comment above a function that says, \"This function does X and returns Y.\" Adding those comments in the future would really help new developers get up to speed on the codebase much faster. (Those comments are also all over Ruby Sass.)\nI also think a contribution guide could be useful. Put down some conventions regarding code style:\nif (noSpaces) {\n   doSomething();\n}\nvs.\nif ( noSpaces )\n{\n    doSomething();\n}\nAnd so forth. I also agree with integrating sass-spec. I think there should be a page that shows that spec in a long list and each point that's not yet implemented/compatible in libsass should be red. It would certainly help focus efforts on the most important issues.\n. That said, I AM about to ship a major update to one of my apps in a few weeks, so I should have a lot more free time on my hands in a month or so. I'll try to get up to speed so I can help out.\n. Libsass should not be \"validating\" imports that target a remote file (one on the internet). If the URI inside the import statement is remote (which can be ascertained by seeing if it contains a // sequence), then libsass ought to just toss that entire @import statement into the CSS.\n. The import has to be at the top of the file. That's clearly in the CSS spec: @import must be at the top.\nSent from my iPhone\n\nOn Feb 14, 2014, at 3:02 PM, Aaron Leung notifications@github.com wrote:\nI tried your example on the master branch and the import appears in the output (although LibSass doesn't move it to the top of the file the way that Ruby Sass does) ... have you pulled in the past couple of weeks?\n\u2014\nReply to this email directly or view it on GitHub.\n. Until this is fixed, the following serves as a hacky workaround:\n\n@-webkit-keyframes pulse {\n    0% { -webkit-filter: unquote(\"saturate(1)\"); }\n    50% { -webkit-filter: unquote(\"saturate(1.8)\"); }\n    100% { -webkit-filter: unquote(\"saturate(1)\"); }\n}\n. ### THEORY\nAfter further testing, it appears that this issue only manifests when any individual path in the colon-separated include_paths string is more than ~100 characters.\nThe length of the entire colon-separated string does not matter, but whenever any individual path within it exceeds about 100 characters, this issue starts appearing.\nWhen I shortened the paths to 97 characters max, I could not reproduce this issue at all. I added several paths of 97 characters so that the total length of the entire colon-separated string was well over 500 characters and libsass continued to work just fine.\n. Well, 4+ hours invested in this and it turns out the issue was a damn race-condition between two threads in my app. The longer strings trigger it. Sorry for clogging your inboxes about this; they should really just take away my keyboard so I can't program stuff anymore.\n. +1 for this. \nIt's been officially roadmapped for Sass 3.4 (along with a complete overhaul of the @import routines), but I can tell you from my email that the ability to import straight CSS is highly desired.\n. Well, both @import \"file.css\" and @import url(\"file.css\") are part of the actual CSS spec and, as such, should be left intact. That is, making one of these inline the contents of the CSS file would go against the spec. What is needed is a formal syntax to inline CSS, similar to what Less does. That's the right way to handle the issue.\nSent from my iPhone\n\nOn Dec 22, 2014, at 11:28, Marcel Greter notifications@github.com wrote:\nWhat's the status on this? If I'm correct we can implement to load css files at least with non-standard imports, like @import \"file\";? This would not touch the way how @import url(\"file.css\"); would be handled. Therefore people at least could use it in this way to include raw css files.\n\u2014\nReply to this email directly or view it on GitHub.\n. Hmm... if these files are an actual dependency of Libsass (which they now appear to be), they ought to be in the release zips. Otherwise, they ought to be conditionally included so that Libsass works without them if they aren't there. \n. Sweet! Submodules are so annoying.\n\nSent from my iPhone\n\nOn Oct 3, 2014, at 11:47, Hampton Catlin notifications@github.com wrote:\nsass2scss is no longer a submodule. So, this is now solved.\n\u2014\nReply to this email directly or view it on GitHub.\n. Sigh. Nevermind. It was an issue with the beta of Xcode 6. Using Xcode 5 to build it solved the problem. \n. Sorry, I should have been a bit more clear. The reason I said it doesn't matter whether the enum is explicitly declared as 32 or 64 bits is because (if I recall correctly) LLVM, unlike GCC, chooses and enforces the appropriate storage size automatically by inspecting the possible values of the enum.\n\nThat said, setting C++11 as the standard C++ library solved the issue. Thanks!\n. I think the problem is with the exports() mixin in bower_components/foundation/scss/foundations/_functions.scss\nZurb uses an exports() mixin to import things only once and this same sort of \"missing lines in CSS file\" bug happened when Ruby Sass changed the behavior of index() so that you had to compare it to false rather than doing !index(...). \nEither way, that's probably where I'd start looking for the trouble. And again, Libsass 2.0 compiles everything just fine. So this looks like a regression in 3 RC4.\n. Awesome. \nOn a more general note, I think it would be wise to assemble a list of the top 5 major sass-based frameworks and proactively check each of them with each major release of Libsass.  Here's why: the majority of people who build websites start with a framework. Foundation, bootstrap, bourbon... Few people are going to start from scratch and code their own grids, etc.  \nTo these people, if you push an update to Libsass and their Foundation site is suddenly all screwed up, Libsass gets the blame. Fairly or not, folks think, \"I updated Libsass and now everything is wrong. Libsass is buggy.\" (I would know; I get those emails about CodeKit updates all the time.) \nWhen you push major releases, I'd check the top 5 frameworks and make sure they compile correctly. If they don't, contact the framework vendor and give them a chance to update their stuff. This sort of coordination between Sass and its major vendors would help end users A TON.  \nIt also helps you guys, because no one will adopt major Libsass releases until the major frameworks are on board. I know it's a headache and I'm not advocating doing it for every minor update, but at least for major, earth-shaking releases like 3.0, a bit of \"developer relations\" would go a LONG way.\n. @hcatlin @chriseppstein \nRegarding my comment above about getting all the major vendors to test major Libsass releases before they ship, I've just sent an email to all the Sass vendors in CodeKit: Zurb, Bourbon, Bourbon Neat, Susy, Jeet, and Google Web Starter Kit. \nI included a pre-release build of CodeKit that has Libsass 3.0 RC4 built-in so that they can test without having to build the CLI utilities from source. I also sent free licenses to everyone to unlock the app. Hopefully, this will make the 3.0 rollout a little smoother by making sure the major frameworks are ready for it. Coordination FTW!\nI know there are other vendors that I missed. I'm happy to include them as well, just let me know who they are. I'm also happy to continue doing this for future major Libsass releases.\n. No problem. Thanks for the shoutout in the release notes as well!\nI figure not everyone is comfortable building source files with make scripts, but if there's a GUI available with the pre-release version and they can just check a box and click \"compile\" to test their framework, it's a much lower bar. Testing stuff is already full of headaches; getting the compiler set up just to start testing shouldn't be one of them.\n. /cc @mgreter, who appears to be responsible for the base-64 embedding.\n. Also: I just read the thread where this new base-64 embedding was discussed. It's cool that the feature exists for those that want it, but at no point in that entire thread did anyone ask, \"What should the default behavior be? What settings make sane defaults?\"\nDefaulting to base-64 embedding for maps was, for the reasons outlined above, a bad decision. But it's a decision that seems to have been made with zero discussion. The default behavior of the compiler was changed and no one stopped to ask if the new defaults would cause problems. I think we should do that in the future when new features are introduced. \n/cc @hcatlin \n. I believe in C++ that primitives are not initialized to anything unless you provide an initial value when defining them. So, source_map_embed will have whatever random bits were last set in that memory block, which may not be --- and probably almost never will be --- 0 (false).\nSee: http://stackoverflow.com/a/16782131/463439\nAlso: there is a note there that certain compilers WILL initialize bool to false. Perhaps GCC does that. I'm compiling with Clang because it's not 1996 any more. :) That could explain the difference.\n. On that note, now would be a good time to add sane default initial values to ALL the bool options. \n. Curious. I use the C API, with the sass_new_file_context. I see what you mean: calloc should cause the bools to start with 0 (false). I don't know why, but that does not appear to be happening. I can post the code I'm writing to use Libsass when I get back to my laptop.\nSent from my iPhone\n\nOn Nov 5, 2014, at 10:08, Marcel Greter notifications@github.com wrote:\nSorry, I didn't actually mean if it is initialized on declaration (which it obviously is not as you correctly stated above). But I had in mind that I saw the context beeing explicitly beeing intialized:\n(sass_context*) calloc(1, sizeof(sass_context))\nBut this is of course only valid for the C interface, which may explain why I did not see this problem before. So I guess you're using libsass directly via the C++ interface?? I will now debug a little further to see if that is logically even possible (if C++ is not initing the context).\n\u2014\nReply to this email directly or view it on GitHub.\n. The default precision should probably be 10 digits. @chriseppstein wrote a long thread about it a while back and I can't find it now, but the TLDR version is that it makes a big difference for grids. \n\nSent from my iPhone\n\nOn Nov 5, 2014, at 10:24, Marcel Greter notifications@github.com wrote:\nOK, this is probably a real issue when using libsass via C++ interface.\nIMO the options should get a default value in context.hpp like this:\n// string with source to compile\nconst char* source_c_str == NULL;\n// for the image-url Sass function\nstring image_path = \"\";\n// for relative paths to the output\nstring output_path = \"\";\n// for inline debug comments in css output\nbool source_comments = false;\n// output style for the generated css code\nOutput_Style output_style = NESTED;\n// path to source map file (enables feature)\nstring source_map_file = \"\";\n// embed in sourceMappingUrl (as data-url)\nbool source_map_embed = false;\n// insert included contents into source map\nbool source_map_contents = false;\n// disable source map comment in css output\nbool omit_source_map_url = false;\n// treat source string as sass\nbool is_indented_syntax_src = false;\n// precision for outputting fractional numbers\nsize_t precision = 0;\n// status flag to skip source map updates\nbool _skip_source_map_update;\nMy compiler did not complain, so I guess the header is the correct place for this!?\n\u2014\nReply to this email directly or view it on GitHub.\n. I think I understand what's happening. Here's how I'm setting up Libsass:\n\n\nI'm creating the options struct and then setting it on the context. Therefore, the call to calloc never zeros out the bools in the struct.\n. Indeed. Now if you can just tell me what's up with that Autoprefixer-source-map bug, I'll be all set!\n. Update: The plot thickens. I went into source_map.cpp and commented out the lines of code that put that file parameter in the source map (it is optional, after all). But this did not solve the problem with Autoprefixer. \nWhat's Happening\nWhen I run Autoprefixer on the compiled CSS file and pass the -m flag, the source map no longer works in my browser. Upon inspecting it, I find that Autoprefixer has added \"app.css\" to the beginning of the sources array in the source map file. \nThis is obviously not correct. The app.css file cannot be a source file; it is the output file. If I manually delete that entry from the sources array, the source map works correctly again. \nRuby Sass Works Fine\nInterestingly, Autoprefixer only does this if Libsass is used to generate the source map. When I compile the Sass file using Ruby sass and generate a map, Autoprefixer does not add app.css to the start of the sources array and the source map works correctly. \nRemoving the file parameter does not fix\nRemoving the file parameter from the Libsass-generated map does not fix the issue; Autoprefixer still adds app.css to the sources array. \nTheory\nThere's something screwy with the mappings that Libsass is generating, which is throwing off Autoprefixer (and likely any other tool that's trying to modify the source map). \nImpact\nI know this (A) is one very obscure and difficult-to-define bug and (B) seems low-priority. But TONS of people now rely on Autoprefixer and Ruby Sass's maps work just fine with it, so the problem does appear to be Libsass-related. \nAfter looking through source_map.cpp briefly, I do see that the file parameter is being used in the mappings process. And file is definitely wrong (as discussed in the original post), so hopefully fixing that will also solve this problem. \n. ### Regression\nI just tested Libsass 3.0.1 and the behavior is the same. The file parameter is still incorrect and Autoprefixer is still misinterpreting the map that Libsass generates. \nThat rules out all of the changes made to source maps for 3.0.2, but it's now 1am, so that's as far back in regression testing as I'm going tonight. \nAren't source maps fun!?\n. Just pulled down the master branch and tested: same result. \nI get the same incorrect path in the file parameter: ../scss/app.css\nThe test case I'm using is a 100% normal installation of Zurb Foundation. I've posted it as a download here --> http://incident57.com/timothy/newzurb.zip\nGrab that and try compiling the 'app.scss' file in the scss folder to app.css in the css folder. Additionally, make sure your source map is named app.css.map (which follows the recommended naming convention described in the source map spec) rather than app.map, which does not follow the spec. Perhaps this explains the difference? In your test cases above, you're using app.map rather than app.css.map. \nLibsass is creating the output file and source map in the right locations, so I'm positive that I'm passing the right paths into the C API for Libsass.\nAt any rate, the master branch exhibits the same incorrect behavior. \n. #### Update\nI just tried naming the source map app.map instead of app.css.map to match your test case and I'm still getting the same incorrect value for the file parameter in the source map.\n. Also interesting: now that I'm using the master branch, the sourceMappingURL at the bottom of the CSS output file has changed. It used to be:\n/*# sourceMappingURL=app.css.map */\nNow, it is:\n/*# sourceMappingURL=../css/app.css.map */\nThis is technically correct, but unneeded. It's going up a directory, then back into the css directory and then listing the map file (which is right next to the CSS file).\n. Ah! That's the difference! Setting the output_path on the context has solved the file issue; the correct path is now put there. \nUnfortunately, though, this has NOT solved the issue with Autoprefixer. For some reason, it continues to add app.css to the beginning of the sources array when it reads the source map and modifies it. Again, it does NOT do this when I use Ruby Sass to compile and generate a source map, so it does appear to be isolated to Libsass. \n. I've updated the issue title to more accurately describe what's happening. \n. I'm positive that it's adding app.css. Here's a screenshot of the source map once Autoprefixer rewrites it (offending addition indicated by yellow arrow): \n\n. To resolve the error you're getting, you need to add the bower_components/foundation path to the load paths option of whatever binary you're using to run Libsass. That will cause the @import statements to resolve correctly.\n. As for a simple case: I just tested that over here, with a single Sass file. Autoprefixer modifies the source map generated by Libsass and does NOT add the CSS file to the sources array. Everything works as it should. \nTherefore, the test case to use is Zurb Foundation. It's the type of code folks will compile in the real world and it appears to break source maps in Libsass. \n. Here's a (large, 8MB) screenshot of what's going on, with everything clearly marked:\n\n. Also, to narrow things down I took my app out of the loop. Here's what I did:\n1. Installed the latest version of autoprefixer: npm install autoprefixer.\n2. cd-ed into the output folder that contains the CSS and .map files.\n3. Ran this command: autoprefixer -m *.css\nThat gives the results in the screenshot above --- if the source map was generated by Libsass, Autoprefixer does not handle it correctly. If it was generated by Ruby Sass, Autoprefixer does handle it correctly. \n. And one more detail: the app.scss file, as it comes from Zurb, contains only @import statements. When I first compiled it with Ruby Sass (and had a map generated), there was no reference to app.scss in the sources array because there were no mappings to anything in that file. So, I added a single rule to app.scss: \nbody {\n    background-color: red;\n}\nThe map generated by Ruby Sass then contained ../scss/app.scss in the sources array because a mapping now exists to that rule. This had no effect on the Libsass-Autoprefixer behavior.\n. I don't recall. However, given that Autoprefixer handles source maps from Ruby Sass just fine, I suspect the problem is with Libsass. \n. This is incredibly useful and was long overdue. The sass_interface file has never been really well documented. A few comments there would go a LONG way towards helping implementers. \n. Hmm... I'm not really a fan of using a ton of functions just to set options on a struct. That's a lot of wasted overhead. I think a better approach would be to implement a single function that returns a sass_options struct initialized with sane defaults. Then you could modify that struct yourself to customize it. I don't really see myself switching to this new API, so perhaps keeping the old one around is a good idea.\nSent from my iPhone\n\nOn Nov 9, 2014, at 13:10, Marcel Greter notifications@github.com wrote:\nPull request has been placed: #635\nPlease give your thumbs up if you like to have this merged!\nSorry to also include the other commits, but I'm too lazy right now to take them apart ...\n\u2014\nReply to this email directly or view it on GitHub.\n. Also, there's really only a handful of implementors that are going to use this API, right? sassc, myself and maybe a few others. All the higher-level implementors are just going to call sassc, no? I think the old sass_interface API was fine, it just needed some solid documentation and comments to make sure folks used it correctly and avoided the common pitfalls. So creating a totally fail-safe API at the expense of performance (no matter how small the decline in performance) isn't a good deal in my opinion. Faster is better. Finally: I've only looked at the documentation on my iPhone on the road, so my apologies if I've missed something.\n\nSent from my iPhone\n\nOn Nov 9, 2014, at 13:10, Marcel Greter notifications@github.com wrote:\nPull request has been placed: #635\nPlease give your thumbs up if you like to have this merged!\nSorry to also include the other commits, but I'm too lazy right now to take them apart ...\n\u2014\nReply to this email directly or view it on GitHub.\n. Fair enough. I'm fine with the getter/setters as long as I don't have to call all 15 of them just to set the options every time I compile a file. A helper that returns an option struct with initialized defaults would be perfect. As for performance: my general policy is to avoid things that degrade it if at all possible. I know that the additional function call overhead won't make a noticeable difference in speed, but over time, if more and more changes add a little extra overhead, it can add up!\n\nSent from my iPhone\n\nOn Nov 9, 2014, at 14:05, Elliott Sales de Andrade notifications@github.com wrote:\nI'm not really a fan of using a ton of functions just to set options on a struct. That's a lot of wasted overhead.\nIs it really? GLib and GTK+ did this for every structure they had, and they don't seem to be complaining.\nI think a better approach would be to implement a single function that returns a sass_options struct initialized with sane defaults.\nThere's no reason there couldn't be helper functions like this alongside the lower-level getter/setters.\nAlso, there's really only a handful of implementors that are going to use this API, right? sassc, myself and maybe a few others. All the higher-level implementors are just going to call sassc, no?\nNo, absolutely not. Everyone (binding-wise) should use the API. Shelling out to sassc is a going to lead to a very broken and possibly stagnant interface.\n\u2014\nReply to this email directly or view it on GitHub.\n. Yep, but setting up the context is part of running Libsass. I definitely understand that this isn't part of the actual compiling step, but it is still a step in the whole process and will be slightly slower than it used to be under the old API. So setting up Libsass will be slightly slower. (I'm also a performance nazi... I may be in the minority.)\n\nSent from my iPhone\n\nOn Nov 9, 2014, at 14:07, Marcel Greter notifications@github.com wrote:\nSo creating a totally fail-safe API at the expense of performance (no matter how small the decline in performance) isn't a good deal in my opinion\nThe new API is only used to setup the context. This has absolutely no influence on the libsass compilation speed.\n\u2014\nReply to this email directly or view it on GitHub.\n. Any updates on this? I'm looking to access the filename and line numbers in my custom function that handles @warn and @debug statements. \n. Could it potentially be easier to simply have @warn and @debug handled by Libsass itself, rather than rely on the custom function approach?\n\n99% of people are just going to write functions that log the message, line number and file of these warnings, right? Since there's no real customization to be done, what benefit is there in relying on the custom function approach? Does it maybe just make more sense to have Libsass log the output like it does for any other error?\nSent from my iPhone\n\nOn Apr 21, 2016, at 04:46, Marcel Greter notifications@github.com wrote:\nSome ground work was already done and included in libsass, but not that we could yet craft a good and future proof API (we need to further refactor how we internally account for these states).\n\u2014\nYou are receiving this because you commented.\nReply to this email directly or view it on GitHub\n. Outstanding. Thanks for the super-quick turnaround!\n. Would the message associated with the @debug or @warn statement be in the s_args parameter, then? \n\nThe docs on custom functions are a little sparse (and also mention that everything is experimental). \n. For example, the Sass_Value union has structs for Sass_Warning (which I assume would be used for @warn statements?), but what gets used for @debug? Is that a Sass_String? I know these must seem like really dumb questions if you're someone who's intimately familiar with the Libsass source, but from the outside, the custom functions are a little tough to grok. \n. Also: the docs state that my custom function must return a value. In this case, all my function does is look at the string associated with the @warn or @debug statement and record that string somewhere so I can display it in a UI. What is the appropriate value to return in this instance?\nThe custom function example always returns \"42px\". But if I return some sort of string, is that going to wind up in the output?\n. Interesting. So the Sass_Value won't actually be one of the structs listed in the union, but rather a string directly? Is that behavior that's going to change?\n. I see, so Custom_Error is used for @debug statements? And both have a message property. And returning 0 should work, maybe? :)\n. Okay, so s_args will be a list. Now suppose I use the example from the Sass docs for debug:\n@debug 10em + 12em;\nThis is supposed to return:\nLine 1 DEBUG: 22em\nIn Libsass, is this going to be a single string? Or am I going to get a bunch of different value types where \"line\" is a string, \"1\" is a number, \"DEBUG:\" is a string, 22 is a number and \"em\" is a string? I'm just a bit confused because @debug and @warn output strings, but the above makes it sound like they could potentially output a list of all kinds of values, which makes dealing with the output much harder.\nAnd finally: I still vote that @warn and @debug should not be second-class citizens in Libsass. They are both primary features of Sass and the compiler should have built-in support for them without requiring each implementor to build that support themselves. (It's also safer: no one is in a better position to properly implement these functions than the Libsass team.)\nNote: by \"built-in support\" I mean the ability to retrieve a list from the Sass_Context of warnings and debug output that occurs during compiling, just as we retrieve the contents of the source map, for example. Libsass doesn't just blindly throw the source map output to stdout; it stores it in the context so that implementors can do things with it. I believe the same should be done for @debug and @warn output because, unlike other custom functions, those are primary features of Sass. \n. I've written a custom function to handle @warn. s_args is indeed a list and I can walk through it and pull out the string from the @warn message. However, the line number and file from which that message was pulled are not in s_args. This is kind of critical information to have. Is there an API to get it? \n. I've written a custom function to handle @debug, using the example above from the official Sass docs (a simple 10em + 12em) \ns_args is indeed a list, with length 1. However, when I attempt to handle that value I find that it is NOT any of these: Sass_String, Sass_Warning, Sass_Error, Sass_List, Sass_Map. I have not tested Sass_Boolean, Sass_Number, Sass_Color, etc because those seem really unlikely.\nSo... how do I get the @debug statement out of s_args? And, additionally, I think the same problem with the filename and line number from @warn will apply here as well.\n. Looking at the link you posted (https://github.com/sass/libsass/blob/master/src/eval.cpp#L321-L337), it appears that the backtrace is never available to the custom function that handles @warn. That's a pretty big limitation and, IMO, renders the \"use a custom function to handle @warn and @debug\" an unworkable approach. Perhaps re-open until this limitation is addressed?\n. I see. What threw me off was the \"em\". I expected 12em to be a string because of the presence of \"em\", which isn't a number.\nSent from my iPhone\n\nOn Jan 10, 2016, at 07:03, Marcel Greter notifications@github.com wrote:\n10em + 12em should resolve to a number of 22em, so yes, I expect you get a number there (what if you would want your own version of sprintf). Thought this was obvious, @debug(1px+2px, \"foo\" + bar, 5 > 3) should IMO give a list of 3px, \"foobar\", true which are of type number, string, boolean.\nAs for the parser information (line numbers etc), this would be a duplucate of #1037\n\u2014\nReply to this email directly or view it on GitHub.\n. Anyway you guys could do a hotfix release for this? It's affecting a wide number of people who are trying to compile Foundation 6 with Libsass. If the milestone is 3.3.4 (which you're saying is March), I'll have to roll back to Libsass 3.3.2\u2014this bug is a showstopper. \n. Ok. I'll rollback. Adding Foundation to the release check sounds like a great idea; it's massively popular and has lots of complex Sass that provides a great real-world test.\n. Update to CodeKit 2.7.1. I rolled Libsass back in that release.\n\nSent from my iPhone\n\nOn Feb 11, 2016, at 22:52, Joop Vos notifications@github.com wrote:\nSame problems here. Is there a doc about how to rollback Libsass in Codekit? I'm a front-front-end guy ... :\\\n\u2014\nReply to this email directly or view it on GitHub.\n. When is the 3.3.5 release scheduled, roughly? I ask because I'd like to ship an update with Libsass 3.3.4, but the many regressions since 3.3.2 make that difficult. If 3.3.5 is roughly around the corner, it'd be better to wait for that, I think. Thanks!\n. Stoked to see static analysis incorporated! It has saved me from shooting myself in my foot many, many times. Especially after refactoring stuff. . Interesting. According to https://developer.apple.com/library/content/qa/qa1419/_index.html, the default stack size for Clang on macOS is 8MB. I'll verify.\n\nEdited to use the official Apple reference rather than a SO answer. The default is 8MB. I'll raise it to 16 and see if this resolves.. Ok, I verified that the process running libsass has an 8MB stack. I then raised this to 64MB, which is the maximum value permitted by macOS. I verified that the process had a 64MB stack as shown below using getrlimit() and setrlimit(). \n\nI'm still getting the exception, though. I'm totally willing to admit this is related to the compiling options I'm using, but do you have any suggestions for what else to check? . Yea, the linker flag is -Wl,-stack_size,1000000 for a 16MB stack. But you can also raise it dynamically at runtime using setrlimit(). I've done both. I'll keep playing around, but the tool where you're verifying this is running Libsass 3.4.xx. Is there a way to test with that tool using the same build of Libsass that I'm using? (The 3.5.0 Beta 3 release).. Yea, I'm positive the linker flag is getting through. Here's the result, showing the libsass-service has a stack size of 64MB:\n\nMy current theory is that while the main thread of this process has the huge stack, the secondary thread where Libsass is actually running has been set up with a 512kb stack. I'm using Apple's XPC framework to run Libsass in an isolated process and I'm not super familiar with the low-level details of how XPC manages its threads---you don't get to control how XPC spawns and runs threads; that's all implementation details. But that would explain this behavior so I'm looking into it.\nI'll go ahead and close though, because this doesn't sound like a Libsass issue.\n. sigh. Confirmed. If I take XPC out of the equation and just run Libsass on the main thread of my app, this issue disappears. The child process in XPC is spawning custom threads to do its work and it's setting the stack size of that thread to 512kb. The 8MB default applies only to main threads in macOS.\nDunno how to combat it yet. Have I told you guys how much I love programming recently?. Yea, I saw that libuv bug while googling earlier. Their solution appears to be the only one available: create your own thread and set the stacksize manually before creation (it can't be changed once the thread is running). That's extra overhead because it has to go down into the kernel, but I can't find any other workaround. I have a SO question posted and I'll file a Radar with Apple --> http://stackoverflow.com/questions/42551114/xpc-service-raise-stack-size-on-worker-thread. I do see the sass_compiler_get_import_stack_size() and sass_compiler_get_import_entry() functions, but these return a Sass_Import_Entry. The entry struct has sass_import_get_abs_path(), but the header indicates that function returns the absolute path after my import function has resolved it. What I'm looking for is the absolute path of the file containing the @import. I'm sure I'm just missing it, so an example in the importer docs would be helpful.. Well, after trying it out, it looks like that sass_import_get_abs_path() does return the absolute path of the file containing the @import statement. But this page has a comment next to abs_path which says, \"path after importer has resolved it\". That led me to believe abs_path wouldn't be relevant until my importer had resolved and set it.\nI guess I just need to confirm that this is the correct approach:\nSass_Import_List glob_importer(const char* path, Sass_Importer_Entry cb, struct Sass_Compiler* comp)\n{    \n    size_t idx = sass_compiler_get_import_stack_size(comp);\n    if (idx <= 0) {\n        // Avoid the out-of-bounds exception.\n        return NULL;\n    }\n\n    Sass_Import_Entry entry = NULL;\n    entry = sass_compiler_get_import_entry(comp, idx - 1);\n\n    if (entry == NULL) {\n        return NULL;\n    }\n\n    // Get the path to the file containing this @import statement\n    const char *filePathOnDisk = sass_import_get_abs_path(entry);\n\n    // Do stuff\n}\n\n. I'm working with Libsass 3.5.0 Beta 3. The latest tagged release on GitHub.. So abs_path of a Sass_Import_Entry is always the absolute path of the file containing the @import statement and NOT the absolute path of the file BEING imported?\nIf so, I'd recommend adding a note to the docs and maybe include an example of this process on the import-handler examples page.. I'm accessing the info from an importer. I'm adding a custom importer to support basic globbing (yep, I know it's a terrible idea, but the world is full of people who just want to make their lives difficult).\nI have a file named main.scss with @import \"neat\";. Using the above approach in my import-handler, I get the following:\n@import found for path: neat\nPath on disk: /Users/bdkjones/Desktop/neattest/main.scss\n\nIt would appear that abs_path contains the path of the file that has the @import statement, at least during the \"resolve imports\" stage.\nIt's a little strange that abs_path changes. I would have expected it to be NULL before my custom import-handler resolved the @import statement. Perhaps a better approach would be to add a new property to Sass_Import_Entry that always contains the absolute path of the file containing the @import statement? Something like parent_abs_path?. Although that wouldn't be relevant in cases where @import is resolved as source-content rather than passing file paths back to Libsass (such as when loading a remote resource). I dunno...this is why you guys are the API designers and I just file issues!. From the passed import to the custom importer.\nThat reference implementation of globbing is perfect! Perhaps a link to that on the docs page for custom importers would be useful. Besides updating the docs, though, I don't think this is an open issue.. Given this change, should Libsass implementers now use sass_option_push_import_extension and provide css?\nIf I do so, will the current release of Libsass still display the deprecation warning?. Sure thing. I can open it on node-sass as well, but I thought I'd file an issue here to discuss the possibility of adding a --precision=all option that does what these people want.\nIs that a feature that's worthwhile?. Well, they could update that documentation paragraph ;) I'll hop over to the main Sass repo.. Related issue with examples: #2717. ",
    "ry5n": "Our team is looking to switch to libsass as it nears feature parity. One thing I would miss is globbing. Like Ben, I\u2019d like to know if a plugin system could reasonably exist for libsass to make non-core features like this possible.\n. \u201cThe reference implementation of Sass doesn't and will not support globbing\u201d \u2013 @\u200anex3 (see above).\nI like and use glob imports, but I respect the language designer\u2019s decision here. I think we should stop asking libsass to support non-reference features. It would be nice to have some way of adding such features to non-Ruby implementations, but that\u2019s probably a separate issue.\n. ",
    "uglymunky": "Sass is a great tool but It's frustrating not being able to do this.\nOur team has two primary sets of scss files: core.scss and views.scss (we also have vendor.scss but that's not related to this post)\ncore.scss rarely changes and views.scss is where we do 90% of our work.  Each time we create a new view we create a new scss file for that view.  The views all depend on core.scss and they are all independent from each other.\nBecause it's not an option to have our engineers go in and manually add an @import each time they create a new view our workaround for not being able to import a folder has been to concatenate all views scss files into one, and then compile that one file.  I then have a master.scss that does:\n@import 'core'\n@import 'views'\nI should be able to skip the concatenation step and simply do:\n@import 'core'\n@import 'path/to/views'\n. ",
    "dustinhorton": "Just want to +1.\nAs someone admittedly completely ignorant to writing software this complex, it seems like a really bizarre line to draw. I feel like there's many things more complex about the most basic of Sass features.\nI'd be curious if the Grunt team has experienced issues...globbing is very popular in Gruntfiles. Different language obviously, but some of the same concerns.\nAlso would hate to see a language kept simplistic because of support requests for an app that leverages the tech...that complaint seems irrelevant. And it could be combatted by adding to the UI messaging to explain/warn, or a UI to build the import statements that visualizes what's actually happening.\n(Sorry that this thread is taking place on the libsass repo, but just chiming in where it seems it'll be heard.)\n. ",
    "iki": "+1 for alphabetically sorted globbing, or require-like feature to add plugins\n@nex3 file rename changes the order? yes that's a feature if we use sorted globbing, we can work with that just fine\n. ",
    "josephspens": "+1\nI guess I'm still unclear about the concerns with regards to adding some sort of globbing mechanism. From reading this thread so far, it seems the main and only concern is the inconsistent ordering of globbed partials could cause unintended cascade issues after compile. Is that a fair assessment?\nIf so, that would be an architectural design flaw of the implementing project, not of the underlying tools.\nIf I wanted to import some partials in this manner...\nsass\n@import \"partials/a\";\n@import \"partials/b\";\n@import \"partials/c\";\n... however I mistakenly ordered them like so...\nsass\n@import \"partials/c\";\n@import \"partials/a\";\n@import \"partials/b\";\n... and the reordering of the cascade created some unintended side effects, would you place blame on the developer who imported the partials in the wrong order, or Sass for not catching a mistake which is impossible for anyone but the developer to recognize?\nCorrect me if I'm wrong, but this scenario seems the same as glob importing all the partials with @import \"partials/*\"; and blaming Sass for the incorrect ordering, should the order matter.\nGlobbing is intended to include partials which are independent of each other, meaning the order in which they are imported does not matter. Using a globbing mechanism outside that context is the fault of the user, not the library. \n. @ry5n That's fair. Feel free to apply my arguments in support of your earlier comment to promote a plugin system, that way these discussions can happen outside the core. As was already pointed out by @benfrain, globbing already exists as a ruby gem.\n. ~~Do we know what version this will be available?~~\nNever mind, I see the 3.2 milestone on the PR itself. I wantz it now!\n. ",
    "jezen": "Globbing may exist as a ruby gem, but I\u2019m only interested in using LibSass to sever the Ruby dependency. Defeats the purpose.\n. ",
    "hannahhoward": "+1 for implementing this, or creating a way for a plugin to do it if not. my team relies heavily on globbing in ruby and it's a bummer to not have it as we try to switch to libsass\n. ",
    "renestalder": "+1\nPeople are always concerned about the ordering. In fact, I realised about 3 Projects with up to 40 SCSS files and hadn't any problems. Thus it's always up to the developer how to use a system.\n. @mgreter @chriseppstein Not \"luck\", a good file structure, that's it. There are several things you can do.\nFor example you could structure your files in a atomic design manner with following folder structure\n- util\n- quarks\n- atoms\n- molecules\nThen make a root level stylesheet, first importing all files from util, then from quarks, then from atoms,... etc.\nOr as I used it in some projects\n- settings\n- shared\n- specific\n  - photogallery\n    - _base.scss\n    - _medium.scss\n    - _large.scss\nWhere settings are mixins and config variables. Shared are global used styles or general elements. And specific are page specific elements as in the example above.\nIn the root level stylesheet I have my media queries, importing the correct sizes of each component in the right media query.\n``` scss\n@import 'settings/*/';\n@media #{$medium} { \n  @import \"shared//_medium.scss\", \"specific//_medium.scss\";\n}\n```\nThe components on the same level have no dependency to each other. They can be used uncoupled, with a dependency to settings or shared components, if needed.\nSo it's always up to the developer to use this the right way.\n. @GDmac IMHO with \"these rules must precede all other types of rules...\" the at-rules are meant, but not selectors. Correct me If I'm wrong.\n. ",
    "DennisBecker": "As a workaround solution for the missing globbing feature I have written https://github.com/DennisBecker/grunt-sass-globbing today for use with grunt-sass plugin.\nAt the moment, it lacks of correct documentation (I will complete it next week).\nYou can migrate from Ruby sass-globbing to grunt-sass-globbing as follows:\nWhen you have an import like this one:\n@import \"partials/variables\";\n@import \"my/folder/**/*\";\nThen you add the following config to your gruntfile:\nsass_globbing: {\n  dist: {\n    files: {\n      'my/_folder.scss': 'my/folder/**/*.scss',\n    }\n  },\nAnd execute this task right before the sasstask.\nI would expect you add my/_folder.scss as empty file to your repository. grunt-sass-globbing will overwrite it. Have a deeper look at it on the tests on https://github.com/DennisBecker/grunt-sass-globbing/tree/master/test\nThis grunt plugin is not finished, so when you want to install it, use npm install https://github.com/DennisBecker/grunt-sass-globbing/tarball/masterfor now. Feedback / pull requests on this plugin much appreciated.\n. This lacks of some features, like removing the underscore before filenames if they are just partials or using the correct relative path. And I think it is not really obvious when you look for an alternative for sass-globbing.\n. ",
    "stubar": "I'm using gulp and was concating everything before my sass call and was getting all sorts of issues with them running asynchronously, even though I was using the recommended dependency patterns.  I ended up using this to generate 1 included index file, https://www.npmjs.com/package/gulp-concat-filenames/.  This doesn't have to be in your watch task, only needs to be run when you create new files. \n. ",
    "tschwartz": "I would suggest using something like https://www.npmjs.com/package/gulp-include (there's most likely something similar for Grunt). I use it for all of my dependency management so that my Gulp setup doesn't need to have that logic baked into it and the mechanism for doing so is consistent across HTML, SCSS and JavaScript. For example:\ncommon.scss\n//= require ../../../bower_components/normalize.css/normalize.css\n//= require '_helpers.scss';\n//= require '_base.scss';\n//= require '_typography.scss';\n//= include ../components/common/**/_*.scss\nscss.js\ngulp.task('scss', function() {\n  return gulp.src([\n      './src/public/scss/**/*.scss'\n    ])\n    .pipe(plugins.include())\n    .pipe(plugins.sass())\n    .pipe(plugins.autoprefixer())\n    .pipe(plugins.cssmin())\n    .pipe(plugins.rename(function(path) {\n      path.extname = '.min.css';\n    }))\n    .pipe(gulp.dest('./dist/public/css/'));\n});\n. ",
    "am11": "Ping! Any updates on this?\nWe are getting segmentation fault with this line of (erroneous) code (via node-sass)\nfoo.scss:\nscss\nbody{color:red;\nwithout closing bracket. We expect libsass to return exception result instead of low level kill semaphore, causing the process(es) termination downstream.\nI reported this issue with https://github.com/sass/node-sass/issues/361. This is a real deal breaker. The Segmentation Fault causes the whole process chain to crash:\nmy node app > (imports) node-sass > (imports) node.js add-on service to call libsass.\nOn that note, can you please add the ability to return JSON exception/error results (with {FileName: .., Line: .., Column: .., Message: .., Details: ..}) instead of plain text, which we have to parse with regex? (https://github.com/sass/libsass/issues/235)\nThanks @akhleung \n. @svnieuw, in Context class, why do we have collection of style_sheets as opposed to one? I thought there would be a reference of one final style_sheet somewhere in the caller class, which we would pass as a second parameter to SourceMap's overloaded ctor to fix this issue.\nIsn't the compiler's job is to generate ONE CSS file from Many SASS files? (or am I missing the point of Context class)\n. @xzyfer, @mgreter \nNow that we have JSON factory, can we provide this option to parse errors as JSON. \nI would vote to retire XML output in favor of JSON library-wide; as JSON is a sleek, less noisy way of representing data for any programming language. \nHowever, if there is a legacy reason to keep XML output for reporting errors, can we make serializing-errors-as-JSON optional (and preferably default it to true)?\n. @mgreter, would it be possible to capture column information for errors too? In Web Essentials, it is required to jump the caret to the exact place of error via Visual Studio's Error List.\n. @svnieuw, thanks for your input.\nThe LESS compiler generates the sourcemap with \\\\ in file paths in Windows. We solved those in the post-processing step in SAAS compiler class of Web Essentials extension for VS. On the contrary,  we didn't need that step in the corresponding function of LESS compiler class.\n. @nschonni, yes. Ideally, it should calculate relative paths of destination file (.css) and all the sources .scss in map, from map file as a reference. Note, the map file can also be generated at different location than css and the source scss files. \nThere is a C++ Windows system function PathRelativePathTo() in shlwapi.dll, which calculates relative paths from a point of reference.\n. Total Paths:\n- From .map to .css file; for \"file: \" value in JSON.\n- From .map to all .scss files; for \"sources[]\" values in JSON.\n- From .css to .map file; for /*# SourceMap .. / comment.\n. FWIW, here is how we can consume shlwapi.dll in C# managed code https://github.com/madskristensen/WebEssentials2013/issues/134#issuecomment-26967876.\n. @svnieuw, @nschonni, is it solved by https://github.com/hcatlin/libsass/commit/eeee3a86a1962aee991e28b6de02251077a33fb5 and https://github.com/hcatlin/libsass/commit/ef3eadb5e8fe538e3e9f025724b28305dcc584d5? I just found these in merged commits (https://github.com/hcatlin/libsass/commits/master).\n@andrew, can you please give us an estimate; when would this fix be available in node-sass?\nThanks. :)\n. @nschonni, can you please code-review my PRs for libsass and on node-sass repo? \nI am preparing another set of commits, which require merging of those branches (cherry-pick).\nWould be fantastic, if those changes would make their way in v2.0.\nThanks in anticipation :)\n. Thank you so much @akhleung for merging this. \n@nschonni, as per your convenience, could you please review my PRs on node-sass? I have some other minor related fixes in my backlog for both repos. Thanks in anticipation.\n. @svnieuw, thanks for the doubling on it. :+1: \nBTW, this issue was also reported by https://github.com/hcatlin/libsass/issues/217. Lets track it there?\n. :+1:\nAnother repo which has integrated CMake recently: https://github.com/neovim/neovim.\n. Possible dup of https://github.com/hcatlin/libsass/issues/242. Even the JSON in sourcemap is invalid because \\ is not escaped.\n. Node-sass' v0.9.3 has this feature.\n. Here is the source-map generated by sass gem:\njson\n{\n\"version\": 3,\n\"mappings\": \"AAEQ,iCAAY;EACR,OAAO,EAAE,IAAI;AAEjB,mCAAgB;EACZ,KAAK,EAAE,KAAK;AAIpB,qBAAW;EACP,MAAM,EAAE,IAAI\",\n\"sources\": [\"test.scss\"],\n\"names\": [],\n\"file\": \"test.css\"\n}\nDecompiles to:\n([2,8](#0)=>[0,0]) | ([2,20](#0)=>[0,33])\n([3,12](#0)=>[1,2]) | ([3,19](#0)=>[1,9]) | ([3,21](#0)=>[1,11]) | ([3,25](#0)=>[1,15])\n([5,8](#0)=>[2,0]) | ([5,24](#0)=>[2,35])\n([6,12](#0)=>[3,2]) | ([6,17](#0)=>[3,7]) | ([6,19](#0)=>[3,9]) | ([6,24](#0)=>[3,14])\n([10,4](#0)=>[4,0]) | ([10,15](#0)=>[4,21])\n([11,8](#0)=>[5,2]) | ([11,14](#0)=>[5,8]) | ([11,16](#0)=>[5,10]) | ([11,20](#0)=>[5,14])\nNot as comprehensive as LESS (which captures the interim unlinked  selectors -- with no declaration -- too) but at least the line numbers are not misleading like libsass.\n. @nschonni, @andrew, is this issue related to libsass or node-sass?\n. After https://github.com/sass/libsass/pull/443#issuecomment-50766408, I tried to dig into it. The essence is; the libsass internals are only reporting the start of line (not even the correct column number), while it should be reporting a map for each token. My knowledge about that code is still wooly..\nThe operation is taking place in output_compressed.cpp and output_nested.cpp. We should make it so it conforms with LESS' mappings standards (npm install -g less) ; to capture mapping for maximum details: every token in the generated output. \nI used http://murzwin.com/base64vlq.html (looks like it's written in Ruby) for decoding the VLQ-B64s while implementing the VLQ class and the hack for node-sass in Web Essentials.\nPerhaps other folks like @akhleung, @mgreter and @nschonni can provide some insightful pointers here about that code.\n. @svnieuw :smile: :+1: \n. Thanking you in anticipation! :smile: \n. Blame says it was written by @akhleung :)\n. Blame says it was written by @akhleung :)\n. @xzyfer, can you shed some light on @svnieuw question? That was the last known show stopper here.\n. +1, exactly what we are looking for in node-sass.\nsourceMapURL: false option should skip appending URL in CSS even if the source-maps are generated separately.\n. Yes I will take a look now. :)\nActually that test was removed recently (https://github.com/sass/node-sass/pull/492#issuecomment-60958730). I will put it back in our repo and get back to you.\n. :+1: \nBut I couldn't test it with windows due to this: https://github.com/sass/libsass/pull/591#issuecomment-61023716 :cry: \n. Let me give it a try. (-8\n. It compiled without any issue! :smile:  :+1: \nBut that test is still failing. :disappointed:  :-1: \n. Just wondering..\nWill we ever be able to move forward with C++11, 14, 17 features, saying goodbye to the old CentOS and the glibc/libstdc++ that goes with it?\n. Old CentOS is a bad news, kept haunting me for quite some nights. :ghost: \n. :+1: :tada: \n. Down the road, if we get attention from someone expert in build-systems, especially gyp, we probably would be able to distill the Linux binary's moving parts, and link all the required machinery statically. Binary size will grow dramatically (from ~2MB to ~5MB each I suppose?) but, IMO, that tradeoff is worthwhile. Speaking of build-systems, hello @QuLogic! :sunglasses: \n. @xzyfer thanks! Is it like diet-glibc that we can statically compile with? Also we would need to static compile libstdc++ as well, which in turn depends on system glibc which is another pain-point. :(\nPS: I think we cannot compile glibc and libstdc++ together (I read it somewhere).\n. Wohoo! \nThanks @Vektah !\nIs CentOS 5 also supported? Because that is our least minimum. (-8 \n. This is brilliant! Thanks. :+1: \nI tried to compile GCC 4.7 on CentOS 5.5. and 5.11, but it failed. Which version of GCC it installed after\ncurl -SL http://people.centos.org/tru/devtools/devtools.repo > /etc/yum.repos.d/devtools.repo?\n. @Vektah, yeah I copied the line before. :-1: \nIncidentally, can we have x86 tooling there as well or should we have a separate Docker image for x86 arch?\n. @mgreter  is this issue also fixed as part of #433?\n. Ops, I must have misread it. I thought the fixes are related to the SASS 3.x syntax functions, which (I guess) is causing this multi-line comments issue. :)\n. @akhleung, thanks!\nI tried changing it here: https://github.com/sass/libsass/blob/97e5346c577211aa395689f61d6e4af4a00b46a3/parser.cpp#L47 (and all the occurrences of this line in parser.cpp) like:\nc++\nString*  contents;\ntry {\n  contents = parse_interpolated_chunk(lexed);\n}\ncatch (Error& err) {\n  contents = new (ctx.mem) String_Schema(lexed, source_position);\n}\nand few other varieties in catch-block, but it still throws.\nAny pointers on where to look to make it parse the comment as text (in case comment-code result in error)?\n. @malrase, thanks for looking into it. But wouldn't @akhleung's approach (above) makes sense? If it throws error in multi-line comments, wouldn't it be nice to raise a warning instead of syntax error? Something like:\nWarning: Unbound variable in multi-line comment at line X, column Y in <file>.scss. \n         Did you mean to use single-line comment?\n. Thanks for merging this @akhleung. :+1: \n. Oh I see. Actually I first put it then removed the scope resolver. I was just trying to make code look smarter which VC2013's compiler didn't mind. :)\nWill fix it. Thanks!\n. On a similar note; please take a look at https://github.com/sass/libsass/issues/324.\nThe gist is:\n- With LESS compiler, the level of detail captured in source-map is very very extensive: It captures sm-info for each property-name, value and even part of value if required (in case you are using vars, mixins etc.).\n- With ruby-sass, the level of detail is (correct but) somewhat mediocre: upto the declarations. Really not as good as LESS. IMO, it looks bit experimental, not the finalized implementation.\n- With libsass, the level of detail is wooly. At some points, it is even incorrect and erroneous! And the maximum valid information it reflects; the line number of rule. Not even the correct column number is captured.\nI know this is not usually what happens around here, but please (only this time -- for once) consider taking LESS' lead, because they really did a great job making source-maps versatile, most comprehensive and hence quite reliable. I believe sass gem (ruby version) will also be fixed at some point to capture more / all tokens language info (which is the main point of having source-map feature in first place, in source-to-source trans-compilations).\nWith LESS set as criteria, you can make corresponding sample code in LESS for comparing source-maps and fix libsass' mappings until the results are ditto. :)\nThat will complete source-map feature in libsass, once forever!\nThoughts?\n. @aexmachina, this is awesome! I think one of the reasons why the build is failing is because resolve_relative_path returns string, while resolve_and_load returns char*.\n@mgreter, would it make sense to change resolve_relative_path to return char* as well; to make the function signatures consistent?\nfile.hpp#L13 and file.cpp#L120  to:\nc++\nchar* resolve_relative_path(const string& uri, const string& base, const string& cwd)\nfile.cpp#L171 to:\nc++\nreturn result.c_str();\nIf not then @aexmachina, you would need to change the calls to resolve_relative_path( .. ) in context.cpp to resolve_relative_path( .. ).c_str().\n. @mgreter, @xzyfer,\n:watch: \nGuys should we merge it in and fix it? OP did his best. This is big step forward to have JSON support. IMO, we should serialize errors/exception messages in JSON rather than noisy/verbose XML (or at least make it optional, so the compatibility with ruby-sass doesn't get effected -- I don't know if that is needed for error messages too). See https://github.com/sass/node-sass/issues/464. \n. I tend to believe that I have fixed this issue via:\n- https://github.com/sass/node-sass/pull/366 and\n- https://github.com/sass/node-sass/pull/367\nThose PRs are awaiting review / merge.\n. @mgreter, can you please confirm if fixes made by https://github.com/sass/libsass/pull/441 overlap this? It turned out to be the issue with lower-case. I think this will compliment those fixes. But in any case please review it.\nIf you think my fixes needs to be reverted after this, please do so. I was actually testing with node-sass code. I think node-sass sends at-least one path differently (don't remember off-hand, can confirm if you want).\nThe end result is to have network-accessible relative-paths in the entire source-map.\nThanks! :)\n. Yes; its probably a downstream error.\nI think it's just a matter of time they merge in https://github.com/sass/node-sass/pull/366 and https://github.com/sass/node-sass/pull/367 and most of these segmentation faults will go away .. :cactus: \n. Thank you @mgreter. I was just about to install everything on my new system to fix this. :+1: \n. @mgreter, \nThere still needs to be few fixes to be made.\nThe idea really is:\n- the primary source file (to be compiled) can be at different location than the output-path.\n- the source-map file can be at different location than the output file.\nBoth of the above assertions aren't complied by libsass at the moment.\nFor that matter:\nFirst, we need to store initializers.output_path() in class variable and then initialize source_map with resolve_relative_path(output_path, source_map_file, cwd) (in a ctor body -- after initiating cwd).\nSecondly, in format_source_mapping_url(), we need to change it to:\nc\n\"/*# sourceMappingURL=\" + resolve_relative_path(source_map_file, source_path, cwd) + \" */\";\nI guess after that the API will be quite flexible and finally browsers will be able to locate correct sources with source maps generated by libsass.\nThoughts?\n. @mgreter, thanks! All these changes are extremely useful. :+1: \nRegarding the source-map initializer issue, please see the source_map's ctor, and this is how source-map is currently initialized in context.cpp. The problem is with the \"file\" member of JSON, which should be the output_path relative to source_map_file. Currently it's merely displaying the file name of output_path; implying both map and output will be in same directory (which is not the case).\n. Thanks @mgreter! :smiley: :+1:\n. @mgreter, yes; all our path-related concerns regarding .map JSON and source maps comments are addressed by this. I have reviewed the code but haven't tried merging the commit (I am running into some PC issues, can't test it until next week). Rest assured, it looks pretty solid than the current state.\nHopefully we get the mapping issue fixed as well. I don't have right insights about the sass-compiler's internals and how it reports sources. If you guys can take a look or point me to the locations in code so I can give it a try, it will truly make a big impact and help many affected out there.. \nThanks!\n. Indeed :smiley: \nI wish if someday node-sass will get blessed with such a thing: \"Merge o' clock\"... node-sass has been insanely slow lately in adapting changes from libsass, accepting PRs, releases and all those usual things which happen to a repository..\n. Can anyone else take the throne and keep the wheel spinning? \nThat is the only SASS' gateway to the JS world. \nAll other sass npms are dead in water :fish: \n. Perfect! Thanks :+1: \n. :+1:\n. @akhleung, would you please review and merge it soon, since node-sass is progressing towards a next release. It would be immaculate timing if this PR makes its way to the upcoming version of node-sass. :smile:\nThanks! \n. @akhleung, @hcatlin in the second commit 0984afe, I have switched the use of int with C99's bool (as per your comment in the code). The CI build is failing because the downstream sassc also needed to be modified. For that matter, I submitted sass/sassc#67 with the required changes. I think when both get merged, the CI build will be fixed. Is there any other moving part which needs to be changed? Or should I rebase it out (and keep 778df3b which will keep API user repeating the line of code)?\n. With changes made in sassc, this build is passing now. \nOnce this is merged, I will send the PRs to sass2scss and node-sass. Other upstreams repositories would also need to make use of C99 bool instead of int.\n/cc @hcatlin\n. In case of node-sass, the current working directory (cwd) is the directory where the node.exe is executed. Therefore, if the cwd is at some random directory (C:/program files/ etc.), it resolves the following relative paths incorrectly:\n- from CSS to Map file. (used for sourceMappingURL comment in CSS)\n- from Map to CSS file. (used for file member in .map)\n- from Map to Source file. (used for sources array in .map)\nWith this commit:\n- from CSS to Map file: cwd is set to output_path's directory\n- from Map to CSS file: cwd is set to source_map_file's directory\n- from Map to Source file: cwd is set to source_map_file's directory\nIn Ubuntu, these two test cases were failing. Supposedly, we have the following:\ncwd: /vagrant/temp/path/\nentry_point: ~/project/sources/file.scss\noutput_path: ~/project/file-output.css (in previous directory than source)\nmap_path: ~/project/source-maps/file-source-map.css.map\nthe current implementation (without this commit) will resolve the relative paths incorrectly.\n. @akhleung, would it be possible to merge in #471, #476 and this one soon? Please review these, since node-sass will probably be picking up a release soon. :)\nThanks.\n@andrew, could you please provide an ETA on vNext of node-sass? This PR will hopefully fix our CI build issue for 0.11.9. Also, is there any other issue we need to fix before vNext? \n. @mgreter, \nThank you for taking time for debugging node-sass tests! :+1: \n\n(i.e. on the command line).\n\nI totally agree with you. For this very reason, the implementer (of node-sass for instance) would let the CLI user to pass relative path for source-map, input and output and on calling the libsass' interface, they would have to resolve abs file paths. This in on my TODO to make sure there is no change in CLI usage in node-sass. The other upstream folks would also have to make sure all three paths are absolute paths and libsass would generate the right thing for them.\nOn the contrary, the cwd way is cleaner. But then the upstream implementer would have to take care of updating the paths in sourcemap file as well as reparse the CSS file to update the source-map comment (with regex!), which in my opinion is an expensive option.\nFrom that perspective, it boils down to: \n\"resolving abs paths for three files input, output and source-map before calling libsass\"\nversus\n\"intervening with output generated by downstream (comes with costly payload)\"\nThoughts?\n. This is true! :+1: \nThis issue is fixed in node-sass repo by https://github.com/am11/node-sass/commit/45219ee51b4b6df7308df857235579c67755fa3c via https://github.com/sass/node-sass/pull/411.\nThis PR isn't required for node-sass now.\n. This is fixed in node-sass. It throws \"invalid-bracket.scss:1: error: invalid property name\".\nNext release should be coming soon. See https://github.com/sass/node-sass/issues/378#issuecomment-54452343.\n. @akhleung, it's good to have you back! :+1: \nHope you are doing well. :)\n. @hcatlin, on a slightly related note; is there a way to get CSS output with correct (relative) URL paths? (https://github.com/sass/node-sass/issues/430)\nFor instance:\nscss\nfoo {\n    + bar {\n        color: lime;\n        background-image: url('../images/7up-fido-dido.png');\n    }\n}\nwill produce:\ncss\nfoo + bar {\n  color: lime;\n  background-image: url(../images/7up-fido-dido.png);\n}\nWhen both input and output files are in same directories. But if they are in separate directories, the generated CSS still has the same url. Going by the above example, if input.scss is located at /tmp/input.scss and output path is at /tmp/output/style.css, the expected url value in resultant output is ../../images/7up-fido-dido.png.\nIf the current behavior is in accord with the sass-specs, it would be nice to have this feature in libsass (and corresponding flag bool resolve_urls (default: false) in the interface) which would do the following:\n- resolve  absolute path of asset (in url(..)) w.r.t. input file path (the actual source file; in case of @imports).\n- using that abs. path; resolve relative path of asset w.r.t output file path and use that one in the output.\nThis way, users won't have to worry about the location of output path, libsass will fix the URLs for them.\n. Opened a separate issue here: https://github.com/sass/libsass/issues/532. :smile: \n. Or you can just run:\nbash\ngit commit --amend\ngit push -f\nand it will rerun travis-ci build.\n. Or even better:\nbash\ngit remote add libsass https://github.com/sass/libsass/\ngit pull --rebase libsass master\ngit push -f\n. :+1: \n. @mgreter, on a separate note, the reference to sass2scss submodule (which used to be there) is gone from the latest libsass master. Did that happen intentionally?\n. @QuLogic, I figured. Actually node-sass had it as a dependency in node-gyp's config. \n. This corresponding PR is https://github.com/sass/libsass/pull/591. \nI am testing on Windows 8.1.1 x64 with node.js x86 (you can test it with node -p \"process.arch\") and Windows 8.1.1 x64 with node.js x64, both with VS2013 Update 3, Python 2.7.8 and node-gyp (npm install node-gyp) installed. To test on Ubuntu, see node-sass' travis.yml file; to update GCC for c++11.\nYou are welcome to test on several operating systems.  :smile: \n/cc @mgreter \n. Not sure what is the use case for abs. URIs?\n. @hcatlin, for some reason, after rebasing with latest master, travis-ci build is failing. Any pointers for that?\n. Yup, I did this work yesterday. I just rebased the local repo to get changes made by https://github.com/sass/libsass/pull/520. :)\n. My branch is up-to-date: https://github.com/am11/libsass/commits/master\nThere is only one test failing:\nSassSpec::Test#test__sass-spec/spec/basic/60_call \n[/home/travis/build/sass/libsass/sass-spec/lib/sass_spec/test.rb:24]\n. All passed! This is ready. :smile: \n. Awesome! Please run git pull --rebase upstream master; git push -f, to squash those merge commits.\n. This was addressed by https://github.com/sass/libsass/pull/834.\n. @xzyfer, in node-sass we have a test for this. It was passing earlier. Now with latest libsass master, it fails. \n. https://github.com/sass/node-sass/blob/0f9ff9162b69d6c074870c36437a53e19d467d13/test/cli.js#L136-L143 (lines 136 to 143): \"should compile with the --output-style'\".\nExpected output: \n``` scss\nnavbar{width:80%;height:23px}#navbar ul{list-style-type:none}#navbar li{float:left}#navbar li a{font-weight:bold}\n```\nActual output:\n``` scss\nnavbar{width:80%;height:23px;}#navbar ul{list-style-type:none;}#navbar li{float:left;}#navbar li a{font-weight:bold;}\n``\n. You're so right. My bad! :-1: \n. Also fixes https://github.com/sass/libsass/issues/268 and https://github.com/sass/libsass/issues/166. :+1:  \n/cc @robrichard, @Nabellaleen \n. @mgreter, @xzyfer, can we make something likeSASS_URL_NORMALISER` (or *ZER :D) in new API, which acts similar to importer, but reports any URLs it encounters during the parse? This way users would be able to change URLs with the desired logic. :)\n. > URLs with the desired logic\nSome advanced stuff: For instance, test against some whitelist from database or some web service and amend the URL accordingly. Or any other unbelievable use-case. :smile: \nAlso, some server-side code (for example; express in node.js) might be able to leverage this feature differently (by imploding some template strings inside the URL and pre-process it). This will be ultra customization.\nFor the relative paths feature detailed above, that could be written on top of this feature:\n(pseudo code)\n-> URL intercepted by AST\n-> Pass URL string to `SASS_URL_NORMALISER` wrapper function (which calls user-defined `sass_options.sass_url_normalizer)\n-> Within that scope, check if relative_urls option is set then resolve the correct URL as follow:\n   ->  first resolve its absolute path from source (.scss/.sass) file path.\n   ->  using the abs. path from previous step, resolve relative path w.r.t output_path.\nIf both sass_url_normalizer (function) and relative_urls (bool) are set, then normalizer function will take precedence and relative_urls will be disregarded.\nThoughts?\n. Sounds fair to me. :)\nMomentarily, can we provide a helper for it, a custom function?\n. I think:\n- this is one of those feature which should be ported into libsass/ruby-sass from compass; because proper asset path resolution (depending on the use-case) is not something without which your CSS code can survive.\n- compass has covered everything, compass is a great framework; but the idea really is to make some salient features first-class citizens of sass compilers for autonomy, regardless of there presence in compass or any third party plugin.\n- there is a reason why Less has provided it as a top-level feature: it is a must have; they also have frameworks and plugin systems to support everything possibly imagined and are very picky to support only features which has demand; use-case driven as they put.. so there is definitely a demand for it out there.\n- you cannot convince ruby-sass guys easily, because mostly they use compass as if it is part of ruby-sass (gem install sass compass), I suppose we (currently deprived of compass) stand a better chance to make distinction of must-have vs. aux features :)\n. Does redirecting stderr to file help; something like this:\nbash\nsassc input.scss 2> libsass-errors.log\n. This is fixed by #542 and the fix is just released with v3.0. \nSo this can be closed. :)\n. :+1: awesome! \nyours have always positive impact on coverage.. :smile: \n. @mgreter is right; the documentation needs to be updated. \nYou need to set sourceComments: none or sourceComments: default and it will not produce \"debug comments\".\nTested with latest node-sass npm, v1.0.3.\n. BTW I think we need to change this behavior: https://github.com/sass/node-sass/blob/0f62c1817cba77c45ad3f27ac20ee604c1e7883b/sass.js#L56 and make it none instead of map.\n@andrew thoughts?\n. This way by default (if souceComments is missing), there won't be any debug info in the code. Just the good old clean plain CSS code.. :)\n. (I read about the reasoning somewhere libsass issue tracker but forgot what was the consensus). With nested style, libsass converts this:\nscss\na{b:c}\nto:\ncss\na {\n  b: c; }\nwhile ruby-sass generates:\ncss\na {\n  b: c;\n}\n(with closing parenthesis at new line)\nShould this be fixed to conform with the output of ruby-sass?\n. Oh my bad. You are right! I was playing with http://sassmeister.com/, forgot to change to nested. :)\nAre there plans to add expanded style in LibSass?\n. I am an idiot. Sorry and thank you for addressing it! :)\n. @hcatlin, I can confirm that it is fixed by https://github.com/sass/libsass/pull/563. Thanks @xzyfer.  :+1: \n. Fixed by 034a98d via #567.\n. Thanks for the fix. :+1: \nCan you please also make these changes (to stop msvcr from barfing: warning C4101: 'bc' : unreferenced local variable):\n``` diff\ndiff --git a/ast.hpp b/ast.hpp\nindex 59b9a4e..3bfac33 100644\n--- a/ast.hpp\n+++ b/ast.hpp\n@@ -658,7 +658,7 @@ namespace Sass {\n           if (!((elements()[i]) == (l[i]))) return false;\n         return true;\n       }\n-      catch (std::bad_cast& bc)\n+      catch (std::bad_cast&)\n       {\n         return false;\n       }\n@@ -706,7 +706,7 @@ namespace Sass {\n           if (!(at(key) == m.at(key))) return false;\n         return true;\n       }\n-      catch (std::bad_cast& bc)\n+      catch (std::bad_cast&)\n       {\n         return false;\n       }\n@@ -815,7 +815,7 @@ namespace Sass {\n         Variable& e = dynamic_cast(rhs);\n         return e && name() == e.name();\n       }\n-      catch (std::bad_cast& bc)\n+      catch (std::bad_cast&)\n       {\n         return false;\n       }\n@@ -969,7 +969,7 @@ namespace Sass {\n         e.normalize(find_convertible_unit());\n         return unit() == e.unit() && value() == e.value();\n       }\n-      catch (std::bad_cast& bc)\n+      catch (std::bad_cast&)\n       {\n         return false;\n       }\n@@ -1008,7 +1008,7 @@ namespace Sass {\n         Color& c = (dynamic_cast(rhs));\n         return c && r() == c.r() && g() == c.g() && b() == c.b() && a() == c.a();\n       }\n-      catch (std::bad_cast& bc)\n+      catch (std::bad_cast&)\n       {\n         return false;\n       }\n@@ -1044,7 +1044,7 @@ namespace Sass {\n         Boolean& e = dynamic_cast(rhs);\n         return e && value() == e.value();\n       }\n-      catch (std::bad_cast& bc)\n+      catch (std::bad_cast&)\n       {\n         return false;\n       }\n@@ -1120,7 +1120,7 @@ namespace Sass {\n         String_Constant& e = dynamic_cast(rhs);\n         return e && unquoted_ == e.unquoted_;\n       }\n-      catch (std::bad_cast& bc)\n+      catch (std::bad_cast&)\n       {\n         return false;\n       }\n```\nAlso, it gives few other warnings: https://gist.github.com/am11/5324b8ffb44f0a599329. It might make sense to fix them, perhaps to save couple of milliseconds here and there? https://github.com/sass/libsass/issues/519 is related.\n. Guys I have made the changes. Please review https://github.com/sass/libsass/pull/572.\n. Thanks guys!\n. This looks fine. The old \"fix\" itself was a hack. This one at least doesn't break the existing feature.\nOn a slightly separate note, do you guys have any idea how to make the sourcemap capture more details than it already does? Source map is the only thing that I wish libsass take LESS lead (which has tons of sourcemap options) rather than the ruby-sass, which itself needs better source-maps: https://github.com/sass/libsass/issues/324. The idea really is to make \"every token\" in generated output mapable to the original code. \"{\", \"}\", \":\", \"color\", \"violet\" etc. are the tokens. Do you guys think we can pull that one off? I tried but couldn't figure out the internals of parser, ast et el. I'm still a rookie when it comes to dark arts of libsass internals. :rabbit: \n. :+1: \nMore frequent releases would produce more valuable feedback. :star: \n. @xzyfer, sometimes it happens. IDK the exact reason. But CI system shut its eyes for some PR. It's choosy like that. When you would merge it, it will probably run it then.\n. @xzyfer, I think we should run a routine to replace all tabs with two-spaces in all cpp, hpp, h and c files, to keep the code formatting consistent.\n. CPPCS! Great idea :+1:\nPersonally, it would be much easier if there is a vcxproj file for VS. Then we can set the rules and use extension like batchformat.\nThis guy has actually a VS2013 vcxproj file for libsass: https://github.com/darrenkopp/libsass-net/tree/master/libsass, but it has other stuff (noise). Another reason to address this concern: https://github.com/darrenkopp/libsass-net/commit/94abbd7f3bd6a1ef9f8e49bddec7b3d48b07c36c#commitcomment-8333599, so our coverage become more pervasive in terms of cross-platform. (-8\n. @mgreter, going by http://stackoverflow.com/a/4012292/863980, should  we replace this char* with std::string and get rid of strcpy?\n. Still getting this error with latest master: http://pastebin.com/meJj5pfn.\n. Hmm, that would be really difficult. I think stats is the node-sass only feature. It is implemented here: binding.cpp#L80-105. I am not sure if it is allocating memory incorrectly, or is it libsass' issue.\nBut further tests revealed that the issue weirdly only happen when call from the test. From node-sass interactive shell, the same works just fine:\n``` powershell\nC:\\users\\Adeel\\Source\\Repos\\node-sass [master +1 ~1 -0 !]> cat C:\\temp\\foo.scss\n// input\n$test: (\n  one: 1,\n  two: 2,\n);\n$expect: (\n  two: 2,\n  one: 1,\n);\n.test {\n  equal: $test == $expect;\n}\nC:\\users\\Adeel\\Source\\Repos\\node-sass [master +1 ~1 -0 !]> node\n\nvar stats = {};\nundefined\nrequire(\"./sass\").renderSync({\n...   file: 'c:\\temp\\foo.scss',\n...   stats: stats,\n...   sourceMap: true\n... });\n'.test {\\n  equal: true; }\\n\\n/# sourceMappingURL=undefined.map /'\nstats.sourceMap.indexOf('foo.scss') !== -1\ntrue\nstats\n{ entry: 'c:\\temp\\foo.scss',\n  start: 1414629548780,\n  includedFiles: [ 'c:/temp/foo.scss' ],\n  sourceMap: '{\\n  \"version\": 3,\\n  \"file\": \"\",\\n  \"sources\": [\"..\\/..\\/..\\/..\\/..\\/..\\/c:\\/temp\\/foo.scss\"],\\n\n \"names\": [],\\n  \"mappings\": \"AAWA,AACE,AAAO\"\\n}',\n  end: 1414629548780,\n  duration: 0 }\n```\n\n@kevva, can you provide any pointers for this?\n. That undefined.scss in sourceMappingURL is also something we need to figure out in sass.js.\n. You don't have to apologize to be a C++ champ only! :sunglasses:\nTill f55b2d5, it works fine:\n``` bash\ngit checkout f55b2d50342f97228a56a513b4cabf40996d6092\nthen remove existing binary build, and then\nnode build\nfollowed by\nnpm test\n```\nit passes the stats test.\nThe next commit is ca5f271883db61ccd1d1e1b84dd4830a2564896f, which concluded v3.0.1. When I git checkout ca5f271883db61ccd1d1e1b84dd4830a2564896f, build and run test, it fails that test with error: Unable to allocate memory: bad allocation.\nSo the issue seems to be in ca5f271883db61ccd1d1e1b84dd4830a2564896f.\n. Oh please disregard my previous comment. It didn't removed the existing binaries.\nI have retested it and found the location of error.\ndiff\ndiff --git a/output_nested.cpp b/output_nested.cpp\nindex 6ead1bf..7ca38dc 100644\n--- a/output_nested.cpp\n+++ b/output_nested.cpp\n@@ -262,7 +262,8 @@ namespace Sass {\n   void Output_Nested::append_to_buffer(const string& text)\n   {\n     buffer += text;\n-    if (ctx) ctx->source_map.update_column(text);\n+    if (ctx && !ctx->_skip_source_map_update)\n+      ctx->source_map.update_column(text);\n   }\nUsing if (ctx) // && !ctx->_skip_source_map_update) with rest of changes works fine. As soon as I use if (ctx && !ctx->_skip_source_map_update), it chokes. It also chokes with if (!ctx->_skip_source_map_update) but fails the test without throwing (gracefully) with if (ctx->_skip_source_map_update).\nApparently, it doesn't like ! there.. :grey_exclamation: :question: \n. Further diggings yielded; it's not the bool issue.\nWith this code:\nc++\nvoid Output_Nested::append_to_buffer(const string& text)\n{\n    buffer += text;\n//    ctx->source_map.update_column(text);\n}\nit throws the same exception, while this passes:\nc++\nvoid Output_Nested::append_to_buffer(const string& text)\n{\n    buffer += text;\n    ctx->source_map.update_column(text);\n}\nOn x64 Windows with x86 node. On other x64 Windows with x64 node doesn't throw.\n. @mgreter, yes that code was fine. Actually when the update_column isn't count, it sets garbage value for generated_position.line to size_t's max. That causes \"string too long exception\" at source_map.cpp#L73.\nThis is fixed by b6efc33 via #586.\n. That makes perfect sense to delete that message. It constituted long lame outdated diffs anyway. :)\n. Haven't made much progress there yet.\nActually I cloned this repository https://github.com/darrenkopp/libsass-net by @darrenkopp. It contains a .NET wrapper of libsass. I am planning to get a VS compatible make file out of it (or vcxproj file), so it works with Appveyor.\nAfter that, we would have to do the same for sassc, to run the test. See https://github.com/darrenkopp/libsass-net/commit/94abbd7f3bd6a1ef9f8e49bddec7b3d48b07c36c#commitcomment-8333599.\nI think we can have a vcxpro file in both repository, so anyone with VS2013 can just open the file and click the green play button to build libsass! :smile: \n. Going by vcxproj file (notice CICompile entires), it seems like they have configured their CI with VSO or some other TFS server. But it wouldn't be bad to have a free/publically-accessible one on Appveyor as well. :smile: \n. With new API, I get this error with your code:\njson\n{\n        \"status\": 1,\n        \"path\": \"c:/temp/foo3.scss\",\n        \"line\": 2,\n        \"column\": 17,\n        \"message\": \"unbound variable $primary-color\"\n}\n. :+1:\n. @xzyfer, nice job catching this bug! :+1: \nI found some more interesting stuff (related).\nConsider the following code:\n(taken from https://raw.githubusercontent.com/less/less.js/../test/less/operations.less, replaced @ with $):\n``` scss\noperations {\ncolor: (#110000 + #000011 + #001100); // #111111\n  height: (10px / 2px + 6px - 1px * 2); // 9px\n  width: (2 * 4 - 5em); // 3em\n  .spacing {\n    height: (10px / 2px+6px-1px*2);\n    width: (2  * 4-5em);\n  }\n  substraction: (20 - 10 - 5 - 5); // 0\n  division: (20 / 5 / 4); // 1\n}\n$x: 4;\n$y: 12em;\n.with-variables {\n  height: ($x + $y); // 16em\n  width: (12 + $y); // 24em\n  size: (5cm - $x); // 1cm\n}\n.with-functions {\n  color: (rgb(200, 200, 200) / 2);\n  color: (2 * hsl(0, 50%, 50%));\n  color: (rgb(10, 10, 10) + hsl(0, 50%, 50%));\n}\n$z: -2;\n.negative {\n  height: (2px + $z); // 0px\n  width: (2px - $z); // 4px\n}\n.shorthands {\n  padding: -1px 2px 0 -4px; //\n}\n.rem-dimensions {\n  font-size: (20rem / 5 + 1.5rem); // 5.5rem\n}\n.colors {\n  color: #123; // #112233\n  border-color: (#234 + #111111); // #334455\n  background-color: (#222222 - #fff); // #000000\n  .other {\n    color: (2 * #111); // #222222\n    border-color: (#333333 / 3 + #111); // #222222\n  }\n}\n.negations {\n    $var: 4px;\n    variable: (-$var); // 4\n    variable1: (-$var + $var); // 0\n    variable2: ($var + -$var); // 0\n    variable3: ($var - -$var); // 8\n    variable4: (-$var - -$var); // 0\n    paren: (-($var)); // -4px\n    paren2: (-(2 + 2) * -$var); // 16\n}\n```\nLess output (as is: https://raw.githubusercontent.com/less/less.js/../test/css/operations.css):\n``` css\noperations {\ncolor: #111111;\n  height: 9px;\n  width: 3em;\n  substraction: 0;\n  division: 1;\n}\noperations .spacing {\nheight: 9px;\n  width: 3em;\n}\n.with-variables {\n  height: 16em;\n  width: 24em;\n  size: 1cm;\n}\n.with-functions {\n  color: #646464;\n  color: #ff8080;\n  color: #c94a4a;\n}\n.negative {\n  height: 0px;\n  width: 4px;\n}\n.shorthands {\n  padding: -1px 2px 0 -4px;\n}\n.rem-dimensions {\n  font-size: 5.5rem;\n}\n.colors {\n  color: #123;\n  border-color: #334455;\n  background-color: #000000;\n}\n.colors .other {\n  color: #222222;\n  border-color: #222222;\n}\n.negations {\n  variable: -4px;\n  variable1: 0px;\n  variable2: 0px;\n  variable3: 8px;\n  variable4: 0px;\n  paren: -4px;\n  paren2: 16px;\n}\n```\nRuby Sass output is same as above.\nLibsass output:\n``` css\noperations {\ncolor: #111111;\n  height: 9px;\n  width: 3em;\n  substraction: 0;\n  division: 1; }\n  #operations .spacing {\n    height: 17px-1px;\n    width: 8 -5em; }\n.with-variables {\n  height: 16em;\n  width: 24em;\n  size: 1cm; }\n.with-functions {\n  color: #646464;\n  color: #ff8080;\n  color: #c94a4a; }\n.negative {\n  height: 0px;\n  width: 4px; }\n.shorthands {\n  padding: -1px 2px 0 -4px; }\n.rem-dimensions {\n  font-size: 5.5rem; }\n.colors {\n  color: #123;\n  border-color: #334455;\n  background-color: black; }\n  .colors .other {\n    color: #222222;\n    border-color: #222222; }\n.negations {\n  variable: -4px;\n  variable1: 0px;\n  variable2: 0px;\n  variable3: 8px;\n  variable4: 0px;\n  paren: -4px;\n  paren2: 16px; }\n```\nPerhaps we can use this test case as is? It is covering units conversion and basic arithmetic on values.\n. Its positive again! :heavy_check_mark: \n:+1: \nShould we have tests for it on SASSC?\n. @mgreter, I have pulled your branch and json.cpp presented new challenges when compiling with VS2013' cl.exe. snprintf is only present in VS2014, which is in preview right now. I was managed to grab the guard for it. Now it is giving me linker errors: context.obj : error LNK2001: unresolved external symbol _base64_encode_block.\nIncidentally, there were three warnings json.cpp#L1175-L1177 and they are fixed by this orthodox way: http://stackoverflow.com/a/15486664/863980 :smile: \ninstead use:\nc++\n*b++ = 0xEFu;\n*b++ = 0xBFu;\n*b++ = 0xBDu;\n. Travis-CI doesn't have Windows. Appveyor is the one we use on node-sass. It has perl, python, VS2013, MinGW etc. Take a look at this: https://github.com/darrenkopp/libsass-net/commit/94abbd7f3bd6a1ef9f8e49bddec7b3d48b07c36c#commitcomment-8333599. :D\nI tried but didn't get too far with that.. Only if we can get cl.exe compatible nmake file, then we can configure it.\n.  That does not seem to be available on GitHub. It's over here: https://git.ozlabs.org/?p=ccan;a=tree;f=ccan/json.\nWe can probably checkout @pb82's repository: https://github.com/pb82/JSON.cpp.\n. _snprintf is different than snprintf. There is a slight chance that the upcoming update of VS2013 (update 4) would get the standard stdio.h's snprint back-ported from VS2014 community-technology-preview. Otherwise, we can retire this conditional #ifdef (guard code) when VS2014 is RTW'd.\nIncidentally, should we look for other repos for json.cpp on GitHub as well? For instance, this one looks promising: https://github.com/open-source-parsers/jsoncpp.\n. Will do that! :)\n. @mgreter, sent the PR to your repo: https://github.com/mgreter/libsass/pull/1. :sunglasses: \n. Pulling  7a9ef5f  in node-sass fails this test: 'should report correct source map in stats'. \nThe input file is: https://github.com/sass/node-sass/blob/703c2e4f7e86351080ed9e8e8c0bf25a0bd330f5/test/fixtures/simple/index.scss.\nThe output map is:\n{ version: 3,\n  file: 'index.scss',\n  sources: [],\n  sourcesContent: [],\n  mappings: '',\n  names: [] }\nNote that the sources array is empty and file should be build.css (the generated output .css, not the source: .scss).\n. Reverting back to v3.0.1 (ca5f271) with https://github.com/sass/libsass/pull/601 fix passes the test. Also passes with f55b2d5 (without any fix).\n. Also, the sourcemaps are serialized with JSON.string() as is. So we aren't doing any post-processing on the ingredients of maps. Hence no reference in source code.\n. @mgreter, that indeed fixed the files issue. :)\nHowever, the sources array and mappings are still empty.\n{ version: 3,\n  file: 'build.css',\n  sources: [],\n  sourcesContent: [],\n  mappings: '',\n  names: [] }\n. @mgreter, thanks! The test passes but the mappings is empty. I think for some reason if (ctx && !ctx->_skip_source_map_update) condition is not satisfying and columns are not being updated.\n\nSeparately, there is another test failing (unrelated to source-map)\n'should contain an empty array as includedFiles'. includedFiles is expected to be an empty array, while it gets [ 'stdin' ] :grey_exclamation: \nHere are the parameters, this test send to upstream:\n``` json\n{ data: '#navbar {\\r\\n  width: 80%;\\r\\n  height: 23px;\\r\\n}\\r\\n\\r\\n#navbar ul {\\r\\n  list-style-type: none;\\r\\n}\\r\\n\\r\\n\nnavbar li {\\r\\n  float: left;\\r\\n\\r\\n  a {\\r\\n    font-weight: bold;\\r\\n  }\\r\\n}\\r\\n',\nstats: { entry: 'data', start: 1414759704171 },\n  comments: false,\n  file: null,\n  imagePath: '',\n  outFile: null,\n  paths: '',\n  precision: 5,\n  sourceMap: null,\n  style: 0,\n  error: [Function],\n  success: [Function] }\n``\n. @mgreter, thanks for adding more tests for node-sass! Please move the css/scss files totest/fixtures//` (/cc @andrew, @kevva)\nI will try running your tests now.\nMeanwhile, FWIW -- I use PowerShell with the following approach:\n(given you have Python 2.7.8 and VS2013 Express for Desktop 2013 installed)\n``` bash\ncd ./into/node-sass/\nif you haven't already, run\nnpm install -g node-gyp\n1- given you have the remote:  git remote add node-sass https://github.com/sass/node-sass\ngit pull --rebase node-sass master \nclear out the old pacakges\nrm -r node_modules\n2- install npm will download the dependencies and rebuild libsass binary,\nit then clones into sass/node-sass-binaries repo and copies the\nprebuild binaries (of all OS'es architectures into ./bin/)\nnpm install\n3- its a bug in our build script that npm install first build the binary, copies it to ./bin/\nthen it overwrites that binary as part of copying binaries from node-sass-clone,\ntherefore, remove the windows binaries:\nrm -r build; rm -r ./bin/win32-ia32-v8-3.14 -Force; rm -r ./bin/win32-x64-v8-3.14 -Force\n4- if you want to modify ./src/libsass, now is the time, then:\nnode ./lib/build.js\nnpm test\nor you can just do \"node\" and enter node.js interactive shell\nwhere you can use: var sass = require(\"./lib\");\nto get a node-sass object.\n```\nIf you want to modify ./src/libsass after running test, repeat step 3 and 4.\n. I pulled your branch and tested with latest libsass, it passes all the tests and exited gracefully.\nI had to change ./binding.gyp though:\ndiff\ndiff --git a/binding.gyp b/binding.gyp\nindex 6b8e506..743888f 100644\n--- a/binding.gyp\n+++ b/binding.gyp\n@@ -8,6 +8,7 @@\n         'src/libsass/ast.cpp',\n         'src/libsass/base64vlq.cpp',\n         'src/libsass/bind.cpp',\n+        'src/libsass/cencode.c',\n         'src/libsass/constants.cpp',\n         'src/libsass/context.cpp',\n         'src/libsass/contextualize.cpp',\n@@ -19,6 +20,7 @@\n         'src/libsass/file.cpp',\n         'src/libsass/functions.cpp',\n         'src/libsass/inspect.cpp',\n+        'src/libsass/json.cpp',\n         'src/libsass/node.cpp',\n         'src/libsass/output_compressed.cpp',\n         'src/libsass/output_nested.cpp',\nSee my branch: https://github.com/am11/node-sass/tree/mgreter-changes.\n. @mgreter for this PR, should we consider mappings: issue: https://github.com/sass/libsass/pull/601#issuecomment-61302399 separate? That regression belongs to this IMO.\nOther than that, it's perfectly ready! :)\n. Exactly, this line was throwing exception.\n. Added a small cleanup commit as well: 80010aa. (spent hours with this code so.. :D)\n. Perhaps https://github.com/sass/libsass/issues/586#issuecomment-61195958 has some gotcha?\nI tested it, and it passed the test case under question. The issue I was getting with Windows x64 with Node.js x86 installation. Also, on x64 Windows with x64 node, it was taking a lot of time on running tests (https://github.com/sass/node-sass/issues/497#issuecomment-61024625). I haven't tested there, but this seems to be the problem.\n. Having one generic [RFC]: Source Maps revamping (request for comments) issue would be great!\nI think we can just trust LESS on that one. It has a lot of source-map related options:\nCLI\n``` bash\nC:\\temp> node .\\node_modules\\less\\bin\\lessc --help\nusage: lessc [option option=parameter ...]  [destination]\nIf source is set to `-' (dash or hyphen-minus), input is read from stdin.\noptions:\n...\n...\n --source-map[=FILENAME]  Outputs a v3 sourcemap to the filename (or output filename.map)\n --source-map-rootpath=X  adds this path onto the sourcemap filename and less file paths\n --source-map-basepath=X  Sets sourcemap base path, defaults to current working directory.\n --source-map-less-inline puts the less files into the map instead of referencing them\n --source-map-map-inline  puts the map (and any less files) into the output css file\n --source-map-url=URL     the complete url and filename put in the less file\n...\n...\n```\nWe can take the inspirations from it's source-maps test and revamp our source-map code to match the details it captures. Even ruby-sass isn't even there yet (https://github.com/sass/libsass/issues/324). The criteria is to capture mapping of as many tokens as possible to establish one-on-one link between source and generated output.\n. This is a great news! :)\nThanks. I can also confirm it.\nJust one issue, (we don't have a test for it); in your node-sass root, run node and enter the interactive shell. Paste the following:\n``` javascript\nvar stats = {};\nvar output = path.join(process.cwd(), './test/fixtures/simple/');\nrequire(\"./lib/index\").renderSync({\n  file: './test/fixtures/simple/index.scss',\n  outFile: path.join(output + 'build.css'),\n  stats: stats,\n  sourceMap: path.join(output, 'maps/build.css.map')\n});\nJSON.parse(stats.sourceMap);\n```\nYou will notice that the mappings is empty.\n. :+1: \nI am working on appveyor thing on https://github.com/darrenkopp/sassc-win. Hopefully, it will get sorted out!\n. I think we should fix the source of problem.\nI first built a patch for it: checking if it lies between std::numeric_limits<size_t>::max() and std::numeric_limits<size_t>::max() - 100, but that would have considered a poor hack I guess. :smiley: \n. Brilliant! :+1: \nIs this addressing https://github.com/sass/libsass/issues/324?\n. I will test it once this is merged. Is this ready?\n. Bundle of thanks @mgreter. This work is priceless! :+1: \nLet me know, if you need my help.. (-8\n. Super fabulous IMO! :+1:\nThanks for sharing! :)\n. LOL that is funny. :smile:\nI guess two-tab indentation is a convention in libsass project.\n. @mgreter, would this be merged before libsass vNext is out?\n. Would be nice if you could send it as a PR at https://github.com/sass/sass-spec. See https://github.com/sass/sass-spec/pull/95 for example.\n@xzyfer, on that note, it seems like https://github.com/sass/sass-spec/pull/95 is ready to get merge in.\n. @mgreter, there are a lot of tools which make use of source-maps. Some are solely related to browser's F12, and then there some other interesting uses-cases for IDE etc. I can give you an example of WebEssentials extension for VS which when VS run the web-application hooks to the browser's F12 tools FF/IE/Chrome and let the user change the markup, CSS etc. in realtime from f12 tool. Now if the CSS was generated by Sass or Less, the change made in browser tool is reflected in the source file, and this magic happens via source map! But this is definitely not possible if the expression in hand is implicitly computed, for instance mixin, strings interpolations etc. (so it stops there).\nThe questions is \"where to stop?\" or \"how much details is fair enough?\". IMO, if we are able to achieve mapping of each independent verb(s) or word(s) of CSS to that of Sass, to the extent that if the token under question is a variable, it points to the latest assignment of that variable or direct mapping (CSS code in Sass), then its more than sufficient.\nI agree this issue should be closed as resolved as the lines are blur and since there are no universal specs (even outside the Sass circle). We always have Less as a reference, as it being one of the kind. Although there happens to be a fundamental difference in Less and Sass (Less being declarative language, while Sass is imperative), source-map is something common emitted by both lang's parsers against the generated CSS. Hence comparable!\nWould you rather close this issue with the PR merge? :)\nThank you for the great work! Libsass generated source-maps are definitely is a much better shape than ever before. :+1: \n. It makes perfect sense. Actually other trans-compilers (less.js for instance) also add the actual source-file-path in the sources array.\n. @mgreter, just tested locally, and it passes all the node-sass tests. :smile: \n. @KaeNote, FFIW, I am using VS to compile libsass for node-sass and sassc-win. I can even attach the debugger to running node.exe process with devenv running libsass project and step in. \nUnlike old times (Express edition days), there is now this full-featured community version for open source projects and academia folks et al. Hopefully, they will consider decoupling the compiler from IDE at some point..\n. @jfroffice, no it doesn't. See https://github.com/sass/node-sass/issues/521#issuecomment-62042949 once again. :)\nThe other issue (that I was reporting to @xzyfer) is that, it should produce another error with this code. But particularly this issue is fixed by libsass and current node-sass produces the result.\n. @mgreter, great work refactoring interface! :+1: \nI will definitely give it a shot. Unfortunately, we don't have functions implemented yet. But rest of it can be absolutely tested out! :)\n. @mgreter, unfortunately, it is failing with GCC and VCC.\nFor GCC errors, see https://travis-ci.org/am11/node-sass/jobs/40434617#L353-L510.\nFor VCC see http://pastebin.com/zMrvajsv.\n. Here is one mysterious looking error from VCC:\nc:\\users\\adeel\\source\\repos\\node-sass\\src\\libsass\\inspect.hpp(98): error C2664: 'void Sass::Inspect::fallback_impl(Sass\n::AST_Node *)' : cannot convert argument 1 from 'Sass::Selector_List *' to 'Sass::AST_Node *' (..\\src\\libsass\\sass.cpp)\n [C:\\users\\adeel\\source\\repos\\node-sass\\build\\binding.vcxproj]\n          Types pointed to are unrelated; conversion requires reinterpret_cast, C-style cast or function-style cast\nWould it make sense to use reinterpret_cast() in that context for clarity and shutting up the VC compiler. :sunglasses: \n. @QuLogic, thanks for the tip. Actually, I added couple of statements in .travis.yml to update g++ and gcc. I understand sudo everything is kind of an anti-pattern, but it is the one which always work! :smile: \n@mgreter, thanks! It built and passed both tests. https://travis-ci.org/am11/node-sass/builds/40448866. While on windows, it is still choking with handful of reinterpret_cast messages. Normally, such things are thrown as warnings in VC++ paradigm. But this is C in Windows, so you never know. :stuck_out_tongue_winking_eye: \nCan you enlighten me with the usage of JSON error reporting? :+1: \nDoes it also serialize exception messages as JSON?\n. darrenkopp/sassc-win and darrenkopp/libsass-net stopped working.\nBTW, any thoughts on splitting sassc-win test code for Appveyor? Currently, we have to update submodule to run the test.\n. To run the tests on node-sass, following is the sequence:\n``` bash\nadd remote and get fresh code\ngit remote add node-sass https://github.com/sass/node-sass\ngit pull --rebase node-sass master\ninstall npm, fetches all the dependences and libsass prebuild binaries\nnpm install\nto build binaries manually and making sure that you are testing against\nlatest binary (not the prebuild ones)\nnode scripts/build -f\nto run the test\nnpm test\n``\n. @mgreter, it is not exposed insass_interface.h, then how would we utilize it? Shouldn't there be an option likebool return_errors_as_json(default: false)?\n. Also, does it now capturecolumninfo as well (in addition tomessage,lineandfile`)? (-8\n. Using your API documentation, https://github.com/mgreter/libsass/wiki/API-Documentation, I will try to refactor node-sass' bindings with new API in a separate branch and wait for libsass to get a tagged release, before merging into node-sass. :)\n. LOL, ikr!\nI removed the comment. :smile: \nToo many tabs were opened :wink: \n. Thanks @mgreter! :+1:\nSo basically, from the above example, bar.scss is there in the returned array but num_included_files is returning wrong count? This only happens in case of data input.\n. Awesome! :smile: :+1: \n. Indeed this is fixed. :smiley: :+1: \n. I will test it against node-sass and sassc-win. \nThanks @mgreter :smile::+1:\n. @mgreter, it compiles with VS2013 Update 4 if we make this change:\n``` diff\ndiff --git a/inspect.hpp b/inspect.hpp\nindex 999f4f0..bd35a9b 100644\n--- a/inspect.hpp\n+++ b/inspect.hpp\n@@ -95,7 +95,7 @@ namespace Sass {\n     virtual void operator()(Selector_List*);\n template <typename U>\n\n\nvoid fallback(U x) { fallback_impl(x); }\nvoid fallback(U x) { fallback_impl(reinterpret_cast(x)); }\n   };\n``\n. @mgreter, unrelated question: does it throw segfault if we pass non-existing files path asinput_pathinsass_make_file_context? In case input file doesn't exist && source_string is empty as well, is it possible to a get proper error message:{ file: input_file, message: \"file not found\" }?\n. I mean with the normalinput_path, does it generate graceful errors? Because with node-sass it is terminates the interactive console if we pass{file: /path/to/non-existing.scss}`. \n\nFor example with my node-sass master branch (with doesn't have importer code), this code:\njavascript\nrequire(\"./\").render({\n  file: \"C:/temp/alpha/index2.scss\",\n  success: function (css,map) { console.log(\"css: \" + css); console.log(\"map: \" + map) },\n  error: function (err) { console.log(\"err: \" + JSON.stringify(err)) },\n})\nterminates the node console, because index2.scss doesn't exists on this path (as if segfault occurred).\n. Impressive! Thanks for the quick fix!! :smile:  :+1: \nI will try it later, right now I am working on a different computer. \n. @mgreter, with node-sass' render function, we target sass_data_context (ctor takes string). If we pass both file and data, it picks file. As you mentioned, it should give precedence to data, in presence of both. I think this is a small glitch. :)\n\nHowever, this is still debatable; whether or not it should prioritize data over file in case of sass_file_context (as its ctor takes input_path). From one view-point, data would have no meanings in case of sass_file_context. \nIn my opinion, we should just have one context, which may tolerate either, or and both: file and data. The following two ctors can be made available:\n- sass_context (char* file, char* data);  // data takes precedence and file is used for sourcemaps\n- sass_context (char* input, enum sass_context_input_method input_method);\nWhere enum sass_context_input_method could be:\nc\nenum sass_context_input_method \n{ \n  FILE,\n  DATA,\n};\nOr maybe, for sake of brevity; just use a c99 bool: sass_context (char* input, bool is_file). :)\nThoughts? \n. My bad: actually it is our script which is doing things. We have three methods: renderSync, renderFileSync and renderFile, which makes to file and data contexts. We will be making a lot of breaking changes for node.js v2.\nGiven the current state of matters, having two separate classes doesn't make much sense, since the new API is now streamlined. I think file vs. data can be unified and more configuration options can be introduced later. :)\n. > Did it automatically add my new commit to this pull request?\nYes, when you push a commit, any PR opened for that branch will capture the commit.\n. Since the second commit replaces the first one, it should be either squashed or rebased.\n. Yup! :+1: \n. @andern, FWIW, on Windows, I am building libsass with VS2013 Update 4 (no need for Cygwin et al. VS comes with C99 support!). Also, you can try out the newly released full featured community version for open-source and academic folks.\nYou can grab the libsass project file for VS from: https://github.com/darrenkopp/sassc-win. :)\n. @nickdima, I have just added two new source-maps options node-sass, see https://github.com/am11/node-sass/commit/d58c303c3d149a8c6a58ff88e7318941c21fda74. \nThe PR (https://github.com/sass/node-sass/pull/543) will be merged, once libsass next tagged release is available and subsequently, we will release vNext of node-sass .\n. With new API implemented in node-sass, this issue is fixed. To wit:\n``` powershell\nC:\\users\\Adeel\\Source\\Repos\\node-sass [master]> cat c:/temp/proveit.sass\n%block\n  width: 100%\n  @media (max-width: 600px)\n    width: 50%\n.whatever\n  @extend %block\nC:\\users\\Adeel\\Source\\Repos\\node-sass [master]> node bin/node-sass --stdout --indented-syntax c:/temp/proveit.sass\n.whatever {\n  width: 100%; }\n  @media (max-width: 600px) {\n    .whatever {\n      width: 50%; } }\n```\n/cc @mgreter \n. @christianmagill, No; libsass can also handle indented syntax. See sass2scss.cpp. :smile: \n. Confirmed! I get the following (JSON) error from libsass, with the new API implemented in node-sass (unreleased):\njson\n{\n        \"status\": 1,\n        \"path\": \"c:/temp/foo3.scss\",\n        \"line\": 18,\n        \"column\": 13,\n        \"message\": \"argument `$map` of `map-get($map, $key)` must be a map\\nBacktrace:\\n\\tc:/temp/foo3.scss:18, in function `map-get`\\n\\tc:/temp/foo3.scss:18, in function `palette`\\n\\tc:/temp/foo3.scss:24\"\n}\n@mgreter, separately; in message of JSON, the filename and line number shouldn't be repeated. :)\n. Perhaps this VS issue is related: https://github.com/sass/node-sass/issues/530#issuecomment-63740435 :)\nIt throws \"Memory Access violation\" on accessing the queue. \n. @carey, thanks for looking into it. I have been wandering around the code to find more improvement and I ran Code Analysis on it, it gives some interesting pointers about memory related issues. \nHere is the log: http://pastebin.com/qgTgz7nS. I have fixed couple of them, but for example this: https://github.com/sass/libsass/commit/a4716732437dd9407b6de02036bc93924cd04b79#commitcomment-8652376, I couldn't figure out.\nThe interesting thing is, it draws the entire path to memory corruptions/leaks. There are total of 26 or warnings Code Analysis throws. It might be worth fixing (unlike .NET projects, it takes quite sometime to test all code paths, at least on i7 Lenovo).\n. I have found that node-sass importer callback is invoked till 21688e1979bff089a13d9a44ad0608357b2a91cc. As soon as I checkout to next commit e0a5d039d078e432af4c94029612031179f56348, it stops calling the cb.\nAnother regression is described here https://github.com/sass/libsass/commit/8957ad82b71ee9a402d3bea57eb97554f5e48776#commitcomment-8644934.\n. @xzyfer, I think it would be nice to merge this PR, so we can grab the corresponding tests in node-sass. :')\n. yay! :zap: :+1: \nThanks :)\n. I can also confirm it is working with node-sass, when pulling latest libsass master (and rebuild).\n. With regard to https://github.com/sass/libsass/issues/532, IMHO the relative paths feature can be implemented as a special case in extensible manner; providing most-common functionality OOTB.\n- Add relative-paths option (default: false to remain conformant with ruby-sass).\n- When the option is set, on compile compiler will first resolve the value and call a virtual function with default implementation:\n  - Sass_Value(char* input_file, char* output_file, char* value_file, char* transient_file, char* parsed_value, char* evaluated_value), where:\n    - input_file: absolute path of file being compiled.\n    - output_file absolute path to user intended output file.\n    - value_file absolute path to file which encountered the value.\n    - transient_file in case where, for example, a mixin or a variable is defined, this path is the file containing the mixin and variable and it could be different that the value_file where it is ultimately consumed. Note import and implode may have different implications in path resolution. :smile: \n    - parsed_value raw value encountered by the parser\n    - evaluated_value evaluated value, which is written to output today.\n  - Return evaluated_value as is, if one of the following is encountered (defensive programming):\n    - Absolute Path\n    - URL\n    - CSS4 variable.\n    - Any invalid path character (which could be meant for post-processing)\n  - Resolve and return relative path as: relative(input_file, relative(value_file, evaluated_value)).\n- Expose same signature on API (perhaps as path_handler), so down-streams can override the default behavior.\n. :+1: \n. :+1: \n. @mgreter, I think the Perl-Example link on wiki is incorrect. I just updated libsass master, and its throwing an error here. Currently, I am passing pointer to struct Sass_Import** sass_importer(const char* file, void* cookie).\n. Great! So basically can I interpret it llike this:\n``` javascript\n// JS\n// set options:\noptions.file = blah;\n...\noptions.prefix = \"some-url-prefix-string\";\noptions.importer = function(file, prefix, done) {\n  // do something with file and prefix and when you\n  // are done producing result, call done(result)\n};\n```\nThen in binding code, pass prefix as second parameter to Sass_C_Import_Fn.\nI am afraid my example might not be accurate, but does it make sense from node-sass implementation viewpoint?\n. Oh that's actually the previous URL! But what would happen if partial.scss (in your example) also imports second-partial.scss, then we lose the desired context in prev?\nI think it would probably make sense to make it projected_path, which returns the absolute path (or url) that libsass interpreted (as opposed to the first parameter url, which is the parsed path as is).\nThoughts?\nIMO it makes sense to wait for this feature before the release.\n. c\ntypedef struct Sass_Import** (*Sass_C_Import_Fn) (\n  const char* parsed_url,       // libsass: what I got\n  const char* interpreted_url,  // libsass: my interpretation of what I got\n  void* cookie                  // libsass: some cookie you want to eat later, I don't care about\n);\n:smiley: \n. I think beyond current URL and its interpretation by libsass, the tertiary implementer/consumer can maintain the list of imports (perhaps in a static memory) it has received by libsass via importer function -- if the use-case is extra-ordinary.\n. Haha! That is true.\nActually I am assuming that libsass without custom importer, does the following:\n- If the initial input path is URL or absolute FS path, set cwd = directory_of(input_path).\n- Subsequent paths in import chain gets resolved with cwd, unless another (a different) URL or abs path is encountered (in which case set cwd = directory_of(current_file)). I think the recursion plays a role to step in and out to get the correct-previous cwd, in case an SCSS document has multiple imports?\nNow suppose abc.scss imports xyz.scss and 123.scss, then xyz.scss imports http://web/assets/foo.scss. Now final user doesn't know what order does the parser use? Depth-first or breath-first?\nMomentarily, if it was a depth-first, then the previous to 123.scss was http://web/assets/foo.scss, which makes it less meaningful to the user because it wanted to deduce the correct absolute path.\nSo in my opinion, libsass should keep that context (resolving path with correct cwd based on the recursion step or tree or whatever) and send us the paths before and after the interpretation, along with cookie. I think this will suffice most of the use cases (the final implementer can then cache the URLs, store them in cache and make use of them depending on their use-case).\nDoes this make sense?\n. Separately, I think (not sure if it is beyond the scope at this point), for downloading content in case of URL, libsass can probably make use of http://casablanca.codeplex.com/.\n. (or even better libcurl: https://github.com/bagder/curl)\n. Thanks for clarification. Lets go with the current implementation. :)\nI updated node-sass code with prev option. I think I have found two bugs :bug: :beetle: \nConsider the following setup:\nC:\\temp\\alpha\\index.scss:\nscss\n@import 'foo.scss';\n@import 'bar.scss';\nC:\\temp\\alpha\\foo.scss:\nscss\n@import 'bar2.scss';\nbody {\ncolor: red;\n}\nC:\\temp\\alpha\\bar.scss:\nscss\np {\ncolor: grey;\n}\nC:\\temp\\alpha\\bar2.scss:\nscss\nspan {\nz-index: 4;\n}\nFollowing is the JS code (lets call it script1):\njavascript\nrequire(\"./\").render ({\n  file: \"c:/temp/alpha/index.scss\",\n  outFile: \"c:/temp/alpha/index.css\",\n  sourceMap: \"c:/temp/alpha/index.css.map\",\n  success: function(css, map){\n     console.warn(css); console.warn(map);\n  },\n  error: function(err, status){\n    console.error(status + \": \" + err);\n  },\n  importer: function(file, prev, done) {\n    console.log(\"File: \" + file);\n    console.log(\"Previous: \" + prev);\n    done({\n      contents: \"div {color: yellow;}\"\n    });\n  }\n});\n(in the importer, I am printing the first two parameters as is to stdout)\nOutput for log messages:\n\nFile: foo.scss\nPrevious: c:/temp/alpha/index.scss\nFile: bar.scss\nPrevious: c:/temp/alpha/index.scss\n\nBug 1: bar2 never reached importer. The expected output was:\n\nFile: foo.scss\nPrevious: c:/temp/alpha/index.scss\nFile: bar2.scss\nPrevious: c:/temp/alpha/foo.scss\nFile: bar.scss\nPrevious: c:/temp/alpha/index.scss\n\nNext, the generated source-map looks like this:\njson\n{\n        \"version\": 3,\n        \"file\": \"index.css\",\n        \"sources\": [\n                \"index.scss\",\n                \"../../../C:/temp/alpha/foo.scss\",\n                \"../../../C:/temp/alpha/bar.scss\"\n        ],\n        \"sourcesContent\": [],\n        \"mappings\": \"AEAA,AAAK,AAAO,AAAZ,AAAK,AAAO\",\n        \"names\": []\n}\nBug2: The sources are messed up, although in the example above, I am only changing the content in importer (not the file path).\nIf I remove importer from script1, then it generates correct path (and also we have bar2 in sources array, which was missing previously):\njson\n{\n        \"version\": 3,\n        \"file\": \"index.css\",\n        \"sources\": [\n                \"index.scss\",\n                \"foo.scss\",\n                \"bar.scss\",\n                \"bar2.scss\"\n        ],\n        \"sourcesContent\": [],\n        \"mappings\": \"AGAA,AACA,AAAS,AFAT,AACA,AAAO,ACFP,AACA,AAAO\",\n        \"names\": []\n}\nCan we nail them before the release? :)\n. Hi. I updated to latest libsass, but the sourcemap issue still exists.\nIt looks like in case of custom importers, the paths in source-map's sources[] array are not resolved w.r.t generated .map file path. Clipping out the importer function produces correct result (without changing anything else).\njavascript\nrequire(\"./\").render ({\n  file: \"c:\\\\temp\\\\alpha\\\\index.scss\",\n  outFile: \"c:\\\\temp\\\\alpha\\\\index.css\",\n  sourceMap: \"c:\\\\temp\\\\alpha\\\\index.css.map\",\n  success: function(css, map){\n     console.warn(css); console.warn(map);\n  },\n  error: function(err, status){\n    console.error(status + \": \" + err);\n  }\n});\nvs\njavascript\nrequire(\"./\").render ({\n  file: \"c:\\\\temp\\\\alpha\\\\index.scss\",\n  outFile: \"c:\\\\temp\\\\alpha\\\\index.css\",\n  sourceMap: \"c:\\\\temp\\\\alpha\\\\index.css.map\",\n  success: function(css, map){\n     console.warn(css); console.warn(map);\n  },\n  error: function(err, status){\n    console.error(status + \": \" + err);\n  },\n  importer: function(file, prev, done) {\n    console.log(\"Previous: \" + prev);\n    done({\n      contents: \"div {color: yellow;}\"\n    });\n  }\n});\nBTW, node.js runtime does not mind Linux-style slash in Windows. :)\nAlso, cd c:/temp/alpha/ and even cd /temp/alpha are valid and equivalent in powershell (when $pwd is in C: drive). In cmd, it only recognizes back-slash, so cd c:\\temp\\alpha\\ and cd \\temp\\alpha are both valid and pointing to same directory (if cd , is in C: drive).\n. @mgreter, @xzyfer, I have implemented this feature in node-sass, but it keeps reporting NA. Do we have to incorporate some sort of compile-time variable in our build process?\nAlso, wouldn't it make sense to handle it differently (as a fallback option), so we don't have this compile-time dependency?\n. Thanks for the information @mgreter.\nIf we have to manually provide version on compile, then I think its better to keep the libsass version in node-sass package.json, where node-sass' own version is defined.\n. node-sass can use a corresponding subsequent (pre)release before the holidays. :)\n. Is there any ETA for RC? I am planning to build release soon. Should we go with libsass 3.1-alpha2 or wait for RC to arrive?\n. Awesomeness! :tada: :congratulations: :+1: \n. @xzyfer, in order to comply with Semantic Versioning v2.0 (which allows us to retain the beta slug), shouldn't we use 3.1.0-beta instead?\n. Perhaps @FeodorFitsner can give us some pointers here? \"How to setup CI with organization account\". I think there is an option to chose the organization when you logon? Or perhaps something in the settings?\nAlso @nschonni, set it up for node-sass: https://ci.appveyor.com/project/sass/node-sass. So hey @nschonni, would you please help us figure out this tricky riddle? :)\n. Great! I will wrap up few things and make a release. Thanks for the heads up @xzyfer ! :+1: \n. Thanks @nschonni!\n@mgreter, I think this markdown would be more verbose:\n[![Build status](https://ci.appveyor.com/api/projects/status/github/sass/libsass?svg=true)]\n(https://ci.appveyor.com/project/sass/libsass/branch/master)\nproduces:\n\n. Yay! :100:  :+1: \n. Congrats! :tada: \n. :+1:\n. :+1:  abstract  classes FTW! \nSpeaking of refactoring the code, would it make sense to also restructure the repo: separate .cs and .cpps from .hs and .hpps like so:\nroot\n   \\\n    libsass\n        \\\n        sources\n            \\ \n             {  all source files go here, could have subdirectories }\n        \\\n        headers \n            \\ \n             {  all header files go here, could have subdirectories matching those under sources }\nThis way the README would be visible without scrolling down the repo's main page. :smile: \n. Awesome! :)\n@mgreter, separately, TravisCI has beta OSX testing support too. Based on this, you would need to send them an email (support@travis-ci.com) to enable Mac testing for libsass repo. I contacted them for node-sass, but they denied saying:\n\nI am afraid we are unable to turn the multi-OS feature for you at this time, as the repository requires multiple Node.js runtimes that are not available.\n\nI think they might enable it for libsass, as there is no such issue.\n. All is well! :+1: \n. Agree with @xzyfer! it can be achieved by PostCSS. See this full example, how we are diverting node-sass output to PostCss processors: auto-prefixer and rtl-css (there is lot of noise in that JS, just ignore that).\nFor the libsass API feature, surely it would be an extra option but IMO this kind of addition would not violate the parity. How? defaults are always set to Ruby-Sass' defaults. Then we can have two independent -- disableable flags, 'use tabs instead of whitespace' (default: false) and 'tab count' (default: 2).\nSeparately (alert: opinion ahead):\nPersonally I think 'compressed output' is one out-of-the-scope feature of any CSS trans-compiler. Why? Because to achieve the most efficient and safest compression (aka true compression), there are evolved/established optimizers like https://github.com/css/csso/. That feature is always half-ready in various CSS superset compiles (producing pseudo-minified output). There should be a standard, like libcsso, which would save everyone from inventing their own minification techniques and the problems that come with them.\n. @mgreter, thanks. :+1: \nI will make node-sass v2.0.0 without this feature. Later, we will provide these options on node-sass front: options.linefeed = \"CR/LF/CRLF\", options.useTabIndentation = true/false and options.indentationLength = whole number (0+). Then generate appropriate options for libsass. Also, we will inherit libsass defaults for these, i.e. we will not set default value and let libsass apply its defaults.\n. Yes the string option itself makes sense.\nWould we need to dispose these const char*, or libsass parser will free the memory after producing the option (like imports**)?\n. :+1: \nApparently, we do not need to change anything in node-sass binding, right? :)\n. https://github.com/sass/libsass/issues/324 and https://github.com/sass/libsass/issues/605 are related, which are being tackled by @mgreter's https://github.com/sass/libsass/pull/603 and https://github.com/sass/libsass/pull/786 PRs. \nTo recap, the root-cause of this issue is not as simple as it seems.\n. :+1: \n. Thanks @mgreter! :+1:\nI will try it now. \n. @mgreter, somehow the errors which were previously returned as JSON are coming as plain text. Is there something changed in sass_context_get_error_json()?\n. After pulling the latest libsass master, it is giving me a plain text error:\njavascript\nrequire(\"node-sass\").renderSync({data:\"messing around\"})\nsource string:1: error: invalid top-level expression\nWhich was previously producing:\njson\n{\n  \"status\": 1,\n  \"file\": \"stdin\",\n  \"line\": 1,\n  \"column\": 1,\n  \"message\": \"invalid top-level expression\"\n}\nAnd segmentation fault if data is an empty string:\njavascript\nrequire(\"node-sass\").renderSync({data:\"\"})\nSegmentation fault\n. Sorry for the cry-wolf, recompiling fixes it! (crazy things happening today here) :)\n. :100: +\nThanks for the quick fix. :+1: :)\n. Hi @QuLogic. Thanks for the info! :+1: \n\nI don't think it implements anything in the C++ standard library...\n\nThis makes perfect sense. I was afraid of the same thing. :)\nBut according to ldd, part of the dynamic lib depends on GLIBC (which is one of two issues described here: https://github.com/sass/node-sass/issues/517). Wouldn't using dietlibc fix the libc dependency bit?\nFor distro releases I agree, it would make more sense to compile against the standard libc.\n. True. I think we should stick with the current approach: compile our binding with oldest GCC and Glibc, which does not require altering the libsass code. That is probably GCC 4.5.4 and GlibC 2.12. :)\nThanks for curing my curiosity! :smiley: :+1: \n. Just sharing random thoughts here. I don't know how much 'embedded' is the sourcemap machinery with libsass code, but if it is implemented in a modular manner and can be consumed by a separate lib, it would be outstanding. You may able to release it as a separate lib with friendly API, which takes certain interface <IParser>, and do the magic. That API can be consumed by other superset langs compilers implemented in C++. Imagine a Stackoverflow and GitHub friendly Markdown compiler (md to html trans-compiler), which is able to produce source-maps and in written in C++! :watermelon: The sad news is there is no markdown complier as of this day, which produces source-maps. The good news is there is a definite demand and some interesting use cases for such a thing.\nThe ideal sourcemap generator is the one which emits maximum mapping info for each language token in compiled source, which maps to source, uni-directional: output --to--> input. And yes not even Ruby-Sass is quite there. However, less.js has made some excellent progress in this domain (for example it even maps the source variable of orange in this output: foo + bar      {   /*  funny stuff ...  wasting space     */     background: linear-gradient(to left, lime, orange); })! :)\nThanks @mgreter for investing time and doing the hard work here. This work is priceless and in coming times the use-cases of source-maps will grow and this libsass implementation will set an example! :+1: :star: :tada: \n. :+1: \n. Super fantastic. You nailed it! :smile_cat: :+1: \n. Any ETAs for The v3.1.0 RTW ? \n. Cool!\n@xzyfer, I invited you on gitter SASS organization channel (https://gitter.im/sass/~chat#), but you aren't enrolled in the organization. :(\n. @mgreter, is there a test case for indent and linefeed options in perl or spec?\n. Yes, actually it is emitting garbage characters. I tested with C-string and then std::string initializer (.c_str). On first runs, it totally ignores the indent setting, but respect the linefeed. But on second run and onward, it is emits some garbage characters with indent, which is forcing libsass to emit @charset \"UTF-8\".\n. Thanks! I will push my changes shortly.\n. Here is the commit: https://github.com/am11/node-sass/commit/fd77d18bbf5aee95829e15d48cbc312d93d44ff6 (updated)\nI have added two options in API for indentation, indentWidth (int) and indentType (space or tab). Based on that, I am constructing a cstring and passing it to libsass. In return, I am getting faulty characters after the linefeed (at indent character position).\n. Here is how the failing test look like: https://travis-ci.org/am11/node-sass/jobs/55564050#L1380. Over on CIs it is happening intermittently. But locally I can reproduce it persistently.\n. @mgreter, finally it worked! https://github.com/sass/node-sass/pull/792\n(C)Strings have tendency to give us hard time..\n. :+1: \n@xzyfer, got your message on #libsass, with node-sass I tested with this:\njavascript\nrequire(\"node-sass\").renderSync({data:\"div {\\\n    $a: 1px;\\\n    $b: 2px;\\\n    foo: $a * $b;\\\n}\"})\nAnd it returned the error:\njson\n{\n  \"status\": 1,\n  \"file\": \"stdin\",\n  \"line\": 1,\n  \"column\": 27,\n  \"message\": \"2px*px is not a valid CSS value\"\n}\n(no crash)\nThis happened before applying 6729b1a (it is pointing to 420d7fb).\n. @mgreter, can we test source-maps with sassc without involving ruby/sass-spec?\nI can write a simple test runner which couts the results. The only \"fancy stuff\" would be using the json.c and actually parsing the result as JSON and test the member/ingridentes of JSON while treating it as an object (as opposed to string). This way we don't have to worry about the order of items or items in sources[] and contents[] arrays. Then we can create some tests and even borrow some from less. :)\nAll this in with pure sassc, no ruby, no gem, just C! :sunglasses: \n. Today is turning out to be a big achievement day! :+1: :star: \nCongratulations! :)\n. @mgreter, if you are authorized, you would see a Stop Build (or Skip Build) button on Appveyor. So you can stop these for example:\nhttps://ci.appveyor.com/project/hcatlin/libsass/build/1.0.50\nand\nhttps://ci.appveyor.com/project/hcatlin/libsass/build/1.0.51\n. Oh great!\nOn a separate note @xzyfer and I were just chatting here https://gitter.im/sass/~chat# about something which you might be able to help us with! Whenever you have time, you can see. The chat logs don't expire on gitter. :smiley: \n. @mgreter, apparently we have access to start/stop here: https://ci.appveyor.com/project/sass/libsass/build/1.0.2. I have started the build! :ok_hand: \n. Apparently, we just need to updated the web hook > Payload URL in GH repo settings. Something like this:\n\n. @xzyfer https://ci.appveyor.com/api/github/webhook?id=s88o0u5qra2ng4vy\nIt corresponds to sass/libsass. \n. LOL yeah. Some loop in there. I think unless there is a new commit pushed (or rebased/amend the existing one), it will not pick up sass/libsass ?\n. @xzyfer, seems like it is building the latest release: https://ci.appveyor.com/project/sass/libsass/.\nThe Webhook URL is located on the project settings main page: https://ci.appveyor.com/project/sass/libsass/settings.\n. I think if you are an admin in Sass, then it should allow you to access and modify settings. \nMeanwhile, here is how I have it configured in one of my Repo on GitHub:\n\nYou can perhaps try deleting the entry and creating a new one with https://ci.appveyor.com/api/github/webhook?id=s88o0u5qra2ng4vy.\n.  :+1: :tada: \n. One way to slice it is adding nightly branch instead of the stable. The nightly would always be the bleeding edge branch and master would simply be the one pointing to the latest stable. Or even more elaborated version would be:\n- master: pointing to latest stable tagged release.\n- nightly: pointing to latest preview tagged release.\n- dev: pointing to bleeding edge commit.\nSo at any point in time, master || nighlty would be sync'd with dev (depending on whether nightly was released most recently or stable).\n. @xzyfer, on a related note, I think it would make sense to delete the exiting (unused/stale) branches https://github.com/sass/libsass/branches (and start fresh with this strategy). :)\n. Awesome! Apparently, number theory is (also) becoming a strong suit of libsass. :sunglasses: \nOn a separate note, would be nice if you guys can setup gitter (like node-sass channel there: https://gitter.im/sass/node-sass), so peeps can throw  in questions, which you guys can answer later. IRC is another way to go. :)\nPS: We have a badge for gitter in README as well: https://github.com/sass/node-sass/blob/master/README.md\n. Regarding tests, libsass relies on sassc executable, which also acts like a driver to run sass-spec test suite, which uses Ruby as an intermediary. But we only achieve functional testing by this approach (on relying on tertiary agent libsass->sassc->ruby..).\nHere is a related issue: https://github.com/sass/sassc/issues/90. As @xzyfer mentioned, the Ruby entity in this test lifecycle is nothing but a convince at this point, and we can gradually move to C++ based testing framework, I think (and what @mgreter said) with that, we might be able to test more features such as options, source-maps and much more features, which are (not totally, but) unrelated to spec.\nHaving said all that, it would still be functional testing, satelliting the API with sassc (which is more native than throwing in Ruby/Python to the mix), as opposed to Unit test, which shall be more focused the nitty-gritty of implementation itself.\nHere is my mind-map (not the graphical one :chart_with_upwards_trend: ):\n- [Functional] Sassc to load spec suites, filter-out to-dos tests and run the suites while maintain stats (a drop-in replacement to what Ruby script is doing there on sass-spec repo). IMO ruby script shouldn't live on sass-spec repo either. Spec repo should only have pairs of input and expected output. (FTR, I do not have anything against Ruby). :)\n- [Functional] Sassc to test libsass' niche features such as; custom importer, custom functions, all those surrounding disableable options and last but not the least, source-maps.\n- [Unit] In libsass, we can have Catch (or CppUnit) to test the components of code, and I believe @smikes has presented more than just a prove-of-concept! This is exactly what we ever wanted... isn't it? :smile: \n. @QuLogic is correct. You can either use the git clone way (for which please refer to @QuLogic's link) or download sassc and extract the folder in libsass directory and compile.\nIt works with both VS2013 Update 4 (Express for Desktop, Professional or Community Version) and VS2015 preview.\n. @patlecat @KaeNote, you can check the appveyor.yml to see how to build it using mingw.\nTo compile as lib, I think it would be nice if we have a another solution file with lib-only configuration. Meanwhile, you can try changing project settings in VS and remove the sassc dependency.\n. Thanks @FeodorFitsner! \n@xzyfer, @mgreter, can you please confirm what @FeodorFitsner's has pointed out?\nYou can find those settings under Appveyor Web Hook settings page on GitHub:\n(something like https://github.com/sass/libsass/settings/hooks/ <some-hook-id>)\nIt looks like:\n\n. Thanks @xzyfer!\n@FeodorFitsner, previously the hook was tied to @hcatlin's account: https://github.com/hcatlin/libsass. We updated it to point to https://github.com/sass/libsass when this problem started. Is there any other tip you can provide to relax this situation? :)\n. @mgreter, you and @xzyfer both are admins. :)\n@FeodorFitsner, its right here: https://github.com/sass/libsass/pull/805#issuecomment-68811040\n. Following https://github.com/appveyor/ci/issues/157, I had a brief email conversation with @FeodorFitsner and GitHub staff, I have found the solution for AppVeyor hook problem.\nCurrently, if the owner logon to AppVeyor, select Sass account and browse to https://ci.appveyor.com/account, they will see my account as GitHub authorization. It was set to Andrew's account, I revoked and re-authorize with my account to test whether it keeps the history, which it does.\nThe issue is neither Andrew nor me are owners of LibSass, but only node-sass. So the solution is simple; either @xzyfer, @mgreter or anyone with Owner role for both node-sass and libsass can logon to https://ci.appveyor.com/account with GitHub creds, select Sass account and click the revoke button under GitHub account then click authorize. This will hook both repos.\n. :tada: \n. @mgreter, its fixed. To make this work (and pass CI), https://github.com/sass/sassc/pull/91 needs to be merged first. Check the update in first comment above.\nPlease also review the commit messages. //cc @xzyfer yay! isn't that we ever wanted!  :D\n. @mgreter, in this case, libsass.sln is not used by CI build at all. This makes libsass package independent. Anyone can download zip, open win/libsass.sln press ctrl+f5 and boom: they got the dll in win/bin/ directory.\nHowever, the one in sassc (sassc/win/sassc.sln) is bit different. It is mostly meant for CI. It requires sassc folder to be present (cloned) at libsass root. Then it generates exe file in libsass/sassc/bin/. So separation of concerns is there. \nIMO, this is more \"separation of concern\" oriented approach.\nBut if we want to consume dll file generated by libsass.sln or the build references across the project, then it would be a tricky scenario (may require some code change)! I am not expert on MSBuild system by any means. Lets see if @darrenkopp can shed some light on that?\n@darrenkopp, what we have with this commit is:\n- clone libsass, cd libsass\n- clone sassc (inside libsass)\n- both libsass and sassc has folder called win with sloluton and project files.\n- the one in libsass/win is libsass.sln (and vcproj with same name), which generates dll file.\n- the one in (libsass/)sassc/win is sassc.sln, which generates exe file.\nWhat we want is to without making code changes, have a dependency of one vcproj on another, in such a way that the libsass references appear in only libsass.vcproj and sassc.proj depend on those references. Is it possible?\n. @mgreter, this worked with wildcards: :zap: \n```\n  \n\nand\n\n\n```\nfor sassc/win/sassc.sln and changed ..\\*. for libsass/win/libsass.sln. :)\nI think we can also define environment variable in powershell and then use it in MSBuild! \nDoesn't cmake unify Make and NMake? We can generate the nmake of this file and then do scripting in cmake. (For the record, I have never used cmake, just nmake once or twice) :)\n. @mgreter, according to this, Make and NMake will work with CMake, so we can add NMake later. :)\nFor now, to make this work on appveyor, we first need to merge https://github.com/sass/sassc/pull/91, then this PR (to take changes from appveyor.yml) and then rerun the build on appveyor to confirm if it is working (which I am pretty sure will work). :wink: \n. Sure thing, will update the wiki accordingly. I promise!! :smile: \n. Thanks @darrenkopp! For that matter, I propose that we restructure the repo like libuv, or even better:\nroot\n  \\\n  other-directories\n  \\\n  src\n      \\\n       header {containing .hpp and .h files}\n      \\\n       code {containing .cpp and .c files}\nAnd header and code directories should always include those files which are required for the compilation.\nOne benefit would be to keep the root cleaner and hence on GitHub, readme would be visible (without major scrolling down). :)\n. @mgreter, is there anything that i need to update for this? I think I would have to update the wiki after this is merged right? :)\n. Its an excellent news! :sunglasses: \n@xzyfer, I am thinking about a preview release (alpha) with libsass v3.1.0 to relax the io.js situation, once we get v3.2.0 ready, we can add more features and land on beta. Who knows we might be able to get https://github.com/sass/node-sass/pull/644 ready by @matryo by that time. 8-)\n. :checkered_flag: :tada: \n. Yes and only nine more bugs to terminate: https://github.com/sass/libsass/issues?q=is%3Aopen+is%3Aissue+label%3Abug. :smiley: :+1: \n. :+1: :tada: \n. Guys this node-sass issue is also related: https://github.com/sass/node-sass/issues/608. :)\n. Cool! I think instead of rerouting peeps, I should make a habit of submitting specs myself to make things easier for you guys to manage. :)\n. :+1: \n. @davidangel, while this is a great idea, but you may want to consider using the alternative approach meanwhile.\nSince node.js is blessed with postcss a foundationally package, you can use packages like csswring to re-wire the source-maps:\n``` javascript\nvar postcss = require('postcss');\nvar csswring = require('csswring');\nvar nodeSass = require('node-sass');\nvar result = noseSass.renderSync({file: 'test.scss');\npostcss().use(\n  csswring.postcss\n).process(result.css);\n```\nOr if you want to consume autoprefixer (yet another postcss based package which lets you configure various vendors' prefixes and autoprefix the output), it won't even require you to use csswring. See https://github.com/sass/node-sass/issues/555#issuecomment-64913888 for example and this for full-scale node-sass example, which runs two postcss processors (Autoprefixer and RTLCss) on the node-sass output, while keeping the node-sass intact.\nAlso, note that the most optimised and correct minification or CSS or JS is a very complicated and delicate matter. The most efficient CSS minifier IMO and in my experience is CSSO: https://github.com/css/csso (not sure whether they are postcss compatible).\nTherefore, for superset CSS languages, Scss, Less, Slylus etc., IMO it does not make much sense to at least \"perfect\" this aspect, for sake of separation of concerns. I think it would make sense to have a unified minification and source-mapping experience from all these post-processors, rather than the varied and yet fragmented one. (but most probably it is not applicable here, since libsass follows ruby-sass for feature selection)\n. @xzyfer, interesting! I haven't tried more-css (!?!). Thanks for the link. :)\n. @umyeah, you can check the version of node-sass and corresponding version of libsass as follow:\nCLI usage:\ncmd\nnode-sass --help\nCode usage:\njavascript\nrequire('node-sass').info()\nnode-sass v2.0.1 corresponds to libsass v3.1.0.\n. Nice catch!\ntest.scss:\n``` scss\n@charset 'UTF-8';\n*{\n  color: red;\n}\n```\nProduces * {\\n  color: red; }\\n, but with test.sass:\n``` sass\n@charset 'UTF-8'\n*\n  color: red\n```\nThrows:\njavascript\n{ status: 1,\nfile: 'c:/temp/test.sass',\nline: 1,\ncolumn: 18,\nmessage: 'invalid top-level expression',\ncode: 1 }\n@xzyfer, is skipping @charset directive from emitting into output by design (spec)?\n. @xzyfer, few more notes. It turned out the be the issue at sass2scss conversion step. I placed a breakpoint at file.cpp#L282 and here is what I have found:\nBefore (.sass):\n``` sass\n@charset 'UTF-8'\n*\n  color: red\n```\nAfter transform (.scss):\n``` scss\n@charset 'UTF-8' {}\n\n{\n  color: red; }\n```\n\nExpected after transform (.scss):\n``` scss\n@charset 'UTF-8';\n\n{\n  color: red; }\n```\n\n//cc @mgreter \n(Disclaimer: I am testing with v3.1.0 not the latest master)\n. :tada: \n. AFAICT libsass doesn't compile below VS2013 Update 2. The C99, C++11 features were not available in older iterations of VS (see this vcblog entry).\nBesides GCC v4.6 is the minimum version which can compile libsass. Why should we misguide the users? It does not make sense.\n. :+1: \n. Thanks for the heads-up @mgreter! :+1: \nIs it a good idea that I backport this change to v3.1.0, since node-sass vNext might go without libsass v3.2.0?\nThis might fix the intermittent hung-ups by libuv and SIGSEGVs which we sometimes encounter with bleeding edge version of io.js.\n. I think it does not compile with GCC 4.6 (or even 4.4.7, which was released after 4.6) right away, unless you apply this kind of a patch (originally provided by @mgreter) for libsass v3.1.0. I testing building node-sass with many versions of GCC (4.4.7, the manually build 4.5.2 and 4.5.4, 4.6 and 4.9) but since our requirement for node-sass was to support CentOS 5 (basically the specific glibc version that it was released with) and above, I stopped and applied the aforementioned patch to compile with 4.6. But I think version 4.7.x might be the bare minimum, as CentOS 6.{don't-remember} was able to build libsass as is, with its default dev-toolkit installation.\n:+1: for making official RPM package of libsass! Any ETA on this?\n@jrobeson, can we build on Copr today? It seems like it is active and community is engaged building packages using copr.\n. @xzyfer, yes that option is required: From libsass' API angle, sass_option_set_source_map_file essentially sets the string path. The option in node-sass (sourceMap) accepts my/preferred/path/to/file.map (String) as well as bool. If sets to true, node-sass resolves the sourceMap path with respect to outFile and pass it to libsass.\nIf source_map (string) is set and output_path is null, libsass can either:\n- assume output_path = change_extension(input_path, \".css\");\n- or emit JSON with empty file: ''.\nI prefer the latter one because it will not confuse the user and if someone comes to our shop with crazy use-case, we can easily pitch: what you set is what you get. :smile: \n. Also, neither libsass nor node-sass do anything with output_path, but both infer it as source_map_out_file. We can probably rename it as a breaking change, if we are chose to go with this option:\n\nIf  source_map  (string) is set and  output_path  is null, libsass will emit JSON with empty file:.''.\n. @joliss, it seems like the issue is due to the reason node-sass require user to provide abs. path for input file, while we should resolve it for the user (in case of relative path); the same way we resolve outFile.\n\nThe outFile is then resolved with respect to (input) file and source-map path is resolved with respect to outFile.\nCan you please open this issue in node-sass instead?\nThank you.\n. I just realized that libsass is resolving the input path with respect to cwd, so we don't have to do that. Please ignore my previous comment.  :)\n. @joliss, \nThe path related issues usually belong to node-sass, since LibSass (for most part) has nailed the path related aspect of source-map.\nThe node-sass API's behavior is:\n- Both .map and .css paths are resolved with respect to input path.\n- Both .map and .css are placed in the same directory, when sourceMap: true. If you want to place it somewhere else, just set sourceMap: 'your/preferred/path'.\nSo node-sass provides following options for your scenario:\n1 - Provide correct relative paths:\njavascript\nvar result = sass.renderSync({ \n  file: 'styles/app.scss',   // <-- cwd + style/app.scss\n   includePaths: ['styles', 'vendor'], \n   sourceMap: '../anyName.css.map',   // <--- relative to input path, could be any location.\n   outFile: '../dist/assets/app.css',  // <-- also relative to input path\n   sourceMapContents: true\n})\n2 - Provide absolute paths:\njavascript\nvar result = sass.renderSync({ \n  file: '/path/to/my/project/app.scss', \n   includePaths: ['styles', 'vendor'], \n   sourceMap: '/path/to/my/project/app.css.map',\n   outFile: '/path/to/my/project//dist/assets/app.css', \n   sourceMapContents: true\n})\n3 - Use sourceMap: true, but save it to the correct path (which appears in sourceMappingURL in generated CSS, which is how browser finds the map file):\n``` javascript\nvar result = sass.renderSync({ \n  file: 'styles/app.scss', \n   includePaths: ['styles', 'vendor'], \n   sourceMap: true,\n   outFile: '../dist/assets/app.css',\n   sourceMapContents: true\n}) \nwriteFile(result.map, '../dist/assets/app.css.map') // but understandably, \n                                                    // this path hard to calculate,\n                                                    // or worse solution could be to parse CSS\n                                                    // for sourceMappingURL using regex\n                                                    // which won't work, if you set\n                                                    // omitSourceMapUrl to false in \n                                                    // node-sass options\n                                                    // hence option 4 below\n```\n4 - Wait for node-sass vNext where you will be able to get back the resolved sourceMap path in callback, when using render (async) method: https://github.com/sass/node-sass/pull/686\njavascript\nsass.render({ \n  file: 'styles/app.scss', \n   includePaths: ['styles', 'vendor'], \n   sourceMap: true,\n   outFile: '../dist/assets/app.css',\n   sourceMapContents: true\n}, function(err, result) { // node-style cb, new in vNext\n  writeFile(result.map, this.options.sourceMap)  // this.options is provided with resolved paths\n})\nHope this helps.\n. :+1: \n. AppVeyor builds are failing for VC jobs: https://ci.appveyor.com/project/sass/libsass/build/1.0.200.\nAdding output_nested and output_compressed in win/libsass.vcxproj and applying the following patch would fix it:\ndiff\ndiff --git a/inspect.cpp b/inspect.cpp\nindex d58dd3c..f3998b1 100644\n--- a/inspect.cpp\n+++ b/inspect.cpp\n@@ -6,6 +6,7 @@\n #include <string>\n #include <iostream>\n #include <iomanip>\n+#include <stdint.h>\n. @mgreter, yes actually the error was about files not found (because they were referenced in vcxproj but were removed from repo). :smiley: \nIt is now complaining that we need #include<stdint.h> in util.cpp.\nhttps://ci.appveyor.com/project/sass/libsass/build/1.0.207/job/bbhkel9xigunkppk#L950\nWould it make sense to add headers in .hpps, so when the header is used by multiple .cpp, it shares forward declarations for those lang features?\n. All Green! https://ci.appveyor.com/project/sass/libsass/build/1.0.208. \nYay! :tada:\n. @mgreter, there are around 266 warnings in VC job on AppVeyor. Some warnings are ignorable (POSIX style vs. STD-C++ style like _stdrup).\nBut others may be useful. Like there are 100+ warnings with code C4099: https://msdn.microsoft.com/en-us/library/695x5bes.aspx.\n\n'Sass::Context' : type name first seen using 'struct' now seen using 'class'\n\n(and vice versa)\nFor instance, in bind.hpp you have struct Context, while elsewhere it is used as class. Would it be a good idea to visit those warnings, it might improve some code patterns. :)\n. Sure. I will try to take a stab at those soon. :smiley: \n. :+1: :100: \n. @mgreter, since the implementer doesn't have any context to resolve line and column information in importer, wouldn't it make sense that libsass handle those two at its own and just accept the error message?\n. @drewwells,\n\nreally no message would be fine with me \"import not found: {name}\" \n\nI think its not mandatory to return custom importer error for implementer. If you don't need the customized error, you can exclude it and libsass will fallback to its default missing-import error.\n. :+1: \nI was not sure what to make of this: https://github.com/sass/libsass/pull/869#issuecomment-77685051. Perhaps both fixes will play role in addressing the flaky behavior of uv_closing in higher versions libuv (that io.js uses). \nThe higher the version is, more sensitive these libraries become (from GC perspective).. (-8\n. (disclaimer I haven't debugged libsass latest code yet)\n@mgreter, is it also applicable to file_context? \nAfter upgrading to 3.2.0-beta.1, if I dispose input_string for data context, it starts failing tests, which makes perfect sense, because we are not making copy before sending to libsass. So I removed the free statement to avoid double free and it worked! :tada: \nNext, I also removed the free statement for input_path in file context case and tested, it was working. But then I added back the free statement for this input path, it still does not break or fail anything (still working fine), whereas I was expecting it to throw as this is a double free case! So, if libsass is not owning input_path memory for file context, is this by design?\n. @mgreter, thanks for the comment. \nI will then keep the free() statement for input_path.\nThere are some source_map path related issues I am facing with 3.2.0-beta.1. Some tests are failing because file member (which points to CSS file) is now returning an absolute path, when we are send the abs. path from node-sass. The expected behavior (the one that libsass v3.1.0 possesses and we shipped with node-sass v3.0.0-pre) is to get the file path resolved w.r.t location of outfile. I couldn't find anything related to paths in changelog. Should I open an issue for it? Or Gitter?\n. :+1: \nCan you please keep the message member intact and add a description (or detail) to JSON for the decorator error? Actually, message is aligned with JavaScript's Error object property. :)\nSingle word like description or detail is also appreciated because JSON's preferred style is cameCase and other languages may not appreciate having no _ between disjoint words. :)\n. Ok. Would it be possible to add err_message to JSON endpoint as detail as well? That would be really cool! This way we won't need to do extra effort at JavaScript front. :)\n. +1 for formatted. So the structure of JSON tuple would be https://github.com/sass/node-sass#error-object + formatted. Note that currently we do not need to induce any property and forward the Error object (parsed from libsass' JSON string) as is to the downstream. So the formatted addition in libsass would automagically be incorporated in node-sass. (ok, I am being selfish here)\n. @mgreter, node v3.0.0-beta.5 is released, that corresponds to libsass v3.2.0-beta.5. :tada: :gift: \nI was hoping it would close https://github.com/sindresorhus/grunt-sass/issues/201 without intervention of node-sass, but the formatted errors are not emitted in JSON error string. :(\nInput:\ndata: 'a{b:c'\nOutput (error):\njson\n{ \"message\": \"error reading values after c\",\n  \"column\": 5,\n  \"line\": 1,\n  \"file\": \"stdin\",\n  \"status\": 1 }\nExpected:\njson\n{ \"message\": \"error reading values after c\",\n  \"formatted\": \"error reading values after c\\non line 1 of stdin\\n>> a{b:c\\n-------^\",\n  \"column\": 5,\n  \"line\": 1,\n  \"file\": \"stdin\",\n  \"status\": 1 }\nIf we are suppose to parse, unwind and then repack JSON error string to implode decorated/formatted error member, then it is really an ordeal. IMO, it seems like an unnecessary overhead to capture part of error differently.\n. What I know about this concept is that C++'s new/delete engages reference tracking and does a lot more then C's free(). However, C's malloc/free() are barebone memory operations, give more control and yet prone to SIGSEGVs etc. Mixing them lead to UB.\n. I am getting a sigsegv on TravisCI on node-sass: https://travis-ci.org/sass/node-sass/jobs/54901826#L648\nIt doesn't tell much and it is not reproducible on Windows. I haven't probe the root cause because I am implementing custom functions feature atm, will report back if it is the same after the implementation. \nNonetheless, there is definitely something fishy about the memory management atm.\n. Going by this comparison sheet on wikipedia, xUnit++ is one of the most feature-complete and modern C++ unit testing framework: https://bitbucket.org/moswald/xunit/wiki/Home. \nI think we can incorporate that one in sassc repo. :)\n. That looks pretty solid. :+1:\nIt would probably be a good idea to add UnitTest++ as a submodule in sass/libsass/test. Once API tests runner is configured, we can port spec runner stuff in there. It will emit its own executable binary (say libsass-test). Eventually, libsass/test may end up with UnitTest++ and fixtures/spec directories (similar to node-sass: https://github.com/sass/node-sass/tree/master/test). :)\n. I can reproduce this issue with current master. \nIn other words, sass/sass-spec#278 is failing.\n. @mgreter, this only happens when git is configured to auto-correct endings. Lets say you type/paste the following in notepad:\nscss\n$media-medium: \"screen and (min-width: #{$break-medium-min}) \\\nand (max-width: #{$break-medium-max})\";\n(or the spec code)\nnotepad will surely add \\r\\n. :sunglasses:\n. @mgreter done https://github.com/sass/libsass/issues/1067. :)\n. Before: https://ci.appveyor.com/project/sass/libsass/build/1.0.284/job/wtrhkkvd6qsux1s0#L445\nAfter: https://ci.appveyor.com/project/sass/libsass/build/1.0.289/job/yr73xv4n09upjp6m#L446\n. I have changed the title of this issue. The debug failure syndrome was back. \nBut the rest of the changes will boost the performance from ~6 mins to ~2 mins per build.\n@xzyfer, please merge it so all future commits get compiled quickly (the MinGW jobs). :)\n. @mgreter, that comment suggests that there were assertion errors when running the sassc command. Can you tell how did you diagnose it? I couldn't find it in the output. Is there a (hidden) verbose switch in sassc?\n. Yes @xzyfer! Debug can wait. :)\n. @mgreter, it was working when I opened this PR and now it starting to fail again: https://ci.appveyor.com/project/sass/libsass/build/1.0.303, so I reverted back that line with echo prefix. I don't know why it was working before and why failing now. But the comment there suggests that it fails with assertion failure, on running tests with debug configuration.\nPerhaps, get some verbose output from sassc to check where the Debug build goes all mute for hours.\n. Yes! I noticed. But yet again, it could be ignored because it is the error spec..? I have the commit ready for it, but since we are not accepting the PR for spec-repo for errors yet, so should I dare trying? :)\n. :+1: :tada: \n. @xzyfer, nice catch. But the keyframes-selector can be from and to as well? Would it make sense to keep a whitelist to qualify for the keyframes-selector (in case CSS brings more terms to the mix in future)? [\"{numeric_value}%\", \"from\", \"to\"]\nRef: http://www.w3schools.com/cssref/css3_pr_animation-keyframes.asp\n. :+1: \n. Success! VC also compiled it. C++11's variadic templates are supported in VS2013, but C++14's one are forthcoming. Here is the latest standard compliance table available (VS2013 vs. VS2015-preview): http://blogs.msdn.com/b/vcblog/archive/2014/11/17/c-11-14-17-features-in-vs-2015-preview.aspx.\n. You would probably need to bump to C++11 to consume its <string>'s pop_back() implementation. (-8\n. yay! :+1: :tada: \nPS: Wow so many commits and PRs are revolving around! Keep them coming! :sunglasses: :100: \n. We would probably need to prevent sassc from prompting error on stderr, but redirect to stdout (2>&1)?\n. Now Sass org is using AppVeyor FOSS Pro account (since last night), so we can experiment with it with much faster pace. :wink: :sunglasses: :sunny: \nThere was no way we would wait for hours to get the CI job done!\n. Please add contextualize_eval.cpp before this line: libsass.vcxproj#L167 and contextualize_eval.hpp here: libsass.vcxproj#L211.\n. @ekskimn, all green here: https://ci.appveyor.com/project/sass/libsass/build/1.0.307 (-8\nIMO, you can squash those commits into one before this gets merged.\n. All four job matrices on two CI servers are passing.\nNow, this is getting really interesting! :smiley: \n. > can you please squash this commits.\n@ekskimn,\nOne way to go about it is a two-fold (long) solution:\nbash\ncd into/libsass\ngit remote add libsass https://github.com/sass/libsass\ngit pull --rebase libsass master\ngit pull --rebase\ngit push -f  # to rewrite the history\nIt will squash away those merge commits. Then:\n``` bash\ngit rebase -i HEAD~12    # here 12 is the number of commits you end-up with in this PR.\neditor will open, replace (only) pick with f for all commits but the first one.\nsave and quit editor\ngit push -f   # to rewrite the history again\n```\nFollowing the exact steps will yield one clean commit. (however, you may want to keep them distributed)\n. @xzyfer also mentioned this for node-sass on Gitter chat. \nIn JavaScript, the end-user can either use promises (such as async#waterfall: https://www.npmjs.com/package/async#waterfall, example usage: Bartinger/grunt-github-release-asset/github_release_asset.js#L42) or just a if/else, switch/case state machine to call appropriate function (to read data from database, web-service, file-systems etc.). For this, IMO, there is no need for API support and offloading the implementation design choice to final implementer would make sense: one generic entry point would suffice.\nI may be missing the point. Please correct me if there is a use-case which cannot be handled without multiple importers.\n. Does this mean libsass will define the types of custom importer?  For instance:\n\nhttp-handler: reads the resource from HTTP\nhttps-handler: reads the resource from HTTPS\nftp-handler: reads the resource from FTP\nnetwork-fs-handler: reads the resource from network filesystem\nlocal-fs-handler: reads the resource from local filesystem\ncustom-handler: reads the resource from data host, could be a web service call, database (@import my-connection-string#table :sunglasses:!) etc.\nglobal-handler: reads the resource from all of the above resources. LibSass will always call this.\n\nQ2: Would we be able to pipe the output of one importer to the input of another, with some kind of a precedence order? Calling multiple importers for same @import encountered. (this is a crazy use-case, but who knows someone may come up with this kind infrastructure which mandate this use-case..)\n. @mgreter, thank you for the explanation! :+1: \nOn a related note, would it be possible to incorporate glob pattern, so implementer can supply a pattern to register against using can_handle()? Found this cross-platform globbing lib: http://www.shwild.org/ from http://stackoverflow.com/a/5213763/.\n. :+1: :zap: :tada: \nI will start implementing it later this week (in the middle of moving), unless, of course someone else wants to give it a go! :smiley: //cc @matryo :smile_cat: \n. With this change, node-sass passes all 749 tests. (and without it, nine source-map related tests were failing)\n@xzyfer, would it be possible to release libsass-v3.0.0-beta.2, so we can release node-sass v3.0.0-alpha.1 with all the awesome libsass new features? (-8\n. @xzyfer, thank you! :+1: :tada: \n. Now, I would just need to attempt the code to compile against gcc 4.4.7 on o0ooold CentOS! 8-)\n. :+1: :100: \nCongrats @ekskimn! :tada: \n@xzyfer, I didn't knew that we are keeping libsass.filters in sync too (not even sure what is it for). \n. :+1: \nThis is also one step towards our ultimate CMake goal /cc @nschonni. If this works, we will have all the criteria we need to create universal CMake configuration: https://github.com/sass/libsass/pull/292.\n. :+1: \nThis is also one step towards our ultimate CMake goal /cc @nschonni. If this works, we will have all the criteria we need to create universal CMake configuration: https://github.com/sass/libsass/pull/292.\n. @onedayitwillmake, perhaps you can get some pointers from Ruby repos' .travis.yml:\nhttps://github.com/ruby/ruby/blob/trunk/.travis.yml\n. I once sent them email for osx support for node-sass, and they denied cutely:\n\nI took a look at this repository. I am afraid we are unable to turn the multi-OS feature for you at this time, as the repository requires multiple Node.js runtimes that are not available.\nFor currently supported language configurations, please consult https://github.com/travis-ci/travis-ci/issues/2320.\nWe are working to beef up our Mac infrastructure, and planning to enable this feature for all repositories.\nThank you for your understanding.\n\nPerhaps libsass gets the pass.\n. CI said: I am good! :+1: \n. :+1: \nPerhaps this is related: I have observed some significant performance decrease when running the huge test with v3.2.0-beta.2 (compared to v3.1.0) via node-sass test runner.\n. This looks quite interesting @mgreter. :+1: \nI will try to wrap my head around how to provision the priority thing in JS and/or decent way to capture the intent of user that which kind of import they want to handle with certain importer, so to translate that in API call.\nCurrently, I am under the impression that we will allow user to make their decision and return null; whether certain importer wants to handle certain kind of URI? In which case, the user will return null or undefined from JS code, we will return nullptr to libsass and libsass will call the next importer in pipe. If there is no next-importer in queue, libsass will fallback to default mechanism.\nPlease CMIIW.\n+1 to add it in v3.2. We already have fistful of breaking changes coming in node-sass v3, why not another! :sunglasses: \n. This is brilliant! :zap: \nI think we can let node-oriented users return the priority as member of object, instead of doing something fancy/tricky like this.priority=.., they will just return {file: ..., contents: ..., priority: ..} (or the async variant done({file: .., contents: ..., priority: ...})).\nAs for the custom headers, I will try to add it to v3, but I am not sure if we would have enough time after this gets merged and libsass v3.2.0 stable is released? Will there be another beta or rc, so we have time to include these features and be able to align node-sass v3.0 release with libsass 3.2?\n. > has to be passed to libsass before the importer gets called\nI just envisioned it how it will look, and let me tell you this much: this is going to be fun :sunglasses: :sunny: \nWe will need to provide the following variants:\n- importer: function\n  - the priority 0 will be sent to libsass from node-sass binding\n- importer: { priority, function }\n  - the user-defined priority will be sent to libsass\n- importer: [function1, function2, ..]\n  - the array index will be sent as priority\n- importer: [{priority, function}, {priority, function}, ..]\n  - the user-defined priority will be sent.\n- importer: [{priority, function}, {priority, function}, {function /* no priority here! */}..]\n  - the user-defined priority will be sent, and the index of array for the missing priority.\n  - not sure what will happen if there is a tie in priorities (user-defined vs. index-decuded)\nSame goes for the headers.\nAside: we really need help from someone to document all that libsass via node-sass has to offer to node.js paradigm.\n. After all, this is issue #:100:0 !\n. @mgreter, the CI builds are mostly failing due to the ongoing DDOS attack on GH servers: https://twitter.com/githubstatus/with_replies.\nSeparately, would it be possible to emit libsass version info in .vcxproj as well? \nEdit: perhaps these are related: \nhttp://stackoverflow.com/a/15141816/863980 &\nhttp://stackoverflow.com/a/3459239/863980.\n. This might be of your interest: node-sass/src/binding.cpp#L135-L148:\n``` c++\n  char** included_files = sass_context_get_included_files(ctx); \nif (included_files) { \n    for (int i = 0; included_files[i] != nullptr; ++i) { \n      // do something\n    }\n  }\n```\n. @QuLogic, thanks for the suggestion. It is fixed by https://github.com/sass/node-sass/commit/8a194d06fa3dfabedd87aec3cf6774a49f3de116.  :+1: \nHowever, we need the iterator index to insert the values in v8 array.\n. Yes we are checking it in all cases, but is there state, when libsass returns NULL for included_files?\nI think it always returns the valid pointer, since it converts C++ vector (context.hpp#L43) to array of C strings (sass_context.cpp#L475), while allocating memory in all cases: sass_interface.cpp#L35. \nShould we consider it safe?\n. @xzyfer, this is pure C++11 std compliance (deprecating usage of the cpp11's deprecated feature) and nothing to do with WindOS-specifics. :smiley_cat: \n. @keeperofkeys, note that this feature will arrive in node-sass in upcoming beta.\n. @mgreter, thanks for the heads-up!\nI am in the middle of relocating due to work. Last night I made node-sass to compile against libsass 3.2. Those weren't huge changes, just to shut the compiler up. Based on your perl-libsass commit, is it possible that Sass_Compiler is null here: https://github.com/sass/perl-libsass/commit/85fbc0573609ec5e22270ba0160c6fb8fc41800b#diff-5b390435e30d16e259818ad6b65d1dafR312? I was getting exception on calling sass_compiler_get_last_import because comp was null with this one line of Sass code:\ndata: '@import \\'doesNotExist.scss\\'',\nI will try to wrap it up during the weekend.\n. @mgreter, take your time, it can wait till tomorrow. :)\n. Yay! for the issue being spotted! :sunglasses: :tada: \n. @mgreter, this is a huge feature and we can do much on consumer side IMO. Kudus! \ud83c\udfc6  \ud83c\udf89\nFor node-sass, it would require a non-CAPI implementation via V8/nan wrappers, for which I can spare sometime if no one else is taking it. :)\nFor libsass-net, I will try to take inference with perl-libsass implementation as we did for all the other features in FFI way.\n@chriseppstein, @darrenkopp, is it a valid option if we have a dontnet bring-up under Sass organization account? If so, on which repo we can further this discussion? This will give the project some boost and comparatively fast updates. Out of interest, I am willing to contribute to keep all projects under organization in sync, with all these kind of awesome auxiliary features Marcel has implementing  \ud83d\ude0e \n. @mgreter, thanks! Should I wait for the next beta?\n@rodneyrehm, I always tend to use pull with rebase. :)\nOnce I added the remotes after the first clone:\n``` bash\nfirst time\ncd src/\ngit clone https://github.com/sass/libsass\ncd libsass\ngit remote add mgreter-libsass https://github.com/mgreter/libsass\ngit remote add xzyfer-libsass https://github.com/xzyfer/libsass\n```\nlater at any random point in time:\nbash\ncd src/libsass\ngit pull --rebase mgreter-libsass feature-branch-name\n(it fetches and rebase on your current branch and fallbacks to 3-way merge if there are conflicts which normally doesn't happen if you have added libsass as submodule like node-sass has)\n. This is super fast! :smiley_cat: :tada: \n. :+1: \nGood idea; and I will go out and get some fresh oxygen :smoking: :smile_cat: \nOn this note, should we configure appveyor to clone sass-spec repo with CRLF ending to test Windows environment verbatim?\n. :tada:  8-)\n. :+1: :100:\nAnd this is one of the huge advancement in libsass IMO. Source-maps are very much promising that what we had few months ago. I remember when I reverse engineered the libsass generated source-map to fix the bugs for WE2013 in C++++ (#), which I think should be removed now. :smile_cat:\n. @mgreter, there is still one crazy case which is inconsistent (perhaps not worth fixing?).\n(added periods to highlight spaces)\nscss\n@import url(\"a.. .\\.. .\n . . b\");\nRuby Sass:\ncss\n@import url(\"a.. ... .\\a  . . b\");\nCurrent libsass master (28ee0884243820a34c3458e26b36fc59ccefd9b3):\ncss\n@import url(\"a.. ... .\n\\a  . . b\");\nNot sure about logic behind ruby-sass implementation. I was expecting something like this:\ncss\n@import url(\"a.. ... .\\  . . b\");\n. @xzyfer,\nquickly tested current master with the following input:\n``` scss\n/ url-test1: without quotes /\n@import url(a\nb);\n/ url-test1: with quotes /\n@import url(\"a\nb\");\n/ url-test2: with quotes /\n@import url(\"a   \\d \\d \\\\d \\\\d\n    c \\t \\n \\t \\n \\\\t \\\\n \\\\t \\\\n\");\n/ url-test2: without quotes /\n@import url(a   \\d \\d \\\\d \\\\d\n    c \\t \\n \\t \\n \\\\t \\\\n \\\\t \\\\n);\n```\nLibSass:\ncss\n/* url-test1: without quotes */\n@import url(a b);\n/* url-test1: with quotes */\n\\a b\"); url(\"a\n/* url-test2: with quotes */\n\\a     c t n \\\\t \\\\n \\\\t \\\\n \\\\\\\\t \\\\\\\\n\");\n/* url-test2: without quotes */\n@import url(a \\d \\\\d \\\\\\d \\\\\\\\d c \\t \\n \\\\t \\\\n \\\\\\t \\\\\\n \\\\\\\\t \\\\\\\\n);\nRubySass:\ncss\n/* url-test1: without quotes */\n@import url(a b);\n/* url-test1: with quotes */\n@import url(\"a\\a b\");\n/* url-test2: with quotes */\n@import url(\"a   \n\\\\d \\\\\n\\\\\\\\d\\a     c t n \\\\t \\\\n \\\\t \\\\n \\\\\\\\t \\\\\\\\n\");\n/* url-test2: without quotes */\n@import url(a \\d \\\\d \\\\\\d \\\\\\\\d c \\t \\n \\\\t \\\\n \\\\\\t \\\\\\n \\\\\\\\t \\\\\\\\n);\nIMO,  url-test1: with quotes is more important than rest of them.\n. Yup, I tested on both Mac and Windows, the result is identical to yours. url-test1 in Windows is inverted from the middle. url-test2 in both are differently incorrect. I used libsass a508a7c and sassc https://github.com/sass/sassc/commit/94838a90c403120af9da5f71a8daf79cf3ec82fe:\nsh\n~/Documents/projects/libsass/sassc/bin/sassc ~/Documents/temp/blah.scss\n. I am running Mac and Windows 10 via Parallels. I am using sassc.\nMac (sassc running on Terminal):\nsh\n~/Documents/projects/libsass/sassc/bin/sassc ~/Documents/temp/blah.scss\ncss\n/* url-test1: without quotes */\n@import url(a b);\n/* url-test1: with quotes */\n@import url(\"a\\a b\");\n/* url-test2: with quotes */\n\\\\\\\\d\\a     c t n \\\\t \\\\n \\\\t \\\\n \\\\\\\\t \\\\\\\\n\");\n/* url-test2: without quotes */\n@import url(a \\d \\\\d \\\\\\d \\\\\\\\d c \\t \\n \\\\t \\\\n \\\\\\t \\\\\\n \\\\\\\\t \\\\\\\\n);\nWindows (sassc running on PowerShell):\nps\n~/Documents/projects/libsass/sassc/bin/sassc ~/Documents/temp/blah.scss\ncss\n/* url-test1: without quotes */\n@import url(a b);\n/* url-test1: with quotes */\n\\a b\"); url(\"a\n/* url-test2: with quotes */\n\\a     c t n \\\\t \\\\n \\\\t \\\\n \\\\\\\\t \\\\\\\\n\");\n/* url-test2: without quotes */\n@import url(a \\d \\\\d \\\\\\d \\\\\\\\d c \\t \\n \\\\t \\\\n \\\\\\t \\\\\\n \\\\\\\\t \\\\\\\\n);\nLine below /* url-test1: with quotes */ on Windows is inverted from the middle. \nLine below /* url-test2: with quotes */ on both Mac and Windows are incorrect but different from each other.\n. @xzyfer, sorry I was looking at the CLI output which was broken in both PowerShell and Terminal in different ways.\nI just piped to a file and saw the output in editor.\nsh\nscssc  blah.scss > blah.css\nMac (TextEdit)\ncss\n/* url-test1: without quotes */\n@import url(a b);\n/* url-test1: with quotes */\n@import url(\"a\\a b\");\n/* url-test2: with quotes */\n@import url(\"a   \n\\\\d \\\\\n\\\\\\\\d\\a     c t n \\\\t \\\\n \\\\t \\\\n \\\\\\\\t \\\\\\\\n\");\n/* url-test2: without quotes */\n@import url(a \\d \\\\d \\\\\\d \\\\\\\\d c \\t \\n \\\\t \\\\n \\\\\\t \\\\\\n \\\\\\\\t \\\\\\\\n);\nWindows (Visual Studio and then HexEdit to check what's going on):\ncss\n/* url-test1: without quotes */\n@import url(a b);\n/* url-test1: with quotes */\n@import url(\"a\n\\a b\");\n/* url-test2: with quotes */\n@import url(\"a   \n\\\\d \\\\\n\\\\\\\\d\n\\a     c t n \\\\t \\\\n \\\\t \\\\n \\\\\\\\t \\\\\\\\n\");\n/* url-test2: without quotes */\n@import url(a \\d \\\\d \\\\\\d \\\\\\\\d c \\t \\n \\\\t \\\\n \\\\\\t \\\\\\n \\\\\\\\t \\\\\\\\n);\nNote that in Windows output, the extra line before each \\a is \\r (HEX 0D). I haven't tested whether it is the raw result of compiler or is it shell redirection inserting the carriage return there. Whichever it is, this issue is fixed. Thank you! :trophy: :+1: \n. @xzyfer, I have confirmed that \\r (hex: 0D) is added before both \\a occurrences, by placing printf(\"size >>> %lu\\n\", strlen(output_string)); before: https://github.com/sass/sassc/blob/94838a9/sassc.c#L46.\nWhen compiling this input sample on Mac it prints: size >>> 308 while on Windows: size >>> 310.\nAny ideas where this \\r it is coming from?\n. With debugger, on Mac:\n```\n\nBlock 0x7fddcbc1d410 (0@[0:0]-[16:0]) [root] 0\n  Comment 0x7fddcbc1c1a0 (0@[0:0]-[0:31]) 0 <>\n  // String_Quoted 0x7fddcbc07460 (0@[0:0]-[0:31]) [/ url-test1: without quotes /] [delayed] <>\n  Import 0x7fddcbc1c230 (0@[1:0]-[1:7]) 0\n @ String_Quoted 0x7fddcbc1c570 (0@[1:8]-[1:12]) [url(a b)] < >\n Comment 0x7fddcbc1c750 (0@[4:0]-[4:28]) 0 <\\n\\n>\n // String_Quoted 0x7fddcbc07ad0 (0@[4:0]-[4:28]) [/ url-test1: with quotes /] [delayed] <\\n\\n>\n Import 0x7fddcbc1c690 (0@[5:0]-[5:7]) 0\n@ String_Quoted 0x7fddcbc1ca10 (0@[5:8]-[5:12]) [url(\"a\\a b\")] < >\n Comment 0x7fddcbc1cb60 (0@[8:0]-[8:28]) 0 <\\n\\n>\n // String_Quoted 0x7fddcbc08050 (0@[8:0]-[8:28]) [/ url-test2: with quotes /] [delayed] <\\n\\n>\n Import 0x7fddcbc1caa0 (0@[9:0]-[9:7]) 0\n@ String_Quoted 0x7fddcbc1cdd0 (0@[9:8]-[9:12]) [url(\"a   \\r\\d \\\\r\\\\d\\a     c t n \\t \\n \\t \\n \\\\t \\\\n\")] < >\n Comment 0x7fddcbc1ceb0 (0@[12:0]-[12:31]) 0 <\\n  \\n>\n // String_Quoted 0x7fddcbc08570 (0@[12:0]-[12:31]) [/ url-test2: without quotes /] [delayed] <\\n  \\n>\n Import 0x7fddcbc1cf40 (0@[13:0]-[13:7]) 0\n@ String_Quoted 0x7fddcbc1d2e0 (0@[13:8]-[13:12]) [url(a \\d \\d \\\\d \\\\d c \\t \\n \\t \\n \\\\t \\\\n \\\\t \\\\n)] < >\n\n```\nWindows:\n```\n\nBlock 00B236C0 (0@[0:0]-[15:1]) [root] 0\n Comment 00B1F080 (0@[0:0]-[0:31]) 0 <>\n // String_Quoted 00AEA178 (0@[0:0]-[0:31]) [/ url-test1: without quotes /] [delayed] <>\n Import 00B06B68 (0@[1:0]-[1:7]) 0\n@ String_Quoted 00B06DA8 (0@[1:8]-[1:12]) [url(a b)] < >\n Comment 00B1F0F8 (0@[4:0]-[4:28]) 0 <\\r\\n\\r\\n>\n // String_Quoted 00AEC078 (0@[4:0]-[4:28]) [/ url-test1: with quotes /] [delayed] <\\r\\n\\r\\n>\n Import 00B06FE8 (0@[5:0]-[5:7]) 0\n@ String_Quoted 00B07228 (0@[5:8]-[5:12]) [url(\"a\\r\\a b\")] < >\n Comment 00B1EEA0 (0@[8:0]-[8:28]) 0 <\\r\\n\\r\\n>\n // String_Quoted 00AEC1A8 (0@[8:0]-[8:28]) [/ url-test2: with quotes /] [delayed] <\\r\\n\\r\\n>\n Import 00B273B0 (0@[9:0]-[9:7]) 0\n@ String_Quoted 00B27680 (0@[9:8]-[9:12]) [url(\"a   \\r\\d \\\\r\\\\d\\r\\a     c t n \\t \\n \\t \\n \\\\t \\\\n\")] < >\n Comment 00B1F170 (0@[12:0]-[12:31]) 0 <\\r\\n  \\r\\n>\n // String_Quoted 00B06808 (0@[12:0]-[12:31]) [/ url-test2: without quotes /] [delayed] <\\r\\n  \\r\\n>\n Import 00B28400 (0@[13:0]-[13:7]) 0\n@ String_Quoted 00B27F80 (0@[13:8]-[13:12]) [url(a \\d \\d \\\\d \\\\d c \\t \\n \\t \\n \\\\t \\\\n \\\\t \\\\n)] < >\n\n```\nLine 10 indicates\nMac: @ String_Quoted 0x7fddcbc1ca10 (0@[5:8]-[5:12]) [url(\"a\\a b\")] < >\nWin: @ String_Quoted 00B07228 (0@[5:8]-[5:12]) [url(\"a\\r\\a b\")] < >\nYou are right, this issue was present before your fix: 2ecaa6667c837715b705c5298d18f849cfb54735. Note that before 15913abcab246cca2fc49e9772789a6f8ce24e51, my sample was throwing SIGSEGV on both OSes, so I tested just one case: url-test1: with quotes. :smile: \n. :+1:\n\n[Spoiler: Given we have custom functions, it might not be possible. On flip-side, it may be possible since it appears to me that the AST has all the required context to pull this]\nIMO, at some point Sass codegens should be able to emit set of the standard CSS, v2 (and above), v3 (and above), v4 (and above) and since so forth. With those set, the compiler should error if the non-conforming pass-through CSS code is encountered. For instance, expression evaluation was ended by IE team in 2008: http://blogs.msdn.com/b/ie/archive/2008/10/16/ending-expressions.aspx and it is no longer supported in standard mode since IE8. Now in a team work, if someone used the expression evaluation, they should get the message if certain compile-time flag was set (say --css2 or --css3). This is similar to how JS superset languages (sweet.js, coffeescript, typescript) are doing it. \nWith that said, I think a black-list approach would be more appropriate to sniff out the vendor specific (non-prefix) tokens (such as expression(), filter() etc.) and throw.\n. @mgreter, could you please explain when should we use sass_make_qstring?\nShould we always expect LibSass to callback the CustomFunction with verbatim string (with inclusive quotes as is) and just use sass_make_string in wrapper? If this is the case, what is the use of sass_make_qstring?\nOr is it so that we should inspect the string values returned by consumer in wrapper code and then call sass_make_string or sass_make_qstring based on whether the returned value has single or double quote within? Or always use sass_make_qstring variant as there is no point of not use verbatim strings.\n. Moreover, the commit difference is monstrous to spot the origin of bug: https://github.com/sass/libsass/compare/31521ef3ece636892f395a80392448ceae449b90...master (385 commits between libsass v3.1.0 and current master).\n. :tada: \nThanks @mgreter! ~,~\n. Note that ruby-sass (which is the model implementation for libsass) gives the ditto output.\n. Congrats :congratulations: \n. Nit: milestone 3.3.1 -> 3.3\n. :+1: \n@spaer, have you tried compiling on i386 (via VM?) or SPARC? I am just curious if libsass is RISC-compatible in general.. (so my toaster can compile Sass natively :stuck_out_tongue_winking_eye:)\n. Looks pretty reasonable to me. :+1: \n. :+1: \n. @mgreter, just wanted to stop by and say thanks for overhauling the build process and opting for cmake. :+1:\n. @mgreter, I totally respect the decision made by @xzyfer. Just an opinion; \n- 3.3 is going to be a HUGE release of libsass\n- Many major downstreams are already using new API\n- sass_interface is already deprecated for a while now.\nGiven this situation, wouldn't it make sense to forgo sass_interface for 3.3? We can always offer help to someone who is asking. Last I remember, .NET wrapper was using it and it was also upgraded..\n. @saper, @xzyfer, those are unused functions! :)\nOtherwise, it is rather easy to version-lock code for MSVCR with this condition: defined(_MSC_VER) && _MSC_VER < 1900.\n. Ah, missed that one hidden under macro! updated the conditional statement.\n. @saper, tested with both VS2013 and VS2014 and everything was green. :)\nDid some digging and found that the ToolsVersion in first line of vcxproj file is irrelevant in native C++ projects when we have Microsoft.Cpp.*.props imported (as we have here; with that tools version gets overridden and also I think msbuild only considers it for .NET projects only if no further tools version is defined, it has a lowest priority I think).\nOne more interesting thing I found during this exercise and commented here (the CLI tip): http://stackoverflow.com/questions/19801072/the-builds-tools-for-v120-platform-toolset-v120-cannot-be-found#comment51867426_19801072 <- the command line argument has the highest precedence. Also we can set environment variable to select tooling for all projects in the given environment.\n. @saper, that's pretty neat! :+1: \nI have left a comment (without the fix, it was complaining when I had VS2013 tooling selected). \n@xzyfer, @mgreter, do you guys like that (separation of concerns) approach by took by @saper?\n. @xzyfer, @mgreter, changes by @saper are incorporated via 574b3941559d7759e6b417b607efc67e97047536. PTAL.\n@mgreter, on a separate note, when  we build on win, the process leaves behind two files win/libsass-version and win/sassc-version. Should we delete them if they are unused as part of the post-build step (via an MSbuild Task)? I am not sure if they are required afterwards, if they do we can add them those two paths to .gitignore. Please advise.\n. @mgreter, it was updating for all consecutive builds (with/without cleanup), so I have added the rule in .gitignore via e0e23e0.\n. @saper, I have make it so that it deletes the files after it sets the variable: 49f5886.\nTested with both VS2013 and VS2015 and win/bin/Debug/sassc -v prints correct versions in both cases.\n@mgreter, it turned out we don't need to both .gitignore for this one.\n. This is tested and ready.\n. ouch! I thought you are AFK so I can mess around a bit with appveyor.yml :wink: \n. @xzyfer, this will fail as it depends on https://github.com/sass/sassc/issues/132. Please first merge sassc PR, then I'll rerun the CI build. Once CI gets green again, this is ready for merging.\nLatest changes made in this PR:\n- libsass\\win\\libsass.sln now produces dynamic lib libsass.dll (or static libsass.lib) as it should. Currently it is producing sassc.exe and compiling sassc. To make it produce static lib, set environment variable LIBSASS_STATIC_LIB and unset to produce dll again.\n- libsass\\sassc\\win\\sassc.sln now produces libsass\\sassc\\bin\\sass.exe as it should and AppVeyor CI will use it.\n- Both projects shared include files via libsass.targets, so we don't need to add sources in multiple projects anymore (for example, at present (without https://github.com/sass/sassc/issues/132), sassc/win/sassc.sln is not compiling due to the stale include references..)\n. @saper, I used LIBSASS_HEADERS_DIR and LIBSASS_SRC_DIR in .targets, .vcxproj.filters and .vcxproj files after reading @mgreter's proposal: https://github.com/sass/libsass/issues/1360. At the moment, they have same values in [libsass/sassc].vcxproj, but the point was to make the project future refactor compatible. I also used LIBSASS_DIR and LIBSASS_STATIC_LIB (user-defined env var which is used in libsass.vcxproj).\nIt will definitely be a good idea to align these build-time variables naming convention across the board (including those we used in node-sass), but that will probably require major overhaul covering gyp, Makefile and vcxproj files in libsass and node-sass. IMO we should have an RFC-issue tracking that kind of cleanup in libsass issue tracker. \n. @xzyfer, sure. I intend to updated the wiki once this is merged. :)\n. @xzyfer, this is ready as is. The there was a sassc<->sass typo and it actually works: MSVC builds passed. \nDo you still want me to refactor the commits? :)\n. @xzyfer, I have rebased it so all appveyor.yml changes are in the first commit. Then the order follows which retain @saper's commits and the final VC solution refactoring goes in bedefc3 which conforms with the changes made in sassc. It can be further squashed down to one multi-authors commit for tidiness. \nLet me know if there is anything. \nAside: I will update the wiki page further and send a separate PR for sassc Readme later.\n. @mgreter, thanks for the suggestion. I have simplified the commands in wiki using environment variables: %ProgramFiles% and %ProgramFiles(x86)% and their PowerShell variants ${env:ProgramFiles(x86)} and $env:ProgramFiles. Also upgraded the sassc PR accordingly: https://github.com/sass/sassc/pull/133.\n\nwhat they need to change if they installed VS in another path (is that even possible?).\n\nDuring the installation, we can change the install directory in VS, but (I think) MSBuild is always installed at %ProgramFiles(<process-arch>)%/MSBuild. Otherwise it needs to be located via registry: http://stackoverflow.com/q/328017 and so forth.\n. PR URL: sass/libsass/pull/1446.\nTest Spec URL: sass/sass-spec/pull/472.\nVerified on Ubuntu Server 14 (Clang 3.6) and Windows 10 (VS 2015).\n. /cc @mgreter: PTAL\n. This is the fix for regression. The throw behavior can be addressed separately IMO.\n\nCouldn't we just assign the constructor arguments to locally scoped variables before calling the  Color  constructor? \n\nGood idea. Another good idea is probably to always finish off with free rather than delete in a custom delete operator implementation as we have more control over memory than we should. :) So IMO this fix is necessary in any case. One obvious question is \"why it is not throwing elsewhere?\". AFAICT, this is the only path to destroy() function, but this assumption is unwarranted because I haven't debugged with the entire sass-spec suite but only a couple dozens tests of my own. ;)\n. > Couldn't we just assign the constructor arguments to locally scoped variables before calling the Color constructor? \nOn this note again; as you indicated previously that the Ruby Sass behavior is to clamped $alpha>1 to 1, $alpha<0 to 0, $[r/g/b] > 255 to 255 and $[r/g/b]<0 to 0. IMO refactoring those functions in functions.cpp does not make any sense when the ultimate aim is to conform with Ruby Sass' no-throw clamping behavior.\n. > I have refactored the colour functions in #1449.\n:+1: \n\n@am11 should https://github.com/sass/libsass/pull/1446/files#diff-3f8f7ba253c6298d2c1de8bfdd63c389R53 also be updated to  free ?\n\nSort answer: No\nLong version: in theory (well and in my understanding):\n- If memory was allocated (in C-style) malloc'd in ctor, then it should be free() in dtor.\n- If the memory was new'd then we have the C++ reference tracking and delete would work.\n- In case there is a chance of ctor-went-wrong-after-successful-memory-allocation-with new (for instance some exception was thrown including bad_alloc (which can be avoided by C++11's new-with-nothrow)), then one should have a custom operator delete implementation (like we have) which should finalize with free().\nOther than this, I think the MemoryManager implementation is pretty solid IMO! (well until some other creepy bug showed up on the radar :smile:)\n. > Not only on some crazy constructor failure\n@saper, have you tested it before commenting?\n. @saper, I really :heart: your inputs, but please see https://github.com/sass/libsass/pull/1450#issuecomment-131819583.\n. It is not the Windows-only issue. It was one a genuine hidden bug which gets hidden again by https://github.com/sass/libsass/pull/1449 and will emerge in some other form. The only time our/custom delete operator is called is when object construction was choking.\nI was able to repro it with clang 3.6 on Ubuntu. YMMV..\n. > From what I see this  destroy()  method gets never called normally.\nYup I think so too and when it is called, the process is already in some kind of disorient state.\n. @saper, maybe my knowledge about C/C++ memory management is not as good as yours as you seems to be pretty sure about it, but let me know if you find out anything interesting because I for one won't make big claims before being absolutely sure and especially before testing the situation at hand..\n. @xzyfer, with this change, Color ctor does not throw either. :)\n. @xzyfer, I have amended the commit. PTAL. \n. Thanks! This is much better than mine. :smile: :+1: \n. @xzyfer, why is this reverted?\n. IMO that was the right fix as I spent quite much time debugging sass-spec suite tests with this change. But your call :)\n. @mgreter, separately; can we replace #ifdef DEBUG with standard C #ifndef NDEBUG postprocessor directive, so we can get libsass debug info with MSVC as well?\n. > So file.cpp is the only one that needs it?\nYes; <windows> header is required in file.cpp for path resolution etc.\n. > Taking your word for it :)\nFingers crossed! :ok_hand: :v: \n. Thanks for the info @mgreter! :+1:\nI have updated the wiki with a short note on error codes: https://github.com/sass/libsass/wiki/API-Documentation#error-codes.\n. Yeah I remember the point of c99func.c. However, the point of this PR is to save every downstream from checking the condition to be able to build with both VS2013 and VS2015. See https://github.com/am11/node-sass/blob/request-ci-artifacts/src/libsass.gyp#L82-L84, there is no decent condition to check MSC_VER there and this approach saved me sometime and hopefully will save others' as well.\n. I found this guy trying to figure out a way to detect toolset version in gyp: http://stackoverflow.com/q/26311665/863980 (received no answer). \nThen tested with VS2013 (on AppVeyor) and VS2015 (both locally and on AppVeyor) with this change, there is no linker error so far; compilation succeeds (only some tests are failing atm).\n. Yup c99func gets excluded from VS2015, when ps: $env:GYP_MSVS_VERSION=2015. Nicely done! \nBTW, AppVeyor is also building with VS2015, but the file pangyp was emitting VS2013 proj files, with c99func. I have sent a PR on your fork.\n. Congrats! :tada: \n. I can confirm that it fixes the node-sass tests issue. Thank you @mgreter! :+1: \n. With:\nsass\ndiv {\n  height: 10px;\nI am still getting:\nbash\nError: Invalid CSS after \"\": expected \"}\", was \"\"\nWith Ruby Sass, it produces:\nbash\nInvalid CSS after \"  height: 10px;\": expected \"}\", was \"\"\n(tested both with LF and CRLF on win)\n. Thanks! This seems to be fixed with 8861bc1.\n\nOn a slightly related note, with ruby-sass the exception message reads as follow:\nbash\nvagrant@trusty64:~$ ruby -v\nruby 2.2.3p173 (2015-08-18 revision 51636) [x86_64-linux-gnu]\nvagrant@trusty64:~$ sass -v\nSass 3.4.18 (Selective Steve)\nvagrant@trusty64:~$ cat blah.scss\ndiv {\n  height: 10px;\nvagrant@trusty64:~$ sass blah.scss\nError: Invalid CSS after \"  height: 10px;\": expected \"}\", was \"\"\n        on line 3 of blah.scss\n  Use --trace for backtrace.\nwithout ... part. Is it something which will be changed in libsass at some point?\n\nEdit: was testing against wrong branch, there is no ellipsis mark (...): Fixed! :)\n\nRegarding testing errors and other special / internal features of libsass, as per https://github.com/sass/sassc/issues/90, in my humble opinion, we should invest effort only once and get rid of the Ruby dependency in favour of C++ testing framework. I will try to prototype salient aspects of testing in C++ using some slim framework (whichever is trending in other repos on GitHub) pretty :soon: (will roll up my selves on coming weekend), in effort to make it a drop-in replacement for ruby test runner for sass-spec (like we have in node-sass). IMO, first three points to focus on would be:\n- Running spec tests (keeping it TODOs and non-TODOs aware).\n- Generating lcov compatible report for coverage.\n- Using proper exception detection semantics, to test the error messages against the hardcoded ones.\nOn top of that, we can build infrastructure for source-map, memory management and performance tests etc. in a long run. :)\nI realize that this is a lot of work and there is risk of things getting more delayed to develop the robust replacement, but IMVHO, there will be even more tech debt we would have to pay otherwise. \n. Considering the intent is to keep Sass-spec repo neutral, independent of any runtime; all the consumers of Sass-spec will have the test tools in their own repos, written in the corresponding runtimes etc. \nFor example, node-sass which conceptually is a secondary consumer if we strictly go by the laws of food-chain, but practically sets an example of using Sass-spec as a fixtures-only submodule.\n. Apparently it is happening with those changes inclusive; as my libsass submodule is pointing to https://github.com/sass/libsass/commit/702ac5aa7079e8b8ab905a307f99840b16cda0d6:\nhttps://github.com/am11/node-sass/tree/request-ci-artifacts/src.\n. @mgreter, also tested with stable release v3.2.5 of libsass and sassc:\n- Extracted https://github.com/sass/libsass/archive/3.2.5.zip\n- Then extracted: https://github.com/sass/sassc/archive/3.2.5.zip inside libsass.\n- Built libsass/sassc/win/sassc.sln.\n- Saved a file \\temp\\test.scss with the following code:\n``` scss\n    .a {\n        color: #000;\n    }\n.b {\n    color: #001;\n}\n\n.c {\n    color: #002;\n}\n\n```\n(tested with both line endings \\r and \\r\\n, there is no difference in the output)\n- Ran libsas/sassc/bin/sassc /temp/test.scss, on stdout I got:\n``` css\n  / line 1, /temp/test.scss /\n  .a {\n    color: #000; }\n/ line 5, /temp/test.scss /\n  .b {\n    color: #001; }\n/ line 9, /temp/test.scss /\n  .c {\n    color: #002; }\n  ```\nWith current master, it is producing:\n``` css\n/ line 1, C:/temp/test.scss /\n.a {\n  color: #000; }\n/ line 3, C:/temp/test.scss /\n.b {\n  color: #001; }\n/ line 7, C:/temp/test.scss /\n.c {\n  color: #002; }\n```\nThe drive letter is present in latest, but line numbers are incorrect.\n. Thanks @mgreter, thanks! I can confirm that #1515 fixed the line number (source comment) issue. :+1: \nThe last failing test is about source-mappings difference: https://travis-ci.org/am11/node-sass/jobs/78265337#L1898-L1916. Could it be due to the improvement in source map since the last release?\n. Thanks @mgreter. We will probably need to update the expected output in node-sass test fixture.\nIn any event, I wanted to run the difference by you before we lock it down. :)\nInput (node-sass/test/fixtures/source-map/index.scss):\n``` scss\nnavbar {\nwidth: 80%;\n  height: 23px;\n}\nnavbar ul {\nlist-style-type: none;\n}\nnavbar li {\nfloat: left;\na {\n    font-weight: bold;\n  }\n}\n```\nCompiled with:\nbash\ncd node-sass\nnode bin/node-sass test/fixtures/source-map/index.scss --source-map=true /test/fixtures/source-map/index.css\nProduces:\n``` css\nnavbar {\nwidth: 80%;\n  height: 23px; }\nnavbar ul {\nlist-style-type: none; }\nnavbar li {\nfloat: left; }\n  #navbar li a {\n    font-weight: bold; }\n/# sourceMappingURL=index.css.map /\n```\nnode-sass 3.3.2 (=> libsass 3.2.5) decompiled mappings on left and that produced with your branch bugfix/ruleset-line-reporting on the right, this diff is produced: http://www.mergely.com/57gV3nMs/\n. Wow, The inspector is super helpful! :100: \nConfirm that both the outputs are accurate and we will only need to update the node-sass test after libsass v3.3 is shipped.\n. I can confirm that this fixes the line-number issue described in #1513. :+1: \nThank you @mgreter! :shipit: \n. I have tested with your branch. It seems like even prior to this delta, some parts of #885 were addressed with previous improvements in source-map and file related PRs.\nWith this PR, AFAICT, all the concerns are addressed and the feature is much resilient than it used to be.\nThanks @mgreter for doing this. Your sourcemap library is precious! :sunglasses: \n. There is probably one related edge case as @chriseppstein described in https://github.com/sass/sass/pull/1819:\nscss\na {\n  b: (29 / 7 * 7) == 29;\n}\nshould produce:\ncss\na {\n  b: true; }  /* at present, it generates b: false */\nReminds me of: https://isocpp.org/wiki/faq/newbie#floating-point-arith2  :)\n. Thanks! a45d5c0 fixed the aforementioned edge case for equality. :+1: \n. I can confirm that with this change, the output is consistent with Ruby-Sass output for the issue described in #1171.\nHowever, the out-of-range error message from R-Sass reads like:\n\nList index is -4 but list is only 3 items long for `nth'\n\nWhile LibSass says:\n\nError: index out of bounds for nth($list, $n)\n. :+1: \n. :+1: \n. > To have more white-box testing of the C++ code? Is Criterion suitable for this?\n\nYes it is possible with Criterion.\nI am interested in getting the checklist done and get answers to the questions I raised above; which lie within the scope of this PR.\nFor the other aspects, like why ruby-runner is not a viable option for libsass moving forward, lets keep it to the related threads: https://github.com/sass/sass-spec/issues/136 & sass/sassc#90.\n. Thanks @xzyfer! \n:+1: to the idea of bringing consistency among the down-streams.\n. TL;DR: With this magnitude of change if the VS2013 support is alive, that is excellent. On a more general note, VS2013 support is a good candidate to be deprecated at some point.\n\nStory:\nThe vast majority of ISO C99 standard is finally supported in VS2015 as well as many C++11,14 and 17 features were implemented, which were not available in previous versions.\nThey have also made standalone built tools available https://github.com/nodejs/node-gyp/issues/629#issuecomment-153196245 (so people don't have to download and install the whole VS to compile C/C++ especially in the upcoming windows dockers use-cases), and we have AppVeyor already supporting VS2015. VC guys have specifically tested node-sass with VS2015. :smile: \nTherefore, I see no point of keeping support for older version of VS moving forward. IMO, if it ever comes to point again where some additional code is required for _MSC_VER < 1900, we should drop old VC compiler support without hesitation and daringly consume C99 and the new language features of C++.\nConsidering:\n- We already are putting too much effort to provide Windows binaries for 7+ module versions x 2 architectures. Many other npm packages with native modules are not even providing a single prebuild binary, but 100% relying on install-time compilation.\n- In case of node-sass, install-time compilation is a fallback; if the npm install node-sass failed to fetch the binary.\n- On Windows, many node-sass users don't have VS and or Python installed and they rely on prebuild binaries.\nSo in saying \"Instead of VS2013+ AND Python27, we are changing our Windows prerequisite policy for building node-sass to VS2015+ AND Python27\" might not even break 1% of existing node-sass consumers on Windows.\n. One nit, otherwise LGTM. Thanks for updating the targets file! :)\n. @mgreter, unfortunately <codecvt> header is not supported by GCC, thus getting it right with VS and Clang are the only options on Windows with this code. I have kept the old (broken) behavior for MinGW. In future, we can add fallback for std::wstring to std::string loss-less conversion to correct this behavior for MinGW.\nEdit: MinGW CI jobs were failing for 7ad7150.\n. Added the fallback for mingw, now it is fixed for both compilers.\n. Thanks @xzyfer, sure I will prepare a test case for spec repo tonight. =)\n. @xzyfer, to test this scenario, once https://github.com/sass/sass-spec/pull/640 is merged, we can add the following lines after https://github.com/sass/libsass/blob/73d5143/appveyor.yml#L70:\nyml\n      cd sass-spec/spec/libsass/S\u00e1ss-U\u0162F8/\n      $env:TargetPath ./input.scss\n(scenario is: when cwd path has Cyrillic characters)\nWithout this, https://github.com/sass/sass-spec/pull/640 will only be testing https://github.com/sass/sassc/pull/156 (that scenario is: when argv[] / input path has Cyrillic characters).\n. As for the coverage, sine the code paths are mutually exclusive (#ifdef out for mingw/msvc), this change has no effect as it will run every time with or without appveyor.yml change.\n. @xzyfer, done! :shipit: :dart: \n. I think TargetPath was just a random name which happens to collide with some MSBuild reserved variable name.\nSince Sassc's vcxproj has the OutDir set correctly to the desired path: https://github.com/sass/sassc/blob/363090a/win/sassc.vcxproj#L58-L64, perhaps we can just rename TargetPath to SasscPath throughout libsass/appveyor.yml to avoid this warning.\n. Perhaps Windows should be detected with:\n``` makefile\n// source: http://stackoverflow.com/a/12099167/863980\nifeq ($(OS),Windows_NT)\n// Windows\nelse\n// Unix\nend\n``\n. Same typo is present indocs/api-context-internal.mdandsrc/sass_context.hpp`.\n. > Coverage increased (+75.009%) to 77.311% \n:rocket:\n. @xzyfer, I was testing this and found another issue here. In the given example, adding a space after test url and before (foo.svg) aborts with SIGSEGV. Note that in Ruby Sass, it stamps out the portion after @svg-load and (foo.svg) as is even with compressed style.\n``` scss\n   @svg-load     test    url   blah      (foo.svg)     {\n  fill: red;\n}\n.foo {\n  background: svg-inline(test);\n}\n```\nOutput:\n``` sh\n[18:45 $ sass ~/Documents/sass/1812.scss  --style=compressed\n@svg-load test    url   blah      (foo.svg){fill:red}.foo{background:svg-inline(test)}\nand sassc SIGSEGVs. I reduced it down to space between last part of name and (\neven with 3-part name, libsass compiles if we don't have space.\nsassc ~/Documents/sass/1812.scss  --style=compressed # without space between blah and (\n@svg-load test urlblah(foo.svg){fill:red}.foo{background:svg-inline(test)}\nlast two parts of custom at-rule's name are joined\n```\n(RubySass behaviour makes sense in expanded and nested but not very efficient for compressed output IMO)\n. //cc @xzyfer =)\n. Good point. Since we don't have .gitattributes in sass-spec (which usually enforces the repo-wide linefeed rules), we can probably save https://github.com/sass/sass-spec/blob/65d2f5f/spec/libsass-closed-issues/issue_1096/input.scss in notepad (with CRLF ending), then run it once without this commit to make the error visible on AppVeyor.\n. @xzyfer, if you commit from Linux and OSX, it will not affect CRLF endings. I have just committed https://github.com/sass/sass-spec/pull/664 from OSX.\n. @xzyfer, needed to expose sass_strdup to API surface for P/Invoke stuff, where string allocated in dotnet is passed to libsass works fine until libsass tries to free() it. I have encountered this issue with source_string in case of Sass_Data_Context. \nMade it a general purpose API function for making C strings, considering it might be reused when implementing the custom function, custom importers, (experimental) custom headers etc. In C# code now I have three cases covered to deal with strings (this PR helps in Case 2):\n``` c#\nif (string.IsNullOrEmpty(sassOptions.Data))\n{\n    Sass.InternalContextPtr = sass_make_file_context(sassOptions.InputFile);\n    // Case 1: dotnet string passed as is to CRT via interop services.\n    // this works just fine because InputFile was allocated by dotnet and will be \n    // deallocated by dotnet GC. libsass will duplicate it and deallocate the clone on\n    // freeing the context.\n    // libsass uses IMPLEMENT_SASS_OPTION_STRING_ACCESSOR macro for\n    // setting input_file option.\n}\nelse\n{\n    Sass.InternalContextPtr = sass_make_data_context(sass_make_c_string(sassOptions.Data));\n    // Case 2: libsass will deallocate the string, so libsass should provide a way to create\n    // that string. Note that we, the callers, don't need to store the ptr returned by\n    // sass_make_c_string locally, as libsass will take care of deallocation.\n}\nSass.InternalOptionsPtr = sass_context_get_options(Sass.InternalContextPtr);\nSass.InternalIndentPtr = Marshal.StringToCoTaskMemAnsi(sassOptions.Indent);\nsass_option_set_indent(sassOptionsInternalPtr, Sass.InternalIndentPtr);\n// Case 3: dotnet should take care of allocation and deallocation, but\n// since libsass is using IMPLEMENT_SASS_OPTION_ACCESSOR macro for setting this option\n// (as opposed to IMPLEMENT_SASS_OPTION_STRING_ACCESSOR, why?), which\n// does not duplicate the string, we have to reallocate memory on process heap and then call\n// Marshal.FreeCoTaskMem(Sass.InternalIndentPtr); in C# class dtor (IDisposable's\n// Dispose()).\n```\n(based on the comment about Case 3, should we switch usages of IMPLEMENT_SASS_OPTION_ACESSOR macro with IMPLEMENT_SASS_OPTION_STRING_ACCESSOR for all stringly options?)\nThe non-generic alternative of this change is to add an overload of sass_make_data_context, which accepts Sass_Value(as we have maker for Sass_Value already on API surface area).\n. @mgreter, changed the function name, I agree that sass_copy_c_string sounds more appropriate. =)\n. @mgreter, sass_copy_c_string is only for sass_make_data_context case. I think sass_copy_c_string name is the confusion, which begs the counterpart sass_free_c_string.\nShould I instead add a bool clone parameter to sass_make_data_context and strdup the source_string if clone is true? Note that in this case libsass is taking the ownership of this string and freeing it on deleting the context.\nEdit: sure will split it into two PRs. Not sure why Travis CI is failing those tests.\n. I have added the sass_free_c_string to complete the pair. \nAgree that reference counting will handle these situations robustly library-wide. IMO, at the moment, source_string is the only odd case where libsass is mixing the concerns. IMO, the usual two cases are:\na) Caller allocates the memory, caller passes to lib, lib uses it, caller deallocates the memory after some function (like compile context) returns.\nb) Caller allocates the memory, lib copies it (strdup), caller deallocates the memory, concerns are separated, so lib de-allocates the cloned copy without caring about consumer.\nHowever, in case of sass_make_data_context, caller allocates the memory and pass it to sass_make_data_context as source_string, libsass does not clone it but assign the ptr as is and later deallocates it after the compilation. So if the caller is a managed runtime (like .NET), the caller will have to somehow tell the garbage collector (usually running as a separate thread or service) to shut its eye on that chunk of memory (i.e. memory pinning), which is bit of extra hassle to manage.\nGiven this situation, should we make sass_make_data_context's behaviour fit into a or b described above? =)\n. As per the discussion, i have made the alternative version for this where caller can tell libsass to clone the source string memory via a boolean flag, and therefore would not be obliged to keep the memory alive: https://github.com/am11/libsass/commit/f076061efaa0a130f8d3d1ae5e1f07b5f3a50a66.\n. :+1: \nIn order to make memory lifecycles independent:\n- All the memory passed to libsass should be copied. \n- After compilation, when the consumer is done extracting out the results, consumer must call sass_delete_context which would delete all the constituents of context (and those of intermediary context aka: cpp_context); until that time, libsass will not free the memory.\n. @mgreter, sure, alright. I will figure out some other way to handle my use case.\n. @drewwells, there are two topics in this thread:\n- the error_source is holding garbage after compilation (prematurely disposing). @mgreter said that will be fixed separately by re-ensuring the lifecycle of every exportable object. To my knowledge, rest of the objects do not have this problem.\n- this PR is mainly about providing a way for external process to allocate char* memory on libsass process heap, which will help in make_data_context's input string argument; when an external runtime calls the lib via FFI. To my knowledge none of the down streams at this point are consuming libsass directly via FFI, but interfacing it via a C++ wrapper (which statically compiles libsass). For example, we can try Ruby-FFI or lua-ffi and get into the same situation (at least on Windows) where I am at with .NET P/Invoke. Note that with libsass-net, we already have the C++/CLS wrapper which is again a C++ wrapper around libsass, not calling libsass via FFI. The hip way is to get it working via P/Invoke, essentially for CoreCLR and Mono targets support (for Linux, OSX and BSD support). With that being said, I have few other options (in case this PR does get rejected :blush:):\n  - On Windows, P/Invoke kernel32's VirtualAllocEx function (or file-memory mapping, or named pipes) to allocate string on libsass heap for libsass itself, so libsass can destroy the memory which belongs to its heap without getting AccessVoilation and likes. On Unix, if the parent/child processes have the same restrictions pertaining to memory access as Windows (one allocates memory on its own heap and pass to the pointer to other, and when other tries to free it, the process horks), I will p/invoke suitable libc functions to inject heap memory for each operating system.\n  - Keep this patch in fork and point submodule accordingly. This will keep the libsass-net code clean and portable.\n  - (are there other options? please feel free to enlighten me ..)\n. :+1: \n. Thanks! :+1: :tada: \n. I am setting it like this: https://github.com/am11/libsass-net/blob/72dde69/src/SafeSassContextHandle.cs#L182-L188.\nI also debugged the code around include_path[s] and found that sass_option_push_include_path does get called from different code paths, but strings inserted into linked list before compile() are ignored during the compilation. It seems like options->include_paths and context->include_paths are redundant and the one in options is not copied in context ctor (and hence remain unused).\nIf possible, can we unify both and have one include_paths linked list (which gets flattened as array later as well; i.e. another overhead)?\n. On R6010:\nIf we want to handle this in libsass, we would probably need to prevent the default std::terminate followed by abort (for example when application tries to write to memory outside its address space) by exception handling.\nIf we want to handle this in sassc, the C way, we would probably need to do error handling for Signals; we will catch SIGABRT as described under Example section of this article. However, literature-wise this article precedes the previous one.\n. :+1: \n. @mgreter, as a general practice, is the idea to handle exceptions in the LibSass for users and sanitize all the exceptions as compiler errors/warnings (for consistent experience)? It is probably a good idea to streamline exceptions in trans-compiler scenarios such as libsass. (however, this goes against the \"principle of avoiding too much defensive programming\" though.. :smile:).\n\nI actually wasn't able to include the statements I added in sassc directly into libsass\n\nFrom C++ side, if _set_error_mode has no effect, we can try to suppress the dialog with SetErrorMode:\nc++\nSetErrorMode(SEM_FAILCRITICALERRORS | SEM_NOGPFAULTERRORBOX);\n_set_abort_behavior( 0, _WRITE_ABORT_MSG);\n. @xzyfer, I remember chatting about it with @mgreter on Slack that while include_path a string is functional, include_paths (plural) string array is not and has no affect on the output. By it looks, this change fixes that issue (I haven't tested it).\n. LGTM - Thanks @mgreter ! \ud83c\udf89 \n. @mgreter,\n\nAdds the following new C-API functions:\n\u2022 void* sass_alloc_memory(size_t size) \n\u2022 char* sass_copy_c_string(const char* str) \n\u2022 void sass_free_memory(void* ptr) \n\ncan we ADDAPIfy these three signatures as well, so they are visible for FFI (P/Invoke)? Currently dumpbin /exports libsass.dll does not list them.\nAt the moment I am using local patch to make it work:\ndiff\n // to allocate buffer to be filled\n-void* sass_alloc_memory(size_t size);\n+ADDAPI void* ADDCALL sass_alloc_memory(size_t size);\n // to allocate a buffer from existing string\n-char* sass_copy_c_string(const char* str);\n+ADDAPI char* ADDCALL sass_copy_c_string(const char* str);\n // to free overtaken memory when done\n-void sass_free_memory(void* ptr);\n+ADDAPI void ADDCALL sass_free_memory(void* ptr);\n. Does renaming TargetPath to SasscPath fix the warning? (i.e. without defining extra variables)\n. cc @mgreter \n. > msbuild win/libsass.sln\nIf you are sure that this MSBuild in PATH corresponds to version of VS you have installed (i.e. by running msbuild /version), then this command is sufficient to build LibSass in Debug configuration. Passing /p:Configuration=Release to the command will build the shared lib in Release configuration. You can also try by invoking MSBuild with absolute path as per the build doc: https://github.com/sass/libsass/blob/master/docs/build-with-visual-studio.md#from-powershell\nIf you are still having the same issue, then Google returns a following workaround for error code, TRK0005:\nhttps://blogs.msdn.microsoft.com/deva/2015/03/24/after-migration-vs-2013-c-project-throws-error-trk0005-failed-to-locate-cl-exe-the-system-cannot-find-the-file-specified/\nBTW, for the local build box to test out windows status etc.; if you don't want VS, you can just have Build Tools for VC installed to compile C/C++ projects strictly via command line -- with absolutely no glorious GUI: http://landinghub.visualstudio.com/visual-cpp-build-tools\n. Hello, regarding the side note: I think that code was meant for MinGW/Cygwin Makefile support and @mgreter can probably confirm it. nmake Makefile is a different entity and is most probably still shipped just to support the ancient projects. MSBuild was introduced as a \"modern\" build system, therefore we put effort to support that XML format.\nWe can probably switch to CMake at some point to encapsulate the underlying build systems. However, a handwritten Makefile and vcxproj files was preferred initially, but if it is causing effort for downstream consumers, we should look into CMake. @mgreter has put some major effort in the build system area.\nI am on vacation and refraining myself to go near computers for six more days.. but yet here we are! \ud83d\ude04 I will try to catch-up with sprockets development and contribute. I used this gem back in the days with Rails 2x and glad to see it still standing tall. Thanks for your efforts @schneems! \ud83d\udc4d \n. @schneems, I just found DevKit documentation: http://github.com/oneclick/rubyinstaller/wiki/Development-Kit and the fact that it is based on MinGW. \nI then installed Ruby 2.3.0 and DevKit on my local VM, then added C:\\tools\\ruby23\\devkit\\bin and C:\\tools\\ruby23\\devkit\\mingw\\bin in PATH.\nAfter that, I applied the following diff on top of https://github.com/schneems/sassc-ruby/commit/85ed6730341c18b9e700a6e717be84461389fdc4:\n``` diff\ndiff --git a/lib/sassc/native.rb b/lib/sassc/native.rb\nindex 261daba..b52b0c2 100644\n--- a/lib/sassc/native.rb\n+++ b/lib/sassc/native.rb\n@@ -6,12 +6,7 @@ module SassC\n spec = Gem.loaded_specs[\"sassc\"]\n gem_root = spec.gem_dir\n\n\nif RUBY_PLATFORM =~ /mswin|mingw/\nlibsass_path = \"#{gem_root}/ext/libsass/win/bin/libsass.dll\"\nelse\nlibsass_path = \"#{gem_root}/ext/libsass/lib/libsass.so\"\nend\nffi_lib libsass_path\n\nffi_lib \"#{gem_root}/ext/libsass/lib/libsass.so\"\nrequire_relative \"native/sass_value\"\n\n\ndiff --git a/lib/tasks/libsass.rb b/lib/tasks/libsass.rb\nindex 3542d8f..e439820 100644\n--- a/lib/tasks/libsass.rb\n+++ b/lib/tasks/libsass.rb\n@@ -20,7 +20,7 @@ namespace :libsass do\n     make_program = ENV['MAKE']\n     make_program ||= case RUBY_PLATFORM\n                      when /mswin|mingw/\n-                       'msbuild /m:4 /p:Configuration=Release win/libsass.sln'\n+                       'make lib/libsass.so'\n                      when /(bsd|solaris)/\n                        'gmake lib/libsass.so'\n                      else\n```\nWhen I executed $CC=\"gcc\" ; bundle exec rake test in PowerShell on Windows 10 x64, it passed:\n``` powershell\nRun options: --seed 1950\nRunning:\n*****S****\nFabulous run in 0.174091s, 333.1591 runs/s, 539.9475 assertions/s.\n58 runs, 94 assertions, 0 failures, 0 errors, 1 skips\n```\nI think your AppVeyor script would not need any alteration. Maybe you would need to add CC like this:\nyml\nenvironment:\n  global:\n    CC: gcc\n  matrix:\n  ..\n. With Debug flag, compiler adds additional debug info to the generated program database (PDB) file (like source-map) containing all the symbols and their line/column infos etc. for source to source mapping (mach-code -> C[++] in this case).\nSome people only generate PDBs in Debug Configuration and disable it for Release Configuration. But mostly it is considered a good practice to have it generated for all configurations.\nIf disabling fixes this issue, we can unset it in vcxproj file (GenerateDebugInformation under 'Release|Win32' condition). Although, it might hide the real issue either in compiler codegen or in our codebase, which will eventually crop up somewhere else IMO.\n. @mgreter, I am all in for release-only builds. My point was merely this; if possible, we should make steps to repro and report the compiler bug upstream during the process of patching it the hacky whacky way. This way we will have a better/definite closure and some link to track this bug by. Generally speaking, sometimes during the process of separating out the steps to repro we rather find the bug in our code but this seems very unlikely in this case. :). I have found the reason why this is happening. The issue is that somewhere in VCBlog or VS2015 release notes (RTM: https://www.visualstudio.com/en-us/news/releasenotes/vs2015-rtm-vs#visualc also see Update 1, 2 and/or update 3 in left-hand nav), there was a detail on breaking changes/improvement in switches they made which causes some non-msbuild build systems pain bit more to figure out, unless we adapt to the new recommendations.\nFor example in your test.bat @asottile, if you replace /Ox /O2 with just /O1 for both *.c and *.cpp cl-commands, the issue disappears. I am not 100% sure if /O1 is the right switch, but here is how I figured it out:\n\nI read about the breaking changes in VC with VS2015 last year and vaguely remembered what those were, so I carried on with my doubt that everything that's not working after upgrading to VS2015 is not necessarily a compiler bug nor result of ABI incompatibility etc. VCRT in VS2015 till date supports Windows XP. :)\nDownloaded libsass master zip in c:\\temp and ran msbuild /v:diag libsass/win/libsass.sln > dump.txt (msbuild in diagnostics mode).\nOpened dump.txt and searched for cl.exe and found these lines:\n\n\nC:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\bin\\CL.exe /c /I..\\include /ZI /nologo /W3 /WX- /Od /Oy- /D WIN32 /D _DEBUG /D _CONSOLE /D _LIB /D ADD_EXPORTS /D \"LIBSASS_VERSION=\\\"\\\"\" /Gm /EHsc /RTC1 /MDd /GS /fp:precise /Zc:wchar_t /Zc:forScope /Zc:inline /Fo\"C:\\temp\\test2\\libsass-master\\win\\bin\\Debug\\obj\\\" /Fd\"C:\\temp\\test2\\libsass-master\\win\\bin\\Debug\\obj\\vc140.pdb\" /Gd /TC /analyze- /errorReport:queue ..\\src\\cencode.c (TaskId:25)\nC:\\Program Files (x86)\\MSBuild\\14.0\\bin\\Tracker.exe /d \"C:\\Program Files (x86)\\MSBuild\\14.0\\bin\\FileTracker32.dll\" /i C:\\temp\\test2\\libsass-master\\win\\bin\\Debug\\obj\\libsass.tlog /r C:\\TEMP\\TEST2\\LIBSASS-MASTER\\SRC\\CENCODE.C /b MSBuildConsole_CancelEvent18e324c0cc49415a81195045638026e0  /c \"C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\bin\\CL.exe\"  /c /I..\\include /ZI /nologo /W3 /WX- /Od /Oy- /D WIN32 /D _DEBUG /D _CONSOLE /D _LIB /D ADD_EXPORTS /D \"LIBSASS_VERSION=\\\"\\\"\" /Gm /EHsc /RTC1 /MDd /GS /fp:precise /Zc:wchar_t /Zc:forScope /Zc:inline /Fo\"C:\\temp\\test2\\libsass-master\\win\\bin\\Debug\\obj\\\" /Fd\"C:\\temp\\test2\\libsass-master\\win\\bin\\Debug\\obj\\vc140.pdb\" /Gd /TC /analyze- /errorReport:queue \n\nNote that project system is not emitting /O1, /O2 or /O3 but rather /Od and negating /Oy. Docs might have more information and warning what combination of these compiler switches may yield false-positives/negatives.\nI am running VS2015 Update 3.\n. Forgot to mention, I also added:\n```xml\n  \n\n\n````\nin win/libsass.vcxproj and replaced <ConfigurationType>DynamicLibrary</ConfigurationType> with <ConfigurationType>Application</ConfigurationType> after creating main.cpp in project root (to test a runnable console app). In debug config build, there were no errors when I ran the application. :). Thanks @mgreter! Glad I could contribute. \ud83c\udf89 Separately, speaking of C++, there is this \ud83c\udd95 Ranges proposal for STL: https://github.com/ericniebler/range-v3, which might be useful (server as source of inspiration) for this project. One downside concerning LibSass is it doesn't support GCC < v4.8.5. :(\nMSFT also forked this project under their org account and made it work in VS2015. Read about it here: https://blogs.msdn.microsoft.com/vcblog/2016/11/16/visual-studio-2017-rc-now-available/.. @xzyfer responded with a PR https://github.com/sass/libsass/pull/2288 \ud83d\ude0e . Nice cleanup! \ud83d\udc4d\nRelated to this, would it be a good idea to have .clang-format rules file like this and make TravisCI do the linting based on the clang-format per PR like these guys are doing? Then in our contribution guide, we can say something this effect:\n\nTo avoid build failures due to code formatting, make sure to run .clang-format before issuing the pull request. On Windows, you can use Clang-Format extension for VS.. @xzyfer, I just mirrored the version numbers. As far as I can tell, the version conventions are not set in stone and there is quite a lot of variety of versions in win32 libs. For instance, instead of four-sequence identifier, we can even use three sequences (semver style).\n\nThe RC file can read from other .h defines. I was thinking, if libtools and resource.rc share common .h file, that would make our life slightly easier. :)\nAlternatively, we can use a bumpversion.sh or extend git command, something like: git sass-tag M.m.p which will update these files, create tag and also create a commit -- exactly how npm version command works.. Rebased the branch against master.. @xzyfer, sorry, I don't intend to hijack the thread as this is slightly off-topic. )\nI have noticed that we have this bounty source footer being rendered incorrectly lately as the plugin inserts the following mark[up/down] at the end of post:\n```html\n\n\nWant to back this issue? Post a bounty on it! We accept bounties via Bountysource.\n\n```\nWhich renders as:\n\n\nWant to back this issue? Post a bounty on it! We accept bounties via Bountysource.\n\n\nIf we add a line feed after the opening tag:\n```html\n\n\nWant to back this issue? Post a bounty on it! We accept bounties via Bountysource.\n\n```\nthat produces the desired result:\n\n\n\nWant to back this issue? Post a bounty on it! We accept bounties via Bountysource.\n. >I don't know who set it up originally.\n\nIt is configured with @hcatlin's account.. > How did you figure this out?\nHover over the edited on first post of any issue to find the username:\n\n. @mgreter FYI. This is great! I actually started prototyping it that day and so far achieved https://gist.github.com/am11/39a65404651f310966d646932c623dd6. I was using clang-format which comes packed with Emscripten (installed few weeks ago; was experimenting WebAssembly version of node-sass with binaryen wasm-sass .. which is at least theoretically very possible goal to achieve \ud83d\ude1c).\nTwo things that I found are:\n\nThe latest version of clang-format (which usually is not available on many Unices OOTB) has most features / options, so the help from google/stackoverflow is bit challenging as we need to concentrate on which version the OP is using\nIt is hard to deduce the LibSass code formatting style, as in some places, we have custom styles .. which is tricky (if not impossible) to configure in clang-format\n\nI like your approach @nschonni to obtain latest, greatest clang-format via npm pipeline. \ud83d\udc4d . @xzyfer, hool! \ud83d\ude3b I will focus on something else then \ud83d\ude1c \n@nschonni, my effort was barely a start of beginning; I was trying to adjust the options so it matches majority of our existing codebase style. I started with ast.cpp, but some styles are challenging to keep, like:\nc++\n    if ((has_ns_ == r.has_ns_) ||\n        (has_ns_ && ns_.empty()) ||\n        (r.has_ns_ && r.ns_.empty())\n    ) {\n      if (ns_.empty() && r.ns() == \"*\") return false;\n      else if (r.ns().empty() && ns() == \"*\") return false;\n      else return ns() == r.ns();\n    }\nWith couple of tweaks, the multiline if-condition was getting flattened and single line if-statement was getting braces but couldn't keep the ditto styles.\nWonder if it is possible for such linters+autoformatters to provide \"auto-detect style\" feature as well (based on the majority of style in code)? Analyze style and emit .clang-format .. that would be a nice feature. . grooooovy! \ud83c\udf61 . Do we want to run it every time or configure it with special trigger (like analyze this)?. Use BUILD=shared like:\n```sh\ngit clone git@github.com:sass/libsass\nBUILD=shared make -C libsass -j5\nstat ./libsass/lib/libsass.so\n```. > No suprise why so few programs (even windows Explorer) fail to implement all this properly ...\nI agree and it is indeed a complex problem to support all kinds of path formats in Windows. Not many applications, including Microsoft's own do not support them all.\nI will quote https://github.com/dotnet/corefx/issues/16094#issuecomment-280105166:\n\nOn Windows should it give back the \"canonical\" volume, which is Guid based \\\\?\\Volume{572FE591-B2EF-4617-AFEC-8DE83A32A7C5}? The same volume can be given any number of aliases. While this seems niche at first I expect it to become more common. There are only 26 possible DOS path drive letters, I can see wanting to use volumes without \"mounting\" them or using something other than A-Z:.\n\nAnother strange-looking path can be of form \\??\\dir1\\dir2 (note how it differs from \\\\?\\...), which is alias to the device aka NT Object name: https://en.wikipedia.org/wiki/Object_Manager_(Windows)#Object_structure. Some applications do support it when reading the registry values.\nThen in PowerShell, ~/ resolves to $HOME/$env:USERPROFILE (note ~/ is legal, but ~\\ is illegal). Also PowerShell can handle \\, / and mixture of these, because at some point these were implemented to make PowerShell POSIX (1.0) complaint. I am not sure if NTFS/Win32 APIs can handle / the same way PowerShell does?\nThus, path normalization can also be a pain, which in our case is required for source-map generation in addition to reading the contents of file.\nIMO, we should confine the scenarios we want to support, and call it out in docs explicitly what are those supported (advanced) UNC path formats on Windows. For example, if this PR is fixing certain scenarios reported by user, without breaking the existing ones, it's probably enough until the next issue is reported. :). Good idea. Fixed by 6383ab63917faf2afabdf8cb9e1107f5df20442d.\n. @mgreter, something like this?\n. Yeah! \"three-way-auto-merging\" did that. And I missed that. Thanks! :)\nIt's fixed by a36f00c.\n. It is appending ; N times (using the (second) overloaded ctor) to result and setting previous_generated_line = generated_line (exactly what while loop was previously doing). \n. CodeStyler: too many semicolons detected .. :stuck_out_tongue_winking_eye: \n. Haha! That goes for all C-style languages I suppose. :smiley: \n. (not sure if its applicable in this scenario)\nmkdir C:\\libsass 2> NUL, redirect stderr to NUL (something analogous to, but not exactly, devnull?).\nSo even if it throws, it will keep continue.\nMore at: http://stackoverflow.com/q/4165387.\n. q is unused, isn't it? :)\n. Oh nice. I was just checking appveyor build: https://ci.appveyor.com/project/sass/libsass/build/1.0.6. Not sure why mingw made it a matter of fatality and terminated tests for such a trivial reason (it should just be a compiler warning). msvc is also choking with unresolved symbol.\n. Oops. TravisCI was passing, I didn't ran tests locally. :p\nThanks for fixing it! :+1: \n. Is this unused?\n. Oh ok. TYT! :+1: \n. This is failing sass/sass-spec#278 on Windows because of \\r\\n. If I convert the endings using dos2unix test/fixtures/spec/spec/libsass-closed-issues/issue_942/input.scss it passes (reverting back with unix2dos .. fails again). But I suppose we don't users to use the dos2unix utility before compilation. :)\n. Yep. It actually prefers escaped strings in the params and values.  :)\nI verified it as follow (please let me know if that is the correct way to verify it):\npowershell\nC:\\users\\adeel\\Source\\Repos\\libsass [master +2 ~0 -0 !]> .\\win\\bin\\Debug\\sassc.exe -v\nsassc: 3.2.5-14-g5c78\nlibsass: 3.1.0-603-gc380\nsass2scss: 1.0.3\n. Actually, it was automagically escaped by VS when I upgraded the project. Seems this is the legit way for executable commands: http://stackoverflow.com/a/2414096/863980 & https://msdn.microsoft.com/en-us/library/ms228186.aspx although > is not one of the special character which requires escaping; going by their chart. :D\n. true! :+1:\n. @xzyfer, I totally agree about the noise. It is just auto-formatting by VS, once we do that it won't get changed in future (just the end of file extra linefeed it omits in some cases, which we should keep for git). With that said, should I revert the extra changes?\n. #if defined(_MSC_VER) && _MSC_VER < 1900 (because it compiles with MinGW and VS2015+ on Windows), and I will move this block before or after #ifdef __MINGW32__ block (see few lines below in this file).\n. Great! Fixed by fb1fcd7.\n. @xzyfer, seems like in some cases, we do need to push_back() the carriage return to quoted string: https://travis-ci.org/sass/libsass/jobs/99452071#L1108.\n. On second though, \\r is a legal character in Unix and Windows. Now I wonder if Ruby Sass is doing the right thing in first place. :bulb: \n. If CSS3 import only accepts network paths, then \\\\r is legal string of length 2. :)\nI have reverted it back to this original code. Now it aligns with Ruby both on Windows and OSX. CI seems to be happy too. :palm_tree: \n. @mgreter, libsass is actually taking ownership of this string and will free it. This is only for data context's data string, which could be a large string. In node-sass binding, we are passing the memory to libsass, which libsass free's as part of sass_delete_data_context.\n. The string passed to sass_copy_c_string will be deallocated by the caller. The cloned string returned by strdup to caller as a char*, which will further passed back to libsass as char* via sass_make_data_context. On deleting the context, libsass frees this string. So everything is freed in the end.\n. Added a free call in 9874428. I think no other down-stream is using it. When we get the syntax error and call sass_context_get_error_src after the compilation (when sass_make_data_context returns to caller), we get garbage back; because libsass deletes cpp_ctx right after compilation. Caught this when debugging.\n. Sure meanwhile I am reverting it back.\n\nDid you check if it's the only property affected by this?\n\nI have made the SassError object on libsass.net which captures everything that libsass API has to offer for errors. During the testing, I made code errors in Sass and hit couple of different exceptions, but this seems to be the only one which was returning garbage.\n. @mgreter, I kept MinGW and MSVC implementations separate here: https://github.com/sass/libsass/blob/e6ac0a2/src/file.cpp#L28-L44 (as GCC hasn't implemented C++11 <codecvt>, so MinGW implementation should make a win32 API call for conversion instead).\nIMO, if this solution works for both, we should probably use the same there. Either way, we should probably refactor this out (here or in util.cpp) and use the function from one place for DRY.\n. Will fix. Thanks.. I think 2015 sln file works with 2013 and 2012, but not the lower ones. Besides, from command line perspective, msbuild adapts to the installed toolchain.\nNow that things are moving fast with the advent of VS Code for windOS and Unices, the previewed full VS for Mac and previewed VS2017, I honestly see no point in sticking with 2013 when we still can provide better support from XP-10 and all related server editions with latest CRT/CPP toolchains (brining dozens of bugfixes in STL and standard conformance). If there is a bug refraining us to moving forward, like any other piece of software, lets report the issue upstream, track it in our repo and keep the dice rolling forward when we are no backward compatibility trade-offs. Officially VC team hasn't even dropped XP support yet (released: 24.04.2001).\nMy \u20ac0.2 :). It seems to be working. I installed editorconfig for VS extension, opened libsass/win/libsass.sln, set indent_size to 12, opened libsass/src/file.cpp and Ctrl+K,D to format the document,  the intended 12 space indentation applied.\nNote starting with VS2017, editorconfig and cmake have built-in support [ref].. ",
    "jimmont": "We were able to resolve this Bus error: 10 by upgrading from node 0.10.20 to 0.10.29.\n. ",
    "richardbutler": "Looks like it - I'm seeing this issue again on Node 0.12.2\n. ",
    "vincentbernat": "If you were using GPLv2 and wanted to relicense to GPLv3, you would need the authorization of all contributors. Or if you wanted to grant a paid commercial license to companies not wanting to be bound by the GPL, you would also need authorization of all contributors. However, since you are using the MIT/Expat license which is compatible with almost all licenses. So, if you wanted to change licensing to GPLv3, you can do it without any copyright assignment (but then, you would need copyright assignment for future contributions). So, for me (but I am not a lawyer), the license is too liberal for the copyright assignment to be of any use.\nMost projects don't use copyright assignment. Some big projects ask for a contributor agreement, but most of the time, this is just to make sure that a contributor is aware that its contribution will be licensed under the same license as the project (see for example the Apache Software Foundation, Mozilla or Google) and the contribution is free of any patent. There is no copyright assignment.\nCanonical changed its contributor agreement from a copyright assignment to a license grant. It created \"Project Harmony\" to avoid the multiplication of different contributor agreements. You could get yours here: http://selector.harmonyagreements.org/\nSome big projects, like the Linux kernel, does not have a copyright assignment. A contributor shows that it understands that his contribution will be GPLv2-licensed by adding a \"Sign-Off\" meta header in its git commit.\nIf you feel that you want to keep the copyright assignment, I would just remove the words that say this is like ASF (because this is not).\n. Fine by me. Thanks for understanding.\n. ",
    "blaise-io": "I'm encountering a similar issue with a different kind of nesting:\n.x { color: red; }\n.y { @extend .x; color: blue; }\n.z { @extend .y; }\nshould compile to:\n.x, .y, .z { color: red; }\n.y, .z { color: blue; }\nbut compiles to:\n.x, .y { color: red; }\n.y, .z { color: blue; }\n. ",
    "opichals": "After transitioning away from the ruby sass implementation I have been hit by this too. Anyone?\n. ",
    "killercup": "I'm still using ruby sass just because of this, too.\n. ",
    "urbaniak": "+1\n. ",
    "gastlich": "+1, @akhleung thanks for working on that!\n. ",
    "crohrer": "+1\n. ",
    "mstrutt": "+1\n. +1\n. ",
    "steveluscher": "Go @akhleung, go!\n. ",
    "bradens": "Looking forward to this!\n. ",
    "carlos22": "This seems to fail inside of a media query. Version: 8a2e0bc\n``` scss\n$myvar: null;\n.mySel {\nfont: $myvar;\n  @media screen {\n    font: $myvar;\n  }\n} \n```\nOutputs\n``` css\n.mySel { }\n  @media screen {\n    .mySel {\n      font: ; } }\n```\n. ",
    "samgiles": "This changes the top level API, I was thinking about it last night and I'd rather not pull this change in just yet because of this fact.  Although do take a look and let me know what your thoughts are. \nCheers\n. ",
    "rowanbeentje": "Note that I'm mostly relying on the tests to guide me on what needs work for now (and comparing to compass output while doing so).  I'll keep working down the tests but if any are wrong just yell :)\n. I got a little confused by this as well - thanks @hcatlin :)  Am I right in thinking everything in old/ could also be deleted?\n. Hmm.  I managed to do that with an old branch not an up-to-date one.  Let's try that again...\n. @nschonni Yeah, this was the very latest master - a side-effect of recent improvements.\n. @hcatlin I'm afraid I was getting this with sassc, not node-sass; tried again with sassc sass/sassc@73f642556dbf64979d74a7a270699f1d8f0019fa and libsass 0d5a942a446b035b80e403d32eca3299480dc5b5 and the great news is the crash is no longer present and sassc seems to output the correct code; the bad news is that at the end of the process sassc outputs:\nUnknown internal error.\n...and exits with a status of 2, rather than 0.\nSo might still need a tweak?\nEasily reproducible with the test case above.\n. (or if it's a problem solely in sassc - oops - should I file there instead?)\n. Well it doesn't crash any more - just gives a cryptic error message and outputs with a failure code. At least it's written out the file by then, but... ;)\n. Oops,  I misread the output. SassC gives:\n[data-foo=\"bar\"].test {\n  margin: 0; }\nnode-sass with libsass3rc1 gives the correct:\n.test[data-foo=\"bar\"] {\n  margin: 0; }\n...and also doesn't error.  So I'll file against SassC instead...\n. ",
    "ingorichter": "Thanks for cleaning this up @akhleung.\n. Yeah, you're right @akhleung. Thanks @hcatlin for cleaning up. I hope he's not too busy cleaning up your desk. You seem to be a funny team. Some of my coworkers complained about my desk, but they never cleaned it up.\n. ",
    "apique": "Found the answer :\nin context.hpp, remove *  line 31:\n  struct Context {\n    Memory_Manager mem;\nin context.cpp, remove * too line 42:\n  Context::Context(Context::Data initializers)\n  : mem(Memory_Manager ()),\nApique\n. ",
    "leafo": "+1, I want to have c function support from sass_interface\n. ",
    "VinSpee": "I AM SO STOKED RIGHT NOW\n\n. ",
    "bountysource-support": "@mgreter don't forget to claim the bounty on this! https://www.bountysource.com/issues/1057273-sass-files-not-supported/claims\n. ",
    "dchest": "Doesn't look related to the reported line, since if I remove these lines: \nhttps://github.com/jlong/sass-bootstrap/blob/0c9ad8f0a09783c18f57e30de499fcf0d0fcff56/lib/_mixins.scss#L698-L712\nit reports the same error on a different line:  mixins:695: error: invalid selector after ,\n. OK, I figured out the code responsible for the error. It's the two mixins:\n``` scss\n@mixin make-grid-columns() {\n  $list: '';\n  @for $i from 1 to $grid-columns {\n    $list: \".col-xs-#{$i}, .col-sm-#{$i}, .col-md-#{$i}, .col-lg-#{$i}, #{$list}\";\n  }\n  $i: $grid-columns;\n  $list: \"#{$list}, .col-xs-#{$i}, .col-sm-#{$i}, .col-md-#{$i}, .col-lg-#{$i}\";\n  #{$list} {\n    position: relative;\n    // Prevent columns from collapsing when empty\n    min-height: 1px;\n    // Inner gutter via padding\n    padding-left:  ($grid-gutter-width / 2);\n    padding-right: ($grid-gutter-width / 2);\n  }\n}\n// [converter] Grid converted to use SASS cycles (LESS uses recursive nested mixin defs not supported by SASS)\n@mixin make-grid-columns-float($class) {\n  $list: '';\n  @for $i from 1 to $grid-columns {\n    $list: \".col-#{$class}-#{$i}, #{$list}\";\n  }\n  $i: $grid-columns;\n  $list: \"#{$list}, .col-#{$class}-#{$i}\";\n  #{$list} {\n    float: left;\n  }\n}\n```\n(https://github.com/jlong/sass-bootstrap/blob/0c9ad8f0a09783c18f57e30de499fcf0d0fcff56/lib/_mixins.scss#L721-L750)\nIf I make them empty, the error goes away.\n. Hah, libsass is actually correct to point out the bug, it just gives the wrong line number.\nSee https://github.com/jlong/sass-bootstrap/pull/119\nThis issue can be closed, I guess.\n. @andrewmartin yes, this was a bug in sass-bootstrap, and it was fully fixed after merging that pull request.\n. ",
    "ain": "I'd suggest creating another ticket on wrong line number reporting. In order to prevent further tickets (incorrectly) flooding in for the project. I'm sure you'd have the exact same ticket on some other framework soon enough\u2026\n. ",
    "timbz": "the ruby code should be in Query::merge()\nhttps://github.com/nex3/sass/blob/stable/lib/sass/media.rb\n. ",
    "JeroenVdb": "Does someone have a (temporarily) workaround for this problem?\n. ",
    "DedRain": "Hi all, any progress with this?\n. ",
    "msikma": "I'm very glad this will be fixed with 3.2, this will make it easy to do e.g. retina-specific code inside code blocks for specific responsive sizes. Hoping the next release is finalized soon, any guesses as to when it'll be ready?\n. Would be very grateful if maps were implemented, since I'm using them in the framework I'm building and am considering switching to libsass. I guess I can try to work around the limitation, but I'd prefer not to.\n. This was a big deal, thanks @xzyfer!\n. ",
    "jbussdieker": "Wouldn't the more appropriate fix be to run ./configure to compensate for portability issues?\n. this is a default file pulling in by automake when a COPYING file doesn't exist. can you send me the license you want?\n. ",
    "maranomynet": "crickets\n. OK, I considered the lack of information about the status of this project relative to the official/reference SASS project, to be a bug.\n:-)\n. ",
    "scottkellum": "@maranomynet Libsass is significantly faster but is a few versions behind on features and only supports the SCSS syntax.\n. Had the same issue and fixed by adding value to make the loop positive: https://github.com/Team-Sass/modular-scale/commit/4c196d59c7c7b866b44144df14f6f57ea6e91d18#diff-f67d0d890183fee4429e55377bc41c5eL31\n. I am using node-sass as well. Looks like just @debug isn\u2019t working. I will update the issue.\n. @akhleung Ah, good catch. Looks like it\u2019s only in 3.3+\n. ",
    "archgrove": "This seems to be to do with the use of an unsigned type (size_t) as the loop index in Expression* Eval::operator()(For* f) (eval.cpp).\n. It does, but I wasn't confident to make a pull-request until I can actually get the entire thing to build properly (having wonderful fun with segfaults in sassc using Apple's clang-500.2.79 when errors are thrown from within Eval::*).\n. I\u2019ll investigate a bit more later, and find a suitable solution. It throws dozens of warnings when compiling, so I need to pick through those. Also need to get the test suite building (sassc\u2019s \u201cmake test\u201d\u2026.doesn\u2019t :).\nI\u2019ll open other issues w.r.t. this when needed.\nadamw\nOn 5 Dec 2013, at 15:59, Aaron Leung notifications@github.com wrote:\n\nOkay, I've changed the variable to a double and pushed the change. As for the segfaults, everything works fine when I use gcc/g++, but it's been a while since I've used a Mac, and I've never tried clang. Do you think the problem is with the compiler?\n\u2014\nReply to this email directly or view it on GitHub.\n. Interesting; this might be the same segfault I\u2019m chasing. It\u2019s proving tricky to track down (the custom memory allocator faults when doing it\u2019s big list of frees). The smallest script I\u2019ve got to reproduce it is:\n\n@function test() {\n}\nbody {\n  name: test();\n}\nadamw\nOn 6 Dec 2013, at 19:02, Aaron Leung notifications@github.com wrote:\n\nOkay, I had to revert the pull request because the binary was segfaulting when compiled with g++ ... some of the changes look inoccuous though, so I'll merge those in piecemeal and try to find the cause of the problem.\n\u2014\nReply to this email directly or view it on GitHub.\n. Actually, with a bit more digging, I can get it to break almost anywhere. Suspecting some heap corruption, but need to move onto my big machine to track it down. Will try in the AM if no-one beats me to it.\n\nadamw\nOn 6 Dec 2013, at 19:02, Aaron Leung notifications@github.com wrote:\n\nOkay, I had to revert the pull request because the binary was segfaulting when compiled with g++ ... some of the changes look inoccuous though, so I'll merge those in piecemeal and try to find the cause of the problem.\n\u2014\nReply to this email directly or view it on GitHub.\n. OK, the super-crashyness was my stupid fault; the new pull request on top of the old should prevent this. Still chasing clang crashes. Feel free to leave it all until I\u2019ve worked it all out.\n\nadamw\nOn 6 Dec 2013, at 19:19, Aaron Leung notifications@github.com wrote:\n\nYeah, my tests were breaking all over the place when I used g++. Anyway, I'm currently tied up with @extend, so I appreciate your looking into this!\n\u2014\nReply to this email directly or view it on GitHub.\n. This request, combined with the application of my previous request, should allow correct compilation on clang. \n\nDetails:\nOK, I tracked down the crasher. There was no corresponding placement delete to match the memory manager's placement new. Therefore, unconstructed objects (due to exceptions thrown in constructors) were being tracked by the memory managers interval vector, but were actually invalid. That this worked in GCC surprises me, but clangs libc++ runtime was most unhappy. I've added the placement delete, which corrects the problem.\nNow, with clang 500.2.79 and gcc 4.7.3, I get clean compilations and identical test suit results, viz:\n\"741 tests found. 70 of them were not run due to unsuccessful termination. Of the 671 that ran, 394 passed.\"\n. ",
    "willsoto": "I am having this issue as well, any suggestions for a temporary fix?\n. For what it's worth, we are using node-sass through the grunt-sass grunt plugin. \nHere is the offending line: background-image: url($iconSpritePath);\nAnd thanks for the tip @mwq27, I will test it tomorrow.\nedit: We just installed it today, so I would imagine it is the most recent version.\n. Just to follow up, @mwq27's fix worked. The temp variable isn't necessary though, simply wrapping the variable in\n#{} is enough it seems.\n. ",
    "mwq27": "I forgot where I saw this solution, but it's working for me:\n//in variables.scss\n$bgimg : '/images/sprite.jpg';\n//in scss\n$tmp : $bgimg;\n.class {\nbackground: url(#{tmp});\n}\nNow I don't know if you have to assign the original variable to a temp one or not.  That's just how I saw the solution.\nI hope this helps.\n. I am also using grunt-sass, if that helps.\n. I've only tried with using a  background image really.  I could try with something else.\n. ",
    "zsitro": "sry for dupe, good luck with it guys!\n. ",
    "saulfautley": "Why this is a thing in the first place I'll never understand... Since when did inconsistent code become a feature?\n. ",
    "Kos": "Looks fixed indeed, thanks!\n. This is a regression; the behaviour was correct in older libsass.. Thanks for checking! I was testing on node-sass master, turns out it didn't use current libsass. I just compiled libsass+sassc myself and I confirm it's fixed.. Thanks for checking! I was testing on node-sass master, turns out it didn't use current libsass. I just compiled libsass+sassc myself and I confirm it's fixed.. ",
    "aedenj": "Does this issue address the situation when the file ends .css? I'm using the most current version of node-sass and when I use the @import statement with .css files I get the following\n500 source string:2: error: file to import not found or unreadable: \"Justified-Gallery/css/jquery.justifiedgallery\"\nHowever when I change the extension to .scss the import is succesful.\n. ",
    "dpashkevich": "Would be great to have this option, although I agree that it breaks live editing of the real files from CDT\n. ",
    "whatisjasongoldstein": "Ah. I'd been using the Python libsass (https://github.com/dahlia/libsass-python).\nI ran it my snippet with sassc and it worked.\nThanks.\n. ",
    "tregagnon": "After more testing, it seems every values that can be changed to a named color value are replaced by libsass\nWith this code\nscss\n.test {\n  color: gray;\n}\n.test1 {\n  color: grey;\n}\n.test2 {\n  color: #808080;\n}\nSass outputs\ncss\n.test {\n  color: gray; }\n.test1 {\n  color: grey; }\n.test2 {\n  color: #808080; }\nbut libsass outputs\ncss\n.test {\n  color: gray; }\n.test1 {\n  color: grey; }\n.test2 {\n  color: grey; }\n. @mgreter Thanks for your test. This would mean the problem comes from the node-sass implementation? They call an outdated version of libsass? \nI will try to pull their last commits to test, but for now, their Travis reports build errors.\nI didn't catch the subtle difference in behaviour with LightGr[ea]y. But it is written in the MSDN document I linked in the first post: http://msdn.microsoft.com/en-us/library/ie/aa358802%28v=vs.85%29.aspx\n. I no longer have this problem since libsass has been updated in node-sass.\n. ",
    "HugoGiraudel": "We should add a spec for this.\n. We probably should add a spec for this, shouldn't we?\n. All tests for @at-root are now written, including nifty ones. If we need more, I'll add more. Some of them still need to be merged though (https://github.com/sass/sass-spec/pull/217).\n. Note: LibSass only chokes with this str-slice test. All other tests for str-slice including special characters pass. All other tests about Sass string functions including special characters pass. Only this one fails.\n. Adding to the discussion: appending a unit as a string is a very poor way of converting a unitless number to a length since it results in having a string instead of a number, preventing any further calculation.\n. compact has never been part of Ruby Sass. It is an old function from Compass thus has nothing to do in LibSass in my opinion.\n. Added a spec: https://github.com/sass/sass-spec/pull/169.\n. Do you have any hint about when LibSass happens to behave like this?\n. This is actually an intended behaviour from Sass. As far as I know, to speed up compilation times Sass does not evaluate all CSS values. It does some kind of quick match to see whether a value should be evaluated as SassScript or not.\nWhile this behaviour leads to an issue where you can actually output prop: null if you explicitly write null as a CSS value, this scenario is very unlikely. \nAnyway, this explains the need for a function. If you want to avoid having to declare a function/mixin for this, you can simply wrap null in braces to force Sass to evaluate it:\ncss\nfoo {\n  bar: (null);\n}\n. css\ntest {\n  deg_grad: 42deg + 42grad;\n  deg_rad: 42deg + 42rad;\n  deg_turn: 42deg + 1turn;\n  grad_rad: 42grad + 42rad;\n  grad_turn: 42grad + 1turn;\n  rad_turn: 42rad + 1turn;\n}\nExpected: \ncss\ntest {\n  deg_grad: 79.8deg;\n  deg_rad: 2448.42274deg;\n  deg_turn: 402deg;\n  grad_rad: 2715.80304grad;\n  grad_turn: 442grad;\n  rad_turn: 48.28319rad;\n}\nResult:\nstdin:2: cannot add or subtract numbers with incompatible units\nFormula:\n1turn == 360deg == 400grad ~= 2\u03c0rad\n. You guys are really quick. Thank you very much. :)\n. Possibly related: https://github.com/sass/libsass/issues/615.\n. I shall add some extra information to this: it only concerns the 55 or so\ntests ran by Sass-compatibility, not the whole suite from Sass-spec.\nAlso, some features from 3.1 are not yet merged thus unavailable for me to\ntest. I suspect the support to be around 70-75% or so.\nThen among missing features, we have:\n- & in SassScript;\n- selector manipulation functions;\n- deep @extend;\n- nested interpolations;\n- variable scoping.\n. Alright. There are two things I cannot test because I am relying on SassMeister backend for this:\n- output style (I think, @xzyfer, you told me that LibSass does not support expanded);\n- sourcemaps.\nAny incompatibility regarding those two topics are invisible to me.\n. Congratulations, it looks gorgeous! :)\n. Spec added: https://github.com/sass/sass-spec/pull/168.\n. What is the status on this? Do you need me to write a spec?\n. Maintainers, what is the current status on this?\n. Sass Compatibility has no \"get it right\" or \"get it wrong\". It has support or no support.\n. I could add a note about how LibSass gets it wrong in the description if you will but I won't be able to do much more. Sass Compatibility intends to list inconsistencies between Sass engines. It is an inconsistency, no matter if both are not supporting what you deem is right.\n. >  The feature should be \"forbids @extend in @media\" and Sass should have it checked and libsass should not have it checked.\nThat seems reasonable.\n\nwe could data-drive it from sass-spec\n\nIt already is, except for the few tests that do not exist on sass-spec. I have been working with @xzyfer on this for several weeks now. As a result, I have written a lot of extra tests for sass-spec. :)\n. Hardly the place for it I suppose. Where should I reach you Chris?\n. LibSass does support a buggy version of it, hence should not be used.\n. There: https://github.com/sass/sass-spec/pull/261.\n. I was myself just encountering an issue where @charset \"UTF-8\" does not get printed, even if explicitly asked for it.\nShall I open another issue?\n. Test:\n``` scss\n@charset \"UTF-8\";\ntest {\n  content: \"\u00f8\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\u00f1\u00bf\u00e9\u00e0\u0164\u01c5\u01c2\u024a\u0271\u02ad\u02ac\u046a\u0488\u0753\";\n}\n```\nExpected:\n``` css\n@charset \"UTF-8\";\ntest {\n  content: \"\u00f8\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\u00f1\u00bf\u00e9\u00e0\u0164\u01c5\u01c2\u024a\u0271\u02ad\u02ac\u046a\u0488\u0753\"; }\n```\nResult:\n``` css\ntest {\n  content: \"\u00f8\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\u00f1\u00bf\u00e9\u00e0\u0164\u01c5\u01c2\u024a\u0271\u02ad\u02ac\u046a\u0488\u0753\"; }\n``\n. Okay, I have figured what's going on. It works when map keys are not quoted. If they are, it fails because it tries to fetch$\"a\"rather than$a... Nasty.\n. We should probably update [this spec](https://github.com/sass/sass-spec/tree/master/spec/libsass-closed-issues/issue_610) to include some tests with quoted keys as well.\n. Added a spec: https://github.com/sass/sass-spec/pull/171.\n. I am not sure12px / 1emshould be valid anyway.em` unit is context-dependant. Did I miss something?\n. Actually Ruby Sass doesn't allow this calculation either.\n\n2px*px isn't a valid CSS value.\n. Adding to the discussion: on SassDoc, we have master as our stable branch. It reflects the latest stable version of the software. And we have develop which is the branch we work on for the next version.\n\nFor a bug fix, we pull a branch from master, fix the bug, then PR the new branch in master. Once reviewed and merged, we bump a patch.\nWhen working on next version, we pull a branch from develop, work on the feature, then PR the new branch in develop. At some point it gets reviewed and merged. Once we have everything we want in our develop branch to release the next version, we make develop the new master and restart over.\nThis process is heavily inspired by git flow and works pretty well I must say.\n. That's an odd one.\n. @xzyfer Does this mean I missed a case with my @at-root test suite?\n. That's very weird since _ and - are strictly equivalent when used in identifiers in Sass.\n. I discussed this with @chriseppstein on Hangouts a couple of days ago. At first, he told me variables only, but I pointed out that it works for functions and mixins as well. \nPlaceholders being tied to usual CSS identifiers rules are not impacted. Map keys and values can be of any data-type so should not be impacted either.\n. Actually it does not come from no but from a bit too agressive handling of the not keyword. Another reason to quote your strings (although there is still a bug to be fixed). :)\n. ``` scss\n$map: (\n  'red': 'foo',\n   red: 'bar',\n);\n.foo {\n  content: inspect($map);\n}\n```\nRuby Sass:\nscss\n.foo {\n  content: (\"red\": \"foo\", red: \"bar\");\n}\nLibSass:\nscss\nDuplicate key \"red\" in map (\"red\": \"bar\"). on line 3 at column 14\nDiscussion: https://twitter.com/HugoGiraudel/status/596267826933014528\n. Also:\n``` scss\n$map: (\n   'red': 'bar',\n);\n.foo {\n  content: type-of(nth(map-keys($map), 1));\n}\n```\nRuby Sass:\nscss\n.foo {\n  content: string;\n}\nLibSass:\nscss\n.foo {\n  content: color;\n}\nLibSass is clearly doing something wrong here. Or the behaviour is not correctly described in the spec, and basically nobody quite knows what should happen, but I'd find it sad I think. :D\n. What is map-set? :x\n. > As far as I can tell Ruby Sass will always treat a quoted colour as a String.\nI can confirm that. Actually there is no such thing as quoted colour  in Ruby Sass. A quoted value is a string, no matter what it contains. So 'red' will never be evaluated as a color, no matter where, no matter how.\n. Also commented Gist: http://sassmeister.com/gist/bd0834fdae880f7a65ea.\n. Of all the possible reasons for this bug, I would not have guessed that. :D\n. You guys rock.\n. Reduced test case:\n``` scss\n@function test($pos) {\n  @return test-#{$pos};\n}\n.foo {\n  content: test(str-slice('scale-0', 7));   // Nope\n  content: test-#{str-slice('scale-0', 7)}; // Yep\n}\n```\nExpected\ncss\n.foo {\n  content: test-0;\n  content: test-0;\n}\nActual\n``` css\n.foo {\n  content: test-\"0\";\n  content: test-0;\n}\n```\n. There you have it.\n. There is a reduced test case:\nTest\n``` scss\n@mixin dummy($a, $b, $c, $d, $e: true) {\n  content: $a $b $c $d $e;\n}\n.foo {\n  @include dummy( ('a', 'b', 'c', 'e')..., $e: false );\n}\n```\nExpected\ncss\n.foo {\n  content: \"a\" \"b\" \"c\" \"d\" false;\n}\nActual\nnamed arguments must precede variable-length argument on line 6 at column 32\n. Workaround: interpolate &.\n. Seconded. Sass should allow custom directives for forward-compatibility.\n. On top:\nscss\n$value: str-slice(unquote('\\\\'), 1);\n/ in Ruby Sass, // in LibSass.\n@kaelig: This should do the trick on LibSass (related https://github.com/sass/libsass/issues/1231):\nscss\n.foo {\n  content: #{'\\\"\\\\' + $character-code + \"\\\"\"};\n}\n. Reported in #1231.\n. A wild guess would be that map-get($family, $set) returns no result, so null, which is not a map for map-get(null, $feature).\nAnyway, I just tried this code on SassMeister and there is no bug whatsoever. I'm pretty sure it's due to a configuration issue with a non-existant map / key. I think you can close.\nIf I may ask, why would you even think there is a bug with LibSass rather than the code you copy/pasted?\n. I think the first issue is related to map keys being colors instead of strings, so it might be a different problem. \nRegarding environment, CodePen is running on Ruby Sass, but you try LibSass on SassMeister. I did with your code and had no bug. :)\n. I thought LibSass was not supporting these selector functions just yet. Did I miss something?\nPlease, use fenced code blocks to wrap your code: https://help.github.com/articles/github-flavored-markdown/#fenced-code-blocks.\n. Please, use fenced code blocks to wrap your code: https://help.github.com/articles/github-flavored-markdown/#fenced-code-blocks.\n. Ruby Sass seems as wrong as LibSass to me.\n. ",
    "HugoHeneault": "I have already run some tests, and I'm quite sure filter:alpha(opacity=80); is the origin of this issue.\n. To be more precise, it seems it's the = symbol which triggers the error. \ndiv\n{\n    filter:alpha(\n        opacity=80\n    );\n}\nreturns css.scss:4: error: error reading values after opacity\n. ",
    "thasmo": "Ye, having this problem too. @akhleung, did you have time to have a look yet? Thanks!\n. :+1: \n. Having a similar problem with bourbon 4.0:\nError in plugin 'gulp-sass': S:\\Project\\gulp.boilerplate\\bower_components/bourbon/dist/helpers/linear-angle-parser:21: error: error reading values after webkit-image\nwhich is this line:\nwebkit-image: -webkit- + $prefix + ($offset - $num) + $suffix,\n. Why was this closed? Won't it be implemented? @akhleung, do you have any insights on this? Thanks a lot!\n. @akhleung, thanks for the update! BEM will be a lot easier to write with the at-root selector.\n. Would be awesome!\n. True, also doesn't work in Ruby Sass. I got a use-case where I needa set the value of a variable to either a media-query or a normal selector. For now I solved it using an if/else, but it would be so much more awesome if it would just work.\nIf this is not a goal of libsass feel free to close it.\n. Yep, thanks for the clarification!\n. ",
    "glebm": "I am on a dial up here in Dominican Republic for a few more weeks (now that's extreme programming). Any help in verifying this would be much appreciated! \n. @reywood Thank you!\n. Same as https://github.com/hcatlin/libsass/issues/231\n. Thanks, @akhleung! :+1: :sunny: \n. I've raised an issue on Sass Ruby about raising the default, see: https://github.com/nex3/sass/issues/1122\n. I wrote this pure Sass proof-of-concept that does something very similar https://github.com/glebm/sass-rewrite-url\n. The unify_with implementation here should be updated to incorporate the changes from https://github.com/sass/libsass/pull/2737.. @mgreter I have a branch (https://github.com/sass/libsass/pull/2775) where I've rewritten selector unification to match Dart Sass. This fixes a ton of bugs but unfortunately breaks Complex_Selector unification.\nPerhaps you can make a PR that just implements subweave for AST nodes, then I can try updating Complex_Selector unification impl to also match Dart Sass.. Update: My unification rewrite has been merged, it's all good.. I think this got fixed by #2736.\nHere is the current libsass output for the first example (format adjusted for readability):\ncss\n.btn.disabled:not(.btn-default, .button-default):not(.btn-outline, .button-outline),\n.btn:disabled:not(.btn-default, .button-default):not(.btn-outline, .button-outline),\n.button.disabled:not(.btn-default, .button-default):not(.btn-outline, .button-outline),\n.button:disabled:not(.btn-default, .button-default):not(.btn-outline, .button-outline) {\n  background: #fefefe !important;\n  color: #111111 !important;\n}. I'm not sure what fixed this but it is no longer broken on master:\n```\n$ sassc/bin/sassc ~/tmp/nest.scss\n.theme1 .something, .theme2 .something {\n  / nothing / }\n.theme1 .something, .theme2 .something {\n  / nothing / }\n``. Only the following case still fails:id:000449,sig:06,src:008670+009131,op:splice,rep:8`. A memory leak not an OOB though.. I believe this is a bug in utf8cpp.\nI've opened an issue (https://github.com/ledger/utfcpp/issues/2) and sent a fix (https://github.com/ledger/utfcpp/pull/3).. Nevermind, was looking at the wrong utfcpp mirror. The right one is probably https://github.com/nemtrif/utfcpp. Checking to see if the bug is already fixed there.. The three cases from the original post no longer fail.\nAll the \"Other input files\" from https://github.com/sass/libsass/issues/2660#issuecomment-394134419 still fail.. A simple reproduction:\nscss\n:not(f(x)) {\n  color: red;\n  @extend x;\n}\nsassc: Stack Overflow.\ndart-sass:\nError: expected \")\".\na:not(f(x)){\n       ^\n  ../../../tmp/so2.scss 1:8  root stylesheet\nruby-sass:\n`\nError: Invalid CSS after \"a:not(f\": expected \")\", was \"(x))\"\n        on line 1 of /home/glebm/tmp/so2.scss\n  Use --trace for backtrace.. This was fixed in https://github.com/sass/libsass/pull/2755, specifically https://github.com/sass/libsass/commit/8f40dc03e5ab5a8b2ebeb72b31f8d1adbb2fd6ae \nTested all cases on master. There are two separate issues here:\nFirst, the & parent selector shouldn't be allowed in selector-append. Example:\nscss\ndiv {\n  a: selector-append('.menu', 'li', '&');\n}\nI've sent a fix for this in #2760.\n\nSecond is this issue:\nscss\ndiv {\n  a: selector-append('.x~~', 'li', 'a')\n}\ndart-sass output:\nError: Parent \".x ~ ~\" is incompatible with this selector.\n  a: selector-append('.x~~', 'li', 'a')\n     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  ../../../tmp/test2.scss 2:6  root stylesheet\nruby-sass output:\nError: Invalid parent selector for \"&li\": \".x ~ ~\"\n        on line 2 of /home/glebm/tmp/test2.scss\n  Use --trace for backtrace.\nsassc output:\n```\nAddressSanitizer:DEADLYSIGNAL\n=================================================================\n==15981==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000088 (pc 0x0000005e7be1 bp 0x7ffd8aa90810 sp 0x7ffd8aa90740 T0)\n==15981==The signal is caused by a READ memory access.\n==15981==Hint: address points to the zero page.\n    #0 0x5e7be0 in Sass::Vectorized >::concat(Sass::Vectorized >) /home/glebm/repos/glebm/libsass/src/ast.hpp:288:61\n    #1 0x5e3fc4 in Sass::Functions::selector_append(Sass::Environment >&, Sass::Environment >&, Sass::Context&, char const, Sass::ParserState, std::vector >&, std::vector, std::allocator > >&) /home/glebm/repos/glebm/libsass/src/fn_selectors.cpp:144:53\n    #2 0x6a1c38 in Sass::Eval::operator()(Sass::Function_Call) /home/glebm/repos/glebm/libsass/src/eval.cpp:1060:18\n    #3 0x6c3274 in Sass::Expand::operator()(Sass::Declaration) /home/glebm/repos/glebm/libsass/src/expand.cpp:250:31\n    #4 0x6cea99 in Sass::Expand::append_block(Sass::Block) /home/glebm/repos/glebm/libsass/src/expand.cpp:802:32\n    #5 0x6bfbd9 in Sass::Expand::operator()(Sass::Block) /home/glebm/repos/glebm/libsass/src/expand.cpp:72:11\n    #6 0x6c0b9f in Sass::Expand::operator()(Sass::Ruleset) /home/glebm/repos/glebm/libsass/src/expand.cpp:144:27\n    #7 0x6cea99 in Sass::Expand::append_block(Sass::Block) /home/glebm/repos/glebm/libsass/src/expand.cpp:802:32\n    #8 0x6bfbd9 in Sass::Expand::operator()(Sass::Block) /home/glebm/repos/glebm/libsass/src/expand.cpp:72:11\n    #9 0x5768b6 in Sass::Context::compile() /home/glebm/repos/glebm/libsass/src/context.cpp:678:12\n    #10 0x5758b7 in Sass::File_Context::parse() /home/glebm/repos/glebm/libsass/src/context.cpp:605:12\n    #11 0x55bc76 in Sass::sass_parse_block(Sass_Compiler) /home/glebm/repos/glebm/libsass/src/sass_context.cpp:234:31\n    #12 0x55b8ba in sass_compiler_parse /home/glebm/repos/glebm/libsass/src/sass_context.cpp:483:22\n    #13 0x55b539 in sass_compile_context(Sass_Context, Sass::Context) /home/glebm/repos/glebm/libsass/src/sass_context.cpp:371:7\n    #14 0x5540f6 in compile_file /home/glebm/repos/glebm/libsass/sassc/sassc.c:158:5\n    #15 0x554ab9 in main /home/glebm/repos/glebm/libsass/sassc/sassc.c:370:18\n    #16 0x7ffbb3fcbb96 in __libc_start_main /build/glibc-OTsEL5/glibc-2.27/csu/../csu/libc-start.c:310\n    #17 0x45b839 in _start (/home/glebm/repos/glebm/libsass/sassc/bin/sassc+0x45b839)\nAddressSanitizer can not provide additional info.\nSUMMARY: AddressSanitizer: SEGV /home/glebm/repos/glebm/libsass/src/ast.hpp:288:61 in Sass::Vectorized >::concat(Sass::Vectorized >*)\n==15981==ABORTING\n```\nI've sent https://github.com/sass/libsass/pull/2762 for this one but not sure if it's the best solution.. This indeed got fixed by #2739. The linked issue was fixed in #2755. The build failure seems unrelated, because the failing pipeline doesn't even use this makefile.. I'm really hoping this makes it into the next release, as I expect the Ruby ecosystem will be switching to libsass with the upcoming sassc and sassc-rails releases.. @alyssais Perhaps we should detect the compiler / linker flavour instead of the operating system? I use clang on Linux and this PR would break it for me, because the clang linker does not support --no-undefined.\nNot sure what the best way to detect the compiler toolchain is. Perhaps via the output of $(CC) --version? If it matches 'gcc' use GCC_LDFLAGS, else if matches 'clang' use CLANG_CFLAGS, otherwise use empty CFLAGS.. I'm not sure if 2 > &1 will work on Windows. I'll try the C program way.. Sent #2729. The Makefile is provided so that it can be built without autotools. This is useful when this library is built for a C extension for Python or Ruby, where autotools is not a requirement of the build environment AFAIK.\n\nAnyway, compiling a small C program is probably (just) more reliable than trying to parse compiler output. \n\nIt's also fast (30ms compile+run), so I'd prefer we do that instead of attempting to parse the --verbose output.\n\nAlthough I wonder if it might be better to take the simpler option of just removing the problematic flags entirely and avoiding the whole problem\u2026\n\nYeah, how useful are these flags?\nAnyway, up to @mgreter and @xzyfer now. So the compiler check approach turned out to be wrong, because as @alyssais has pointed out in https://github.com/sass/libsass/pull/2729#issuecomment-438589228, the compiler and the linker can be (and often are) different.\nLet's just remove these flags?. @xzyfer Can you please link to the closed issue? #1992 doesn't discuss it.\nI'd like to read the discussion to understand the claims of non-portability, because mkdir -p support is a POSIX requirement: http://pubs.opengroup.org/onlinepubs/9699919799/utilities/mkdir.html. @sgbeal While I still can't find the issue, looking further at the Makefile, it appears to support Windows. On Windows, mkdir is an alias for md, which does not support -p.\nPerhaps send a PR that sets MKDIR differently on Windows vs non-Windows?. @sgbeal The checked in Makefile is not generated by autotools. It's an alternative way to build for when autotools may not be available (e.g. when compiling this for a C extension for Ruby or Python).\n\"Windows\" in this case is when you have e.g. gcc and gmake but are running it from CMD (as opposed to e.g. Cygwin Bash or a similar POSIX environment).\nRegardless, I think my #2728 PR resolves this issue, as with that PR make should no longer attempt to create directories that already exist.. @xzyfer Thanks! Looks like I guessed right that this is specifically about Windows compatibility. Sent #2728 which should simply prevent make from trying to create directories that already exist.. @sgbeal I think this might also solve the problem described in #2727. Does it?. @sgbeal Like this:\nbash\ngit clone https://github.com/glebm/libsass.git && cd libsass && git checkout patch-2. OK, try git checkout origin/patch-2 or git checkout origin patch-2. > Seems coverage reporting by the target (AUTOTOOLS=no COVERAGE=yes BUILD=static) has broken\nIt's been broken for a while, not by this PR. I don't think so, don't have much experience in that. This PR can't affect coverage though, as it only changes the linker flags.. @alyssais Oh, that's right. This PR doesn't make sense. Good catch!. In the first commit (https://github.com/sass/libsass/pull/2737/commits/880cd261e434e6e4eeec7463695136ba48ab1b94) I added a function that returns the unification order by matching on typeid.\nThe second commit (https://github.com/sass/libsass/pull/2737/commits/474e9a7483751960a7d986e777c48f98a518e801) adds a unification_order method to the Selector class instead. \nI prefer the second one even though the class hierarchy is not ideal for this (because unification_order is not defined for a few selector types).. Done. @xzyfer The first failing commit seems to be the one that disables coverage for clang: https://github.com/sass/libsass/commit/d09d09d9607d7593b92ba5daf3d8d947a4267f6b\nIt looks like libsass may have been leaking for a while but this went unnoticed because ASAN is disabled when coverage is enabled:\nhttps://github.com/sass/libsass/blob/3e60b123a0704577c6da5123c16669ee55f08561/script/ci-build-libsass#L57-L59. This is what I use for investigating by the way:\n```bash\nenable_asan() {\n  export EXTRA_CXXFLAGS='-fsanitize=address -g -O0 -fno-omit-frame-pointer'\n  export EXTRA_CFLAGS=\"$EXTRA_CXXFLAGS\"\n  export EXTRA_LDFLAGS=\"-fsanitize=address -lstdc++\"\n  export ASAN_OPTIONS=\"verbosity=1:symbolize=1\"\n  export CC=clang\n  export CXX=clang++\n}\nenable_asan\ncd sassc && make clean && cd - && make clean && make -j8 test\n```. >  in the small window where the configuration was incorrect,\nMaybe not that small, it fails on d09d09d9607d7593b92ba5daf3d8d947a4267f6b as well.. Bisecting (manually, running on the current test suite but only considering ASAN errors):\n| Date   | Commit   | Result |\n|--------|----------|--------|\n| 04 Jul | 38f4c369 | FAIL   |\n| 04 Apr | 9266d26f | FAIL   |\n| 17 Mar | d0b6338f | FAIL   |\n| 17 Mar | bbfcf493 | FAIL   |\n| 17 Mar | 4c34d16a | FAIL   |\n| 17 Mar | 205dc65d | FAIL   |\n| 17 Mar | 0599b2ec | PASS   |\n| 17 Mar | 10c25da5 | PASS   |\n| 17 Mar | aa7386f2 | PASS   |\n| 15 Mar | 9cfe0df9 | PASS   |. According to the bisection results, the first ASAN failure is at https://github.com/sass/libsass/commit/205dc65d0f1af1f5f715080432192195d64256be. My PRs each address individual leaks. With all 3 there are no more leaks.. OK, will do so in the future. CI was only passing because it wasn't running ASAN (until you disabled coverage). Memory leaks existed since March 17.. Yes, there must be, because the error message in that build is:\n==4122==LeakSanitizer has encountered a fatal error.\n==4122==HINT: For debugging, try setting environment variable LSAN_OPTIONS=verbosity=1:log_threads=1\n==4122==HINT: LeakSanitizer does not work under ptrace (strace, gdb, etc). Looks like it doesn't work in a docker container without --cap-add ptrace. See https://github.com/google/sanitizers/issues/764.\nLooks like there is no way to add container capabilities on Travis. However, we can simply set sudo: required in .travis.yml. See https://github.com/travis-ci/travis-ci/issues/9033. Rebased.. @mgreter @xzyfer Reverting this commit fixes it but I do not yet understand why: https://github.com/sass/libsass/commit/4254054dec66bb715d3a16ce3a9cf40501522773. This is an alternative to reverting https://github.com/sass/libsass/commit/4254054dec66bb715d3a16ce3a9cf40501522773 that also fixes the issue:\ndiff\ndiff --git a/src/ast.cpp b/src/ast.cpp\nindex da3540a9..1fc73647 100644\n--- a/src/ast.cpp\n+++ b/src/ast.cpp\n@@ -1243,7 +1243,8 @@ namespace Sass {\n     if (!this->has_parent_ref()) return this;\n     Selector_List_Ptr ss = SASS_MEMORY_NEW(Selector_List, pstate());\n     for (size_t si = 0, sL = this->length(); si < sL; ++si) {\n-      ss->concat(at(si)->resolve_parent_refs(pstack, traces, implicit_parent));\n+      Selector_List_Obj rv = at(si)->resolve_parent_refs(pstack, traces, implicit_parent);\n+      ss->concat(rv);\n     }\n     return ss;\n   }\nCertainly seems like a bug in SharedPtr.. The ASAN build on Travis is not fixed yet but I'm looking into it.. Can't figure out why it's failing the error tests (and can't reproduce locally).\nSome memory leaks are reported in plugins. I've sent the following PRs:\nhttps://github.com/mgreter/libsass-glob/pull/1\nhttps://github.com/mgreter/libsass-digest/pull/1\nhttps://github.com/mgreter/libsass-tests/pull/1\nFor libsass-tests, there is still one ASan error that I haven't figured out.. @mgreter I've fixed all the memory leaks reported in the plugins. Can you please merge the PRs?. @mgreter Sorry to hear about your surgery. Forget about GitHub and focus on recovering! I hope you get better soon! Thank you for letting us know.. Sent https://github.com/mgreter/libsass-tests/pull/2. It is finally green! https://github.com/sass/libsass/pull/2760. Based on Travis run time, this is a significant performance win.\nCan you release a new version once this is merged?\nAll the memory leaks reported by ASan have been fixed, and I am not any closer to figuring out / reproducing the failing tests in the ASan build but pretty sure they are not bugs but issues with the test harness.. Rebased. Fixed! This was the cause of both Travis and AppVeyor failing: https://github.com/sass/libsass/pull/2755/commits/436ee57c6e767696be80138d48c1d1e17a5def6a\n\nWell the plugin tests are still failing ASan but only due to bugs in the plugins (for which the PRs have been sent already).\nOnce this has been merged I'll rebase #2754.. Ah, nevermind, Windows still failing. The whack-a-mole continues.. Not reproducible on Visual Studio 2015 and Visual Studio 2017, so I'm downloading Visual Studio 2012 now.. Oh, Microsoft Visual Studio 12.0 is actually Visual Studio 2013. \ud83d\ude10 . Finally fixed. Learned that exceptions must have a copy constructor (https://stackoverflow.com/a/10855545). In my day job we don't use exceptions.. libsass-python uses its own build commands to build libsass.\nThis is an issue with libsass-python, not libsass, and it has already been fixed there: https://github.com/sass/libsass-python/pull/277. Looks like this requires upgrading to at least VS2015 https://msdn.microsoft.com/en-us/library/hh567368.aspx. Yes, this is still valid, VS2013 does not have full C++ 11 support as per the link above.\nIt's not failing because I've been avoiding using C++ 11 features not supported by VS2013.. Anyway, closing this, as per https://github.com/sass/libsass/pull/2758#issuecomment-442757293.\nVS2015 (or perhaps even VS2017) will be the minimum required version in the next major release, but for now we're keeping VS2013 support for compatibility with older versions of Node.. > For now I'm in favour of keeping VS2013 as the default.\nFor how long? My main concern is that VS2013 doesn't have full C++ 11 support.. OK! That's not too bad.. No disabled tests get fixed by this so I guess a libsass-closed-issues test should be added to sass-spec.. > We were producing an error in this case, but not the right error\nWe weren't producing an error, we were segfaulting instead:\nsassc/bin/sassc ~/tmp/test.scss \n[1]    6924 segmentation fault (core dumped)  sassc/bin/sassc ~/tmp/test.scss. Does make test_probe return the same result as before?. Well, make test_probe returns a list of over a dozen specs that used to fail but now pass on master. We should make sure it's the same list.. Ah, I haven't pulled from there for a while!\nPerhaps sassc, sass-spec, and plugins should be git submodules, then I think they will get updated automatically on git pull? CI could still always pull the latest version.. There is one test:\nconsole\n$ cd sassc; msbuild .\\win\\sassc.sln /p:Platform=Win32 /p:Configuration=Debug /m:4; cd ..\n$ ruby sass-spec/sass-spec.rb -V 3.5 --probe-todo --impl libsass -c sassc\\bin\\sassc.exe sass-spec/spec\n...\nThe following tests pass but were marked as TODO for libsass:\nsass-spec/spec/core_functions/color/hsla/error/one_arg. @mgreter I wonder if your weave refactoring will fix the stack-overflow bugs. I tried figuring it out but couldn't. . What's the build configuration?\nhttps://www.appveyor.com/docs/build-configuration\nTrying to figure out how much RAM and how many cores it has, but can't see any information in AppVeyor UI. The build doesn't seem to be any slower, so I guess it has <2 cores.. @mgreter @xzyfer Ready for review. @xzyfer Can you please take care of the \"output_style\" sass-spec stuff? Thanks. > AFAICT the regressions in CI do not seem \"output-style\" related only, most seem to indicate regressions with namespace handling. Not sure if the reference implementation was changed for these tests?\nI tried a few of the failing tests with dart-sass and Ruby Sass and the tests were wrong (libsass with this PR matched dart-sass). \n\nNot sure if the reference implementation was changed for these tests?\n\nI don't know if it changed or never was like this to begin with, only libsass runs \"output_style\" tests.. Actually, there is one non output_styles failure (sass-spec/spec/selector-functions/unify/base). @mgreter Here I've updated the failing output_styles tests with Ruby Sass output: https://github.com/sass/sass-spec/pull/1319/files. @mgreter @xzyfer All fixed! Please take a look.. @xzyfer Perhaps we should merge this (and then sass/sass-spec#1319) to unbreak the build?\nI can address feedback from @mgreter afterwards if any.. Thanks!. Some more information as to the root cause (VS2017):\n\n. There is a bit of a mess with namespace handling as it tries to consider has_ns=true ns=\"\" and has_ns=false ns=\"\" as equal. This is not what dart-sass does.\n . A minimal fix like this one https://github.com/glebm/libsass/commit/b16fad66100ce0db90fb4bed94228680eb50bd92 breaks one case in selector-functions/unify/universal_simple.\n2775 fixes it ~~but it requires a weave for selectors (#2557).~~. Looks like #2775 doesn't need to wait for #2557 after all. All the tests it fails are \"output_style\" tests.. > Maybe @glebm knows a better and portable way to compare floats/doubles for equivalency!?\nI don't know too much about how this is supposed to be done in Sass. All approaches come with tradeoffs.\nI was even slighlty surprised that these are represented as doubles internally, instead of something like bigrational from gmp.. dart-sass uses epsilon = math.pow(10, -SassNumber.precision - 1):\nhttps://github.com/sass/dart-sass/blob/94fd7e6e503a977e60bb8c7b894ac9fd3d597a45/lib/src/util/number.dart#L11\nPerhaps we should do the same.. Rebased. Ah, have to rebase the sass-spec PR as well for CI to pass. The endless loop here is while $i != 5.\nIf you add @debug($i); there, it becomes clear what's going on:\noom.scss:7 DEBUG: 1.foo 1.foo 1.foo 1.foo 1.foo 1.foo 1.foo 1.foo ...\nRuby Sass and Dart Sass do the same thing here.\nIntended behaviour, I guess.\n@nex3, Should number + selector be a valid operation in Sass? It is now but it seems weird that this is allowed.. @rjoshi18 This issue is closed as \"won't fix\" / \"works as intended\" (\"by design\").. A simple repro:\nscss\nx {\n @extend #{&};\n @extend #{&};\n}\nInterestengly, the various versions of Sass can't agree on the right result:\nWith the example as above, Dart outputs nothing.\nRuby outputs:\nError: \"x\" failed to @extend \"x\".\n       The selector \"x\" was not found.\nHowever, if we change this to:\nscss\nx {\n @extend #{&};\n @extend #{&};\n color: red;\n}\nDart:\ncss\nx {\n  color: red;\n}\nRuby:\ncss\nx {\n  color: red; }\n/cc @nex3 . AppVeyor is broken because of @mgreter's recent changes. The fix is in #2775.. By the way, the broken windows build is tracked in #2776. Now green.. I'm hoping that #2785 will at least make it obvious.\nI don't think an automatic lint is possible here (as _Ptr is better for performance when it is safe).\nI'm following this Rust Sass compiler closely btw: https://github.com/kaj/rsass.. Great! I'm going to wait until @mgreter finishes #2557 to avoid merge conflicts.. 2 pro, 1 neutral, let's do this.\n@mgreter Is now a good time or would you like to finish the subweave PR first (to reduce conflicts)?. Minimal example:\nscss\n@supports (foo: bar) or {\n}\nDart Sass:\nError: expected \"(\".\n@supports (foo: bar) or {\n                        ^\nRuby Sass:\nsass ~/tmp/npd.scss        \nError: Invalid CSS after \"...(foo: bar) or  \": expected @supports condition (e.g. (display: flexbox)), was \"{\". > Edit: I checked them locally but no \"passing tests\" did show up on CI ...\nIs your sass-spec git clone up-to-date?\nHere is what I get locally and also on CI (e.g. https://travis-ci.org/sass/libsass/jobs/468471517):\nconsole\n$ make test_probe\nThe following tests pass but were marked as TODO for libsass:\n/spec/libsass-closed-issues/issue_666/angle\n/spec/libsass-closed-issues/issue_151\n/spec/libsass-closed-issues/issue_1163\n/spec/core_functions/color/hsla/four_args/basic\n/spec/core_functions/color/hsla/error/one_arg\n/spec/core_functions/color/hsl/three_args/basic\n/spec/libsass/units/conversion/angle\n/spec/libsass/units/conversion/size\n/spec/libsass/units/conversion/resolution\n/spec/libsass/units/simple\n/spec/libsass/color-functions/other/adjust-color/s\n/spec/libsass/color-functions/other/change-color/s\n/spec/libsass/color-functions/other/scale-color/s\n/spec/libsass/color-functions/saturate\n/spec/libsass/color-functions/hsl/saturation\n/spec/libsass/color-functions/hsl/darken\n/spec/libsass/color-functions/hsl/lighten\n/spec/libsass/color-functions/hsl/desaturate\n/spec/scss/negation\n/spec/colors/saturation\n/spec/output_styles/compressed/libsass-closed-issues/issue_151\n/spec/output_styles/compressed/libsass/color-functions/other/adjust-color/s\n/spec/output_styles/compressed/libsass/color-functions/other/change-color/s\n/spec/output_styles/compressed/libsass/color-functions/other/scale-color/s\n/spec/output_styles/compressed/libsass/color-functions/saturate\n/spec/output_styles/compressed/libsass/color-functions/hsl/saturation\n/spec/output_styles/compressed/libsass/color-functions/hsl/darken\n/spec/output_styles/compressed/libsass/color-functions/hsl/lighten\n/spec/output_styles/compressed/libsass/color-functions/hsl/desaturate\n/spec/output_styles/compressed/colors/saturation\n/spec/output_styles/nested/libsass-closed-issues/issue_151\n/spec/output_styles/nested/libsass/color-functions/other/adjust-color/s\n/spec/output_styles/nested/libsass/color-functions/other/change-color/s\n/spec/output_styles/nested/libsass/color-functions/other/scale-color/s\n/spec/output_styles/nested/libsass/color-functions/saturate\n/spec/output_styles/nested/libsass/color-functions/hsl/saturation\n/spec/output_styles/nested/libsass/color-functions/hsl/darken\n/spec/output_styles/nested/libsass/color-functions/hsl/lighten\n/spec/output_styles/nested/libsass/color-functions/hsl/desaturate\n/spec/output_styles/nested/colors/saturation\n/spec/output_styles/compact/libsass-closed-issues/issue_151\n/spec/output_styles/compact/libsass/color-functions/other/adjust-color/s\n/spec/output_styles/compact/libsass/color-functions/other/change-color/s\n/spec/output_styles/compact/libsass/color-functions/other/scale-color/s\n/spec/output_styles/compact/libsass/color-functions/saturate\n/spec/output_styles/compact/libsass/color-functions/hsl/saturation\n/spec/output_styles/compact/libsass/color-functions/hsl/darken\n/spec/output_styles/compact/libsass/color-functions/hsl/lighten\n/spec/output_styles/compact/libsass/color-functions/hsl/desaturate\n/spec/output_styles/compact/colors/saturation. @xzyfer Looks like I missed one reference, sent https://github.com/sass/sassc/pull/245. Fixed!. @xzyfer The discussion in the comments is not a blocker for merging this btw.. wrong fix, actually have to make it const for C ABI compat. Will reopen once ast_node_to_sass_value is fixed.. @mgreter ping. @xzyfer Let's merge this, it's the only blocker for getting rid of the typedefs.. Closing, as this is likely to cause build issues for some older distributions.. @xzyfer Good point, I've changed it to simply disable coverage for that build instead of removing it completely.. @xzyfer ping. Does this reproduce on master?. Looks good to me. Works as intended, custom property values are not evaluated as SassScript, see https://github.com/sass/sass/issues/2383#issuecomment-336349172 for the explanation and a workaround.. > I can't really think of a reason why having\nThis decision is not arbitrary. I suggested you actually read the issue comment and discussion linked above (https://github.com/sass/sass/issues/2383#issuecomment-336349172 and https://github.com/sass/sass/issues/1128).\nIf you'd like to discuss the language specification further, the correct repo for that is https://github.com/sass/language.\nThis repo is just for the libsass implementation. None of the maintainers here work on the Sass specification (also, this is not even the \"reference\" implementation, dart-sass is).. @xzyfer Merging this won't cause any problems for @mgreter, as he can just apply the same sed command to his outstanding PR.. Reverted.. The documentation is out of date, clang on Travis is actually v5.0 (see the build log and multiple issues on the travis-ci repo about the docs being out of date).\nTravis docs on almost every subject are out of date.. Done, for script/ci-build-sass with AUTOTOOLS=no only as I don't know any other systems used here.. Can we not put spaces around <template>? This is never needed in C++11.. For me it's easy to confuse with the less than operator and takes a second to realize it isn't.\nIt also isn't a convention for any of the common coding conventions (e.g. the ones supported by clang-format out of the box).\nNot sure if it's actually consistent, e.g. 3 lines above it's used without spaces.. I'm not sure what that todo means tbh. std::set can be constructed directly from a range:\nc++\nSelectorSet lset(lset.begin(), lset.end());\nSelectorSet rset(rset.begin(), rset.end());. Consider SelectorSet::key_compare instead of OrderSelector (it might communicate the meaning better here). Looks like this reverted https://github.com/sass/libsass/commit/2a4935c9ad137bedb1be6690a78995a6714a7e62\nI wonder if there are others. This reverted https://github.com/sass/libsass/pull/2739. How about using hash maps/sets throughout (std::unordered_map)? They are faster and easier to get right. Do you know where the upstream repo is?. How do you want it to be?. No, it's a literal. Otherwise both lhs and rhs are const char* so there is no + operator.\nEverywhere else for a + b + c + ..., either a or b is an std::string, which is enough to not need a conversion.. Removed to spacing, assuming that's what you prefer here.. These are the default quote delimiters for GNU m4, perhaps that's where Ruby got them from.\nhttps://www.gnu.org/software/m4/manual/m4-1.4.15/html_node/Changequote.html. An interesting quote from autoconf manual (https://www.gnu.org/software/autoconf/manual/autoconf.html#Changequote-is-Evil):\n\n... by default M4 uses ` and ' as quotes, but in the context of shell programming (and actually of most programming languages), that's about the worst choice one can make .... \n",
    "reywood": "Just pulled latest master branches of libsass, sassc, and bootstrap-sass. Compiled sassc and ran against bootstrap-sass/vendor/assets/stylesheets/bootstrap.scss. Looks legit to me. The glyphicons font URLs appear to be correct. Output is here.\n. ",
    "el-rotny": "what commit  is this under?\n. ",
    "jmesserly": "fyi -- syntax might change (again): http://lists.w3.org/Archives/Public/www-style/2014Jan/0603.html\n. ",
    "wrumsby": "The new syntax is supported by Sass - see sass/sass#1071.\n. #452 appears to be a duplicate of this issue although this issue mentions the no longer supported syntax so I would recommend closing this issue in favour of #452.\n. ",
    "malrase": "Yeah, we agree with closing this issue in favour of #452 . \n. I added a test (see PR here: https://github.com/sass/sass-spec/pull/79 )\nI used pretty much the same code from the original issue and I get the following output when running with sassc:\n.theme .test-hello, .theme .test-world {\n  color: red; }\nwhich seems to be the desired outcome. \nPlus, the test passes fine.\n@donaldpipowitch or @mgreter \u2013 can either of you confirm that the test case I've entered is valid? And if libsass is not working for you two on the current build?\nCheers!\n. I believe as it's \"not in sass\", this issue should be closed.\n. So I was playing around with this to find a working test case, but Sass 3.4 seems to throw an error for this, too.\nSass errors because there's no variable \"$header\" \u2013 meaning that it's seeing and trying to interpret the variable, but doesn't pay attention to the values given to it by the @each line.\nhttp://sassmeister.com/gist/0277dd12d32a99cd97fd\nIt looks like libsass (at least in Sassmeister) gives a similar error about unbound variables. Could this be a Ruby Sass bug too?\n. (Note: if I set the variable \"$header: h1\" in either example before the comment, the code works fine.)\n. So if you're following the Sass issue, it looks like this is intended behaviour. See the comment by lolmaus here: https://github.com/sass/sass/issues/1465#issuecomment-58214993\n. I was adding a test for this issue and wanted to make sure it broke. It definitely does in libsass 2.0 (see gist: http://sassmeister.com/gist/e35f97e487b68f85b1f0).\nHowever, the test seemed to pass fine when I ran it against 3.0.\nHere's my pull request with the test (https://github.com/sass/sass-spec/pull/67/files) \u2013 I used the exact same input SCSS as found in the gist above.\nCan either of you who first had this issue maybe verify that the input SCSS I'm using would break in your cases, or that this has been fixed for your use case in 3.0?\nCheers!\n. I created a test for the first error you were seeing, which still occurs for me (I guess the \"remove placeholders\" fix hasn't been merged yet?). The test is here:\nhttps://github.com/sass/sass-spec/pull/81\nHowever, it looks like there's another problem with the desired output. I haven't created a test for that yet. I'll wait to see how @errorx666 responds to the output above. \n. I'm in the process of writing a test and put the code into a gist:\nhttp://sassmeister.com/gist/ed4788de313bcabe9f68\n(That should be using Sass 3.4)\nIs that the desired interpolation behaviour? I can see how the libsass result:\n.test {\n  margin: 10 1px 2px 3px; }\nis not correct.\nHowever, I guess I'd expect Sass 3.4 to give a result closer to\n.test {\n  margin: 101px 102px 103px; }\n. Ah! I see what you mean. It's difficult to test right now, unfortunately. \nhttp://sassmeister.com/gist/7b8f1f58a2b356aac923\nThe above will be the test when we can test it.\n@hcatlin can you remove the \"needs test\" tag from this while we get it sorted out.\n. Using /deep/ definitely breaks libsass:\nhttp://sassmeister.com/gist/abebd8016d9a9e9caccb\nHowever, using ::shadow and :host seems to be OK?\nhttp://sassmeister.com/gist/d3869019da2eb39d9fcc\nI'll add a test-case for /deep/, though.\n. D'oh, someone's already added the test:\nhttps://github.com/sass/sass-spec/tree/master/spec/libsass-todo-issues/issue_452\nThe \"needs test\" tag can be removed.\n. https://github.com/sass/sass-spec/tree/master/spec/libsass-todo-issues/issue_469\nThis now has a test, so the label \"needs test\" should be removed.\n. Here's the saturate test case as a gist:\nhttp://sassmeister.com/gist/b906aa9a86d31f921bf2\nIf Sass sees one variable, it just ignores the saturate() and exports it directly into the CSS.\nIf there's two variables, it does the colour maths on saturate().\n. I added a new test to the sass-spec (PR: https://github.com/sass/sass-spec/pull/66) to cover the weird saturate() case.\n. ",
    "IGZjaviernieto": "hi,\nwhen I try something like:\n.some-class{\n  content: \"\\\";\n}\nI'm getting: \"error: error reading values after...\"\n. we're already scaping the backslash \"\\\" (mistype error in previous post), and getting the error. We're using grunt-sass->node-sass->libsass. Maybe some overscape in the lib call chain??\n. ok, thanks.\n. ",
    "derek73": "The issue may be with any function inside the url(), for example:\nurl(twbs-font-path('#{$icon-font-path}#{$icon-font-name}.eot')\nreturns the same error.\n. agree, this issue is a dup then. thx\n. ",
    "rodneyrehm": "For reference, libsass and sassc were builds from master (9e57bdf98ede7d44e51ba0cc8c4fea7cfcbcaa33)\n. I can confirm the interpolation working fine now.\n. node-sass is compiled against libsass v1.0.1 - not master.\n. Affirmative. Bug is fixed. thank you!\n. sure, we can do that. do you want me to do it (will take some time) or do you want to have access to medialize/sass.js and move it yourself?\n. I've compiled current master with emscripten. It now fails because of the free. @ckruse can you reproduce that with sassc?\n. there was no free() in the wrapper and yes, the strdup on my side fixed it. thx!\n. Are you sure this is fixed? I'm still getting the wrong line reported\u2026\n. Yes, I've successfully tested in in my context - but I haven't written any tests for it (as coveralls already reported).\nI don't understand why you're worried, it is a char** in the first place and considering all the function does is null the pointer so it doesn't get cleaned later. I didn't see a difference to how char * is handled. That said, I have no idea what I'm doing - I'm rather happy I'm able to spell \"C\" ;)\n. Thanks for merging!\n\nBTW. On my todo list also to update sass.link.js\n\nI'm currently looking at API Sass Importer and how I can integrate that into sass.js - that should go a long way to simplify your sass.link.js, no? I'll open an issue for that wiki page, as I have questions to ask / discoveries and opinions to share.\n. > I wished more people used links the way you did!\nso do I :/\n\n\u2026 aware that custom importers are considered a highly experimental feature\n\nyes. It's a public API none the less. I don't expect it to be solid and working properly. That's why I investigated and provided feedback. Was that not the reason you exposed the experiment in the first place?\n\nbut the only real benefit I see is that you are able to emit @imports, that will be moved to the top of the css by libsass automatically.\n\nI don't understand what you're trying to say.\n\nFor the behavior I disagree that custom importers should just act as a fallback. Maybe you want to have some preprocessor for files libsass would otherwise just process on its own.\n\nagreed. But then I'd expect to be handed the path/content of the file libsass already identifed (or rather would have identified) to not have to implement this myself.\n\nIMO returning null in custom importers should give you your desired result\n\nnot really. I still have to make sure the file exists to not engage any of my fallback scenarios and return null.\n. My problems with the API are addressed in #962, so you're free to close this issue on that front.\n\nI just added a sentence in the wiki right now to document this.\n\nI would've preferred those bits as code examples, e.g.\n``` c\nstruct Sass_Import sass_importer_demo(const char url, const char prev, void* cookie) {\n  // engage libsass internal resource loading\n  return NULL;\n}\nstruct Sass_Import sass_importer_demo(const char url, const char prev, void* cookie) {\n  // inform libsass that the resource could not be loaded\n  struct Sass_Import list = sass_make_import_list(1);\n  const char* message = \"some error message\";\n  // passing line:0, column:0 makes libsass fill in the correct values\n  list[0] = sass_make_import_entry(url, 0, 0);\n  sass_import_set_error(list[0], strdup(message), 0, 0);\n  return list;\n}\n```\n. I added some examples to the end of API Sass Importer Example.\nSince the other topics are already tracked in #962, I'm closing this issue. Thanks!\n. > In my experience returning a 0 size array causes runtime exception as the code is expecting a non-empty array, did you try this and see something different? I ran this again and got the following Go error: \u2026\nI only ran this after emscripting it to JavaScript and did not get any errors - simply no output.\n. my importer function currently doesn't do more than log its input and return NULL. I have the following FS:\n/sass/testfile.scss\n  @import \"sub/deeptest\";\\n.testfile { content: \"loaded\"; }\n/sass/sub/deeptest.scss\n  .deeptest { content: \"loaded\"; }\nThe source I pass to the Sass_Data_Context is as follows:\n@import \"testfile\";\nThe generated content is correct:\n.deeptest{content:\"loaded\"}.testfile{content:\"loaded\"}\nMy importer looks as follows:\n``` c\nstruct Sass_Import sass_importer_emscripten(const char cur_path, Sass_Importer_Entry cb, struct Sass_Compiler comp) {\n  struct Sass_Import previous = sass_compiler_get_last_import(comp);\n  const char prev_path = sass_import_get_path(previous);\n  const char* prev_base = sass_import_get_base(previous);\nconsoleLog(strdup(\"path\"), strdup(cur_path));\n  consoleLog(strdup(\"prev.path\"), strdup(prev_path ? prev_path : \"-nullprt-\"));\n  consoleLog(strdup(\"prev.base\"), strdup(prev_base ? prev_base : \"-nullprt-\"));\nreturn NULL;\n}\n```\nThe expected log output:\n```\npath: \"testfile\"\nprev.path: \"stdin\"\nprev.base: -nullptr-\npath: \"sub/deeptest\"\nprev.path: \"/sass/testfile.scss\"\nprev.base: \"stdin\"\n```\nThe actual result:\n```\npath: \"testfile\"\nprev.path: \"\"\nprev.base: -nullptr-\npath: \"sub/deeptest\"\nprev.path: \"\"\nprev.base: -nullptr-\n``\n. for what its worth, I'm getting the same output when usingSass_File_Context` \n. > Which commit hash of libsass are you on?\nI checked with 3.2.0-beta.4 and fd7f20fa (most recent master at the time of writing).\n\nWhich compiler are you using?\n\nI don't understand the question. Is there more than one? I'm using the C-API and after configuring the options I call sass_compile_data_context(). The time I confirmed my results with the file context, I used sass_compile_file_context(), obviously. Does that count as two compilers?\nThe way I use libsass (without the modifications for the beta.4 importer) can be observed here. Should I be doing something different?\n. Looks like this PR fixes the problem!\n\ntested the following way:\n```\ncd libsass\ngit checkout master && git fetch --prune && git pull --rebase\ngit remote add mgreter git@github.com:mgreter/libsass.git\ngit fetch mgreter\ngit merge mgreter/bugfix/issue_1035\nbuilding my stuff\n```\nis there a simpler way to locally merge a PR manually adding all PRs to .git/config:\n[remote \"origin\"]\n  url = git@github.com:sass/libsass.git\n  fetch = +refs/heads/*:refs/remotes/origin/*\n  fetch = +refs/pull/*/head:refs/remotes/origin/pr/*\n. splendid, thank you for the quick fix!\n. Your fix may have gone a tiny bit too far. In 3.2.1 for precision: 0, the following code\nscss\n$foo: 123px; .m { width: $foo; }\ncompiles to\ncss\n.m {\n  width: 123.0px; }\nI don't think adding .0 is a good idea.\n. Oh, it even got worse:\nscss\n$foo: 123.4px; .m { width: $foo; }\ncompiles to\ncss\n.m {\n  width: 123.0px; }\nso now we're actually losing precision\n. I see your sassc vs sass test and realize that precision:0 is intended to lose the decimal, it is not the value to set for \"use libsass default\"? If that's the case, what is the default value?\n. No, it's not what I desire. What I want is the ability to tell libsass to use its default value for precision. I assumed 0 would trigger that. Or maybe -1 does. Or maybe nothing triggers the default value, in which case I'd like to know the default value, so I can set it instead of passing in 0. If none of that is possible, I'll go and adjust my code to simply not set precision, in order to have libsass use its default value.\nMaybe all of this is really just based on me not understanding that precision:0 is meant to truncate the decimal part.\n. ok, preventing to set the precision seems like the easiest (and apparently future-proof) way. thanks!\n. No need to apologize, obviously I wasn't able to make clear what I wanted\u2026 \nThanks guys! :)\n. > We're certainly open to making it more accessible to uninitiated and open to feedback and improvements.\nthat'd be fantastic ;)\n\nSass_Map maps to a Sass map value, so like Sass Maps, it's keys can be of any Sass type.\n\nso what's the idea of having a map as a key in a map? what are the tyical types that are parsed from SCSS, what are the types you expect to generate CSS? In what Situation would I even work with a map (as opposed to a list)?\n. nice! yes, this fixes my issue :)\n. The same is true for line comments. What used to be /* line 1, /somewhere/testfile.scss */, now is /* line 1, somewhere/testfile.scss */\n. > Do you know with which version it was still working as intended?\nIt was still working with 3.2.1\n\nMaybe you would be able to do a git bisect to find the commit that breaks it for you?\n\nI've never used git bisect before, but as far as I understand I'd need to build the library for every commit to narrow things down. Since my builds take ages (that whole emscripten thing\u2026) I'm not sure this would be a quickie\u2026\n. >  can you tell on which versions you saw this error.\n@mgreter the OP includes the node-sass --version output - this happened in libsass 3.3.6. I've also confirmed this issue still exists in libsass 3.4.0-RC1 via compiling it to sass.js. \n. ",
    "andyfriesen": "Hey, this is great!  Thanks!\nI took a swing at fixing this myself but you beat me to it.  Here's my test: https://github.com/hcatlin/sass-spec/pull/11\n. ",
    "matthew-andrews": "Ah thanks @akhleung  I did try to look to see if there were any existing issues but couldn't find one.  I will close this as it's a duplicate.\n. ",
    "aeharding": "This feature would be amazing for me. How quickly does this libsass adopt new features after released in Sass 3.3?\n. ",
    "thomaswelton": "Really want to use susy. Is libsass supposed to be up to date with the latest sass version?\n. libsass is significantly better. Instead of jumping ship we should be pestering scss package developers to test their code against libsass. And how off adding the new sass features until libsass can catch up.\nI'm not sure of all the new stuff in sass 3.2 yet, but I'm sure the authors of susy could have written their plugin to work with libsass if they had thought it was a big enough priority. So instead of using susy for my grid I'm using zurb foundation as that compiles with libsass.\n. Having to install ruby just to compile css is too much on my CI server.\nNode does lots of stuff form me with gulp/grunt so I have that installed. \nRuby doesn't do anything else for me and want to cut it out of my stack. \nPlus it's much slower in comparison. \n\nOn 13 Mar 2014, at 21:19, ljearwood notifications@github.com wrote:\nWhy not just use compass, it is not as fast, granted, but it just plain\nworks.\nOn Mar 13, 2014 4:02 PM, \"Thomas Welton\" notifications@github.com wrote:\n\nlibsass is significantly better. Instead of jumping ship we should be\npestering scss package developers to test their code against libsass. And\nhow off adding the new sass features until libsass can catch up.\nI'm not sure of all the new stuff in sass 3.2 yet, but I'm sure the\nauthors of susy could have written their plugin to work with libsass if\nthey had thought it was a big enough priority. So instead of using susy for\nmy grid I'm using zurb foundation as that compiles with libsass.\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/263#issuecomment-37586368\n.\n\u2014\nReply to this email directly or view it on GitHub.\n. Maybe someone could design a \"compiles with libsass\" badge for devs to add to their readme. \nEveryone loves readme badges :)\n\nOn 13 Mar 2014, at 21:19, ljearwood notifications@github.com wrote:\nWhy not just use compass, it is not as fast, granted, but it just plain\nworks.\nOn Mar 13, 2014 4:02 PM, \"Thomas Welton\" notifications@github.com wrote:\n\nlibsass is significantly better. Instead of jumping ship we should be\npestering scss package developers to test their code against libsass. And\nhow off adding the new sass features until libsass can catch up.\nI'm not sure of all the new stuff in sass 3.2 yet, but I'm sure the\nauthors of susy could have written their plugin to work with libsass if\nthey had thought it was a big enough priority. So instead of using susy for\nmy grid I'm using zurb foundation as that compiles with libsass.\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/263#issuecomment-37586368\n.\n\u2014\nReply to this email directly or view it on GitHub.\n. I've been there are done it. Not relying on ruby to do my css is a lot better than when I did use it. But this isn't about ruby. It's about libsass being faster and devs needing to support it. \n\nOn 13 Mar 2014, at 21:36, ljearwood notifications@github.com wrote:\nRuby is extremely light, you'll be fine.\nOn Mar 13, 2014 4:35 PM, \"Thomas Welton\" notifications@github.com wrote:\n\nHaving to install ruby just to compile css is too much on my CI server.\nNode does lots of stuff form me with gulp/grunt so I have that installed.\nRuby doesn't do anything else for me and want to cut it out of my stack.\nPlus it's much slower in comparison.\n\nOn 13 Mar 2014, at 21:19, ljearwood notifications@github.com wrote:\nWhy not just use compass, it is not as fast, granted, but it just plain\nworks.\nOn Mar 13, 2014 4:02 PM, \"Thomas Welton\" notifications@github.com\nwrote:\n\nlibsass is significantly better. Instead of jumping ship we should be\npestering scss package developers to test their code against libsass.\nAnd\nhow off adding the new sass features until libsass can catch up.\nI'm not sure of all the new stuff in sass 3.2 yet, but I'm sure the\nauthors of susy could have written their plugin to work with libsass\nif\nthey had thought it was a big enough priority. So instead of using\nsusy for\nmy grid I'm using zurb foundation as that compiles with libsass.\n\nReply to this email directly or view it on GitHub<\nhttps://github.com/hcatlin/libsass/issues/263#issuecomment-37586368>\n.\n\nReply to this email directly or view it on GitHub.\n\n\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/263#issuecomment-37589838\n.\n\u2014\nReply to this email directly or view it on GitHub.\n. How bad ass would it be if I wrote a micro travis style site that would run compilation tests on new commits and pull requests to allow devs to continue using the normal SCSS compiler but run CI tests against libsass.\nI think that'd be pretty bad ass. :smile: \n. \n\n",
    "ljearwood": "I'm sorry, but because of that reason I went back to using compass.\n On Mar 13, 2014 7:24 AM, \"Thomas Welton\" notifications@github.com wrote:\n\nReally want to use susy. Is libsass supposed to be up to date with the\nlatest sass version?\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/263#issuecomment-37526717\n.\n. Why not just use compass, it is not as fast, granted, but it just plain\nworks.\nOn Mar 13, 2014 4:02 PM, \"Thomas Welton\" notifications@github.com wrote:\nlibsass is significantly better. Instead of jumping ship we should be\npestering scss package developers to test their code against libsass. And\nhow off adding the new sass features until libsass can catch up.\nI'm not sure of all the new stuff in sass 3.2 yet, but I'm sure the\nauthors of susy could have written their plugin to work with libsass if\nthey had thought it was a big enough priority. So instead of using susy for\nmy grid I'm using zurb foundation as that compiles with libsass.\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/263#issuecomment-37586368\n.\n. Ruby is extremely light, you'll be fine.\nOn Mar 13, 2014 4:35 PM, \"Thomas Welton\" notifications@github.com wrote:\nHaving to install ruby just to compile css is too much on my CI server.\nNode does lots of stuff form me with gulp/grunt so I have that installed.\nRuby doesn't do anything else for me and want to cut it out of my stack.\nPlus it's much slower in comparison.\n\nOn 13 Mar 2014, at 21:19, ljearwood notifications@github.com wrote:\nWhy not just use compass, it is not as fast, granted, but it just plain\nworks.\nOn Mar 13, 2014 4:02 PM, \"Thomas Welton\" notifications@github.com\nwrote:\n\nlibsass is significantly better. Instead of jumping ship we should be\npestering scss package developers to test their code against libsass.\nAnd\nhow off adding the new sass features until libsass can catch up.\nI'm not sure of all the new stuff in sass 3.2 yet, but I'm sure the\nauthors of susy could have written their plugin to work with libsass\nif\nthey had thought it was a big enough priority. So instead of using\nsusy for\nmy grid I'm using zurb foundation as that compiles with libsass.\n\nReply to this email directly or view it on GitHub<\nhttps://github.com/hcatlin/libsass/issues/263#issuecomment-37586368>\n.\n\nReply to this email directly or view it on GitHub.\n\n\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/263#issuecomment-37589838\n.\n. \n",
    "nicetransition": "I am afraid that I might have to jump ship too.\n. Very true -- I'm looking for a solution to be used in the next week. \"jumping ship\" is extreme, but for the time being I'm going back to compass. I will continue following the issues, pushes, releases until all the parts that I use are covered.\n. From what I have seen, the dev community is pushing hard for a quick and easy rollout of Sass 3.3. This issue and other 3.3 related issues are causing some headaches and rollbacks to the previous versions of Sass. \nAs tevko asked, when can we expect Libsass to make updates?\n. :+1:  !\n. ",
    "digitaljhelms": "@lunelson thank you for sass-list-maps! :+1: :beers:\n. I haven't used Susy.\n. Agreed, feels dirty, but awesome workaround for the moment until this is fixed properly. :+1: \n. ",
    "steffenmllr": "@digitaljhelms @lunelson did you get susy working with the sass-list-maps polyfill ?\n. ",
    "itanex": "+1 for a 'compiles with libsass' badge\n. ",
    "darkwebdev": "The problem with susy is that the old version that uses sass 3.2 also needs compass and the new version that doesn't need compass requires sass 3.3 and maps.\nSo I just keep using compass and susy on old projects and use libsass with bourbon and neat on new ones. And in general: no ruby = no crossplatform-and-version-problems.\n. @kuraga just \"npm i node-bourbon\"\n. ",
    "laurelnaiad": "I don't think the issue is developers forgetting to or not bothering to test against libsass... the issue is that they want/need features that are part of Ruby SASS and not (or not yet) in libsass. No amount of testing will cause them to change the decision to use those features if it is intentionally made.  \nThat said, I'm all for the testing of sass code with libsass. I think a travis-like site to run tests of any sass code against libsass already exists -- travis itself is already capable of this, no?\n. It should be the case that you could set up a build script in node using something like gulp or grunt that executes node-sass against your sass files and evaluated the results using a testing framework.  Hook that repository up to travis and you're in business.  It will install your node npm devDependencies (of which node-sass would be one) as part of its install of your repo..... I am not familiar with how C++ repos are tested but I expect that if you wanted to test against libasss built from source (or even just straight compiled libsass with a C++ harness), that roughly the same technique would work.  I suppose that if you wanted to test libsass without the risk of hitting any node-sass issues along the way this would be a better, still doable route to go.\n. ",
    "kuraga": "+1 can't compile https://github.com/thoughtbot/bourbon without it\n. ",
    "ogbaoghene": "+1\n. @hcatlin Really appreciate this, thanks a lot to @xzyfer. What's the plan for the @each operator though, is it something in the works?\n. @designorant @xzyfer Updating grunt-sass fixed, glad no more workarounds. Thanks a lot\n. +1, it also throws an invalid property name error when used in mixins, such as:\n@mixin bem-m($modifier) {\n  &--#{$modifier} {\n    @content;\n  }\n}\n. ",
    "Goltergaul": "+1\n. ",
    "hutber": "+1\n. Interesting you couldn't reproduce it. I wonder what it could be about my set up that would cause this if its not libsass. I will look into my other processes and see if its something else causing the problem. \nthanks\n. ",
    "coxrichuk": "+1 for support sass-script maps\n. ",
    "designorant": "@ogbaoghene It's already baked in in LibSass 3.1.\nIf you're having issues, make sure you're using the latest version of either: libsass/node-sass/gulp-sass/grunt-sass. You may also need to do some light refactoring/cleaning up to get rid of some workarounds.\nOn a side note Susy 2.2.2.alpha.1 does support LibSass now.\n. ",
    "halcarleton": "sorry, false alarm, it looks like the problem is somewhere else. Still trying to work it out, but it's not libsass\n. Yeah, it was a missing underscore on a file that was supposed to be a partial.\n. ",
    "robrichard": "Maybe, but the difference here is that the word \"null\" is actually printed into the output. Also it is only happening when the compressed flag is used.\n. ",
    "nford": "Hi Chris, I see it's been removed in RC3. Would you have a link to the issue you referred to?  \"&\" isn't working well as search string.\n. +1\n. @akhleung @hcatlin would you have a rough estimate on when this ticket might be resolved? We're very keen to move our legacy SASS (with over 500 uses of this type of selector) to your compiler!\n. Fantastic, thanks for the quick reply!\n. ",
    "tobystokes": "Have tried with Sassmeister which I think is using node-sass 0.7.0, and grunt-sass which also uses node-sass. I'll try again with master and report back.\n. URLs don't need to be quoted, but that's a useful workaround for my case anyway!\n. I am on holiday, if you have urgent business, please ring the Pretty office on 020 7378 8815\n. ",
    "joelanman": "Cheers for that! I'm afraid I'm using it via node-sass, so I guess I'll have to wait for them to update\n. ",
    "kevinSuttle": "I'm going to close this for now, as I have it running on another project and fine. I'll investigate and report if I find anything of use to libsass. Thanks guys.\n. ",
    "tel": "This occurs in Bourbon HEAD.\n. ",
    "yratof": "This is still an issue a month down the line. Codekit 2.0 just launched with Libsass as an option, but using it with Bourbon causes compiling issues\nerror reading values after true\n. Strange \u2013 It seems to be working for me using sass 3.4.13 \u2013\u00a0perhaps the compiler i'm using is intervening and importing them for me. Though it wouldn't explain why libsass would error and not rubysass if Codekit is pulling the files for me...\n. Hmmm, I didn\u2019t install this myself, so i\u2019ll investigate to see if Codekit brings this with it...\n\nOn 2 Jun 2015, at 13:12, Jannik Zschiesche notifications@github.com wrote:\n@yratof https://github.com/yratof is it possible that you have installed sass-globbing https://github.com/chriseppstein/sass-globbing in your rubysass?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/sass/libsass/issues/1256#issuecomment-107932011.\n. @apfelbox Good catch there \u2013\u00a0Shame that the same process doesn't work with libsass.\n. \n",
    "jetlej": "Also seeing this issue with CodeKit and Foundation out of the box\n. ",
    "niallobrien": "Is there an update on this? Would like the use Bourbon v4 with libsass - thanks!\n. ",
    "voxpelli": "I think this feature is a bit different from many other Sass 3.3 ones. Most you can chose to not use and get no downsides from doing so.\nUsing the old Sass 3.2 way of defining globals results in tons of (valid) deprecation notices in Sass 3.3 though \u2013 while the new Sass 3.3 !global makes Sass 3.2 based preprocessors like libsass fail.\nCurrently supporting both Sass 3.3 and libsass therefore means getting lots of deprecation warnings on each compilation in Sass 3.3, making it hard to find other valid output. (True for eg. some of the unit test libraries out there \u2013 bootcamp and true \u2013 which both relies heavily on globals)\n. I would make this a pretty high priority as it, as pointed out in the above mentioned issue, is kind of blocking big frameworks like Bootstrap from using libsass at the moment. Those projects are actively discouraging any SASS-compilation using a precision less than 10.\n. @jmagnusson There's an active discussion in nex3/sass#1122 about the default, as mentioned by @glebm. I don't think libsass will want to diverge from the other Sass implementations in its default value so until Sass itself changes its default the only alternative for libsass is likely to mirror the configurability of precision that already exists in other implementations, as was initially suggested here.\n. ",
    "XhmikosR": "Yeah :+1: for this. I was experimenting with this for Ratchet but I gave up due to this and @at-root lack. For reference  https://github.com/twbs/ratchet/pull/479\n. No worries, even this is a step closer. Thanks!\n. I think this was fixed in https://github.com/sass/libsass/pull/409? If so that's awesome news :)\n. BTW, I had to remove fPIC to build without warnings under MSYS/mingw-w64.\n. Indeed. Fixed it.\n. ",
    "donaldpipowitch": "Thank you for the update!\n. Thank you for the update. I didn't used libsass directly, so I can't test it right now. (I tried it through node-sass where I reported the issue first - they directed me to libsass as the source of the bug.)\n. ",
    "quagliero": "Thanks! Bloody Node-sass ;)\n. ",
    "inlikealion": "@akhleung Are you sure this is only from the /path/with.css/string context? I am having the same issue with @import \"bower_components/inuit-layout/objects.layout\";. \nI had to fix it by explicitly adding the file extension: @import \"bower_components/inuit-layout/objects.layout.scss\";\n. Great to hear. I am using node-sass/grunt-sass, which I know are not shipping the latest libsass. I just wanted to make sure your refactoring wasn\u2019t ONLY fixing the path**.css** string. Thanks for checking into it!\n. ",
    "mirisuzanne": "Yes, please. I don't have anything to add off-hand. If there's any way to help without knowing C or Ruby, I'm happy to help out.\n. In my mind, the fact that Sass is a superset of CSS should actually make any feature determination fairly straight-forward. \nThe core \"assumed\" language is CSS. Anything we add is a Sass feature, and should be documented. Nesting is a feature, and nested media-queries are a feature if we are doing something other than outputting them directly. If nested media-queries are possible in CSS, but we still do something extra with nested queries - that extra tooling is a feature. \nIt may be common for features to disappear as they become integrated directly in CSS, but that should be something we can handle. \n. Is the not() function defined in LibSass? It doesn't seem to exist in RubySass, though it's easy enough to replicate. \nscss\n@function not($arg) {\n  @return if($arg, false, true);\n}\n. @xzyfer I added those tests to the spec. Well, I made a pull request \u2014 if that looks good I (or someone else) can merge it in.\n. If maps are supposed to be a key feature of 3.0, I'd love to see this make the cut. Looping isn't an edge case or a bonus feature \u2014 it's central to most map uses I've seen (and certainly any library use). There's a lot of excitement around 3.0, and I'd like to jump on that bandwagon, but none of my libraries can do much without looping through maps. Pretty please. :)\n. Oh, in that case I'll need to write a relaxed-compare function for Susy - because most map use-cases (settings etc) don't depend on order.\n. @xzyfer This branch passes all my basic map tests. I ran this series of tests (with the final @each loop un-commented):\ncss\n.test-each {\n  -map-get: 'yep';\n  -map-remove: 'yep';\n  -map-merge: 'yep';\n  -map-keys: 'yep';\n  -map-values: 'yep';\n  -map-has-key: 'yep';\n  -map-compare: 'yep'; }\nThat seems to fix merge, compare, and loop. I'll also run it against larger frameworks when I get a chance. Cheers! :)\n. Hey, I'm glad this makes sense! I added tests to my sass-spec PR. :)\n. I'm not \u2014 don't know a thing about C, no matter how many plusses you add. I'm just running through Susy and filing issues/tests when I run into problems. :)\n. Added tests for negative index in sass/sass-spec@f01abbf6d47ec62f\n. You kids are the coolest. \n. @xzyfer This bug seems to be only partially fixed in 3.1 (I haven't tested against 3.2). The problem still exists when you retrieve a fraction from a map. See my example on SassMeister.\n. Also, using @debug, it is impossible to tell the difference between any of these. The quotes never appear.\n. Oddly, my larger issue was fixed by changing url('#{$font-path}#{$path}') to url($font-path + $path). Does that make sense to anyone?\n. I just ran into this issue today, and wonder if it's the same thing?\n``` scss\n$function: 'hsl';\n$hue: 360;\n$value: (30%, 40%);\n.test {\n  // This doesn't work in libsass (works in ruby sass)\n  background-color: call($function, $hue, $value...);\n// This works great\n  $call: join(($function, $hue), $value);\n  color: call($call...);\n}\n// ERROR: required parameter $lightness is missing in call to function hsl on line 7 at column 21\n```\n. @xzyfer I'm seeing this error again, but only when I call core Sass functions. With custom functions, it works great. Here's a demo showing it successful with a custom function, and again with the hack listed above \u2013\u00a0but failing (in libsass only) if you unquote the call with a core function:\nhttps://www.sassmeister.com/gist/cd09d650328b8f486a5d3b31c3009225. It seems that one of my examples was bad, but the other still shows the same discrepancy. I removed the error: https://www.sassmeister.com/gist/cd09d650328b8f486a5d3b31c3009225. ",
    "lydell": "FYI: Both css-parse and postcss parse neither selectors nor declaration values (and some at-rule stuff). There is a WIP yet inactivate CSS value parser, though.\nA little idea: What about using phantomjs and the CSS object model stuff?\n. Thanks for your response! I think this is the situation:\n1. In the output a b { you map the a to a { in the original input (line 1) and the b to b { in the original input (line 3), because it is technically correct. I agree.\n2. To help browser dev tools, you added a second mapping for the a to b { in the original input (line 3). That's why there's a \"duplicate\" mapping.\n3. The .getOriginalPositionFor method of the mozilla/source-map library does not handle \"duplicate\" mappings. It takes a (line, column) pair as input and gives one as output, while it should really return an array of (line, column) pairs.\n4. PostCSS seems to add a single source mapping per selector. When merging a PostCSS source map and a Libsass source map it would help if PostCSS had made a higher-resolution source map, just like Libsass does.\nSo I guess there are several issues here:\n- PostCSS could generate better source mappings for selectors.\n- mozilla/source-map could start handling \"duplicate\" mappings.\n- Browsers could improve their source map consumption.\n- The spec could be clarified.\n- Libsass could possibly decide to optimize for what happens to work in practice, not what is correct (which would be a somewhat sad way to go.)\nFeel free to close this issue if you like.\n. ",
    "Jakobud": "What's the status of 3.3 support?\n. I was looking but didn't see any 3.3 issues. Thanks\n. Good news! I dream of a world where Libsass stays up to date with Ruby Sass.\n. ",
    "lucascosta": "Yes (source maps), but I downloaded the latest version from the master branch and replaced the LibSass folder (I'm using node-sass on grunt-sass). It seems the problem only affects long multiline comments. I replaced my file with oneline comments and multiline comments of 1 line and it gets the line right.\n. ",
    "xvoidee": "Default implementation of sassc https://github.com/hcatlin/sassc does not have option \"expanded\"\nWhen I modify sassc source code to include this keyword I get same result - brackets do not stay on next line.\n. ",
    "thedeerchild": "Bumping this up, as it's actively causing issues for the Foundation framework.\n. ",
    "jmagnusson": "Why not just increase the precision value to 10? Would that raise any issues for any projects? Any performance decreases worth mentioning?\n. Please please please merge this\n. ",
    "joeyhoer": "A simplified test case:\n.test {\n    content: '';\n}\n@import url('test.css');\nRuby Sass correctly restructures the CSS such that the @import(s) are at the top:\n@import url(\"test.css\");\n.test {\n  content: ''; }\nLibsass incorrectly produces:\n```\n.test {\n  content: ''; }\n@import url('test.css');\n```\nAs noted above the CSS spec says: \"any @import rules must precede all other rules (except the @charset rule, if present).\"\nDepending on how the Sass is structured, this bug can and will produce code where @import rules are not inserted into the CSS output correctly and are subsequently ignored. \n\nA somewhat related minor bug/difference in Libsass and Ruby Sass is the output of the following test:\n@import \"//example.com/test.css\";\nRuby Sass:\n@import \"//example.com/test.css\";\nLibsass:\n@import url(\"//example.com/test.css\");\nI don't foresee any issues arising from this bug in particular, however it is an interesting difference to note. \n. Yes, I've encounter the same issue:\n@if not false { \u2026 } // Works in Ruby Sass; does NOT work in libsass\n@if false != true  { \u2026 } // Works\n@if not(false) { \u2026 } // Works\nThis should be considered a bug, unless there is a reason for not doing so.\n. ",
    "andrade1379": "Hey guys,\nI'm also using grunt-sass and when I set the outputstyle to \"compressed\" the CSS is being commented out.\nI'd like to add a space after the comments\n*!\n * Bootstrap v3.3.5 (http://getbootstrap.com)\n * Copyright 2011-2015 Twitter, Inc.\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n *//*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}\n. ",
    "kkriehl": "Whoa, I just tried this with the \"not\" before \"unitless\" removed and it works. Looks like the combination of \"and not\" as condition operator isn't recognized as exclusion. Working example:\n``` scss\n$value: auto;\n@if type-of($value) == number and unitless($value) {\n    body {\n        background-color: red;\n    }\n}\n```\n. ",
    "runningskull": "This bug causes warnings to be spit out when using compass, because of an and not in this file\n. @utkarshkukreti that seems to have done the trick. I submitted PR #310 for it.\n. ",
    "RaptorCZ": "Zip is on my web site and will keep it online :-) Really need fix for this, because Mindscape Workbench is slow as hell.\n. ",
    "darrenkopp": "hey sorry, i didn't get any notifications from GitHub on this. Works great, thanks!\n. Yup, no worries.\n. Yeah, there isn't a better way to have it dynamically update outside of using wild cards. However, you could still use wildcards but constrain them to tighter directories, but then you get to a similar situation as the first one where adding files in new directories could cause them to not be picked up.\n. @am11 fine with me. . ",
    "Nevraeka": "@hcatlin - where can we request these features get added ? What repository or location?\n. ",
    "utkarshkukreti": "@runningskull check out my branch: https://github.com/utkarshkukreti/libsass/tree/fix-separator-in-append-and-compact\nI modified append to match the logic in http://sass-lang.com/documentation/Sass/Script/Functions.html#append-instance_method, and compact to match https://github.com/chriseppstein/compass/blob/stable/lib/compass/sass_extensions/functions/lists.rb#L18\nLet me know if it works.\n(2 tests were failing on master (and still are))\n. #308\n. I was getting the same error as OP when compiling using clang, and this patch fixed it. :+1:!\n. https://github.com/hcatlin/sassruby redirects to https://github.com/sass/ruby-libsass\n. ",
    "genexp": "Thanks!\n. Actually, this problem was with grunt-sass.  I had an entry in the files array for my task that had no corresponding source files.\n. ",
    "geelen": "Having this exact issue, and can't figure out any syntax that'll actually compile. I'd be happy with a workaround, if anyone's found one?\n. The commit that pushed the fix for later reference: https://github.com/sass/libsass/commit/5660bfe602b127f8f55c3ca0fcfafa87a7a5421b\nLanded in libsass 2.0 (I think), for my reference (why I came here), that matches up with node-sass v0.9.0\n. ",
    "jbblanchet": "I can confirm that the workaround above works. If like me you wanted to use a for loop, the following works:\n```\n$x: \"\\\"#{$i}\\\"\"\na#{\"[data-foo=\" + $x + \"]\"} {\n  width: 120px * $i;\n}\n```\n. ",
    "arian": "Thanks, seems to work for me now. Also #308 seems to be fixed with this now.\n. This is probably related to #308 and #309 \n. ",
    "Panksi": "Is this solved? can i get some example? thanks. ",
    "tevko": "Very understandable. Do you have any idea when we can expect to see those\nfeatures in Libsass?\nOn Wed, Mar 12, 2014 at 6:39 AM, sascha fuchs notifications@github.comwrote:\n\nIs a feature from Ruby-Sass 3.3. Will not work with Libsass at this time.\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/314#issuecomment-37394632\n.\n\n\nTim Evko\n//timevko.com\n. ",
    "cgarstin": "You can work around this by putting the rules that are inside the mediaquery inside another selector.\nE.g change:\n%foo {\n    @media screen and (min-width: 300px) {\n        max-width: 80%;\n    }\n}\nto:\n%foo {\n    @media screen and (min-width: 300px) {\n        &:not(fakeSelector) {\n            max-width: 80%;\n        }\n    }\n}\n. ",
    "mattborn": "@cgarstin Why have I never seen this?! While this feels like a hack, it does work.\n. ",
    "andres-torres-marroquin": "+1 on this issue\n. ",
    "lilymartinez": "+1 \n. ",
    "webinsation": "Hey guys there is a better cleaner way. Just use this:\n%foo {\n    @media screen and (min-width: 300px) {\n        & {\n            max-width: 80%;\n        }\n    }\n}\nHope this helps all you libsassers trying to get it working!\n. ",
    "kaminogi": "Please fix this.\n. ",
    "nathanhammond": "The full collection of use cases for people who stumble across this is documented here: https://github.com/nex3/sass/issues/1094\n. There has to be a better way. This should somewhere register a list of all the prefixes and follow the appropriate parsing behavior everywhere.\n. ",
    "rnarian": "I'm getting a 3.3 related error too:\nerror: invalid selector after &\nMy code looks something like this:\n.element {\n  (...)\n  &__item {\n    position: absolute;\n  }\n}\n. Sent from my iPhone\nOn Sat, May 3, 2014 at 3:53 PM, Hampton Catlin notifications@github.com\nwrote:\n\nSo, there is no such thing as \"3.3 syntax support\", exactly. It's a whole\nset of features and changes. Maps (not source maps) are a major syntax\nchange in 3.3.\nFrom the example above, it seems that you are referring to using the parent\nselector to implement BEM-style approaches?\nAka, what is described here:\nhttp://www.alwaystwisted.com/post.php?s=2014-02-27-even-easier-bem-ing-with-sass-33\nIs that what this ticket is in reference to? If so, it looks pretty simple\nto implement @akhleung.\nOn Sat, May 3, 2014 at 9:08 AM, Dominic notifications@github.com wrote:\n\nI added bounty here because 3.3 syntax support (for the BEM approach,\nspecifically) is important to me and something I'd like to see in libsass\nbefore Maps (source maps I'm guessing? I don't use them and possibly never\nwill) or anything other feature. This feature would make my life a heap\neasier and I'd like to support (albeit in a small way via adding to the\nbounty) if I can.\n\nReply to this email directly or view it on GitHubhttps://github.com/hcatlin/libsass/issues/319#issuecomment-42104639\n.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/hcatlin/libsass/issues/319#issuecomment-42105519\n. \n\n",
    "renege": "+1!\n. ",
    "mmikkel": "+1\n. ",
    "homerjam": "+1\nI would \u2665\ufe0e 3.3 support\n. Nothing says +1 like a backed bounty, just sayin'\n. ",
    "LostCrew": "+1\n. ",
    "Jaspur": "+1\n. ",
    "zymara": "+1\n. ",
    "lancedikson": "+1\n. ",
    "seocamo": "+1\n. ",
    "szarouski": "+1\n. ",
    "Murmurianez": "+1bem-bem-bem-bem-bem\n. ",
    "nikpachoo": "+1\n. ",
    "dominicwhittle": "+1 (and a few $$$ on the bounty)\n. I added bounty here because 3.3 syntax support (for the BEM approach, specifically) is important to me and something I'd like to see in libsass before Maps (source maps I'm guessing? I don't use them and possibly never will) or any other feature. This would make my life a heap easier and I'd like to support (albeit in a small way via adding to the bounty) if I can. \n. @hcatlin Yes, the .block { &__element { ... } &--modifier { ... } } syntax in the article you linked to is what I'm referring to. \nI'd guess that just about everyone who +1ed this issue after @rnarian's initial comment are on the same page. \n. Flip'n awesome! Any word on how this propagates into node-sass? (And ends up in gulp-sass in my case.)\n. Thanks @akhleung \n. ",
    "pwalczyszyn": "+1\n. ",
    "davidyezsetz": "+1\n. ",
    "superfunkminister": "+1\n. ",
    "frankbaele": "+1\n. ",
    "Ne-Ne": "Sounds great! +1\n. Thanks for the reply @nschonni. Is there any idea of what version Libsass is currently at?\nDoes anyone have a linky for the thread ref above....\n. ",
    "aludvigsen": "The &_item or &-item selector would be really nice!\n. ",
    "w0rm": "+1 really need this\n. ",
    "fallingfree": "+1\n. ",
    "ilanbiala": "+1\n. ",
    "dani-z": "A must +1\n. ",
    "joelworsham": "Would love to see this supported as well. Libsass is awesome btw.\n. Any array map I try to create gives me an error like:\nerror: error reading values after...\nLike:\n$map: (foo: bar, bar: baz);\ngives me:\nerror: error reading values after foo\n. Hmmm.\nI'm using grunt, and grunt-sass, and I did an \"npm update\" in my project. How can I check my libsass version?\n. Here's some info about my project:\nUsing Foundation CSS framework SCSS by Zurb. Using Normalize (important from SCSS), http://git.io/normalize.\nMain.scss\n```\n// Vendor\n@import \"../vendor/css/normalize\";\n// Deps\n@import \"settings.scss\";\n// Foundation\n// Here we control all of the various foundation components to use\n@import \"../vendor/sass/foundation/components/visibility\";\n@import \"../vendor/sass/foundation/components/clearing\";\n@import \"../vendor/sass/foundation/components/grid\";\n@import \"../vendor/sass/foundation/components/buttons\";\n@import \"../vendor/sass/foundation/components/type\";\n@import \"../vendor/sass/foundation/components/forms\";\n// Setup\n@import \"base\";\n// Static\n@import \"static/header\";\n@import \"static/footer\";\n// Templates\n@import \"templates/single-post\";\n@import \"templates/page\";\n@import \"templates/common\";\n// Overrides\n@import \"wp\";\n```\n. ",
    "lanskey": "+1\n. ",
    "airtonix": "Got this working like so : \nhttp://sassmeister.com/gist/9783557\n. ",
    "joneff": "It's either related to or the same issue I have: concatenating strings with quotes. Originally I thought it was WE issue (the one referenced by @am11).\n\nWith following file\n``` scss\n$q: '\"'; // double quote in single quotes\n$qq: unquote( $q ); // unquoted version of double quote\n$p1: unquote(\"(\"); // just a brace\n$p2: unquote(\")\"); // another brace\n$c: \"something\"; // a string in quotes\n$cc: unquote( $c ); // the same thing no quotes\nbody {\n    / Plain string /\n    test: $c;\n    test: $cc;\n/* quotes on both ends */\ntest: $q + $c + $q;\ntest: $qq + $c + $qq;\ntest: $q + $cc + $q;\ntest: $qq + $cc + $qq;\n\n/* leading and trailing quotes */\ntest: $q + $c;\ntest: $qq + $c;\ntest: $q + $cc;\ntest: $qq + $cc;\ntest: $c + $q;\ntest: $cc + $q;\n\n/* Other combos */\ntest: $p1 + $q + $c + $q + $p2;\ntest: $q + $p1 + $p2;\ntest: p + $q + p;\n\n/* Quotes */\ntest: $q;\ntest: $q + $q;\ntest: $q + $c + $q;\ntest: $p1 + $q + test + $q + $p2;\ntest: $q + $p1 + test + $p2 + $q;\n\n}\n```\nCss output from gem sass\ncss\nbody {\n  /* Plain string */\n  test: \"something\";\n  test: something;\n  /* quotes on both ends */\n  test: '\"something\"';\n  test: \"something\";\n  test: '\"something\"';\n  test: \"something\";\n  /* leading and trailing quotes */\n  test: '\"something';\n  test: \"something;\n  test: '\"something';\n  test: \"something;\n  test: 'something\"';\n  test: something\";\n  /* Other combos */\n  test: (\"something\");\n  test: '\"()';\n  test: p\"p;\n  /* Quotes */\n  test: '\"';\n  test: '\"\"';\n  test: '\"something\"';\n  test: (\"test\");\n  test: '\"(test)\"'; }\nOutput from nodesass (which uses libsass)\ncss\nbody {\n  /* Plain string */\n  test: \"something\";\n  test: something;\n  /* quotes on both ends */\n  test: \"something\";\n  test: \"something\";\n  test: \"something\";\n  test: \"something\";\n  /* leading and trailing quotes */\n  test: \"something;\n  test: \"something\";\n  test: \"something;\n  test: \"something\";\n  test: \"something\\\"\";\n  test: something\";\n  /* Other combos */\n  test: (\"something\");\n  test: \"();\n  test: p\"p;\n  /* Quotes */\n  test: '\"';\n  test: \"\";\n  test: \"something\";\n  test: (\"test\");\n  test: \"(test)\"; }\nNow some quote collapsing is expected, for instance concatenating '\"' and \"string\". but what strikes me as unusual is that unquoted string is concatenated with a quote, the latter is collapsed / trimmed. Also, libsass (nodesass) tends to add a closing quote a lot more often.\n. what's interesting is the way single selectors are treated:\nsass\n.outer {\n    $sel: &;\n    @debug $sel;\n}\n// => (outer,)\n.outer,\n.outer {\n    $sel: &;\n    @debug $sel;\n}\n// => outer, outer\nInterestingly enough, node_sass does not suffer from that artefact, only rubysass...\n. ",
    "booleanbetrayal": ":+1: \n. +1\n. +1\n. +1\n. ",
    "adam-beck": ":+1: \n. ",
    "mike-spainhower": ":+1:  Just ran into this.\n. Thanks @mgreter :heart: \n. ",
    "hellatan": "@tevko your codepen link doesn't seem to work.  I think i know what your issue is though and it looks like it's fixed with the latest compiled version of sassc and the latest version of libsass.  This gist shows it compiling:\n```\n%holder {\ncolor: green;\n    &:hover {\n        color: red;\n    }\n}\n.class-1 {\n    @extend %holder;\n}\n.class-2 {\n    @extend .class-1;\n}\n```\noutputs\n.class-1, .class-2 {\n  color: green; }\n  .class-1:hover, .class-2:hover {\n    color: red; }\n. @forestbelton i think this is fixed now.  You may need to get the latest sassc version and recompile with the latest libsass.  I was having this same issue with an older compiled version but I just recompiled everything today and it seems to be working.  I was also testing this out on sassmeister which now supports libsass.  The output there seems to be what you're trying to accomplish.\n. whoops.  i accidentally had sass 3.3.5 used for compiling the output.  Correctly using the libsass option, the output is more like this:\n.a > .child, .a > .b, .a > .b {\n    color: #fff;\n}\nit is strange that it does output the same .a > .b selector twice.\n. ",
    "keithamus": "node-sass could indeed use more tagable versions. Issues constantly surface asking us to update to master. Would be nice to have a hard line and only update to tagged versions.\n. ",
    "thehydroimpulse": "Getting the same issue.\n. @akhleung \nThe issue is the flex rules. Commenting them out fixes the issue.\n``` scss\n.assignment-header {\n  display: flex;\n}\n.assignment-header-left {\n  flex: 0 0 42px;\n  background: url(navbar-button-back@2x.png) 50% 50% no-repeat;\n  background-size: 40%;\n  width: 30px;\n  height: 30px;\n  opacity: 0.6;\na {\n    display: block;\n    padding: 20px;\n  }\n}\n.assignment-header-title {\n  flex: 1 0 auto;\n  text-align: center;\nwidth: 235px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.assignment-header-right {\n  flex: 0 0 42px;\n}\n```\n. That's the whole file that I passed in for compilation. Trying it out directly with libsass and node-sass results in everything working fine. The only weird thing is the exception being thrown, but, like you said, the newest versions might not have been pulled. \n. ",
    "pasviegas": "Same issue. Anyone solved?\n. ",
    "blimmer": "I'm seeing this issue in my project now, too. It's non-deterministic, unforutnatley. If I keep running my start task via Brunch + NPM, it works about 80% of the time.\n. ",
    "aramix": "having the same issue... anyone found any solution or a workaround for this? :(\n. changing all return string() to return \"\" fixed the problem for me\n. ",
    "kevinmeredith": "upgrading fixed this issue for me too - http://stackoverflow.com/a/14001583/409976\n. ",
    "sym3tri": "That's a valid argument, but I it's also valid to request font_path as long as image_path is supported.\n. ",
    "forestbelton": "Yeah, even stranger, since the output is not only missing selectors but outputting wrong ones too.\n. ",
    "nongio-zz": "here a gist to reproduce the error: https://gist.github.com/nongio/a04a0bdbdb87c3e36fe4\n. Is anyone working on this issue? I would like to start contribute. If there is any WIP I would like to give my help.\n. ",
    "zakj": "146 seems to be where all the @extend-related action is.\n. ",
    "zaius": ":thumbsup: \nWorking perfectly. Thanks for the fix!\n. ",
    "mweibel": ":+1: for some fix for this issue.\n. ",
    "dpoindexter": "I'm also interested in the answer to this question. This would be great for doing incremental builds and integrating with other tools.\nFor comparison, Sass appears to support this via its API and it looks like it will be integrated into the command line util in the future: https://github.com/sass/sass/issues/809\n. ",
    "Munter": "+1 from me on this.\nIt's a big blocker from making more efficient tools that can set up intelligent file watchers based on the actual code needed.\nWhat we do now is put the burden of flattening this dependency graph into a config file for the end user of the tools if they want efficient recompilations, or even worse, just watch and recompile everything on any change of anything.\n. +1 from me. I'd really like access to the AST for being able to map a proper dependency graph\n. I solved my immediate problems by accepting that sass is a black box. Luckily libsass has a stats object you can pass in, which it fills with the files that were included in the build. No proper dependency tree, ast node reference or anything, but it solved my problem of setting up file watchers automatically on any file that might be of interest\n. ",
    "derekprior": "I'm getting this with a clean install of node-sass. Is there a version of libsass/node-sass that I can revert to to get around this?\n. ",
    "JakeChampion": "Moving the all media feature keyword into the variable resolves the parsing/compilation error.\n``` scss\n$mediaquery: 'all and (min-width: 300px)';\n@media #{$mediaquery} {\n  div {\n    display: block;\n  }\n}\n```\ncss\n@media all and (min-width: 300px) {\n  div {\n    display: block; } }\n. ",
    "sta1r": "I've tried loud comments but they don't output either. I believe this may relate to #291 - in which case I guess I can override the version of libsass in grunt-sass?\n. ",
    "hilja": "Loud comment would be amazing, WordPress want's to have a theme declaration in the CSS file as a comment.\n. What ever gulp-sass used, I assume it was 3.1. I'll do some more tests. Thanks for the answer!\n. Actually, how do I use sassc? I installed libsass with the instruction, but I can't really figure out how to get sassc running... Read the docs but I'm missing something.\n. @drewwells is the 3.1 libsass on tap?\n. Okay I managed to locate libsass 3.1.0 formula and got it installed and ran the same project. Strangely, sassc was yelling me about scut, although the path is 100% right and it works with node-sass. Here's the error:\n```\n$ sassc style.scss style-sassc.css\nError: file to import not found or unreadable: bower_components/scut/dist/_scut.scss\n       Current dir: /Users/hilja/web/vagrants/vvv/www/example/htdocs/content/themes/cm/src/sass/\n        on line 12 of style.scss\n\n\n'bower_components/scut/dist/_scut.scss',\n   ^\n```\n\n\nSo the speed is not compatible with the node-sass test because there are less files (I had to remove two other files that used scut mixins), but nonetheless the two sassc test are identical. Weirdly also after installing the 3.1.0 $ sascc -v showed the libsass version to be 3.0.3, so I tested with that.\nHeres the results from the first test:\n```\n$ sassc -v\nsassc: 3.2.1\nlibsass: 3.2.4\nsass2scss: 1.0.3\n$ for i in {1..10}; do ./sass-test.sh; done\nTime in nanoseconds: 172700000\nPretty format: 00:00:00:00.172\n\nTime in nanoseconds: 105256000\nPretty format: 00:00:00:00.105\n\nTime in nanoseconds: 106497000\nPretty format: 00:00:00:00.106\n\nTime in nanoseconds: 105511000\nPretty format: 00:00:00:00.105\n\nTime in nanoseconds: 109372000\nPretty format: 00:00:00:00.109\n\nTime in nanoseconds: 101441000\nPretty format: 00:00:00:00.101\n\nTime in nanoseconds: 104064000\nPretty format: 00:00:00:00.104\n\nTime in nanoseconds: 104616000\nPretty format: 00:00:00:00.104\n\nTime in nanoseconds: 103924000\nPretty format: 00:00:00:00.103\n\nTime in nanoseconds: 106928000\nPretty format: 00:00:00:00.106\n\n```\nAnd here's for the 3.0.3 (drumroll):\n```\n$ sassc -v\nsassc: 3.2.1\nlibsass: 3.0.3\nsass2scss: 1.0.3\n$ for i in {1..10}; do ./sass-test.sh; done\nTime in nanoseconds: 91442000\nPretty format: 00:00:00:00.091\n\nTime in nanoseconds: 73716000\nPretty format: 00:00:00:00.073\n\nTime in nanoseconds: 69278000\nPretty format: 00:00:00:00.069\n\nTime in nanoseconds: 67914000\nPretty format: 00:00:00:00.067\n\nTime in nanoseconds: 69215000\nPretty format: 00:00:00:00.069\n\nTime in nanoseconds: 71606000\nPretty format: 00:00:00:00.071\n\nTime in nanoseconds: 68391000\nPretty format: 00:00:00:00.068\n\nTime in nanoseconds: 72726000\nPretty format: 00:00:00:00.072\n\nTime in nanoseconds: 69080000\nPretty format: 00:00:00:00.069\n\nTime in nanoseconds: 70013000\nPretty format: 00:00:00:00.070\n\n```\n3.0.3 seems to be faster. I'm not expert on these matters and my test setup probably wasn't laboratory quality, but seemingly there's a little difference.\nLibsass also seems to be even faster without Node in between :)\n. @xzyfer Cool. I can test more with SassC on a bigger project, if that's needed.\n. @drewwells :+1: \n. ",
    "iodic": ":+1:  for loud comments. I am using libsass in CodeKit and also need loud comments for WordPress themes. :)\n. ",
    "sethta": "+1 also for loud comments. As mentioned earlier, it's needed for WordPress themes.\n. ",
    "jonmspencer": "+1 Keep loud comments!\n. ",
    "nsams": "ok, I hope you can find a proper fix for the problem - this bug currently breaks suzyone.\n. @davidtheclark this is about not operator vs. not function\n. see my almost identical patch #349 and why akhleung rejected it.\nsee also the open issue #368 for this bug\n. sourcemaps contains all imported files, you can probably use that.\n. nice to see work on that, but this breaks https://github.com/sass/sass-spec/pull/95 (wich is not yet merged)\nSame issue as with https://github.com/sass/libsass/pull/349 I think - I tried to work around that in https://github.com/sass/libsass/pull/562\n. This is not correct - https://github.com/sass/sass-spec/pull/95 was passing\n. ha - finally!\ntanks a lot!\n. ",
    "reezer": "It appears to happen whenever I use a variable. My minimal example is a file like this:\n.slider--edit\n{\n  color: $white;\n}\nOther files work fine and the problem arises only on FreeBSD.\n. Tracked this down to the compiler. Looks like my GCC-47 had problems. I switched to clang (which is a good thing to do in recent FreeBSD versions anway). Now it works.\n. Same here. Only got it working with clang. Might be related to mixing node or so being compiled with clang and libsass with GCC. Maybe it would make sense to always use the system CC.\n. ",
    "prydie": "I'm also seeing this issue via node-sass with FreeBSD 10.1 and GCC 4.8.3. I've got it working using CXX=clang++, however it would be good to maintain support for GCC.\n$ uname -a\nFreeBSD graves 10.1-RELEASE FreeBSD 10.1-RELEASE #0 r274401: Tue Nov 11 21:02:49 UTC 2014     root@releng1.nyi.freebsd.org:/usr/obj/usr/src/sys/GENERIC  amd64\n$ g++48 --version\ng++48 (FreeBSD Ports Collection) 4.8.3\n```\n0  0x000000080223a6ca in thr_kill () from /lib/libc.so.7\n1  0x000000080230f149 in abort () from /lib/libc.so.7\n2  0x0000000801d9e42d in __cxa_rethrow () from /lib/libcxxrt.so.1\n3  0x00000008040b0bd5 in Sass::Parser::error () from /srv/django/rocketpod.co.uk/node_modules/gulp-sass/node_modules/node-sass/bin/freebsd-x64-v8-3.14/binding.node\n4  0x00000008040c6ae3 in Sass::Parser::parse_import () from /srv/django/rocketpod.co.uk/node_modules/gulp-sass/node_modules/node-sass/bin/freebsd-x64-v8-3.14/binding.node\n```\n. Actually, yes that makes a lot more sense.\n. ",
    "mikeebee": "Do we know if support for this has been added with the release of version 3.0?\n. @mzgol ok, thanks!\n. Couple of reasons:\n1. I had similar errors when trying something like this before, and it was a bug in LibSass.\n2. Since it was functioning on Codepen, using Sass, I assumed it would work if copied into my environment. \nSound ok?\n. Ah, must be an issue with my setup as I copied the code directly.\nThanks for your input!\n. ",
    "wintercounter": "SassMeister was using 3.1 beta for a little bit and tried it.\nTest Code:\n``` scss\n.outer {\n  content: 'outer';\n@at-root {\n    .inner {\n      content: 'inner';\n    }\n  }\n}\n```\nWrong Output:\ncss\n.outer {\n  content: 'outer';\n  @at-root {\n    .inner {\n      content: 'inner'; } }\n }\nExpected:\ncss\n.outer {\n  content: 'outer';\n}\n.inner {\n  content: 'inner';\n}\n. Awesome, keep up the good work! Libsass is a holy grail for me because it's performance. I still achieved 10 sec compilation time because of the huge codebase and many (not kidding, thousands) of map-get. (I know it has improvements in 3.1 but node-sass has still only 3.0). With the Ruby compiler this was around 40-50 sec, you can imagine how funny is that to work with :D \n. ",
    "dawidk92": "+1\n. It works! Thanks a lot :)\n. ? Issue #551 is about other problem\n. ",
    "sp90": "So is this usable now?\n. When is 3.2 expected to release - do we have any timespand at this time?\n. ",
    "ciampo": "Any update on this?\n. @mzgol Having some issues while compiling the sass through gulp-sass, but I guess the problem is the gulp-sass not using an updated version of node-sass\n. @mzgol you're actually right, just realised we were using an outdated version of  gulp-sass - all fixed. Sorry and thanks!\n. ",
    "sergiomcalzada": "Hello, the file is here.\nBut the compiler Mindscape Web Workbench does not have problems compiling it.\nThanks you.\n. ",
    "KingScooty": "Sorry to repeat the question, but will libsass 2 support Bourbon 4.x? Or is it still only Bourbon 3.x?\n. ",
    "samu": "Hi all,\ni tried to use this new feature, but it does not seem to work. Check out https://github.com/sass/node-sass/issues/450 for more info.\nUpdate: Turns out the syntax I used over there was invalid anyways. Sorry for the noise :]\n. ",
    "gamb": "Thanks! For the workaround too :+1:\n. ",
    "bluegray": "not() seems to work in libsass and ruby sass. Although I don't see anything in the sass docs.\nhttp://sassmeister.com/gist/42b6684201b55a154c07\n. ",
    "davidtheclark": "\nSassScript supports and, or, and not operators for boolean values.\n\nhttp://sass-lang.com/documentation/file.SASS_REFERENCE.html#boolean_operations\n. Ah, I see the confusion now. My mistake.\n. ",
    "micha149": "Awesome. Got insane about this. not true is not false :sweat: \n. ",
    "rivy": "You beat me to it. I was just committing the changes to my copy.\nI've got a couple of other small changes that I'll put into a couple of\npull requests. They fix some minor niggles that cause compiler warnings.\n On Jun 2, 2014 1:27 PM, \"Aaron Leung\" notifications@github.com wrote:\n\nOkay, changed the binary literals to hex literals. Please give it a try.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/hcatlin/libsass/issues/372#issuecomment-44873644.\n. I just submitted two pull requests.\n\nThe first was my solution for replacing the bit literals. It differs from\nyours by using bit shifted integers which I thought preserved the\nmeaning/context of the constants. I thought it might be worth a look. Feel\nfree to refuse the pull if you like your change better.\nThe second just adds end of file newlines to a few problematic file which\nwere causing compiler warnings for me (very minor stuff).\nI've got a third set of changes (a comment modification, and adding\nunsigned specifiers to position variables to avoid signed/unsigned\ncomparison warnings). But those changes are to the sass2scss/sass2scss.cpp\nfile which you have as a submodule. I'll try to find the repo for that one\nand submit the changes to them. I included the diff below if you're curious:\nWith all three change sets, I get a completely clean, warning free compile\nusing gcc v4.2.1 on a QNAP NAS.\nCheers.\nRoy\n=== cut\ndiff --git a/sass2scss.cpp b/sass2scss.cpp\nindex a5100cb..9aa4304 100644\n--- a/sass2scss.cpp\n+++ b/sass2scss.cpp\n@@ -5,16 +5,16 @@\n #include \n #include \n-/*\n\nsrc comments: comments in sass syntax (staring with //)\n\n-    css comments: multiline comments in css syntax (starting with /*)\n\nKEEP_COMMENT: keep src comments in the resulting css code\nSTRIP_COMMENT: strip out all comments (either src or css)\n\n-    CONVERT_COMMENT: convert all src comments to css comments\n-/\n+///\n+//\n+//    src comments: comments in sass syntax (staring with //)\n+//    css comments: multiline comments in css syntax (starting with /)\n+//\n+//    KEEP_COMMENT: keep src comments in the resulting css code\n+//    STRIP_COMMENT: strip out all comments (either src or css)\n+//    CONVERT_COMMENT: convert all src comments to css comments\n+//\n+///\n// our own header\n #include \"sass2scss.h\"\n@@ -76,7 +76,7 @@ namespace Sass\n         converter.whitespace = \"\";\n// remove possible newlines from string\n-        int pos_right = sass.find_last_not_of(\"\\n\\r\");\n- ```\n     unsigned int pos_right = sass.find_last_not_of(\"\\n\\r\");\n   if (pos_right == string::npos) return scss;\n// get the linefeeds from the string\n  ```\n@@ -90,7 +90,7 @@ namespace Sass\n       if (PRETTIFY(converter) == 0)\n       {\n           // remove leading whitespace and update string\n-            int pos_left = sass.find_first_not_of(\" \\t\\n\\v\\f\\r\");\n-            unsigned int pos_left = sass.find_first_not_of(\" \\t\\n\\v\\f\\r\");\n           if (pos_left != string::npos) sass = sass.substr(pos_left);\n       }\n@@ -111,8 +111,8 @@ namespace Sass\n         string scss = \"\";\n// get postion of first meaningfull character in string\n-        int pos_left = sass.find_first_not_of(\" \\t\\n\\v\\f\\r\");\n-        int pos_right = sass.find_last_not_of(\" \\t\\n\\v\\f\\r\");\n-        unsigned int pos_left = sass.find_first_not_of(\" \\t\\n\\v\\f\\r\");\n- ```\n     //unsigned int pos_right = sass.find_last_not_of(\" \\t\\n\\v\\f\\r\");\n// special case for final run\n   if (converter.end_of_file) pos_left = 0;\n  ```\n@@ -281,7 +281,7 @@ namespace Sass\n           }\n// get postion of last meaningfull char\n-            int pos_right = sass.find_last_not_of(\" \\t\\n\\v\\f\\r\");\n- ```\n         unsigned int pos_right = sass.find_last_not_of(\" \\t\\n\\v\\f\\r\");\n   // check for invalid result\n   if (pos_right != string::npos)\n\n```\nOn Mon, Jun 2, 2014 at 1:48 PM, Aaron Leung notifications@github.com\nwrote:\n\nGreat, looking forward to it!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/hcatlin/libsass/issues/372#issuecomment-44875866.\n. Whoops!\n\nI forgot to include a tiny change to context.cpp to fix a minor issue of\nmember initialization order.\nI submitted a third pull request.\nNow, with those three changesets (and the sass2scss change), I get a clean,\nwarning-free compile (gcc v4.2.1, QNAP TS-1679).\nRoy\nOn Mon, Jun 2, 2014 at 1:48 PM, Aaron Leung notifications@github.com\nwrote:\n\nGreat, looking forward to it!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/hcatlin/libsass/issues/372#issuecomment-44875866.\n. Great!\n\nI thought size_t would be more appropriate as well, but I didn't look far\nenough to see if there were any potential negative values used.\nThanks for updating it.\nRoy\nOn Jun 3, 2014 12:20 PM, \"Marcel Greter\" notifications@github.com wrote:\n\nHi @rivy https://github.com/rivy\nI'm the \"maintainer\" of sass2scss and just updated my repository with your\nsuggestions!\nAlthough I replaced all the ints with size_t, as IMO this should be the\ncorrect type.\nI'm really not a real-world c++ coder, so I hope that this compiles\nwithout warning!\nmgreter/sass2scss@0dbfb8f\nhttps://github.com/mgreter/sass2scss/commit/0dbfb8fe7fa724776e01844ac565a16653ad2162\nhttp://www.cplusplus.com/reference/cstring/size_t/\nhttp://www.cplusplus.com/reference/string/string/npos/\nBest regards\nMarcel\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/hcatlin/libsass/issues/372#issuecomment-44994005.\n. Yeah, I commented that line out. I thought it was in the diff.\nOn Jun 3, 2014 2:38 PM, \"Aaron Leung\" notifications@github.com wrote:\nI still get a warning about an unused variable pos_right, but otherwise\nit looks good.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/hcatlin/libsass/issues/372#issuecomment-45010422.\n. Yes, but there is some discussion about changing it to another default (maybe 10, or maybe lower to 3, it isn't clear; see see [Default precision too low] sass/sass issue #1122 @ https://github.com/sass/sass/issues/1122).\n\nBy initializing it to 0 (as was being done, just implicitly), precision picks up the current sass default (even if it changes in the future).\nOn Jun 22, 2014 8:14 PM, \"Nick Schonning\" notifications@github.com wrote:\n\nIn emscripten_wrapper.cpp:\n\n@@ -18,6 +18,7 @@ char *sass_compile_emscripten(\n   options.output_style = output_style;\n   options.image_path = NULL;\n   options.include_paths = include_paths;\n-  options.precision = 0; // 0 => use sass default numeric precision\n\nDefault is actually 5,\nhttps://github.com/sass/sass/blob/2045a314e2fcd2a5f32d358a4ba57409089e6372/lib/sass/script/value/number.rb#L37\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/416/files#r14058252.\n. \n",
    "wadehammes": "@akhleung @hcatlin that is what I thought, honestly not completely up-to-date on maps yet, so wasn't really sure what this issue pertained to. Thanks for the clarification, and love all the new stuff!\n. ",
    "vektah": "@xzyfer There are two nice approaches mentioned here: https://sourceware.org/ml/libc-help/2011-04/msg00034.html\nNamely: \n- build a gcc 4.9 cross compiler that targets the version of glibc on centos.\n- build a recent gcc in a centos vm/docker environment and use that to link against the old version of gcc. \nResultant executable should run on both new and old versions of glibc.\n. Turns out options 2 is pretty damn easy with docker.\ncreate a Dockerfile:\n```\nFROM centos:6\nRUN curl -SL http://people.centos.org/tru/devtools-1.1/devtools-1.1.repo > /etc/yum.repos.d/devtools-1.1.repo\nRUN curl -sL https://rpm.nodesource.com/setup | bash -\nRUN yum --enablerepo=testing-1.1-devtools-6 install -y devtoolset-1.1-gcc devtoolset-1.1-gcc-c++ nodejs git\nRUN git clone https://github.com/sass/node-sass\nWORKDIR /node-sass\nRUN npm install\nRUN git submodule update --init --recursive\nRUN PATH=\"/opt/centos/devtoolset-1.1/root/usr/bin/:$PATH\" node scripts/build.js\n```\nthen run:\ndocker build . -tag node-sass-bin\ndocker run node-sass-bin cat /node-sass/vendor/linux-x64-11/binding.node > binding.node\nThe resulting binding.node is linked against the older glibc and runs on both ubuntu and centos6!\n. Surprisingly, it will work. One binary spanning 8 years of linux:\nModified Dockerfile:\n```\nFROM centos:5\nRUN yum install -y curl git make\nRUN rpm -ivh http://dl.fedoraproject.org/pub/epel/5/x86_64/epel-release-5-4.noarch.rpm\nRUN curl -SL https://rpm.nodesource.com/setup | bash -\nRUN curl -SL http://people.centos.org/tru/devtools/devtools.repo > /etc/yum.repos.d/devtools.repo\nRUN yum --enablerepo=testing-devtools-5 install -y devtoolset-1.0 nodejs\nRUN git clone https://github.com/sass/node-sass\nWORKDIR /node-sass\nRUN npm install\nRUN git submodule update --init --recursive\nRUN rm /usr/bin/python && ln -s /usr/bin/python26 /usr/bin/python # This centos install is probably toast at this point... It will break yum and other things from here out.\nRUN PATH=\"/opt/centos/devtoolset-1.0/root/usr/bin:$PATH\" node scripts/build.js\n```\n[root@8839b0c4d367 node-sass]# cat /etc/redhat-release \nCentOS release 5.11 (Final)\n[root@8839b0c4d367 node-sass]# ./bin/node-sass --output-style compressed foo.scss \nbody{font:100% Helvetica,sans-serif;color:#333}\nand same binding.node:\n% cat /etc/lsb-release \nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=14.10\nDISTRIB_CODENAME=utopic\nDISTRIB_DESCRIPTION=\"Ubuntu 14.10\"\n% ./bin/node-sass --output-style compressed foo.scss \nbody{font:100% Helvetica,sans-serif;color:#333}\n. @am11 The curl does not install gcc it just adds another repo\nyum --enablerepo=testing-devtools-5 install -y devtoolset-1.0\nInstalls g++ in /opt:\n[root@5f5088f9baa3 node-sass]# /opt/centos/devtoolset-1.0/root/usr/bin/g++ --version\ng++ (GCC) 4.7.0 20120507 (Red Hat 4.7.0-5)\nCopyright (C) 2012 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\nIts not the newest, but it does compile master.\nIt also does not change the system version of gcc, so both can be installed side by side in a normal centos distro.\n@QuLogic I assumed there was a better way of doing that, but didn't go looking. Sadly it does not seem to work:\nStep 10 : RUN scl enable python26 bash\n ---> Running in dd8b486efc27\nUnable to open /etc/scl/prefixes/python26!\nThe docker images are pretty minimal, as you can see I needed to install curl. \nThe comment probably applies either way as things like yum have #!/usr/bin/python.\n. ",
    "parris": "I think node-sass just needs a version bump. Sorry for the alarm. Thanks!\n. ",
    "nmec": "I am getting the same error with the following:\nscss\n.tabs {\n    @each $slug, $color in (alpha, #babdc7), (bravo, #7c459b), (charlie, #49c8f5) {\n        &.#{$slug} {\n            border-bottom-color: $color;\n        }\n    }\n}\nOutput is correct when I run the same through SassMeister.com\n. ",
    "kornelski": "Hmm, do you think cast to double would be better?\n. Bummer :(\n. #399 is a workaround for this.\n. No rush, I guess I need to update tests first :)\n. Sorry, I don't have time to rework this, so I'm closing the PR.\n. ",
    "paazmaya": "Could be related to https://github.com/mgreter/sass2scss/issues/3 which is now fixed.\n. @sibsfinx could you confirm with the latest libsass/sass2scss development versions against your code, if the issue has been fixed?\n. Actually, the following Sass fails on the last selector combination, while the first two works, perhaps as they are separate:\nsass\n::selection\n  color: rebeccapurple\n::-webkit-selection\n  color: rebeccapurple\n::-webkit-selection, ::selection\n  color: rebeccapurple\ntesting.sass:5: error: invalid top-level expression\n. Seems that my example is now working with the latest sass2scss code, thank you for the quick fix.\n. @matthewmcvickar you would need to build from the latest development sources, AKA master at Github, for each of the projects and then link them together.\n. Just a quick note, I compiled and/or used the latest Git versions available of the given stack but the same error....\n. Fixed in https://github.com/mgreter/sass2scss/commit/59cec07b2968a419ab6d2059c423df512d21d8ad\n. Duplicate of #404 \n. Please note that this is while the selectors are nested.\nThe error message becomes the following when the selectors are directly in root:\nerror: invalid top-level expression\n. The error messages are printed at lines\nhttps://github.com/sass/libsass/blob/master/parser.cpp#L739\nand\nhttps://github.com/sass/libsass/blob/master/parser.cpp#L111\nPerhaps there should be a check for empty selector, which than could be ignored?\nThe current version of Ruby Sass ignores them.\n. Great! Thanks again\n. Thank you for the quick fix!\nI have a lot of Sass code to go though so in the next few days there will come more issues like this on the surface...\n. @extend\n. There is also @return, but not sure if it needs special care otherwise...\n. Quickly tested by similarly ignoring @return and got the expected CSS result.\nUsed http://sass-lang.com/documentation/file.SASS_REFERENCE.html#function_directives example, as Sass:\n``` sass\n$grid-width: 40px\n$gutter-width: 10px\n@function grid-width($n)\n  @return $n * $grid-width + ($n - 1) * $gutter-width\nsidebar\nwidth: grid-width(5)\n``\n. Again so quick, thank you!\n. How about@extend?\n. :sunny: \n. https://github.com/mgreter/sass2scss/blob/master/sass2scss.cpp#L216\n. Indeed it has been fixed, thank you @mgreter \n. Yes sir!\n. Running without theline-numbersoption-lonsassccommand line, the.mapfile is created with expected content.\n. Also, while using grunt-sass, settingsourceComments: 'map'will result expected.map` file with proper contents.\nSeems that line comments and source maps cannot be used at the same time.\nIt is mentioned at least on node-sass (https://github.com/sass/node-sass#outputstyle) that the above behaviour is expected, but not explicitly stating that both could not be achieved at the same time.\n. Haven't used source maps in the given setup since... Perhaps could try again as it has been quite a while.\n. The following Sass:\n``` sass\n=query\n  @media screen\n    @content\n.selector-with-dash\n  +query\n    p\n      color: rebeccapurple\n      +doesnotexist\n.selector\n  text-decoration-color: blue\n```\nThe failure \"might\" be related to source maps, as changing that option creates a different error as show below. Both examples are run via grunt-sass.\nsh\nFiles: undefined-mixin.sass -> undefined-mixin.css\nOptions: precision=10, sourceComments=\"map\", sourceMap\nPID 23404 received SIGSEGV for address: 0x0\n0   segfault-handler-native.node        0x00000001009f1b78 _ZL16segfault_handleriP9__siginfoPv + 192\n1   libsystem_platform.dylib            0x00007fff972ee5aa _sigtramp + 26\n2   ???                                 0x000000000000000d 0x0 + 13\n3   node                                0x000000010014cf7c _ZN2v86String3NewEPKci + 214\n4   binding.node                        0x0000000103fcbea1 _Z12FillStatsObjN2v86HandleINS_6ObjectEEEP17sass_file_context + 42\n5   binding.node                        0x0000000103fcbfca _Z12MakeCallbackP9uv_work_s + 136\n6   node                                0x0000000100138eb0 uv__work_done + 168\n7   node                                0x000000010012fcfd uv__async_event + 62\n8   node                                0x000000010012fe70 uv__async_io + 136\n9   node                                0x000000010013c7be uv__io_poll + 1427\n10  node                                0x00000001001302b5 uv_run + 239\n11  node                                0x000000010000c01e _ZN4node5StartEiPPc + 365\n12  node                                0x00000001000030f4 start + 52\n13  ???                                 0x0000000000000004 0x0 + 4\nsh\nFiles: undefined-mixin.sass -> undefined-mixin.css\nOptions: precision=10, sourceComments=\"map\", sourceMap=false\nAssertion failed: (val->IsString()), function _NanGetExternalParts, file ../node_modules/nan/nan.h, line 1990.\nAbort trap: 6\n. With inline comments, the given and expected output appears:\nsh\nFiles: undefined-mixin.sass -> undefined-mixin.css\nOptions: precision=10, sourceComments=\"inline\", sourceMap\nWarning: undefined-mixin.sass:9: error: no mixin named doesnotexist\nBacktrace:\n    undefined-mixin.sass:9, in mixin `@content`\n    undefined-mixin.sass:3, in mixin `query`\n    undefined-mixin.sass:6\n Use --force to continue.\n. Even a small Sass as this triggers the above described behaviour:\nsass\n.selector\n  color: rebeccapurple\n  +doesnotexist\n. Thanks for the tip, will look at node-sass more in depth.\n. Indeed, sass/node-sass#366 seems to fix this issue and results in showing better message about the non existing mixin.\nThank you @am11 \n. ",
    "sibsfinx": "@paazmaya thx for the response, I'll try to update and let you know\n. +1 for this\nIt would be more expectable behavior to ignore empty selectors and maybe print warning to the std error output\n. ",
    "matthewmcvickar": "I am still getting this error with grunt-sass v0.14.0 and node-sass v0.9.3:\nsass\n::selection\n  background: blue\nFails:\nsh\nlibc++abi.dylib: terminating with uncaught exception of type std::out_of_range: basic_string::substr\nAbort trap: 6\nWhat do I need to update to get around this?\n. ",
    "wonja": "Addressed Aaron's comments with commit  35b9dd5.\n. @akhleung good point! thanks\n. Yup! Totally forgot to check the quoted cases.\n. ",
    "bradgearon": "I will provide a specific example.  As soon as I get back to my hotel.  Thanks!\n. Nevermind this.  Still looking into exactly what the cause is but I know its not this.  Thanks for the follow up and sorry to waste your time.\n. ",
    "Melros": "Any news on this? Currently I use grunt-sass 0.14.0 that uses node-sass 0.9.3 that uses libsass 0.2.1beta and it still fails as described by @44px.\n. ",
    "Mimikoo": "I've resolved this with LIBS='-lstdc++'. At first it didn't want to compile. But trying several times, it compiled.\n. ",
    "OliverJAsh": "That's a bit of a hack, but you're right that I probably good. An AST would still be helpful for other operations.\n. I wonder if this is doable by reading the source map (just landed in https://github.com/sass/libsass/pull/481).\n. Aha, so it does. Nice find: https://github.com/sass/node-sass#stats\n. ",
    "mrjoelkemp": "+1 for a proper AST. Would help with dependency tree operations plus lowers the barrier to entry for other linters besides scss-lint.\n. ",
    "EggieCode": "That is true. I'm trying to fork it. But first I need to get it working om 2.0.0 or 2.1.0\nAnd I cannot find the problem for it. It is somewhere in the UTF-8 enconding\n. ",
    "anatomic": "+1 on this issue, although not a showstopper it's a bit annoying to have to extract all &-- to top-level .#{$block}--#{$modifier}\n. Actually, I'll correct myself, it looks like .#{$block}--#{$modifier} { ... } doesn't work inside @each but .block--#{$modifier} does.\n. Example available here http://sassmeister.com/gist/c87da804c31f5418c980\n. Sorry, last update on this one, it looks like you can hack a way around this by using string interpolation to assign the className to a new variable. Demo here: http://sassmeister.com/gist/39e64d8a710ea7fcba81\n``` scss\n$modifiers: (top bottom left right);\n$selector: push;\n.#{$selector} {\n  @each $modifier in $modifiers {\n    $className: \"--\" + $modifier;\n    &#{$className} {\n      margin-#{$modifier}: 2em;\n    }\n  }\n}\n```\n. ",
    "grayghostvisuals": "anyone willing to take a look at this yet? + @akhleung @nex3 \n. Thanks for taking the time to look Hampton Inn & Suites ;) :beers:\n. @malrase Results have a separation. I get this reported to me via libsass users\u2026 font-size: 32 rem Notice the gap between the last digit and the string \u201crem\u201d\n. ",
    "Ventajou": "I wish I could help, this would really help improve our setup at work.\n. ",
    "joeyadams": "Hooray, I'm useful!  Yes, you can remove the copyright notices from the files and put them in the readme.\nI took a quick look at the code, and noticed a few issues in SourceMap::generate_source_map:\n- It looks like it's wrapping the sourcesContent array in two pairs of brackets (json_stringify will generate array brackets when passed an array).\n- This is a memory leak: result += json_stringify(triples, \"\\t\");.  json_stringify returns a char*, which is not freed automatically like a C++ string.\n- This function could be rewritten to use the JSON library instead of string concatenation to build the whole object.\n. @aexmachina: to fix the memory leak, change this:\nresult += json_stringify(triples, \"\\t\");\nto this:\nchar *str = json_stringify(triples, \"\\t\");\nresult += str;\nfree(str);\nAlso, I'd change the name triples to something more descriptive, maybe sourceContent.\n. ",
    "davetgreen": "@paazmaya Could you share your grunt-sass task config? Having the same issue and would like to check that what we've got matches what you managed to get working. :)\n. @xzyfer Apologies, I wrote this in a rush before going on annual leave!\nWe're using node-sass as part of our Grunt set-up which (according to their package.json) has a dependency of libsass 3.3.6\n. ",
    "davidblurton": "trace:\n```\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007ffff6c5392a in strlen () from /lib/x86_64-linux-gnu/libc.so.6\n(gdb) bt\n0  0x00007ffff6c5392a in strlen () from /lib/x86_64-linux-gnu/libc.so.6\n1  0x00000000005a2c48 in v8::String::New(char const*, int) ()\n2  0x00007ffff690d0b2 in FillStatsObj(v8::Handle, sass_file_context*) ()\nfrom /home/ubuntu/src/salmondesign-hush/node_modules/broccoli-sass/node_modules/node-sass/bin/linux-x64-v8-3.14/binding.node\n3  0x00007ffff690d546 in MakeCallback(uv_work_s*) ()\nfrom /home/ubuntu/src/salmondesign-hush/node_modules/broccoli-sass/node_modules/node-sass/bin/linux-x64-v8-3.14/binding.node\n4  0x000000000095dd9f in uv__work_done (handle=0xe0f198 ,\nstatus=<optimized out>) at ../deps/uv/src/unix/threadpool.c:220\n\n5  0x0000000000954399 in uv__async_event (loop=0xe0f0e0 ,\nw=<optimized out>, nevents=<optimized out>) at ../deps/uv/src/unix/async.c:80\n\n6  0x0000000000954623 in uv__async_io (loop=0xe0f0e0 ,\nw=0xe0f258 <default_loop_struct+376>, events=<optimized out>)\nat ../deps/uv/src/unix/async.c:151\n\n7  0x0000000000961728 in uv__io_poll (loop=0xe0f0e0 , timeout=-1)\nat ../deps/uv/src/unix/linux-core.c:271\n\n8  0x0000000000955178 in uv_run (loop=0xe0f0e0 ,\nmode=<optimized out>) at ../deps/uv/src/unix/core.c:317\n\n9  0x000000000080fda2 in node::Start(int, char**) ()\n10 0x00007ffff6bebec5 in __libc_start_main () from /lib/x86_64-linux-gnu/libc.so.6\n11 0x00000000005901a1 in _start ()\n(gdb)\n```\n. Yes, this was in node-sass. I will ask them to update dependencies. Thanks.\n. ",
    "bradrobertson": "Sure, sorry for the duplicate issue log. I only just discovered libsass this weekend so I wasn't really sure what state it was in \n. ",
    "AndyOGo": "it absolutely matters for module based development to avoid duplicated code generation\n. @xzyfer \nYeah I know I read through all the TL DR stuff started in 2011.\nI really see it as a key feature, though there seems to be so much of opposition - very sadly...\nTo clarify it's a bug in the SASS language, hence libsass suffers from the exact same design decision fault.\n\nIn case anyone is curious - To Whom It May Concern:\nThe Issue: https://github.com/sass/sass/issues/139\nAvailable solutions depends on your tool chain:\n- ruby-sass: https://github.com/Compass/compass/tree/master/import-once\n- node-sass: https://www.npmjs.com/package/node-sass-import-once\n- webpack: https://www.npmjs.com/package/sass-loader-once\n. Well thats exactly my point.\nSorry for my \"quick fix\" being confusing. This should just expose that build works fine with brackets but not without them.\n. @xzyfer \nWell I know that it works with ruby based SASS parser.\nBut a soon as try to compile with libsass it fails on that line:(\n. ",
    "matthiasbayer": "Any news on this issue?\n. ",
    "john-landgrave": "Any movement on this? Or can anyone point me at the general place to step in to making this change myself?\n. ",
    "peterblazejewicz": ":+1: \n. ref: https://sass-compatibility.github.io/#shadow_dom_styling\n. ",
    "hackingbeauty": "Can this please get fixed and merged?  I'm not able to use libsass in my Polymer project.\n. ",
    "Panya": "BTW /deep/ was changed to >>> (http://dev.w3.org/csswg/css-scoping-1/#deep-combinator)\n. Actually, ruby sass' output is also invalid because according to the spec you can't write selectors inside @keyframes.\nUP: this bug was fixed in 3.4.0.\n. Your example works fine in libsass 3.0.1+ (see http://sassmeister.com/gist/a7381418bae7d13f8d81)\n. Well, as I know in Ruby Sass you cannot use @extend inside @media that way (extending a selector that outside the @media's block). You'll get an error.\n. Actually, no. In Ruby Sass you will get the same result. The calc is a special case and you should use an interpolation for it (see https://github.com/sass/sass/issues/1147).\n. Actually, no. In Ruby Sass you will get the same result. The calc is a special case and you should use an interpolation for it (see https://github.com/sass/sass/issues/1147).\n. > Ruby Sass 3.4.11 produces an error\nNo error for me, see http://sassmeister.com/gist/daf55b620cffef95cd04\n. Looks like duplicate of #593\n. It's not really a bug as Ruby Sass produces the same output. You just should use interpolation in this case:\nsass\n@mixin pTransition($content){\n  -webkit-transition:-webkit-#{$content};\n  -moz-transition:-moz-#{$content};\n  -ms-transition:-ms-#{$content};\n}\n. It's also doesn't work in Ruby Sass. You should write it like this (without @media in a var):\nscss\n$mq: \"(min-width: 320px)\";\n@media #{$mq} {\n  p {\n    color: red;\n  }\n}\n. That's correct behavior (Ruby Sass 3.4.19 throws the same error).\n. ",
    "JosefJezek": "https://code.google.com/p/chromium/issues/detail?id=446051\n. ",
    "iamcarrico": "If I am not mistaken--- LibSass will error out. Although--- currently if you put in a number (which is valid CSS) it will error out. So, I do not think that is a bad thing. \n. ",
    "foxx": "Just got this same bug today.. I can't explain precisely why it's happening, but I can at least give some debug.\nSass: 3.7.4\nRuby: 2.1.3\nBourbon Neat: 1.7.0\nUsing the following;\n$column: golden-ratio(1em, 3) !default;\nResults in;\nscss/struct:3: error: invalid operands for multiplication\nSadly I just don't know enough Ruby or the internals of Sass to even guess why/where this might be happening, but I narrowed it down to those two methods.\nThe problem happens when using gulp-sass which uses libsass afaik. \nIf I use ruby-sass, I get the following;\nneat/grid/_private.scss:15:in `span-columns': Undefined operation: \"12 times golden-ratio(1em, 3)\". (Sass::SyntaxError)\n    from struct.scss:126\n    from entry.scss:10\n    from /home/app/.rvm/gems/ruby-2.1.3/gems/sass-3.4.7/lib/sass/script/tree/operation.rb:85:in `rescue in _perform'\n    from /home/app/.rvm/gems/ruby-2.1.3/gems/sass-3.4.7/lib/sass/script/tree/operation.rb:81:in `_perform'\n    from /home/app/.rvm/gems/ruby-2.1.3/gems/sass-3.4.7/lib/sass/script/tree/node.rb:50:in `perform'\n    from /home/app/.rvm/gems/ruby-2.1.3/gems/sass-3.4.7/lib/sass/script/tree/operation.rb:64:in `_perform'\nHopefully this will help diagnose the problem, sorry I couldn't be of any more use\n. ",
    "johannesjo": "It is great to hear that you're working on that!\n. ",
    "IbnSaeed": "any update on using singularitygs with libsass ?\n. any update on using singularitygs with libsass ?\n. ",
    "BrandonJF": "Hey @donnrri , I was having that exact issue. Turns out that I was missing some bourbon libraries that were doing calculations for these grid columns. Namely, I'd earlier removed: \n_px-to-em.scss\n_strip-units.scss\n_golden-ratio.scss\nWhich can all be found in the functions folder of Bourbon. The issue is actually occurring because the multiplication function is expecting integer input as is being passed ems because the underlying sass functions to convert them are not being called. Make sure that your Bourbon installation is up to date and that you are correctly referencing the locations of these files in the bourbon.scss. \nHopefully this helps you, it's what worked for me with Libsass. \nCheers, \nBrandon. \n\n. ",
    "donnrri": "Thanks very much for your tip, I'll try it out.\n. ",
    "benesch": "Looks to be fixed with the merge of sass/sass-spec#36. :)\n. Ah, okay. I added some tests of my own for this way back when (sass/sass-spec#35), but looks like I missed the tricky saturate case. I'm on it!\n. Well, that was tricky.\nTurns out the saturate overload as I originally wrote was okay, though it didn't quite agree with Ruby Sass. Since CSS3 filter functions can only take numbers as arguments, I was checking whether the first argument was a number. So \nsaturate(red)\nwas getting rejected as a CSS3 filter function overload, since red isn't a valid value for a CSS filter function, whereas\nsaturate(10)\nwould get accepted as a CSS3 filter function overload, since 10 is valid there.\nAnyway, for compliance with Sass, I've updated the overload to naively check for the existence of the second $amount argument, and assume that the user intends the filter function overload if s/he only provides one argument.\nThen just a couple minor output formatting modifications (see commit messages) to achieve parity with Sass.\n. Took a stab at this in #561 and added a test in sass/sass-spec#94. \nNote this change also allows variable names to contain unicode chars like \u00a5 as desired, but writing a test for this is currently challenging. Ruby Sass outputs @charset \"UTF-8\"; whenever the output document contains a non-ASCII char, but libsass does not. I've punted on testing this case for now.\n. @xzyfer yeah, I saw your WIP! I didn't realize you were planning to have it ready for 3.1\u2014woohoo!\u2014so I figured I'd send these ten lines along.\nI agree that these will only reduce performance, but it seems like map-equal in particular right now is fairly useless.\n. Closing this, then :)\n. This appears to be failing because sass-spec is running an unrelated map test that should be TODO.\n. woohoo!\n. This is awesome. Any idea if there's any low-hanging fruit remaining? map-merge and map-equals, maybe?\nps. if you're willing to post at least a rough sketch of your map-heavy code, I'm more than happy to poke around!\n. Whoop, looks like this is fixed in master. Sorry for the noise.\n. For posterity, looks to have been fixed by #797.\n. ",
    "GDmac": "in css \"The @import CSS at-rule allows to import style rules from other style sheets. \n_These rules must precede all other types of rules_, except @charset rules\"\nhttps://developer.mozilla.org/en-US/docs/Web/CSS/@import\n. @renestalder if i look at the css 2.1 spec, it is 'illegal' after ANY other rule.\nhttp://www.w3.org/TR/CSS2/syndata.html#at-rules\nedit: so, after a comment is not a problem, but it is something to keep in mind.\n@hcatlin :+1: \n. ",
    "pdufour": "Sorry I can't quite recall the exact scenario where I encountered this issue. I think I might have been writing a mixin. But I expected it to behave similar to the @media query in that it doesn't put div @media { etc.. } even if you are several layers deep. Also expected behavior to match Ruby Sass.\n. Ah yeah, the Ruby Sass output is wrong. Seems good in the latest build though,\ndiv {\n  display: block;\n}\n@keyframes {\n  from {\n    foo: bar;\n  }\n}\n. Ah yeah, the Ruby Sass output is wrong. Seems good in the latest build though,\ndiv {\n  display: block;\n}\n@keyframes {\n  from {\n    foo: bar;\n  }\n}\n. Thanks a lot!\n. ",
    "trayburn": ":+1: Same issue discovered with node-sass\n. ",
    "breiter": "Any semicolon in the this.innerHTML string will cause invalid property name unless you escape it with .\nscss\n.icon-lock-open { *zoom: expression( this.runtimeStyle['zoom'] = '1', this.innerHTML = '&#xe810\\;&nbsp\\;'); }\nCan work around by piping the output through sed 's/\\\\;/;/g' but it sucks.\n. ",
    "filipbech": "actually, its not only silent selectors. \n``` scss\n@mixin mobileOnly() {\n    @media all and (max-width: 568px) { @content; }\n}\n.test {\n    color:#000;\n    @include mobileOnly() {\n        color:#fff;\n    }\n}\np {\n    @extend .test;\n}\n```\nwill return\nscss\n.e-test, p {\n  color: #000; }\n  @media all and (max-width: 568px) {\n    .e-test {\n      color: #fff; } }\n. ",
    "coveralls": "\nCoverage remained the same when pulling 9423ad30f01802a6165a8d9d3c8545d085e10dd6 on am11:master into 0d5a942a446b035b80e403d32eca3299480dc5b5 on sass:master.\n. \nCoverage remained the same when pulling b28dac45387b91c6666fb77f9e2a5d647a1b0ba7 on kevinsimper:master into 859d11d53b9bf5d9bf63d861a547222c0f485cd9 on sass:master.\n. \nChanges Unknown when pulling bd81611f898fbfd15bf5b0a6c959c1f3f6f5de2a on mgreter:feature/test-coverage into * on sass:master*.\n. \nCoverage remained the same when pulling 32147825c235996c185274d79f8c1ac313ec54de on vadimi:master into 442e168083cc2308de161ae6bf3d0ae7ea1f06b8 on sass:master.\n. \nCoverage increased (+69.54%) when pulling 976bd2b0f8f6497727381b7d61eb35eda3dfa4dc on mgreter:feature/coveralls-metrics into c31087c6e7ab479c7c3f5f20d2f3fb31b3491c8b on sass:master.\n. \nCoverage increased (+69.54%) when pulling 5d82781f119b75a1bc8a241607db9f38b0d3b270 on mgreter:feature/coveralls-metrics into c31087c6e7ab479c7c3f5f20d2f3fb31b3491c8b on sass:master.\n. \nCoverage decreased (-0.06%) when pulling e2b7dcf4d7cb44db7dabc91d977c9566821fca49 on xzyfer:feat/list-separator into b1ce9a876a4ca92223c7ad0252907aa538839909 on sass:master.\n. \nCoverage decreased (-0.05%) when pulling a4716732437dd9407b6de02036bc93924cd04b79 on xzyfer:feat/css-variable into b1ce9a876a4ca92223c7ad0252907aa538839909 on sass:master.\n. \nCoverage decreased (-0.05%) when pulling a4716732437dd9407b6de02036bc93924cd04b79 on xzyfer:feat/css-variable into b1ce9a876a4ca92223c7ad0252907aa538839909 on sass:master.\n. \nCoverage decreased (-0.11%) when pulling 8a866f310939ba5f5f677cf6b26a80441520e14d on benesch:filter-effects-functions into 3a404a8afb8b44b07ccb2dc5df3adb80685243bd on sass:master.\n. \nCoverage increased (+0.05%) when pulling e560fbbdb35f6a08e3fe7795911cae0d6e516b2d on wonja:call_function into 3a404a8afb8b44b07ccb2dc5df3adb80685243bd on sass:master.\n. \nCoverage decreased (-0.06%) when pulling 0f097f9682e0b86325fe94ddace6996a31b1d392 on am11:master into 3ea8247f810a632ca06f487da63e4c36abebddf4 on sass:master.\n. \nCoverage decreased (-0.06%) when pulling a36f00c9759c233c399c7212f5837dbec18e09dd on am11:master into 3ea8247f810a632ca06f487da63e4c36abebddf4 on sass:master.\n. \nCoverage increased (+0.01%) when pulling 2640ccd75ee38a2deebf6ab6d5fdf06cae660f83 on DealerDotCom:feature/colors into 859d11d53b9bf5d9bf63d861a547222c0f485cd9 on sass:master.\n. \nCoverage decreased (-0.06%) when pulling 49e12507608610c68f12d40d2b91e677d3d136de on jlinton:JL_CHANGES into 27d4fcd92db501d0662696f08942f35499717f53 on sass:master.\n. \nCoverage increased (+0.01%) when pulling a182d2c60eb2731ab6874df75c2edf5ca7c80dc7 on xzyfer:feat/neated-maps into 27d4fcd92db501d0662696f08942f35499717f53 on sass:master.\n. \nCoverage decreased (-0.01%) when pulling 7a6a31de6ac744eacc1af28a2e4979b435a7818d on xzyfer:feat/issue_487 into 27d4fcd92db501d0662696f08942f35499717f53 on sass:master.\n. \nCoverage increased (+0.02%) when pulling 2784283937286c8d52965fbbe4c596418abc966a on xzyfer:fix/issue_510 into 27d4fcd92db501d0662696f08942f35499717f53 on sass:master.\n. \nCoverage decreased (-0.02%) when pulling e5a8ea77c340028cf23511ea52cb62505924241c on xzyfer:fix/issue_337 into 27d4fcd92db501d0662696f08942f35499717f53 on sass:master.\n. \nCoverage decreased (-0.24%) when pulling 5f6227e1fe94e1de021f35b4b9298dd92742e59e on xzyfer:fix/issue_528 into dc78a68277af80bd14ad27d58b98c86717b3c534 on sass:master.\n. \nCoverage increased (+0.01%) when pulling b17f4350fd353b3ee55a7acc9700267484aac3bb on xzyfer:fix/map-key-as-numbers into f660edea1f747950ad0ddedd07f794d377b70132 on sass:master.\n. \nCoverage increased (+0.01%) when pulling 18fbaebb9d9dbfee0317a6f22201f4b438e37d18 on mgreter:negative-number-output into 9569ba15a3b9d04be1490f6d83c998802cd94514 on sass:master.\n. \nCoverage remained the same when pulling b860361d6a2a117244d2e803ab06145472fbd5fa on mgreter:negative-number-output into 9569ba15a3b9d04be1490f6d83c998802cd94514 on sass:master.\n. \nCoverage decreased (-0.04%) when pulling 8f1a7a8ff13fde75ae8da5022d3fa21b5fe413b2 on mgreter:expose-quote-function into 9569ba15a3b9d04be1490f6d83c998802cd94514 on sass:master.\n. \nCoverage remained the same when pulling 6d4af0e943d2c7fd5ef50f61ec89cee704df5d0f on mgreter:fix-trailing-semicolon-removal into 9569ba15a3b9d04be1490f6d83c998802cd94514 on sass:master.\n. \nCoverage increased (+0.04%) when pulling 46833fa0f78f5427f4f1ebc0a1c4c8051dfb14cc on benesch:map-behavior into 2b70b16f6e4a3ad1476b64ddecc95f662540898c on sass:master.\n. \nCoverage decreased (-0.38%) when pulling 7f7e64212e4cb39e4112ac516f274d1fc9e3427e on xzyfer:wip/fast-maps into 2b70b16f6e4a3ad1476b64ddecc95f662540898c on sass:master.\n. \nCoverage decreased (-0.32%) when pulling ef474580a3265baf448e10b05b2910d2460a9346 on xzyfer:wip/fast-maps into 2b70b16f6e4a3ad1476b64ddecc95f662540898c on sass:master.\n. \nCoverage decreased (-0.42%) when pulling c9c18ed64e4f232d014ef00644ae59ba38d8424a on xzyfer:wip/fast-maps into 2b70b16f6e4a3ad1476b64ddecc95f662540898c on sass:master.\n. \nCoverage decreased (-0.36%) when pulling 4312887b7aaac8104e56fe942cf34e5af1ee69a8 on xzyfer:wip/fast-maps into 2b70b16f6e4a3ad1476b64ddecc95f662540898c on sass:master.\n. \nCoverage decreased (-0.37%) when pulling ea35a0b791d40d684e834328a207ba476abca237 on xzyfer:wip/fast-maps into 2b70b16f6e4a3ad1476b64ddecc95f662540898c on sass:master.\n. \nCoverage decreased (-0.24%) when pulling 71306a878a5588ac10f8b5eb56ff2cc38aed1369 on mgreter:fix/c-sass-value-mem-leak into 8fd3adb6f30547adbec4fa4e86cc28932bfb698d on sass:master.\n. \nCoverage decreased (-0.06%) when pulling 60a2107014581907d0a8f95fe59986690ad8d5ce on xzyfer:feat/each-maps-for-realz into 02f905881a7cb2e7f64d9921ec813110ad1b9dc1 on sass:master.\n. \nCoverage decreased (-0.1%) when pulling 9cac507b0c4b82ed3beb9554f8b5d123fa8a793c on xzyfer:feat/each-maps-for-realz into 02f905881a7cb2e7f64d9921ec813110ad1b9dc1 on sass:master.\n. \nCoverage decreased (-0.11%) when pulling 0a643df09c06b00b9e5cfebbe132656999c5f7f4 on xzyfer:feat/each-maps-for-realz into 52ad3791cdca9b6c6b0905a3b7588d9f61d54ab5 on sass:master.\n. \nCoverage increased (+0.09%) when pulling e8c549a052f450a41826450bab281f5dc1cd27f5 on xzyfer:feat/each-maps-for-realz into 52ad3791cdca9b6c6b0905a3b7588d9f61d54ab5 on sass:master.\n. \nCoverage increased (+0.01%) when pulling d61fc2afa76129090982f57e525a2b0d2af1aae3 on mgreter:fix/build-older-gcc into 02f905881a7cb2e7f64d9921ec813110ad1b9dc1 on sass:master.\n. \nCoverage increased (+0.01%) when pulling eb612b119e0ef4fe6fbcad9ad42855759e5c5aa9 on avoliva:master into 52ad3791cdca9b6c6b0905a3b7588d9f61d54ab5 on sass:master.\n. \nCoverage increased (+0.16%) when pulling c43ac9554257bf9620612552f243356d7dd56fa6 on avoliva:master into 52ad3791cdca9b6c6b0905a3b7588d9f61d54ab5 on sass:master.\n. \nCoverage increased (+0.16%) when pulling d45737b02f4f39dd4898c410bdb67c8cd2a397dd on avoliva:master into 52ad3791cdca9b6c6b0905a3b7588d9f61d54ab5 on sass:master.\n. \nCoverage increased (+0.02%) when pulling e8d426c2b1724034655fdbd015d7cfbf3b48c90d on sufianrhazi:import-once into 068add947e7f06b143a205f9bb60da3c560b5729 on sass:master.\n. \nCoverage remained the same when pulling 608cfc09873cfc2445f57b4b41b5ef46c534540e on am11:master into ca5f271883db61ccd1d1e1b84dd4830a2564896f on sass:master.\n. \nCoverage increased (+0.13%) when pulling 704ba5e234e8508af7bb693b478589995042e117 on xzyfer:wip/remove-compact into 5e864434cd9688798ea4719c13ea264485d67acb on sass:master.\n. \nCoverage increased (+1.63%) when pulling bb91e27015380758d2924a0d74e684a5c4f3274a on mgreter:source-map-sources into 5e864434cd9688798ea4719c13ea264485d67acb on sass:master.\n. \nCoverage increased (+1.62%) when pulling 1b007181fbbebd258e456d97ca2774829fce08bd on mgreter:source-map-sources into 2fae47a29133cf7f845d4a9386b2dd9e24adf608 on sass:master.\n. \nCoverage increased (+1.63%) when pulling 53a568ae071ea6e94c5667191fd61a00d5b3a090 on mgreter:source-map-sources into 7a381b892941d5d8d66b8a3740aab880c0a2e79f on sass:master.\n. \nCoverage increased (+1.63%) when pulling 7a9ef5f4ff2e5fff2e9bfd74459c3dff061570e2 on mgreter:source-map-sources into 7a381b892941d5d8d66b8a3740aab880c0a2e79f on sass:master.\n. \nCoverage decreased (-0.17%) when pulling a8d51547244963ae16a758cb3db686c9f6f0010b on xzyfer:feat/functions-as-map-keys into 2fae47a29133cf7f845d4a9386b2dd9e24adf608 on sass:master.\n. \nCoverage decreased (-0.02%) when pulling 662acce03693fce004c7bfa2b065b2db6e6c8aca on pdufour:master into 7a381b892941d5d8d66b8a3740aab880c0a2e79f on sass:master.\n. \nCoverage decreased (-0.02%) when pulling 662acce03693fce004c7bfa2b065b2db6e6c8aca on pdufour:master into 7a381b892941d5d8d66b8a3740aab880c0a2e79f on sass:master.\n. \nCoverage increased (+0.01%) when pulling b6efc33d37c68b85a1aae39ef41197e47b53da41 on am11:master into 7a381b892941d5d8d66b8a3740aab880c0a2e79f on sass:master.\n. \nCoverage increased (+0.01%) when pulling 96b2cb09f36174c4dfb6382474aa6f683d8c8c37 on am11:master into 7a381b892941d5d8d66b8a3740aab880c0a2e79f on sass:master.\n. \nChanges Unknown when pulling f685c6f0e10160ed1b4b9d315ef2f530def28182 on test/travis-ci into * on master*.\n. \nCoverage decreased (-0.13%) when pulling f50ee5dd0d6ecfd1f144947da08f0a32ea77f354 on xzyfer:feat/map-varargs into 883a9b407b6a13b8dcea69581df393980a944ee1 on sass:master.\n. \nCoverage decreased (-0.13%) when pulling d681ca681f2be46450dabab2c04c2480394ab153 on xzyfer:feat/map-varargs into 883a9b407b6a13b8dcea69581df393980a944ee1 on sass:master.\n. \nCoverage increased (+0.5%) when pulling 4022396c8fd4321246c824a31cf1f34f6268f4fb on xzyfer:feat/at-supports into 00ad5fb4d2891e9f585ccea64232d6b097ea0262 on sass:master.\n. \nCoverage decreased (-0.01%) when pulling 40693d54a5d9f9f5f53b594863240d2f686b1727 on xzyfer:feat/hoist-feature-queries into 068add947e7f06b143a205f9bb60da3c560b5729 on sass:master.\n. \nCoverage decreased (-0.01%) when pulling c33353d937704e6a0ac09ac62388aef3bfac70a1 on bugfix/source-map-sources into 18b0d9bd045e212bf4b9909db44c34f50d1fe9c2 on master.\n. \nCoverage increased (+0.0%) when pulling 370e03886bce6aea6ec2a74bdbd32c0dc7ea2f90 on mgreter:issue/550 into 5375056698332ab0f1c25fa68639b5df4190b69d on sass:master.\n. \nCoverage increased (+0.19%) when pulling 3877ee0771245f4b5c12aa9cd0792180e2c2be77 on andern:master into 6a548bfe63071c708fbb120ed66381e2f3e1450c on sass:master.\n. \nCoverage increased (+0.01%) when pulling 3a651ce16bbb61bfa3a0495fdd669c355864d05a on andern:master into 2e48c07a9c5f90c75a17100a61bc248bcdc5c941 on sass:master.\n. \nCoverage increased (+0.01%) when pulling bdc449a65c0e91336d64e05b18f161895f25b85c on xzyfer:fix/issue_641 into 4cd50343755de38a84c2ed8f9bd65a79f6fa6ceb on sass:master.\n. \nCoverage decreased (-0.04%) when pulling 4e6ac82e588a72fa60c7ab65f1ec17ea68bd2876 on xzyfer:wip/not-expression into c0dbb431c99c0cf2bba7f79c76892a561cba7b26 on sass:master.\n. \nCoverage decreased (-0.02%) when pulling 70fe8f3eade98127eb26aa7a29ac7444cca6001b on xzyfer:revert/not-expression into 70d70e47c752744a4035517f548d37c2c509adec on sass:master.\n. \nCoverage increased (+0.01%) when pulling e1d92638384419729fd8b8e06828c05e28c1c837 on xzyfer:wip/normalize-ie-keyword-args into dfdeac649ad079d9fa48591b181fd760e4433c37 on sass:master.\n. \nCoverage increased (+0.01%) when pulling d259fa10cdbb1737f7e154854bd80ca5b28456d1 on mgreter:bugfix/unit-conversion into a94377b5aac6a10a6aa3ed90656557e7b9843fd1 on sass:master.\n. \nCoverage decreased (-0.02%) when pulling 624145d87d4f512308af843c13bf6bd540ea2a08 on drewwells:setfunc into 85bccf28544106546aa5e1cae78bdaf7421b70dc on sass:master.\n. \nCoverage increased (+0.08%) when pulling 5847f2e488564e2790284fce86c400059decb1d3 on xzyfer:feat/skip-static-values into f1c3d0de573baffd5911ee99e04fa4e92ab9a8fe on sass:master.\n. \nCoverage decreased (-0.03%) when pulling dc58506439edb940c2ad34248f186d29910497ca on xzyfer:wip/not-expression into d57a2ff642fb31e1b39a242e28d194913dd549e9 on sass:master.\n. \nCoverage decreased (-0.03%) when pulling 57eb3d45dc89fbb70952d8ad0018c66cdb91f684 on xzyfer:wip/normalize-ie-keyword-args into b2d727fe48cb2822ae0f03bef7d9c69bfb6c583f on sass:master.\n. \nChanges Unknown when pulling 57eb3d45dc89fbb70952d8ad0018c66cdb91f684 on xzyfer:wip/normalize-ie-keyword-args into * on sass:master*.\n. \nCoverage increased (+0.0%) when pulling 8577fea62b0f0f20c064d98d857504bf277e95bc on mgreter:fix/random-numbers into c561c4230c985cb3c3a11b6e0f5a6e8663da0653 on sass:master.\n. \nCoverage increased (+0.12%) when pulling 34a5752bcaad6c401c641897f352ca7c59f4c252 on mgreter:feature/importer-parent-context into 0877bf0c049f05e377290e9709080b91d78d4998 on sass:master.\n. \nCoverage decreased (-0.15%) when pulling dfb717bfae8e8d59b67ab141203d750719b6d8ac on mgreter:fix/const_sass_values into ba767dc5d4ffe8c06b22d0b083106f56c1491efd on sass:master.\n. \nCoverage decreased (-0.03%) when pulling 407ad898f7795308771d567f84872a50e95f3e5d on mgreter:feature/query-compiled-versions into ba767dc5d4ffe8c06b22d0b083106f56c1491efd on sass:master.\n. \nCoverage decreased (-0.16%) when pulling 5c8ff6daaa20fb2cae01bb22649a97de7d26245e on mgreter:feature/inspect-function into 7baead6fa3ca6ffa4df74426c3fd6d412554355e on sass:master.\n. \nCoverage decreased (-0.45%) when pulling d31c960d89e1fb06329a44065807817ba760c40b on mgreter:feature/overload-error-fn into 1738c7fc84ea41665040ab07e4d2bd9db18e2c56 on sass:master.\n. \nCoverage decreased (-0.1%) when pulling dd2c068dd5de1898ead087687bd3d81895e6e393 on mgreter:feature/utf8-charset into 92e19f154124a5d0ee5eb947eb0ed46a796b5d36 on sass:master.\n. \nCoverage increased (+0.03%) when pulling 35c55e163fd88531dd5cdb06901c55990bb03e43 on mgreter:fix/color-token-ops into 7aaa45a979ce65d50b3158ff50bf9409f8955063 on sass:master.\n. \nCoverage decreased (-0.01%) when pulling 22edce001ea5556a178d7715793b7a724a9bdbf0 on am11:master into 1738c7fc84ea41665040ab07e4d2bd9db18e2c56 on sass:master.\n. \nCoverage remained the same when pulling c25ea323c6283201088ba18638c392e6577df4bc on xdissent:map-content-type into 27c556ca3fd630862ca2cac8f1f6199240a5b0b0 on sass:master.\n. \nCoverage remained the same when pulling fe2adfbcddead52931ff665da494366ebb4e51d5 on mgreter:feature/tap-report into cf54cd8f39e95e3050739762dc24ecfcfbe1cd4b on sass:master.\n. \nCoverage remained the same when pulling f2f7b1fadf78a31254736f251fcd4cb63a6028e9 on xzyfer:fix/quoted-keyword-args into 3dcc5e86c4c519e2b4b9db06df8d0d164704807e on sass:master.\n. \nCoverage increased (+0.01%) when pulling 40475142aac98c7b34f8e2c80be6a1c6fc015637 on xzyfer:fix/return-each-lists into 51ba56457563588643d93b7d0434ab79cb436b79 on sass:master.\n. \nCoverage increased (+0.02%) when pulling 0772828017a17636c0444881ca06ad3decb7b410 on mgreter:feature/build-dll-win-mingw into 9852e41a11f16e8d52992a0f6e4d08068e9cd0ad on sass:master.\n. \nCoverage increased (+0.02%) when pulling f9f51f87215c25525f52d77fe5584fe37cd1e73c on mgreter:feature/build-dll-win-mingw into c4e03e94ccb29f8517d22b2ffe97bfc20c12fed3 on sass:master.\n. \nCoverage remained the same when pulling 4742ae4ff2d730c1be41beddb436fdeb37f233f2 on xzyfer:fix/ie-keyword-parsing-variables into 9852e41a11f16e8d52992a0f6e4d08068e9cd0ad on sass:master.\n. \nCoverage increased (+0.01%) when pulling 2a89e3511b7373740afdc2e40633178127504100 on xzyfer:feat/better-modulo-handling into c4e03e94ccb29f8517d22b2ffe97bfc20c12fed3 on sass:master.\n. \nCoverage increased (+0.01%) when pulling 320c25c4c468b9b8059d9054ae3616f952f22439 on xzyfer:fix/unary-hydration into 4a1388537f8ef42712f48d8db9c5d1429351f930 on sass:master.\n. \nCoverage decreased (-0.02%) when pulling 492c870e8bc818cc0003c813df531fac6f94698d on mgreter:fix/source-map-issues into 86f56b2b49da654a9cbd1ef272e94b01cbbfba10 on sass:master.\n. \nCoverage increased (+0.04%) when pulling 2635d435b6f6ca566016e06e2c25374f5560a996 on mgreter:feature/import-css into ccfcfd2212bfb6fb9097e66d57816ab3aae62dc8 on sass:master.\n. \nCoverage increased (+0.05%) when pulling 527a95d658bb176295dcc91e7074fba7c9715e04 on mgreter:feature/import-css into 31521ef3ece636892f395a80392448ceae449b90 on sass:master.\n. \nCoverage decreased (-0.03%) when pulling 4efc621bbc0d989b1046aef74fe86aee89022f0d on mgreter:feature/final-api-improvements into cf7c1d14fec91a66ab9c2a3050dcec5fab6198f5 on sass:master.\n. \nCoverage increased (+0.01%) when pulling dc63805f2d9e1605ba8f9337a6063791fad980c9 on xzyfer:fix/str-slice-end-at-0 into cf7c1d14fec91a66ab9c2a3050dcec5fab6198f5 on sass:master.\n. \nCoverage increased (+0.01%) when pulling dc63805f2d9e1605ba8f9337a6063791fad980c9 on xzyfer:fix/str-slice-end-at-0 into cf7c1d14fec91a66ab9c2a3050dcec5fab6198f5 on sass:master.\n. \nCoverage decreased (-0.0%) when pulling 7c9f6578223fc0111039945100c6a8a2aa017dcd on xzyfer:fix/asignment-parsing-too-strict into c5d37fafa64580e47b4deb28d0f32d336ef45aaa on sass:master.\n. \nCoverage decreased (-0.02%) when pulling 5de1e90e7c17f0589bbe6e18e13d3d3231328315 on xzyfer:fix/guarded-assigments-override-null into 6125753e7352d7bd8c8896a0cdbcdd20e1b15cab on sass:master.\n. \nCoverage increased (+0.01%) when pulling 2e64a2076f7f7d73ad8f19bf369c3c09302a2b37 on xzyfer:fix/guarded-assigments-override-null into 6125753e7352d7bd8c8896a0cdbcdd20e1b15cab on sass:master.\n. \nCoverage decreased (-0.23%) when pulling d1894bd43e65b7c3e9907316f84734c861661a18 on xzyfer:fix/better-parsing-of-minus-operand into d9b3f4b77405f338ad9e6e1450c0893239bfd20f on sass:master.\n. \nCoverage decreased (-0.05%) when pulling a814a8b14fcc7e6fd0f95f886e2b72ddff687bd3 on xzyfer:fix/error-on-duplicate-map-keys into 715fa7a847ab380c33be937aa0469e083b0afa0f on sass:master.\n. \nCoverage decreased (-0.0%) when pulling 3ed6e43912388abd3121e9f8c9a96fa13954408a on xzyfer:fix/dont-output-empty-declarations into d8c08c6e85cf269174c251f33078f3c1c1990f86 on sass:master.\n. \nCoverage decreased (-0.0%) when pulling 68a45e13aebfefac1cbd963f63ec60df1a42769f on xzyfer:fix/always-eval-binary-leaves into 6f716d7263ef16a17a6ae2f04fa83cd112b346f2 on sass:master.\n. \nCoverage increased (+0.02%) when pulling 163c189e06fa5a21ebf30e8323958353896b90d2 on xzyfer:fix/improve-parsing-static-values into 7adb5ae2817c1cb9f417b26daa28695708c00309 on sass:master.\n. \nCoverage increased (+0.02%) when pulling e89cc53edcbfc122f35ae405cc47969ab7960b2d on xzyfer:fix/improve-parsing-static-values into 7adb5ae2817c1cb9f417b26daa28695708c00309 on sass:master.\n. \nCoverage remained the same when pulling 4559c96f6d88caed81993038118a4e1c44fd5d5d on xzyfer:fix/all-the-semicolons into 8cc077531c9c1399e68ba9418203aa0513d5ba80 on sass:master.\n. \nCoverage increased (+0.02%) when pulling 1a86c5fddf3c599f2c7b0ea61a1f651d1e8b85a4 on mgreter:fix/source-map-771 into 6f716d7263ef16a17a6ae2f04fa83cd112b346f2 on sass:master.\n. \nCoverage increased (+0.14%) when pulling fe6f105616aae2727187c47447f1def8385ae415 on mgreter:fix/url-parsing into 448f051045bf62982a9bc107f389af4a50db0761 on sass:master.\n. \nCoverage decreased (-0.13%) when pulling 8de0b0aeb2fe38cabef476d42394b78b1ceefd97 on mgreter:fix/url-parsing into d9b3f4b77405f338ad9e6e1450c0893239bfd20f on sass:master.\n. \nCoverage decreased (-0.0%) when pulling e70e2ec7fd5df63ab78fc63354297357eba1361f on smikes:694-unquoting-problems into d9b3f4b77405f338ad9e6e1450c0893239bfd20f on sass:master.\n. \nCoverage decreased (-0.0%) when pulling 7e0b5e9f015be38b5f390517f1565d57b2c4c352 on smikes:694-unquoting-problems into 420d7fb4e578857150e15d80c966e5cac779d932 on sass:master.\n. \nCoverage decreased (-0.12%) when pulling 33965ce7b5179e1d2720e3a110fdadaded83335e on mgreter:fix/hardened-api into 5483186ab9406fa69bfcc48b59b2a76009d9483d on sass:master.\n. \nCoverage increased (+0.81%) when pulling 06a63e5c141c1fc54e7505d3fab1e8135d3f3fc3 on mgreter:source-map-test into 420d7fb4e578857150e15d80c966e5cac779d932 on sass:master.\n. \nCoverage decreased (-0.02%) when pulling 1a937f2e6fe9aeb43ae2f2569900a8ee7afc616f on mgreter:feature/configurable-linefeed into 3b0feb9f13d5885de9f2ceec81b9a66a76f9be2d on sass:master.\n. \nCoverage decreased (-0.02%) when pulling 706b6df952c95f984f8ac5889a0716d052dc3e51 on mgreter:feature/configurable-linefeed into 1ab48eccdd6fc8c807482d3100bd52fa2cb42ec4 on sass:master.\n. \nChanges Unknown when pulling 706b6df952c95f984f8ac5889a0716d052dc3e51 on mgreter:feature/configurable-linefeed into * on sass:master*.\n. \nCoverage decreased (-0.27%) when pulling 1751f20488c941d3ff334fb2d2269ed0c0ff4f6e on xzyfer:feat/bubble-media-queries into 5045bceebbe8d9a5e4da363a0e8ea5ee6f6f6927 on sass:master.\n. \nCoverage decreased (-0.16%) when pulling f69a76b33102bf48a41dd5a40b4071df46c196b4 on xzyfer:feat/bubble-media-queries into 5045bceebbe8d9a5e4da363a0e8ea5ee6f6f6927 on sass:master.\n. \nCoverage increased (+0.8%) when pulling 33a9e45aa5df1f312c1f29f67a6e0670def5997b on feature/improved-source-maps into 420d7fb4e578857150e15d80c966e5cac779d932 on master.\n. \nCoverage increased (+0.23%) when pulling e9ef4b40a7b079ec52471e0e090e5ef9c607ab9a on feature/improved-source-maps into 065b3668df2a035be602683bc53c0d96abed7db2 on master.\n. \nCoverage increased (+0.09%) when pulling 75a1147e14b4f4be3330c66b5265f4e032694e3d on mgreter:fix/copy-context-options into fa5d68d982eabc8d230a747a31471f582975a003 on sass:master.\n. \nCoverage remained the same when pulling a41482e81bcda717786e4d6ec4232a7bae096a1b on mgreter:fix/makefile-portability into 31521ef3ece636892f395a80392448ceae449b90 on sass:master.\n. \nCoverage increased (+0.0%) when pulling 8b399d1204122b28ab9e580aff2a88658b903dc4 on xzyfer:fix/op-number-units into 9087a772eb8d5a883b866a9b4b5fb37052c48451 on sass:master.\n. \nCoverage increased (+0.06%) when pulling be25eea2cc83c64b13722363b1f99a9e9dabcc03 on smikes:escaped-interpolation into 31521ef3ece636892f395a80392448ceae449b90 on sass:master.\n. \nCoverage increased (+0.08%) when pulling 976d64a841e18c370a45df68c2390dcd83368738 on smikes:escaped-interpolation into 31521ef3ece636892f395a80392448ceae449b90 on sass:master.\n. \nCoverage increased (+0.08%) when pulling 1c2724aea36f90828151f537e49470dcc6f8c1f7 on smikes:escaped-interpolation into 31521ef3ece636892f395a80392448ceae449b90 on sass:master.\n. \nCoverage increased (+0.13%) when pulling 84878243c5aacfefc79a7bf78a13fce96e58bf33 on smikes:escaped-interpolation into 31521ef3ece636892f395a80392448ceae449b90 on sass:master.\n. \nCoverage decreased (-0.17%) when pulling 41807c8d6183debe05cc581f17b562048629f447 on xzyfer:feat/at-root into a921a733c921cc5f44a572b4c2a3d1da38f43e65 on sass:master.\n. \nCoverage increased (+0.25%) when pulling c79ef9f89af4bece290943323c92ded5d536253d on xzyfer:feat/bubble-media-queries-2 into d67912888b0254b670d35930fbd67fcc892573d7 on sass:master.\n. \nCoverage increased (+0.05%) when pulling ba63c096efa4a606d9001328707907f374511205 on xzyfer:fix/remove-empty-blocks into 5045bceebbe8d9a5e4da363a0e8ea5ee6f6f6927 on sass:master.\n. \nCoverage increased (+0.05%) when pulling ba63c096efa4a606d9001328707907f374511205 on xzyfer:fix/remove-empty-blocks into 5045bceebbe8d9a5e4da363a0e8ea5ee6f6f6927 on sass:master.\n. \nCoverage remained the same when pulling 9c5c26f42fed1784d03ee2e67ee856e8f081b977 on QuLogic:build-stuff into 63093c185248bf1eda6b43e4c70f2ef4342811e0 on sass:master.\n. \nCoverage remained the same when pulling 835c3d720b90bc231c949eb3af8684a746a817a5 on QuLogic:build-stuff into 63093c185248bf1eda6b43e4c70f2ef4342811e0 on sass:master.\n. \nCoverage remained the same when pulling 674c17c8353b167abf13b20300697ade14665444 on am11:master into a921a733c921cc5f44a572b4c2a3d1da38f43e65 on sass:master.\n. \nCoverage remained the same when pulling de67aa10ff45735b1e3d60119b2f8c1890c94331 on am11:master into a921a733c921cc5f44a572b4c2a3d1da38f43e65 on sass:master.\n. \nCoverage remained the same when pulling 6900a30e2916087d68917aed5f2406c80b592b2a on am11:master into a921a733c921cc5f44a572b4c2a3d1da38f43e65 on sass:master.\n. \nCoverage remained the same when pulling 6900a30e2916087d68917aed5f2406c80b592b2a on am11:master into a921a733c921cc5f44a572b4c2a3d1da38f43e65 on sass:master.\n. \nCoverage increased (+3.06%) to 76.21% when pulling 732284c581158cd29864c004db45504fdd5fe2cd on am11:master into a921a733c921cc5f44a572b4c2a3d1da38f43e65 on sass:master.\n. \nCoverage increased (+0.13%) to 76.34% when pulling 013e98bdd71fbec7beab84a31bddae8c97120147 on am11:master into 175c167feddefe8b6ac8aa2f0c42b3d391a7f616 on sass:master.\n. \nCoverage remained the same at 76.21% when pulling 013e98bdd71fbec7beab84a31bddae8c97120147 on am11:master into 175c167feddefe8b6ac8aa2f0c42b3d391a7f616 on sass:master.\n. \nCoverage increased (+0.03%) when pulling 57522fcb65bac8d538ceddea9f44b50186515d69 on xzyfer:feat/more-accurate-nested-output into 381b0ce45afedada9dc4e5b9904c976a7d712879 on sass:master.\n. \nCoverage increased (+0.03%) when pulling 57522fcb65bac8d538ceddea9f44b50186515d69 on xzyfer:feat/more-accurate-nested-output into 381b0ce45afedada9dc4e5b9904c976a7d712879 on sass:master.\n. \nCoverage decreased (-0.1%) when pulling 5a848e726297ec122e7b727d620615e51497a760 on xzyfer:fix/str-slice-end-at-0 into 0b5952649e4302c9ff2dafd0cfe4aa553cf02895 on sass:master.\n. \nCoverage increased (+0.11%) when pulling 8ff58934a1fc3695b6b84b6a0813fe6ec3b17a95 on xzyfer:fix/normalize-string-func-params into 0a2fedb3982a451236e477e9bd1c26d483decb93 on sass:master.\n. \nCoverage increased (+0.39%) when pulling 5fa33c20e2eb1af87d094dbc9a50f84baefea6e0 on xzyfer:feat/unknown-directive-bubbling into ada6c37233241dae6d1817156b5a4ebf652e021b on sass:master.\n. \nCoverage increased (+0.41%) when pulling f303793e263ee581fb4ae5561f3f5b47b28d785f on xzyfer:fix/dont-import-absolute-url into ada6c37233241dae6d1817156b5a4ebf652e021b on sass:master.\n. \nCoverage remained the same when pulling a0fbbe542d54bcb421e3c88ea3383b2cccea546f on mgreter:regression/820 into 3c916876124a1fdec564138e4c06f0dfccef8887 on sass:master.\n. \nCoverage increased (+0.01%) when pulling 38ead6461245d22a936e631c12aab37b790c1196 on xzyfer:fix/negative-numbers into 1ad267ff77ec615630a6e446711e715395bd9f43 on sass:master.\n. \nCoverage increased (+0.0%) when pulling be6b7f3f7cd9a2bce5f3cf8f7bbd0ada66d39924 on xzyfer:feat/update-number-functions into 930dc97c9ea4299de843e3e72129dc26cdf1ac66 on sass:master.\n. \nCoverage increased (+0.03%) to 76.43% when pulling c82c82bf6f92369cf619c8f0c8b401f0e2b96eee on xzyfer:feat/remove-image-url into 003d3dce28d5a9296339cd8da8b051cce525c5cc on sass:master.\n. \nCoverage increased (+0.11%) when pulling 33729644a84c7c85c3477da4477da318c43af741 on xzyfer:feat/remove-compact into 3a07c14185afdee816d29f628d2546e151e4456f on sass:master.\n. \nCoverage increased (+0.2%) when pulling ace85f08dfd486227194815311bdfe2b8aa2a070 on xzyfer:wip/keyframe-bubbling into 9d5d088e502d65b6e63947d98c86774870589228 on sass:master.\n. \nCoverage decreased (-0.04%) to 76.11% when pulling 0b2580f01ba106510f4f752550609368ea70cc76 on jmhe:issue615 into a91597057cfa33ffdb1c38ef438c63bd605e4d2e on sass:master.\n. \nCoverage decreased (-0.02%) to 76.12% when pulling c8ff945af1e22f771a98287e888429fc34873a33 on alprs:fix_desaturate-grey into 714484ed54ee3a8cfacfd65a5a37c1414d9cee69 on sass:master.\n. \nCoverage increased (+0.12%) to 76.21% when pulling 9d2f3313d02ede3ff5ab89de16c5a96d91d0a501 on alprs:fix_desaturate-grey into 4d5ea59e3ed6d189a4f66576c27b61017af119cb on sass:master.\n. \nCoverage increased (+0.12%) to 76.21% when pulling b6b1d2eb2de767bd09c9d7e1210e6338665c5525 on alprs:fix_desaturate-grey into 4d5ea59e3ed6d189a4f66576c27b61017af119cb on sass:master.\n. \nCoverage increased (+0.12%) to 76.21% when pulling 657486b5f1aeee4885275cdb29ed92e9bb640998 on alprs:fix_desaturate-grey into 4d5ea59e3ed6d189a4f66576c27b61017af119cb on sass:master.\n. \nCoverage remained the same at 76.09% when pulling 917d509f389d96b34cbde33bfa454ddd31a13dc2 on alprs:fix_comments-stacktrace into 4d5ea59e3ed6d189a4f66576c27b61017af119cb on sass:master.\n. \nCoverage remained the same at 76.43% when pulling 7ce1e5cce87dbdd16efb5b6e009bd381291e3809 on alprs:fix_comments-stacktrace into 1f40bf416f30b9580a32478d69db38e6de2be3fa on sass:master.\n. \nCoverage remained the same at 76.14% when pulling c55a4fd3c519d35d58a495c1663374cfcd2d80e4 on asottile:patch-1 into 714484ed54ee3a8cfacfd65a5a37c1414d9cee69 on sass:master.\n. \nCoverage remained the same at 76.21% when pulling e9a1290ab9737aa546a0b2467bddf47b7223000b on GawainLynch:rpm-spec into 175c167feddefe8b6ac8aa2f0c42b3d391a7f616 on sass:master.\n. \nCoverage remained the same at 76.21% when pulling 87b7388dac6755dcd3448c0b73454710d0e8932b on GawainLynch:rpm-spec into 175c167feddefe8b6ac8aa2f0c42b3d391a7f616 on sass:master.\n. \nCoverage remained the same at 76.21% when pulling 87b7388dac6755dcd3448c0b73454710d0e8932b on GawainLynch:rpm-spec into 175c167feddefe8b6ac8aa2f0c42b3d391a7f616 on sass:master.\n. \nCoverage increased (+0.06%) to 76.28% when pulling 83b5391e58613d16ec4424ab37a1c434dff68c8b on xzyfer:fix/at-rule-bubbling-references into 175c167feddefe8b6ac8aa2f0c42b3d391a7f616 on sass:master.\n. \nCoverage increased (+0.06%) to 76.28% when pulling 83b5391e58613d16ec4424ab37a1c434dff68c8b on xzyfer:fix/at-rule-bubbling-references into 175c167feddefe8b6ac8aa2f0c42b3d391a7f616 on sass:master.\n. \nCoverage remained the same at 76.28% when pulling 3fcb2f4a377918714b91c73a580e8726fc8959f0 on xzyfer:fix/function-name-normalization into 0c0428fb9d42cccba7e8d95440b280efadaedfaa on sass:master.\n. \nCoverage remained the same at 76.3% when pulling 3bbd52b1c26fbc438313023507cdd72caefabcf2 on xzyfer:fix/function-name-normalization into 833639765a8f053d80991ca33dddb7e7b94131b6 on sass:master.\n. \nCoverage decreased (-0.16%) to 76.14% when pulling 3bbd52b1c26fbc438313023507cdd72caefabcf2 on xzyfer:fix/function-name-normalization into 833639765a8f053d80991ca33dddb7e7b94131b6 on sass:master.\n. \nCoverage decreased (-0.31%) to 76.12% when pulling ba0fe1e11a580e6af1cdf5d7d283ce92a29675bd on mgreter:test-interpolate-merging into 1f40bf416f30b9580a32478d69db38e6de2be3fa on sass:master.\n. \nCoverage increased (+0.01%) to 76.45% when pulling 93e43a66dbb7e329bfa35d1f8d85ea24f9268eee on xzyfer:feat/ms-calc into 1f40bf416f30b9580a32478d69db38e6de2be3fa on sass:master.\n. \nCoverage increased (+0.0%) to 76.45% when pulling aeb67c96ff90c85387bd60fad2f1ac5921906c17 on xzyfer:fix/propset-comments into 9405fe0f7860ad7855d95f4d2276c49190e3464e on sass:master.\n. \nCoverage increased (+0.0%) to 76.45% when pulling aeb67c96ff90c85387bd60fad2f1ac5921906c17 on xzyfer:fix/propset-comments into 9405fe0f7860ad7855d95f4d2276c49190e3464e on sass:master.\n. \nCoverage increased (+0.0%) to 76.45% when pulling aeb67c96ff90c85387bd60fad2f1ac5921906c17 on xzyfer:fix/propset-comments into 9405fe0f7860ad7855d95f4d2276c49190e3464e on sass:master.\n. \nCoverage decreased (-0.02%) to 76.44% when pulling 0074e4978ea53fe85d997fde5545067d8cac9d5b on xzyfer:faet/optional-spaces-and-comments into 1eb0e5dc2a9c6f25399ae86318353087dc76c4ce on sass:master.\n. \nCoverage decreased (-0.02%) to 76.44% when pulling 0074e4978ea53fe85d997fde5545067d8cac9d5b on xzyfer:faet/optional-spaces-and-comments into 1eb0e5dc2a9c6f25399ae86318353087dc76c4ce on sass:master.\n. \nCoverage decreased (-0.02%) to 76.44% when pulling 0074e4978ea53fe85d997fde5545067d8cac9d5b on xzyfer:faet/optional-spaces-and-comments into 1eb0e5dc2a9c6f25399ae86318353087dc76c4ce on sass:master.\n. \nCoverage increased (+0.02%) to 76.46% when pulling 5eba5f0e4fc80f13789a916224a11fd27d00b20d on xzyfer:fix/greedy-not-operator into fc53c9c4f1ff2c51178e9e22c15773e7dc1ae1a2 on sass:master.\n. \nCoverage remained the same at 76.46% when pulling 90219a4e122998fae317ef638743900482404674 on mgreter:fix/autotools-versioning into 2274c510eab885925acdb5ddf5ab774e7e85c993 on sass:master.\n. \nCoverage remained the same at 76.46% when pulling 90219a4e122998fae317ef638743900482404674 on mgreter:fix/autotools-versioning into 2274c510eab885925acdb5ddf5ab774e7e85c993 on sass:master.\n. \nCoverage increased (+0.94%) to 80.67% when pulling 7877cfa872b036d55344db5d12ea908bb70f3705 on mgreter:feature/output-emitter into f642fad3660e332184734e46f2dc1609d32c8bc1 on sass:master.\n. \nCoverage decreased (-0.19%) to 76.43% when pulling f775b9455999787a95f849d4fcf96bf94c73d6ca on mgreter:bugfix/color-functions into d35892aa574c6592e20575b8c86ec63c5bfe873b on sass:master.\n. \nCoverage remained the same at 80.77% when pulling 4b08df390dc435cbdb2eb71a279337e93be5db1a on am11:master into 8e74f7fdd7fe7ed0bf5e9c1922a3150633168c68 on sass:master.\n. \nCoverage decreased (-2.3%) to 78.48% when pulling efc9dd4277096bb98d9a6eb735ebb3384ae3d67f on xzyfer:fix/vs-compat-bug into fb64dbda33fba1e0bbcdf0667e55499f22190486 on sass:master.\n. \nCoverage decreased (-0.05%) to 79.91% when pulling 5745f932e8189da386c22a1ec962c1a60ca3a6f8 on npiguet:master into 51ffdcd450f50f836513b4e720296f35ba7049ef on sass:master.\n. \nCoverage increased (+0.05%) to 79.96% when pulling 01e4b4e4fcbbadc4d00406fb3eaff3c693201962 on mgreter:bugfix/issue_930 into a2a21c33a293a8e26ec1e8f0d8a56aea37f2cad1 on sass:master.\n. \nCoverage remained the same at 79.96% when pulling de6b50637634da50867c7a0f7b90bcfa00f27839 on mgreter:bugfix/move-rpm-spec into a4b17ab2864c856b5c4b3eaf48dfe76bcc576ae2 on sass:master.\n. \nCoverage remained the same at 79.96% when pulling 0c072dd252d16d9b041120ca8a9f10ddd0e1049b on mgreter:feature/cleanings into ad40495c9b2fea23106699a8ce8a55e38fe2f337 on sass:master.\n. \nCoverage increased (+0.76%) to 80.72% when pulling 84a752a4be4d98b7c5d8fa8a77b1cf9944d85f78 on mgreter:travis-ci/output-styles-tests into ad40495c9b2fea23106699a8ce8a55e38fe2f337 on sass:master.\n. \nCoverage remained the same at 80.72% when pulling 7b704d2f1f6060e75e6f18443c639a6c224f7339 on mgreter:bugfix/relative-paths-on-win into e2ee39cb708a46d6d9ce803d3dec977ba782af03 on sass:master.\n. \nCoverage remained the same at 80.72% when pulling d3de95714fba7534bbc4fe07d5ab86a5b5e6b620 on mgreter:bugfix/relative-paths-on-win into e2ee39cb708a46d6d9ce803d3dec977ba782af03 on sass:master.\n. \nCoverage remained the same at 80.72% when pulling 8a62662a4cd8680de9ba018cfed22f9730dfa61c on am11:master into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage remained the same at 80.72% when pulling 7e2802f02553f44807601bd15c406bf6e04ce3d6 on am11:master into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage remained the same at 80.72% when pulling 7e2802f02553f44807601bd15c406bf6e04ce3d6 on am11:master into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage remained the same at 80.72% when pulling 409cc12738e9a17e64f746b13ec00edf1e2a4ac9 on am11:master into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage remained the same at 80.72% when pulling 409cc12738e9a17e64f746b13ec00edf1e2a4ac9 on am11:master into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage remained the same at 80.72% when pulling 63ab83f8332a7276b7c0ec72b0247557f9686f86 on am11:master into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage remained the same at 80.72% when pulling 11bbb66ca69211deef2413a7d34598c1d812a991 on am11:master into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage remained the same at 80.72% when pulling 11bbb66ca69211deef2413a7d34598c1d812a991 on am11:master into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage remained the same at 80.72% when pulling 76b5ef7355eb840127b7ce3d77364028c6ab06b3 on am11:master into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage increased (+0.03%) to 80.42% when pulling 621f1e78ef8b1c8ea37454d3a7701bd219fccbb5 on mgreter:bugfix/issue_947 into 8e7a2947b82adcb79484cbc0843979038c9d7c4a on sass:master.\n. \nCoverage increased (+0.0%) to 80.07% when pulling 47dffc56344c744a2e8e2a6afd104a5dbba60461 on mgreter:bugfix/issue_947 into efeace562d0191b91bc321cd2b84a1a669577de0 on sass:master.\n. \nCoverage remained the same at 80.72% when pulling 26b5595ddc2773c7aeac40f68ebe3519705fa793 on mgreter:bugfix/issue_940 into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.32%) to 80.39% when pulling 8dd7eccff53a80d61faa1d966ff3998a3f7835ea on mgreter:bugfix/issue_941 into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.02%) to 80.7% when pulling 1b1fc934c9bf5e91ed61031d15d8c5bf77ecb9c8 on mgreter:bugfix/issue_942 into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.01%) to 80.7% when pulling 8d1f21fb1b3858f1ff525c8584cc04724377615a on mgreter:bugfix/issue_942 into 421754096a0f03e975b2b95e76e43fa425ce0646 on sass:master.\n. \nCoverage decreased (-0.19%) to 80.53% when pulling 4e5472e0b3f05e1473153d9d31c72ce70e917084 on mgreter:bugfix/issue_945 into 421754096a0f03e975b2b95e76e43fa425ce0646 on sass:master.\n. \nCoverage decreased (-0.46%) to 80.26% when pulling e2e555c1a872616fce7ca36581922426fadcad40 on mgreter:bugfix/issue_938 into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.56%) to 80.16% when pulling c75bb5168839b07989db09aebe1fedbce101b75c on mgreter:bugfix/issue_938 into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.56%) to 80.16% when pulling c75bb5168839b07989db09aebe1fedbce101b75c on mgreter:bugfix/issue_938 into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.09%) to 80.63% when pulling ef73c1b5812612a50de5f8a4404ae6c5b53f45a2 on ekskimn:parent-selector into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.1%) to 80.62% when pulling 776e997da631c78a105d6f9b2135ad2691cd95dc on ekskimn:parent-selector into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.1%) to 80.62% when pulling 324b14f81ef596a39d27d23ad5ca0dc886fda1cd on ekskimn:parent-selector into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.11%) to 80.61% when pulling 1c15df0d9f205848a346adbd7e76f4e838faa94f on ekskimn:parent-selector into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.11%) to 80.61% when pulling d9090b33b575a6cd20a6e1ec3da276d98a4c1ddf on ekskimn:parent-selector into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.08%) to 80.63% when pulling 92e3f0bc5c12c67defa54aafbb3379c3eae7c480 on ekskimn:parent-selector into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.1%) to 80.62% when pulling 98977d8efa06d3443ad187da70222fa0da721808 on ekskimn:parent-selector into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.4%) to 80.32% when pulling 5b6d06a357bd3c06b3b03ac744a4c1d0eadf9903 on ekskimn:parent-selector into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage decreased (-0.4%) to 80.32% when pulling 5b6d06a357bd3c06b3b03ac744a4c1d0eadf9903 on ekskimn:parent-selector into dea27e5e3cc61a0d9f00ffa3f598a1080c6502d6 on sass:master.\n. \nCoverage remained the same at 80.72% when pulling 8f36c759d7192738e7fee0706008a91abddc4cd6 on am11:master into 421754096a0f03e975b2b95e76e43fa425ce0646 on sass:master.\n. \nCoverage increased (+0.08%) to 80.79% when pulling 717c3ed04d49bbd374053c6ce50bf25866a47149 on ekskimn:issue-548 into 62314f6a3cbc7dbed3878884504847edd7fecb7b on sass:master.\n. \nCoverage increased (+0.08%) to 80.79% when pulling 717c3ed04d49bbd374053c6ce50bf25866a47149 on ekskimn:issue-548 into 62314f6a3cbc7dbed3878884504847edd7fecb7b on sass:master.\n. \nCoverage increased (+0.08%) to 80.79% when pulling 47ecb0d78205bca6a5df6785e4f380730fc9d1e8 on ekskimn:issue-548 into 62314f6a3cbc7dbed3878884504847edd7fecb7b on sass:master.\n. \nCoverage increased (+0.08%) to 80.79% when pulling 6735dd5f477894dd19b98e7f39aab8872ccbe797 on xzyfer:feat/ampersand-in-sassscript into 62314f6a3cbc7dbed3878884504847edd7fecb7b on sass:master.\n. \nCoverage increased (+0.23%) to 80.31% when pulling f7f463bfbac73bf3957e7a79337e7e532ff4b895 on onedayitwillmake:master into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage increased (+0.0%) to 80.16% when pulling 063bb9ea8b857f27076ddd96ebb3f58b50a31204 on mgreter:bugfix/issue_943 into bb10765929c5ca730668d4f4c16282799cacb77e on sass:master.\n. \nCoverage increased (+0.01%) to 80.17% when pulling 05dc97dcb9f5500d7bb44a6bc5f07e2532dec7a5 on asottile:error_fatal into bb10765929c5ca730668d4f4c16282799cacb77e on sass:master.\n. \nCoverage increased (+0.03%) to 80.19% when pulling 21cc37816361342c3aeee8822f98dd0d82b05bae on asottile:error_fatal into bb10765929c5ca730668d4f4c16282799cacb77e on sass:master.\n. \nCoverage remained the same at 80.2% when pulling 9e3253945ef431cbda7c3308638097dcee71480d on saper:dlopen into 948854a3169dabc6a82349f4e15f7e910a704d8c on sass:master.\n. \nCoverage increased (+0.02%) to 80.21% when pulling 2f0690067e3fc2c2ee25ea3a40eea2c58789f82b on xzyfer:clean/ampersand-in-sassscript into 3681c480d6105fc18b600e5a8c739d70da65439c on sass:master.\n. \nCoverage increased (+0.0%) to 80.2% when pulling 5c39f37b213ee9d60fa9f3af2a7cbbcc661fe881 on xzyfer:fix/at-directive-parsing into 3681c480d6105fc18b600e5a8c739d70da65439c on sass:master.\n. \nCoverage increased (+0.0%) to 80.2% when pulling 5c88a6bc0cef8f595560377a8b28a2f5fb4bb97a on mgreter:bugfix/issue_972 into 948854a3169dabc6a82349f4e15f7e910a704d8c on sass:master.\n. \nCoverage increased (+0.01%) to 80.2% when pulling d87a792be93db6437a6e980591bd047bf6eab949 on mgreter:bugfix/issue_980 into 948854a3169dabc6a82349f4e15f7e910a704d8c on sass:master.\n. \nCoverage decreased (-0.01%) to 80.19% when pulling 1015f4e090d21534a672d2ca083cbf1e088cb5fa on rodneyrehm:feature/add-included_files-taker into 948854a3169dabc6a82349f4e15f7e910a704d8c on sass:master.\n. \nCoverage increased (+0.03%) to 80.22% when pulling b221b40aa562a29de6aa8ff9ea45fbc5ce420972 on mgreter:feature/global-assignments into f0475ee2de8ba4c00d35cce1d4ae0280bec4e318 on sass:master.\n. \nCoverage remained the same at 80.19% when pulling 33a9107996ee4cb5b9308a90aeb5f0c02e609387 on mgreter:bugfix/issue_988 into f0475ee2de8ba4c00d35cce1d4ae0280bec4e318 on sass:master.\n. \nCoverage increased (+0.06%) to 80.29% when pulling 9fb564e460497501718f737ffe2946574f1c1584 on mgreter:refactor/prelexer into 6ab00d940ccd9b78f93791eeef9b15d65045d706 on sass:master.\n. \nCoverage remained the same at 80.37% when pulling 3ffa142ef39da3b11ef88adbd7e4b4ea9adac8ef on mgreter:dlopen into cfce077e77c71e79bf112fee426b8e351a5c16a9 on sass:master.\n. \nCoverage increased (+0.02%) to 80.39% when pulling 38a91d409f032ff6033dcc726536e620d03db023 on mgreter:bugfix/issue_143 into b287d314f365eed19ccabf1a2fc40ccf38f1ae6f on sass:master.\n. \nCoverage decreased (-0.01%) to 80.38% when pulling 5caacc3848652d9c38a22a5ad8383a41c195c70e on mgreter:bugfix/issue_452 into ff3565b1dae300b7f9caf6d6237c707abce9cf3b on sass:master.\n. \nCoverage increased (+0.01%) to 80.41% when pulling b56aa7ba6ad69aba397754947ef2b0edd00d5b0b on saper:tr1/unordered_map into 091010d677f12b44a267117257a5c8fbfb900d8e on sass:master.\n. \nCoverage remained the same at 80.4% when pulling 9669f7d10e6e9b8c3f003c727e88393bcebde76b on saper:nullptr into 091010d677f12b44a267117257a5c8fbfb900d8e on sass:master.\n. \nCoverage remained the same at 80.4% when pulling 3bc77d3aa5c91872e50304e6289a17ec4419e1d7 on drewwells:bugfix/versionheader into 091010d677f12b44a267117257a5c8fbfb900d8e on sass:master.\n. \nCoverage decreased (-0.35%) to 80.07% when pulling a73ae2637e2a004f98959d28b39fe073125000af on mgreter:feature/expose-file-resolver into ba0b3e0a6c16fb2362ad5a8a38fe30bb1ef69f68 on sass:master.\n. \nCoverage decreased (-0.35%) to 80.07% when pulling f98127a8e032d58c3e644d6eeaa359c37cd345cc on mgreter:feature/expose-file-resolver into ba0b3e0a6c16fb2362ad5a8a38fe30bb1ef69f68 on sass:master.\n. \nCoverage decreased (-0.35%) to 80.07% when pulling f98127a8e032d58c3e644d6eeaa359c37cd345cc on mgreter:feature/expose-file-resolver into ba0b3e0a6c16fb2362ad5a8a38fe30bb1ef69f68 on sass:master.\n. \nCoverage decreased (-2.41%) to 77.99% when pulling 060c95ae8a32e6883e168c360c6ed36d4dbbe73e on drewwells:feature/importslength into 8e7a2947b82adcb79484cbc0843979038c9d7c4a on sass:master.\n. \nCoverage decreased (-0.01%) to 80.39% when pulling 060c95ae8a32e6883e168c360c6ed36d4dbbe73e on drewwells:feature/importslength into 8e7a2947b82adcb79484cbc0843979038c9d7c4a on sass:master.\n. \nCoverage decreased (-0.01%) to 80.39% when pulling 304a8e2f9c2ab1e3bed796a16086fe9857792449 on drewwells:feature/importslength into 8e7a2947b82adcb79484cbc0843979038c9d7c4a on sass:master.\n. \nCoverage increased (+0.03%) to 80.42% when pulling 8d8dc08fdff06e33ccde3725003837968d3f1ae0 on mgreter:bugfix/issue_972 into 8e7a2947b82adcb79484cbc0843979038c9d7c4a on sass:master.\n. \nCoverage decreased (-0.01%) to 80.38% when pulling d4c5731f6f627c757c1828513bceee95bf268139 on mgreter:bugfix/issue_978 into 8e7a2947b82adcb79484cbc0843979038c9d7c4a on sass:master.\n. \nCoverage decreased (-0.11%) to 80.28% when pulling 8439c1cb4a3f4d2700a11caa7b1e7fa0434ccdfb on mgreter:bugfix/parent-selector-eval into 8e7a2947b82adcb79484cbc0843979038c9d7c4a on sass:master.\n. \nCoverage remained the same at 80.09% when pulling 6e92c3d86b9b691b8f9f6da8feddbab79b0a75e5 on saper:auto/pic into b87f4c7a14fd03852bda7238c305269d3340447e on sass:master.\n. \nCoverage remained the same at 80.09% when pulling 6e92c3d86b9b691b8f9f6da8feddbab79b0a75e5 on saper:auto/pic into b87f4c7a14fd03852bda7238c305269d3340447e on sass:master.\n. \nCoverage remained the same at 80.09% when pulling 7d194873e2f7ef9fc0c445550cb0b2f50aa90a06 on am11:master into b87f4c7a14fd03852bda7238c305269d3340447e on sass:master.\n. \nCoverage decreased (-0.01%) to 80.07% when pulling d45026af47de4e97225d818a023111a0ab2552d3 on mgreter:bugfix/issue_1007 into b87f4c7a14fd03852bda7238c305269d3340447e on sass:master.\n. \nCoverage increased (+0.01%) to 80.1% when pulling c1c641196300d740d9d7a452f9cb32e131f6c1f1 on mgreter:bugfix/issue_950 into b87f4c7a14fd03852bda7238c305269d3340447e on sass:master.\n. \nCoverage decreased (-0.11%) to 79.98% when pulling cc1fde7d5ced1e647f1341a91219e3aa50f0ac0c on mgreter:bugfix/issue_674 into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage decreased (-0.13%) to 80.59% when pulling fd1814c58da94497142d929a5dd5be7c39d1ab70 on mgreter:bugfix/issue_674 into 70992f46d995212d2fa81b98776080d0c698cd22 on sass:master.\n. \nCoverage decreased (-0.13%) to 80.59% when pulling fd1814c58da94497142d929a5dd5be7c39d1ab70 on mgreter:bugfix/issue_674 into 70992f46d995212d2fa81b98776080d0c698cd22 on sass:master.\n. \nCoverage remained the same at 80.09% when pulling e220e0653a919803570ede97e59e8a12652029f0 on xzyfer:feat/at-error-feature into 4ebec9ab375c22b6a9393ca6fbf8597aa59c1e23 on sass:master.\n. \nCoverage remained the same at 80.09% when pulling 170de9cccb50ef9e18afdb355cd4798ec6957b90 on xzyfer:feat/at-error-feature into 4ebec9ab375c22b6a9393ca6fbf8597aa59c1e23 on sass:master.\n. \nCoverage decreased (-0.15%) to 79.93% when pulling 0e48782c3692b5822e4d835ba79b6f4c4f285d19 on mgreter:wip/dead-code-paths into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage decreased (-0.17%) to 79.92% when pulling 994bba97815d9eda19cffc64e7ab2cbd00d743f3 on mgreter:wip/dead-code-paths into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage increased (+0.58%) to 80.66% when pulling 6288f013c0932c65d866057759e2cdbe5c554e59 on mgreter:wip/dead-code-paths into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage increased (+0.73%) to 80.82% when pulling 2f030bfab2bc945483ef9cf7289f208adbcbd840 on mgreter:wip/dead-code-paths into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nChanges Unknown when pulling 5b111cfe2e1503262e6a72b8fd6575c1e3b31e6b on xzyfer:feat/units-level-3-feature into * on sass:master*.\n. \nChanges Unknown when pulling 5b111cfe2e1503262e6a72b8fd6575c1e3b31e6b on xzyfer:feat/units-level-3-feature into * on sass:master*.\n. \nCoverage increased (+0.01%) to 80.09% when pulling c1b4dd5a490cdbc6deb4629b6f131717c34aac94 on xzyfer:feat/reference-combinator into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage decreased (-1.67%) to 78.42% when pulling 3d41b6b9dc7a0e5164f3898da02de87af85097c1 on onedayitwillmake:selectorFunctions into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage decreased (-4.26%) to 75.82% when pulling d30928ab315c0320a05c91a00ca2a5b1db48f064 on onedayitwillmake:selectorFunctions into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage decreased (-1.67%) to 78.42% when pulling d30928ab315c0320a05c91a00ca2a5b1db48f064 on onedayitwillmake:selectorFunctions into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage decreased (-1.2%) to 78.88% when pulling 9acd2e78328de4db28fa4fb156b77e5bf8c4a403 on onedayitwillmake:selectorFunctions into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage decreased (-1.26%) to 78.82% when pulling 9e8569ba663d9affa9a5b0c96ab58407507a9e36 on onedayitwillmake:selectorFunctions into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage decreased (-1.26%) to 78.82% when pulling 9e8569ba663d9affa9a5b0c96ab58407507a9e36 on onedayitwillmake:selectorFunctions into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage decreased (-1.14%) to 78.94% when pulling b0858e065a9ae58a0d155ba6e44ceecad580bddf on onedayitwillmake:selectorFunctions into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage decreased (-1.14%) to 78.94% when pulling b0858e065a9ae58a0d155ba6e44ceecad580bddf on onedayitwillmake:selectorFunctions into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage decreased (-1.0%) to 79.7% when pulling 9dfd9683951658ebdbb132281ae8d9d7c0fcd6cd on onedayitwillmake:selectorFunctions into 1e3db6b16fa4109ef8c96a51749842408eae4bcb on sass:master.\n. \nCoverage decreased (-1.0%) to 79.7% when pulling 9dfd9683951658ebdbb132281ae8d9d7c0fcd6cd on onedayitwillmake:selectorFunctions into 1e3db6b16fa4109ef8c96a51749842408eae4bcb on sass:master.\n. \nCoverage decreased (-1.52%) to 79.18% when pulling 9dfd9683951658ebdbb132281ae8d9d7c0fcd6cd on onedayitwillmake:selectorFunctions into 1e3db6b16fa4109ef8c96a51749842408eae4bcb on sass:master.\n. \nCoverage decreased (-1.52%) to 79.18% when pulling 9dfd9683951658ebdbb132281ae8d9d7c0fcd6cd on onedayitwillmake:selectorFunctions into 1e3db6b16fa4109ef8c96a51749842408eae4bcb on sass:master.\n. \nCoverage increased (+0.23%) to 80.31% when pulling c9b8ee55a6e29480c345214ba6745f36b81b911e on mgreter:test/travis-osx-support into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage increased (+0.14%) to 80.22% when pulling 7bdcd6ad3af54881e09c07db89fc114a671e860c on mgreter:bugfix/issue_1021 into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage increased (+0.14%) to 80.22% when pulling 7bdcd6ad3af54881e09c07db89fc114a671e860c on mgreter:bugfix/issue_1021 into d215db5edb90035d18b616a499730841a5b622df on sass:master.\n. \nCoverage increased (+0.02%) to 80.32% when pulling 35db19c580ceae50bb234f078cc2437df2fc5226 on mgreter:bugfix/issue_592 into fd7f20fa5f8f7b8b4a4d82c28e229c402bb02098 on sass:master.\n. \nCoverage decreased (-0.02%) to 80.28% when pulling 625a2a0abef0163418ea165047899998105346fd on mgreter:bugfix/issue_823 into fd7f20fa5f8f7b8b4a4d82c28e229c402bb02098 on sass:master.\n. \nCoverage decreased (-0.02%) to 80.7% when pulling ce01b5e647716037ddb05b3d4f9c05bc9a4190e2 on mgreter:bugfix/issue_823 into 70992f46d995212d2fa81b98776080d0c698cd22 on sass:master.\n. \nCoverage increased (+0.39%) to 80.69% when pulling bb4777cf13e41fc949fca7b0cfc21a4d1132d7fa on mgreter:bugfix/issue_1035 into fd7f20fa5f8f7b8b4a4d82c28e229c402bb02098 on sass:master.\n. \nCoverage increased (+0.01%) to 80.3% when pulling ed30ce56c6ee55badd57664e339daa9cc7c60c6c on mgreter:bugfix/issue_1025 into fd7f20fa5f8f7b8b4a4d82c28e229c402bb02098 on sass:master.\n. \nCoverage increased (+0.03%) to 80.62% when pulling 427a31ca043203846ac034e34e8520c601cacde6 on mgreter:bugfix/feature-block-indent into 5a037bbd93cf5a5e840178e1f83f3274e99f6eb9 on sass:master.\n. \nCoverage increased (+0.03%) to 80.59% when pulling 2ce13636e9fe5f1466147b4ee8ec8f641b4f0a0c on mgreter:feature/import-with-media-queries into f82a41ba56094e586dd33b7d2451d84abf5a4f55 on sass:master.\n. \nCoverage increased (+0.09%) to 80.64% when pulling b5dfefae906f69785d8432e754170b9468dcbc34 on mgreter:feature/eliminate-nested-not into f82a41ba56094e586dd33b7d2451d84abf5a4f55 on sass:master.\n. \nCoverage increased (+0.04%) to 80.31% when pulling 1bc35fa7ee6c7ba2bc96b34c9f351e7ba2cb3735 on mgreter:feature/eliminate-nested-not into 9ad775fdfe568efb92ae936edadacea6d5a60da3 on sass:master.\n. \nCoverage increased (+0.04%) to 80.31% when pulling 1bc35fa7ee6c7ba2bc96b34c9f351e7ba2cb3735 on mgreter:feature/eliminate-nested-not into 9ad775fdfe568efb92ae936edadacea6d5a60da3 on sass:master.\n. \nCoverage increased (+0.02%) to 80.64% when pulling cbbdc064f53164c101d440127e93d843590f3930 on mgreter:bugfix/str-slice-function into f82a41ba56094e586dd33b7d2451d84abf5a4f55 on sass:master.\n. \nCoverage increased (+0.08%) to 80.64% when pulling e89d61646bc746e588a27fb88eb5cae9abca89b7 on mgreter:bugfix/str-slice-function into f82a41ba56094e586dd33b7d2451d84abf5a4f55 on sass:master.\n. \nCoverage increased (+0.02%) to 80.29% when pulling 3467e6013a8c63d2ddb645b352e79cfe10a2f907 on mgreter:bugfix/str-slice-function into 9ad775fdfe568efb92ae936edadacea6d5a60da3 on sass:master.\n. \nCoverage increased (+0.0%) to 80.56% when pulling eed66985bc60e5e99157f880f591fddd7bfc2e5b on mgreter:bugfix/math-ops-with-units into f82a41ba56094e586dd33b7d2451d84abf5a4f55 on sass:master.\n. \nCoverage increased (+0.02%) to 80.28% when pulling b5ac186d1838a5336e8ae81fa010fe55e027e74b on mgreter:bugfix/math-ops-with-units into 9ad775fdfe568efb92ae936edadacea6d5a60da3 on sass:master.\n. \nCoverage increased (+0.07%) to 80.63% when pulling 2421ef03db56d6a49680b4532ff0e8975d6ce471 on mgreter:bugfix/preserve-separator-with-varargs into f82a41ba56094e586dd33b7d2451d84abf5a4f55 on sass:master.\n. \nCoverage increased (+0.01%) to 80.28% when pulling 7dc9f16bbed03b424514d35834e58b94d04894b1 on mgreter:bugfix/preserve-separator-with-varargs into 9ad775fdfe568efb92ae936edadacea6d5a60da3 on sass:master.\n. \nCoverage decreased (-0.12%) to 80.21% when pulling ae310a71529b0ba65fe6d61bd92102befbe9329c on mgreter:bugfix/preserve-separator-with-varargs into 66631c07ba6e2ff2f740924369114ab9248f168d on sass:master.\n. \nCoverage increased (+0.07%) to 80.63% when pulling 51b0bf03ac0eb88ef8e91193d4f6a9763af0799c on mgreter:bugfix/url-trailing-spaces into f82a41ba56094e586dd33b7d2451d84abf5a4f55 on sass:master.\n. \nCoverage decreased (-0.01%) to 80.62% when pulling 64f83974d54a8f27d18fa224dd1ab6b1edc14be2 on mgreter:bugfix/issue_1053 into f82a41ba56094e586dd33b7d2451d84abf5a4f55 on sass:master.\n. \nCoverage increased (+0.0%) to 80.63% when pulling 3f1c048134bc7d5bb9d07271f430d467fba83fca on mgreter:lower-compact-to-warning into f82a41ba56094e586dd33b7d2451d84abf5a4f55 on sass:master.\n. \nCoverage increased (+0.01%) to 80.28% when pulling 58ffae1a00445b321fbe1cad516550ec96c415b2 on mgreter:lower-compact-to-warning into 9ad775fdfe568efb92ae936edadacea6d5a60da3 on sass:master.\n. \nCoverage increased (+0.09%) to 80.65% when pulling c9ff5c993681cdeda9b90cc7bb36d61c608268d4 on mgreter:feature/selector-namespace into f82a41ba56094e586dd33b7d2451d84abf5a4f55 on sass:master.\n. \nCoverage remained the same at 80.56% when pulling a4a5511488843069dff778f9e77bafa760231b60 on xzyfer:fix/elseif into f82a41ba56094e586dd33b7d2451d84abf5a4f55 on sass:master.\n. \nCoverage increased (+0.07%) to 80.62% when pulling a4a5511488843069dff778f9e77bafa760231b60 on xzyfer:fix/elseif into f82a41ba56094e586dd33b7d2451d84abf5a4f55 on sass:master.\n. \nCoverage decreased (-1.58%) to 79.06% when pulling a7e93f8c5bfaad7745aa64e50a39438b2f53eaf9 on onedayitwillmake:selector_functions into 01352784469e685713654ebe457877a2f7abe3ff on sass:master.\n. \nCoverage decreased (-4.4%) to 76.24% when pulling 189fa0dad93e02510d8efca81999ba4b076a59fb on onedayitwillmake:selector_functions into 01352784469e685713654ebe457877a2f7abe3ff on sass:master.\n. \nChanges Unknown when pulling 0c606ea8558404e01e1c81e235cc6bbf6836bab8 on onedayitwillmake:selector_functions into * on sass:master*.\n. \nChanges Unknown when pulling 1e71a0982b9be7d0585a780708b04f39673dd648 on onedayitwillmake:selector_functions into * on sass:master*.\n. \nCoverage decreased (-1.8%) to 78.46% when pulling 74600d348b53808cf720c17a816f471962a571be on onedayitwillmake:selector_functions into 20d887093075b4d219df441acca19e40ee765740 on sass:master.\n. \nCoverage increased (+0.01%) to 80.65% when pulling a400011078782eb440d501d6c1c978d22130ab17 on mgreter:bugfix/multiline-win-lf into 01352784469e685713654ebe457877a2f7abe3ff on sass:master.\n. \nCoverage increased (+0.01%) to 80.64% when pulling 8330a1a97aaac179b79062467befb766899b990e on mgreter:feature/restore-token-on-fail into 01352784469e685713654ebe457877a2f7abe3ff on sass:master.\n. \nCoverage remained the same at 80.64% when pulling 5ef668846e800980f7590de57e1a4f1b558b794b on mgreter:bugfix/issue_1068 into 01352784469e685713654ebe457877a2f7abe3ff on sass:master.\n. \nCoverage decreased (-2.54%) to 78.1% when pulling e9079da96870160e8755ad1be02895ba17c4bea6 on onedayitwillmake:xcode into 01352784469e685713654ebe457877a2f7abe3ff on sass:master.\n. \nCoverage remained the same at 80.64% when pulling e9079da96870160e8755ad1be02895ba17c4bea6 on onedayitwillmake:xcode into 01352784469e685713654ebe457877a2f7abe3ff on sass:master.\n. \nCoverage increased (+0.02%) to 80.66% when pulling 041f3a7517d4d216725197dc9cf6b08e76ac4680 on xzyfer:fix/elseif-duex into 01352784469e685713654ebe457877a2f7abe3ff on sass:master.\n. \nCoverage increased (+0.02%) to 80.66% when pulling 041f3a7517d4d216725197dc9cf6b08e76ac4680 on xzyfer:fix/elseif-duex into 01352784469e685713654ebe457877a2f7abe3ff on sass:master.\n. \nCoverage decreased (-0.01%) to 80.65% when pulling 773dd3f88e3308943f435ba7a98150dd96567477 on mgreter:bugfix/issue_1056 into c8785121cf8229a7adc3a7aac80bf998348f27d1 on sass:master.\n. \nCoverage decreased (-0.02%) to 80.64% when pulling 263c4de1ab092414f59d3ec79fd7192c43e0925c on mgreter:bugfix/issue_1074 into 815c03b37a796cb7768b7e9f733ac130c3f09a2e on sass:master.\n. \nCoverage increased (+0.0%) to 80.67% when pulling 325b507bf99fbfc03460fc8d6b14f3101c4e24c8 on mgreter:bugfix/issue_1075 into 815c03b37a796cb7768b7e9f733ac130c3f09a2e on sass:master.\n. \nCoverage remained the same at 80.67% when pulling 2c5f97a14eaf50519b7e1176ffbf0eedb27ec735 on saper:fix/node/843 into 815c03b37a796cb7768b7e9f733ac130c3f09a2e on sass:master.\n. \nCoverage decreased (-0.15%) to 80.45% when pulling 02aa04d3cf36faeb4d2893eca6925c82e47b8ba9 on mgreter:bugfix/issue_1081 into e60ad9a9c27ee3b189cc41581094349c703d3f88 on sass:master.\n. \nCoverage decreased (-0.15%) to 80.42% when pulling 9bc24a9444b5ca5f82619b359b56d49fcf85e482 on mgreter:bugfix/issue_1081 into c4fb559be0a3c39e0c71c88a36b0af5f1e8c456f on sass:master.\n. \nCoverage remained the same at 80.6% when pulling 8e1da10b3bd474a27a4502319f574c79bdb85b9a on mgreter:bugfix/issue_1082 into e60ad9a9c27ee3b189cc41581094349c703d3f88 on sass:master.\n. \nCoverage remained the same at 80.6% when pulling 8e1da10b3bd474a27a4502319f574c79bdb85b9a on mgreter:bugfix/issue_1082 into e60ad9a9c27ee3b189cc41581094349c703d3f88 on sass:master.\n. \nCoverage decreased (-0.03%) to 80.57% when pulling 980e17dbe54b0dba563ed09a8bfdf46222e9b9b0 on mgreter:bugfix/issue_1082 into e60ad9a9c27ee3b189cc41581094349c703d3f88 on sass:master.\n. \nCoverage remained the same at 80.57% when pulling f8d9f27b844ec0f8f15d3f53452acd3bd0138174 on mgreter:hotfix/issue_1087 into c4fb559be0a3c39e0c71c88a36b0af5f1e8c456f on sass:master.\n. \nCoverage decreased (-0.24%) to 80.36% when pulling e08239c3567f57080707bf86808ecf18c8b6696b on mgreter:hotfix/issue_1086 into e60ad9a9c27ee3b189cc41581094349c703d3f88 on sass:master.\n. \nCoverage decreased (-0.22%) to 80.35% when pulling 9684c0090da52a308ed778c18351918975926d39 on mgreter:hotfix/issue_1086 into c4fb559be0a3c39e0c71c88a36b0af5f1e8c456f on sass:master.\n. \nCoverage decreased (-0.22%) to 80.35% when pulling 9684c0090da52a308ed778c18351918975926d39 on mgreter:hotfix/issue_1086 into c4fb559be0a3c39e0c71c88a36b0af5f1e8c456f on sass:master.\n. \nCoverage decreased (-0.24%) to 80.33% when pulling 9684c0090da52a308ed778c18351918975926d39 on mgreter:hotfix/issue_1086 into c4fb559be0a3c39e0c71c88a36b0af5f1e8c456f on sass:master.\n. \nCoverage remained the same at 80.28% when pulling f32cc4a54ed6464d59511bc66646102805d3b590 on Candid:master into 0dd65439366bd4b6d9fce42a7f6a45990df5e836 on sass:master.\n. \nCoverage remained the same at 80.28% when pulling f2a73edb9da9ff48fbd2cecbcd13c7353fee4419 on Candid:master into 0dd65439366bd4b6d9fce42a7f6a45990df5e836 on sass:master.\n. \nCoverage remained the same at 80.28% when pulling 1047fcc21c4f199d7f6fe813f88f566fa747f470 on saper:pull/1094/3 into 0dd65439366bd4b6d9fce42a7f6a45990df5e836 on sass:master.\n. \nCoverage remained the same at 80.28% when pulling 1047fcc21c4f199d7f6fe813f88f566fa747f470 on saper:pull/1094/3 into 0dd65439366bd4b6d9fce42a7f6a45990df5e836 on sass:master.\n. \nCoverage remained the same at 80.28% when pulling fb43360f1de24044306ccb910a0cddae6f61e136 on saper:pull/1094/3 into 0dd65439366bd4b6d9fce42a7f6a45990df5e836 on sass:master.\n. \nCoverage remained the same at 80.28% when pulling 3799d2ef7dbf7b00ef3362811f7f262d69807090 on xzyfer:fix/random-no-limit into ea8d03393715f1b0c077a22bd349c90f59220955 on sass:master.\n. \nCoverage remained the same at 80.28% when pulling 3799d2ef7dbf7b00ef3362811f7f262d69807090 on xzyfer:fix/random-no-limit into ea8d03393715f1b0c077a22bd349c90f59220955 on sass:master.\n. \nCoverage decreased (-0.0%) to 80.27% when pulling 252c622a105b966a2ec4cee6a8aa14168733106d on mgreter:bugfix/issue_1106 into 8905202b72913de393d58b3127530ccd50c22a6c on sass:master.\n. \nCoverage remained the same at 80.28% when pulling 5a9da2ff19503f29a038f6b5e9893cb0580aef11 on xzyfer:feat/slack-button into 8905202b72913de393d58b3127530ccd50c22a6c on sass:master.\n. \nCoverage decreased (-2.45%) to 77.83% when pulling 5a9da2ff19503f29a038f6b5e9893cb0580aef11 on xzyfer:feat/slack-button into 8905202b72913de393d58b3127530ccd50c22a6c on sass:master.\n. \nCoverage decreased (-0.0%) to 80.27% when pulling 5a9da2ff19503f29a038f6b5e9893cb0580aef11 on xzyfer:feat/slack-button into 8905202b72913de393d58b3127530ccd50c22a6c on sass:master.\n. \nCoverage increased (+0.01%) to 80.28% when pulling c040f548e5fdc4d06a7eb1f488e7c9adb3669fd7 on xzyfer:fix/ie-hack-regression into c68b0a009379e490227d91f5bc331fc9e8da17f6 on sass:master.\n. \nCoverage decreased (-0.0%) to 80.29% when pulling 93ab23a3204ee3017de4fc3afdd49212ac26b593 on xzyfer:fix/ie-hack-regression into a140623c167089099002c97550da86cbd4874ff0 on sass:master.\n. \nCoverage increased (+0.01%) to 80.31% when pulling 925220c57cfc9e3bc44c317eba473733194069c4 on xzyfer:fix/ie-hack-regression into a140623c167089099002c97550da86cbd4874ff0 on sass:master.\n. \nCoverage increased (+0.04%) to 80.32% when pulling 8e048656a9d03c6479a0fa5519d05df1343b346b on mgreter:bugfix/issue_1115 into f90a1b7af6b3379b7b528b375b746ebb4a02f421 on sass:master.\n. \nCoverage decreased (-0.03%) to 80.29% when pulling 08a00b5e6594b11d82d967c15dc1ae8f8e2192dc on mgreter:bugfix/issue_1115 into daf9163652c909993f949d88e7798394c1a6c882 on sass:master.\n. \nCoverage decreased (-0.02%) to 80.3% when pulling e771bc5a9e1127fff1ae64d5b1671f15647badc9 on mgreter:bugfix/issue_1115 into daf9163652c909993f949d88e7798394c1a6c882 on sass:master.\n. \nCoverage decreased (-0.06%) to 80.26% when pulling d928f7d3d6e7655399cc6e6dcecd96c012724e0a on mgreter:bugfix/issue_1115 into daf9163652c909993f949d88e7798394c1a6c882 on sass:master.\n. \nCoverage decreased (-0.06%) to 80.26% when pulling 8265b6bb9d9f27ba74a5eb760556bc8a7ad64fd7 on mgreter:bugfix/issue_1115 into daf9163652c909993f949d88e7798394c1a6c882 on sass:master.\n. \nCoverage decreased (-0.05%) to 80.27% when pulling 7df70e65d5f3943f48d6bca6e564a3685323d032 on mgreter:bugfix/issue_1115 into daf9163652c909993f949d88e7798394c1a6c882 on sass:master.\n. \nCoverage remained the same at 80.27% when pulling 111795d11c9366aea896c0c36e07ba42a74f9380 on xzyfer:feat/better-slack-ur into f90a1b7af6b3379b7b528b375b746ebb4a02f421 on sass:master.\n. \nCoverage increased (+0.0%) to 80.28% when pulling cb77da70ba34b9482c4b7ead8b47f24337bd83c3 on xzyfer:feat/quote-null into fec7377022fe1af2c437a28686163f0dc46b8a95 on sass:master.\n. \nCoverage decreased (-0.01%) to 80.27% when pulling 0a6656186de28dbf38fde6ff8c108d65a870db16 on xzyfer:cleanup/function/unquote into 8963264ddeb2adca6c27818ad93fe6e84ff4912e on sass:master.\n. \nCoverage decreased (-0.03%) to 80.25% when pulling 120d8ebab68b8da0e7b258655e0ab299234a4570 on mgreter:bugfix/issue_1130 into 8963264ddeb2adca6c27818ad93fe6e84ff4912e on sass:master.\n. \nCoverage remained the same at 80.27% when pulling 91429dc039a4d6edb988c27aba617cbb3add450a on xzyfer:fix/function/hue into 25f2d10673112c88e6b67bf58d59a2153c57083a on sass:master.\n. \nCoverage increased (+0.02%) to 80.3% when pulling 5b332dc4bd7cf0ef50b9e911cfcb5ff7b9dfddb3 on xzyfer:fix/issue-1133 into f1c9e0692bc70da6ef53ec4823dde1dd8a5a4953 on sass:master.\n. \nCoverage increased (+0.02%) to 80.3% when pulling 8af0da1e37842415321496b4f9598d57d3af22ae on xzyfer:fix/issue-1133 into f1c9e0692bc70da6ef53ec4823dde1dd8a5a4953 on sass:master.\n. \nCoverage increased (+0.02%) to 80.3% when pulling 34f6053196bf4364ba15a6d7a80df45fa66975b3 on xzyfer:fix/issue-1133 into f1c9e0692bc70da6ef53ec4823dde1dd8a5a4953 on sass:master.\n. \nCoverage increased (+0.04%) to 80.34% when pulling cd5eb31707fe3b3bfad56e92488477a8f11fb051 on xzyfer:fix/property-strings into a140623c167089099002c97550da86cbd4874ff0 on sass:master.\n. \nCoverage increased (+0.0%) to 80.31% when pulling 85649d34b23610fac65b56ca2da37ac840645207 on xzyfer:fix/property-strings into 73979ff34955d6f52ab9456494e5794c9e29e2e2 on sass:master.\n. \nCoverage increased (+0.0%) to 80.3% when pulling f6240e93fb1de21d705ce64e448b640024260a0f on xzyfer:fix/compact-comment-output into a140623c167089099002c97550da86cbd4874ff0 on sass:master.\n. \nCoverage increased (+0.0%) to 80.3% when pulling f6240e93fb1de21d705ce64e448b640024260a0f on xzyfer:fix/compact-comment-output into a140623c167089099002c97550da86cbd4874ff0 on sass:master.\n. \nCoverage increased (+0.0%) to 80.3% when pulling be223412d461fe0b10e66c8c51688c6d095f4380 on xzyfer:fix/compact-comment-output into a140623c167089099002c97550da86cbd4874ff0 on sass:master.\n. \nCoverage remained the same at 80.3% when pulling af40c98d79cb30c84e2141e5292511544b1ab898 on xzyfer:fix/compact-comment-output into 73979ff34955d6f52ab9456494e5794c9e29e2e2 on sass:master.\n. \nCoverage remained the same at 80.3% when pulling af40c98d79cb30c84e2141e5292511544b1ab898 on xzyfer:fix/compact-comment-output into 73979ff34955d6f52ab9456494e5794c9e29e2e2 on sass:master.\n. \nCoverage increased (+0.01%) to 80.32% when pulling af40c98d79cb30c84e2141e5292511544b1ab898 on xzyfer:fix/compact-comment-output into 73979ff34955d6f52ab9456494e5794c9e29e2e2 on sass:master.\n. \nCoverage decreased (-0.01%) to 80.26% when pulling 6f50613afacd7eb82a984795f2b92ff3aad33f7a on mgreter:bugfix/issue_1080 into 89338a7f29285b08667d59ed33eeb20868c30ef5 on sass:master.\n. \nCoverage decreased (-0.01%) to 80.26% when pulling 94cbc82dff338c4913ec342dc4c31e20834edde0 on mgreter:bugfix/issue_1080 into 9ad775fdfe568efb92ae936edadacea6d5a60da3 on sass:master.\n. \nCoverage remained the same at 80.27% when pulling a278cea24366c36b50f90dc32c27553a4283ba50 on mgreter:bugfix/issue_1101 into 89338a7f29285b08667d59ed33eeb20868c30ef5 on sass:master.\n. \nCoverage decreased (-0.0%) to 80.26% when pulling 79e8d32e05f8b6fce0dc60c62f6b8cabcc8dc92b on mgreter:bugfix/issue_1101 into 89338a7f29285b08667d59ed33eeb20868c30ef5 on sass:master.\n. \nCoverage remained the same at 80.26% when pulling e88c4ce55ad0f1b0b00a74c0671cd2ddba070a34 on mgreter:feature/issue_1146 into 20d887093075b4d219df441acca19e40ee765740 on sass:master.\n. \nCoverage decreased (-0.08%) to 80.18% when pulling ad07679b241a67e3bb525476462ae1080a7212d5 on mgreter:feature/c-api-string-quoted into 20d887093075b4d219df441acca19e40ee765740 on sass:master.\n. \nCoverage remained the same at 80.26% when pulling 0e5bc24beed46f821a1237ebf07619e6951a99cb on xzyfer:fix/1144 into 20d887093075b4d219df441acca19e40ee765740 on sass:master.\n. \nCoverage increased (+0.01%) to 80.27% when pulling 299e2a7489f667530b02e5ffbb8e3196b38d3e39 on xzyfer:fix/1140 into b9439154bb011268121d01ab904080dff80b2424 on sass:master.\n. \nCoverage increased (+0.01%) to 80.27% when pulling 299e2a7489f667530b02e5ffbb8e3196b38d3e39 on xzyfer:fix/1140 into b9439154bb011268121d01ab904080dff80b2424 on sass:master.\n. \nCoverage remained the same at 80.33% when pulling 195e05a940656f554c8f56a8893e82d81c19796e on mgreter:bugfix/missing-fn-declarations into e716caa918d86b3b8598e8ad639943fe6ec8e0ec on sass:master.\n. \nCoverage decreased (-0.02%) to 80.31% when pulling b1738d08ba5cbd4f8b7074aebafd60daa0e78016 on xzyfer:feat/salt-the-earth-of-compact into 040f8ce5fa93417be87de3b5a96b7fe741f278c8 on sass:master.\n. \nCoverage increased (+0.02%) to 80.35% when pulling e53f613d82d38fd7bdf3ad9d6809bb0eff5d28be on carsonmcdonald:maxstack into 040f8ce5fa93417be87de3b5a96b7fe741f278c8 on sass:master.\n. \nCoverage decreased (-0.13%) to 80.2% when pulling 081decb9a1643e1e7c6d46a5fbe35e096c86acad on mgreter:bugfix/issue_1049 into 66631c07ba6e2ff2f740924369114ab9248f168d on sass:master.\n. \nCoverage decreased (-0.13%) to 80.2% when pulling 558b54bf8c4c0aae0bd84fb781bfae1ce9bf1a4b on mgreter:bugfix/issue_1103 into 66631c07ba6e2ff2f740924369114ab9248f168d on sass:master.\n. \nCoverage decreased (-0.07%) to 80.26% when pulling cc26444860f20497e3e4747827646c6a7120b04a on mgreter:bugfix/issue_1153 into 66631c07ba6e2ff2f740924369114ab9248f168d on sass:master.\n. \nCoverage decreased (-0.08%) to 80.25% when pulling 8bc46e45353e588b05bc97f6e3c3d04a922aa7a1 on mgreter:bugfix/issue_1153 into 66631c07ba6e2ff2f740924369114ab9248f168d on sass:master.\n. \nCoverage decreased (-0.39%) to 79.94% when pulling 2653a4a7859a4d8be5a9974c6c0de76455f6711a on mgreter:bugfix/issue_1167 into 66631c07ba6e2ff2f740924369114ab9248f168d on sass:master.\n. \nCoverage decreased (-0.15%) to 80.18% when pulling 47bc6651cb03606da279fdce783530c1e9a8d45c on mgreter:bugfix/issue_1171 into 66631c07ba6e2ff2f740924369114ab9248f168d on sass:master.\n. \nCoverage decreased (-0.21%) to 80.11% when pulling 3030315452431c36f5e65156549d879aa438801a on mgreter:bugfix/issue_1168 into 66631c07ba6e2ff2f740924369114ab9248f168d on sass:master.\n. \nCoverage decreased (-0.13%) to 80.2% when pulling 9c74c7a48de7542c4dca93f49f98a85e163941fa on mgreter:bugfix/issue_1169 into 66631c07ba6e2ff2f740924369114ab9248f168d on sass:master.\n. \nCoverage decreased (-0.12%) to 80.21% when pulling 8ae39173ff73e4d870c06c10a6ef39e4fb09f30f on mgreter:bugfix/issue_1170 into 66631c07ba6e2ff2f740924369114ab9248f168d on sass:master.\n. \nCoverage increased (+0.07%) to 80.18% when pulling 974ae42b87a3714fff5ed38132272486747f524c on mgreter:bugfix/issue_1158 into 348fde80d3da4e8be121573579f5e1cdbd888e69 on sass:master.\n. \nCoverage increased (+0.01%) to 80.12% when pulling 265ced8713a50d4e58e2f361ed800c0676745e33 on mgreter:bugfix/issue_1178 into 348fde80d3da4e8be121573579f5e1cdbd888e69 on sass:master.\n. \nCoverage decreased (-0.04%) to 80.07% when pulling c5caf83522bd080ddad49aadd78d5efdc4063323 on mgreter:bugfix/issue_1093 into 348fde80d3da4e8be121573579f5e1cdbd888e69 on sass:master.\n. \nCoverage increased (+0.0%) to 80.11% when pulling aee4b963748fccf7fa01c66ddd9f25e8da760c23 on mgreter:bugfix/issue_1092 into 348fde80d3da4e8be121573579f5e1cdbd888e69 on sass:master.\n. \nCoverage increased (+0.2%) to 80.11% when pulling bde8ee57d5b8bb80663b1e8ff553c88dcc51cde0 on mgreter:bugfix/issue_1117 into f802410637d14ec405ed68af79bd01e546cb73eb on sass:master.\n. \nCoverage remained the same at 80.11% when pulling 9ab050f1b58a8f7772cf5efe0d703115fdd5bd4e on mgreter:bugfix/issue_1117 into 348fde80d3da4e8be121573579f5e1cdbd888e69 on sass:master.\n. \nCoverage increased (+0.17%) to 80.07% when pulling 4e4bb40ed3410e61f03fa416d49a13190254470b on mgreter:bugfix/issue_1016 into f802410637d14ec405ed68af79bd01e546cb73eb on sass:master.\n. \nCoverage decreased (-0.04%) to 80.07% when pulling 3f536a99d322542487c6d04c75361e4812846a20 on mgreter:bugfix/issue_1016 into 348fde80d3da4e8be121573579f5e1cdbd888e69 on sass:master.\n. \nCoverage increased (+0.19%) to 80.1% when pulling d313b88d84de086aaca38099d68e7f54e902c8d7 on mgreter:bugfix/issue_948 into f802410637d14ec405ed68af79bd01e546cb73eb on sass:master.\n. \nCoverage decreased (-0.15%) to 79.96% when pulling b9880e8141eeda7d5e1913b3058e9820f341d2da on mgreter:bugfix/issue_948 into 348fde80d3da4e8be121573579f5e1cdbd888e69 on sass:master.\n. \nCoverage remained the same at 80.14% when pulling 930d68b15a3e3f4d7d860b8bc142c42ddb862763 on saper:fix/1185 into 3cf31efc229d0492754de1bbc791154e05a4ae67 on sass:master.\n. \nCoverage decreased (-0.02%) to 80.13% when pulling 649bc61376954275299b81029c940e6d20baa3af on saper:fix/1185 into 3cf31efc229d0492754de1bbc791154e05a4ae67 on sass:master.\n. \nCoverage decreased (-0.02%) to 80.12% when pulling 55fa15b438be66b89c903631f111cd77926b3fae on saper:fix/1185pp into 3cf31efc229d0492754de1bbc791154e05a4ae67 on sass:master.\n. \nCoverage increased (+0.07%) to 80.19% when pulling 167f2a8b22e043ba1d36f28b4ee23a2fb41d3934 on mgreter:bugfix/issue_1192 into fb82f0bb604a457670ecaf87e10435d2a23af7e2 on sass:master.\n. \nCoverage decreased (-0.17%) to 80.02% when pulling cd18ae88b7553c12a31b4a7367f698d5af781b10 on mgreter:bugfix/issue_1188 into fb33a2a64ef8d05df4c8d6eeaf86e38b5a87d28c on sass:master.\n. \nCoverage increased (+0.02%) to 80.14% when pulling 8b556bc69ed960b50d66e8d12fa5313e2c37a41f on mgreter:bugfix/issue_1187 into fb82f0bb604a457670ecaf87e10435d2a23af7e2 on sass:master.\n. \nCoverage increased (+0.02%) to 80.14% when pulling 2eef52a6d083e84318635fc8e3907f59c6a870e0 on mgreter:bugfix/issue_1187 into 8ca8816d1ce6deb445afd1ad67857b33f8c7f7ef on sass:master.\n. \nCoverage decreased (-0.02%) to 80.17% when pulling 258e8b7f1daa96d11dfda8dd45c094d51e4813b3 on mgreter:bugfix/issue_1096 into fb33a2a64ef8d05df4c8d6eeaf86e38b5a87d28c on sass:master.\n. \nCoverage decreased (-0.02%) to 80.1% when pulling 9b8545b5337268bc175d08a3ca405fa643df893c on mgreter:bugfix/issue_1096 into 8ca8816d1ce6deb445afd1ad67857b33f8c7f7ef on sass:master.\n. \nCoverage decreased (-0.06%) to 80.13% when pulling af234df293e78420bd1ffcb060946799f324dc3a on mgreter:bugfix/issue_593 into fb33a2a64ef8d05df4c8d6eeaf86e38b5a87d28c on sass:master.\n. \nCoverage increased (+0.01%) to 80.2% when pulling fa720a7dca535eb7f1ec836a51dd55e50683ed4c on mgreter:bugfix/issue_442 into fb33a2a64ef8d05df4c8d6eeaf86e38b5a87d28c on sass:master.\n. \nCoverage decreased (-0.01%) to 80.1% when pulling e00aec60a385b4eededeaa2e3ac53fe05cc81dd4 on mgreter:bugfix/issue_442 into 8ca8816d1ce6deb445afd1ad67857b33f8c7f7ef on sass:master.\n. \nCoverage decreased (-0.14%) to 80.05% when pulling 40af5ea638abe45c3a562ee8fa4cb3c37d26982a on tysongach:tg-capitalization into fb33a2a64ef8d05df4c8d6eeaf86e38b5a87d28c on sass:master.\n. \nCoverage decreased (-0.01%) to 80.11% when pulling ff3f8a0692c16cfd0fb043eb76c985950c8a7e68 on mgreter:feature/selector-functions-basic into 28ee0884243820a34c3458e26b36fc59ccefd9b3 on sass:master.\n. \nCoverage increased (+0.13%) to 80.25% when pulling f8074a0efe34eb3f4743f5171ed15dafa1ab0b1e on mgreter:feature/selector-functions-basic into 28ee0884243820a34c3458e26b36fc59ccefd9b3 on sass:master.\n. \nCoverage remained the same at 80.25% when pulling 75877d0adf401c6d9873a08f7dd8c1a5e5dfa620 on xzyfer:fix/issue-1208 into a6482aac915f46e3e9033afd88659889b215a288 on sass:master.\n. \nCoverage increased (+0.01%) to 80.26% when pulling 9cce07e90a3b742359a80cf18d2bf2766fd69156 on xzyfer:fix/issue-1206 into a6482aac915f46e3e9033afd88659889b215a288 on sass:master.\n. \nCoverage decreased (-0.0%) to 80.27% when pulling e9097fcbe01df278f18819486eeaf2a601033bd9 on xzyfer:fix/at-rules-with-variables into 9aeadf494fe420c7ad1f0b2ee4bf812c40046ad0 on sass:master.\n. \nCoverage decreased (-0.07%) to 80.22% when pulling 8671263f0bf0f945f85d6298f9f6dc8f33945212 on mgreter:feature/refactor-contextualize into 221d7fb8db51fa85010323c26e08500f1ee180c2 on sass:master.\n. \nCoverage increased (+0.02%) to 80.28% when pulling 362cbaa83c5c7a1b7577a246b982cf34dfd4ec8a on xzyfer:feat/unquote-media-query-expressions into eb58cef5979b3e5311e400fd5c631eb13705d280 on sass:master.\n. \nCoverage decreased (-0.01%) to 80.28% when pulling f68eb51fca30fc61c814c3b75ece2aceb9008cc0 on tristanlins:hotfix/missing-importer-function-implementation into 221d7fb8db51fa85010323c26e08500f1ee180c2 on sass:master.\n. \nCoverage increased (+0.36%) to 80.65% when pulling 3525e027db9c556f69a1736fdad866c32c913b62 on tristanlins:hotfix/missing-importer-function-implementation into 221d7fb8db51fa85010323c26e08500f1ee180c2 on sass:master.\n. \nCoverage remained the same at 80.28% when pulling 628ea47e984b6fa122255d465a8b441c66f31a3e on tristanlins:feature/custom-function-arguments into 221d7fb8db51fa85010323c26e08500f1ee180c2 on sass:master.\n. \nCoverage remained the same at 80.28% when pulling 79e6995bda97ed11933274816ee03316003ca727 on tristanlins:hotfix/add-source-parameter-order into 221d7fb8db51fa85010323c26e08500f1ee180c2 on sass:master.\n. \nCoverage remained the same at 80.28% when pulling 75b54e608a0e91cd8875e24e8729b5384fe84a81 on drewwells:feature/md into 221d7fb8db51fa85010323c26e08500f1ee180c2 on sass:master.\n. \nCoverage remained the same at 80.28% when pulling 706f2a616cd59dee4f1c38b5e07a79d1900ab6d7 on xzyfer:fix/color-rounding into 221d7fb8db51fa85010323c26e08500f1ee180c2 on sass:master.\n. \nCoverage remained the same at 80.28% when pulling 706f2a616cd59dee4f1c38b5e07a79d1900ab6d7 on xzyfer:fix/color-rounding into 221d7fb8db51fa85010323c26e08500f1ee180c2 on sass:master.\n. \nCoverage remained the same at 80.28% when pulling 900a71eb6ebb9b9dd3a035c6fb65755a1a821699 on xzyfer:fix/debug-ast-error into 757472e8ad052b9e90b3ff93752fb538ff0b46b7 on sass:master.\n. \nCoverage increased (+0.22%) to 80.51% when pulling 904df2075b83db824a4e7a1bd61b958dcccf4799 on xzyfer:fix/parsing-optional-semicolons into 8878396f2ad9ef000e02bcf43560dc4c9f167db7 on sass:master.\n. \nCoverage increased (+0.01%) to 80.52% when pulling 0e8d3229bac3888fb40ad83058e3139e974dee7d on xzyfer:fix/incorrectly-merged-media-queries into fad76c88e63b38af7fb74ab1d4e034854f288723 on sass:master.\n. \nCoverage decreased (-1.83%) to 78.82% when pulling 8f00b20f0551fb43764dd19677e03ad800a0cda9 on mgreter:refactoring/parser-for-3.3 into 25a1d79b63cfe73ee4d6d68ca752a3acc999c075 on sass:master.\n. \nCoverage decreased (-2.37%) to 78.27% when pulling 7411b6b7bbfa564f588b4e210f043d4eb450ebd0 on mgreter:refactoring/parser-for-3.3 into 25a1d79b63cfe73ee4d6d68ca752a3acc999c075 on sass:master.\n. \nCoverage increased (+0.17%) to 80.59% when pulling 421e86954017e2337405b6e400c0009c85ccdb4b on xzyfer:fix/compressed-short-colors into 367266118d3df49cc82018606b5d904b4e3ab55a on sass:master.\n. \nCoverage decreased (-0.01%) to 80.6% when pulling 5d8738eba9aba801608980cd4472a72331f3d646 on xzyfer:fix/map-duplicate-keys into 256f05b7388211fe7e45b6d8a9dd7a4bf8da8526 on sass:master.\n. \nCoverage decreased (-0.0%) to 80.6% when pulling 541b644bcbc1edf231a61d88a7af123bdde8335d on xzyfer:fix/map-duplicate-keys into 256f05b7388211fe7e45b6d8a9dd7a4bf8da8526 on sass:master.\n. \nCoverage decreased (-1.43%) to 79.21% when pulling 0514d01f0c157f119e3bfe4c9f7b48588609dcbe on onedayitwillmake:sel_functions into 25a1d79b63cfe73ee4d6d68ca752a3acc999c075 on sass:master.\n. \nCoverage decreased (-1.43%) to 79.21% when pulling 0514d01f0c157f119e3bfe4c9f7b48588609dcbe on onedayitwillmake:sel_functions into 25a1d79b63cfe73ee4d6d68ca752a3acc999c075 on sass:master.\n. \nCoverage decreased (-1.41%) to 79.23% when pulling 60cc9fcdc1aee754cf4e5aac991d3baa39084760 on onedayitwillmake:sel_functions into 25a1d79b63cfe73ee4d6d68ca752a3acc999c075 on sass:master.\n. \nCoverage increased (+0.5%) to 79.578% when pulling 421d27489aa8d018575aa288b31b12d1c420d52c on mgreter:feature/static-native-fn-params into c95478ce654f357c63940a04ba7b6c422b7c7037 on sass:master.\n. \nCoverage decreased (-0.01%) to 78.034% when pulling 6725427a3dde641823a08aa02cfb31a375537cf7 on xzyfer:feat/mgreter/1925 into 213339a802827fab23cb61b79ad7d592fad33c2d on sass:master.\n. \nCoverage decreased (-0.007%) to 78.041% when pulling 988df82e390db9046f954bc318bf6394b107890c on mgreter:bugfix/issue_1944 into 213339a802827fab23cb61b79ad7d592fad33c2d on sass:master.\n. \nCoverage increased (+0.2%) to 78.281% when pulling e2422dbb79be61ac9746a72dc7f29484f69fbbe4 on xzyfer:fix/import-file-resolution into 213339a802827fab23cb61b79ad7d592fad33c2d on sass:master.\n. \nCoverage remained the same at 78.048% when pulling e2422dbb79be61ac9746a72dc7f29484f69fbbe4 on xzyfer:fix/import-file-resolution into 213339a802827fab23cb61b79ad7d592fad33c2d on sass:master.\n. \nCoverage remained the same at 78.048% when pulling 941b0b7f9975796041a29cfaea13b78fa43c4563 on xzyfer:feat/sass-spec-version-3.4 into 213339a802827fab23cb61b79ad7d592fad33c2d on sass:master.\n. \nCoverage remained the same at 78.048% when pulling 3fa5ea1ac7802a04a7e52deca2c8a2326c17f31d on xzyfer:feat/sass-spec-version-3.4 into 213339a802827fab23cb61b79ad7d592fad33c2d on sass:master.\n. \nCoverage remained the same at 78.048% when pulling 9f35944e652917012d7643930b87bef7237f0135 on xzyfer:feat/sass-spec-version-3.4 into 213339a802827fab23cb61b79ad7d592fad33c2d on sass:master.\n. \nCoverage remained the same at 78.048% when pulling fc223aa1a8a542fa2c800a8fceea70cff75cabd5 on mgreter:bugfix/1969-calc-prelexer into 213339a802827fab23cb61b79ad7d592fad33c2d on sass:master.\n. \nCoverage remained the same at 78.048% when pulling a8a3a0e79978ed635a0cbc8fa1a38109bc42ac91 on tony:patch-1 into 213339a802827fab23cb61b79ad7d592fad33c2d on sass:master.\n. \nCoverage increased (+0.6%) to 78.047% when pulling d0a2a03682ab2470d8c4b8380576600daa924003 on xoofx:sass_string_alloc into 140959c78b1223094a47d874f854a738ccca3a9a on sass:master.\n. \nCoverage increased (+0.6%) to 78.047% when pulling d0a2a03682ab2470d8c4b8380576600daa924003 on xoofx:sass_string_alloc into 140959c78b1223094a47d874f854a738ccca3a9a on sass:master.\n. \nCoverage increased (+0.07%) to 78.013% when pulling bf471e241260aa1f648b490184cb5fae457371d7 on xoofx:fix_sass_option_push_include_path into aa8aa2d12c5e63867e0cf9cc9a70f9b8f2ffae0e on sass:master.\n. \nCoverage remained the same at 78.033% when pulling 6417858ab6071b21cdbd92536fb211898fc63b97 on mgreter:bugfix/issue_1971 into 8f144c0b5525cd66f236357baac1038010a9bcb0 on sass:master.\n. \nCoverage increased (+0.007%) to 78.047% when pulling f982577baf35cb57942b0d8ff990225d86d6ce3f on mgreter:bugfix/issue_1931 into cd72e39ac29a3c32a53f366c96b110d4b2c9fef7 on sass:master.\n. \nChanges Unknown when pulling f6f2064946838901c58c8d1a9dfd18d75be8213e on mgreter:bugfix/issue_1889 into * on sass:master*.\n. \nCoverage decreased (-0.002%) to 77.939% when pulling 85b0d2b114b812c2b16acf5c49cffb1c6a5328de on mgreter:bugfix/issue_1945 into e47c8d5b836335a271323333c515059dbdf647d7 on sass:master.\n. \nCoverage increased (+1.2%) to 79.184% when pulling 913150f6ff00f318e8e92e3a5bac99351c6e4f30 on mgreter:feature/C-API-mem-allocator into aa8aa2d12c5e63867e0cf9cc9a70f9b8f2ffae0e on sass:master.\n. \nCoverage decreased (-0.3%) to 77.943% when pulling 25625bb88741c44c868ea56785cf58faf8bc42e5 on mgreter:bugfix/segfault-remove-parents into a57a66e9b8f00379a60a191f95c6e05b76ee5c5a on sass:master.\n. \nCoverage increased (+0.003%) to 77.943% when pulling c4460f3ef6ba5697e444d3fa5aa7054c2e6aac9b on mgreter:bugfix/segfault-remove-parents into 3b9b5a5562bf3d6eccde773386b7c36d5823bf02 on sass:master.\n. \nCoverage decreased (-0.3%) to 77.939% when pulling 131540cb32b6f929e27da6d6f444b3ce2a0e7a40 on mgreter:bugfix/MSVC-debug-assertion into a57a66e9b8f00379a60a191f95c6e05b76ee5c5a on sass:master.\n. \nCoverage decreased (-0.3%) to 77.939% when pulling 131540cb32b6f929e27da6d6f444b3ce2a0e7a40 on mgreter:bugfix/MSVC-debug-assertion into a57a66e9b8f00379a60a191f95c6e05b76ee5c5a on sass:master.\n. \nCoverage decreased (-0.2%) to 77.778% when pulling d2b3db1fe99999a0e570acc8df36030f8749803b on mgreter:bugfix/issue_1417 into 3b9b5a5562bf3d6eccde773386b7c36d5823bf02 on sass:master.\n. \nCoverage increased (+0.007%) to 78.785% when pulling ab0e8e90a22c88d0496b0199fede659088e7a9f4 on mgreter:bugfix/function-call-invocation into c624d6e0183591e7671f75b1d900c81c475bddbf on sass:master.\n. \nCoverage decreased (-0.07%) to 78.711% when pulling 2a94073b57eaff7d50c72b5fc8e40ba91911ef53 on mgreter:feature/pseudo-selector-compare into c624d6e0183591e7671f75b1d900c81c475bddbf on sass:master.\n. \nCoverage increased (+0.3%) to 79.049% when pulling 067d4d6b9edef642fc43921596a5a95fed1e73cd on chriseppstein:feat/sass-spec-version-3.4 into 1033e8561a9a9d9ee8c0cad48ee56185fcd87254 on sass:master.\n. \nCoverage decreased (-0.001%) to 78.789% when pulling 1189ef929117f5ccf054227ce1ebedaefcb2cc3c on mgreter:bugfix/issue_1991_and_1996 into 10d82926d3683752bd64705ab93b4a812a2c7747 on sass:master.\n. \nCoverage decreased (-0.3%) to 78.949% when pulling 83d401b19ae6dc61968aaf833513594c57e05a6c on mgreter:refactor/directive-parsing into 57fbfb977eed6fc692ef41ba6ad3a56bbec6ccfc on sass:master.\n. \nCoverage increased (+0.002%) to 78.791% when pulling d342a4383f16cfd27b377094bc96cc8e445f0993 on mgreter:bugfix/issue_1927 into 3ffb1fd8d1cdddcc937afad63882d8bea982b6be on sass:master.\n. \nCoverage decreased (-0.3%) to 78.791% when pulling a58aa661ffeb21a934a7f8a751d712f4e9beb168 on mgreter:ci-enable/address-sanitizer into 089643bb77f1162dfe4d0514ee203d68c2b94df5 on sass:master.\n. \nCoverage decreased (-0.3%) to 78.805% when pulling 05ede2bd1489d73b8be21d131e9542ec706930ad on mgreter:bugfix/issue_2000 into 9f028554d3f70afe68591031b6e01a693d64c04c on sass:master.\n. \nCoverage increased (+0.02%) to 78.822% when pulling b96723b20520827b69bbf01dac1d83afcdfe2280 on mgreter:bugfix/flag-propagation into bee270f84fceb95a7a5efb8bc0eb407aa8fab8e7 on sass:master.\n. \nCoverage remained the same at 78.822% when pulling e79cc7e293676afb0ef73d6b73947b27a3ab923b on mgreter:bugfix/extend-regression into 957ad485f868ec2c855b5ce738e13f78452192ba on sass:master.\n. \nCoverage remained the same at 78.822% when pulling c071681d93d6028e528fa6fef762a8a6118ea27f on saper:appfail into 1ccaa9e0c5776ecf433b12c2b3ceadc705c0edc4 on sass:master.\n. \nCoverage increased (+0.02%) to 78.844% when pulling 5aab2fad3b6c1558f784da86ec39b208728ce3b7 on mgreter:bugfix/extend-regression-2 into 1ccaa9e0c5776ecf433b12c2b3ceadc705c0edc4 on sass:master.\n. \nCoverage remained the same at 78.844% when pulling ef042ec7792c2ecff4de67cad909d4897308a750 on trash/spec-timeout into dad30227fd3e6203a268bdd2901e9c4e2eec1f0b on master.\n. \nCoverage remained the same at 78.844% when pulling 8323d7b79fab4e2daf7b2af33d6e114483ad9c97 on saper:msb8012 into dad30227fd3e6203a268bdd2901e9c4e2eec1f0b on sass:master.\n. \nCoverage decreased (-0.6%) to 78.288% when pulling 8323d7b79fab4e2daf7b2af33d6e114483ad9c97 on saper:msb8012 into dad30227fd3e6203a268bdd2901e9c4e2eec1f0b on sass:master.\n. \nCoverage decreased (-0.09%) to 78.753% when pulling 87fd6fecf0a2b629b9a0b45e8e95453215837940 on chriseppstein:language_version into dad30227fd3e6203a268bdd2901e9c4e2eec1f0b on sass:master.\n. \nCoverage decreased (-0.08%) to 78.766% when pulling f6167a2c3c42b12e0828c461efd9e51591424928 on mgreter:bugfix/issue_2017 into dad30227fd3e6203a268bdd2901e9c4e2eec1f0b on sass:master.\n. \nCoverage decreased (-0.007%) to 78.759% when pulling 1a4dd3b8bcabe4567a937191ce56b258aaf6fba4 on mgreter:bugfix/issue_2016 into 445ad3cde59ed0449b57a034bb06d6f7ac8d74df on sass:master.\n. \nCoverage remained the same at 78.766% when pulling 9cb6a20f162e21c7209d0b0b6297d45257d5f0c9 on mgreter:feature/guard-json-stringify into 445ad3cde59ed0449b57a034bb06d6f7ac8d74df on sass:master.\n. \nCoverage remained the same at 78.766% when pulling ac9efc3e57b79ff5b8d551e3041ad79dec4d19f5 on mgreter:bugfix/issue_2023 into 445ad3cde59ed0449b57a034bb06d6f7ac8d74df on sass:master.\n. \nCoverage increased (+0.04%) to 78.798% when pulling 579d7f0c74e5ed7953bcf0c49f6965dbefb2e1ad on mgreter:bugfix/issue_2020 into 527f3a8e5224f52b409d3d6e4850b5ebbba0c09e on sass:master.\n. \nCoverage increased (+0.006%) to 78.765% when pulling cf8563936d1ef1fdca3e0cfb0b62d1ddfbce6df8 on mgreter:bugfix/issue_1706 into 527f3a8e5224f52b409d3d6e4850b5ebbba0c09e on sass:master.\n. \nCoverage increased (+0.4%) to 79.136% when pulling 5484af75ac9d9f8fd9fecd502102797f362402d7 on mgreter:bugfix/issue_1661 into 527f3a8e5224f52b409d3d6e4850b5ebbba0c09e on sass:master.\n. \nCoverage increased (+0.009%) to 78.807% when pulling 61726957564b2820fcdbf96e8d1244fade75ed16 on mgreter:bugfix/issue_2031 into 7889f8ce38858fae0cbbe7ae0bfc42310fde044e on sass:master.\n. \nCoverage decreased (-0.006%) to 79.236% when pulling 4796e008c062a54c25c90cc353230051976db1f2 on mgreter:bugfix/issue_2031 into 57fbfb977eed6fc692ef41ba6ad3a56bbec6ccfc on sass:master.\n. \nCoverage decreased (-0.03%) to 78.773% when pulling 33e04e6df62bf59ecd18cc9275772af9b9b1f3c4 on mgreter:test/appveyor-ci into 6a44eec75c1a36702894a6cf0f7bdaea27f7260b on sass:master.\n. \nCoverage increased (+0.4%) to 79.243% when pulling 21a296fc5c233befa0d2ab2ce0ed76b76a2d1aaa on mgreter:feature/probe-passing-todo into 6a44eec75c1a36702894a6cf0f7bdaea27f7260b on sass:master.\n. \nCoverage increased (+0.5%) to 79.243% when pulling 26084e38d017ed22cd6539dde023aa20e5e35217 on mgreter:feature/probe-passing-todo into 0987c4138ef40bd9a01cd5469126cce6c56bcef1 on sass:master.\n. \nCoverage decreased (-0.02%) to 78.779% when pulling 9217ef72e327f4fc9f89117dae3823df3021e05b on mgreter:CI/test into 6a44eec75c1a36702894a6cf0f7bdaea27f7260b on sass:master.\n. \nCoverage decreased (-0.02%) to 78.779% when pulling b52cc20bf711a48ef419b7d1aac4f7a08b586f2b on mgreter:improve/selector-parsing into 6a44eec75c1a36702894a6cf0f7bdaea27f7260b on sass:master.\n. \nCoverage increased (+0.007%) to 78.728% when pulling cad01929339e4b02439130589f0452c75fafbe49 on test/CI into 0987c4138ef40bd9a01cd5469126cce6c56bcef1 on master.\n. \nCoverage decreased (-0.01%) to 78.715% when pulling 857c67863c4d25e9564cd39d56b3cc22100f612a on mgreter:bugfix/missing-initializer into cbf5c3166df87e0cdd1fa90475ee1ca0b82e0a9e on sass:master.\n. \nCoverage remained the same at 78.924% when pulling 4a07e060dfcf857f6d04f56740c25aa531c44a37 on mgreter:test/CI into 3ae9a2066152f9438aebaaacd12f39deaceaebc2 on sass:master.\n. \nCoverage increased (+0.02%) to 78.94% when pulling 59e0f4edba5185e189d7c56496a91973881957ef on mgreter:feature/github-contrib-hints into 3ae9a2066152f9438aebaaacd12f39deaceaebc2 on sass:master.\n. \nCoverage increased (+0.02%) to 78.94% when pulling 59e0f4edba5185e189d7c56496a91973881957ef on mgreter:feature/github-contrib-hints into 3ae9a2066152f9438aebaaacd12f39deaceaebc2 on sass:master.\n. \nCoverage decreased (-0.3%) to 78.94% when pulling a3fa3338e742dff7838ec23f579b8190b877d0d0 on asottile:remove_warning into 8160ba933785cd8c46a93b8ce88ce20efc482900 on sass:master.\n. \nCoverage decreased (-0.3%) to 78.943% when pulling 798aff188068e42a557e11dc691e23ffe57e54f5 on mgreter:bugfix/issue_2046 into 8160ba933785cd8c46a93b8ce88ce20efc482900 on sass:master.\n. \nCoverage increased (+0.06%) to 78.999% when pulling d83f879d915d3c1d2e276bca9873fd27c641dd07 on mgreter:bugfix/extend-recursion into 4d0bc51a197407191f10001544fe23febdce03f0 on sass:master.\n. \nCoverage increased (+0.08%) to 79.078% when pulling 2c75e9be2a271fc28efd375e3caa2553bba4027e on mgreter:refactor/delayed-values into 2f6e81a5ac9122c46362e051befa05272ee1df6c on sass:master.\n. \nCoverage decreased (-0.09%) to 78.985% when pulling 4682e95bbc601327f6a5156f7f666fdb6c427903 on mgreter:build/split-ast into c95478ce654f357c63940a04ba7b6c422b7c7037 on sass:master.\n. \nCoverage increased (+0.009%) to 79.087% when pulling ed0e36b71c8f2aa14ffd9c4b0a831ee239f64099 on mgreter:bugfix/issue_1732 into c95478ce654f357c63940a04ba7b6c422b7c7037 on sass:master.\n. \nCoverage increased (+0.05%) to 79.13% when pulling 0adb50853ede4d55210ac21449a79cba8b4b0cea on xzyfer:fix/issue-1732 into c95478ce654f357c63940a04ba7b6c422b7c7037 on sass:master.\n. \nCoverage increased (+0.3%) to 79.415% when pulling a396a3fffe24811c3ad147e539d5590cc342e341 on xzyfer:fix/issue-1732 into 52628d040d8c2ebbac76d66db118e99c7b7383a2 on sass:master.\n. \nCoverage increased (+0.2%) to 79.248% when pulling 6d6fab6cb68b6b99285f2384ef1882fe92d0fe36 on xzyfer:fix/issue-1732 into 52628d040d8c2ebbac76d66db118e99c7b7383a2 on sass:master.\n. \nCoverage increased (+0.2%) to 79.239% when pulling c75f24d8979f81081a46561c716d192b4aad04dc on xzyfer:fix/issue-1732 into 52628d040d8c2ebbac76d66db118e99c7b7383a2 on sass:master.\n. \nCoverage remained the same at 79.078% when pulling 1036ba13648bc2ef654647455bb74db7cf6ebe94 on mgreter:build/fix-msys2-mingw64-automake into c95478ce654f357c63940a04ba7b6c422b7c7037 on sass:master.\n. \nCoverage remained the same at 79.239% when pulling 54b2390cd3dfd7104f7d40a59957945006ac9757 on xzyfer:feat/cleanup-check-nesting into d8fb898ba4107e93e79736cf0e4d48edb96d8113 on sass:master.\n. \nCoverage remained the same at 79.239% when pulling 3ca32a70a9850e93f3b4d8b7a5a6db5e5e720d80 on mgreter:bugfix/issue_1537 into d8fb898ba4107e93e79736cf0e4d48edb96d8113 on sass:master.\n. \nCoverage increased (+0.02%) to 79.257% when pulling 2f49f12f490dfc2f8737d8b1ca05b9cc12e5802b on mgreter:bugfix/issue_1786 into d8fb898ba4107e93e79736cf0e4d48edb96d8113 on sass:master.\n. \nCoverage increased (+0.01%) to 79.25% when pulling ca84038236ad90fcea65e7cadcaac2fdae639ab4 on mgreter:errmsg/missing-fn-argument into d8fb898ba4107e93e79736cf0e4d48edb96d8113 on sass:master.\n. \nCoverage decreased (-0.1%) to 79.095% when pulling 14da927d48cd71cf6e9ad642f9687951e1241c57 on mgreter:bugfix/issue_1930 into d8fb898ba4107e93e79736cf0e4d48edb96d8113 on sass:master.\n. \nCoverage increased (+0.03%) to 79.286% when pulling 77008711c8e59eab5352f0982dc69e776160d6c9 on mgreter:bugfix/issue_2074 into 9a3f4cb277af74e06eb62285c938293e837e21d2 on sass:master.\n. \nCoverage remained the same at 79.286% when pulling abd6807cead088022c6e516a20fb42442934ae62 on am11:master into 3b1e9ffb9d0d2e1e25994225f4d5918c1b8f03be on sass:master.\n. \nCoverage remained the same at 79.286% when pulling 01f370ae0d65809c40cee0f43d2ac6415716aa4a on am11:master into 3b1e9ffb9d0d2e1e25994225f4d5918c1b8f03be on sass:master.\n. \nCoverage remained the same at 79.286% when pulling 99d5cc51faa08c7d56cc6fc56e252c060bea8c4e on am11:master into e80b63d0f3f631e68f7b43dbbb2b7f45a7f2d620 on sass:master.\n. \nCoverage decreased (-0.06%) to 79.237% when pulling 332327aa55e520d63c3f32dc9d23eac39ade7fd5 on xzyfer:feat/implement-trace into 34bcd3f756945d7fb0f9b4612aecb62ea4cf188d on sass:master.\n. \nCoverage increased (+0.002%) to 79.243% when pulling 6a9b4343913059652c8c36680ad6fd983942caaf on xzyfer:feat/at-root-bubble into 2f47dae3ad86ad12578f577fe93999d13a158167 on sass:master.\n. \nCoverage decreased (-0.2%) to 79.066% when pulling 3b72dbc7278538acf53561e956a26ed6b6d545d6 on xzyfer:feat/make-it-rain into 6e4409e071e808044171034712ddd2ebaa1fcb5a on sass:master.\n. \nCoverage decreased (-0.1%) to 79.128% when pulling c15f22f748016890a6d4edabe0920a55df35a180 on xzyfer:feat/make-it-rain into 6e4409e071e808044171034712ddd2ebaa1fcb5a on sass:master.\n. \nCoverage increased (+0.2%) to 79.395% when pulling c15f22f748016890a6d4edabe0920a55df35a180 on xzyfer:feat/make-it-rain into 6e4409e071e808044171034712ddd2ebaa1fcb5a on sass:master.\n. \nCoverage increased (+0.1%) to 79.392% when pulling 6f806382101375ecdceccd1ada857f6b4d88d7ff on xzyfer:feat/make-it-rain into 6e4409e071e808044171034712ddd2ebaa1fcb5a on sass:master.\n. \nCoverage decreased (-0.1%) to 79.12% when pulling 634e74c366b3907c4aac492cb381cc57ed9d94e4 on xzyfer:feat/make-it-rain into 6e4409e071e808044171034712ddd2ebaa1fcb5a on sass:master.\n. \nCoverage increased (+0.01%) to 79.131% when pulling d71883a002e71bbb8b07d649db0fc32c529c63d6 on xzyfer:feat/remove-cssize-selector into a227821b25b468f90805cfdca64ade6778e29bd2 on sass:master.\n. \nCoverage remained the same at 79.12% when pulling 93606aeabd88ea41d956e595a722544d6a1ed0ca on xzyfer:fix/at-root-exlude into a227821b25b468f90805cfdca64ade6778e29bd2 on sass:master.\n. \nCoverage remained the same at 79.131% when pulling 1c51840eb4ccde86c14d84672ba88822eacbdf8f on xzyfer:feat/better-debug into 2b2f48425fc138e695c6d8408e9865ecf227f1e4 on sass:master.\n. \nCoverage increased (+0.003%) to 79.095% when pulling a3020dbb101f94c00e5939be2ee5ef3f9092e74e on xzyfer:feat/selector-resolve-parent-refs into d33f45b1745e67d4aa855367aff52a6a0193c69c on sass:master.\n. \nCoverage decreased (-0.01%) to 79.083% when pulling d675a847cad180e57d9d49b162f01298c0a457d5 on xzyfer:feat/cleanup-selectors into dc097fd72a752b702965ee2164103e14370c9c71 on sass:master.\n. \nCoverage remained the same at 79.083% when pulling a2e057fc7fd30ffcb5fd95cdfef99af12934a2b0 on MoritzKn:patch-1 into 4acbae75da0d485fda4f2a1cf348c1aebcbda1e3 on sass:master.\n. \nCoverage remained the same at 79.083% when pulling f093070438d18d38ea984bc85a9d6ad998799ce0 on MoritzKn:patch-1 into 4acbae75da0d485fda4f2a1cf348c1aebcbda1e3 on sass:master.\n. \nCoverage decreased (-0.006%) to 79.077% when pulling 32ceedc0bdadd513af8cad6739aa4e90e84cc879 on mgreter:bugfix/issue_2106 into 38fd7934435d9f95b254fb3b3f4bd38cbb7f25ff on sass:master.\n. \nCoverage remained the same at 79.077% when pulling 7b5f46ca312dcd9295ada5e573853ae7bddb426d on mgreter:bugfix/issue-2112 into c6a81691065bb9fb552308c865c8c8c20c4f8ef6 on sass:master.\n. \nCoverage remained the same at 79.077% when pulling 7b5f46ca312dcd9295ada5e573853ae7bddb426d on mgreter:bugfix/issue-2112 into c6a81691065bb9fb552308c865c8c8c20c4f8ef6 on sass:master.\n. \nCoverage increased (+0.005%) to 79.101% when pulling 4682c70a309bddc7e47690f7ef00a6af51d60ffb on mgreter:bugfix/invalid-duplicate-map-key into 55c0858c37a7c00eda237f46e8685d9d687454ff on sass:master.\n. \nCoverage remained the same at 79.113% when pulling c2a47c17b4dce42b1cad4195c516095ea61e00f7 on lesstif:add-php-binding-proj into 2fde7e6a2f9c91f1193b07194d8400124a1a5500 on sass:master.\n. \nCoverage decreased (-0.01%) to 79.095% when pulling 5c4b6212a0419b38d29f0f01722895dcc383e0e5 on lesstif:add-php-binding-proj into 6610e815ff77600fedf22bf10541d08d70f94218 on sass:master.\n. \nCoverage decreased (-0.02%) to 79.096% when pulling db1d56b064920daaea5e26a131ba85e6a05d4909 on mgreter:bugfix/issue-2120 into 2fde7e6a2f9c91f1193b07194d8400124a1a5500 on sass:master.\n. \nCoverage increased (+0.009%) to 79.104% when pulling 2f42bd585f6e508d7747836ec2679a400c07143c on mgreter:bugfix/issue-2124 into 7a455d13031ca44c784526e9c5c98556c5dd0988 on sass:master.\n. \nCoverage remained the same at 79.104% when pulling d8520aa3a8f418d3326e3c3894e3834ef7314e2f on DerPapst:master into 6610e815ff77600fedf22bf10541d08d70f94218 on sass:master.\n. \nCoverage increased (+0.005%) to 79.101% when pulling 9d8fe8dd65f8f5f5ccf429cfda1630e2148b40aa on IanMitchell:strslice-fix into 55c0858c37a7c00eda237f46e8685d9d687454ff on sass:master.\n. \nCoverage decreased (-0.4%) to 79.011% when pulling d7134a73cb3a70729e1203f2e6dc20cfcffed5f8 on delapuente:brackets into ba9258a621321480b4c38d1ff42faaa2b7168059 on sass:master.\n. \nCoverage decreased (-0.4%) to 79.011% when pulling d7134a73cb3a70729e1203f2e6dc20cfcffed5f8 on delapuente:brackets into ba9258a621321480b4c38d1ff42faaa2b7168059 on sass:master.\n. \nCoverage increased (+0.001%) to 79.096% when pulling 9adf7b75336302fed6facc82886bfeffcec10e09 on mgreter:bugfix/rgb-hue-from-zero-saturation into a728565a646662b333f71dda113b91af518ecd75 on sass:master.\n. \nCoverage remained the same at 79.11% when pulling 6ee56b21c31a84aa4e06239fdd5bed7996cd24cd on scottdavis:patch-1 into 96ff08ce8a0e724d5333179413a0bd6cfff5baa3 on sass:master.\n. \nCoverage increased (+0.02%) to 79.132% when pulling 80eec3d21fe26509418a4f5e029934edf2b1d6c3 on mgreter:bugfix/issue-2151 into 014a61b6b3619a30d1d6567b11a00dafb8897f47 on sass:master.\n. \nCoverage increased (+0.1%) to 79.263% when pulling ae5db282c975c365d295af803359fd92cf8c6a2d on mgreter:bugfix/issue-2153 into 849e7e0f2ff0372cf65b8d4e048f7cc0e54a9f53 on sass:master.\n. \nCoverage decreased (-0.0002%) to 79.262% when pulling 4999c91c049901fca329104375a6d9a3f4e6ebcd on mgreter:bugfix/issue-2158 into acbc26bdd5a9c4fd42b5dd92155a6042e0de7eee on sass:master.\n. \nCoverage increased (+0.1%) to 79.253% when pulling 6be1efc5eed927fbe1a0d0f92e06caa33167e6b2 on nschonni:data-error-65-status-code into 849e7e0f2ff0372cf65b8d4e048f7cc0e54a9f53 on sass:master.\n. \nCoverage increased (+0.02%) to 79.284% when pulling 3a5ea36770ca7e40f64e71188e4a8d498e1f0529 on mgreter:bugfix/issue-2147 into acbc26bdd5a9c4fd42b5dd92155a6042e0de7eee on sass:master.\n. \nCoverage decreased (-0.02%) to 79.242% when pulling 33de7669eb8a559dfe21a91af9bebe0910078c93 on mgreter:bugfix/issue-2144 into acbc26bdd5a9c4fd42b5dd92155a6042e0de7eee on sass:master.\n. \nCoverage decreased (-0.008%) to 79.195% when pulling e9e3d1cf7e70861ceddae5814b94fb9ea9073684 on mgreter:bugfix/issue-2143 into 325958f77e412f38c8870e3562f5b4e7f46121f3 on sass:master.\n. \nCoverage decreased (-0.04%) to 79.203% when pulling da1bc02f7b0302609dc382a4dc80ddfc37c1f67e on mgreter:improve-mem-footprint into aea48f683d136c825807d19c831b559929efa6f4 on sass:master.\n. \nCoverage remained the same at 79.195% when pulling 7cbbecdb05ae9784222da7ca3220d1ac5245c55a on am11:patch-1 into ce371da32ae69f3fa344344802fa1ee54cbac114 on sass:master.\n. \nCoverage remained the same at 79.195% when pulling 996f7de97958ddb8aeafc50cdfbb1cc16f451969 on mgreter:bugfix/issue-2169 into ce371da32ae69f3fa344344802fa1ee54cbac114 on sass:master.\n. \nCoverage increased (+0.3%) to 79.5% when pulling ab550044acd0f685faca5684a7c5e5af34979e3d on delapuente:debug-builds into 6de56c8b0781416d615b383b6ee2bfbe3c108540 on sass:master.\n. \nCoverage increased (+0.007%) to 79.252% when pulling 59012e402baea8a4b31fbe2281ff59e0bc741bd0 on delapuente:debug-builds into 6de56c8b0781416d615b383b6ee2bfbe3c108540 on sass:master.\n. \nCoverage increased (+0.007%) to 79.252% when pulling 59012e402baea8a4b31fbe2281ff59e0bc741bd0 on delapuente:debug-builds into 6de56c8b0781416d615b383b6ee2bfbe3c108540 on sass:master.\n. \nCoverage increased (+0.007%) to 79.252% when pulling 59012e402baea8a4b31fbe2281ff59e0bc741bd0 on delapuente:debug-builds into 6de56c8b0781416d615b383b6ee2bfbe3c108540 on sass:master.\n. \nCoverage increased (+0.007%) to 79.252% when pulling 59012e402baea8a4b31fbe2281ff59e0bc741bd0 on delapuente:debug-builds into 6de56c8b0781416d615b383b6ee2bfbe3c108540 on sass:master.\n. \nCoverage increased (+0.3%) to 79.5% when pulling 39b1e4de83d14fc10547f524ec18cafd1edaf02a on delapuente:debug-builds into 6de56c8b0781416d615b383b6ee2bfbe3c108540 on sass:master.\n. \nCoverage increased (+0.09%) to 79.34% when pulling da8964a53923e4fad4f14448a0a4abfb1216fd49 on xzyfer:feat/maps-as-lists into be81001fcac2c33e9ded7d85984e884c16871307 on sass:master.\n. \nCoverage increased (+0.3%) to 79.538% when pulling 55005d77be575187b24fca0a148846721dab38b5 on xzyfer:feat/maps-as-lists into be81001fcac2c33e9ded7d85984e884c16871307 on sass:master.\n. \nCoverage decreased (-0.4%) to 78.886% when pulling 081748cd2f7d34a7231a8a18af64a2c0610569a8 on xzyfer:feat/maps-as-lists into be81001fcac2c33e9ded7d85984e884c16871307 on sass:master.\n. \nCoverage increased (+0.09%) to 79.34% when pulling 081748cd2f7d34a7231a8a18af64a2c0610569a8 on xzyfer:feat/maps-as-lists into be81001fcac2c33e9ded7d85984e884c16871307 on sass:master.\n. \nCoverage increased (+0.09%) to 79.34% when pulling 081748cd2f7d34a7231a8a18af64a2c0610569a8 on xzyfer:feat/maps-as-lists into be81001fcac2c33e9ded7d85984e884c16871307 on sass:master.\n. \nCoverage decreased (-0.3%) to 79.102% when pulling cc8e1a85dbdf591aa0933d1bfa0942054980c396 on xzyfer:fix/issue_2154 into 8d08554fcc465ae3fa4f1cfe49b73bc36d0438ca on sass:master.\n. \nCoverage decreased (-0.3%) to 79.102% when pulling cc8e1a85dbdf591aa0933d1bfa0942054980c396 on xzyfer:fix/issue_2154 into 8d08554fcc465ae3fa4f1cfe49b73bc36d0438ca on sass:master.\n. ",
    "milesj": "Awesome, thanks a lot @carsonmcdonald !\n. ",
    "jalcine": ":+1: This sounds like libsass would need to implement an interface of sorts. But where exactly would you want to extend? Like the definition of a function into the Sass namespace or adding new keywords?\n. ",
    "code1492": "thank you for comment. \nI'm not good at english and actually I don't know c++ language. but I really want to add random function.\nI think sass ruby version(?) has random() function. \nhttp://sass-lang.com/documentation/Sass/Script/Functions.html\nwhy c++ haven't this function?\nplease somebody add this..\n. ",
    "nwinter": "I was seeing this by way of node-sass until I upgraded my node to 0.10.32 from 0.10.26, after which it pulled the latest node-sass version and started working again.\n. ",
    "samccone": "k thanks @hcatlin \n. ",
    "tomByrer": "Yes, MDN describes not media, & I've used it myself.\n. Reopen please?\n4 & 8 character hex for CSS translucent (RGBA) has been in the CSS4 Color spec for over a year.  Would be nice if people could write CSS today to the upcoming spec.  Or at least not have a better, non-breaking warning.\n. ",
    "webdevotion": "I bumped into this issue just now.  Maybe it might help future googlers.\nI copy pasted the default media queries from Zurb Foundation in my sass file.\nWhen I saved the file the compilation stalled with the error mentioned above.\nI then added // something so that each query would contain at least a comment.\nIf this sounds confusing, check the last line of my code example.\nI saved the file and it compiled again.\nworking code\n``` scss\n// Small screens\n@media only screen / Define mobile styles /\n  // something\n@media only screen and (max-width: 40em) / max-width 640px, mobile-only styles, use when QAing mobile issues /\n  // something\n// Medium screens\n@media only screen and (min-width: 40.063em) / min-width 641px, medium screens /\n  .background-white\n    .advantages-group\n      @include advantages-columns-background( $border-color: white )\n.background-tint\n    .advantages-group\n      @include advantages-columns-background( $border-color: $row-bg )\n@media only screen and (min-width: 40.063em) and (max-width: 64em) / min-width 641px and max-width 1024px, use when QAing tablet-only issues /\n  // something\n// Large screens\n@media only screen and (min-width: 64.063em) / min-width 1025px, large screens /\n  // something\n@media only screen and (min-width: 64.063em) and (max-width: 90em) / min-width 1025px and max-width 1440px, use when QAing large screen-only issues /\n  // something\n// XLarge screens\n@media only screen and (min-width: 90.063em) / min-width 1441px, xlarge screens /\n  // something\n@media only screen and (min-width: 90.063em) and (max-width: 120em) / min-width 1441px and max-width 1920px, use when QAing xlarge screen-only issues /\n  // something\n// XXLarge screens\n@media only screen and (min-width: 120.063em) / min-width 1921px, xxlarge screens /\n  // something\n```\n. ",
    "juliangruber": "this is most likely a problem with node-sass\nhttps://github.com/sass/node-sass/pull/434\n. ",
    "aaronjensen": "I didn't know it was exposed to ruby, how would I do that?\nOn Oct 3, 2014 4:02 AM, \"Marcel Greter\" notifications@github.com wrote:\n\nIf you know that you have indented sass syntax in your string, you should\nbe able to call sass2scss yourself to make the conversion before feeding\nit into libsass.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/488#issuecomment-57780863.\n. ah, not sure why i said ruby. in this instance i'm using node-sass: https://github.com/sass/node-sass/issues/438\n. \n",
    "adyballa": "@hcatlin\nbtw\nI have good use of image_path, because I dont know the prefix in sass. So this function will not work\n. ",
    "callumacrae": "I'm confused. Was this deprecated or removed?\nUpdating to node-sass 3.1 broke all the images on our website. This is from the output CSS:\ncss\n.sun-rays {\n  background-image: image-url(\"bg-with-sunrays-large.png\");\n  background-size: cover;\n  background-repeat: no-repeat; }\nI'm not getting an error using node-sass through gulp-sass. It's just outputting image-url and silently breaking.\nCould I suggest that breaking changes not be hidden at the bottom of the release notes? Also, could you collaborate with the node-sass folks so that breaking changes in libsass are mentioned there, too? There was nothing in the node-sass 3.1 release notes about this function being removed. I don't think most people who use node-sass read the libsass release notes!\nAlso, in the future, a soft deprecation a version ahead of the head deprecation would be massively appreciated! I had no idea this feature was non-standard until it disappeared.\n. sass\n@media all and (max-width: 768px) {\n  @media only screen and (min-device-pixel-ratio: 2), only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi) {\n    body .div {\n      color: blue;\n    }\n  }\n}\nOutput:\ncss\n@media {\n  body .div {\n    color: blue;\n  }\n}\nExpected output (I think):\ncss\n@media only screen and (min-device-pixel-ratio: 2) and (max-width: 768px), only screen and (-webkit-min-device-pixel-ratio: 2) and (max-width: 768px), only screen and (min-resolution: 192dpi) and (max-width: 768px) {\n  body .div {\n    color: blue;\n  }\n}\n. What?\nOf course they can be merged. It works as nested media queries as raw CSS, but then doesn't work in IE8 because it doesn't support nested media queries.\n\"only screen\" matches both \"all\" and \"only screen\".\nTry it as CSS. It works. SASS breaks it.\n. Fair enough. Thanks.\n. Yep. I redeployed and it went away\u2014apparently Heroku has been having issues today. Not sure how that could lead to this, though.\nWe also had it on the latest version of iojs on Travis yesterday a few times.\n. It was node 0.10.40. I have no idea what compiler we're using (it's on heroku and the build output doesn't give us a version number), but it doesn't fail every time.\n. ",
    "danielrz": "what about the $cache-buster parameter? does LibSass supports cache busting with images?\n. ",
    "swarajban": "@callumacrae we're having the same problem after upgrading. What did you do to fix?\n. Thanks @xzyfer and @idflood. I ended up using asset functions from this node package. My CSS image URL's are being set properly again\n. ",
    "idflood": "@swarajban here is a simple implementation:\nsass({\n  functions: {\n    'image-url($img)': function(img) {\n      return new sass.types.String('url(\"images_directory/' + img.getValue() + '\")');\n    }\n  }\n})\n. ",
    "GuyPaddock": "Also see: https://github.com/fetch/node-sass-asset-functions. ",
    "kevinsimper": "I do not really understand why the test fails, since I only changed a error message :(\n. I rerun the travis tests.\n. ",
    "laurentvd": "So, is this feature now implemented in the master branch?\n. ",
    "toastal": "It appears that the only things that were merged in were the test cases for the bug. The milestone is set for 3.1 and 3.0 is only at release candidate at this time. I'd assume all 3.0 bugs are to be wrapped up before anything else is really looked at. The reality seems to be SOON\u2122 though.\n. The -p flag is for after files are created so of course it didn't fire on a fresh checkout. The steps I'd done were git pull that was behind a month or two. When I ran make (without make clean so that I'm not having to rebuild what's not needed), make bawked on creating one of the folders because it existed and so nothing was built. I didn't realize that this is an unfortunate incompatibility with Windows's mkdir. I manually added -p to the Makefile on line 5 and it has worked ever since.\n. ",
    "andreasisaak": "@xzyfer Without sass-list-maps, i have an error with your solution:\nWarning: xxx/scss/components/nav/top-links:66: argument$mapofmap-keys($map)must be a map\n. @xzyfer Without sass-list-maps, i have an error with your solution:\nWarning: xxx/scss/components/nav/top-links:66: argument$mapofmap-keys($map)must be a map\n. @xzyfer I tested exactly your code :) \n. @xzyfer It was my fault! The code works perfectly\n. ",
    "dbashford": ":+1: \n. ",
    "scottdavis": "Can you introspect the arguments in c++? I know in ruby sass you have to pass in all possible arguments ex:\nruby\n  declare :sprite, [:map, :sprite]\n  declare :sprite, [:map, :sprite, :offset_x]\n  declare :sprite, [:map, :sprite, :offset_x, :offset_y]\n  declare :sprite, [:map, :sprite, :offset_x, :offset_y, :use_percentages]\n. ",
    "SparkyBluefang": "Interesting. I see that failure when running upstream master, however I see it fixed on feature/colors.\nFor the sake of my sanity, I did double check the hex value changes in color_names.hpp and they should be correct.\nhttp://en.wikipedia.org/wiki/Web_colors#X11_color_names\n. Please correct me if I'm wrong, but strongly typed enums are part of the c++11 standard, which libsass is now using.\nhttp://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2347.pdf\nSome of my co-developers were using clang. The -stdlib=libc++ flag is needed (see the Makefile) but I believe that's just for std::shared_ptr. And one of them did have to update xcode/clang/llvm:\n$ g++ --version\nConfigured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/usr/include/c++/4.2.1\nApple LLVM version 5.1 (clang-503.0.40) (based on LLVM 3.4svn)\nTarget: x86_64-apple-darwin12.5.0\nThread model: posix\nThe purpose of using strongly typed enums is because there is no standard on how an enum is represented, so it is compiler and architecture dependent.\nBy forcing the enum to be an unsigned integer of a known length, you can use the full width of the number without playing games with negatives, endianness, or overflows. Granted, the current implementation of dbg_lvl_t doesn't care a whole lot about order, but it originally did represent an ordered debug level (none, info, warn, error, debug, trace) where numerical comparison was important.\nThe choice of using a 32bit length was a bit more esoteric. 32bits is the native word size of most consumer hardware. Using something smaller is a waste of space unless it can be aligned and packed into some other data structure. Using something larger requires emulation in a 32bit environment.\n. ",
    "imathis": ":+1: This makes me so happy. I welcome the \"correctness over speed\" perspective.\nSide note: \"Hunt them down like dogs\" isn't about hunting down dogs but instead refers to how dogs are used in hunting, offering their highly tuned senses and unfailing dedication in the service of lazy and incapable humans.\n. ",
    "jlinton": "Hmm, the gcc breakage is strange, I was building it with GCC. As far as the tabs, I tried cleaning them up (hence \"correct poor formatting\") where did you see a problem?\nIf your interested in committing this in the future, just tell me what you want changed (variable sanitation?, multiple parms?) and I can spend a little time cleaning it up. \n. ",
    "rawcreative": "The same error occurs with variable interpolation inside a map, e.g.\n$output: (\n     margin-#{from($flow)}: 0,\n  );\n. ",
    "changetip": "Hi xzyfer, drewwells sent you a Bitcoin tip worth a beer (10,270 bits/$3.50), and I'm here to deliver it \u2794 collect your tip at ChangeTip.com.\nIs this real?\n. Hi mgreter, drewwells sent you a Bitcoin tip worth a beer (9,332 bits/$3.49), and I'm here to deliver it \u2794 collect your tip at ChangeTip.com.\nLearn more about ChangeTip\n. ",
    "gakimball": "I think part of what contributed to our issues with Ruby Sass is just how people deal with dependencies. We weren't properly instructing our users to use Bundler, which means your Ruby dependencies are being managed at the system level. You type gem update sass or gem install sass and you get the newest version, so any Ruby stack you use is going to use 3.4 whether your toolset supports it or not.\nSo people intentionally or unwittingly upgraded to the newest version of Ruby Sass and ran to us when it didn't work with Foundation. It's sort of their fault, but when you're managing a key dependency at the system level things are just going to get weird if you don't use Bundler.\nI think switching the various Foundations to a pure JS stack will be beneficial for us, and it should be doable long-term now that libsass and Ruby Sass will eventually be developed in tandem. Having this one Ruby dependency off to the side when our stack is increasingly JS-focused is also just a hassle.\nAnd yes, we'd love to work with y'alls to make sure this stuff doesn't accidentally break. Now that the dust has (mostly) settled on this Sass stuff for us, we're all going to be watching the development of Sass fairly closely. (I'm very interested in it personally, but for the sake of the framework we need to know how it's developing.)\nEdit: By \"pure JS stack\" I guess I'm mostly thinking of the Grunt scenario, where you compile with a JS version of libsass. But people use Foundation on Rails, Python, and PHP stacks also, so emphasizing libsass compatibility will go a long way towards making the framework more flexible.\n. The compiler seems to only try division if one or both of the operands is negative.\nThis will compile as-is:\nscss\n.selector {\n  background: #fff url('') 100px 20px / 100%;\n}\nThis will produce an error:\nscss\n.selector {\n  background: #fff url('') 100px -20px / 100%;\n}\nFor anyone who needs a temporary workaround, you can interpolate the negative value to bypass the error.\nscss\n.selector {\n  background: #fff url('') 100px #{-20px} / 100%;\n}\n. ",
    "alexmngn": "You're right. I'm using broccoli-sass which is using node-sass and it seems those libraries are not using the latest version of libsass yet. \nI'll wait for them to update libsass.\n. That's great!\n. ",
    "TomHarms": "Aah thanks! I didn't know that, i was still using grunt-libsass \n. ",
    "benjixx": "Just stumbled upon this issue. It seems this is also a blocker for using http://www.csstyle.io/ with libsass.\n. I guess this is already actively worked on in #548.\n. ",
    "ebrentnelson": "I second benjixx's comment. libsass is choking on csstyle. I've been trying to figure out why. \nWe have something like this:\n23 // allow parts to respond to options on parents\n 24 @mixin whenComponentOption($option){\n 25   $index: str-index(#{&}, \"__\") - 1;\n 26   $component: str-slice(#{&}, 0, $index);\n 27\n 28   #{$component}.\\--#{$option} & {\n 29     @content;\n 30   }\n 31 }\nThat throw an error like this:\nnode_modules/csstyle/csstyle:25: error reading values after\nI have tracked it down to the ampersand on line 25, but have been unsuccessful at fixing it in csstyle alone. (Note: In my case I am using sass-loader for webpack that uses libsass under the hood---I am pretty sure.)\n. ",
    "ekskimn": "Hi guys,\nI'd like to try to implement this in my own fork but not quite sure how to get the parent selector and then translate that to an expression.\nIt seems that the if block in parse_simple_selector_sequence in the Parser isn't what I thought.  I thought that that would give me a reference to the parent selector (based on the comments).  If it does, I\"m not sure how to reference that in the parse_value method when it tries to parse an assignment statement.\nAny help would be appreciated.\nAlso it seems that Selectors can't be Expressions, which is fine because I can use Selector_Schema to get the string value, right?  I think what I'm really looking for is a way to get the environment/context when the parser is parsing a given statement.\nThanks in advance. \n. Thats great news!  Thank you.  Ive spent some trying to figure it out and\nhave been stymied. I think i will wait till you implement it but the\ncuriosity is killing me on how to implement it.  I read through the wiki on\nhow to develop for libsass and i still was not sure how to understand some\nof the domain language. Would you mind explaining to me how to implement\nthis?  The curiosity is killing me.\n2015. 1. 20. \uc624\ud6c4 8:19\uc5d0 \"Michael Mifsud\" notifications@github.com\ub2d8\uc774 \uc791\uc131:\n\nIf you're willing to wait I plan to tackle this over the weekend.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/548#issuecomment-70782348.\n. Thank you~!  So that was my first approach but parse_value returns an expression and I didn't know how to create an Expression from a Selector_Reference.  The AST value isn't accessible from a Selector_Reference  object....\n\nAlso i'd love to continue to contribute to this so I'll take a shot and send you a PR when I think I have it working....\n. So I am trying to return this:\n      Selector_Reference* sel = new (ctx.mem) Selector_Reference(pstate);\n      return new (ctx.mem) Expression(sel->pstate());\nAnd when i output the & reference, I get an empty string.  So I think I must not be returning the correct value....\n. Ah, okay so that's what I thought.  I was hoping for a simpler answer, which was simply returning the right value in parse_value, but like you said, there was no way to access the member I needed, or rather, the member simply doesn't exist.\nWhen you say expand the Selector_Reference with contextualize, what do you mean?  Do you mean have Selector_Reference have a reference to a contextualize member or to inherit from it?\nI can work on refactoring the selector expanding logic into its own operator.\n. Wouldn't I have to \na) make Selector_Reference inherit from Expression\nb) Have the expand visitor apply the Contextualize to the Selector_Reference for the Assignment visitor method?\n. ah...the spec that was written only seemed to account for the assignment case....so this means that I'd have to apply this to ALL the visitor methods???  that kinda sucks....there should be a better way.\n. Ah, that's what you mean by the stacks being different...the eval visitor is for expressions primarily and the expand visitor is primarily for Statements?\nIt seems like I need to create a SelectorExpression, like the MediaQuery_Expression class....what do you think?\n. Hmm....so there's a dilemma where the expand visitor takes the eval visitor as a constructor parameter because it uses it to eval arguments, which is fine, but if I were to make the eval visitor take the expand visitor as a construction parameter then that would be circular....do I need a new visitor class to submit to both classes?\n. Hi xzyfer,\nOut of curiosity, did you manage to get to this at all this weekend?\n. Ah, if i can ask a question...don't want to bother you on your long weekend....but I am trying to implement this and am trying to figure out if I need to do the following:\n1. create a parent selector expand visitor that operates on a parent selector expression object and outputs a Statement\n2. pass it to the eval visitor and have it execute when it operates on a parent selector expression\n3. pass it and the eval visitor to the expand visitor and execute it when operating on a ruleset object and outputs a statement.\nwould that do the trick?\n. @xzyfer I have the first test case passing, but I can't seem to get the interpolation and the binary expression one going.  When I do a perform(&to_string) on a Compound_Selector, it returns an empty string.  Is that not implemented for Compound_Selector?  What I'm trying to do is in the Eval visitor to evaluate a binary expression and if the right or left is a parent selector, I want to print the string and set it to the value of the String_Constant object it returns.  any ideas?\n. Will do this weekend\nOn Friday, February 20, 2015, Michael Mifsud notifications@github.com\nwrote:\n\nBump. @ekskimn https://github.com/ekskimn can you please open a PR with\nyour work so far. I'd hate to have to duplicate effort on this.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/548#issuecomment-75358514.\n. @xzyfer\nSorry it's taking a bit.  I'll have  PR to you tonight\n. Hey @xzyfer \nJust to let you know where i am with things...i have the first test case figured out but when the parent selector is in another statement such as an interpolation, i'm having a hard doing that without the contextualizer being in the eval visitor.  The problem is that the contextualizer takes the eval as a parameter.  \n\nWhat do you recommend?\n. PR to you @xzyfer ...like the comments say, i have the declaration and the binary operations working but the interpolation isn't...though it really should and not quite sure why it wouldn't....I'm still looking at that, but if you get a chance take a look at the PR\n. I know who that might be actually.  I can coordinate with him.\nOn Mon, Mar 16, 2015 at 11:50 PM, Michael Mifsud notifications@github.com\nwrote:\n\nYou can't understand my excitement to see movement on this @ekskimn\nhttps://github.com/ekskimn. I'll dig into it soon.\nThis may be of interest to you @1xProgrammer\nhttps://github.com/1xProgrammer.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/959#issuecomment-82159062.\n. also, how concerned should I be that the coverage decreased?  while i did\nrefactor some code around, I didn't actually create a lot of new code.\n\nJust to be clear, what I did was separate out the contextualize that used\neval from the parts that didn't.  I made eval use contextualize as part of\nits composition but then created a new class contextualize_eval which\ninherits from contextualize since they would share the same code, but adds\nthe selector schema and attribute selector methods that require an eval.\nThen I set the expander to use the contextualize_eval and eval members as\nit did before.  The last thing i wanted was to have a bunch of if\n(expression_type == Expression::SELECTOR) 's lying around.\nOn Mon, Mar 16, 2015 at 11:50 PM, Michael Mifsud notifications@github.com\nwrote:\n\nYou can't understand my excitement to see movement on this @ekskimn\nhttps://github.com/ekskimn. I'll dig into it soon.\nThis may be of interest to you @1xProgrammer\nhttps://github.com/1xProgrammer.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/959#issuecomment-82159062.\n. #548 I got the interpolation working~!\n. ah dammit...i didn't see that....running those tests now...cross your fingers~!\n. looks like the seg faulting tests are mixin argument tests....let me see if i can whip that out....\n. no, i totally agree.  I'm the same way with my dev team (ask them...they'll tell you i'm a dictator =) ) so I totally appreciate all the feedback\n. @am11   added those files to the vs project file.\n. @xzyfer \nI explained a little above in one of my comments:\n\nJust to be clear, what I did was separate out the contextualize that used eval from the parts that didn't.  I made eval use contextualize as part of its composition but then created a new class contextualize_eval which inherits from contextualize since they would share the same code, but adds the selector schema and attribute selector methods that require an eval.  Then I set the expander to use the contextualize_eval and eval members as it did before.  The last thing i wanted was to have a bunch of if (expression_type == Expression::SELECTOR) 's lying around.   \nI knew that eval had to use contextualize in order to resolve the parent selector but then the parent selector could also be within an expression (such as an interpolation)  So I separated it out into two, one which inherits from the other.  let me know if that helps clarify.\n. how did the builds pass?  the whitespace issue is still oustanding and I realize that there is another issue where the type expected is a list and I am returning a string....\n. lol... so confused...i can see that those tests are failing on my local machine tho....i'm working on returning a list of strings.\n. @xzyfer thank you...that makes much more sense.  i'm working on returning a list....hopefully i can hit the whitespace thing too.\n. @xzyfer I would think you wouldn't want to do that.  that was exactly what I wanted to prevent.  I'd rather let the class definition determine what it can handle and what it can't as opposed to a 3rd party making the decision for it...  just my 2 cents.\n. Hey all. I am sorry i missed all these messages!  I am in the middle of\nmoving (bought a house in silicon valley) and i had tried to squash the\ncommits earlier today and also got a lot of merge conflicts so i didnt\ncommit it.\nIf u need me to try again i can do so within the hour\n2015. 3. 17. \uc624\ud6c4 5:57\uc5d0 \"Michael Mifsud\" notifications@github.com\ub2d8\uc774 \uc791\uc131:\n\nI tried a couple strategies for squashing the branch but the merge commit\ncaused too many conflicts.\nFor the sake of simplicity I've created a fully squashed patched\nhttps://www.dropbox.com/s/gndtujidx0bktz7/complete.patch?dl=0 rebased\noff the latest Libsass master.\ncd libsass\nSync you master with the latest Libsass master\ngit remote add libsass https://github.com/sass/libsass\ngit pull --rebase libsass master\ngit pull --rebase\ngit push -f  # to rewrite the history\nUnstage your changes and create a new commit\ngit checkout parent-selector\ngit reset --hard master\ngit clean -fd\ngit apply /path/to/complete.patch\ngit add .\ngit commit -m \"Support parent selector & in values / and/or interpolations\"\nrewrite history\ngit push -f parent-selector\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/959#issuecomment-82661566.\n. Sure np. Give me an hour\n2015. 3. 18. \uc624\uc804 3:02\uc5d0 \"Michael Mifsud\" notifications@github.com\ub2d8\uc774 \uc791\uc131:\nYeah the merge commits really mad a mess of the branch. To be honest I'd\njust create a new branch and apply the patch from my previous comment.\nMake sure you sync you master with the latest Libsass master first.\ngit remote add upstream https://github.com/sass/libsass\ngit fetch upstream\ngit merge upstream/master\ngit push\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/959#issuecomment-82862238.\n. PR is up there from a new branch,  #965 \n. @xzyfer Hey, just so i know..what other clean up were you looking for?\n. :+1: \nThanks for the encouragement~!  Now looking for the next feature to implement~!\n. on which file?  appveyor.yml was the only file that i didn't fully recognize in my change set...I also went through the diffs to see if they were what I expected.\n. That's what i had done...i created a new branch called #548 from master and i replayed all my changes as well as your patch.\n. yeah let me do that\n. oops sorry...fat fingered that.\n. no i hadn't updated the commit...when i do the interactive rebase, I get an error \"Could not apply 717c3ed04d49bbd374053c6ce50bf25866a47149... 717c3ed\"\n. can I just issue you a new PR?\n. i'll do the fix up\n. Ok you should be good to go.\n. Thanks @xyfer, sorry for the pr mess.  I tried doing the fixup commit but yeah it ended up being another commit somehow.\n. @mgreter Most definitely sticking around.  Glad to contribute something even if @xzyfer still seems uncomfortable with it.  Considering doing #963 next\n. Hi @xzyfer , I took at look at the PR and it makes sense to me. =) :thumbsup:\n. @xzyfer  Taking a look....\n. @xzyfer Just a quick update....i did some debugging and the error occurs in the eval visitor when visiting the parent selector, after doing the contextualize visitation and before executing any of the listize visitations.  It isn't in the static cast, because I broke that out into its own line and it got passed that just fine.  Somehow it is blowing up when calling perform(listize)  but not sure why yet.\n. @mgreter Thanks Marcel~!  I didnt' get a chance to look at this further~!\n. @xzyfer Want me to take this?\n. @xzyfer I don't think I have the rights to assign this issue to myself....would you mind assigning it to me?\n. @xzyfer ah, got it =)\n. Hi all,  i'm on this bug again...should have a fix for it shortly...I think I know what's going on with it.\n. oh?  is it pushed to the repo?\n. Ah i see what you're doing....lol...you really didn't like the contextualize_eval, huh? =)  \n\nDo you happen to know when you might push it?  My team and I are wanting to get that fix in to fix a particular issue we have.  \nAlso do you happen to know if you're going to merge the selector-functions PR in as well?\n. @mgreter  Hey @onedayitwillmake  and I have been troubleshooting some issues we were seeing on our side and there are a couple of bug fixes we'd like to contribute to your branch. What's the best way to do this for you?    One fix is for the selector replace where it doesn't properly handle the specificity for a replace and the other fix is one related to child selectors where it duplicates the child selector when you assign it to a variable.\n. @xzyfer Okay makes sense.  It's just that @mgreter took in @onedayitwillmake selector function code and this kind of goes along with it.  But I will fork and branch from that branch and reapply my changes, and create a PR, does that work?\n. @xzyfer Also I created a cmakelists.txt for C-Lion development, do you think that that should be added to the repo?\n. @mgreter Hey, those PR's are now open for you.  I have one for each bug fix...i figured it would be better that way.  The first one came just as your made your commit...so it can't be automerged...sorry~!\n. @HugoGiraudel The selector functions are in the 3.3 release branch.\n. ah thanks~!\n. ah, It isn't supposed to be.  I was using it in the next line and forgot to put it back in.  Committing in a moment...\n. Hmm...not sure what you mean there.  Can you explain more?\n. Fixed~!  good catch btw.\n. actually i looked at the code again.  yeah, i think they are the same\nExpression* ex = var->perform(this);\n. Yeah i was following convention there in that method but happy to change the rest of the calls.  Shall I?\n. no particular reason.  I can change that\n. yes...sorry about that~!\n. I opted for\nreturn Contextualize::fallback_impl(n);\nSince it really should just call the base class\n. in this case, this wouldn't be left over code.  This is actually necessary to resolve the parent selector expression.\n. NM, i lied.  there is left over code in there.  cleaning that up.\n. I think i see what you're saying.  I think I was thinking of it as that this class is a sort of decorator or just extension on the original contextualize class.  I started down the path you are suggesting and went with inheritance in this case because I felt that it felt more natural.  I can try it the other way again\n. So i tried that and a lot more tests broke.  it's 2:48 am here  =) so i will need to sleep...but I welcome more feedback.  I'm looking at that one error statement that I removed.  The test was the closed issue 930 that was breaking when it is uncommented in.  That test, though, passes, when commented out (not exactly a litmus test but just saying).\n. ",
    "gionkunz": "Awesome!\n. Great effort guys :+1: \n. ",
    "Lekensteyn": "Nice, I had no idea where to look for a possible fix. Thank you for picking it up!\n. ",
    "scottwio": "Same problem here line comments are generated when sourceComments is set to Map. grunt-sass version 0.16.0\n. ",
    "blowback": "simpler:\n```\n$gold: gold;\n$white: white;\ndiv {\n    foo: if($white == gold, 'yes', 'no');\n    bar: if($gold == gold, 'yes', 'no');\n}\n```\ngives no/no not no/yes\n. ",
    "cahamilton": "I've noticed something similar with mixins converting over to LibSass. \nExample:\n```\n@mixin button($button-color: null) {\n@if $button-color == red {\n    background-color: #ff0000;\n} @else if $button-color == blue {\n    background-color: #0000ff;\n} @else if $button-color == green {\n    background-color: #00FF00\n} @else {\n    background-color: #ccc;\n}\n\n}\n.btn-red {\n    @include button($button-color: red);\n}\n.btn-blue {\n    @include button($button-color: blue);\n}\n.btn-green {\n    @include button($button-color: green);\n}\n.btn {\n    @include button;\n}\n```\nRubySass compiles as:\n.btn-red {\n    background-color: #ff0000; }\n.btn-blue {\n    background-color: #0000ff; }\n.btn-green {\n    background-color: #00ff00; }\n.btn {\n    background-color: #ccc; }\nLibSass compiles as:\n.btn-red {\n    background-color: #ccc; }\n.btn-blue {\n    background-color: #ccc; }\n.btn-green {\n    background-color: #ccc; }\n.btn {\n    background-color: #ccc; }\n. ",
    "virtualize": "Verified, same problem here\n. ",
    "julianxhokaxhiu": "+1 having the same issue\n. +1\n. ",
    "baudoin": "+1\n. ",
    "tylergaw": "+1 I put in #566 for the same underlying issue, but thought maybe it would be helpful to have the more general issue since it's happening for all media queries, not just imported files.\n. Nice, that worked for me @xzyfer http://showterm.io/abecc603ff1a27b98b73f (ignore the __git_ps1: command not found crud, gonna fix that one of these days)\nAlso, thank you for the setup instructions. I previously tried to set up libsass/sassc from the readme and couldn't figure it out at all.\n. ",
    "laustdeleuran": "+1 for #566 \n. +1 :)\n. ",
    "evoactivity": "Closing this as the problem is more broad than I had tested for, follow #566 for updates.\n. ",
    "michaeljpowell": "+1\n. ",
    "avoliva": "Are you working on this?\n. Great. I'll take a stab at it :D\n. @xzyfer Haha, thanks. I tried but not very great with the git CLI, yet. 354de3e should be all the commits in one, though.\n. Right, but by the time it reaches the helper function it's already been cast as a List, correct? Maybe I'm not understanding your point. Can you elaborate more?\n. I see what you mean, and it keeps the same code style. I'll try that approach.\n. Great idea, I'll look into it.\n. I don't think the RGB helper fits the criteria of other ARG functions. It seems the ARG functions are used to grab the arguments passed in ($list, $color, etc.). The helper function for the RGB doens't accept one of those passed in arguments.\nI did find a rather glaring mistake in my logic, and was able to remove the boolean flag alpha, so the code is more clear.\nGoing to test it out some more and I'll push up some changes.\n. Not sure if I did this correct. I merged remote master into my branch before pushing.\ncommit 8837e4d has everything I added.\n. Going to create a new pull request\n. Will do! Soon...\n. Thanks, I'll be working on this today :)\n. Sure. Don't know how that got there honestly.\n. Ah thanks I figured there was a better way to do this part.\n. just using\ni == index\nshould work as index is supposed to the the index of the array also counting from zero.\n. \"Should l->length() + n->value() be l->length() - n->value()?\"\nAh yeah you're right. But I think it's actually \nl->length() - n->value() + 1\nbecause n counts from one while index should start from zero\nedit: math was bad \nit should remain at \nl->length() + n->value()\nif the list is length 3 and the value is -1, the index would be 2, which would be the last element.\n. ",
    "Ky6uk": "I tried to compile code \nscss\n@import \"foundation/components/grid\";\nwith grunt-sass includePath contains bower_components/foundation/scss\n. Ahh. I spent more time and found https://github.com/zurb/foundation/commit/29ffaad25daa4cfd99f5c9da4143baf89d883565 and https://github.com/zurb/foundation/issues/5932\nI'll try to check it a bit later, but problem looks resolved at https://github.com/zurb/foundation/releases/tag/v5.4.7\nStay tuned. =)\n. ",
    "sufianrhazi": "Heh, I didn't mean it as a protest, only that it was something we needed and found useful :)\nAnd wow, that's quite a neat trick for import-once emulation!\nI totally understand the desire for a more robust system, any thoughts to what that would look like? Also, is there any mechanism/plan/roadmap for the ability to add additional plugins/behaviors to libsass?\n. I've just added sassc bindings for enabling this behavior: https://github.com/sass/sassc/pull/78\n. On master, it appears that @import is not yet overridable via the public C API -- it looks like it was an oversight to not expose the importer.\nAfter making the following changes to expose the importer, it looks like an import-once sort of behavior could be pretty easily built: https://github.com/sufianrhazi/libsass/commit/4b96888e34080b1bbc48bfae85ab51511a450bc9\nIn writing a test program to verify this is possible, I do think the custom importer API is a bit awkward: libsass free()s the source and srcmap pointers passed to sass_make_import(), but does not have ownership strdup() them in the implementation. It probably should either strdup() them or not free() them at all.\n. Yeah, that's what I ended up using, but AFAICT it wasn't exposed to the public C API\n. Oh, silly me: I didn't realize the sass_interface.h was now deprecated. We should probably put a #warning deprecated API notice in sass_interface.h\n. I'd love to help with this effort\u2013I've been poking around the internals of the libsass' AST to see the feasibility of adding the ability to serialize (and unserialize) an AST to (and from) JSON. From what's already there in master, this seems very doable.\n@mgreter -- In regards to the stability, the raw AST seems quite reasonable as a first draft of a standardized export format. Do you have a good feel for which node types are most likely to change and which are temporary for calculation (Number is the only one which seems a bit shaky)?\n. ",
    "davidangel": "I'm confused by this, isn't 'compact' documented here: http://sass-lang.com/documentation/file.SASS_REFERENCE.html#output_style\nWhy wouldn't all of these options get included?\n. @xzyfer so is there support for the compact output style currently? I've been trying to use it with gulp-sass/nose-sass without much luck...\n. Cool!\n. ",
    "jpdesigndev": "I verified that node-sass seems to be referencing a a commit after #591 was merged, but still running into issues.\nFor example:\n``` scss\n$svg-fills: (\n  primary:      $primary-color,\n  secondary:    $secondary-color,\n  success:      $success-color,\n  error:        $error-color\n);\n@each $fill in $svg-fills {\n  .fill-#{$fill} { fill: map-get($svg-fills, $fill); }\n}\n```\nThrows an error Unable to allocate memory: std::bad_alloc\nFull error \n```\ngulp(17780,0x103f53000) malloc:  mach_vm_map(size=7651461227091288064) failed (error code=3)\n error: can't allocate region\n*** set a breakpoint in malloc_error_break to debug\nstream.js:94\n      throw er; // Unhandled stream error in pipe.\n            ^\nError: Unable to allocate memory: std::bad_alloc\n```\nWhen I reduce the above map to just two values, it works. Anything over that, and it breaks.\nscss\n$svg-fills: (\n  primary:      $primary-color,\n  secondary:    $secondary-color\n);\n. I'm seeing this issue when trying to compile the following:\n``` scss\n@mixin margin-selectors($before:1em, $after:1em, $start:0px, $end:0px) {\n  -webkit-margin-before: $before;\n  -webkit-margin-after: $after;\n  -webkit-margin-start: $start;\n  -webkit-margin-end: $end;\n}\n@mixin not-selectable($value:none) {\n  user-select: $value;\n}\n@mixin input-placeholder-color($color) {\n  &::-webkit-input-placeholder,\n  &::-moz-placeholder, / Firefox 19+ /        // <------------------ Error: invalid selector after ,\n  &:-moz-placeholder, / Firefox 18- /\n  &:-ms-input-placeholder {\n    color: $color;\n  }\n}\n```\nI'm running gulp-sass v2.0.1 --> node-sass v3.1.0 --> libsass v3.2.4\n. ",
    "ngryman": "Hey,\nI run into the same issue with nearly the same code as @jpdesigndev.\nIt seems to be related to maps manipulation in @each.\nIt's also random. Commenting, uncommenting chunks of codes make the issue disappear, re-appear randomly.\n. ",
    "kevva": "Yeah, you def need to rebase to mirror the latest master before PR. A lot of changes happened in the tests structure.\n. ",
    "benflodge": "553 Looks like a similar issue but on the variable names rather than the selectors, I'll test with the latest master and let you know.\n. I've just tested this with latest libsass using sassc and this still seems to be an issue.\n. Thanks this is now working perfectly with sassc, now to make it work with node-sass.\n. ",
    "patlecat": "With the errors I got under Windows and MSVC I fully agree, CMake would make it so much easier to offer builds that work.\n. Alright now I got Sassc.exe with the instructions mentioned, thanks. And how can I compile libSass to a (static) .lib or a DLL? Is it really still only possible to do with mingw?\n. Seems fairly easy to do on any platform nowadays :http://stackoverflow.com/questions/931093/how-do-i-make-my-program-watch-for-file-modification-in-c\n. Can I ask why libsass wants to be compatible with such an old compiler? What is the point?\n. Ah that's why you demand the use of Visual Studio 2013 Upd4 (the latest) just to support a larger audience? LOL No seriously, why do you do it? Why not just say GCC 4.8.2 is the minimum?\n. ",
    "dancoates": "@bdkjones Did you find that the source map worked before it was run through autoprefixer? Because I think I am experiencing the same issue, but for me the source map is broken even before it is run through autoprefixer.\nI am seeing that same group of semi colons at the start of the mappings string.\nI am using node-sass and the jump from 1.0.3 to 1.1.0 seems to break source maps for me. This is the release that updated to libsass 3.0.1, which was a jump from f660edea1f747950ad0ddedd07f794d377b70132 to ca5f271883db61ccd1d1e1b84dd4830a2564896f \nclick here to see the commits between those two.\nHere's the source map output from before the update to libsass 3.0.1:\nhttps://gist.github.com/dancoates/5626805512d78b9a4437\nand after:\nhttps://gist.github.com/dancoates/1ae1cdc40af0bd723f7d\nThis happens with both compressed and nested styles, nested points to the completely wrong spot in the sass and compressed always points to line 1 of style.css.\nI'm also using Foundation, not sure if that is part of the issue?\n. ",
    "davemac": "Same problem as dancoates. Latest version of Foundation 5.5 and getting the same group of semi-colons at the start of the mappings string in the source map files.\nUsing  \"node-sass\": \"~1.2.3\",  \"grunt-sass\": \"0.17.0\"\nI see similar issues here, which I think are the same thing:\nhttps://github.com/sindresorhus/grunt-sass/issues/166\nhttps://github.com/sass/node-sass/issues/573\n. ",
    "alanhogan": "Is this still accurate? There is only one blocker from 3.4 compatibility?\n. @xzyfer Should this be attached to a milestone?\n. ",
    "jfroffice": "@am11 maybe my node-sass or libsass was not up to date. I check.\n. ",
    "STRML": "Nevermind: this looks like a dupe of https://github.com/sass/libsass/issues/566 and can be closed.\n. ",
    "mik01aj": "Oh come on. It has to return strings matching [a-z][a-z0-9]+ so that\nthey're unique, so when you call it 1000 times and put the results to a\nset, the set has 1000 elements. They don't necessarily have to be random.\n. By \u201cnot random, but unique\u201d I meant something like <date (with microseconds)> + <counter>. This is by no means random, but nonetheless I would expect collisions to be as rare as with current sass unique-id.  \nBtw, If you want to go for random, this might help: http://preshing.com/20121224/how-to-generate-a-sequence-of-unique-random-integers/\n. Well, you can never test everything. I believe that testing the above two requirements would be good enough.\n. ",
    "akiran": "yes, ability to query the list before compile step will solve our problem at https://github.com/jtangelder/sass-loader/pull/29\n@mgreter  +1 for your two step proposal.\nHaving api functions to parse dependencies and also updating included files in case of errors is very useful.\n. ",
    "SanderElias": "@lunelson Thanks you for the workaround.\nI updated the issue's title, but I think the example still holds. If you have an suggestion on how to better demonstrate the issue, I will adapt it\n. ",
    "matthewlein": "Great. Thanks for doing that.\n. Here you go https://github.com/sass/sass-spec/pull/135\nIf you need anything else on that, let me know.\nWhile digging in it a little, I found that interestingly, this works just fine:\n```\n$grid-columns: 4;\n@for $i from 1 through $grid-columns {\n  @for $j from 1 through $grid-columns {\n    @if $j > $i {\n      .#{\"bar\"}--#{$i}_#{$j} {\n        width: percentage( $i/$j );\n      }\n    }\n  }\n}\n```\nWhen it interpolates the number from the loop var, it has no problem.\n. .#{\"foo\"}--#{'1'} { width:100%; } is probably a simpler way of saying that. :)\nThis works fine, and might be a workaround for me for now.\n. ",
    "esr360": "I still seem to be getting this issue, or at least an issue very similar to this, when using Libsass (I don't get the error when using Ruby Sass):\n```\n\n\nError: index out of bounds for nth($list, $n)\n        on line 21 of ../../Synergy/src/scss/mixins/_component.scss\n\n\n$namespace: nth(module-tree(&), length(module-tree(&)));\n\n```\n\n\n\n\nFor reference here is the culpable line of code: https://github.com/esr360/Synergy/blob/4715c9ceec3ca1ad664ef0b7a093743b9929e3de/src/scss/mixins/_component.scss#L21 \nIt should be noted that if I change this line:\nscss\n$namespace: nth(module-tree(&), length(module-tree(&)));\nInto this:\n```scss\n$this: module-tree(&);\n$namespace: nth($this, length($this));\n```\nthen it compiles without an error.. @tedw's comment several posts up still seems to be an issue? Is there a separate issue for this?\n.foo {\n    @at-root button#{&} {\n        color: red;\n    }\n}\noutputs:\n.foo button.foo {\n    color: red;\n}\nexpected:\nbutton.foo {\n    color: red;\n}\nhttp://sassmeister.com/gist/d610ed626e510cea938c\nEDIT: Sorry guys. I can see from this issue that it will be fixed (is fixed) in 3.3 https://github.com/sass/libsass/issues/1491\n. I think the ideal situation would be that they both support this features. The next best thing would be as @xzyfer says and to at least have them be consistent, even if that means neither of them supporting it.\nYou should be able to switch from libsass to ruby sass in theory without anything breaking. Having something which would knowingly prevent this from happening imo is a bad thing.\n. Fantastic! Can't wait.\n. Amazing, thanks for the quick fix.. Sounds similar to my issue:\nhttps://github.com/sass/libsass/issues/2520\n...in that I too am using selector-replace(), @at-root and am having issues with exponential chained selectors too.\nI found a few work arounds, not sure if there's anything that could apply to your scenario.. Great, thanks so much, I'm glad you were able to get to the bottom of it.. ",
    "andern": "Did it automatically add my new commit to this pull request? Anway...\nIt turns out it didn't work to simply change to __isascii(). Although that function seems to be preferred over isascii(), it didn't solve the problem I got on the windows machine running Cygwin.\n. This has now been confirmed to work on the windows machine running cygwin.\n. Like that?\n. ",
    "mrusinak": "Relevant clarification:\nThis only occurs if the test file uses the .sass extension. If I name the file \"test.scss\", the line-ending type does not matter\n. Thanks, that helped a lot.\nOddly enough using correct .sass syntax breaks classic-mac (just CR), while unix/windows then work.\n. ",
    "nickdima": "Generating source maps by passing the content instead of a file. Mainly for implementing this in node-sass.\n. I was asking this because of this comment by @svnieuw some while ago:\n\nlibsass currently only supports source maps with sass_file_context. The source file (input path) can only be specified as path and not as data string.\n\n@mgreter can you point me to the commit where this was implemented so I can investigate further? Thanks a lot!\n. ",
    "christianmagill": "I'm pretty sure LibSass can only handle the SCSS format.\n. ",
    "mgntrn": "Any solution yet?\n. ",
    "greypants": ":+1: \n. I ran into the same issue on 3.4.2, but can confirm this is fixed in the most recent release.\nThis was the previously failing code:\n``` scss\n$breakpoints: (\n  \"small\"  : \"(min-width: 480px)\",\n  \"medium\" : \"(min-width: 680px)\",\n  \"large\"  : \"(min-width: 900px)\",\n  \"max\"    : \"(max-height: 1200px)\"\n);\n@mixin breakpoint($key) {\n  @media #{map-get($breakpoints, $key)} {\n    @content\n  }\n}\n```\n. ",
    "carey": "The crash in sass_free_file_context is because copy_strings only allocates (8 * num) + 1 bytes instead of 8 * (num + 1). I would use calloc(num + 1, sizeof(char*)) instead.\nThere's a copy_strings in both sass_context.cpp and sass_interface.cpp, and both seem to have the same problem.\n. I'm only using the sass_compile_file API, but when it creates a Sass::Context::Data it leaves the importer field uninitialised, rather than setting it to a null pointer. My code crashes when LibSass tries to use the random data here on encountering @import, unless I modify sass_compile_file to set importer to 0.\nThe Visual C++ 2013 debugging runtime enables a lot of consistency checks in malloc and free, like Linux does when MALLOC_CHECK_ is set to 2. I was running under the debugger to see why @import caused a crash, which is why free_string_array started crashing.\nThe C standard defines sizeof(char) to always be 1.\n. Here's my test program that crashes in sass_import_get_function:\n``` c\ninclude \ninclude \"libsass/sass_interface.h\"\nint main()\n{\n    sass_file_context *ctx = sass_new_file_context();\nctx->input_path = \"test.scss\";\n\nint status = sass_compile_file(ctx);\nif (ctx->error_status == 0) {\n    puts(ctx->output_string);\n} else {\n    puts(ctx->error_message);\n}\n\nsass_free_file_context(ctx);\n\nreturn 0;\n\n}\n``\n. Sorry, that code looks for the SCSS file I was using for testing. The minimum needed to reproduce the problem is a filetest.scss` like this in the current directory:\n@import \"inc\";\n. I can't reproduce it with GCC on Linux, since the stack is initialised to zeros there, so the pointers in Sass::Context::Data end up being null. Visual Studio fills the stack with 0xcc to detect programming problems, though, so source_c_str_, include_paths_c_str_, include_paths_array_ and importer_ all start out as 0xcccccccccccccccc.\ninclude_paths_str_ and include_paths_array_ get changed to valid pointers in sass_compile_file, and source_c_str_ isn't used, but importer_ is left uninitialised and copied to cpp_ctx, so sass_import_get_function crashes.\nI've been able to fix the crash in Windows by either initialising all fields in Sass::Context::Data:\n``` diff\n--- a/context.hpp\n+++ b/context.hpp\n@@ -83,6 +83,8 @@ namespace Sass {\n     bool _skip_source_map_update; // status flag to skip source map updates\n KWD_ARG_SET(Data) {\n\n\npublic:\nData() : source_c_str_(), include_paths_c_str_(), include_paths_array_(), importer_() {}\n       KWD_ARG(Data, const char*,     source_c_str);\n       KWD_ARG(Data, string,          entry_point);\n       KWD_ARG(Data, string,          input_path);\n```\n\nor by explicitly setting importer in sass_compile_file (and sass_compile):\ndiff\n--- a/sass_interface.cpp\n+++ b/sass_interface.cpp\n@@ -209,6 +209,7 @@ extern \"C\" {\n                        .include_paths_array(0)\n                        .include_paths(vector<string>())\n                        .precision(c_ctx->options.precision ? c_ctx->options.precision : 5)\n+                       .importer(0)\n       );\n       if (c_ctx->c_functions) {\n         struct Sass_C_Function_Descriptor** this_func_data = c_ctx->c_functions;\nI prefer the former, since that way both POD and non-POD fields of the Sass::Context::Data class get initialised in the constructor, not just the non-POD fields. It looks like LibSass prefers the latter style, though.\n. There's no reason not to make both changes. The mythical perfect optimising compiler would generate the same code for either or both.\n@am11 The first commit in a94377b5aac6a10a6aa3ed90656557e7b9843fd1 should fix the crash in free_string_array, making it possible to debug the real problem in parse_file. That looks like a different problem, where it looks like this has ended up a null pointer.\n. Thanks for the fix in 375b7692c1aa605686356d1a238a432b599f9fc9. There's very similar code in sass_compile_file that needs fixing in the same way as in sass_compile.\nAfter that fix too, and realising that sass_make_function doesn't copy the signature string, I'm using the old API from Java without crashes.\n. ",
    "zigotica": "Hi @mgreter @aexmachina \nIs fixing the Source Map feature in any milestone? I know you might have other priorities, but I'd really love to see it working. This would help fine tune development quite a lot for many teams.\nThank you. ",
    "flops": "I think this is a close one, correct me if i'm wrong.\nhttps://github.com/sass/node-sass/issues/1584. ",
    "Grawl": "Wow wow, how to do it guys? I am also have this issue and want to update libsass from 3.0.0 to 3.0.1 but I know nothing about compiling Clang apps.\n. Wow wow, how to do it guys? I am also have this issue and want to update libsass from 3.0.0 to 3.0.1 but I know nothing about compiling Clang apps.\n. @xzyfer yes, I have manually updated node-sass to v1.2.3 inside of grunt-sass with \ncd node_modules/grunt-sass && npm install node-sass#1.2.3 -D and it solved my problem.\nBut can you help me with adding this to package.json? Because grunt-sass uses old node-sass v1.0.3 that have old libsass inside.\n. @xzyfer it's not working for me :disappointed: \nI have seen some \u201cresolved\u201d fields into other's package.json's, can it help me with similar situations? Or\u00a0all I\u00a0can is\u00a0just to fork other's repo to configure it's\u00a0dependencies?\n. ",
    "jakob-e": ":+1:...  I think I could have done it in just one pull (tsk-tsk newbies ;-)\nhttps://github.com/sass/sass-spec/pull/147\nhttps://github.com/sass/sass-spec/pull/148\nNote I've added it to the maps folder to keep things together \nspec/maps/keywords/\n. Thanks @xzyfer I've moved the files to issue_672 in libsass-todo-issues and made a new PR\nI hope I did close the old ones correctly \u2013 sorry in advance \u2013 Thanks for teaching me :+1:\nhttps://github.com/sass/sass-spec/pull/149\n. PR added to https://github.com/sass/sass-spec/pull/149 (now containing issue 672 and 674) \u2013 Let me know if you want me to create a separate branch and make a new. \n. Extra observation \u2013 I'm not sure if it is intentional in LibSass (why I did not make a PR)\nConcatenating with null throws an error in SASS 3.4.7 in LibSass 3.0.1 null is ignored.\n``` SCSS\n@function test($arg1, $arg2:null){\n  @return $arg1 + $arg2;\n}\n/ SASS 3.4.7 /\ndiv {\n  test-1: test(foo, bar); \n  test-2: test(foo); // Invalid null operation: \"\"foo\" plus null\".\n}\n/* LibSASS 3.0.1\ndiv {\n  test-1: foobar;\n  test-2: foo; \n}\n```\n. PR: https://github.com/sass/sass-spec/pull/155\n. deleted\n. @saper \u2013 I had the same problem solved by chunking up the string (2000 characters each) \nEncode SVG and a test (61443 characters)\n``` SCSS\n//\n//  Function to create an optimized svg url\n//\n@function svg-url($svg){\n    //\n    //  Add missing namespace\n    //\n    @if not str-index($svg, xmlns) {\n        $svg: str-replace($svg, '    }      //      //  Chunk up string in order to avoid \n    //  \"stack level too deep\" error\n    //       $encoded:'';\n    $slice: 2000;\n    $index: 0;\n    $loops: ceil(str-length($svg)/$slice);\n    @for $i from 1 through $loops {\n        $chunk: str-slice($svg, $index, $index + $slice - 1); \n        //\n        //   Encode (may need a few extra replacements)\n        //\n        $chunk: str-replace($chunk,'\"','\\'');\n        $chunk: str-replace($chunk,'<','%3C');\n        $chunk: str-replace($chunk,'>','%3E');\n        $chunk: str-replace($chunk,'&','%26');\n        $chunk: str-replace($chunk,'#','%23');     \n        $encoded: #{$encoded}#{$chunk};\n        $index: $index + $slice; \n    }\n    @return url(\"data:image/svg+xml;charset=utf8,#{$encoded}\"); \n}\n//  Helper function to replace characters in a string\n@function str-replace($string, $search, $replace: '') {\n    $index: str-index($string, $search); \n    @if $index { \n        @return str-slice($string, 1, $index - 1) + $replace + \n            str-replace(str-slice($string, $index + \n            str-length($search)), $search, $replace); \n    }\n    @return $string; \n}\n// Use It\n.class { \n    background-image: svg-url('.....');  \n}\n```\n. @matthias-vogt \nExcept from the first \"add missing namespace\" (note the edit) only single characters are replaced \u2013 why it shouldn't be a problem :-)     \n. ",
    "Veraxus": "It turns out that this behavior has been (controversially) deprecated and removed as of SASS 3.3. Please disregard this issue. Different approaches are recommended instead.\nFor more information, see: https://github.com/sass/sass/issues/456\n. ",
    "outclassed": "+1\n. @mgreter , thank you for taking a look.  This is what I have found:\nhttp://sass-lang.com/documentation/file.SASS_REFERENCE.html#keyword_arguments\nDefault values for arguments specified in the signature also don't seem to work.\n. ",
    "emphaticsunshine": "+1\n. ",
    "fwhite-wsm": "+1\n. ",
    "gorakhargosh": "You're welcome! :)\n. ",
    "al3jo": "I have a case in which this is broken. Not completely sure is related with the same issue discussed here, but it has to do with eh IE expression.\nHere's the scss:\n``` scss\n@mixin spec1() {\n  spec1: unquote(\"3 + \\\"px\\\"\");\n}\n@mixin spec2($e) {\n  spec2: unquote(\"#{$e} + \\\"px\\\"\");\n}\n@mixin spec3($e) {\n  spec3: unquote(\"#{$e} + 'px'\");\n}\n.element {\n  @include spec1;\n  @include spec2(3);\n  @include spec3(3);\n}\n```\nThe expected result will be:\ncss\n.element {\n  spec1: 3 + \"px\";\n  spec2: 3 + \"px\";\n  spec3: 3 + 'px'; }\nHowever, libsass will output:\ncss\n.element {\n  right: 3 + \"px\";\n  right: 3 + \\\"px\\\";\n  right: 3 + 'px'; }\nI can open a new issue and create specs if you think is needed\n. As it turns out, this has to do with the deprecated warnings.\nUpdating the code to not use deprecated APIs fixes this.\nThanks\n. ",
    "P233": "Interpolation handles quoted string list incorrectly. The following code\n``` scss\n$a: \".class-a\", \".class-b\";\n$b: \".class-a\" \".class-b\";\n{$a} {\ndisplay: none;\n}\n{$b} {\ndisplay: none;\n}\n```\nis compiled to:\n``` css\n.class-\",\".class-b {\n  display: none; }\n.class-\"\".class-b {\n  display: none; }\n```\n. ",
    "FeodorFitsner": "Well, there is no difference between personal or org accounts in AppVeyor. It's just \"account\" that can hold multiple users/collaborators and be associated with a single GitHub account for accessing repos and teams.\n. 1) make sure webhook URL is from right project\u00a02) have at least \"push\" and \"pull_request\" events ticked on webhook settings\n3) check \"Recent deliveries\" for any non-OK results\n-Feodor\nOn Mon, Jan 5, 2015 at 4:16 PM, Adeel Mujahid notifications@github.com\nwrote:\n\nFor some reason, Appveyor is not picking up the webhook. @xzyfer updated the webhook URL in settings.\n@FeodorFitsner, can you please tell us besides updating the webhook URL, what else do we need to change to hear back from https://ci.appveyor.com/project/sass/libsass?\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/805#issuecomment-68806296\n. Could you paste a screenshot of webhook settings from GitHub?\n\n-Feodor\nOn Mon, Jan 5, 2015 at 5:13 PM, Marcel Greter notifications@github.com\nwrote:\n\nFYI: I have activated \"status\" recently in the hope it might solve this ... beside that I have no idea. @xzyfer do you have admin access at appveyor for that repository? Maybe we need some setting there?\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/805#issuecomment-68811630\n. OK, and what's correspondent project at AppVeyor?\n\n-Feodor\nOn Mon, Jan 5, 2015 at 5:21 PM, Michael Mifsud notifications@github.com\nwrote:\n\n@mgreter you'll need to log out of AppVeyor and re-login then select sass from the dropdown that appears.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/805#issuecomment-68812318\n. I see queued builds: https://ci.appveyor.com/project/sass/libsass/history Seems to be OK?\n. Will take a look.\n\n-Feodor\nOn Mon, Jan 5, 2015 at 6:24 PM, Marcel Greter notifications@github.com\nwrote:\n\n@FeodorFitsner The issue is that \"CI reports\" are not included. As you can see in https://github.com/sass/libsass/pull/811, only Travis-CI reports it's status to the PR.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/pull/805#issuecomment-68817146\n. Take a look at this post: http://help.appveyor.com/discussions/problems/3612-github-showing-multiple-checks#comment_38488858\n. \n",
    "sturobson": "Wasn't this a feature that was available in Sass but was neutered in 3.2?\nAnyways..... ssssshhhhhhhhhh\n. Instantly closing this after seeing this tweet from xzyfer\nWhich links to the 3.5 release candidate post. Thanks @xzyfer for your quick reply, both in this issue and on the twitters <3 . ",
    "davidkpiano": "Shouldn't this be a bug in LibSass? The expected behavior in @HugoGiraudel 's test was that .other-selector would extend the .selector ruleset only in @media print; whereas it's applied outside the media query in LibSass (unexpected behavior).\nThe lack of this \"feature\" seems like a necessary evil to prevent unexpected behavior like that. If I wanted to extend the .selector ruleset regardless of media query and then have custom rules inside a media query, I would just do this (which LibSass doesn't support yet):\n``` scss\n.selector {\n  content: selector;\n}\n@media print {\n  .other-selector {\n    @at-root (without: media) {\n      @extend .selector;\n    }\n    background: red; // custom rule inside media query\n  }\n}\n```\n. Relevant: https://github.com/sass/sass/blob/d26e6fa17f55d64278c9f09b5ace5e256e363e3f/lib/sass/script/value/number.rb#L329 and https://github.com/sass/sass/blob/d26e6fa17f55d64278c9f09b5ace5e256e363e3f/lib/sass/script/value/number.rb#L450\nruby\n    # This is the source data for all the unit logic. It's pre-processed to make\n    # it efficient to figure out whether a set of units is mutually compatible\n    # and what the conversion ratio is between two units.\n    #\n    # These come from http://www.w3.org/TR/2012/WD-css3-values-20120308/.\n    relative_sizes = [\n      {\n        'in' => Rational(1),\n        'cm' => Rational(1, 2.54),\n        'pc' => Rational(1, 6),\n        'mm' => Rational(1, 25.4),\n        'pt' => Rational(1, 72),\n        'px' => Rational(1, 96)\n      },\n      {\n        'deg'  => Rational(1, 360),\n        'grad' => Rational(1, 400),\n        'rad'  => Rational(1, 2 * Math::PI),\n        'turn' => Rational(1)\n      },\n      {\n        's'  => Rational(1),\n        'ms' => Rational(1, 1000)\n      },\n      {\n        'Hz'  => Rational(1),\n        'kHz' => Rational(1000)\n      },\n      {\n        'dpi'  => Rational(1),\n        'dpcm' => Rational(1, 2.54),\n        'dppx' => Rational(1, 96)\n      }\n    ]\nMutually compatible units should be coerced to the unit in the first operand -- that's the behavior in Ruby Sass.\n. @xzyfer Yep, _defaults() and _assign() (as well as other functions) rely on this behavior. :smile: \n. @mgreter Sure, want me to make a new issue with the second example? I feel like it might be an issue with arglists from variable-length arguments, rather than just lists (correct me if I'm wrong), hence the specific example.\n. @mgreter Other way around. It seems that appending 3 to the arglist (1, 2) results in 1, 2, 3 for Ruby Sass and (1, 2), 3 for Libsass, or something like that.\n. :sob: \n. Probably the same issue as this: https://github.com/sass/libsass/issues/1283\nThe keys 1 2 and 2 1 are distinct, as are to top right and to right top\n. :confetti_ball: \n. @karneaud That's expected. The @mixin clearfix needs to have @content inside the body to accept a content block.\n. What's the difference between your code and this?\nscss\n.m-post {\n    &--meta {\n        &--title {\n            font-size: 16px;\n        }\n    }\n}\n. @mgreter I think your example works as expected because you're only passing in one argument to args(), instead of three, as in the previous example.\n. Ruby Sass does not throw an error, but the outputs are inconsistent:\nTest\n``` scss\n.bar {\n  color: green;\n}\n.foo {\n  @extends .bar;\n}\n```\nRuby Sass output\n``` css\n.bar {\n  color: green;\n}\n.foo {\n  @extends .bar;\n}\n```\nLibsass + Node Sass output\n``` css\n.bar {\n  color: green;\n}\n@extends .bar;\n```\n. ",
    "matthewpavkov": "So, libsass does not support @extend within @media, and should not be used, correct?\n. ",
    "saper": "I can confirm that for the https://github.com/sass/sass-spec/pull/261 testcase libsass still works, i.e. produces output\ncss\n.foo, .bar {\n  content: 'foo'; }\nwithout reporting an error.\nThis was:\nsassc: 3.3.0-beta1\nlibsass: 3.3.0-beta2-1-g1efd\nsass2scss: 1.0.3\n. https://github.com/saper/libsass/tree/fix/3.1/850 contains the fix on the 3.1.0 branch.\nSeems like one cannot create pull requests to tags or releases, only to branches.\n. Pushed @Candid 's version with uint32_t as #1099\n. @djensen47 suggests in https://github.com/sass/node-sass/issues/858#issuecomment-93570201 to apply this to 3.1.0 (and release 3.1.1) The actual json.cpp is the same on 3.1.x and 3.2.x so the patch can be just cherry-picked.\n. @djensen47: Can you (1) open another bug for this, (2) provide your compiler details (3) try to compile with env V=1 npm install node-sass?\n. Does it work now?\n. @drewwells Here's some very initial swig interface file that got me started with Python https://gist.github.com/49387732f25ad50f913f\n. Yes, of course. You need to have libsass compiled first (doesn't have to be installed in some system-wide directory). My experimental libsass lives in /home/saper/sw/libsass.\nI am using BSD make to generate series of commands below:\n```\nswig3.0 -o /usr/obj/home/saper/sw/python-libsass/libsass_wrap.c \\\n      -python -I/home/saper/sw/python-libsass/../libsass/include \\\n      /home/saper/sw/python-libsass/libsass.i\ncc -fpic -DPIC  -O2 -pipe   -g -I/home/saper/sw/python-libsass/../libsass/include \\\n    -I/usr/local/include/python2.7 -std=gnu99 -Qunused-arguments  -fstack-protector  -c \\\n     /usr/obj/home/saper/sw/python-libsass/libsass_wrap.c \\\n     -o /usr/obj/home/saper/sw/python-libsass/libsass_wrap.So\nbuilding shared library _libsass.so\ncc  -fstack-protector -shared -Wl,-x -Wl,--fatal-warnings -Wl,--warn-shared-textrel  \\\n     -o _libsass.so -Wl,-soname,_libsass.so  \\\n     NM='nm' lorder /usr/obj/home/saper/sw/python-libsass/libsass_wrap.So | tsort -q \\\n     -Wl,-rpath /home/saper/sw/python-libsass/../libsass/lib \\\n     -L/home/saper/sw/python-libsass/../libsass/lib -lsass -L/usr/local/lib -lpython2.7\n```\nDon't worry about /usr/obj, it's just a neat way to have separate build directory when using BSD make.\n. (adding to #1160)\n. I see this change has caused some concern :) It is actually very rare for C libraries to accept pointers form callers and free them.\nAnd unfortunately copying strings is not going to help performance, first because copying takes time, second (more important) that compiler can speed up the code if it knows pointers are const, as suggested above. \nLooking at the commits dealing w/the problem I have some ideas:\n- [ ] rename Context::sources to Context::heap_sources, since it is used only to deallocate memory in the destructor.\n- [ ] Introduce Context::add_heap_source to be used by functions using resolve_and_load() as well as isass2scss conversion. This function would do heap_sources.push_back(contents) and then call original add_sources(). The latter would need to have sources.push_back() removed of course. That would reversing the effect of 3187a3cbff33a27e9608b419a02d52488a82c7c7 (be explicit about heap-allocated strings owned by libsass instead of copying user-supplied strings to make sure they are heap allocated).\n- [ ] Regarding 7e1b94b94eb60833dcd96f572f1357b924b62183 I am not sure why should sass_option_set_##option setters free old values. I think nothing in the libsass code allocates there...\n- [ ] sass_option_push_include_path does not need to strdup() and it should not be freed as well. include_paths handling seems to have some redundancy but I don't see a case where we need to heap-allocate a string there from within libsass. \n- [ ] I think something could be done with the error text buffers, so you would not need strdup() or any other utility function at all...\n. Yes, it does not yet work as expected. We probably should be able to get -fPIC flags from libtool as well.\n. This is magic. I decided to overcome my angst w/autotools and I can recommend @david-a-wheeler video as a first step (http://www.dwheeler.com/autotools/).\nFrankly I am learning as we go.\nMy motivation was easy - I have to delete -ldl -lstdc++ every time I compile on FreeBSD. libtool should take care of this. I have also noticed that Windows builds do not get their LIBSASS_VERSION defined in the code, but this is an old bug?\nThere are still few things to improve (axe few more items in Makefile.am).\nI was wondering if we would like to include some proper gcov.m4 macro - there is one which is GPL - http://bazaar.launchpad.net/~allanlesage/coverage-tutorial/trunk/files.\nNext step (not in this pull request) will be to detect some C++ features and get rid of gcc 4.4.* branch!\n. I am already half-done with autoconf stuff. I have now macros to detect range loops, nullptr as well as to clean up  madness.\nWork in progress in in http://github.com/saper/libsass/tree/cxx11\nNow working on variadic templates ...\n. @mgreter your changes are of course fine (minus one little nitpick)\n. @mgreter Can you help me in getting prelexer work on old compilers (I try to use the old code if C++11 does not fully work - http://github.com/saper/libsass/tree/variadic0). I seem to be getting error in parser.cpp:\nhttps://gist.github.com/saper/69435ad853b3f7a1fc10\nI see that previously peek was used differently, but why this fails only in those two places? Any ideas how to fix it without too much #ifdefing ?\n. Can we also have AM_PROG_AR on mingw32? Otherwise autoreconf complains out:\n/usr/local/share/automake-1.15/am/ltlibrary.am: warning: 'libsass.la': linking libtool libraries using a non-POSIX\n/usr/local/share/automake-1.15/am/ltlibrary.am: archiver requires 'AM_PROG_AR' in 'configure.ac'\nMakefile.am:28:   while processing Libtool library 'libsass.la'\n. Looks like _AC_PROG_CC_G autoconf test sets -O2 -g as the default compiler flags on gcc-likes (including clang).\n. Can you try running autoreconf and then ./configure ? libtool should find them\n. We need to resolve C++ namespacing first, and then this can possibly be resolved quickly.\n. Rebased for @drewwells for experiments with limited compiler environment (Android, MacOS X 10.6 SDK, etc.)\n. > I think agree with @mgreter. We don't have the issues nullptr is intended to fix.\nLet's use at least NULL instead :)\n. Yep, but unfortunately the pic-only option is broken in the earlier versions. I think we can let this to sit here for a while until there is a solution or at least @travis-ci upgrades their default libtool from 2.4.2 to something newer (there is 2.4.6 even now)\n. Yes... In the good ol' days normally \"release\" tarballs are shipped with a working ./configure script which generates libtool script. The user should not normally need autotools at all to use our library (even if compiling from source and using ./configure).\nBut I agree it is a bit early to require this.\n. Probably a nice idea for a sponsored project, if appropriate resources could be made available.\n. Well I started digging into the code and it seems that backtrace gets constructed also in static int handle_errors(Sass_Context* c_ctx) manually, but I think node_sass gets one from the Backtrace object.\n. assignment and property tests from https://github.com/sass/sass-spec/pull/324 do not fail on libsass 3.3.0-beta2 (as they probably should). \n.  Pushed #1099 to simply replace ucha_t with uint32_t (essentially it's @candid 's version)\n. Coool, almost arrived on the same commit ID :)\n. eh, forgot to push the update :(\n. Having removed extra braces in input:\n``` js\n    var sass = require('node-sass');\nvar input = \"#test1 { area: 1px * 2px / 1px;\\n\" +\n            \"         area-fn: testing(1px * 2px) / 1px; }\\n\" +\n            \"#test2 { ratio: 20px / 2% * 1%;\\n\" +\n            \"         ratio-fn: testing(20px / 2%) * 1%; }\";\n\nvar options = {\n  data: input,\n  functions: {\n    \"testing($value)\": function(value) {\n      console.log(value.getUnit());\n      return value;\n    }\n  }\n};\nvar expected = \"#test1 { area: 1px; area-fn: 1px; }\\n\" +\n               \"#test2 { ratio: 10px; ratio-fn: 10px; }\\n\";\n\n\nsass.renderSync(options);\nconsole.log(options.result.css.toString());\n\n```\nI am getting:\n```\npx*px\npx/%\ntest1 {\narea: 2px;\n  area-fn: 2px; }\ntest2 {\nratio: 10px;\n  ratio-fn: 10px; }\n```\nso units are still strings, but they do work here and back.\nTested with node-sass master https://github.com/sass/node-sass/commit/7c15014b594f2b9e85b72cab89e2aca56762e740, libsass master as of Aug 20th https://github.com/sass/libsass/commit/0ae11a47e69164bc5ce563f51201f765d2822fb6 (also https://github.com/sass/libsass/commit/66f4e68bb42eae09c4c2686124c4b55873162698)\n. I agree. I have an idea: what about storing units (via C API or maybe internally as well) as a fixed-length array of all incompatible units just with their exponents? Sure, you waste few bytes almost every time, but even if we would have implemented all units from Syst\u00e8me International it would be only an array of 7 bytes.\n. > @saper sass accepts anything as units, not just the ones specified in\n\ncss, so the max length is unknown. I don't see any benefit in this, as\nparsing the given unit string is as straight forward in C as any other\nexchange format I could possibly think of (instead of null terminated,\nit is '*' and '/' terminated now). Btw. the following are valid units\nfor sass:\nscss\ntest: (1\\65 _em--_--e0 - 2\\65 _em--_--e0);\n\nExcellent, thanks for pointing this out :)\n. I think this is one issue in one part of code, and this code needs to be torn apart a bit. It is kind of orthogonal to the problems reported.\n. will try to provide test case for the leak\n. To clarify my intentions about better C-API I have opened #1368 for discussion.\n. This is due to \n```\nif ((__cplusplus >= 201103L) && defined(_GLIBCXX_USE_C99) \\\n && !defined(_GLIBCXX_HAVE_BROKEN_VSWPRINTF))\n\n```\nin <bits/basic_string.h>\nthe same case is described here:\nhttp://stackoverflow.com/questions/19500013/undefined-strtold-when-using-glibcxx-use-c99\nAdding -D_GLIBCXX_USE_C99 to the g++48 commandline works...\n. Wrong fix.\n. Superseded by #1191\n. This fixes #1185 for certain gcc 4.x environments\n. (accoring to git bisect sass/libsass@974ae42b87a3714fff5ed38132272486747f524c broke this, it was introduced in https://github.com/sass/libsass/pull/1177)\n. Isn't configure enough? autoreconf should not be necessary\n. > Apparently not? I get errors without autoreconf\n\ncd libsass-tmp; ../libsass-src/configure --disable-shared \\\n          --prefix=/Users/drew/src/github.com/wellington/go-libsass --disable-silent-rules \\\n          --disable-dependency-tracking\n/bin/sh: ../libsass-src/configure: No such file or directory\nmake: *** [libsass-tmp] Error 127\n\nI am sorry, I misunderstood the issue! Of course we don't ship ./configure\nscript in the git repository. What I meant is that ./configure should be enough\nto create the version information, but of course you need to have\nthat script first :)\nSorry for noise!\n. > No problem I'm still not great with auto tools but I am reading through the\n\nbook on it! :)\n\nThis is highly recommended: http://www.dwheeler.com/autotools/\n. Probably we should identify the state of the executor vs compiler's state. We should be able to provide a stable interface to the custom function implementors (for example, I'd like to have it serializable #1108). Even if some reflective functions should be made available ( e.g. #1065 ) we may need to provide a stable interface there as well.\nNot only custom functions are affected - probably having the same interface for the built-ins would be beneficial as well.\n. I see that lots of use cases revolve around mapping \"import-identifier\" to \"actual-imported-resource\"\nSo, in general, what is needed is an array of:\n('@identifier', 'string')\nor\n('@identifier', sourcefile)\nmappings?\nSecond question:\nWhat about introducing a way to specify such mapping upfront to libsass, something like:\nctx = sass_new_context();\n  sass_add_file_source(ctx, 'a', 'sub/a.scss')\n  sass_add_file_source(ctx, 'b', 'sub/b.scss')\n  sass_add_subtree_source(ctx, 'mixins', 'proj/mixins') /* for subdirectories */\n  sass_add_data_source(ctx, 'c', '/* ... */')\n  sass_add_custom_source(ctx, 'special', custom_import_func)\n  sass_compile(ctx);\nThis might actually reduce the need for custom importers - as those records could be added dynamically upfront before rendering.\n. The second argument (abs_path) is almost certainly correct, the first argument which serves a kind of generic \"imported entity\" identifier is up to the interpretation. See also https://github.com/sass/libsass/issues/1160\n. Wow, that's huge...\n. I think this import-once approach may have some trouble due to #1160. Would love to see a self-contained test.\n. Is this different from ruby sass?\nSince it seems normal to me - when the piece of code is encountered, it is executed; if the file is about to be included we need to call the importer, parse and execute contents.\nI guess that the \"import once\" functionality simply overshadows the old definition of \"component/color\" and then you get the error. Does it work without the \"import once\" functionality?\n. This is now included in #1287\n. On Sun, 21 Jun 2015, Michael Mifsud wrote:\n\nThanks @saper.\nPlease pull the logger into a separate PR. We need the string fix\nbut I'm hesitant to add yet another (undocumented) logger. We should\ndiscuss and implement a single debugging interface.\n\nYes, but the string fix is most probably incomplete and I need facility to develop\nit further... And merging the logging in and out of the code is no fun!\nWhich debugging interface is documented?  At least this one has\nan old DDJ article :)\nBut here we go:\nhttps://github.com/sass/libsass/pull/1289 <-- string fix\nhttps://github.com/sass/libsass/pull/1288 <-- tracing strings\n. Since #1289 got merged and #1288 is still(?) under consideration - closing this one.\n. Well the problem is that debug_ast is probably affected by the very problem I am debugging: it uses dynamic_cast<> which seems to not do the right thing for the strings.\nI am more interested in tracing lifecycle of certain objects - when they are created and used.\nFrom the example dump (It also includes output from https://github.com/sass/node-sass/pull/1007):\n[LIBSASS] 0x803c83600:operator() output.cpp:391 This should be a constant string... (0,\"list-style-type\")\n[LIBSASS] 0x803c83600:operator() output.cpp:393 ... but dynamic_cast<String_Quoted*> worked\n[LIBSASS] 0x803c83600:operator() output.cpp:376 This should be a quoted string... (0,\"list-style-type\")\n[LIBSASS] 0x803c83600:operator() output.cpp:381 ... no quote mark(?), sending via string_to_output\nIt seems that void Output::operator()(String_Constant* s) gets called first always, and not the the operator for the derived type.... The code looks very strange - on one hand we depend on the runtime type information, but on the other hand - we always check for quoting...\n. Thanks. Will look it up. So now we can get rid of this pretty confusing constructs like\nif (dynamic cast...) {\n  do something\n} else if (quote_mark) { \n  do something\n} else { \n  definitely_not_quoted\n}\n?\n. @mgreter Ok, I read a little on CRTP and frankly I don't see it applied there .... we just use plain old polymorphism (with virtual tables) and run time type information, both with their overhead.\nCan you elaborate a bit?\n. Thanks! With CRTP we could actually get rid of dynamic cast, and break output.cpp into output methods for respective types... that would be awesome\n. Mini-documentation: https://github.com/sass/libsass/wiki/Live-trace-facility\n. Oh noes... I actually want to use a pure C connector to libsass... please no C++ madness!\n. I understood wrongly - that you intend to introduce C++ operators. Personally I think that API is already way too large and too bloated. I'd rather have small JavaScript classes handling complex numbers/units or color class than rely on the API. The API should get the data in and out. Of course it does not help that the structures are opaque - I'd love to be able to see them. That would save us a LOT of API calls.\n. @driekus77 did you customize _settings.scss ? Can you post the file?\n. Please push whatever you have, we need to reproduce this bug somehow...\n. Can you try running env V=1 npm install ?\nCan you paste (for example to https://gist.github.com) the output of\ng++ -std=c++0x -fexceptions -dM -E -c ast.cpp\n. In node_moduless/node-sass/src/libsass\nNo, we don't have any SmartOS instances running.\n. Thanks, I have tried setting up SmartOS instance on some hosted site but even with my pretty decent Solaris skills it took me too long. If somebody wants to step up and maintain this, we can ship Solaris binaries, no problem.\n. Some stuff I'd like to have to support the OS for node-sass: https://github.com/sass/node-sass/issues/981#issuecomment-119034796\n. Yes, when checking out node-sass be sure to checkout git submodules as well (git submodule update --init for example).\nYou can also try standalone libsass checkout, and follow the standard autoconf procedure.\n. @djensen47 can you try #1309?\n. > Also, did you see this: https://gist.github.com/jperkin/4b88403da41f556e540d\nNo, thank you!\n. @djensen47 can you check if the current git master compiles? \n. Well, unfortunately it does not. Got my gear running an the ancient Solaris 9 machine and we still fail with gcc 4.9 :(\n. This one is a quick fix for Solaris problem.\n. Can we re-open this only to fix #1308?\n. Er, no... this should be enough to fix the Solaris problem. The #1310 fixes the problem generally across the code base.\n. Aye aye, sir!\n. There is no reason SPARC wouldn't work. I have access to an old SPARC machine to test but first I need a decent C++11 compiler there, will not be easy.\n. Will work on rebasing this as the refactoring goes in. Most important changes are in the headers, we can apply this in two stages - headers first and removal of use namespace std; in the .cpp files later.\n. This is now rebased on top of d94ca1f\n. Ouch, AppVeyor can't fetch MinGW at the moment :(\n. @drewwells who cares it's appveyor to be infected ;)\n. This is a cleaned-up, simplified and rebased version of my previous patches.\n. :rocket: \n. :rotating_light: \n. I have rebased un'std branch to the current master, so if the new code has std::vector, std::string, std::map, std::pair, std::make_pair(), std::min(), std::max() etc. it should merge easily... Would that be ok? scratch that, that would be practically re-doing my work...\n. Well using namespace std; is a nice shortcut for simple trivial programs, but I am already having trouble to figure out issues with different compilers (Visual Studio redefining min/max https://github.com/saper/libsass/commit/23f89beef745936fbbb82bc95aa1efe19824a682, GCC breaking std::round() on non-glibc systems https://github.com/sass/node-sass/issues/1034, and of course the SEC problem on Solaris etc.). \nActually I was surprised that most of the files use std::string or std::vector rather sparingly, for other *.cpp files (but not header files!) it is always possible to do using std::string; using std::vector to improve readability. That said - it easier to spot difference between std::string and String  (meaning Sass::String), and we also have a local variable named string somewhere...\nAnother example of related trouble is https://github.com/sass/libsass/commit/5445c456acd1db47608dd20cd267cb3e034c3c62 - you don't really know which abs() are you using and how stricter C++ type checking should work...\nOnly in ast.hpp readability is a bit worse - because this \"header\" file is doing lots of work (instead of ast.cpp file for example) and ast.hpp gets included almost everywhere, therefore all namespace imports get spoiled onto other files.\nEven if this is developer's (slight) inconvenience, people trying to compile libsass on non-Linux platforms will certainly have a simpler job.\n. What happened? Everything works?\n. @mgreter can you help me to figure out why AM_PROG_AR fails on your mingw32 setup?\n. Maybe we should not rely on extension at all\n. This is because of laws of physics. White light encompasses all wavelengths and therefore covers all possible hues. If you change the hue value of white or black, the colors stay the same.\nYou can see this in action on http://www.colorizer.org/ for example.\n. Sourceforge malware update again? :)\n. Hmm, not sure I love it but I think there are few things to consider:\n1) Can we fix the Makefile situation? It is highly annoying to have a version-controlled Makefile overwritten by configure\n2) lib directory will be confusingly not used in the libtool case, correct? Can we maybe use src/.libs instead?\nThe reason why it may be useful - I am compiling node-sass bindings with library paths set to $HOME/sw/libsass/.libs/libsass.so. This way I can test changes in libsass without touching the node-sass bindings. Would love to have this location for both autoconf and non-autoconf cases.\n3) I think if this reorganization would serve any real purpose, I'd like to have out-of-tree building possible. MSVC is always doing this, we could have this with GNU make.\n4) Shell scripts for CI should be simplified to the bare minimum. A good directory organization should allow this (no cd or ${BASH_SOURCE[0]} there anymore).\nSome middle-term thoughts:\n5) I think ast.hpp is too big. What about introducing one source file per type (number.cpp, string.cpp, ....) to combine all functions related to one node type into one file (and possibly one class). This could have some additional advantages like getting rid out classes like Output and probably we could have much less dynamic_casts (if any).\n. re 1) What about having hand-generated Makefile in one directory and autotools-generated Makefile in another? Maybe GNUmakefile can be used somehow (generated....)?\nThe reason I raise this I want to avoid another move because this will be easier for some other reason (simplifying the script for example).\nHere's a simpler https://github.com/saper/sassc/blob/fixautoconf/ci-build file that actually can be made even more simple. And we should almost never need to change the directory in the script if the Makefiles are right...\n. It is a problem, because git status always shows modified Makefile and sass_version.h - one needs to hand-pick files to commit and be careful not to include those; this contributes to getting dirty version indicator even it is not.\n. I think we should start generating sass_version.h files in any case. \nWhat happens here if git is unavailable/not in PATH/on strike?\n. So, sass_version.h is the next one to deal with :)\n. Requiring\n#include <libsass/sass.h>\ninstead of\n#include <sass.h>\nis an API change. (I know you can cheat with -I, but that's still breaking the API).\n. Ah, in that case it's fine of course.\n. We have a circular dependency on sassc, which needs to be updated to run our tests.\n. > In principle $(RM) -r is not portable. Might not be that big of an\n\nissue as ie. mkdir -p, but what if we have del set for RM! Might\nnot be a problem now, but if we use specific options, it makes no\nsense to use variables for the calls!\n\nGood point, we can have have $(RMF). Is \"del\" working with \"-f\" ?\n. Well, there is del /s :) But I went for rmdir as you have suggested, thanks!\n. I don't recall needing to add std::stack anywhere... (#include <stack> can safely go away as well)\n. Re git history: It got much more complicated with the file moves, so I wouldn't worry too much about it now.\nFor example:\nm> git diff namespaces ^master -- values.hpp \ndiff --git a/values.hpp b/values.hpp\nnew file mode 100644\nindex 0000000..765ed86\n--- /dev/null\n+++ b/values.hpp\n@@ -0,0 +1,12 @@\n+#ifndef SASS_VALUES_H\n+#define SASS_VALUES_H\n+\n+#include \"ast.hpp\"\n+\n+namespace Sass {\n+\n+  union Sass_Value* ast_node_to_sass_value (const Expression* val);\n+  Value* sass_value_to_ast_node (Memory_Manager<AST_Node>& mem, const union Sass_Value* val);\n+\n+}\n+#endif\n. It was meant to be part of a \"lightweight drop-in\" library :) and moved in from src to root in e74a31d2a3039edc100a7303137e8481776a4e23\n. Ok, it's my turn. This is going to be difficult because it is mostly a matter of style but it also has some technical implications (like keeping namespace pollution to the minimum).\n1. I don't think that having std:: in almost every place required is a bad thing. I kind of got used to it very quickly and since I am browsing other C++ projects like V8 or Chromium - they use consequently prefixes almost everywhere.\n2. Having std::string or std::hash actually makes code sometimes more readable. I found few places where it helps:\n   - many places where we have string to_string. std::string to_string is more readable to me\n   - we've had a local variable called string somewhere (https://github.com/sass/libsass/blob/7ed376f36547753b246adddb41bd0478a220e706/src/ast.hpp#L1362) - that's okay if the standard type is always std::string.\n   - places like https://github.com/sass/libsass/blob/7ed376f36547753b246adddb41bd0478a220e706/src/ast.hpp#L932-L937 - I don't know STL by heart and initially I thought hash_combine was some standard library function. If we have a policy to put namespace prefixes everywhere, there is no doubt: every item from the library is namespaced by std::. Rare exceptions could be made with using only within some crowded code (we don't have that many).\n3. Google Style Guide is something one does not have to follow (they have some very strict decisions on some items), but they are right in pointing out that using namespace should never be used and using can be used only in .cpp files (or within methods in the header files).\n4. I strongly dislike introduction of one more header file for this purpose. Also including using std::string in the header files, like using std::string; in sass2scss.h. The reason is pollution again: when I was removing using clauses from source files for #1310 there was always one more header file where the using clause was hiding. So from this point view, a header file makes no sense - it's just a pure redundancy on one hand - but if you don't do rendudancy, then it's obscure magic. You put using into some obscure header file (say sass2scss.h) and those using clauses magically operate everywhere. If you have them explicit at the top of the file and, say, want to remove them - they still magically work. You remove #include \"sass.h\" and they still work, because they are hidden in some other headerfile. It took me 13 commits in #1310 before I realized that the using clause was still hiding somewhere (in https://github.com/saper/libsass/commit/324f3b3d06e10706c84be04880b995dfa4c77535).\nThat's why I think there is no easy way out - we need to get it out of headers, use std:: almost everywhere. We can for example put using std::string etc. at the top of the most busy .cpp files (in #1310 I decided to leave it in 6 source files: https://github.com/saper/libsass/blob/namespaces/file.cpp#L38, https://github.com/saper/libsass/blob/namespaces/parser.cpp#L22-L23 etc., but more I think about it I would propose a rule to include std:: always in the new code and slowly modify existing code to replace existing uses gradually.\nUnfortunately, the headers need to be dealt with now and uniformly, as we don't have long methods there which would justify putting using std::string inside them.\nI am not using an editor that magically completes identifiers - and I still prefer to type those std::s by hand.\n. Ok, it's my turn. This is going to be difficult because it is mostly a matter of style but it also has some technical implications (like keeping namespace pollution to the minimum).\n1. I don't think that having std:: in almost every place required is a bad thing. I kind of got used to it very quickly and since I am browsing other C++ projects like V8 or Chromium - they use consequently prefixes almost everywhere.\n2. Having std::string or std::hash actually makes code sometimes more readable. I found few places where it helps:\n   - many places where we have string to_string. std::string to_string is more readable to me\n   - we've had a local variable called string somewhere (https://github.com/sass/libsass/blob/7ed376f36547753b246adddb41bd0478a220e706/src/ast.hpp#L1362) - that's okay if the standard type is always std::string.\n   - places like https://github.com/sass/libsass/blob/7ed376f36547753b246adddb41bd0478a220e706/src/ast.hpp#L932-L937 - I don't know STL by heart and initially I thought hash_combine was some standard library function. If we have a policy to put namespace prefixes everywhere, there is no doubt: every item from the library is namespaced by std::. Rare exceptions could be made with using only within some crowded code (we don't have that many).\n3. Google Style Guide is something one does not have to follow (they have some very strict decisions on some items), but they are right in pointing out that using namespace should never be used and using can be used only in .cpp files (or within methods in the header files).\n4. I strongly dislike introduction of one more header file for this purpose. Also including using std::string in the header files, like using std::string; in sass2scss.h. The reason is pollution again: when I was removing using clauses from source files for #1310 there was always one more header file where the using clause was hiding. So from this point view, a header file makes no sense - it's just a pure redundancy on one hand - but if you don't do rendudancy, then it's obscure magic. You put using into some obscure header file (say sass2scss.h) and those using clauses magically operate everywhere. If you have them explicit at the top of the file and, say, want to remove them - they still magically work. You remove #include \"sass.h\" and they still work, because they are hidden in some other headerfile. It took me 13 commits in #1310 before I realized that the using clause was still hiding somewhere (in https://github.com/saper/libsass/commit/324f3b3d06e10706c84be04880b995dfa4c77535).\nThat's why I think there is no easy way out - we need to get it out of headers, use std:: almost everywhere. We can for example put using std::string etc. at the top of the most busy .cpp files (in #1310 I decided to leave it in 6 source files: https://github.com/saper/libsass/blob/namespaces/file.cpp#L38, https://github.com/saper/libsass/blob/namespaces/parser.cpp#L22-L23 etc., but more I think about it I would propose a rule to include std:: always in the new code and slowly modify existing code to replace existing uses gradually.\nUnfortunately, the headers need to be dealt with now and uniformly, as we don't have long methods there which would justify putting using std::string inside them.\nI am not using an editor that magically completes identifiers - and I still prefer to type those std::s by hand.\n. Thank you for this question @drewwells ! I think this actually touches the gist of this issue.\nCustom importers work in a pull way and the proposed add_source method is a push way.\nCustom importers work this way: libsass processes the file and when it encounters @import statement\nit stops the parsing and calls the custom importer routine to provide the data or the file name. After the\nresponse is received, libsass continues processing.\nIn the new way (which does not remove the possibility to have custom importers as we have now, of course)\nyou prepare all your bits before starting the execution phase. I actually think that it should be possible\nto pre-parse all available resources/mixins and then just invoke the execution engine pointing at the \"main\" file\n(which you may have any). Ideally, if we find a way to nicely persist the libsass context, maybe you could just keep all your files parsed until they change and invoke just the execution engine for (multiple if necessary) \"main\" files:\n`-+ lib\n   `-+ mixins\n     `--- lib.scss\n     `--- cps.scss\n     `--- img.scss\n   `-+ custom\n      `- user.scss\n`-+ css\n  `--- profilepage.scss\n  `--- helppages.scss\n  `--- main.scss\nAfter\naddsource(c, 'lib/mixins/lib', 'lib/mixins/lib.scss')\naddsource(c. 'lib/mixins/cps', 'lib/mixins/cps.scss')\naddsource(c. 'lib/mixins/img', 'lib/mixins/img.scss')\naddsource(c, 'lib/mixins/lib', 'lib/mixins/lib.scss')\naddsource(c, 'css/profilepage', 'css/profilepage.scss')\naddsource(c, 'css/helppages, 'css/helppages.scss')\naddsource(c, 'css/main, 'css/main.scss')\nand then it is possible to do, hopefully without re-parsing everything:\ngenerate(c, 'css/main', 'out/css/main.css')\ngenerate(c, 'css/helppages, 'out/css/helppages.css')\ngenerate(c, 'css/profilepage, 'out/css/profilepage.css')\nActually generate() does not need to touch the file system, it just writes the data to the buffer supplied by the client.\nI think the custom importers we have now have been shaped after the Ruby implementation, where the Sass engine does not have a knowledge of files really but it invokes supplied importer (see documentation for Sass::Importers). File system import is just the default importer which can be replaced by another backend, for example database.\nBecause of the nature of C, it seemed easier to provide a built-in file interface, that complicated the API a bit.\n(I have renamed compile to generate in the example at the top).\n. This is exactly what @mgreter means, thank you. I proposed to expose this for two reasons: to let libsass avoid any I/O operations (which breaks node-sass in some cases) and because this function was already there available (it is removed now as far as I can see).\n. so, can we close this?\n. @xzyfer I wonder if this expansion issue is a duplicate of some other issue we already have? Or this a new thing and should be kept open?\n. Oh that was ugly, thanks!\n. In general - as noted partially in the comments - we need to check whether we need assertion or whether we should somehow handle the situation.\nWe definitely SHOULD NOT cover up errors with if() - the code should fail fast when things go wrong -  finding errors will be more difficult.\n. This is actually more related to the git version control utility and not GitHub as such.\nYour commit series starting with b3b564d was done when a61117a492dbcb56b495d441cdad34d8d2ed was the top of the master. (This is normal, you have started your modifications at the time).\nIn the meantime the work on libsass progresses and the master advanced from a61117a4 to the (current as I write this) - those are 29 commits:\ngit log --oneline master ^a61117a4\n9b4e424 Merge pull request #1395 from xzyfer/fix/json-signature-mismatchg\n8367adf Update some methods in json.cpp to be more interally consistent\nce1f6c2 Fix mismatch in function signature in json.cpp\n666d2c0 Merge pull request #1342 from mgreter/feature/number-fixes\ne154e5c Merge pull request #1373 from drewwells/feature/jsonpreprocessor\n7ed376f Merge pull request #1389 from mgreter/bugfix/issue-1376\nfe37d44 Merge pull request #1391 from mgreter/code-improvements\n50bcd62 Fix a few obvious code issues\n046e78f Fix interpolation of lists with null values\n92be77a Merge pull request #1388 from mgreter/fix/msvc-warnings\n434327b Merge pull request #1363 from mgreter/fixes/issue_1355\nc522143 Make empty `@return` statement a parser error\na303263 Add concrete types for all statements\nc6d43fd Fix a few MSVC warnings\nd17ab21 Merge pull request #1387 from mgreter/fix/pointer-compare\nb4e24d7 Remove pointer compare functions\n7014f55 Merge pull request #1369 from saper/nodl\ne764b04 Merge pull request #1383 from mgreter/bugfix/memory-manager\n73329f6 Merge pull request #1385 from mgreter/fix/mac-build\n17f56ef Fix memory manager not tracking memory\nbc8be92 Fix memory access bug (Fixes Mac CI builds)\n7f2d973 Fix Makefile to create include directory on install\ndaeb86e Merge pull request #1380 from saper/emptysourcesContent\n02aa085 Merge pull request #1379 from saper/tapmode\n57f88e5 Don't emit sourcesContent if empty\n78140ad Fix checking whether we can use TAP mode...\nb0f37d0 move methods from directives to static functions\n5e9437b No -ldl for FreeBSD\n1f709b8 Fix error for multiplication of invalid units\nSo your work and current libsass diverged (this is normal in the process when more than one person works on the same code base).\nWhat you need to do is to tell git to analyze what where your changes (diffs) to the original master back then (a61117a4) and try to re-apply them onto the current code base. You can do this step-by-step (to better understand the process maybe) or automatically via the git rebase command (that's why it is called \"rebasing\" - please rebase your changes).\nManual way:\ngit remote update\ngit checkout -b new-master origin/master\ngit log --oneline b3b564d ^new-master\n(produces a list of changes you did)\ngit cherry-pick 2bf7801\n<fix conflicts>\ngit cherry-pick 1b3f029\n<fix conflicts>\n....\nand so on for all the changes listed.\nThe automated way is\ngit remote update\ngit checkout -b msvc-warnings b3b564d\ngit rebase origin/master\nBecause the code you have modified might have changed in the meantime too and more particularly because some of the code you have done has already been applied, you will run into the situation called \"conflict\".\ngit will stop and ask you to correct the files:\n```\nm> git checkout -B msvc-warnings b3b564d\nm> git rebase origin/master\nFirst, rewinding head to replay your work on top of it...\nApplying: Fixing multiple MSVC compiler warnings and code analysis\nUsing index info to reconstruct a base tree...\nM       src/ast.cpp\nM       src/color_maps.cpp\nM       src/eval.cpp\nM       src/json.cpp\nM       src/parser.cpp\n:64: trailing whitespace.\n:213: trailing whitespace.\n    if (sources.size() == 0 && source_c_str) \n:219: trailing whitespace.\n                for (char src : sources ) \n:226: trailing whitespace.\n                for (char str : strings ) \n:232: trailing whitespace.\n    for (size_t m = 0; m < import_stack.size(); ++m) \nwarning: squelched 3 whitespace errors\nwarning: 8 lines add whitespace errors.\nFalling back to patching base and 3-way merge...\nAuto-merging src/parser.cpp\nAuto-merging src/json.cpp\nAuto-merging src/eval.cpp\nAuto-merging src/color_maps.cpp\nCONFLICT (content): Merge conflict in src/color_maps.cpp\nAuto-merging src/ast.cpp\nCONFLICT (content): Merge conflict in src/ast.cpp\nFailed to merge in the changes.\nPatch failed at 0001 Fixing multiple MSVC compiler warnings and code analysis\nThe copy of the patch that failed is found in:\n   /home/saper/sw/libsass/.git/rebase-apply/patch\nWhen you have resolved this problem, run \"git rebase --continue\".\nIf you prefer to skip this patch, run \"git rebase --skip\" instead.\nTo check out the original branch and stop rebasing, run \"git rebase --abort\".\n```\nIf you say git status it will show which files are the problem now:\n``````\nm> git status\n````rebase in progress; onto b3b564d\nYou are currently rebasing branch 'msvc-warnings' on 'b3b564d'.\n  (fix conflicts and then run \"git rebase --continue\")\n  (use \"git rebase --skip\" to skip this patch)\n  (use \"git rebase --abort\" to check out the original branch)\nChanges to be committed:\n  (use \"git reset HEAD ...\" to unstage)\n    modified:   src/color_maps.hpp\n    modified:   win/libsass.vcxproj\n\nUnmerged paths:\n  (use \"git reset HEAD ...\" to unstage)\n  (use \"git add ...\" to mark resolution)\n    both modified:   src/ast.cpp\n    both modified:   src/color_maps.cpp\n\n``````\nSo you need to edit src/ast.cpp and src/color_maps.cpp, searching for lines looking like this:\n```\n<<<<<<< HEAD\n      int numval = (int)(r * 0x10000 + g * 0x100 + b);\n=======\n      double numval = r * 0x10000 + g * 0x100 + b;\n\n\n\n\n\n\n\nFix a few MSVC warnings\n```\n\n\n\n\n\n\n\nThis means that the bottom line comes from your change, and the above comes from the code that has changed (HEAD means current libsass master in this context).\nYou have to decide which line is correct and delete the <<<<, ===, >>>> markings. \nWatch out as there may be many situations like this is the one file. After you are done, you save the file\nand do\ngit add src/ast.cpp\nAfter all conflicting files are corrected, do git rebase --continue, and finally you will be done.\nThe push your changes to github using -f option:\ngit push -f <your-github-remote> HEAD:master\n. You can check your commits ahead of master with git log HEAD ^origin/master\n. It seems to me this separation is unnecessary... I think it should be kept as simple as possible. Additionally I find overloading of () mostly confusing.\n. > I probably need the seperation once I implement the correct memory\n\nhandling (scoping). At some point we may move items from an inner\nscope to the global scope. But I agree that it could be a normal\nmethod and doesn't have to overload the () operator (was there\nbefore my time).\n\nUh, sounds complicated! I think we still have possibilities\nto simplify and improve memory handling in the existing code.\n. My very early attempt at better scoping of the heap memory is in #1386 for discussion.\n. Sure, I didn't know where operator() was supposed to be used, so reverting the incorrect change is fine as well.\n. Side note: it seems that some test is failing on travis from time to time. Can we run it more verbosely to find out which one is this?\n. See also https://www.traviscistatus.com/incidents/lx8qm0t7q39t\n. What kind of signal are we getting there? Isn't that still Travis CI platform issue that causes this?\n. continue makes sense in case of, say, EAGAIN - when we do non-blocking reads (we don't afair).\nBut in case of a signal - it is a bad thing and we should exit with an error.\n. No one knows :) That's why UNIX has chose the path of returning EINTR and leaving it up to the caller... If somebody is worried about this, they usually use SA_RESTART facility of sigaction(2)\n. > I think I finally found and fixed the issue in https://github.com/mgreter/libsass/commit/6cc693c564de825e7a5ac94966d60c3dbeb5c6f6 ... I guess it was misleading me with the Error 4 first, the actual problem was a segfault:\nWow, nice. How can we improve testing harness to bring a real error\nupfront?\n. Does #1310 fix the issue without the #undef?\n. > No, it has to be #undef or not #define in the first place. #undef is a cleaner approach though: https://github.com/sass/libsass/pull/1410#issuecomment-125458730\nI asked because Solaris #defines SEC and we can fix it by not polluting our namespace with \"std\".\nWould that work for your case as well?\nthe min() max() windows problem needs to be solved by #define NOMINMAX though - they provide\nthe possibility to tell windows.h \"don't define these\". By the way they are defined\nprevent me to cure the situation using namespaces.\nCan you try #1310 and see if it helps? (Without the undef).\nWhich compiler are you using?\n. Well, there is no build error on our code as-is (just checked with VS2013). This is a consequence of combining all our files into one, which is not a supported build configuration. Unfortunately, Win32 API is full of funny symbols and one of the reasons to split files is to isolate affected files. \nI'd recommend adding an additional file with a workaround code in the additional header file included as the first one, prior to merging the files. Or somewhere in between.\n#define _NOWIN32_PSEUDO_MODIFIERS does not work when using full Windows SDK headers, unfortunately #define IN is embedded in many core headers and it is impossible to somehow #define it out\nHaving said that, I'm happy to work on streamlining our header files to make compilation process faster, but I don't think we should support that mode of compilation.\n. > Are you experiencing build errors as a result of these changes? If so,\n\ncould you reproduce it on the appveyor test suite because all builds are\npassing.\n\nThe build is fine with the code as-is (from git master).\nIf I add #include  to \"units.cpp\" it breaks\nbecause of #define IN in many Windows headers (windef.h,\nncrypt.h, bcrypt.h, wincrypt.h and many others).\nYou can try this I think also with MinGW32 if you point\nto to a full Windows API (as opposed to a stripped down\npackage MinGW32 provides).\nBut #undef IN after #include  fixes the issue.\n. > Personally, I think we should not use IN, OUT, OPTIONAL because\n\nthose have special meaning in windows. I initially fixed this by\nrenaming IN to INCH, but if you give windows an inch it'll take a\nmile :)\n\nThat's reasonable. Windows hijacks lots of words, but we've\nhad issues with Solaris as well.\n. You can file it against the https://github.com/sass/sass repository (if it's not already there...)\n. We also support \"data\" context, where source is provided as the user-supplied memory buffer. Would that work for your case?\n. Commit 0e6b4a2 still works fine for me, master is broken\n. Bisect points at 9b4e4244bc86a4ad49e2deb8ef4f41d39c176102 - surprising :)\n. yep, my bisect went bad, checking again.. didn't have compile errors though\n. This is the backtrace:\n```\n0  __cxa_throw (thrown_exception=0x802430078, tinfo=0x80146a320 , dest=0x801264860 )\nat /usr/src/lib/libcxxrt/../../contrib/libcxxrt/exception.cc:768\n\n1  0x000000080125af91 in __cxa_bad_typeid () at /usr/src/lib/libcxxrt/../../contrib/libcxxrt/auxhelper.cc:54\n2  0x0000000800b9b0d2 in Sass::Eval::operator() (this=0x7fffffffd978, v=0x802408100) at eval.cpp:711\n3  0x0000000800cd4cf1 in Sass::Variable::perform (this=0x802408100, op=0x7fffffffd978) at ./ast.hpp:1151\n4  0x0000000800bc22b3 in Sass::Expand::operator() (this=0x7fffffffd968, i=0x80244f660) at expand.cpp:324\n5  0x0000000800cd4781 in Sass::If::perform (this=0x80244f660, op=0x7fffffffd968) at ./ast.hpp:582\n6  0x0000000800bc7986 in Sass::Expand::append_block (this=0x7fffffffd968, b=0x80242b440) at expand.cpp:585\n7  0x0000000800bc71b4 in Sass::Expand::operator() (this=0x7fffffffd968, c=0x80244f700) at expand.cpp:555\n8  0x0000000800bcc401 in Sass::Mixin_Call::perform (this=0x80244f700, op=0x7fffffffd968) at ./ast.hpp:737\n9  0x0000000800bc7986 in Sass::Expand::append_block (this=0x7fffffffd968, b=0x80242b2c0) at expand.cpp:585\n10 0x0000000800bbe778 in Sass::Expand::operator() (this=0x7fffffffd968, b=0x80242b2c0) at expand.cpp:77\n11 0x0000000800b7f51e in Sass::Block::perform (this=0x80242b2c0, op=0x7fffffffd968) at ./ast.hpp:323\n12 0x0000000800b44fb2 in Sass::Context::parse_file (this=0x80240f400) at context.cpp:345\n13 0x0000000800cefbc4 in sass_parse_block (compiler=0x8024060e0) at sass_context.cpp:505\n14 0x0000000800cefa01 in sass_compiler_parse (compiler=0x8024060e0) at sass_context.cpp:654\n15 0x0000000800cef543 in sass_compile_context (c_ctx=0x80240b100, cpp_opt=...) at sass_context.cpp:538\n16 0x0000000800cef889 in sass_compile_file_context (file_ctx=0x80240b100) at sass_context.cpp:641\n17 0x0000000000401def in compile_file (options=0x802408080, input_path=0x7fffffffeab9 \"/home/saper/sw/nodes-sass-problems/libsass/1415/test.scss\",\noutfile=0x0) at sassc.c:102\n\n18 0x00000000004024b0 in main (argc=, argv=) at sassc.c:274\n```\nOn frame #2 the value is NULL, that's why we get the exception\n. When the $parent variable is set (breakpoint expand.cpp:274) , the selector() method at eval.cpp#L1509 at returns NULL. So the \"selector stack\" seems to be wrong.\n. Looks to me like a bigger issue now - during the expansion phase we traverse the tree lexically, while variables should actually be expanded from the dynamic context. The context of the mixin call is not known (not set), since we process @mixin first and @include later.\n. The latter seems to be second half of the issue: the selector stack is empty, so we return NULL as a value and crash.\nThe first half exposed by the mixin case is that we have the selector stack is empty while it should not be (mixin call does not get its dynamic scope of selectors).\n. Sure, it is empty, because IT IS empty :) now I see it.\nA quick workaround (or even a fix?) in #1430\n. I see lots of other methods happily returning 0 as Expression *. Maybe this should be handled at the @if level, for example.\n. A dynamic test from https://github.com/sass/sass-spec/pull/463 shows this:\nfoo {\n    color: call(missing, $a: b);\n}\nOutput:\nfoo {\n  color: missing(b); }\n. (This should really belong to https://github.com/sass/node-sass )\nnode-sass tries to download the binary automatically for your platform - maybe this download fails sometimes?\nThere is a TROUBLESHOOTING.md guide in the node-sass repository - please try to follow the steps mentioned there and post the result\n. Interesting, why travis didn't pick this one?\n. yeah, unless we eliminate the use of those constants we probably\nshould rename all of them...\n. I have submitted https://github.com/sass/sassc/pull/129 to apply the same to sassc (which is used also when building libsass on win32)\n. My compiler now says:\nclang++ '-D_LARGEFILE_SOURCE' '-D_FILE_OFFSET_BITS=64' '-DLIBSASS_VERSION=\"3.2.5\"' '-DDEBUG' '-D_DEBUG' -I/home/saper/.node-gyp/3.0.0/src -I/home/saper/.node-gyp/3.0.0/deps/uv/include -I/home/saper/.node-gyp/3.0.0/deps/v8/include -I../src/libsass/include  -fPIC -pthread -Wall -Wextra -Wno-unused-parameter -m64 -g -O0 -fno-rtti -std=gnu++0x -std=c++0x -fexceptions -frtti -MMD -MF ./Debug/.deps/Debug/obj.target/libsass/src/libsass/src/ast.o.d.raw -g -c -o Debug/obj.target/libsass/src/libsass/src/ast.o ../src/libsass/src/ast.cpp\nIn file included from ../src/libsass/src/ast.cpp:1:\n../src/libsass/src/ast.hpp:1489:13: warning: 'const' type qualifier on return type has\n      no effect [-Wignored-qualifiers]\n    virtual const bool needs_parens(Supports_Condition* cond) { return false; }\n            ^~~~~~\n../src/libsass/src/ast.hpp:1507:13: warning: 'const' type qualifier on return type has\n      no effect [-Wignored-qualifiers]\n    virtual const bool needs_parens(Supports_Condition* cond);\n            ^~~~~~\n../src/libsass/src/ast.hpp:1521:13: warning: 'const' type qualifier on return type has\n      no effect [-Wignored-qualifiers]\n    virtual const bool needs_parens(Supports_Condition* cond);\n            ^~~~~~\n../src/libsass/src/ast.hpp:1536:13: warning: 'const' type qualifier on return type has\n      no effect [-Wignored-qualifiers]\n. We need this(?) in almost every instance of this marvel:\n``` cpp\n      string exp_src = exp->perform(&to_string) + \"{\";\n      / do something with / Parser::parse_selector(exp_src.c_str(), ctx);\n```\nand there are ARGSEL macros that might be helpful and the right place to do this...\n. We can  use -$(MKDIR) lib\n. > @toastal can you be more specific on where it failed? I was not able\n\nto produce this on a fresh checkout and make of libsass master.\n\nIt might be related to the fact that previous release didn't clean \"lib\" folder.\nSo it might happen only once after upgrade or something like that.\n. Can you check if https://github.com/sass/libsass/commit/77962e11da934451c80615275c7b622314cee73d or https://github.com/sass/libsass/commit/4aa12e96215ae9fbbab4178eca5f17d56ada111c work?\n. Thanks, I was afraid we have broken something yesterday.\n. appveyor :ok: \\o/\n. Thanks :) I can now compile libsass for Windows (32-bit) on my FreeBSD laptop. \n. Oh it seems that telling MSBuild which Microsoft Visual C++ version we are using is not so easy, so what about #if _MSC_VER < 1900 instead?\n. Need to check if 14.0 tools version breaks msbuild from 2013\n. @am11 what do you think about this :) tested only with my VC2013 https://github.com/am11/libsass/pull/1 Can you see if it works with VC2015 (should skip compiling c99func.c completely).\n. > @mgreter, it was updating for all consecutive builds (with/without cleanup), so I have added the rule in .gitignore via e0e23e0.\nOne idea: can we easily move them in \"bin/{Debug|Release}\" folder? I thin that's where they really belong.\nThis way the source directory can stay read-only all the time (we need this for UNIX as well btw.)\n. We can get rid of those files btw .:) patch pending.\n. Here it is https://github.com/am11/libsass/pull/2!\nMSBuild 12.0 required, but no temporary files! Tested with VS2013\n. One idea: why not use one variable (SASS_LIBSASS_PATH - the same one as Travis CI is using) and just use directories relative to that src and include?\n. Shouldn't we maybe split VC2015 integration (which is done and works) and sassc/libsass divorce into a separate PR?\n. > Frankly if this is working as expected I'm happy to get it shipped.\n\n@am11 has put in a lot of great work here and a split although nice,\nis nitpick a this point IMHO.\n\nI agree - if we get it working, that it may be combined. Of course.\n. Probably broken with 3af051e6583a2d94cfdb6a51cb2f8dee3ebf0c22\n. This problem is because you have an older C++ compiler. What are you using?\nYou can try this patch #995 (this is for older libsass though, needs to be merged) - let me know if it helps.\nThis patch works only with the autoconf build of libsass - so you need to use ./configure and build libsass manually first, and then tell node-sass to use it using as described in https://github.com/sass/node-sass/pull/876#issuecomment-94730030\nIf this is worth the trouble for you I can update #995 to the current libsass.\n. Maybe depends on the network - whether binary module download succeeds or not. Maybe it depends on the deployment box (different environments - why not:) One will never know without full logs.\n. Using free() in the normal case causes destructors not to be called. This is not good, given especially given we want to free memory as we go and not only when shutting down. I'd suggest determining object ownership and doing something like #1386 in the mid-term, unless there is a better idea. \n. Oh noes, but this patch makes the memory manager to always use free() ! Not only on some crazy constructor failure.... Constructors here are pretty simple and don't mostly fail.\n. On Mon, 17 Aug 2015, Adeel Mujahid wrote:\n\n\nNot only on some crazy constructor failure\n\n@saper, have you tested it before commenting?\n\nNo? Should I check if destructors get called?\n. Do you know why exactly VS aborted? Did it create the object with \"new\" before the parameters were evaluated?\n. On Mon, 17 Aug 2015, Michael Mifsud wrote:\n\n\nFrom @am11 research this isn't isolated to VS \nhttps://github.com/sass/libsass/issues/1443#issuecomment-131463458\n\n\nOk, I wasn't able to reproduce it on clang, only with VS.\n. Let me go back to 8127946d3f8a7c140ba705afaf0673d75a3f7186 and try.\nFrom what I see this destroy() method gets never called normally.\n. No, in most cases (this begins to change right now) we just don't free memory explicitly. Let me try to reproduce the bug, because just because we almost never delete our objects manually it does not mean we should do it this way.\n. I think that placement new() is one of the most confusing things in C++ and I wish it would go away one day.\n. @am11 thanks for this, lgtm. So file.cpp is the only one that needs it?\n. > > So file.cpp is the only one that needs it?\n\nYes; <windows> header is required in file.cpp for path resolution etc.\n\nPlease excuse my overzeal then :)\n. > > So file.cpp is the only one that needs it?\n\nYes; <windows> header is required in file.cpp for path resolution etc.\n\nPlease excuse my overzeal then :)\n. @am11 Just filed https://github.com/sass/libsass/issues/1518 to deal with -DDEBUG\n. Will need to undig #995 .. :(\n. furthermore, even gcc 4.9 on Solaris 2.9 does not recognize standard round() properly. Will investigate.\n. So, the reason is pretty simple - older versions of Solaris don't provide round() function at all.\n. There are two related issues: one is that gcc libraries blindly assume glibc-like support for C and round is not put in the std:: namespace but is available via <math.h> as in C. On older systems there is no round at all. It could be solved with autoconf to detect the proper function, but we also need a non-autoconf solution. I think about adding round() to something like c99func.c\n. The problem with older Solaris is that there is no round() function at all.\n. /bin/bash ../libtool  --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I. -I/home/admini/saper/src/libsass/src  -I/home/admini/saper/src/libsass/include  -Wall -O2  -std=c++0x -g -O2 -MT util.lo -MD -MP -MF .deps/util.Tpo -c -o util.lo /home/admini/saper/src/libsass/src/util.cpp\nlibtool: compile: g++ -DHAVE_CONFIG_H -I. -I/home/admini/saper/src/libsass/src -I/home/admini/saper/src/libsass/include -Wall -O2 -std=c++0x -g -O2 -MT util.lo -MD -MP -MF .deps/util.Tpo -c /home/admini/saper/src/libsass/src/util.cpp -fPIC -DPIC -o .libs/util.o\n/home/admini/saper/src/libsass/src/util.cpp: In function \u2018double Sass::round(double, std::size_t)\u2019:\n/home/admini/saper/src/libsass/src/util.cpp:28:12: error: \u2018::round\u2019 has not been declared\n     return ::round(val);\n            ^\n/home/admini/saper/src/libsass/src/util.cpp:28:12: note: suggested alternative:\n/home/admini/saper/src/libsass/src/util.cpp:20:10: note:   \u2018Sass::round\u2019\n   double round(double val, size_t precision)\n          ^\n/home/admini/saper/src/libsass/src/util.cpp:29:3: warning: control reaches end of non-void function [-Wreturn-type]\n   }\n   ^\nGNUmakefile:618: recipe for target 'util.lo' failed\nmake[2]: *** [util.lo] Error 1\n. I just came to conclusion we should rename all constants and enums either a prefix...\n. If we modify the way the allocator is invoked, why not ditch the placement new altogether and just add objects to the MemoryManager via the macro?\nAnother improvement idea (the next step?) would be to use some kind of smart pointers there...\n. Of course new has to stay. Let's ditch (mgr.allocate(...)) only.\nIf you plan to do reference counting, why not use smart pointers instead (shared_ptr is refcounted afaik). Besides, it would be easier to introduce step-by-step child object ownership (something along the lines of #1386).\n. > We may want to use an actual custom allocator at a later stage, so\n\nkeeping it that way we only need to change the actual implementation\nlater. This PR fixes the problem at hand, so I'm happy with the\ncurrent state. We can discuss shared_ptr and what not when we actually\nthink about using them.\n\nSorry,\n\"We may want to use (...) at a later stage\" is not fixing the problem at hand.\n. > It fixes the issues seen with MSVC without changing anything\n\nelse. This is what I see shrug. \nIt handles the memory correctly,\nwithout leaking if an error occurs after initial memory allocation,\nbefore object is really constructed. It releases it via delete\ncorrectly afterwards.\n\nI have a question:\nI'd like to implement object ownership for those AST_Node's which\nare tighly bound. For example, Definition instances should\nown its Parameter instances.\nI believe this should be done by implementing destructors\nwhich delete subordinate objects.\nShould I take those subordinate objects out of control of the\nmemory manager or is there a chance that memory manager\ncan have weak pointers and figure out itself, that the subordinate\nobject got purged?\n. On Sun, 23 Aug 2015, Marcel Greter wrote:\n\nIt fixes the issues seen with MSVC without changing anything\nelse. This is what I see shrug. It handles the memory correctly,\nwithout leaking if an error occurs after initial memory allocation,\nbefore object is really constructed. It releases it via delete\ncorrectly afterwards.\n\nIt changes the invocation. It adds more spaghetti code (sorry).\nWhy not just use something like this sketch:\n```\ndefine SASS_MEMORY_NEW(mgr, Class, ...)                         \\\nmgr.add(new Class(VA_ARGS))\n```\nwhere mgr.add() does only:\nnodes.push_back(parameter);\nDo we really need more? I think playing with our own overallocated\nmemory \"just in case\" is going in the wrong direction. It's already\nway too complicated.\n. > We will use custom allocators in the future! Having it there already\n\nmeans that the basics are already tested. Once we add micro memory\nmanagement we can do various experiments to figure out what kind of\nallocator fits bests. A very easy optimization will be to keep a\ncertain amount of memory container around for re-use. So I don't see\nthe point to remove it now just to add it back later. I don't think it\nadds much overhead (if any at all).\n\nYou will certainly disagree, but I think that playing with\nan optimized memory allocator in a situation where even basic\nmemory management is non-existing is a premature optimization.\nPlus I don't see the reason of keeping 80+ lines doing nothing.\nCurrent code is obsure enough!\nEOT from my side.\n. Well, the whole point of the c99func.c is not to compile that file when not needed... you can leave ifdefs if you Iike but I'd leave msbuild conditional rules in place.\n. That is why I think we can keep MSBuild rule and leave conditionals inside. I will deal with libsass.gyp once our gyp fully supports vs2015.\nI want to make sure we don't get any linker errors when not linking c99func.obj\n. Here it goes: https://github.com/saper/node-sass/commit/edf71270750fa6d6538359409edd935f8c4beb35 - can you check that with VS2015 if c99func.c gets excluded from the build? This is https://github.com/sass/node-sass/pull/1040\n. Should be. Merging now changes into node-sass and then I can see it very clearly with our gyp setup.\n. (related: https://github.com/sass/libsass/issues/1160)\n. Good idea to move those functions - actually they both are supposed to do the same, just copy_strings diverged quickly.\nI have proposed my take in https://github.com/sass/libsass/commit/e9bffb2bfc5d46a0049cb25d8dc0f159e451d546 (part of https://github.com/sass/libsass/pull/1521 now).\n. To test an API you do integration tests. Unit testing requires decomposition of the code internally to test particular pieces. There are some stub tests in https://github.com/sass/libsass/tree/202a4ea098c6f99ed70344135dbe3d4720e0c681/test which afaik are not connected to the CI. Getting them to work would be a good first step.\n. @mgreter Would that be possible to be able to paste the suspected \"incorrect\" source map into the inspector third window and browse that? I can paste a different map but when I click \"Inspect\" it switches to the generated map automatically.\nAnother wish item from me would be to save some horizontal screen space - I think the leftmost column can go away complete - I tried to have two browser windows side-by-side with two times source map tool to compare the \"bad\" map and the \"good\" map. Would be cool to save space a bit :)\n. What does [analyze] do?\n. @am11 https://github.com/saper/node-sass/commit/5aafff7e7457860a8077911f75d87a83d6bdc4a8 includes the patched test, so now node-sass tests should pass. You only need to manually update libsass to https://github.com/sass/libsass/commit/bd8b50ae1d87f68254d4abd22a6e03fa295437a7 and then you can try https://github.com/sass/node-sass/pull/1040\n. Thanks @mgreter will try that one!\n. > Interesting that I don't see this is clang. We must have different versions.\nnode-gyp sets C++ compiler \nflags to \"-Wall -Wextra -Wno-unused-parameter\"\n(at least with my debugging io.js 3.0 configuration), \nso if you override CXXFLAGS when building libsass you\nshould get them as well.\n. Solved in a private branch, will push in the morning CEST\n. On Fri, 6 Nov 2015, Marcel Greter wrote:\n\nIs there a \"definition of done\" for this Bug? I didn't see this warning so far myself? Maybe you could give some more information of used compiler and environment?\n\nthis was clang 3.7 as the title says... definition of done: potential issue reported by the warning is resolved.\n. On Fri, 6 Nov 2015, Marcel Greter wrote:\n\nWe don't see this on the Travis [Mac OSX CI build] [1] and I don't have access or connection to any Mac, so someone else needs to step in here to analyze this further ...\n\nyou need clang at least 3.7 on any platform to see this. It's related to rtti and\nis probably mit platform-dependent.\n. I can't say I fully understand what shall Complex_Selector::parentize()  return - I sense this method should fail in some cases right away.\nThis change just covers up the problem, probably.\n. Superseded by #1527 \n. Yes, thank you!\n. Yes, worked for me too. Calling this function also works properly.\n. Maybe we should use libsass directory, as this is related to this implementation and not to some genetic Sass C API which does not exist ATM.\n. Thanks! Seems to work now.\n. The bug you have mentioned is about C90 initializer struct x = { 0, }. It's different with C++ as explained in the comments.\n. And how does Lookahead rv { } work for you? (C++11 syntax without =)\n. So we need to go with #1542 then, right.\n. Fixed via #1542\n. Mentioning https://github.com/sass/libsass/issues/1143 for reference (not sure if it fixes the problems discussed there).\n. While not identical, here is what I got from libsass git master (681b5113fa74f2cc6117f142d9bdd56dfac494da):\n@media (max-width: 600px) {\n  .primary-menu__dropdown-toggle {\n    float: right;\n    display: block; } }\nSo this will be fixed in the next release.\n. Nice enhancement :) Closures, anyone?\n. Let's open an enhancement proposal :)\n. Too much redundancy, will be very error-prone. What about parsing the signature during construction and storing the parsed arguments in Signature?\n. The problem is this commit is adding 900 lines of redundant code, which previously fit in 100.\n. I don't think that replacing ruby with C for the sake of replacing ruby is a most important goal in itself; however with a good C/C++ testing framework one could actually start tearing apart libsass code internally and test various pieces in isolation (probably very difficult at this). Any ideas how to approach this? To have more white-box testing of the C++ code? Is Criterion suitable for this?\n. Looks like a problem with floating point representation...\n. Did you try ruby on Windows as well?\n. @gabriellecrawford which version of libsass are you using?\n. > hi, yes ruby sass gives the value that ends with c7 on both windows and linux\n\nlet me look into the version question, we're using grunt-sass which uses node-sass?\nMy coworker said he tried running with the node-sass 3.3.3 and the problem still exists...\n\nGood to know you are using node-sass for that, thanks.\nCan you try running \"node-sass\" script - it should be in the node_modules/node-sass/bin\nand check version with \"node-sass -v\".\n. I just got \ncss\nh1 {\n  border-color: #ffcdc7; }\nwith \nnode-sass   3.3.2   (Wrapper)   [JavaScript]\nlibsass     3.2.5   (Sass Compiler) [C/C++]\non both FreeBSD 11 running amd64 and\nnode-sass       3.4.0-beta1     (Wrapper)       [JavaScript]\nlibsass         3.3.0.b2+FreeBSD.       (Sass Compiler) [C/C++]\nrunning on FreeBSD 10.1 (also amd64)\n. > so we're using grunt 1.0.0 which I think uses node-sass 3.0.0 which uses libsass 3.2.0?\nCheck with node-sass -v\nor just run node and then\nvar s = require('node-sass')\nconsole.log(s.info)\n. I am getting #ffcdc8 using ruby sass (git master https://github.com/sass/sass/commit/b409aad5fb34f363cec426f2102dd7005e1a45a6) on the same machine I got #ffcdc7. Good to reproduce :)\n. Interestingly, on some random 64-bit Linux machine I tried:\n```\n$ ./sass/bin/sass t.scss \nh1 {\n  border-color: #ffcdc8; }\n$ ./node-sass/bin/node-sass t.scss \nh1 {\n  border-color: #ffcdc7; }\n```\n(This is node-sass 3.4.0-beta1 with libsass 3.3.0-beta2)\n. It is impossible to write a test for this; if we are (and it is so specified) using floating point arithmetic - I'd need to check values against \u025b. I think in this case some fixed-point integer-like arithmetic should suffice, but that's on our reference implementation to settle on something.\n. Yes it is 8 spaces per stack frame and one space coming from somewhere. You can easily see this with sass/sass-spec#494\n. Good point. New version of my error testing suite takes only god first line for comparison, so let's ditch this for now.\n. Can you check which directory are you in? If you have checked out git repository and didn't cd into it, the make -C libsass command works. -C just means \"change into that directory\". So, if you are inside of the libsass directory, just do make -j5\nIf you have more issues, please post a complete log with the git clone and the sequence of commands you are trying.\n. > Yeah I cd'd into libsass first, which explains the No such file of directory. If I run make -j5, all that's produced is lib/libsass.a.\nThis is ok. A static library has been produced correctly.\nYou can add BUILD=shared parameter if you would like to have libsass.so generated.\nIt's easy to end up in the chicken-and-egg scenario - libsass needs sassc\nfor testing, sassc needs libsass to build. That's why your \"make -C sassc\"\nbuild starts building... libsass.\nWhat you should do is to build libsass first (I think this succeeded on your side)\nand then build sassc again.\n. This is what  Ruby Sass is doing:\nError: Invalid CSS after \"...-width: 100px) \": expected media query list, was \"{\"\n        on line 1 of test\n  Use --trace for backtrace.\nso this is intentional. (Or a bug report should be filed in https://github.com/sass/sass)\n. Sorry, but the example you have originally given was incomplete. Now it is obvious, what's wrong. Thanks.\n. Ok, got test ready for the test suite.\n. There is a test in spec/libsass-todo-issues/issue_1266 already.\n. Once this is merged (or a similar fix) https://github.com/sass/sass-spec/pull/523 can be pulled in to sass-spec\n. Test written https://github.com/sass/sass-spec/pull/510\n. Here's what I got with the brand new libsass:\n```\nm> ~/sw/sassc/bin/sassc -v\nsassc: 3.3.0-beta1\nlibsass: 3.3.0-beta2-1-g1efd\nsass2scss: 1.0.3\nm> ~/sw/sassc/bin/sassc spec/libsass-todo-issues/issue_1569/input.scss\nError: Base-level rules cannot contain the parent-selector-referencing character '&'.\n   Backtrace:\n            spec/libsass-todo-issues/issue_1569/input.scss:2\n    on line 2 of spec/libsass-todo-issues/issue_1569/input.scss\n\n\n\n.nihilo & {\n   --------^\n\n\n```\n. Crash backtrace for the complex case:\n```\nProgram received signal SIGSEGV, Segmentation fault.\n0x000000000047af9d in Sass::Complex_Selector::skip_empty_reference (this=0x801c502e0) at src/ast.hpp:2128\n2128            tail_->has_line_feed_ = this->has_line_feed_;\n(gdb) bt\n0  0x000000000047af9d in Sass::Complex_Selector::skip_empty_reference (this=0x801c502e0) at src/ast.hpp:2128\n1  0x0000000000463433 in Sass::Complex_Selector::parentize (this=0x801c36020, parents=0x0, ctx=...) at src/ast.cpp:955\n2  0x00000000004626bd in Sass::Complex_Selector::parentize (this=0x801c34f60, parents=0x0, ctx=...) at src/ast.cpp:890\n3  0x0000000000528a8c in Sass::Eval::operator() (this=0x7fffffffde20, s=0x801c34f60) at src/eval.cpp:1426\n4  0x0000000000528624 in Sass::Eval::operator() (this=0x7fffffffde20, s=0x801c31200) at src/eval.cpp:1399\n5  0x0000000000481ae1 in Sass::Selector_List::perform (this=0x801c31200, op=0x7fffffffde20) at src/ast.hpp:2275\n6  0x000000000053f511 in Sass::Expand::operator() (this=0x7fffffffde10, r=0x801c34ec0) at src/expand.cpp:117\n7  0x000000000047cc1e in Sass::Ruleset::perform (this=0x801c34ec0, op=0x7fffffffde10) at src/ast.hpp:413\n8  0x00000000005495c6 in Sass::Expand::append_block (this=0x7fffffffde10, b=0x801c31140) at src/expand.cpp:644\n9  0x0000000000548d69 in Sass::Expand::operator() (this=0x7fffffffde10, c=0x801c4c540) at src/expand.cpp:613\n10 0x000000000054f161 in Sass::Mixin_Call::perform (this=0x801c4c540, op=0x7fffffffde10) at src/ast.hpp:779\n11 0x00000000005494a5 in Sass::Expand::operator() (this=0x7fffffffde10, c=0x801c1c980) at src/expand.cpp:628\n12 0x000000000065b651 in Sass::Content::perform (this=0x801c1c980, op=0x7fffffffde10) at src/ast.hpp:789\n13 0x00000000005495c6 in Sass::Expand::append_block (this=0x7fffffffde10, b=0x801c30e40) at src/expand.cpp:644\n14 0x000000000053e58d in Sass::Expand::operator() (this=0x7fffffffde10, b=0x801c30e40) at src/expand.cpp:78\n15 0x00000000004faf8e in Sass::Block::perform (this=0x801c30e40, op=0x7fffffffde10) at src/ast.hpp:378\n16 0x00000000005409fd in Sass::Expand::operator() (this=0x7fffffffde10, m=0x801c347e0) at src/expand.cpp:182\n17 0x000000000047cebe in Sass::Media_Block::perform (this=0x801c347e0, op=0x7fffffffde10) at src/ast.hpp:457\n18 0x00000000005495c6 in Sass::Expand::append_block (this=0x7fffffffde10, b=0x801c30b40) at src/expand.cpp:644\n19 0x00000000005429b1 in Sass::Expand::operator() (this=0x7fffffffde10, i=0x801c34a60) at src/expand.cpp:352\n20 0x000000000065b471 in Sass::If::perform (this=0x801c34a60, op=0x7fffffffde10) at src/ast.hpp:624\n21 0x00000000005495c6 in Sass::Expand::append_block (this=0x7fffffffde10, b=0x801c30900) at src/expand.cpp:644\n22 0x0000000000544b13 in Sass::Expand::operator() (this=0x7fffffffde10, e=0x801c30f00) at src/expand.cpp:457\n23 0x000000000065b081 in Sass::Each::perform (this=0x801c30f00, op=0x7fffffffde10) at src/ast.hpp:654\n24 0x00000000005495c6 in Sass::Expand::append_block (this=0x7fffffffde10, b=0x801c30780) at src/expand.cpp:644\n25 0x0000000000548d69 in Sass::Expand::operator() (this=0x7fffffffde10, c=0x801c31080) at src/expand.cpp:613\n26 0x000000000054f161 in Sass::Mixin_Call::perform (this=0x801c31080, op=0x7fffffffde10) at src/ast.hpp:779\n27 0x00000000005495c6 in Sass::Expand::append_block (this=0x7fffffffde10, b=0x801c30fc0) at src/expand.cpp:644\n28 0x00000000005453c0 in Sass::Expand::operator() (this=0x7fffffffde10, e=0x801c31740) at src/expand.cpp:489\n29 0x000000000065b081 in Sass::Each::perform (this=0x801c31740, op=0x7fffffffde10) at src/ast.hpp:654\n30 0x00000000005495c6 in Sass::Expand::append_block (this=0x7fffffffde10, b=0x801c30180) at src/expand.cpp:644\n31 0x000000000053e58d in Sass::Expand::operator() (this=0x7fffffffde10, b=0x801c30180) at src/expand.cpp:78\n32 0x00000000004faf8e in Sass::Block::perform (this=0x801c30180, op=0x7fffffffde10) at src/ast.hpp:378\n33 0x00000000004c44d4 in Sass::Context::parse_file (this=0x801c23280) at src/context.cpp:352\n34 0x00000000004226c0 in sass_parse_block (compiler=0x801c060e0) at src/sass_context.cpp:481\n35 0x0000000000422501 in sass_compiler_parse (compiler=0x801c060e0) at src/sass_context.cpp:637\n36 0x0000000000421fc5 in sass_compile_context (c_ctx=0x801c1f100, cpp_opt=...) at src/sass_context.cpp:519\n37 0x0000000000422389 in sass_compile_file_context (file_ctx=0x801c1f100) at src/sass_context.cpp:624\n38 0x0000000000419f3f in compile_file (options=0x801c1c080, input_path=0x7fffffffeacf \"spec/libsass-todo-tests/parent-selector/missing/input.scss\",\noutfile=0x0) at sassc.c:107\n\n``\n. Testcase added with https://github.com/sass/sass-spec/issues/512\n.  I can't reproduce the problem, can you post an example how are you invoking this function?\n. Can you install node-sass and just try to produce a small case to reproduce this? Just a single .scss file with your function and its invocation.\n. Thanks. I can confirm this is an issue with libsass 3.2.5 (current release bundled with node-sass 3.3.3) but it got fixed in libsass 3.3.0-beta2, which you can try by installingnpm install node-sass@beta.\n. Simple test written https://github.com/sass/sass-spec/pull/536\n. @peterwilsoncc I think that \"&\" in libsass does not expose the parent selector, it just compares strings. Can you confirm this is your case as well? See [the test case](https://github.com/saper/sass-spec/blob/95053d9b3ed77304e0a071f1b624e7a6c27a3575/spec/libsass-todo-issues/issue_1590/quoted-ampersand-does-not-select/input.scss) and [the expected output from Ruby Sass](https://github.com/saper/sass-spec/blob/95053d9b3ed77304e0a071f1b624e7a6c27a3575/spec/libsass-todo-issues/issue_1590/quoted-ampersand-does-not-select/expected_output.css) taken from https://github.com/saper/sass-spec/commit/95053d9b3ed77304e0a071f1b624e7a6c27a3575\n. Wouldn'tsizeof(union Sass_Value *)work as well?\n. will test on the old Solaris, too.\n. I frankly doubt one can get stable results there when working with floating point\n. One cannot check for floating point results by comparing numbers for equality, it should be| actual_value - expected_value | < \u03b5, where \u03b5 is a very small floating point number...\n. The integer color values come from floating point calculations, don't they?\n. double is floating point too (exponent + mantissa)\n. double has more precision, but that does not help really when converting to integers.\n. I have #995 and #996 to for this with autoconf. 4.4 has no issues with variadic templates?\n. I also like the shortfor` loops, but I think we should unroll them to avoid issues like somebody adding or changing some loop to the form that cannot be automatically unrolled with a script (like the ones patched above).\n. I guess this might be #1709 and/or #1729 \n. It looks like\n```\n@mixin parent {\n  @content;\n}\n@include parent() {\n  body.immobile & {\n    margin-bottom: 0;\n  }\n}\n```\nis enough to reproduce that.\n. Replacing nullptr with 0 is simply incorrect, it should be NULL. I have updated #996 to fix this.\nAlso please be more verbose in the commit messages, saying Add some code improvements is not good!\n. Ah, #996 got closed. It is now #1660.\n. > I didn't realise this root issue was specific to just src/util.cpp. We use 0 in place of NULL a lot.\nThis is not good. Right now it is probably hard to identify those places.\n. > I believe that is why @mgreter wanted to leave it as is. My understanding of NULL in C++ is that it's functionally equivalent to 0 (at least in out use case)\n\n\nIn C++, the definition of NULL is 0, so there is only an aesthetic difference. I prefer to avoid macros, so I use 0. Another problem with NULL is that people sometimes mistakenly believe that it is different from 0 and/or not an integer. In pre-standard code, NULL was/is sometimes defined to something unsuitable and therefore had/has to be avoided. That's less common these days.\nIf you have to name the null pointer, call it nullptr; that's what it's called in C++11. Then, nullptr will be a keyword.\nSource\n\n\nOk, so this is not \"wrong\" just \"I don't like it\".\nEven in the examples http://www.cplusplus.com/reference/cstdlib/strtoul/ says NULL.\nThe reason is simple:\nstroul(buffer, 0, 16); looks like 0 was just an ordinary number (offset into the buffer, maybe?)\nAnd of course then C++11 needed to create nullptr to solve problems it created .... :)\nAnd later they figured out they need nullptr_t, too!\n. Just a remark: I think render is a bit too generic for a good name, one could imagine having two steps: one to compile the code into some intermediate form and another one \"executing\", \"performing\" or \"running\" it.\n. Fixed by #1668 ?\n. I think I have pushed somewhere into \"maps\" tests but It is not there...\n. I have tested this against 3.3.2 and I see two issues:\nOne is that '\\@baz' is accepted by libsass as valid (1.1, 2.1, 3.1)\nAnother is that 1.2 generates empty output on libsass, I have filed #1734 for that.\n. ( Partially related to sass/libsass#1684, sass/libsass#1734 )\n. Is precision a user-defined option in ruby sass as well?\n. Ruby gives a warning:\nDEPRECATION WARNING on line 1 of libsass-todo-issues/issue_1706/input.scss:\nNaming a function \"calc\" is disallowed and will be an error in future versions of Sass.\nThis name conflicts with an existing CSS function with special parse rules.\nDEPRECATION WARNING on line 2 of libsass-todo-issues/issue_1706/input.scss:\nNaming a function \"-foo-calc\" is disallowed and will be an error in future versions of Sass.\nThis name conflicts with an existing CSS function with special parse rules.\n. Looks related to https://github.com/sass/libsass/issues/1729, maybe\n. Got fixed in the meantime: libsass 3.3.2 produces correct output.\n. Ruby Sass gives an error message when running from the command-line:\nError: Invalid CSS after \"\"\\0screen\"\": expected expression (e.g. 1px, bold), was \";\"\nBut it procesess the file, if specified.\nLibsass always processes the file and produces the correct output:\n@charset \"UTF-8\";\n@media \ufffdscreen {\n  .vjs-default-skin.vjs-user-inactive.vjs-playing .vjs-control-bar :before {\n    content: \"\"; } }\nThe funny character before \"screen\" is Unicode U+FFFD which indicates \"Invalid Unicode character\".\nZero cannot be used since it indicates end of string.\n. On Fri, 13 Nov 2015, Michael Mifsud wrote:\n\nComparing Ruby Sass with the latest LibSass\n@charset \"UTF-8\";\n@media ???screen {\n  .vjs-default-skin.vjs-user-inactive.vjs-playing .vjs-control-bar :before {\n    content: \"\"; } }\nLibSass 3.3.3\n@charset \"UTF-8\";\n@media ???screen {\n  .vjs-default-skin.vjs-user-inactive.vjs-playing .vjs-control-bar :before {\n    content: \"\"; } }\n\nThere is a difference when feeding Ruby from stdin (not from file) - it complains\nloudly.\n. If this change does not break VS2015, we should go for it I think.\n. This issue seems to be fixed with 3.3.2, only error message is slightly different. \n. Filed #1730 for the error message.\n.  Those errors were reported in https://github.com/ezekg/flint/issues/38 and https://github.com/ezekg/flint/issues/40\nWith libsass 3.3.2 however, I am getting sassc being stuck in a seemingly infinite loop.\nTo reproduce:\n- Clone git://github.com/ezekg/flint.git into /tmp/flint\n- Create input.scss:\n```\n@import \"_flint\";\n.foo{\n    @include _(3 4 6 12);\n}\n``\n- Runsassc -I /tmp/flint/stylesheets input.scss`\nIt hangs forever until the memory available to the process is exhausted.\nWould be great to have a smaller test case./\n. My wild guess this maybe something with passing parameters - optional/rest parameter handling.\n. A backtrace while still running:\n```\n~To_String (this=0x7ffffffe5de8) at src/to_string.cpp:15\n15    To_String::~To_String() { }\n(gdb) bt\n0  ~To_String (this=0x7ffffffe5de8) at src/to_string.cpp:15\n1  0x0000000000538837 in Sass::Eval::operator() (this=0x7fffffff20a0, v=0x801d20c80) at src/eval.cpp:827\n2  0x00000000006733a1 in Sass::Variable::perform (this=0x801d20c80, op=0x7fffffff20a0) at ast.hpp:1160\n3  0x0000000000541e85 in Sass::Eval::operator() (this=0x7fffffff20a0, a=0x801d27a60) at src/eval.cpp:1161\n4  0x00000000004f84a1 in Sass::Argument::perform (this=0x801d27a60, op=0x7fffffff20a0) at ast.hpp:1046\n5  0x0000000000542344 in Sass::Eval::operator() (this=0x7fffffff20a0, a=0x801d279c0) at src/eval.cpp:1194\n6  0x00000000004837e1 in Sass::Arguments::perform (this=0x801d279c0, op=0x7fffffff20a0) at ast.hpp:1068\n7  0x000000000053177d in Sass::Eval::operator() (this=0x7fffffff20a0, c=0x801d27ba0) at src/eval.cpp:665\n8  0x00000000004f7401 in Sass::Function_Call::perform (this=0x801d27ba0, op=0x7fffffff20a0) at ast.hpp:1115\n9  0x000000000051f5c3 in Sass::Eval::operator() (this=0x7fffffff20a0, a=0x801d248c0) at src/eval.cpp:135\n10 0x000000000067487e in Sass::Assignment::perform (this=0x801d248c0, op=0x7fffffff20a0) at ast.hpp:533\n11 0x000000000051ec9e in Sass::Eval::operator() (this=0x7fffffff20a0, b=0x801d24800) at src/eval.cpp:73\n12 0x000000000050f51e in Sass::Block::perform (this=0x801d24800, op=0x7fffffff20a0) at ast.hpp:380\n13 0x00000000005227ac in Sass::Eval::operator() (this=0x7fffffff20a0, w=0x801d27920) at src/eval.cpp:304\n14 0x0000000000672751 in Sass::While::perform (this=0x801d27920, op=0x7fffffff20a0) at ast.hpp:678\n15 0x000000000051ec9e in Sass::Eval::operator() (this=0x7fffffff20a0, b=0x801d24680) at src/eval.cpp:73\n16 0x000000000050f51e in Sass::Block::perform (this=0x801d24680, op=0x7fffffff20a0) at ast.hpp:380\n17 0x000000000053381e in Sass::Eval::operator() (this=0x7fffffff20a0, c=0x801d2aca0) at src/eval.cpp:715\n18 0x00000000004f7401 in Sass::Function_Call::perform (this=0x801d2aca0, op=0x7fffffff20a0) at ast.hpp:1115\n19 0x000000000052282c in Sass::Eval::operator() (this=0x7fffffff20a0, r=0x801d2a980) at src/eval.cpp:312\n20 0x00000000006721b1 in Sass::Return::perform (this=0x801d2a980, op=0x7fffffff20a0) at ast.hpp:690\n21 0x000000000051ec9e in Sass::Eval::operator() (this=0x7fffffff20a0, b=0x801d24ec0) at src/eval.cpp:73\n22 0x000000000050f51e in Sass::Block::perform (this=0x801d24ec0, op=0x7fffffff20a0) at ast.hpp:380\n23 0x000000000053381e in Sass::Eval::operator() (this=0x7fffffff20a0, c=0x801cb02a0) at src/eval.cpp:715\n24 0x00000000004f7401 in Sass::Function_Call::perform (this=0x801cb02a0, op=0x7fffffff20a0) at ast.hpp:1115\n25 0x000000000051f5c3 in Sass::Eval::operator() (this=0x7fffffff20a0, a=0x801cad780) at src/eval.cpp:135\n26 0x000000000067487e in Sass::Assignment::perform (this=0x801cad780, op=0x7fffffff20a0) at ast.hpp:533\n27 0x000000000051ec9e in Sass::Eval::operator() (this=0x7fffffff20a0, b=0x801cad6c0) at src/eval.cpp:73\n28 0x000000000050f51e in Sass::Block::perform (this=0x801cad6c0, op=0x7fffffff20a0) at ast.hpp:380\n29 0x000000000051f9d3 in Sass::Eval::operator() (this=0x7fffffff20a0, i=0x801cb0340) at src/eval.cpp:150\n30 0x0000000000672d51 in Sass::If::perform (this=0x801cb0340, op=0x7fffffff20a0) at ast.hpp:636\n31 0x000000000051ec9e in Sass::Eval::operator() (this=0x7fffffff20a0, b=0x801cf9ac0) at src/eval.cpp:73\n32 0x000000000050f51e in Sass::Block::perform (this=0x801cf9ac0, op=0x7fffffff20a0) at ast.hpp:380\n33 0x0000000000521117 in Sass::Eval::operator() (this=0x7fffffff20a0, f=0x801cad840) at src/eval.cpp:204\n34 0x0000000000672b71 in Sass::For::perform (this=0x801cad840, op=0x7fffffff20a0) at ast.hpp:653\n35 0x000000000051ec9e in Sass::Eval::operator() (this=0x7fffffff20a0, b=0x801cf9880) at src/eval.cpp:73\n36 0x000000000050f51e in Sass::Block::perform (this=0x801cf9880, op=0x7fffffff20a0) at ast.hpp:380\n37 0x000000000051f9d3 in Sass::Eval::operator() (this=0x7fffffff20a0, i=0x801cb0480) at src/eval.cpp:150\n38 0x0000000000672d51 in Sass::If::perform (this=0x801cb0480, op=0x7fffffff20a0) at ast.hpp:636\n39 0x000000000051ec9e in Sass::Eval::operator() (this=0x7fffffff20a0, b=0x801cf8080) at src/eval.cpp:73\n40 0x000000000050f51e in Sass::Block::perform (this=0x801cf8080, op=0x7fffffff20a0) at ast.hpp:380\n41 0x000000000053381e in Sass::Eval::operator() (this=0x7fffffff20a0, c=0x801cfba60) at src/eval.cpp:715\n42 0x00000000004f7401 in Sass::Function_Call::perform (this=0x801cfba60, op=0x7fffffff20a0) at ast.hpp:1115\n43 0x000000000052582f in Sass::Eval::operator() (this=0x7fffffff20a0, b=0x801cfbb00) at src/eval.cpp:466\n44 0x0000000000674311 in Sass::Binary_Expression::perform (this=0x801cfbb00, op=0x7fffffff20a0) at ast.hpp:953\n45 0x00000000005fdd47 in Sass::Functions::sass_if (env=@0x7fffffff2fa8, d_env=@0x7fffffff6b48, ctx=@0x801c23280,\nsig=0x6b4d97 \"if($condition, $if-true, $if-false)\", pstate=<value optimized out>, backtrace=0x7fffffff2f00)\nat src/functions.cpp:1641\n\n46 0x00000000005339e0 in Sass::Eval::operator() (this=0x7fffffffdb58, c=0x801d0d020) at src/eval.cpp:717\n47 0x00000000004f7401 in Sass::Function_Call::perform (this=0x801d0d020, op=0x7fffffffdb58) at ast.hpp:1115\n48 0x0000000000524d51 in Sass::Eval::operator() (this=0x7fffffffdb58, m=0x801cf7c00) at src/eval.cpp:445\n49 0x00000000004831d1 in Sass::Map::perform (this=0x801cf7c00, op=0x7fffffffdb58) at ast.hpp:884\n50 0x0000000000524d51 in Sass::Eval::operator() (this=0x7fffffffdb58, m=0x801cf7b40) at src/eval.cpp:445\n51 0x00000000004831d1 in Sass::Map::perform (this=0x801cf7b40, op=0x7fffffffdb58) at ast.hpp:884\n52 0x000000000051f5c3 in Sass::Eval::operator() (this=0x7fffffffdb58, a=0x801cf7d80) at src/eval.cpp:135\n53 0x000000000067487e in Sass::Assignment::perform (this=0x801cf7d80, op=0x7fffffffdb58) at ast.hpp:533\n54 0x000000000051ec9e in Sass::Eval::operator() (this=0x7fffffffdb58, b=0x801cf7600) at src/eval.cpp:73\n55 0x000000000050f51e in Sass::Block::perform (this=0x801cf7600, op=0x7fffffffdb58) at ast.hpp:380\n56 0x000000000053381e in Sass::Eval::operator() (this=0x7fffffffdb58, c=0x801d83c00) at src/eval.cpp:715\n57 0x00000000004f7401 in Sass::Function_Call::perform (this=0x801d83c00, op=0x7fffffffdb58) at ast.hpp:1115\n58 0x00000000005594f0 in Sass::Expand::operator() (this=0x7fffffffdb48, a=0x801d7d440) at src/expand.cpp:260\n59 0x000000000067484e in Sass::Assignment::perform (this=0x801d7d440, op=0x7fffffffdb48) at ast.hpp:533\n60 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801d7d380) at src/expand.cpp:684\n61 0x0000000000561616 in Sass::Expand::operator() (this=0x7fffffffdb48, c=0x801da0400) at src/expand.cpp:646\n62 0x0000000000566b71 in Sass::Mixin_Call::perform (this=0x801da0400, op=0x7fffffffdb48) at ast.hpp:791\n63 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801da0340) at src/expand.cpp:684\n64 0x000000000055aa81 in Sass::Expand::operator() (this=0x7fffffffdb48, i=0x801da7fc0) at src/expand.cpp:365\n65 0x0000000000672d21 in Sass::If::perform (this=0x801da7fc0, op=0x7fffffffdb48) at ast.hpp:636\n66 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801d9fc80) at src/expand.cpp:684\n67 0x000000000055aa81 in Sass::Expand::operator() (this=0x7fffffffdb48, i=0x801da8060) at src/expand.cpp:365\n68 0x0000000000672d21 in Sass::If::perform (this=0x801da8060, op=0x7fffffffdb48) at ast.hpp:636\n69 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801d954c0) at src/expand.cpp:684\n70 0x000000000055aaae in Sass::Expand::operator() (this=0x7fffffffdb48, i=0x801da8100) at src/expand.cpp:369\n71 0x0000000000672d21 in Sass::If::perform (this=0x801da8100, op=0x7fffffffdb48) at ast.hpp:636\n72 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801d93240) at src/expand.cpp:684\n73 0x0000000000561616 in Sass::Expand::operator() (this=0x7fffffffdb48, c=0x801dd0940) at src/expand.cpp:646\n74 0x0000000000566b71 in Sass::Mixin_Call::perform (this=0x801dd0940, op=0x7fffffffdb48) at ast.hpp:791\n75 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801dd0880) at src/expand.cpp:684\n76 0x0000000000555f3d in Sass::Expand::operator() (this=0x7fffffffdb48, b=0x801dd0880) at src/expand.cpp:79\n77 0x000000000050f4ee in Sass::Block::perform (this=0x801dd0880, op=0x7fffffffdb48) at ast.hpp:380\n78 0x00000000005583cf in Sass::Expand::operator() (this=0x7fffffffdb48, m=0x801de0c00) at src/expand.cpp:183\n79 0x00000000004828ce in Sass::Media_Block::perform (this=0x801de0c00, op=0x7fffffffdb48) at ast.hpp:459\n80 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801dd0700) at src/expand.cpp:684\n81 0x000000000055aa81 in Sass::Expand::operator() (this=0x7fffffffdb48, i=0x801de2b60) at src/expand.cpp:365\n82 0x0000000000672d21 in Sass::If::perform (this=0x801de2b60, op=0x7fffffffdb48) at ast.hpp:636\n83 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801dd0640) at src/expand.cpp:684\n84 0x000000000055aa81 in Sass::Expand::operator() (this=0x7fffffffdb48, i=0x801de8380) at src/expand.cpp:365\n85 0x0000000000672d21 in Sass::If::perform (this=0x801de8380, op=0x7fffffffdb48) at ast.hpp:636\n86 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801dd0580) at src/expand.cpp:684\n87 0x000000000055aaae in Sass::Expand::operator() (this=0x7fffffffdb48, i=0x801de8420) at src/expand.cpp:369\n88 0x0000000000672d21 in Sass::If::perform (this=0x801de8420, op=0x7fffffffdb48) at ast.hpp:636\n89 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801dcff80) at src/expand.cpp:684\n90 0x000000000055bf8e in Sass::Expand::operator() (this=0x7fffffffdb48, f=0x801de4a80) at src/expand.cpp:411\n91 0x0000000000672b41 in Sass::For::perform (this=0x801de4a80, op=0x7fffffffdb48) at ast.hpp:653\n92 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801dcfec0) at src/expand.cpp:684\n93 0x000000000055aaae in Sass::Expand::operator() (this=0x7fffffffdb48, i=0x801de84c0) at src/expand.cpp:369\n94 0x0000000000672d21 in Sass::If::perform (this=0x801de84c0, op=0x7fffffffdb48) at ast.hpp:636\n95 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801dcf980) at src/expand.cpp:684\n96 0x000000000055aaae in Sass::Expand::operator() (this=0x7fffffffdb48, i=0x801de8560) at src/expand.cpp:369\n97 0x0000000000672d21 in Sass::If::perform (this=0x801de8560, op=0x7fffffffdb48) at ast.hpp:636\n98 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801dcf440) at src/expand.cpp:684\n99 0x000000000055aa81 in Sass::Expand::operator() (this=0x7fffffffdb48, i=0x801e33480) at src/expand.cpp:365\n100 0x0000000000672d21 in Sass::If::perform (this=0x801e33480, op=0x7fffffffdb48) at ast.hpp:636\n101 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801dcf200) at src/expand.cpp:684\n102 0x000000000055aaae in Sass::Expand::operator() (this=0x7fffffffdb48, i=0x801e33520) at src/expand.cpp:369\n103 0x0000000000672d21 in Sass::If::perform (this=0x801e33520, op=0x7fffffffdb48) at ast.hpp:636\n104 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801dade00) at src/expand.cpp:684\n105 0x000000000055aaae in Sass::Expand::operator() (this=0x7fffffffdb48, i=0x801e335c0) at src/expand.cpp:369\n106 0x0000000000672d21 in Sass::If::perform (this=0x801e335c0, op=0x7fffffffdb48) at ast.hpp:636\n107 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801da07c0) at src/expand.cpp:684\n108 0x0000000000561616 in Sass::Expand::operator() (this=0x7fffffffdb48, c=0x801e2db00) at src/expand.cpp:646\n109 0x0000000000566b71 in Sass::Mixin_Call::perform (this=0x801e2db00, op=0x7fffffffdb48) at ast.hpp:791\n110 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801e2da40) at src/expand.cpp:684\n111 0x0000000000555f3d in Sass::Expand::operator() (this=0x7fffffffdb48, b=0x801e2da40) at src/expand.cpp:79\n112 0x000000000050f4ee in Sass::Block::perform (this=0x801e2da40, op=0x7fffffffdb48) at ast.hpp:380\n113 0x00000000005571d0 in Sass::Expand::operator() (this=0x7fffffffdb48, r=0x801e33660) at src/expand.cpp:123\n114 0x000000000048262e in Sass::Ruleset::perform (this=0x801e33660, op=0x7fffffffdb48) at ast.hpp:415\n115 0x0000000000562276 in Sass::Expand::append_block (this=0x7fffffffdb48, b=0x801c2e180) at src/expand.cpp:684\n116 0x0000000000555f3d in Sass::Expand::operator() (this=0x7fffffffdb48, b=0x801c2e180) at src/expand.cpp:79\n117 0x000000000050f4ee in Sass::Block::perform (this=0x801c2e180, op=0x7fffffffdb48) at ast.hpp:380\n118 0x00000000004d0b28 in Sass::Context::compile (this=0x801c23280) at src/context.cpp:642\n119 0x00000000004cf97a in Sass::File_Context::parse (this=0x801c23280) at src/context.cpp:573\n120 0x0000000000421307 in sass_parse_block (compiler=0x801c16060) at src/sass_context.cpp:305\n121 0x0000000000421131 in sass_compiler_parse (compiler=0x801c16060) at src/sass_context.cpp:450\n122 0x0000000000420db5 in sass_compile_context (c_ctx=0x801c1f100, cpp_ctx=0x801c23280) at src/sass_context.cpp:340\n123 0x000000000042101c in sass_compile_file_context (file_ctx=0x801c1f100) at src/sass_context.cpp:437\n124 0x000000000041a84f in compile_file (options=0x801c1c080, input_path=0x7fffffffeaaf \"f.scss\", outfile=0x0) at sassc.c:107\n125 0x000000000041b055 in main (argc=, argv=) at sassc.c:301\n```\n. Thanks! WIth flint git master ( https://github.com/ezekg/flint/commit/22aa527dd2321 ) I am getting warnings and the desired output:\nDEPRECATION WARNING: Passing foo, a non-string value, to unquote()\nwill be an error in future versions of Sass.\n        on line 35 of /home/saper/sw/flint/stylesheets/flint/functions/lib/_list-to-str.scss\nDEPRECATION WARNING: Passing foo, a non-string value, to unquote()\nwill be an error in future versions of Sass.\n        on line 35 of /home/saper/sw/flint/stylesheets/flint/functions/lib/_list-to-str.scss\nDEPRECATION WARNING: Passing foo, a non-string value, to unquote()\nwill be an error in future versions of Sass.\n        on line 35 of /home/saper/sw/flint/stylesheets/flint/functions/lib/_list-to-str.scss\nDEPRECATION WARNING: Passing foo, a non-string value, to unquote()\nwill be an error in future versions of Sass.\n        on line 35 of /home/saper/sw/flint/stylesheets/flint/functions/lib/_list-to-str.scss\nfoo {\n  float: left;\n  width: 293.75%;\n  margin-right: 3.125%;\n  margin-left: 3.125%; }\n  *, *:before, *:after {\n    box-sizing: border-box; }\n  @media (min-width: 60.0625em) {\n    foo {\n      width: 17.1875%;\n      margin-right: 0.78125%;\n      margin-left: 0.78125%; } }\n  @media (min-width: 40.0625em) and (max-width: 60em) {\n    foo {\n      width: 31.25%;\n      margin-right: 1.04167%;\n      margin-left: 1.04167%; } }\n  @media (min-width: 20.0625em) and (max-width: 40em) {\n    foo {\n      width: 71.875%;\n      margin-right: 1.5625%;\n      margin-left: 1.5625%; } }\nYes, we should try to figure out what went wrong, so I am leaving this open.\n. @andrew-skybound your bug reports are amazing. Fortunately, this one got fixed in 3.3.2.\n. I wonder if this is intended behaviour or just some byproduct of Ruby Sass implementation...\n. Thank you for the explanation @nex3 ! Regarding 4.0 I've had a brief look at https://github.com/sass/sass/milestones/4.0 and I was wondering is there any chance we could have a more formal (BNF?) specification of Sass 4.0? Would simplify greatly testing and building new interpreters.\n. Libsass is also not accepting asterisk glued to numbers and interpolations, maybe this is related?\n. Thanks. Fortunately this has no impact (since lhs_tail->head() != 0 implies rhs_tail->head() != 0 in conjunction with the two lines above, but definitely worth fixing, which I did in #1744 \n. Thanks, I have changed your shellcode to sprintf(command, \"procstat -f %d; procstat -f $$\", pid);  to reproduce this on FreeBSD (with clang); I think your change makes sense.\n. Thanks, this solved it. I have actually read this entry before but couldn't imagine it applies to our situation. Thank you.\n. @am11 is setting $env:TargetPath done with intention to override the setting from the sassc.vcxproj file? If yes, then it seems that the linker complains with \nwarning MSB8012: TargetPath(sassc/bin/sassc) does not match the \nLinker's OutputFile property value (C:\\projects\\libsass\\sassc\\bin\\sassc.exe). \nThis may cause your project to build incorrectly. \nTo correct this, please make sure that $(OutDir), $(TargetName) and $(TargetExt)\nproperty values match the value specified in %(Link.OutputFile)\nShall we modify $env:OutDir as well? Btw. I wonder if fixing this is not a good opportunity to introduce the subst trick and to publish clean .pdb files.\n. Reopening to check this.\n. Check how actually @warn and @debug objects are returned alongside the \"normal\" value\n. Two questions:\n1) Which \"install\" is now default on Solaris? Or more precisely, which part breaks when using traditional SysV \"install\"?\n2) I think we should just rename all constants and prefix them with something like LIBSASS_ to avoid issues like the SEC one. Otherwise it'll be the endless chase...\n. The logic in https://github.com/sass/libsass/blob/3.3.2/Makefile#L24 seems to be pretty unreliable to me. I was only using Visual Studio to build libsass, so I didn't check that. @Coridyn are you using MinGW 64 to build? What is the value of MAKE during your build?\n. I don't really know what this check is for. Visual Studio will not use that Makefile, you rule out cygwin earlier, is this a fallback case for \"neither VS, nor cygwin, nor MinGW\"? I think we should just remove this check.\n.  This is amazing, thanks!\n. I wonder if this is another instance of #1757\n. What about just having LIBSASS_ prefix on all our constants?\nC++ namespaces will not solve SEC issue afaik (the preprocessor will still try to expand it!)\n. It is not the compiler, those are the header files. If you don't like it we can drop SassUnit, since that's a bit too much. it's a known problem in the C world and most libraries try to namespace like this, this is nothing unusual. Windows is also adding random symbols defined here and there, you might by lucky with one SDK or version setting, but not with another. We can't change a whole world.\n. :tada:\n. @mgreter I am sure you will disagree with me, but here it is:\nI wrote those examples on purpose to see how the API breaks. We are programming C here and not Pascal and C pointer semantics does not tell you anything about where does the memory come from.\nOne reason why our API is broken is that you cannot pass a static or stack-allocated memory. Suppose I write a library that wraps libsass and I also cannot guarantee where the memory comes from.\nSecond reason is sometimes you need to use a custom allocator, for example because you operate in the environment like V8 or Python virtual machine. I am unable to pass strings created on those platforms directly because they will not survive libsass operations. Copying strings is taking time and is really bad solution. \nAlso by not using const char * one eliminates lots of possibilities to optimize the code by the compiler, because the compiler never knows if there isn't a pointer that is going to modify that memory in unexpected ways. \nI do not understand the point where you are afraid that the stack memory can be deallocated in-between. Except for callbacks (imports, functions) I don't see the issue here.\nThe change in the API to \"own\" all the memory was done to work around some double-free problems in the library instead of fixing them. Yes, I know memory management is difficult and C++ does not make it easier.\nTypically C APIs require the caller to return a large output buffer to be used as the output. If it's too small, one truncates the result or returns the error code. A custom memory allocator in libsass could be used to store C++ objects in the caller-supplied buffer as well (that would be actually a good use for the custom allocator for new). \nlibsass did use caller-provided memory not so long ago at least for its data, so it's not impossible. \n. This should be the proper behaviour as of Sass 4.0 per https://github.com/sass/sass/issues/1425\n. Not sure what PR ready means ... but hey, green looks so much better!\n.  This change removes VS version conditional - we should always include this header because we use width int types. I tested it with VS2013 and VS2015 was tested by appveyor.\nWe should be able to run tests for VS2015 as an additional environment if we want.\n. Unfortunately the tests fail since the use the newest sass-spec, not the one we've had with 3.3.2 release. Filed #1838 for that.\n. The first commit here is the same as #1835, so master is now compiling on VC2013.\nThe second commit is to enable building again on VC2013 on AppVeyor, so we can check if node-sass still compiles.\n. (This PR was against 3.3, not master).\nTo avoid confusion, submitted https://github.com/sass/libsass/pull/1888 to supersede this.\n. yep, I fully agree 1) that it should be the other way around, except that submodules are sometimes difficult to work with. But this works well for node-sass.\n2) That's what I've had in mind. Additional check if (magic pattern) then git fetch XXX; git checkout XXX else (do what we do now with the PR number); done.\nThank you! \n. Can you provide a (non)working example? Did you check if it works for Ruby Sass?\n. I am getting this now:\n\ngmake BUILD=debug-shared CC=cc CXX=c++\nmkdir lib\ncc -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-19-g3054\\\"\" -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/cencode.o src/cencode.c\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-19-g3054\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/ast.o src/ast.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-19-g3054\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/base64vlq.o src/base64vlq.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-19-g3054\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/bind.o src/bind.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-19-g3054\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/color_maps.o src/color_maps.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-19-g3054\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/constants.o src/constants.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-19-g3054\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/context.o src/context.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-19-g3054\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/cssize.o src/cssize.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-19-g3054\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/emitter.o src/emitter.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-19-g3054\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/environment.o src/environment.cpp\nsrc/environment.cpp:183:38: error: no matching member function for call to 'to_string'\n        { std::cerr << \" : \" << val->to_string(true, 5); }\n                                ~~~~~^~~~~~~~~\nsrc/ast.hpp:94:25: note: candidate function not viable: requires single argument 'opt', but 2 arguments were\n      provided\n    virtual std::string to_string(Sass_Inspect_Options opt) const;\n                        ^\nsrc/ast.hpp:95:25: note: candidate function not viable: requires 0 arguments, but 2 were provided\n    virtual std::string to_string() const;\n                        ^\n1 error generated.\n\n\nis it because of this change?\n\n. Yes, see https://github.com/sass/libsass/issues/1917#issuecomment-196546027\n. (this can be related to the compiler configuration issues)\n. I don't know. I've tried to compile 3.3.2 and it fails with the namespacing issues:\n````/bin/bash ../libtool  --tag=CXX   --mode=compile /home/admini/saper/sparcv9/bin/g++ -DHAVE_CONFIG_H -I. -I/home/admini/saper/src/libsass/src  -I/home/admini/saper/src/libsass/include  -Wall -O2  -std=c++0x -g -O2 -MT ast.lo -MD -MP -MF .deps/ast.Tpo -c -o ast.lo /home/admini/saper/src/libsass/src/ast.cpp\nlibtool: compile: /home/admini/saper/sparcv9/bin/g++ -DHAVE_CONFIG_H -I. -I/home/admini/saper/src/libsass/src -I/home/admini/saper/src/libsass/include -Wall -O2 -std=c++0x -g -O2 -MT ast.lo -MD -MP -MF .deps/ast.Tpo -c /home/admini/saper/src/libsass/src/ast.cpp -fPIC -DPIC -o .libs/ast.o\nIn file included from /home/admini/saper/src/libsass/src/ast.hpp:35:0,\n                 from /home/admini/saper/src/libsass/src/ast.cpp:1:\n/home/admini/saper/src/libsass/src/units.hpp:10:28: error: call of overloaded \u2018acos(int)\u2019 is ambiguous\n   const double PI = acos(-1);\n                            ^\n/home/admini/saper/src/libsass/src/units.hpp:10:28: note: candidates are:\nIn file included from /home/admini/saper/sparcv9/lib/gcc/sparc64-sun-solaris2.9/4.9.3/include-fixed/math.h:25:0,\n                 from /home/admini/saper/sparcv9/include/c++/4.9.3/cmath:44,\n                 from /home/admini/saper/sparcv9/include/c++/4.9.3/random:38,\n                 from /home/admini/saper/sparcv9/include/c++/4.9.3/bits/stl_algo.h:66,\n                 from /home/admini/saper/sparcv9/include/c++/4.9.3/algorithm:62,\n                 from /home/admini/saper/src/libsass/src/ast.hpp:11,\n                 from /home/admini/saper/src/libsass/src/ast.cpp:1:\n/home/admini/saper/sparcv9/lib/gcc/sparc64-sun-solaris2.9/4.9.3/include-fixed/iso/math_iso.h:176:21: note: long double std::acos(long double)\n  inline long double acos(long double __X) { return __acosl(__X); }\n                     ^\n/home/admini/saper/sparcv9/lib/gcc/sparc64-sun-solaris2.9/4.9.3/include-fixed/iso/math_iso.h:148:15: note: float std::acos(float)\n  inline float acos(float __X) { return __acosf(__X); }\n```\nso maybe this problem was here before or (more likely) has been introduced by our current \"fix the namespace problem\" solution.\n```\n. The code in question has been introduced in 3.3.0 (3.2.5 compilation failed because of other issues).\n. No, access is not possible :( I have just checked the manpages and ceil() and floor() seem to be available.\n. This is running on an older SPARC box, but I happen to have original x86 install media, so building a VirtualBox VM is certainly possible! Modern GNU compilers are running fine on this platform.\n. Confirmed using  \n/home/saper/sw/sassc/bin/sassc --version\nsassc: 3.3.0\nlibsass: 3.3.3-2-g20bfd\nsass2scss: 1.0.5\nTest added https://github.com/sass/sass-spec/pull/728\n. We actually crash trying to write the error message about it being undefined.\nStacktrace, sel is NULL:\n```\nProgram received signal SIGSEGV, Segmentation fault.\n0x000000000055f7d5 in Sass::Extend::operator() (this=0x7fffffffda90, b=0x8020558c0) at src/extend.cpp:2042\n2042            std::string str_sel(sel->to_string({ NESTED, 5 }));\n(gdb) bt\n0  0x000000000055f7d5 in Sass::Extend::operator() (this=0x7fffffffda90, b=0x8020558c0)\nat src/extend.cpp:2042\n\n1  0x00000000004ee79e in Sass::Block::perform (this=0x8020558c0, op=0x7fffffffda90) at src/ast.hpp:425\n2  0x00000000004afc42 in Sass::Context::compile (this=0x802024280) at src/context.cpp:660\n3  0x00000000004ae99e in Sass::File_Context::parse (this=0x802024280) at src/context.cpp:583\n4  0x0000000000422857 in sass_parse_block (compiler=0x80201a060) at src/sass_context.cpp:321\n5  0x0000000000422681 in sass_compiler_parse (compiler=0x80201a060) at src/sass_context.cpp:467\n6  0x0000000000422305 in sass_compile_context (c_ctx=0x80201f100, cpp_ctx=0x802024280)\nat src/sass_context.cpp:356\n\n7  0x000000000042256c in sass_compile_file_context (file_ctx=0x80201f100) at src/sass_context.cpp:454\n8  0x000000000041b13f in compile_file (options=0x80201c080, input_path=0x7fffffffea7f \"input.scss\",\noutfile=0x0) at sassc.c:131\n\n9  0x000000000041b945 in main (argc=, argv=) at sassc.c:332\n```\n. @xzyfer This is still reproducible on 0a05c8d11b61c66c407c57e3c623bb5165f04825 .\nI have just tried this on a clean working directory with unmodified Makefile (important!):\n```\n\ngmake BUILD=debug-shared CC=cc CXX=c++\nmkdir lib\ncc -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-32-g0a05\\\"\" -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/cencode.o src/cencode.c\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-32-g0a05\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/ast.o src/ast.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-32-g0a05\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/base64vlq.o src/base64vlq.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-32-g0a05\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/bind.o src/bind.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-32-g0a05\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/color_maps.o src/color_maps.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-32-g0a05\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/constants.o src/constants.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-32-g0a05\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/context.o src/context.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-32-g0a05\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/cssize.o src/cssize.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-32-g0a05\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/emitter.o src/emitter.cpp\nc++ -g -DDEBUG -DDEBUG_LVL=\"NONE\" -Wall -DLIBSASS_VERSION=\"\\\"3.3.3-32-g0a05\\\"\" -std=c++0x -I /home/saper/sw/libsass/include -fPIC -fPIC -c -o src/environment.o src/environment.cpp\nsrc/environment.cpp:183:38: error: no matching member function\n      for call to 'to_string'\n        { std::cerr << \" : \" << val->to_string(true, 5); }\n                                ~~~~~^~~~~~~~~\nsrc/ast.hpp:94:25: note: candidate function not viable:\n      requires single argument 'opt', but 2 arguments were\n      provided\n    virtual std::string to_string(Sass_Inspect_Option...\n                        ^\nsrc/ast.hpp:95:25: note: candidate function not viable:\n      requires 0 arguments, but 2 were provided\n    virtual std::string to_string() const;\n                        ^\n1 error generated.\nMakefile:240: recipe for target 'src/environment.o' failed\ngmake: *** [src/environment.o] Error 1\n```\n\n\n. Ouch. So we need to implement them as the list of (k,v) items, never the hash map...\n. This actually belongs to https://github.com/sass/node-sass/issues , but let me ask you first: what happens if you use clang instead of gcc?\n. @fivedoor make: clang++: No such file or directory is not that bad, the commandline invocation could not find your compiler - can you try to find out what is the full path to clang and clang++ and use it instead? export CC=/full/path/to/clang export CXX=/full/path/to/clang++\n. Just try export CXX=/usr/bin/clang Can you double check /usr/bin/clang --version to make sure you are using your new clang installed and not the oldish one from Apple?\n. Perfect!\n. typeid warning is harmless, it got fixed later - see https://github.com/sass/libsass/issues/1523\nconfigure: error: installation or configuration problem: assembler cannot create object files.\nThis is something more serious, you might want to report this to the people maintaining jpeg-tran.\nMost probably you need to point somehow to the assembler which works; something strange is going on here.\nJust install development dependencies and try to run  npm test against node-sass, I hope it works!\n. @smolugu well, ths completely unrelated to this project. You are pretty much on your own, since the messages say your OS version is not supported. You can try asking in the brew community for help. Upgrading your cmake may help, maybe.\n. Think you @fivedoor , that's very useful. clang 3.6 is too new to be built with an old clang, so we need to take an immediate step - first to build gcc48 and then use it build clang-3.6.\nActually gcc48 should be enough to build node-sass, but then you are using a modern libstdc++ which comes with gcc48 and you may end up in trouble when running our code from within node, which AFAIK uses the old C++ library still provided by Apple.\n. Looks like Richard Stallman has won against Apple this time :)\n. It might, actually my first thought was that this is just a coincidence...\n. Normally node-sass just includes libsass source, can you post your full logs of your libsass and node-sass build?\n. From a quick look at the source:\nFirst they get collected https://github.com/sass/libsass/blob/master/src/context.cpp#L276\nAnd then stuck in the \"sources\" entry of the source map generated:\nhttps://github.com/sass/libsass/blob/master/src/source_map.cpp#L40\n. @schneems good to hear things are getting better. Thanks for providing all the information needed to troubleshoot this in your pull request - this is very useful. Can you try using MinGW toolkit to build libsass instead of Visual Studio? I've left the comment at the appropriate place.\n. @chriseppstein is there a way to detect 3.5 code automatically?\nIf yes, that would be the preferred solution. The order should be:\n1. Runtime detection from the source file (if possible)\n2. Runtime switch\n3. Compile-time option\n4. Separate development branch\nOf course the branch could do for the experimental phase, but we should try to move upwards towards runtime detection if possible.\n. libsass.so is a shared library, but it is not designed to work attached as a PHP extension. Please check out https://github.com/sass/libsass/blob/master/docs/implementations.md - there are two projects we know of that can help create a PHP extension with libsass.\n. Looks pretty straightforward change to me.\n. Did you manage to reproduce it without node, i.e. only with libsass - for example with sassc? If you get it reproduced without node, let's discuss it here - otherwise it's a node-sass thing.\n. It would be important to check whether it crashes without node-sass (pure sassc). Also, which runtime C++ library versions are used on the affected and unaffected versions? Where does node binary come from (OS package, nodejs download, URL)?\n. @mgreter thank you very much! Let's switch to the node-sass bug then https://github.com/sass/node-sass/issues/1738\n. Rounding it yourself?. Which version of libsass has been used?. Which libsass version was used to create a crash?. No worries, this is solved already, I need to check where I saw the fix.. This is https://github.com/nodejs/node/issues/14076 and it is already fixed in node and is already in the Release Candidate https://github.com/nodejs/node/issues/14076#issuecomment-320024766 - so either downgrade to node 6 or wait a bit.. Node 8.3.0 has just made it to the FreeBSD ports.. FYI: I have uploaded FreeBSD bindings for node 4,6 and 8 for i386 and amd64 architectures.. This belongs to node-sass indeed. Why is the parameter with -I in quotes? Did you compile node yourself? Can you check config.gypi file in the build directory?. This has to be checked if the oldest compiler we support has that option. clang 4.0 is a brand new one.. That's okay, thank you!. great, thanks!. Your node-sass is too old.. Interesting, looks like we have a regression with #1308 coming back haunting us.. I wonder how this broke. The problem is that file.cpp includes <unistd.h> before we have a change to undefine __EXTENSIONS__ (this was done long ago in eae7c0a56c59b5e6a49ec2b0e99545939de93ac1). \nMoving #include \"sass.hpp\" to the top of that file seems to fix it.... According to bisect, 375394819b001389c7f61d3de042b55d3f460bde broke this. \nAlso checked with SmartOS (17.3.0) and it is broken the same way.. What kind of file system is T: ? Does it happen the same way when working on C: ?. We are not requiring Visual Studio 2010 anywhere, in fact that one will it work because we depend on C++11 features.    Since sometimes it is needed to set the toolkit version externally I would prefer not to hardcore it in the son file.\nWhere is th is VS2010 default is coming from? Maybe it is set somewhere as a part of Rust scaffolding? . Could you publish some code to reproduce it (ideally with a local host/file system only)?. Correct. I need to see what we can do with test coverage.\nUnfortunately I think we might want to pass -O2 to the linker too. Or maybe not? There is no link-time optimization there, I think.\n. > >  clean-objects:\n\n\n\n$(RM) lib/.a lib/.so lib/.dll lib/.la\n-$(RM) lib/.a lib/.so lib/.dll lib/.la\n-$(RMDIR) lib\n  clean: clean-objects\n\n\nWhy is there a dash before the variables/command? And I somehow would rather put the rmdir into the clean target itself, but I guess that's just a personal preference, but maybe you can see where I'm going ...\n\nDash is to ignore error from rmdir. rm -r does not fail when the file\ndoes not exist; rmdir does.\nOtherwise \"make clean\" fails when \"lib\" exist.\n. Maybe we can get rid of the File namespace at all (if it makes making bindings more difficult...)? Also Util then...\n. This should go away now...\n. not needed at all?\n. not needed at all?\n. I hope it is not necessary, haven't tried swig for years...\n. Sure, my mistake. Even more, let's make it return the (char **) pointer for easier error checking.\n. #995 adds an autoconf macro here:\n+#ifdef HAVE_CXX_UNORDERED_MAP_RESERVE\n+      elements_.reserve(s); list_.reserve(s);\n+#endif\nFor non-autoconf builds it stays undefined, so no harm here.\n. ",
    "naartjie": "Sure, I will put one together. Let me clean up the files I have, and provide as small a test case as possible.\nThanks for looking into this.\n. Here she is, I've tried to strip it down as much as possible:\n``` scss\nhtml {\n  padding: 0;\n}\nbody {\n  color: #333;\n  background-color: #999;\n}\n@mixin input-size($parent) {\n  textarea#{$parent},\n  select[multiple]#{$parent} {\n    height: auto;\n  }\n}\n@include input-size('.input-sm');\n```\nI've also uploaded the compiled examples to this repo:\npre-3.0.1 is compiled with libsass f55b2d5, and post-3.0.1 is compiled with head / 5f3558d.\n\nOh dear, so after all of that, I've just noticed that the broken map contains an extra ; before: \"mappings\": \";6BAAA..., and the one that works doesn't have that. If I remove it the line numbers are reported fine. \nIn my original use case where I discovered this, I had 2 ;; at the beginning of the mappings element, and 2 corresponding @include input-size's, and I just went back now, and it looks like removing the ; fixes the issue. So I hope this is a relatively easy fix ;-).\n. @mgreter NP. Thanks for looking into it.\ngh-pages finally caught up, and the test cases are viewable in the browser here: broken and working\n. Hi @mgreter. I have tested your fix/source-map-issues branch, and I can confirm this fixes the issue I was having.\nThanks a lot for having a look at this!! Any chance this could make it into the next release? #697\n. Sorry it took a while, I had a busy weekend, back on track now ;-)\n. Awesome, thanks @mgreter :+1: \n. ",
    "nkgm": "Same problem here. Problem started with node-sass v1.1.0 - it uses libsass @ ca5f271.\n. ",
    "macrozone": "I noticed this issue with the latest release of node-sass, so I guess, it will be fixed soon.\n. ",
    "dfabreguette-ap": "If you can't upgrade your sass version up to the fix (which was my case for some reasons), I used \"rgba(0,0,0,0)\" instead as a quick fix. I know I know, it may not have same compatibility results... :)\n. ",
    "smikes": "@QuLogic Looks like I maybe should use rbenv?\ngem does not seem to take a --user arg.\n. thanks!\n. What I'd like to do with this PR is the following:\n1. finish writing Catch unit tests that cover the current behavior of quote/unquote\n2. discuss changes needed to the quote/unquote algorithms to address the bugs noted above, plus any others that come up, minus any behaviors that I have incorrectly identified as bugs \n3. implement changes to quote/unquote algorithms\n4. add unit test (and/or specs) to cover quoting and unquoting in a number of cases, including a \"stress test\" (where we generate all possible strings s of length < N from a small alphabet e.g. \" ' a \\\\, and confirm that for all s, s == unquote(quote(s)))\n5. remove all cruft and squash down into a mergeable pull request\nDuring this process I hope to learn more about sass and libsass, and with luck kill issue #694 and maybe a few more quoting-related issues.\n. It looks like I only added quote.cpp to the SOURCES in Makefile, not in the configure.ac or Makefile.am or related sources.  I will fix this tomorrow, going to bed in my time zone.\n. Here is a candidate PR for the first part of my work on quoting/interpolation in libsass.\nSee https://github.com/sass/sass-spec/pull/218 for the spec.\nAlthough the code in libsass that detects interpolations appears to ignore escaped ones:\nfind_first_in_interval< sequence< negate< exactly<'\\\\'> >, exactly<hash_lbrace> > >(b, e);\nmy unit tests showed that this did not work.  Worked around it in the stupidest way possible, that is, with an explicit guard.  May be amenable to cleanup later, but for now, this is a step that increases correctness and coverage (+0.06%)\n. Okay, I will move the quote/unquote functions into util.\nI will remove the unit tests from this PR.  I appreciate that nobody wants to add a new dependency, especially a random untried C++ unit test framework.  However, I argue that unit tests are critical to this project, and in particular, for quoting/unquoting and similar internal functions that are never exposed.  In this case, I was only able to implement a correct next_unescaped_interpolant() by using unit tests; and the refactoring was tricky because I could not establish unit tests to pin the behavior as I worked.\nCatch provides everything I want in a modern test framework for C++, including selecting tests by name or by tag, various output formats, separate compilation etc.  Please check it out, and if there is no consensus about a unit test framework but a general consensus that there ought to be more testing, I would volunteer to support Catch unit tests.  https://github.com/philsquared/Catch\nIn any case, I will continue to maintain unit tests in my own branch and try to prevent them from leaking into my PRs.\n. > As it stands I think this PR's commits need a tidy up. Two or three well written commits should get the job done whilst preserving appropriate forensic git information. I can assist with this is you need.\nSquashed down to one commit.  I don't think there was anything important in the intervening commits, just add/revert of the new file quote.cpp and add/revert of the unit tests.\n. Thanks. I missed this, because I did not re-inspect unquote after I handled the merge from #779 , commit https://github.com/sass/libsass/commit/5483186ab9406fa69bfcc48b59b2a76009d9483d.\n. Is it running with an implicit 'warnings as errors' setting?  Anyway, thanks for pointing it out.  When 1.0.14 https://ci.appveyor.com/project/sass/libsass/build/1.0.14  finally runs we'll see if I got it. \n. ",
    "MethodGrab": "Thanks! :+1:\n. ",
    "pierremanceaux": "Not sure to understand, does this closed issue actually means that \n.element {\n    &--modifier {\n        color: red;\n    }\n}\nshould not output  anymore ?\nI'm actually using grunt-sass (https://github.com/sindresorhus/grunt-sass) and it fails on every modifiers selectors (&--)\n. @xzyfer thanks for you quick answer :)\nJust to know, is it possible to update the version of libsass used by grunt-sass?\n. Great, got it, thanks a lot for you time xzyfer.\n. ",
    "tompazourek": "It's still not working for me, using gulp-sass (latest version 3.1.0), which is supposed to use node-sass (version 3.4.2), which uses libsass (version 3.3.6).\nAny ideas why? Can you reopen, if possible?\nscss\n$test-var1: null;\n$test-var1: red !default;\n@debug($test-var1); // outputs: red. @xzyfer I see, thanks for the clarification.. I thought it might be useful to keep them all listed them even when they haven't been updated recently. They might still work just fine. I haven't tested SharpScss or LibSassHost myself, really, so I cannot tell if they are better than the other options on the list. I just noticed them as alternatives for somebody researching how to use libsass on the .NET Platform.\nI think those links are still useful information, and I can imagine it can help someone. Many other links on the page are dead projects, and I think it's alright.\nSharpScss has been updated 7 months ago, which isn't that bad, really. I wouldn't think it's a dead project. A difference is that it runs on .NET Core, comparing to LibSassHost only running on full .NET Framework. That might be an important factor to some developers.\nAnd as for libsass-net, it's one of the \"sanctioned\" implementations mentioned in README.md as well, and it falls under https://github.com/sass. I'm not sure if it makes sense to remove that one.... ",
    "caesar": "+1, this would be a nice (if not very important) option to have for the sake of coding style consistency within a project.\nBut, does libsass implement features which aren't in ruby sass???\n. ",
    "3den": "when will this change be published on the sass gem?\n. ",
    "manuelro": "Was this feature already added? I still getting a File to import not found or unreadable while importing a css file from my bower dependencies.\nUsing:\n@import \"angular-material/angular-material.min\"\nThe load path is right, since I can import .scss and .sass files. Any help, please?\n. ",
    "smartapant": "@mgreter, i have the same problem that @manuelro has, is the feature available?\n. ",
    "micahblu": "I'm also getting the same error with a confirmed css path.\nUpdate:\nGot rid of the File to import not found error by doing a quick npm update node-sass',\nhowever it is just maintaining the css import, which is not what I understand it should do.. Correct me if I'm wrong but isn't it the intent that the @import \"path/style\" will look for a partial or matching .css file and inline it into the output file? \n. @drewwells That is understood however as I stated is not the intent that the@import \"path/style\"` will look for a partial or matching .css file and inline it into the output file?\n- Note the missing .css\n. ",
    "ccraze-matt": "@chriseppstein Does rubygem sass expose a configuration option to allow the inline importing of css files?\n. ",
    "electronicdreamer": "I can see this was merged but it's not really working on my side.  \nI'm using node-sass 4.5.3 which uses libsass 3.5.0.beta.2 and  \n@import \"~vue-wysiwyg/dist/vueWysiwyg.css\"; works fine but\n@import \"~vue-wysiwyg/dist/vueWysiwyg\"; does not, saying  \n\nError: File to import not found or unreadable: ~vue-wysiwyg/dist/vueWysiwyg.\nParent style sheet: E:/project/assets/scss/vendor/_vendor.scss\non line 3 of assets/scss/vendor/_vendor.scss\n@import \"~vue-wysiwyg/dist/vueWysiwyg\";\n\nAm I doing something wrong?. Not sure what you mean by importer but I'm just using grunt-sass -> node-sass -> libsass to compile the file.  \nI've tried with @import \"../node_modules/vue-wysiwyg/dist/vueWysiwyg\"; and I have the same problem.. ",
    "maxhawkins": "Great. I sent a ping to the bug report.\nI don't know much about Debian packaging. Hopefully the original submitter will follow through.\n. ",
    "edouard-lopez": "I post an explaination on ask ubuntu on how to install on Ubuntu/Linux Mint. This is based on the official doc plus some fixes on hurdles I encounter.\n. ",
    "mockturtl": "\nhttps://bugs.debian.org/cgi-bin/bugreport.cgi?bug=694730\n\n:fireworks:   https://tracker.debian.org/pkg/libsass\n. ",
    "benjaoming": "Debian has a SASS team that maintains libsass and sassc for unstable since 2015 and testing since 2016.\nhttps://packages.qa.debian.org/libs/libsass.html\nThis means packages were also in the Ubuntu universe repo since Wily (15.10).\nhttps://launchpad.net/ubuntu/+source/libsass\nhttps://launchpad.net/ubuntu/+source/sassc\nUnfortunately, due to dependency issues it won't run on Ubuntu 14.04... but meh.. we should upgrade anyways :)\n. @bhat3 I haven't tried that, sounds like something that's worth a try. You can probably just modify the debian/control file and rebuild..\nAnyways, installing libsass and sassc from source is pretty easy, following these instructions.\n. ",
    "bhat3": "@benjaoming are you sure that backporting to Ubuntu 14.04 is not possible? i mean with rebuilding the packages not just installing.\n. @benjaoming Just tried to backport it, but cdbs comes in the way and when i blindly lower the version dependency in debian/control i got the following error. So it seems that we would need to backport cdbs as well, but for today i can't spend more time on it :(\n``\nI: Building the package\nI: Running cd /build/*/ && env PATH=\"/usr/sbin:/usr/bin:/sbin:/bin\" HOME=\"/nonexistent\" dpkg-buildpackage -us -uc -rfakeroot\ndpkg-buildpackage: source package libsass\ndpkg-buildpackage: source version 3.3.4-1~trusty1~trio1\ndpkg-buildpackage: source distribution trusty\ndpkg-buildpackage: source changed by BHat3 <bhat3@trio-group.de>\n dpkg-source --before-build libsass-3.3.4\ndpkg-buildpackage: host architecture amd64\n fakeroot debian/rules clean\nsed -e 's/__LIBPKG__/libsass0/g' <debian/control.in.in >debian/control.in\ntest -x debian/rules\nrm -f debian/stamp-makefile-build debian/stamp-makefile-install\n/usr/bin/make  -C .  -k distclean\nmake[1]: Entering directory/build/libsass-3.3.4'\nmake[1]: *** No rule to make target distclean'.\nmake[1]: Leaving directory/build/libsass-3.3.4'\nmake: [makefile-clean] Error 2 (ignored)\nrm -f debian/stamp-makefile-check\nrm -f debian/stamp-autotools\nrmdir --ignore-fail-on-non-empty .\nrmdir: failed to remove '.': Invalid argument\nmake: [makefile-clean] Error 1 (ignored)\nrm -rf autom4te.cache\nrm -f script/config.guess script/config.sub script/ltmain.sh m4/libtool.m4 m4/ltoptions.m4 m4/ltsugar.m4 m4/ltversion.m4 m4/lt~obsolete.m4 aclocal.m4 configure script/compile script/install-sh script/missing script/depcomp ./Makefile.in script/test-driver config.h.in config.log\nrm -f debian/copyright_newhints\nrm -f debian/cdbs-install-list debian/cdbs-package-list debian/stamp-copyright-check\nrm -rf \"debian/upstream-cruft\"\nrm -f debian/stamp-upstream-cruft\nrm -f debian/stamp-autotools-files\ndh_clean \nrm -f debian/stamp-local-shlibs-libsass\nrm -f script/config.guess script/config.sub\ntest ! -d script || rmdir --ignore-fail-on-non-empty script\nrm -f Makefile.am\n dpkg-source -b libsass-3.3.4\ndpkg-source: info: using source format `3.0 (quilt)'\ndpkg-source: info: building libsass using existing ./libsass_3.3.4.orig.tar.gz\ndpkg-source: info: building libsass in libsass_3.3.4-1~trusty1~trio1.debian.tar.gz\ndpkg-source: info: building libsass in libsass_3.3.4-1~trusty1~trio1.dsc\n debian/rules build\nsed -e 's/LIBPKG/libsass0/g' debian/control.in\ntest -x debian/rules\nmkdir -p \".\"\n/usr/share/cdbs/1/rules/buildcore.mk:109: WARNING:  DEB_DH_STRIP_ARGS is a deprecated variable\nScanning upstream source for new/changed copyright notices...\nlicensecheck -c '.*' -r --copyright -i '^debian/(changelog|copyright(|_hints|_newhints))' -l '99999' * | /usr/lib/cdbs/licensecheck2dep5 > debian/copyright_newhints\n10 combinations of copyright and licensing found.\nWARNING: The following (and possibly more) new or changed notices discovered:\nLicense: UNKNOWN\n  Hampton Catlin, Nathan Weizenbaum, and Chris Eppstein and \u2026\n  2014-2015, Google Inc.; contributed by Alexey Sokolov <\u2026\nTo fix the situation please do the following:\n  1) Fully compare debian/copyright_hints with debian/copyright_newhints\n  2) Update debian/copyright as needed\n  3) Replace debian/copyright_hints with debian/copyright_newhints\ntouch debian/stamp-copyright-check\nmkdir -p \"debian/upstream-cruft\"\nmv Makefile debian/upstream-cruft/Makefile\ntouch debian/stamp-upstream-cruft\ncp -f GNUmakefile.am Makefile.am\ncd . && libtoolize -c -f\nlibtoolize: putting auxiliary files in AC_CONFIG_AUX_DIR, script'.\nlibtoolize: copying filescript/ltmain.sh'\nlibtoolize: putting macros in AC_CONFIG_MACRO_DIR, m4'.\nlibtoolize: copying filem4/libtool.m4'\nlibtoolize: copying file m4/ltoptions.m4'\nlibtoolize: copying filem4/ltsugar.m4'\nlibtoolize: copying file m4/ltversion.m4'\nlibtoolize: copying filem4/lt~obsolete.m4'\ncd . && aclocal-, -Im4 --install --force\n/bin/sh: 1: aclocal-,: not found\nmake: *** [debian/stamp-autotools-files] Error 127\ndpkg-buildpackage: error: debian/rules build gave error exit status 2\n```\n. @xzyfer Might look like but i am building with pbuilder with a defined build environment that fulfills the build dependencies:\nBuild-Depends: cdbs (>= 0.4.122~),\n devscripts,\n libtool,\n automake,\n autoconf,\n debhelper,\n dh-buildinfo,\n autoconf-archive,\n d-shlibs (>= 0.50)\nThat's why i thought it must be a failure from cdbs with is the Common Debian Build System that also integrates automake & co. But as said i can't do a no source changes backport to Ubuntu 14.04 and right now i am lacking time for it, so feel free to inspect it :)\n. ",
    "philippkuehn": "This seems not to be fixed. I have the same problem as before.\nAnd there is something more. This is strange. \nTestcase 1:\n``` scss\nbody {\n  color: blue;\n}\n.banner {\n  color: blue;\n}\n```\nChrome 39:\nbody: line 1 -> correct\n.banner: line 2 -> not correct (should be 5)\nFirefox 34:\nbody: line 1 -> correct\n.banner: line 5 -> correct\nTestcase 2:\n``` scss\n// @import \"base/reset\";\nbody {\n  color: blue;\n}\n.banner {\n  color: blue;\n}\n```\nChrome 39:\nbody: line 1 -> not correct (should be 3)\n.banner: line 4 -> not correct (should be 7)\nFirefox 34:\nbody: line 1 -> not correct (should be 3)\n.banner: line 7 -> correct\n. yes. tested master. \n(and i've updated my previous comment with more info)\n. ",
    "browniefed": "@HugoGiraudel sorry this was pulled from compass mixins, compass/typography/text/_replacement.scss in particular. I was under the impression that because the calculation (outputting just the px amount) worked in previous libsass versions that it may be a regression.\nThe raw sass solution is to strip away all units and then just multiply by -1px, so if this is intended then no big deal.\n. ",
    "sebastian-steinmann": "Any ETA on getting this into a release?\nStuck with slow ruby-sass because of this bug.\n. ",
    "scamden": "@xzyfer changelog shows you added basic support for this feature, any help? we would love to use libsass but we use this syntax everywhere\n. i'm using gulp sass, but i manually installed node-sass@2.0.0-beta, to get\nsome of your latest features, not sure which version they're using since\nit's not a node package, where could i find that info?\nOn 6 January 2015 at 14:56, Michael Mifsud notifications@github.com wrote:\n\n@scamden https://github.com/scamden do you know which version of\nlibsass you're using? Are you using it via sassc or a 3rd party like\nnode-sass, grunt-sass, gulp-sass etc..\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/813#issuecomment-68949953.\n\n\nSterling Camden\nSoftware Engineer\n502 Emerson Street | Palo Alto, CA 94301\n303.520.2968 | sterling@relateiq.com\n. here's the repro using the libsass version that' son there:\nhttp://sassmeister.com/gist/a3d01d4828d7e07f48f4\nOn 6 January 2015 at 16:46, Michael Mifsud notifications@github.com wrote:\n\nI believe the node-sass CLI has a version flag now.\nIf you could create a test case on http://sassmeister.com that'd be\ngreat.\nOn 7 Jan 2015 09:58, \"Sterling Camden\" notifications@github.com wrote:\n\ni'm using gulp sass, but i manually installed node-sass@2.0.0-beta, to\nget\nsome of your latest features, not sure which version they're using since\nit's not a node package, where could i find that info?\nOn 6 January 2015 at 14:56, Michael Mifsud notifications@github.com\nwrote:\n\n@scamden https://github.com/scamden do you know which version of\nlibsass you're using? Are you using it via sassc or a 3rd party like\nnode-sass, grunt-sass, gulp-sass etc..\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/813#issuecomment-68949953.\n\n\nSterling Camden\nSoftware Engineer\n502 Emerson Street | Palo Alto, CA 94301\n303.520.2968 | sterling@relateiq.com\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/813#issuecomment-68950334.\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/813#issuecomment-68961615.\n\n\nSterling Camden\nSoftware Engineer\n502 Emerson Street | Palo Alto, CA 94301\n303.520.2968 | sterling@relateiq.com\n. You can't reproduce in sassmeister? Or locally?\nOn Wed, Jan 7, 2015 at 5:44 AM Michael Mifsud notifications@github.com\nwrote:\n\n@scamden https://github.com/scamden I can't reproduce this. Everything\nappears to be working in your gist. Try compiling the 3.1.0 stable release.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/813#issuecomment-69022942.\n. \n\n. What would be the recommended method for that?\nOn Wed, Jan 7, 2015 at 1:45 PM Michael Mifsud notifications@github.com\nwrote:\nI can't reproduce it either locally or on sassmeister -\nhttp://sassmeister.com/gist/855ff3f3c38808f6fcdb\nI think you mean be running in to a bug with sassmeister. Try creating a\nnew gist with Libsass.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/813#issuecomment-69097793.\n. Exactly that is the incorrect output\nOn Wed, Jan 7, 2015 at 1:48 PM Michael Mifsud notifications@github.com\nwrote:\nI've confirmed the supplied code produces\n.myClass {\n  left: 3px;\n  bottom: 1px; }\nin Libsass 3.1.0-beta, 3.1.0-beta.2, and 3.1.0 stable.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/813#issuecomment-69098273.\n. @xzyfer awesome thank you!\n. \n",
    "torkiljohnsen": "I am experiencing something similar. I set up a CodePen snippet where you can compare how CodePen compiles and how LibSASS compiles (added the LibSASS compiled source in a comment). Click the eye icon to toggle compiled CSS view:\nhttp://codepen.io/torkil/pen/BydJQr?editors=110\n. ",
    "polarathene": "Have built source maps via gulp-ruby-sass, I'm assuming this is the same sourcemap output via ruby sass. It handles the sepia(1) as a single mapping in both .css and .scss files. Even if a variable is used, for some reason if I import the $value from test/num partial, it won't be referenced when used with sepia($value) only. Though if I use it as a value for a property like opacity it'll map to the partial referencing the test/num.scss in the sourcemap. Both libsass/rubysass handle variables like that so perhaps it's intended.\nVisual mappings between the two here: gulp-ruby-sass, node-sass/libsass.\nlibsass mappings (With AAAA issue):\n\"mappings\": \"AAGA,AAAA,SAAS,AAAA;EAAE,AAAA,MAAM,AAAA,EAAE,AAAA,UAAK,AAAA;EAAU,AAAA,KAAK,AAAA,ECHhC,OAAO;;ADKd,AAAA,SAAS,AAAA;EACP,AAAA,MAAM,AAAA,EAAE,AAAA,UAAK,AAAA;EACb,AAAA,KAAK,AAAA,ECND,IAAI;EDOR,AAAA,OAAO,AAAA,EERD,GAAG\"\nruby-sass mappings:\n\"mappings\":\"AAGA,SAAS;EAAE,MAAM,EAAE,UAAa;EAAE,KAAK,ECHhC,OAAO;;ADKd,SAAS;EACP,MAAM,EAAE,UAAa;EACrB,KAAK,ECND,IAAI;EDOR,OAAO,EERD,GAAG\"\n. ",
    "gilluminate": "+1\n. I imported libsass master into node-sass, ran gulp-sass. There doesn't appear to be any change to the mapping problem. Still exists.\n. input.scss\n@import \"test\";\n_test.scss\n```\n* {\n    margin: 0;\n    padding: 0;\n    background-repeat: no-repeat;\n    -webkit-text-size-adjust: none;\n}\n, :before, *:after {\n    -moz-box-sizing: border-box;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n}\n```\noutput.css\n*{margin:0;padding:0;background-repeat:no-repeat;-webkit-text-size-adjust:none}*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}\noutput.css.map\n{\"version\":3,\"sources\":[\"_test.scss\"],\"names\":[],\"mappings\":\"AAAA,EACI,OAAQ,EACR,QAAS,EACT,kBAAmB,UACnB,yBAA0B,MAG9B,EAAG,AAAC,SAAS,AAAC,QACV,gBAAiB,WACjB,mBAAoB,WACpB,WAAY\",\"file\":\"degreed_app.css\",\"sourcesContent\":[\"* {\\n    margin: 0;\\n    padding: 0;\\n    background-repeat: no-repeat;\\n    -webkit-text-size-adjust: none;\\n}\\n\\n*, *:before, *:after {\\n    -moz-box-sizing: border-box;\\n    -webkit-box-sizing: border-box;\\n    box-sizing: border-box;\\n}\"],\"sourceRoot\":\"/source/\"}\nThe problem seems to be stemming from the *, *:before, *:after line because that's where line numbers get messed up in Chrome Dev Tools.\n. My mistake! This was coming from gulp-sourcemaps which I was led to believe used libsass as a dependancy. Not the case. Carry on.\n. ",
    "josephdburdick": "+1\n. ",
    "ericnewton76": ":+1:\nThe options present in ruby-sass would be greatly appreciated.  :wink:\n. Seeing pull request #910 !  Awesome work fellas!  Thanks much!  :+1: \n. ",
    "foria": "Ok I clicked on the link here: https://github.com/sindresorhus/grunt-sass\n. ",
    "umyeah": "I ran into this issue as well when trying to do width: -ms-calc(100% - 100px); \nThis is happening to me when using libsass 3.1.0 on sassmeister as well as when using node-sass version 2.0.1 (not sure what version of libsass that is using)\n. ",
    "baires": "Any news abut this issue? I'm also stuck\n. ",
    "molily": "Thanks a lot for your work. :satisfied:\n. ",
    "mmaxim": "Yeah this did cause a problem, which is how I stumbled upon it. It could mean there is a deeper bug int he parser to even get to that block of code in the first place, but I didn't look that hard (since this fix just made everything work for me). I'll work on getting a minimal test case.\n. ",
    "defualt": "Oops sorry about that.\n. ",
    "arcxyz": "This feature will be available on Ruby Sass 3.5:\nPR: https://github.com/sass/sass/pull/2057\nIssue: https://github.com/sass/sass/issues/626\n. ",
    "brentjohnson": "$ gcc -v\ngcc version 4.7.2 (GCC)\nTarget: x86_64-sun-solaris2.11\n$ uname -irsv\nSunOS 5.11 joyent_20130808T165657Z i86pc\n. ",
    "nielsgoossens": "Was this issue ever resolved? I am witnessing the same problem.\ngcc (GCC) 4.9.1, SunOS 5.11 joyent_20141212T011737Z i86pc\n../src/libsass/json.cpp:159:18: error: conflicting declaration 'typedef uint32_t uchar_t'\n typedef uint32_t uchar_t;\n                  ^\nIn file included from /usr/include/sys/wait.h:37:0,\n                 from /usr/include/stdlib.h:41,\n                 from ../src/libsass/json.cpp:29:\n/usr/include/sys/types.h:98:23: note: previous declaration as 'typedef unsigned char uchar_t'\n typedef unsigned char uchar_t;\n                       ^\nIn file included from ../src/libsass/json.cpp:26:0:\n../src/libsass/json.cpp: In function 'int utf8_write_char(uchar_t, char_)':\n../src/libsass/json.cpp:299:18: warning: comparison is always true due to limited range of data type [-Wtype-limits]\n   assert(unicode <= 0x10FFFF && !(unicode >= 0xD800 && unicode <= 0xDFFF));\n                  ^\n../src/libsass/json.cpp:299:43: warning: comparison is always false due to limited range of data type [-Wtype-limits]\n   assert(unicode <= 0x10FFFF && !(unicode >= 0xD800 && unicode <= 0xDFFF));\n                                           ^\n../src/libsass/json.cpp:299:64: warning: comparison is always true due to limited range of data type [-Wtype-limits]\n   assert(unicode <= 0x10FFFF && !(unicode >= 0xD800 && unicode <= 0xDFFF));\n                                                                ^\n../src/libsass/json.cpp:305:22: warning: comparison is always true due to limited range of data type [-Wtype-limits]\n   } else if (unicode <= 0x7FF) {\n                      ^\n../src/libsass/json.cpp:310:22: warning: comparison is always true due to limited range of data type [-Wtype-limits]\n   } else if (unicode <= 0xFFFF) {\n                      ^\nIn file included from ../src/libsass/json.cpp:26:0:\n../src/libsass/json.cpp: In function 'void to_surrogate_pair(uchar_t, uint16_t_, uint16_t_)':\n../src/libsass/json.cpp:351:18: warning: comparison is always false due to limited range of data type [-Wtype-limits]\n   assert(unicode >= 0x10000 && unicode <= 0x10FFFF);\n                  ^\n../src/libsass/json.cpp:351:40: warning: comparison is always true due to limited range of data type [-Wtype-limits]\n   assert(unicode >= 0x10000 && unicode <= 0x10FFFF);\n                                        ^\n../src/libsass/json.cpp: In function 'void emit_string(SB_, const char_)':\n../src/libsass/json.cpp:1214:42: error: cannot convert 'uint32_t_ {aka unsigned int_}' to 'uchar_t_ {aka unsigned char_}' for argument '2' to 'int utf8_read_char(const char_, uchar_t_)'\n           s += utf8_read_char(s, &unicode);\n                                          ^\nbinding.target.mk:128: recipe for target 'Release/obj.target/binding/src/libsass/json.o' failed\nmake: *_* [Release/obj.target/binding/src/libsass/json.o] Error 1\nmake: Leaving directory '/opt/ghost/content/themes/Decode-for-Ghost-master/node_modules/node-sass/build'\ngyp ERR! build error \ngyp ERR! stack Error: make failed with exit code: 2\ngyp ERR! stack     at ChildProcess.onExit (/opt/ghost/content/themes/Decode-for-Ghost-master/node_modules/node-sass/node_modules/pangyp/lib/build.js:271:23)\ngyp ERR! stack     at ChildProcess.emit (events.js:98:17)\ngyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)\ngyp ERR! System SunOS 5.11\ngyp ERR! command \"/opt/local/bin/node\" \"/opt/ghost/content/themes/Decode-for-Ghost-master/node_modules/node-sass/node_modules/pangyp/bin/node-gyp\" \"rebuild\"\ngyp ERR! cwd /opt/ghost/content/themes/Decode-for-Ghost-master/node_modules/node-sass\ngyp ERR! node -v v0.10.33\ngyp ERR! pangyp -v v2.1.0\ngyp ERR! not ok \nBuild failed\n. Was this issue ever resolved? I am witnessing the same problem.\ngcc (GCC) 4.9.1, SunOS 5.11 joyent_20141212T011737Z i86pc\n../src/libsass/json.cpp:159:18: error: conflicting declaration 'typedef uint32_t uchar_t'\n typedef uint32_t uchar_t;\n                  ^\nIn file included from /usr/include/sys/wait.h:37:0,\n                 from /usr/include/stdlib.h:41,\n                 from ../src/libsass/json.cpp:29:\n/usr/include/sys/types.h:98:23: note: previous declaration as 'typedef unsigned char uchar_t'\n typedef unsigned char uchar_t;\n                       ^\nIn file included from ../src/libsass/json.cpp:26:0:\n../src/libsass/json.cpp: In function 'int utf8_write_char(uchar_t, char_)':\n../src/libsass/json.cpp:299:18: warning: comparison is always true due to limited range of data type [-Wtype-limits]\n   assert(unicode <= 0x10FFFF && !(unicode >= 0xD800 && unicode <= 0xDFFF));\n                  ^\n../src/libsass/json.cpp:299:43: warning: comparison is always false due to limited range of data type [-Wtype-limits]\n   assert(unicode <= 0x10FFFF && !(unicode >= 0xD800 && unicode <= 0xDFFF));\n                                           ^\n../src/libsass/json.cpp:299:64: warning: comparison is always true due to limited range of data type [-Wtype-limits]\n   assert(unicode <= 0x10FFFF && !(unicode >= 0xD800 && unicode <= 0xDFFF));\n                                                                ^\n../src/libsass/json.cpp:305:22: warning: comparison is always true due to limited range of data type [-Wtype-limits]\n   } else if (unicode <= 0x7FF) {\n                      ^\n../src/libsass/json.cpp:310:22: warning: comparison is always true due to limited range of data type [-Wtype-limits]\n   } else if (unicode <= 0xFFFF) {\n                      ^\nIn file included from ../src/libsass/json.cpp:26:0:\n../src/libsass/json.cpp: In function 'void to_surrogate_pair(uchar_t, uint16_t_, uint16_t_)':\n../src/libsass/json.cpp:351:18: warning: comparison is always false due to limited range of data type [-Wtype-limits]\n   assert(unicode >= 0x10000 && unicode <= 0x10FFFF);\n                  ^\n../src/libsass/json.cpp:351:40: warning: comparison is always true due to limited range of data type [-Wtype-limits]\n   assert(unicode >= 0x10000 && unicode <= 0x10FFFF);\n                                        ^\n../src/libsass/json.cpp: In function 'void emit_string(SB_, const char_)':\n../src/libsass/json.cpp:1214:42: error: cannot convert 'uint32_t_ {aka unsigned int_}' to 'uchar_t_ {aka unsigned char_}' for argument '2' to 'int utf8_read_char(const char_, uchar_t_)'\n           s += utf8_read_char(s, &unicode);\n                                          ^\nbinding.target.mk:128: recipe for target 'Release/obj.target/binding/src/libsass/json.o' failed\nmake: *_* [Release/obj.target/binding/src/libsass/json.o] Error 1\nmake: Leaving directory '/opt/ghost/content/themes/Decode-for-Ghost-master/node_modules/node-sass/build'\ngyp ERR! build error \ngyp ERR! stack Error: make failed with exit code: 2\ngyp ERR! stack     at ChildProcess.onExit (/opt/ghost/content/themes/Decode-for-Ghost-master/node_modules/node-sass/node_modules/pangyp/lib/build.js:271:23)\ngyp ERR! stack     at ChildProcess.emit (events.js:98:17)\ngyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)\ngyp ERR! System SunOS 5.11\ngyp ERR! command \"/opt/local/bin/node\" \"/opt/ghost/content/themes/Decode-for-Ghost-master/node_modules/node-sass/node_modules/pangyp/bin/node-gyp\" \"rebuild\"\ngyp ERR! cwd /opt/ghost/content/themes/Decode-for-Ghost-master/node_modules/node-sass\ngyp ERR! node -v v0.10.33\ngyp ERR! pangyp -v v2.1.0\ngyp ERR! not ok \nBuild failed\n. ",
    "candid82": "I don't think it's \"downstream\" error. I get this error on SmartOS when I run make inside libsass directory:\ng++ -Wall -O2 -DLIBSASS_VERSION=\"\\\"3.2.0-beta.5-16-ge60a\\\"\" -std=c++0x -I /root/libsass/ -fPIC -c -o json.o json.cpp\njson.cpp:159:18: error: conflicting declaration 'typedef uint32_t uchar_t'\nIn file included from /usr/include/sys/wait.h:38:0,\n                 from /usr/include/stdlib.h:40,\n                 from json.cpp:29:\n/usr/include/sys/types.h:98:23: error: 'uchar_t' has a previous declaration as 'typedef unsigned char uchar_t'\njson.cpp: In function 'void emit_string(SB*, const char*)':\njson.cpp:1214:42: error: cannot convert 'uint32_t* {aka unsigned int*}' to 'uchar_t* {aka unsigned char*}' for argument '2' to 'int utf8_read_char(const char*, uchar_t*)'\nMakefile:210: recipe for target 'json.o' failed\nmake: *** [json.o] Error 1\n(gcc 4.7.3, SunOS 5.11 joyent_20131227T234851Z i86pc i386 i86pc Solaris)\n. @mgreter json.cpp requires uchar_t to be 32 bit. The definition in types.h makes it 8 bit. So no, #ifndef won't fix the issue.\n. @xzyfer cool. Do you want me to remove _t suffix as @QuLogic suggested, so that the type name becomes uchar32? I thinks it's a good idea since _t is indeed reserved in POSIX. Alternatively, the entire typedef can be dropped and uint32_t can be used directly. uchar32_t is only used in json.cpp file, and uint32_t is used throughout the rest of the codebase, so this might be the best way to address the issue. I'll be happy to make the change, just let me know which way you want to go.\n. @xzyfer not sure which way you wanted to go, but I went with using uint32_t directly and got rid of the alias. So this is essentially identical to @saper's PR (with the comments fixed so it passes on Windows).\n. ",
    "anlutro": "http://sassmeister.com/gist/f0f08a8f6706f4e573e8\nAs you can see, because it says @extends instead of @extend the Ruby Sass parser just leaves the line alone, assuming it's valid CSS. Compiling the same Sass with libsass yields a compiler error for the reasons stated above.\n. Awesome. I love using sassc, keep up the great work :)\n. @QuLogic I did that originally but thought it might be misleading because it is originally the saturation of the colour passed to the function.\nAs for clamping saturate(), it actually seems to be working fine - saturate(red, 50%) still returns red.\nsaturate() on grey colours behaves weirdly in my opinion, but it behaves weirdly in ruby sass so I suppose it'd be bad form to try and change it in libsass.\nI'll see if I can make a PR to the spec.\n. Looks like I was wrong about saturate() not having the same issue. I can fix that as well I suppose.\n. OK, there is one more problem I have to fix - desaturate(saturate(#999, 1%), 10%); should return #999999 but returns #90a2a2.\n. Fixed and squashed commits, everything should be OK now.\n. Fixed, thanks.\n. Anything blocking this?\n. Ah, I see. I've been compiling all the time so releases aren't a huge deal\nto me personally - I'll just keep rebasing against master until then, I was\njust curious.\nOn Sun, 22 Feb 2015 00:56 Michael Mifsud notifications@github.com wrote:\n\nThanks for you work!\nThis is @mgreter https://github.com/mgreter's area and he is currently\nbusy with #899 https://github.com/sass/libsass/pull/899\nWe'll make sure this makes it into the next release.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/866#issuecomment-75401690.\n. If you remove the @function -test directive you'll see that call('-test') still works. So underscores in @function directives are being replaced with dashes internally, but not in call() and function-exists() calls.\n. Sure. Do you know which directory such a spec should go into? spec/libsass, spec/libsass-todo-issues?\n. Done: https://github.com/sass/sass-spec/issues/272\n. Does it work in ruby sass? I don't feel strongly either way about it working or not, I only included it because I know it worked in previous versions of libsass.\n. Well, I installed ruby and the sass gem, and the test case I provided above seems to work.\n\n$ ruby -v\nruby 1.9.3p194 (2012-04-20 revision 35410) [x86_64-linux]\n$ sass -v\nSass 3.4.13 (Selective Steve)\n$ cat test1.scss \n.foo { @import \"test2\"; }\n$ cat test2.scss \n&.bar { color: red; }\n$ sass test1.scss \n.foo.bar {\n  color: red; }\nEDIT: I also installed Sass 3.2 and it works fine there as well.\n. Oddly enough, the above now works when I remove the \\ - maybe this is intentional? I actually prefer it without the \\, but I still feel that it should be allowed - if it's not too much work to implement.\n. https://github.com/sass/sass/issues/1237 may be of interest regarding the backslash. It was my understanding that backslashes to denote multiline strings was valid CSS and should therefore be valid Sass/SCSS.\n. Agree with this. Some information on how to enable debugging would also be nice. I tried figuring out the makefile on how to turn on debug flags but wasn't able to.\n. Seems similar in nature to https://github.com/sass/libsass/pull/865\n. Was able to fix it with this dirty hack, but not sure if there's a more underlying issue that needs to be adressed.\n$ git diff\ndiff --git a/src/sass2scss.cpp b/src/sass2scss.cpp\nindex dd8cbc3..67a4cfe 100644\n--- a/src/sass2scss.cpp\n+++ b/src/sass2scss.cpp\n@@ -570,7 +570,8 @@ namespace Sass\n                                sass.substr(pos_left, 5) == \"@warn\" ||\n                                sass.substr(pos_left, 6) == \"@debug\" ||\n                                sass.substr(pos_left, 6) == \"@error\" ||\n-                               sass.substr(pos_left, 8) == \"@charset\"\n+                               sass.substr(pos_left, 8) == \"@charset\" ||\n+                               sass.substr(pos_left, 8) == \"@include\"\n                        ) { sass = indent + sass.substr(pos_left); }\n                        // replace some specific sass shorthand directives (if not fallowed by a white space character)\n                        else if (sass.substr(pos_left, 1) == \"=\" && sass.find_first_of(SASS2SCSS_FIND_WHITESPACE, pos_left) != pos_left + 1)\n. Can input be negative? I assume rgb_to_hsl will never return a colour with negative saturation, and if you pass a negative number to the saturate() function, an error will be thrown.\n. Yikes, stupid mistake. Glad you spotted it.\n. @QuLogic you were right, though the comment and the way it was done before was a bit misleading. Basically if you desaturate a colour with 1% saturation by 10% it would wrap around and the bug would appear again.\n. ",
    "di5abled": "great thank you, I was looking for an existing issue but overlooked it. \nI'll close this one for now :)\n. ",
    "strarsis": "Can such a custom reader re-use the libsass parser, too, when reading the file in question?\nUsing an extra instance of libass just to get the AST for the imports would double the parse time.\nCaching/invalidation tools like gulp-progeny use regexps to extract the used import paths.\nA full libsass parser, preferably the same one as used for processing the sass anyway, \nwould be able to handle all possible cases including syntax error messages.\nWith best regards\n. Thank you for the response.\nWhat I find annoying is the usage of maps just for this specific feature is quite redundant:\n$positions: map-merge($positions, (\n  offset-#{$from}: $new-value\n));\nSome kind of set-var function would make it easier:\n$positions: set-var(offset-#{$from}, $new-value, $positions);. ",
    "TheDutchCoder": "Yes I am using the latest version (1.3.2)\nEdit: I've narrowed down the issue to this debug mixin:\n``` sass\n@mixin display-mq() {\n@each $q in $media-queries {\n$query: map-get($media-queries, $q);\n\n@media #{$query} {\n  content: '#{$q}: #{map-get($media-queries, $q)}';\n}\n\n}\n}\n```\n$media-queries is a map of key/value pairs.\nSo far the issue seems to be with the @each inside the mixin.\n. Okay got it, it seems when looping through a map with @each, I need to specify two variables, so the correct code would be:\n``` sass\n@mixin display-mq() {\n@each $name, $query in $media-queries {\n@media #{$query} {\n  content: '#{$name}: #{$query}';\n}\n\n}\n}\n```\n. It's in my comment above the solution? :)\nI'll repeat, just in case ;)\nBAD\n``` sass\n@mixin display-mq() {\n@each $q in $media-queries {\n$query: map-get($media-queries, $q);\n\n@media #{$query} {\n  content: '#{$q}: #{map-get($media-queries, $q)}';\n}\n\n}\n}\n```\nGOOD\n``` sass\n@mixin display-mq() {\n@each $name, $query in $media-queries {\n@media #{$query} {\n  content: '#{$name}: #{$query}';\n}\n\n}\n}\n```\nA little more background: in the broken example, I loop through the map and then map-get every individual item. This is terrible and unnecessary, but I was tired I guess. It would also technically look like $q: foo: 'bar' which doesn't make sense and was the reason for the error I presume.\nIn the working example I bind the key/value pairs to their own variables (like I should).\nIt might be a bug, although I think it makes sense to at least throw an error when this happens (and a little more descriptive one if possible).\n. ",
    "yonidor": "+1 encountered the same issue\n. ",
    "jananananana": "+1, using Sass 3.4, seeing same issue\n. ",
    "rawalter21": "Below is another example of this problem:\n``` sass\n@mixin test($var) {\n    @debug \"Value is #{$var}\";\n}\n@include test(notFalse);\n```\nThe output of the debug will be \"Value is false\" when it should be \"Value is notFalse\"\n. ",
    "satya164": "Similar issue here. I have something like,\n```\n$settings: (general, profile, notification);\n@each $setting in $settings {\n    &.list-item-#{$setting}-settings { background-image: url(../../img/client/icons/#{$setting}-settings.svg); }\n}\n```\nIn the output, I get \"false\" instead of \"notification\".\nI tried with other strings which start with \"not\", and I get the same result.\n. ",
    "asottile": "It seems to only fail with MSVC and the compile line I had above (can drop the void foo() and just pass NULL instead, I was testing something else there and forgot to remove it).\n. I've simplified my reproduction (eliminated the cookie argument).  Running bld.bat and then main.exe will crash :(\n. Here's a run in appveyor demonstrating the issue: https://ci.appveyor.com/project/asottile/libsass/build/1.0.9\n. Oh man, the problem has been staring me in the face all day and I didn't even notice it: C:\\Program Files (x86)\\Microsoft Visual Studio 12.0\\VC\\INCLUDE\\xlocale(337) : warning C4530: C++ exception handler used, but unwind semantics are not enabled. Specify /EHsc.  Adding this flag fixes the the consumption of 0xBAADF00D :D.\nMan, warning fatigue sucks :(\n. @xzyfer I didn't see an obvious way to add a regression test for compressed mode, could you give me a pointer or two?\n. Yeah that's fine, I'm not too concerned about this (we've identified as not a blocker from moving from pyscss to libsass), just figured I'd be a good sumaritan and report :)\n. This is pretty important for our build as we use @error as a way to fatally terminate compilation.  Silently printing and not indicating there is an error is not really going to work for us (and is pretty unfortunate behavior!)\n. Sure sure, I'm going to try and look into this myself as well :)\n. Yep I'm pretty familiar with the interface ( I implemented python bindings with custom functions for 3.1.0 here: https://github.com/dahlia/libsass-python/pull/44/files ).  I'll hopefully have something by end of tonight.\n. How should I regression test this?\n. How can I avoid the undefined behaviour introduced by mismatched malloc() + delete[]: http://stackoverflow.com/a/2570224/812183\n. Couldn't the strdup call be moved into sass_make_data_context?  Avoiding transferring of ownership would be ideal :)\n. I can't give control because I'm borrowing the reference myself (from a PyObject* bytes object which is being refcounted and managed by the python runtime gc mechanism).  I still think it's a bit of a shame to trade performance for UB, but I'd understand if you'd rather not change it.  const char* would be even better though :)\n. I'm going to make a copy, but if the library was making the copy it could control how it was copied and avoid malloc / delete[] mismatch. Not a really big deal though, I'll live :)\n. ah yeah I've made an unused variable.  I'll remove that.  You can see the sample output in the description of the PR\n. fixed!\n. I've bisected it to this commit: 925220c57cfc9e3bc44c317eba473733194069c4\nLooking at the commit it's not obvious to me what changed...\n@xzyfer any ideas?\nUsing this (yes it leaks memory):\n``` c++\n// entries/main1.cpp\ninclude \"sass_context.h\"\ninclude \ninclude \ninclude \nint main() {\n    char src = (char)malloc(sizeof(char) * 50);\n    strcpy(src, \"a { width: 3.0px }\");\n    struct Sass_Data_Context context = sass_make_data_context(src);\n    sass_compile_data_context(context);\n    struct Sass_Context ctx = sass_data_context_get_context(context);\n    std::string output = sass_context_get_output_string(ctx);\n    std::cout << output << std::endl;\n    return static_cast(output != \"a {\\n  width: 3px; }\\n\");\n}\n```\n``` Makefile\nC_SOURCES := $(wildcard .c)\nC_OBJECTS = $(patsubst %.c,build2/c/%.o,$(C_SOURCES))\nCPP_SOURCES := $(wildcard .cpp)\nCPP_OBJECTS = $(patsubst %.cpp,build2/cpp/%.o,$(CPP_SOURCES))\nMAIN_SOURCES := $(wildcard entries/*.cpp)\nOUTS = $(patsubst entries/%.cpp,%.out,$(MAIN_SOURCES))\nall: main1.out\nbuild2/c/%.o: %.c\n    @mkdir -p build2/c/\n    gcc -pthread -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fPIC -I./ -c $^ -o $@ -c -O2 -fPIC -std=c++0x -Wall -Wno-parentheses\nbuild2/cpp/%.o: %.cpp\n    @mkdir -p build2/cpp/\n    gcc -pthread -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fPIC -I./ -c $^ -o $@ -c -O2 -fPIC -std=c++0x -Wall -Wno-parentheses\nbuild2/mains/%.o: entries/%.cpp\n    @mkdir -p build2/mains\n    gcc -pthread -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fPIC -I./ -c $^ -o $@ -c -O2 -fPIC -std=c++0x -Wall -Wno-parentheses\nmain1.out: build2/mains/main1.o $(C_OBJECTS) $(CPP_OBJECTS)\n    g++ -pthread -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-Bsymbolic-functions -Wl,-z,relro $^ -L./libsass -o $@ -fPIC -lstdc++ -ldl\n.PHONY: clean\nclean:\n    rm -rf build2 main1.out\n```\n``` sh\nscript.sh\n(make -f Makefile2 clean && make -f Makefile2 -j 12 && ./main1.out) || false\n```\nshell\n$ git bisect start\n$ git bisect good 3.1.0\n$ git bisect bad 3.2.4\n$ git bisect run ./script.sh\n. Well, now I can't reproduce the ruby behaviour.  I seem to consistently be getting the 3.0px output in ruby-sass, though I'm on a different machine...\n. Seems I had my binaries confused :S ruby-sass actually compiles the same as libsass, so this is less of a regression and more of a match-ruby I guess :)\n. I should clarify, I made a mistake when creating the ticket (probably two terminals, with one where I accidentally had alias sass=sassc and the other where it was unaliased).\nThe behaviour in 3.1 was \"wrong\" or \"not matching ruby sass\", and in 3.2 it now matches-sass.  So ignoring ruby-sass it looks like a regression, but in reality it's actually a bugfix.  I'll update the original post so it makes more sense.\n. fwiw here's an example from our tests in libsass-python of a map with a non-string key: https://github.com/dahlia/libsass-python/blob/58d34fb0811ddb8cf4c700cf49654e85b4e01af7/sasstests.py#L1231 (the test in this case is because python dict is mutable and therefore unhashable so we needed a separate representation)\nAdmittedly the example is a bit contrived.\n\nwhat's the idea of having a map as a key in a map\n\nI have yet to come across an actual situation where this is useful :)\n\nIn what Situation would I even work with a map (as opposed to a list)?\n\nOne example from some code I've worked with is to map string values to other things (such as z indexes etc.)\n. @jorgehatccrma the project you're looking for is https://github.com/dahlia/libsass-python :)\n. Whichever editor you're reading the outputted source in is not respecting the UTF-8 encoding.\nApologies, the next bit is python (python2), but that's the easiest way to express the difference.  Without knowing python, what you need to know is u'\\u....' is a unicode literal containing a unicode escape (the equivalent in css is '\\...'.\n``` python\nThe input character\n\n\n\nprint(u'\\ue003')\n\ue003\n\n\n\nThe UTF-8 bytes printed\nThis should appear the same as above\n\n\n\nprint(u'\\ue003'.encode('UTF-8'))\n\ue003\n\n\n\nThe UTF-8 byte representation\n\n\n\nu'\\ue003'.encode('UTF-8')\n'\\xee\\x80\\x83'\n\n\n\nThe UTF-8 bytes misinterpreted as cp1252 (windows default encoding)\n\n\n\nprint(u'\\ue003'.encode('UTF-8').decode('cp1252'))\n\u00ee\u20ac\u0192\n```\n. Do you have a charset on your page such as:\n\n\n\nhtml\n        <meta charset=\"utf-8\">\n. Possibly related: #1235\n. Can you produce a short example html + css. I'm failing to reproduce given the resources on their website\n. fwiw I'm pretty sure you're missing your charset on your html document.\nCompare renderings of these two:\nhtml\n<!doctype html>\n<html>\n<head>\n    <style>\n        div:after { content: '\u2603'; }\n    </style>\n</head>\n<body>\n    <div>test</div>\n</body>\n</html>\n\nhtml\n<!doctype html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <style>\n        div:after { content: '\u2603'; }\n    </style>\n</head>\n<body>\n    <div>test</div>\n</body>\n</html>\n\n. This seems to break us here: https://github.com/dahlia/libsass-python/issues/99\nI can probably update that to use a newer VS without issue.  I think most (if not all) of our windows consumers install via python wheels anyway.\n. fwiw, we dropped VS2013 and are now using VS2015 :)\n. This is against 3.3.2\n. Fixed in master, thanks!\n. bisect tells me this is the first commit showing this behaviour: 964613e034a33536df3dc5a8ccc0c239eb2c7ac2 @mgreter \n. Sounds great, I added a spec for it here: https://github.com/sass/sass-spec/pull/724\n. Thanks again! Just what I was looking for\n. Haven't found anything concrete yet, but this commit seems to (somehow?) contribute to a stack overrun: https://github.com/dahlia/libsass-python/pull/149#issuecomment-213987628\nHopefully I'll have more information soon :)\n. Will do and report back.  I'm out of space on my SSD so I'll probably need to spin up a VM\n. Changing to /GR does the trick! -- I think I can fix that up in the flags I pass to setuptools (python).\nThanks for the tip!\n. Hmmm... this is slightly difficult to do since those are some defaults that are difficult to override -- any idea why this commit breaks /GL ?\n. <3 you're the best\n. I do remember something similar to this in some code I wrote a long while back -- I thought the standard protected against the string temporary being collected but perhaps not.\nThis patch seems to make the code succeed:\n``` diff\ndiff --git a/src/sass_context.cpp b/src/sass_context.cpp\nindex e3f34af..9105866 100644\n--- a/src/sass_context.cpp\n+++ b/src/sass_context.cpp\n@@ -140,7 +140,8 @@ extern \"C\" {\n       json_append_member(json_err, \"message\", json_mkstring(e.what()));\n       json_append_member(json_err, \"formatted\", json_mkstring(msg_stream.str().c_str()));\n       try { c_ctx->error_json = json_stringify(json_err, \"  \"); } catch(...) {}\n-      c_ctx->error_message = sass_copy_c_string(msg_stream.str().c_str());\n+      std::string s = msg_stream.str();\n+      c_ctx->error_message = sass_copy_c_string(s.c_str());\n       c_ctx->error_text = sass_copy_c_string(e.what());\n       c_ctx->error_status = 3;\n       c_ctx->output_string = 0;\n```\n. oh sweet, we came to the same conclusion :D\n. Hi @xzyfer Thanks for all the awesome work :)\nWondering when I can expect 3.3.7 so I can plan some time to follow up\n. fwiw, I've verified output against ~70kloc of scss via master of https://github.com/dahlia/libsass-python \ud83d\udc4d . I'm debugging away at this, having a difficult time getting the link flags correct (I seem to be tickling some other unrelated compiler bug which is preventing me from properly linking)\n. 1 in the morning here, I'll look at this tomorrow.  Sorry for the incomplete bug report, thought I'd be able to reuse my test harness from last time though I was unable to which has delayed my debugging significantly :(\n. I've updated with my reproduction, I'm more confused than last time :S\n. Stupidly this fixes it:\ndiff\n$ git diff -w\ndiff --git a/src/sass_context.cpp b/src/sass_context.cpp\nindex df92021..dc6f353 100644\n--- a/src/sass_context.cpp\n+++ b/src/sass_context.cpp\n@@ -125,7 +125,8 @@ extern \"C\" {\n       json_append_member(json_err, \"message\", json_mkstring(e.what()));\n       json_append_member(json_err, \"formatted\", json_mkstream(msg_stream));\n       try { c_ctx->error_json = json_stringify(json_err, \"  \"); } catch(...) {}\n-      c_ctx->error_message = sass_copy_string(msg_stream.str());\n+      std::string msg_stream_str = msg_stream.str();\n+      c_ctx->error_message = sass_copy_string(msg_stream_str);\n       c_ctx->error_text = sass_copy_c_string(e.what());\n       c_ctx->error_status = 1;\n       c_ctx->error_file = sass_copy_c_string(e.pstate.path);\nDoesn't feel correct though, are we fighting inlining maybe?\n. I tried poking it some more and couldn't really get anything to work (tried __declspec(noinline), tried making the function take the stringstream instead, couldn't really think of a way to write a macro to do this.  I wonder if trying to support /DEBUG is entirely sadness and I should look into hacking that out from our end...\n. I'm opting to disable /DEBUG under msvc: https://github.com/dahlia/libsass-python/pull/167 (via the /Od flag)\n. Unless you guys are interested in supporting /DEBUG I think this can be closed (perhaps documented somewhere that it is not supported?).\n. For what it's worth, my patch above worked in one part of the codebase but failed in another so it isn't really a solution.  I wonder what the maximum codesize msvc bug reports can be, heh.\nWe've turned off debug builds so this is much lower priority than it was when I created it (I didn't think that setuptools had enough control over distribution-set compile flags, I was wrong!).. yep sorry about this, we forgot to call sass_option_set_output_path so the source maps were being made relative to the input file\n. Here's my bisect:\n```console\n$ cat asottile/test.sh\n!/usr/bin/env bash\n(make clean && make) || exit 125\n(\n    set -ex\n    cd asottile\n    g++ -I../include main.cpp ../lib/libsass.a -ldl\n    ./a.out\n) || false\n```\nAnd my bisect\nconsole\n$ git bisect start\n$ git bisect good 3.4.3\n$ git bisect bad 3.4.4\n$ git bisect run asottile/test.sh\nAnd it comes to:\n```\n...\n12d8763b7f6851f0dbabdec4b47f92923a57e449 is the first bad commit\ncommit 12d8763b7f6851f0dbabdec4b47f92923a57e449\nAuthor: Marcel Greter marcel.greter@ocbnet.ch\nDate:   Thu Dec 29 01:41:40 2016 +0100\nRemove current working directory from search paths\n\nSass 3.4: The current working directory will no longer\nbe placed onto the Sass load path by default. If you\nneed the current working directory to be available,\nset SASS_PATH=. in your shell's environment.\n\n```\nhttps://github.com/sass/libsass/commit/12d8763b7f6851f0dbabdec4b47f92923a57e449\nPerhaps the least surprising commit to have found from this :)\n@mgreter I assume this shouldn't have landed in the libsass 3.4 branch? (and maybe not even at all? I don't seem to see it called out in the 3.5 changelogs either). @xzyfer what branch is being maintained for 3.4 (3.4-stable, 3.4, or 3.4.x)? I can make a PR against whichever. Oh, I see it is already reverted in fd5158647cc9c63e44450378eb9cebc79b5a3b3e -- just unreleased :). No problem, have a good holiday!\nOn Aug 3, 2017 11:45 PM, \"Michael Mifsud\" notifications@github.com wrote:\n\nI'm not going to get this sorted before going away sorry. I'll take\nanother look next week.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2411#issuecomment-320148802, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ABugnxxpEBKbAFSMfPnEJk87HWS7xTFHks5sUpPHgaJpZM4N5YR-\n.\n. (no rush!) any eta on when 3.4.6 will be released?. No problem!  Thanks for the release!. I've either simplified the reproduction or found a separate bug that's suspiciously similar: https://github.com/sass/libsass/issues/2429. A workaround (I think?) is to use input[type=\"url\"] { ... } instead.. Seems an exact duplicate of https://github.com/sass/libsass/issues/2429 -- a workaround (for now) is to use 3.4.4 or the betas until 3.4.6 is released. @plavcik our project is tracked here: https://github.com/dahlia/libsass-python. @plavcik also note that we were originally using -std=c++0x and switched to the gnu flag to fix an issue: https://github.com/dahlia/libsass-python/pull/197. tbh I can't actually find anything that says it's deprecated (googling deprecated c++0x leads to this issue in fact!). Spec created: https://github.com/sass/sass-spec/pull/1160. PR created: https://github.com/sass/libsass/pull/2463. The build seems to have timed out?  Perhaps it can be restarted. sweet thanks!. I haven't bisected this yet, but I suspect https://github.com/sass/libsass/commit/93c81fe9b1de3788f22a41e8165b0c233472bc7a\n\nCC @mgreter . @mgreter awesome, thanks for the quick fix :). If we're going based on sass-lang, they would need an explicit @charset directive for anything other than UTF-8.  (though that mentions some ruby-specific things -- perhaps there needs to be a better \"language\" spec for things like this).. Bisects to efd97dae376de50b3e6ed724337c4f274a21491d. Thanks for the heads up :). ",
    "jonrimmer": "Thanks. I can live without sourcemaps if necessary, but with over 100 source .scss files, they're a definite aid to debugging. I'll try stripping out the charset, and make sure the encoding is specified via the HTML or a header.\n. ",
    "phlorie": "Good to know.\nIs there currently a version that can be used with grunt ? Or an alternative ? \nAny documentation I found until now uses the same command.\nThank you\n. ",
    "GawainLynch": "Derp! The CentOS 6 build machine I used a patch similar to the one that @am11 linked! I just retried on a vanilla install (gcc-* 4.4.7), and it indeed won't build. \nAs for CentOS 7, that comes with GCC 4.8. I think I put GCC 4.6 as the minimum from something in the docs somewhere, and don't have a 4.6 install handy to test.\nShould I just bump this to 4.7?\n. Updated and rebased on master.\n. With RPM packages the -n is the packaging number that is incremented for each build of that specific version.\n. ",
    "ahacking": "Nice work, thanks!\n. ",
    "keoghpe": "grunt-sass: 0.14.2\nnode-sass: 0.9.3\n. ",
    "rocco": "just fyi:\neven current yeoman generators (e.g. generator-webapp@0.5.1) might depended on  grunt-sass@0.14.x wich depends on node-sass: 0.9.3. -> edit your package.json and npm install to upgrade\n. ",
    "tristanlins": "Thanks for the explanation. :+1: \nI fully understand that writing a different parser need much time no one have for the moment.\nMaybe this will be a feature in the far future, if someone find the time to make it real :-)\nThanks for the great work btw. ^^\n. pong @xzyfer :-)\n. While testing this, I find out that this wont work.\nThe @import statements are evaluated before any custom function. In result the import stack is always empty when the custom functions are called.\n. > and I don't see a reason custom functions would need that information.\nWe need this information because we need to calculate relative paths. Not from the file itself, but from the context the file is defined in. And to know the context, we need to know which file calls the function.\nIts a bit complex, because we deliver \"virtual\" resources with out application and we have a function very similar to the *-url compass functions. Expect that our urls depend on the file's context, not a global definable location... it's a lot of magic ;-D\n. > @tristanlins can you supply an example where this fixes source map issues?\nIf you have a source.scss like this:\ncss\n// foo is imported by a custom importer\n@import \"foo\";\nand a custom importer that create such an import:\nc\nsass_make_import(\"/some/path/to/foo.scss\", \"http://example.com\", \"body { background: red }\", \"\");\nthe expected sourcemap may look like this:\njson\n{ \"sources\": [\"/some/path/to/foo.scss\"] }\nbut I got:\njson\n{ \"sources\": [\"foo\"] }\nI can try to build a simple C example, but I'm not so familiar with C. It's more try-and-error ^^\n. > From a cursory look I would have expected the current behaviour to be correct.\nCompare the Context::add_source declaration at context.cpp:250, with the call at parser.cpp:258.\nFor me, it looks as if the parameters are reversed.\n. This is realy bad, because we deliver the assets from a VFS and need a special rewriting for url(...) urls. Is there another way / callback to manipulate how libsass handle url(...) 's? (expect regex'ing the source or css?)\n. Okay, thanks for the clarification. :-)\n. ",
    "camflan": "No problem. I deleted all traces of both sassc and libsass, upgraded homebrew and reinstalled. Still getting it bound to 3.0.3\nI'll keep fiddling with it, unless you have another idea. thanks!\n\n. That's what I've been looking for. I've checked all of the /usr/ dirs, everything is symlinked to /usr/local/Cellar/libsass/3.1.0\nAny other places it could be?\n. no ldd on mac, but here's what I got from otool\n\n. It looks like Libsass 3.2.5 on SassMeister does not display this bug\nPlay with this gist on SassMeister.\n\n. ",
    "dhruvbhatia": "Experiencing the same issue:\n\n. ",
    "callmecavs": "@xzyfer here's the pr: https://github.com/sass/sass-spec/pull/268\n. ",
    "joliss": "\nThis gives it away that the source file \"app.scss\" is indeed not accessible if you only serve dist\n\nExactly. This appears to be a relatively common scenario; let me state it explicitly: \"We're generating a dist directory to be deployed on a web server (for development or production). We want source maps to work.\"\nIt seems to me that the \"sourcesContent\" key was added to the source map spec to address the issue of sources (like app.scss) not being available, by embedding everything in the .map file. (I also have \"sourcesContent\" enabled in my examples above.) The path names listed in \"sources\" are therefore mostly \"decorative\" in that they affect how paths are displayed in devtools; we still need to get them right though.\nIt's not clear to me at this point what the expected correct behavior even is, and that's the question I'm raising with this issue. Like, what do we want the source map to look like in a scenario like this? Is the source map generated by \"better-output.js\" in my example really the right way, with a file:/// URL for sourceRoot and all? I'm a bit dubious.\nWe would like to be able to have good source map support in downstream packages like broccoli-sass to make it \"just work\", but at the moment we don't really know what the correct output for this scenario would even look like. Perhaps it might make sense to link up with people working on the Firefox or Chrome devtools as well (does Paul Irish still work on this stuff?)... I'm not volunteering unfortunately, but I just wanted to bring up this problem.\n. ",
    "mdix": "Any workarounds for the time being?\n. Darn... of course it can be inverted. Thanks for your help!\n. ",
    "npiguet": "I just managed to get a little more information to locate my error: It seems that the truncation of the numbers happens at parse time (as opposed to output time), because of the two following things:\n- the value of precision has no effect on the output\n- the value of fractions are calculated based on the truncated version of the number (example below)\n.something {\n  margin: (4.5/9);\n}\nis compiled to\n.something {\n  margin:0.44444 }\nwhen the value of the margin should clealy be 0.5, and not 0.4444 (Which by the way is equal to 4/9, so the 4.5 value was first truncated to 4 and then the fraction was calculated based on the truncated number.)\nI can't figure out where the problem could be coming from by looking at the libsass source code. Could I be missing some compiler flag, or could I possibly have a version of some library (maybe the one that is used to convert strings to numbers) that is not what libsass expects?\n. Actually, I just found the source of the problem and it is indeed a bug in libsass. In version 3.1.0 it occurs at eval.cpp:627\ncase Textual::NUMBER:\n        result = new (ctx.mem) Number(t->path(),\n                                      t->position(),\n                                      atof(num.c_str()),\n                                      \"\",\n                                      zero);\nthe problem here is that atof is locale dependent. On my system, the locale is the following: \n$ locale\nLANG=en_US.UTF-8\nLANGUAGE=en_US\nLC_CTYPE=\"en_US.UTF-8\"\nLC_NUMERIC=fr_FR.UTF-8\nLC_TIME=fr_FR.UTF-8\nLC_COLLATE=\"en_US.UTF-8\"\nLC_MONETARY=fr_FR.UTF-8\nLC_MESSAGES=\"en_US.UTF-8\"\nLC_PAPER=fr_FR.UTF-8\nLC_NAME=fr_FR.UTF-8\nLC_ADDRESS=fr_FR.UTF-8\nLC_TELEPHONE=fr_FR.UTF-8\nLC_MEASUREMENT=fr_FR.UTF-8\nLC_IDENTIFICATION=fr_FR.UTF-8\nLC_ALL=\nSpecifically, LC_NUMERIC specifies the french locale. In the french locale, the decimal separator is , not .. Therefore, atof stops parsing the number when it encounters ., because . is not a valid character for numbers in the french locale.\nThere are multiple other usages of atof that would also need to be fixed.\nI think this issue can be re-opened now.\n. By the way, the best way to reproduce this reliably on any system for me was to modify sassc.c as follow:\n- add #include <locale.h>\n- add setlocale(LC_ALL, \"\"); as the first line of the main() function.\nThen run \nmake -C libsass; make -C sassc\nexport LC_ALL=\"fr_FR.utf8\"\nsassc/bin/sassc test.scss\nwhere the contents of test.scss was \n.something {\n        margin: 2.3px;\n}\n. This has been tested and fixes the problem on my machine.\n. ",
    "willin": "```\n\nnode-sass@2.0.1 install /Users/willin/Documents/wulian/html/router-manage-2/node_modules/node-sass\nnode scripts/install.js\n\nCan not download file from https://raw.githubusercontent.com/sass/node-sass-binaries/v2.0.1/darwin-x64-iojs-1.4/binding.node\n\nnode-sass@2.0.1 postinstall /Users/willin/Documents/wulian/html/router-manage-2/node_modules/node-sass\nnode scripts/build.js\n\nmodule.js:322\n    throw err;\n          ^\nError: Cannot find module '/Users/willin/Documents/wulian/html/router-manage-2/node_modules/node-sass/node_modules/pangyp/bin/node-gyp'\n    at Function.Module._resolveFilename (module.js:320:15)\n    at Function.Module._load (module.js:262:25)\n    at Function.Module.runMain (module.js:485:10)\n    at startup (node.js:112:16)\n    at node.js:863:3\nBuild failed\n```\n. ",
    "WillsB3": "I've also been seeing this issue. Looks like the point at which this broke was the 3.3.5 release. \nI've been using gulp with node-sass and my test case compiles fine with node-sass 3.4.2 which I believe uses LibSass 3.3.2 under the hood.\nWhen I switch to using node-sass v3.5.1(which uses LibSass 3.3.5) compiling fails with the following error:\n```\nMessage:\n    sass/test.scss\nError: Base-level rules cannot contain the parent-selector-referencing character '&'.\n   Backtrace:\n    sass/test.scss:2, in mixin `my-mixin`\n    sass/test.scss:7\n    on line 2 of sass/test.scss\n\n\n\nhtml & {\n   --^\n```\n\n\nHere is my minimal test case: https://github.com/WillsB3/node-sass-issue/tree/master.\n. @xzyfer Good shout. Just checked and this test fails to compile with Ruby Sass with the same error. Looks like Libsass must have incorrectly been compiling this to something that wasn't actually valid...\n. ",
    "Haemoglobin": "Thanks for the fast reply - and putting the keys in as strings works great as a workaround :)\nCheers\n. ",
    "sindresorhus": "@mgreter I know we can implement it ourselves, but that means every consumers has to manually implement it. Would be nice if libsass came with a nice output. Consumers are still free to create their own based on the error info.\n. :+1: Yes, every consumer could do this, but they would probably do it badly and it would be sad to have so much duplicated code.\n. ",
    "ckruse": "Oh, I forgot to mention: I reproduced the problem using sassc and the input $foo:123px; .m { width:$foo; }\n. Oh, I forgot to mention: I reproduced the problem using sassc and the input $foo:123px; .m { width:$foo; }\n. The problem is not the missing strdup() call but the mix of malloc()/realloc() and delete. This is forbidden and leads to undefined behaviour. See the valgrind output. It doesn't make sense to expect a C API to get memory allocated by new since C doesn't know about it. It's a C++ feature. (Also this is not my source, I just discovered the problem)\nAm 12. M\u00e4rz 2015 23:00:30 MEZ, schrieb Marcel Greter notifications@github.com:\n\nAre you using latest master (3.2 beta)? Because there was a breaking\nchange in this direction:\nChange in sass_make_data_context - libsass now really takes memory\nownership\nThe interface always was intended to be char*, but we messed that up\nand actually made a copy ourself (which would have meant the arg should\nhave been const char* #869). The intention always was that\nimplementors can pass the memory ownership to libsass, since we want to\navoid a copy if possible. This basically just means that you probably\nhave to provide a copy to libsass yourself.\nC\n// ctx = sass_make_data_context(source_string); // old\nctx = sass_make_data_context(strdup(source_string)); // new\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/940#issuecomment-78646696\n\n\nVia mobile thus short. Sorry.\n. Does sources only contain memory given by the C API? If yes then you should, yes. Regarding sassc working: yes it works, but it segfaults in the clean-up code.\n. If the sources vector contains mixed memory (some allocated with\nnew, some allocated with malloc/realloc) you need to come up with\na strategy for that. You mustn\u2019t use free on new allocated memory\nand you mustnt usedeleteonmallocallocated memory. C++ memory\nmanagement differs from C memory management. This is important.\n. @rodneyrehm nope, everything is fine now. Did you remove thefree()in the wrapper?\n. @rodneyrehm and if you give it strings allocated on the stack or the data segment (e.g. string literals) don't forget thestrdup()` call\n. ",
    "telekid": "This style of commenting is used heavily in a number of common libraries, including normalize and nvd3.\n. ",
    "Awem": "maybe still an issue? see: https://github.com/twbs/bootstrap-sass/issues/879#issuecomment-88128759 and https://github.com/jtangelder/sass-loader/issues/72#issuecomment-88127867\n. @krzkrzkrz broccoli-sass uses libsass via node-sass, which is still using 3.2.0-beta.2\n. @krzkrzkrz no, it's already reported.\n. ",
    "dalvarez": "@krzkrzkrz I'm getting the same issue to (using broccoli-sass in an ember-cli project)\n. @krzkrzkrz that fixed it for me too - when you uninstall and then reinstall, it switches node-sass version to node-sass@3.0.0-alpha.1 which doesn't have the bug.\n. ",
    "krzkrzkrz": "I am using broccoli-sass in an Ember CLI app (v0.2.2). I seems broccoli-sass is using libsass, I get:\nYou may not @extend an outer selector from within @media.\nYou may only @extend selectors within the same directive.\nFrom \"@extend .input-sm\" on line 48 of tmp/tree_merger-tmp_dest_dir-VAbune7B.tmp/app/styles/bootstrap/_input-groups.scss\nDowngrading broccoli-sass to a previous version (0.6.2) doesn't render any issues:\nnpm uninstall --save-dev broccoli-sass\nnpm cache clean\nnpm install --save-dev broccoli-sass@0.6.2\nReference: https://github.com/joliss/broccoli-sass/issues/59#issuecomment-88559764\n. @AW-UC should I report this on the node-sass repo as well?\n@dalvarez glad to hear\n. ",
    "DenisMir": "I'm using the latest node-sass release which uses libsass version 3.1. \n. @xzyfer \nI have tried to hunt down the issue. I'm pretty sure I got it now but it is pretty weird. \nI have some function which is reading a modular scale value from a map. \nscss\n@function ms-get-scale-ratio($pos) {\n  @if not $modular-scale {\n    @warn 'Please define a modular scale map in your config.';\n  } @else {\n    $key: scale-#{$pos};\n    @debug 'Trying to get ratio for position #{$pos} with key #{$key}';\n    $ratio: map-get($modular-scale, $key);\n    @debug 'Found ratio is #{$ratio}';\n    @return $ratio;\n  }\n}\nThe modular scale map is something like that: \nscss\n$modular-scale: (\n  scale-0: 1.2,\n  scale-1: 1.3,\n  scale-2: 1.4,\n  scale-3: 1.5,\n  scale-4: 1.6\n);\nThe part where the function gets called looks like: \nscss\n$bp-index: str_slice($bp-key, 7);\n@debug 'Got breakpoint index #{$bp-index} for #{$bp-key}';\n$ratio: ms-get-scale-ratio($bp-index);\nNow when I'm looking at the debug log I'm getting some correct pairs of log which look like:\nGot breakpoint index 2 for break-2\nTrying to get ratio for position 2 with key scale-2\nFound ratio is 1.4\nBut I'm also getting something like:\nGot breakpoint index 2 for break-2\nTrying to get ratio for position \"2\" with key scale-\"2\"\nFound ratio is\nThe \"2\" is breaking the code here. With no ratio value I'm getting the invalid operands for multiplication   which is ok.\nI hope that I could help you finding the issue. Please adjust the title according to the correct malfunction. At the moment I'm not quite sure what is going on here. If you need more information just drop me a message.\n. @xzyfer Do you need more information from me to be able to identify the bug?\n. @xzyfer No problem. I will try to reproduce the bug there. I haven't seen it since using node-sass@3.1.2 in grunt-sass.\n. ",
    "mechanicalduck": "So the first example compiles indeed correctly after all.\nHowever, it won't compile correctly when the keyframe selector is wrapped in a @keyframes selector (necessary for a css animation).\n@keyframes test {\n  $cur-frame: 10%;\n  #{$cur-frame} {\n    color: red;\n  }\n}\nlibsass output:\n@keyframes test {\n  #{$cur-frame} {\n    color: red;\n  }\n}\nruby sass output:\n@keyframes test {\n  10% {\n    color: red; } }\nThanks.\n. I am glad this has been added to the 3.2 milestone.\n. Added Pull Request for the specs:\nhttps://github.com/sass/sass-spec/pull/279\n. The 'needs test' tag could be removed now I guess - \nexcept the case of course that more extensive tests are needed.\nWith best regards.\n. Specs: https://github.com/sass/sass-spec/pull/279\n. ",
    "onedayitwillmake": "@xzyfer Added the accompanying test in pull request 281\nhttps://github.com/sass/sass-spec/pull/281\n. I've started work on this - should I do a WIP progress pull request? or just hold off? \n. Ah I see, this is mostly meant to help with debugging while on OSX. \n@mgreter Yes, I am not officially representing my employer in this pull request. I can move it into the contrib directory if it makes more sense there.\n. Sure thing, creating the wiki page now. Will be a little thin, but I can fill it up per your suggestions after\n. Here's a quick write up, let me know if there are any extra blanks to fill \nhttps://github.com/sass/libsass/wiki/External_Contributions\n. I just pushed another commit, which removed an extra scheme I had created in the workspace.\n@mgreter I'm not familiar with Travis-CI, but in order to build from command line it's possible to run:\n$ xcodebuild -workspace xcode/xcode.xcworkspace/ -scheme static-library\nI can be in charge of maintaining the Xcode build files. \nIt is not much work, I simply added only the CPP files listed in the Makefile to the static-library project target, so I have no problem keeping it in line. \n(to be sure, I have no problem placing the /xcode/ directory in 'contrib' either, up to you guys)\n. @mgreter Sounds good, I'll make sure it's building in Travis-CI in my next commit.\n. @mgreter I notice the .travis.yml file is calling ./script/ci-build-libsass which builds libsass into the 'lib' directory. \nWhat would be the best way for me to get the xcode build working, without stepping on the above script's work since they are building the same libsass.a file?\n. @mgreter I'm not familiar with Travis, I was thinking when it looks at travis.yml it looks for information on how to build the library, but the project already contains that information and builds using GCC/Clang.\nI'm not sure where I would add steps to build using xcode, without in effect bumping out the current information, or building the library a second time in order to keep both instructions. Again this could be because i'm not familiar with Travis CI\n. Sorry, this might sound like a broken record but I'm not sure what the task is.\ntravis.yml currently builds using GCC/Clang command line, but we would like to have it /instead/ build using xcodebuild command line tool /if/ it's running on an OSX environment in travis? \nOtherwise, building via command line GCC/Clang will then be erased once the xcodebuild is done. Correct?\n. Ah yes ok this clears everything up, it will just run it in parallel! Got it \ud83d\udc4d\n. So Travis gives the variable, TRAVIS_OS_NAME which I check for osx, to trigger the build. \nHowever the build even with:  \nos:\n  - linux\n  - osx\nIt will still trigger a linux only build.\nApparently multi-os projects are not exactly supported currently, seems to be due to server load (http://docs.travis-ci.com/user/multi-os/)\nIt also appears that by default, all builds run on Ubuntu 12.04 LTS Server Edition 64 bit unless the language is set to objective-c \nhttp://docs.travis-ci.com/user/ci-environment/#CI-environment-OS\n\nTravis CI virtual machines are based on Ubuntu 12.04 LTS Server Edition 64 bit, with the exception of Objective-C builds, which runs on Mac OS X Mavericks.\n\nI tried a few the obvious thing of setting two languages in the YAML just to kick start it, but it didn't fall for that \ud83d\ude22 (https://travis-ci.org/onedayitwillmake/libsass/builds/55532426)\nJust to see if it was a possibility, I set the language to 'objective-c' which did indeed trigger the OSX host, which launched xcodebuild and everything went according to plan \ud83d\ude01(https://travis-ci.org/onedayitwillmake/libsass/builds/55552324 - although libsass.so version currently fails because im not sure how to place the library where it wants after building the dynamic library) \nTL;DR Travis wont allow multiple OS environments, you can only force the OSX environment if falsely set the language to 'objective-c' - With this flag set it builds correctly in OSX and passes the tests\n. Well specifically they mention that, currently if you want multiple OS support you /can/ request it - perhaps that is the route they took?\n\nThis feature needs to be enabled manually. If you wish to take advantage of this feature, please send email to support@travis-ci.com, indicating which repository you would like to have it enabled\nWe are at capacity with Mac workers in both .org and .com environments. Consequently, we are not accepting requests for the multi-OS feature at this time. As more capacity is added, we will resume accepting requests.\n. I did give those parameters a try (simply osx as well as linux) in the.travis.yml`, however it does not trigger an OSX build.\n\nThis was the resulting output: \nhttps://travis-ci.org/onedayitwillmake/libsass/builds/55528078\nIn fact, setting the host OS has no effect, you will only get an OSX VM if the language is set to objective-c.\nhttp://docs.travis-ci.com/user/ci-environment/#CI-environment-OS\n\nTravis CI virtual machines are based on Ubuntu 12.04 LTS Server Edition 64 bit, with the exception of Objective-C builds, which runs on Mac OS X Mavericks.\n. Yay! \ud83c\udf8a - will do in the morning!\n. In order to iron out any kinks, should I request OSX support for my own fork? Or was that part of their green light? \n. @am11 @xzyfer This /should/ do the trick now.\n\nI've set the language:\nlanguage: \n  - objective-c\n  - cpp\nWhich should trigger the OSX environment. \nI've also temporarily excluded the shared build on OSX, it compiles correctly but sassc cannot locate it.\nI would consider that a separate issue for now\n. @xzyfer Looks like a new different error is showing up:\nUsing /home/travis/.rvm/gems/ruby-1.9.3-p551\n0.01s/home/travis/build.sh: line 42: /usr/local/bin/actool: Permission denied\nI wonder if it is a combination of linux environment, and the language being set to objective-c in order to trigger the OSX dual environment \n. I tried swapping the language setting, but this forced the linux only environment causing OSX builds to fail of course.\nPerhaps someone can jump in with some advice, but it appears.\n- Setting language 'objective-c' causes linux builds to fail (even though they are in fact ran from a linux worker), potentially a bug in Travis.\n- Setting language to 'cpp' prevents OSX host from being created causing Xcode builds to fail.\n. @mgreter Any advice, it appears that for now we cannot satisfy Travis (cannot trigger OSX unless lang is set as objective-c, not setting the language to cpp causes build failure for linux)?\n. @xzyfer It's definitely picking it up, it's just that we have to set the language to Objective-C which is causing the other builds to fail for some reason\n. @xzyfer I don't believe so, as on the top it's stating that it's using a linux worker:\nUsing worker: worker-linux-3da96de7-1.bb.travis-ci.org:travis-linux-6\n. The environment is not correct, but brew is installed by default. If we run brew it will not exist.\nThe only way to trigger OSX environment, is to set the language to objective-c, other than being obviously wrong. It causes the reverse, and linux builds fail. Lemme do that now, maybe we can dissect it.\nWhen the environment is OSX brew exist, and is one of the steps in my modified ci script\n. @mgreter Yes, I see your test - looks very promising, maybe I was confusing myself with travis because i'm not familiar with it. My fork's does not allow dual OS builds, but on these merge request builds this project does. I reset the .travis.yml file to match more like the one above\n. Strange, it looks like it just timed out - but the OSX build was never started\n. @mgreter It looks like it's working, but with a few caveats:\nFrom the output, https://travis-ci.org/sass/libsass/jobs/56763059, and I noticed this locally as well, it builds using xcode then something else down the line rebuilds the library.\nCuriously this happens after the output:\nsuccessfully compiled libsass\nAUTOTOOLS=no COVERAGE=yes BUILD=static\nWhich means it must happen in a subsequent script. \n. @mgreter The files added are part of the Xcode's self contained project file, much as how imagine a .sln file is under the hood. They are just GUID references to the files.\nI think if you are using a different OS, then you're right there is no benefit of including the Xcode project from a compilation standpoint for the computer. It builds on OSX using make just fine.\nThe benefit is more for users on OSX, to be able to contribute to the project using Xcode along with the LLDB debugger by simply pulling the repo down and opening the project file.\nHowever, to your point if that is not a strong enough reason because it would have to be updated when new files are added/removed the way that VS solution file has to be, then I can close the pull request.\n. @mgreter Fully agree, perhaps in contrib directory is best.\nAlso out of curiosity which is the spot you're referring to, with the multiple times? The project file? I want to make sure I did not think you were talking about something else when I answered\n. @mgreter @xzyfer I think im going to re-do this as a new pull request, to skip over the ugly stuff in the middle that I did while testing out options\n. Slightly tangential question, what does listize do? When is it required and when is it not?\n. @mgreter @xzyfer I'm implementing selector-replace, and I'm trying to use extendSelectorList to do it - as I see that is how the ruby version is structured.\nFor example with such a test input:\nselector-replace('.foo', '.foo', '.bar');  // should output .bar\nI created a populate_extends method on Selector_List which takes another Selector_List, and appears to fill the entries with the correct value (in this case .bar for the key .foo). I naively attempted to pass that plainly into Extend::extendSelectorList but its outputs is .foo\nI know that seems a bit dense, but here is some of the output. \nYou can see that it picks up the .bar key for .foo, but right away it is dropped:\n```\n\nselector_replace\n\nREGISTERING EXTENSION REQUEST: .foo <- .bar\nSubset_Map::put key=.foo \nSubset_Map::get key=& \nSubset_Map::get key=.foo \nEXTEND COMPLEX: [.foo]\nLOOP: .foo\nEXTEND COMPOUND: .foo\nSubset_Map::get key=.foo \nSEQ: [&, .foo]\nSELS: .bar\nMEMBERS: .foo\nSELF_WO_SEL: .foo\nLHS: .foo\nRHS: .foo\nUNIFIED: .foo\nSOURCES SETTING ON NEW SEQ: [.foo]\nSOURCES NEW SEQ BEGIN: SourcesSet[]\nSOURCES THIS EXTEND: SourcesSet[]\nSOURCES WITH NEW SOURCE: SourcesSet[[.foo]]\nSOURCES ON NEW SELECTOR AFTER ADD: SourcesSet[[.foo]]\nSOURCES THIS EXTEND WHICH SHOULD BE SAME STILL: SourcesSet[]\nRECURSING DO EXTEND: [.foo]\nEXTEND COMPLEX: [.foo]\nLOOP: .foo\nEXTEND COMPOUND: .foo\nSubset_Map::get key=.foo \nSEQ: [&, .foo]\nSELS: .bar\nMEMBERS: .foo\nSELF_WO_SEL: .foo\nLHS: .foo\nRHS: .foo\nUNIFIED: .foo\nSOURCES SETTING ON NEW SEQ: [.foo]\nSOURCES NEW SEQ BEGIN: SourcesSet[]\nSOURCES THIS EXTEND: SourcesSet[[.foo]]\nSOURCES WITH NEW SOURCE: SourcesSet[[.foo]]\nSOURCES ON NEW SELECTOR AFTER ADD: SourcesSet[[.foo]]\nSOURCES THIS EXTEND WHICH SHOULD BE SAME STILL: SourcesSet[[.foo]]\nEXTEND COMPOUND END: .foo\nEXTENDED: []\nCHOICES UNSHIFTED: [[.foo]]\nEXTENDED NOT EXPANDED: [[[.foo]]]\nPATHS: [[[.foo]]]\nWEAVE: [[.foo]]\nCURRENT: [.foo]\nCURRENT POST POP: []\nLAST CURRENT: [.foo]\nSUB: [[]]\nWEAVES: [[[.foo]]]\nTRIM: [[[.foo]]]\nRESULT INITIAL: [[[.foo]]]\nSEQS1: [[.foo]] 0\nTRIMASDF SEQ1: [.foo]\nTRIMASDF SOURCES: SourcesSet[[.foo]]\nMAX SPECIFICITY: 1000\nSEQS1: [[.foo]]\nSEQS2: [[.foo]]\nCONTINUE\nPUSHING: [.foo]\nRESULT BEFORE ASSIGN: [[[.foo]]]\nTEMP RESULT  0 [[.foo]]\nRESULT: [[[.foo]]]\nFINAL RESULT: [[[.foo]]]\nTRIMMED: [[[.foo]]]\n\n\n\n\n\nEXTENDED: [[.foo]]\nEXTEND COMPLEX END: [.foo]\nRECURSING DO EXTEND RETURN: [[.foo]]\nEXTEND COMPOUND END: .foo\nEXTENDED: [[.foo]]\nCHOICES UNSHIFTED: [[.foo], [.foo]]\nEXTENDED NOT EXPANDED: [[[.foo], [.foo]]]\nPATHS: [[[.foo]], [[.foo]]]\nWEAVE: [[.foo]]\nCURRENT: [.foo]\nCURRENT POST POP: []\nLAST CURRENT: [.foo]\nSUB: [[]]\nWEAVE: [[.foo]]\nCURRENT: [.foo]\nCURRENT POST POP: []\nLAST CURRENT: [.foo]\nSUB: [[]]\nWEAVES: [[[.foo]], [[.foo]]]\n\n\n\n\n\nTRIM: [[[.foo]], [[.foo]]]\nRESULT INITIAL: [[[.foo]], [[.foo]]]\nSEQS1: [[.foo]] 0\nTRIMASDF SEQ1: [.foo]\nTRIMASDF SOURCES: SourcesSet[]\nMAX SPECIFICITY: 0\nSEQS1: [[.foo]]\nSEQS2: [[.foo]]\nCONTINUE\nSEQS1: [[.foo]]\nSEQS2: [[.foo]]\nSEQ2 SPEC: 1000\nIS SPEC: 1000 >= 0 true\nIS SUPER: true\nFOUND MORE SPECIFIC\nRESULT BEFORE ASSIGN: [[[.foo]], [[.foo]]]\nTEMP RESULT  0 []\nRESULT: [[], [[.foo]]]\nSEQS1: [[.foo]] 1\nTRIMASDF SEQ1: [.foo]\nTRIMASDF SOURCES: SourcesSet[[.foo]]\nMAX SPECIFICITY: 1000\nSEQS1: [[.foo]]\nSEQS2: []\nSEQS1: [[.foo]]\nSEQS2: [[.foo]]\nCONTINUE\nPUSHING: [.foo]\nRESULT BEFORE ASSIGN: [[], [[.foo]]]\nTEMP RESULT  1 [[.foo]]\nRESULT: [[], [[.foo]]]\nFINAL RESULT: [[], [[.foo]]]\nTRIMMED: [[], [[.foo]]]\n\n\n\n\n\nEXTENDED: [[.foo]]\nEXTEND COMPLEX END: [.foo]\nextendedSelectors: [[.foo]]\n    childNode: [.foo]\n\n\n\n\n\n\nDONE\n\n.test {\n  a: .foo; }\n```\nAny insight is appreciated! Hoping to tackle this before the end of the week\n. I actually made some progress, will have to post tomorrow - but im very close!\n. @mgreter Sure thing, will write a function based version of the test case and post to spec\n. @mgreter i can't see the details of why the appveyer builds are failing. Normally there is a link, could you point me in the right direction? \n. @mgreter I agree, i can merge that in. The selector function, is essentially parsing the selectors, returning the result of calling that method\n. @mgreter Would be great if you could generate it! \n@mgreter @xzyfer Re: $selector-append \nI have the function working with functionally correct output, however in ruby-sass the output is ordered alphabetically. \nTo give an example:\ninput: selector-append(\".a\", \".b, .c\", \".de, .df, foo\");\n// ruby-sass\n.a.b.de, .a.b.df, .a.bfoo, .a.c.de, .a.c.df, .a.cfoo;\n// libsass \n.a.b.de, .a.c.de, .a.b.df, .a.c.df, .a.bfoo, .a.cfoo;\n~~I could sort all the Complex_Selectors in the Selector_List, after the operation - but I'm not sure if that would be the right thing to do. Any advice?~~\nWhoops, swapping the iteration order of the loop fixes the issue.\nSee: https://github.com/sass/libsass/commit/7ccaeceb490a93dea3a74b642413c9d4415803f5\n. @mgreter @xzyfer Alright! Implemented selector-nest to make the full set\n. @mgreter @xzyfer Do you guys have any advice on fixing the build errors in some of the travis-ci builds? It looks like it's failing on the issue_1075, in only some of the builds\n. @xzyfer @mgreter Just curious if there was any movement on this, I implemented the .travis.yml modifications, should I just rebase?\n. @xzyfer Gotcha, makes sense.\nBesides the one on the bottom, which other ones do you see have merges with master? \n. @xzyfer I will give it another go tomorrow morning, you reckon I should just squash it to a few key commits and rebase from there?\n. @xzyfer Looks like something else broke on this one, saying I have a duplicate function however I'm not seeing that on my end. Maybe I'm just bad at pull-request, what do you suggest\n. @xzyfer Thanks for heads up, I removed them \n. @mgreter Any movement on this one?\n. @mgreter Although it's building correctly, I'm having a bit of trouble with linking to the installed .dylib on travis.\nAny advice? Imo i think it would also be fine to simply not build the shared library version on OSX/Xcode since it's less used\n. Any word on the selector functions?\n. Really liking the changes in this branch, everything is really making a lot more sense as someone less familiar with the code base! \n. @mgreter Thank you! Yes it seems to dislike the std::function I used as a custom comparator for creating a std::set< Complex_Selector*> - I assumed I could use C++11 feature.\nLooking again, i see you already have a Complex_Selector_Pointer_Compare functor I can use instead! \nI will switch to that and commit :)\n. It's still a todo (an extra check ruby sass does), I figured i would open the issue once this is in the actual code base.\n. This one is not my own, it's from the code base, but is commented out. I re-comment it out\n. Not my comment\n. Remove the whole function?\n. Which portion?\n. ",
    "geddski": "sweet! This is the main feature I've been waiting for to be able to use libsass with csstyle. Thanks @xzyfer!\n. ",
    "jesseleite": "Thank you!  PS. Check out geddski's csstyle sometime, it's pretty slick :)\n. ",
    "ncoden": "\nvariable-parameters can follow optional parameters but not the other way around.\n\n@xzyfer Why not ? I understand that when passed inline we cannot split optional parameters from variable-parameters, but it would work well with named parameters, and would be really useful to provide additional \"second-hand\" options to a function.\nFor example:\n```scss\n@function please-call-this-for-me($func, $args..., $warn: true) {\n    @if type-of($func) == 'function' and function-exists($func) {\n        @return call($func, $args...);\n    }\n    @else if $warn == true {\n        @warn 'Function #{$func} does not exists';\n    }\n}\n// Call \"foo\" with (bar, baz, warn)\n$_: please-call-this-for-me(foo, bar, baz, warn);\n// Call \"foo\" with (bar, baz)\n$_: please-call-this-for-me(foo, bar, baz, $warn: false);\n```\nThat's a stupid example I know, but we can see that the \"main job\" of please-call-this-for-me is to call a function with arguments (this is why using variable-parameters seems legit to me, instead of a list) and that we need beside this \"main job\" to customize it with optional arguments that will not be used often but that we still need.\nWhat do you think ?. ",
    "dominicbarnes": "Oh my bad, I thought that's where I was posting lol. (too many tabs!)\n. ",
    "MikeMcElroy": "May have been fixed by 21ce837c5 -- will close until I get a chance to try it through node-sass\n. ",
    "afaye": "Sorry, I got confused while testing things with less.\nHere is a usecase (tested this time:) ) working with Sass 3.4.13, but not with libsass v3.0.3 :\n``` scss\n.component{\n    color: red;\n    @at-root{\n        #{&}--foo#{&}--bar {\n            color: blue;\n        }\n    }\n}\n.test{\n    @at-root{\n        .selector#{&} {\n            color: blue;\n        }\n    }\n}\n// Outputs \"file.scss:4: error reading values after \"\n// Expected result (with sass 3.4)\n.component {\n  color: red; }\n  .component--foo.component--bar {\n    color: blue; }\n.selector.test {\n  color: blue; }\n```\n. ",
    "tedw": "I noticed another issue with & interpolation in @at-root blocks:\n``` scss\n.foo {\n  @at-root button#{&} {\n    color: red;\n  }\n}\n// Generated CSS has an additional selector prepended\n.foo button.foo {\n  color: red;\n}\n```\nThis wasn't a problem in 3.2.2, only 3.2.3 and later.\nI thought it made sense to include this here, but I'm happy to submit a separate issue if you prefer.\nThanks! \n. ",
    "corysimmons": "I use a split string function to grab the denominator from this stringed fraction and set it to $cycle.\nThen I use &:nth-child(#{$cycle}n) { ... } to perform some operations on every nth-child.\nThis works on other versions of SCSS including CodePen but doesn't work with LibSass. Thank you.\n. @xzyfer Apparently it's the sl-explode() function.\nhttp://sassmeister.com/gist/1f0fecbb6af5ca3d2f3b\n. Neat, eta on 3.2.0?\n. @xzyfer Awesome, thanks for answering my questions. Have a nice day!\n. ",
    "dwightjack": "Hi I'n not sure my issue is exaclty the same as @joelworsham . Anyway since I updated to latest beta version, source maps seems to be broken when using @extend  feature.\nScenario:\n``` scss\n//SCSS\n%test {\n    font-size: 10px;\n}\na {\n    background-color: red;\n}\np {\n    @extend %test;\n}\n```\n``` css\n//CSS\np {\n  font-size: 10px; }\na {\n  background-color: red; }\n/# sourceMappingURL=style.css.map /\n```\n//Generated sourcemap\n{\n    \"version\": 3,\n    \"file\": \"style.css\",\n    \"sources\": [\n        \"style.scss\"\n    ],\n    \"sourcesContent\": [],\n    \"mappings\": \"AAAO,AACN,AAAW,AAGZ,AACC,AAAkB\",\n    \"names\": []\n}\nWhen I inspect the p tag the Dev Tool refers to the a tag rule (line 6).\nIn my build workflow a similar scenario is causing autoprefixer sourcemaps to break with an error:  No element indexed by -1\n. Thank you and all the team for the great effort you're putting in the project!\n. ",
    "stefanpenner": "@mgreter which version will that release be?\n. ",
    "wzrdtales": "@mgreter I can confirm the master fixes the data-url issue. There are still issues together with foundations components scss.\nHave posted the test results there:\nhttps://github.com/sass/node-sass/issues/840#issuecomment-90707810\n. ",
    "franzheidl": "This issue with the & parent selector appears not only when extending placeholders, it seems to also happen when the parent selector is generated on the fly and using @at-root:\nI have this source:\n```\n@mixin outer($name) {\n    .#{$name} {\n        @content;\n    }\n}\n@mixin inner($name) {\n    @at-root {\n        &#{$name} {\n            @content;\n        }\n    }\n}\n@include outer('peter') {\n    color: red;\n    @include inner('paul') {\n        color: green;\n    }\n}\n```\nThe expected output should be (and what Ruby Sass 3.4.13 gives me):\n.peter {\n  color: red; \n}\n.peterpaul {\n   color: green; \n}\nBut the result is:\n.peter {\n  color: red; \n}\n paul {\n    color: green; \n}\n. ",
    "changemewtf": "This could also help with generating dependency graphs, obviating the need for something like sass-graph and pre-empting issues like https://github.com/sass/node-sass/issues/1179.\n. ",
    "stefsullrew": "We have a very, very big need for a tool that can parse the CSS and give us an AST. Has anyone made progress on this?\n. It is not, @danoc ... though as much as I hate doing documentation, I would love that as well. We need to do checks on certain things prior to Sass compiling. Having the AST exposed would give us that ability.\n. Not sure if this helps anyone in this thread, but we went ahead and built a library to traverse/modify an AST which meets the needs that we had. We open sourced it, so if it helps anyone here with the use case they had, it's here: https://github.com/salesforce-ux/scss-parser\n(Originally, I added this link - which is used for the above: https://github.com/salesforce-ux/query-ast)\nCheers!\n. ",
    "danoc": "@stefsullrew \u2013 Is it related to automated documentation? If so, we should chat! I would also really, really, really love such a feature.\n. This is great. Thanks @stefsullrew!\n. @mgreter \u2013 We only ran into this issue when using the BEM shorthand notation (&--) within a placeholder that is extended.\nRuby Sass behaved as we expected.\n. @mgreter \u2013 I'll defer to @tomgenoni for the first question but I should have noted that both &__ and &-- produce similar results.\n. ",
    "maximus8891": "The latest master doesn't throw an error anymore. Returns:\nhdr(2, 5) {\n  color: #08c;\n}. Seems like static_value treats values like 3.0px as const strings preventing the trailing zero reduction.\nA related issue is #550, where it is favoured to treat values like .01px as strings, otherwise they get transformed into 0.01px.. There was a spec created for #1216 and it is still in the todo list. I wanted to close it.\nI can updated the spec to match the current output and close this PR. However, first I wanted to check that the behaviour is correct. Given 3.0px, the output is 3.0px. Would not contracting 3.0px to 3px save space?\nIn #550 it worked the other way round. .001px was extended to 0.001px adding a character.\n. Makes sense, especially that there are other specs that have conversions from opacity: 1.0; to opacity: 1.0;.. Maybe this approach?\nWould it be too much overhead?\nhttps://floating-point-gui.de/errors/comparison/\n```java\n    public static boolean nearlyEqual(float a, float b, float epsilon) {\n        final float absA = Math.abs(a);\n        final float absB = Math.abs(b);\n        final float diff = Math.abs(a - b);\n    if (a == b) { // shortcut, handles infinities\n        return true;\n    } else if (a == 0 || b == 0 || diff < Float.MIN_NORMAL) {\n        // a or b is zero or both are extremely close to it\n        // relative error is less meaningful here\n        return diff < (epsilon * Float.MIN_NORMAL);\n    } else { // use relative error\n        return diff / Math.min((absA + absB), Float.MAX_VALUE) < epsilon;\n    }\n}\n\n```\nThe idea is to use the relative error. 0.0001 == 0.0002 and 1000.0001 == 1000.0002 require a different epsilon so to speak.. ",
    "simonsmith": "Great, appreciate it\n. ",
    "dandehavilland": "Just in case it isn't clear from my original post, I resolved this in my app by simply removing my comments.\n. ",
    "jouni": "Thanks! I tried to search for a similar issue, but obviously not hard enough :)\n. ",
    "ausi": "I\u2019m not sure if I can make a meaningful pull request for this topic. I have no experience in C and C++, I just noticed the outdated readme while preparing the issue #1158 and trying to run the test suite.\n. ",
    "mikeangstadt": "Is this fixed yet?  Shouldn't you be waiting until it is available before closing an issue?\n. \" and will be in the next beta of Libsass and node-sass.\" where is a new node-sass build?\n. ",
    "perplexes": "I'm running into this on current master (b2a3d98ed384d2d19aa79157d08fa21c3e8043e0): https://gist.github.com/perplexes/ff97bab5669b8dad0248\n. Just ran into this with https://github.com/Igosuki/compass-mixins/issues/34 / https://github.com/Igosuki/compass-mixins/pull/67. It's trying to define compact if it doesn't exist. Since compact was stripped from libsass, this is needed to put it back in, in a version independent way.\nCurrently (as of b2a3d98ed384d2d19aa79157d08fa21c3e8043e0) function definition is scoped to the control block, breaking this usage (@if not(function-exists(compact)) { ....). Causing this funny behavior: https://gist.github.com/perplexes/e0e75f00b3772f2bf643. It seems to not register with the globals, so even function-exists breaks within the block.\nCurrent work-around is to just remove the if statement (since in my codebase I know we need it). Any suggestions on what compass-mixins can do, though? Maybe a function-if-not-exists directive?\n. This is not valid CSS (although the W3C validator seems fine with it) - it has the IE 8 digit hex AND alpha, when it should just have 6-digit hex and alpha.\nClosing.\n. ",
    "volodos": "I also have this error, i've done \"npm install node-sass@beta\" command, didn't worked.\nThe error is:  \"Error: expected a variable name (e.g. $x) or ')' for the parameter list for alpha\n        on line 112 of stdin\"\nCode:  input.File { width: 100%; position: relative; text-align: right; -moz-opacity: 0; filter: alpha(opacity: 0); opacity: 0; z-index: 30; cursor: pointer; }\n. ",
    "atdrago": "Thanks for the response, @xzyfer. Added a PR sass/sass-spec#327\n. ",
    "binarykitchen": "Ah, thanks for your work. After some debugging I found out that $header-button-background-color was set to white and that didn't work. But when I set that variable to #fff, then it worked. Weird. \n. Ouch!\n. If you want to reproduce it, then try using gulp-sass and compile\nsass\n$foo: white;\nfoo {\n  bar: adjust-color($foo, $hue: -6deg, $lightness: -16, $saturation: -7);\n}\n. gulp-sass v1.3.3 (it is the latest)\n. thx. let me know when it's published on npm\n. ",
    "andfinally": "I've since found this seems to apply to all code inside media queries - when I remove the media queries from global.scss and wrap them around the code in media-query-480.scss, that CSS turns out munged together too.\n. Thanks @xzyfer!\n. ",
    "sqal": "Fixed in 3,2 - 5eba5f0e4fc8. Check release notes\n. ",
    "VaJoy": "you are right, I`d forgot this way of writing sass. thx :)\n. ",
    "realityking": "Small FYI, this breaks Bootstrap as it's used in the Breadcrumb separator.\n. ",
    "cvrebert": "@xzyfer Protip: @mdo doesn't maintain bootstrap-sass. Please let someone on the Bootstrap Sass Team know next time, or file a bug in bootstrap-sass.\n. Cheers mate\n. Yeah, I agree it would be preferable for Ruby Sass to not error out. I'm just not a Sass guru, so I thought I'd file a discrepancy report here to get some investigation rolling.\n. Okay, filed https://github.com/sass/sass/issues/1726\n. Okay, per https://github.com/sass/sass/issues/1726#issuecomment-109444372 this does seem to be a SassC bug rather than a Ruby Sass bug.\n. > if I run the original issue with latest ruby sass I get some output!\n@mgreter Hmm?\n$ sass -v\nSass 3.4.16 (Selective Steve)\n$ sass one.css \nError: Invalid CSS after \"...min-width:0\\0) \": expected media query list, was \"{\"\n        on line 2 of one.css\n  Use --trace for backtrace.\n$\n. Environment:\nOS X El Capitan 10.11.1\n$ c++ --version\nApple LLVM version 7.0.0 (clang-700.1.76)\nTarget: x86_64-apple-darwin15.0.0\nThread model: posix\nlibsass: https://github.com/sass/libsass/commit/d18808de7159cedbe8d814e0e7c4fa277e7ece3b\nhttps://github.com/sass/sassc/commit/7efa9c452f4f2a814fbe74448ebdc2e703e67a4a\nFull build output: https://gist.github.com/cvrebert/bd95d26561e14de2cead\n. Looks like the Travis build is using an older version of clang (and possibly of OS X?):\n\n$ clang --version\nApple LLVM version 6.0 (clang-600.0.54) (based on LLVM 3.5svn)\nTarget: x86_64-apple-darwin13.4.0\n. \n",
    "karolyi": "+1\n. ",
    "adye": "+1, Here is a snippet\n$green: green;\n.button--#{$green}--alt{\n  color: $green;\n}\n.button--with--text {\n  @extend .button--#{$green}--alt;\n}\nThanks\n. ",
    "dtothefp": "@HugoGiraudel sorry for not more complete info.  The repo for this code is css-smart-grid and line 33 is where it chokes.\nThe missing imported variables are here:\n``` sass\n// 20px at 960px wide container, accounting for a 1/2 gutter width padding on the left and right of the container\n$gutter:    percentage(20px/940px);\n// 60px at 960px wide container\n$one-column:                6.3829787%;\n// set this to the minimum width you want the columns to take effect at\n$columns-break-point:          481px !default;\n// set this to the maximum width you want .container to have\n$container-max-width:          940px !default;\n// set this to true to include support for CSS Flexbox (modern syntax).\n$flexbox-support:             true !default;\n// a collection of the columns you want to build. the first parameter must be an integer of how many columns wide this instance is, followed by 1 or more class names to apply this width to.\n$column-list:    (2, \"two\") (3, \"three\", \"one-fourth\") (4, \"four\", \"one-third\") (5, \"five\") (6, \"six\", \"one-half\") (7, \"seven\") (8, \"eight\", \"two-thirds\") (9, \"nine\", \"three-fourths\") (10, \"ten\") (11, \"eleven\") (12, \"twelve\", \"full\") !default;\n// a collection of the offsets you want to build. the first parameter must be an integer of how many columns wide this instance is offset, followed by 1 or more class names to apply this offset to.\n$offset-list:    (1, \"one\") (2, \"two\") (3, \"three\") (4, \"four\") (5, \"five\") (6, \"six\") (7, \"seven\") (8, \"eight\") (9, \"nine\") (10, \"ten\") (11, \"eleven\") !default;\n```\nAnd here is a Sassmeister Gist http://sassmeister.com/gist/b4d0154f7704516cddec that seems to be compiling successfully in Libsass 3.1.0\n. @xzyfer @drewwells \nhere is a demo repo https://github.com/dtothefp/node-sass-error-demo/blob/master/grunt/node-sass.js\nmy mistake, it is a media query in the main bootstrapped smart-grid.scss that is calling the column-set mixin that is causing the problem\nif you add below to Sassmeister or just checkout my repo\n@media (min-width:$columns-break-point) {\n    @include column-set;\n}\nnode-sass will throw the error I'm referencing\n. @HugoGiraudel @drewwells @xzyfer @stewsmith I've pinpointed the issue. If you reference the article http://hugogiraudel.com/2013/07/15/understanding-sass-lists/#section-4 about appending to sass lists you will see that the syntax below will work\n``` scss\n$pages: home, about, products, contact;\n$selector: ();\n@each $item in $pages {\n  $selector: append($selector, unquote('.#{$item} .nav-#{$item}'), comma);\n}\n```\nbut the following syntax will break (and coincidentally the syntax used in the css-smart-grid mixin)\n@each $item in $pages {\n  $selector: $selector, unquote('.#{$item} .nav-#{$item}');\n}\nYou can see an example in my sample repo https://github.com/dtothefp/node-sass-error-demo running grunt works and grunt breaks compiling directly with node-sass api or you can just use the above example code to see the issue.\n. @xzyfer thanks for the reply. Any idea when we can expect Libsass 3.2.0 and node-sass 3.0.0 to come out of beta?\n. @HugoGiraudel I can confirm this is still an issue\n. ",
    "filmic": "I get this error compiling code:\n```\n$EQ-Selectors: ();\n.el {\n    $EQ-Selectors: append($EQ-Selectors, &, 'comma') !global;\n}\n```\nThrows:\n4:39  invalid selector after &\nI'm running gulp-sass v2.0.1 --> node-sass v3.1.2 --> libsass v3.2.4\n. ",
    "sndrs": "i'm an idiot! sorry\n. ",
    "OnkelTem": "Ok, working on this\n. ",
    "elfring": "I suggest to reconsider the consequences of the following wording from the section \"16.2 Source file inclusion\" in the standard specification for the programming language \"C++\".\n```\n\u2026\nThe named source file is searched for in an implementation-defined manner. If this search is not supported, or if the search fails, the directive is reprocessed as if it read\ninclude  new-line\n\u2026\n```\n- How do you think about to avoid \"a duplicated file search\" here?\n- Would you like to restrict the searched directories for header files of your software?\n. There are different opinions about the handling of the involved implementation-defined behaviour.\n- Will header files be also searched outside the specified include directories if double quotes are used for the discussed preprocessor statement?\n- Is there a speed difference measurable if a file is not found there and the search will be retried with \"the angle brackets inclusion method\"?\n. ",
    "shaunbent": "That was fast - I was going to write the test you requests tonight.\nBrilliant - thanks for this.\n. ",
    "AlbertoElias": "Yes, in the second link I posted, you can see that colour strings are treated like colours. But in map keys, they're not, and that's why an error is thrown in my third example if you uncomment the second key in the map (I forgot to mention that).\nThanks everyone for the very quick response!\n. Yes, I used @kaelig\u00b4s workaround for my second example and it works fine\n. Yes, this does seem to have broken again in Libsass 3.3. We're getting duplicate map keys errors again\n. That was quick! Thanks :D\n. @mgreter I can confirm it fixes it! Cheers!\n. That's great, thanks. And yes, I had tested in 3.2.\n. ",
    "jsma": "Yep, bootstrap. I've narrowed it down to mixins/_hide-text.scss. On the older version of bootstrap I'm running (not sure which off hand) it had \"font: #{0/0} a;\" which causes the failure in my case. If I change it like it was upstream in a later version to \"font: 0/0 a;\" then the issue disappears. Is the takeaway that I need to upgrade bootstrap or is there a deeper bug that needs to be squashed?\n. ",
    "paweltin": "There is however a workaround for this issue:\nscss\n$foo: unquote(\"not-allowed\");\n. Sorry, I was using an older build of node-sass. Everything is working after update :+1: \n. ",
    "tysongach": "Any update on this?\n. ",
    "linnett": "I'm using gulp-sass v 2.0.0. deps: \n\"gulp-util\": \"^3.0\",\n\"node-sass\": \"^3.0.0\",\n\"object-assign\": \"^2.0.0\",\n\"through2\": \"^0.6.3\",\n\"vinyl-sourcemaps-apply\": \"~0.1.1\"\nI believe this is the most up to date isn't it?\n. npm -v = 1.4.3\nnode -v = 0.10.26\nnode -p process.versions = \n```\n{ http_parser: '1.0',\n  node: '0.10.26',\n  v8: '3.14.5.9',\n  ares: '1.9.0-DEV',\n  uv: '0.10.25',\n  zlib: '1.2.3',\n  modules: '11',\n  openssl: '1.0.1e' }\n```\nnode -p process.platform = darwin\nnode -p process.arch = x64\n./node_modules/.bin/node-sass = does not exist but gulp-sass is in the node_modules folder.\nThanks\n. node-sass   3.0.0   (Wrapper)   [JavaScript]\nlibsass     3.2.2   (Sass Compiler) [C/C++]\n. Hey - so the issue was that someone had previously set it to 0. It then goes on to do other things after the loop. i think before it ignored if it was 0 but this time it tried to iterate through and errors. Seems reasonable that it would error - thanks for the help! \n. ",
    "suisho": "Thanks!\n. ",
    "fuhlig": "1st run: grunt-sass ^0.18.1 (node-sass 2)\n2nd run: grunt-sass 1.0.0 (node-sass 3)\nthe compile time ~ doubled from upgrading to node-sass 3\n\n. ",
    "12finger": "... same for us (on a project with > 500kb sass + scss files)\nspeed went down ~75%: now compilation takes 3.3sec instead of 1.9\n(for some reason we separate scss files from sass, so we have separate tasks for it in Gulp, that's why both show up in the following output. but for this example i only changed one single line in a sass file)\nca. 3.3sec  -  slow, on node-sass@3.1.1\n\nca.. 1.9sec  -  before: fast on node-sass@2.1.1\n\n. ",
    "johnhunter": "Could just use filter: alpha(opacity=$opacity); although the unquote workaround might be useful for other cases.\n. ",
    "iparr": "Also struggling a little with this issue.\nI've been using it (perhaps unwisely) without mixins, for example in this example where the global-logo will only adapt a hover color when it is a link (as opposed to a heading, or span):\n```\n.global-logo {\n@at-root a#{&} {\n    &:hover {\n        background-color: red;\n    }\n}\n\n}\n```\nThis is the one thing stopping me utilising libsass fully on some of my websites so I'm going to watch keenly for a fix!\n. Great news, thanks for the update @xzyfer \n. ",
    "danielguillan": "I've run some quick tests and It looks like a bug was introduced in 3.2.3 or 3.2.4. @at-root was working as expected on 3.2.0 through 3.2.2. I hope this helps.\n. I'll be happy to help with the spec. What are some of those edge cases?\n. @xzyfer Just added the new specs. I hope most of the cases are being covered now.\n. Spec added sass/sass-spec#743\n. ",
    "MakhBeth": "The issue is not only with #{&} but with all the interpolations.\nExample:\n```\n@mixin test{\n  @at-root #{\".interpolated\"}{\n    @content;\n  }\n}\n.parent{\n  @include test(){\n  .child{\n      a: 2;}\n  }\n}\n```\nThe aspected result would be:\n.interpolated .child {\n  a: 2; }\nBut instead we'll have:\n.parent .interpolated .child {\n  a: 2; }\nTemporary fix for me was:\n@mixin test{\n  @at-root body\n    #{\".interpolated\"}{\n      @content;\n  }\n}\nThanks all\n. ",
    "chetzof": "Any chance to get 3.3 in the next few days? I would gladly wait and switch from ruby version before i release a package that i'm working on.\nEdit: Ah, i see there are still quite a few issues before 3.3 milestone. Oh well :)\n. thanks!\n. Having the parent ticket marked as fixed, this specific case still does not work on latest beta.\nNow the output is \n```\n.address__headline {\n  color: #bebebe;\n}\n.address__headline--footer {\n  display: none;\n}\n.address--footer address__headline {\n  font-weight: bold;\n}\n```\nAlmost right, but notice the missing dot in the last selector.\n. Hey! Is this also included in 3.3 release ?\n. ",
    "Chocanto": "Issue still opened ? Is this bug not fixed ?\n. @xzyfer Wow, nice work. Thank you ! :)\n. ",
    "drone1": "Would you help me understand why not? Seems like a lot of what people complain about with regard to mixins being difficult to debug goes away if you have a feature like this.\nOn Wed, May 27, 2015 at 12:16 AM, Michael Mifsud notifications@github.com\nwrote:\n\nNo plans at the moment.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/1222#issuecomment-105790621\n. Roger that. Thanks.\n\nOn Wed, May 27, 2015 at 3:57 PM, Michael Mifsud notifications@github.com\nwrote:\n\nCurrently you are the only person asking for this. This issue is the first time I've heard of this feature. These two things tell me this is a very low priority. Certainly lower than getting feature parity with Ruby Sass.\nWe may eventually get to this but it's not a priority for anyone. We're open to pull requests.\nReply to this email directly or view it on GitHub:\nhttps://github.com/sass/libsass/issues/1222#issuecomment-106091262\n. \n",
    "dertieran": "Just wanted to add my +1 for this feature.\nNot sure what you consider as \"supported by Ruby Sass\".\nYou can't add it as a command line option (I think), but it is supported by sass.\nI used it with compass for example.\nWould be awesome to have this in libsass because it really helps when using some mixins.. ",
    "aaronharding": "Oh, yeah.. that worked. I feel derpy. Thanks man!\n. ",
    "jorgehatccrma": "Oops! Apologies for that ... in that case, keep up the good work!\n. Thanks. I found it and realized there's a related issue reported, so I\ndidn't report it.\nThanks!\nOn Fri, May 22, 2015 at 9:03 PM, Anthony Sottile notifications@github.com\nwrote:\n\n@jorgehatccrma https://github.com/jorgehatccrma the project you're\nlooking for is https://github.com/dahlia/libsass-python :)\n\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1232#issuecomment-104830956.\n\n\nJorge Herrera, Ph.D.c.\nCCRMA (Center for Computer Research in Music and Acoustics)\nStanford University\n. ",
    "una": "The docs look good to me, just did a few copy edits/notes to watch out for :smile: thanks for doing this!\n. I'd be happy to!\n. Maybe keep the consistent naming convention of \"LibsSass\" > \"libsass\"\n. Is this a note you mean't to address later? If not -- make it a full sentance\n. Here's another spot where \"LibSass\" is a unique spelling (Libsass here) <-- again, super minor\n. Sass & LibSass -- this will be my last comment on consistent naming :smile: \n. Can you link to the API here so people can read up on it for further details if they find a problem?\n. is this supposed to be \"only the\"?\n. copy edit idea: \nBy using custom importers, Sass stylesheets can be implemented in any possible way, such as by being loaded via a remote server. Please note: this feature is experimental and is implemented differently than importers in Ruby Sass. Imports must be relative to the parent import context and therefore we need to pass this information to the importer callback. This is currently done by passing the complete import string/path of the previous import context.\n. Here are two ebiulds to compile...\n. This is a good spot for alt text inside the []\n. hehehe SASS :see_no_evil: \n. ",
    "geniuscodemonkey": "Yeah it is an issue. Instead of seeing my custom font graphic, I see \u00ee\u20ac\u0192.\nI have a workaround that solves my immediate issue; so I'm not too worried about this at the moment, and I will probably tell another internal development team to use the same workaround (although it will take extra effort). But it is definitely something that should be looked at is possible. \n. ",
    "Risord": "What is status here?\nI think this is little bit difrent thing than https://github.com/sass/libsass/issues/1231 (but of course they maybe are related).\nI don't think that  is meaningless because output like \"\u00ee\u20ac\u0192\" is not meaningless on any encoding(?) Some testing (basicly same than on libsass-net topic): \n.myClass { \ncontent: \"\\f000\";\n}\n-> \"\\f000\" //Right\n$my-variable: \"\\f000\";\n.myClass { \ncontent: $my-variable;\n}\n-> \"\u00ef\u20ac\u0192\"\nAnd on both way if using actual utf-8 character \"\uf003\" its also leads to \"\u00ef\u20ac\u0192\". I tested that if output would be like in topic https://github.com/sass/libsass/issues/1231 so real utf character -> everything would work fine. In practice this problem cause problem when working with icons of font awesome library (http://fortawesome.github.io/Font-Awesome/).\n. ",
    "jaicab": "Thanks @HugoGiraudel for setting up this issue!\nIt's interesting that when you add some actual text around it (like an html tag or something) it does work. Check out my original example on SassMeister.\n. ",
    "guptamo": "It prevents the browser from rendering the glyphs completely.\nFrom what I\u2019ve seen it isn\u2019t simply the text editor not respecting the encoding, the character is re-written to the css output as\u00a0\u25fb.\nCheers,\nMohit Gupta\nOn May 27, 2015 at 11:30:09 AM, Michael Mifsud (notifications@github.com) wrote:\nI have noticed this aswell, however in my experience this doesn't affect the browsers's behaviour. Please confirm this actually causes an issue?\n\u2014\nReply to this email directly or view it on GitHub.\n. Ok let me walk you through how I get to the error.\n1. Download source SASS files right here\n2. Create a virtualenv and install libsass though pip\n   pip install libsass\n3. Unzip SASS source files into the virtualenv\n4. Activate the virtualenv\n5. Use sassc command to compile the SASS source files\n   sassc materialize.scss materialize.css\nThis is an excerpt compiled with Compass\n.mdi-navigation-menu:before{content:\"\\e8a1\"}\nThis is the same excerpt compiled using SASS\n.mdi-navigation-menu:before { content: \ue8a1; }\nNot sure if this is relevant but I'm using Sublime Text 3 and just in case I checked the css using TextEdit.\n. ",
    "kmsheng": "same issue here\n.glyphicon-plus:before {\n  content: \"\\2b\"\n}\nThe result will omit the slash in libsass 3.2.5\n. ",
    "nicholascloud": "@xzyfer Awesome, that worked, thank you!\n. ",
    "apfelbox": "This is not yet implemented in neither sass nor libsass.\nSee sass/sass#690 and sass/sass#1094 for related issues.\n. @yratof is it possible that you have installed sass-globbing in your rubysass?\n. Yep: https://incident57.com/codekit/help.html#sass\n\nImport Globbing\nCodeKit supports \"globbing\" import statements in Sass. If you write @import 'someFolder/*', all Sass files in \"someFolder\" will be imported in alphabetical order. When you change one of the imported files, CodeKit will recompile the base file.\n\nSo they either used the extension linked above or implemented it themselves. But either way: it is a custom Codekit solution.\n. I know of this workaround, but is this not a bug? @xzyfer . (Sassmeister tells me, that this was fixed in LibSass 3.5.0.beta.2 https://www.sassmeister.com/gist/62baf195a564f3ac62a954a03d4f8586). ",
    "adambair": "I've run into this problem as well while trying out the recent release of sassc-rails https://github.com/bolandrm/sassc-rails (hit 1.0 yesterday).\n```\nError: named arguments must precede variable-length argument\n        on line 152 of ../../.rvm/gems/ruby-2.0.0-p451@openbay/gems/compass-core-1.0.3/stylesheets/compass/_support.scss\n\n\ne for-legacy-browser($browser, $range..., $threshold: $threshold, $ranges: $br\n```\n. \n\n",
    "pkmiec": "This is related to https://github.com/sass/libsass/issues/872\n. Thanks. I'll work on getting a self-contained example today.\n. That's been my experience as well; the resulting .css is correct (thus it is difficult to make a spec in sass-spec). However, the following patch to libsass shows the problem,\npatch\ndiff --git a/parser.cpp b/parser.cpp\nindex 2c6bc72..ec41473 100644\n--- a/parser.cpp\n+++ b/parser.cpp\n@@ -236,6 +236,7 @@ namespace Sass {\n   {\n     bool has_import = false;\n     string load_path = unquote(import_path);\n+    cout << \"-- \" << import_path << \"\\n\";\n     for (auto importer : importers) {\n       // int priority = sass_importer_get_priority(importer);\n       Sass_Importer_Fn fn = sass_importer_get_function(importer);\n``` scss\n/ example.scss /\n@import \"_one.scss\";\n@import \"_three.scss\";\n/ _one.scss /\n@import \"_two.scss\";\n.one { color: #100; }\n/ _two.scss /\n.one { color: #200; }\n/ _three.scss /\n.one { color: #300; }\n```\ncompiling sassc with the patched libsass,\nsassc %> bin/sassc /tmp/example.scss /tmp/out.scss\n-- /tmp/example.scss\n-- \"_one.scss\"\n-- \"_three.scss\"\n-- \"_two.scss\"\nWhich means that importers will see _three.scss before _two.scss.\n. ",
    "JLHwung": "Another situation might be relevant to this issue, see http://sassmeister.com/gist/6b58d3d5b01bb2a932c6\nThis snippet is from bootstrap-sass-official and it breaks the apperance of breadcrumb component.\n. ",
    "okdana": "Thank you for fixing this!\n. Oh, that does sound like it. Should i close this in favour of the other one?\n. Is this OK?\n```\n% cat test-case.scss\n@function bar() {\n    $baz: (\n        to top       : bottom,\n        to top right : bottom left,\n        to right top : left bottom,\n        to right     : left\n    );\n    @return 0;\n}\n.foo { width: bar(); }\n% sass test-case.scss\n.foo {\n  width: 0; }\n% sassc test-case.scss\nError: Duplicate key \"to right top\" in map (to top: left, to top right: left bottom).\n        on line 2 of test-case.scss\n\n\n$baz: (\n   -------^\n```\n. \n\n",
    "marek-saji": "In case someone have the same problem and finds this issue \u2014 temporary workaround for my SVG problem is to use single interpolation:\ncss\ndiv\n{\n    $size: '10px';\n    $color: '%23FF0000';\n    background-image: url(\"data:image/svg+xml,#{ \"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100% 100%' width='\" + $size + \"' height='\" + $size + \"'><circle cx='50%' cy='50%' r='50%' fill='\" + $color + \"' /></svg>\" }\");\n}\n. ",
    "thebestako35": "just following the thread, just want to ask how did you fix this issue?\n. sorry just newbie in sass , can you enlight me with this code issue\n  $conversion-map: ( \n    to top          : bottom,\n    to top right    : bottom left,\n    to right top    : left bottom,\n    to right        : left,\n    to bottom right : top left,\n    to right bottom : left top,\n    to bottom       : top,\n    to bottom left  : top right,\n    to left bottom  : right top,\n    to left         : right,\n    to left top     : right bottom,\n    to top left     : bottom right\n  );\n. im using gulp to compile my scss\n. ",
    "helios1989": "hi gud evening , same issue here just want to ask what did i miss here\n\n. can you tell me what will be the work around for this issue?\n. ",
    "driekus77": "Perhaps an idea is to compile libsass as a static lib and let sassc as brother/sister project, not as sub library, use this library? \nI already did this in my personal fork: https://github.com/driekus77/libsass.net.mixed. Heir both libsass and sassc are submodules. A checkout of a (main) lib must always build without having todo other thinks first.\n. Its an assertion so probably you only see/discover it only when running libsass in debug.\nI tested it on Windows using Visual Studio 2013 to get libsass in debug\nUnfortunately I don't know the foundations version number anymore because I only have the .scss files. I can push the foundation scss files if you want?\nRemember that I tested it with libsass-net (C# wrapper arround libsass)\n. Its an assertion so probably you only see/discover it only when running libsass in debug.\nI tested it on Windows using Visual Studio 2013 to get libsass in debug\nUnfortunately I don't know the foundations version number anymore because I only have the .scss files. I can push the foundation scss files if you want?\nRemember that I tested it with libsass-net (C# wrapper arround libsass)\n. Ok I pushed my foundation Sass/Scss files to:\nhttps://github.com/driekus77/SassDebugTests/tree/master/foundation\nUse default.scss as input for your test\n. I overlooked something concerning my suggested fix. A few lines before the fix and right after the u.find_first_of...:\nstring unit(u.substr(l, r - l));  <== r is also used and can be npos (huge number)\nBut when I move the npos check up right after the u.find_first_of... \nFoundation output is not oke.\nCan somebody with domain knowledge please check if r needs to be checked sooner?\nThanks & Greetings,\nHenry\n. Aha sorry for the fuss didn't see youre commit. Only looked at the code in 3.5.2 release.\nThanks for your quick responds.\nGreetings, Henry\n. Oke I fixed most of the warnings and code analysis issues in a fork: \nhttps://github.com/driekus77/libsass\nAfter that I tested by compiling foundation and bootstrap with sassc.\nI hope the fixes are usefull.\nKind regards,\nHenry\n. Thanks for quick respons!\nI have created a pull request: \nhttps://github.com/sass/libsass/pull/1378\nKind regards,\nHenry\nVerstuurd vanaf mijn iPhone\n\nOp 24 jul. 2015 om 10:38 heeft Michael Mifsud notifications@github.com het volgende geschreven:\nThanks for the report @driekus77. Could you please pull request from your fork?\n\u2014\nReply to this email directly or view it on GitHub.\n. Thanks for the \"fail fast\" lesson. Martin Fowler related reading is always ok. \n\nI will close this pull request and create 2 new ones:\n- Fixing Warnings with MSVS 2015\n- Fixing Code analysis issues with MSVS 2015\nAgain thanks for the quick feedback.\n. My experience with git(hub) is lacking: What do you meen with \"Could you please base this PR off master?\u201d\nRebase or Create a branch on driekus77:libsass which is more describing?\nKind regards,\nHenry \n\nOn 27 jul. 2015, at 02:59, Michael Mifsud notifications@github.com wrote:\nCould you please base this PR off master?\n. Hi all,\n\nThanks for the extensive help!\nI managed somehow, with also a little help from SourceTree tool (Atlassian), to rebase in a code_issue branch and merge this branch back to master.\nI now get:\n\"This branch is 18 commits ahead of sass:master\"\nWhich looks a little bit strange because I didn't do 18 commits. Maybe something went wrong?\nI have the code still save on my laptop (At work now).\nThanks again and greetings,\nHenry\n. Sorry for the mess-up and thanks for cleaning.\nI should dive into git\u2019s rebase a little further.\nJust take the new PR and do with it what you want. I\u2019ll take my hands off of it because You guys know the code the best. \nIf I can help in any other way just mail me(e.g. testing).\nThanks again and Kind regards,\nHenry\n\nOn 28 jul. 2015, at 04:57, Michael Mifsud notifications@github.com wrote:\nHmm ok looks like things got a little messed up here. I've created #1408 https://github.com/sass/libsass/pull/1408 to track this from now on. This will allow me to fix the git history myself whilst maintaining @driekus77 https://github.com/driekus77 authorship!\n\u2014\nReply to this email directly or view it on GitHub https://github.com/sass/libsass/pull/1381#issuecomment-125418134.\n. \"data context\" only counts for input?\n\nI was more thinking in the line of C++ streams:\nvoid CompileToStream(std::istream* scssInput, std::ostream* cssOutput, std::ostream* srcMapOutput = nullptr);\nBut I can imagine that you want to keep the C API clean of C++?\nTechnical indept (Please correct me if I'm wrong):\nInput Stream => (Pre)Lexer => Parser(s) => Abstract Syntax Tree (AST) => Compiler => Output Stream.\nIn above workflow only the AST will need extensive memory. The streaming will be \"Read/Write and forget\".\nBut it totally depends on if one of the other components needs (in memory) reference to the input or output data.\nNext added feature is that C++ streaming can give you locale/encoding conversion support for free.\n. ",
    "jaredmorrow": "I can also confirm this still fails on SmartOS.\n. Head of master @b2a3d98ed384d2d19aa79157d08fa21c3e8043e0\n. We found a few things and fixed them, but don't know how portable our fixes are\n. Yeah, I'll get you a PR in the next 10 min hopefully, just retracing our steps.\n. I understand the pain of keeping up with the integration tests.  Having a Solaris or BSD handy is pretty hard for every library maintainer.\n. Totally understand, as the packager of Riak once-upon-a-time, I had to run 16 VMs for our own internal build service since no online/service came close to providing all the things we needed.  For anything short of a company-sponsored, for-pay product (like RIak), it is overkill to do the same.\n. @xzyfer PR #1782 fixes it for us, but we weren't too sure what was going on in those enum's that required the #undef\n. Thinking about this a bit more, the proper way to install it would be to set PREFIX to be /opt/local, and then I wouldn't have to use the CFLAGS, but then the PREFIX setting in the makefile would have to be changed to be ?= instead of = and that might start down the slippery slope of multi-platform support littering the makefile.\n. Ah, okay.  Well we can fix it by specifying a proper PREFIX for SmartOS then.\n. I'll stay subscribed to this PR, so just holler and I'm willing to make any changes and re-push.\n. Fixed in latest commit, and properly set PREFIX, which was the original need for the -p.  Lastly, I removed a conditional that wasn't needed when you can just use the ?= to get the same logic.\n. Should I remove the Makefile changes so this PR can merge?  I'm fine either\nway, I can easily document setting the proper variables on the command\nline.\nOn Sunday, December 20, 2015, Michael Mifsud notifications@github.com\nwrote:\n\nI think we should just rename all constants and prefix them with something\nlike LIBSASS_ to avoid issues like the SEC one. Otherwise it'll be the\nendless chase...\nMakes sense to me. Should be its own PR though.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/pull/1782#issuecomment-166211527.\n. \n",
    "dennisfrank": "@mgreter @xzyfer If this is already fixed, that would be great! \nBTW same issue with @each:\n@each $item, $value in $items {\n    .#{$foo}:before,\n    [data-attribute=\"#{$foo}\"]:before,\n    [data-another-attribute=\"#{$foo}\"]:before {\n        content: \"whatever\";\n  }\n}\n. Hm. This file has LF unix line endings: http://cl.ly/code/2Y21191G2S3p/download/test.app.scss\nSame problem.\n. Thanks guys! :)\n. ",
    "patrickording": "I don't know what was wrong but I did my project set-up from scratch and now it works.\n. ",
    "chenxiaochun": "I am sorry it's my mistake.\nIt should't has the double quotation mark. But removed, the Ruby Sass will throw exception.\n. OK, thank you very much.\n. There are also problems with the latest version.. Yes, it's running well.. ",
    "natecavanaugh": "Awesome, thank you! :)\n. ",
    "andrew-skybound": "I've run some additional tests and it looks like there are quite a few failing cases which are all likely related to the originally reported issue.\nHere are six test cases, showing interpolation around a function call, and around a parenthesized expression.  The first six declarations are the test cases themselves, the next six show the type-of(), and the last six show the length().\nInput:\np {\n    color: #{A}round(0.5);\n    color: round(0.5)#{B};\n    color: #{A}round(0.5)#{B};\n    color: #{A}(B C);\n    color: (B C)#{D};\n    color: #{A}(B C)#{D};\n    /* typeof */\n    color: type-of(#{A}round(0.5));\n    color: type-of(round(0.5)#{B});\n    color: type-of(#{A}round(0.5)#{B});\n    color: type-of(#{A}(B C));\n    color: type-of((B C)#{D});\n    color: type-of(#{A}(B C)#{D});\n    /* lengths */\n    color: length(#{A}round(0.5));\n    color: length(round(0.5)#{B});\n    color: length(#{A}round(0.5)#{B});\n    color: length(#{A}(B C));\n    color: length((B C)#{D});\n    color: length(#{A}(B C)#{D});\n}\nRuby Sass\np {\n  color: A1;\n  color: 1B;\n  color: A1B;\n  color: AB C;\n  color: B CD;\n  color: AB CD;\n  /* typeof */\n  color: string;\n  color: string;\n  color: string;\n  color: string;\n  color: string;\n  color: string;\n  /* lengths */\n  color: 1;\n  color: 1;\n  color: 1;\n  color: 1;\n  color: 1;\n  color: 1;\n}\nLibsass\np {\n  color: Around(0.5);\n  color: round0.5B;\n  color: Around0.5B;\n  color: A(B C);\n  color: B CD;\n  color: AB CD;\n  /* typeof */\n  color: string;\n  color: list;\n  color: list;\n  color: string;\n  color: list;\n  color: list;\n  /* lengths */\n  color: 1;\n  color: 2;\n  color: 2;\n  color: 1;\n  color: 2;\n  color: 2;\n}\n. Input:\n```\ndiv {\n    foo: 'A'#{B};\n    foo: #{A}'B';\n    foo: 'A'#{B}'C';\n    foo: #{A}'B'#{C};\n    foo: A#{B}'C';\n    foo: 'A'#{B}C;\n    foo: #{A}B'C';\n    foo: 'A'#{B}C'D';\n    foo: 'A'B#{C}D'E';\n    foo: A'B'#{C}D'E';\n}\ndiv {\n    foo: type-of('A'#{B});\n    foo: type-of(#{A}'B');\n    foo: type-of('A'#{B}'C');\n    foo: type-of(#{A}'B'#{C});\n    foo: type-of(A#{B}'C');\n    foo: type-of('A'#{B}C);\n    foo: type-of(#{A}B'C');\n    foo: type-of('A'#{B}C'D');\n    foo: type-of('A'B#{C}D'E');\n    foo: type-of(A'B'#{C}D'E');\n}\ndiv {\n    foo: length('A'#{B});\n    foo: length(#{A}'B');\n    foo: length('A'#{B}'C');\n    foo: length(#{A}'B'#{C});\n    foo: length(A#{B}'C');\n    foo: length('A'#{B}C);\n    foo: length(#{A}B'C');\n    foo: length('A'#{B}C'D');\n    foo: length('A'B#{C}D'E');\n    foo: length(A'B'#{C}D'E');\n}\n```\nRuby SASS Output:\n```\ndiv {\n  foo: \"A\"B;\n  foo: A\"B\";\n  foo: \"A\"B\"C\";\n  foo: A\"B\"C;\n  foo: AB\"C\";\n  foo: \"A\"BC;\n  foo: AB \"C\";\n  foo: \"A\"BC \"D\";\n  foo: \"A\" BCD \"E\";\n  foo: A \"B\"CD \"E\";\n}\ndiv {\n  foo: string;\n  foo: string;\n  foo: string;\n  foo: string;\n  foo: string;\n  foo: string;\n  foo: string;\n  foo: string;\n  foo: string;\n  foo: string;\n}\ndiv {\n  foo: 1;\n  foo: 1;\n  foo: 1;\n  foo: 1;\n  foo: 1;\n  foo: 1;\n  foo: 1;\n  foo: 1;\n  foo: 1;\n  foo: 1;\n}\n```\nLibsass Output:\n```\ndiv {\n  foo: 'A'B;\n  foo: A'B';\n  foo: 'A'B'C';\n  foo: A'B'C;\n  foo: AB'C';\n  foo: 'A'BC;\n  foo: AB'C';\n  foo: 'A'BC'D';\n  foo: 'A'BCD'E';\n  foo: A'B'CD'E';\n}\ndiv {\n  foo: string;\n  foo: list;\n  foo: string;\n  foo: list;\n  foo: list;\n  foo: string;\n  foo: list;\n  foo: string;\n  foo: string;\n  foo: string;\n}\ndiv {\n  foo: 1;\n  foo: 2;\n  foo: 1;\n  foo: 2;\n  foo: 2;\n  foo: 1;\n  foo: 2;\n  foo: 1;\n  foo: 1;\n  foo: 1;\n}\n```\n. Here's another difference, which might be part of the same issue:\nInput:\nSASS\n@else{}\nRuby SASS:\nError: Invalid CSS: @else must come after @if\n        on line 1 of test.scss\nLibsass:\nCSS\n@else {}\n. Note that when @debug, @warn, or @error appear in a mixin which is included in a nested property scope, no error should be raised (the rules work as they normally would).\n```\n@mixin font-properties() {\n    weight: bold;\n    @warn \"Warning\";\n}\na {\n    font: {\n        @include font-properties();\n    }\n}\n```\nOutput:\nWARNING: Warning\n         on line 3 of test.scss, in `font-properties'\n         from line 8 of test.scss\n. I think @saper is correct in that it was not an intentional decision and rather a byproduct of Ruby SASS not having a clear specification.\nFrom a language design perspective, this behavior is terrible.  The output is unexpected, use cases are practically non-existant, and it means accurate syntax coloring is impossible without analyzing the AST.  Perhaps an issue should be opened upstream to have it reviewed, and possibly improved as a breaking change in a future version.\nIdeally the only operator that would act this way is dash, and only when there is no whitespace separating the interpolation and the identifier.\n```\n{\"margin\"}-top  // no problem here\n{a}+b           // this should concatenate like two ordinary strings\n{a}*2           // this should be an error\n{a}==\"a\"        // this should be \"true\"\n{a} -2          // this should result in a list, not a single unquoted string with a space in it\n```\nWishful thinking, perhaps.\n. @nex3 Thank you for the explanation.  sass/sass#1778 looks like a move in the right direction, for sure.\n. @gedkott The example you posted works just fine for me (the value of the last declaration comes out JUNK-appended-value).  I tried it with Libsass 3.3.2-32-gb2a3 and Ruby SASS as well.  Perhaps the version of node-sass you're using is linking an old version of Libsass.\n. ",
    "Designer023": "Just a note for anyone who needs a workaround before the updated version is released (or is stuck on an old version) can try the following:\n```\n{ '@-moz-document \\url-prefix()' } {  ...  }\n```\n. ",
    "Prince-Raul": "@xzyfer \nsorry, I write the code was wrong!\nI found the bug width #1210\uff0cths\uff01\nLIbsass when the next version released\uff1f\n. ",
    "mahtd": "Both of those still fail\n```\n$ sassc --version\nsassc: 3.2.5-14-g5c78\nlibsass: 3.2.5-164-g7796\nsass2scss: 1.0.3\n$ sassc nest-child-sibling.fail.scss\n.foo .bar .baz {\n  foo: bar; }\n.foo .bar .baz {\n  foo: bar; }\n.foo .bar .baz {\n  foo: bar; }\n```\n```\n$ sassc --version\nsassc: 3.2.5-14-g5c78\nlibsass: 3.2.5-166-g4aa1\nsass2scss: 1.0.3\n$ sassc nest-child-sibling.fail.scss\n.foo .bar .baz {\n  foo: bar; }\n.foo .bar .baz {\n  foo: bar; }\n.foo .bar .baz {\n  foo: bar; }\n```\n. Yeah, I can confirm that\nlibsass @ 3af051e~1 (4767390)\n$ sassc parent-sibling-parent.scss\n.foo + .foo {\n  foo: bar; }\nlibsass @ 3af051e\n$ sassc parent-sibling-parent.scss\n.foo + {\n  foo: bar; }\n. Looks like 06ad34e is the one that broke it\n. ",
    "indrekpaas": "@xzyfer no worries, just stumbled upon it the other day.\n. ",
    "hyunchulkwak": "thanks @xzyfer \n. ",
    "jvennix-rmn": "Thanks!\n. ",
    "technoAri": "I can't understand how to contribute... can u help me?????\nOn 17 August 2015 at 23:53, Marcel Greter notifications@github.com wrote:\n\nThe actual problem was ARGR(\"$alpha\", Number, 0, 1)->value() IMHO. We\nneed to check the returned value first (in this case ARGR does not seem to\nreturn anything).\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1443#issuecomment-131916994.\n. plz visit https://github.com/technoAri to see my contributions.\n. \n",
    "JohnAlbin": "Go, team! Go!\nLooking forward to this release as it fixes a show-stopping bug for me. #1280\n. So\u2026 your Sass file has something like this:\nscss\n// Assuming this file is in project-root/sass.\n@import \"../bower_components/bootstrap-sass/assets/stylesheets/bootstrap\";\n?\n. I found a simpler test case that didn't require using call(), so I've updated the above test case and the bug description. Both the old and the new test case produce the same error message.\n. ",
    "slyoldfox": "Same here. Curious to see if this will solve https://github.com/sass/node-sass/issues/970\n. @xzyfer would love if this could make it in the 3.3 release \n. The following is a more complex example with a mixin\n```\n$tablet-portrait:                 768px;\n$tablet-landscape:                980px;\n$desk-normal:                     1120px;\n$desk-big:                        1280px;\n$grid-breakpoints-immobile: (\n        'tablet-portrait':   '(min-width: ' + $tablet-portrait + ') and (max-width: ' + $tablet-landscape + ')',\n        'tablet-landscape':  '(min-width: ' +  $tablet-landscape + ') and (max-width: ' + $desk-normal + ')',\n        'desk-normal':       '(min-width: ' +  $desk-normal + ') and (max-width: ' + $desk-big + ')',\n        'desk-big':          '(min-width: ' +  $desk-big + ')'\n);\n@mixin grid-media-query($media-query, $breakpointDefinitions) {\n  $breakpoint-found: false;\n@each $breakpoint, $breakpointvalue in $breakpointDefinitions{\n    $name: $breakpoint;\n    $declaration: $breakpointvalue;\n@if $media-query == $name and $declaration{\n  $breakpoint-found: true;\n\n  @media only screen and #{$declaration} {\n    @content;\n  }\n}\n\n}\n}\n@each $name in map-keys($grid-breakpoints-immobile) {\n  @include grid-media-query($name, $grid-breakpoints-immobile) {\n    body.immobile & {\n      margin-bottom: 0;\n    }\n  }\n}\n```\nOutput on 3.3.3:\n```\n$ node-sass file.scss\n@media only screen and (min-width: 768px) and (max-width: 980px) {\n  body.immobile {\n    margin-bottom: 0; } }\n@media only screen and (min-width: 980px) and (max-width: 1120px) {\n  body.immobile {\n    margin-bottom: 0; } }\n@media only screen and (min-width: 1120px) and (max-width: 1280px) {\n  body.immobile {\n    margin-bottom: 0; } }\n@media only screen and (min-width: 1280px) {\n  body.immobile {\n    margin-bottom: 0; } }\n```\nOn 3.4.0\n$ node-sass -v\nnode-sass       3.4.0-beta1     (Wrapper)       [JavaScript]\nlibsass         3.3.0-beta2     (Sass Compiler) [C/C++]\n$ node-sass file.scss\n/c/Users/marc/AppData/Roaming/npm/node-sass: line 14:  7024 Segmentation fault      node \"$basedir/node_modules/node-sass/bin/node-sass\" \"$@\"\n. Thanks for checking up on this and adding the test cases. I'm AWAL next week for two weeks. If you need someone to test this on our .scss files, @HeadOnAPlate might be able to run those while I'm gone. \n. ",
    "hmoffatt": "Hmm, no just \"div {\" as input does not cause a crash for me.\n. Try master now?\n. Yes that works for me.\n. It's probably not new, but when I compile the sassc vcxproj I am getting these warnings from sass_context.cpp:\n1>c:\\dev\\test\\libsass\\src\\sass_context.cpp(193): warning C4297: 'copy_strings' : function assumed not to throw an exception but does\n1>          The function is extern \"C\" and /EHc was specified\n1>c:\\dev\\test\\libsass\\src\\sass_context.cpp(197): warning C4297: 'copy_strings' : function assumed not to throw an exception but does\n1>          The function is extern \"C\" and /EHc was specified\n. ",
    "urkle": "Will do.. Ideally I'd be including a patch as well :)   FYI..  (Xcode 6.4)\n$ gcc -v\nConfigured with: --prefix=/Applications/Xcode.app/Contents/Developer//usr --with-gxx-include-dir=/usr/include/c++/4.2.1\nApple LLVM version 6.1.0 (clang-602.0.53) (based on LLVM 3.6.0svn)\nTarget: x86_64-apple-darwin14.5.0\nThread model: posix\n. ",
    "Ghostavio": "awesome\n. ",
    "cahnory": "Sorry, I will :)\n. ",
    "bassplayer7": "@mgreter, I'm sorry about that. I absolutely should have included the code: I'm not sure why it didn't cross my mind.\n\nHere's where it happened to me, in case it affects your error message:\n```\n.column {\n  & {\n    width: 31%;\n    margin: 1rem 1.5%;\n    display: inline-block;\n    vertical-align: top;\n&-half {\n  @extend &;\n}\n\n}\n}\n```\nThat was perhaps what made me miss the error of my way originally is that it was not extending a parent selector. I was trying to extend .column, but would have extended .column-half unintentionally. I'm not sure if that would impact the error message. \nThanks for working on this! I appreciate libsass very much. \n. Ok. Great. Right, I didn't expect the SCSS to compile, I was just commenting on the error message. And, & could, and often would be a parent selector, so that message would make sense. Again, I really appreciate your work on that.\n. Could you provide a small example of the code that is causing the issue? I just tested a nested import and it worked fine. I'm wondering if there is a syntax error that is the root cause of the issue?\n. ",
    "brookjordan": "Why not allow extending of parent selectors?\nI was hoping this would work \u2014 I'm using B__E--M and would love for modifiers to be able to extend their parent without having to type the full parent selector out.\n. Oops, sorry. Thanks @xzyfer !\n. ",
    "ezekg": "Awesome. That explains why the issue is closed. Thanks for the link. :+1: \n. Looking at trying to create a test case. I really can't figure out why this is happening. I'll look into it further tonight if I have some time.\n. The error message is misleading (I'm guessing it's due to running out of memory).\nI located the issue and fixed it after some digging around with a simple change: https://github.com/ezekg/flint/commit/59b91597a608c8f5aad9188863711de4268abae9#diff-53d9f7f0f068dabf1ef294b4181ddbcf. I made a costly mistake calling that function twice (it's quite intensive, doing a recursive search attempting to find a matching key inside a potentially large map).\nI'll try to dig into it more to figure out why it was causing an infinite loop in Libsass and if that change did indeed fix the issue. I just ran your test case above, so I'll run more tomorrow.\n. I'll work on fixing those warnings tomorrow. I think I found a few more edge cases in the Libsass compilation that I'm going to look into as well. I'll report back tomorrow.\n. @xzyfer, @saper I've been running some additional tests and found this so far:\nInput (test.scss)\n``` scss\ntest-1 test-2 test-3 test-4 test-5,\ntest-6 test-7 test-8 test-9 test-10 {\n    @each $set in & {\n        set: inspect($set);\n    @each $selector in $set {\n        selector: inspect($selector);\n    }\n}\n\n}\ntest-1 test-2 test-3 test-4 test-5,\ntest-6 test-7 test-8 test-9 test-10 {\n    @for $i from 1 through length(&) {\n        $set: nth(&, $i);\n        set: inspect($set);\n    @each $selector in $set {\n        selector: inspect($selector);\n    }\n}\n\n}\n```\nRuby Sass (sass test.scss)\n``` css\ntest-1 test-2 test-3 test-4 test-5,\ntest-6 test-7 test-8 test-9 test-10 {\n  set: test-1 test-2 test-3 test-4 test-5;\n  selector: test-1;\n  selector: test-2;\n  selector: test-3;\n  selector: test-4;\n  selector: test-5;\n  set: test-6 test-7 test-8 test-9 test-10;\n  selector: test-6;\n  selector: test-7;\n  selector: test-8;\n  selector: test-9;\n  selector: test-10; }\ntest-1 test-2 test-3 test-4 test-5,\ntest-6 test-7 test-8 test-9 test-10 {\n  set: test-1 test-2 test-3 test-4 test-5;\n  selector: test-1;\n  selector: test-2;\n  selector: test-3;\n  selector: test-4;\n  selector: test-5;\n  set: test-6 test-7 test-8 test-9 test-10;\n  selector: test-6;\n  selector: test-7;\n  selector: test-8;\n  selector: test-9;\n  selector: test-10; }\n```\nLibSass (sassc test.scss)\n``` css\ntest-1 test-2 test-3 test-4 test-5,\ntest-6 test-7 test-8 test-9 test-10 {\n  set: test-1 test-2 test-3 test-4 test-5, test-6 test-7 test-8 test-9 test-10;\n  selector: test-1 test-2 test-3 test-4 test-5, test-6 test-7 test-8 test-9 test-10; }\ntest-1 test-2 test-3 test-4 test-5,\ntest-6 test-7 test-8 test-9 test-10 {\n  set: test-1 test-2 test-3 test-4 test-5;\n  selector: test-1;\n  selector: test-2;\n  selector: test-3;\n  selector: test-4;\n  selector: test-5;\n  set: test-6 test-7 test-8 test-9 test-10;\n  selector: test-6;\n  selector: test-7;\n  selector: test-8;\n  selector: test-9;\n  selector: test-10; }\n```\nSeems like iterating over & with an @each loop doesn't behave correctly. I'm guessing this has something to do with the null values I've been getting.\nShould I open a new issue for these as I find them or keep them all here?\n. ",
    "mknadler": "Weird & cool!\n. More generally, it looks like the issue is that maps accept keys without values in libsass but not ruby sass:\n$map: (\n  foo, \n  bar: baz\n);\ndoes not cause an error, but probably should?\n. makes sense to me! this was not exactly something I was trying to do in order to accomplish anything, moreso a weird edge case I stumbled upon.\n. ",
    "andybenedict": "Thanks for the quick response. You guys rock.\n. Sorry, I thought attribute selectors went wonky if they were ahead of the value. Must have set up my check in the browser wrong. \nI also pulled the sass  ruby gem (which I don't use because libsass is so much faster) and got the same sequencing problem. So it looks like it is upstream.\nI'll move forward with my project and report this as a minor bug to the sass project.\nThanks again and sorry for the error and confusion. And you guys still rock!\n. ",
    "patrick-wc": "This works:\n.width-1\\/3\nis recognised as class=\"width-1/3\"\n. ",
    "gabriellecrawford": "hi, yes ruby sass gives the value that ends with c8 on both windows and linux\nlet me look into the version question, we're using grunt-sass which uses node-sass?\nMy coworker said he tried running with the node-sass 3.3.3 and the problem still exists...\n. so we're using grunt-sass 1.0.0 which I think uses node-sass 3.0.0 which uses libsass 3.2.0?\n. Hmmm. I believe the linux boxes we have are running OEL 5.\n. just to elaborate, we just switched over from running the same scss files on the same machines from running ruby sass to libsass. Ruby used to give c8 on all machines, libsass still gives c8 on our OEL machines, but c7 on windows....\n. Great, thank you!!!!\n. I'm sorry, but I don't understand this answer, by implementor do you mean node-sass? My team is using libsass and grunt...\n. thank you! I'm wondering one more thing, can file a separate issue depending on your answer. If I explicitly put @charset \"UTF-8\"; at the beginning of my sass file it's stripped, shouldn't it be passed through?\n. ",
    "conceptdeluxe": "I think I have discovered a similar / related bug with:\nsassc: 3.3.0\nlibsass: 3.3.2-32-gb2a3\nsass2scss: 1.0.5\nInput:\n$foobar-color: #f0706f;\n$foobar-bg: lighten($foobar-color, 50%);\n$foobar-border: darken($foobar-bg, 5%);\n.foobar {\n    border-color: $foobar-border;\n}\nOutput SASS / Ruby:\n.foobar {\n  border-color: #fde8e8; }\nOutput SassC / LibSass:\n.foobar{border-color:#f2f2f2}\n. ",
    "mafrosis": "Yeah I cd'd into libsass first, which explains the No such file of directory. If I run make -j5, all that's produced is lib/libsass.a.\nI deleted the libsass directory and re-cloned it - and had another unexpected outcome:\n```\n\nmake -j5 sassc                                                                                                                  5:13:57\nmkdir lib\ncc -Wall -O2 -DLIBSASS_VERSION=\"\\\"3.3.0-beta2\\\"\" -I /opt/libsass/libsass/include -fPIC -fPIC -c -o src/cencode.o src/cencode.c\ng++ -Wall -O2 -DLIBSASS_VERSION=\"\\\"3.3.0-beta2\\\"\" -std=c++0x -I /opt/libsass/libsass/include -fPIC -fPIC -c -o src/ast.o src/ast.cpp\ng++ -Wall -O2 -DLIBSASS_VERSION=\"\\\"3.3.0-beta2\\\"\" -std=c++0x -I /opt/libsass/libsass/include -fPIC -fPIC -c -o src/base64vlq.o src/base64vlq.cpp\ng++ -Wall -O2 -DLIBSASS_VERSION=\"\\\"3.3.0-beta2\\\"\" -std=c++0x -I /opt/libsass/libsass/include -fPIC -fPIC -c -o src/bind.o src/bind.cpp\ng++ -Wall -O2 -DLIBSASS_VERSION=\"\\\"3.3.0-beta2\\\"\" -std=c++0x -I /opt/libsass/libsass/include -fPIC -fPIC -c -o src/color_maps.o src/color_maps.cpp\ng++ -Wall -O2 -DLIBSASS_VERSION=\"\\\"3.3.0-beta2\\\"\" -std=c++0x -I /opt/libsass/libsass/include -fPIC -fPIC -c -o src/constants.o src/constants.cpp\ng++ -Wall -O2 -DLIBSASS_VERSION=\"\\\"3.3.0-beta2\\\"\" -std=c++0x -I /opt/libsass/libsass/include -fPIC -fPIC -c -o src/context.o src/context.cpp\nIn file included from src/context.hpp:18:0,\n                 from src/ast.hpp:35,\n                 from src/color_maps.cpp:1:\nsrc/plugins.hpp:7:28: fatal error: sass/functions.h: No such file or directory\n #include \"sass/functions.h\"\n                            ^\ncompilation terminated.\nIn file included from src/context.hpp:18:0,\n                 from src/ast.hpp:35,\n                 from src/bind.cpp:2:\nsrc/plugins.hpp:7:28: fatal error: sass/functions.h: No such file or directory\n #include \"sass/functions.h\"\n                            ^\ncompilation terminated.\nIn file included from src/context.hpp:18:0,\n                 from src/ast.hpp:35,\n                 from src/ast.cpp:1:\nsrc/plugins.hpp:7:28: fatal error: sass/functions.h: No such file or directory\n #include \"sass/functions.h\"\n                            ^\ncompilation terminated.\ng++ -Wall -O2 -DLIBSASS_VERSION=\"\\\"3.3.0-beta2\\\"\" -std=c++0x -I /opt/libsass/libsass/include -fPIC -fPIC -c -o src/cssize.o src/cssize.cpp\nIn file included from src/context.hpp:18:0,\n                 from src/ast.hpp:35,\n                 from src/context.cpp:14:\nsrc/plugins.hpp:7:28: fatal error: sass/functions.h: No such file or directory\n #include \"sass/functions.h\"\n                            ^\ncompilation terminated.\nIn file included from src/context.hpp:18:0,\n                 from src/ast.hpp:35,\n                 from src/cssize.hpp:4,\n                 from src/cssize.cpp:5:\nsrc/plugins.hpp:7:28: fatal error: sass/functions.h: No such file or directory\n #include \"sass/functions.h\"\n                            ^\ncompilation terminated.\nMakefile:230: recipe for target 'src/color_maps.o' failed\nmake:  [src/color_maps.o] Error 1\nmake:  Waiting for unfinished jobs....\nMakefile:230: recipe for target 'src/bind.o' failed\nmake:  [src/bind.o] Error 1\nMakefile:230: recipe for target 'src/ast.o' failed\nmake:  [src/ast.o] Error 1\nMakefile:230: recipe for target 'src/context.o' failed\nmake:  [src/context.o] Error 1\nMakefile:230: recipe for target 'src/cssize.o' failed\nmake:  [src/cssize.o] Error 1\n```\n. For whatever reason, I just could not get this to compile. However, I used the instructions from over here with success:\n\nhttps://github.com/sass/sassc/blob/master/docs/building/unix-instructions.md\n. ",
    "scniro": "Definitely not intentional, and definitely not a sass issue. See sassmeister gist. This will work fine on the current version of sass (3.4.14), but selecting libsass 3.2.5 will reproduce the error (control panel setting)\n. ",
    "nkovacs": "Is this related? \n``` scss\na.asc:after {\n    content: /\"\\e113\"/ \"\\e151\";\n}\na.desc:after {\n    content: /\"\\e114\"/ \"\\e152\";\n}\n```\nWorks fine with sass 3.4.14, breaks with libsass 3.2.5\n. ",
    "karneaud": "ok i installed a local node-sass into the project folder and ran\nnode_modules/.bin/node-sass test.scss test.css\non\n```\n@function makelongshadow($color, $len) {\n  $val: 0px 0px $color;\n  @for $i from 1 through $len {\n    $val: #{$val}, #{$i}px #{$i}px #{$color};\n  }\n  @return $val;\n}\n@mixin longshadow($color, $len:34) {\n  text-shadow: makelongshadow($color, $len);\n}\n.test\n{\n  @include longshadow(black);\n}\n```\nand got \n\n{\n  \"message\": \"error parsing interpolated value\",\n  \"column\": 11,\n  \"line\": 4,\n  \"file\": \"/Users/kendallarneaud/Documents/Git/fridgemusic/test.scss\",\n  \"status\": 1\n}\n. @stevenschobert  FYI\n. updated to node-sass@beta1 and got the error\nMixin \"clearfix\" does not accept a content block\n\nthe clarify mixin\n```\n@mixin clearfix {\n  *zoom: 1;\n&:before, &:after {\n    content: \" \";\n    display: table;\n  }\n&:after {\n    clear: both;\n  }\n}\n```\n. ",
    "peterwilsoncc": "Thanks @saper, very much appreciated.\n. ",
    "ofca": "Ok, I made some testing and I just learn something new about sass. It seems that I made a wrong assumption about how sass compile some directives to css, and I don't need to use @at-root directive at all. I still think aliasing @at-root by caret would be great but it's not neccassary to BEM technique.\nI'm sorry to bother you, and I'm closing this issue.\n. ",
    "anmolsarma": "@saper It would. The void* just makes it really obvious that you only need enough memory to store a pointer.\n. ",
    "ArcticSnowman": "This is essential to use this module on Centos6 based hosts, in corporate environments\n. In our corporate environment, we are required to stick to the officially supported Centos6 releases of GCC, which is stuck at 4.4.7.   And while there are a whole host of work-around, that's not the route we want our developers to go down if we can help it.\n. ",
    "k-funk": "My shop only supports GCC 4.4.7 on our production machines. I'd love to see this get merged in, and libsass-python library updated when it's ready.\n. Any progress on this, or is it decided to not have 4.4 support?\n\nI don't feel comfortable attempting gcc 4.4 support\n\nStill seems pretty unreasonable that libsass can't be used on CentOS 6 (LOTS of shared-hosting boxes).. ",
    "Roguelazer": "+1 most production environments aren't going to support gcc5 for a while, it would be nice to keep Saas working without requiring crazy-bleeding-edge versions of things. Enterprise life-cycles are measured in years, not months...\n. ",
    "absalomedia": "OK. Managed to wrangle my PHP & HHVM integrations up to 3.3.0..  Still working on the Nginx Libsass 3.3 edition..\nWhen will the API documentation be updated?\n. ",
    "toptalo": "Yes! Thanks!\n. ",
    "NielsDoucet": "I understand. In the ruby-sass implementation this appears to throw an error as well.\nIs there a way to detect that a mixin is called from within a parent selector? Or should we change its signature and pass in the parent directly?\nAlso: has the spec changed regarding this parent selector '&'? Because we have been using this code since april 2014, without any problem.\n. Ok, I experimented a bit and it turns out length(&) seems to return 1, even if there is no context.\nIt contains an empty string as its element.\nI managed to guard the code by using this function instead:\n@function hasContext() {\n  @return nth(&, 1);\n}\nThanks for pointing me in the right direction.\n. ",
    "mlarcher": "any news on the matter ?\n. Here is what is generating the problem in my context:\n```\n// getPrefixes\n// this function is used by mixins to set the proper progressive enhancement prefixes\n@function getPrefix($feature, $useModernizr: true) {\n  $yesPrefix: '';\n  $noPrefix: '';\n  @if $useModernizr {\n    $yesPrefix: '.' + $feature;\n    $noPrefix: '.no-' + $feature;\n  }\n  @return (yes: $yesPrefix, no: $noPrefix);\n}\n@mixin remIt($attr, $values, $before: '', $between1: ' ', $between2: ' ', $between3: ' ', $after: '', $useModernizr: true) {\n$cssremunit: getPrefix(cssremunit, $useModernizr);\n// it's good to keep the fallback at all times for debug purpose\n  #{map-get($cssremunit, no)} & {\n@if length($values) == 1 {\n  #{$attr}: #{$before}#{nth($values, 1)}px#{$after};\n}\n@if length($values) == 2 {\n  #{$attr}: #{$before}#{nth($values, 1)}px#{$between1}#{nth($values, 2)}px#{$after};\n}\n@if length($values) == 3 {\n  #{$attr}: #{$before}#{nth($values, 1)}px#{$between1}#{nth($values, 2)}px#{$between1}#{nth($values, 3)}px#{$after};\n}\n@if length($values) == 4 {\n  #{$attr}: #{$before}#{nth($values, 1)}px#{$between1}#{nth($values, 2)}px#{$between1}#{nth($values, 3)}px#{$between1}#{nth($values, 4)}px#{$after};\n}\n\n}\n#{map-get($cssremunit, yes)} & {\n@if length($values) == 1 {\n  #{$attr}: #{$before}#{pxToRem(nth($values, 1))}rem#{$after};\n}\n@if length($values) == 2 {\n  #{$attr}: #{$before}#{pxToRem(nth($values, 1))}rem#{$between1}#{pxToRem(nth($values, 2))}rem#{$after};\n}\n@if length($values) == 3 {\n  #{$attr}: #{$before}#{pxToRem(nth($values, 1))}rem#{$between1}#{pxToRem(nth($values, 2))}rem#{$between1}#{pxToRem(nth($values, 3))}rem#{$after};\n}\n@if length($values) == 4 {\n  #{$attr}: #{$before}#{pxToRem(nth($values, 1))}rem#{$between1}#{pxToRem(nth($values, 2))}rem#{$between1}#{pxToRem(nth($values, 3))}rem#{$between1}#{pxToRem(nth($values, 4))}rem#{$after};\n}\n\n}\n}\n.some-class {\n    @include remIt(font-size, 16);\n}\n```\nresulting in\n```\n\".no-cssremunit\" .some-class {\n  font-size: 16px;\n}\n\".cssremunit\" .some-class {\n  font-size: 1rem;\n}\n```\ninstead of the expected (and previously fine until 3.4)\n```\n.no-cssremunit .some-class {\n  font-size: 16px;\n}\n.cssremunit .some-class {\n  font-size: 1rem;\n}\n```\n. ",
    "yoannisj": "What's the status on this? I tried to work around the issue/bug without success:\na) by using with: rule instead of without: media\n`````scss\n.a {\n  color: red;\n}\n@media print {\n  .b {\n    @at-root (with: rule) {\n      @extend .a;\n    }\n  }\n}\n`````\nb) by introducing the parent selector reference &\n`````scss\n.a {\n  color: red;\n}\n@media print {\n  .b {\n    @at-root (without: media) {\n      & {\n        @extend .a;\n      }\n    }\n  }\n}\n`````\nTrial b actually throws another error:\nError: You may not @extend an outer selector from within @media.\n    You may only @extend selectors within the same directive.\n    From \"@extend .a\" on line 12 of stdin\n    on line 1 at column 1\nEdit: tried with 'Libsass 3.5.0-beta.2'. both methods work in Sass '4.0.0-alpha.1'. ",
    "tomgenoni": "@mgreter This is just a reduced case to reproduce the issue. It's a change in behavior from the previous version. You can see the expected output with an earlier version of Libsass and Ruby Sass at http://sassmeister.com/gist/4c34daba378d7269af35\n. It appears that with the BEM selector the .class--modifier is being reversed to --modifier.class\n```\n%foo,\n.foo {\n display:block; \n&--up {\n   border: none;\n }\n}\n.zoo {\n  @extend %foo;\n&--up {\n    @extend %foo--up;\n  }\n}\n```\nexpected:\n```\n.zoo,\n.foo {\n  display: block;\n}\n.zoo--up,\n.foo--up {\n  border: none;\n}\n```\nwith Libsass v3.3.1:\n```\n.zoo,\n.foo {\n  display: block; \n}\n--up.zoo,\n .foo--up {\n    border: none; \n}\n```\n--up.zoo should be .zoo--up. I think that's the extent of this issue.\nhttp://sassmeister.com/gist/0d5e1935dfb0538f908e\n. ",
    "atalis": "We recently switched to the latest version of Node from a much older version and had to upgrade a 3rd party library we are using, to be compatible with the current Node version.  Now things are broken all over the place because of this bug.  I understand this issue is not resolved in libsass yet, so I'm trying to figure out recursively what versions of our dependencies  we'd need to go back to in order to get rid of this issue.  \nSo, a few questions (apologies, if I missed this info here, this thread is a bit convoluted):\n1. What version of libsass was this bug introduced?\n2. What version is the fix going into - 3.5?  4.0?\n3. When is that version scheduled to release?  (Or has it already been released, perhaps?)\n. ",
    "steveworkman": "As @xzyfer said, try a custom importer, I had an issue where we had .scss files and .css files in the same directory, and here's the importer I made for node-sass\njavascript\nimporter: function(url, prev, done) {\n    // Use this to import scss files, instead of css ones\n    let updatedUrl = url;\n    if (!url.endsWith('.scss') && !url.endsWith('.css')) { // Also don't change ones already explicitly set to .css\n        updatedUrl += '.scss';\n    }\n    grunt.verbose.writeln(`Changed ${url} into ${updatedUrl}`);\n    done({file: updatedUrl});\n}\nTested with node-sass 4.5.2 libsass 3.5.0-beta2. ",
    "yisibl": "Please fix this problem as soon as possible.Thanks! :ghost: \n. @xzyfer Thanks.\nWhen did gulp-sass sync to this version?\n. ",
    "aarongeorge": "A work around for now is to create a variable and unquote it:\n```\n$breakpoint: 'tablet';\n$class: unquote('.-#{$breakpoint}');\n{$class} {\ncolor: #FFF;\n\n}\n```\n. Awesome work.\nThanks @xzyfer!\n. @xzyfer Any reason brew will only pull down v3.2.5 on El Capitan?\n. ",
    "bolandrm": "For what it's worth, in SassC-Ruby, I've implemented this as @mgreter says.  Converting first with sass2scss.\n. ",
    "j-walker23": "@xzyfer Hey, thanks for you approach on this. Greatly appreciated.\nI am what seems like forever through a huge angular globals refactor into jspm and dynamic modules. Quite a task lol.\nI saved the sass for the end, which is a ton of only indented syntax.\nMy point to all of this is because i have spent so much time i would like to finish strong with sass using the latest/cool techs like with javascript and everything else. So i am wondering what all is involved with this issue technically, if its something i could realistically handle i would be happy to.\n. ",
    "DanPurdy": "Ok looks like I've jumped the gun a bit here, looks like an issue deeper into the mixin that I missed, will close this now and report back.\n. ",
    "randallmeeker": "I'm getting a different symptom, but same thing. When I do compressed the following class name .something-white will get turned into .something-#fff\n. example \nhttp://sassmeister.com/gist/5906a5c199e1d50f328b\n. In my case I found if needed to enclose the string in quotes to be fixed. \nhttp://sassmeister.com/gist/df83bf821ef3a65b6283\n. ",
    "lolmaus": "For anyone wondering, I use @at-root like that to avoid polluting the global variable/mixin/function namespace.\n. I'm sorry, I've included wrong code example.\nThis one should cause a segmentation fault:\n``` scss\n@at-root\n@import 'foo';\nhtml {\n    color: red;\n  }\n```\nlibsass 3.3.1, node-sass 3.4.1.\n. ",
    "LPGhatguy": "I would promote this bug's fix being delayed until after #1776 is also resolved -- as it stands this bug is the best way to sidestep the issue.\n. ",
    "sheinzle": "Ran across the same bug today when debugging Bourbon's @mixin transition. When passing a list within an arglist it is processed wrongly.\nHere is a simplified version of the bug:\n```\n@mixin property-test($properties...) {\n    @warn \"#{type-of($properties)}\"; // returns arglist\n    @each $property in $properties {\n        @warn \"#{type-of($property)}\"; // returns string instead of list\n    }\n}\n.test {\n    @include property-test(transform 0.6s, opacity 0.1s);\n}\n```\n. ",
    "jbeales": "Thanks @mgreter - I'm excited to see this in production so I can switch back to libsass, and leave slow Ruby sass behind :)\n. ",
    "evilebottnawi": "@saper whereas it is possible to do?\n. @xzyfer but this not work in ie8. It is not good :(\n. @xzyfer good, it is bad\n. @xzyfer error based on https://github.com/webpack-contrib/sass-loader/issues/416\nI tried this example:\n```shell\n$testMap: (\n    white: (color: white)\n);\n@each $key in map-keys($testMap) {\n    .test-btn-#{$key} {\n        $colors: map_get($testMap, $key);\n    color: map-get($colors, color);\n}\n\n}\n``\nIn https://www.sassmeister.com/ withLibSass v3.5.0.beta.2,Sass v4.0.0.alpha.1,Sass v3.4.21,Sass v3.3.14withcompressedoutput, btw inSass v3.5.0.pre.rc.1this example doesn't work.. @xzyfer seems yes, local testing on3.5.0.beta.2also have this problem. @xzyfer should i create this issue in originalsass` repo?. @xzyfer can your provide example how i can solve this problem in my example?\n\nIn Sass you should quote your strings if you want to use them as strings.. @xzyfer thanks, i constantly learn something new about sass/scss :smile: . \n",
    "gkatsev": "There is an issue open against sass to have a cli flag to output ascii-only: https://github.com/sass/sass/issues/1395\nWould it be possible for libsass to implement it first ahead of ruby sass?\n. ",
    "Taritsyn": "functions.cpp file contains fix to the following error:\nError   7   error C2061: syntax error : identifier 'uint_fast32_t'\nThis error occurs when you compile in Visual Studio 2013.\n. @am11 Thanks for tip. I made changes to functions.cpp file.\n. > \u2026, comparing to LibSassHost only running on full .NET Framework. That might be an important factor to some developers.\n@tompazourek LibSassHost supports a .NET Core (.NET Standard) since version 1.0.0.. ",
    "safareli": "+1\n. ",
    "unfulvio": "+1\n. ",
    "harryfinn": "@saper this error is also present when trying to @import \"local/file\"; (local import rather than from external url) - is there something in place to also allow this with libsass or an accepted current limitation of @import for local files?\n. @xzyfer from what I understand of the associated PR's above, PR #1848 allows the use of @import within control directives for libsass, bringing it inline with ruby sass, or have I got that wrong?\nI've just tried @saper's code in my libsass powered project and it now works having updated my version of node-sass (which I assume therefore includes the fixes in PR #1848) however, when I amend the code to use a local file it fails again\n. ",
    "gedkott": "Based on the comment by @andrew-skybound \"#{a}+b // this should concatenate like two ordinary strings\", I believe I am seeing the same problem. To start, here are the details of my environment, system, etc. to as great as detail as I can provide (let me know if there is something more I should mention):\nOS X Yosemite 10.10.5\nnode engine v0.10.40\nnpm 3.5.1\ngulp-sass version 2.1.0\nnode-sass version 3.4.2\nI was seeing some odd behavior in the output of my scss files processes by node-sass.\nHere is the example that is causing the problem:\n```\n// example.scss\n$SOME_STRING_TO_INTERPOLATE_WITH: \"JUNK\";\ndiv {\n  color: #{$SOME_STRING_TO_INTERPOLATE_WITH} + '-appended-value';\n}\np {\n  color: $SOME_STRING_TO_INTERPOLATE_WITH + '-appended-value';\n}\np.special {\n  color: \"#{$SOME_STRING_TO_INTERPOLATE_WITH -appended-value}\";\n}\n$ANOTHER_VAR: #{$SOME_STRING_TO_INTERPOLATE_WITH} + '-appended-value';\ndiv.wrong {\n  color: $ANOTHER_VAR;\n}\n$STILL_ANOTHER_VAR: #{$SOME_STRING_TO_INTERPOLATE_WITH}+'-appended-value';\ndiv.still-wrong {\n  color: $STILL_ANOTHER_VAR;\n}\n```\n```\n//output.css\ndiv {\n  color: JUNK-appended-value; \n}\np {\n  color: \"JUNK-appended-value\"; \n}\np.special {\n  color: \"JUNK -appended-value\"; \n}\ndiv.wrong {\n  color: JUNK-appended-value; \n}\ndiv.still-wrong {\n  color: JUNK; \n}\n```\nThe problem is that div.still-wrong was expected to have a color property of JUNK-appended-value, but it just leaves off the 'appended-value' part. I know how to fix it and that is by just placing a space between the variables, strings, and operators like in the ANOTHER_VAR example. This works, but I don't understand what is actually wrong. I have been chasing this bug for some time and just stumbled across this issue conversation. I'm still lost as to why this is an issue though. Am I seeing the same problem? If so, can anyone do me a huge favor and explain what is going on here? \n. ",
    "nek4life": "Having the same issue with python-libsass, it seems it's the underlying libsass implementation of sourcemaps\n. ",
    "tehOPEologist": "thank you so much @mgreter, so i should use that branch for now to get the sourcemapping i'd like?\n. @mgreter so there isn't a fix for this currently is what you're saying?  i'm confused by your \"ctrl+click\" comment, as that would just bring up the file itself and the first selector..  doesn't go to the line where the style you've clicked on is.\n. ahh nice, thanks i guess i can use that for now till it gets cleared up in chrome.  thanks again!\n. i agree @xzyfer and i appreciate this problem being addressed!  will continue to monitor.  thank you again!\n. /applauds @mgreter :clap: :clap: :clap: :clap:  ^_^\n. just realized https://github.com/sass/libsass/issues/1901 is the same issue.  closing.\n. ",
    "ggedde": "@mgreter @tehOPEologist  This issue is still going on.\nI understand both sides to this and it seems that making a hard change is not ideal.\nSo why not just have a simple compile option to allow for it.\nie.\n--single-level\nThis way you leave it up to the developer to use it accordingly depending on their tools and IDE, etc.\nOR change \"single-level\" to the default and have --multi-level as an option.  Since no IDE currently requires the multi-level source maps.\nEither-way works.. ",
    "jkrehm": "Yep. That's not the exact code, but it's close enough to get the idea.\n. I think I narrowed down the issue to when the include path is something like this: ../www-root.\nFile layout:\n\n/* www-root/styles/style.scss */\n@import \"vendor/foo/bar\";\n/* www-root/vendor/foo/bar.scss */\n@import \"test\";\n/* vendor/foo/_test.scss */\nbody {\n    color: #123456;\n}\nIn the tools directory run npm install node-sass. Finally, while in the tools directory run:\nnode_modules/.bin/node-sass ../www-root/styles/style.scss -o ../www-root/styles/ --include-path ../www-root\nWith node-sass 3.4.1 it works just fine.\nWith node-sass 3.4.2 I get the following error:\n{\n  \"formatted\": \"Error: File to import not found or unreadable: test\\n       Parent style sheet: ../www-root/vendor/foo/bar.scss\\n        on line 1 of ../www-root/vendor/foo/bar.scss\\n>> @import \\\"test\\\";\\n   ^\\n\",\n  \"message\": \"File to import not found or unreadable: test\\nParent style sheet: ../www-root/vendor/foo/bar.scss\",\n  \"column\": 1,\n  \"line\": 1,\n  \"file\": \"../www-root/vendor/foo/bar.scss\",\n  \"status\": 1\n}\n. Have you guys been able to reproduce the issue now?\n. I think this and #1750 are the same issue.\n. ",
    "btwolfe79": "I've been having the same issue where sass files that try to import relative paths no longer work .... I'm using gulp-sass and have had to lock down the old version (2.0.3) to keep things working.  We use gulp-sass -> node-sass -> libsass ... and after 2.0.3 of gulp-sass trying to include sass imports (from our bower dir) fail to find any imports that try to use relative paths.  Something as simple as Foundation or Ionic sass files (with @import \"panel\") will fail to resolve... the file is local (in nested bower scss folder) to the current file.\nWould love to hear some other thoughts/ideas on how to solve... I can't find any other people talking about this.  Using Windows environment.\nThanks!\n. Can't provide a true sample, but here's the gist:\ngulpSass.sass({\n includePaths : {\n   [\n    'myBowerDirectory/foundation-apps/scss'\n   ]\n }\n})\nFoundation scss file (in this case /foundation-apps/scss/components/_grid.scss) has \"@import \"panel\"\".\n_panel.scss is available in the same path as _grid.scss.  However, with newer versions of libsass this results in \"File to import not found\".\nThis worked properly in earlier version of gulp-sass -> node-sass -> libsass\n. ",
    "x-yuri": "@mgreter I understand the kludge is still in effect? It may be that it's not needed anymore. I didn't test it thoroughly, but from my couple of attempts it seems like at least Chromium 63 looks for the next mapping after the opening curly bracket.\nAnd there's a [related issue][2], where a guy from Firefox team wants to change libsass behavior. But it may be an opportunity to change how Firefox handles things.\n[2]: https://github.com/sass/node-sass/issues/2092. Well, it appears I mistook scss code for css. But why scss, if it was originally sass?. Closing in favor of webpack/css-loader#381. ",
    "pdaoust": "This is something that'd have to become part of the official Sass spec first. The Sass developers have stated that they don't intend to implement it. Is there a specific thing about maps that frustrates you?\n. ",
    "catamphetamine": "The error goes away when I put semicolons inside:\n```\n@media all and (min-width: 901pt)                          { @import \"l-xl.scss\"; }\n@media all and (min-width: 601pt)  and (max-width: 900pt)  { @import \"m-l.scss\";  }\n@media all and (min-width: 241pt)  and (max-width: 900pt)  { @import \"s-m.scss\";  }\n@media all                         and (max-width: 900pt)  { @import \"xs-m.scss\"; }\n@media all                         and (max-width: 600pt)  { @import \"xs-s.scss\"; }\n@media all and (min-width: 1601pt)                         { @import \"xl.scss\"; }\n@media all and (min-width: 901pt)  and (max-width: 1600pt) { @import \"l.scss\";  }\n@media all and (min-width: 601pt)  and (max-width: 900pt)  { @import \"m.scss\";  }\n@media all and (min-width: 241pt)  and (max-width: 600pt)  { @import \"s.scss\";  }\n@media all                         and (max-width: 240pt)  { @import \"xs.scss\"; }\n```\n. I guess this issue can be closed for now since your tests pass.\n. ",
    "googol7": "also happens if you forget to add a semicolon ; after an @import \"xyz\";\n. ",
    "telamon": "\nalso happens if you forget to add a semicolon ; after an @import \"xyz\";\n\nMan that just wasted some of my time, could we get some better error reporting on this one?. ",
    "timschoch": "We work with SharePoint, thus our generated files only work on the Server while the sass files are only locally. I don't think this scenario would work with source maps?\n. Thanks @xzyfer for pointing this out. I just tried it and it works like a charm! \nHow did I miss that? This is exactly what I was looking for.\n. ",
    "davidmeirlevy": "h1 {\n        width :calc(100% - 110px);\n}\n. ",
    "jonasjonas": "Thanks for the feedback!\nI'll look into it.\n. ",
    "clord": "Ah crap, I went and basically wrote this exact same PR :) patiently waiting for a pull on this one now.\n. ",
    "MelonHTML5": "@xzyfer sorry, what line breaks? Is there such a setting in sass?\n. @xzyfer, the line number source map says is wrong. For example, it will say line 17 in button.scss, but the code is actually on line 87.  It appears that each \"content: $fa-var-glass;\" increases the number by 1. For example, when there are 20 \"content: $fa-var-glass;\" in your SCSS code, the wrong line number souce maps says will be 20 larger than the actual line number. Hope that makes sense. \nAnd in the fontawesome scss, there are hundreds of \"content: $fa-var-glass;\" definitions in SCSS code which as I described above, makes all the line number several hundreds larger than when they should be.   \nTo replicate this, what you can do is\n1. Create an app.scss\n2. Write the code in app.scss and compile it with a source map\n3. sassc -m -t compressed app.scss app.css\n3. Create a blank html page and include the app.css file. Inspect the body element in chrome dev tools, it will say margin: 10px on line 7 of app.scss, but it is actually on line 12. The difference is 5 (12 - 7 = 5) which is the 5 lines (containing \"\\\") defined at the top of the file. \nCode:\n```\n$variable-example1: \"\\example1\";\n$variable-example2: \"\\example2\";\n$variable-example3: \"\\example3\";\n$variable-example4: \"\\example4\";\n$variable-example5: \"\\example5\";\nbody {\n    &:before {\n        content: $variable-example1;\n    }\nmargin: 10px;\nbackground: white;\n\n}\n```\n. @xzyfer, I've updated the code example above, please try again. Compiling the code in ruby sass works, but not in libsass.\n. Any updates? @xzyfer \n. ",
    "kylemacfarlane": "I just ran into this bug as well. This issue needs reopening.\nHere's my cut down demo that triggers this bug:\n```\n@mixin icon() {\n    $code: '\\00a0'; // Unicode whitespace\n    content: $code;\n}\n.breadcrumb {\n    &:before {\n        @include icon();\n    }\n}\n.hello-from-line-12 {\n    background: red;\n}\n```\nThe generated sourcemap says that .hello-from-line-12 is coming from line 2 which is obviously wrong.\n. ",
    "Coridyn": "I'm using MinGW32 from the ruby devkit environment (Ruby 2.2.3p173 with DevKit mingw64-32-4.7.2).\nI don't think it's that though - the first check for Windows is matching so it doesn't fall through to the MinGW cases at all.\nLine 23 of the Makefile has the Windows check:\nmake\nifneq (,$(findstring WINDOWS,$(PATH)))\n    # Matches here because \"WINDOWS\" is in the PATH variable\n    UNAME := Windows\nelse\n    # Doesn't get here because it's already detected as \"Windows\"\n    ifneq (,$(findstring mingw32,$(MAKE)))\n        UNAME := MinGW\n    else\n        # This `uname` check would work if it reached this far.\n        ifneq (,$(findstring MINGW32,$(shell uname -s)))\n            UNAME = MinGW\n        else\n            UNAME := $(shell uname -s)\n        endif\n    endif\nendif\n. ",
    "blabute": "My apologies. Below is a code that will compile.\n```\n/---------------------------------------------------------------------------\\\n    TEST\n*---------------------------------------------------------------------------*/\n    header {\n    background-color: blue;\n\n} // header\n\n```\n. ",
    "lobinga": "You should revise the readme.md which say to can use VS 2013 Update 4+.\nIf I want to use VS2013\uff0cI need to use which commit\uff1f\n. ",
    "BboyKeen": "You're right. After deeper research, it appears that the faulty plugin in my pipeline is gulp-concat-css which rebases the svg url in the wrong way.\nSorry for the inconvenience.\n. ",
    "xoofx": "Sorry to bump into this PR, as I required almost something very similar to @am11 is looking in the PR #1973 \nThough, I would like to add a simple sass_string_alloc function instead of a sass_string_dup (or copy from c), as I would like to avoid duplicating the allocation in C# (as I can dump directly a wchar string to utf8 string, instead of dumping to my own allocated utf8 string, and then copy/reallocate the same utf8 string in libsass)\n. So @mgreter Would you like me to make a PR with a new sass_allocate_memory and sass_free_memory as you suggested here?\n. @xzyfer indeed, that's quite related!, sorry I didn't look much further at existing PR. Though, I would prefer to have an alloc function instead of only a string duplicate, so that I can avoid double allocating while I can dump directly the UTF8 string to the allocated slot.\n. > @xoofx never mind my previous comment, I'm hungry.\nNo, I did a fix and push force in the meantime ;)\nYou can see above a PR for sassc using this API.\n. @mgreter I tested it only on my wrapper and in the sassc branch. I have checked that using sass_option_set_include_path together with sass_option_push_include_path was correctly appending paths. It is not really a breaking change nor an additional feature but really just a bug fix. Previous API were just no-op.\n. I have tested it on the command line (only on Windows), so yes, I made a test, though quite basic. I was assuming also that there are some unit test using it?\n. > @xoofx can you rebase this to latest master so CI passes. Thanks!\ndone\n. ship it! :sweat_smile: \n. Also a broader plan would be to replace all internal malloc/free so that they go through this API to allocate things (and internally also all C++ objects would use the same allocator), so that custom mem allocator could then be pluggable.\n. Well, the previous code was basically a no-op (filling include_paths and then after freeing it).\nThat being said, there is a slight issue with c_ctx->include_paths that will not be released.\nBut I'm really not enough sure how ownership is currently working in libsass, if you could enlighten me. Looking at the code, I would assume that include_paths should be free in the sass_clear_context. Is it correct?\n. ah, actually, https://github.com/sass/libsass/blob/master/src/sass_context.cpp#L527 seems to release things, should be ok then? :sweat_smile: \n. ",
    "arkonan": "If sass/sass#1425 is trying to match LESS's behavior I would expect \n.btn {\n    .open& {\n        color: #000;\n    }\n}\nto produce\n.open.btn {\n  color: #000;\n}\n(rather than output the & into the CSS)\n. ",
    "matthias-vogt": "@jakob-e It's an edge case, but if the string gets split exactly where a theoretical match of a substring would be, that match won't be replaced. Fixing that needs some creativity \ud83d\ude01\n. @jakob-e Just for anyone looking for a generic string-replace function. I wouldn't want anyone to have to debug that :P\n. Congrats on the release :) Sorry, i confused the version with my npm version. It's actually 3.8.0.\nI was able to reproduce it with libsass (v3.3.6) on sassmeister:\nhttp://www.sassmeister.com/gist/adff8f5343405f4c7bc94fa95108df69\n. Well that was quick, thanks a lot!\n. ",
    "stevenvachon": "css\n@custom-media --large-viewport (min-width: 1001px);\nHaven't checked Ruby Sass.\n. @mgreter this isn't completely solved:\nsass\n@custom-media --viewport-lg (width >= 64em);\n@custom-media --viewport-md (width <  64em) and (width >= 40em);\n@custom-media --viewport-sm (width <  40em);\nproduces:\n```\nError: Undefined operation: \"width gte 64em\".\n        on line 1 of stdin\n\n\n@custom-media --viewport-lg (width >= 64em);\n   -----------------------------^\n\n\n{\n  \"status\": 1,\n  \"file\": \"stdin\",\n  \"line\": 1,\n  \"column\": 30,\n  \"message\": \"Undefined operation: \\\"width gte 64em\\\".\"\n}\n```\nPerhaps this could be related to #1911?\n. awesome! when is it due?\n. Ruby Sass? Uh-oh -- that thing is so behind on bug-fixes.\n. Ok, thank you.\n. I would've preferred to have access to a plugin instead of waiting for v4, but I guess this is as done as it'll get until then.\n. I would like to be able to write future-CSS, containing features such as @custom-media in Sass/SCSS; and today, not in the distant future when Sass v4 is released. Much of this is explained in the link within my original comment.\n. I don't know how Sass works internally. This issue was a question on how I would achieve what I had achieved with Less.js\n. @xzyfer I'm having difficulty finding the issue number for the namespacing feature in v4\n. ",
    "manuel-di-iorio": "@xzyfer Yup, I'll do thanks :+1: \n. ",
    "jessedoyle": "Great thank you! This fixes my problem.\nI'll look into a documentation PR in the near future.\n. ",
    "k0kubun": ":cool: \nThank you!\n. ",
    "gauteh": "In fact this variant seems to work as expected:\n```\n$foo: global-variable-exists(test-var);\n@if ($foo) { \n  @debug (\"exists\"); \n} @else {\n  @debug (\"does not exist\");\n}\n``\n. Ah, apparently the spaces in between function and () causes the problem. Confused.\n. Actually, is this a bug in the spec that it cannot have spaces between function-name and ()? It is certainly inconsistent with the rest of CSS.\n. From looking at git blame the culprit might be 6a5444b2, if I remove the call tosass_file_context_set_options` the error is lost. I cannot inspect the structs more in depth using gdb at this point since I do not have access to the complete type in gdb.\nAdding a sass_option_set_input_path (options, scsspath); makes no difference.\n. From looking at git blame the culprit might be 6a5444b2, if I remove the call to sass_file_context_set_options the error is lost. I cannot inspect the structs more in depth using gdb at this point since I do not have access to the complete type in gdb.\nAdding a sass_option_set_input_path (options, scsspath); makes no difference.\n. @mgreter Ah - sorry, I did not notice that. The problem is still with libsass 3.4.0. The example exhibits the problem, If I change it to (https://github.com/astroidmail/astroid/pull/249/commits/b44b9fcd50f5ba9bfe728d426ddb23001eda5199):\n```\n    struct Sass_File_Context file_ctx = sass_make_file_context(scsspath);\n    struct Sass_Context context = sass_file_context_get_context(file_ctx);\n    sass_option_set_precision((Sass_Options) file_ctx, 1);\n    sass_option_set_source_comments((Sass_Options) file_ctx, true);\nint status = sass_compile_file_context (file_ctx);\n\nif (status != 0) {\n  const char * err = sass_context_get_error_message (context);\n  ustring erru (err);\n  LOG (error) << \"theme: error processing: \" << erru;\n\n  throw runtime_error (\n      ustring::compose (\"theme: could not process scss: %1\", erru).c_str ());\n}\n\nconst char * output = sass_context_get_output_string(context);\nustring output_str(output);\nsass_delete_file_context (file_ctx);\n\nreturn output_str;\n\n}\n``` \nit works.\n(on a side note: should I free output here? or is it freed by delete_file_context?). Hi @mgreter, thanks - your proposed fix works fine (and should be portable if you decide to change the class structure later on). I do not have libsass set up in a development environment at the moment, so I won't have the time to test #2259 now unfortunately. It does look like it would fix the issue though.. Thanks \ud83d\ude0a\nons. 21. des. 2016 kl. 01.10 skrev Marcel Greter notifications@github.com:\n\nClosing as resolved\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/sass/libsass/issues/2257#issuecomment-268396865, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AADd-7E5sivtMGP7bTl119Ti0qetcFr5ks5rKG5ygaJpZM4LRhQL\n.\n. \n",
    "sou-lab": "if .box at root\nscss\n.wrap {\n  @media (min-width: 480px) { \n    display: block;\n    @at-root (without: media rule) {\n    // or  @at-root (without: all) {\n      .box { \n        display: inline-block;\n      }\n    } \n  }\n}\n. ",
    "arnoldbird": "Thanks.  I know when I post a report like this, there is a chance I'm posting to the wrong project, but it's very hard for me to know where the problem lies.  In any case, something wasn't playing nice with something else, but I've since found a good combination for this project, based around compass and gulp-simple-compass.  In another project, I found that libsass + grunt-sass worked much better than compass.  An upgrade to Ubuntu 15.04 may be a factor this time (pure speculation), and/or the old libsass version I was using.  \nPerhaps it would make sense to close this.  : )\n. ",
    "joelperry93": "I am still getting this issue.\nlibsass 3.3.6\nnode-sass 3.7.0\nCan't see this ticket referenced in the release notes. Did this get fixed?\nCheers\n. Here is my SASS and the output. Is this the same issue as this ticket describes? I am getting it on libsass 3.3.3+\nSASS\n[class*=\"button-\"] {\n   &:hover:not(.button-disabled) {\n       transform: translate(0, 1px);\n   }\n}\nInvalid CSS (libsass >=3.3.3)\n[class*=\"button-\"]:hover:not(.button-disabled):not(.tablesorter-pager .button.disabled) {\n     -webkit-transform: translate(0, 1px);\n     transform: translate(0, 1px); \n}\nValid CSS (libsass <=3.3.2)\n[class*=\"button-\"]:hover:not(.button-disabled) {\n   -webkit-transform: translate(0, 1px);\n           transform: translate(0, 1px); \n}\n. Thanks for the response. It did turn out to be an issue with that .tablesorter-pager definition in another file. The 3.3.3 update must have started compiling it correctly and causing the issue on our end. Thank you.\n. ",
    "niutech": "Ok, I found it here: http://libsass.ocbnet.ch/installer/\n. I found it on a 3rd party server, but it doesn't resolve the issue\nbecause the binaries should be downloadable from the official repo (as\nreleases) to be trusted. Who has time, resources and knowledge to\nbuild them themselves?\n. I can see this domain belongs to you @mgreter, but it's hard to notice from the first view. So people may think the binaries are unofficial builds. Why aren't thay part of the official repo as releases?\n. ",
    "usta": "@niutech if your problem solved could you please close this issue\n. I hope  this one is correct code-style\n. I hope  this one is correct code-style\n. you are welcome\n. any comments ?\n. ",
    "RFV5s": "ME too\n. ",
    "sassanh": "This is the line that raises the error:\n@media screen and #{$str} {\nIf I add a @debug $str on top of it, it'll print out:\n/some/path/bower_components/foundation-sites/scss/util/_breakpoint.scss:138 DEBUG: \"'(min-width: \"40em)'\n. ",
    "joopvos": "Same problems here. Is there a doc about how to rollback Libsass in Codekit? I'm a front-front-end guy ... :\\\n[edit]\nOops ... I thought I updated Codekit but I didn't ... with 2.7.1 everything is fine now ... :)\n. ",
    "shoaibik": "Hi, I can confirm having a same error, I am using the latest Foundation\n``` scss\n\n\nError: media query expression must begin with '('\n        on line 139 of components/foundation-sites/scss/util/_breakpoint.scss\n\n\n-----------^\n```\n. \n\n\n\n",
    "lenz": "Same Problem here when using python-libsass 0.10.1 (=libbsass 3.2.3) on Debian 8 and OS X 10.8.\nError: media query expression must begin with '('\nMoreover on OS X 10.7 the Django runserver exits with a malloc error!\nThe malloc and media query problems are fixed on all systems when downgrading to python-libsass 10.0.0 (=libbsass 3.2.2)\n. ",
    "itkrt2y": "Sorry, I did not read Ruby-Libsass Readme properly...\nNow, updated the link!\n. ",
    "nowells": "Awesome fix @xzyfer! Thanks for fixing this!\n. ",
    "erbridge": "Sorry. I'll get to it when I have a moment.\n. ",
    "kenyakodaira": "@xzyfer \nThanks!\nI know, right.\nHowever , this program would succeed.\n```\n%btnBase {\n  display: none;\n}\n@mixin mobile {\n  @media only screen and (min-width:300px) {\n    @content;\n  }\n}\n@include mobile {\n  a {\n    @extend %btnBase;\n  }\n}\n```\nI want you to try to reproduce how.\n. @chriseppstein \nI have also wants the same result.\n. ",
    "sgen": "No I havent tried compiling it against ruby sass.\ngulp-sass@2.2.0\nnode-sass@3.4.2\nHow can I find my libsass version?\n. ",
    "bastei": "\nDoes it compile on the more recent 3.3.3?\n\nNo, it fails with the same error.\n. ",
    "bmvantunes": "I tested with gulp-sass@beta and it worked like expected.\nThanks a lot.\n. ",
    "ochafik": "Mmh, ok, that error message was a red herring, the root cause is the line below, which looks like #1451. Probably because prefix-usage is a Compass builtin :-(\n$usage: prefix-usage($prefix, $capability, $capability-options);\n  @if $usage > $threshold {\n. The right way to go might just be to use autoprefixer and hard code some constant prefix-usage to trick the Compass stylesheets into not using prefixes at all.\nClosing this issue.\n. Similarly, this source now fails to build with 3.4.5:\nscss\n%url-status {}\nurl-status {}\nWhile the following is fine:\nscss\n.url-status {}\n%foo-status {}. Ah, I see this was already fixed in master by https://github.com/sass/libsass/commit/82b8af61717a8ac4cecd3bd2f6375a20c583d3ea, cool!\nWould you have any ETA for 3.4.6?. Cool, thanks!. Cool, thanks!. Already fixed by https://github.com/sass/libsass/commit/82b8af61717a8ac4cecd3bd2f6375a20c583d3ea, closing this.. Could this bug please be reopened until master branch is fixed?. ",
    "mcMickJuice": "Hello,\nHas there been any headway on this issue? We use a BEM mixin as a helper to generate all of our bem styling.  as it currently stands sourcemaps are unusable with this approach.\ni understand this is a hard problem and I appreciate any and all work you do you on this issue.. ",
    "kgcreative": "Following this issue, as I'm running into the same thing. I'm temporarily getting around this by injecting some non-standard CSS during development, but that makes me feel unclean.. @paulirish - So, interesting discovery today while I was testing this out:\n```\n// source-map-test.scss\n@mixin source-map-test {\n display: block;\n}\n// properties\nmy-element {\n @include source-map-test;\n}\n``\nThe above code will output a source map, withmy-elementbeing credited tosource-map-test.scss`\nHOWEVER\n```\n// source-map-test.scss\n@mixin source-map-test {\n display: block;\n}\n// properties\nmy-element {\n /!/\n @include source-map-test;\n}\n```\nAdding an empty important comment before the mixin call, will result in a source map that credits my-element to my-element-source-file.scss (adding a normal comment // or /* */ doesn't work. But /*!*/ does work.)\nTested with node-sass via grunt-sass-2.0.0\nI have no idea why this works.. ",
    "generalov": "@kgcreative Looking at the http://sass-lang.com/documentation/file.SASS_REFERENCE.html#comments\n\nWhen the first letter of a multiline comment is !, the comment will always rendered into css output even in compressed output modes.\n\nThe /*!*/ comments are preserved on the output. For example:\nCommon case\nInput SCSS\n%foo {\n  color: red\n}\n.bar {\n  @extend %foo;\n}\n.baz {\n  @extend %foo;\n}\nOutput CSS\n.bar,\n.baz {\n  color: red;\n}\nUse /*!*/ comments\nInput SCSS\n%foo {\n  color: red\n}\n.bar {\n  /*!*/\n  @extend %foo;\n}\n.baz {\n  /*!*/\n  @extend %foo;\n}\nOutput CSS\n.bar,\n.baz {\n  color: red;\n}\n.bar {\n    /*!*/\n}\n.baz {\n    /*!*/\n}\nThe additional selectors are kept in the output. The Chrome inspector displays these rules. They are empty but included in Source Maps so the navigation is possible.. ",
    "mold": "Still having this problem when generating BEM selectors with mixins. @kgcreative's solution didn't work using gulp-sourcemaps@2.6.1 and gulp-sass@3.1.0.\nAny updates/ideas/recommendations?. ",
    "ksylor": "Chiming in to say that fixing this and/or having a workaround to trace back to the use of the mixin rather than the mixin itself would be super useful for some css analysis work my team is doing. Thanks!. ",
    "xxvii": "Same problem here.\nI switched from the Ruby generated sass to node/libsass generated sass.\nThe Ruby source maps show the row number relative to the css rule, while the libsass ones the row of the mixin that generated the selector, which is completely unuseful.\nIf iI want to know where a mixin is, all I have to do is a simple text search, but finding a specific css rule in a scss is way more complicated.\nBesides, Google Chrome's inspector shows the correct css rule row (and not the mixin row) while Firefox shows the mixin row with the same libsass generated source map. Why is that?. So...no news about that?\nFirefox still shows the mixin's row number instead of the rule's row number.. ",
    "humphrey": "!!! uWSGI process 23679 got Segmentation Fault !!!\n*** backtrace of 23679 ***\n/usr/local/bin/uwsgi(uwsgi_backtrace+0x2e) [0x4696ee]\n/usr/local/bin/uwsgi(uwsgi_segfault+0x21) [0x469ab1]\n/lib/x86_64-linux-gnu/libc.so.6(+0x36d40) [0x7ff2d80afd40]\n/opt/venv/polygon/local/lib/python2.7/site-    packages/_sass.so(_ZN4Sass6ExtendclEPNS_5BlockE+0xf5) [0x7ff2d0a88b55]\n/opt/venv/polygon/local/lib/python2.7/site-packages/_sass.so(_ZN4Sass7Context7compileEv+0x30b) [0x7ff2d0a030fb]\n/opt/venv/polygon/local/lib/python2.7/site-packages/_sass.so(_ZN4Sass12File_Context5parseEv+0x2f2) [0x7ff2d09fec92]\n/opt/venv/polygon/local/lib/python2.7/site-packages/_sass.so(sass_compiler_parse+0xcc) [0x7ff2d09f28cc]\n/opt/venv/polygon/local/lib/python2.7/site-packages/_sass.so(sass_compile_file_context+0x6d) [0x7ff2d09f2fbd]\n/opt/venv/polygon/local/lib/python2.7/site-packages/_sass.so(+0x960bb) [0x7ff2d09b40bb]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x4bd4) [0x7ff2d85cc0d4]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d) [0x7ff2d85cd54d]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x48d8) [0x7ff2d85cbdd8]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d) [0x7ff2d85cd54d]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x48d8) [0x7ff2d85cbdd8]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d) [0x7ff2d85cd54d]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0x1c37a5) [0x7ff2d86027a5]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyObject_Call+0x43) [0x7ff2d856ed43]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_EvalFrameEx+0xeb1) [0x7ff2d85c83b1]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x4b59) [0x7ff2d85cc059]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d) [0x7ff2d85cd54d]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0x1c37a5) [0x7ff2d86027a5]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyObject_Call+0x43) [0x7ff2d856ed43]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_EvalFrameEx+0xeb1) [0x7ff2d85c83b1]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x4b59) [0x7ff2d85cc059]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x4b59) [0x7ff2d85cc059]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x80d) [0x7ff2d85cd54d]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0x1c36d0) [0x7ff2d86026d0]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyObject_Call+0x43) [0x7ff2d856ed43]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0xbb7bd) [0x7ff2d84fa7bd]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyObject_Call+0x43) [0x7ff2d856ed43]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(PyEval_CallObjectWithKeywords+0x47) [0x7ff2d85e7577]\n/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0(+0x110f92) [0x7ff2d854ff92]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x8182) [0x7ff2d9a6c182]\n/lib/x86_64-linux-gnu/libc.so.6(clone+0x6d) [0x7ff2d817400d]\n*** end of backtrace ***\n. ",
    "tony": "I'm getting segfaults on buttons.scss.  At last I was able to build this on FreeBSD with full debug symbols (ah, refreshing).\nThis is the problem section: https://github.com/Dogfalo/materialize/blob/793e5716040cb133041b55be75b1fae51debb9f3/sass/components/_cards.scss#L107\n``` sass\n    a:not(.btn):not(.btn-large):not(.btn-floating) {\n      color: $card-link-color;\n      margin-right: $card-padding;\n      transition: color .3s ease;\n      text-transform: uppercase;\n  &:hover { color: $card-link-color-light; }\n}\n\n```\nIt seems to be the :not's. Which is what @xzyfer is experiencing. Builds fine without :not.\n``` gdb\n\n\n\n\n\nEXTENDED: [[.btn], [.btn-large]]\nEXTEND COMPLEX END: [.btn]\nEXTEND ORIGINAL SELECTORS: .card .card-action a:not(&.btn, &.btn-large):not(.btn-large):not(.btn-floating)\nEXTEND SETTING NEW SELECTORS: &.card .card-action a:not(&.btn, &.btn-large):not(.btn-large):not(.btn-floating)\nFOUND SELECTOR: .card .card-action a:not(&.btn, &.btn-large):not(.btn-large):not(.btn-floating):hover\nEXTEND COMPLEX: [.card, .card-action, a:not(&.btn, &.btn-large):not(.btn-large):not(.btn-floating):hover]\nLOOP: .card\nEXTEND COMPOUND: [.card]\nEXTEND COMPOUND END: [.card]\nEXTENDED: []\nADD SOURCES: [.card, .card-action, a:not(&.btn, &.btn-large):not(.btn-large):not(.btn-floating):hover]\nCHOICES UNSHIFTED: [[.card]]\nLOOP: .card-action\nEXTEND COMPOUND: [.card-action]\nEXTEND COMPOUND END: [.card-action]\nEXTENDED: []\nADD SOURCES: [.card, .card-action, a:not(&.btn, &.btn-large):not(.btn-large):not(.btn-floating):hover]\nCHOICES UNSHIFTED: [[.card-action]]\nLOOP: a:not(&.btn, &.btn-large):not(.btn-large):not(.btn-floating):hover\nEXTEND COMPOUND: [a, :not(&.btn, &.btn-large), :not(.btn-large), :not(.btn-floating), :hover]\nEXTEND COMPOUND END: [a, :not(&.btn, &.btn-large), :not(.btn-large), :not(.btn-floating), :hover]\nEXTENDED: []\nADD SOURCES: [.card, .card-action, a:not(&.btn, &.btn-large):not(.btn-large):not(.btn-floating):hover]\nCHOICES UNSHIFTED: [[]]\nEXTENDED NOT EXPANDED: [[[.card]], [[.card-action]], [[]]]\nPATHS: [[[.card], [.card-action], []]]\nWEAVE: [[.card], [.card-action], []]\nCURRENT: [.card]\nCURRENT POST POP: []\nLAST CURRENT: [.card]\nSUB: [[]]\nCURRENT: [.card-action]\nCURRENT POST POP: []\nLAST CURRENT: [.card-action]\nSUB: [[.card]]\nCURRENT: []\nProcess 20586 stopped\n thread #1: tid = 102164, 0x00000000005591b9 sasscSass::weave(Sass::Node&, Sass::Context&) [inlined] std::__1::deque<Sass::Node, std::__1::allocator<Sass::Node> >::back(this=0x0000000802974b08 size=0) + 113 at deque:1736, stop reason = signal SIGBUS: hardware error\n    frame #0: 0x00000000005591b9 sasscSass::weave(Sass::Node&, Sass::Context&) [inlined] std::__1::deque >::back(this=0x0000000802974b08 size=0) + 113 at deque:1736\n   1733 deque<Tp, _Allocator>::back()\n   1734 {\n   1735     size_type __p = __base::size() + __base::__start - 1;\n-> 1736     return ((__base::__map_.begin() + __p / __base::__block_size) + __p % __base::__block_size);\n   1737 }\n   1738\n   1739 template \n(lldb) bt\n thread #1: tid = 102164, 0x00000000005591b9 sasscSass::weave(Sass::Node&, Sass::Context&) [inlined] std::__1::deque<Sass::Node, std::__1::allocator<Sass::Node> >::back(this=0x0000000802974b08 size=0) + 113 at deque:1736, stop reason = signal SIGBUS: hardware error\n  * frame #0: 0x00000000005591b9 sasscSass::weave(Sass::Node&, Sass::Context&) [inlined] std::__1::deque >::back(this=0x0000000802974b08 size=0) + 113 at deque:1736\n    frame #1: 0x0000000000559148 sasscSass::weave(path=0x00000008029b4000, ctx=0x0000000801c2d000) + 984 at extend.cpp:1468\n    frame #2: 0x0000000000553aad sasscSass::extendComplexSelector(pComplexSelector=0x00000008025d0460, ctx=0x0000000801c2d000, subset_map=0x0000000801c2d1e8, seen=size=0, isReplace=false, isOriginal=true) + 5277 at extend.cpp:1875\n    frame #3: 0x000000000055043f sasscSass::Extend::extendSelectorList(pSelectorList=0x00000008025d5780, ctx=0x0000000801c2d000, subset_map=0x0000000801c2d1e8, isReplace=false, extendedSomething=0x00007fffffffcfbb) + 1503 at extend.cpp:1930\n    frame #4: 0x000000000055560b sasscvoid Sass::extendObjectWithSelectorAndBlock(pObject=0x0000000802b67ee0, ctx=0x0000000801c2d000, subset_map=0x0000000801c2d1e8) + 363 at extend.cpp:2011\n    frame #5: 0x000000000055547c sasscSass::Extend::operator(this=0x00007fffffffda50, pRuleset=0x0000000802b67ee0)(Sass::Ruleset*) + 44 at extend.cpp:2057\n    frame #6: 0x000000000047963e sasscSass::Ruleset::perform(this=0x0000000802b67ee0, op=0x00007fffffffda50) + 30 at ast.hpp:460\n    frame #7: 0x00000000005540a3 sasscSass::Extend::operator(this=0x00007fffffffda50, b=0x00000008027fe040)(Sass::Block*) + 163 at extend.cpp:2032\n    frame #8: 0x00000000004ddeae sasscSass::Block::perform(this=0x00000008027fe040, op=0x00007fffffffda50) + 30 at ast.hpp:425\n    frame #9: 0x00000000004aa0f6 sasscSass::Context::compile(this=0x0000000801c2d000) + 982 at context.cpp:661\n    frame #10: 0x00000000004a8f12 sasscSass::File_Context::parse(this=0x0000000801c2d000) + 3362 at context.cpp:584\n    frame #11: 0x00000000004228c6 sasscsass_parse_block(compiler=0x0000000801c220e0) + 422 at sass_context.cpp:324\n    frame #12: 0x00000000004226ff sassc::sass_compiler_parse(compiler=0x0000000801c220e0) + 191 at sass_context.cpp:470\n    frame #13: 0x00000000004223a5 sasscsass_compile_context(c_ctx=0x0000000801c26000, cpp_ctx=0x0000000801c2d000) + 37 at sass_context.cpp:359\n    frame #14: 0x00000000004225f7 sassc::sass_compile_file_context(file_ctx=0x0000000801c26000) + 439 at sass_context.cpp:457\n    frame #15: 0x000000000041b159 sassccompile_file(options=0x0000000801c24000, input_path=\"/home/z/study/materialize/sass/materialize.scss\", outfile=0x0000000000000000) + 105 at sassc.c:131\n    frame #16: 0x000000000041bb43 sasscmain(argc=2, argv=0x00007fffffffe7a0) + 1827 at sassc.c:332\n    frame #17: 0x000000000041ac7f sassc_start + 383\n```\n. If you're experiencing this with the python wrapper / django-libsass, lock yourlibsassat0.10.0`.\n\n\n\n\n\npip install libsass==0.10.0\nor\nlibsass==0.10.0 in your requirements.txt.\n. ^ Yup apparently its only on Python 3.5 64bit.\nhttps://ci.appveyor.com/project/dahlia/libsass-python/build/322\nedit: 3.5 is the only 3.x 64bit being tested on libsass-python atm\n. > I recommend adding a deprecation warning for this as soon as possible, possibly along with a link to an example importer that will import .css files for users for whom migrating will be difficult.\nPlease provide some examples of how to handle importing raw CSS files from third party libraries. This would break a lot of behavior for me. It was an important feature.. ",
    "brandonprry": "I am not sure what else I can show you, the above has many commands to run as well as the input to use to crash sassc.\n```\ncat id\\:001088\\,sig\\:06\\,src\\:002784+006448\\,op\\:splice\\,rep\\:2.min\n:000000#{00}000000{//\n}\n\ncat id\\:001088\\,sig\\:06\\,src\\:002784+006448\\,op\\:splice\\,rep\\:2.min | ~/sassc/bin/sassc\n=================================================================\n==29872==ERROR: AddressSanitizer: heap-use-after-free on address 0x60300000cd60 at pc 0x7f7f62fad2a1 bp 0x7ffdb25ada90 sp 0x7ffdb25ada88\nREAD of size 1 at 0x60300000cd60 thread T0\n    #0 0x7f7f62fad2a0  (/root/libsass//lib/libsass.so+0x3f82a0)\n    #1 0x7f7f62fb0b1b  (/root/libsass//lib/libsass.so+0x3fbb1b)\n    #2 0x7f7f62fb0009  (/root/libsass//lib/libsass.so+0x3fb009)\n    #3 0x4dc533  (/root/sassc/bin/sassc+0x4dc533)\n    #4 0x4dd034  (/root/sassc/bin/sassc+0x4dd034)\n    #5 0x7f7f61b44a3f  (/lib/x86_64-linux-gnu/libc.so.6+0x20a3f)\n    #6 0x435e48  (/root/sassc/bin/sassc+0x435e48)\n0x60300000cd60 is located 0 bytes inside of 31-byte region [0x60300000cd60,0x60300000cd7f)\nfreed by thread T0 here:\n    #0 0x4bcb32  (/root/sassc/bin/sassc+0x4bcb32)\n    #1 0x7f7f62da1e14  (/root/libsass//lib/libsass.so+0x1ece14)\n    #2 0x7f7f62dabddd  (/root/libsass//lib/libsass.so+0x1f6ddd)\n    #3 0x7f7f62dc0447  (/root/libsass//lib/libsass.so+0x20b447)\n    #4 0x7f7f62dab066  (/root/libsass//lib/libsass.so+0x1f6066)\n    #5 0x7f7f62d294fc  (/root/libsass//lib/libsass.so+0x1744fc)\n    #6 0x7f7f62d28835  (/root/libsass//lib/libsass.so+0x173835)\n    #7 0x7f7f62fb08fb  (/root/libsass//lib/libsass.so+0x3fb8fb)\n    #8 0x7f7f62fb0009  (/root/libsass//lib/libsass.so+0x3fb009)\n    #9 0x4dc533  (/root/sassc/bin/sassc+0x4dc533)\n    #10 0x4dd034  (/root/sassc/bin/sassc+0x4dd034)\n    #11 0x7f7f61b44a3f  (/lib/x86_64-linux-gnu/libc.so.6+0x20a3f)\npreviously allocated by thread T0 here:\n    #0 0x4bce12  (/root/sassc/bin/sassc+0x4bce12)\n    #1 0x7f7f625b9187  (/usr/lib/x86_64-linux-gnu/libstdc++.so.6+0x8e187)\nShadow bytes around the buggy address:\n  0x0c067fff9950: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c067fff9960: fa fa fa fa fa fa fa fa fa fa fd fd fd fd fa fa\n  0x0c067fff9970: fd fd fd fd fa fa fd fd fd fd fa fa fd fd fd fd\n  0x0c067fff9980: fa fa fd fd fd fd fa fa fd fd fd fd fa fa fd fd\n  0x0c067fff9990: fd fd fa fa fd fd fd fd fa fa fd fd fd fd fa fa\n=>0x0c067fff99a0: fd fd fd fd fa fa fd fd fd fd fa fa[fd]fd fd fd\n  0x0c067fff99b0: fa fa fd fd fd fd fa fa fd fd fd fa fa fa fd fd\n  0x0c067fff99c0: fd fd fa fa fd fd fd fa fa fa fd fd fd fa fa fa\n  0x0c067fff99d0: 00 00 01 fa fa fa fd fd fd fa fa fa fd fd fd fa\n  0x0c067fff99e0: fa fa fd fd fd fa fa fa fd fd fd fa fa fa fd fd\n  0x0c067fff99f0: fd fa fa fa fd fd fd fa fa fa 00 00 01 fa fa fa\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07 \n  Heap left redzone:       fa\n  Heap right redzone:      fb\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack partial redzone:   f4\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Container overflow:      fc\n  Array cookie:            ac\n  Intra object redzone:    bb\n  ASan internal:           fe\n  Left alloca redzone:     ca\n  Right alloca redzone:    cb\n==29872==ABORTING\n```\n. Yes, that is correct. This is ubuntu wily, built from source from git.\n```\n./version.sh\n3.3.4\ngit log | head -n 9\ncommit 213339a802827fab23cb61b79ad7d592fad33c2d\nMerge: f5b02c9 32c921a\nAuthor: Michael Mifsud xzyfer@gmail.com\nDate:   Fri Mar 18 01:51:35 2016 +1100\nMerge pull request #1955 from xzyfer/fix/issue-1644\n\nFix error not being thrown when & is used without a parent selector\n\n\n```\n. What is the output that you get?\n. If you build absolute latest as such:\n```\nexport CFLAGS=\"-fsanitize=address -O1 -fno-omit-frame-pointer\" CXXFLAGS=\"-fsanitize=address -O1 -fno-omit-frame-pointer\" LDFLAGS=\"-fsanitize=address -fno-omit-frame-pointer\"\nmake clean build-shared\n```\nThen run my input through the newly-built sassc compiler, you should see what I am talking about.\n. You should export the environment variables, not just use them in front of make. Otherwise, they are not picked up by libsass when make is called there to build and you do not get the same result I have.\n. ",
    "TxHawks": "Thanks. \nOpened an issue in the Ruby Sass repo\n. ",
    "haschek": "Is this bug really fixed in libsass 3.3.5? I'm using node-sass 3.7.0, it is using Herbie (3.3.6) since node-sass 3.6.0 ... or is this fix not included in libsass 3.3.6?\nI get errors related to an own function with the name calc_lineheight. If I rename it to lineheight-calc it works.\n$ node-sass --version\nnode-sass       3.7.0   (Wrapper)       [JavaScript]\nlibsass         3.3.6   (Sass Compiler) [C/C++]\nError message:\n{\n  \"formatted\": \"Error: Undefined operation: \\\"calc_lineheight($text-supercontent-fontsize) lt 1.25\\\".\\n        on line 25 of _devshare/scss/settings/_calculation.scss\\n>> @if ($text_supercontent_lineheight < $text_minimal_lineheight)\\n   -----^\\n\",\n  \"message\": \"Undefined operation: \\\"calc_lineheight($text-supercontent-fontsize) lt 1.25\\\".\",\n  \"column\": 6,\n  \"line\": 25,\n  \"file\": \"/data/_devshare/scss/settings/_calculation.scss\",\n  \"status\": 1\n}\nAs I wrote before, that error do not occure if I rename the function to lineheight-calc, so the error seems not to be on my side.\n. @xzyfer Maybe I approve it with SassMeister later but my Sass code worked for last three years, I do not see the bug there.\nIt stopped working with the change to node-sass 3.7.0 (libsass 3.3.6) and worked again after a simple renaming of the calc_lineheight function to lineheight-calc. It's not necessary bug #1969 but it looks like it has something to do with the calc prefix.\n. ",
    "robsonsobral": "Thanks, @xzyfer and @mgreter !\n. ",
    "dehrax": "It uses \"node-sass\": \"^3.4.1\".\n. ",
    "pradyunsg": "Well, in my first build, I already had the relevant folder. When I did ran\nmake, it exited with an Already Exists error.\nI'm guessing make does not know that these is a file-system dependency.\n(I'm on my phone)\nOn Mon, Apr 18, 2016, 12:25 AM Marcel Greter notifications@github.com\nwrote:\n\nPlease provide more information on your env.\nYour make command seems not able to handle:\n$(DESTDIR)$(PREFIX):\n    $(MKDIR) $(DESTDIR)$(PREFIX)\nWhich should act as an \"ensure_exists\"!\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1992#issuecomment-211082830\n. @mgreter Sorry for the lack of information in the earlier comment and OP.\n\nSystem Information\nOS: Ubuntu 14.04 64 bit\nlibsass: master branch\n$ make --version\nGNU Make 3.81\n[snip]\nThis program built for x86_64-pc-linux-gnu\nI'm not sure what else would be relevant about the system...\nHow to Reproduce\nI can reproduce by following running these commands to setup an environment:\n``` shell\ncd /tmp\ngit clone https://github.com/sass/libsass libsass_make_check\ncd libsass_make_check\nmake -j3\nMaking sure the directory exists\nsudo rm -rf /usr/local/include # I had this backed up on another place, so I was fine with this\nsudo mkdir /usr/local/include\n```\nSubsequently, here's the output from the various make target commands\nshell\n$ # Just checking for mkdir command...\n$ sudo make -n install-headers\nmkdir /usr/local/include\nmkdir /usr/local/include/sass\ninstall -v -m0644 \"include/sass.h\" \"/usr/local/include/sass.h\"\ninstall -v -m0644 \"include/sass2scss.h\" \"/usr/local/include/sass2scss.h\"\ninstall -v -m0644 \"include/sass/base.h\" \"/usr/local/include/sass/base.h\"\ninstall -v -m0644 \"include/sass/version.h\" \"/usr/local/include/sass/version.h\"\ninstall -v -m0644 \"include/sass/values.h\" \"/usr/local/include/sass/values.h\"\n$ # And, failure.\n$ sudo make install-headers\nmkdir /usr/local/include\nmkdir: cannot create directory \u2018/usr/local/include\u2019: File exists\nmake: *** [/usr/local/include] Error 1\n$ # Incidentally, running the exact same make command again will work!\n$ sudo make -n install-headers\ninstall -v -m0644 \"include/sass.h\" \"/usr/local/include/sass.h\"\ninstall -v -m0644 \"include/sass2scss.h\" \"/usr/local/include/sass2scss.h\"\ninstall -v -m0644 \"include/sass/base.h\" \"/usr/local/include/sass/base.h\"\ninstall -v -m0644 \"include/sass/version.h\" \"/usr/local/include/sass/version.h\"\ninstall -v -m0644 \"include/sass/values.h\" \"/usr/local/include/sass/values.h\"\n$ sudo make install-headers\ninstall -v -m0644 \"include/sass.h\" \"/usr/local/include/sass.h\"\n\u2018include/sass.h\u2019 -> \u2018/usr/local/include/sass.h\u2019\ninstall -v -m0644 \"include/sass2scss.h\" \"/usr/local/include/sass2scss.h\"\n\u2018include/sass2scss.h\u2019 -> \u2018/usr/local/include/sass2scss.h\u2019\ninstall -v -m0644 \"include/sass/base.h\" \"/usr/local/include/sass/base.h\"\n\u2018include/sass/base.h\u2019 -> \u2018/usr/local/include/sass/base.h\u2019\ninstall -v -m0644 \"include/sass/version.h\" \"/usr/local/include/sass/version.h\"\n\u2018include/sass/version.h\u2019 -> \u2018/usr/local/include/sass/version.h\u2019\ninstall -v -m0644 \"include/sass/values.h\" \"/usr/local/include/sass/values.h\"\n\u2018include/sass/values.h\u2019 -> \u2018/usr/local/include/sass/values.h\u2019\ninstall -v -m0644 \"include/sass/context.h\" \"/usr/local/include/sass/context.h\"\n\u2018include/sass/context.h\u2019 -> \u2018/usr/local/include/sass/context.h\u2019\ninstall -v -m0644 \"include/sass/functions.h\" \"/usr/local/include/sass/functions.h\"\n\u2018include/sass/functions.h\u2019 -> \u2018/usr/local/include/sass/functions.h\u2019\n. I didn't really bother that there was a autotools based build system. I saw the Makefile and went hah, let's make this.\n~~I guess saying the autotools is the \"recommended\" way to build would be nice, to direct one to use it instead.~~ I'm dumb. It's already written there.\n. Sure, autotools it is then! Thanks for the help! And this awesome project!\nOn Fri, Apr 22, 2016, 4:33 AM Marcel Greter notifications@github.com\nwrote:\n\nClosed #1992 https://github.com/sass/libsass/issues/1992.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/1992#event-636928951\n. \n",
    "fivedoor": "Revisiting to report I tried the switch to clang and still hit pretty much the same errors. \nExcept this time instead of the line: \ng++: error: unrecognized command line option '-stdlib=libc++'\nI got \nmake: clang++: No such file or directory\nwhich perhaps suggest the commands I used to switch to clang were not sufficient: \nfivedoors-MacBook-Pro:~ fivedoor$ export CC=clang\nfivedoors-MacBook-Pro:~ fivedoor$ export CXX=clang++\nThe install process has been very slow and this time was the worst. It took about 3.5 hrs for the install to run it's course (and fail). \nI will see what input I can get re the error on the node-sass forum and report a solution if I get one. \n. Thanks saper \nSo I tried:\nfivedoors-MacBook-Pro:~ fivedoor$ export CC=/usr/bin/clang\nfivedoors-MacBook-Pro:~ fivedoor$ export CXX=/usr/bin/clang++\nwhich resulted in the same error again but with the distinction: \nmake: /usr/bin/clang++: No such file or directory\nChecking again:\n$ which clang\nreturns:\n/usr/bin/clang\nbut\nwhich clang++\ndoes not return anything\nFrom initial search I'd assumed that having clang I would also mean clang++ was available? \nEverything I can find re installing clang++ is geared towards ubuntu. \nDo you have a further recommendation on what to try next?\nThanks! \n. /usr/bin/clang --version\nretrurns:\nApple clang version 1.7 (tags/Apple/clang-77) (based on LLVM 2.9svn)\nTarget: x86_64-apple-darwin10\nThread model: posix\nyes, looks like that is the version that came with 10.6.8 I think\nI did try export CXX=/usr/bin/clang before  getting the previous error messages\nthanks\n. Looks like I can use brew to install a later version with\nbrew install --with-clang llvm \nI will take a look into giving that a go\n. Just to update the post with what got me through in the end...\nI tried \nbrew install --with-clang llvm\nbutclang --versionstill returned version 1.7\nI then tried the following: \n$ port search clang\n$ sudo port install clang-3.6\n$ port select --list clang\n$ sudo port select --set clang mp-clang-3.6\nThat seemed to do it as \n$ clang --version returned clang version 3.6.2 (tags/RELEASE_362/final)\nI then updated the paths: \n```\n$ export CC=/opt/local/bin/clang\n$ export CXX=/opt/local/bin/clang++\n```\nThis time the installation completed successfully :) \nThank you very much for your help and guiding me in the right direction saper - it was invaluable! \nOne postscript - \nI did seem to get an lot of warnings during the install. \nhttps://github.com/fivedoor/foundation-records/blob/master/installation_log_190416\nI've had quite a few warnings from brew about the support for 10.6.8.  and before the above worked was on the verge of giving up and installing a version of el capitan (to run as partitioned drive so I can retain snow leopard for other apps)\nI wonder if that's still a wiser option going forward as I get the feeling I may run into more issues related to using snow leopard/ an older os? \nAnyway thanks again for the support on this issue!\n. @smologu \nJust recapping the core stuff from the notes I made on what I did. \nIt has been a while so hope it's clear & helps : \n// Follow advice on https://github.com/nodejs/node-gyp/issues/906\n// install gcc48 \n$ sudo port install gcc48\n$ sudo port select --set gcc mp-gcc48\nSelecting 'mp-gcc48' for 'gcc' succeeded. 'mp-gcc48' is now active.\n// delete node-gyp folder again \n$ which clang\n/usr/bin/clang\n// confirm path available\n$ echo $PATH\n/opt/local/bin:/opt/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/git/bin:/usr/X11/bin\n// find what is the full path to clang and clang++ and use it instead\n// https://github.com/sass/libsass/issues/1998#issuecomment-211099908\n// check available versions of clang \n$ port search clang\n//and install \n$ sudo port install clang-3.6\n// seemed to work so check                \n```\n$ port select --list clang\nAvailable versions for clang:\n    mp-clang-3.6\n    none (active)\n```\n// looks good so select 3.6 \n```\n$ sudo port select --set clang mp-clang-3.6\nPassword:\nSelecting 'mp-clang-3.6' for 'clang' succeeded. 'mp-clang-3.6' is now active.\n```\n// Success \n//check updated - success \n//try to set export location\n$ export CC=/opt/local/bin/clang\n$ export CXX=/opt/local/bin/clang++\n// Success \n. It\u2019s probably worth adding that while I was able to resolve the original issue in this post I did run into more problems down the line which seemed to be related to running an older OS. \nI eventually installed el-capitan on an external drive, preserving 10.6.8 to run some older software and as a fall back. As long as you have a machine running snow leopard or above I believe you should be able to update to the latest OS for free on that machine.\n// Compatibility check:\nhttp://www.everymac.com/mac-answers/os-x-el-capitan-faq/os-x-el-capitan-compatible-macs-system-requirements.html\nThat might seem like a long winded work-around but using an up to date OS everything runs quicker and I come up against a lot less conflicts that need resolving so it might save time in the long run provided you don't have a specific need to stay running snow leopard. \n. ",
    "smolugu": "@fivedoor I am going through the exact same problem. trying to switch the compiler to clang. Can you please tell me the steps on how to do it. Thank you!\nAlso tried to install later version of clang using \nbrew install --with-clang llvm \nbut i am getting the below error. I am a novice and really need help!\nshyam-molugus-macbook-5:pulses Shyam$ brew install --with-clang llvm\nWarning: You are using OS X 10.6.\nWe (and Apple) do not provide support for this old version.\nYou may encounter build failures or other breakages.\n==> Downloading http://llvm.org/releases/3.6.2/llvm-3.6.2.src.tar.xz\nAlready downloaded: /Users/Shyam/Library/Caches/Homebrew/llvm-3.6.2.tar.xz\n==> Downloading http://llvm.org/releases/3.6.2/cfe-3.6.2.src.tar.xz\nAlready downloaded: /Users/Shyam/Library/Caches/Homebrew/llvm--clang-3.6.2.tar.xz\n==> cmake -G Unix Makefiles /private/tmp/llvm-20160602-48463-1r6cqk/llvm-3.6.2.src \nLast 15 lines from /Users/Shyam/Library/Logs/Homebrew/llvm/01.cmake:\nmake: *** [cmTC_183c8/fast] Error 2\nCMake will not be able to correctly generate this project.\nCall Stack (most recent call first):\n  CMakeLists.txt:25 (project)\n-- Configuring incomplete, errors occurred!\nSee also \"/tmp/llvm-20160602-48463-l64qtc/CMakeFiles/CMakeOutput.log\".\nSee also \"/tmp/llvm-20160602-48463-l64qtc/CMakeFiles/CMakeError.log\".\nREAD THIS: https://git.io/brew-troubleshooting\nIf reporting this issue please do so at (not Homebrew/brew):\n  https://github.com/Homebrew/homebrew-core/issues\nThese open issues may also help:\nllvm 3.8.0 https://github.com/Homebrew/homebrew-core/pull/1593\nllvm and openmp https://github.com/Homebrew/homebrew-core/issues/1254\n. @saper Thank you! I was hoping to get help here since @fivedoor was having the same issue and using the same OS X. Will try again after upgrading cmake.\n. @fivedoor @saper Thank you! Really appreciate it. I almost gave up and thinking of buying a new mac. but will try your suggestions. will update you.\nRegards,\n. ",
    "lmergner": "I've had success with the following on 10.6.8. \nbrew install gcc\nCXX=gcc-5 brew install libsass\nBut CXX=gcc-5 npm install node-sass fails with a flag error. I see that the node-sass node-gyp file adds c++11 flags for clang, which conflict with the c++ flags for gcc. It would be nice if node-sass could detect whether older macs are actually running clang, or document how to override the flags.\nI have yet to successfully brew clang using gcc-5, which takes forever on an old laptop. I mention this as a contrast to using port.\n. ",
    "VPenkov": "I'm trying to migrate from Ruby Sass which works.\nHere, try this in sassmeister:\n```\n.m__exhibit-header--medium {\n    @extend #{&}--plain; //Inception!!\n&--plain {\n    font-size: 1em;\n}\n\n}\n```\n. ",
    "peschee": "Thanks for letting me know @xzyfer Wasn't aware of this, your arguments make sense though. It just makes it a bit trickier when refactoring your code.\n. ",
    "emyarod": "I apologize, the function does not contain that typo in the source. It must have occurred when I was copy pasting it, so it contains the extra brace. However, the problem still persists in libsass 3.3.5, which fixes issue #1969.\nthe correctly edited and entire function, for reference:\n// dynamic text color\n@function set-text-color($bg-color) {\n  // if background color is light, return dark colored text\n  @if (lightness($bg-color) > 50) { @return $dark-text; }\n  // if background color is dark, return light colored text\n  @else { @return $light-text; }\n}\n// dynamic text colors\n@function set-text-color($bg-color, $text-type) {\n  // if bgc is light, return dark colored text\n  @if (lightness($bg-color) > 50) {\n    @if ($text-type == text) {\n      @return $light-text;\n    } @else if ($text-type == secondary-text) or if ($text-type == icons) {\n      @return $light-secondary-text;\n    } @else if ($text-type == hint-text) or if ($text-type == disabled-text) {\n      @return $light-disabled-text;\n    } @else if ($text-type == divider-text) {\n      @return $light-divider-text;\n    }\n  // if bgc is dark, return light colored text\n  } @else if ($text-type == text) {\n    @return $dark-text;\n  } @else if ($text-type == secondary-text) or if ($text-type == icons) {\n    @return $dark-secondary-text;\n  } @else if ($text-type == hint-text) or if ($text-type == disabled-text) {\n    @return $dark-disabled-text;\n  } @else if ($text-type == divider-text) {\n    @return $dark-divider-text;\n  }\n}\n. I only receive this error when compiling with node-sass or sass.js builds based on libsass 3.3.1 or higher. I've spoken to the sass.js developer about this issue persisting in the latest release, but he was confident that the error was being thrown by libsass. Is there anything else I can provide to help you reproduce the bug?\n. @xzyfer \nargument `$color` of `lightness($color)` must be a color\nBacktrace:\n    sass/flattish/utils/_functions.scss:6, in function `lightness`\n    sass/flattish/utils/_functions.scss:6, in function `set-text-color`\n    sass/flattish/components/_buttons.scss:214\nI'm using this function to style an element's text color based on its background color. In this instance, I'm styling buttons, whose background colors are first assigned in a Sass map and then passed into the set-text-color function.\nHere is the referenced portion in _buttons.scss:\n```\n// flat buttons with color bg\n@if #{$button-type} == 'flat-colorized-bg-button' {\n  @if $background-color != $primary {\n    #{$selector-name} {\n      color: set-text-color($background-color, text) !important;\n  @include ripple($background-color, $ripple-color);\n\n  &:hover { background-color: $hover-color !important; }\n}\n\n} @else {\n    $flat-colorized-bg-button-selectors: append($flat-colorized-bg-button-selectors, unquote('#{$selector-name}'), 'comma');\n  }\n}\n```\nIf more context is required, here is the source for _functions.scss and _buttons.scss\nPlease let me know if any additional information is needed!\n. When compiling using the official Ruby Sass compiler, this error is thrown:\nError: $color: null is not a color for `lightness'\n        on line 6 of utils/_functions.scss\n        from line 10 of flattish.scss\n  Use --trace for backtrace.\n. ",
    "nilssolanki": "@mgreter this breaks a lot of my code...\nIs this something that higher-level components would abstract back to the previous behaviour or is this intended to be exposed to the end users?\nAnd how can I extract the values? nth(inspect(&), 1) does not seem to work.\nIs there a recommended way to move from the previous behaviour to the new one without having to rewrite all the functions?\nSome documentation would be really helpful. Thanks in advance.\n. @mgreter help me out here please.\nI've tried the following:\n$selector-list: nth(&, 1);\n@debug $selector-list;\nand I still get:\n(.form,)\nAm I completely off track?\n. ",
    "paulfalgout": "Ah the sourcemap inspector will be useful.  I guess I need to trace down the issue more.\nWith 0 code changes I did a fresh install of gulp-sass ~2.2.0 which has a dependency on node-sass of ^3.4.1 and node-sass 3.5.x recently updated libsass such that I am now using 3.3.5\nIf I force gulp-sass to use node-sass 3.4.1 which uses libsass 3.3.2 this error goes away\n. So perhaps I'm running into a legitimate error that wasn't thrown in the earlier versions.  Upon closer inspection of the error I was looking at the wrong line trying to make an example: Here's what breaks:\nexample @mgreter is this specifically what the error is addressing or is this a regression?\nWith libsass 3.3.2 it would output with no error:\n.screening__item.highlight label {\n  box-shadow: inset 0 0 0 1px #0582DA;\n}\n. ",
    "glen-84": "@xzyfer,\nI have the same issue, and it compiles without errors using Sass 3.4.22:\nvagrant@debian-wheezy:~/test-ruby-sass$ sass pages.scss > out.css\nDEPRECATION WARNING:\nSass 3.5 will no longer support Ruby 1.9.3.\nPlease upgrade to Ruby 2.0.0 or greater as soon as possible.\nvagrant@debian-wheezy:~/test-ruby-sass$\nDid this change in a later version of Sass? I got 3.4.22 when running gem install sass.\n. @xzyfer https://github.com/sass/libsass/issues/2095\n. ",
    "nicovalencia": "\ud83d\udc4d \n. Thanks! \ud83d\udc4d \n. ",
    "bschaf": "\ud83d\udc4d  Thank you! \n. ",
    "stowball": "Sorry, there was a typo in the color() function. It now matches my example output in Ruby Sass\n. Yeah, you're right. Thanks for the quick response.\nPesky typos >.<\n. ",
    "TonyBogdanov": "I'm basicly just reposting this from the sassc repo, I guess there's nothing wrong with the sourcemap, the point is, both works and doesnt should have exactly the same content, but they don't.\n. ",
    "ckknight": "Sorry about that. It's 3.6.0. I read the wrong number.\n. ",
    "zanderi": "I realize this is an edge case but we ran across it and it took a long time to figure out what was going on. In the end we removed the @extend from the basic styling of the btns and added the properties to each one in order to fix it. But the following code (simplified for demonstration) emits a large amount of selectors that end up breaking the css.\n```\n.btn{\n  display:block;\n  padding:6px 12px;\n}\n.btn-basic{\n  @extend .btn;\n  color:#FFF;\n}\n.btn-blue{\n  @extend .btn-basic;\n  color:blue;\n}\nh1, h2, p, a:not(.btn) {\n    color: #FFFFFF;\n}\na:not(.btn) {\n    text-decoration: underline;\n}\na:not(.btn):hover {\n    color: #007ad1;\n}\n```. ",
    "kenborge": "If your project is using a lot of pseudo selectors with common classes like :not(.btn) be careful about extending these classes. One extend of a common button class in our project cased the generated css to go from 1.1M to 2.1M with a lot of invalid css. . ",
    "wedneyyuri": "@mgreter I know I was using a broken code.\nI do not want to be annoying, but do you agree that a clearer warning about this behavior would help a lot? A simple link would be enough.\n. I am not asking you to change the Sass message. But an warn after the message would be good.\nIt could be dropped in the next major release and be something like: \"In previous versions of libsass this error was ignored. See .\nIt should help everyone using a third party dependency (eg. grunt-sass).\nThanks for your time and for this great project.\n. ",
    "espositom221": "My version is last release 3.3.6\nand node-sass is build via npm install\nI\nIl 05 mag 2016 18:20, \"Marcel Greter\" notifications@github.com ha scritto:\n\nYou are missing a function added in #2021\nhttps://github.com/sass/libsass/pull/2021 and is not related to\nLIBSASS_VERSION. It seems you try to link against an older library\nversion than your source is expecting. But you give too little info to\nspeculate why.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/2069#issuecomment-217199973\n. Hi,\nIf i install via npm node-sass, its work fine,no issue.\nIf i try to install harp what use node-sass 3.4.2 with libsass 3.3.6 noto\nwork and i have the previsius error\nIl 05 mag 2016 18:25, \"vincenzo esposito\" espositom221@gmail.com ha\nscritto:\nMy version is last release 3.3.6\nand node-sass is build via npm install\nI\nIl 05 mag 2016 18:20, \"Marcel Greter\" notifications@github.com ha\nscritto:\n\nYou are missing a function added in #2021\nhttps://github.com/sass/libsass/pull/2021 and is not related to\nLIBSASS_VERSION. It seems you try to link against an older library\nversion than your source is expecting. But you give too little info to\nspeculate why.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/sass/libsass/issues/2069#issuecomment-217199973\n. \n\n",
    "cemelo": "Sorry about that. Didn't know sass2scss was a different project.\n. @henrahmagix @xzyfer Sorry for the delay. I'll try to push it in the next couple of days.\n. ",
    "henrahmagix": "@cemelo Can you add this to sass2scss please? I would really really like this for long maps. I looked but I couldn't see it in https://github.com/mgreter/sass2scss\n. Brill, thanks!\n. ",
    "ashclarke": "Ah ok, I've updated the gist to remove the extraneous ; on L75 and I now see the error \nInvalid CSS after \".space-\": expected selector, was \"\"\"-inset\"\nwhen switching to use Sass 3.4.21 as the compiler.\nThanks for the pointers and apologies for the misunderstanding. More :coffee: required!\n. Ah ok, I've updated the gist to remove the extraneous ; on L75 and I now see the error \nInvalid CSS after \".space-\": expected selector, was \"\"\"-inset\"\nwhen switching to use Sass 3.4.21 as the compiler.\nThanks for the pointers and apologies for the misunderstanding. More :coffee: required!\n. Thanks! Glad I could help out, even if in such a roundabout way! :smile:\n. Thanks! Glad I could help out, even if in such a roundabout way! :smile:\n. Ok, thanks @xzyfer. I just discovered that it is possible to define $string: null; to \"solve\" the problem, but it is clear now that that is a workaround to missing the interpolation when redefining $string later.\n. Ok, thanks @xzyfer. I just discovered that it is possible to define $string: null; to \"solve\" the problem, but it is clear now that that is a workaround to missing the interpolation when redefining $string later.\n. ",
    "cldwalker": "@xzyfer Gotcha. Thanks for the suggestions\n. ",
    "fatso83": "Viewed as math, the result is wrong, as n is undefined.  Multiplication and division makes sense, but not addition and subtraction. Frankly, none of my colleagues could come up with an example of when that would make sense. \nIt seems as a case of a bug becoming the specification, but I can live with that, although it makes otherwise simple mixins very hard to create right as one needs to reimplement parsing of unquoted sass strings to get something as omega right. \nWhat's not so cool is that I cannot find this behavior documented. Just a claim that the math works as in real life, which it does not do. I guess that's another ticket for the homepage, so closing this. \n. Of course that's fine. But promoting numbers without units to numbers with units does not make much sense. \n. How is that different? Are you missing a \"not\" in there? Why should using n as a unit be any different than px? I am wondering if you have misunderstood the issue and think that I want 3n + 4 = 7n. I don't.\nPS. That last sentence makes no sense, so I am not sure what you mean. \n. That's fine. Still it should be a documented feature under \"numeric operations\" in the Sass reference docs. \n. ",
    "hon2a": "@xzyfer There are two interesting aspects to this:\n1. I've been using this pattern for a year now (through various libsass versions) without any problems,\n2. as described above, it only fails sometimes (most of the time it still works fine).\nBut I've got my work-around ... so I just wanted to report it in case it points to a larger issue.\n. Unfortunately, after spending more than an hour black-box testing the issue, I got nowhere. The most trivial case (at the top of issue description) is now failing. My real use-case is quite complex and I haven't been able to determine what causes the previous, \"erroneous\" behavior.\nI'll verify with Ruby Sass next time. The error being the correct behavior never crossed my mind :)\n. Submitted an issue with Sass.\n. ",
    "bencergazda": "@mgreter I've created a Sassmesiter gist: http://www.sassmeister.com/gist/efebdb5362a32d0a0f42977fed2eef0b\nThis compiles in ruby sass but does not in libsass. Hope this helps to solve the issue and will be fixed soon.\n. The strange thing is that when nex3 tested locally, got the good results in 3.4.25, 3.5.0-rc.1, 3.5.1, 4.0.0.alpha.1, and bleeding edge 4.0.0. Can I hope that this has been already fixed or should I provide any extra detail?. ",
    "nelisbijl": "Sorry, wrong project. Problem occured in sass.js (https://github.com/medialize/sass.js/issues/59)\n. ",
    "tzi": "Thanks a lot! \n. ",
    "DerPapst": "@xzyfer: I've read the documentation but api-importer.md does not say anything about srcmap except that libsass frees it once complete and both, the internal documentation nor the examples give any additional clues about it. I'd be willing to extend this part of the documentation once I'm sure what this parameter is about. \ud83d\ude09\n@saper: Thanks for your pointers. All i can see there though is that something should be added to \"sources\" in the map file.\nMy scss is\nscss\n@import \"herpderp\";\nand I create the following importer entry:\nc\nsass_make_import_entry(\n    \"herpderp\",\n    \"a { color: red; }\",\n    \"{\\\"version\\\":3,\\\"sources\\\":[\\\"herpderp.db\\\"],\\\"mappings\\\":\\\";AAAA,CAAC,CAAC;EAAE,KAAK,EAAE,GAAI,GAAI\\\"}\"\n);\nbut no matter if I pass the map contents or 0 the generated map doesn't change.\nIt is always:\njson\n{\n    \"version\": 3,\n    \"file\": \"stdin.css\",\n    \"sources\": [\n        \"stdin\",\n        \"herpderp\"\n    ],\n    \"sourcesContent\": [\n        \"\\n@import \\\"herpderp\\\";\\n\",\n        \"a { color: red; }\"\n    ],\n    \"mappings\": \";ACAA,AAAA,CAAC,CAAC;IAAE,KAAK,EAAE,GAAI;CAAI\",\n    \"names\": []\n}\nMaybe I'm doing something fundamentally wrong...\n. Hi, thanks. \ud83d\ude04\nI've added a PR to add your explanation to the documentation.\n. ",
    "jdsteinbach": "I did not have this error back in March & earlier. Don't know what version of node-sass I had installed back then, sorry.\n. ",
    "schneems": "Just getting to this comment now. I'm going to give this a shot. Thanks a ton! Will keep issue updated. \nAlso thanks for the windows support in the first place. It's a huge responsibility and the few times i've had to make windows compat patches makes me grateful for anyone who has experience there.\nAs a side note it looks like the makefile has some window specific code in it: https://github.com/sass/libsass/blob/6610e815ff77600fedf22bf10541d08d70f94218/Makefile#L26-L42 did this file work with nmake at one time?\n. Hey, i'm trying to refrain from posting due to vacation (I really wish github had an OOO or Do not Disturb feature). Don't worry about replying while away.\nYour advice was great and worked, also I found this doc https://github.com/sass/libsass/blob/master/docs/build-on-windows.md (way too late) which did re-confirm many things you've told me. I got a build working and I believe i've linked to it correctly using Ruby FFI interface, i'm now getting a segfault when I call into the lib. It could be a problem with the Ruby FFI interface, a problem with the sassc-ruby glue code, or a problem with the build of libsass into a dll. \nI don't think you should need to know anything about Ruby, but maybe you could help with that last one. Is there any way for me to verify the dll I made works or is valid?\nLet me know when you get back, hope you're enjoying time off. \n. Sorry for the delay. I keep getting pulled away from this project. I'm going to close this for now so it doesn't clog up your issues. Thanks for the help. I hope to return to this soon.\n. ",
    "IanMitchell": "It looks like the master branch had the same issue\n. ",
    "delapuente": "Hello folks. Firstly, I want to notice this is a WIP branch focused on adding the new bracketed list notation only. Although I'm familiarized with compiler concepts, I'm not familiar with the specific architecture of the lexer, parser and emitter, I'm just repeating patterns in the code with the ultimate goal of passing spec/sass_3_5/bracket_lists and spec/sass_3_5/functions.\nThe kind of feedback I'm looking for, @xzyfer is about errors related to misconceptions or things I'm doing increasing technical debts.\n@chriseppstein IMHO, I think we need a new branch, saynext, and some way to configure which tests to run in sass-spec. Then, each time you are adding a new 3.5 feature, branch next , say next-new-feature, enable the tests for that feature, implement it and merge over next. Once all 3.5 spec is passing, merge over master, stabilize and release.\n. Come back from vacation. I did not forget this. Catching up with the mail and new commits inbound!\n. I completely changed the implementation. I'm going to ensure this PR passes all the tests master branch does for both 3.4 and 3.5 specifications, in addition to new bracket tests in 3.5. Tell me what do you think about the new implementation, @xzyfer \n. I added the missing parts for bracketed lists related functions: the $bracketed argument for join() and the new is-bracketed() function. I also run master and brackets branch against the current 3.4 spec and see no regressions but I notice some when running both branched against 3.5 spec so I'm trying to catch and fix them.\n@xzyfer could you point me to some example of the CI feature, please? I will try to look at it after catching the regressions.\nI think there is an issue with the spec so I open a bug for that sass/sass-spec#907\n. @xzyfer I tried to join Slack a couple of times so far but I'm not receiving the invitation. Could you help me, please?\n. @xzyfer the PR seems to pass the tests, before merging, let me know and I will update the commit messages to be more detailed.\n. @xzyfer sorry for the delay. The new comments are ready. Feel free to merge if the new commits pass the tests. Thank you very much for your support.\nIf libsass 3.5 is not ready for the CSS Grid release time window, do you think we could backport this?\n. It seems one of the builds timed out. Is there some way to restart it?\n. @xzyfer I granted you permissions to my repo. I can rebase it today although I saw you open another PR. Do what you want but, to be honest, I'm excited if this PR is the one to be merged. ;). @xzyfer is done. Please, merge before it breaks again. :P Happy New Year!!. ",
    "smebberson": "@saper, thanks, I'll give it a shot!\n. ",
    "s-yadav": "Got into same issue while upgrading from sass-rails to sassc-rails \n. ",
    "darklow": "As a workaround I found that using attribute selector still works. Not perfect, but better than nothing.\n``` css\n/ Instead of /\n:not(.thing) {\n    @extend .thing;\n    background: blue;\n}\n/ You can write: /\n:not([class*=\"thing\"]) {\n    @extend .thing;\n    background: blue;\n}\n```\n. ",
    "cmaart": "Can confirm issue occurring for:\ncmd\n$ node-sass --version\nnode-sass       4.3.0   (Wrapper)       [JavaScript]\nlibsass         3.4.3   (Sass Compiler) [C/C++]\n. Duplicate of #2139 . ",
    "nickautomatic": "Until a fix for this is rolled out, is there a temporary solution or workaround at all? eg. is there an older version that didn't have this issue? We were using custom properties (with gulp-sass) a couple of months ago with no problem, but now we get this sort of conversion (--white \u2192 --#ffffff) happening each time, which makes me wonder if this issue has crept in recently.\n. ",
    "smoogly": "Thanks!\n. ",
    "stepmr": "Just checking in, were there any blockers to releasing 3.4 RC1? . ",
    "bertusgroenewegen": "@xzyfer I would appreciate it, if you could fix this minor bug :) pretty please . but they boost the score CSS on Sonarqube :) I know its minor minor and you're already investing alot of your time. I can buy you a big coffee donation 10 euro in return :). ",
    "automagisch": "+1 on this issue! You get a big coffee from me as well if this fix happens :) For now I'm trying to create a workaround with Node, if that is a success I'll try to link this here as well.. ",
    "speedplane": "That was fast, thank you!\n. Hmm.... maybe this is expected behavior, according to this SO post:\nhttp://stackoverflow.com/questions/15371332/sass-ignores-variables-defined-in-if-statement\n. ",
    "BarryThePenguin": "I'm using it in a postcss plugin as a placeholder. But I'd understand if this syntax is considered invalid. I've got a workaround for now where I can define my at rule with a value eg @customAtRule true;\n. ",
    "squidfunk": "Digging into the code, in my view, sourcemap support can be nothing else but entirely broken. I'm currently trying to fix it in my fork and will submit a PR when done. Sourcemaps in Chrome are already working correctly (the case stated above), but still some way to go to make it adhere to the specs.\n. This is fixed in the commit I linked in the linked PR. Would be awesome to get this into 3.4 (if I understood you correctly)\n. Thank you for the update. Feedback is appreciated.\n. Thank you for the very detailed explanation. I'm quite aware of the fact that my PR is kind of a hotfix to make it work within Chrome and Gemini. I wished I could fix it in a better way, but as you also noticed, the current design of libsass doesn't allow for that.\n\nI guess you mostly relate your expectations regarding sourcemap according to how gemini-coverage behaves? IMO sourcemaps V3 is still just a draft/proposal and I'll try to explain why libsass creates the sourcemaps as it currently does.\n\nCan you link to the section which states something about the way sourcemaps should look like? To me, this proposal only defines the format of the sourcemap file, so how the final JSON should look, not where sourcemap offsets should look like.\n\nI also already want to point out that sourcemap has no concept of opening and closing mappings. AFAIR there is no concept of \"enclosing\" ranges for sourcemaps. Libsass does not output evenly distributed pairs of start-end mappings (explanations why this is follows).\n\nThis is perfectly fine and I understand the concept. Maybe I did not make it clear enough in my explanation. However, the name of the functions add_open_mapping and add_close_mapping might be irritating to the unaware reader.\n\n... we added one crutch to libsass (you can read up that in the linked issue) which causes a duplicate starting mapping (AAAA).\n\nI saw that crutch in the source, read the PR, and in my opinion it was at the wrong position. I put it into the rendering of the Sequence_Selector, in order to put it at the beginning of a compound selector.\n\nI agree that we could argue if the mapping for the parent selector should point to where the & was or from where the actual selector in the output is comming from (libsass does the second).\n\nWell, the main problem why I started with all this was the fact that every selector that is blended with the parent selector & points to the parent selector. We write CSS in BEM-style, and thus everything links to the parent.\n\nIMHO this is a perfectly valid mapping according to the specs.\n\nIn my opinion, the specs state nothing about how mappings should look like, so every mapping is perfectly valid, as long as the final JSON can be parsed ;-)\n\nWe tried to do our best to get the best support for browsers.\n\nSourcemaps are broken in Chrome (see the linked issue), so the crutch that was added doesn't solve all the problems.\n\nUnfortunately your other examples can also be explained and do IMO not violate against the current SourceMap draft. IMO you can only call the behavior of libsass buggy under certain assumptions which are IMO not given by the current spec. \n\nAgain, in my opinion, the spec doesn't say anything on mappings, so every mapping is valid. However, I do understand the point that you don't want to change things the way I proposed because it may break stuff downstream, so I'm fine with that.\n\nAnother example why getting it right is difficult: Take the selector &-bar (becomes .foo-bar). After evaluation we could have a mapping for & to .foo and one for -bar. If we would do that, the first mapping would point to the outermost scope, which would lead to #1747 (unuseful mapping in browsers).\n\nThis is wrong, because .foo-bar does have nothing to do with .foo - those are two entirely different selectors. For this reason the way libsass does it currently is wrong. This is also why using SASS with BEM produces wrong sourcemaps. However, this was the first thing I fixed in the following commit: https://github.com/sass/libsass/pull/2208/commits/9da48411aa86217f66706c465d777a1519728dd4\nWould you be okay with merging the changes only made in this commit (I can revert everything else in my PR)? This would already fix a lot for us.\n. ",
    "netmikey": "Unfortunately not. The tool/library stack is pretty deep at this point (libsass -> node-sass -> webpack -> angular-cli -> angular-material2), and I don't know enough about all of them to connect the dots top to bottom. I kinda hoped a reduced test, a stack trace and a commit-range could have pointed you into the right direction \ud83d\ude09\n. Thanks for taking the time to look in to this, @mgreter. \nWhat Linux distribution did you use to try reproducing the error? As mentioned in this comment, only Debian wheezy seems to be affected (32bit as well as 64bit) while Ubuntu 16.04 seems to work.\nI can reproduce it on both our CD server with 4GB of memory available, and a small virtual machine I run locally with about 1,5 GB free memory. It doesn't look like the OS is running out of memory during the build though. Also, @emri99 and @christiandreher both have the same issue, so it's probably not limited to our server.\nIs there anything I can do to help reproducing it?\n. The problem doesn't occur with node-sass v3.5.3 (which uses libsass 3.3.5) and starts with node-sass v3.6.0 (which uses libsass 3.3.6).\nIn our case, the node binaries for wheezy come from the nodesource repos here: deb https://deb.nodesource.com/node_6.x wheezy main.\nAs for testing this with pure sassc, that's the hardest part to me as I'm a Webpack/SASS novice. Maybe @emri99 could help (as he's using webpack directly), or maybe someone from the angular-cli team (@Brocco? ;-)) could help extracting a sassc command that's equivalent to what angular-cli/webpack does?\n. @mgreter Thanks a lot!! I can confirm that recompiling node-sass after npm installing makes the subsequent webpack build work on both my Debian machines.\n. ",
    "sukexero": "Hi nschonni\nI still need to compile libsass right? plz can you give me the compiled library?\n. thank you very much mgreter I really appreciate it.\n. ",
    "Borislav69": "@sukexero \nwere you able to successfully install those .msi installers?\n@mgreter \nI tried to install on 3 different machines running windows 7 sp1 without any success! always get error \"could not access network location\" do have another installer or perhaps just the executable for sass compiler?\nmaybe here isn't the right place to ask this question but do you guys have any Idea why the maintainers of https://github.com/sass/sassc don't provide official binaries and why they want every body to install VS and compile themselves?\n. ",
    "parhs": "@mgreter I was looking for that thanks. I'll make a pull request there too. Did  test here fail because of timeout?\n. ",
    "IrvingArmenta": "@xzyfer still not working; The other variables work fine, and also, if i put the variable inside the same file, like on top of the same document, I get the same result, the task just ends with no error message. :/. Is very simple, any file, even something like this:\nexample.sass \n```\n$primary: #000000\n$secondary: #959595\nbody\n  background-color: $primary\n  color: $secondary\n```\nsomething like this, It just ends the task, on the CMD, it only ends like \"sass ...\" and that's it, there is no error message or anything, but if i don't use that kind of variable, it compiles just fine, so i'm not sure what is the problem.  \nI'm using .sass files not .scss, I tried using .scss but it's the same problem, I'm on Windows 7 ultimate 64x, not sure if that's an issue, I used to compile with an old version of node, and npm, and it worked fine before, I updated and this happened, I have updated and re-installed everything (everything) multiple times, so that is why i decided to put an issue here. . this is the content of my gulpfile.js \n```\n'use strict';\nlet gulp = require('gulp');\nlet sass = require('gulp-sass');\nlet notify = require(\"gulp-notify\");\nlet concat = require('gulp-concat');\nlet uglyfly = require('gulp-uglyfly');\ngulp.task('sass', function () {\n  return gulp.src('./public/sass/*/.sass')\n    .pipe(sass({outputStyle: 'compressed'}).on('error', sass.logError))\n    .pipe(gulp.dest('./public/css'))\n    .pipe(notify(\"Compilation success!\"));\n});\ngulp.task('scripts', function() {\n  return gulp.src('./public/js/*.js')\n    .pipe(concat('web-app-min.js'))\n    .pipe(uglyfly())\n    .pipe(gulp.dest('./public/js/output'))\n    .pipe(notify(\"Scripts done!\"));\n});\ngulp.task('watch', function () {\n  gulp.watch('./public/sass//.sass', ['sass']);\n  gulp.watch('./public/js/.js', ['scripts']);\n});\ngulp.task('default', ['scripts', 'sass', 'watch']);\n```\n\"scripts\" task works fine.\nIs this what you mean by my gulp-sass config? or where do i get that data from?  sorry, I know gulp in a very superficial way.. I got\n'-- gulp-sass@2.3.2\n  '-- node-sass@3.11.2\n. Hello, I got a different cmd and this is what throws me when I try to compile SASS with a color variable:\n/cygdrive/c/Users/ir/AppData/Roaming/npm/gulp: line 14:  6904 Illegal instruction     node \"$basedir                                            /node_modules/gulp/bin/gulp.js\" \"$@\"\nI hope this can help to fix my issue : / . ",
    "pxl-dgn": "It seems the last correct version is \nnode-sass       3.4.2   (Wrapper)       [JavaScript]\nlibsass         3.3.2   (Sass Compiler) [C/C++]\nThe next available (node-sass) version does have this issue.\nnode-sass       3.5.1   (Wrapper)       [JavaScript]\nlibsass         3.3.5   (Sass Compiler) [C/C++]\n. ",
    "helmus": "I am attempting to remove one .row selector. Right now I have to repeat it in my first code example ( shown below again ). \nOff course in this example this selector is very small, but that's for the sake of the example. \nSometimes this selector might be bigger, and the ability to nest it under a single .row & selector would be nice\n.container {\n  .operation {\n    color: green;\n  }\n  // duplication of .row selector here\n  .row.is-active &,\n  .row:hover & {\n    .operation {\n      color: inherit;\n    }\n  }\n}\n. Isn't the point of nesting selectors to combine them ? \ud83d\ude04 \nJust wanna make extra clear that the below scss currently works for me, it does exactly what I want. \nI just wanted to fix the fact that I have to write two .row selectors.\n.container {\n  .operation {\n    color: green;\n  }\n  .row.is-active &,\n  .row:hover & {\n    .operation {\n      color: inherit;\n    }\n  }\n}\n. Thanks for your help, it does look like this won't be possible then. Your proposed solution there is a different selector tough; it requires both .is-active and :hover condition to be true, while my selector needs only 1 of those conditions to be true.\n. ",
    "pawlufelice": "I think I have a similar issue. I have:\n.a, .b {\n    &-c {\n        color: hotpink;\n    }\n}\nand I get\n.a-c,\n.b-c {\n  color: hotpink; }\nSo far so good. Then I do this:\n.a, .b {\n    & &-c {\n        color: hotpink;\n    }\n}\nand get\n.a .a-c,\n.b .a-c, .a\n.b-c,\n.b\n.b-c {\n  color: hotpink; }\nbut I want this:\n.a .a-c,\n.b .b-c {\n  color: hotpink; }\nAny help please?\nthanks. ",
    "jleclanche": "@xzyfer I must be missing how one becomes the other? There's invalid syntax after that colon.. ",
    "smeevil": "\ud83d\udc4d \nI would love to have proper source maps for indented sass. ",
    "sapegin": "Another example:\n```sass\n$colors: red #f00, yellow #ff0, green #0f0, blue #00f;\n@each $entry in $colors {\n    $name: nth($entry, 1);\n    $color: nth($entry, 2);\n.box-#{$name} > header {\n     background: $color;\n}\n\n}\n```\nWas reported at Ruby Sass in 2013, I can reproduce it in Libasass 3.5.0.beta.2 (via node-sass 4.5.0). Seems to be fine in LibSass 3.4.0 though.\nAnother similar issue \u2014 https://github.com/sass/libsass/issues/1701\n. ",
    "mattfysh": "@delijah I was able to get this working again after upgrading by escaping the colon i.e. \nsass\n\\:global\n    .my-global-class-name\n        background-color: red. ",
    "delijah": "@mattfysh I can confirm this. Using a \"\\\" solves the problem. Now my sass-linter doesn't like it ;) I will open an issue for that.. ",
    "593273894": "Thank you for you reply. The difference results in the different file hash so I can not distinguish the file version. There are many numbers in my code like 25/64 45/64 61/64 will cause this issue. Is there any solutiion of this?. Thank you for your help! I use this as a workaround:\nscss\n@function px2rem($px) {\n    @return ceil($px * 10000 / 64) / 10000+rem;\n}\nsame output:\ncss\ndiv {\n  width: 0.0782rem; }. ",
    "abompard": "Ah, thanks for the info on the sass-spec tags.. Version 3.4.1\n(sorry for not replying sooner). The version was 3.4.1\n(sorry for not replying earlier). This is with libsass 3.4.1.. ",
    "cblegare": "Sorry for not following this up, I had less time for my little scss project.  Thanks you!. ",
    "schmod": "Aside: The above example works fine if the parent selector is not a list.\ninput.scss\nscss\n.a {\n  .b {\n    color: blue;\n    #{&}-foo {\n      color: red;\n    }\n  }\n}\noutput.css\n```css\n.a .b {\n  color: blue;\n}\n.a .b-foo {\n  color: red;\n}\n```. Thanks @mgreter!  That was incredibly fast!!. ",
    "eltiare": "Looks like this might have to do with with using old/broken versions of libsass. I'm going to close this for now. . ",
    "holmesmr": "CCing in dlmanning/gulp-sass#577 so this issue is linked to that one.. ",
    "DBosley": "Getting an issue related to this combined with angular/material2's styles. Commenting here to raise awareness of the issue.. ",
    "nickdunn": "Input:\n$char: '\\66';\ncontent: '\\feff#{$char}';\n\nOutput (fail):\ncontent: \"\udbbb\udfff\";\n\nHowever if I put a space between them, I get the correct output.\nInput:\ncontent: '\\feff #{$char-f}';\n\nOutput (pass):\ncontent: \"\ufefff\";\n\nWeird that the space gets collapsed?. May be related to https://github.com/sass/libsass/issues/1115.. I am still able to recreate this issue using libsass 3.5.0.beta.2 (via node-sass 4.5.3). Could this issue be re-opened?. Ah, please accept my apologies \u2014 I was following the wrong tag. Do you know when this might make it into a release?. ",
    "yurivict": "3.8.0. Thanks!. ",
    "meodai": "wow that was quick. Thanks @mgreter . ",
    "jacksleight": "According to the release notes this fix was included in 3.5.0.beta.3, however the latest node-sass is still bundling libsass 3.5.0.beta.2:\n./node_modules/node-sass/bin/node-sass --version\nnode-sass   4.7.2   (Wrapper)   [JavaScript]\nlibsass     3.5.0.beta.2    (Sass Compiler) [C/C++]\nAny idea when node-sass will be updated to 3.5.0.beta.3? This bug breaks our build currently so we're stuck on a very old version.. ",
    "NicolasGraph": "You can reproduce this in Sassmeister.\nEdit: However, if it works with 3.5.0-beta-3, that's fine!. ",
    "classicmike": "Hi guys,\nI submitted this issue about a month ago and I was just wanted to follow up on whether or not this has been looked at or not. I have just edited the issue content just to make it a little more readable with the example code.\nThanks for your help.. ",
    "zaycakitayca": "@xzyfer , I've actually opened this issue because of different behaviour in Ruby Sass and LibSass. But I've checked out compressed style in both compilers. After your response I've checked default style too and then both compilers produces an error. So I'm not sure if this a bug or not, but at least it's a different from Ruby Sass on same configuration.. @xzyfer \nsass -t compressed test.scss test.css\nsassc -t compressed test.scss test.css. Thanks. ",
    "TheColorRed": "Ahh, okay. Adding the quotes around the colors works. \nI had no problems with red, blue, orange, etc. most of the colors worked fine.. ",
    "silvandiepen": "I use them in my projects with capitals in maps. Use Yellow instead of yellow. I would do it as following: \n$colors: (\n    Yellow: #ffeb3b\n);\n@each $name, $color in $colors {\n    $amount: 40;\n    @for $i from 0 through 9 {\n        .#{to-lower-case($name)}-#{($i*100)} { background-color: lighten($color, $amount) };\n        $amount: $amount - 2;\n    }\n}. ",
    "jonathanphz": "Actually just found the problem - I had a typo. Spent more than an hour trying to fix this :(\nSorry!. ",
    "JohnMica": "if you wrap the whole http inside \"http://img12.360buyimg.com/da/jfs/t1708/343/1355811714/2006/812516d1/55e511a9N42e564c7.jpg\" does it work ?. ",
    "luchillo17": "Soo the notes on the docs on Angular guide are outdated?. @xzyfer Look at the last paragraph in the /deep/ section before the yellow encased paragraph, it's anchored so it should scroll by itself:\nhttps://angular.io/docs/ts/latest/guide/component-styles.html#!#-deep-. The funny thing is that i found it didn't worked because i was in Webpack using the css-loader and it worked, but inconsistently the sass-loader didn't since it uses node-sass under the hood, which uses this lib under it's hood.. It is indeed, however whether browser vendors start implementing is a different story.. ",
    "Zefling": "It's in this specification : https://drafts.csswg.org/css-scoping/#deep-combinator. ",
    "ogonkov": "Ok, seems i need to use some kind of linter. ",
    "uberska": "Thanks for the quick comment! I saw that issue, but didn't realize it was the same thing.\nWe're trying to update our codebase from 3.0 -> 3.5.0.beta3. This issue causes quite a bit of bloat in our css. Where I have .a through .e in the example, we actually have 16 selectors.\nFrom some of the other issues I found through the link you provided, it sounds like support for extending wrapped selectors isn't fully supported yet. Given that we're coming from 3.0 and haven't had extend for wrapped selectors yet, one outcome that could be useful for us would be to turn it off until the implementation is fully supported. Would you accept a pull request in libsass and node-sass for a flag to disable extends on wrapped selectors?. Wow, thanks for the quick turnaround, @mgreter ! We'll try a new build with libsass master.. With master, our problem seems to be fixed. Thanks @mgreter !. ",
    "marticongost": "I have noticed a regression on 3.4.5 that I suspect may be related to this change.\nThis is the SASS source:\n```\nsearchForm {\nflex: 1 1 auto;\n\n:host(:not([searchEnabled='true'])) & {\n    display: none;\n}\n\n}\n```\nIn 3.4.3, libsass produced the following CSS:\n```\nsearchForm {\nflex: 1 1 auto; }\n  :host(:not([searchEnabled='true'])) #searchForm {\n    display: none; }\n```\nWhereas on 3.4.5 I get this:\n```\nsearchForm {\nflex: 1 1 auto; }\n   #searchForm {\n    display: none; }\n```\nNotice the change in the selector for the inner rule. If I remove :not() from the original source 3.4.5 works as expected, so the problem does seem to be related to the handling of :not():\n```\nsearchForm {\nflex: 1 1 auto; }\n  :host([searchEnabled='true']) #searchForm {\n    display: none; }\n```. The online tool seems to be using 3.5b. Could this have been fixed by a later change in master (https://github.com/sass/libsass/commit/5a7dbc80a9f6b8062006b758d05bb302a695cc1f)? I can certainly reproduce it in 3.4.5. I'm using the Python bindings.. ",
    "chearius": "The problem is, that libsass fails with segmentation fault (SIGSEGV) without any further information about the source of the problem (recursion depth, stack overflow or whatever). From my point of view, it should print an error message and terminate without segmentation fault.\nRebuilding libsass and node-sass bindings with -O0 doesn't help, it still triggers SIGSEGV.. ",
    "bachew": "Oops, I assumed sassc command installed by libsass-python is the exactly the same as libsass's, it appears to be different in sassc.py. Sorry for taking up your time, please close this issue, I'll create pull request for libsass-python instead.. ",
    "botandrose": "Thanks for the quick response!\nSame behavior on both 3.4.5 and 3.5.0.beta.3.\nI tried checking the output of sass2scss, and that indeed appears to be the problem. Without the colon, sass2scss interprets the margin-top 1px as a 2-element css selector... something that would match the following html: <margin-top><1px></1px></margin-top> and thus converts the sass to:\nscss\nh1 { margin-top 1px {} }\nThis \"correctly\" compiles to empty string, because there are no actual declarations under that interpretation.\nUltimately, I would like an error or warning thrown here, like Ruby Sass does. To that end, my first thought is to add missing colon detection to sass2scss. However, it appears that there is no error detection whatsoever in sass2scss; I can't get it to error out no matter what garbage I send it. So perhaps this belongs in libsass, in the form of somehow detecting invalid selectors? Or perhaps adding a \"This selector doesn't have any properties and will not be rendered.\" warning? Thoughts?. ",
    "wuz": "We just ran across this issue as well: \nSass:\n```\n$common-colors: (\n  white: white,\n  primary: blue,\n  secondary: red\n);\n@each $name, $color in $common-colors {\n  .#{$name} {\n    color: $color;\n  }\n  .#{$name}-hover {\n    &:hover, &.hovered {\n      color: $color;\n    }\n  }\n}\n```\nOutput:\n:hover,.hovered{color:#fff}.primary{color:blue}.primary-hover:hover,.primary-hover.hovered{color:blue}.secondary{color:red}.secondary-hover:hover,.secondary-hover.hovered{color:red}\nRunning with sass ./test.scss --style compressed throws the error as expected, but node-sass --output-style compressed test.scss doesn't throw an error, instead just silently failing to create the classes correctly.\nError from sass command:\n``\nWARNING on line 8, column 4 of ./test.scss:\nYou probably don't mean to use the color value#fff' in interpolation here.\nIt may end up represented as #ffffff, which will likely produce invalid CSS.\nAlways quote color names when using them as strings (for example, \"#fff\").\nIf you really want to use the color value here, use `\"\" + $name'.\nError: Invalid CSS after \".\": expected class name, was \"#fff\"\n        on line 8 of ./test.scss\n  Use --trace for backtrace.\n```\nI'd be happy to look into the bug, but I don't even know where to begin. If someone can point me to the code, I'd happily help out!\nThanks!\nConlin\n. We just ran across this issue as well: \nSass:\n```\n$common-colors: (\n  white: white,\n  primary: blue,\n  secondary: red\n);\n@each $name, $color in $common-colors {\n  .#{$name} {\n    color: $color;\n  }\n  .#{$name}-hover {\n    &:hover, &.hovered {\n      color: $color;\n    }\n  }\n}\n```\nOutput:\n:hover,.hovered{color:#fff}.primary{color:blue}.primary-hover:hover,.primary-hover.hovered{color:blue}.secondary{color:red}.secondary-hover:hover,.secondary-hover.hovered{color:red}\nRunning with sass ./test.scss --style compressed throws the error as expected, but node-sass --output-style compressed test.scss doesn't throw an error, instead just silently failing to create the classes correctly.\nError from sass command:\n``\nWARNING on line 8, column 4 of ./test.scss:\nYou probably don't mean to use the color value#fff' in interpolation here.\nIt may end up represented as #ffffff, which will likely produce invalid CSS.\nAlways quote color names when using them as strings (for example, \"#fff\").\nIf you really want to use the color value here, use `\"\" + $name'.\nError: Invalid CSS after \".\": expected class name, was \"#fff\"\n        on line 8 of ./test.scss\n  Use --trace for backtrace.\n```\nI'd be happy to look into the bug, but I don't even know where to begin. If someone can point me to the code, I'd happily help out!\nThanks!\nConlin\n. ",
    "justablob": "I'd like to vote against this, or atleast for a toggle to enable it, because so far I've found it to be really useful, for example when lightening/darkening (primary + 5%) colors or mixing them ($primary / 1.8 + $secondary / 2.2).. ",
    "yivo": "It works well if @media not print is nested.\nscss\n.block {\n  @media (min-width: 600px) {\n    @media not print {\n      color: green;\n    }\n  }\n}. ",
    "tabatkins": "\ud83d\udc4d . ",
    "nop33": "This also works, what's the correct approach?\n```sass\n$default-margin: 10px;\nbody {\n    margin: #{$default-margin} -#{$default-margin} -#{$default-margin} -#{$default-margin};\n}\n``. I would expect that if you want to actually calculate the result, one should use thecalc` function (it's also mentioned here ).. Thanks for your replies, you've been very helpful!. ",
    "jbremer": "Fair enough. Would you by any chance know of a starting point for such CSS formatter in Gulp? I just ran into postcss, but didn't see anything in this direction in there. I'm personally not all that familiar with the tools out there in this area.. Oh, sweet, thanks! https://cuckoo.sh/ebf1b499512a098a/screenshot.png\nBest of luck with the rest of the project.. ",
    "gy741": "Hi.\nMichael Mifsud (xzyfer) seems to have access to the HackerOne site.\nI can post the problem here, But I think should check it through HackerOne.\nTo prevent the exploitation of bugs prior to patching.\nThanks.. Hi.\n[1] Do not have access to the page?\n[1]https://hackerone.com/reports/245446\nThanks.. @xzyfer Can not you access the page too?\nDo you mind if I post bug information to github?. @xzyfer I submitted six reports.\nCan you view my reports on the hackerone site?. @xzyfer Okay, Thanks.. ",
    "maniqui": "Yes, I saw that issue before posting this one, and although probably caused by the same misunderstanding, I though it would be better to create a new issue.\nBy the way, I found another workaround, which you can see in this gist.\nPassing an unquoted key argument to map-get is enough to work. I though that the argument had to be a string, but it seems a \"naked\" key is fine, and probably, correct. Right?\ninput.scss\n```scss\n$badColors: (\n  white: #fff,\n  black: #000\n);\n$goodColors: (\n  \"white\": #fff,\n  \"black\": #000\n);\n.test-bad {\n   color: map-get($badColors, white); #Unquoted key\n   background-color: map-get($badColors, black); #Unquoted key\n}\n.test-good {\n   color: map-get($goodColors, \"white\");;\n   background-color: map-get($goodColors, \"black\");\n}\n```\nActual and expected output\n```css\n.test-bad {\n  color: #fff;\n  background-color: #000;\n}\n.test-good {\n  color: #fff;\n  background-color: #000;\n}\n```\n. ",
    "jhpratt": "@nschonni node-sass is 4.5.3.. Just running sass --version, which is what I think you want, gives 3.5.1, which is the current release.. Ah, gotcha. It works using regular compilation, that's why I couldn't figure out why it wasn't working. Thanks for figuring that out! Hopefully this can be resolved at some point.. ",
    "meduzen": "I encountered this blocking situation while writing a @mixin. I have a @supports declaration with logic. Basically, and a bit shortened, what I\u2019d like to do is this, which seems  impossible at the moment:\n@each $offset, $val in $offsets {\n  @supports(#{$prop}-#{$offset}: unquote('max(0px)')) {\n    #{$prop}-#{$offset}: unquote('max(constant(safe-area-inset#{$offset}), #{$value})');\n  }\n}. ",
    "hitautodestruct": "This issue is occurring for me on node-sass v4.7.2 any ideas if this will be fixed?. ",
    "duncan-bayne": "@saper :wave: ... let me know if I can help in any way.  I'm a bit of a FreeBSD n00b though.. ",
    "cool-abhi": "If I am installing sass@4.5.3 package directly it is giving same issue. ",
    "shanalikhan": "I have the same problem in TFS\n@cool-abhi what helped ?. ",
    "hamzahamidi": "There is an issue when downloading the repository. ERROR 404 Page not found https://github.com/sass/node-sass/releases/download/v4.5.3/win32-x64-59_binding.node    This happened to me when starting a new Ionic project although I don't have any proxy.. ",
    "gunnx": "@mgreter When I tested in sassmeister it failed but in a different way, it errors but doesn't show a trailing comma in the error but yes I will raise it in the other repo. Thanks.. ",
    "sinuhepop": "@mgreter: You are right, it's how Sass works. In fact, this is a bug of the library I'm using: https://github.com/FortAwesome/Font-Awesome/issues/10842. ",
    "Noxmox6": "Hey,\nthanks for your quick reply. :)\nI have test it and now i can use a Path with 302 Characters. But if i increase the length to 369, it is also not working. The path length has been changed, but not to much. Hey, i tryed at again with your fix after i cleaned my project clearly and it works! :D\nI have test it with a 15 directories path and the css is completly created.\nTHANKS!. ",
    "REPTILEHAUS": "Yeah I figured, Im using this with an additional task to cssmin to clear all comments.. ",
    "just-boris": "I was migrating my project from node-sass to dart-sass when I encountered an issue caused by the new dart-sass version behavior.\nWe use custom importer function to rewrite file paths depending of the current ui-theme. We have the following file structure\nsrc/sass/\n\u251c\u2500\u2500 index.scss\n\u251c\u2500\u2500 button.scss\n\u251c\u2500\u2500 button.custom.scss\n\u251c\u2500\u2500 constants.scss\n\u251c\u2500\u2500 constants.custom.scss\n\u2514\u2500\u2500 dropdown.scss\nWhen the \"custom\" theme is being built, importer enforces .custom.scss files to be included instead of default ones. This way we can override only some parts of the theme without rewriting it all.\nWith migration to dart-sass, the importer doesn't work for us, because it is not called, as soon as files for original theme are present, so we always get the \"original\" theme built, even if \"custom\" was requested.. ",
    "resuna": "OK, I explicitly checked out 3.4.5 and now despite it claiming to be building 3.4.5 when I actually build it builds 0.0.9:\n\nchecking for strtol... yes\nchecking for library containing dlopen... none required\nconfigure: Building libsass (3.4.5)\nchecking that generated files are newer than configure... done\nconfigure: creating ./config.status\n\nLike so:\n\nlibtool: link: g++  -fPIC -DPIC -shared -nostdlib /usr/lib/crti.o /usr/local/lib/gcc48/gcc/x86_64-portbld-freebsd10.1/4.8.4/crtbeginS.o  .libs/cencode.o .libs/ast.o .libs/node.o .libs/context.o .libs/constants.o .libs/functions.o .libs/color_maps.o .libs/environment.o .libs/ast_fwd_decl.o .libs/bind.o .libs/file.o .libs/util.o .libs/json.o .libs/units.o .libs/values.o .libs/plugins.o .libs/position.o .libs/lexer.o .libs/parser.o .libs/prelexer.o .libs/eval.o .libs/expand.o .libs/listize.o .libs/cssize.o .libs/extend.o .libs/output.o .libs/inspect.o .libs/emitter.o .libs/check_nesting.o .libs/remove_placeholders.o .libs/sass.o .libs/sass_util.o .libs/sass_values.o .libs/sass_context.o .libs/sass_functions.o .libs/sass2scss.o .libs/to_c.o .libs/to_value.o .libs/source_map.o .libs/subset_map.o .libs/error_handling.o .libs/SharedPtr.o .libs/utf8_string.o .libs/base64vlq.o   -L/usr/local/lib/gcc48/gcc/x86_64-portbld-freebsd10.1/4.8.4 -L/usr/local/lib/gcc48/gcc/x86_64-portbld-freebsd10.1/4.8.4/../../../../../x86_64-portbld-freebsd10.1/lib -L/usr/local/lib/gcc48/gcc/x86_64-portbld-freebsd10.1/4.8.4/../../.. -lstdc++ -lm -lc -lgcc_s /usr/local/lib/gcc48/gcc/x86_64-portbld-freebsd10.1/4.8.4/crtendS.o /usr/lib/crtn.o  -O2 -g -O2 -O2   -Wl,-soname -Wl,libsass.so.0 -o .libs/libsass.so.0.0.9\n\n. ",
    "GabLeRoux": "Been stuck on this for a week now. I tried to delete package-lock.json, tried other node versions, tried changing node-sass version from ^4.5.3 to 4.5.2 or  in package.json, always the same.\n@mgreter I'm randomly shooting everywhere like a cowboy, any advice or suggestions I could try?. ",
    "wesleytodd": "Thanks @mgreter!  Do you know what release this will go out with?. @mgreter Bump.  Sorry to bother here, but I was going to follow up with what it will take to get this into node-sass, but I don't know how to know when it is ready or what to do.. Ok.  Thanks for the info, I will look out for that.. ",
    "tthaliath": "Getting the same error while running yo tool\n$ node --version\nv9.0.0\n$ npm --version\n5.5.1\n$ yo meanjs\nYou're using the official MEAN.JS generator.\n? What mean.js version would you like to generate? 0.4.0\n0.4.0\n? In which folder would you like the project to be generated? This can be change\nd later. mean\nCloning the MEAN repo.......\n? What would you like to call your application? Code snippets\n? How would you describe your application? Full-Stack JavaScript with MongoDB, E\nxpress, AngularJS, and Node.js\n? How would you describe your application in comma seperated key words? MongoDB,\n Express, AngularJS, Node.js\n? What is your company/author name? \n? Would you like to generate the article example CRUD module? No\n? Would you like to generate the chat example module? No\nRunning npm install for you....\nThis may take a couple minutes.\nError: Command failed: cd mean && npm install\nCannot download \"https://github.com/sass/node-sass/releases/download/v4.5.3/linux-x64-59_binding.node\": \nHTTP error 404 Not Found\nIs it due to missing node v9.0.0 support? what is the latest node version that is fully supported?. ",
    "ivancicf": "Hi from the OSS-Fuzz team: We were wondering if there has been any updates here.\nWe'd be very excited to have this project onboard. The cash rewards for integration are still available, and we've been ramping up our open source fuzzing efforts. \nPlease see here and here for how to use this. As mentioned in the recent blog post, we could also provide a sample fuzz target that you are welcome to use directly or modify.\nPlease  let us know if there's anything else we can do to help get this integrated.\nThanks!\n. ",
    "thaoms": "I managed to fix it with this:\nfilter: #{ \"grayscale(50%)\" };\nI never had to do this.\nI can find a similar issue here\nhttps://github.com/workshops-de/angularjs.de/commit/e2426d387afa8035fd5872495b3987ef2480bf62. Issue can be closed, was related to:\nhttps://github.com/twbs/bootstrap/pull/23579\nsorry, so many things to check. ",
    "im-n1": "I use node-sass package which uses libsass. So I dived into and found libsass directory and version.sh script. That how I got the version info.\nNevertheless cool if it works :+1: . ",
    "ADTC": "Weird, same problem I face when trying to add :root.... ",
    "Larsklopstra": "use (backslash):root \ud83d\ude04 . ",
    "wouter-muller": "Thanks @Larsklopstra  couldn't figure this one out!. ",
    "drook": "````diff\n--- units.cpp.orig      2017-12-30 10:12:57.611866142 +0300\n+++ units.cpp   2017-12-30 10:13:30.501632897 +0300\n@@ -91,7 +91,7 @@\n     else if (s == \"rad\")  return UnitType::RAD;\n     else if (s == \"turn\") return UnitType::TURN;\n     // time units\n-    else if (s == \"s\")    return UnitType::SEC;\n+    else if (s == \"s\")    return UnitType::SECONDS;\n     else if (s == \"ms\")   return UnitType::MSEC;\n     // frequency units\n     else if (s == \"Hz\")   return UnitType::HERTZ;\n@@ -120,7 +120,7 @@\n       case UnitType::RAD:     return \"rad\";\n       case UnitType::TURN:    return \"turn\";\n       // time units\n-      case UnitType::SEC:     return \"s\";\n+      case UnitType::SECONDS:     return \"s\";\n       case UnitType::MSEC:    return \"ms\";\n       // frequency units\n       case UnitType::HERTZ:   return \"Hz\";\n--- units.hpp.orig      2017-12-30 10:13:03.372814084 +0300\n+++ units.hpp   2017-12-30 10:13:23.057973304 +0300\n@@ -35,7 +35,7 @@\n     TURN,\n // time units\n\n\nSEC = TIME,\n\nSECONDS = TIME,\n     MSEC,\n// frequency units\n````. Yup, in some node-sass libsass bundled versions I saw the SmartOS #define knob just to fix this SEC macro - for some reasons it doesn't fire on Solaris.. @xzyfer well, I posted my patch already - it's a working one, and libsass is working after it at least for node.js (I used it to build frontend for grafana, which isn't assembling without node-sass and especially without it's libsass binding binary). I've also tried to run the full test sequence for libsass, but seems like sassc has it's own building issues (and to my knowledge its building scripts are of poor quality), so I cannot say \"I ran the full test sequence, just commit it in\", but I'm looking into it.. \n\n",
    "alyssais": "This is still broken for me on SmartOS 2017Q4 :(. Fixed Travis failure on Darwin \u2013 I was using UNAME in the Makefile before it had been defined. Should have used OS instead.\nAppVeyor looks like it just hung and then timed out. \ud83e\udd37\u200d\u2640\ufe0f . I\u2019m confused \u2014 there are autotools files in the repo, but the Makefile isn\u2019t generated using autotools? What\u2019s the reason for that \u2014 are you trying to move away from it?\nAnyway, compiling a small C program is probably (just) more reliable than trying to parse compiler output. Although I wonder if it might be better to take the simpler option of just removing the problematic flags entirely and avoiding the whole problem\u2026. I've amended my commit to just remove these flags.\n. Side note: I keep having to rebase this PR so it can be merged, because a new commit has been added to master, even though there aren't any conflicts or anything. Maybe have a think about whether that needs to be a hard \"no\"? IME it often doesn't, and in this sort of case where the change is very unlikely to conflict with anything else it gets annoying fast.. Wonderful, thank you! Do you have any plans for a release?. On second thoughts, I\u2019m not actually sure this is going to solve my problem. Solaris generally uses the GCC compiler, but not its linker. And this is checking the compiler, right?. > Honestly I think even a simple comment would go a long way to stopping this regressing again. Memories are short.\nWhere would it go? Would it have to be repeated once per file?\n. Thank you! While I'm here, any news on a release?. ",
    "fsaenger": "Sorry, couldn't properly link to SourceMap Inspector because it doesn't store code that throws errors.. Sorry about that, @nschonni, my mistake.. ",
    "dperolio": "I did search, but saw that one was closed.. ",
    "entr": "Finally, thanks!. ",
    "stephenbe": "I have not. Would you want me to try it and report back ? . Lol but what does that mean? I don't know the history of ruby sass and it seems like you are alluring to something. ",
    "jeffwcx": "@mgreter , this issue may have already fixed in #2330 . I down grade node-sass's version to 4.1.1. and it works.  Thank for your answer.. ",
    "ArmorDarks": "I've actually opened an issue with proposal to make it a feature: https://github.com/sass/sass/issues/2470. Thanks!. ",
    "gilnoiman": "T: system is \"samba4\".\nit has too many dependencies for testing it on c: . ",
    "chriscoyier": "This probably isn't the perfect place to ask this, so feel free to shoo me there.\nI'm curious how the rollouts work. This eventually goes into a point release for libsass, right? Then implementations of it need to update to that version, so if we're using Node, we wait for the next point release of node-sass?. ",
    "YodasWs": "@xzyfer,\nYes, I would expect libsass to give an error on this.\nI had originally filed a defect on sass and was told to report it here. node-sass with libsass does not throw an error but outputs the wrong CSS.. ",
    "FezVrasta": "Example:\nhttps://github.com/FezVrasta/bootstrap-material-design/blob/06e9fcac7d4877467cf51e6bfecdd0454fb5273f/scss/_forms.scss#L75\n@include bmd-form-color($bmd-label-color, $bmd-label-color-focus, $input-border-color);. Thanks for the clarification, may you suggest an alternative way to obtain the same result? I spent quite some time to get rid of it but I couldn't figure out a solution.. Thanks I'll give it a try. ",
    "mpalpha": "this should work within a mix-in etc:\n$some-class: 'someclass';\n@if #{&} {\n    @at-root {\n        #{&}.#{$some-class} {\n            attribute: value;\n        }\n    }\n}. ",
    "gilbsgilbs": "@xzyfer Sorry, I oversimplified the test scenario. Here is the faulty code:\n$  echo '.foo { font-size: (16px / 16px) + 0em; }' | ./node_modules/.bin/node-sass -s\n.foo {\n  font-size: 1; }\n~Let me update the issue description.~ done\nEdit: Mmh. After some further testing, it doesn't seem that much related to the 0em as:\n$ echo '.foo { font-size: (16px / 16px) + 1em; }' | ./node_modules/.bin/node-sass -s\n.foo {\n  font-size: 2; }. Many thanks. . ",
    "pascalduez": "Thanks @mgreter,\nthe reason of my surprise is there's no mention of such change in the LibSass changelog, so this is quite confusing if I may. There's a link to the Sass changelog but that's not really straighforward.\nSo basically this means LibSass, node-sass, and also Ruby Sass don't follow semver?\n. Thanks for clarifying @xzyfer @mgreter\nKeep up the amazing work!\n. ",
    "vineetgorhe": "Thanks. It prevents users with strict licensing restrictions from importing this source in their repo to build. If this file isn\u2019t needed at all then perhaps it can be deleted during the import.. ",
    "Demo30": "I'm sorry, this doesn't belong to LibSass. ",
    "dilyanpalauzov": "It works for me with VPATH builds. How does it fail exactly because of subdir-objects?. GNUMakefile.am contains:\nSASS_SASSC_PATH ?= $(top_srcdir)/sassc\nnodist_tester_SOURCES = $(SASS_SASSC_PATH)/sassc.c\nso at the time automake is run, before./configure, Automake does not know the source files for tester.  At https://www.gnu.org/software/automake/manual/html_node/Conditional-Sources.html is written\n\"You can\u2019t put a configure substitution (e.g., \u2018@FOO@\u2019 or \u2018$(FOO)\u2019 where FOO is defined via AC_SUBST) into a _SOURCES variable. \" and \"Automake must know all the source files that could possibly go into a program, even if not all the files are built in every circumstance. \"\nThe above _SOURCES violate Automake's wishes.\nThis SASS_TEST_FLAGS += -c $(top_srcdir)/tester$(EXEEXT) should use $(top_builddir) because there the tester file shall be created (in VPATH builds).\nConsider shortening configure.ac:\n```diff\ndiff --git a/configure.ac b/configure.ac\n--- a/configure.ac\n+++ b/configure.ac\n@@ -73,7 +73,6 @@ the --with-sassc-dir= argument.\n ])\n   ])\n   SASS_SASSC_PATH=$sassc_dir\n-  AC_SUBST(SASS_SASSC_PATH)\nAC_ARG_WITH(sass-spec-dir,\n               AS_HELP_STRING([--with-sass-spec-dir=], [specify directory of sass-spec for testing (default: sass-spec)]),\n@@ -93,15 +92,14 @@ the --with-sass-spec-dir= argument.\n       SASS_SPEC_PATH=\"$sass_spec_dir\"\n       ;;\n   esac\n-  AC_SUBST(SASS_SPEC_PATH)\n else\n   # we do not really need these paths for non test build\n   # but automake may error if we do not define them here\n   SASS_SPEC_PATH=sass-spec\n   SASS_SASSC_PATH=sassc\n-  AC_SUBST(SASS_SPEC_PATH)\n-  AC_SUBST(SASS_SASSC_PATH)\n fi\n+AC_SUBST(SASS_SPEC_PATH)\n+AC_SUBST(SASS_SASSC_PATH)\nAM_CONDITIONAL(ENABLE_TESTS, test \"x$enable_tests\" = \"xyes\")\n``. With the newest code, ./configure still creaes a file$(SASS_SASSC_PATH)/.deps/tester-sassc.Poand make sayssassc/.deps/tester-sassc.Ponot found.. Yes, I am sure../configuregenerates the attached [config.status](https://github.com/sass/libsass/files/1824452/config.status.txt) and running it creates$(SASS_SASSC_PATH)/.deps/tester-sassc.Po`.\n. ",
    "sovanyio": "Given that, could the error output actually give a useful message there? Or at least a hint \"arithmetic does not work on interpolated strings\". ",
    "liamkeily": "Like @tony I was using this to import css files from an npm package, whats the best way to go about this now?. ",
    "bayucandra": "@xzyfer just check at documentation about \"Custom importer\": https://sass-lang.com/documentation/file.SASS_REFERENCE.html#custom_importers . However, it looks not so clear to me. Do you have more detail reference about \"Custom import\" things? thanks in advance. . @qodesmith Looks the point is just throw away CSS out from SCSS code right? I thought there was some way which I can do inside my SCSS code, so we can still see a CSS list inside SCSS code. Will do gulp concatenation then, since I am using gulp instead Webpack. Thanks for sharing your way.. ",
    "qodesmith": "@bayucandra If you're using Webpack, you can import your css files at the top of your entry JavaScript file. That's where I was importing my top-level scss file anyway. And so long as you're using css-loader in your chain of loaders, everything should be good to go.. @tcchau Shameless plug - try Create New App instead \ud83d\ude04I created it to ease my pain of including things like scss and redux since I was using them all the time. But I wanted to keep the simplicity of CRA in that you just have to type a single command and boom - app generated.\nI agree that it's a pain that you can't import css directly from a scss file. I myself have been using it that way to import 3rd party libraries (even some of my own!) that only provide a css file.. > Right now, there's legal CSS that works differently when used with Sass than when used as CSS.\n@chriseppstein I'd be interested to see an example of that. I wasn't aware of it!. ",
    "tcchau": "@qodesmith I'm using create-react-app, which restricts you from importing from outside of the src directory, so this isn't a viable workaround for people like @liamkeily and myself. I work mainly with SASS so the times I want to import a CSS file are exactly when it's from a third-party who provides a CSS file but not a SASS file. Disallowing imports of CSS files altogether seems overly-restrictive, since SASS is a superset of CSS and a SASS parser should be able to handle all CSS input without problems.. ",
    "jakubfijalkowski": "Should I also move Java and JavaScript headings up in the list?. Fixed. Well, that was fast.\nThank you!. ",
    "remotezygote": "There needs to be something somewhere that tells you what to do about this warning. It cropped up all of a sudden, and I have no idea how to make it go away. Where is the documentation about what to do when you hit this? There appears to be zero documentation about sass_option_push_import_extension anywhere... did I miss something? Is that a function you call? Is that a configuration item? What is it?. ",
    "waltercruz": "Error: Invalid CSS after \"...mplate-columns:\": expected expression (e.g. 1px, bold), was \"[full-start] minmax\"\n        on line 14 of scss/2-tools/_grid.scss. yes, i closed the bug. for some reason my node environment was with a very old version os libsass! Sorry for the noise! . ",
    "chancestrickland": "Oi, sorry about that. Thanks!. ",
    "thatguystone": "It looks like the file came from json.c, which, as @nschonni noted, hasn't been updated since 2011.\nApart from the usage in json.cpp, out_of_memory is only used once, so it might be better just inline it. Thoughts?. ",
    "simongcc": "@xzyfer Thanks for your follow up.. @xzyfer After reinstalling the node-sass 4.8.3 allow again the follow behaviour which you described as \"not allowed\" is allowing again. I am not sure what dependency making it happening by chance.\nSCSS\n:root {\n  --TEST: $theme-primary;\n}\nexpected\n:root {\n  --TEST: $theme-primary;\n}\nresult\n:root {\n  --TEST: 0, 0, 0;\n}. @xzyfer I have just confirmed it is the only version installed:\nyarn list v1.5.1\nwarning Filtering by arguments is deprecated. Please use the pattern option instead.\n\u2514\u2500 node-sass@4.8.3. ",
    "bsmith-cycorp": "At the very, very least this should be somehow mentioned in the documentation, which it doesn't seem to be. It unexpectedly broke our project on a minor-version upgrade (if a SASS variable can be assigned to a regular CSS property without #{ }, it's reasonable to assume that it could be assigned to a custom CSS property without it), and I'd bet we're not the only ones.. My dispute wasn't with the syntax itself (lord knows I'm not qualified to comment on that), but with the communication of it. It sounds, however, like the libsass team has their hands tied given the fact that Ruby sass is still considered the canonical reference, which I wasn't aware of.\nI guess the real underlying issue is that CSS custom properties are mentioned nowhere in http://sass-lang.com/documentation at all, as far as I can tell - neither the supported nor the unsupported version of the syntax - even though support for them has been officially added to the compiler itself. This leads one to assume - in the absence of a special explanation - that the syntax is the same as for other CSS properties (again, I'm not arguing that requiring #{ } is unreasonable, only that it's reasonable to assume it isn't required, lacking documentation to the contrary).\nI don't know how the relationship between the libsass and sass teams affects the ability to update documentation, but I think we can agree the documentation needs to reflect this API, otherwise\n\nRelying on bugs is no different to relying on an undocumented API and violates your contract with us.\n\nisn't a valid argument.. ",
    "cristiangiagante": "How i can do the invert?\nAssign css variable to sass variable?. ",
    "electerious": "@chriseppstein This is not possible. CSS variables are computed during runtime while SASS will run once you compile it. You can't assign a CSS variable to a SASS variable.. ",
    "JLarky": "\nHow i can do the invert?\nAssign css variable to sass variable?\n\njust replace\n--color: $my-var;\nwith\n--color: #{$my-var};. ",
    "durgapatra": "How i can do this?\n Sass variable change  to css variable ?\n// style.scss \n$primary-color: #dc4545;\ndiv{\nbackground : $primary-color\n}\ntry to do this \ndiv{\nbackground : var(--primary-color)\n}\nis that possible for any way? \n. ",
    "idontusenumbers": "I get the same build errors and can confirm the change @Nimce reports does in fact let the build complete on my machine.. ",
    "Ziggizag": "I also confirm these build errors and confirm the remedy provided by @Nimce works perfectly. I could compile entire sassc.exe using this tip.. ",
    "jgroot82": "Hi I can also confirm that @Nimce solution fix the issue for me.\n. ",
    "ebgc": "tx for response\ni am referring to sassc-rails gem which depends on sassc gem which has an ext library (libsass) build running during bundle install. \nand SASS_LIBSASS_PATH does the job - tx again. ",
    "juliancarrivick": "If it helps, I think I'm being hit by a similar (same?) bug with using :not() with nested elements. I would expect that the following Sass: \n``` sass\n.parent:not(.a, .b) {\n    color: blue;\n.child {\n    color: red;\n}\n\n}\nwould compile to the following: css\n.parent:not(.a, .b) {\n  color: blue;\n}\n.parent:not(.a, .b) .child {\n  color: red;\n}\nHowever, using libsass it outputs: css\n.parent:not(.a, .b) {\n  color: blue;\n}\n.parent .child {\n  color: red;\n}\n```\nIt seems to be an issue with the multiple elements in the :not() clause because when I compile it with a single selector in the :not() it outputs correctly:\n``` sass\n.parent:not(.a) {\n    color: blue;\n.child {\n    color: red;\n}\n\n}\nCompiles to: css\n.parent:not(.a) {\n  color: blue;\n}\n.parent:not(.a) .child {\n  color: red;\n}\n```\nI verified this using https://www.sassmeister.com/ (nice little tool!).. ",
    "timomayer": "Will this be fixed soon? It breaks some of our projects. ",
    "HongxuChen": "FYI, it is a stack-overflow according to Address Sanitizer:\n```\n    #33 0x7fd8b1e2063b in Sass::Inspect::operator()(Sass::Selector_List) /home/hongxu/FUZZ/libsass-orig/src/inspect.cpp:1098 \n    #34 0x7fd8b1e15eb3 in Sass::Selector_List::perform(Sass::Operation) /home/hongxu/FUZZ/libsass-orig/src/ast.hpp:2984\n   #35 0x7fd8b1e15eb3 in Sass::Inspect::operator()(Sass::Wrapped_Selector) /home/hongxu/FUZZ/libsass-orig/src/inspect.cpp:986\n    #36 0x7fd8b1e0fe50 in Sass::Inspect::operator()(Sass::Compound_Selector) /home/hongxu/FUZZ/libsass-orig/src/inspect.cpp:996\n    #37 0x7fd8b1e1ded7 in Sass::Compound_Selector::perform(Sass::Operation) /home/hongxu/FUZZ/libsass-orig/src/ast.hpp:2742\n    #38 0x7fd8b1e1ded7 in Sass::Inspect::operator()(Sass::Complex_Selector) /home/hongxu/FUZZ/libsass-orig/src/inspect.cpp:1023\n    #39 0x7fd8b1e1e3f4 in Sass::Complex_Selector::perform(Sass::Operation) /home/hongxu/FUZZ/libsass-orig/src/ast.hpp:2907\n    #40 0x7fd8b1e1e3f4 in Sass::Inspect::operator()(Sass::Complex_Selector) /home/hongxu/FUZZ/libsass-orig/src/inspect.cpp:1061\n    #41 0x7fd8b1e2063b in Sass::Complex_Selector::perform(Sass::Operation) /home/hongxu/FUZZ/libsass-orig/src/ast.hpp:2907\n    #42 0x7fd8b1e2063b in Sass::Inspect::operator()(Sass::Selector_List) /home/hongxu/FUZZ/libsass-orig/src/inspect.cpp:1098\n...\n    #439 0x7fd8b1e1e3f4 in Sass::Complex_Selector::perform(Sass::Operation) /home/hongxu/FUZZ/libsass-orig/src/ast.hpp:2907\n    #440 0x7fd8b1e1e3f4 in Sass::Inspect::operator()(Sass::Complex_Selector) /home/hongxu/FUZZ/libsass-orig/src/inspect.cpp:1061\n    #441 0x7fd8b1e2063b in Sass::Complex_Selector::perform(Sass::Operation) /home/hongxu/FUZZ/libsass-orig/src/ast.hpp:2907\n    #442 0x7fd8b1e2063b in Sass::Inspect::operator()(Sass::Selector_List) /home/hongxu/FUZZ/libsass-orig/src/inspect.cpp:1098\n    #443 0x7fd8b1e15eb3 in Sass::Selector_List::perform(Sass::Operation) /home/hongxu/FUZZ/libsass-orig/src/ast.hpp:2984\n    #444 0x7fd8b1e15eb3 in Sass::Inspect::operator()(Sass::Wrapped_Selector) /home/hongxu/FUZZ/libsass-orig/src/inspect.cpp:986\n    #445 0x7fd8b1e0fe50 in Sass::Inspect::operator()(Sass::Compound_Selector*) /home/hongxu/FUZZ/libsass-orig/src/inspect.cpp:996\nSUMMARY: AddressSanitizer: stack-overflow ??:0 __interceptor_strlen\n==17445==ABORTING\n```. Another heap buffer overflow happens nearby:\n```\n==6731==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60200000efdd at pc 0x7fcdb81f7565 bp 0x7ffd03f0a200 sp 0x7ffd03f0a1f0\nREAD of size 1 at 0x60200000efdd thread T0\n    #0 0x7fcdb81f7564 in unsigned int utf8::unchecked::next(char const*&) utf8/unchecked.h:84\n    #1 0x7fcdb7e6966e in handle_error /home/xiaofei/FUZZ/libsass-orig/src/sass_context.cpp :84\n    #2 0x7fcdb7e6ab9f in handle_errors /home/xiaofei/FUZZ/libsass-orig/src/sass_context.cpp:207\n    #3 0x7fcdb81f6d8d in sass_parse_block /home/xiaofei/FUZZ/libsass-orig/src/sass_context.cpp:253\n    #4 0x7fcdb81f6d8d in sass_compiler_parse /home/xiaofei/FUZZ/libsass-orig/src/sass_context.cpp:483\n    #5 0x7fcdb81f6ec8 in sass_compile_context /home/xiaofei/FUZZ/libsass-orig/src/sass_context.cpp:371\n    #6 0x402d35 in compile_file /home/xiaofei/FUZZ/sassc-orig/sassc.c:158\n    #7 0x402456 in main /home/xiaofei/FUZZ/sassc-orig/sassc.c:375\n    #8 0x7fcdb79c682f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)\n    #9 0x402748 in _start (/home/xiaofei/FUZZ/sassc-orig/install/bin/sassc+0x402748)\n0x60200000efdd is located 0 bytes to the right of 13-byte region [0x60200000efd0,0x60200000efdd)\nallocated by thread T0 here:\n    #0 0x7fcdb8591602 in malloc (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x98602)\n    #1 0x7fcdb7fcf403 in Sass::File::read_file(std::__cxx11::basic_string, std::allocator > const&) /home/xiaofei/FUZZ/libsass-orig/src/file.cpp:463\nSUMMARY: AddressSanitizer: heap-buffer-overflow utf8/unchecked.h:84 unsigned int utf8::unchecked::next(char const*&)\nShadow bytes around the buggy address:\n  0x0c047fff9da0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c047fff9db0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c047fff9dc0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c047fff9dd0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd\n  0x0c047fff9de0: fa fa fd fa fa fa 00 fa fa fa 00 00 fa fa 00 00\n=>0x0c047fff9df0: fa fa 00 fa fa fa fd fa fa fa 00[05]fa fa 00 00\n  0x0c047fff9e00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c047fff9e10: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c047fff9e20: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c047fff9e30: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c047fff9e40: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07 \n  Heap left redzone:       fa\n  Heap right redzone:      fb\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack partial redzone:   f4\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Container overflow:      fc\n  Array cookie:            ac\n  Intra object redzone:    bb\n  ASan internal:           fe\n==6731==ABORTING\n```\nsample inputs:\ntest_m004.txt\ntest_m005.txt. Other relevant input files (some of them emit different different call stacks in different runs):\nso_parser.cpp:1808_01.txt\nso_parser.cpp:1792_01.txt\nso_parser.cpp:1792_02.txt\nso_parser.cpp:1846_01.txt\n. Other input files:\nso_ast.cpp:2163_01.txt\nso_ast.cpp:2163_02.txt\nso_ast.cpp:2164_01.txt\nso_ast.cpp:2165_01.txt\nso_ast.cpp:2170_01.txt\nso_ast.cpp:2170_02.txt\n. Two relevant inputs:\nso_ast.cpp:43_01.txt\nso_ast.cpp:45_01.txt\n. ",
    "samuelcolvin": "I think this can be closed, this is exactly what was expected by #1963.\nPersonally, I think it should have been depreciated via a warning first and caused a minor release rather than patch, but it's too late now.. I'm very confused by the depreciation, nowhere seems clear:\n\nThe deprecation warning will be removed in 3.6.0.\n\nvs.\n\nIncluding .css files with @import is non-standard behaviour which will be removed in future versions of LibSass. Use a custom importer to maintain this behaviour. Check your implementations documentation on how to create a custom importer.\n\nWill the depreciation warning be removed in 3.6.0 and sass_option_push_import_extension continue to work or will the functionality of importing css be completely removed?\nPersonally, I would say it would be a big step back for libsass to stop supporting css imports, this will either mean:\n libraries using libsass each have to implement their own custom importers for supporting css\n or the average user (who I guess has no idea about custom importers or how to implement them) loses the right to import css into their sass, thereby losing all the benefits of checking and compressing css.\nI don't use ruby, I'm not going to and I couldn't care less what it does and doesn't do. Please can we keep sass_option_push_import_extension.. Thanks for clarifying.\nI've just read the module proposal for sass 4 and it looks great.. ",
    "raxod502": "See also https://github.com/sass/node-sass/issues/2362 for dealing with this on the node-sass end.. ",
    "carnil": "This issue was assigned CVE-2018-11499. ",
    "VictorRodriguez": "@xzyfer thanks a lot for the great support, do you have the patch of the common root cause issue?\n. Hi, I was trying to fix the issue and find out that the heap-use-after-free  points to the line: \nhttps://github.com/sass/libsass/blob/master/src/sass_context.cpp#L79\nis that correct? if so where is the free before assigning const char* line_end = line_beg ?. @xzyfer thanks a lot for the great support, do you have the patch of the common root cause issue? . ",
    "irundaia": "@marvinhuebner, I'm not a sass expert, but I''m not sure why you're using interpolation here. That's the thing that breaks the number arithmetic. \nFor what it's worth... I get the same output when using Ruby sass as with libsass.. ",
    "marvinhuebner": "If i wrote this by myself i could easily change that, but we're including a bunch of scss from a third party package in some of our client projects. It worked out really well, till i upgraded our build stack to use the latest versions and node-sass@4.9.0 which depends on libsass 3.5.4.\nI'm just wondering why this has worked before?\nFor know i downgraded back to node-sass@4.7 and will get in contact with the company which develops the third party package.. > I suggest submitting a paper or issue the offending library.\nI will do this. But thanks for your input on this!. ",
    "Geobert": "Locally, to make it works, I had to open the sln with VS2017 and let it upgrade. Then I've compare what VS2017 added to the project and adding these platforms did the trick on my computer. . > Where is th is VS2010 default is coming from? Maybe it is set somewhere as a part of Rust scaffolding?\nI've no clue :-/ If you think it's not a good idea discard this PR, I've manage a workaround in the build script from Rust.. ",
    "npetruzzelli": "Got it, thank you! \nSo if I were to explain it to someone else, then I'd be telling them that relative URLs only appear to be POSIX paths because:\n\nThey both use . to represent the current directory\nThey both use .. to represent the parent directory\nThey both use / to represent a segment/directory separator\n\nIn the case of relative paths, there are not URI protocols, domains, or ports, so it otherwise is a valid POSIX filesystem path (assuming the relative path does not have a hash or a query string.)\nWould it be too confusing to bring up symbolic links here?\nAnd more information can be found:\n\nFile System Paths\nWindows Naming Files, Paths, and Namespaces\nPOSIX 4.13 Pathname Resolution\n\n\nURLs/URIs\nUniform Resource Identifier (URI): Generic Syntax\nKeep in mind that there is more to URLs than what is in the URL Class\n\n\n\n\nDoes that sound about right?. ",
    "slarti-b": "Ah!  Yes.  I was.\nHowever, the commit you link is updating to ABI version to 1:0:0 as you say - so I guess the first quoted block in my original post needs updating. ",
    "bskibinski": "This is a pretty major bug, just found out myself when upgrading libsass to a newer version (older versions didn't have this bug). This could break sites without you noticing. This should really be fixed as fast as possible. You can quickly check different libraries here:\nhttps://www.sassmeister.com/\nOk I had a brainfart yesterday, my example below actually isn't a bug (or at least the order doesn't matter in that case).\nBut the original bug still stands.\n~~I also did some tests, and there are a more ways extends with classes within them, also get printed in the wrong order:~~\nLibsass:\n```\n%testextend {\n  background: red;\n  &.hoverclass {\n    background: blue;\n  }\n}\n%testextend {\n  background: red;\n  &:hover {\n    background: blue;\n  }\n}\n.wrapper {\n  &.inner {\n    @extend %testextend;\n  }\n}\n**Output:**\n.wrapper.inner {\n  background: red;\n}\n.hoverclass.wrapper.inner {\n  background: blue;\n}\n.wrapper.inner {\n  background: red;\n}\n.wrapper.inner:hover {\n  background: blue;\n}\n```\n~~As you can see... hoverclass get printed as the first class.~~\n~~Actually, i've found that my example is also a bug in the normal sass library. will make a bug report there.\nBut OP's bug (with [type=bla] example) is a libsass bug, and should also be fixed asap :)~~. @ashleykolodziej Haha happy cake day! Glad i could make it better ;)\nAlso, my second bug finding isn't actually a bug (long day) but yours still is!\nLets hope this gets fixed soon! :). There is no bug here, this is the way extends are supposed to work.\nIn your very first example, the duplication occurs because you're doing a \"double\" import of \"@import './placeholder'\", let me show you:\nin top.scss you import these two files:\n@import './placeholder';\n@import './utility';\nAnd in utility.scss, you import placeholder.scss again.\nSo, top is importing placeholder and utility. And utility also imports placeholder.\nSo what you get in your compiled top.scss is the folowing code:\n%green (imported through top.scss)\n%green (imported throught utility.scss)\nand then you get the .green class, which will extend into the 2 the two %green placeholders.\nBe sure you import all your partials in one main document, so you don't get this.\nBelow another example explaining that extends should work like this:\nYou've defined two placeholder tags (with the same name %green).\nSo the .green class gets extended into the 2 separate %green placeholders.\nExtends are not like mixins, so the properties aren't added to the class .green.\nInstead, the class .green gets added to the place where %green placeholder is defined.\nSo in your example:\nInput\n```\n/ a /\n%green { color: green; }\n/ b /\n%green { color: green; }\n/ c /\n.green { @extend %green; }\n/ d /\n```\nOutput\n```\n/ a /\n.green {\n  color: green; }\n/ b /\n.green {\n  color: green; }\n/ c /\n/ d /\n```\nThe above is the correct behavior for extends.\nExpected output\n```\n/ a /\n/ b /\n/ c /\n.green {\n  color: green; }\n/ d /\n```\nThe output above is wrong, this is kind of how mixins work.. Mixins and extends are 2 completely different beasts.\nMy advice would be to steer clear of extends if you don't see any clear benefits, it can be tricky to get your head around, and could easily create specificity 'bugs'.\nAnd actually modern zipping of css has actually made mixins preferable over extends the way compressing files works, you get a smaller file size using mixins (even though the css file using mixins will be a lot bigger, but it gets compressed better).. ",
    "ashleykolodziej": "@bskibinski I kid you not, it\u2019s literally my birthday today and you have no idea how excited I was to see someone finally reply to this, even if it\u2019s just to say I\u2019m not alone! Best unintended birthday present ever. \ud83c\udf82\ud83c\udf89 . ",
    "Guitarheroua": "Heh, as usually some unexpected issues pop up, and I  made another extension for qt stylesheets, connected with a special syntax of functions for gradients. (see commit). \nqlineargradient(x1:0, y1:0, x2:1, y2:1,\n                stop:0 white, stop: 0.4 gray, stop:1 green)\nNow it does not look so easy to integrate qss to SASS lib, and not to broke something :(. Opened issue in SASS(see issue #2549), close this one.. ",
    "bep": "I'm using Clang on MacOS and Linux and GCC on WIndows, and I'm getting the same warnings on all platforms. But I will investigate a little more.. @xzyfer could you tag a minor release with this fix in it?. ",
    "glatzert": "I have no idea how a localhost unc-path would look like and if it'll work on your testsystems or not.\nIn our case @import \\\\uncserver\\share\\style.sass is enough to make it fail (probably some escaping is done as well so \\\\\\\\uncserver\\\\share\\\\style.sass)\n. Can we do anything to help here?\nUNC path Imports are important for us, since we place variables like colors and such in a shared drive.\nIf someone could Point out where the issue Comes from, we can also find someone here to create a PR. ",
    "rshelnutt": "Just ran some updates on node.js & node-sass, getting similar (?) error when processing a scss on networked drive.  UNC path compile fails (\"File to import not found or unreadable:), local directory processes fine. Oddly enough, the scss is what's returned as the \"not found or unreadable\", but scss file is saved - only the css isn't processed.. ",
    "adamreisnz": "I happened to pick up on this issue, but it makes me worried what else might not be working correctly in the latest libsass versions. We use :not selectors and & references quite extensively.. Would be great to get some feedback on this from a collaborator.. @xzyfer Any update on this guys? This is a severe bug, why is it not being addressed?\nValid code that was working before is no longer working, forcing us to stay on v2.\nI've added steps to reproduce etc.. Awesome, thanks for fixing. @glebm What version of libsass did this fix end up in?. Do you have an estimate for when it might be released?\nWe are having issues installing our build tools on a windows computer because we're forced to use a lower version of node-sass which doesn't have this bug. Would be great if we could upgrade the whole stack.. ",
    "mbehzad": "i'm having the same issue.\n:not(.c1, .c2) \nor\n &:not(.c1)\n will work correctly. but \n&:not(.c1, .c2)\n will result to a rule with no :not in it.. ",
    "JoanBotella": "I have the same problem. I'm using the LibSass v3.5.4 .\nNote that you can still use the syntax :not(.foo):not(.bar) .. ",
    "ILyaCyclone": "Any plans for fixing this issue in release? We are stuck on \"gulp-sass\": \"^2.3.2\" (in which there's no such issue) and can't upgrade.. ",
    "stephanemagnenat": "Any news on progress on this issue? It is currently blocking the use of modern CSS media query level 4 in the webpack/sass-loader ecosystem.. ",
    "deivid-rodriguez": "Just run into this too. Is the build failure a real failure due to this PR?. That's good! :). ",
    "maki-markie": "Oh, sorry... is SassMiddleware not part of the libsass library?. ",
    "koppen": "Yes, that is correct. So sass2scss is a library libsass relies on? Should I report this upstream then?. ",
    "jamesarosen": "Adding an unused placeholder has no effect on output:\nscss\n// _placeholder.scss\n%green { color: green; }\n%purple { color: purple; }\n```css\n.green {\n  color: green; }\n.green {\n  color: green; }\n. Defining the placeholder twice and doing no imports has the same effect:scss\n// top.scss\n%green { color: green; }\n%green { color: green; }\n.green { @extend %green; }\ncss\n.green {\n  color: green; }\n.green {\n  color: green; }\n```\nThis is probably the smallest possible reproduction.. Adding some comments shows that the CSS is being emitted by the placeholder both times and never by the actual CSS rule.\nInput\nscss\n/* a */\n%green { color: green; }\n/* b */\n%green { color: green; }\n/* c */\n.green { @extend %green; }\n/* d */\nActual Output\n```css\n/ a /\n.green {\n  color: green; }\n/ b /\n.green {\n  color: green; }\n/ c /\n/ d /\n```\nExpected Output\ncss\n/* a */\n/* b */\n/* c */\n.green {\n  color: green; }\n/* d */. Adding a separate selector suggests that the problem lies in the \"common rule extraction\" logic.\nInput\nscss\n/* a */\n%green { color: green; }\n/* b */\n%green { color: green; }\n/* c */\n.green { @extend %green; }\n.greener { @extend %green; font-weight: bold; }\n/* d */\nActual Output\n```css\n/ a /\n.green, .greener {\n  color: green; }\n/ b /\n.green, .greener {\n  color: green; }\n/ c /\n.greener {\n  font-weight: bold; }\n/ d /\n```. > Can you confirm by trying with dart-sass?\nbash\n$ node_modules/.bin/sass --version\n1.13.0 compiled with dart2js 2.0.0\nscss\n// with-placeholders.scss\n/* a */\n%green { color: green; }\n/* b */\n%green { color: green; }\n/* c */\n.green { @extend %green; }\n.greener { @extend %green; font-weight: bold; }\n/* d */\n```css\n// $ node_modules/.bin/sass with-placeholders.scss\n/ a /\n.greener, .green {\n  color: green;\n}\n/ b /\n.greener, .green {\n  color: green;\n}\n/ c /\n.greener {\n  font-weight: bold;\n}\n/ d /\n```\n\nI think the behaviour is intended.\n\nFrom the sass-lang documentation:\n\nOn their own, without any use of @extend, rulesets that use placeholder selectors will not be rendered to CSS.\n\nThat's ambiguous and I can see how one interpretation might be\n\nplaceholder selectors render in-place when rulesets reference them\n\nBut I think it would be equally valid to assume they act like mixins:\nscss\n// with-mixins.scss\n/* a */\n@mixin green { color: green; }\n/* b */\n@mixin green { color: green; }\n/* c */\n.green { @include green; }\n.greener { @include green; font-weight: bold; }\n/* d */\n```css\n// $ node_modules/.bin/sass with-mixins.scss\n/ a /\n/ b /\n/ c /\n.green {\n  color: green;\n}\n.greener {\n  color: green;\n  font-weight: bold;\n}\n/ d /\n```. Fair enough, I guess. This just means I\u2019ll always use mixins instead of placeholders since I want to allow consumers to declare their dependencies as they see fit.. ",
    "halfnibble": "Sorry. Relate to node-sass only. Also, will be fixed by removing the deprecation warning according to: https://github.com/sass/node-sass/issues/2362. ",
    "sgbeal": "Certainly mkdir -p is more portable than simply failing to install on any platform at all?. Here's a portable solution, taken from the autotools manual:\nFrom the libsass checkout:\nautoreconf --install\n...\nconfigure.ac:15: installing 'script/install-sh'\n...\n[stephan@host:~/cvs/libsass]$ l ./script/install-sh\n-rwxr-xr-x 1 stephan stephan 15155 Nov 12 10:07 ./script/install-sh\nThat install script is as portable as it gets. (Simply throw away all of the autoreconf output aside from that file, then check that file in.)\nFunnily enough, it uses mkdir -p (which is apparently specified by POSIX mkdir), but it also works around various portability problems.\n. Apropos portability: the source code uses C++0x, which means it's compiling on a relatively recent platform (less than 10 years old). i'd bet my left testicle that all such platforms support mkdir -p.. What perceived limitation is not addressed by using the install script generated by autoconf (demonstrated 4 comments up from here)? This project uses the autotools, and is thereby limited in portability to platforms that toolset supports. Using autotool's install script is therefore the most natural and portable solution for all platforms the project can be built on using the provided makefiles.. @glebm what's a \"Windows\"?\nThe build uses the autotools and it \"really should\" use the install-sh which is distributed with autotools. If that installer is not portable enough then using the autotools is a lost cause.. @glebm my sincere apologies: 'what's a \"Windows\"' was intended facetiously (Windows hasn't been a thing in my household since last millennium), not as as an honest question, and that has no place in this forum.. @glebm if i knew how to use git/github properly, and could figure out how to pull this for a local test, i could probably tell you that :/. (i'm a Fossil SCM guy, not a git guy :/) i have no personal experience with order-only prerequisites, so i can't say with certainty whether it resolves the problem.. @glebm \n [stephan@host:~/cvs/libsass]$ git checkout patch-2\n error: pathspec 'patch-2' did not match any file(s) known to git.\n\nThat's after doing a fresh clone.. @glebm Unfortunately:\n$ git checkout origin/patch-2\nerror: pathspec 'origin/patch-2' did not match any file(s) known to git.\n$ git checkout origin patch-2\nerror: pathspec 'patch-2' did not match any file(s) known to git.\n@mgreter that does the trick.\nThis is exactly why i'm not a git guy - even the most banal operations are cryptic :/.\nSo, after building...\n[stephan@host:~/cvs/libsass]$ m install PREFIX=$HOME\n'lib/libsass.a' -> '/home/stephan/lib/libsass.a'\n(noting that ~/lib existed beforehand)\nSuccess!. ",
    "Hint-ru": "Sorry, inaccurate bug report. It looks like problem in comments, which are copied as is (with original linefeed). But the final linefeed in the end of the file is valid (parameter dependent).. ",
    "shamilovtim": "For reference: https://github.com/sass/libsass-python/issues/276. ",
    "zyingp": "Assigned CVE-2018-19797. The original file has no problem and only a simple extra symbol like  '/'  or '&' crashes the sassc program. I guess that sometime such extra symbol may introduced in by typos.  I am not sure whether there could be some governors in libsass (like an upper bound on loop)? When we are writing code (C/C++/Java), we know the compilers will not crash on our typos or small errors. I am not sure whether sass file is some kind of \"code\", and sassc could show equivalent robustness.. Assigned CVE-2018-19827. ",
    "rasendubi": "Hey guys! I'm trying to fix the CVE-2018-19797 on NixOS. As far as I know, this PR is the only available patch and it does not apply to 3.5.5 release. (There were no src/fn_utils.cpp.)\nWould you like to backport the patch to 3.5.x? Releasing a new patch version would be even more awesome :slightly_smiling_face: . ",
    "rjoshi18": "@xzyfer Could you please tell, How this issue has fixed here?\nThanks . ",
    "Xiphoseer": "The minimal example CSS was tested with pysassc, but the same behavior appears on node-sass and http://libsass.ocbnet.ch/srcmap/.. ",
    "E4ck": "It can be reproduced, build libsass/saasc with ASan:\nCXX=afl-clang-fast++ CC=afl-clang-fast CFLAGS=\"-g -fsanitize=address \" CXXFLAGS=$CFLAGS make -C sassc -j4\nRun cat crash127.txt | ./sassc\nI think the previous UAF vulnerability was not fixed successfully on libsass 3.5.5.\nsass_context.cpp:77:39.  I have a mistake, I downloaded the code directly through git clone, I found that the default version of git is not 3.5.5, it is 3.5.2\nAfter revalidating under version 3.5.5, I get the code location of the crash: code\nASAN:\n=================================================================\n==3794==ERROR: AddressSanitizer: heap-use-after-free on address 0x606000000f80 at pc 0x0000005c6d0d bp 0x7ffda9ba17f0 sp 0x7ffda9ba17e8\nREAD of size 1 at 0x606000000f80 thread T0\n    #0 0x5c6d0c in Sass::handle_error(Sass_Context*) /home/eack/libsass/src/sass_context.cpp:75:28\n    #1 0x5baa36 in Sass::handle_errors(Sass_Context*) /home/eack/libsass/src/sass_context.cpp:207:18\n    #2 0x5baa36 in Sass::sass_parse_block(Sass_Compiler*) /home/eack/libsass/src/sass_context.cpp:253\n    #3 0x5baa36 in sass_compiler_parse /home/eack/libsass/src/sass_context.cpp:483\n    #4 0x5b85c2 in sass_compile_context(Sass_Context*, Sass::Context*) /home/eack/libsass/src/sass_context.cpp:371:7\n    #5 0x5b81ac in sass_compile_data_context /home/eack/libsass/src/sass_context.cpp:456:12\n    #6 0x5a7069 in compile_stdin /home/eack/sassc/sassc.c:138:5\n    #7 0x5a81ed in main /home/eack/sassc/sassc.c:375:18\n    #8 0x7fb58a6aa82f in __libc_start_main /build/glibc-Cl5G7W/glibc-2.23/csu/../csu/libc-start.c:291\n    #9 0x4aad88 in _start (/home/eack/sassc/bin/sassc+0x4aad88)\n\n0x606000000f80 is located 0 bytes inside of 55-byte region [0x606000000f80,0x606000000fb7)\nfreed by thread T0 here:\n    #0 0x56edf8 in __interceptor_cfree.localalias.0 /home/eack/llvm-install/llvm-6.0.1.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:76\n    #1 0x9d917e in Sass::Eval::operator()(Sass::Selector_Schema*) /home/eack/libsass/src/eval.cpp:1606:7\n    #2 0xa0e34e in Sass::Expand::operator()(Sass::Extension*) /home/eack/libsass/src/expand.cpp:656:16\n    #3 0xa1a762 in Sass::Expand::append_block(Sass::Block*) /home/eack/libsass/src/expand.cpp:811:32\n    #4 0x9e1870 in Sass::Expand::operator()(Sass::Block*) /home/eack/libsass/src/expand.cpp:72:11\n    #5 0x9e51a4 in Sass::Expand::operator()(Sass::Ruleset*) /home/eack/libsass/src/expand.cpp:144:27\n    #6 0xa1a762 in Sass::Expand::append_block(Sass::Block*) /home/eack/libsass/src/expand.cpp:811:32\n    #7 0x9e1870 in Sass::Expand::operator()(Sass::Block*) /home/eack/libsass/src/expand.cpp:72:11\n    #8 0x630b00 in Sass::Context::compile() /home/eack/libsass/src/context.cpp:670:12\n    #9 0x62eea2 in Sass::Data_Context::parse() /home/eack/libsass/src/context.cpp:639:12\n    #10 0x5b9926 in Sass::sass_parse_block(Sass_Compiler*) /home/eack/libsass/src/sass_context.cpp:234:31\n    #11 0x5b9926 in sass_compiler_parse /home/eack/libsass/src/sass_context.cpp:483\n    #12 0x5b85c2 in sass_compile_context(Sass_Context*, Sass::Context*) /home/eack/libsass/src/sass_context.cpp:371:7\n    #13 0x5a81ed in main /home/eack/sassc/sassc.c:375:18\n    #14 0x7fb58a6aa82f in __libc_start_main /build/glibc-Cl5G7W/glibc-2.23/csu/../csu/libc-start.c:291\n\npreviously allocated by thread T0 here:\n    #0 0x56efb8 in __interceptor_malloc /home/eack/llvm-install/llvm-6.0.1.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88\n    #1 0x5a9650 in sass_alloc_memory /home/eack/libsass/src/sass.cpp:35:17\n    #2 0x5a9650 in sass_copy_c_string /home/eack/libsass/src/sass.cpp:46\n    #3 0xa0e34e in Sass::Expand::operator()(Sass::Extension*) /home/eack/libsass/src/expand.cpp:656:16\n    #4 0xa1a762 in Sass::Expand::append_block(Sass::Block*) /home/eack/libsass/src/expand.cpp:811:32\n    #5 0x9e1870 in Sass::Expand::operator()(Sass::Block*) /home/eack/libsass/src/expand.cpp:72:11\n    #6 0x9e51a4 in Sass::Expand::operator()(Sass::Ruleset*) /home/eack/libsass/src/expand.cpp:144:27\n    #7 0xa1a762 in Sass::Expand::append_block(Sass::Block*) /home/eack/libsass/src/expand.cpp:811:32\n    #8 0x9e1870 in Sass::Expand::operator()(Sass::Block*) /home/eack/libsass/src/expand.cpp:72:11\n    #9 0x630b00 in Sass::Context::compile() /home/eack/libsass/src/context.cpp:670:12\n    #10 0x62eea2 in Sass::Data_Context::parse() /home/eack/libsass/src/context.cpp:639:12\n    #11 0x5b9926 in Sass::sass_parse_block(Sass_Compiler*) /home/eack/libsass/src/sass_context.cpp:234:31\n    #12 0x5b9926 in sass_compiler_parse /home/eack/libsass/src/sass_context.cpp:483\n    #13 0x5b85c2 in sass_compile_context(Sass_Context*, Sass::Context*) /home/eack/libsass/src/sass_context.cpp:371:7\n    #14 0x5a81ed in main /home/eack/sassc/sassc.c:375:18\n    #15 0x7fb58a6aa82f in __libc_start_main /build/glibc-Cl5G7W/glibc-2.23/csu/../csu/libc-start.c:291\n\nSUMMARY: AddressSanitizer: heap-use-after-free /home/eack/libsass/src/sass_context.cpp:75:28 in Sass::handle_error(Sass_Context*)\nShadow bytes around the buggy address:\n  0x0c0c7fff81a0: fd fd fd fa fa fa fa fa fd fd fd fd fd fd fd fa\n  0x0c0c7fff81b0: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa\n  0x0c0c7fff81c0: fd fd fd fd fd fd fd fa fa fa fa fa fd fd fd fd\n  0x0c0c7fff81d0: fd fd fd fa fa fa fa fa fd fd fd fd fd fd fd fa\n  0x0c0c7fff81e0: fa fa fa fa fd fd fd fd fd fd fd fa fa fa fa fa\n=>0x0c0c7fff81f0:[fd]fd fd fd fd fd fd fa fa fa fa fa fd fd fd fd\n  0x0c0c7fff8200: fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c0c7fff8210: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c0c7fff8220: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c0c7fff8230: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c0c7fff8240: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07 \n  Heap left redzone:       fa\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Container overflow:      fc\n  Array cookie:            ac\n  Intra object redzone:    bb\n  ASan internal:           fe\n  Left alloca redzone:     ca\n  Right alloca redzone:    cb\n==3794==ABORTING\n\n. ",
    "fgeek": "CVE-2019-6283 has been assigned for this vulnerability. CVE-2019-6286 has been assigned for this vulnerability. CVE-2019-6284 has been assigned for this vulnerability. ",
    "luiscla27": "I think i have a more standard solution, what do you all think about implementing log levels?? (like log4j, winston, etc). \nPlease tell me if you agree more on this :)  (so i'll modify this FR title). Thank you for answering all my concerns with this @xzyfer... btw, i've found the library with the problem so the fix is in progress for me :+1: \nAnd so... i guess everyone else use cases it'll have to wait until the library owners decide to fix their deprecated stuff (...)\nPlease remember that this warnings are not critically important to continue our work as developers... if they were like that, an error would be thrown instead of a warning. \n. ",
    "SnijderC": "If anyone comes across this that has the same issue, this is my current workaround:\nscss\n.row {\n  $width--col-1: 1fr;\n  $width--col-2: 6rem;\n  $width--col-3: 6rem;\n  $width--col-4: 10rem;\n  $row-height: 4rem;\n  grid-template-areas: \"col1 col2 col3 col4\";\n  grid-template-rows: $row-height;\n  grid-template-columns: $width--col-1 $width--col-2 $width--col-3 $width--col-4;\n}. ",
    "stanhu": "I've reproduced the problem with sassc as well:\n```\n$ bin/sassc /tmp/fail.txt\nError: 1fr/repeat isn't a valid CSS value.\n        on line 7049 of ../../../../tmp/fail.txt\n\n\ngrid: 1fr/repeat(2, 1fr); }\n\n\n--------^\n```\nAttached is the failing input.\nfail.txt\n. It looks like 1fr/repeat(2, 1fr) doesn't work, but 1fr / repeat(2, 1fr) does:\nSample input:\ncss\n.grid-layout2 {\n  grid: 1fr/repeat(2, 1fr);\n}. ",
    "thany": "If it really works as intended, then the intention is wrong \ud83d\ude03\nAgain, it works fine in Ruby Sass, and it also works fine for any regular property. It also works fine for properties that start with a single dash. Since CSS variables are gaining traction, they oughta be supported. It currently feels like CSS variables are somehow magically/arbitrarily exempted from the Sass parser.\nQuestion: what is the reasoning behind this behaviour?. That appears to be an issue about using native CSS variables syntax as if they were Sass variables. That would be a feature request that's very hard to implement.\nWhat I'm filing here, is an actual bug.\nLook, it works provably in Ruby Sass, and doesn't in LibSass.\nPlease explain your reasoning for not wanting this fix this bug?. So the \"bug\" is in Ruby Sass?. Alright.\nSo will this ever be fixed?\nAs much as it it intended behaviour, it is not desired behaviour.\nI can't really think of a reason why having --var: $var in your output css would be helpful in any way... I also still don't understand why Sass makes an arbitrary decision to ignore everything in a property that starts with -- but behaves as expected in a property that starts with only a single -.. ",
    "charliepark": "I think you want \"check out\" here.\nhttp://grammarist.com/spelling/checkout-check-out/\n. Feel free to edit as necessary: \"A list of of packages to install: mingw-developer-toolkit, mingw32-base, mingw32-gcc-ada, mingw32-gcc-fortran, mingw32-gcc-g++, mingw32-gcc-objc, msys-base.\"\n. Some extra spaces before the commas in this sentence.\n. extra commas here, too\n. I'm not sure the joke's strong enough to stand on its own, but if you keep this section, \"check out\" would be two words here as well.\n. Wrap make in backticks?\n. Viola => Voila\n. ",
    "Vagabond": "I would remove this, I added it by accident when tinkering.\n. ",
    "MoritzKn": "If i move the reference links to the end of the file, the link [Marcel Greater](@mgreter) still don't works. It only seems to work if i write it like this [@mgreter].\n. "
}