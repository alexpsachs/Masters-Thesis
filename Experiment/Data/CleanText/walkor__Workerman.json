{
    "walkor": "\u611f\u8c22\u4f60\u7684issue\uff0c\u4ee5\u4e0a\u5e76\u975e\u662fworkerman\u7684bug\u3002\n. \u5df2\u7ecfmerge\uff0c\u975e\u5e38\u611f\u8c22\n. thanks to upliu\n------------------ \u539f\u59cb\u90ae\u4ef6 ------------------\n\u53d1\u4ef6\u4eba: \"upliu\"notifications@github.com; \n\u53d1\u9001\u65f6\u95f4: 2014\u5e747\u670825\u65e5(\u661f\u671f\u4e94) \u51cc\u66680:47\n\u6536\u4ef6\u4eba: \"walkor/workerman\"workerman@noreply.github.com; \n\u4e3b\u9898: [workerman] \u4e00\u4e9b\u5c0f\u7ec6\u8282\u6539\u8fdb (#3)\nYou can merge this Pull Request by running\n   git pull https://github.com/upliu/workerman master \nOr view, comment on, or merge it at:\nhttps://github.com/walkor/workerman/pull/3\nCommit Summary\n\u4fee\u6539\u4e3a\u66f4\u52a0\u51c6\u786e\u7684\u63d0\u793a\u4fe1\u606f\nWindow -> Windows\n\u5220\u9664\u591a\u4f59\u7684\u672a\u4f7f\u7528\u7684\u53d8\u91cf\ncorrect typo\nMerge branch 'master' of https://github.com/upliu/workerman\nFile Changes\n```\n M     README.md     (2)   \nM     workerman/Core/Lib/Checker.php     (2)   \nM     workerman/Core/Master.php     (3) \n```\nPatch Links:\nhttps://github.com/walkor/workerman/pull/3.patch\nhttps://github.com/walkor/workerman/pull/3.diff\n\u2014\nReply to this email directly or view it on GitHub.\n. \u975e\u5e38\u611f\u8c22AnewG\n. thanks\n. ./workermand status need sysvshm and sysvmsg extension\n. \u6267\u884c\u4e24\u6b21force_kill\n\u6267\u884c\u7b2c\u4e00\u6b21\u7684\u65f6\u5019\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6740\u6b7b\u7684\u662f\u5b50\u8fdb\u7a0b\uff0c\u8fd9\u65f6\u4e3b\u8fdb\u7a0b\u8fd8\u6ca1\u6740\u6b7b\u7684\u8bdd\uff0c\u4e3b\u8fdb\u7a0b\u6709\u53ef\u80fd\u4f1a\u91cd\u542f\u542f\u52a8\u4e86\u65b0\u7684\u5b50\u8fdb\u7a0b\uff0c\u5bfc\u81f4\u8fdb\u7a0b\u6ca1\u6740\u5e72\u51c0\u3002\n\u6267\u884c\u7b2c\u4e8c\u6b21\u7684\u65f6\u5019\u4e3b\u8fdb\u7a0b\u5df2\u7ecf\u5728\u7b2c\u4e00\u6b21\u65f6\u6740\u6b7b\u4e86\uff0c\u6240\u4ee5\u7b2c\u4e8c\u6b21\u4f1a\u5f7b\u5e95\u6740\u6b7b\u6240\u6709\u5b50\u8fdb\u7a0b\u3002\n\u53ef\u4ee5\u7406\u89e3\u4e3a\u7b2c\u4e00\u6b21\u76ee\u7684\u662f\u6740\u6b7b\u4e3b\u8fdb\u7a0b\uff0c\u7b2c\u4e8c\u6b21\u6740\u6b7b\u6240\u6709\u5b50\u8fdb\u7a0b\u3002\n. posix_getpwuid \u5c5e\u4e8ePHP\u7684posix\u6269\u5c55\u7684\u4e00\u4e2a\u51fd\u6570\u3002\u770b\u4e0bPHP\u7684posix\u6269\u5c55\u662f\u5426\u5b89\u88c5\u4e86\u3002\nphp -m | grep posix\n\u6ca1\u88c5\u7684\u8bdd\u53ef\u4ee5\u5c1d\u8bd5yum -y install php-process\u53bb\u5b89\u88c5\n. \u6ca1\u6709\u4ec0\u4e48\u7279\u522b\u7684\u8bbe\u8ba1\u601d\u8def\uff0c\u4e3b\u8981\u662f\u60f3\u8ba9url\u53ea\u80fd\u8c03\u7528Modules\u547d\u540d\u7a7a\u95f4\u4e0b\u7684\u51fd\u6570\n. \u90a3\u4e2aDB\u7c7b\u6700\u4e3b\u8981\u7684\u662f\u8fd9\u4e2a\u6587\u4ef6\nhttps://github.com/walkor/workerman/blob/master/applications/Demo/Lib/DbConnection.php\n\u53ef\u4ee5\u62f7\u8d1d\u8fc7\u53bb\uff0c\u7136\u540e\u81ea\u5df1\u5b9e\u73b0\u4e2a\u6570\u636e\u5e93\u5355\u4f8b\u5c31\u597d\u4e86\u3002\n\u6216\u8005\u50cfDemo\u4e00\u6837\uff0c\u6309\u7167\u76ee\u5f55\u62f7\u8d1d\u8fc7\u6765\n\u5e94\u8be5\u53ea\u62f7\u8d1d\u4e0b\u9762\u7684\u6587\u4ef6\u5c31\u597d\u4e86\napplications/Demo/Lib/Autoloader.php\napplications/Demo/Lib/Db.php\napplications/Demo/Lib/DbConnection.php\napplications/Demo/Config/Db.php\n\u7136\u540erequire_once Lib/Autoloader.php;\n\u5c31\u53ef\u4ee5\u7528\u4e86\n. thanks a lot\n. \u8bf7\u4f7f\u75283.x\u7248\u672c\u5427\uff0c3.x\u7248\u672c\u5bf9hhvm\u652f\u6301\u7684\u66f4\u597d\u4e9b\n. \u8981\u5148\u83b7\u5f97\u67d0\u4e2a\u623f\u95f4\u7684\u6240\u6709client_id\uff0c\u8fd9\u4e2a\u5728workerman-chat\u4e2d\u662f\u5b58\u50a8\u5728memcache\u4e2d\u7684\uff0c\nkey\u4e3a $key = \"ROOM_CLIENT_LIST-$room_id\";\n\u7136\u540e\u53c2\u7167\u4e0b\u9762\u94fe\u63a5\u8c03\u7528\u63a5\u53e3\u53d1\u9001\uff0c\u6839\u636e\u4f60\u7684\u9700\u6c42\u60c5\u51b5\u53c2\u8003\u4e0b\u9762\u7684\u94fe\u63a5\n\u975eworkerman\u9879\u76ee\u5411\u7528\u6237\u63a8\u9001\u6570\u636e\nhttp://wenda.workerman.net/?/question/130\nworekrman\u5b9a\u65f6\u4efb\u52a1\uff0c\u5b9a\u65f6\u63a8\u9001\u6570\u636e\nhttp://wenda.workerman.net/?/question/72\n. thanks alot\n. thx \n. thanks \n. \u770b\u8d77\u6765\u662f\u8bfb\u5230\u7684\u6570\u636e\u4e0d\u662f\u4e2a\u6709\u6548\u7684\u6570\u7ec4\uff0c\u53ef\u80fd\u662f\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u7684\u95ee\u9898\u3002\n\u53e6\u5916get\u4ee3\u7801\u4e0d\u4e25\u8c28\uff0c\u83b7\u53d6\u7684\u6570\u636e\u4e00\u5f8b\u53cd\u5e8f\u5217\u5316\uff0c\u4f46\u662fset\u65f6\u6709\u65f6\u53c8\u4e0d\u5e8f\u5217\u5316\u3002\n\u8bf7\u81ea\u884creview && debug\u4e0b\u4ee3\u7801\u5427\n. https://github.com/walkor/workerman.net/blob/master/applications/Doc3.workerman.net/src/SUMMARY.md\nHere is the docs,but only chinese.\nYes, you can get the arguments for your script.\n. English document may be available after 2 months.\n. Yes\uff0c onConnect will be  triggered when new client come.\nonWorkerStart will be triggered when worker is made.\nonWorkerStop will be triggered when worker is down.\nAnd on{...} is allways called from worker process.\n. $connection is the instance of TcpConnection  and $worker is the instance of  Worker.\nWorker's callback and arguments  \nphp\nonWorkerStart($worker)    \nonWorkerStop($worker)\nonConnect($connection) \nonMessage($connection, $data)  \nonClose($connection)   \nonBufferFull($connection)  //Emitted when $connection\u2018s write buffer becomes full.  \nonBufferDrain($connection)  //Emitted when $connection\u2018s write buffer becomes empty.  \nonError($connection, $error_code, $error_msg)\nTcpConnection's Api and arguments\nphp\nsend($data)  // Send data.\ngetRemoteIp()\ngetRemotePort()\nclose()  //Close connection.\npauseRecv()  //Pauses the reading of data.   \nresumeRecv()   //Resumes reading.\n. If you  start workerman by command php start.php start, you can restart all workers by command php start.php restart or php start.php reload for gracefull restart.\nYou can also send SIGINT or SIGUSR1 signal to the main process, then all worker processes will be restart or reload. If you send SIGINT or SIGUSR1 signal to one worker process, then the worker process will be restart or reload.\nAny end  closed connection will emitted onClose.\n. It difficult to do that. \nWorkerman's reload is restart worker processe(s).When a process exit everything will be destroyed.\nMaybe Classkit is useful for what you want, but need a lot of codes to achieve it.\n. For example.\nYou can't reassign the original connnections to the new worker process, because the connections are closed when original  worker process stoped.\nMain process dose not hold connnections. Every worker processes hold connections for themselves.\n. English docs are available. English docs\n. fixed\n. Here is the link.\nhttps://packagist.org/packages/walkor/workerman\n. \u5728\u670d\u52a1\u5668\u4e0d\u65adPUSH\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5ba2\u6237\u7aef\u76f4\u63a5\u62d4\u6389\u7f51\u7ebf\u670d\u52a1\u5668\u4e0d\u80fd\u8bc6\u522b\u51fa\u5ba2\u6237\u7aef\u5df2\u7ecf\u65ad\u7f51\n\u5176\u5b9e\u8fd9\u91cc\u670d\u52a1\u7aef\u5df2\u7ecf\u53d1\u73b0\u5ba2\u6237\u7aef\u6ca1\u6709\u53d1\u5fc3\u8df3\u8d85\u8fc7\u4e86pingNotResponseLimit\u9650\u5236\uff0c\u5df2\u7ecf\u8c03\u7528\u4e86$connection->close();\uff0c\u4f46\u662f$connection->close();\u6709\u4e00\u4e2a\u673a\u5236\uff0c\u5982\u679c\u5f53\u524d\u94fe\u63a5$connection\u8fd8\u6709\u6570\u636e\u672a\u53d1\u9001\uff0c\u5219\u5fc5\u987b\u7b49\u5f85\u6570\u636e\u53d1\u9001\u5b8c\u6bd5\u624d\u771f\u6b63\u65ad\u5f00\uff0c\u624d\u4f1a\u51fa\u53d1onClose\u3002\u4f46\u662f\u7531\u4e8e\u5ba2\u6237\u7aef\u7f51\u7ebf\u88ab\u62d4\uff0c\u6240\u4ee5\u6570\u636e\u4e00\u76f4\u53d1\u9001\u8d85\u65f6\uff0cTCP\u5c42\u9762\u4f1a\u4e00\u76f4\u91cd\u8bd5\uff0c\u76f4\u5230\u4e00\u5b9a\u65f6\u95f4\uff08\u4f9d\u8d56\u7cfb\u7edf\u5185\u6838\u914d\u7f6e\uff0c\u4e00\u822c\u662f10\u5206\u949f\u4ee5\u4e0a\uff09TCP\u5c42\u9762\u624d\u4f1a\u65ad\u5f00\uff0c\u624d\u4f1a\u51fa\u53d1onClose\u3002\n\u8fd9\u4e2a\u95ee\u9898\u5c06\u4f1a\u5728\u672c\u5468\u5185\u4fee\u590d\uff0c\u8c22\u8c22\u53cd\u9988\u3002\n. fixed\n. thanks \uff1a \uff09\n. Which statistics?\nworkerman-statistics or the statistics of command php your_file.php status\n. Yes capture the status outputted is the most convenient way.\n. You can get the stats of current worker  from \n Workerman\\Connection\\ConnectionInterface::$statistics \nhttps://github.com/walkor/workerman/blob/master/Workerman/Connection/ConnectionInterface.php#L19\n.  No such interface, but capture status output is the best way to get status from all workers.\n. Thank you very much in support of the workerman \uff1a \uff09\n. thanks : \uff09\n. GatewayWorker\u5df2\u7ecf\u652f\u6301Redis\u5b58\u50a8\uff0c\u8bf7\u4f7f\u7528Redis\u5b58\u50a8\n\u53e6\u5916GatewayWorker\u4eceworkerman\u76ee\u5f55\u4e2d\u72ec\u7acb\u51fa\u6765\u4e86\uff0c\u653e\u5728https://github.com/walkor/GatewayWorker\n. thanks \n. thanks\n. ok\n. \u6709\u8ba1\u5212\u51faguide\u6587\u6863\uff0c\u4f1a\u653e\u5728\u4e3b\u9875\u663e\u773c\u4f4d\u7f6e\uff0c\u4e0d\u8fc7\u76ee\u524d\u8fd8\u6ca1\u6709\u786e\u5207\u6392\u671f\n. \u6700\u7ec8\u8d77\u4f5c\u7528\u7684\u6c38\u8fdc\u662fconnection\u4e0a\u7684onMessage\u56de\u8c03\uff0c\nconnection\u5efa\u7acb\u540eworker\u7684onMessage\u56de\u8c03\u4f1a\u8d4b\u503c\u7ed9connection\uff0c\u89c1\u6e90\u7801\nhttps://github.com/walkor/Workerman/blob/master/Worker.php acceptConnection\u65b9\u6cd5\u5b9e\u73b0\u90e8\u5206\n\u4e4b\u6240\u4ee5\u6709\u4e2aworker->onMessage\uff0c\u4e3b\u8981\u662f\u65b9\u4fbf\u4f7f\u7528\uff0c\u4f8b\u5982\u4e0b\u9762\u4ee3\u7801\nphp\nuse Workerman\\Worker;\nrequire_once './Workerman/Autoloader.php';\n$worker = new Worker('websocket://0.0.0.0:8484');\n// \u5f53\u6709\u5ba2\u6237\u7aef\u8fde\u63a5\u4e8b\u4ef6\u65f6\n$worker->onConnect = function($connection)\n{\n    // \u8bbe\u7f6e\u8fde\u63a5\u7684onMessage\u56de\u8c03\n    $connection->onMessage = function($connection, $data)\n    {\n        var_dump($data);\n        $connection->send('receive success');\n    };\n};\n// \u8fd0\u884cworker\nWorker::runAll();\n\u4e0e\nphp\nuse Workerman\\Worker;\n$worker = new Worker('websocket://0.0.0.0:8484');\n// \u76f4\u63a5\u8bbe\u7f6e\u6240\u6709\u8fde\u63a5\u7684onMessage\u56de\u8c03\n$worker->onMessage = function($connection, $data)\n{\n    var_dump($data);\n    $connection->send('receive success');\n};\n// \u8fd0\u884cworker\nWorker::runAll();\n\u6548\u679c\u76f8\u540c\uff0c\u4f46\u662f\u7b2c\u4e8c\u79cd\u5199\u6cd5\u66f4\u7b80\u6d01\u6613\u61c2\u3002\n\u6bcf\u4e2a\u8fde\u63a5\u90fd\u53ef\u4ee5\u62e5\u6709\u81ea\u5df1\u7684\u534f\u8bae\u53caonMessage/onClose/on{...}\u7b49\u5c5e\u6027\uff0c\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u6839\u636e\u9700\u8981\u91cd\u65b0\u8d4b\u503c\u7ed1\u5b9a\uff0c\u8fd9\u6837\u975e\u5e38\u7075\u6d3b\uff0c\u5c24\u5176\u5728AysncTcpConnection\u4e2d\u3002\n\u8fd9\u91cc\u6709\u4e00\u4e2a\u5178\u578b\u7684\u52a8\u6001\u8bbe\u7f6e\u8fde\u63a5\u7684on{...}\u56de\u8c03\u7684\u5e94\u7528\uff0chttps://github.com/walkor/shadowsocks-php \uff0c\n\u4e3b\u8981\u7684\u4e1a\u52a1\u4ee3\u7801\u89c1 https://github.com/walkor/shadowsocks-php/blob/master/Applications/Shadowsocks/start.php\n. You can redirect STDOUT into a file like this.\nSupport only in daemon mode  and command like php your_file.php start -d.\n``` php\nuse Workerman\\Worker;\nrequire_once './Workerman/Autoloader.php';\nWorker::$daemonize = true;\n// All output will be redirected to /tmp/stdout.log\nWorker::$stdoutFile = '/tmp/stdout.log';\n$worker = new Worker('Text://0.0.0.0:8484');\n$worker->on{...} = function(){...\n// Run all workers\nWorker::runAll();\n```\nMore informations see https://github.com/walkor/workerman-manual/blob/master/english/src/worker-development/stdout_file.md\n. You can also redirect STDOUT into a file like this.\nphp\nglobal $STDOUT, $STDERR;\n$stdfile = '/your/path/stdfile';\n@fclose(STDOUT);\n@fclose(STDERR);\n$STDOUT = fopen($stdfile,\"a\");\n$STDERR = fopen($stdfile,\"a\");\n. \u975e\u5e38\u611f\u8c22\u60a8\u7684\u5efa\u8bae\nWorkerman\u7684\u547d\u540d\u7a7a\u95f4\u53ca\u534f\u8bae\u89c4\u8303\n\u5f53\u8c03\u7528\nphp\nnew Worker('Scheme://...');\n\u9047\u5230\u672a\u77e5\u534f\u8baeScheme\uff08Workerman\\Protocols\\Scheme\u7c7b\u4e0d\u5b58\u5728\uff09\u65f6\uff0cWorkerman\u4f1a\u5c1d\u8bd5\u52a0\u8f7d\\Protocols\\Scheme\u7c7b\u3002\n\u6240\u4ee5\u81ea\u5b9a\u4e49\u534f\u8bae\u7c7b\u8981\u6c42\u672c\u5730\u9879\u76ee\u76ee\u5f55\uff08\u975eWorkerman\u76ee\u5f55\uff09\u65b0\u5efa\u4e00\u4e2aProtocols\u76ee\u5f55\uff0c\u91cc\u9762\u653e\u7f6e\u81ea\u5df1\u7684\u534f\u8bae\u7c7b\uff0c\u5e76\u4ee5Protocols\u4e3a\u547d\u540d\u7a7a\u95f4\u5373\u53ef\u3002\n\u4f8b\u5982\u4e0b\u9762\u7684\u76ee\u5f55\u7ed3\u6784\n\u251c\u2500\u2500 vendor\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Workerman // Workerman\u9879\u76ee\u76ee\u5f55\n\u2502\u00a0\u00a0\n\u2514\u2500\u2500 YourProject      // \u4e1a\u52a1\u9879\u76ee\u76ee\u5f55\n    \u251c\u2500\u2500 Protocols      // \u4e1a\u52a1\u9879\u76ee\u81ea\u5b9a\u4e49\u534f\u8bae\u76ee\u5f55\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 Scheme.php // \u4e1a\u52a1\u9879\u76ee\u81ea\u5b9a\u4e49\u534f\u8bae\u6587\u4ef6\n    \u2514\u2500\u2500 start.php            // \u4e1a\u52a1\u9879\u76ee\u7684\u542f\u52a8\u811a\u672c\n\u8fd9\u6837Workerman\u9879\u76ee\u548c\u4e1a\u52a1\u9879\u76ee\u76f8\u4e92\u72ec\u7acb\uff0c\u65b9\u4fbf\u7ef4\u62a4\u548c\u5347\u7ea7\u3002\n\u5f53\u4e0d\u7b26\u5408\u60a8\u9879\u76ee\u547d\u540d\u7a7a\u95f4\u89c4\u8303\u65f6\n\u5982\u679c\u60a8\u7684\u9879\u76ee\u65e0\u6cd5\u4f7f\u7528 Protocols\\Scheme \u8fd9\u6837\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u53ef\u4ee5\u901a\u8fc7class_alias\u51fd\u6570\u6765\u89e3\u51b3\n\u4f8b\u5982\uff1a\nclass_alias('\\YourNamespace\\Scheme', 'Protocols\\Scheme');\n\u6700\u540e\npr\u4e2d\u589e\u52a0\u4e86\u4e09\u4e2a\u63a5\u53e3\uff0c\naddSchema\ngetSchemaClass\ngetSchemaList\n\u52bf\u5fc5\u4f1a\u7ed9\u7528\u6237\u5e26\u6765\u4e00\u5b9a\u7684\u5b66\u4e60\u6210\u672c\uff0c\u800c\u5927\u90e8\u5206workerman\u7528\u6237\u7528\u4e0d\u5230\u8fd9\u4e09\u4e2a\u63a5\u53e3\uff0c\u6216\u8005\u53ef\u4ee5\u901a\u8fc7class_alias\u51fd\u6570\u6765\u89e3\u51b3\uff0c\u6240\u4ee5\u8fd9\u4e2apr\u4e0d\u51c6\u5907\u63a5\u53d7\uff0c\u8bf7\u89c1\u8c05\u3002\n\u5982\u679c\u60a8\u4e00\u5b9a\u8981\u8fd9\u4e09\u4e2a\u63a5\u53e3\uff0c\u5efa\u8bae\u5728\u60a8\u7684\u9879\u76ee\u4e2d\u5bf9Worker\u7c7b\u8fdb\u884c\u91cd\u8f7d\u3002\n\u6700\u540e\u975e\u5e38\u611f\u8c22\u60a8\u5bf9Workerman\u7684pr\u3002\n. \u4e0d\u60f3\u7ee7\u627fTcpConnection\u7684\u8bdd\uff0c\u90a3\u53ea\u80fd\u91cd\u5199\u4e86\n. \u8fd9\u4e9b\u90fd\u5c5e\u4e8e\u534f\u8bae\u5904\u7406\uff0c\u548cConnection\u7c7b\u6ca1\u6709\u5173\u7cfb\u3002workerman\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5904\u7406\u8fd9\u79cd\u60c5\u51b5\uff0c\u5177\u4f53\u53ef\u4ee5\u770b\u4e0b\u624b\u518c\u534f\u8bae\u90e8\u5206\u3002\n\u5b9e\u73b0\u65b9\u6cd5\u5982\u4e0b\uff1a\n\u76ee\u5f55\u7ed3\u6784\n\u251c\u2500\u2500 testProject //\u9879\u76ee\u76ee\u5f55\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Protocols // \u4e1a\u52a1\u534f\u8bae\u76ee\u5f55\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 YourWebsocket.php  // \u4e1a\u52a1\u5b9e\u73b0\u7684\u534f\u8bae\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 start.php // \u542f\u52a8\u6587\u4ef6\n\u2514\u2500\u2500 Workerman //workerman\u76ee\u5f55\nyourWebsocket.php\n``` php\n<?php\nnamespace Protocols;\nuse Workerman\\Protocols\\Websocket;\nuse Workerman\\Connection\\ConnectionInterface;\n// \u81ea\u5b9a\u4e49websocket\u534f\u8bae\u7c7b\nclass yourWebsocket extends Websocket\n{\n    /*\n     * \u534f\u8bae\u7f16\u7801\uff0c\u8c03\u7528send($data)\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u524d\u4f1a\u81ea\u52a8\u8c03\u7528\n     * yourWebsocket::encode($data, $connection)\n     /\n    public static function encode($data, ConnectionInterface $connection)\n    {\n         // \u52a0\u65f6\u95f4\u6233\uff0c$data \u662f\u6570\u7ec4\uff0c\u4e3asend($data) \u4e2d\u7684$data\n         $data['time'] = time();\n         // \u8f6c\u6362\u6210json\n         $data = json_encode($data);\n         // \u8c03\u7528\u7236\u7c7b\u7684encode\n         return parent::encode($data, $connection);\n    }\n/**\n  * \u89e3\u7801\uff0cworkerman\u6536\u5230\u5ba2\u6237\u7aef\u6570\u636e\u540e\u4f1a\u5148\u6267\u884cyourWebsocket::decode($buffer, $connection)\n  * \u8fd4\u56de\u503c\u4f1a\u4f20\u9012\u7ed9onMessage($data, $connection)\u4e2d\u7684$data\n  */\npublic static function decode($recv_buffer, ConnectionInterface $connection)\n{\n    // \u4ecewebsocket\u6570\u636e\u4e2d\u5f97\u5230\u539f\u59cb\u7684\u6570\u636e\n    $data = parent::decode($recv_buffer, $connection);\n    // json \u89e3\u7801\u539f\u59cb\u6570\u636e\n    $data = json_decode($data, true);\n    // \u8fd4\u56de\n    return $data;\n}\n\n}\n```\n\u521d\u59cb\u5316\u65f6\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86\nstart.php\n``` php\n<?php\nuse Workerman\\Worker;\nrequire_once '../Workerman/Autoloader.php';\n$ws_worker = new Worker(\"YourWebsocket://0.0.0.0:2346\");\n$ws_worker->onMessage = function($connection, $data)\n{\n    var_dump($data);\n    $response_data = array(1,2,3);\n    $connection->send($response_data);\n};\nWorker::runAll();\n```\n\u8fd9\u6837\u5c31\u4e0d\u7528\u6bcf\u6b21\u5728onMessage\u4e2d\u624b\u52a8json_decode\u4e86\uff0csend\u65f6\u4e5f\u4f1a\u81ea\u52a8json_encode\u5e76\u81ea\u52a8\u52a0\u4e0a\u65f6\u95f4\u6233\n\u4ee5\u4e0a\u4ee3\u7801\u672c\u5730\u6d4b\u8bd5ok\n. workerman\u81ea\u8eab\u6ca1\u6709\u8def\u7531\u3002\n\u8def\u7531\u5c5e\u4e8e\u4e1a\u52a1\u6846\u67b6\u90e8\u5206\uff0cworkerman\u81ea\u8eab\u4e0d\u6d89\u53ca\u4efb\u4f55\u4e1a\u52a1\u903b\u8f91\uff0cworkerman\u53ea\u4e13\u6ce8\u4e8esocket\u901a\u8baf\uff0c\u4e0d\u5173\u6ce8\u4f20\u8f93\u7684\u662f\u4ec0\u4e48\u5185\u5bb9\uff0cworkerman\u4f20\u8f93\u7684\u6570\u636e\u53ef\u80fd\u662f\u5305\u542b\u4e1a\u52a1\u903b\u8f91\u7684\u6570\u636e\u5305\uff0c\u4e5f\u53ef\u80fd\u662f\u65e0\u4efb\u4f55\u903b\u8f91\u7684\u89c6\u9891\u6d41\uff0c\u6216\u8005\u662f\u5176\u5b83\u6570\u636e\n\u5982\u4f55\u5b9e\u73b0\u8def\u7531\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u4e1a\u52a1\u60c5\u51b5\u800c\u5b9a\uff0c\u4e1a\u52a1\u4e0d\u540c\u8def\u7531\u5b9e\u73b0\u53ef\u80fd\u4e0d\u540c\uff0c\u8fd9\u91cc\u6ca1\u6709\u7edf\u4e00\u7684\u65b9\u6848\n. \u4e0d\u597d\u610f\u601d\uff0c\u6211\u8fd9\u91cc\u6ca1\u6709\n. thanks\n. \u53ef\u4ee5\n.  \n\u6ca1\u770b\u51fa\u53c2\u6570\u54ea\u91cc\u9519\u4e86\n. \u53d1\u4e2apullrequest\u5427\uff0c\u770b\u4e0d\u61c2\u4f60\u5728\u8bf4\u4ec0\u4e48\u3002 \u5b9a\u4e49\u65b9\u6cd5\uff1f\u5c01\u5305\u5931\u8d25\uff1f\u56e0\u4e3a\u5b9a\u4e49\u7684\u65b9\u6cd5\u5bfc\u81f4\u5c01\u5305\u5931\u8d25\uff1f\nset_error_handler \u6846\u67b6\u81ea\u8eab\u7528\u4e0d\u5230\u8fd9\u4e2a\uff0c\u6ca1\u6709\u5fc5\u8981\u5b9a\u4e49\u3002\u5e76\u4e14\u5b9a\u4e49\u4e86\u53ef\u80fd\u4f1a\u5f71\u54cd\u4e1a\u52a1\uff0c\u56e0\u4e3a\u4e1a\u52a1\u5f88\u53ef\u80fd\u4f1a\u5b9a\u4e49\u81ea\u5df1\u7684set_error_handler \u3002\u5982\u679c\u4e1a\u52a1\u9700\u8981\u5b83\u53ef\u4ee5\u5b8c\u5168\u81ea\u5df1\u5b9a\u4e49\u3002\n. @devypt \nYes, we need your help.\nIf you can help us we will be very grateful !\n: )\n. \u5e94\u8be5\u662fpid\u6587\u4ef6\u88ab\u5220\u9664\u4e86\uff0c\u5bfc\u81f4\u627e\u4e0d\u5230\u4e3b\u8fdb\u7a0b\uff0c\u65e0\u6cd5\u53d1\u9001status\u4fe1\u53f7\uff0c\u6240\u4ee5status\u770b\u4e0d\u5230\u3002\n\u53ef\u4ee5\u53c2\u8003\u624b\u518c\nhttp://doc3.workerman.net/worker-development/pid_file.html\n\u628apid\u6587\u4ef6\u653e\u5230\u5b89\u5168\u7684\u5730\u65b9\n. I think your approach is good enough.\nI think for some time and no better way to come up with.\n. Thanks\n. \u8fd9\u4e2a\u6587\u4ef6\u662f\u8fd0\u884cstatus\u547d\u4ee4\u540e\u52a8\u6001\u751f\u6210\u7684\u3002\u6ca1\u751f\u6210\u7684\u539f\u56e0\u4e00\u822c\u662fdebug\u6a21\u5f0f\u8fd0\u884c\u65f6\u6309\u4e86ctrl z\u5f3a\u5236\u6302\u8d77\u4e86\u4e3b\u8fdb\u7a0b\uff0c\u5bfc\u81f4\u4e3b\u8fdb\u7a0b\u4e0d\u54cd\u5e94\u4efb\u4f55\u547d\u4ee4\u3002\u8bf7\u4e0d\u8981\u6302\u8d77\u4e3b\u8fdb\u7a0b\n. brew \u5b89\u88c5\u7684PHP5.30\uff1fmac \u7684\u8fd9\u4e2a\u7248\u672c\u4fe1\u53f7\u63a7\u5236\u51fd\u6570\u6709bug\uff0c\u4e0d\u8981\u7528\u8fd9\u4e2a\u7248\u672c\u3002\u6362\u4e2a\u7248\u672c\u5c31\u597d\u4e86\n. \u9047\u5230\u4ec0\u4e48\u95ee\u9898\uff1f\u8bf7\u8be6\u7ec6\u63cf\u8ff0\u3002\n\u987a\u4fbf\u8d34\u4e0a\u64cd\u4f5c\u7cfb\u7edf\uff0cPHP\u7248\u672c\u548cworkerman\u7248\u672c\u3002\n. fixed\n. redis\u6269\u5c55\u5355\u4f8b\u957f\u8fde\u63a5\u4e0d\u592a\u7a33\u5b9a\uff0c\u6539\u6210\u77ed\u8fde\u63a5\u5c31\u597d\u4e86\u3002\u65b9\u6cd5\u662f\u6bcf\u6b21instance\u7684\u65f6\u5019\u91cd\u65b0new \u4e2a Redis\u5b9e\u4f8b\u3002\n\u6216\u8005\u5347\u7ea7\u4e0bGatewayWorker\uff0c\u76ee\u524dGatewayWorker2.0\u5df2\u7ecf\u53bb\u6389\u4e86redis\u7684\u4f9d\u8d56\uff0c\u4e5f\u4e0d\u4f1a\u6709\u8fd9\u4e2a\u95ee\u9898\u3002\nGatewayWorker2.0 \u4e0eGatewayWorker1.0\u533a\u522b\u89c1\u624b\u518c\nhttp://workerman.net/gatewaydoc/appendices/upgrade.html\n. \u56e0\u4e3a\u4f60\u7684\u7ec8\u7aef\u53d1\u8d77\u4e86\u4e24\u4e2a\u8fde\u63a5\u5bfc\u81f4\u7684\n. workerman\u662f\u4e2a\u901a\u7528\u7684\u670d\u52a1\u7aefsocket\u6846\u67b6\uff0c\u6ca1\u6709\u4efb\u4f55\u4e1a\u52a1\u903b\u8f91\uff0c\u5f53\u7136\u4e5f\u4e0d\u5305\u542bp2p\u7684\u4e1a\u52a1\u3002\n\u5982\u679c\u4f60\u5bf9p2p\u5f88\u719f\u6089\uff0c\u53ef\u4ee5\u7528workerman\u8fc5\u901f\u5199\u51fa\u4e2ap2p\u670d\u52a1\u7aef\u51fa\u6765\uff0c\u670d\u52a1\u7aef\u4f5c\u7528\u5c31\u662f\u6253\u4e2a\u6d1e\u800c\u5df2\uff0c\u5e76\u4e0d\u590d\u6742\u3002\n. Sorry. There is no plan at present.\n: - (\n. https://gitter.im is ok. \nI've joined Atriedes  and joostshao in the chat.\n. Thank you for your post @Arul- . \nBut I want to make workerman as simple as possible. I think it's a better choice to build a new PSR7 project and use composer to install it.. Thanks for your pull request.\nI had fixed #47 issue.\nSorry for my delay.\n. There are two monitoring services available which can monitor files change and then send reload signal to master process of workerman. \nhttps://github.com/walkor/workerman-filemonitor/blob/master/Applications/FileMonitor/start.php\nThis is a file monitoring service for workerman.\nhttps://github.com/walkor/workerman-filemonitor-inotify/blob/master/Applications/FileMonitor/start.php\nThis is a file monitoring service too which need inotify extension.\nChoose one of them for installation.\n. It is very easy.\nRequire the start.php in your script and change $monitor_dir to the catalogue of your project.\n. You are welcome.\n. Thanks a lot\n. \u5df2\u7ecf\u4fee\u590d\uff0c\u91cd\u65b0\u66f4\u65b0\u518d\u8bd5\u4e0b\n. \u5728master\u4e3b\u5206\u652f\u4e0a\uff0c\u6d4b\u8bd5\u6ca1\u95ee\u9898\u624d\u653e\u5230release.\n. \u5728\u4e3b\u8fdb\u7a0b\u4e2d\u521b\u5efa\u7684\u8d44\u6e90\u5b50\u8fdb\u7a0b\u9ed8\u8ba4\u7ee7\u627f\u5171\u4eab\u3002\u53e6\u5916\u901a\u8fc7unix socket\u914d\u5408socket_sendmsg\u4e5f\u80fd\u5b9e\u73b0\u8fdb\u7a0b\u95f4resource\u63cf\u8ff0\u7b26\u4f20\u9012\u5171\u4eab\u3002\n\u4f46\u662f\u6709\u4e9b\u8d44\u6e90\u5171\u4eab\u4f1a\u6709\u95ee\u9898\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u8fde\u63a5\uff0cmysql\u670d\u52a1\u7aef\u8fd4\u56de\u6570\u636e\u7406\u8bba\u4e0a\u5176\u5b83\u5171\u4eab\u7684\u8fdb\u7a0b\u4e0a\u4e5f\u6709\u80fd\u8bfb\u5230\uff0c\u5bfc\u81f4mysql\u8fde\u63a5\u5f02\u5e38\u3002\n\u5c3d\u91cf\u4e0d\u8981\u8d44\u6e90\u5171\u4eab\uff0c\u6700\u597d\u662f\u6bcf\u4e2aworker\u8fdb\u7a0b\u81ea\u5df1\u521b\u5efa\u72ec\u4eab\u3002\n. 139\u662f\u8fdb\u7a0b\u6536\u5230SIGSEGV\u4fe1\u53f7\u63a8\u51fa\u4e86\uff0c\u5e94\u8be5\u662fLibevnet\u6269\u5c55coredump\u4e86\u3002\nPHP7\u7684Libevent\u6269\u5c55\u8fd8\u6ca1stable\uff0c\u7b49\u7b49\u518d\u7528\u5427\u3002\n\u6216\u8005\u7528ev\u6269\u5c55\u8bd5\u4e0b\uff08\u6ce8\u610fphp7\u7248\u672c\u7684ev\u4e5f\u6ca1stable\uff09\n. PHP7 \u76ee\u524d\u8fd8\u6682\u65f6\u7528\u4e0d\u4e86libevent\u3002\u5c0f\u4e8ePHP7\u7684\u7248\u672c\u53ef\u4ee5\u7528\n. \u611f\u8c22 @joelhy \u7684\u5efa\u8bae\nworkerman\u5df2\u7ecf\u652f\u6301\u4e86ev\u6269\u5c55\u3002\nEvent \u6269\u5c55\u4e5f\u4f1a\u652f\u6301\uff0c\u5177\u4f53\u65f6\u95f4\u8fd8\u6ca1\u5b9a\u3002\nGatewayWorker\u6846\u67b6\u5df2\u7ecf\u652f\u6301\u81ea\u5b9a\u4e49Event.php\u7684\u7c7b\u540d\uff0c\u53ef\u4ee5\u907f\u514d\u51b2\u7a81\uff0c\u4f46\u662f\u9ed8\u8ba4\u7c7b\u540d\u4ecd\u7136\u662fEvent\uff0c\u5982\u679c\u8981\u652f\u6301Event\u6269\u5c55\uff0c\u8fd8\u662f\u8981\u517c\u5bb9\u4e0b\u3002\n. \u975e\u5e38\u975e\u5e38\u611f\u8c22\n. \u8f9b\u82e6\u4e86\uff0c\u8c22\u8c22\n. \u53ef\u4ee5\uff0c\u53c2\u8003\u624b\u518cAsyncTcpConnection\u90e8\u5206\u3002\n. tcp\u591a\u6b21\u63a5\u6536\u662f\u6b63\u5e38\u73b0\u8c61\uff0c@dalarge \u9700\u8981\u6309\u7167\u624b\u518c\u534f\u8bae\u90e8\u5206\u5b9a\u4e49\u4e2a\u534f\u8bae\u53bb\u63a5\u6536\uff0c\u5c31\u4e0d\u4f1a\u51fa\u73b0json\u683c\u5f0f\u9519\u8bef\u73b0\u8c61\u3002\n. Thank you so much.\n. \u82f1\u6587\u592a\u5dee\u4e86 : (\n. 1\u3001229 \u884cself::sessionWriteClose();\u662f\u7528\u6765\u4fdd\u5b58session\u7684\uff0c\u53bb\u6389\u540e\u5c31\u4fdd\u5b58\u4e0d\u4e86session\u4e86\n2\u3001\u76ee\u524d\u6682\u65f6\u4e0d\u652f\u6301session_save_path\u7684redis\uff0cmemcache\u7c7b\u578b\u3002\nhttp\u534f\u8bae\u7684\u5e94\u7528\u4e0d\u662fworkerman\u7684\u76ee\u6807\uff0c\u8ba9PHPer\u6446\u8131PHP\u53ea\u80fd\u7528\u4e8eWeb\u5f00\u53d1\u7684\u675f\u7f1a\u624d\u662fworkerman\u7684\u4e3b\u8981\u76ee\u6807\u3002\u76ee\u524d\u4e0d\u4f1a\u82b1\u8d39\u592a\u591a\u65f6\u95f4\u53bb\u5b8c\u5584http\u534f\u8bae\u53cawebserver\u3002\n\u5982\u679c\u60f3\u5f00\u53d1http\u534f\u8bae\u7684\u5e94\u7528\uff0cnginx\u914d\u5408fpm\u662f\u975e\u5e38\u597d\u7684\u9009\u62e9\uff0c\u5404\u79cdmvc\u6846\u67b6\u5df2\u7ecf\u975e\u5e38\u6210\u719f\u4e86\uff0c\u5f00\u53d1\u3001\u8c03\u8bd5\u3001\u90e8\u7f72\u3001\u8fd0\u7ef4\u3001\u7ef4\u62a4\u90fd\u975e\u5e38\u7b80\u5355\u3002\n. sessionWriteClose \u91cc\u9762\u6709\u5224\u65ad\u662f\u5426\u8c03\u7528\u4e86sessionStart\uff0c\u6ca1\u6709\u7684\u8bdd\u5c31\u76f4\u63a5\u8fd4\u56de\u4e86\n. Fixed. Thanks.\n. require_once\u6027\u80fd\u5f88\u5dee\u662f\u4e2a\u9519\u8bef\u7684\u7406\u8bba\u3002\n\u5373\u4f7f\u7528\u4e86namespace\uff0c\u4ee3\u7801\u52a0\u8f7d\u4e5f\u662f\u901a\u8fc7require\\include\\require_once\\include_once\u52a0\u8f7d\u7684\uff0c\u6ca1\u6709\u591a\u5c11\u533a\u522b\u3002\n\u53e6\u5916workerman\u4ee3\u7801\u53ea\u4f1a\u5728\u542f\u52a8\u65f6\u52a0\u8f7d\uff0c\u4ee5\u540e\u5c31\u957f\u9a7b\u5185\u5b58\u4e86\uff0c\u4e0d\u4f1a\u91cd\u590d\u8fd0\u884crequire_once\uff0c\u6ca1\u6709\u4efb\u4f55\u6027\u80fd\u5f71\u54cd\u3002\n. \u8d34\u4ee3\u7801\n. php\nrequire_once 'conf/config.php';\n$worker = new Worker();\n//\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u6570\u76ee($markets\u662fconfig\u91cc\u9762\u7684\u6570\u7ec4)\n$worker->count = count($markets);\n$worker->onWorkerStart = function ($worker) {\n    global $markets;\n    Timer::add(0.5, 'taskGenerator', array('worker' => $worker, 'markets' => $markets));\n};\n\u5982jackyxie\u6240\u8bf4\uff0c\u52a0\u4e2aglobal\u5c31\u884c\u4e86\u3002\n\u89c1php\u624b\u518c\uff1ahttp://php.net/manual/zh/language.variables.scope.php\n. php\n $runtims++;\n\u4f60\u5355\u8bcd\u62fc\u5199\u9519\u4e86\n. \u4f60\u53ef\u4ee5\u8bd5\u4e0b http://doc3.workerman.net/worker-development/stop-all.html \u6587\u6863\u4e2d\u7684\u793a\u4f8b\uff0c\u770b\u4e0b\u662f\u5426\u6b63\u5e38\u3002\n\u5982\u679c\u6b63\u5e38\uff0c\u8bf7\u68c0\u67e5\u4e0b\u81ea\u5df1\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u6253\u5370\u4e0b\u65e5\u5fd7\uff0c\u770b\u4e0b\u662f\u5426\u6267\u884c\u5230\u4e86Worker:stopAll();\n\u4f60\u8d34\u7684\u4ee3\u7801\u6709\u8bed\u6cd5\u9519\u8bef\uff0c\u6700\u597d\u81ea\u5df1\u8bd5\u4e0b\u4ee3\u7801\u6b63\u786e\u6027\u518d\u8d34\u4e0a\u6765\uff0c\u8fd9\u6837\u5927\u5bb6\u90fd\u8282\u7701\u65f6\u95f4\u3002\n. Thanks\n. \u6ca1\u6709\u7279\u522b\u7684\u542b\u4e49\u3002\u6ca1\u7528\u5230\u7684\u53c2\u6570\u53ef\u4ee5\u53bb\u6389\u3002\n. \u4f60\u53d1\u7684pr\u662f\u9519\u7684\uff0c\u5df2\u7ecf\u5173\u95ed\u3002\n\u8fd9\u91cc\u6ca1\u5fc5\u8981\u975e\u8981\u628a\u53c2\u6570\u53bb\u6389\uff0c\u56de\u8c03\u51fd\u6570\u672c\u6765\u5c31\u4f20\u9012\u4e86\u8fd9\u4e9b\u53c2\u6570\uff0c\u7528\u6ca1\u7528\u5230\u90fd\u4f20\u9012\u4e86\u3002\n. \u4f60\u7684\u4ee3\u7801\u662f\u9519\u7684\u3002\n\u53e6\u5916\u8fd9\u91cc\u4fdd\u7559\u53c2\u6570\u6ca1\u6709\u95ee\u9898\uff0c\u4e0d\u7528\u53d1pr\u4e86\u3002\n. stdin.php\n``` php\n<?php\nrequire_once /your/path/Workerman/Autoloader.php';\nuse Workerman\\Worker;\nuse Workerman\\Connection\\TcpConnection;\n$worker = new Worker();\n$worker->onWorkerStart = function($worker)\n{\n    $con = new TcpConnection(STDIN);\n    $con->onMessage = function($con, $msg){\n        echo \"recv form stdin: $msg\";\n    };\n};\nWorker::runAll();\n```\nRun with command php stdin.php start and type some words you will see the result.\nIt looks strange but works.\n. Who write pipes?\n. Here is an example for STDOUT of htop pipe to $con->onMessage. May be will help.\n``` php\n<?php\nrequire_once  '/your/path/Workerman/Autoloader.php';\nuse Workerman\\Worker;\nuse Workerman\\Connection\\TcpConnection;\n$worker = new Worker();\n$worker->onWorkerStart = function($worker) {\n    $con = new TcpConnection(popen('htop', 'r'));\n    $con->onMessage = function($con, $data) {\n        echo \"recv from pipe: $data\";\n    };\n};\nWorker::runAll();\n``\n. Thanks.\n. \u8fd9\u4e2a\u95ee\u9898\u662f\u5df2\u77e5\u7684\uff0c\u628aworkerman\u4f5c\u4e3awebsocket\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u8fd9\u4e00\u4fa7\u5fc5\u987b\u53d1\u9001\u6570\u636e\uff0c\u624d\u80fd\u89e6\u53d1websocket\u63e1\u624b\uff0c\u624d\u80fd\u5efa\u7acb\u8d77\u94fe\u63a5\u3002\n@leconsc \u53ef\u4ee5\u5148\u8fd9\u4e48\u7528\u7740\uff0c\u8fd9\u4e2a\u95ee\u9898\u540e\u9762\u4f18\u5316\n. Workerman\u4e3b\u5206\u652f\u5df2\u7ecf\u4f18\u5316\u89e3\u51b3\n. \u4e0d\u5ba2\u6c14\n. wss\u53ea\u9700\u8981\u7528nginx\u5728ws\u524d\u505a\u4e00\u5c42ssl\u4ee3\u7406\u5373\u53ef\n. \u4e0d\u662f\u5728client\u7aef\u8fd0\u884cnginx\uff0c\u5728\u670d\u52a1\u7aef\uff0c\u9664\u4e86\u8fde\u63a5\u65f6\u7528wss\u5ba2\u6237\u7aef\u4e0d\u7528\u4efb\u4f55\u64cd\u4f5c\u3002\nnginx\u5f00\u4e2a\u7aef\u53e3\u4ee3\u7406ssl\uff0cwss\u7ecf\u8fc7\u8fd9\u4e2anginx\u4ee3\u7406\u540e\u6570\u636e\u5c31\u662fws\u7684\u6570\u636e\u4e86\uff0cnginx\u628a\u8fd9\u4e2a\u6570\u636e\u8f6c\u53d1\u7ed9workerman\u3002\n. \u54e6\uff0c\u62b1\u6b49\u3002\u6211\u7406\u89e3\u9519\u4e86\uff0c\u4ee5\u4e3a\u4f60\u8981workerman\u4f5c\u4e3awss\u670d\u52a1\u7aef\u3002\nworkerman\u4f5c\u4e3awss\u5ba2\u6237\u7aef\uff0c\u4ee3\u7801\u7c7b\u4f3c\u5982\u4e0b\uff0c\u5c31\u662f\u52a0\u4e00\u53e5$con->transport = 'ssl';`\nphp\n$con = new AsycnTcpConnection('ws://x.x.x.x:xx');\n$con->transport = 'ssl';\n$con->onXXX(.....\n\u89c1\u624b\u518c http://doc3.workerman.net/worker-development/async-tcp-connection-transport.html\n\u8981\u6c42workerman\u7248\u672c>=3.3.3\n. \u4e0d\u5ba2\u6c14\n. Segmentation fault: 11\n\u8bf4\u660e\u67d0\u4e2a\u6269\u5c55\u6709bug\uff0c\u4f60\u770b\u4e0b\u662f\u4e0d\u662f\u7528\u4e86\u4ec0\u4e48\u7279\u6b8a\u7684\u6269\u5c55\uff0c\u53ef\u4ee5\u628a\u4e0d\u8981\u7684\u6269\u5c55\u90fd\u5378\u8f7d\u6389\u3002\n\u4e3b\u8fdb\u7a0b\u56e0\u4e3acoredump\u9000\u51fa\u4e86\uff0c\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4killall php\u6740\u6389\u6240\u6709php\u8fdb\u7a0b\n. \u4f60\u770b\u770b\u4f60\u7684livevent\u6269\u5c55\u7248\u672c\u662f\u4e0d\u662f\u592a\u4f4e\u4e86\u3002\n. \u53ef\u4ee5\u628alibevent\u6269\u5c55\u5378\u8f7d\u6389\u770b\u770b\u662f\u4e0d\u662flibevent\u6269\u5c55\u95ee\u9898\uff0c\u53e6\u5916libevent\u6269\u5c55\u5b98\u65b9\u6700\u65b0\u7248\u672c\u662f0.1.0\u3002\nhttp://pecl.php.net/package/libevent\n. \u90a3\u53ef\u80fd\u662fphp\u7684bug\uff0c\u6362\u4e2aphp\u7248\u672c\u8bd5\u4e0b\u5427\n. Epoll\u548c\u540c\u6b65/\u5f02\u6b65\u6ca1\u76f4\u63a5\u5173\u7cfb\uff0c\u963b\u585e\u8fd8\u662f\u975e\u963b\u585e\u770b\u5b9e\u9645\u8c03\u7528\u53c2\u6570\u3002\n\u53e6\u5916\u8fd9\u4e2a\u4e0d\u9002\u5408\u653e\u5728workerman\u7684issue\u4e2d\u3002\n. \u7528\u5f15\u7528\u7684\u65b9\u5f0f\u5c06$timer_id\u4f20\u9012\u5c31\u53bb\u5373\u53ef\nphp\n$timer_id = Timer::add(10, function()use(&$timer_id){\n    Timer::del($timer_id);\n});\n. Thanks.\n. \u7528\u4e2a\u5168\u5c40\u6570\u7ec4\u505a\u4e00\u4e2a\u6620\u5c04\u5c31\u597d\u4e86\n. Yes, you can.\nExample.\n``` php\nuse Workerman\\Worker;\nrequire_once './Workerman/Autoloader.php';\n$worker = new Worker('text://0.0.0.0:2015');\n$worker->onWorkerStart = function($worker)\n{\n    $inner_worker = new Worker('udp://0.0.0.0:2016');\n    $inner_worker->onMessage = 'on_message';\n    $inner_worker->listen();\n};\n$worker->onMessage = 'on_message';\nfunction on_message($connection, $data)\n{\n    $connection->send(\"hello\\n\");\n}\nWorker::runAll();\n```\n. \u50cf @taozywu \u8bf4\u7684\uff0c\u5bf9workerman\u6ca1\u5f71\u54cd\uff0c\u5982\u679c\u9009\u62e9yes\uff0c\u9700\u8981\u5b89\u88c5\u4e0bOpenSSL\u5e93\uff0c\u6709\u4e9b\u7528\u6237\u4e0d\u4f1a\u5b89\u88c5\u3002\u4e3a\u4e86\u7b80\u5316\u5b89\u88c5\u6b65\u9aa4\uff0c\u9009\u62e9no\n. thanks\n. thanks\n. thanks\n. thanks\n. \u4ee3\u7801\u91cc\u9762\u52a0sleep\u8fd9\u79cd\u4e0d\u80fd\u8bf4\u6027\u80fd\u4e0b\u964d\u4e86\uff0c\u8fd9\u79cd\u5c5e\u4e8eQPS\u4e0b\u964d\u4e86\uff0c\u4f60\u901a\u8fc7\u89c2\u5bdf\u7cfb\u7edf\u8d1f\u8f7d\u5176\u5b9e\u662f\u964d\u4f4e\u4e86\u3002\n\u4efb\u4f55\u8bed\u8a00\u50cf\u8fd9\u6837\u8ba9\u8fdb\u7a0b\u5b8c\u5168\u7761\u7720\u90fd\u4f1a\u5bfc\u81f4QPS\u4e0b\u964d\uff0c\u8fd9\u4e2a\u4e0d\u662f\u6846\u67b6\u51b3\u5b9a\u7684\uff0c\u5b8c\u5168\u662f\u5f00\u53d1\u8005\u7684\u4ee3\u7801\u51b3\u5b9a\u3002\nworkerman\u7684\u5f02\u6b65\u662f\u901a\u8fc7\u975e\u963b\u585eIO\u914d\u5408\u591a\u8fdb\u7a0b\u6765\u5b8c\u6210\u7684\uff0c\u5e76\u4e0d\u662f\u5f00\u53d1\u8005\u968f\u610f\u5199\u4ee3\u7801\u90fd\u53ef\u4ee5\u5f02\u6b65\u3002\n\u53e6\u5916\u5f02\u6b65\u5e76\u4e0d\u4e00\u5b9a\u80fd\u63d0\u9ad8\u670d\u52a1\u5668\u6027\u80fd\uff0c\u4e00\u822c\u6765\u8bf4\u53ea\u662f\u4e00\u79cd\u7f16\u7a0b\u624b\u6cd5\uff0c\u53ef\u4ee5\u51cf\u5c11\u7528\u6237\u8bf7\u6c42\u7b49\u5f85\u65f6\u95f4\u3002\n. \u8fd9\u91cc\u8d34\u4e2aworkerman\u5f02\u6b65\u7684\u4f8b\u5b50\uff0css-php\u4ee3\u7406\uff0c\u5f88\u591a\u7528\u6237\u7528\u5b83\u6765\u7ffb\u5899\u3002\n\u4ee3\u7406\u539f\u7406\uff1a\u6bd4\u5982\u7528\u6237\u60f3\u770b\u4e00\u4e2ayoutube\u7f51\u9875\uff0c\u4ee3\u7406\u670d\u52a1\u7aef\u6700\u7b80\u5355\u7684\u505a\u6cd5\u662f\u5728onMessage\u91cc\u628a\u7f51\u9875\u5185\u5bb9\u5168\u90e8\u4e0b\u8f7d(curl/file_get_contents...)\u4e0b\u6765\uff0c\u7136\u540e\u6574\u4f53\u53d1\u7ed9\u5ba2\u6237\u7aef\u3002\u5982\u679c\u8fd9\u4e2a\u4e0b\u8f7d\u8fc7\u7a0b\u53ea\u6709100\u6beb\u79d2\uff0c\u611f\u89c9\u8fd8\u53ef\u4ee5\u63a5\u53d7\u3002\u4f46\u662fyoutube\u89c6\u9891\u6d41\u5462\uff1f\u4e0d\u53ef\u80fd\u5728onMessage\u91cc\u628a\u89c6\u9891\u4e0b\u8f7d\u5b8c\u518d\u53d1\u7ed9\u7528\u6237\uff0c\u4f46\u662f\u5982\u679c\u4f60\u53ea\u7528curl\u6216\u8005file_get_conents\u7b49\u83b7\u53d6youtube\u89c6\u9891\u6570\u636e\u5c31\u8981\u540c\u6b65\u7b49\u5f85(\u8fd9\u4e2a\u963b\u585e\u7b49\u5f85\u4efb\u4f55php\u6846\u67b6\u90fd\u63a7\u5236\u4e0d\u4e86\uff0cworkerman\u81ea\u7136\u63a7\u5236\u4e0d\u4e86)\uff0c\u679c\u6240\u6709\u8fdb\u7a0b\u90fd\u963b\u585e\u5728\u8fd9\u91cc\uff0c\u4ee3\u7406\u7684\u541e\u5410\u91cf\u5c31\u4f1a\u5f88\u5dee\u3002\n\u6240\u4ee5\u5f02\u6b65\u6b63\u786e\u7684\u505a\u6cd5\u5e94\u8be5\u662f\u7c7b\u4f3css-php\u4f8b\u5b50\u4e00\u6837\uff0c\u5229\u7528IO\u975e\u963b\u585e\uff0c\u5f02\u6b65\u5efa\u7acbsocket\u94fe\u63a5\uff0c\u5f02\u6b65\u63a5\u53d7\u6d88\u606f\uff0c\u5f02\u6b65\u8f6c\u53d1\u6d88\u606f\uff0c\u8fd9\u6837\u4ee3\u7406\u6574\u4e2a\u541e\u5410\u91cf\u5c31\u63d0\u9ad8\u4e86\uff0c\u770byoutube\u89c6\u9891\u4e5f\u5c31\u4e0d\u4f1a\u5361\u4e86\u3002\n\u6240\u4ee5\u8fd8\u662f\u6211\u4e0a\u9762\u8bf4\u7684\uff0c\u4ee3\u7801\u662f\u5426\u5f02\u6b65\u6267\u884c\u4e0d\u662f\u5168\u90e8\u7531\u6846\u67b6\u51b3\u5b9a\uff0c\u5f88\u5927\u7a0b\u5ea6\u4e0a\u7531\u5f00\u53d1\u8005\u7f16\u7801\u624b\u6cd5\u51b3\u5b9a\u7684\uff0c\u4e0d\u662f\u968f\u4fbf\u4e2a\u4ee3\u7801\u6254\u4e0a\u53bb\u5c31\u80fd\u5f02\u6b65\u6ef4\u3002\n. \u63d0\u793a \u6709\u51b2\u7a81\uff0c\u65e0\u6cd5\u5408\u5e76\uff0c\u6682\u65f6\u4e0d\u63a5\u53d7\u8fd9\u4e2apr\u3002\n\u4f46\u662f\u4ecd\u7136\u975e\u5e38\u611f\u8c22\u5bf9workerman\u7684\u652f\u6301\u3002\n. thanks\n. Thanks.\n. You can try to use autoload.php of composer.\n. See http://php.net/manual/en/function.spl-autoload-register.php .\n. \u975e\u5e38\u611f\u8c22pr\u3002\n\u8fd9\u4e2a\u6539\u52a8\u6709\u70b9\u5927\uff0c\u53d8\u52a8\u4e86\u63a5\u53e3\u53c2\u6570\uff0c\u6682\u65f6\u5148\u4e0d\u5408\u5e76\u3002\n\u6211\u5148\u8003\u8651\u4e0b\n. Need a lot of changes and replacement are not recommend.\n. I didn't know the existence of reactphp when I wrote workerman. \nAdd a wrapper for reactphp-event-loop is a simple way to fit workerman.\nHere is workerman's event-loop interface.\nhttps://github.com/walkor/Workerman/blob/master/Events/EventInterface.php\n. Workerman support reactphp-loop now.\nExamples.\nhttps://github.com/walkor/Workerman#async-mysql-of-reactphp. If timer runs a very time consuming task, when the process  receive the restart signal, because it can not quickly stop so being killed by the main process, then the log will be recorded. \nIt's not a serious problem.\n. Timer not stoped, but busy.\nIn \"PROCESS STATUS\" no one timer left, because your processes are busy , no time to respond to the status command.\n. No need to restart.\nMay be your php code called exit or die, witch cause processes eixted  with status 256.\n.  require_once './Workerman/Autoloader.php';\u4e3b\u8981\u662f\u7ed9\u975ecomposer\u7528\u6237\u4f7f\u7528\u7684\u3002\ncomposer\u7528\u6237\u76f4\u63a5\u4f7f\u7528 require_once './vendor/autoload.php';\u5c31\u53ef\u4ee5\u4e86\uff0c\u719f\u6089composer\u7684\u7528\u6237\u90fd\u77e5\u9053\u8fd9\u4e2a\uff0c\u4f60\u7b2c\u4e00\u6b21\u7528\u4e0d\u7406\u89e3\u4e5f\u6b63\u5e38\u3002\n\u591a\u4e2a\u9879\u76ee\u53ef\u4ee5\u590d\u7528\u540c\u4e00\u4e2aworkerman\u4ee3\u7801\u5e93\uff0c\u53ea\u8981\u5f15\u5165Workerman/Autoloader.php\u6216\u8005vendor/autoload.php\u5373\u53ef\n. Try this codes.\n``` php\n<?php\nuse Workerman\\Worker;\nrequire_once 'your/path/Workerman/Autoloader.php';\n$worker = new Worker('tcp://0.0.0.0:1234');\n$worker->count=4;\n$worker->onMessage = function($connection, $data)\n{\n    $connection->send(\"HTTP/1.1 200 OK\\r\\nConnection: keep-alive\\r\\nServer: workerman\\r\\nContent-Length: 5\\r\\n\\r\\nhello\");\n};\nWorker::runAll();\n``\n. \u60ca\u7fa4\u6548\u5e94\uff0c\u662f\u6b63\u5e38\u7684\u3002\n. \u4e0d\u9519\u7684\u7279\u6027\uff0c\u975e\u5e38\u611f\u8c22\uff01\n. \u76f4\u63a5exit(0);\u4f1a\u88abworkerman\u5224\u65ad\u5f02\u5e38\u9000\u51fa\uff0c\u6240\u4ee5\u4f1a\u6709\u4e2a\u65e5\u5fd7\u3002\n\u7528Worker::stopAll();\u6765\u4ee3\u66ffexit(0);`\u5c31\u597d\u4e86\u3002\n. \u5e38\u89c1\u7684exit_status\u53ca\u5176\u542b\u4e49\u5982\u4e0b\uff1a\n0\uff1a\u8868\u793a\u6b63\u5e38\u9000\u51fa\uff0c\u8fd0\u884creload\u5e73\u6ed1\u91cd\u542f\u540e\u4f1a\u51fa\u73b0\u503c\u4e3a0\u7684\u9000\u51fa\u7801\uff0c\u662f\u6b63\u5e38\u73b0\u8c61\u3002\u6ce8\u610f\u5728\u7a0b\u5e8f\u4e2d\u8c03\u7528exit\u6216die\u4e5f\u4f1a\u5bfc\u81f4\u9000\u51fa\u7801\u4e3a0\uff0c\u5e76\u4ea7\u751f\u4e00\u6761WORKER EXIT UNEXPECTED\u9519\u8bef\u4fe1\u606f\uff0cworkerman\u4e2d\u4e0d\u5141\u8bb8\u4e1a\u52a1\u4ee3\u7801\u8c03\u7528exit\u6216\u8005die\u8bed\u53e5\u3002\n9\uff1a\u8868\u793a\u8fdb\u7a0b\u88abSIGKILL\u4fe1\u53f7\u6740\u6b7b\u4e86\u3002\u8fd9\u4e2a\u9000\u51fa\u7801\u4e3b\u8981\u53d1\u751f\u5728reload\u5e73\u6ed1\u91cd\u542f\u65f6\uff0c\u5bfc\u81f4\u8fd9\u4e2a\u9000\u51fa\u7801\u7684\u539f\u56e0\u662f\u7531\u4e8e\u5b50\u8fdb\u7a0b\u6ca1\u6709\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u54cd\u5e94\u4e3b\u8fdb\u7a0breload\u4fe1\u53f7(\u4f8b\u5982mysql\u3001curl\u7b49\u957f\u65f6\u95f4\u963b\u585e\u7b49\u5f85\u6216\u8005\u4e1a\u52a1\u6b7b\u5faa\u73af\u7b49)\uff0c\u88ab\u4e3b\u8fdb\u7a0b\u5f3a\u5236\u4f7f\u7528SIGKILL\u4fe1\u53f7\u6740\u6b7b\u3002\u6ce8\u610f\uff0c\u5f53\u5728linux\u547d\u4ee4\u884c\u4e2d\u4f7f\u7528kill\u547d\u4ee4\u53d1\u9001SIGKILL\u4fe1\u53f7\u7ed9\u5b50\u8fdb\u7a0b\u4e5f\u4f1a\u5bfc\u81f4\u8fd9\u4e2a\u9000\u51fa\u7801\u3002\n65280\uff1a\u5bfc\u81f4\u8fd9\u4e2a\u9000\u51fa\u7801\u7684\u539f\u56e0\u662f\u4e1a\u52a1\u4ee3\u7801\u6709\u81f4\u547d\u9519\u8bef\uff0c\u4f8b\u5982\u8c03\u7528\u4e86\u4e0d\u5b58\u5728\u7684\u51fd\u6570\u3001\u8bed\u6cd5\u9519\u8bef\u7b49\uff0c\u5177\u4f53\u9519\u8bef\u4fe1\u606f\u4f1a\u8bb0\u5f55\u5230Worker::logFile\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5728php.ini\u4e2derror_log\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d(\u5982\u679c\u6709\u6307\u5b9a\u7684\u8bdd)\u627e\u5230\u3002\n64000\uff1a\u5bfc\u81f4\u8fd9\u4e2a\u9000\u51fa\u7801\u7684\u539f\u56e0\u662f\u4e1a\u52a1\u4ee3\u7801\u629b\u51fa\u4e86\u5f02\u5e38\uff0c\u4f46\u4e1a\u52a1\u6ca1\u6709\u6355\u83b7\u8fd9\u4e2a\u5f02\u5e38\uff0c\u5bfc\u81f4\u8fdb\u7a0b\u9000\u51fa\u3002\u5982\u679cworkerman\u4ee5debug\u65b9\u5f0f\u8fd0\u884c\u65f6\u5f02\u5e38\u8c03\u7528\u6808\u4f1a\u6253\u5370\u5230\u7ec8\u7aef\uff0cdaemon\u65b9\u5f0f\u8fd0\u884c\u65f6\u5f02\u5e38\u8c03\u7528\u6808\u4f1a\u8bb0\u5f55\u5230Worker::stdoutFile\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\u3002\nexit with status 9 \u4e00\u822c\u662f\u8fdb\u7a0b\u5728\u5904\u7406\u4e1a\u52a1\uff0c\u6ca1\u529e\u6cd5\u53ca\u65f6\u54cd\u5e94stop/reload\u547d\u4ee4\uff0c2\u79d2\u5185\u6ca1\u6709\u6267\u884c\u9000\u51fa\uff0c\u88ab\u4e3b\u8fdb\u7a0b\u6740\u6b7b\u3002\n\u6458\u81ea\u624b\u518c http://doc3.workerman.net/advanced/status.html\n. strace -p pid\npid\u4e3a\u90a3\u4e2astatus\u91cc\u9762\u6d88\u5931\u7684\u8fdb\u7a0bpid\uff0c\u770b\u770b\u8fdb\u7a0b\u5728\u5e72\u4ec0\u4e48\n. \u628aevent\u6269\u5c55\u53bb\u6389\u5e94\u8be5\u5c31\u597d\u4e86\u3002\n\u7531\u4e8e\u5b50\u8fdb\u7a0bA\u4f7f\u7528\u4e86event\u6269\u5c55\uff0c\u5b50\u8fdb\u7a0b\u518d\u6b21fork\u540e\uff0c\u5b50\u8fdb\u7a0b\u7684\u5b50\u8fdb\u7a0bB\u4f1a\u7ee7\u627f\u8fd9\u4e2aevent\u5b9e\u4f8b\u3002\n\u6211\u6000\u7591B\u9000\u51fa\u540e\u5f71\u54cd\u4e86A\u7684event\u5b9e\u4f8b\u3002\n\u8fd9\u4e2a\u5728\u5f00\u53d1workerman\u65f6\u6709\u9047\u5230\u8fc7\uff0c\u5f00\u53d1\u65f6\u5c1d\u8bd5\u4e3b\u8fdb\u7a0b\u548c\u5b50\u8fdb\u7a0b\u90fd\u662f\u7528event/libevent\uff0c\n\u4e5f\u662f\u4f1a\u51fa\u73b0\u5b50\u8fdb\u7a0b\u9000\u51fa\u540e\uff0c\u5f71\u54cd\u5230\u4e86\u4e3b\u8fdb\u7a0b\u7684event/libevent\u884c\u4e3a\uff0c\n\u6240\u4ee5\u76ee\u524dworkerman\u4e3b\u8fdb\u7a0b\u90fd\u662fselect\uff0c\u6ca1\u6709\u7528epoll\uff0c\u6240\u4ee5\u6ca1\u8fd9\u4e2a\u95ee\u9898\u3002\n\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u4e0b\u628aevent\u6269\u5c55\u53bb\u6389\n. @xpader \u8bf4\u7684\u5bf9\uff0c\u4e0d\u5efa\u8bae\u5728workerman\u91ccfork\u8fdb\u7a0b\uff0c\u5bb9\u6613\u56e0\u4e3a\u5171\u4eab\u8d44\u6e90\u5bfc\u81f4\u4e0d\u53ef\u9884\u77e5\u7684\u95ee\u9898\u3002. http://doc3.workerman.net/faq/async-task.html\n\u624b\u518c\u8fd9\u91cc\u6709\u5f02\u6b65\u6267\u884c\u4efb\u52a1\u7684\u793a\u4f8b\uff0c\u770b\u4e0b\u662f\u4e0d\u662f\u60f3\u8981\u7684. \u7528fork\u7684\u65b9\u6cd5\u9ad8\u5cf0\u671f\u4f30\u8ba1\u5185\u5b58\u5360\u7528\u66f4\u9ad8\uff0c\u800c\u4e14\u611f\u89c9\u4e0d\u53ef\u63a7\u3002\u53e6\u5916\u5b9e\u65f6fork\u5f88\u8017\u8d39\u8d44\u6e90\uff0c\u6027\u80fd\u4f1a\u6bd4\u8f83\u5dee\u3002\n\u4e0a\u9762\u5f02\u6b65\u4efb\u52a1\u4f1a\u597d\u5f88\u591a\uff0c\u5f02\u6b65\u4efb\u52a1\u4e0d\u4ec5\u53ef\u4ee5\u6254\u7ed9\u672c\u673a\u53bb\u505a\uff0c\u8fd8\u53ef\u4ee5\u4e22\u7ed9\u670d\u52a1\u5668\u96c6\u7fa4\u53bb\u505a\uff0c\u5185\u5b58\u5360\u7528\u53ef\u63a7\uff0c\u5e76\u4e14\u6ca1\u6709fork\u5f00\u9500\u3002\u96c6\u7fa4\u524d\u6321\u4e00\u5c42dns\u6216\u8005lvs\uff0c\u53ef\u4ee5\u968f\u65f6\u52a0\u51cf\u670d\u52a1\u5668\u591a\u5230\u52a8\u6001\u6269\u5bb9\u6216\u8005\u7f29\u5bb9\u800c\u4e0d\u5f71\u54cd\u670d\u52a1\u3002. \u8fd9\u4e2a\u662fGatewayWorker\u4e2d\u7684\u8bbe\u7f6e\uff0c\u548cWorkerman\u6ca1\u5173\u7cfb\u3002\n\u4e0d\u662fbug\uff0c\u5c31\u662f\u8fd9\u4e48\u8bbe\u8ba1\u7684\u3002\u8fd9\u4e2a\u5b9a\u65f6\u5668\u662f\u6bcf\u4e8c\u5206\u4e4b\u4e00$pingInterval \u65f6\u95f4\u6267\u884c\u4e00\u6b21\uff0c\u6240\u4ee5\u4e58\u4ee52\n. I think the codes with workerman most like this for your application.\nphp\nuse Worker\\Worker;\n// serverquery protcol\n$worker = new Worker('serverquery://0.0.0.0:10011');\n$worker->onMessage = function($connection, $message){\n    // $message->cmd = 'notifyCliententerview/notifyServeredited/notifyTextmessage/..etc'\n    $callback = $message->cmd;\n    if (is_callable($callback)) {\n        $callback($message);\n    }\n};\nWorker::runAll();\nIn workerman you do not need to handle sockets or read data manually, but just deal with your business in onMessage callback.. \u6b63\u5e38\uff0cPHP\u91cc\u51fd\u6570\u5185\u90e8\u8bbf\u95ee\u4e0d\u5230\u51fd\u6570\u5916\u90e8\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u8fd9\u4e2a\u662fPHP\u57fa\u672c\u7684\u8fd0\u884c\u673a\u5236\u3002\n\u4f60\u53ef\u4ee5\u5728\u51fd\u6570\u5185\u90e8\u58f0\u660e global $mc_server; \uff0c\u901a\u8fc7\u5168\u5c40\u53d8\u91cf\u7684\u65b9\u5f0f\u53bb\u8bbf\u95ee\u3002\u6216\u8005use\u95ed\u5305\u7684\u65b9\u5f0f\u8bbf\u95ee\u3002. onMessage\u91cc\u80af\u5b9a\u4e5f\u4e0d\u884c\uff0c\u4f60\u81ea\u5df1\u641e\u9519\u4e86. Merged and thanks.. Workerman will check Protocols/myProtocol first and then Workerman/Protocols/myProtocol, so there is no need to put your protocol  in \\Workerman\\Protocols.\nYes you can also use myNameSpace\\myProtocol://0.0.0.0:1234.. Im not sure ,maybe a week or longer.. I have no time to do that.\nThis is an open source project, you can send PR if you need that.. I tried to add LibEvLoop for react but unfortunately there is coredump for libev extension and which I  can not solve.\nSo I decide not to support LibEvLoop until libev is stable enough.. :-(. Fixed.\nI added similar codes in Workerman\\Events\\React.php.\n. No plan to implement load balancer in workerman.\nI think\nClient<-->DNS<-->Server\nor\nClient<-->DNS<-->LVS<-->Server\nis good for your situation.\n. LVS works in the 4 layer network and has better performance than other balancing system(nignx, haproxy etc...) witch work in the network of 7 layers.\nI don't have a deep understanding of emqtt.io so I can't make any comments.. You should add a ssl proxy with nginx/stunnel etc.\nHere is the link for nginx ssl proxy setting nginx-tcp-ssl-termination/.\n. Make socket ssl with contex functions maybe work but I'm not sure.\nSee https://github.com/walkor/phpsocket.io/issues/35 .. I have tested that and conclusion is there is not need add unset codes. Here the codes.\nphp\n<?php\n$c = str_pad('', 10240000, 1);\n$a = function()use($c){\n    $a = $c.\"\\n\";\n    //unset($c);\n};\n$a();\necho memory_get_usage(true).\"\\n\";. I tried the codes below and $a still in memory. unset is no need in function context.\nSince  version 5.3  PHP has its own GC and unset is not required in function context.\nHere is the link for PHP GC.\nYou can call gc_collect_cycles() after code unset($a,$b); then $a will destruct.\n```php\n<?php\nclass A{\n        public $a;\n    function __destruct(){\n            echo \"This object(A) removed from memory<br/>\\n\";\n    }\n\n}\nclass B{\n        public $B;\n    function __destruct(){\n            echo \"This object(B) removed from memory<br/>\\n\";\n    }\n\n}\n$a = new A;\n$a->a = function()use($a){\n    unset($a);\n};\n$b = new B;\n$b->b = $a;\ncall_user_func($a->a);\nunset($a,$b);\necho \"You think both \\$a and \\$b are freed from memory But \\$a is in memory\\n\";\n. This feature is not implemented yet.. Yes ,after a few weeks.. I have no time to do that.\nThis is an open source project, you can send PR if you need that.. Now you can force workerman use EV like this.php\nuse Workerman\\Worker;\n// Set eventLoopClass for workerman.\nWorker::$eventLoopClass = '\\Workerman\\Events\\Ev';\n//Worker::$eventLoopClass = '\\Workerman\\Events\\Libevent';\n//Worker::$eventLoopClass = '\\Workerman\\Events\\Select';\n//Worker::$eventLoopClass = '\\Workerman\\Events\\React\\LibEventLoop';\n//Worker::$eventLoopClass = ....\n$worker = new Worker('http://0.0.0.0:1234');\n$worker->on....\n. Yes.\nSet up an HTTP proxy that inserts the userip header on every request then you can get it in$_SERVER['HTTP_USERIP'].. Open /etc/sysctl.conf and add\nnet.ipv4.tcp_timestamps = 1\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_tw_recycle = 1\nRunsysctl -p```. Explain it in english is too hard for me.  : )\nI found a similar link hope that will help you.\nhttps://redmine.lighttpd.net/projects/weighttp/wiki\n. Thank you for your advice.\nBut some times we need long connection for realtime communication on http and do not want to close it. \nI tend to use workerman as a generic service without any business like when or how to close connection.\nIf a timer for connection is required I suggest to extend workerman but not do it in workerman.. Thanks a lot.. Because you reboot the server and the pid file of workerman which stored workerman's pid remains on disk.\nWhen workerman starting, start script will get the pid  from the file and check if the process of the pid still alive.\nMaybe another process started which pid is the same as workerman's old pid.\nJust delete the pid file of workerman after you reboot your server.\n. Thanks . Try to use command ps aux to find the pid of HttpServerWorker which disappeared in status,\nAnd then use command strace -ttp pid to see what happened in the process.. stopped by SIGTSTP means that the process was stoped by signal SIGTSTP.\nBut I don't know who sended the signal.\n. I noticed that the value of STAT in your result of ps aux was T, That means your process was halted by signal SIGTSTP.\nPressing Ctrl+Z will sends the TSTP signal to your process.  Did you pressed CTRL+Z?\n. > after minutes , no workerman listed in ps aux\nThis is something I've never met before, and I can't tell you what's wrong.. Do not use sleep in workerman.\nAnd do not use infinite loop in workerman.\nAll of these will cause process statistics to disappear for php index.php status command, because event-loop can not be executed for temporary or permanent and can not responds the status command or other commands(restart stop etc...) .. Yes heavy duty  may also cause the problem because process can not deal with status command in time.. Try to update phpsocket.io. The problem had been fixed .\nSee https://github.com/walkor/phpsocket.io/pull/53 . You can send a pull request.. Because most users of workerman come from Asia, So if you not set your timezong in your php.ini workerman will use Asia/Shanghai as default.. Not support this. . What is the version of your php?. I think this is the issue of https://github.com/expressif/pecl-event-libevent.. Please use event extension.\nSo far , the extension of libev or libevent are not stable enough for php7.. Show your codes please.. Looks like Epoll does not support the resource of pg_connect returned.. Can you test with event ?. Yes, extension of libevent are not stable enough for php7.\nExtension event seems not support resource of pg_connect returned.. I'm not good at C programming and I do not know whats's the problem with  expressif/pecl-event-libevent.. Thanks a lot.. I don't really understand what you mean. Can you show me your code?. Thank you for your issue but it is not workerman's issue but gatewayWorker.\nPlease move this to GatewayWorker. \u53ef\u80fd\u662f\u4e1a\u52a1\u6709\u81f4\u547d\u9519\u8bef\uff0cdebug\u65b9\u5f0f\u8fd0\u884c(-d \u53bb\u6389)\u8bd5\u8bd5\u3002\n\u6216\u8005\u628a\u4e1a\u52a1\u4ee3\u7801tz.php\u8d34\u51fa\u6765\u3002. \u770b\u5230\u4f60\u4ee3\u7801\u7528\u7684\u662fWorker,\u5e76\u6ca1\u6709\u8bbe\u7f6eonMesage,\u786e\u5b9e\u6ca1\u6709\u8fd4\u56de\u4efb\u4f55\u6570\u636e\u7ed9\u5ba2\u6237\u7aef\u3002. \u53ef\u80fd\u662f\u4f60php7.0.15\u7684bug\u3002\n\u6362\u4e2aphp\u7248\u672c\u8bd5\u4e0b. #138 . You can use redis-react in workerman.\nInstall\ncomposer require clue/redis-react\nUsage\n```php\n<?php\nrequire_once DIR . '/vendor/autoload.php';\nuse Clue\\React\\Redis\\Factory;\nuse Clue\\React\\Redis\\Client;\nuse Workerman\\Worker;\n$worker = new Worker('tcp://0.0.0.0:6161');\n$worker->onWorkerStart = function() {\n    global $factory;\n    $loop    = Worker::getEventLoop();\n    $factory = new Factory($loop);\n};\n$worker->onMessage = function($connection, $data) {\n    global $factory;\n    $factory->createClient('localhost:6379')->then(function (Client $client) use ($connection) {\n        $client->set('greeting', 'Hello world');\n        $client->append('greeting', '!');\n    $client->get('greeting')->then(function ($greeting) use ($connection){\n        // Hello world!\n        echo $greeting . PHP_EOL;\n        $connection->send($greeting);\n    });\n\n    $client->incr('invocation')->then(function ($n) use ($connection){\n        echo 'This is invocation #' . $n . PHP_EOL;\n        $connection->send($n);\n    });\n});\n\n};\nWorker::runAll();\n. You can useWorkerman\\Protocols\\Http::header('...');to set header.php\nuse Workerman\\Protocols\\Http;\n$worker_http->onMessage = function($connection,$data) {\n    $extension_static = ['png','jpg','jpeg','gif','css','js','otf','eot','woff2','woff','ttf','svg','html'];\n    $parse_url_path = parse_url($_SERVER['REQUEST_URI'],PHP_URL_PATH);\n    $extension = pathinfo($parse_url_path,PATHINFO_EXTENSION);\nif (in_array($extension,$extension_static)) {\n    $content = file_get_contents('/home/wborba/project/jessi/src'.$_SERVER['REQUEST_URI']);\n\n    // Here content-type for css and js, or none for img.......\n    if ($extension === 'css') {\n        Http::header('Content-Type: text/css');\n    } else if ($extension === 'js') {\n        Http::header('Content-Type: application/javascript');\n    } else ...\n\n    $connection->close($content);\n\n    return;\n}\n\ntry {\n     $content = 'my content in html';\n\n} catch (WException | Exception $error) {\n    //\n}\n\n$connection->send($content);\n\n};\n```\nWorkerman has an Implementation WebServer which will set correct header according to extension. Mime.types  is the mapping of the header and the extension which WebServer used.\nHere is an example for workerman's WebServer.\n```php\nrequire_once DIR . '/vendor/autoload.php';\nuse Workerman\\WebServer;\nuse Workerman\\Worker;\n// WebServer\n$web = new WebServer(\"http://0.0.0.0:80\");\n// 4 processes\n$web->count = 4;\n// Set the root of domains\n$web->addRoot('www.your_domain.com', '/home/wborba/project/jessi/src');\n$web->addRoot('www.another_domain.com', '/another/path/Web');\n// run all workers\nWorker::runAll();\n. Thank you for your pull request but workerman has supported ssl.\nHere is an example.php\n// SSL context\n$context = array(\n    'ssl' => array(\n        'local_cert' => '/etc/nginx/one.pem',\n        'local_pk'   => '/etc/nginx/one.key',\n    )\n);\n$worker = new Worker('http://0.0.0.0:443', $context);\n// Enable SSL.\n$worker->transport = 'ssl';\n$worker->onMessage = function($con, $msg) {\n    $con->send(\"hello\");\n};\nWorker::runAll();\n. exit with status 11 \u662f\u53d1\u751f\u4e86core dump\uff0c\u5e94\u8be5\u662f\u4f60\u7684php 7.0.15\u7684bug\u5bfc\u81f4\u7684. I test that ok. Here are the codes.php\nexec('php /your/path/of/file.php status', $return);\nvar_dump($return);\n```\n. Thanks a lot.. Merged. Thanks.. You must have SSH permissions for your linux server.\nAll of control must be done in ssh terminal.\nI don't think your Cpanel has the ability to run workerman.\nHere is a screenshot show how to install and run workerman in ssh terminal. \n\n. Yes, Workerman support SSL now using stream_socket_enable_crypto which support nonblocking socket.. ps aux \n\u770b\u4e0bworkerman\u8fdb\u7a0b\u6709\u51e0\u4e2a. \u5e94\u8be5\u662f php 7.1.2 \u4fe1\u53f7\u5904\u7406\u6709bug\u5bfc\u81f4\u7684\uff0c\n\u6362\u4e2aphp\u7248\u672c\u8bd5\u4e0b. php5 tz.php start -d  ps aux \u540e\u627e\u5230\u4e3b\u8fdb\u7a0bpid\uff0c\n\u7136\u540estrace -p \u4e3b\u8fdb\u7a0bpid\u3002\n\u518d\u53e6\u5916\u5f00\u4e00\u4e2a\u7ec8\u7aef\uff0c\u8fd0\u884c php5 tz.php status\n\u8d34\u4e0bstrace\u7684\u7ed3\u679c\u3002\n. \u7b2c\u4e00\u6b21\u89c1\u5230\u8fd9\u79cd\u60c5\u51b5\uff0c\n\u662f\u5426\u6709\u6539\u52a8\u8fc7Workerman\u4ee3\u7801\uff1f. tz.php \u4ee3\u7801\u80fd\u53d1\u4e00\u4e0b\u4e48\uff1f. \u6211\u8fd9\u91cc\u8bd5\u4e86mac \u7cfb\u7edf \u548c ubuntu\u90fd\u662f\u6ca1\u95ee\u9898\u7684\u3002\n\u8981\u6392\u67e5\u8fd9\u4e2a\u95ee\u9898 \u9700\u8981\u4f60\u6253\u65e5\u5fd7\u4e86\uff0c\nhttps://github.com/walkor/Workerman/blob/master/Worker.php#L774\nstatus \u4f1a\u8fdb\u5165\u8fd9\u4e2a\u5206\u652f\uff0c\u53ef\u4ee5\u6253\u5370\u4e0b\u65e5\u5fd7\u770b\u770b\u5728\u8d70\u5230\u54ea\u91cc\u9000\u51fa\u7684\u3002. \u4e0d\u662f\u8fd9\u4e2a\u610f\u601d\u3002\u56e0\u4e3a\u6211\u8fd9\u91cc\u65e0\u6cd5\u91cd\u73b0\u95ee\u9898\uff0c\u9700\u8981\u4f60\u81ea\u5df1\u52a8\u624b\u627e\u5230\u6267\u884c\u5230\u4e86\u7a0b\u5e8f\u7684\u54ea\u4e2a\u90e8\u5206\u51fa\u73b0\u95ee\u9898\u5e76\u9000\u51fa\u4e86\u3002\n\u4f60\u53ef\u4ee5\u5728\u6211\u8bf4\u7684\u90a3\u4e2a\u4f4d\u7f6e\u5f00\u59cb\u6392\u67e5\uff0c\u6bd4\u5982\u628a\u5728\u6000\u7591\u6709\u95ee\u9898\u7684\u5730\u65b9\u81ea\u5df1\u8bb0\u5f55\u4e0b\u65e5\u5fd7\uff0c\n\u6700\u7b80\u5355\u7684\u6bd4\u5982\u5728\u6000\u7591\u6709\u95ee\u9898\u7684\u5730\u65b9 echo \u4e00\u6bb5\u6587\u5b57\u6bd4\u5982\u884c\u53f7\uff0c\u542f\u52a8\u7684\u65f6\u5019\u4e0d\u52a0-d \u4e5f\u5c31\u662fdebug\u65b9\u5f0f\u542f\u52a8\uff0c\u518d\u542f\u52a8\u4e00\u4e2a\u7ec8\u7aef\u8fd0\u884cstatus, \u5982\u679c\u7a0b\u5e8f\u6267\u884c\u5230\u4e86\u4f60echo \u7684\u4f4d\u7f6e\u5c31\u4f1a\u6709\u6253\u5370\u5728\u7ec8\u7aef\uff0c\u6ca1\u6267\u884c\u5230\u5c31\u4e0d\u4f1a\u6253\u5370\uff0c\u6700\u7ec8\u80fd\u5b9a\u4f4d\u5230\u5728\u54ea\u4e00\u4e2a\u5730\u65b9\u9000\u51fa\u7684. \u4e86\u89e3\u4e86\uff0c\u611f\u8c22\u53cd\u9988. Good advice. \ud83d\udc4d . Your timer process was blocked and not response status command in time so you can't see it in terminal.\nThat is not problem.\nIf you use ps aux command you will see the process. \nAnd you can also use strace -p pid to see what the missing process is doing.. Thanks.. Please use english, that can help all people to understand each other. Thanks.   : -). Thanks again.\nI tested the following codes and it works fine for php start.php start -d command .\n```php\n<?php\nrequire_once DIR . '/Workerman/Autoloader.php';\nuse Workerman\\Worker;\n$pid = pcntl_fork ();\nif ($pid === 0)\n{\n    while(1) sleep(1);\n}\nelse\n{\n    $worker = new Worker('http://0.0.0.0:1234');\n    $worker->onMessage = function($connection, $data)\n    {\n        echo \"Hello\\n\";\n        $connection->send(\"Hi\");\n    };\n    Worker::runAll();\n}\n```\nPlease show an complete example for your problem that will help solve problems quickly.. php\n        register_shutdown_function ( function ($pid_t)\n    {\n        $mypid = posix_getpid ();\n        $msg = \"kill pid:{$pid_t}, mypid:{$mypid}\";\n        Log::log_step ( $msg );\n        posix_kill ( $pid_t, SIGKILL );\n    }, $pid );\nMaster process will exited when use command php start.php start -d for daemon.\nSo the callback of register_shutdown_function was triggered.\nAnd child process was killed by posix_kill ( $pid_t, SIGKILL ).. Try to use nohup php start.php start & .. Use Workerman\\Protocols\\Http::header to send header to clients.\n```php\nuse Workerman\\Protocols\\Http;\n$http_worker = new Worker(\"http://0.0.0.0:12101\");\n$http_worker->count = 4;\n$http_worker->onMessage = function($connection, $data) {\n        if(isset($_GET['download'])) {\n                $file_path = $GLOBALS['path'].$_GET['download'];\n                $file = file_get_contents($file_path);\n                $file_size = filesize($file_path);\n                // Use Workerman\\Protocols\\Http::header to send header to clients.\n                Http::header(\"Content-type: text/plain\");\n                Http::header(\"Accept-Ranges: bytes\");\n                Http::header(\"Content-Disposition: attachment; filename=\".$_GET['download']);\n                $connection->send($file);\n    } else {\n            $do_a = read_dir($GLOBALS['path']);\n            $do_b = make_list($do_a);\n            $do_c = get_full_html($do_b, $data);\n            $connection->send($do_c);\n    }\n\n};\nWorker::runAll();\n. You are welcome..status 11``` means core dump occurred.\nUsing unstable extensions or PHP bug  will cause the problem.. I really want to help you, but I can do nothing because C is not my forte.. Thanks. \ud83d\udc4d . \u8fd9\u4e2apr\u6ca1\u6709\u5408\u5e76\u3002pr\u4e2d\u6ca1\u6709\u8bf4\u660e\u5177\u4f53\u662f\u4ec0\u4e48\u95ee\u9898\uff0c\u5e76\u4e14\u4ee3\u7801\u6709hack\u7684\u611f\u89c9\uff0c\u4e0d\u4e25\u8c28\u3002\nThis PR is not merged. PR did not specify what is the problem, and the code has the feeling of hack, not rigorous.\n. Fixed.. Thank you for your issue.. Please use english, that can help all people to understand each other. Thanks. : -). Under Linux (Or POSIX type OS), using fork() will cause the forked child to have copies of all the parent's file descriptors. Any that it does not close will continue to be shared.  Master process create a listening socket and fork , child process will share it and can be used to accept() new sockets for clients. This is how many servers, including Apache in most cases, work.\n. When a connection coming ,every idle child process will be awakened and to call  accept() to accept the  connection on the shared listening socket,\nbut only one process will success and other processes will fail(accept() return false), that cause thundering herd problem. . Workerman will use socket option SO_REUSEPORT  when $worker->reusePort is set to be true (this feature only support in php7 or greater). SO_REUSEPORT is a new feature for Linux kernel 3.9.\nWhen the SO_REUSEPORT option is not enabled, a single listening socket notifies workers about incoming connections, and each worker tries to take a connection.\n\nWith the SO_REUSEPORT option enabled, there are multiple socket listeners for each IP address and port combination, one for each worker process. The kernel determines which available socket listener (and by implication, which worker) gets the connection. This can reduce lock contention between workers accepting new connections, and improve performance on multicore systems. However, it can also mean that when a worker is stalled by a blocking operation, the block affects not only connections that the worker has already accepted, but also connection requests that the kernel has assigned to the worker since it became blocked.\n\n. Thanks.. Thanks.. Done.. Thanks.. Thanks.. Thanks.. thanks. Good idea.\nYou can get the count of timer by code count($this-> _eventTimer) inside Events/Event.php Events/Libevent.php Events/Ev.php Events/Select.php.\nAnd use count($this->_timerIdMap) in Events/React/ExtEventLoop.php Events/React/LibEventLoop.php Events/React/StreamSelectLoop.php.\nI think you can add a method getCount for Lib/Timer.php which get the real timer\n count by above codes and display it in writeStatisticsToStatusFile method of Worker.php.. Not self::$_tasks but $this->_tasks.. Timer status has been implement in version 3.4.7.. Fixed. . See https://github.com/walkor/workerman-manual/blob/master/english/src/worker-development/__construct.md. You can  create 4 processes and each process has its own port, like \nphp\n$worker1 = new Worker('websocket://0.0.0.0:8081');\n$worker1->count = 1;\n$worker2 = new Worker('websocket://0.0.0.0:8082');\n$worker2->count = 1;\n$worker3= new Worker('websocket://0.0.0.0:8083');\n$worker3->count = 1;\n$worker4 = new Worker('websocket://0.0.0.0:8084');\n$worker4->count = 1;\nClient can chose any one you want to connect with specific port.\nBut you can not make a connection to a specific process when these processes are listening the same port, like\nphp\n$worker = new Worker('websocket://0.0.0.0:8080');\n$worker->count = 4;. Four processes are listening different ports.\nFour processes are listening the same port.\nThis is the main difference.\n. https://github.com/walkor/Workerman/issues/184#issuecomment-308069727\nSee this.. It is a strange requirements and workerman not support that.. Looks like an error thrown by the xdebug extension.\nTry to disable it.. It is not workerman's issue but gatewayworker's. Please move it to GatewayWorker.. It is not workerman's bug.\nThe workerman in https://github.com/walkor/tcp-proxy-demo is too old.\nAsyncTcpConnection must call connect method to establish connection now.\nI have fixed in https://github.com/walkor/tcp-proxy-demo/commit/611872455eedcec5d4c06d9c0c6745e6ffa12e95#diff-09912625b277e8728d35f29c441c74c3 just now.. ```php\n<?php\nrequire_once DIR . '/your/path/vendor/autoload.php';\nuse Workerman\\Worker;\n$worker = new Worker('websocket://0.0.0.0:12345');\n$worker->onConnect = function($connection) {\n   // When websocket connection established  onWebSocketConnect callback will be called then you can get the http header of websocket handshake by $_SERVER in it.\n   $connection->onWebSocketConnect = function($connection){\n      var_export($_SERVER);\n      // $connection is a php object and you can set some property to it dynamically. We set property Sec_WebSocket_Key to every $connection when websocket connection established.\n      $connection->Sec_WebSocket_Key = $_SERVER['HTTP_SEC_WEBSOCKET_KEY'];\n   };\n};\n$worker->onMessage = function($connection, $data)\n{\n    // Get Sec_WebSocket_Key for the $connection.\n    $Sec_WebSocket_Key = $connection->Sec_WebSocket_Key;\n    $connection->send(\"My Sec_WebSocket_Key is $Sec_WebSocket_Key\");\n};\nWorker::runAll();\n```. There is a interprocess/multi-server communication component for workerman named channel.\nInstall workerman\\channel with command\nconposer require workerman/channel\nExample.\n```php\n<?php\nuse Workerman\\Worker;\nrequire_once DIR . '/vendor/autoload.php';\n// Channel Server. \n$channel_server = new Channel\\Server('0.0.0.0', 2206);\n$worker = new Worker('websocket://0.0.0.0:4236');\n// 6 processes.\n$worker->count=6;\n$worker->onWorkerStart = function($worker)\n{\n    // Channel client connect to Channel Server.\n    Channel\\Client::connect('127.0.0.1', 2206);\n    // Subscribe broadcast event . \n    Channel\\Client::on('broadcast', function($data)use($worker){\n        foreach ($worker->connections as $connection) {\n           $connection->send($data);\n        }\n    });\n    // you can subscribe any events you want.\n    Channel\\Client::on('some other event like send group', function($data)use($worker){\n        // Your send to group business.\n    });\n};\n$worker->onMessage = function($connection, $data) {\n    // Publish broadcast event to all worker processes.\n    Channel\\Client::publish('broadcast', $data);\n};\nWorker::runAll();\n.php\n<?php\nuse Workerman\\Worker;\nrequire_once DIR . '/vendor/autoload.php';\n// Channel Server. \n$channel_server = new Channel\\Server('0.0.0.0', 2206);\n$worker = new Worker('websocket://0.0.0.0:4236');\n// 6 processes.\n$worker->count=6;\n$worker->onWorkerStart = function($worker)\n{\n    // Channel client connect to Channel Server.\n    Channel\\Client::connect('127.0.0.1', 2206);\n    // Subscribe $worker->id event . \n    Channel\\Client::on($worker->id, function($data)use($worker){\n        foreach ($worker->connections as $connection) {\n           $connection->send($data);\n        }\n    });\n};\n$worker->onMessage = function($connection, $data) {\n    // Publish event to one worker processes which id is 1.\n    $worker_id = 1;\n    Channel\\Client::publish($worker_id, $data);\n};\nWorker::runAll();\n```. You are welcome.. Show your codes please.. Thanks.. \n\nNot pretty but wrong format.. #176 \nWrong format. \nPlease do not send pull request again.. Thanks.. Here is an example show how to send a big file to client.\nphp\nfunction send_file($connection, $file_path)\n{\n    $connection->fileHandler = fopen($file_path, 'r');\n    $do_write = function()use($connection)\n    {\n        // Send buffer not full.\n        while(empty($connection->bufferFull))\n        {\n            // Read from disk.\n            $buffer = fread($connection->fileHandler, 8192);\n            // Read eof.\n            if($buffer === '' || $buffer === false)\n            {\n                return;\n            }\n            $connection->send($buffer, true);\n        }\n    };\n    // Send buffer full.\n    $connection->onBufferFull = function($connection)\n    {\n        $connection->bufferFull = true;\n    };\n    // Send buffer drain.\n    $connection->onBufferDrain = function($connection)use($do_write)\n    {\n        $connection->bufferFull = false;\n        $do_write();\n    };\n    $do_write();\n}. Is there any error message for websocket protocol?. php\nfunction send_file($connection, $file_path)\n{\n    $connection->fileHandler = fopen($file_path, 'r');\n    $len = filesize($file_path);\n    $first_byte = \"\\x82\";\n    if ($len <= 125) {\n        $header_buffer = $first_byte . chr($len);\n    } else {\n        if ($len <= 65535) {\n             $header_buffer = $first_byte . chr(126) . pack(\"n\", $len);\n        } else {\n             $header_buffer = $first_byte . chr(127) . pack(\"xxxxN\", $len);\n        }\n    }\n    $connection->send($header_buffer, true);\n    $do_write = function()use($connection)\n    {\n        // Send buffer not full.\n        while(empty($connection->bufferFull))\n        {\n            // Read from disk.\n            $buffer = fread($connection->fileHandler, 8192);\n            // Read eof.\n            if($buffer === '' || $buffer === false)\n            {\n                return;\n            }\n            $connection->send($buffer, true);\n        }\n    };\n    // Send buffer full.\n    $connection->onBufferFull = function($connection)\n    {\n        $connection->bufferFull = true;\n    };\n    // Send buffer drain.\n    $connection->onBufferDrain = function($connection)use($do_write)\n    {\n        $connection->bufferFull = false;\n        $do_write();\n    };\n    $do_write();\n}\nI checked it again and it works now for websocket protocol.\n. The current coding style is better.. $worker->connections stored all connection instances. You can get it by it's id.\nphp\n<?php\nrequire_once __DIR__ . '/../Workerman/Autoloader.php';\nuse Workerman\\Worker;\n$worker = new Worker('websocket://0.0.0.0:1238');\n$worker->onMessage = function($connection, $data) use ($worker)\n{   \n    $id = $connection->id;\n    // $worker->connections stored all connection instances. You can get it by it's id.\n    $connection = $worker->connections[$id];\n    $connection->send(\"My connection->id is $id\");\n};\nWorker::runAll();. Channel.\nUse channel for interprocess communication.\nInstall channel.\ncomposer require workerman/channel.\nExample.\n```php\n<?php\nuse Workerman\\Worker;\nrequire_once DIR . '/vendor/autoload.php';\n// Channel server.\n$channel_server = new Channel\\Server('0.0.0.0', 2206);\n// Websocket server\n$worker = new Worker('websocket://0.0.0.0:4236');\n$worker->count=2;\n$worker->name = 'pusher';\n$worker->onWorkerStart = function($worker)\n{\n    // Channel client.\n    Channel\\Client::connect('127.0.0.1', 2206);\n$event_name = $worker->id;\n\nChannel\\Client::on($event_name, function($event_data)use($worker){\n    $to_connection_id = $event_data['to_connection_id'];\n    $message = $event_data['content'];\n    if(!isset($worker->connections[$to_connection_id]))\n    {\n        echo \"connection not exists\\n\";\n        return;\n    }\n    $to_connection = $worker->connections[$to_connection_id];\n    $to_connection->send($message);\n});\n\n$event_name = 'broadcast';\nChannel\\Client::on($event_name, function($event_data)use($worker){\n    $message = $event_data['content'];\n    foreach($worker->connections as $connection)\n    {\n        $connection->send($message);\n    }\n});\n\n};\n$worker->onConnect = function($connection)use($worker)\n{\n    $msg = \"workerID:{$worker->id} connectionID:{$connection->id} connected\\n\";\n    echo $msg;\n    $connection->send($msg);\n};\n// Http server.\n$http_worker = new Worker('http://0.0.0.0:4237');\n$http_worker->name = 'publisher';\n$http_worker->onWorkerStart = function()\n{\n    Channel\\Client::connect('127.0.0.1', 2206);\n};\n$http_worker->onMessage = function($connection, $data)\n{\n    $connection->send('ok');\n    if(empty($_GET['content'])) return;\n    // Push data to a connection of a worker process.\n    if(isset($_GET['to_worker_id']) && isset($_GET['to_connection_id']))\n    {\n        $event_name = $_GET['to_worker_id'];\n        $to_connection_id = $_GET['to_connection_id'];\n        $content = $_GET['content'];\n        Channel\\Client::publish($event_name, array(\n           'to_connection_id' => $to_connection_id,\n           'content'          => $content\n        ));\n    }\n    // Broadcast?\n    else\n    {\n        $event_name = 'broadcast';\n        $content = $_GET['content'];\n        Channel\\Client::publish($event_name, array(\n           'content'          => $content\n        ));\n    }\n};\nWorker::runAll();\n```\nTest.\n1\u3001Run.\nphp start.php start\nWorkerman[start.php] start in DEBUG mode\n----------------------- WORKERMAN -----------------------------\nWorkerman version:3.2.7          PHP version:5.4.37\n------------------------ WORKERS -------------------------------\nuser          worker         listen                    processes status\nroot          ChannelServer  frame://0.0.0.0:2206       1         [OK]\nroot          pusher         websocket://0.0.0.0:4236   2         [OK]\nroot          publisher      http://0.0.0.0:4237        1         [OK]\n----------------------------------------------------------------\nPress Ctrl-C to quit. Start success.\n2\u3001Chrome.\njavascript\nws = new WebSocket(\"ws://127.0.0.1:4236\");\nws.onmessage = function(e) {\n    alert(\"message\uff1a\" + e.data);\n};\n3\u3001Send message.\nVisit http://127.0.0.1:4237/?content={$content} to broadcast $content to all client.\nVisit http://127.0.0.1:4237/?to_worker_id={$worker_id}&to_connection_id={$connection_id}&content={$content} to send $content to one client.\n. Thank a lot.\nI had fixed the problem.. Please use english, that can help all people to understand each other. Thanks. : -). Refer #187 .. Creating mysql connections without closing them can cause thistoo many connectionserror.\nSo the simple way is just close all mysql connection at the end of onMessage.\nThe best way is to create a global mysql connection and all requests reuse this connection. It looks like this.php\n$worker = new Worker(...);\n// Global db connection.\n$db_connection = null;\n$worker->onWorkerStart = function($worker) {\n    // Create global db connection.\n    global $db_connection;\n    $db_connection = new your\\db\\Connection(....);\n};\n$worker->onMessage = function($client_connection, $data) {\n    // Reuse global db connection.\n    global $db_connection;\n    $db->connection->query(....);\n};\n```. Moved to https://github.com/walkor/GatewayWorker/issues/28 .. Yes. Support android socket and ios socket.. No demo.. Please use english, that can help all people to understand each other. Thanks.. https://github.com/koush/AndroidAsync for Android.\nhttps://github.com/daltoniam/Starscream for IOS swift.\nhttps://github.com/facebook/SocketRocket for object-c.\nhope that can help you.. php\nforeach ($connections_of_some_user as $connection) {\n    $connection->send('.....');\n}. ```php\n$users = [];\n$app_work = new AppWorker(\"websocket://0.0.0.0:8000\");\nswitch ($status) {\n    case 'start':\n}\n$app_work->onWorkerStart = function () use (&$users) {\n    // create local tcp-server\n    $inner_tcp_worker = new Worker(\"tcp://127.0.0.1:1234\");\n$inner_tcp_worker->onMessage = function ($connection, $data) use (&$users) {\n    $data = json_decode($data);\n    if (isset($users[$data->user])) {\n        $webconnections = $users[$data->user];\n        // ==== Key point =====\n        foreach($webconnections as $con) {\n            $con->send($data->message);\n        }\n    }\n};\n$inner_tcp_worker->listen();\n\n};\n$app_work->onConnect = function ($connection) use (&$users) {\n    $connection->onWebSocketConnect = function ($connection) use (&$users) {\n        // ===== Key point =====\n        $users[$_GET['user']][$connection->id] = $connection;\n        $connection->user = $_GET['user'];\n    };\n};\n$app_work->onClose = function ($connection) use (&$users) {\n    // ===== Key point =====\n    if (!isset($connection->user))  return;\n    unset($users[$connection->user][$connection->id]);\n};\n$app_work->args($status, true, 'server');\n$app_work->runAll(); \n. Thanks alot.. Thank you very much..php\n$ws_worker = new Worker(\"websocket://0.0.0.0:2346\");\n$ws_worker->onConnect = function($connection)\n{\n    $connection->onWebSocketConnect = function($connection , $http_header)\n    {\n        // Check $_SERVER['HTTP_ORIGIN'] here.\n        if($_SERVER['HTTP_ORIGIN'] != 'http://kedou.workerman.net')\n        {\n            $connection->close();\n        }\n        // $_GET and $_SERVER is also available here.\n        // var_dump($_GET, $_SERVER);\n    };\n}; \n```. I closed this issue because this is not workerman's issue but phpsocket.io\u2018s.\nPlease go to https://github.com/walkor/phpsocket.io/issues and create a new issue.. I closed this issue because this is not workerman's issue but phpsocket.io\u2018s.\nPlease go to https://github.com/walkor/phpsocket.io/issues and create a new issue.. @denfm \nThank you for your replay.\nCan you describe what specific bug is?. Thank you so much @denfm .\nI get it.\nWorkerman not obtaining TERM signal before this commit at 13 Oct. So when master process of workerman got a term signal it will exits leaving the child process which still listening. \nBut now workerman added an graceful stop with Term signal so it will works fine now.\nAnd strictly speaking, this is not a bug of workerman.. No, you don't have to  remove it. .  Sorry, the pull request is refused because there is no difference after merge the pull request. . Fixed and thank you for your issue.. Yes , I found extension ev is not stable enough .\nExtension event is also a high performance extension similar to ev.\n. Workerman prohibits recreating processes because they can make programs unstable(out of memory and zombie processes) when developers don't have enough experience.\nIt is recommended that you create enough task processes to handle time-consuming tasks.\nThese are the example.\ntask_worker.php\nphp\nuse Workerman\\Worker;\nrequire_once __DIR__ . '/Workerman/Autoloader.php';\n// task protocol\n$task_worker = new Worker('Text://0.0.0.0:12345');\n$task_worker->count = 100;\n$task_worker->name = 'TaskWorker';\n$task_worker->onMessage = function($connection, $task_data)\n{\n     $task_data = json_decode($task_data, true);\n     // Time-consuming task.\n     $task_result = ......\n     $connection->send(json_encode($task_result));\n};\nWorker::runAll();\nwebsocket_worker.php\n```php\nuse Workerman\\Worker;\nuse \\Workerman\\Connection\\AsyncTcpConnection;\nrequire_once DIR . '/Workerman/Autoloader.php';\n// websocket\n$worker = new Worker('websocket://0.0.0.0:8080');\n$worker->onMessage = function($ws_connection, $message)\n{\n    // connect to task worker.\n    $task_connection = new AsyncTcpConnection('Text://127.0.0.1:12345');\n    // task.\n    $task_data = array(\n        'function' => 'send_mail',\n        'args'       => array('from'=>'xxx', 'to'=>'xxx', 'contents'=>'xxx'),\n    );\n    // send task to task worker.\n    $task_connection->send(json_encode($task_data));\n    // get the result from task worker.\n    $task_connection->onMessage = function($task_connection, $task_result)use($ws_connection)\n    {\n         var_dump($task_result);\n         // remember close the task connection.\n         $task_connection->close();\n         $ws_connection->send('task complete');\n    };\n    $task_connection->connect();\n}\nWorker::runAll();\n```\nAlso see #165. . Forking child process on each connection is Inefficient, and the service will becomes unstable (memory exhaustion, zombie process etc).\nThere are many workerman users whose applications have more than 10 thousand client connections, so this solution is not applicable.. Here is an example.\n```php\n<?php\nrequire_once DIR . '/vendor/autoload.php';\nuse Workerman\\Worker;\nuse Workerman\\Lib\\Timer;\n// Max idle time\ndefine('MAX_IDLE_TIME', 30);\n$worker = new Worker('tcp://0.0.0.0:1234');\n$worker->onWorkerStart = function($worker){\n    // Global timer that check if any connection timedout\n    Timer::add(1, function()use($worker){\n        $time_now = time();\n        foreach($worker->connections as $connection) {\n           if ($time_now - $connection->lastMsgTime > MAX_IDLE_TIME) {\n              $connection->close();\n           }\n        }\n    });\n};\n$worker->onConnect = function($connection){\n    $connection->lastMsgTime = time();\n};\n$worker->onMessage = function($connection, $data)\n{\n    $connection->lastMsgTime = time();\n    $connection->send(\"hello $data \\n\");\n};\nWorker::runAll();\n```. Please use english, that can help all people to understand each other. Thanks. : -)\nOr you can send your question to http://wenda.workerman.net which is for chinese.\nAnyway, please describe the problem in detail or someone else can't help you. > 1. There are two master processes .\nHow do you judge there are two master processes?\n\n\nMaster process does not exit when stop.\n\n\nHow do you judge master process does not exit?\nCan you describe the problem in  more detail like this\uff1f\n1. Show the codes start.php.\n2. What operations have been done? Please paste screenshot.\n3. How do you judge problem occurred? Please paste screenshot.\nAnother important point is that...\nDo you modified the workerman source code?. Please try another php version. . Sorry, the pull request is refused because there is no difference after merge the pull request.. There is no description for the pull request. And I see there is other changes(Merge pull request\u00a0#1\u00a0from walkor/master\u00a0\u2026) which I not sure if it's ok.\nA small performance here is not helpful for the business.\nNo any bad things but no any good things.\nBut still thanks to farwish.\n. Please use https://certbot.eff.org/ to create ssl pem file and key.\nWhat is pem file look this.\nhttps://serverfault.com/questions/9708/what-is-a-pem-file-and-how-does-it-differ-from-other-openssl-generated-key-file. Thanks.. Good idea. And I think we need compatible old usage, so the codes may look like this\nphp\nif (isset($connection->worker->onWebSocketConnect) \n|| isset($connection->onWebSocketConnect))\n { ... }. This looks more rigorous.\nThanks.. Thank you so much.. php\nrequire_once('vendor/autoload.php');\nuse Workerman\\Worker;\n$context = array(\n    'ssl' => array(\n        'local_cert' => '/home/admin/conf/web/xxx.pem',\n        'local_pk' => '/home/admin/conf/web/xxx.key',\n        'verify_peer' => false,\n    )\n);\n$ws_worker = new Worker(\"websocket://xx.xx.xxxx:9999\", $context);\n$ws_worker->transport = 'ssl';\n$ws_worker->onWorkerStart = function()\n{\n    $inner_tcp_worker = new Worker(\"tcp://127.0.0.1:9998\");\n    $inner_tcp_worker->onMessage = function($connection, $data) {\n        $data = json_decode($data);\n        $to['tel'] = $data->to;\n        $to['msg'] = $data->message;\n        echo json_encode($to);\n        global $ws_worker;\n        if ($ws_worker->connections) {\n            $connection = current($ws_worker->connections);\n            $connection->send(json_encode($to));\n        }\n    };\n    $inner_tcp_worker->listen();\n};. I just added donate link in readme.\n\nThank you for your generosity.. Thank you so much.. Thank you so much.. It's a good feature, and I'll think about it.\nThank you so much.. #359 . Thank you so much. \ud83d\udc4d . Thanks.. Thank you for your pr.\nBut the idea here is to display an error that contains the call stack, not to throw it.. Thank you. \ud83d\udcaf . Thank you so much. \ud83d\udc4d . merged. merged.. Thanks.. Thanks for your issue. I will find the problem. . Fixed.. You can get query parameter by this way.\n<?php\nrequire_once __DIR__ . '/Workerman/Autoloader.php';\nuse Workerman\\Worker;\n$worker = new Worker('websocket://0.0.0.0:1234');\n$worker->onWebSocketConnect = function($connection, $header){\n    // $_GET is available here and we store it to $connection as dynamic property so we can use it later.\n    $connection->some_var = $_GET;\n};\n$worker->onMessage = function($connection, $data)\n{\n    var_export($connection->some_var);\n    $connection->send('123');\n};\nWorker::runAll();. Thanks.. Please use english, that can help all people to understand each other.\nAnd it is not workerman's issue but gatewayWorker's. \nPlease move the issue to here.\nThanks.. Thank you so much. \ud83d\udc4d . Thank you for your issue. \nBut php 5.3 or Higher is ok.\nWorkerman not only support php7 but php 5.3 is also supported.. Here is for the project for windows.\nhttps://github.com/walkor/Workerman-for-win. ```php\n<?php\nrequire_once DIR . '/Workerman/Autoloader.php';\nuse Workerman\\Worker;\nuse Workerman\\Protocols\\Websocket;\n$worker = new Worker('websocket://0.0.0.0:12345');\n$worker->onConnect = function($connection){\n    $connection->websocketType = Websocket::BINARY_TYPE_ARRAYBUFFER;\n};\n$worker->onMessage = function($connection, $data)\n{\n    $connection->send('hello');\n};\nWorker::runAll();\n```\nHere are the codes. Sorry for delay.. Sorry, I can't reproduce this problem.\nIs there any special operation?\nDo you called ws.close() at JS-client side?. I think you can send a message to js client tell the client to close the ws connection by it self. . Thanks.. Done.. \u6709\u6d4b\u8bd5\u7684\u4f8b\u5b50\u4e48\uff1f. It looks like the PID file is missing.\nYou can use Worker::$pidFile = '/your/path/of/workerman.pid'; before Worker::runAll(); to set the pid file to a safe path.\nThe default pid path is the in workerman parallel position.. Thanks.. I am not familiar with ssl.\nverify_peer looks like an option that whether to verify the remote certificate.\nIf verify_peer=true then the remote client side must has a certificate.\nAlso cafile option must be setted in server side if verify_peer=true.\nHere are the ssl options in php manual. Hope that will help.. > But instead, I'm seeing the worker waiting for each task to finish, to handle the next one.\nYes, PHP is a single threaded program, and the task within each process is wait for a serial execution.. Workerman can handle many connections, but all requests from these connections are processed one by one in one php process. Multiple processes are processed in parallel.. Thank you for your pull request.\nSTREAM_CRYPTO_METHOD_TLSv1_0_SERVER STREAM_CRYPTO_METHOD_TLSv1_1_SERVER STREAM_CRYPTO_METHOD_TLSv1_2_SERVER  only support by php >=5.6 but workerman requires php >= 5.3.3 that may cause problems in many projects.\nAnd I found the value \nSTREAM_CRYPTO_METHOD_SSLv2_SERVER | STREAM_CRYPTO_METHOD_SSLv23_SERVER\n is equal to \nSTREAM_CRYPTO_METHOD_SSLv2_SERVER | STREAM_CRYPTO_METHOD_SSLv23_SERVER  | STREAM_CRYPTO_METHOD_TLSv1_0_SERVER | STREAM_CRYPTO_METHOD_TLSv1_1_SERVER | STREAM_CRYPTO_METHOD_TLSv1_2_SERVER for php >=5.6.  \nSo I will use STREAM_CRYPTO_METHOD_SSLv2_SERVER | STREAM_CRYPTO_METHOD_SSLv23_SERVER as default crypto_type.. Please show your status with command php your_start_file.php status.. It works fine for me.\nHere is the codes.\n```php\n<?php\nrequire_once DIR . '/Workerman/Autoloader.php';\nuse Workerman\\Worker;\nuse Workerman\\Lib\\Timer;\n$w = new \\Workerman\\Worker(); \n$w->onWorkerStart=function(){\n    $timer_id=Timer::add(1,function()use($timer_id){\n        var_dump(time());\n    },[],true);\n    Timer::add(10,function()use($timer_id){\n        var_dump('delete'.$timer_id);\n        Timer::del($timer_id);\n        Timer::delAll();\n    },[],false);\n}; \n\\Workerman\\Worker::runAll();\noutput\nint(1512357687)\nint(1512357688)\nint(1512357689)\nint(1512357690)\nint(1512357691)\nint(1512357692)\nint(1512357693)\nint(1512357694)\nint(1512357695)\nstring(7) \"delete1\"\n. Unfortunately, timer not support this feature.\nBut you can do it like this.php\n$task = new Worker();\n$task->onWorkerStart = function($task)\n{\n    // 2.5 seconds\n    $time_interval = 2.5; \n    $function = function() {\n            echo \"Timer run\\n\";\n    };\n    $timer_id = Timer::add($time_interval, $function);\n   $functuon(); // exec function without interval waiting\n};\n.php\n<?php\nrequire_once DIR . '/vendor/autoload.php';\nrequire_once DIR . '/public/index.php';\nrequire_once DIR . '/functions.php';\nuse Illuminate\\Support\\Facades\\Redis;\nuse PHPSocketIO\\SocketIO;\nuse Workerman\\Lib\\Timer;\nuse Workerman\\Worker;\n$io    = new SocketIO(2022);\n$io->on('connection', function ($socket) use (&$io) {\n    Timer::delAll();\n    Timer::add(1,bar($io));\n});\n$io->on('workerStart', function()use($io) {\n    Timer::add(1, 'bar', array($io));\n});\nfunction bar($io) \n{\n    return function () use (&$io) {\n        var_dump(time());\n        $io->emit('foo','test');\n    };\n};\nWorker::runAll();\n```\nAlso see https://github.com/walkor/phpsocket.io/issues/125 .. Here is an example for nginx proxy for workerman with SSL.\nWorkerman.\n```php\n<?php\nrequire_once DIR . '/Workerman/Autoloader.php';\nuse Workerman\\Worker;\n$worker = new Worker('websocket://0.0.0.0:8282');\n$worker->onMessage = function($connection, $data)\n{\n    $connection->send($data);\n};\nWorker::runAll();\n```\nNginx conf.\n```\nserver {\n  listen 443;\nssl on;\n  ssl_certificate /your/path/of/ssl/server.pem;\n  ssl_certificate_key /your/path/of/ssl/server.key;\n  ssl_session_timeout 5m;\n  ssl_session_cache shared:SSL:50m;\n  ssl_protocols SSLv3 SSLv2 TLSv1 TLSv1.1 TLSv1.2;\n  ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;\nlocation /\n  {\n    # Websocket port 8282\n    proxy_pass http://127.0.0.1:8282;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"Upgrade\";\n    proxy_set_header X-Real-IP $remote_addr;\n  }\n}\n. Fixed. Please update workerman-3.5.4-stable..php\n$user_data = [];\n$ws_worker->onConnect = function($connection) use (&$user_data){\n    $connection->onWebSocketConnect = function ($connection) use (&$user_data) {\n        $user_data['email'] = $_GET['user'];\n        //$user_data['email']['id'] = $connection->id;\n               // ======= Here is right======\n               var_dump($user_data);\n    };\n        // Not here.\n    // var_dump($user_data);\n};\n. You should declare$user_dataas a global variable like this in every callback function when you need it.php\n$ws_worker->onWorkerStart = function($ws_worker){\n    $time_interval = 1.0; \n    $timer_id = Timer::add($time_interval, \n        function()\n        {\n                global $user_data;\n        echo $user_data['email']; // this variable empty in this function\n    }     \n}\n. Please install event extension.. Try this.\napt-get install libevent-dev\npecl install event\nAddextension=event.soto php.ini.. Try to run commandulimit -HSn 102400`` and restart workerman.. Run commandtopand see which process cost cpu.. The output shows the process of pid 20738 cost cpu %22.\nRun commandstrace -ttp 20738`  can show what the process doing.\nBy the way %22 is not much for the machine with 8 cpu cores.. The values of STREAM_CRYPTO_METHOD_SSLv2_SERVER | STREAM_CRYPTO_METHOD_SSLv23_SERVER and  STREAM_CRYPTO_METHOD_TLSv1_0_SERVER | STREAM_CRYPTO_METHOD_TLSv1_1_SERVER | STREAM_CRYPTO_METHOD_TLSv1_2_SERVER | STREAM_CRYPTO_METHOD_SSLv2_SERVER | STREAM_CRYPTO_METHOD_SSLv23_SERVER are equal for php>=5.6, so it is not necessary to judge the php version.. Can you show your codes?. You can do it like this when you do not want to reconnect .\nphp\n$conn->onClose = null;\n$conn->close();. php\n        $conn->onConnect = function($conn) {\n            // ====== can not use $this in Anonymous function. =======\n            $this->_conn = $conn;\n            log::info(\"\u8fde\u63a5 [\".$conn->getRemoteIp().':'.$conn->getRemotePort().'] \u6210\u529f');\n        };\n$conn->onConnect is Anonymous function and can not use $this in it.\nThe same problem with onMessage onError onClose.... When $conn->reConnect($timeout) is called a timer for reconnection will start insideAsyncTcpConnection  , but AsyncTcpConnection has no \n api to cancel the timer at present, so the reconnection will eventually be executed. \nYou can create your connection class by extending AsyncTcpConnection and add a cancelRecconect method  which like this.\nphp\npublic function cancelReconnect(){\n    Timer::del($this->_reconnectTimer);\n}. Variables between different processes are separated, unable to share or be accessed across processes.. @bleid3 Yes, it is a correct way.. Thanks.. Unfortunately, no such interface is implemented.\nI think you can write a class to inherit the Workerman\\Protocols\\Websocket class to implement it.. Is the problem still in existence? How to judge the failure of the stop\uff1f.  How to judge the failure of the stop\uff1f\nany screenshot ?. The reasons for stop fail I can think of are the following.\n\nPressed Ctrl Z to cause the process to hang up. \nThe user that runs the stop command is not the same as the startup user. \nThe PID stored in the PID file is overdue (for example, the server restarts), and the process of pid is not a workerman process. The solution for this case is to delete the workerman's PID file and try again.. Closing this due to a lack of feedback.\nPlease come back with more details if this problem persists and we can reopen this\u00a0. Please start workerman as daemon mode.. Thanks.. Can you show all of your codes.. Please replace\nphp\nrequire_once($template_file);\n with\nphp\nrequire($template_file);\nin Sunphp/Lib/Controls/TemplateControl.php line 40.\n\nThe second time loading php the same files via require_once will not work in workerman,  because workerman is the memory-resident framework. \n. https://github.com/walkor/Workerman/commit/5a954448b05287888e1b1b8ea11c393376d83903\nFixed and thanks.. The codes works fine for me.\nCan you tell me what kind of browser and version you use. \nAnd please show the codes of client side.. I find some links help that will help.\nhttps://support.cloudflare.com/hc/en-us/articles/200170706-How-do-I-restore-original-visitor-IP-with-Nginx-\nhttps://support.cloudflare.com/hc/en-us/sections/200805497-Restoring-Visitor-IPs\nhttps://www.sunnyhoi.com/how-to-find-real-ip-address-website-behind-cloudflare/\nYou can also search the key words cloudflare real ip by your self.. No reason, not close standard input has no effect on workerman.. The certificate must be a valid certificate.\nThe certificate specifies which domain name is used to access it, so please confirm that 127.0.0.1 is legal for the certificate. \n\nI found that https://firstsender.com:2346/'s certificate is not the same as the https://firstsender.com/'s certificate, and https://firstsender.com:2346/'s certificate has expired. You are welcome.. It looks like the permissions of the operating system.\n. decode() should  be called after input() check.\ndecode() only be called when input() return >0.\nhttps://github.com/walkor/Workerman/blob/master/Protocols/Websocket.php#L51\nwill make sure the buffer length will not be less than 2.\nSo I don't know why you have the waring.\nDo you call decode() manually?\nYou can add some codes to show the call stack like this.\nphp\n    public static function decode($buffer, ConnectionInterface $connection)\n    {\n        $masks = $data = $decoded = null;\n        // Show the call stack.\n        if (strlen($buffer)<2) echo new \\Exception('we need more buffer');\n        $len = ord($buffer[1]) & 127;\n        if ($len === 126) {\n            $masks = substr($buffer, 4, 4);\n            $data  = substr($buffer, 8);\n       ..... Closing this due to a lack of feedback.\nIf this problem persists and we can reopen this.. I agree with @farwish .. It works fine for me. \nCan you show your codes?\ninitWorkers should not be called in the windows system, and we do not want the master process listen port because windows can not use fork() method to create multi processes.  The mechanism here is different from the Linux system.. Closing this due to a lack of feedback.\nIf this problem persists and we can reopen this.. Try the repo https://github.com/walkor/phpsocket.io .. You can just close the new connection with $connection->close() when the user's connection exists.. you can close the old one and keep the new one.. If you want to both two devices can receive messages, you need to keep the two connections. You can not replace new connection with old one.. try the following:\nphp\n$worker->onWorkerStart = function() use ($maxtime) {\n    // set timer to exit the process\n    \\Workerman\\Lib\\Timer::add($maxtime, function() {\n        echo \"Work ended.\".PHP_EOL;\n        // Send signal SIGINT to master pid and then stop all processes.\n        posix_kill(posix_getppid(), SIGINT);\n    });\n    // do more stuff\nYou can not stop one process because master process will fork one immediately.\nBut you can stop all process by codes posix_kill(posix_getppid(), SIGINT);.\nHope that will help.. Thanks.. Great! Thanks.. Thanks a lot.. Good.\nThank you so much.. There is a project hoping to help you.\nhttps://github.com/kiddyuchina/Beanbun. Thanks a lot.. Thanks.. > Client id calculated by $local_ip, $local_port and $connection_id.\nThe $connection_id is created by gateway::generateConnectionId , so there's no need to change  anything for TcpConnection.php. \nYou can modify behavior of gateway::generateConnectionId by extending gateway class.\n. This library dos not support socketIO, but phpsocket.io supports socketIO. \nUnfortunately socketIO does not support multiple threads.. PHP native SSL does not support multidomain settings, so this feature does not seem to be implemented at present.. Thanks.. Thanks a lot.. Thank you so much.. Thanks. \ud83d\udc4d . I'm not sure.\nIt looks like a network timeout.\nHow can I reproduce this?. I guess thundering herd caused this error. Try to set $worker->reusePort = true; that may help.\nSee https://github.com/walkor/Workerman/issues/156. \nThere is an operator @ to ignore error at \nhttps://github.com/walkor/Workerman/blob/fbfd9abe7a0415c3568bbbea7604a7bd0f460200/Worker.php#L2171. May be your codes has set set_error_handler() and threw the exception.\n. Closing this due to a lack of feedback.\nPlease come back with more details if this problem persists and we can reopen this.. Thanks. \ud83d\udc4d . @wujingke \nBased on the discussion with you, the PR will be closed.\nThank you very much for your PR.\n. Good job. Thanks.. Yes, you should turn it on manually with codes like this.\nphp\nWorker::$eventLoopClass = '\\Workerman\\Events\\Swoole';\nSee #294 . Thank you for your PR.\nBut this feature is new and has not yet proved complete stability and availability, so it can not be accepted as a default setting at the moment.\nYou should turn it on manually with codes like this.\nphp\nWorker::$eventLoopClass = '\\Workerman\\Events\\Swoole';\n. Thanks.. \ud83d\udc4d . Good job and Thank you so much. \ud83d\udc4d . Done.. Workerman can accept multiple client by default.. Can you show all your codes?. Closing this due to a lack of feedback.\nPlease come back with more details if this problem persists and we can reopen this.. Which protocol do you use? websocket?. Here is an example.\nphp\n$ws = new Worker('websocket://0.0.0.0:8181');\n$ws->onConnect = function($connection)\n{\n    $connection->onWebSocketConnect = function($connection , $http_header)\n    {\n        // var_dump($_GET, $_SERVER);\n    };\n};\n. Can you  show all your codes?. Closing this due to a lack of feedback.\nPlease come back with more details if this problem persists and we can reopen this\u00a0. Maybe you setted $worker->user = '...'; in your codes which only working when start workerman as root privileges. So just remove $worker->user = '...'; $worker->group = '...'; in your codes.\nAlso you can ignore this warning because the user of the running process is already apache-user.. Fixed.. Try to use https://github.com/reactphp/event-loop/releases/tag/v0.4.3.. The pr closed because Event::exit(); has syntax error when php  version<7.0.\nThank you for your pr.. Please  keep workerman running and try to run command php x.php status in other terminal and show the outputs.\nAlso show outputs of php -m.. Yes, possible swoole's Bug.  Use ev extension and event extension will be more stable.. Sorry for delay.\nChannel\\Client only works in workerman environment. \nBut we can create an new class to do that, here is the example.\n```php\n<?php\nnamespace Channel;\nclass Client \n{\n    /\n     * Connction to channel server.\n     * @var TcpConnection\n     */\n    protected static $_remoteConnection = null;\n    /\n     * Channel server ip.\n     * @var string\n     /\n    protected static $_remoteIp = null;\n    /\n     * Channel server port.\n     * @var int\n     /\n    protected static $_remotePort = null;\n/**\n * Connect to channel server\n * @param string $ip\n * @param int $port\n * @return void\n */\npublic static function connect($ip = '127.0.0.1', $port = 2206)\n{\n    if(!self::$_remoteConnection)\n    {\n         self::$_remoteIp = $ip;\n         self::$_remotePort = $port;\n         self::$_remoteConnection = stream_socket_client('tcp://'.self::$_remoteIp.':'.self::$_remotePort, $code, $message, 5);\n         if (!self::$_remoteConnection) {\n             throw new \\Exception($message);\n         }\n     }    \n}\n\n/**\n * Publish.\n * @param string $events\n * @param mixed $data\n */\npublic static function publish($events, $data)\n{\n    self::connect();\n    $body = serialize(array('type' => 'publish', 'channels'=>(array)$events, 'data' => $data));\n    $buffer = pack('N', 4+strlen($body)) . $body;\n    fwrite(self::$_remoteConnection, $buffer);\n}\n\n}\nClient::connect('127.0.0.1', 2206);\nClient::publish('broadcast', ['content'=>'something']);\n```\nIt works fine for me.. Done.. Please upgrade  workerman. This issue fixed in version 3.5.6.. What is the version of react/event-loop\uff1f. Please try to update the latest version of react/event-loop.. Thanks for the pr.\nThis pr closed because the error still exist after merging. \nYou can send Sec-WebSocket-Protocol like this.\n```php\n<?php\nrequire_once DIR . '/vendor/autoload.php';\nuse Workerman\\Worker;\nuse Workerman\\Protocols\\Websocket;\n$worker = new Worker('websocket://0.0.0.0:12345');\n$worker->onConnect = function($connection){\n    $connection->onWebSocketConnect = function($connection, $header) {\n        // Set Sec-WebSocket-Protocol header.\n        $connection->headers = array('Sec-WebSocket-Protocol: ' . $_SERVER['HTTP_SEC_WEBSOCKET_PROTOCOL']);\n    };\n};\n$worker->onMessage = function($connection, $data)\n{\n    $connection->send('hello');\n};\nWorker::runAll();\n. Is this what you want?php\n$ws_worker->onWorkerStart = function($ws_worker)\n{\n    $time_interval = 5;\n    $timer_id = Timer::add($time_interval,\n        function() use ($ws_worker)\n        {\n            foreach($ws_worker->connections as $connection) {\n                $connection->send('text');\n            }\n        }\n    );\n};\n. You are welcome.. You can send img tag liketo client.\nIt will be downloaded automatically by HTTP when the browser renderings the img tag. . yes. Thanks.. Thanks. \ud83d\udc4d . Yes Ws.php is client side protocol.\nIf client send ping then workerman(as websocket server) will send pong automatically.  \nSo you do not do anything.. You can use Timer to send pings to client like this.php\nuse Workerman\\Lib\\Timer;\n$worker = new Worker('websocket://0.0.0.0:8080');\n$worker->onWorkerStart = function($worker) {\n    $time_interval = 10;\n    Timer::add($time_interval, function()use($worker)) {\n        foreach($worker->connections as $connection) {\n            $connection->send(pack('H*', '890400000000'), true)\n        }\n    }\n};\n``. Yes898000000000is wrong.890400000000` is correct.\nThe close package is $connection->send(pack('H*', '8800'), true);\nonWebSocketClose will be called when a close frame received for websocket. onClose will be called when  a fin package received for tcp.  The order is usually onWebSocketClose followed by onClose.\n. Please zip all project then upload it and show how to reproduce the problem.. You use channel to do that.\nThese links may help.\nhttps://github.com/walkor/Workerman/issues/175\nhttps://github.com/walkor/Workerman/issues/184. Thanks.. Thanks.. What is the problem?. It is workerman's bug?. Thank you for your pr.\nBut how can I reproduce this problem?. Thanks a lot.. This is not workerman's issue but gatewayworker's.\n\nUndefined class constant 'CMD_ON_CONNECTION' in /data/wwwroot/sd_watch_gateway/vendor/workerman/gateway-worker/src/BusinessWorker.php:377\n\nThere is no key words CMD_ON_CONNECTION in https://github.com/walkor/GatewayWorker/blob/master/src/BusinessWorker.php#L377 .\nPlease make sure you upgraded to the latest version.. Gateway::VERSION in src/Gateway.php.. Can you show codes of /data/wwwroot/sd_watch_gateway/vendor/workerman/gateway-worker/src/BusinessWorker.php:377 \u3002. gateway-worker/src/BusinessWorker.php:377\nAs you see ,  error message Undefined class constant 'CMD_ON_CONNECTION' will not happen here.\nTry restart your gateway after upgrade.. You are welcome.. Closing this due to a lack of feedback.\nPlease come back with more details if this problem persists and we can reopen this.. Can you  show the codes of /Applications/XAMPP/xamppfiles/htdocs/Workerman/Worker.php on line 530?. Closing this due to a lack of feedback.\nPlease come back with more details if this problem persists and we can reopen this.. Worker has a id property.\nYou can add prefix to connection->id to make it unique like this.\nphp\n$worker = new Worker('websocket://0.0.0.08080');\n$worker->count = 8;\n$worker->onConnect = function($connection) use ($worker){\n    $connection->id = $worker->id.$connection->id;\n};\n.... Thanks.. Workerman is a generic socket framework which not designed specifically for HTTP.\nWorkerman can support many protocols, and it will not make special implementation for any communication protocol.. Sorry, I mean workerman will not provide these features. . Fixed. . You can create a websocket connection in your web page and send command to any devices.. Try the codes.\n```\nuse Workerman\\Worker;\nuse Workerman\\Lib\\Timer;\nrequire_once DIR . '/Workerman/Autoloader.php';\n$worker = new Worker();\n$worker->count = 4;\n$worker->onWorkerStart = function($worker)\n{\n    // only process 0 start a timer\n    if($worker->id === 0)\n    {\n        Timer::add(1, function(){\n            echo \"works\\n\";\n        });\n    }\n};\nWorker::runAll();\n. Moved to https://github.com/walkor/phpsocket.io/issues/159.. Connection id is not unique for every processes but for one process.\nConnection id maybe the same for many processes.\nConnection id is an id for one process not for global.\nSee https://github.com/walkor/Workerman/issues/333. You are welcome..php\nuse Workerman\\Worker;\nrequire_once DIR . '/autoload.php';\n// Channel Server.\n$channel_server = new Channel\\Server('0.0.0.0', 2206);\n$worker = new Worker('websocket://0.0.0.0:2342');\n// 6 processes.\n$worker->count=6;\n$worker->onWorkerStart = function($worker)\n{\n    // Channel client connect to Channel Server.\n    Channel\\Client::connect('127.0.0.1', 2206);\n    // Subscribe $worker->id event .\n    Channel\\Client::on($worker->id, function($data)use($worker){\n        $content = $data['content'];\n        $id      = $data['id'];\n        if (isset($worker->connections[$id])) {\n            $worker->connections[$id]->send($content);\n        }\n    });\n};\n$worker->onConnect = function($connection) use ($worker)\n{\n    echo \"New connection from ip: \" . $connection->getRemoteIp() .\"\\n\"; // \u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u044c\n    //global $id;\n    $id = $worker->id.$connection->id; // id write\n    echo \"Connect client: $id\\n\";\n};\n$worker->onMessage = function($connection, $data) {\n   if (strpos($data, 'Browser:') !== false) {\n    $wid = $data[9];//substr($data, 10);\n    $evsid = substr($data, 10);\n    $worker_id = $wid;\n    $message = \"EVS LED ON\";\n    Channel\\Client::publish($worker_id, ['id'=>$evsid, 'content'=>$message]);\n   }\n};\nWorker::runAll();\n.  Fixed and please try again.. Please try to update react/event-loop to the latest version.\nReact/event-loop changed the React\\EventLoop\\LoopInterface since v0.5.0..php\nfwrite($this->_socket, $this->_sendBuffer, 8192);\n8192 is not buffer size limit, but the length of data for fwrite.\nThe send buffer size limit byTcpConnection::$defaultMaxSendBufferSizewhich default value is 1024*1024 Bytes and can be change by codesTcpConnection::$defaultMaxSendBufferSize = 10010241024;. Removed the length param for write.\nBut for ssl connection the length param must be setted due to https://bugs.php.net/bug.php?id=72333 .. Thanks.. Closed because there is no pcntl or posix extensions for windows.. Thank you for your pr.\nWebServer has already supported setting  custom404 page.\nFor example.php\n<?php\nrequire_once DIR . '/../Workerman/Autoloader.php';\nuse Workerman\\WebServer;\nuse Workerman\\Worker;\n$web = new WebServer('http://0.0.0.0:8181');\n$web->addRoot('example.com', ['custom404' => DIR . '/404page.html', 'root' => DIR . '/web']);\nWorker::runAll();\n. Variables of different processes can not be shared.\nBut you can use mysql/redis etc as an global storage to share data.. Work well.. You are welcome.. OS_TYPE_LINUX defined in file https://github.com/walkor/Workerman/blob/master/Lib/Constants.php.\nPlease check.. Great.\nThank you so much.. \ud83d\udc4c. Thanks. \ud83d\udc4d . Example.php\n$ws = new Worker('websocket://0.0.0.0:8181');\n$ws->onConnect = function($connection)\n{\n    $connection->onWebSocketConnect = function($connection , $http_header)\n    {\n        echo $connection->getRemoteIp(),\"\\n\";\n        echo $_SERVER['HTTP_ORIGIN'],\"\\n\";\n        if ($auth_fail) $connection->close();\n    };\n};\n``. You are welcome. . As this message happens when workerman gets http requtest rather than https/wss.. MySql server will close connection when the connection idle forinteractive_timeout` seconds which can be change in my.conf.\nThe error message will be displayed when the php process closing and then mysql extension will send close package to mysql server by the closed connection. \nYou can close the mysql connection manually when the the task completed then the close package will not send again to mysql server.\nFinally,  this is not a serious problem. You can just ignore it. \n. Thanks. Thanks. $ws_worker and $tcp_worker are in different processes.\nVariables can not be shared in different processes.\nSo the codes not work.\nThe URL provided by @dns582 is the right choice.. Server with one process which listen both websocket and tcp. \n```php\n<?php\nuse Workerman\\Worker;\nrequire_once './Workerman/Autoloader.php';\nglobal $worker;\n$worker = new Worker('websocket://0.0.0.0:1234');\n$worker->count = 1;\n$worker->onWorkerStart = function($worker)\n{\n    $inner_text_worker = new Worker('tcp://0.0.0.0:5678');\n    $inner_text_worker->onMessage = function($connection, $buffer)\n    {\n        global $worker;\n        $data = json_decode($buffer, true);\n        $uid = $data['uid'];\n        $ret = sendMessageByUid($uid, $buffer);\n        $connection->send($ret ? 'ok' : 'fail');\n    };\n    $inner_text_worker->listen();\n};\n$worker->uidConnections = array();\n$worker->onMessage = function($connection, $data)use($worker)\n{\n    if(!isset($connection->uid))\n    {\n       $connection->uid = $data;\n       $worker->uidConnections[$connection->uid] = $connection;\n       return;\n    }\n};\n$worker->onClose = function($connection)use($worker)\n{\n    global $worker;\n    if(isset($connection->uid))\n    {\n        unset($worker->uidConnections[$connection->uid]);\n    }\n};\nfunction broadcast($message)\n{\n   global $worker;\n   foreach($worker->uidConnections as $connection)\n   {\n        $connection->send($message);\n   }\n}\nfunction sendMessageByUid($uid, $message)\n{\n    global $worker;\n    if(isset($worker->uidConnections[$uid]))\n    {\n        $connection = $worker->uidConnections[$uid];\n        $connection->send($message);\n        return true;\n    }\n    return false;\n}\nWorker::runAll();\n```\njavascript.\njavascript\nvar ws = new WebSocket('ws://127.0.0.1:1234');\nws.onopen = function(){\n    var uid = 'uid1';\n    ws.send(uid);\n};\nws.onmessage = function(e){\n    alert(e.data);\n};\nNotify the user.\nphp\n$client = stream_socket_client('tcp://127.0.0.1:5678', $errno, $errmsg, 1);\n$data = array('uid'=>'uid1', 'percent'=>'88%');\nfwrite($client, json_encode($data));\necho fread($client, 8192);. Please install event extension.\n. Are you sure CMD [\"/usr/sbin/php-fpm7.2\", \"-F\", \"./chatter/web/ws/index.php start -d\"] not CMD [\"/usr/sbin/php\", \"-F\", \"./chatter/web/ws/index.php start -d\"] ?\nAnd can you show the codes of ./chatter/web/ws/index.php?. Workerman works only in php cli, but CMD [\"/usr/sbin/php-fpm7.2\", \"-F\", \"./chatter/web/ws/index.php start -d\"] seems use php-fpm.. It works fine for me.\nPlease run command tcpdump -AXXns 4096 -iany port 8891 and retry then show the output.. \nTry to add codes echo \"input:\",bin2hex($buffer),\"\\r\\n\"; to Protocols/Websocket.php like this. \nRestart workerman and run command tcpdump -AXXns 4096 -iany port 8891 and retry then show the output.. Please compress and upload all the codes.. \n\nIt works fine for me.. Closing since it seems we can't help here.. I should say thank you.\nI am sorry to have failed to help you.\nAt present, no user has ever responded to similar problems. I will continue to try to locate this problem.. If mbstring.func_overload = 2/3/7 in php.ini then the behavior of function strlen() will changed and the error happened. \nPhp manual : http://www.php.net/manual/en/mbstring.overload.php\nSo make sure the mbstring.func_overload = 0 in your php.ini every thing will work fine.. Thanks a lot. \ud83d\udc4d . I'm not sure. \nThe codes format looks disordered. . Please format the codes and I will try check again.. That's ok\uff0c please send pr.\nThank you.. Merged and thanks.. Please try run command composer require react/event-loop and try again.\n. Closing this due to a lack of feedback.\nPlease come back with more details if this problem persists and we can reopen this\u00a0. Thanks.. Thank you for your PR.\nBut the PR closed because there are some obvious mistakes in the codes.\n1. FatalError PHP Parse error:  syntax error, unexpected '[' in ./Workerman/Worker.php on line 1211 for php 5.3.x .\n2.\nphp\n        if (static::$eventLoopClass) {\nseems like wrong.\nphp \nif (!static::$eventLoopClass)\nseems like all right.\nI don't know if there is any other mistakes.\nI don't think getEventLoopName needs to be changed too much.\nFinally, thank you very much for your PR.. Developer can decide which event-loop class to be use by codes Worker::eventLoopClass=$someValue. \nSo the code may like this\nphp\nif (!static::$eventLoopClass) {\n   $class = try_to_select_one();\n   static::$eventLoopClass = $class;\n} else {\n    return static::$eventLoopClass;\n}\nEV extension is not stable enough so it not in Worker::$_availableEventLoops.\nYes, please fix your last merge of phpsocket.io. \nThank you for support.. php\n$worker = new Worker();\n$worker->onWorkerStart = function(){\n    $addr = '127.0.0.1: 3120';\n    $io_con = new AsyncTcpConnection(\"tcp://$addr\");\n    $io_con->addr = $addr;\n    $io_con->onConnect = function($io_con){\n        $io_con->send(\"GET /socket.io/?EIO=3&transport=polling&t=1536989364696-0 HTTP/1.1\\r\\nOrigin:null\\r\\n\\r\\n\");\n    };\n    $io_con->onMessage = function($io_con, $data){\n        preg_match('/\"sid\":\"(.*?)\"/', $data, $match);\n        $sid = $match[1];\n        $io_con->onMessage = function($io_con, $data){\n            $io_con->protocol = '\\Workerman\\Protocols\\Ws';\n            $io_con->handshakeStep = 2;\n            $io_con->websocketCurrentFrameLength = 0;\n            $io_con->websocketDataBuffer         = '';\n            $io_con->tmpWebsocketData            = '';\n            $io_con->send('2probe');\n            $io_con->onMessage = function($io_con, $data){\n                // complete socket.io handshake\n                $io_con->send('5');\n                // get message from socket.io server\n                $io_con->onMessage = function($io_con, $data){\n                    echo \"recv from server:$data\";\n                    $io_con->send('42'.json_encode(array('chat message', 'hello workerman')));\n                };\n                // heartbeat detection\n                $io_con->timer_id = Timer::add(55, function()use($io_con){\n                    $io_con->send('2');\n                });\n                $io_con->close = function($io_con){\n                    Timer::del($io_con->timer_id);\n                };\n            };\n        };\n        $io_con->send(\"GET ws://{$io_con->addr}/socket.io/?EIO=3&transport=websocket&sid=$sid HTTP/1.1\\r\\nConnection: Upgrade\\r\\nUpgrade: websocket\\r\\nSec-WebSocket-Key: 8puc4jWM6pe+oc5YrZDDTA==\\r\\n\\r\\n\");\n    };\n    $io_con->connect();\n};\nWorker::runAll();\nSocket.io has its own communication protocol based on http and websocket.\nHere is an example.. Use var_dump to display outgoing data.\nUse $socket->emit('event', $data) to send data to browser.\n. Thanks.. Here is an example for javascript.\njavascript\nws = new WebSocket(\"ws://ip:1111\");\nws.onopen = function() {\n    ws.send('tom');\n};\nws.onmessage = function(e) {\n    // browser will recv data from workerman\n    alert(\"recv:\" + e.data);\n};. Sorry for my last answer.\nYou can use channel to do multi workers communication.\nThese links may help.\nhttps://github.com/walkor/Workerman/issues/175\nhttps://github.com/walkor/Workerman/issues/184\nhttps://github.com/walkor/Workerman/issues/317\n. You are welcome.. Thanks.. \u4ec0\u4e48\u60c5\u51b5\u4e0b\u9700\u8981\u5730\u5740\u7684host\u4e0ehttp header\u4e2d\u7684host\u4e0d\u540c\u5462\uff1f. \u53d1\u4e00\u4e2apr\u5427. Ws prptocol support host setting now.\nphp\n$ws_connection = new AsyncTcpConnection(\"ws://workerman.net:7272\");\n$ws_connection->headers = array('Host' =>'workerman.net');\n$ws_connection->onMessage = function($con, $data){\n    var_export($data);\n};\n$ws_connection->connect();. Ws prptocol support host setting now.\nphp\n$ws_connection = new AsyncTcpConnection(\"ws://workerman.net:7272\");\n$ws_connection->headers = array('Host' =>'workerman.net');\n$ws_connection->onMessage = function($con, $data){\n    var_export($data);\n};\n$ws_connection->connect();\nClosed.. You can del the old timer and add a new one.. Thank you for your pr.\nWorkerman had this feature before and removed because it will lead to unpredictable behavior.\nFor example, the following file and codes.\nwebsocket.php\nphp\n<?php\n$worker = new Worker('websocket://0.0.0.0:1234');\n...\nIt will load the websocket.php indefinitely.\nSo this can not be merged. \nAnyway, thank you very much. . Not all closure of a client can be track.\nSome time client can not send fin package to the server for example the network closed unexpectedly.\nIF server not receive a fin package it will think that the connection is not break so the onClose callback not will be fired.\nYou can send something to client to detect the broken, and this is why all the long connection applications maintain the heartbeat on the application layer.. Thanks.. Just require_once the Client file before initialize the Client class.. You can use spl_autoload to load undefined class .\nhttp://php.net/manual/en/function.spl-autoload.php. Workerman does not support this feature.. Thank you for your pr.\nBut windows does not support pcntl or posix extension and sockets extension  is not necessary for workerman.\nThere are also some useless properties added private $socket private $status private $workerId in this pr.\nSo the pr closed.\nThanks.. php\n```php\n<?php\nrequire_once DIR . '/Workerman/Autoloader.php';\nuse Workerman\\Worker;\n$context = array(\n    // more ssl context see http://php.net/manual/zh/context.ssl.php\n    'ssl' => array(\n        'local_cert'                 => '/your/path/of/server.pem', \n        'local_pk'                   => '/your/path/of/server.key',\n        'verify_peer'                => false,\n        'allow_self_signed' => true, \n    )\n);\n$worker = new Worker('websocket://0.0.0.0:443', $context);\n$worker->transport = 'ssl';\n$worker->onConnect = function($con){\n    $con->onWebSocketConnect = function($con, $http_header){\n        var_dump($_SERVER);\n    };\n};\n$worker->onMessage = function($con, $msg) {\n    $con->send('ok');\n};\nWorker::runAll();\n```\njavascript\njavascript\nws = new WebSocket(\"wss://domain.com/chat-appllication\");\nws.onopen = function() {\n    alert(\"connect success\");\n    ws.send('tom');\n};\nws.onmessage = function(e) {\n    alert(\"recv\uff1a\" + e.data);\n};. You can use nginx as ssl proxy like this.\nPHP\n```php\n<?php\nrequire_once DIR . '/Workerman/Autoloader.php';\nuse Workerman\\Worker;\n$worker = new Worker('websocket://0.0.0.0:8282');\n$worker->onMessage = function($con, $msg) {\n    $con->send('ok');\n};\nWorker::runAll();\nNginx conf.\nserver {\n  listen 443;\nssl on;\n  ssl_certificate /etc/ssl/server.pem;\n  ssl_certificate_key /etc/ssl/server.key;\n  ssl_session_timeout 5m;\n  ssl_session_cache shared:SSL:50m;\n  ssl_protocols SSLv3 SSLv2 TLSv1 TLSv1.1 TLSv1.2;\n  ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;\nlocation /chat-appllication\n  {\n    proxy_pass http://127.0.0.1:8282;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"Upgrade\";\n    proxy_set_header X-Real-IP $remote_addr;\n  }\n# location / {\n    ....\n  } \n}\nJavascriptjavascript\nws = new WebSocket(\"wss://domain.com/chat-appllication\");\n```\n. Show your codes please.. Closing this due to a lack of feedback.\nPlease come back with more details if this problem persists and we can reopen this. Fixed.. Please try to run command \u2018 strace public/wss/index.php start -d\u2019 and show the output.. Please show your command for starting workerman.\nIt seems like you are using docker and docker can not receive your ctrl c (SIGINT) signal.. It seems not workerman's issue.\nThe strace result show that the docker command blocked with select system call and can not quit.. Show your codes please.. Closing this due to a lack of feedback.\nPlease come back with more details if this problem persists and we can reopen this.. Good job.\nBut I think this can be as an independent project and install with composer more reasonable.\nThank you for your pr.. I believe this has been answered, so I'm closing this for now.\u00a0. include_once will not include or execute index.php again so no output there.\nIn workerman, classes should be defined as a single file and loaded with include_once/require_once or autoload mechanism.\nThe standard practice is like this.\nindex.php\nphp\n<?php\nrequire_once /your/path/of/User.php\necho \\User\\User::getName() . '<br />';\necho \"user-2\" . '<br />';\nThis is also the practice of most frameworks.. You can add a file monitor to check if any file changed and then reload automatically.\nHere is some example.\nhttps://github.com/walkor/workerman-filemonitor\nhttps://github.com/walkor/workerman-filemonitor-inotify (inotify extension required). Yes, workerman is a resident memory program. PHP not allowed to redefine a class when it already in memory.\n```php\n<?php\nnamespace User;\nclass User\n{\n    static public function getName()\n    {\n        return 'user-1' . time();\n    }\n}\necho \\User\\User::getName() . '';\necho \"user-2\" . '';\n``\nThe codes works fine in php-fpm/apache because everything will be destroyed(include class definition) after the request finished. When the next request comes php-fpm/apache will load the class to memory again and  there is problem because every thing destroyed before this request. Everything destroyed and rebuild again will lead to bad performance.\nIf you use other resident memory http application like java/c/c++/go etc it also need to some operation like reload after code change.. Not all codes will be retained in memory in php cli. Generally speaking, the definition of function and class will reside in memory. Temporary variables within a function or method will be released after executed and will not reside in memory.  The codesinclude $workerman_file;inonMessagemethod so the temporary variables will be released and not retained in memory.. I think this link will help.\nhttps://github.com/Textalk/websocket-php.It shows not run` there are three reasons for this.\n\n\nThe service has not been started or already shut down. Run command ps auxf to see if process workerman exists.\n\n\nPid file missing. The pid file localtion is dirname('workerman/Worker.php'). \"/../xxx.pid by default and can be changed by codes Worker::$pidFile='/your/path/workerman.pid';.\n\n\nThe process startup user and status user are not the same.. Try dtruss with mac.. Run command php -v and show the output.\nSorry for the delay.. status 11 means coredump for php. I think this is php 7.3.0's bug. \nPlease use more stable version for php, for example php7.2.13 or greater, php7.1.25 or greater or php7.0.33.. > I want to do a cluster server separate by services, like, users, admin, shop, and then i want to start/stop one by one if i want. But i want to see the unified stats like php mainServer status\n\n\nWhat's stats do you want?. $io = new SocketIO(2000); and $io = new SocketIO(2001); means two different processes let's mark them A and B. IF A change the variable($server) B can not see the change that means variables are separated between processes. But you can store the variables to mysql/redis etc and every process can get them from it any time.\nIf you want to start/stop standalone services the you must separate them to two start files (remove require 'shop.php'; from main.php).  Then you can run command php main.php start -d and php shop.php start -d to start service standalone.And can stop any one by command php startfile.php stop. Workerman does not support stop one service when the all services start in one startfile. Workerman does not support see all service status form one command when services start in different startfiles.. 1- Yes, lvs dns nginx haproxy etc. You can find them in google.\n2-$socket->id can not be shared between process. Just use $io->emit();\n3-Yes, phpsocket.io support different services use the same channel server.\n4- Sorry, there is no plan at present.\nMost of questions are relate to project phpsocket.io. If you has more question about phpsocket.io  welcome to post issues to here.. move_uploaded_file() is_uploaded_file()  \u7ed5\u4e0d\u8fc7\u53bb\u7684\u8bdd\u8fd9\u4e2apr\u5c31\u5148\u4e0d\u5408\u5e76\u4e86\u3002\n\u4f60\u53ef\u4ee5\u5148\u6269\u5c55\u4e0bhttp\u534f\u8bae\u5148\u7528\u7740\uff0c\u5982\u679cmove_uploaded_file() is_uploaded_file() \u80fd\u89e3\u51b3\u7684\u8bdd\u53ef\u4ee5\u8003\u8651\u5408\u5e76\u3002. Please install pcntl extension.. Yes, workerman removed SSLv3, see https://github.com/walkor/Workerman/pull/246 .. Lock added and thank you for your pr.. I think there's some memory leak in your business codes.\nThe simplest way is add a timer to check the memory and restart the current process like this.\nphp\n$worker -> onWorkerStart = function($worker){\n    Timer::add(10, function() use ($worker){\n        if (memory_get_usage(true) > 128*1024*1024 && count($worker->connections) == 0) {\n            // Restart current process.\n            Worker::stopAll();\n        }\n    });\n};\nThe best solution is to find the code that causes the memory leak and fix it. . I can\u2018t tell where your business codes have memory leak. May be the Tablets class, you must find it by yourself.. Each client has a corresponding TcpConnection instance $connection. You can call $connection->send('..') send message to the corresponding connected client.  All connections stored in the array $worker->connections and you can choose which one to send.. Try the codes.\nphp\n<?php\nuse Workerman\\Worker;\nrequire_once __DIR__ . '/Workerman/Autoloader.php';\n$http_worker = new Worker(\"http://0.0.0.0:8000\");\n$http_worker->count = 1;\n$http_worker->onMessage = function($connection, $data)\n{\n    if($_SERVER['HTTP_CONNECTION'] == 'Keep-Alive') {\n        $connection->send('Hello World');\n    } else {\n        $connection->close('Hello World');\n    }\n};\nWorker::runAll();. Thanks.. \n\nIt's works fine for me.. You are welcome. \u4e2d\u6587\u63d0\u95ee\u8bf7\u5230 https://wenda.workerman.net/ \u53d1\u5e16. Thank you for your post and good work for project https://github.com/lynncho/shy .\nWorkerman can listening multi port  in one start file like this.\nphp\n<?php\nuse Workerman\\Worker;\n$ws_worker = new Worker('websocket://0.0.0.0:1234');\n$ws_worker->onMessage = function(){};\n$http_worker = new Worker('http://0.0.0.0:5678');\n$http_worker->onMessage = function(){};\n// ...\nWorker::runAll();\nI hope this is what you want.. Worker::$pidFile marked which service to deal with.\nYou can change Worker::$pidFile by command $argv like this.\nphp\n<?php\nuse Workerman\\Worker;\n$module = $argv[3];\nWorker::$pidFile = \"/tmp/$module.pid\";\ncall_user_func($module);\nfunction chat() {\n    $worker = new Worker('websocket://0.0.0.0:1234');\n    $worker->onMessage = function(){};\n}\nfunction api() {\n    $worker = new Worker('http://0.0.0.0:5678');\n    $worker->onMessage = function(){};\n}\nWorker::runAll();\nThen start with command like php start.php start -d chat php start.php start -d api.\nStop with command php start.php stop -d chat php start.php stop -d api.\n. Yes triple equals operator has better performance.\nBut this pull request will not be accepted, because we found no significant change in performance after testing.\nI think the reason is that using flock has performance loss too which is not significantly lower than thundering herd.\n. $this->protocol is not an object but a string.. ",
    "joostshao": "\u54e6\uff0c\u597d\u5427\uff0c\u6211\u4ee5\u4e3a\u662f\u3000function\u4f1a\u6bd4method in class \u6267\u884c\u6548\u7387\u5feb\u3000\u8fd9\u4e2a\u539f\u56e0\n. \u591a\u8c22\uff0c\u8d44\u6e90\u9694\u79bb\uff0c\u81ea\u5df1\u7ba1\u7406\n. https://github.com/gophp7/gophp7-ext/wiki/extensions-catalog\n\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u5462?\n. \u8fd9\u4e2a\u662f\u7528\u5de5\u5177\u68c0\u6d4b\u7136\u540e\u6839\u636e\u68c0\u6d4b\u7ed3\u679c\u4fee\u6b63\u7684\u5417\uff1f\n. \u90a3\u8fd9\u6837\u4e5f\u591f\u8f9b\u82e6\u4e86\uff0c\u81f4\u656c\uff01\n. ",
    "donglei": "hhvm --version\nHipHop VM 3.4.2 (rel)\nCompiler: tags/HHVM-3.4.2-0-g40d85d7386b3342ab848fc45c6892433c89ef5b2\nRepo schema: 13cba877c4300d1d0481b3f40eb128a5115d4e08\nExtension API: 20140829\n. ",
    "yanpeipan": "tks\n. ",
    "IngwiePhoenix": "When will english docs be available?\nI worked out the API, sort of, with a lot of print_r()'s... but having the actual docs would be helpful.\n. Okay, sounds good! But maybe you can answer me a little question.\nWhich callback is used upon client initialization? Like, there is onConnect and such. But is there a function that is called each time the worker is made, on the worker's end? I saw onWorkerCreate...but I am not sure if this is called from the main process or the worker process.\n. Awesome. What are the arguments given to the various callbacks? Only the worker object or more?\n. Very nice! This helps me a lot!\nOne last thing though. I want to intentionally restart a worker. Currently, I am doing this by sending SIGUSR1 to the process itself: http://git.ingwie.me/ingwie/bird3/blob/master/php-lib/YiiApp.php (See YiiApp::stop())\nIs there an actual \"right\" way to relaunch a worker?\nDoes onClose() reffer to when the client closes the connection to the worker?\n. Is there a way to reload a worker, but keeping its statistics? Reloading a worker also means that the stats for connections and such are reset to 0.\n. Actually it is not that hard.\nEach time a worker is created, use the uniqid() function and save that as a variable. Then offer this very worker a restart function. This restart function should mention to the parent process that it wants to restart and give it it\u2019s unique ID. The master sends a signal to finally stop the worker. Then, the process re-fork()s itself and assigns the previous ID again.\nYou then can assign this very ID to the entries in the worker table - that way the workers can keep their state.\nThis is just an diea of mine though!\nKind regards, Ingwie.\n. Awesome work! I just looked through them, they are very nice. :)\n. Awesome! I\u2019ll verify. :)\n. https://packagist.org/packages/wujingke/workerman\nIt still reads 2014...\n. Oh my bad! Thanks for the link :)\n. Strange. I installed Workerman 3.1 via composer now and commented out my manual require_once - expecting Workerman to load automaticaly. But when I load a file that extends Workerman with a protocol, i get an error that Workerman\\Protocols\\ProtocolInterface is not defined...\nThat is my code, a snippet from it:\nnamespace Workerman\\Protocols {\nuse \\Workerman\\Connection\\ConnectionInterface;\nclass Hdp implements ProtocolInterface {\nFor now, I am just require_once()\u2019ing the Autoloader file from vendor/walkor/workerman/Workerman/Autoloader.php. But it would be nice if you could find a way to avoid needing to do this. I also will do a research and see what I can find.\n. I would like to capture the statistics outputted by the \u201estatus\u201c command. I will look into that link you gave me too, never seen it before. :)\n. workerman-statistics does not have an english README \u2026 so I can\u2019t quite understand what it does...\n. And there is no way to do get the stats  from within a worker itself?\n. And how to get it from all workers at once?\n. Very welcome! =)\n. And how can I get this working in a non-deamonized mode? The Workerman process is managed via NodeJS. The entry point for Workerman: https://github.com/DragonsInn/BIRD3/blob/master/php-lib/request_handler.php\n. I am redirecting using php://stdout php://stdout now. I need to test this more but so far, no error was thrown! :)\n. I doubt so, since the developer is asian (Chinese I think it was?) and will likely prefer to document in his foreign language. Understandable, imho.\n. Ill go with the first one. Awesome, you totally got this covered! :)\nThough...may I request english docs? At least an english example on how to utilize it? The only chinese I know is blind, so she can't help me ;)\n. Okay, cool! Thanks for that. :)\n. ",
    "ghost": "\u53ef\u80fd\u662f\u770b\u4e86\u4e00\u904d\u6ca1\u611f\u89c9\uff0c\u7b2c\u4e8c\u904d\u770b\u4e86\u5bf9\u7740\u6e90\u7801\u53d1\u89c9\u597d\u50cf\u4e5f\u53ef\u4ee5\u4e0d\u7528guide\uff0c\u60a8\u7684\u6ce8\u91ca\u5199\u5f97\u5f88\u597d\u4e86\u3002\n. \u662f\u7684\uff0c\u8fd9\u6837\u5b50\u662f\u7075\u6d3b\u4e86\u5f88\u591a\u3002\u975e\u5e38\u611f\u8c22\u60a8\u7684\u56de\u7b54\u3002\n. But my question is about how to get the connection by id from another script. E.g:\nThis starts the Websocket Server:\n```php\n//ws_start.php\n<?php\nrequire_once DIR . '/vendor/autoload.php';\nuse Workerman\\Worker;\nuse \\Workerman\\Connection\\TcpConnection;\n// Create a Websocket server\n$ws_worker = new Worker(\"websocket://0.0.0.0:2346\");\n// 4 processes\n$ws_worker->count = 4;\n// Emitted when new connection come\n$ws_worker->onConnect = function(TcpConnection $connection) use (&$conn)\n{\n    echo \"Connection id: \".$connection->id.PHP_EOL;\n    echo \"Worker id: \".$connection->worker->id.PHP_EOL;\n};\n// Emitted when data received\n$ws_worker->onMessage = function(TcpConnection $connection, $data)\n{\n    $connection->send('hello ' . $data);\n};\n// Emitted when connection closed\n$ws_worker->onClose = function(TcpConnection $connection)\n{\n    echo \"Closed connection: \".$connection->id;\n    echo \"Connection closed\\n\";\n};\n// Run worker\nWorker::runAll();\n```\nAnd i want to send a message to connection \"x\" from another script e.g:\n```php\n//send_message.php\n<?php\nrequire_once ('vendor/autoload.php');\n//Connection id from cli\n$connectionId = $argv[1];\n//Message\n$message = $argv[2];\necho \"Will send Message: $message to connection: $connectionId\".PHP_EOL;\n```. ",
    "ywisax": "\u591a\u8c22\u56de\u590d~\nclass_alias\u7684\u786e\u53ef\u4ee5\u89e3\u51b3\u6211\u7684\u95ee\u9898\u3002\n. ",
    "shellus": "\u5982\u4f55\u91cd\u5199\u5462\uff1f\u5176\u5b9e\u6211\u7684\u95ee\u9898\u662f\uff1a\u201c\u8be5\u600e\u4e48\u5728workerman\u4e0a\u5c01\u88c5\u5e94\u7528\u5c42\u534f\u8bae\u201d\u3002\u4f8b\u5982\u6bcf\u4e2asend\u52a0\u4e0a\u65f6\u95f4\u6233\uff0c\u683c\u5f0f\u8f6c\u6362\uff08json_encode\uff09\u7b49...\n\u4e0d\u5c01\u88c5\u662f\u4e0d\u73b0\u5b9e\u7684\u5427\uff0c\u603b\u4e0d\u80fd\u6bcf\u6b21\u90fd\n$data\uff3b\u201ctime\u201d\uff3d=time\uff08\uff09\uff1bsend\uff08json_encode\uff08$data\uff09\uff09\u5427\uff1f\nworkerman\u8bbe\u8ba1\u65f6\u6ca1\u6709\u8bbe\u8ba1\u5982\u4f55\u5b9e\u73b0\u8fd9\u6837\u6269\u5c55\u65b9\u6cd5\u5417\uff1f\n. \u8c22\u8c22\uff0c\u4f60\u7684\u89e3\u91ca\u5b8c\u7f8e\u7684\u89e3\u51b3\u4e86\u6211\u7684\u95ee\u9898\u3002\n. \u90a3\u662f\u5426\u6709\u5178\u578b\u7684\u8def\u7531\u6848\u4f8b\u53ef\u4ee5\u53c2\u8003\u5462\uff1f\n. ",
    "liujian883": "\u4f7f\u7528is_array\u5224\u65ad\u4e0b$worker_connection\u518d\u8fdb\u884cforeach\u3002\u5b9e\u9a8c\u786e\u5b9a\u53ef\u4ee5\u8fdb\u884c\u5168\u90e8business\u7684\u8def\u7531\n. ",
    "agui2200": ".....\u5c31$this->send,\u5728close\u65b9\u6cd5\u91cc\u9762\uff0csend\u7684\u65f6\u5019\uff0c\u4f20\u7684\u662f\u4f60\u81ea\u5df1\u5199\u7684msg\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u56e0\u4e3a\u5b9a\u4e49\u7684\u65b9\u6cd5\uff0c\u9ed8\u8ba4\u662f\u8981\u53bb\u5c01\u5305\u7684\uff0c\u5c01\u5305\u7684\u65f6\u5019\u5c31\u4f1a\u5931\u8d25\u4e86\uff0c\u8fd8\u6709\u4e2a\u95ee\u9898\uff0cset_error_handler\uff0c\u8fd9\u4e2a\u4e1c\u897f\uff0c\u6211\u89c9\u5f97workerman\u81ea\u5df1\u5e94\u8be5\u5b9a\u4e49\u4e00\u4e2a\n. ",
    "sixFingers": "@devypt I'm in, too\n. ",
    "sukui": "posix_kill($master_pid, SIGUSR2);\n. http://doc3.workerman.net/worker-development/max-package-size.html\n\u8bbe\u7f6e\u5305\u5927\u5c0f\n. \u641e\u9519\u4e86.\n. @sm2017 \nhttps://pecl.php.net/package/event. ",
    "vb2005xu": "mac \u4e0a\u59cb\u7ec8\u62a5\u9519,linux\u4e0a\u6ca1\u4e8b\n. PHP 5.5.23 (cli) (built: Mar 23 2015 01:47:37)                                                          \u2502---\nCopyright (c) 1997-2015 The PHP Group                                                                   \u2502Press Ctrl-C to quit. Start success.\nZend Engine v2.5.0, Copyright (c) 1998-2015 Zend Technologies\n\u6211\u662f\u8fd9\u4e2a\u7248\u672c\n. ",
    "dalarge": "\u8c22\u8c22\uff0c\u6211\u5347\u7ea7\u8bd5\u8bd5\n. ",
    "sungerk": "https://github.com/jaxl/JAXL \n. ",
    "praswicaksono": "Well I can help if you man but it require intensive communication. Where I can reach you for more talk about this? any IM maybe\n. either gitter or IRC is fine with me since those tools already used by most opensource project also it can attract foreign developer to contribute.\n. ",
    "Arul-": "Take a look at my implementation at https://github.com/Arul-/reactive-restler/blob/dev/interop/Workerman/Psr7.php\nThe only dependency it has with the rest of my framework is \nphp\n$class = ClassName::get(ServerRequestInterface::class);\nIt can easily be changed by hardcoding the PSR Request class\nI can make a pull request here if you like. Understood!. You are welcome @walkor keep up the good work \ud83d\udc4d . ",
    "DmitryMamchyts": "I think this PR will fix https://github.com/walkor/Workerman/issues/47 issue\n. Ok, thanks\n. ",
    "jackyxie": "\u6211\u662f\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u5b89\u88c5\u7684\u54e6\uff1a\ncomposer require workerman/workerman\n. \u6700\u65b0\u7684release\u53ef\u4ee5\u7528\u5417\uff1f\u8fd8\u662f\u8bf4\u8981\u4e0b\u8f7dmaster\u6e90\u7801\n. \u597d\u7684\uff0c\u6211\u7528master\u7684\u8bd5\u8bd5\n. \u90a3\u76ee\u524d\u5c31\u6682\u65f6\u7528\u4e0d\u4e86libevent\u54af\uff1f\n. \u54e6\uff0c\u597d\u7684\u3002\u5fd8\u4e86\u662f reusePort\u624d\u9700\u8981php7\n. ```\nrequire_once 'conf/config.php';\n$worker = new Worker();\n//\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u6570\u76ee($markets\u662fconfig\u91cc\u9762\u7684\u6570\u7ec4)\n$worker->count = count($markets);\n$worker->onWorkerStart = function ($worker) {\n    Timer::add(0.5, 'taskGenerator', array('worker' => $worker, 'markets' => $markets));\n};\n```\nonWorkerStart\u91cc\u9762\u7684 $markets\u63d0\u793a\u672a\u5b9a\u4e49\n. config.php\n<?php\n    $markets = array(\n            'okc',\n            'huob',\n            'bitv',\n    );\n. \u55ef\uff0c\u4f7f\u7528global\u662f\u53ef\u4ee5\u3002\u6211\u8fd8\u6709\u53e6\u5916\u4e00\u4e2a\u95ee\u9898\uff1a\u6bd4\u5982\u6211\u6709\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u91cc\u9762\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u6211\u60f3\u7528\u4e00\u4e2a\u8fdb\u7a0b\u5904\u7406\uff0cworkman\u8981\u600e\u4e48\u5b9e\u73b0\u554a\uff1f\n. \u4ee3\u7801\u91cc\u9762\u662f\u6b63\u786e\u7684\uff0c\u8fd9\u91cc\u6253\u9519\u4e86\n. ",
    "joelhy": "PHP7\u7528\u6237\u53ef\u4ee5\u7528Event\u6269\u5c55\u3002\u6ce8\u610f\uff1aEvent\u6269\u5c55\u53ea\u652f\u6301PHP 5.4+\u3002\nlibevent\u6269\u5c55\uff0c\u6700\u540e\u66f4\u65b0\u65f6\u95f4\u4e3a2013\u5e745\u670822\u53f7\uff0c\u4e0d\u53ef\u80fd\u6709\u8003\u8651PHP 7\u517c\u5bb9\u6027\uff0c\u4e0d\u63a8\u8350\u5728 PHP 7\u4e0a\u4f7f\u7528\u3002\n\u6216\u8005\u4f7f\u7528ev\u6269\u5c55\uff0c\u65b0\u7248\u672c\u4e5f\u6709\u8003\u8651 PHP 7\u517c\u5bb9\u6027\u3002\n@walkor  \u5efa\u8baeWorkerman\\Events\u91cc\u589e\u52a0\u5bf9 Event \u6269\u5c55\u7684\u652f\u6301\uff0c\u5e76\u5728\u6587\u6863\u4e2d\u4f18\u5148\u63a8\u8350\u4f7f\u7528\u8fd9\u4e2a\u6269\u5c55\u3002\n. @walkor  \u5982\u679c\u542f\u7528 Event \u6269\u5c55\u652f\u6301\uff0c\u793a\u4f8b\u7a0b\u5e8f\u4ee3\u7801Applications/*/Event.php\uff1aworkerman-chat\uff0cworkerman-todpole\u7684 Event \u7c7b\u540d\u9700\u8981\u66f4\u6539\u6210\u5176\u4ed6\u540d\u79f0\uff0c\u6216\u8005\u52a0\u4e0a namespace \u4ee5\u9632\u547d\u540d\u51b2\u7a81\u3002\n. \u662f\u7684\n. \u542f\u7528\u4e0b\u7f16\u8f91\u5668\u6216IDE\u7684Spell Check(\u62fc\u5199\u68c0\u67e5)\u529f\u80fd\uff0c\u6709\u52a9\u4e8e\u53d1\u73b0\u4e9b\u95ee\u9898\u3002\n. ",
    "scriptzteam": "found :)\n. ",
    "hetao29": "Workerman-master/Protocols/Http.php\u7684229\u884c\nself::sessionWriteClose();\n\u5e94\u8be5\u6ce8\u91ca\u6389\uff0c\u56e0\u4e3a\u6ca1\u6709\u7528\n. \u6211\u7684\u610f\u601d\u56e0\u4e3a\u4ee3\u7801\u6ca1\u6709session_start,\u6240\u4ee5session_close\u4e5f\u5e94\u8be5\u6ca1\u6709\u5fc5\u8981\n\u6211\u4e5f\u660e\u767d\uff0cworkerman\u5bf9http\u534f\u8bae\u652f\u6301\u80af\u5b9a\u6709\u9650\uff0c\u6bd5\u7adfhttp\u534f\u8bae\u7ec6\u8282\u5f88\u591a\uff0c\u800c\u4e14\u8d85\u7ea7\u590d\u6742\u3002\n\u660e\u767d\u4f60\u7684\u8bbe\u8ba1\u5b9a\u4f4d\u3002\n\u5728 2016\u5e743\u670828\u65e5 \u4e0a\u534811:14\uff0cwalkor notifications@github.com\u5199\u9053\uff1a\n\n1\u3001229 \u884cself::sessionWriteClose();\u662f\u7528\u6765\u4fdd\u5b58session\u7684\uff0c\u53bb\u6389\u540e\u5c31\u4fdd\u5b58\u4e0d\u4e86session\u4e86\n2\u3001\u76ee\u524d\u6682\u65f6\u4e0d\u652f\u6301session_save_path\u7684redis\uff0cmemcache\u7c7b\u578b\u3002\nhttp\u534f\u8bae\u7684\u5e94\u7528\u4e0d\u662fworkerman\u7684\u76ee\u6807\uff0c\u8ba9PHPer\u6446\u8131PHP\u53ea\u80fd\u7528\u4e8eWeb\u5f00\u53d1\u7684\u675f\u7f1a\u624d\u662fworkerman\u7684\u4e3b\u8981\u76ee\u6807\u3002\u76ee\u524d\u4e0d\u4f1a\u82b1\u8d39\u592a\u591a\u65f6\u95f4\u53bb\u5b8c\u5584http\u534f\u8bae\u53cawebserver\u3002\n\u5982\u679c\u60f3\u5f00\u53d1http\u534f\u8bae\u7684\u5e94\u7528\uff0cnginx\u914d\u5408fpm\u662f\u975e\u5e38\u597d\u7684\u9009\u62e9\uff0c\u5404\u79cdmvc\u6846\u67b6\u5df2\u7ecf\u975e\u5e38\u6210\u719f\u4e86\uff0c\u5f00\u53d1\u3001\u8c03\u8bd5\u3001\u90e8\u7f72\u3001\u8fd0\u7ef4\u3001\u7ef4\u62a4\u90fd\u975e\u5e38\u7b80\u5355\u3002\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/walkor/Workerman/issues/66#issuecomment-202214853\n. \u8fd9\u548cworkerman\u6ca1\u6709\u5173\u7cfb\u5427\uff0c\u76f4\u63a5global\u5f15\u6709\u5c31\u884c\u4e86\uff0c\u4e0d\u8fc7\u56e0\u4e3a\u662f\u5168\u5c40\u53d8\u91cf\uff0c\u6240\u4ee5\u8981\u8003\u8651\u503c\u7684\u5b89\u5168\u6027\n. \u5443\uff0c\u6211\u5230\u4e0d\u89c9\u5f97\u662f\u8fd9\u6837\u7684\uff0c\u8fd9\u6837\u6d4b\u8bd5\u5e76\u53d1\u54cd\u5e94\u662f\u6ca1\u6709\u95ee\u9898\u7684\uff0conMessage\u91cc\u9762\u7684\u6ca1\u6709\u5b9e\u73b0\u5f02\u6b65\n\n2016-09-07 11:04 GMT+08:00 yesme2000 notifications@github.com:\n\nusleep(10000); \u8fd9\u79cd\u8017\u65f6\u7684\u4e1a\u52a1\uff0c\u5e94\u8be5\u4ea4\u7531\u540e\u53f0\u7a0b\u5e8f\u53bb\u5904\u7406\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/walkor/Workerman/issues/92#issuecomment-245161771,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AHo6OhGRHJ_LxsrMMKjVWk4S5NyB8_t0ks5qnim8gaJpZM4J1fH1\n.\n. \u8fdb\u4e00\u6b65\u8ddf\u8fdb\u53d1\u73b0\uff0c\u548cSelect,Event,Libevent\u90fd\u6ca1\u6709\u5173\u7cfb\uff0c\u4ec0\u4e48\u5e95\u5c42\u90fd\u4f1a\u6709\u8fd9\u4e2a\u95ee\u9898\uff0c\u8fd9\u548c\u4e3bWorker\u7684\u4e8b\u5173\u6709\u5173\uff0c\u800c\u4e14\u662f\u4e00\u4e2a\u6bd4\u8f83\u4e25\u91cd\u7684\u903b\u8f91\u95ee\u9898\u3002\n\n\u5c31\u662f\u5f53\u591a\u4e2a\u5b50\u8fdb\u7a0b\u6a21\u5f0f\u65f6\u5019\uff0c\u6bcf\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u90fd\u4f1a\u76d1\u542c\u6240\u6709\uff08\u5305\u62ec\u5176\u5b83\u5b50\u8fdb\u7a0b\uff09\u7684\u4e8b\u4ef6\uff0c\u8fd9\u662f\u4e0d\u5e94\u8be5\u7684\uff0c\u6d6a\u8d39\u6027\u80fd\u800c\u4e14\u5404\u79cd\u51fa\u9519\uff01\n. https://github.com/walkor/Workerman/pull/104\n. ",
    "gouchaoer": "\u7b49\u7b49\u3002\u3002\u3002worker\u5e38\u9a7b\u5185\u5b58\u7684\u8bdd\u8fd9\u70b9\u65f6\u95f4\u4e0d\u7528\u8003\u8651\u3002\u3002\u3002\u597d\u5427\uff0c\u4e0d\u7528\u6539\u4e86\n. \u76f4\u63a5\u5728\u5f02\u6b65\u56de\u8c03\u903b\u8f91\u91cc\u963b\u585e\u7761\u7720\u80af\u5b9a\u4e0d\u884c\uff0c\u4f60\u7761\u772010ms\u53bb\u6a21\u62df\u4e1a\u52a1\u6bd4\u5982\u53bb\u67e5\u4e2asql\u5565\u7684\u53ef\u4ee5\uff0c\u4f46\u662f\u67e5sql\u672c\u8eab\u662f\u540c\u6b65\u7684\uff0c\u4e5f\u5fc5\u5bfc\u81f4qps\u4e0b\u964d\u7684\u5f88\u5389\u5bb3\uff0c\u5c31\u7b97nodejs\u4f60\u8fd9\u4e48\u6d4b\u4e5f\u662f\u4e00\u6837\u7684\u3002\n\u5f02\u6b65\u5c31\u610f\u5473\u7740\u4f60\u4e0d\u80fd\u963b\u585e\uff0c\u4f60\u9700\u8981\u628a\u4f6010ms\u7684\u540c\u6b65\u4e1a\u52a1\u6539\u6210\u56de\u8c03\u65b9\u5f0f\u3002\n. complete example:\ncomposer.json\n```\n{\n    \"require\": {\n        \"workerman/workerman\": \"^3.3\",\n        \"predis/predis\": \"^1.1\"\n    }\n}\n```\nbug.php\n```\n<?php\n// php -d xdebug.remote_autostart=On luminati.php start\nrequire_once DIR . '/vendor/autoload.php';\nuse Workerman\\Worker;\nuse Predis\\Client;\nforeach ( $argv as $v )\n{\n    if(stripos($v, 'stop')!==false)\n    {\n        Log::log_step ( 'Worker stop!' );\n        Worker::runAll ();\n    }\n}\nLog::log_step(\"start to fork!\");\n$pid = pcntl_fork ();\nif ($pid === 0) // \u5b50\u8fdb\u7a0b\n{\n    Log::setting ( 'luminati_pcntl_fork.log' );\n    Log::$echo = false;//\u7981\u6b62\u6807\u51c6\u8f93\u51fa\uff0c\u56e0\u4e3a\u5df2\u7ecf\u6ca1\u6709\u4e86shell\u4e86\n    $mypid = posix_getpid ();\n    $msg = \"child process start, mypid:{$mypid}\";\n    Log::log_step ( $msg );\ntry\n{   \n    while ( true )\n    {\n        sleep(2);\n        Log::log_step('sleep 2s...');\n    }\n}catch ( \\Exception $e )\n{\n    $msg = \"child process error, mypid:{$mypid}, \" . $e->getMessage ();\n    Log::log_step ( $msg, 'error' );\n}\n\n} else if ($pid === - 1) // fork\u5931\u8d25\u7236\u8fdb\u7a0b\n{\n    Log::setting ( 'luminati.log' );\n    Log::log_step ( 'pcntl_fork failed', 'pcntl_fork_failed' );\n} else // \u6210\u529f\u7236\u8fdb\u7a0b\n{\n    Log::setting ( 'luminati.log' );\n    $mypid = posix_getpid ();\n$msg = \"fork success, child process:{$pid}, mypid:{$mypid}\";\nLog::log_step ( $msg );\nregister_shutdown_function ( function ($pid_t)\n{\n    $mypid = posix_getpid ();\n    $msg = \"kill pid:{$pid_t}, mypid:{$mypid}\";\n    Log::log_step ( $msg );\n    posix_kill ( $pid_t, SIGKILL );\n}, $pid );\n\n// Create a TCP worker.\n$worker = new Worker ( \"tcp://0.0.0.0:12345\" );\n// \u53ea\u80fd\u662f1\u4e2a\u8fdb\u7a0b\n$worker->count = 1;\n// Worker name.\n$worker->name = 'luminati-http-proxy';\n\n$worker->onConnect = function ($connection) \n{\n    // \u8bbe\u7f6e\u8fde\u63a5\u7684onMessage\u56de\u8c03\n    $connection->onMessage = function ($connection, $data) use (&$RID_connections, &$worker)\n    {\n        $connection->send(\"test\");\n    };\n};\n\nLog::log_step ( 'Worker start!' );\n// Run.\nWorker::runAll ();\n\n}\nclass Log\n{\n    static public $echo=true;\n    const LOG_MAX = 8 * 1204 * 1024; // 8M\n    protected static $start = null;\n    protected static $log = null;\n    static public function setting($fn = 'luminati.log')\n    {\n        self::$start = time ();\n        self::$log = DIR . \"/{$fn}\";\n    date_default_timezone_set ( 'Asia/Shanghai' );\n\n}\nstatic protected function log_file($str, $level = null)\n{\n    $fp = null;\n    if (empty ( $level ))\n    {\n        $fp = self::$log;\n    } else\n    {\n        $fp = str_replace ( '.log', \"-{$level}.log\", self::$log );\n    }\n\n    file_put_contents ( $fp, $str, FILE_APPEND );\n    if (mt_rand ( 0, 1024 ) === 0)\n    {\n        clearstatcache ();\n        $filesize = filesize ( self::$log );\n        if ($filesize > self::LOG_MAX)\n        {\n            $msg = date ( 'Y-m-d H:i:s', $now ) . \" [warning][{$diff}s], clear log file, filesize:{$filesize}\\r\\n\";\n            if(self::$echo)echo $msg;\n            file_put_contents ( $fp, $msg );\n        } else\n        {\n            $msg = date ( 'Y-m-d H:i:s', $now ) . \" [info][{$diff}s], clearstatcache, filesize:{$filesize}\\r\\n\";\n            if(self::$echo)echo $msg;\n            file_put_contents ( $fp, $msg, FILE_APPEND );\n        }\n    }\n}\nstatic public function log_step($message, $level = null)\n{\n    if (empty ( self::$start ))\n    {\n        self::setting ();\n    }\n\n    $now = time ();\n    $diff = $now - self::$start;\n    $str = \"\\r\\n\" . date ( 'Y-m-d H:i:s', $now ) . \" [$level][{$diff}s] {$message}\";\n    if(self::$echo)echo $str;\n    self::log_file ( $str );\n    if (! empty ( $level ))\n        self::log_file ( $str, $level );\n}\n\n// \u5982\u679c\u8ddd\u4e0a\u4e00\u6b21\u8fd4\u56detrue\u7684\u8c03\u7528\u7ecf\u8fc7\u65f6\u95f4\u8d85\u8fc7$seconds\u5219\u8fd4\u56detrue\uff0c\u5426\u5219false\npublic static function tick($key, $seconds)\n{\n    $now = time ();\n    static $arr = [ ];\n    if (! array_key_exists ( $key, $arr ))\n    {\n        $arr [$key] = $now;\n        return 0;\n    }\n\n    $diff = $now - $arr [$key];\n    $wait_time = $seconds - $diff;\n\n    if ($wait_time >= 0)\n    {\n        //$msg = \"tick:{$key}, wait_time:{$wait_time}s\";\n        //Log::log_step ( $msg );\n\n        sleep ( $wait_time );\n    } else\n    {\n        $msg = \"tick:{$key}, wait_time:{$wait_time}s < 0s!\";\n        Log::log_step ( $msg, 'warning' );\n    }\n\n    $arr [$key] = time ();\n\n    return $wait_time;\n}\n\n}\n``. but how can i stop my own forked process when iphp bug.php stop`?. ",
    "MINORITYmaN": "hi, or use global variables:\nrequire_once 'conf/config.php';\n$worker = new Worker();\n//\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u6570\u76ee($markets\u662fconfig\u91cc\u9762\u7684\u6570\u7ec4)\n$worker->count = count($markets);\n$worker->onWorkerStart = function ($worker) {\n    Timer::add(0.5, 'taskGenerator', array('worker' => $worker, 'markets' => $GLOBALS['markets']));\n};\nkind regards, stefano\n. ",
    "YaoZeyuan": "ok\uff0c\u5df2\u63d0\u4ea4PR\n. ",
    "stunningpixels": "That works pretty well, what about having multiple open pipes? How can you write to the STDIN if it's demonised\n. For example if I were to run\nexec(\"./script\")\nAnd get the output STDOUT of the script to call $con->onMessage\n. ",
    "leconsc": "\u8c22\u8c22\u3002\n. \u597d\u7684\u3002\n. \u4e3b\u8981\u662fclient\u7aef\u662f\u4e0d\u9700\u8981nginx\u7684\uff0c\u662f\u76f4\u63a5\u5e0c\u671b\u901a\u8fc7wss\u6765\u6253\u5f00websocket\u8fde\u63a5\u7684\u3002\u56e0\u4e3a\u6211\u662f\u5728\u547d\u4ee4\u884c\u4e0b\u8fd0\u884c\u7684\u3002\n. \u6211\u7684\u610f\u601d\u662f\u73b0\u5728\u6211\u5df2\u7ecf\u6709\u4e00\u4e2awss\u7684websocket\u7684service, \u6211\u9700\u8981\u901a\u8fc7AsyncTcpConnection\u4f5c\u4e3a\u5ba2\u6237\u7aef\u8fde\u63a5\u4e0a\u53bb\u3002\u4f46\u662f\u73b0\u5728Client\u4ec5\u652f\u6301ws\u534f\u8bae\uff0c\u4e0d\u652f\u6301wss\u534f\u8bae\u3002\n. \u597d\u7684\u3002\u8b1d\u8b1d\n. \u6211\u8fd0\u884c\u5176\u5b83\u7a0b\u5e8f\uff0c\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\u554a\uff0c\u53ea\u662f\u5728reload\u65f6\uff0c\u624d\u51fa\u9519\u3002\u800c\u4e14\u6211\u7684\u4ee3\u7801\u4e2d\u4e5f\u6ca1\u6709\u7528\u5176\u5b83\u6269\u5c55\n. \u6211\u73b0\u5728\u672c\u5730libevent\u662f\u6700\u65b0\u76842.0.22\uff0cphp\u6a21\u5757\u6709:\nbcmath\nbz2\ncalendar\nCore\nctype\ncurl\ndate\ndba\ndom\nereg\nexif\nfileinfo\nfilter\nftp\ngd\ngettext\nhash\niconv\nintl\njson\nldap\nlibxml\nmbstring\nmcrypt\nmemcache\nmemcached\nmhash\nmysql\nmysqli\nmysqlnd\nodbc\nopenssl\npcntl\npcre\nPDO\npdo_mysql\nPDO_ODBC\npdo_sqlite\nPhar\nposix\nreadline\nredis\nReflection\nsession\nshmop\nSimpleXML\nsoap\nsockets\nSPL\nsqlite3\nstandard\nsysvmsg\nsysvsem\nsysvshm\ntokenizer\nwddx\nxdebug\nxml\nxmlreader\nxmlrpc\nxmlwriter\nxsl\nzip\nzlib\n\u4f46\u662f\u4ecd\u65e7\u6709\u4ee5\u4e0a\u9519\u8bef\u3002\n. 1. \u6211\u521a\u624d\u53d1\u73b0\u6700\u521d\u6211\u6ca1\u6709\u5b89\u88c5php55-libevent\n2. \u521a\u624d\u7f16\u8bd1\u5b89\u88c5\u4e86libevent 0.1.0, \u4ecd\u65e7\u4e00\u6837\u7684\u9519\u8bef\uff0c\u53ef\u80fd\u8fd8\u662f\u5176\u5b83\u4ec0\u4e48bug\n   \u8fd8\u6709\u6ca1\u6709\u5176\u5b83\u4ec0\u4e48\u53ef\u80fd\u9020\u6210\u8fd9\u4e2a\u9519\u8bef\uff1f\n\u6211\u7ee7\u7eed\u6df1\u5165\u6d4b\u8bd5\u4e86\u4e00\u4e0b\uff0c\u6309\u6b63\u5e38\u6d41\u7a0b\uff0c\u5728\u53d1\u9001reload\u547d\u4ee4\u540e:\nposix_kill($master_pid, SIGUSR1);\nmaster\u5e94\u8be5\u8fdb\u5165signalHandler\u8fd9\u4e2a\u6d41\u7a0b\u5427\uff0c\u4f46\u662f\u76ee\u524d\u90fd\u6ca1\u6709\u5230\uff0c\u5c31\u62a5\u9519\u4e86\uff0c\u6bd4\u8f83\u5947\u602a\n\u800c\u4e14\u6309\u6b63\u5e38\u903b\u8f91master\u90fd\u5df2\u7ecf\u9000\u51fa\u4e86\uff0cworker\u8fdb\u7a0b\u4e5f\u5e94\u8be5\u9000\u51fa\uff0c\u4f46\u662f\u73b0\u5728worker\u5374\u6ca1\u6709\u9000\u51fa\u3002\n. ",
    "jbkingsley": "\u8fd9\u4e2a\u95ee\u9898\u521a\u597d\u78b0\u5230\uff0c\u771f\u662f\u592a\u5de7\u4e86\uff0c\u611f\u8c22\nSent from my iPhone\n\nOn Aug 3, 2016, at 10:04 AM, \u674e\u4eae notifications@github.com wrote:\nClosed #78.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub, or mute the thread.\n. I am thinking this feature too. This feature would  be very convenient in reusability and maintainablity when we developed a server that must support  http and websocket at the same time.   . OK...thanks\nI'm gonna keep watching my program. \n",
    "tjliu912": "workerman\u4f5c\u4e3awss\u5ba2\u6237\u7aef\uff0c\u4ee3\u7801\u7c7b\u4f3c\u5982\u4e0b\uff0c\u5c31\u662f\u52a0\u4e00\u53e5$con->transport = 'ssl';\n$con = new AsycnTcpConnection('ws://x.x.x.x:xx');\n$con->transport = 'ssl';\n$con->onXXX(.....\nws://x.x.x.x:xx . \u540e\u9762\u7684\u90e8\u5206\u662f port \u4e00\u5b9a\u662f\u8bbe\u5b9a443\u5417\uff1f\n// \u8fd9\u91cc\u8bbe\u7f6e\u7684\u662fwebsocket\u534f\u8bae\n$worker = new Worker('websocket://0.0.0.0:2022', $SSL_setting);\n\u6211\u8fd9\u8fb9\u8bbe\u5b9aport \u4e3a 2022 \uff0c\u5ba2\u6237\u7aef\u8fde\u7ed3\u65f6\uff0c\u4e0d\u7528\u8bbe\u5b9a\u62102022\u5417\uff1f\n\u53c2\u8003\u6587\u6863\uff1ahttp://doc3.workerman.net/faqas-wss-client.html\n. ",
    "xiabin": "\u4f46\u662fepoll\u5728\u8c03\u7528\u7684\u65f6\u5019\u4e0d\u4f1a\u963b\u585e\u6574\u4e2a\u7a0b\u5e8f\u5417\n. \u4ece\u7406\u8bba\u4e0a\u662f\u4f1a\u7684 \u5e76\u4e0d\u662f\u771f\u6b63\u7684\u5f02\u6b65\u7684\u56de\u8c03\u53ea\u662f\u4ece\u5e94\u7528\u4e0a\u6765\u8bf4\u67d0\u79cd\u610f\u4e49\u4e0a\u662f\u5f02\u6b65\u56de\u8c03\u6216\u8005\u5f02\u6b65\u975e\u963b\u585e\u5427\n. ",
    "smallworld-network-wupeng": "\u6211\u4e5f\u60f3\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u4e0d\u8fc7\u770b\u8d77\u6765\u5f88\u602a\uff0c\u4e0d\u77e5\u9053\u53ef\u4e0d\u53ef\u884c\uff0c\u6240\u4ee5\u6ca1\u6709\u6d4b\u8bd5\u3002\u8c22\u8c22\uff01\n. ",
    "dam1r89": "Perfect, thank you.\n. ",
    "taozywu": "\u4e2a\u4eba\u7406\u89e3\uff1a\n\u9996\u5148\u4f60\u95ee\u7684\u95ee\u9898\u8ddfworkerman\u672c\u8eab\u6ca1\u591a\u5927\u5173\u7cfb\uff0c\u8fd9\u662flibevent\u8ddfssl\u7684\u95ee\u9898\u3002\n\u4f60\u9614\u4ee5\u770b\u4e0bhttps://github.com/libevent/libevent \u8fd9\u4e2a\u94fe\u63a5\u5e76\u627e\u5230\u5982\u4e0b\u7c7b\u4f3c\u5904\u7406\n\nOpenSSL support\n\nTo build Libevent with OpenSSL support you will need to have OpenSSL binaries available when building, these can be found here: http://www.openssl.org/related/binaries.html\n\n\u6700\u540e\u795d\u4f60\u597d\u8fd0\uff01\n. @ronindesign \nhi, you can follow this. also refer @walkor 's codes.\nforeach($workerConfigs as $wc) {\n     // this you can write custom protcol\n     // serverquery://0.0.0.0:10011  serverquery://0.0.0.0:10012  serverquery://0.0.0.0:10013\n     $worker = new Worker($wc['protcol']);\n     $worker->count = 1;\n     $worker->onMessage = function($connection, $message){\n         // $message->cmd = 'notifyCliententerview/notifyServeredited/notifyTextmessage/..etc'\n         $callback = $message->cmd;\n         if (is_callable($callback)) {\n              $callback($message);\n         }\n      };\n}\nWorker::runAll();\nAs above,  this reach Multiple custom workers. at last  good luck!. @88gumak88  you can look http://doc.workerman.net/315298 , i hope to help u.\ngood luck!. \ud83d\udc4d . @cnsms  \n```php\n$worker = new Worker(...);\n// Global db connection.\n$db_connection = null;\n$db_configs = [\n     \"host\" => \"localhost\",\n     \"user\" => \"root\",\n     \"dbtable\" => \"test\",\n     \"password\" => \"123456!@#\",\n     \"charset\" => \"\",\n];\n$worker->onWorkerStart = function($worker) {\n    // Create global db connection.\n    global $db_connection, $db_configs;\n    require_once your_path . \"/think/db/connector/mysql.php\";\n    // $db_connection = new \\think\\db\\connector\\MySQL($db_configs);\n    $db_connection = Db::connect($db_configs);\n};\n$worker->onMessage = function($client_connection, $data) {\n    // Reuse global db connection.\n    global $db_connection ;\n    $result = $db_connection ->table('')->select();\n    file_put_contents(\"/tmp/tmp.log\", var_export($result, true).\"\\n\", FILE_APPEND));\n};\n```\n--\nlike this!\n. @xpader \nthe code is defined only in '__construct', after that u can use it. If you worry about the continued use of memory, I think it can be ignored or u  can unset it in time. it is my opinion!. @walkor  okay. @ares333 \n32/2147483647\n64/9223372036854775807\nNormal does not appear above, personal perception can be ignored.. @327  please look your GatewayWorker version.. @hoangweb  please look http://wenda.workerman.net/?/question/1335. @hoangweb  can you show full code ?. @DeltaVetal26 \nYou provide the link https://www.websocket.org/echo.html is wss not ws protocol. please check which one you want to use. \nIf you use ws protocol, in the websocket js use 'ws://'; if you use wss protocol, in the websocket use 'wss://', in the server add ssl config  follow this link \nhttp://doc.workerman.net/faq/secure-websocket-server.html\n. @DeltaVetal26\nI don't understand ESP8266 devices  work, can you sure this device use websocket protocol? or this device use tcp/udp protocol?\nThis following may help you\n1) demo.php\n```php\n<?php\nrequire_once DIR . '/Workerman/Autoloader.php';\nuse Workerman\\Worker;\n$app_work = new Worker(\"websocket://0.0.0.0:8000\");\n$app_work->onWorkerStart = function ($worker) {\n    $inner_worker = new Worker(\"websocket://0.0.0.0:1234\");\n$inner_worker->onMessage = function ($connection, $data) use ($worker){\n    foreach($worker->connection  as $con) {\n        $con->send($data);\n    }\n};\n$inner_worker->listen();\n\n};\n$app_work->onMessage = function ($connection, $data) {\n    echo \"app_work=>\".$data.\"\\n\";\n};\n$app_work->runAll();\n```\n2) one browser \njs\nvar ws = new WebSocket(\"ws://127.0.0.1:1234\");\nws.onopen = function(e){console.log(\"onopen\");};\nws.onmessage = function(e){console.log(e.data);};\n3) another browser\njs\nvar ws = new WebSocket(\"ws://127.0.0.1:8000\");\nws.onopen = function(e){console.log(\"onopen\");};\nws.onmessage = function(e){console.log(e.data);};\nAt last good luck for you!\n. @DeltaVetal26  \nIt's ok to run your code on my computer\uff01\n```\n\n----------------------- WORKERMAN -----------------------------\nWorkerman version:3.5.11          PHP version:7.2.2\n------------------------ WORKERS -------------------------------\nuser          worker        listen                     processes status\nroot          none          websocket://0.0.0.0:12345   4         [OK] \n----------------------------------------------------------------\nPress Ctrl+C to stop. Start success.\nNew Client: 1\nNew Client: 2\n```\nThat's my websocket code\njs\nvar ws = new WebSocket(\"ws://127.0.0.1:12345\");\nws.onopen = function(e){console.log(\"onopen\");};\nws.onmessage = function(e){console.log(e.data);};\nPlease show your js websocket code.. @DeltaVetal26 \nThat's kind of weird. can you print log in your any websocket client?. @Tonkong\nPlease  update your workerman!. @olegius88 \nCan you show more informations that include the workerman version, the third-party framework, and the PHP version?. @olegius88 \nPlease do as he(@walkor) says \nI guess when your scripts are done , but you do not close mysql \nGood luck at last!\n. ",
    "winer632": "\u660e\u767d\u4e86\uff0c\u591a\u8c22\n. ",
    "pypypystudy": "usleep(10000);  \u8fd9\u79cd\u8017\u65f6\u7684\u4e1a\u52a1\uff0c\u5e94\u8be5\u4ea4\u7531\u540e\u53f0\u7a0b\u5e8f\u53bb\u5904\u7406\n. ",
    "xiaohuilam": "\nyesme2000 commented 10 minutes ago\nusleep(10000); \u8fd9\u79cd\u8017\u65f6\u7684\u4e1a\u52a1\uff0c\u5e94\u8be5\u4ea4\u7531\u540e\u53f0\u7a0b\u5e8f\u53bb\u5904\u7406\n\n10ms\u662f\u6a21\u62df\u4e1a\u52a1\u6267\u884c\u65f6\u95f4\uff0c\u50cf\u4e00\u822c\u590d\u6742\u5ea6\u7684\u4e1a\u52a1\uff0c\u5305\u542b\u4e00\u4e24\u4e2afor\u5faa\u73af\uff0c\u6267\u884c\u8017\u65f6\u57fa\u672c\u90fd\u5728 10ms \u7ea7\u522b\n. ",
    "impuulse": "Can you explain in more detail, thx.\n. exit with code - it's mean that timer stoped? In \"PROCESS STATUS\" no one timer left, and i manualy restart them. \n. Should i do manual restart when in \"PROCESS STATUS\" no one timer left? And what's is mean exit status 256 ?\n. ",
    "sm2017": "Why you have your own event loop? I think it is a mistake\nWorkerman is a powerful tool but there is a little plugin and extension for it \nCan you tell me how can I add a extension to workerman that based on reactphp event loop? for example these extensions\nhttps://github.com/reactphp/filesystem\nhttps://github.com/reactphp/http-client \n. Thanks a lot \ud83d\udc4d . How long it take to support this feature ?. OK , I want waiting and hope you implement this feature \nThank you. Any update?. Any updates?. I found the bug , /react/event-loop/src/Timer/Timers.php(90) use call_user_func and pass $timer as first parameter and ignore all other args :-(. I think , the solution is the following , instead of pass callback to react do the following\n```php\npublic static function add($time_interval, $func, $args = array(), $persistent = true)\n{\n$reactCallback = function() use ($func,$args) {\n    call_user_func_array($func,$args);\n    unset($func,$args);\n};\n//Other codes\n}\n. Thanks. You forgot to addphp\nunset($func,$args);\n```\nIt is very important part , As you know anonymous functions is Closure object , Also until you have a reference to object it remain to memory\nSo if you pass a variable in $args that refer to  Closure It remain in memory , It is safe to use unset. What about ngnix , h2o and other load balancing system , what you think?\nWhat about http://emqtt.io/ , I am planning to replace workerman Gateways with this , What do you think about performance?. Is there any solution ? without any proxy?. Run this code \n```php\nclass A{\n    public $a;\nfunction __destruct(){\n    echo \"This object(A) removed from memory<br/>\\n\";\n}\n\n}\nclass B{\n    public $B;\nfunction __destruct(){\n    echo \"This object(B) removed from memory<br/>\\n\";\n}\n\n}\n$a = new A;\n$a->a = function()use($a){\n};\n$b = new B;\n$b->b = $a;\nunset($a,$b);\necho \"You think both \\$a and \\$b are freed from memory But \\$a is in memory\\n\";\n````\nSo it is safe to use unset inside anonymous function\nAs you see object of class A is in memory and destructed in shutdown. Do you have plan to implement it?. Any update?. Any update?. Can you explain what is it? line by line. I reopen it as you mark this issue as enhancement. Any updates?. Where is problem? I am not familiar with strace\nResult of ps aux\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot      3945  0.0  0.1 370180 18236 pts/0    T    12:17   0:00 WorkerMan: master process  start_file=/home/index.php\nroot      3946  0.0  0.0 370180 10384 pts/0    T    12:17   0:00 WorkerMan: worker process  HTTP-Worker components\\protocols\\Http://0.0.0.0:80\nroot      3947  0.0  0.0 370180 10384 pts/0    T    12:17   0:00 WorkerMan: worker process  HTTP-Worker components\\protocols\\Http://0.0.0.0:80\nroot      3948  0.0  0.0 370180 10384 pts/0    T    12:17   0:00 WorkerMan: worker process  HTTP-Worker components\\protocols\\Http://0.0.0.0:80\nroot      3949  0.0  0.0 370180 10384 pts/0    T    12:17   0:00 WorkerMan: worker process  HTTP-Worker components\\protocols\\Http://0.0.0.0:80\nroot      3950  0.0  0.0 370468 10852 pts/0    T    12:17   0:00 WorkerMan: worker process  ChatBusinessWorker none\nroot      3951  0.0  0.0 370468 10852 pts/0    T    12:17   0:00 WorkerMan: worker process  ChatBusinessWorker none\nroot      3952  0.0  0.0 370180 10672 pts/0    T    12:17   0:00 WorkerMan: worker process  ChatBusinessWorker none\nroot      3953  0.0  0.0 370468 10868 pts/0    T    12:17   0:00 WorkerMan: worker process  ChatBusinessWorker none\nroot      3954  0.0  0.0 370244 11704 pts/0    T    12:17   0:00 WorkerMan: worker process  ChatGateway components\\protocols\\SecureWebsocket://0.0.0.0:1122\nroot      3955  0.0  0.0 370244 11716 pts/0    T    12:17   0:00 WorkerMan: worker process  ChatGateway components\\protocols\\SecureWebsocket://0.0.0.0:1122\nroot      3956  0.0  0.0 370244 11692 pts/0    T    12:17   0:00 WorkerMan: worker process  ChatGateway components\\protocols\\SecureWebsocket://0.0.0.0:1122\nroot      3957  0.0  0.0 370244 11700 pts/0    T    12:17   0:00 WorkerMan: worker process  ChatGateway components\\protocols\\SecureWebsocket://0.0.0.0:1122\nroot      3958  0.0  0.0 370180 10432 pts/0    T    12:17   0:00 WorkerMan: worker process  Register text://0.0.0.0:1236\nroot      3990  0.0  0.0 149144  1756 pts/0    R+   12:19   0:00 ps aux\nresult of strace -ttp 3946\nstrace -ttp 3946\nProcess 3946 attached\n12:23:55.104831 --- stopped by SIGTSTP ---\nresult of strace -ttp 3951\nstrace -ttp 3951\nProcess 3951 attached\n12:24:44.656523 --- stopped by SIGTSTP ---\nAll other pids has same result for strace -ttp pid\n. I use the following command\nphp index.php stop\nAfter that . all websocket connection of clients lost and disconnected.but database connection from business works is connected\n. Why websock connection is lost and no body can connect but the result of ps aux told gateway worker is alive??. > Did you pressed CTRL+Z?\nNo , How can I do this when I start php in daemon mod using php index.php start -d ?\nI only do the following\n php index.php start -d\n after 2-3 days php index.php stop. Again occurred \nps aux\n```\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot      4863  0.0  0.0 370180 10616 ?        S    08:38   0:00 WorkerMan: master process  start_file=/home/index.php\nroot      4868  2.1  1.2 505584 146200 ?       S    08:38   0:10 WorkerMan: worker process  ChatBusinessWorker none\nroot      4869  2.6  1.2 511728 152344 ?       S    08:38   0:12 WorkerMan: worker process  ChatBusinessWorker none\nroot      4870  2.6  1.6 560884 201496 ?       S    08:38   0:12 WorkerMan: worker process  ChatBusinessWorker none\nroot      4871  2.3  1.2 515824 156440 ?       S    08:38   0:11 WorkerMan: worker process  ChatBusinessWorker none\n```\nafter minutes , no workerman listed in ps aux \n. # result of strace -ttp  pid\n11:39:59.446451 write(1, \"pg_connect(): Unable to connect \"..., 206) = 206\n11:39:59.446548 rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0\n11:39:59.446685 rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0\n11:39:59.446811 rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0\n11:39:59.446937 nanosleep({1, 0}, 0x7ffe15bd2430) = 0\n11:40:00.447524 socket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 84\n11:40:00.447875 setsockopt(84, SOL_TCP, TCP_NODELAY, [1], 4) = 0\n11:40:00.448158 fcntl(84, F_SETFL, O_RDONLY|O_NONBLOCK) = 0\n11:40:00.448383 fcntl(84, F_SETFD, FD_CLOEXEC) = 0\n11:40:00.448498 setsockopt(84, SOL_SOCKET, SO_KEEPALIVE, [1], 4) = 0\n11:40:00.448643 connect(84, {sa_family=AF_INET, sin_port=htons(30001), sin_addr=inet_addr(\"10.10.10.11\")}, 16) = -1 EINPROGRESS (Operation now in progress)\n11:40:00.448809 poll([{fd=84, events=POLLOUT|POLLERR}], 1, 4294967295) = 1 ([{fd=84, revents=POLLOUT}])\n11:40:00.448950 getsockopt(84, SOL_SOCKET, SO_ERROR, [0], [4]) = 0\n11:40:00.449073 getsockname(84, {sa_family=AF_INET, sin_port=htons(42266), sin_addr=inet_addr(\"10.10.10.15\")}, [16]) = 0\n11:40:00.449217 poll([{fd=84, events=POLLOUT|POLLERR}], 1, 4294967295) = 1 ([{fd=84, revents=POLLOUT}])\n11:40:00.449365 sendto(84, \"\\0\\0\\0\\10\\4\\322\\26/\", 8, MSG_NOSIGNAL, NULL, 0) = 8\n11:40:00.449585 poll([{fd=84, events=POLLIN|POLLERR}], 1, 4294967295) = 1 ([{fd=84, revents=POLLIN}])\n11:40:00.449748 recvfrom(84, \"N\", 16384, 0, NULL, NULL) = 1\n11:40:00.449875 poll([{fd=84, events=POLLOUT|POLLERR}], 1, 4294967295) = 1 ([{fd=84, revents=POLLOUT}])\n11:40:00.450014 sendto(84, \"\\0\\0\\0i\\0\\3\\0\\0user\\0postgres\\0database\\0p\"..., 105, MSG_NOSIGNAL, NULL, 0) = 105\n11:40:00.450148 poll([{fd=84, events=POLLIN|POLLERR}], 1, 4294967295) = 1 ([{fd=84, revents=POLLIN}])\n11:40:00.453400 recvfrom(84, \"E\\0\\0\\0\\223SFATAL\\0CXX000\\0MCould not ob\"..., 16384, 0, NULL, NULL) = 148\n11:40:00.453498 close(84)               = 0\nI use pg_connect() in my code , how can I tell my application don't connect to pg when stopeed. >Do not use sleep in workerman.\nI never use but may be third party library use usleep for less than 1ms sleep\n\nAnd do not use infinite loop in workerman.\n\nI never use\nI only have heavy duty , 1M-10M events per second. I use PHP 7.0.14 and install https://github.com/expressif/pecl-event-libevent. I switch to EV and have this error\n```\nPHP Warning:  Ev::run(): Libev error(0): Success in /home/app/vendor/workerman/workerman/Events/Ev.php on line 171\nWarning: Ev::run(): Libev error(0): Success in /home/app/vendor/workerman/workerman/Events/Ev.php on line 171\nWORKER EXIT UNEXPECTED \n. I use beforelibev``` in php7 with workerman , before you switch to React , but for test I comment\nhttps://github.com/walkor/Workerman/blob/e3b1eea5ef24cb1bf394541a1ade35143c0d73b0/Worker.php#L854-L856\nto prevent react but same issue , I dont know why\n\nPlease use event extension.\n\nHow can I install event extension for PHP7 . I search web but don't find extension for PHP7\n. I install event but I have new issue\nNow my event handler is React using \\Workerman\\Events\\React\\ExtEventLoop , but my EV_READ event listener is not working , it works well with \\Workerman\\Events\\React\\StreamSelectLoop. For test I comment\nhttps://github.com/walkor/Workerman/blob/e3b1eea5ef24cb1bf394541a1ade35143c0d73b0/Worker.php#L854-L856\nNow my event loop is Workerman\\Events\\Event , I have this Warning\nWarning: Event::add(): Epoll ADD(1) on fd 24091136 failed. Old events were 0; read change was 1 (add); write change was 0 (none); close change was 0 (none): Bad file descriptor in /home/app/vendor/workerman/workerman/Events/Event.php on line 94\nPHP Warning:  Event::add(): Failed adding event in /home/app/vendor/workerman/workerman/Events/Event.php on line 94\nWhy I dont have this error for \\Workerman\\Events\\React\\ExtEventLoop ?\nWHY I HAVE NO ISSUE WITH \\Workerman\\Events\\React\\StreamSelectLoop ? WHY?!!?. php\n$connection = pg_connect(\"host=localhost port=5432 dbname=mary\");\n$socket = pg_socket($connection);\nWorker::$globalEvent->add($socket, EventInterface::EV_READ, function(){\n     //My Codes\n});\n. I test the code without workerman in a test file . it works well with libevent and php7\nBut in workerman when I enable libevent I have this error\n```\nWarning: stream_set_read_buffer(): supplied resource is not a valid stream resource in app/vendor/workerman/workerman/Connection/AsyncTcpConnection.php on line 266\nPHP Warning:  socket_import_stream(): supplied resource is not a valid stream resource in app/vendor/workerman/workerman/Connection/AsyncTcpConnection.php on line 270\nWarning: socket_import_stream(): supplied resource is not a valid stream resource in app/vendor/workerman/workerman/Connection/AsyncTcpConnection.php on line 270\nPHP Warning:  socket_set_option() expects parameter 1 to be resource, boolean given in app/vendor/workerman/workerman/Connection/AsyncTcpConnection.php on line 271\nWarning: socket_set_option() expects parameter 1 to be resource, boolean given in app/vendor/workerman/workerman/Connection/AsyncTcpConnection.php on line 271\nPHP Warning:  socket_set_option() expects parameter 1 to be resource, boolean given in app/vendor/workerman/workerman/Connection/AsyncTcpConnection.php on line 272\nWarning: socket_set_option() expects parameter 1 to be resource, boolean given in app/vendor/workerman/workerman/Connection/AsyncTcpConnection.php on line 272\nPHP Warning:  event_set(): fd argument must be either valid PHP stream or valid PHP socket resource in app/vendor/react/event-loop/src/LibEventLoop.php on line 256\nWarning: event_set(): fd argument must be either valid PHP stream or valid PHP socket resource in app/vendor/react/event-loop/src/LibEventLoop.php on line 256\nPHP Warning:  event_add(): Unable to add event without an event base in app/vendor/react/event-loop/src/LibEventLoop.php on line 263\nWarning: event_add(): Unable to add event without an event base in app/vendor/react/event-loop/src/LibEventLoop.php on line 263\nPHP Warning:  event_del(): Unable to delete event without an event base in app/vendor/react/event-loop/src/LibEventLoop.php on line 251\n. I run test script with event , this error occurred\nPHP Warning:  Event::add(): Epoll ADD(1) on fd 19004832 failed. Old events were 0; read change was 1 (add); write change was 0 (none); close change was 0 (none): Bad file descriptor in app/vendor/react/event-loop/src/ExtEventLoop.php on line 259\nPHP Warning:  Event::add(): Failed adding event in app/vendor/react/event-loop/src/ExtEventLoop.php on line 259\n``` \nWorkerman itself workes with event. Hi again\nPlease see https://github.com/expressif/pecl-event-libevent/issues/11 and reply \nThanks a lot. Moved to https://github.com/walkor/GatewayWorker/issues/19. See https://github.com/expressif/pecl-event-libevent/issues/11#issuecomment-286056747\nCan you help me ? can you understand why?\nI try to do same as workerman do in a test script but test script works well\n. The problem is \nhttps://github.com/walkor/Workerman/blob/master/Events/Libevent.php#L113\nThis event added to https://github.com/walkor/Workerman/blob/master/Connection/AsyncTcpConnection.php#L171 , but out of workerman project I cannot reproduce error , I think before https://github.com/walkor/Workerman/blob/master/Connection/AsyncTcpConnection.php#L171 we have another file descriptor that added to libevent , if right , can you tell me where I can find file descriptors that added to  Libevent before https://github.com/walkor/Workerman/blob/master/Connection/AsyncTcpConnection.php#L171. Why the new commit is not available in Packagist?\nhttps://packagist.org/packages/workerman/workerman#dev-master ,  b007a796a58e620b4ded93a19174e86d86d61d0c not 9b49339aff9adf9933454120f84ca63ac303b801 ?\nI use composer require workerman/workerman dev to update\n. Moved to https://github.com/walkor/GatewayWorker/issues/27. We can use http://php.net/manual/en/function.version-compare.php . OK \ud83d\udc4d . @farwish In heavy load how strace can be usable?. @farwish Not completely\nBut I am waiting for replies in related issues\nhttps://github.com/walkor/GatewayWorker/issues/36\nhttps://github.com/walkor/GatewayWorker/issues/37. @farwish . last version . and no strange message when stop fails. @walkor  yes and I dont know a solution. >How to judge the failure of the stop\uff1f\nWhen I run php index.php stop command it prints something like this (Not exactly as I type it not copy past , I have no output at the moment)\nstopping ...\nstop fails\n\nany screenshot ?\n\nI will send once. @ walkor 1 & 2 is not occured , I'm sure , please dont close issue when the stop fails occurred again I will check 3rd case. @walkor \ud83d\ude2d. @walkor ok , thanks a lot. ",
    "kse300489": "Maybe you use 64bit OS?\n. Ty, this is better.\nResult: Requests per second: 125142.43 [#/sec] (mean)\n. ",
    "jinliming2": "\u73b0\u5728\u770b\u6765\u5e94\u8be5\u662fwindows\u7248\u672c\u7684\u9505\u3002\u3002\u3002\n\u4e4b\u524d\u5728windows\u4e0b\u5f00\u53d1\uff0c[::]:8080\u53ea\u80fd\u76d1\u542c\u672c\u5730\u7684IPV6\u5730\u5740\uff0c\u4e0d\u80fd\u76d1\u542cIPV4\u5730\u5740\u3002\n\u73b0\u5728\u5c06\u6587\u4ef6\u4e22\u5230\u5c40\u57df\u7f51\u4e2d\u7684Linux\u4e86\uff0c\u5c06workerman\u4e5f\u66ff\u6362\u6210\u4e86Linux\u7248\u672c\uff0c\u5728\u5c40\u57df\u7f51\u4e2d\u901a\u8fc7IPV4\u548cIPV6\u90fd\u80fd\u8bbf\u95ee\u4e86\u3002\n. \u8c22\u8c22\u3002\n. @walkor \u987a\u4fbf\u95ee\u4e00\u4e0b\uff0c\u5728\u624b\u52a8\u6267\u884cphp xxx.php stop\u7ed3\u675f\u7684\u65f6\u5019\uff0clog\u91cc\u4f1a\u51fa\u73b0\u591a\u6761\nworker[none:****] exit with status 9\n\u4e00\u5806\u72b6\u6001\u7801\u4e3a9\u7684\u9000\u51fa\u4fe1\u606f\u3002\u8fd9\u4e2a\u4e00\u822c\u662f\u7531\u4ec0\u4e48\u5f15\u8d77\u7684\uff1f\u6709\u5f71\u54cd\u4e48\uff1f\n. \n. \u55ef\uff0c\u76ee\u524d\u53bb\u6389event\u6269\u5c55\uff0c\u5b50\u8fdb\u7a0b\u91cc\u4f7f\u7528Worker::stopAll();\uff0c\u5c31\u90fd\u6b63\u5e38\u4e86\uff0c\u5b50\u8fdb\u7a0b\u9000\u51fa\u540e\u4e5f\u4e0d\u5f71\u54cdstatus\u91cc\u7684\u663e\u793a\uff0c\u65e5\u5fd7\u91cc\u4e5f\u6ca1\u6709\u5f02\u5e38\u9000\u51fa\u7684\u4fe1\u606f\u3002\n\u4e0d\u8fc7\u7684\u786e\u53ef\u80fd\u51fa\u73b0\u65e0\u6cd5\u9884\u6d4b\u7684\u95ee\u9898\uff0c\u540e\u671f\u518d\u60f3\u5176\u4ed6\u89e3\u51b3\u65b9\u6848\u3002\n\u4e0d\u8fc7\u6211\u8fd8\u662f\u5e0c\u671b\u80fd\u7ed9\u4e2a\u6bd4\u8f83\u597d\u7684\u5f02\u6b65\u6267\u884c\u547d\u4ee4\u7684\u65b9\u6848\u3002\u3002\u3002. \u55ef\uff0c\u8fd9\u4e2a\u7684\u610f\u601d\u5c31\u662f\u5199\u4e24\u4e2aworkerman\uff0c\u4e00\u4e2a\u7528\u4e8e\u5904\u7406\u7528\u6237\u7684\u8fde\u63a5\u670d\u52a1\uff0c\u7136\u540e\u628a\u9700\u8981\u6267\u884c\u7684\u4efb\u52a1\u4ea4\u7ed9\u53e6\u4e00\u4e2aworkerman\u53bb\u5904\u7406\u3002\n\u8fd9\u6837\u505a\u4e5f\u53ef\u4ee5\uff0c\u4f46\u5c31\u662f\u5904\u7406\u4efb\u52a1\u7684workerman\u7684\u8fdb\u7a0b\u6570\u4e0d\u592a\u597d\u628a\u63e1\uff0c\u8bbe\u7f6e\u5c11\u4e86\u5728\u9ad8\u5cf0\u671f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u90e8\u5206\u4efb\u52a1\u4e0d\u80fd\u53ca\u65f6\u5206\u914d\u5230\uff0c\u8bbe\u7f6e\u591a\u4e86\u4f1a\u957f\u65f6\u95f4\u5360\u7528\u5185\u5b58\u8d44\u6e90\u3002. \u542c\u8d77\u6765\u4e0d\u9519\uff0c\u53ef\u4ee5\u8bd5\u8bd5\u3002. ",
    "xpader": "\u7406\u8bba\u4e0a\u4e0d\u5e94\u8be5\u5728 worker \u8fdb\u7a0b\u4e2d\u81ea\u5df1\u8fdb\u884c fork() \u64cd\u4f5c\u5427\uff0c\u81ea\u5df1\u5728\u6d41\u7a0b\u4e2d fork \u7684\u8fdb\u7a0b\u6ca1\u80fd\u8d70 Workerman \u5185\u7f6e\u7684\u6d41\u7a0b\uff0c\u4f46\u5f88\u591a\u8d44\u6e90\u6307\u5411\u76f8\u540c\uff0c\u9000\u51fa\u65f6 Workerman \u4e2d\u5f97\u4e0d\u5230\u8be5\u8d44\u6e90\uff0c\u4f46 fork \u524d\u7684\u8fdb\u7a0b\u8fd8\u5728\uff0c\u7406\u8bba\u4e0a\u5c31\u662f\u5e94\u8be5\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\u3002\u90a3\u5c31\u662f status \u547d\u4ee4\u770b\u4e0d\u5230\uff0c\u4f46\u8fd8\u80fd\u63a5\u53d7\u8bf7\u6c42\u8fdb\u884c\u5904\u7406\uff0c\u56e0\u4e3a socket \u8d44\u6e90\u8fd8\u628a\u6301\u5728\u90a3fork \u524d\u7684\u8fdb\u7a0b\u4e2d\u5462\u3002. Make the long time job or blocking job to queue, or another worker process.. \u628a debug_backtrace \u5b58\u5230\u5c5e\u6027\u4e2d\u4e0d\u662f\u4f1a\u6301\u7eed\u5360\u7528\u66f4\u591a\u7684\u5185\u5b58\u4e48\uff0c\u8fd9\u4e2a\u4e5f\u4e0d\u5c11\u554a\uff0c\u800c\u4e14\u5e26\u6765\u7684\u6027\u80fd\u63d0\u5347\u5bf9\u5173\u952e\u4e1a\u52a1\u597d\u50cf\u4e5f\u6ca1\u6709\u5e2e\u52a9\u3002. Use ps auxf | grep Workerman in linux, or use ps auxd | grep Workerman in FreeBSD to show your process tree.\nPaste you phpversion, and you php -m info.. Use Constant is more good performance, why not merge it?\nA little performance improvement.\nNo any bad things.. \ud83d\udc80. I think we better not run Yii in Workerman, because Yii is not designed to run persistently in the process, that may make memory leak.. ",
    "ronindesign": "Managing multiple instances is definitely in the scope of workerman.\nHowever, you may be missing a stage of async looping, as you never call the wait() method.\nFor example:\nphp\nwhile(1) $ts3WelcomeBot->getAdapter()->wait();\nMost likely you will need to implement non-blocking loop that integrates the $worker->manage() at the right level.\nFor example, we see in the source for wait():\n```php\ndo {\n  $evt = $this->getTransport()->readLine();\n} while($evt instanceof TeamSpeak3_Helper_String && !$evt->section(TeamSpeak3::SEPARATOR_CELL)->startsWith(TeamSpeak3::EVENT));\nreturn new TeamSpeak3_Adapter_ServerQuery_Event($evt, $this->getHost());\n```\nSome options:\n1) If you include built-in wait(), then internally waitForReadyRead() will continually block on stream until waitTimeout value before it loops.\n2) Use $worker->manage() to handle the read mechanism looping. You'll still need to implement the read logic, but the worker should have no problem handling the stream management.\n3) Implement your own read mechanism that doesn't block, similar to lots of native stream select switching implementations, you can find examples online.. @walkor this makes sense for the action stage of the logic.\nHowever, since the TeamSpeak3 class is used in managing (and emitting) during the listen stage, the logic or scenario is more complex.\nThe issue currently is that the TeamSpeak3 class blocks internally while listening to sockets, so this seems to complicate using workerman to manage each connection. . ",
    "JABirchall": "Yes, we are aware the framework in its current state would block workman, the framework is currently being rewritten to v2 and researching possible options. As the last major update was sometime in 2012 to add support for the multiple protocols in TeamSpeak (ServerQuery, FileTransport, TSDNS etc). But to use all of them, you need to create separate scripts or disconnect from on and reconnect to the other visa verse.\nv2 will plan to have, multiple instance support, PSR-4 autoloading, better event handling etc.. ",
    "BoundlessHaung": "\u5c34\u5c2c\u7684\u5730\u65b9\u4e3b\u8981\u662fonMessage\u91cc\u80fd\u8bbf\u95ee\u00b7\u00b7onConnect \u5374\u4e0d\u884c\u00b7. \u4e0d\u597d\u610f\u601d\u25cf\ufe4f\u25cf\uff0c\u521a\u624d\u4ed4\u7ec6\u770b\u4e86\u4e00\u4e0b\uff0c\u786e\u5b9e\u641e\u9519\u4e86\u00b7\u00b7\u00b7\u6709\u70b9\u60f3\u5f53\u7136\u4e86\u3002. ",
    "forkeer": "Dec 11, 2016  from now has not changed?. tnx. walkor \nplease do it i need this feature . walkor from 29 days ago\nany update ?. tnx. hi walkor \nany update ????. Try running it with strace -f -v. ",
    "RubyTheRose": "Coming back to this a year later, this issue seems to be closed abruptly without any real solution created.. ",
    "dorw123": "Hi walkor. \nI have a CentOS server. I would like to know how to start my server as a deamon on startup. I put the script in rc.local to run on startup but it seems that the server is not starting. When checking with status parameter says \"not run\".. ",
    "ishland": "I think you need to check if that process is a workerman process.. You just have to make a protocol detector. And start a internal listening in this worker.\nThis can switch protocol without upgrade header.. Fixes when packed as a phar, can not stop a daemon process. Displays \"not run\"\nAdds help messages.\nI have a project uses workerman, packed as a phar. I need to fix it.\n\u5f53\u7a0b\u5e8f\u6253\u5305\u6210phar\u7684\u65f6\u5019\u65e0\u6cd5\u505c\u6b62\u5b88\u62a4\u8fdb\u7a0b\uff0c\u8ba4\u4e3a\u6ca1\u6709\u5728\u8fd0\u884c\u3002\n\u6dfb\u52a0\u5e2e\u52a9\u4fe1\u606f\n\u6211\u6709\u4e00\u4e2a\u9879\u76ee\u4f7f\u7528phar\u6253\u5305\u3002\u6211\u8981\u4fee\u590d\u8fd9\u4e2a\u95ee\u9898\u3002. Maybe that is not a good idea.. @ares333 All right.. Self fixed. it was memory leaks, but i fixed by myself. ",
    "linkec": "@dorw123 did you use -d parameter? or set Worker::$daemonize = true; I think it should fix your problem.. I thought this will not fixed, whether you disabled Error reporting, then you are not able to track the crash.. this is for debug , you can disable it when you finish your development.\nbut tbh , these warning/error messages are useful during your program is running.\nyou can quick track to the error and find out where is wrong.\nI strongly suggest do not turn it off.. ",
    "detain": "To check to see if its running and safely remove pid files can do something like:\nbash\nif [ $(php start.php status 2>/dev/null|grep \"PROCESS STATUS\"|wc -l) -eq 0 ]; then\n  # clean up old run, remove pid file or run a stop command?\n  php start.php stop\n  php start.php start -d\nfi. ",
    "joanebrown": "As I see in my composer I have the latest version workerman/phpsocket.io 1.1 and the \"workerman/workerman\": \"^3.3\",. How can I check if this is real? How can I update with composer?\nThank you very much for your amazing work. Well, I see the code of phpsocket.io and I have the fixex by @Buri but still fails, as I described you...\nThe error is in workerman, not inside phpsocket.io \nWhen I add a conditional in /var/www/myapp/vendor/workerman/workerman/Events/React.php on line 9 for check if $fd is null, all works well:\ncase EventInterface::EV_TIMER_ONCE;\n    if($fd !== null){\n        return  $this->_loop->cancelTimer($fd);\n    }\n[...]\n\n. @walkor Have you tried my fix?. Of Course :-) Thank you.\n. No, thank you for your amazing work :-)\n. ",
    "tolew1": "@joanebrown  thank you for that patch. I can confirm I was having this problem and that fixed the fatal error above. This does need to be in the update so that composer won't overwrite when updated. . ",
    "benwaffle": "yes, but UTC is a good default for all users. Why does workerman need the timezone at all?. ",
    "wwng2333": "debug\u542f\u52a8\u6b63\u5e38\n\u4e1a\u52a1\u4ee3\u7801\uff1ahttps://github.com/wwng2333/tz. \u6709\u8bbe\u7f6eonMesage \u5728\u7b2c332\u884c. root@wwng-lan:/tmp/home/root/tz# php tz.php status\nWorkerman[tz.php] status\nroot@wwng-lan:/tmp/home/root/tz#\nstart -d\u4ee5\u540estatus\u65e0\u7ed3\u679c. root@wwng-lan:/tmp/home/root# ps | grep php\n12986 root     13732 S    php tz.php start -d\n12987 root     13732 S    php tz.php start -d\n12988 root     13732 S    php tz.php start -d\n12989 root     13732 S    php tz.php start -d\n12990 root     13732 S    php tz.php start -d\n22297 root      1376 S    grep php\nroot@wwng-lan:/tmp/home/root# netstat -an | grep 81\ntcp        0      0 0.0.0.0:81              0.0.0.0:*               LISTEN. \u6211\u53bb\u7f16\u8bd1\u4e2a5.6. ```\nroot@wwng-lan:/tmp/home/root/tz# php5 tz.php start -d\nWorkerman[tz.php] start in DAEMON mode\n----------------------- WORKERMAN -----------------------------\nWorkerman version:3.3.6          PHP version:5.6.30\n------------------------ WORKERS -------------------------------\nuser          worker        listen             processes status\nroot          Proberv       http://0.0.0.0:81   5         [OK]\n----------------------------------------------------------------\nInput \"php tz.php stop\" to quit. Start success.\nroot@wwng-lan:/tmp/home/root/tz# php5 -v\nPHP 5.6.30 (cli) (built: Jan 31 2017 23:44:12)\nCopyright (c) 1997-2016 The PHP Group\nZend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies\nroot@wwng-lan:/tmp/home/root/tz# php5 -m\n[PHP Modules]\nCore\nctype\ncurl\ndate\ndom\nereg\nhash\njson\nlibxml\nmbstring\npcntl\npcre\nposix\nReflection\nsession\nSimpleXML\nSPL\nsqlite3\nstandard\nxml\nzip\nzlib\n[Zend Modules]\nroot@wwng-lan:/tmp/home/root/tz# ps | grep php\n20719 root     13076 S    php5 tz.php start -d\n20731 root     13336 S    php5 tz.php start -d\n20732 root     13336 S    php5 tz.php start -d\n20734 root     13336 S    php5 tz.php start -d\n20735 root     13336 S    php5 tz.php start -d\n20736 root     13336 S    php5 tz.php start -d\n20750 root      1376 S    grep php\nroot@wwng-lan:/tmp/home/root/tz# curl 127.0.0.1:81\ncurl: (52) Empty reply from server\n\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u4e00\u5207\u6b63\u5e38. \u6211\u6000\u7591\u662f\u5c11\u7f16\u8bd1\u4e86\u4ec0\u4e48\u6a21\u5757 \u4f46\u662f\u6839\u636e\u6587\u6863\u4f3c\u4e4e\u8be5\u6709\u7684\u90fd\u6709\u4e86. \u7ecf\u8fc7\u5206\u6790\u53d1\u73b0 \u8c03\u7528floor round (int) \u548c % \u4f1a\u5bfc\u81f4core dump\n\u770b\u6765\u6ca1\u6cd5\u7528\u4e86.\n[XZB /opt/bin]# ps | grep WorkerMan\n 5974 admin     1592 S    grep WorkerMan\n21084 admin     8592 S    {php} WorkerMan: worker process  Proberv http://0.0.0.0:2345\n21085 admin     8592 S    {php} WorkerMan: worker process  Proberv http://0.0.0.0:2345\n21086 admin     8592 S    {php} WorkerMan: worker process  Proberv http://0.0.0.0:2345\n3\u4e2a.\n[XZB /opt/tz]# php5 tz.php start -d\nWorkerman[tz.php] start in DAEMON mode\n----------------------- WORKERMAN -----------------------------\nWorkerman version:3.3.9          PHP version:5.6.30\n[XZB /opt/tz]# ------------------------ WORKERS -------------------------------\nuser          worker        listen               processes status\nroot          Proberv       http://0.0.0.0:2345   3         [OK] \n----------------------------------------------------------------\nInput \"php tz.php stop\" to quit. Start success.\n[XZB /opt/tz]# php5 tz.php status\nWorkerman[tz.php] status \n[XZB /opt/tz]# php5 tz.php status\nWorkerman[tz.php] status \nWorkerman[tz.php] not run\n[XZB /opt/tz]# uname -a\nLinux XZB 3.4.113 #5 SMP Mon Feb 20 22:37:44 CST 2017 mips GNU/Linux\n.\n[XZB /opt/home/admin]# strace -p 3703\nstrace: Process 3703 attached\nwait4(-1, 0x7f90e1d8, WSTOPPED, NULL)   = ? ERESTARTSYS (To be restarted if SA_RESTART is set)\n--- SIGUSR2 {si_signo=SIGUSR2, si_code=SI_USER, si_pid=3712, si_uid=0} ---\nsigreturn({mask=[]})                    = -1 EINTR (Interrupted system call)\nrt_sigprocmask(SIG_BLOCK, ~[RTMIN RT_1], [], 16) = 0\numask(000)                              = 000\nlseek(3, 0, SEEK_SET)                   = 0\nwrite(3, \"\", 0)                         = 0\nclose(3)                                = 0\nclose(2)                                = 0\nclose(1)                                = 0\nclose(4)                                = 0\nclose(0)                                = 0\nmunmap(0x76e7a000, 266240)              = 0\nmunmap(0x76ec5000, 1052672)             = 0\nmunmap(0x76fc6000, 266240)              = 0\nbrk(0xdfb000)                           = 0xdfb000\nexit_group(0)                           = ?\n+++ exited with 0 +++\n`php5 tz.php status`\u540e\u4e3b\u8fdb\u7a0b\u5c31\u6d88\u5931\u4e86. \u5e76\u6ca1\u6709\u6539\u8fc7\n\u521a\u624d\u91cd\u65b0\u4e0b\u4e86\u4e00\u4efd`https://github.com/walkor/Workerman/archive/v3.3.9.zip`\n\u8fd8\u662f\u4e00\u6837. https://github.com/wwng2333/tz.\n[XZB /opt/tz]# tail -10 workerman.log \n2017-02-25 16:10:23 pid:3730 Workerman[tz.php] status \n2017-02-25 16:16:10 pid:3736 Workerman[tz.php] status \n2017-02-25 16:16:10 pid:3736 Workerman[tz.php] not run\n2017-02-25 16:16:13 pid:3737 Workerman[tz.php] stop \n2017-02-25 16:16:13 pid:3737 Workerman[tz.php] not run\n2017-02-25 16:16:19 pid:3740 Workerman[tz.php] start in DAEMON mode\n2017-02-25 16:16:19 pid:3743 Warning: User root not exsits\n2017-02-25 16:16:19 pid:3745 Warning: User root not exsits\n2017-02-25 16:16:19 pid:3744 Warning: User root not exsits\n2017-02-25 16:16:33 pid:3749 Workerman[tz.php] status \n\u65e5\u5fd7\u6307\u7684\u662f\u8fd9\u4e2a\u5417. \u660e\u767d\u4e86 \u6211\u73b0\u5728\u53bb\u6392\u67e5. \u6309\u7167\u60a8\u7684\u65b9\u6cd5\uff0c\u83b7\u5f97\u62a5\u9519\u5982\u4e0b\uff1a\n[XZB /opt/tz]# php tz.php start\nWorkerman[tz.php] start in DEBUG mode\nWarning: User root not exsits\n----------------------- WORKERMAN -----------------------------\nWarning: User root not exsits\nWorkerman version:3.3.9          PHP version:7.1.2\n------------------------ WORKERS -------------------------------\nuser          worker        listen               processes status\nroot          Proberv       http://0.0.0.0:2345   3         [OK] \n----------------------------------------------------------------\nPress Ctrl-C to quit. Start success.\nWarning: User root not exsits\nFatal error: Uncaught Error: Call to undefined function Workerman\\sys_getloadavg() in /opt/tz/vendor/Worker.php:1213\nStack trace:\n0 /opt/tz/vendor/Worker.php(774): Workerman\\Worker::writeStatisticsToStatusFile()\n1 [internal function]: Workerman\\Worker::signalHandler(17, Array)\n2 /opt/tz/vendor/Worker.php(1022): pcntl_signal_dispatch()\n3 /opt/tz/vendor/Worker.php(434): Workerman\\Worker::monitorWorkers()\n4 /opt/tz/tz.php(1104): Workerman\\Worker::runAll()\n5 {main}\nthrown in /opt/tz/vendor/Worker.php on line 1213\n.php\nif(!function_exists('sys_getloadavg')) {\n    function sys_getloadavg()\n    {\n        $loadavg = explode(' ', file_get_contents('/proc/loadavg'));\n        for($i=0;$i<3;$i++) {\n            $__loadavg[] = $loadavg[$i];\n        }\n        return $__loadavg;\n    }\n}\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86.php\nexec('php /root/ffpanel_api/cron.php &');\n``\nafter add a&, it works fine.. after rebuild php in local machine, it works.. seems it's about kernel version\nit works under 4.4.0-63. Got it.\nThanks for help.. After addWorker::stopAll();` works well.. ",
    "adrianofoschi": "Thanks you. ok it works perfectly. I've open a new pull request for PHPSOCKETIO\nhttps://github.com/walkor/phpsocket.io/pull/72\nThanks you. ",
    "williamborba": "Hello @walkor I got to do it http server render static files Inserting content-type this way\nphp\nHttpCache::$header['Content-Type'] = \"Content-Type: text/css;charset=utf-8\\r\\n\";\n...\nHttpCache::$header['Content-Type'] = \"Content-Type: application/javascript;charset=utf-8\\r\\n\";\nFor files css it's ok, but for js not work because ..\n```\nServer: workerman/3.3.6\nContent-Length: 86709\n/! jQuery v3.1.1 | (c) jQuery Foundation | jquery.org/license /\nHow keeping clean header and send to buffer only content of file...?\nHere there is the error reported of browser..\nSyntaxError: missing ; before statement[Learn More]  ... jquery-3.1.1.min.js:1:21\n```\nHere it's line of code ..\nhttps://github.com/walkor/Workerman/blob/master/Protocols/Http.php#L231. ",
    "sudevva": "Thanks. Closed.. I'm sorry.\nMy native language is not english too. But please use english, that can help other people to understand each other. Thanks). Our audience and contributors are multi-lingual, consider this, maybe someone else besides the author will want to solve your problem.. The free worker will get the data. This thing is behind OS load balance. Walkor can you write some article(work flow maybe) about how it works? When the worker start to listen and how they listen one socket. It's will be very interesting.. +1 thank you. ",
    "ClosetMonkey": "Sorry if I make this issue murky, but unix sockets are not ideal candidates for async network operations. the term async is used in network programming to discribed non-blocking network apis, ie the task is will typically still be done in the calling thread but progression of the thread will not halt due to \"blocking events\". The concept of blocking events are totally different between an TCP socket and UNIX domain socket. TCP has to handle flow control, congestion control, resending of lost packets, control messages etc, all of which can cause delays (blocks) from just a couple milliseconds to even hundreds of milliseconds. Unix domain sockets however are not network bound and are only a wrapper for stable and reliable local IPC queues. blocking events within Unix domain sockets are typically system related (context switches etc) and only cause delays in microseconds or even nanoseconds, and often with a great many of such blocking events happening in per second. This can lead to an entire processor's resources being consumed by just by trying to handle the non-blocking reading and writing.. ",
    "mkeyno": "@walkor  thanks for reply , I have ssh private/public key but I don't know how to configure putty  to connect my host server. ",
    "ronalfei": "\u8fd9\u4e2apr\u5408\u5e76\u4e86\u5417?  \u6211\u4e5f\u9047\u5230\u4e86\u8fd9\u4e2a\u95ee\u9898, \u4f46\u6211\u8ba4\u4e3a\u4e0d\u5e94\u8be5\u7528is_json\u6765\u505a\u5224\u65ad, \u5e94\u8be5\u7528content_type\u6765\u5224\u65ad.\n parse_str($http_body, $_POST) \u4e3b\u8981\u662f\u9488\u5bf9 'CONTENT_TYPE' => 'application/x-www-form-urlencoded'\u8fd9\u79cd\u60c5\u51b5\u7684, \u7406\u60f3\u7684\u5904\u7406\u662fcontent-type\u4ec5\u4ec5\u4e3aform-urlencode\u7684\u65f6\u5019\u624d\u7528parse_str \u89e3\u6790\u5230$_POST\u4e4b\u4e2d\u53bb. . ",
    "vponomarev": "@garveen WebSocket client library now supports SubProtocols.. Yes, you're right.\nEven more, to save maximum level of control $connection->onWebSocketConnect should have a priority over $connection->worker->onWebSocketConnect.\nSomething like this:\nif (isset($connection->onWebSocketConnect) || isset($connection->worker->onWebSocketConnect)) {\n$wsEvent = isset($connection->onWebSocketConnect)?$connection->onWebSocketConnect:$connection->worker->onWebSocketConnect;\n...\ncall_user_func($wsEvent,...);\n}\n. ",
    "jiaoge008": "The master process forks multi worker process\uff0cthese worker processes will listen the same socket\u3002How to decide which worker process handle the data that come from the listened socket? Does thundering herd will happen?. It means that the OS(POSIX type OS) is in charge of dispatching data. Is it?. Thank you very much.. ",
    "Hypoaristerolactotherapist": "I can't grab the list of currently open timed tasks in Timer. self::$_tasks is always empty when I have a timer running. none works, I will get try directly from globalEvent. @walkor I have something decent but am having issues with changing the event loop to something else than select, I have to install all others before I can update these. I have an intense two weeks so I'll get back to it later.\nMy small test is done with\n```php\n<?php\nrequire_once(\"Autoloader.php\");\nuse Workerman\\Worker;\nuse Workerman\\Lib\\Timer;\n$task = new Worker();\n$task->name = \"Stats Test\";\n$task->count = 8;\n//Worker::$eventLoopClass = '\\Workerman\\Events\\Libevent';\n//Worker::$eventLoopClass = '\\Workerman\\Events\\Event';\n//Worker::$eventLoopClass = '\\Workerman\\Events\\Ev';\n//Worker::$eventLoopClass = '\\Workerman\\Events\\React\\ExtEventLoop'\n//Worker::$eventLoopClass = '\\Workerman\\Events\\React\\LibEventLoop'\n//Worker::$eventLoopClass = '\\Workerman\\Events\\React\\StreamSelectLoop'\nclass foo\n{\n    public function bar()\n    {\n        echo \"|\";\n    }\n}\n$task->onWorkerStart = function($task)\n{\n    $foo = new foo();\n    for($i = 1; $i <= 4;$i++)\n    {\n        Timer::add($i,[$foo,\"bar\"]);\n        Timer::add($i*1.5,function()\n        {\n            echo \"-\";\n        });\n    }\n};\n// run all workers\nWorker::runAll();\n```. Hi @abshammeri I built a backend server on Workerman for these long running jobs. What it does is this\n\nCustom protocol to accept a job\nPut the job in a queue and return a job ID\nTimers run the job offline and put the result in a specific place under the given job ID\nThe client can come later to check the result at this specific place and check - non blocking - if the result is available\n\nIt also allows me to have a custom cron server I can run to the second using timers.\nHope it helps. ",
    "zhiephie": "Thanks @walkor . ",
    "dandanlee": "What is the difference between the two?. ",
    "88gumak88": "This is the main difference. because i use port 443  . ",
    "chenyangguang": "@Wakirin \u8fd9\u91cc\u6709\u4f8b\u5b50\uff0c\u5e94\u8be5\u770b\u770b\u6587\u6863\uff0c\u548c\u4ed6\u7684\u6e90\u7801\uff0c\u90fd\u662f\u53ef\u4ee5\u8ddf\u8e2a\u7684\uff0c\u6bd4swoole\u597d\u770b\u591a\u4e86\u3002. Oh, well then. It's not a big bug. It's just a reminder. Ignore it. Close this issue please.. ",
    "wakirin": "Sorry, I don't understand Chinese. I think, it that what I need. Thx.\n// \u5efa\u7acbsocket\u8fde\u63a5\u5230\u5185\u90e8\u63a8\u9001\u7aef\u53e3\n$client = stream_socket_client('tcp://127.0.0.1:5678', $errno, $errmsg, 1);\n// \u63a8\u9001\u7684\u6570\u636e\uff0c\u5305\u542buid\u5b57\u6bb5\uff0c\u8868\u793a\u662f\u7ed9\u8fd9\u4e2auid\u63a8\u9001\n$data = array('uid'=>'uid1', 'percent'=>'88%');\n// \u53d1\u9001\u6570\u636e\uff0c\u6ce8\u610f5678\u7aef\u53e3\u662fText\u534f\u8bae\u7684\u7aef\u53e3\uff0cText\u534f\u8bae\u9700\u8981\u5728\u6570\u636e\u672b\u5c3e\u52a0\u4e0a\u6362\u884c\u7b26\nfwrite($client, json_encode($data).\"\\n\");\n// \u8bfb\u53d6\u63a8\u9001\u7ed3\u679c\necho fread($client, 8192);. It's not working, sorry for long response. \nLast time I leaved current project and now return.\nI use this example https://github.com/walkor/Workerman/issues/175#issuecomment-302005328 with Channel,\nhow to send direct from php?. It's helped. \nThanks.. @walkor I am tried detect message is delivered to user or not, with $worker->count=4;, but don't understand how to do it. I just want create notification job, if message not delivered, but at now it's duplicate 4 times. Can you help with it? What better way for me ?. @walkor \nsorry for disturb, now I see it's question not about Workerman. . @lumenier1 \nInstall workerman\\channel with command\ncomposer require workerman/channel. At now, I use this command for kill all process:\nkill -9 $(ps aux|grep WorkerMan|grep test|awk '{print $2}')\nMaybe somebody will advise better solution.. @denfm it's working, thanks!. @walkor \ndo I need remove stopsignal=INT from config, if workerman stable version will be update ?. ",
    "Feryo": "Ive got the same question. But I would also ask, how to send data to the Master, and how to send data from one connection to another from other worker (and from the same worker).. I get, that for 1 worker we can do this:\n```\nforeach($worker->connections as $connection)\n{\n    $connection->send(\"Hello everybody!\");\n}\n// And this is for one user by connection id=1: \n$worker->connections[1]->send('Hello, user 1');\n```\nBut for many workers we have to send data to master, and the master will send it to the certain worker, but how we can do that?. Thank you very much! But is there a way to send data to the certain worker by its id without checking all incomming data in every worker?. ",
    "ImadBazzal": "Thank You!. ",
    "lumenier1": "Sorry, but I can't find Channel\\Server class in the sources. I tried to implement it $channel_server = new Channel\\Server('0.0.0.0', 2206); but an error occurs.... ",
    "S-Kerrigan": "Hm, guys can anyone say me, how it possible run on Windows?\nI just get \"classic-error\" about \"multi workers init in one php file are not support\"\nI know, that need split to two files this sample-code. However, i cannot understand, how it possible, when need in code of \"base-worker\" have a code of \"channel-worker\". . ",
    "kak2z7702": "Hey. I ask for help. I have a chat. There are many rooms in the chat. How can I make my own channel for each room? I need to send a message to all users of the room. How can I add a user to the channel? I think this needs to be done during the onConnect event. But I do not know how. Thank.. Maybe I set myself the task incorrectly?\nI have:\n1. Wockerman with one woker.\n2. Chat where a lot of rooms.\nI need:\n1. Send messages within the same chat room.\n2. Send messages to one user.\nNow:\n1. When registering in a room, I remember in which room this user.\n2. When the user sends a message, I see each the connections from the array.\n3. I send a message to those who are from the same room.\nI need again):\n1. Several woker.\n2. If one woker recive message - all the woker received this message too. At each woker, you must look at each connection and send it to those connections that are from the correct room.. Hi. I ask for help. After installing the extension, Workerman highly loads the CPU. Why is that? Thank.\n`Workerman[server.php] status\n----------------------------------------------GLOBAL STATUS----------------------------------------------------\nWorkerman version:3.5.16          PHP version:7.1.22\nstart time:2019-01-26 11:19:13   run 0 days 0 hours\nload average: 3.03, 3, 3         event-loop:\\Workerman\\Events\\Event\n3 workers       3 processes\nworker_name   exit_status      exit_count\nChannelServer 0                0\nnone          0                0\nnone          0                0\n----------------------------------------------PROCESS STATUS--------------------------------------------------\npid     memory  listening                worker_name   connections send_fail timers  total_request qps    status\n20737   4M      frame://0.0.0.0:2208     ChannelServer 0           0         0       0             0      [idle]\n20738   6M      websocket://0.0.0.0:8088 none          30          0         0       9184          0      [idle]\n20739   4M      tcp://127.0.0.1:1239     none          1           0         0       0             0      [idle]\n----------------------------------------------PROCESS STATUS---------------------------------------------------\nSummary 14M     -                        -             31          0         0       9184          0      [Summary]\n20736 root       20   0  246M 20128 11040 S  0.0  0.1  0:00.00 WorkerMan: master process  start_file=/var/www/***/server.php\n20737 root       20   0  246M 16108  7016 S  0.0  0.0  0:00.00 WorkerMan: worker process  ChannelServer frame://0.0.0.0:2208\n20739 root       20   0  246M 16228  7136 S  0.0  0.0  0:00.00 WorkerMan: worker process  none tcp://127.0.0.1:1239\n20738 root       20   0  252M 26292 11656 R 18.6  0.1  1:33.93 WorkerMan: worker process  none websocket://0.0.0.0:8088\nmy server \n1  [||||||||||                                                                     10.4%]     5  [|||||||||||||||||                                                              19.0%]\n  2  [||||||||||||                                                                   13.0%]     6  [||||||||||||||||                                                               18.5%]\n  3  [|||||||||||||||||||||||||                                                      29.7%]     7  [||||||||||||||||                                                               18.4%]\n  4  [|||||||||                                                                       9.9%]     8  [|||||||||||||||||||                                                            21.8%]\n  Mem[|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||   6372/32105MB]     Tasks: 77, 154 thr; 2 running\n  Swp[|                                                                         35/12279MB]     Load average: 2.26 2.79 2.85\n                                                                                                Uptime: 249 days(!), 12:18:13. root@mail:~# top\ntop - 14:29:07 up 249 days, 15:19,  2 users,  load average: 2.60, 3.19, 3.15\nTasks: 197 total,   2 running, 195 sleeping,   0 stopped,   0 zombie\n%Cpu(s): 15.1 us,  2.9 sy,  0.0 ni, 77.1 id,  4.8 wa,  0.0 hi,  0.1 si,  0.0 st\nKiB Mem:  32876056 total, 26711176 used,  6164880 free,  1991848 buffers\nKiB Swap: 12574716 total,    36408 used, 12538308 free. 18190648 cached Mem\nPID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n20738 root      20   0  263840  32980  12220 S  22.0  0.1  34:14.37 php\n28095 mysql     20   0 5372016 2.022g   9928 S   4.7  6.5   1093:35 mysqld\n 8402 www-data  20   0   45608  18852   4508 S   0.7  0.1  10:14.91 nginx\n   23 root      20   0       0      0      0 S   0.3  0.0  33:41.08 ksoftirqd/3\n  194 root      20   0       0      0      0 S   0.3  0.0  41:24.38 jbd2/md2-8\n 8407 www-data  20   0   44868  18124   4532 S   0.3  0.1  19:16.55 nginx\n14723 www-data  20   0  488912  13040   2624 S   0.3  0.0   0:00.33 apache2\n18249 www-data  20   0  488912  13040   2624 S   0.3  0.0   0:00.05 apache2\n18338 root      20   0   26984   3148   2560 R   0.3  0.0   0:00.01 top\n18444 www-data  20   0  488912  13040   2624 S   0.3  0.0   0:00.04 apache2\n18996 roombear  20   0  242168  27832  19060 R   0.3  0.1   0:00.01 php\n19958 999       20   0 1950796 412228  24692 S   0.3  1.3  41:02.27 mysqld\n    1 root      20   0  177056   5100   2836 S   0.0  0.0   4:42.33 systemd\n    2 root      20   0       0      0      0 S   0.0  0.0   0:00.29 kthreadd\n    3 root      20   0       0      0      0 S   0.0  0.0  47:27.03 ksoftirqd/0\n    5 root       0 -20       0      0      0 S   0.0  0.0   0:00.00 kworker/0:0H\n    7 root      20   0       0      0      0 S   0.0  0.0 226:21.06 rcu_sched\n. ",
    "mitsh": "this example is working on only http protocol, i couldn't use in websocket protocol.\ni changed send buffer size to 100mb, its seems solved. \n$connection->maxSendBufferSize = 1024 * 1024 * 100;\nbut, how can use your example in websocket protocol?. when i try first time, $this->send is sending data in raw mode, so websocket client throw error like that \"opcode(-1)\". i turned off raw sending. and then, it send whole data partialed by 8192 to client side. so, my js client its not understand what the data. here is an example of my client server protocol;\n```\n$ws_worker->onMessage = function (Workerman\\Connection\\TcpConnection $connection, $data) use (&$engine, &$users, &$ws_worker)\n{\n    $packet = json_decode($data, true);\n$matches = [];\npreg_match('/\\.(js|tmpl|html?|json)$/sui', $packet['uri'], $matches);\n\n$extension = $matches[1];\n\nif ($extension == 'js' || $extension == 'tmpl')\n{\n    $asset_path = FATKA_PUBLIC_DIR . $packet['uri'];\n\n    $data = null;\n\n    if ($status = file_exists($asset_path))\n    {\n        $data = file_get_contents($asset_path);\n    }\n\n    $content = [\n        'event_id' => $packet['event_id'],\n        'uri'      => $packet['uri'],\n        'type'     => $extension,\n        'status'   => $status,\n        'data'     => $data\n    ];\n}\nelse if ($extension == 'html' || $extension == 'json')\n{\n    // other stuff...\n}\n\nif ($is_asset)\n{\n    $connection->fileHandler = tmpfile();\n\n    fwrite($connection->fileHandler, json_encode($content));\n\n    fseek($connection->fileHandler, 0);\n\n    send_file($connection);\n}\nelse\n{\n    $connection->send(json_encode($content));\n}\n\n}\n```\nmay be my protocol is wrong. have you any idea about that how to fix that issue?\nthanks again. i changed maxsendbuffersize to default and i tested the code but no chance. i like your idea and i am trying to solve these problem on that way.\nWorkerman[/sites/domains/mongo.works/vhosts/www/bin/websocket.php] start in DEBUG mode\n----------------------- WORKERMAN -----------------------------\nWorkerman version:3.4.2          PHP version:7.1.5\n------------------------ WORKERS -------------------------------\nuser          worker           listen                     processes status\nroot          fatka websocket  websocket://0.0.0.0:21002   4         [OK]\n----------------------------------------------------------------\nPress Ctrl-C to quit. Start success.\nconnection open: 1\nbuffer full\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nerror 2 send buffer full and drop package\nbuffer drain\nand i try another websocket library. but, i didn't notice error like that. . ",
    "cnsms": "2017-07-04 19:25:15 exception 'PDOException' with message 'SQLSTATE[08004] [1040] Too many connections' in C:\\www\\zk\\thinkphp\\library\\think\\db\\Connection.php:300\nStack trace:\n0 C:\\www\\zk\\thinkphp\\library\\think\\db\\Connection.php(300): PDO->__construct('mysql:dbname=do...', 'root', 'root', Array)\n1 C:\\www\\zk\\thinkphp\\library\\think\\db\\Connection.php(934): think\\db\\Connection->connect()\n2 C:\\www\\zk\\thinkphp\\library\\think\\db\\Connection.php(414): think\\db\\Connection->initConnect(true)\n3 C:\\www\\zk\\thinkphp\\library\\think\\db\\Query.php(239): think\\db\\Connection->execute('INSERT INTO `sy...', Array)\n4 C:\\www\\zk\\thinkphp\\library\\think\\db\\Query.php(2063): think\\db\\Query->execute('INSERT INTO `sy...', Array)\n5 C:\\www\\zk\\application\\workerman\\model\\Device.php(126): think\\db\\Query->insert(Array)\n6 C:\\www\\zk\\application\\workerman\\controller\\Index.php(91): app\\workerman\\model\\Device->abnormal(22, Array)\n7 [internal function]: app\\workerman\\controller\\Index->app\\workerman\\controller{closure}(Object(Workerman\\Connection\\TcpConnection), '\\xFF\\xAA\\x16\\x00\\\\x00000000000...')\n8 C:\\www\\zk\\Workerman\\Connection\\TcpConnection.php(503): call_user_func(Object(Closure), Object(Workerman\\Connection\\TcpConnection), '\\xFF\\xAA\\x16\\x00\\\\x00000000000...')\n9 [internal function]: Workerman\\Connection\\TcpConnection->baseRead(Resource id #84)\n10 C:\\www\\zk\\Workerman\\Events\\Select.php(257): call_user_func_array(Array, Array)\n11 C:\\www\\zk\\Workerman\\Worker.php(809): Workerman\\Events\\Select->loop()\n12 C:\\www\\zk\\Workerman\\Worker.php(457): Workerman\\Worker->run()\n13 C:\\www\\zk\\Workerman\\Worker.php(366): Workerman\\Worker::runAllWorkers()\n14 C:\\www\\zk\\application\\workerman\\controller\\Index.php(126): Workerman\\Worker::runAll()\n15 [internal function]: app\\workerman\\controller\\Index->index()\n16 C:\\www\\zk\\thinkphp\\library\\think\\App.php(224): ReflectionMethod->invokeArgs(Object(app\\workerman\\controller\\Index), Array)\n17 C:\\www\\zk\\thinkphp\\library\\think\\App.php(389): think\\App::invokeMethod(Array, Array)\n18 C:\\www\\zk\\thinkphp\\library\\think\\App.php(130): think\\App::module(Array, Array, NULL)\n19 C:\\www\\zk\\thinkphp\\start.php(18): think\\App::run()\n20 C:\\www\\zk\\index.php(32): require('C:\\www\\zk\\think...')\n21 {main}\n. ok,i'll try it.. Is not the database can not use tp5?\nYou write this is a separate re-connected to the database slightly.. @taozywu ok,i'll try it.. ",
    "18667366881": "android   socket  and  ios socket   Support?  thinkyou. \u4f60\u597d  \u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2ademo \u5417  \u4e07\u5206\u611f\u8c22. \u90a3 \u80fd\u4e0d\u80fd\u8bf4\u4e00\u4e0b   \u5b89\u5353\u9700\u8981\u7528\u54ea\u4e2a\u5e93  \u624d\u80fd\u8fde\u63a5\u5230 workerman  . Hello, can you tell me what code framework Android needs to use the workerman framework?. Thank you very much!. ",
    "Drabiv": "How to get $connections_of_some_user? \nFor example, I have chat application. One user for some reason opened chat in 4 different browsers. Now I send him message and expect to see this message appearing in all 4 browsers simultaneously.\nI have tried to use the below code, but managed to send message only to the one client (the one to which user connected latest).\n`$users = [];\n   $app_work = new AppWorker(\"websocket://0.0.0.0:8000\");\n    switch ($status) {\n        case 'start':\n\n   }\n\n   $app_work->onWorkerStart = function () use (&$users) {\n        // create local tcp-server\n        $inner_tcp_worker = new Worker(\"tcp://127.0.0.1:1234\");\n\n\n\n\n        $inner_tcp_worker->onMessage = function ($connection, $data) use (&$users) {\n            $data = json_decode($data);\n\n            if (isset($users[$data->user])) {\n                $webconnection = $users[$data->user];\n                $webconnection->send($data->message);\n\n           }\n        };\n        $inner_tcp_worker->listen();\n    };\n    $app_work->onConnect = function ($connection) use (&$users) {\n        $connection->onWebSocketConnect = function ($connection) use (&$users) {\n            // when connecting new user store get-parameter, that we received from client\n            $users[$_GET['user']] = $connection;\n\n        };\n    };\n    $app_work->onClose = function ($connection) use (&$users) {\n        $user = array_search($connection, $users);\n        unset($users[$user]);\n    };\n\n\n   $app_work->args($status, true, 'server');\n    $app_work->runAll(); `\n\n. Thanks a lot Walkor. It works!. ",
    "MaksimDzhangirov": "Thank you for quick reply.. I am getting this error while trying use your code example.\n\n443 port is currently used by nginx service and I cannot disable it.\n\nDo you have any suggestions how can I resolve this problem?. Thank you. It works.. ",
    "farwish": "@Wakirin Set the \\Workerman\\Worker object's attribute reusePort to true, it may be resolved.. @sm2017 \n1.Show status:  php start.php status.\n2.In daemon mode, you also can log standard output in your business logic by setting Worker::$stdoutFile = '/tmp/stdout.log'.\n3.Using tcpdump dump handshake process to see the network traffic is normal in linux, it likes the tool wireshark.\n4.Enter  strace -p processId in command line to see system calls like the business logic executed and signal processed etc.\n. I think some can be used.\nstrace -c -p Pid  show sys call statistic.\nstrace -o output.log -T -p Pid output log into file with time of each sys call.\nstrace -o output.log -T -e select -p Pid see specific sys call such as select.\nDo you find any way or idea to resolve trouble these days?  @sm2017 \n. Which version of Workerman you used \uff1f Is there any strange or normal output message when stop fails\uff0c any screenshot ? @sm2017 . Make sure if there is a xxxxxx.pid file that saved the workerman master process id, if not exists, this problem can be fixed use Worker::$pidFile to save pid in a safe place. Run ps aux | grep WorkerMan to see current master process id is matched in the pidFile , if pid not matched, maybe pid is used by other program, delete the pid file.  There is a way to force stop all workers ps aux | grep WorkerMan | awk '{print $2}' | xargs kill -9. @sm2017 . It seems a permission problem.. Maybe some hidden bug triggered in some situation, what the scene is?\n@walkor . I thik it is a wrong way, workerman is multi process mode, a process can contains multi threads, but reverse direction is crazy and not right. \nOther tips, pthreads is not well supported in php7.. @Frago9876543210  You can set the worker count like $this->ws->count = 2 after new Worker, so that the server is concurrent, if the cpu has multi core, the processing is also parallel.. ",
    "denfm": "Workerman has a bug from posix-signal processing, the TERM signal in particular (used in supervisor by default). \nSolution: use stopsignal=INT to resolve this problem.. @walkor I think that fork processes loop when obtaining the TERM signal, i.e. this process is terminated, but it is immediately restored by the script. That is why the possible quick solution is static::$_gracefulStop set as true, or not to restore the process when obtaining such signal.. ",
    "keppelcao": "I found the issue occurs in GW project, but the WM project is fine.\n\u6211\u53d1\u73b0\u5728GW\u9879\u76ee\u91cc\u6709\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f46\u662fWM\u9879\u76ee\u5374\u662f\u597d\u7684\u3002\nSorry for my poor English.\n\u62b1\u6b49\u82f1\u8bed\u6bd4\u8f83\u5dee\u3002. ",
    "lvshuang": "@keppelcao  \u5927\u90e8\u5206\u662f\u56fd\u4eba\u5728\u7528\uff0c\u53ef\u4ee5\u7528\u6c49\u8bed\u63d0\u95ee . ",
    "morozovsk": "Thank you. I have tested event. It is litle faster then ev. So I will use event.. ",
    "abshammeri": "Thanks @walkor. I'm still learning and exploring the project internal structure. We are planning to use it as TCP server into production soon.  But just a side question, why are you creating all the process at once on the server start instead of forking child process on each connection? The child process can communicate with the parent process by sending signal each X seconds. if no signal received.. the parent process can kill the child. The child/parent can use shared memory if needed. This will help preventing zombie processes as I thought.. the parent process work as a Process Manager.\nWhat do you think? does that make sense? I'm not expert by the way.\nThanks for the project.. appreciated. . Thanks for your time.. Thanks @walkor . ",
    "gulinfang": "This is my start.php file:\n`<?php\nuse Workerman\\Worker;\n/*\n * run with command\n * php start.php start\n /\nini_set('display_errors', 'on');\n// \u68c0\u67e5\u6269\u5c55\nif(!extension_loaded('pcntl'))\n{\n    exit(\"Please install pcntl extension. See http://doc3.workerman.net/install/install.html\\n\");\n}\nif(!extension_loaded('posix'))\n{\n    exit(\"Please install posix extension. See http://doc3.workerman.net/install/install.html\\n\");\n}\n// \u6807\u8bb0\u662f\u5168\u5c40\u542f\u52a8\ndefine('GLOBAL_START', 1);\nrequire_once dirname(DIR) . '/vendor/autoload.php';\n// \u52a0\u8f7d\u6240\u6709Applications//start.php\uff0c\u4ee5\u4fbf\u542f\u52a8\u6240\u6709\u670d\u52a1\nforeach(glob(dirname(DIR).'/Applications/Statistics/start.php') as $start_file)\n{\n    require_once $start_file;\n}\n// \u8fd0\u884c\u6240\u6709\u670d\u52a1\nWorker::runAll();\n`\nAnd i haven't changed any workerman code.\nNow I can see the processes :\n`\n4539 ?        Ss     0:00 WorkerMan: master process  start_file=/mnt/php/test/shell/start.php\n4540 ?        S      0:00  _ WorkerMan: master process  start_file=/mnt/php/test/shell/start.php\n4541 ?        S      0:00      _ WorkerMan: worker process  StatisticProvider text://0.0.0.0:55858\n4542 ?        S      0:00      _ WorkerMan: worker process  StatisticWorker statistic://0.0.0.0:55656\n4543 ?        S      0:00      _ WorkerMan: worker process  StatisticWeb http://0.0.0.0:55757\n4544 ?        S      0:00      _ WorkerMan: worker process  StatisticFinder text://0.0.0.0:55858\n`\nThe master process remains after I stoped :\n`\n4539 ?        Ss     0:00 WorkerMan: master process  start_file=/mnt/php/test/shell/start.php\n4540 ?        S      0:00  _ WorkerMan: master process  start_file=/mnt/php/test/shell/start.php\n`. ",
    "kko123": "Thank you! It works!\nHow i can donate this project? Can't find any donation info.\nAnd another question:\nI added after require_once('vendor/autoload.php'):\n$mysqli = new mysqli($host_db, $login_db, $password_db, $dbase);\nif ($mysqli->connect_error) {\n    die('Error (' . $mysqli->connect_errno . ') '\n            . $mysqli->connect_error);\n}\n$mysqli->query(\"SET NAMES 'utf8';\");\n$mysqli->query(\"SET CHARACTER SET 'utf8';\");\n$mysqli->query(\"SET SESSION collation_connection = 'utf8_general_ci';\");\nand added some function with mysql queries.\nscript work as expected only in debug mode but not working in daemon mode (where i can find stdouts from this mode? in debug mode i see all in console).\nThere is some problems with mysql connection in forked process.... i think\nHow i can fix it?\nP/S. SOLVED (Workerman\\Mysql\\Connection)!!!\nHow i can donate this project? Can't find any donation info.. Please accept my modest donation!\nThank you for your help and libraries.. ",
    "tbase82": "Hi,\nin my case this method is never called:\n$worker->onWebSocketConnect = function($connection, $header){\n    // $_GET is available here and we store it to $connection as dynamic property so we can use it later.\n    $connection->some_var = $_GET;\n};\nI called it inside onConnect. In this case it worked.\n$worker->onConnect = function($connection){\n    $connection->onWebSocketConnect =function($connection, $header){\n        $connection->getParams = $_GET;\n    };\n.....\nThank you very much for your answer. \n. ",
    "ruelbermudez": "Thanks. Working now. . ",
    "stigout": "No. I haven't called ws.close() at JS-client.\nBut I have tried it.\nI have removed $connection->close('Closing'); in the Server-side and rebooted it.\nNext I've tried to call ws.close() in the client-side (JavaScript), but I've received a code 1006 from ws.onclose.\nCode:\n$(document).ready(function(){\nif (\"WebSocket\" in window) {\nvar ws_url = 'ws://*MyIPisDEL*/websocket/';\nvar ws = new WebSocket(ws_url);\nws.onopen = function() {\nws.send('Good!');\n};\nws.onerror = function(e) {\nconsole.log(e);\n};\nws.onmessage = function(e) {\nconsole.log(e.data);\nws.close(1000, 'Test reason');\n};\nws.onclose = function(e) {\n//always return code is 1006\nconsole.log(e);\n};\n} else {\nalert(\"No support a websocket\");\n}\n});\n. ",
    "xcorp1986": "nice\uff0c\u8fd9\u6837\u65b9\u4fbf\u5b50\u7c7b\u590d\u5199\u7236\u7c7b\u65b9\u6cd5. ",
    "congci": "@walkor \u539f\u7406\u662f\u53ef\u884c\u7684\u3001\u4e0d\u8fc7\u6211\u60f3\u7b80\u5355\u4e86\u3001\u6574\u5408workman\u6709\u70b9\u95ee\u9898\uff0c\u56e0\u4e3a\u534f\u7a0b\u8c03\u5ea6\u5668\u9700\u8981\uff08\u4e8b\u4ef6loop->\u534f\u7a0b\u8c03\u5ea6\uff09\u8fd9\u4e2a\u63a8\u8fdb\u3002\u5176\u63a8\u8fdb\u65b9\u5f0f\u662f\u987a\u5e8f\u7684\uff0c\u4e5f\u5c31\u662f\n1\u3001event_add \u52a0\u4e8b\u4ef6\n2\u3001socket\u51c6\u5907-->\u534f\u7a0b\u8c03\u5ea6\n3\u3001\u5f80\u4e0b\u6267\u884c\u3002\n4\u3001\u4e8b\u4ef6\u4f9d\u6b21\u89e6\u53d1\uff0c\u534f\u7a0b\u5806\u6808\u4f9d\u6b21\u5f80\u4e0a\u3002\u6700\u540e\u8fd4\u56de\u7ed3\u679c\u3002\n\u6211\u671f\u671b\u7684\u662f\u8fd9\u6837\u7684\u8c03\u7528\u7684\u65b9\u5f0f\uff1a\n$http_worker->onConnect = function($connection){\n       $data = yield from dowork(); //\u6b64\u5904\u662f\u4e1a\u52a1\u903b\u8f91\u3001\u91cc\u9762\u90fd\u53ef\u4ee5\u7528yield \u6765\u5904\u7406\u5f02\u6b65\u3001\u4e5f\u5c31\u662f\u4e8b\u4ef6\u52a0\u7684\u56de\u8c03\u5176\u5b9e\u662f\u534f\u7a0b\u8c03\u5ea6\u5668\uff0c\u800c\u4e0d\u662f\u56de\u8c03\u3002\n      $connection->send($data);//\u6b64\u5904\u4fbf\u662f\u4ee5\u524d\u7684\u56de\u8c03\u3002\n};\n\u4ee5\u524d\u7684\u7ec4\u4ef6\u5f88\u591a\u90fd\u662f\u6d89\u53ca\u5230\u56de\u8c03\u3002\u6539\u52a8\u6709\u70b9\u5927\u3002\n\u5982\u679c\u9020\u6210\u56f0\u6270\u548c\u6253\u6270\uff0c\u975e\u5e38\u62b1\u6b49\uff5e. \u6211\u63d0\u4ea4\u7684\u90a3\u4e2a\u66f4\u6539\u57fa\u7840\u7ec4\u4ef6\u3001\u5c31\u662f\u66f4\u6539\u6210\u529f\u7684\u3001\u800c\u4e14\n1\u3001\u5bf9\u73b0\u6709\u7684\u6846\u67b6\u4e0d\u5f71\u54cd\u3002\n2\u3001\u4e1a\u52a1\u903b\u8f91\u4e2d\u5f02\u6b65\u56de\u8c03\u548c\u534f\u7a0b\u968f\u65f6\u5207\u6362\n\u6d4b\u8bd5\u662f\uff1a\nphp\nrequire_once __DIR__ . '/vendor/autoload.php';\nuse Workerman\\Worker;\n$http_worker = new Worker(\"http://127.0.0.1:8000\");\n$http_worker-count = 1;\n$http_worker->isYield = true;\n$http_worker->onConnect = function($connection){\n    yield $connection->send(\"xxxxxxx\");\n};\nWorker::runAll();\n.",
    "AndrewSologor": "Ok, thank you! I'll try it next time if this repeated.. I've not changed any worker params except Worker::$pidFile.\nWhen I start the server directly from the terminal (i.e. php www/index_socketio.php start -d) it detects that the process group is right and I don't get that warning.\nI'll leave it as is. Thank you!. ",
    "areebmajeed": "Well, connect to multiple TCP servers is not required. Even one will work perfectly.. So, I simply tried to run two other files and only one worked, the other didn't. It said that it was already active, but it wasn't, the other process was.. Found the solution, made two workers and then simply used Worker::runAll() to make them run.. It's also worthy to mention that:\nconnections array returns the expected result when you print it from/within the $ws_worker inside.. Nope :(\nOn Wed, 29 Aug 2018, 12:27 pm dns582, notifications@github.com wrote:\n\nGood afternoon, friends! Was it possible to deal with this issue?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/walkor/Workerman/issues/360#issuecomment-416845725,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AIuuM3tamsNSKOAaNHyxmmjjf2_raUh0ks5uVjs9gaJpZM4WLcMQ\n.\n. \n",
    "Stiveknx": "Well, but if that's correct, that means that I can't have more than 1 client connecting to my \"web_server.php\".\nI don't think that's correct, if that was an webserver serving another stuff like static files to clients, for example, that means that I can have only one visitor to my server? (Since it can't handle multi-tasks)\n. ",
    "soha1410": "Workerman[socket.php] status \n----------------------------------------------GLOBAL STATUS----------------------------------------------------\nWorkerman version:3.5.2          PHP version:7.1.6\nstart time:2017-12-04 03:00:11   run 0 days 0 hours   \nload average: 2.05, 2, 2         event-loop:\\Workerman\\Events\\Select\n0 workers       0 processes\nworker_name  exit_status      exit_count\n----------------------------------------------PROCESS STATUS---------------------------------------------------\npid memory  listening    worker_name  connections send_fail timers  total_request qps    status. thank you for your help,\nI'm using https://github.com/walkor/phpsocket.io which use your library , I think this issue maybe related to your Timer library so ask it here.\nI have a socket which needs to do some function and broadcast the result to users.\nthis is my code.\n```\n<?php\nrequire_once DIR . '/vendor/autoload.php';\nrequire_once DIR . '/public/index.php';\nrequire_once DIR . '/functions.php';\nuse Illuminate\\Support\\Facades\\Redis;\nuse PHPSocketIO\\SocketIO;\nuse Workerman\\Lib\\Timer;\nuse Workerman\\Worker;\n$io    = new SocketIO(2022);\n$io->on('connection', function ($socket) use (&$io) {\n    Timer::delAll();\n    Timer::add(1,bar($io));\n});\nTimer::add(1,bar($io));\nfunction bar($io) \n{\n    return function () use (&$io) {\n        var_dump(time());\n        $io->emit('foo','test');\n    };\n};\nWorker::runAll();\n//\n```\nI need the function to execute each seconds even if there is no user connected to socket . \nso put the Timer::add(1,bar($io));\n outside of the on connection. but the problem is the $io can not broadcast to users. but if I put the the timer after $io->on('connection' , it works but it needs to have user connected to server.\nit sounds like the $io object is not the same , but hash of the object in php is exactly the same,\nI decide to put in both place and call Timer:delAll before add the second timer , but it doesn't stop the first timer, it sounds there is some scope issue. it's very odd and I spend several days to solve the problem with all possible workaround , \nit would be a great if you can help me out of this . thanks.. It works, thank you so much . . thank you so much . . ",
    "LorDo": "How to run timer func manual ?\nsomething like \n$task = new Worker();\n$task->onWorkerStart = function($task)\n{\n    // 2.5 seconds\n    $time_interval = 2.5; \n    $timer_id = Timer::add($time_interval, \n        function()\n        {\n            echo \"Timer run\\n\";\n        }\n    );\n$timer_id->run(); // exec function without interval waiting\n};\n. ",
    "Troodi": "How i can identifier user if he reload page? Maybe use ip?. $user_data = [];\n$ws_worker->onConnect = function($connection) use (&$user_data){\n    $connection->onWebSocketConnect = function ($connection) use (&$user_data) {\n        $user_data['email'] = $_GET['user'];\n        //$user_data['email']['id'] = $connection->id;\n    };\n    var_dump($user_data);\n};\nvar_dump return 0;\nbut \n$ws_worker->onConnect = function($connection) use (&$user_data){\n    $connection->onWebSocketConnect = function ($connection) use (&$user_data) {\n        $user_data['email'] = $_GET['user'];\n        //$user_data['email']['id'] = $connection->id;\n        var_dump($user_data);\n    };\n};\nhave result with data?\nHow save data in global?. Yes, but how i can use in\n$ws_worker->onWorkerStart = function($ws_worker){\n    $time_interval = 1.0; \n    $timer_id = Timer::add($time_interval, \n        function()\n        {\n            echo $user_data['email']; // this variable empty in this function\n        }       \n}\n. ```\n$ws_worker->onConnect = function($connection){\n    $user_data[] = $_GET['user'];  //var_dump() out email\n    };\n};\nBut...\n$ws_worker->onWorkerStart = function($ws_worker){\n    $time_interval = 1.0; \n    $timer_id = Timer::add($time_interval, \n        function()\n        {\n        global $user_data;\n        var_dump($user_data['email']); // out array(0){}\n    }     \n}\n```\nI dont know why.. Wow, global in onConnect too! Thx!. ",
    "Karmadon": "@walkor I reinstalled - not worked for me\ngit clone https://github.com/expressif/pecl-event-libevent.git\ncd pecl-event-libevent\nphpize\n./configure\nmake && sudo make install\nAnd trying this\nsudo apt-get install php7.1-dev gcc make libevent-dev\nI did right?. $ php -i | grep event                                                                                                                                      \nevent                                                                                                                                                                      \nlibevent2 headers version => 2.1.8-stable\n----------------------------------------------GLOBAL STATUS----------------------------------------------------\nWorkerman version:3.5.4          PHP version:7.1.11-0ubuntu0.17.10.1\nstart time:2017-12-15 22:09:47   run 0 days 0 hours   \nload average: 1.89, 1, 0         event-loop:\\Workerman\\Events\\Event\n1 workers       4 processes\nworker_name  exit_status      exit_count\nSO-1255      0                0\n----------------------------------------------PROCESS STATUS---------------------------------------------------\npid     memory  listening                worker_name  connections send_fail timers  total_request qps    status\n13122   N/A     websocket://0.0.0.0:8000 SO-1255      N/A         N/A       N/A     N/A           N/A    [busy] \n13123   N/A     websocket://0.0.0.0:8000 SO-1255      N/A         N/A       N/A     N/A           N/A    [busy] \n13124   4M      websocket://0.0.0.0:8000 SO-1255      616         0         0       78584         0      [idle]\n13125   6M      websocket://0.0.0.0:8000 SO-1255      1012        0         0       58222         0      [idle]. ",
    "dragonflylee": "i modify the stop like below \nphp\npublic function stop()\n    {\n        if ($this->status !== self::STATUS_STOPED) {\n            $this->status = self::STATUS_STOPED;\n            if ($this->_conn) {\n                $this->_conn->onClose = null;\n                $this->_conn->close();\n                log::info(\"\u5f00\u59cb\u505c\u6b62 \".var_export($this->_conn, true));\n            }\n        }\n    }\nand the log like below\n17:19:52 10948 warning \u8fde\u63a5 [127.0.0.1:27000] \u65ad\u5f00 (1) \u6b21, (117) \u79d2\u540e\u5f00\u59cb\u91cd\u8fde\n17:20:07 10948 info \u5f00\u59cb\u505c\u6b62 Workerman\\Connection\\AsyncTcpConnection::__set_state(array(\n   'onConnect' =>\n  Closure::__set_state(array(\n  )),\n   'transport' => 'tcp',\n   '_status' => 8,\n   '_remoteHost' => '127.0.0.1',\n   '_remotePort' => 27000,\n   '_connectStartTime' => 1513761379.909976,\n   '_remoteURI' => '/',\n   '_contextOption' => NULL,\n   '_reconnectTimer' => 19,\n   'onMessage' => NULL,\n   'onClose' => NULL,\n   'onError' => NULL,\n   'onBufferFull' => NULL,\n   'onBufferDrain' => NULL,\n   'protocol' => '\\\\Protocols\\\\Terminal',\n   'worker' => NULL,\n   'bytesRead' => 456,\n   'bytesWritten' => 887,\n   'id' => 2,\n   '_id' => 2,\n   'maxSendBufferSize' => 1048576,\n   '_socket' => NULL,\n   '_sendBuffer' => '',\n   '_recvBuffer' => '',\n   '_currentPackageLength' => 0,\n   '_remoteAddress' => '127.0.0.1:27000',\n   '_isPaused' => false,\n   '_sslHandshakeCompleted' => true,\n))\n17:21:49 10948 info  \u8fde\u63a5 [127.0.0.1:27000] \u6210\u529f\nit is strange after the status of AsyncTcpConnection is already 8, the connect will called. well\uff0ci wrote another sample to test the problem, which code below\n```php\n<?php\nini_set('display_errors', 'on');\nuse Workerman\\Worker;\nuse Workerman\\Lib\\Timer;\nuse Workerman\\Connection\\AsyncTcpConnection;\nrequire_once DIR . '/vendor/autoload.php';\nif (isset($argv[1]) and in_array($argv[1], array('start', 'restart'))) {\n    $worker = new Worker();\n    $worker->reloadable = false;\n    $worker->onWorkerStart = function() use ($worker) {\n        $conn = new AsyncTcpConnection('tcp://127.0.0.1:80');\n        $conn->onConnect = function($conn) {\n            Worker::log(\"connect ({$conn->getRemoteIp()}:{$conn->getRemotePort()}) success\");\n        };\n        $conn->onClose = function($conn) {\n            $timeout = 10;\n            Worker::log(\"Start reconnect ({$conn->getRemoteIp()}:{$conn->getRemotePort()}) in ($timeout) seconds\");\n            $conn->reConnect($timeout);\n        };\n        $worker->onWorkerReload = function() use ($conn) {\n            $conn->onClose = null;\n            $conn->close();\n            Worker::log(\"close connection ({$conn->getRemoteIp()}:{$conn->getRemotePort()})\");\n        };\n        Worker::log(\"Start connect\");\n        $conn->connect();\n    };\n}\nWorker::$logFile = './workerman.log';\nWorker::$pidFile = './workerman.pid';\nWorker::runAll();\nafter start worker,i restart the apache service\nthen run reload to close the connection, command below\nphp start.php start -d\nservice httpd restart\nphp start.php reload\n```\nand the log file below\n\n2017-12-22 23:54:41 pid:4751 Workerman[start.php] start in DAEMON mode\n2017-12-22 23:54:41 pid:4754 Start connect\n2017-12-22 23:54:41 pid:4754 connect (127.0.0.1:80) success\n2017-12-22 23:55:03 pid:4754 Start reconnect (127.0.0.1:80) in (10) seconds\n2017-12-22 23:55:05 pid:4791 Workerman[start.php] reload\n2017-12-22 23:55:05 pid:4753 Workerman[start.php] reloading\n2017-12-22 23:55:05 pid:4754 close connection (127.0.0.1:80)\n2017-12-22 23:55:13 pid:4754 connect (127.0.0.1:80) success\n\n\nthe test environment is CentOS 6.9 with php5.6.32 and Workerman version:3.5.4. ",
    "vashp": "Thank you!\nAnother question about passed variable from php script(web site) to $wsWorker \nI have the following configuration servers\n$users = [];\n    $channel_server = new Channel\\Server('0.0.0.0', 1235);\n\n\n    $innerTcpWorker = new Worker(MessengerServerHelper::LOCAL_SOCKET);\n    $innerTcpWorker->name = 'Local server';\n    $innerTcpWorker->onWorkerStart = function () {\n        Channel\\Client::connect('127.0.0.1', 1235);\n    };\n    $innerTcpWorker->onMessage = function ($connection, $data) use (&$users) {\n        $event_name = 'event_inner_message';\n        Channel\\Client::publish($event_name, $data);\n    };\n\n\n    $wsWorker = new Worker(\"websocket://0.0.0.0:\" . MessengerServerHelper::WEB_SOCKET_PORT);\n    $wsWorker->name = 'Messenger WS-server';\n    $wsWorker->count = 1;\n    $wsWorker->onWorkerStart = function ($worker) use (&$users) {\n        Channel\\Client::connect('127.0.0.1', 1235);\n\n        $event_name = 'event_inner_message';\n        Channel\\Client::on($event_name, function ($data) use ($worker, &$users) {\n            $messageData = json_decode($data, true);\n            $userId = $messageData['user']['id'] ?? $messageData['user'] ?? false;\n            if ($userId && !is_array($userId)) {\n                $this->sendDataToUser($users, $userId, $data);\n            }\n        });\n    };`\n\nand in php script(he is in another place)  i do\n$instance = @stream_socket_client(self::LOCAL_SOCKET, $errno, $errstr, 30);\nfwrite($connection, $event . \"\\n\");\nPhp script -> innerTcpWorker -> Channel -> wsWorker\nIs it  correct way?\nCan i do Php script -> wsWorker ?. ",
    "zrlhk": "you can use websocket client. like:  https://github.com/zrlhk/PHP-websocket-client. ",
    "aqnaruto": "@farwish thankyou, you mean when i  add php /web-msg-sender-master/stat.php restart  to cron  need some permission  ?. \n. ",
    "sunphpacc": "good\nworkerman-win-sun.zip\n. Thank you, replacement shows normal. ",
    "mikkiek": "\nCan you tell me what kind of browser and version you use.\n\nI've tried chrome 63.0.3239.132 and firefox 57.0.4 - both of them has an issue\n\nAnd please show the codes of client side.\nCode looks like that\n```\nlet ws = new WebSocket(ws://127.0.0.15/ws);\nws.addEventListener('open', () => {\n    console.log('WS Open');\n});\n\nws.addEventListener('message', (event) => {\n    let reader = new FileReader();\n    reader.addEventListener(\"loadend\", () => {\n         console.log('Message ' + reader.result);\n    });\n    reader.readAsText(event.data);\n});\nws.addEventListener('error', (event) => {\n    console.log('WS Error', event);\n});\nws.addEventListener('close', () => {\n    console.log('WS Close', event);\n});\nAnd then i've a button which do following thing:\nfunction test(){\n    let blob = new Blob([Math.random()], {\n        type: 'text/plain'\n    });\nws.send(blob);\n\n}\n```\nHowever, i guess the issue that i'm using windows, which doen't support POSIX and PCNTL\n. ",
    "ckjet": "I'm trying on domain which have certificate, but still not connect.\nMy test page: https://firstsender.com/st.html\nGoogle chrome show this error:\nWebSocket connection to 'wss://firstsender.com:2346/' failed: Error in connection establishment: net::ERR_INSECURE_RESPONSE. Thank you Walkor! That's help me. I forget about end of my sertificate (which im using for sockets).. ",
    "Frago9876543210": "@farwish I want only parallel processing of the web socket.. @walkor I mean that Worker::runAll(); acts as sleep function.. ",
    "mirkhamidov": "Thanks. Ok. Than, how resolve this situation:\n- we allow multisession, that means, you can connect with a single account from two or more devices. \n- user1 connected with device1 \n- user2 trying to connect with device2, we can find out, that user already connected, but second \u2018$connection\u2019 is different than first. As you rcan commend, I will do \u2018$connection->close()\u2019 for second device, how device2 will get updates via socket?\nPS: how replace new connection with old one?. Yes, I can, but how device2 will receive messages from saved previously connection?. tnx. ",
    "atyachin": "I tried the following:\n$worker->onWorkerStart = function() use ($maxtime) {\n// set timer to exit the process\n\\Workerman\\Lib\\Timer::add($maxtime, function() {\necho \"Work ended.\".PHP_EOL;\nWorker::stopAll();\n}); \n// do more stuff\nHowever, the process is terminated and immediately restarting.... ",
    "vbezruchkin": "Thanks. I've achieved this using Guzzle :) Thanks for your library again!. ",
    "ares333": "@ishland Some functions in swoole is really important for me but I don't want to use swoole framework.. Swoole timer is avilable in https://github.com/walkor/Workerman/blob/master/Events/Swoole.php. ",
    "exbit": "\u0421an't tell how to reproduce the bug, I have it randomly appears. May be this error you need to code to handle that worker would not crash?. ",
    "woann": "all right ,understand. ",
    "LuckyCyborg": "You are welcome!\nAnd, again, will be very nice if you will do quickly a fresh release, containing this patch, as our Quasar Push Server rely on this HTTP Session improvements for its WEB server part, as it is its server.php\n```php\n//--------------------------------------------------------------------------\n// Setup The Workerman's Session\n//--------------------------------------------------------------------------\nHttp::sessionSavePath(\n    $config->get('session.files', STORAGE_PATH .'sessions')\n);\nHttp::sessionName(\n    $config->get('session.cookie', 'quasar_session')\n);\n```. Thank you very much! :+1: . ",
    "hhxiaohei": "@walkor I use wss for wechat mini\nthis is the request header\njs\nGET wss://rms23.dev:4421/ HTTP/1.1\nHost: rms.dev:4431\nConnection: Upgrade\nPragma: no-cache\nCache-Control: no-cache\nUpgrade: websocket\nOrigin: http://127.0.0.1:53902\nSec-WebSocket-Version: 13\nUser-Agent: wechatdevtools appservice port/65099\nAccept-Encoding: gzip, deflate, br\nAccept-Language: en-US,en;q=0.8\nReferer: https://servicewechat.com/wx1d181916318b8afd/devtools/page-frame.html\ncontent-type: application/json\nAuthorization: Bearer eyJ0eXAiOiJKV1QiLC23JhbGciOiJSUzI1NiIsImp0aSI6ImNkYjBkNGFmNmIwZGI0NzhhN2Y5YWUyYTVjZWMxYmMxNmY0NDQzZTg3YTg4ZTI1NDdkYWZlZDVhYTk1OWExODA1ZjllYjc3MDkzNjI4NjViIn0.eyJhdWQiOiIyIiwianRpIjoiY2RiMGQ0YWY2YjBkYjQ3OGE3ZjlhZTJhNWNlYzFiYzE2ZjQ0NDNlODdhODhlMjU0N2RhZmVkNWFhOTU5YTE4MDVmOWViNzcwOTM2Mjg2NWIiLCJpYXQiOjE1MjMxNzU4NDksIm5iZiI6MTUyMzE3NTg0OSwiZXhwIjoxNTU0NzExODQ5LCJzdWIiOiIyOCIsInNjb3BlcyI6W119.k-2kHtJVqFFdyAXaWUgIcfRfZbghTc7AQPouAu8QF-U99HHSKrr4I5Lr4vP58RzFzbq3p0L5V2uqyb4CrrFTV0TDCH9lVWy2MZZTMCxG0ZkMXEfpaffAZ7Xuixa4NNJ5Up_M_BAJHFuPLVupFW8JvSBj3tJgo6MvkvNMhlpJx8ScsgeZBYd-LOTGyQ6PK0ZVrn7A8XMzua4EcW9IQu2gNEUzm4PcMUHJG64YwPTTAJ6E_Zey1W1jm3Tb_yPLaQbWh-D32vlB8qTkPi69kL7d4mUCyUGGQMYKjgfLtQuB_yN6ay7BHH5sxhWKDhQt2WqHBY6RzyAew13jURajES-2bIWupK0Q6WZAiqEhlueG1Fr6omIMtzI2GQwDHUEwhjY13f8L3gBMb0YuizpevExKqINt33YSVKOJo6FrkDbbNZPsH7k0KW51-Tc7eWh-jWQI_cqhTtqKcLe0YwIJNCcwrwYMSETDlOPX2kz4RYyFghaw1xfy4_G3n2txEIAkpMHjEVu98N7L960AiEeSfLeY4J6Tx9mKx1UYTgX_hpUbfYg37eU2u2Wx8WdgLiVJcmyd0KwTInXn2k8qGtw9golkniIvaz1iyzz8LKt7I8Vv1L9PpID8Gg59ckKqKk4D8Hhhj6Ng7H-eqE0JVY4kWgAyIpGsoKAtdWuV83Vu_ravTIw\nI need the Authorization in workerman onMessage function. The $_GET is [], $_SERVER not has them. ",
    "Tasmany": "With 0.4.3 work fine. ",
    "hellvesper": "Just checked, workmen 3.5.5 have same problem.. I think problem is in default event-loop. By default, it uses Swoole, when I changed it to Ev, the problem is gone.\nWorkerman[server.php] status \n----------------------------------------------GLOBAL STATUS----------------------------------------------------\nWorkerman version:3.5.6          PHP version:7.2.4\nstart time:2018-04-17 19:32:38   run 0 days 0 hours   \nload average: 1.42, 2, 2         event-loop:\\Workerman\\Events\\Swoole\n1 workers       1 processes\nworker_name  exit_status      exit_count\nWebServer    11               2\n----------------------------------------------PROCESS STATUS---------------------------------------------------\npid     memory  listening           worker_name  connections send_fail timers  total_request qps    status\n10325   2M      http://0.0.0.0:8080 WebServer    0           0         0       0             0      [idle]\n----------------------------------------------PROCESS STATUS---------------------------------------------------\nSummary 2M      -                   -            0           0         0       0             0      [Summary]\n```[PHP Modules]\nbcmath\nbz2\ncalendar\nCore\nctype\ncurl\ndate\ndba\ndom\nev\nexif\nfileinfo\nfilter\nftp\ngd\ngettext\ngmp\nhash\niconv\nintl\njson\nldap\nlibxml\nmbstring\nmysqli\nmysqlnd\nodbc\nopenssl\npcntl\npcre\nPDO\npdo_dblib\npdo_mysql\nPDO_ODBC\npdo_pgsql\npdo_sqlite\npgsql\nPhar\nphpdbg_webhelper\nposix\npspell\nreadline\nReflection\nsession\nshmop\nSimpleXML\nsoap\nsockets\nsodium\nSPL\nsqlite3\nstandard\nswoole\nsysvmsg\nsysvsem\nsysvshm\ntokenizer\nwddx\nxml\nxmlreader\nxmlrpc\nxmlwriter\nxsl\nZend OPcache\nzip\nzlib\n[Zend Modules]\nZend OPcache\n```. ",
    "plashenkov": "It works excellent for me too, thank you very much!\nMaybe you will want to add the ability to use the Channel\\Client outside of workerman environment right out of the box?. Cool! Tested it, works very nice.. Thank you!\nYes, I know that it answers to pings. But how to implement sending pings to clients from the server? And checking for answers (pongs). And maybe closing a connection if there is no pongs from the client.. ",
    "poisonbian": "I met the same problem, I had updated Workerman to version 3.5.6, but it didn't work\nFatal error: Declaration of Workerman\\Events\\React\\Base::addReadStream() must be compatible with React\\EventLoop\\LoopInterface::addReadStream($stream, callable $listener) in /home/work/poisonbian/god/ThinkPHP_3.1.3/Extend/Vendor/Workerman/Events/React/Base.php on line 23. class Worker\n{\n    /\n     * Version.\n     \n     * @var string\n     /\n    const VERSION = '3.5.6';\n/**\n * Status starting.\n *\n * @var int\n */\nconst STATUS_STARTING = 1;\n\n....... ",
    "energo5": "Yes, thank you.. You mean transfer from the server to the client via the websocket only a link to the file, and on the client through JavaScript to show in the browser. Correctly?. ",
    "nexen2": "Walkor, its clear to use a timer. But what about data?\nYour code is not working, Chrome is disconnecting on ping, writing an error to log:\nsocket.js?v=1550695204:185 WebSocket connection to 'ws://crm.local/websocket' failed: A server must not mask any frames that it sends to the client.\nSame troubles with closing. In time Chrome just drops connection on WS socket close so its ok, but Firefox waits its closed on server side, and closes a connection from client side then. But your \"close\" packet seems incorrect, bcz Firefox after page refresh (F5 or any other action) writes to log:\nThe connection to ws://crm.local/websocket was interrupted while the page was loading.\nPeople say that bcz connection was not clearly closed from server side.\nPlease, fix that and provide a functionality to control a Websocket service correct packets - both ping and close and any other if it exists.. I tested Wrench library and how it make a ping.\nIt sends, if I had sent a \"time()\" as ping:\n//                   1 5 5 0 7 5 3 2 9 6\n//890a31353530373533323936\nWhere 89 an opcode, 0a - length. You have 8 zeros, so seems you did a mistake: not \"898000000000\", but \"89080000000000\" is correct - you missed a zero before last \"8\".\nAlso, it works with Chrome, but failing in Firefox. Seems Firefox does not like \"zeros\" string. But it accepts normal string, like timestamp for example.\nIt still a question what is wrong with \"close\".\np.s. after some tests I discovered that onWebSocketClose is runned when it must, but connection is not closed. Sometimes onWebSocketClose is runned again several seconds later. And in 10-15 seconds normal onClose is being run, thats the moment when it closed really. O_o. And hi again. :-)\nIt looks like server cannot close the connection. It closing up to 10-15 seconds later, on some \"timeout\" or similar setting.\nI added a erorr_log() to TcpConnection::destroy() and discovered its called several times (3-5 usually) before connection is closed really.\nRunning \"server.php connections\" shows these unclosed connections.\nAgain, Both Chrome and Firefox writes error messages to console about connection problem with WS host.\nSo, \"workerman\" is doing something wrong when connection is closing. Wrench library has no such problems, but this library have no multi-thread support.\nhttps://github.com/varspool/Wrench\nP.S. BTW i tried \"0x880x00\" - my v64 Firefox fails, it wants at least 6-8 bytes data in a ping packet to treat it correctly. \"Empty\" ping packet makes browser disconnect a WS connection, not keeping it alive. That's why I sent a \"time()\" data.. ",
    "sergiy-petrov-vakoms": "I think it would be great to move words \"linux\" and \"windows\" to separate class-constants, e.g. OS_TYPE_LINUX and OS_TYPE_WINDOWS to prevent such typos in future.. ",
    "zqhong": "@sergiy-petrov-vakoms \nsound good. I add a new Pull Request to do it. #327 \n:smile: . ",
    "malacca": "sorry, I still don't know how to reproduce.\nI use workerman on centos7,  test same code many many times, it happened sometimes, not always\nmaybe worker process stop, but not run this code\nhttps://github.com/walkor/Workerman/blob/master/Worker.php#L1451\nso, if only use static::$_pidMap to check worker process status, it will be never stop sucessful\nhttps://github.com/walkor/Workerman/blob/master/Worker.php#L1476\ni add these code,  and test same code,  it work fine everytime.\ni think it's system compatibility issues, this is just in case\n. added one new change,  for win version,  may be start file not have .php extension\nis_file() verification  is enough\ni  have test case,  include first pr, how to give you ?. ",
    "327": "how to see gatewayworker version ? I user composer by  \"workerman/gateway-worker\": \"^3.0\". \nthis is my version info. /\n\n * Gateway\uff0c\u57fa\u4e8eWorker \u5f00\u53d1\n * \u7528\u4e8e\u8f6c\u53d1\u5ba2\u6237\u7aef\u7684\u6570\u636e\u7ed9Worker\u5904\u7406\uff0c\u4ee5\u53ca\u8f6c\u53d1Worker\u7684\u6570\u636e\u7ed9\u5ba2\u6237\u7aef\n \n * @author walkorwalkor@workerman.net\n\n/\nclass Gateway extends Worker\n{\n    /\n     * \u7248\u672c\n     \n     * @var string\n     /\n    const VERSION = '3.0.8';\n . \n. thanks, you are right.\nneed restart after upgrade. ",
    "hoangweb": "i fixed it by not passing true param to send method:\nthis code produce Invalid frame header:\n$connection->send(\"HTTP/1.1 200 OK\\r\\nConnection: keep-alive\\r\\nServer: workerman\\r\\nContent-Length: 5\\r\\n\\r\\nhello\", true);\ni changed to:\n$connection->send(\"HTTP/1.1 200 OK\\r\\nConnection: keep-alive\\r\\nServer: workerman\\r\\nContent-Length: 5\\r\\n\\r\\nhello\");\n. ",
    "INHack20": "Perfect, you could add to the protocol http, https, ws or wss the option to set the origin of the ip for example:\n$protocol = $worker->getProtocol();\n$protocol->setIpSourceMethod(\"REQUEST\");// OR\n$protocol->setIpSourceMethod(\"HTTP_X_FORWARDED_FOR\"); // OR \n$protocol->setIpSourceMethod(function($request){\n//logic for obtain ip from $request\nreturn 127.0.0.5;\n});\nIt is an idea to configure and be able to obtain the real public ip behind a proxy or haproxy.\nThank you.. Ok thanks.. ",
    "DeltaVetal26": "Hi Walkor! I tried to create a test WebSocket Server from the example below:\n`<?php\nrequire_once DIR . '/vendor/autoload.php';\nuse Workerman\\Worker;\n// Create a Websocket server\n$ws_worker = new Worker(\"websocket://0.0.0.0:2346\");\n// 4 processes\n$ws_worker->count = 4;\n// Emitted when new connection come\n$ws_worker->onConnect = function($connection)\n{\n    echo \"New connection\\n\";\n };\n// Emitted when data received\n$ws_worker->onMessage = function($connection, $data)\n{\n    // Send hello $data\n    $connection->send('hello ' . $data);\n};\n// Emitted when connection closed\n$ws_worker->onClose = function($connection)\n{\n    echo \"Connection closed\\n\";\n};\n// Run worker\nWorker::runAll();`\nAfter running this server, I decided to connect to it via the Web application: https://www.websocket.org/echo.html\nWhen I try to connect to this WebSocket Server, I see a message about an unsuccessful connection:\nhttps://imgur.com/a/h9qzx1D\nThe most interesting is that ESP8266 in the form of WebSocket Client connects and works normally. I thought that the case in the Firewall, having disabled his error, did not disappear.\n. @taozywu\n I changed the protocol to ws, and it all worked! Many thanks!!! Another question: is it possible to create two WebSocket servers (# 1 for ESP8266 devices, # 2 for a web browser). Commands from the web browser will be transferred to WebSocket Server # 2, and then sent to the WebSocket # 1 server? I would like to implement this for the reliability of the system, if the # 2 WebSocket server fails\n. @taozywu \nThank you very much for the code! One of these days I will check my server and say the results :)\n. js code:\njavascript\nvar socket = new WebSocket(\"ws://xx.xx.xxx.xx:2342\");\nsocket.onopen = function() {};\nsocket.onmessage = function(event) {};\nI connect to the WebSocket Server not only through js. On the phone I have a separate WebSocket application, on the computer that I connect through the js page, there is also esp8266. If you connect one by one, then the following happens:\ntxt\nPress Ctrl+C to stop. Start success.\nNew Client: 1\nNew Client: 1\nNew Client: 2\nNew Client: 1\nNew Client: 3\nEverything is very strange. I even tried to completely update Workerman. I have a suspicion that this is due to the fact that I connect to the server from different types of device clients (phone application / computer browser / esp8266-unknowable, it has its own websocket code)\nFor the correctness of the experiment, I took a separate html file into which I downloaded the js code written above.  I uploaded this file to the hosting.  Next, I went to this file from the browser and a connection with id 1 appeared in the console. Next, I moved to this file from the phone (another network) and the console again appeared with the connection to id 1. Next, I tried to reload the page from the phone, in the console  the connection from the phone rebooted and became already with id 2. It worked!\ntxt\nNew Client: 01\nNew Client: 11\nNew Client: 31\nConnection closed\nNew Client: 02\nConnection closed\nNew Client: 12\nConnection closed\nNew Client: 21\nConnection closed\nNew Client: 13\nConnection closed\nNew Client: 32\nConnection closed\nNew Client: 03\nConnection closed\nConnection closed\nNew Client: 33\nConnection closed\nNew Client: 34\nConnection closed\nNew Client: 14\nConnection closed\n@taozywu @walkor \nMany thanks!!! I love the Workerman!. Sorry, it works fine when I have:\nphp\n$worker->count = 1;\nI increased the number of connections and installed the channel:\n```php\nuse Workerman\\Worker;\nrequire_once DIR . '/autoload.php';\n// Channel Server.\n$channel_server = new Channel\\Server('0.0.0.0', 2206);\n$worker = new Worker('websocket://0.0.0.0:2342');\n// 6 processes.\n$worker->count=6;\n$worker->onWorkerStart = function($worker)\n{\n    // Channel client connect to Channel Server.\n    Channel\\Client::connect('127.0.0.1', 2206);\n    // Subscribe $worker->id event .\n    Channel\\Client::on($worker->id, function($data)use($worker){\n        foreach ($worker->connections as $connection) {\n           $connection->send($data);\n        }\n    });\n};\n$worker->onConnect = function($connection) use ($worker)\n{\n    echo \"New connection from ip: \" . $connection->getRemoteIp() .\"\\n\"; // \u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u044c\n    //global $id;\n    $id = $worker->id.$connection->id; // id write\n    echo \"Connect client: $id\\n\";\n};\n$worker->onMessage = function($connection, $data) {\n   if (strpos($data, 'Browser:') !== false) {\n    $wid = $data[9];//substr($data, 10);\n    $evsid = substr($data, 10);\n    $worker_id = $wid;\n    $message = \"EVS LED ON\";\n    Channel\\Client::publish($worker_id, $message);\n   }\n};\nWorker::runAll();\n```\nExample: I send a message:\ntxt\n\"Browser: 32\"\n, then the algorithm truncates this message and writes the variables:\nphp\n $worker_id = 3\n $evsid = 2\nThen the message is sent to channel # 3:\nphp\nChannel\\Client::publish($worker_id, $message);\nWhen I send a message = it is sent to all members of the channel\n\u21163, which is not very good. How do I send a message to a client with ID 32? 3 - channel number, 2 - customer ID. \nThe source code of the channel uses only the publication ($ worker_id, $ message);\n. Unfortunately, this does not work(\nExample: I'm writing the command\n txt\n\"Browser: 42\"\n, but on this device with ID 42 commands were not received. Did I do something wrong?. @walkor Everything is working! Many thanks!!!\n. @walkor Thank you very much!. ",
    "IlyaChupika": "thank you!. ",
    "tyurderi": "Yup - but by increasing TcpConnection::$defaultMaxSendBufferSize the speed of the transmission is way too slow. It feels like 0,1MB per second. When changing the length of data for fwrite the speed is increasing very good. For example I did this:\nphp\nfwrite($this->_socket, $this->_sendBuffer, 8192 * 1024);. ",
    "jfcherng": "Because of https://github.com/walkor/Workerman/issues/249.\nIf this PR is merged, maybe we add an extra doc in the readme to indicate Workerman under Windows via $ composer require workerman/workerman --ignore-platform-reqs?\n--ignore-platform-reqs ignores php, hhvm and ext-* requirements.. ",
    "Tonkong": "ok. ",
    "DTFreeman": "$ws_worker->count = 4;\n$ws_worker Master process will fork 4 child process, and master process will never die... if child process crash/exception/die, master will restart it!\nand your code is running at child process.\n@see Workerman\\Worker::monitorWorkersForLinux(). ",
    "Shkarbatov": "\nmaster process will never die\n\nTo optimistic :)\n\n@see Workerman\\Worker::monitorWorkersForLinux()\n\nThanks!. ",
    "morix-gao": "Thank U~. ",
    "olegius88": "workerman-3.5.14-stable\nframework - WordPress 4.9.8\nPHP 7.2.9\nworpdress run in onWorkerStart event in single Worker. ",
    "dns582": "Good afternoon, friends! Was it possible to deal with this issue?. Apparently you need to do as in this example, a global array of users ($uidConnectionMap), https://github.com/walkor/web-msg-sender/blob/master/start_io.php . However, I would like to understand how to use it correctly in WORKERMAN, the author please help!. I had such task: there is a web socket through which commands for performance of slow operations come. WS_worker puts the task into the queue from the queue other worker lifting her up and perform. The problem arose when it was necessary after the task back through the socket WS_worker to notify the user of performance of a building. As the respected author said, all these workers are different processes, and there is no visibility of variables. Therefore, I have not yet found a better way than to write the result of the execution to the database and in the ws-worker timer to poll the database for the completion of the task and then inform the user. If there is a more elegant solution to not pull the database - please tell me about it.. Probably the best idea is to use local_socket to alert ws_worker when a long task has completed. This is great! Thanks a lot to the author!. ",
    "sanan-tech": "Yeap I'm use the command where usr/sbin/php-fpm7.2. This index.php calls the getWorker () method on the SocketController:13. All this application works outside the docker, on physical hardware, but inside the docker - this controller running in CLI mode, as I wrote above, does not see superglobal variables of  php:((. I also removed \"./chatter/web/ws/index.php start -d\". Because this needs to be done inside the container, not in the dockerfile :) in any case, this does not solve the problem. thanks:)  issue solved! greetings from Moscow:)) \nthe problem really was not only this, but also in my settings of the docker, as well as what should be specified when creating the websocket ip-address 0.0.0.0 with port from dockerfile's EXPOSE value (for ex 8080) and in docker-composer.yml:\n```yml\nphp:\n...\nports:\n    - \"8080:8080\"\n. I run Ctrl+C, Ctrl+Z, exit command, but is not working:(. https://anotepad.com/notes/hjfjtp \n. There are 2 ways I used:\ndocker-compose exec php php public/wss/index.php start -d\nand\ndocker-compose exec php bash\n$ php public/wss/index.php start -d\n```\nboth methods give the same result - the console is locked.. thanks!. ",
    "abramovantonru": "Dump: https://pastebin.com/qMTNwDBi\n20 packets captured\n20 packets received by filter\n0 packets dropped by kernel\n\n\n\n. Server echo: https://pastebin.com/NC3a0MXn\nDump: https://pastebin.com/hddE1gRc\n\n. There may be a conflict between the server settings and the Workerman, because the other project (phpws) is working completely.\nI will remind you that errors appear only when the client sends messages to the server. Separately from the server the messages come up correctly, but not in response to the client, but sent through the local socket.\nworkerman.zip. Screenshot 1: on connect.\nScreenshot 2: on message (ws.send('hello')).\nWhat is it? Check $buffer.\n\n\n. Thank you for your time. The problem can not be solved and you can not reproduce it. It's a pity, but it happens. I now use swoole, everything works fine without any changes to the platform and settings. There is a large community around Workerman and I like it, but such problems do not allow it to be used. Probably some problems with the place where the client understands how to sign a frame with a mask. Only this way I can explain the byte code instead of the normal input data on the server. Two different frameworks work, so the problem is only this. I apologize for not being able to understand and help improve the Workerman.. Thanks you, but my CMS Framework required mbstring.func_overload = 2.. ",
    "blogdaren": "That's all right\uff0cmy pleasure. \n. ok, i  don't know why the codes format become so disordered in github?\nand my VIM configuration is:\n\"\"\u8bbe\u7f6etab\u7b49\u4ef7\u7684\u7a7a\u683c\u957f\u5ea6\nset tabstop=4\n\"\"\u64cd\u4f5c<<\u548c>>\u65f6\u7f29\u8fdbN\u4e2a\u7a7a\u683c\nset shiftwidth=4\n\"\"\u8bbe\u7f6e\u624b\u52a8\u6309\u4e0btab\u952e\u65f6\u7f29\u8fdbN\u4e2a\u7a7a\u683c\nset softtabstop=4\ni will check it,  and plz tell me if you have any idea, thks.. @walkor \n1. well, i have found the reason why codes become so disordered on github, plz see:   http://www.blogdaren.com/post-2476.html\n2. BTW, i fixed the code reformat merged in pull request #364\uff0c and i will pay more attention to it later.\n3. After removing the redundant code  once again, it looks like this:\nhttps://github.com/blogdaren/Workerman/blob/0c70d0f431cf676a5b86ef42da0fde4a0a780cba/Worker.php#L1583-L1597\n4.  check all of above is ok?. PR #367 submited . > Fixed.\nen, rtirm($buffer) is also not rigorous,  have got the fixed code rtrim($buffer, \"\\r\\n\");  . > include_once will not include or execute index.php again so no output there.\n\nIn workerman, classes should be defined as a single file and loaded with include_once/require_once or autoload mechanism.\nThe standard practice is like this.\nindex.php\n<?php\nrequire_once /your/path/of/User.php\necho \\User\\User::getName() . '<br />';\necho \"user-2\" . '<br />';\nThis is also the practice of most frameworks.\n\ni have a new test again with practice, i approve the practice rquire_once which will keep the code /path/to/user.php reside memory contantly, but as to the case http application,  it will ask Workerman to reload /path/to/user.php every time when the code self changed, i think this is not proper, so any advice?\n. en...., i got that\u3010FileMonitor\u3011 long ago,  but as to http application, i just don't understand why we need workerman to reload the code manually or with compoment like  FileMonitor every time when the code self changed,  if so, on one hand,  it will make us do such a  job frequently in development mode\uff1b on the other hand, i guess that the good news is the class code require_once will keep reside memory, right\uff1f  so do u mean is it necessary or right way to do like this ?\n. @walkor \n1\u3001firstly, tks for your awesome replying, i feel that i m lack of certain understanding for the specifics resident memory for a long time, i always thought  HTTP APPLICATION code based on Workerman works like PHP-FPM,  i just mean the HTTP APPLICATION\uff0ccurrently it looks i have wrong understanding\uff0c in other words, all applications based on Workerman will run as resident memory \uff0cso is it right to understand\uff1f\n2\u3001secondly,  i have a little of doubt for the WebServer\uff1a\nhttps://github.com/walkor/Workerman/blob/9893a3b26eb06f9d35a760e0dd049a5dacbfcb40/WebServer.php#L208\nhere, the include statement\uff0c\u3010yeah i can understand the class code\u3011but assume the application code  /path/to/index.php looks like this:\n<html><body>demo</body></html>,  in this case,  i wonder how include can make the index.php keep reside memory\uff1f and i know that we call include every time will lead to PHP to reload the code from disk,  now it seems contradictory,  is it right to understand or how was that\uff1f. @walkor  okay, got that..., tks a lot.. awesome... thks  a lot.. ",
    "guangrei": "hi sorry for the late reply, after some research i don't need to create connection pool and what i really need is workerman/channel, thanks for great work \ud83d\ude4f\ud83c\udffb. ",
    "MarcFaussurier": "Hello !\nI fixed the 5.3.x compatibility mistake here https://github.com/iPolitic/Workerman/commit/51d3f5cc29218b8c1db97631c83e1898f83cd301\n\nif (static::$eventLoopClass) {\nseems like wrong.\nif (!static::$eventLoopClass)\nseems like all right. \n\nAre you sure ? \nBecause well as the default value for your static variable Worker::$eventLoopClass is '' (empty string) I am simply checking that this string is non empty.  If it is not, i continue etc ... else I use the default Loop exactly as before, expect that I change it back to the default one if an unsupported loop were given instead of crashing the php script and the computer.  \nAlso I have a little question; why isn't the Ev loop declared in Worker::$_availableEventLoops array ?\nA last thing, in my last phpsocket.io merge (https://github.com/walkor/phpsocket.io/pull/172/commits/14d05e41b0c09b909baf03640139fedf6a58c52e), it looks like I used PHP 5.4 short array, should I send you a fixed version of it? \nHave good day sir !\nThank you really much for your excellent lib !!! The future of php is here. ",
    "tuchido": "Thank you walkor,\nCan you help me answer one more question?\nHow to display outgoing data and data returned to the browser?. @walkor . thanks walkor,\nI tried this way, but that's not what I want to ask.\nMy idea is that the workers communicate with each other but how can it be displayed to the browser?\nOr is there a way to save to the database and display it to the browser in real time?. If i follow the javascript code above, the client can only connect to the server, and the server can not connect to the client.\nI want to simulate the server and connect to each other.\nThere are 5 servers:\nserver A connects and sends data to server B, server B receives the data of server A and processes, then server B connects and sends data to server C and finally server C returns the connection for server A.\nIn a cycle like this, how can I display the data sent and the received data of all servers to the browser?. Hi Walkor,\nThanks for your help, I am very happy to be told this.. I use the php framework yii2, if done the same way I always have to call require_once DIR. '/vendor/autoload.php'; in the files that I use. ",
    "xiaopiao5789": "@walkor \u516c\u5171\u670d\u52a1\u4f7f\u7528 CDN \u52a0\u901f\uff0c\u5982\u679c\u662f\u5185\u90e8\u670d\u52a1\u5219\u6ca1\u592a\u5927\u5fc5\u8981\u7ecf\u8fc7 CDN\uff0c\u5982\u679c\u670d\u52a1\u7aef\u5bf9 Host \u8fdb\u884c\u7ed1\u5b9a\u5219\u9700\u8981\u8fd9\u79cd\u60c5\u51b5\u3002. Duplicate of #374 . ",
    "zmn817": "Workerman is just the underlying framework, and specific permission controls are handled by specific business code.. ",
    "l2ping": "\nI thought this will not fixed, whether you disabled Error reporting, then you are not able to track the crash.\n\nIt is strange to customize the application settings in the library.. ",
    "xiaobaig0407": "thank you for the answer ,,but I have alreday used this ,and it didn't work \nthis is my code \n`<?php\nuse Workerman\\Worker;\nuse Workerman\\Lib\\Timer;\nrequire_once dirname(dirname(FILE)).DIRECTORY_SEPARATOR.'Autoloader.php';\nWorker::$pidFile = dirname(FILE).DIRECTORY_SEPARATOR.'proworkerman.pid';\nWorker::$logFile = dirname(FILE).DIRECTORY_SEPARATOR.'proworkerman.log';\n// worker\u5b9e\u4f8b1\u67094\u4e2a\u8fdb\u7a0b\uff0c\u8fdb\u7a0bid\u7f16\u53f7\u5c06\u5206\u522b\u4e3a0\u30011\u30012\u30013\n$worker1 = new Worker('tcp://0.0.0.0:8585');\n$worker1->name = 'hellomoto';\n// \u8bbe\u7f6e\u542f\u52a84\u4e2a\u8fdb\u7a0b\n$worker1->count = 4;\n//\u76d1\u542c\u7aef\u53e3\u590d\u7528\n$worker1->reusePort = true;\n// \u6bcf\u4e2a\u8fdb\u7a0b\u542f\u52a8\u540e\u6253\u5370\u5f53\u524d\u8fdb\u7a0bid\u7f16\u53f7\u5373 $worker1->id\n$worker1->onWorkerStart = function($worker1)\n{\n    if($worker1->id === 0) {\n        Timer::add(1, function () {\n            echo 'only one set ';\n        });\n    }\n};\nand   the service is Indeed running,\n'Workerman[testprocess.php] start in DEBUG mode\n---------------------------------------- WORKERMAN -----------------------------------------\nWorkerman version:3.5.16          PHP version:7.1.7\n----------------------------------------- WORKERS ------------------------------------------\nproto   user            worker          listen                processes    status\ntcp     root            hellomoto       tcp://0.0.0.0:8585    4             [OK]\ntcp     root            none            tcp://0.0.0.0:8686    2             [OK]\n--------------------------------------------------------------------------------------------\nPress Ctrl+C to stop. Start success.\nbaiyutao@baiyutaodeMacBook-Pro \ue0b0 /tmp \ue0b0 ps -ef |grep hello\n  501 74113 70996   0 10:16AM ttys015    0:00.00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn hello\n    0 74077 74076   0 10:15AM ttys021    0:00.01 WorkerMan: worker process  hellomoto tcp://0.0.0.0:8585\n    0 74078 74076   0 10:15AM ttys021    0:00.00 WorkerMan: worker process  hellomoto tcp://0.0.0.0:8585\n    0 74079 74076   0 10:15AM ttys021    0:00.00 WorkerMan: worker process  hellomoto tcp://0.0.0.0:8585\n    0 74080 74076   0 10:15AM ttys021    0:00.00 WorkerMan: worker process  hellomoto tcp://0.0.0.0:8585\nbut the coimmand  php testworkprocess.php status didn't not work   . it worked ,sorry i didn't use the same user with the command . and I change this sentense \nstatic::$_statisticsFile                      = sys_get_temp_dir() . \"/$unique_prefix.status\";\ninto \n   static::$_statisticsFile                      =   dirname(FILE) . \"/test/$unique_prefix.status\";\n,otherwise it will stop at this \n if (!is_readable(static::$_statisticsFile)) {\n            return '';\n        }\n. sorry, i have a questioin , I can use strace to debug in liux ,but what can i do with mac?. ",
    "werthd": "This is my current php file:\n```php\n<?php\nuse Workerman\\Worker;\nrequire_once './Autoloader.php';\n$context = array(\n    'ssl' => array(\n        'local_cert'  => './cert/server.crt',\n        'local_pk'    => './cert/server.key',\n        'verify_peer' => false,\n    )\n);\n// Create A Worker and Listens 2346 port, use Websocket protocol\n$ws_worker = new Worker(\"websocket://0.0.0.0:2346\", $context);\n// 4 processes\n$ws_worker->count = 4;\n$ws_worker->transport = 'ssl';\n// Emitted when new connection come\n$ws_worker->onConnect = function($connection) {\necho(\"Trigger onConnect\\n\");\n\n// When websocket connection established  onWebSocketConnect callback will be called then you can get the http header of websocket handshake by $_SERVER in it.\n$connection->onWebSocketConnect = function($connection){\n\n    echo(\"Trigger onWebSocketConnect\\n\");\n\n};\n\n};\n$ws_worker->onMessage = function($connection, $data)\n{\n    echo \"Message: \".$data.\"\\n\";\n};\n// Emitted when connection closed\n$ws_worker->onClose = function($connection)\n{\n    echo \"Connection closed\\n\";\n};\n// Run worker\nWorker::runAll();\n```\nand this is what i do on my chrome console:\njavascript\nws = new WebSocket('wss://localhost:2346');\nWebSocket\u00a0{\n    binaryType: \"blob\"\n    bufferedAmount: 0\n    extensions: \"\"\n    onclose: null\n    onerror: null\n    onmessage: null\n    onopen: null\n    protocol: \"\"\n    readyState: 3\n    url: \"wss://localhost:2346/\"\n}\nVM66:1 WebSocket connection to 'wss://localhost:2346/' failed: Connection closed before receiving a handshake response\nMy terminal logs:\nTrigger onConnect\nworker[none:91025] exit with status 11\nThe onWebSocketConnect isn't triggered. I don't know where i am supposed to get the header from to continue.. PHP 7.3.0 (cli) (built: Dec  7 2018 11:00:11) ( NTS )\nCopyright (c) 1997-2018 The PHP Group\nZend Engine v3.3.0-dev, Copyright (c) 1998-2018 Zend Technologies\n    with Zend OPcache v7.3.0, Copyright (c) 1999-2018, by Zend Technologies. I did compile my own version of php to be able to use pcntl.. Thanks a lot. I installed php 7.1 and it works \ud83d\udc4d.. ",
    "kelvindc": "I have the same problem too, \nused to work fine in 7.2\nstatus 11 after upgrade to 7.3,\nso 7.3 is not ready for use with workerman. ",
    "x-jim": "I want to separate code from mainServer.php\nmain.php\n`<?php\nrequire_once '../vendor/autoload.php';\nuse Workerman\\Worker;\nuse PHPSocketIO\\SocketIO;\nuse PHPSocketIO\\ChannelAdapter;\n$server         = new stdClass();\n$server->users  = array();\n$shop_channel    = new Channel\\Server('127.0.0.1', 8989);\n$main_channel    = new Channel\\Server('127.0.0.1', 8990);\n// Conectamos el cluster\n$io                 = new SocketIO(2000);\n$io->worker->name   = 'main';\n$io->worker->count  = 1;\n$io->on('workerStart', function() use($io) {\n// Seleccionamos el canal\nChannelAdapter::$ip    = '127.0.0.1'; // Server A\nChannelAdapter::$port  = 8989;\n$io->adapter('\\PHPSocketIO\\ChannelAdapter');\n\necho \"Worker ID: \". $io->worker->id. PHP_EOL;\n\n});\n$io->on('connection', function($socket) use($io) {\n    global $server;\n$socket->join($io->worker->name);\n\necho \"Conntected to main\" . PHP_EOL;\n\n$socket->on('tester', function($socket) use($io, $server) {\n    echo \"Server called\" . PHP_EOL;\n    return 'WOWOOOOOOOOOOOO';\n});\n\n});\n// Shop service, here it works.\nrequire 'shop.php';\nWorker::runAll();`\nShop.php\n`require_once '../vendor/autoload.php';\nuse Workerman\\Worker;\nuse PHPSocketIO\\SocketIO;\nuse PHPSocketIO\\ChannelAdapter;\nuse PHPSocketIO\\Event\\Emitter;\nuse Workerman\\Connection\\AsyncTcpConnection;\n// Conectamos al cluster\n$io = new SocketIO(2001);\n//$global_worker = new GlobalData\\Server('0.0.0.0', 2207);\n$io->worker->count          = 1;\n$io->worker->name           = 'shop';\n$service                    = $io->worker->name;\n$io->on('workerStart', function($worker) use($io) {\nChannelAdapter::$ip    = '127.0.0.1'; // Server A\nChannelAdapter::$port  = 8989;\n$io->adapter('\\PHPSocketIO\\ChannelAdapter');\n\necho \"__________\" .PHP_EOL;\n\n});\n`\nI want to start/stop service shop standalone from main.php, meanwhile main,php, but i want to acces to $server Object from main.php, because there are the users, maybe im in a wrong way but i need to separate services from one unique cluster.\nAnd then when I write php main.php status i want to see the connected services with their status on the console, is it possible?\nThank you!\n. Thank you for your answer, finally I just did one file main.php with a globalDataServer ($server  = new \\GlobalData\\Server('127.0.0.1', 9118);)\nand then in other service called shop.php but included in main.php just to start it with one command and im using: \nworkerStart in shop.php\n```php\n$io->on('workerStart', function() use($io, $server) {\n        // Seleccionamos el canal\n        ChannelAdapter::$ip    = '127.0.0.1'; // Server A\n        ChannelAdapter::$port  = 8989;\n        $io->adapter('\\PHPSocketIO\\ChannelAdapter');\n\n        global $global;\n        $global = new \\GlobalData\\Client('127.0.0.1:9118');\n        $global->add('test', 1);\n        $global->add('boot', 1);\n    });\n\n```\nAnd when user is logged I need to do something like this:\n```php\n                       $server->users[$msg['id_user']] = array(\n                            'id_user'       => $msg['id_user'],\n                            'id_company'    => $msg['id_company'],\n                            'sockets'       => array($socket->id),\n                            'token'         => $msg['token'],\n                            'id_locale_app' => $msg['id_locale_app'],\n                            'id_locale_attribute' => $msg['id_locale_attribute'],\n                        );\n                    # Seteamos globalmente los usuarios del servidor\n                    $global->add('users', $server->users);\n\n                    # Creamos una sala de usuario, donde todas las comunicaciones de dicho usuario pasar\u00e1n por aqui\n                    $socket->join($msg['id_user']);\n\n```\nBecause one user can be connected in multiple devices and different ip's, with this I save all users and the sockets per user (1-N) 1 User - N sockets.\nBy the way I have some questions:\n1- Is there a way to load balance a service?\n2- Why $io->to($socket->id)->emit('stat', 'hello'); doesn't work for me? maybe I should do $io->in($socket->id])->emit('stat', 'hello'); like a room?\n3- Is there a way to use the same channel in 2 different services? ex: shop.php and main.php connect to same channel;\n4- It is planned to do in a future, the features what I want? like multiple service global stats in one file? \nSorry for all the questions!\nPS: walkor, you had a amazing sockets library, congrats :)\nThank you in advance.. ",
    "augushong": "\u55ef,\u597d\u7684.\u7684\u786e.. ",
    "HarryZheng0907": "add file lock for avoid running multiple times. ",
    "zuicis": "Hi, at this moment i already automaticly restarting proceses with timer:\nphp\n$maxMemory = ArrayHelper::getValue(Yii::$app -> params, 'workerman.maxMemory','128');\nif ($upInsert -> memory >= $maxMemory || ($upInsert -> connections == 0 && $upInsert -> memory >= 20)){\n    posix_kill($upInsert -> pid, SIGQUIT);\n    if ($upInsert -> memory >= $maxMemory * 2){\n        posix_kill($upInsert -> pid, SIGUSR1);\n    }\n}\nAbout memory leak, i testet with one query to database and got that leak, without query also have leak, but then it needs to wait several hours:\n```php\nprivate function Work(){\n    $name = \"TEST\";\n   $dbConnection = null;\n    $consoleDir = Yii::getAlias('@console');\n    FileHelper::createDirectory($consoleDir . '/runtime/pids');\n    Worker::$stdoutFile = $consoleDir . \"/runtime/logs/{$name}_stdout.log\";\n    Worker::$logFile = $consoleDir . \"/runtime/logs/{$name}_workerman.log\";\n    Worker::$pidFile = $consoleDir . \"/runtime/pids/{$name}.pid\";\n    Worker::$eventLoopClass = '\\Workerman\\Events\\Event';\n$context = ['ssl' => []];\n$worker = new Worker(\"websocket://0.0.0.0:8910\", $context);\n$worker -> name = $name;\n$worker -> count = 4;\n$worker -> user = 'www-data';\n$worker -> group = 'www-data';\n$worker -> reloadable = true;\n\n$worker -> onWorkerStart = function($worker){\n        global $dbConnection;\n        $dbConnection = Yii::$app->db;\n\n Timer::add(0.01, function() use($worker){\n            foreach($worker->connections as $connection) {\n                $connection -> send('x');\n             }\n    });\n};\n\n$worker -> onMessage = function($connection,$data) use ($worker){\n           global $dbConnection;\n    //after some time this answer fills memory and after client reconect memory notbeing purged\n    echo \"WE GOT ANSER!!! \\n\";\n    $update = Tablets::find()->where([\"id\" => 1])->one($dbConnection);\n       //$update = Tablets::findOne(1);\n};\n\nWorker::runAll();\n\n}\n```\n. i don't think the problem is in yii2 because i`m runing script from yii2-console (CLI) with disabled debuger :\nphp\nif (php_sapi_name() == \"cli\" || basename(dirname(getcwd())) == \"api\" ){\n    defined('YII_DEBUG') or define('YII_DEBUG', false);\n}\nDisabled logger:\nphp\nYii::$app -> log -> targets['file'] -> enabled = false;\nphp\nnamespace console\\controllers;\nuse Yii;\nuse yii\\console\\Controller;\nuse yii\\di\\Instance;\nuse yii\\base\\Exception;\nuse yii\\helpers\\ArrayHelper;\nuse yii\\helpers\\Url;\nuse yii\\helpers\\FileHelper;\n//workerman\nuse Workerman\\Worker;\nuse Workerman\\Events\\Event;\nuse Workerman\\Lib\\Timer;\nuse Workerman\\Connection\\ConnectionInterface;\n//models\nuse common\\models_extendet\\Tablets;\nuse common\\models_extendet\\Records;\nif I'm not mistaken, the problem occurred after the php version upgrade to 7.2 . i'll install a fresh virtual server today and try again.. Problem on php upgrade from 5.x to 7.2. Fresh installation don`t have leak.. ",
    "wilson63": "Your code can run correctly.\nThank you very much!!. ",
    "shturnev": "\nIt's works fine for me.\n\nYes you are right! Apparently I did not understand something ..\nSorry for interrupting. ",
    "lynncho": "Thanks for your reply, I want to open the port independently, a single startup file to open multiple master processes. Services do not affect each other.\nsuch as run:\nphp console workerman chat start : Open 2345 port for chat service\nphp console workerman draw-guess start : Open 2346 port for \u300aU Draw AND I Guess\u300b game service\nMore importantly, I wish that I can shut down a service separately, and other services will run as usual.. ",
    "HillLiu": "How about use triple equals operator?\n$this->reusePort===false. "
}