{
    "ThingEngineer": "Sorry I let this go for so long, been busy on other projects. Plus I use CodeIgniter so I rarely use standalone db libraries like this except for in small projects. In answer to your question yes. This is actually what I'm doing now with the following code located on line 170 of the insert method.\n($stmt->affected_rows) ? $result = $stmt->insert_id : $result = false;\nreturn $result;\nSo IF there are affected rows then return the inserted id, IF not then return false. The included index file shows an example of inserting a record then prints out the inserted ID.\n. Thanks, definitely a useful item. Had a few people request it just didn't have the time to work on that one. :)\nI'll add it in.\n-Josh\nOn Jan 22, 2012, at 2:37 PM, Teo wrote:\n\nI needed this method in my project where I use your library, so I guess it would be handy to add it also to your code.\nYou can merge this Pull Request by running:\ngit pull https://github.com/teo-sk/PHP-MySQLi-Database-Class patch-1\nOr you can view, comment on it, or merge it online at:\nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/pull/2\n-- Commit Summary --\n- added method to get last insert id\n-- File Changes --\nM MysqliDb.php (11)\n-- Patch Links --\nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/pull/2.patch\n https://github.com/ajillion/PHP-MySQLi-Database-Class/pull/2.diff\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/pull/2\n. Oliver,\n\nNo worries, that fine with me. This was just a tool used for learning about MySQLi and DB wrappers. I used it in a few small projects but I generally use a framework like CI for large PHP projects. Nothing wrong with keeping it up to date though, I've had a good amount of people using it and still asking about it.\nJosh Campbell | Ajillion | 417.631.2473 | josh.campbell@ajillion.com\nOn Oct 30, 2012, at 10:06 AM, Oliver Bayes-Shelton notifications@github.com wrote:\n\nUpdated the MysqliDb.php file to work with php 5.3+ be removing call by reference and adding a refValues method.\nLet me know if you feel these are changes are useful.\nSorry if it is in master and not dev I just did a straight fork and push\nYou can merge this Pull Request by running:\ngit pull https://github.com/obayesshelton/PHP-MySQLi-Database-Class master\nOr view, comment on, or merge it at:\nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/pull/3\nCommit Summary\nUpdated the MysqliDb.php file to work with php 5.3\nFile Changes\nM MysqliDb.php (27)\nPatch Links\nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/pull/3.patch\nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/pull/3.diff\n\u2014\nReply to this email directly or view it on GitHub.\n. Zachary is correct, this is by design. \n\nLove the micro-framework btw Zachary, at some point in any php coders career (hopefully sooner rather than later) you come to the point when you realize a framework of some type is the only way to manage this beast of a language. I think that writing your own framework (no mater how simple or complex) is something every coder should do for education sake. \nSome other good php frameworks: Larvel, FuelPHP, CodeIgniter, CakePHP (not really on that last one...)\n. This is typical and by design.\n. You are correct, this is released under the GNU GPL license as listed in the code header block.\n. Thank you!\n. Zachary of course has a point. But to answer your question directly, yes that can be added so I'll leave this open until it is.\n. Looks good, thank you Pascal.\n. See how quick you get what you need when you ask in the right place Oscar. ;) Thanks Alexander.\n. Yes. \n-JoshC\n\nOn Jun 26, 2014, at 8:25 AM, oscaroxy notifications@github.com wrote:\nclear, thanks\nbut ... will joshcam commit your patch?\n\u2014\nReply to this email directly or view it on GitHub.\n. Merged \n-lots of smiles on this one lol ;)\n. Maybe, at this point we have less information than you do about your site and what issues could possibly be slowing down your load times. Maybe start with describing what exactly your site is doing and better yet profile the queries that run so we can see benchmark results. \n. In a quick test I haven't been able to duplicate the error, if I get some more time this weekend I'll try to dig a bit deeper if someone hasn't identified it by then.\n. Alexander is on top of this like (insert synonym here)!. I have a couple ideas but I'll need to test them. If you remove the first select or swap the order do you get good data returned from the other select?\n\nAlso could you test this out, something looks off and I'm not where I can test the existing code right now.\n$mysqli = new mysqli(  \"HOST\", \"USR\", \"PWD\", \"DBNAME\" ); \n$ivalue=1; \n$res = $mysqli->multi_query( \"CALL myproc($ivalue,@x);SELECT @x\" ); \nif( $res ) { \n  $results = 0; \n  do { \n    if ($result = $mysqli->store_result()) { \n      printf( \"<b>Result #%u</b>:<br/>\", ++$results ); \n      while( $row = $result->fetch_row() ) { \n        // do something with the row \n      } \n      $result->close(); \n      if( $mysqli->more_results() ) echo \"<br/>\"; \n    } \n  } while( $mysqli->next_result() ); \n} \n$mysqli->close();. I understand it. Alex has already submitted it but, the json package definition changes won't be published until the next release. What I should have done was have Alex make the changes right before release or make a feature branch for it, the latter seemed overkill. Lesson learned, onetime thing though. Thank you all for your contribution to this wrapper.. ",
    "obayesshelton": "Ah cool, well let's hope someone get's some use out of the new merge. \nThanks :) \nSent from my iPhone\nOn 30 Oct 2012, at 03:11 PM, Josh Campbell notifications@github.com wrote:\n\nOliver, \nNo worries, that fine with me. This was just a tool used for learning about MySQLi and DB wrappers. I used it in a few small projects but I generally use a framework like CI for large PHP projects. Nothing wrong with keeping it up to date though, I've had a good amount of people using it and still asking about it. \nJosh Campbell | Ajillion | 417.631.2473 | josh.campbell@ajillion.com \nOn Oct 30, 2012, at 10:06 AM, Oliver Bayes-Shelton notifications@github.com wrote: \n\nUpdated the MysqliDb.php file to work with php 5.3+ be removing call by reference and adding a refValues method. \nLet me know if you feel these are changes are useful. \nSorry if it is in master and not dev I just did a straight fork and push \nYou can merge this Pull Request by running: \ngit pull https://github.com/obayesshelton/PHP-MySQLi-Database-Class master \nOr view, comment on, or merge it at: \nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/pull/3 \nCommit Summary \nUpdated the MysqliDb.php file to work with php 5.3 \nFile Changes \nM MysqliDb.php (27) \nPatch Links \nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/pull/3.patch \nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/pull/3.diff \n\u2014 \nReply to this email directly or view it on GitHub. \n\u2014\nReply to this email directly or view it on GitHub.\n. \n\n",
    "okpg": "Seems to work just fine for me.\n. ",
    "fayax": "It works after MysqlDb.php update to fix _dynamicBindResults() bug.\n. ",
    "irfannaseefp": "You can use insert function for this. \n$insertdata = array('first'=>'me1', 'last'=>'him1', 'user'=>'21', 'zoneId'=>'1');\nif($result = $db->insert('x_user') )  echo \"Succes\";\nActually this issue you are facing is because , in rawQuery function, they are sanitizing the query using filter_var function. \n. As a quick way out , you can go to Class MysqliDB and edit the rawQuery function definition first line as follows:\npublic function rawQuery($query, $bindParams = NULL) \n    {\n        // $this->_query = filter_var($query, FILTER_SANITIZE_STRING);\n        $this->_query = $this->_mysqli->real_escape_string($query);\n. ",
    "zQueal": "Something like this MySQLi database class is for quick and dirty jobs; not for sustainable code. For something like what you're attempting to do, you should be using PDO functions to execute queries. They're more safe.\nIf you're unsure how to get started with PDO, you can use Flight which comes with PDO support built in. It's a more complete framework as well. Simple boilerplate.\n. For something such as this, using MySQLi (my opinion) would be outdated -- you should be using PDO prepared statements.\nThey're much more clean, and helpful.\n. ",
    "a3020": "I guess you mean Laravel (http://laravel.com)\n. ",
    "CapCap": "Why would you call an update with no changes?\n. Take a look at the following pull request: https://github.com/ajillion/PHP-MySQLi-Database-Class/pull/27\n. Take a look at the following pull request: https://github.com/ajillion/PHP-MySQLi-Database-Class/pull/27\n. Take a look at the following pull request: https://github.com/ajillion/PHP-MySQLi-Database-Class/pull/27\n. See https://github.com/ajillion/PHP-MySQLi-Database-Class/pull/26 for my solution\n. See https://github.com/ajillion/PHP-MySQLi-Database-Class/issues/22 for issue\n. Not easily, as the statements are prepared\n. This is for the following issues:\nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/issues/16\nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/issues/21\nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/issues/20\n. ",
    "logicbucks": "I would say you can use the rawQuery method.\n. ",
    "maan": "I extended it to support ORDER BY statements, check if you like. Thanks for the class!\n. I added such a method some weeks ago. Syntax is:\n$db->orderby('db_field', 'ASC');\nStandard values are \"position\" for the database parameter and \"ASC\" for the order one. So one could write:\n$db->orderby('db_field');\nor\n$db->orderby();\nin case you want ascending order and your column is named \"position\".\n. I forked it, you can find it here: https://github.com/maan/PHP-MySQLi-Database-Class\nPut out a request to merge, too.\n. If you want to do it yourself: just use a raw query with the rawQuery() method.\n. pretty hard to follow if one can't see database structure and the bigger picture.\nhave you tried setting a test-timestamp instead of \"CONCAT(CURDATE(), ' ', CURTIME() )\" to track down where the problem sits? or creating the timestamp via php? just to check, not as a permanent status for your project(s).\n. You are using the class incorrectly. This worked for me:\n$params = array('1', 'A5f8dd');\n$results = $sql->rawQuery('UPDATE images SET views=views+?  WHERE hash=?', $params);\nEDIT: Check it. Dunno if that's causing the error you have.\n. For me, it works\u2026?\n. $params = array(\"%\" . $q . \"%\", \"%\" . $q . \"%\");\n$data_results = $db->rawQuery(\"SELECT * FROM XY WHERE Z1 LIKE ? OR Z2 LIKE ?\", $params);\n. ",
    "Gapz": "The method:\n$db->order('type', 'ASC');\nWould be a great feature!\n. Hey maan,\nThanks for your reply!\nIt doesn't seem to work and I searched for orderby in the class and can't find anything.\nIs there an updated class I should be downloading from somewhere?\n. Awesome!\nThanks so much, works great!\n. maan you are the MAN! :)\nThanks so much for your efforts!\n. ",
    "pquerner": "Yes, that would be great!\n. php\n$params = array($uid, $name, $version, $dir, $version);\n                        $insert = $this->db->rawQuery(\"INSERT INTO `\" . $this->conf[\"db\"][\"db_database\"] . \"`.`\" . $this->table . \"` (`uid`, `software_name`,`version_server`,`path_exe`) VALUES (?, ?, ?, ?) ON DUPLICATE KEY UPDATE uid=LAST_INSERT_ID(uid), version_server=?\", $params);\ngives me this:\nFatal error: Call to a member function fetch_field() on a non-object in /home/p.querner/public_html/_Intern/UpdateProgramWithoutAD/Server/Classes/MysqliDb.php on line 418\nI'll try to work on it when I got some space, for now its ugly but working with the use of a new mysqli query. I still dont understand why exactly.\n. Now working fine with your changed, atleast it does not throw an error.\nChecked with:\nphp\n                        $params = array($uid, $name, $version, $dir, $version);\n                        $insert = $this->db->rawQuery(\"INSERT INTO `\" . $this->conf[\"db\"][\"db_database\"] . \"`.`\" . $this->table . \"` (`uid`, `software_name`, `version_server`, `path_exe`) VALUES (?, ?, ?, ?) ON DUPLICATE KEY UPDATE uid = LAST_INSERT_ID(uid), version_server = ?\", $params);\n                        if ($insert)\n                                return true;\n. Would it be possible to have the data in that sql query too?\nSomething like:\nSELECT * FROM foo WHERE bar = 1\n. Chunk your stuff you want to add to your DB.\n. Also it could help to chunk whatever your have (my data is inside an array) and if I through my array, which has 36k records to the insert function (with foreach) it will break together also.\nI had to chunk it down then foreach to the chunked down array, and then feed it to the insert function.\n. Its too much data to process. You cant take the script to handle it for you. Its your system.\n. I dont think thats really helping the issue here.\nSure, it doesnt try to have it all in one select, but once you're finished you have this big array data which is floating somewhere in memory.\nThis is a programmatic error, not some error of a 3rd party library in my opinion.\n. I agree with avbdr. Follow the naming rules and this is a good pull request. :)\n. Shouldnt it be $_count just to have the same naming conventions?\n. Well okay then. :)\n:+1: \n. Simple solution would be to add a function to class which simply returns\nreturn $this->_mysqli->ping();\nThen to call it:\n/* check if server is alive */\nif ($db->pingServer()) {\n    printf (\"Our connection is ok!\\n\");\n} else {\n    printf (\"Error: %s\\n\", $db->error);\n}\n. Just realized. There is a pull request which features your needs already: Simple grab the code from there:\nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/pull/54\n. Looks great!\n. Well yes. You could use the select query.\nAs said in the examples:\n$users = $db->get('users', 10); //contains an array 10 users\n. Easy.\nOne solution would be to simply cache the IDs and then exclude those IDs (which are currently shown) in a WHERE clause (with NOT IN for example).\nSo:\nGrab all the IDs and do a count on it. Then divide this number by X (how much posts you want per page).\nThen do a limit to 10 to get the first 10 results (on page 1)\nIf page <> 1 you have to grab all IDs which were NOT IN the first 10 (and were not in the previous 10) and do a limit on it. \nAnd so on...\n. I dont think the conn.php solution works for all of us. Also the code looks unclean and there is a lot of unneeded changed lines. (Coming from your style to code)\n. In the end I realized that, but thanks for the heads up. :)\n. Maybe a comment on top of your code would be great.\n. I always use \nif ($this->mysqliDb->ping() !== TRUE) {\n//could not connect\n}\n. ",
    "massivetoe": "I think this is by design. The use of filter_var($query, FILTER_SANITIZE_STRING) converts single quotes into entities. \nTry using rawQuery instead; where the single quoted parameters are in the $params array:\nphp\n$params = array($uid, $name, $version, $dir, $version);\n$results = $db->rawQuery(\"INSERT INTO `\" . $this->conf[\"db\"][\"db_database\"] . \"`.`\" . $this->table . \"` (`uid`, `software_name`,`version_server`,`path_exe`) VALUES (?, ?, ?, ?) ON DUPLICATE KEY UPDATE uid=LAST_INSERT_ID(uid), version_server=?\", $params);\nI've not tested this though.\n. I notice on my setup it throws an error, but still writes to the database. http://www.php.net/manual/en/mysqli-stmt.result-metadata.php#97338 explains that INSERT/UPDATE/DELETE does not produce a result for $stmt->result_metadata() - but does not give an error. This may be why $meta->fetch_field() falls over (and then throws the error).\nCommenting out \"return $this->_dynamicBindResults($stmt);\" on line 133 stops the error being thrown. \nIt's not a solution, but that's as far as I've got at the moment.\n. I've edited the class so that the function _dynamicBindResults(mysqli_stmt $stmt) checks if it's a SELECT query or an INSERT/UPDATE/DELETE query:\n``` php\n    protected function _dynamicBindResults(mysqli_stmt $stmt) {\n        $parameters = array();\n        $results = array();\n    if ($stmt->affected_rows === -1) { // SELECT\n        $meta = $stmt->result_metadata();\n        $row = array();\n        while ($field = $meta->fetch_field()) {\n            $row[$field->name] = null;\n            $parameters[] = & $row[$field->name];\n        }\n\n        call_user_func_array(array($stmt, 'bind_result'), $parameters);\n\n        while ($stmt->fetch()) {\n            $x = array();\n            foreach ($row as $key => $val) {\n                $x[$key] = $val;\n            }\n            array_push($results, $x);\n        }\n        return $results;\n    }\n    else { // INSERT/UPDATE/DELETE\n        return $stmt->affected_rows;\n    }\n}\n\n```\nI've not fully tested it, so it may not be that great.\n. Update of _dynamicBindResults() to fix https://github.com/ajillion/PHP-MySQLi-Database-Class/issues/23\nIf a SELECT query is passed to $db->query or $db->rawQuery, all is OK. However, if an INSERT/UPDATE/DELETE query is used, the function falls over.\nThe problem is\nphp\n$meta = $stmt->result_metadata();\ndoes not return a result for an INSERT/UPDATE/DELETE query (http://www.php.net/manual/en/mysqli-stmt.result-metadata.php#97338). This causes\nphp\n$meta->fetch_field()\nto throw a fatal error.\nI propose that _dynamicBindResults() first checks for a SELECT query using\nphp\nif ($stmt->affected_rows === -1) {\nIf this condition is true, _dynamicBindResults() works as previously and returns an array of results (if there are any to return). If not,\nphp\nelse { return $stmt->affected_rows; }\nwill return the number of rows affected by the INSERT/UPDATE/DELETE query.\n. ",
    "benck": "I agree with massivetoe. You should not do escape_string by yourself when using mysqli.\n. I couldn't find the bug initially, because the array was fed by other functions. However, your suggestions will work, thanks!\n$results = $db->where('id', array_values($arr_fed_by_other_class), 'IN')->get('users');. ",
    "avbdr": "i think this is not an issue now. could be closed\n. fixed in master\n. fixed in master. thanks\n. master have getLastQuery() calls which returns schematic last executed query with variables. \nI have noted 'schematic', because char variables are not quoted. \n. thats already in master. Thank you\n. dup of https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/79\n. dup of https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/79\n. with latest version you can disable filtering. \n $crud -> rawQuery('SELECT * FROM user WHERE iduser<5', null, false);\nalso for a security reasons you might want to use bind variables instead of adding them into sql.\n $crud -> rawQuery('SELECT * FROM user WHERE iduser< ?', Array(5), false);\n. could be closed already\n. all is fixed in master :) thank you\n. $db->count variable stores resultset count now. Could be closed.\n. added in master\n. $db->join('table2Name', 'field1 <> field2', 'LEFT')\n$db->join('table3Name', 'field1 <> field2', 'LEFT')\n$results = $db-get('tableName');\n. i think this could be closed \n. should be working just fine. $db->rawQuery(\"call sp_customer(?)\", Array(5));\n. This API already landed. Could be closed\n. getValue() is available in master\n. this should be working now. I think could be closed\n. this could be closed. Already fixed. \n. Master have getOne() function implemented. \nSee https://github.com/ajillion/PHP-MySQLi-Database-Class/ doc for more details\n. could be closed\n. fixed. could be closed\n. could be closed. \n$insertId = $db->insert('contact', $array);\n. closing. We have quite good error reporting now.\n. merged into master\n. i think wont be an issue already\n. $db->count stores results count. Could be closed\n. i assume you are using rawQuery. use $db->rawQuery(\"query\",Array(args), false); to avoid that.\n. db->getLastQuery()\n. can you clarify what issue you are fixing? thank you\n. added. thanks\n. more info is in https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/211\n. this should be working now. Could be closed\n. fixed in master. thanks\n. $db-getLastQuery(); could be closed\n. with https://github.com/avbdr/PHP-MySQLi-Database-Class you can do something like\n$db->where (\"username\",$username);\n$db->orWhere (\"email\",$email);\n$db->where (\"password\",$db->func(\"SHA1(?)\",Array($passwd)));\n. lot of code were since time bugreport were created. I cant imagine a case when this can happen now.\n. new api allows to do where statements like \n$threeHoursAgo = time() - ( 60 * 60 * 3 );\n$db->where(\"add_timestamp\", Array (\"<\" => $threeHoursAgo))\nalso in my repo you there is a helper function \n$db->where(\"add_timestamp\", Array (\"<\" => $db->interval(\"-3h\"));\n. fixed in master long time ago. \n. use \n$resutls = $this->db->rawQuery(\"UPDATE __cat_product SET category = \".$new_cat_name.\" WHERE product_id IN(\". $imploded .\")\",null, false);\nand better switch to prepared statements. \n$db->where (\"product_id\", $ids, 'in');\n$db->update(\" __cat_product\", ['category' => $new_cat_name]);\n. +1 Im also working on some improvements. Slowly. For example I might finish support for functions calls in insert() and update(). \nAlso I do not agree about the fact that library have a lot of issues. Library 'just works'.\n. i think could be closed :)\n. workaround added.\nphp\n$param = array(100);\n$query = \"select * from tablename where dbfield < ?\";\ndbclass->rawQuery($query, $param, false);\n. should be fixed in master long time ago\n. can anybody provide a reproducible testcase for this? I mean query + sample table structure + sample data? \n. great then :) @danielcorrea can you confirm that latest version fixes issue for you too?\n. just pull the latest master.\n. how many records you are pulling out? \n. i have a feeling that this bug is mostly not related to a library but about big amounts of data peoples are trying to select with 1 select. Maybe as a workaround to this problem we need to come up with one more get() which will be performing multiple selects with limit in the background.\nAlso im still not sure if we need to call mysql_store_result() for all the queries. \n. fixed in master\n. you patch is breaking existing code style (camel case and indents) plus I see bunch of dirty changes which do not belong to this feature. \nAlso to follow code style I would call variable numRows. \nApart of this I agree, patch is great. Perfect replacement for extra count() call.\n. I have reworked this patch to make it more clean plus renamed row_num to count.\nhttps://github.com/avbdr/PHP-MySQLi-Database-Class/commit/7133f129c6d920ab6befd33afa4a2b03665be17e\n. _ is usually a prefix for a private/protected variables, while in this case we have public variable. \nAm I wrong?\n. merged into master\n. I have a feeling that you do not have updated mysqlidb library. Can you check?\n. you have a typo in your code\n$mydb->where(\"psit_img_id\",  array(\"in\", $samples));\nshould be\n$mydb->where(\"psit_img_id\",  array(\"in\" => $samples));\n. please close\n. lol. its on the main page\n. $users = $db->where(\"id\", Array(\"in\" => array(1,2,3,4,5,6)));\n$users = $db->get (\"users\");\nworks like a charm\n. $db->where(\"id\", Array(\"in\" => array(1,2,3,4,5,6)));\n$db->update (\"users\", Array(\"name\" => 'test'));\nworked just fine here. Please post the piece of your code. \nMost likely there is a typo there.\n. please close\n. already fixed. Please close\n. So your implementation of real_escape_string makes sure that value will not contain reserved words? \n. I think we can merge transaction functions with some slight changes.\n1. lets take out real_escape_string for now as Im not sure about its actual purpose.\nWe can study this case deeper and modify already existing function escape() to do what is needed but in better way.\n2. begin_transaction() should be beginTransaction()\n3. __shutdown_check should() be _transaction_shutdown_check()\n4. update readme with new API examples. I think 1 small chapter 'Transactions' with 1 piece of code which is using all 3 functions will be fine\n5. add a test into tests.php\n. i just commited transactions function to https://github.com/avbdr/PHP-MySQLi-Database-Class/commit/9e7856399c7f04df72472aa50c2191c8d7cb287f\n. transactions part of this patch were landed. thank you.\n. transaction api is landed already. please close\n. can you still reproduce that with latest master? \n. that should be fixed long time ago\n. Same  like Array() but with some helpers\nphp\n$data = Array (\n    \"lastUpdated\" => $db->now(), // NOW() function\n    \"loginCount\" => $db->inc(), // logincount = loginCount+1\n    \"loginLimit\" => $db->dec(), // loginLimt = loginLimit-1\n    \"name\" => $db->func(\"CONCAT(firstName, lastName)\"), // \n    \"name\" => Array(\"[C]\",\"CONCAT(firstName, lastName)\")) // \n    \"login\" => \"testusr\"\n);\n$db->insert(\"users\", $data);\n$db->getLastError();\n. I just pushed implementation. Looking forward to hear feedbacks.\nhttps://github.com/avbdr/PHP-MySQLi-Database-Class/commit/7c6b2f4bdf6e7b0d1d4f8b830e28a38b0f293f5d \n. Simple patch will help.\n$db->get(\"users\", Array(10,10));\n```\n$ git diff MysqliDb.php \ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex c51214c..05660c5 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -530,7 +530,10 @@ class MysqliDb\n     // Did the user set a limit\n     if (isset($numRows)) {\n\n\n$this->_query .= ' LIMIT ' . (int)$numRows;\nif (is_array ($numRows))\n$this->_query .= ' LIMIT ' . (int)$numRows[0] . ', ' . (int)$numRows[1];\nelse\n$this->_query .= ' LIMIT ' . (int)$numRows;\n         } // Prepare query\n\n```\n. fixed. please close\n. patch breaks existing api. closing\n. thats already commited to master\n. fixed in master\n. fixed in master\n. https://github.com/avbdr/PHP-MySQLi-Database-Class/commit/7489b650243490365b5dcb41b5408f453ad44ec6\n\n\nUnfortunately query is not one to one to the executed one, but at least better then showing ? instead of real variables. \n. available in master\n. I have a feeling that this error comes out of stored procedure rather then library. can you check? \nI can call functions just fine. \n. is this appears every time script runs? \nI have a feeling this is a server related issue rather then our library.\n. fixed in master\n. most of the changes is from my repository. I have submitted it to a review, maybe it should be merged by pieces. Changes are not that major, during a review its visible that most of them \nI have a local tests file which passing all tests successfully after all the modifications. \nBut if somebody want to contribute to more tests, i will be glad to share it.\nAbout quotes, i think its an ajillion decission not to allow quotes as such patch was already rejected in the past and most peoples indeed keeps this mod in their branches.\n. thats all already commited to master.\n. Thats all fixed in master. Plus added 'not between' case. Thank you\n. filter_var in rawQuery() most likely is the problem. try to comment it out.\n. 1. adding backticks to select will break calls like  update/get(\"users u, products p\") and bunch of others. \n2. adding backticks to table names wont help much as where conditions still wont be escaped.\n3. it is not clear how to handle weird fields/table names like my table or my,table in automatic way. \n3) completely ruins my enthusiasm on writting a fix for this issue as anyway it will be solving 'half of the problem'.\nI have some ideas but its pretty tricky change and if someone wants to play please ping me\n. not sure how I overlooked that. \nI just pushed a fix to https://github.com/avbdr/PHP-MySQLi-Database-Class.git\nplease check and let me know. That should be merged into master soon.\n. not a bug. could be closed\n. fixed in master\n. I wrote orWhere() support here https://github.com/ajillion/PHP-MySQLi-Database-Class/pull/98 but i doubt that it will be merged. \nIn your complex where case i think rawQuery() is the way to go. \nIn the future I were thinking on writting rawWhere() to inject raw where conditions.\nSomething like:\nphp\n$db->Where(\"(username=? AND password=?)\" ,Array(...));\n$db->orWhere(\"(username=? AND password=?)\" ,Array(...));\n$users = $db->get(\"users\");\n. actually I just commited this feature https://github.com/avbdr/PHP-MySQLi-Database-Class/commit/8e48b720c5d784787233853c796a95debf42281d\n. thats also landed $db->where (\"a=1 or b=3\");\ncould be closed\n. thats already fixed \n. looks like there is a problem with preparing of such queries in mysqli. \nYou can workaround this by using query like:\nSELECT \n  TABLE_NAME\nFROM    \n  INFORMATION_SCHEMA.TABLES    \nWHERE    \n  table_schema = 'mydb' AND    \n  table_name LIKE ?\n. fixed. could be closed\n. you are missing quotes around like condition.\nWHERE registered_from.registeredType LIKE '$clay' AND swh28_user_usergroup_map.group_id IN\nanother thing make sure you have recent master.\nanother thing instead of using rawquery, you can use join() and where() functions \n. This way should look better :)\n$db->join(\"swh28_user_usergroup_map map\", \"reg.user_id = map.user_id\", \"INNER\");\n$db->join(\"swh28_users u\", \"reg.user_id = u.id\", \"INNER\");\n$db->where(\"reg.registeredType\", Array(\"LIKE\" => $clay)); \n$db->where(\"map.group_id\", Array(\"IN\" => Array(62, 28, 61, 29, 63, 27)))\n$result = $db->get (\"registered_from reg\", null, \"reg.user_id, reg.registeredType, map.group_id, u.name\");\nIts always better to pass variables via parameters array as this protects you from sql injections plus you do not need to mess with quotes. :) \n. patch available in https://github.com/avbdr/PHP-MySQLi-Database-Class/commit/3214680b72575c2431b2a66c56d0bbb5c7d388a1\n. also f01c82e is fixing an issue where multiple where() and orWhere() conditions were overwritting previous conditions on the same variable. \n. Its pretty simple to implement but im not sure about the API. \ndb->insert(\"table\", $data, $isMulti = true);\ndb->multiInsert(\"table\", $data);\nUsing  db->insert(\"table\", $data) for single and multi records would introduce security flow I believe. \n. more info in https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/208\n. i just commited transactions function to https://github.com/avbdr/PHP-MySQLi-Database-Class/commit/9e7856399c7f04df72472aa50c2191c8d7cb287f\n. you should write such conditions without prepared variables\n$db->where('month(date_added) = month(CURDATE())\");\n. there is bunch of places where error could occure. I would close the bug or strip it it down to a reproducible testcase. \nFirst of all i would check if $insert is properly populated or gets executed at all\n. Can you please test this commit? \nhttps://github.com/avbdr/PHP-MySQLi-Database-Class/commit/3874194928cdd5368fc59911539a973edf0c2a0d\n. Thank you, fixed in https://github.com/avbdr/PHP-MySQLi-Database-Class/commit/3874194928cdd5368fc59911539a973edf0c2a0d\n. merged into master\n. can you please test the same code without 'if (version_compare (phpversion(), '5.4', '<'))' removed from _dynamicBindResults () functions in the library? \nAlex\n. that is fixed in master\n. patch were not commited to joshcam repo yet. \nI have it only in my https://github.com/avbdr/PHP-MySQLi-Database-Class repo\n. already in master long time ago\n. i believe you are using an outdated version..\n. this should work\n$db->rawQuery(\"select * from table where my_column=?\",Array(\"pippo\"));\n. you can open mysqlidb.php and in rawQuery function comment out filter_var() function for now.\n. I just pushed a fix not to escape slashes as well. Thanks\n. also you can use db->get (\"table\",null, \"CASE WHEN 0 < (SELECT COUNT(*) FROM table WHERE 0=0 ) THEN '1' ELSE '0' END as column\")\nthat should work\n. thanks. I just hit this issue on the server of my old customer. :) \nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/pull/124\n. merged into master\n. Josh, can you please merge this asap so we wont bother early adopters. :)\n. as for rawQuery try to remove filter_var from the function. \nas for subquery, u have an error:   $db->where('d2.createDate', array('>'=> 'd1.createDate')); should be $db->where('d2.createDate = d1.createDate);\nyou can use getLastQuery() to debug your queries. \n. ```\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 7c8e57e..6068ffd 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -193,8 +193,7 @@ class MysqliDb\n      */\n     public function rawQuery($query, $bindParams = null)\n     {\n-        $this->_query = filter_var ($query, FILTER_SANITIZE_STRING,\n-                                    FILTER_FLAG_NO_ENCODE_QUOTES);\n+        $this->_query = $query;\n         $stmt = $this->_prepareQuery();\n     if (is_array($bindParams) === true) {\n\n```\n. i just looked  and  $sub->where('sessionId', 'd1.sessionId') is also a problem.\n. $num_rows could be replaced with $db->count . \nhttps://github.com/joshcam/PHP-MySQLi-Database-Class#select-query\n. https://github.com/joshcam/PHP-MySQLi-Database-Class/pull/119\nCan you try this fix?\n. Add \n $stmt->store_result();\nOn the line before:\ncall_user_func_array(array($stmt, 'bind_result'), $parameters);\nIn mysqlidb.php\n. What php version you are using? \n. I see. So issue is related to Bug #119. I will work out a fix after weekends.\n. merged into master\n. class never quotes values as its using prepared statements. \nSee documentation about getLastQuery(). \nupdate wont fail on empty variable except the case where your field2 is marked as 'not null'.\n. nop. I believe readme covers pretty much everything.\n. in reality update() returns an amount of rows updated instead of success/failure. \nI agree with your statement and I would rather make it return success/failure and count variable to contain amount of rows affected.\nMaybe we can add '-1' as a return value for failed update. \n. thanks. After looking at the code its clearly visible that this is a bug. \nPlease try my repo for a bugfix https://github.com/avbdr/PHP-MySQLi-Database-Class \n. Good point. I will make a commit\n. commited in https://github.com/avbdr/PHP-MySQLi-Database-Class/commit/89c80f1c91492d52880806475954f4e5a89c76f7\n. workaround is merged into master\ndb->rawQuery ($query, $params, false);\n. please try my branch on https://github.com/avbdr/PHP-MySQLi-Database-Class\nIt have a fix for that. Should be merged to here soon.\n. fix is merged into master\n. Try latest version from master. I believe you are using very old version\n. > Try latest version from master. I believe you are using very old version\n. fixed in master\n. you might try this fast code, i will commit that later togeather with new createTable () function\n\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 2d9c585..7670895 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -1052,4 +1052,9 @@ class MysqliDb\n             return;\n         $this->rollback ();\n     }\n+\n+    public function tableExists ($tableName) {\n+        $result = $this->rawQuery (\"desc \" . self::$_prefix . $tableName);\n+        return count ($result) > 0;\n+    }\n } // END class\n\n. Sorry, never managed to start working on that yet\n. added in master. Code based on code sent by @falahati. thank you.\n. Hello,\nThat's a weird issue but can you try to comment out set_charset in mysqlidb constructor and try again?\n. I agree, this piece of the api is missing for now. \nPatch below add api like this:\n $db->where(null, $sub, 'EXISTS');\n $db->where(null, $sub, 'NOT EXISTS');\nFeel free to offer better API. \n\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 2d9c585..10cd0ec 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -759,6 +759,10 @@ class MysqliDb\n                     $this->_query .= \" $key ? AND ? \";\n                     $this->_bindParams ($val);\n                     break;\n+                case 'not exists':\n+                case 'exists':\n+                    $this->_query.= $key . $this->_buildPair (\"\", $val);\n+                    break;\n                 default:\n                     $this->_query .= $this->_buildPair ($key, $val);\n             }\n\n. are you using latest master + my patch? \nCopypasting your code im getting:\nSELECT * FROM tblMember m WHERE   EXISTS  (SELECT pm.MemberID FROM tblPaymentMember pm INNER JOIN tblPayment p on p.ID = pm.PaymentID  JOIN tblMember m on m.ID = pm.MemberID WHERE   p.Year = YEAR(CURDATE()) AND pm.MemberID = m.ID) GROUP BY m.ID  ORDER BY m.Lastname ASC, m.Firstname ASC\n. I believe head and subqueries share all the data between them, but thats unrelated to an issue with query building.\nI have a feeling that you mistyped $sub somewhere in your code.\ntry to run this:\n\nrequire_once (\"../MysqliDb.php\");\n$db = new Mysqlidb('localhost', 'root', '', 'hostyourpbx');\nif(!$db) die(\"Database error\");\n    $sub = $db->subQuery();\n        $sub->join('tblPayment p', 'p.ID = pm.PaymentID', 'INNER');\n        $sub->join('tblMember m', 'm.ID = pm.MemberID');\n        $sub->where('p.Year = YEAR(CURDATE())');\n        $sub->where('pm.MemberID = m.ID');\n        $sub->get('tblPaymentMember pm', null, 'pm.MemberID');\n    $db->where(null, $sub, 'EXISTS');\n    $db->orderBy('m.Lastname', 'ASC');\n    $db->orderBy('m.Firstname', 'ASC');\n    $db->groupBy('m.ID');\n    $result = $db->get('tblMember m');\n\n. which php version you are using?\n. can you do print_r ($db) before last $db->get()? \n. and also try IN case to see if its working. Seems some weird issue with subquery() under wampserver\n. whats about print_r ($sub->getSubQuery()) after $sub->get()\n. can you try this patch?\n\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 4569e3a..b96fc36 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -97,7 +97,7 @@ class MysqliDb\n      * Is Subquery object\n      *\n      */\n-    protected $isSubQuery = false;\n+    protected $isSubQuery = 0;\n\n     /**\n      * @param string $host\n@@ -118,7 +118,7 @@ class MysqliDb\n             $this->port = $port;\n\n         if ($host == null && $username == null && $db == null) {\n-            $this->isSubQuery = true;\n+            $this->isSubQuery = 1;\n             return;\n         }\n\n\n. \ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 4569e3a..99142ca 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -119,8 +119,10 @@ class MysqliDb\n     if ($host == null && $username == null && $db == null) {\n         $this->isSubQuery = true;\n\n\necho \"subquery\\n\";\n             return;\n         }\necho \"main query\\n\"; // for subqueries we do not need database connection and redefine root instance\n $this->connect();\n\n\n. can you run with this patch and see what output you will get. I wonder if you will ever hit subquery part.\n. Please try this patch.\n\n\n\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 4569e3a..a19b92a 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -117,10 +117,12 @@ class MysqliDb\n         else\n             $this->port = $port;\n\n-        if ($host == null && $username == null && $db == null) {\n+        if (empty ($host) && empty ($username) && empty ($db)) {\n             $this->isSubQuery = true;\n+            echo \"subquery\\n\";\n             return;\n         }\n+        echo \"main query\\n\";\n\n         // for subqueries we do not need database connection and redefine root instance\n         $this->connect();\n\n. try this one please\n\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 4569e3a..e31edc2 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -117,10 +117,12 @@ class MysqliDb\n         else\n             $this->port = $port;\n\n-        if ($host == null && $username == null && $db == null) {\n+        if ($host == \"subquery\") {\n             $this->isSubQuery = true;\n+            echo \"subquery\\n\";\n             return;\n         }\n+        echo \"main query '{$host}' '{$username}' '{$db}'\\n\";\n\n         // for subqueries we do not need database connection and redefine root instance\n         $this->connect();\n@@ -996,7 +998,7 @@ class MysqliDb\n      */\n     public static function subQuery()\n     {\n-        return new MysqliDb();\n+        return new MysqliDb(\"subquery\");\n     }\n\n     /**\n\n. weird. You have some global variables sharing enabled. \nTry this patch.\n\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 4569e3a..47f53ce 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -106,21 +106,23 @@ class MysqliDb\n      * @param string $db\n      * @param int $port\n      */\n-    public function __construct($host = NULL, $username = NULL, $password = NULL, $db = NULL, $port = NULL)\n+    public function __construct($dbHost = NULL, $dbUsername = NULL, $dbPassword = NULL, $dbName = NULL, $dbPort = NULL)\n     {\n-        $this->host = $host;\n-        $this->username = $username;\n-        $this->password = $password;\n-        $this->db = $db;\n-        if($port == NULL)\n+        $this->host = $dbHost;\n+        $this->username = $dbUsername;\n+        $this->password = $dbPassword;\n+        $this->db = $dbName;\n+        if($dbPort == NULL)\n             $this->port = ini_get ('mysqli.default_port');\n         else\n-            $this->port = $port;\n+            $this->port = $dbPort;\n\n-        if ($host == null && $username == null && $db == null) {\n+        if ($dbHost == \"subquery\") {\n             $this->isSubQuery = true;\n+            echo \"subquery\\n\";\n             return;\n         }\n+        echo \"main query '{$dbHost}' '{$dbUsername}' '{$dbName}'\\n\";\n\n         // for subqueries we do not need database connection and redefine root instance\n         $this->connect();\n@@ -996,7 +998,7 @@ class MysqliDb\n      */\n     public static function subQuery()\n     {\n-        return new MysqliDb();\n+        return new MysqliDb(\"subquery\");\n     }\n\n     /**\n\n. Great that you find a way to make it work.\nBut I do not understand why you are getting constructor values set with value of another instance.\nNew Mysqlidb() ought to call constructor with values set to nulls.\nYour workaround will work, however it will make second connection to mysql plus will redefine Singleton instance.\nI'm a bit short on time today so I won't be able to debug this today more closer. \nSounds as a weird bug in your php version or some very weird config option set.\n. Seems You applied my patch manually and you misunderstood lines.\nIf (host = null .... ) should be removed and replaced to if (host == 'subquery')\n. oh boy. :) well, then its resolved.\n. thats a fake feel of security. attacker can use CHAR() function :) I will close this but anyway thank you for your pull request\n. There is pagination sample in the readme.\nI'm not sure that class is a right place to\nAdd pagination functions, but you can add sample code to our index.php example and we can refer to it in readme.\n. added in master\n. fixed in master\n. https://github.com/joshcam/PHP-MySQLi-Database-Class#properties-sharing\npretty much the same you are looking for\n. Indeed, constructor will die() in case of wrong credentials. \nYou can also check $db->ping() if connection is up.\nI were thinking to refactor die() part of the library but do not want to break users code who already counting on this errors.\n. $db->where('column1 like \\'%?%\\' OR column2 like \\'%?%\\' OR column3 like \\'%?%\\' OR column4 like \\'%?%\\' ', $data);\nprepared statement do not not work this way.\n$data = array('%gas%','%gas%','%gas%','%gas%');\n$db->where('(column1 like ? OR column2 like ? OR column3 like ? OR column4 like ?)', $data);\n. thats weird. getOne() is a wrapper to Get(), it just returns first row of data and limits query to 1.\nI believe your problem is laying somewhere else.\n. > $subQuery.\" aaa\"\nyou cant concat subquery with a string as its an object. As of now library do not support join with subqueries so feel free to cook a patch or i might try to prepare something during next week. \nAlex\n. if you are still interested in the functionality you can try to use my patch from https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/195\n. thats fixed with a proper fix in https://github.com/avbdr/PHP-MySQLi-Database-Class. Should be merged here soon.\n. pushed into my branch. Will request merge now :)\n. master have this option already.\n. I afraid you need to read readme more carefully. Limit  parameter could be an array. First comment even quoted you sample code\n. thank you, fixed. fix also adds count handling.\n. fixed in master. thanks\n. this should work with $db->func() now.\n. fixed in master\n. is this written in mysqli reference somewhere? What problem _utf8 is solving? \n. thank you. i have fixed that im my tree. Will push a merge soon\n. fixed\n. thanks, late but fixed :)\n. closing as a dup of #356 \n. _query is correct as getOne() fetching only 1 row from the table. If you need more then 1 row, use get().\n. is there any test case for that? \n. i think you have your own constructor in FDKDB which is not calling parent constructor. \n. your last example have an extra closing.\nshould be\ndb->where( ' (koko=? OR koko = ? ) AND (toto = ? OR toto = ?)', array(1,2,3,4)) \n. closing as not bugreport is unclear\n. i have committed faster alternative for this. Thank you!\n. closing as not a bug\n. I have pushed today an implementation for FOUND_ROWS support in https://github.com/avbdr/PHP-MySQLi-Database-Class/commit/bbd80bc5aaa4762ec00f12523864e6e883d16d03\nShould be merged here soon.\nsyntax \n$users = $db->withTotalCount()->get('users', Array ($offset, $count));\necho \"Showing {$db->count} from {$db->totalCount}\";\nORDER BY FIELD were commited a while ago. \n. closing\n. this will work. But i agree, raw line will be more easy to ready in such cases.\n$data = Array (\n    'maxScore' => $db->func('currentScore'),\n);\n$db->where ('id', 1);\n$db->update ('users', $data);\n. closing\n. thank you, pushed to https://github.com/avbdr/PHP-MySQLi-Database-Class.git\nI were to lazy to write this myself :) \n. in master already\n. the following notation should also work. \n$db->where ('user_pass = SHA2 (?,512)', Array ($password));\nLooks cleaner I believe\n. i dont think this is a problem of the library. Looks like encoding issues in the database; \ntry to execute this query in the sql console. SELECT * FROM admin_users WHERE user_login = ? AND user_pass = SHA2 (?,512) LIMIT 1\n. oh, indeed. try to find line set_charset ('utf8'); and remote it or modify to a correct encoding. I will work out a proper setter if that will help.\n. latest version of the library allows to change charset in constructor. Fixed\n. fixed in master\n. pushed to https://github.com/avbdr/PHP-MySQLi-Database-Class.git with some modifications.\nthank you.\n. dup of https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/188\n. Writing such a feature would require to write 'one more data validation library'. I believe the best way is to sanitize your data before going into mysql as you wrote.\n. can anybody provide a reproducible testcase for this? I mean query + sample table structure + sample data? \n. more info in https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/79. closing\n. see the readme about subqueries\n. https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/30#issuecomment-72958277\n. I think for a queries like this its better to use rawQuery as building an orm syntax like this will be even more messy :)\n. just added this to master. fixes\n. i believe you need to learn PHP deeper (as well to understand how multiple rows in the table could be stored in the single row of result) or to switch to another library like doctrine. \n. i believe switching to doctrine wont save you from learning PHP deeper \n. should be working just fine. Can you try latest master? \n. closing this for missing information\n. ids should be an array.\n $db -> where('ID', Array(28,27,26,25), 'IN');\n. try to upgrade your library to the latest version.\n. unfortunately library do not support subquieres in join right now. You might cook a patch if you want as im pretty busy this days.\ndup of https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/146\n. watch for updates. I might prepare a fix in the near future.\n. Can you please try the following patch:\ncode will be (note new syntact for subQuery()):\n```\n$kapcsolattartok = $db->subQuery(\"k\");\n$kapcsolattartok\n    ->groupBy('k.megbizo_id')\n    ->where(\"qqq\", 150)\n    ->get('megbizok_kapcsolattartok k', null, 'k.megbizo_id, COUNT(k.kapcsolattarto_id) AS kapcsolattartok');\n$data = $db\n    ->join($kapcsolattartok, 'm.megbizo_id = k.megbizo_id', 'LEFT')\n    ->where('m.torolve', 0)\n    ->orderBy('m.megbizo_megnevezes')\n    ->orderBy('m.megbizo_azonosito')\n    ->get('megbizok m');\n```\n```\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 3a9dfcb..b15d14f 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -117,7 +117,7 @@ class MysqliDb\n         else\n             $this->port = $port;\n\nif ($host == null && $username == null && $db == null) {\nif ($username == null && $db == null) {\n             $this->isSubQuery = true;\n             return;\n         }\n@@ -427,12 +427,14 @@ class MysqliDb\n      {\n         $allowedTypes = array('LEFT', 'RIGHT', 'OUTER', 'INNER', 'LEFT OUTER', 'RIGHT OUTER');\n         $joinType = strtoupper (trim ($joinType));\n\n$joinTable = filter_var($joinTable, FILTER_SANITIZE_STRING);\n if ($joinType && !in_array ($joinType, $allowedTypes))\n     die ('Wrong JOIN type: '.$joinType);\n\n\n\n$this->_join[$joinType . \" JOIN \" . self::$_prefix . $joinTable] = $joinCondition;\n\nif (!is_object ($joinTable))\n$joinTable = self::$_prefix . filter_var($joinTable, FILTER_SANITIZE_STRING);\n+\n\n$this->_join[] = Array ($joinType,  $joinTable, $joinCondition);\n return $this;\n\n}\n@@ -587,7 +589,7 @@ class MysqliDb\n     $subQuery = $value->getSubQuery ();\n     $this->_bindParams ($subQuery['params']);\n\n\nreturn \" \" . $operator . \" (\" . $subQuery['query'] . \")\";\n\n\nreturn \" \" . $operator . \" (\" . $subQuery['query'] . \") \" . $subQuery['alias'];\n     }\n/**\n@@ -679,8 +681,16 @@ class MysqliDb\n     if (empty ($this->_join))\n         return;\n\n\nforeach ($this->_join as $prop => $value)\n\n$this->_query .= \" \" . $prop . \" on \" . $value;\nforeach ($this->_join as $data) {\nlist ($joinType,  $joinTable, $joinCondition) = $data;\n+\nif (is_object ($joinTable))\n$joinStr = $this->_buildPair (\"\", $joinTable);\nelse\n$joinStr = $joinTable;\n+\n$this->_query .= \" \" . $joinType. \" JOIN \" . $joinStr .\" on \" . $joinCondition;\n\n}\n     }\n/**\n@@ -946,7 +956,8 @@ class MysqliDb\n array_shift ($this->_bindParams);\n $val = Array ('query' => $this->_query,\n\n\n'params' => $this->_bindParams\n'params' => $this->_bindParams,\n'alias' => $this->host\n             );\n     $this->reset();\n     return $val;\n@@ -1031,9 +1042,9 @@ class MysqliDb\n /**\nMethod creates new mysqlidb object for a subquery generation\n  */\npublic static function subQuery()\npublic static function subQuery($subQueryAlias = \"\")\n {\nreturn new MysqliDb();\nreturn new MysqliDb ($subQueryAlias);\n }\n\n/**\n```\n. :) that was the testcase. sorry\n. i will come up with some tests and will commit a patch\n. thats fixed with a proper fix in https://github.com/avbdr/PHP-MySQLi-Database-Class. Should be merged here soon.\n. huh. thank you. Indeed clone() will clone only the main object and will use a references for subqueries.\ncan you please try folowing patch:\n\n\n``` php\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex b15d14f..515a040 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -163,6 +163,9 @@ class MysqliDb\n      */\n     protected function reset()\n     {\n+        if ($this->isSubQuery)\n+            return;\n+\n         $this->_where = array();\n         $this->_join = array();\n         $this->_orderBy = array();\n```\n. thats fixed with a proper fix in https://github.com/avbdr/PHP-MySQLi-Database-Class. Should be merged here soon.\n. fixed in master\n. we should refactor this part of the code somehow to get rid of hardcoded utf8 charset.\n. thats fixed with a proper fix in https://github.com/avbdr/PHP-MySQLi-Database-Class. Should be merged here soon.\n. try to dump your database and check which charset your tables are using. I think they are not UTF8.\nThe purpose of the patch is to allow setting character to NULL in situations like that.\n. I agree with you here, but the goal were to maintain backwards compatibility with old behavoir.\nAt least now there is an api to change encoding for a cases which were 'broken' before.\n. then it gives SELECT * FROM users where lastName <=> 'NULL'. what is wrong. \nthis case is tested in tests.php so i do not think its not working. \nPlease provide a real testcase if possible. \n. getLastQuery () do not return 100% exact the same query as executed. Its written in the documentation. i will try to this case more next days\n. have you solved your issue? \n. should be fixed in master\n. thank you. Merged\n. can you please try following patch?\n``` php\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 2e1c4a5..3ee47a7 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -358,7 +358,7 @@ class MysqliDb\n         if ($this->isSubQuery)\n             return;\n\n$this->_query = \"UPDATE \" . self::$_prefix . $tableName .\" SET \";\n$this->_query = \"UPDATE \" . self::$_prefix . $tableName; $stmt = $this->_buildQuery (null, $tableData);\n $status = $stmt->execute();\n\n@@ -723,7 +723,8 @@ class MysqliDb\n     if ($isInsert !== false) {\n         $this->_query .= '(' . implode(array_keys($tableData), ', ') . ')';\n         $this->_query .= ' VALUES(';\n-        }\n+        } else\n+            $this->_query .= \" SET \";\n foreach ($tableData as $column => $value) {\n     if ($isUpdate !== false)\n\n\n\n```\n. pushed to master\n. dont you mean 'desc' here? \nshow columns for t_users;\nERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'for t_users' at line 1\n. if you are calling 100 phpfiles at the same time that would require 100 mysql connections\nThe only way to fix this issue is to increase max connections limit in mysql itself. There is nothing mysqlidb can do for you to fix that. \n. most likely you need to use rawQuery($sql, false) to disable input filter.\n. sorry, rawQuery($this->sql, null, false);\n. i think then your $this->sql is empty.\n. thats weird. let me see\n. huh mysqli->prepare cant prepare statements with multiple sql commands. \nyou will need to execute them one by one. \nyou can take a look at tests.php how multi insert is implemented there.\n. that would work indeed\n. good idea. Except that I believe something like this will be more readable\n$this->DB->insert ('products_data', [\n                 ['50', 'price', '400'],\n                 ['51', 'price', '401'],\n                 ['52', 'price', '402']\n            ],\n            [\"product_id\", \"data\", \"value\"]\n);\n. Creation of a big insert () () () () statement wont be an optimal solution I believe so we should implement something like this internally:\n1. startTransaction()\n2. prepare a statement\n3. iterate over array of data and execute bind && execute\nAll sounds pretty straightforward except handling of the special cases like db->func(), db->now() values.\n. well, i have tried using different ways and for 100k variables prepared statements are very slow. \nBest difference is 25 secs ws 1sec with rawQuery() of unprepared data.\nseems need to play with large single query more.\n. fixed in master\n. good. I just tagged 2.1 release. Will try to keep this practice.\n. i have a feeling that this is not an issue of a library but in your code somehow. \nTry to reduce your code to a minimum and check it once again.\nI cant imagine a situation where such case can occure.\n. haha, indeed. \nplease try this patch.\n``` php\n$ git diff MysqliDb.php\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex edfa9fd..b23b04b 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -230,6 +230,7 @@ class MysqliDb\n     $stmt->execute();\n     $this->_stmtError = $stmt->error;\n\n\n$this->_lastQuery = $this->replacePlaceHolders ($this->_query, $bindParams);\n         $this->reset(); return $this->_dynamicBindResults($stmt);\n\n```\n. to do it right way, it will be easier to patch _dynamicBindResults function and add $mysqlidb->objectOutput = true flag to determine if you want array or object output.\n\n\nwhile ($stmt->fetch()) {\n            $x = new stdObject;\n            foreach ($row as $key => $val) {\n                $x->$key = $val;\n            }\n            $this->count++;\n            array_push($results, $x);\n        }\nthats a start. then you would want to run tests.php. \n. thats the readme of the alpha i did. Still working on some updates. https://github.com/avbdr/PHP-MySQLi-Database-Class/blob/master/dbObject.md\n. merged in master\n. mysqlidb can return objects now as well. https://github.com/joshcam/PHP-MySQLi-Database-Class#defining-a-return-type\n. thats already fixed. thanks\n. if you were more specific maybe we could suggest you a solution, but I believe solution will be more complex then just fix to the class. \n. timezone question is something that developer need to take care by himself. Store your date in GMT timezone and then during select apply user timezone. \n. Look at the readme ...\n$db->where('time <= DATE_ADD( NOW(), INTERVAL -2 MINUTE )');\n$db->update( 'table', array('status'=> '0') );\nIn your case value used as a string parameter.\n. id say good to go.\n. i think the best way is to do a wrapper class which overwrites an insert(), update(), get() and rawQuery methods. We could create an extra directory in the tree and host stuff like that there.\n. I like the functionality of the patch a lot but can you please do the following:\n1. Get rid of the defines mess on the top. \n2. Rename define name to MYSQLIDBTRACE or SAVEQUERIESSAVEQUERIES. I think first one is better due to its size.\n3. Fix the code style. Right now I see lot of weird indentations and function names with '_' instead of a camelcase.\n4. Add a section to a readme how to use new functionality.\nThank you\n. sounds good. I will land the patch with my adjustments somewhere this week. \nThanks for a patch.\n. if someone have comments on the API leave them here\n. Thank you. Merged with my changes https://github.com/joshcam/PHP-MySQLi-Database-Class/commit/fef36b1df5fbea61612f9c712eb913eaf9e262e6\n. Db->getLastQuery() is what you want\n. print_r($mydb->trace,true)\nactually second parameter is optional. Its used to strip the prefix from the script path in the 3rd array value.\n. as well class supports simple validation and preInsert/preUpdate hook. \nthinking about adding pagination function here as well.\n. you will initialize MysqliDB once, and after that there is no need to carry db credentials around. \nYou can download initial scripts and make your adjustments or paste them here. \nhttps://github.com/avbdr/PHP-MySQLi-Database-Class\n. ``` php\n<?\nrequire_once (\"../MysqliDb.php\");\nclass test extends MysqliDB {\npublic function __construct () {\n    parent::__construct ('localhost', 'root', '', 'akorbi');\n}\n\n}\n$t = new test();\nprint_r ($t->get(\"users\",1));\n?>\n```\n. implemented api sample https://github.com/avbdr/PHP-MySQLi-Database-Class/blob/master/dbObject/test.php\n. initial doc https://github.com/avbdr/PHP-MySQLi-Database-Class/blob/master/dbObject.md\n. because thats how it designed. There is couple issues posted here about this and there is some patches available to make them objects.\nAs for me I do not see any use of returning results as objects except to waste extra memory. \n. great! Can you please add couple lines to a readme and also a test? Apart of this patch looks great\n. commited to master with minor adjustments. thank you.\n. please checkout latest master. I think that should be fixed in https://github.com/joshcam/PHP-MySQLi-Database-Class/commit/6c98f0ea7a570a868f91b3fe57538fc4544a50a1\n. see readme for a get() parameters. $db->get(\"table\",Array($count,$offset))\nlibrary is not doing any background activities. \n. thats exactly how it should work. Can you paste your code? \n. $db->now() is made to use in insert/update queries. \nin where() you can use just a raw condition\n$db->where('add_time <= now()')->get('user');\n. works here. Are you doing lot of sql queueries in some loop?  Maybe something related to https://bugs.mysql.com/bug.php?id=42041?\n. bug is missing test case. closing\n. I doubt that thats the case. Please try to update library from master and recheck the code. Maybe you have where('id', Array('IN' => Array('1,2,3')));\n. there is a case in test, it should be working just fine\n. pretty hard to see where the problem is withou a data and a testcase. \nAs for sql injections library is based on preprated statements so you should be safe if you will not be including data like where(\"a = \". $_GET['q']) or rawQuery (\"select * from test where a = \". $_GET['q']).\n. very unlikely that library would wipe out something byt itself. \nMaybe you hit this https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/229 issue ?\n. Great patch! \n1. What is the use of getLastQueryHeaders()?\n2. Id rename _output var to _returnType with values Array and Object to be consistent with new dbObject.\n3. Can you please update readme and add couple tests into tests/mysqlitests?\nThank you\n. i have implemented return type in a slightly different way to stay consistent with dbObject.\nseems im missing some setter for a default returnType, but will commit it a bit later\n. use where()\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/ \n. i think you are not calling rawQuery with false parameter to disable sanitizing. \ndb->rawQuery (\"select * from foo where bar <= ?\", Array (10), false);\n. thanks for a feedback :) Looks like you are one of the first dbObject users as I have commited this addon couple weeks ago. \n1. use $obj->toJson() or echo $obj to serialize it to json()\n2. Indeed somehow i forgot to test dbObject for prefix functionality. I will try to update master asap.\nThanks. Please keep openning issues in case you will find something.\nAlex\n. please update to a latest master. I have pushed prefix fix for everything except orderBy() method. \n. just pushed that into master. thank you.\n. im not sure where is the problem. If you have multiple rows with id 0 it will return first record. \n. im sorry, I do not understand what do you mean.\n. interesting. Thank you for a bug report. Please try latest master.\n. fixed in master.\n. can you please try latest master please? Should be fixed\n. Thank you. Please update to latest master. I just commited support to replace()\n. i will look into it shortly\n. fixed, thanks for a bugreport\n. thanks. Seems description were copypasted from getOne method. getValue always return a single value of 1 row. Not sure, maybe will be nice to have getColumn() method. \n. commited into master\n. 1. how many rows you are getting in result?\n2. do you have longtext fields in this result?\n3. what php version you are running?\n. Can you please try this patch?\n```\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -786,7 +786,7 @@ class MysqliDb\n     // avoid out of memory bug in php 5.2 and 5.3\n     // https://github.com/joshcam/PHP-MySQLi-Database-Class/pull/119\n\n\nif (version_compare (phpversion(), '5.4', '<'))\n//if (version_compare (phpversion(), '5.4', '<'))\n              $stmt->store_result(); call_user_func_array(array($stmt, 'bind_result'), $parameters);\n\n```\n. If its not much troubles, can you please put longtext field back, and test the following patch? \n\n\n``` php\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 7b3b545..32fddc7 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -769,6 +769,9 @@ class MysqliDb\n     {\n         $parameters = array();\n         $results = array();\n+        // See http://php.net/manual/en/mysqli-result.fetch-fields.php\n+        $mysqlLongType = 252;\n+        $shouldStoreResult = false;\n     $meta = $stmt->result_metadata();\n\n@@ -780,13 +783,17 @@ class MysqliDb\n     $row = array();\n     while ($field = $meta->fetch_field()) {\n\n\nif ($field->type == $mysqlLongType)\n\n$shouldStoreResult = true;\n+\n             $row[$field->name] = null;\n             $parameters[] = & $row[$field->name];\n         }\n\n\n// avoid out of memory bug in php 5.2 and 5.3\n\n// avoid out of memory bug in php 5.2 and 5.3. Mysqli allocates lot of memory for long*\n// and blob* types. So to avoid out of memory issues store_result is used\n         // https://github.com/joshcam/PHP-MySQLi-Database-Class/pull/119\nif (version_compare (phpversion(), '5.4', '<'))\nif ($shouldStoreResult)\n              $stmt->store_result(); call_user_func_array(array($stmt, 'bind_result'), $parameters);\n\n```\n. please try latest master and let us know\n. do you have any errors before this? Also error cant be the same as line 444 points to a different line of code now.\n. Thats what i did.\n\n\n``` php\n$id = $db->insert(\"users\", Array (\n                'login' => 'user10',\n               'customerId' => 10,\n               'firstName' => 'John',\n               'lastName' => 'Doe',\n               'password' => $db->func('SHA1(?)',Array (\"secretpassword+salt\")),\n               'createdAt' => $db->now(),\n               'expires' => $db->now('+1Y'),\n               'loginCount' => $db->inc()\n));\n$db->where(\"id\", $id);\nprint_r ($db->getOne(\"users\"));\n$db->update (\"users\", Array ('login' => 'user11'));\n$db->where(\"id\", $id);\nprint_r ($db->getOne(\"users\"));\n```\nArray\n(\n    [id] => 7\n    [login] => user10\n    [active] => 0\n    [customerId] => 10\n    [firstName] => John\n    [lastName] => Doe\n    [password] => 546f98b24edfdc3b9bbe0d241bd8b29783f71b32\n    [createdAt] => 2015-07-01 12:16:30\n    [expires] => 2016-07-01 12:16:30\n    [loginCount] => 1\n)\nArray\n(\n    [id] => 7\n    [login] => user11\n    [active] => 0\n    [customerId] => 10\n    [firstName] => John\n    [lastName] => Doe\n    [password] => 546f98b24edfdc3b9bbe0d241bd8b29783f71b32\n    [createdAt] => 2015-07-01 12:16:30\n    [expires] => 2016-07-01 12:16:30\n    [loginCount] => 1\n)\n. what php version you are using?\n. how do you initialize mysqlidb() ? \n. Can you run one more time with this patch and send an output of the print_r (). you can hide mysql creds from there :)\n``` php\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 7b3b545..f09bd9f 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -438,6 +438,7 @@ class MysqliDb\n         $this->_query = \"UPDATE \" . self::$prefix . $tableName;\n     $stmt = $this->_buildQuery (null, $tableData);\n\n\nprint_r ($this);\n         $status = $stmt->execute();\n         $this->reset();\n         $this->_stmtError = $stmt->error;\n```\n. have you managed to fix your problem?\n. i will close this because of incomplete test case. Most likely bug were caused because of some additions to vanila mysqlidb code or some extends/overrided constructor\n. use rawQuery($sql,$params,false); \n. its disabling query string filtering. I think this should be a default behavoir soon.\n. can you share some test code which is failing?\n. can you please check following patch:\n\n``` php\ndiff --git a/dbObject.php b/dbObject.php\nindex d2a67f1..1a973d1 100644\n--- a/dbObject.php\n+++ b/dbObject.php\n@@ -109,7 +109,7 @@ class dbObject {\n         if (empty ($this->dbTable))\n             $this->dbTable = get_class ($this);\n\nif ($data)\nif (is_array ($data) && count ($data) > 0)\n             $this->data = $data;\n     }\n\n```\n. your problem is in constructor. you are calling parent::__construct() with $data set to null.\nFix this or remove the __construct () method from your Item class and remove all your modifications from dbObject and it will all work.\n. i have a feeling that you need to use update() instead of insert()?\nwhat sql query do you expect to execute with this piece of code? \n. dup of #248 \n. $this->result = $this->db->rawQuery($this->query, array(30), false);\n. $db->rawQuery($sql, $params, false);\n. are you sure that you are using latest version from master?  I were fixing this recently.\n. yes, there were no major changes\n. new version tagged. Please confirm that your issue could be closed. thanks\n. closing as fixed\n. Use get('tbl',null,\"cola as a, colB as b\").\nAs for second issue please update from master\n. Thank you for a pull request. You patch will be caching results limited to where() conditions of the first get(). As well your patch seems would break multisave feature. Can you work out this moments please and write a documentation for a hasManyThrough as Im not sure what usecase does it have? \n. I have applied your patch, runned tests/dbObjectTests.php, fixed 2 errors and gave up on 3rd.\nrestoration of a cached object is not possible because as all dbObject instances are storing reference to the same MysqliDb instance. so first get() will will reset the conditions. \nif we will be copying MysqlidDb for each new dbObject, that will increase memory use\nand as well will bring new issues which should be resolved.  So the idea of caching is maybe good,\nbut still implementation is not fully finished. \nAs for the multisave:\nforeach ($this->data as $key => &$value) {\n            if ($value instanceof dbObject && $value->isNew == true) {\n                $id = $value->save();\nit iterates over an array of data and if its finding dbObjects \n. if (!is_array ($user->products->get()) || (count ($user->products->get()) != 3)) {\nis it failing. :) first get() will clearout mysqlidb::_where array\n. this is the case why you are not hitting the bug we were talking about. You are get()ing products only once now. \nphp\n-if (!is_array ($user->products) || (count ($user->products) != 3)) {\n+$products = $user->products->get();\n+if (!is_array ($products) || (count ($products) != 3)) {\nas well your change  userId to user also avoiding 1 issue. \nId say we need to add your 'user' case as a new testcase \nas hasOne have 2nd parameter optional and if its not set relation name itself used as a key.\nMysqlidb issue is caused by copy() seems after serialize() or clone its tricky to modify $_mysqli variable. I will take a look on this later. \n. as well I have fixed a typo in preLoad :) thanks\n. Ok. I have fixed a bug and expanded tests to cover your 'user' usecase. \nWith a new fix all tests should be passing as is with the only change for user->products to user->products->get()\n. please try not to commit unrelated things :)\n. im still thinking about the use of this feature. you are not going to cache results but just a set of properties + 1 new $modelName () call per cache. Are you sure that they are so expensive to recreate without caching? \n. but library already have hasOne caching:\nif (isset ($this->data[$name]) && $this->data[$name] instanceof dbObject)\n            return $this->data[$name];\n...\nreturn $this->data[$name] = $obj->byId($this->data[$key]);\nMaybe lets forget about all this mods and will finish implementation of hasMany, hasManyThough and belongsTo?\n. Do you have latest source from master?\n. I agree. Will try to figure out something in couple days\n. oh, i forgot that I already fixed this issue in https://github.com/joshcam/PHP-MySQLi-Database-Class/commit/03e5d76867ac400041926b0e66d858659adfc7cc\nPlease make sure you are using latest master.\n. thats a nice spec :) thank you. I like proposed API. Will try to implement that during the week.\n. looks great except you need to clearout updateColumns and lastInsertId in reset() function.\nCan you please update readme, tests/mysqlidbtests.php and submit a pull request? \nI will commit it as is.\n. looks great. I will review tomorrow and will commit. Thank you for your time.\n. thanks. I have landed you patch and as well removed your copypaste of the insert stuff + fixed a bug you have made in last_insert_id() generation. \nthank you.\n. good point. I will address this later on\n. replace () is for https://dev.mysql.com/doc/refman/5.0/en/replace.html\nyou are looking for db->update(['field' => $db->func('replace(...)')])\n. thank you. fixed.\n. dup of https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/213\n. thanks for a bugreport. Can you please try this patch?\n```\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 74c124e..46215a2 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -1108,14 +1108,14 @@ class MysqliDb\n     protected function refValues($arr)\n     {\n         //Reference is required for PHP 5.3+\n-        if (strnatcmp(phpversion(), '5.3') >= 0) {\n+        //if (strnatcmp(phpversion(), '5.3') >= 0) {\n             $refs = array();\n             foreach ($arr as $key => $value) {\n                 $refs[$key] = & $arr[$key];\n             }\n             return $refs;\n-        }\n-        return $arr;\n+        //}\n+        //return $arr;\n     }\n /**\n\n```\n. fixed in master. Thank you for your bugreport.\n. please update mysqlidb to 2.2 or master\n. patch looks valid except that I would like to add is_numeric() validation as we are removing int cast.Can you fix and send?\nthanks\n. thanks. commited.\n. Guys, issues are not a stackoverflow? \n$db->rawQuery (\"show tables like 'users'\");\nif ($db->count > 0)\n     echo 'exists'\n. please post the code which is storing data into the table. \n. https://dev.mysql.com/doc/refman/5.0/en/charset-column.html\n. then your emoticon is in the wrong encoding. try http://unicodeemoticons.com/\n. Nice patch, thanks.\n1. please add joinOrWhere () method as well to maintain same api as where()/orWhere().\n2. please make a copypasted code from buildWhere() as a separate shared function and reuse them in both places.\n3. Please add couple tests into tests/mysqlidbtests.php and couple lines to readme\n4. Publish change as a pull request, so i will merge it with your name.\nAlex\n. we are fetching results by references. Thats why its not needed to mysqli_stmt_free_result in the most cases. \nIn fact after looking at the code I found that we are not closing prepared statement when not needed.\nI have fixed that in master. Thanks.\n. you can use master. Its always safe to use. I have some more features to implement before release, so it wont happen till next month. \n. are you sure that this code is working? :)\n. its impossible to know that. update returns only number of the rows affected. \nMaybe you interested in onDuplicate() functionality? \nhttps://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html\n. thanks. merged. \n. use rawQuery () to get all the rows. rawQueryValue() is a helper function which returns only first column of the result. \n. i dont think this is caused by the library. Maybe you have magic_quotes_gpc enabled? Or you are calling addslashes or escape() function before insert() somewhere.\n. Set magic quotes to off and retry your test.\nYou are using very old php :)\n. Can you provide a sniplet of code which doesn't work?\n. i see, indeed, syntax here will be slightly diferent. I will work it out later on. \nthanks for a bugreport\n. please try latest master. i have commited a fix\n. Readme is so small\n. Hello,\nCan you try this patch? \n```\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 4d91176..f4ac4fa 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -497,7 +497,7 @@ class MysqliDb\n     {\n         $res = $this->ArrayBuilder()->get ($tableName, $limit, \"{$column} AS retval\");\n\nif (!$res)\nif ($this->count == 0)\n             return null; if (isset($res[0][\"retval\"]) && $limit == 1)\n\n```\n. can you see what is the value of $this->count ?\n. can you do print_r ($res)? \n. and what does raw sql returns in the mysql cli? \n. also how do you call getValue()?\n. ok, let me try to reproduce. weird.\n. thanks. fixed in https://github.com/joshcam/PHP-MySQLi-Database-Class/commit/239730f4796976addbbfdcb7b961bd5009f479f9\n. welcome. :)\n. can you please explain which bug you are fixing?\n. thank you, pushed.\n. mysqlidb do not support insert from select unfortunately. use rawQuery() for this\n. marking as duplicate\n. that should work. what error you are getting? Just in case make sure you are using latest stable version or master.\n. you do 2 separate queries. \n\n\n$db->rawQuery('set @count = ?', 0);\n$db->where ...\n$db->setQueryOptions ('IGNORE')->update ('tab_module', [\n         'uniq_id' => $db->func ('@count + 1')\n]);\n. hm, yes, you seems right, ' := ' seems is the issue\n. oh, sorry, \n$db->rawQuery('set @count = ?', 0);\n$db->where ...\n$db->setQueryOptions ('IGNORE')->update ('tab_module', [\n         'uniq_id' => $db->func ('@count := @count + 1')\n]);\nthat should work.\n. i suggest to sanitize your input by yourself and manually build insert sql query with multiple rows in 1 query. I were trying to reuse statement for this, but binding still makes huge overhead over a single insert.\nif you still want to stick with regular insert (), to significantly save insert time you can do\n$db->startTransaction();\nserie of insert()\n$db->commit();\ntake a look at https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/312\n. if you have time and want to participate feel free to code fast multi insert for the lib :)\n. closing as dup of https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/208\n. i have keep them as is to keep compatibility with MYSQL standart terms. I dont think we want to invent our own keywords.\n. thank you. :) fixed\n. can you please identify which part is failing?\n. I think you havent updated library to the latest master. Please check.\n. Indeed. I will push a fix today. Thanks for a bugrepirt\n. please try this patch\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 84011ad..f3cebd1 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -713,7 +713,7 @@ class MysqliDb\n     {\n         $allowedDirection = Array (\"ASC\", \"DESC\");\n         $orderbyDirection = strtoupper (trim ($orderbyDirection));\n-        $orderByField = preg_replace (\"/[^-a-z0-9\\.\\(\\),_`]+/i\",'', $orderByField);\n+        $orderByField = preg_replace (\"/[^-a-z0-9\\.\\(\\),_`\\*]+/i\",'', $orderByField);\n. ok. fixed in master\n. thanks, merged\n. are you using latest stable/master?\n. thank you, you are correct. fixed in master\n. Use db->escape()\n. yes, most likely $rest_id sometimes gets empty and it updates whole table.\nYou need to upgrade to latest stable or latest master as this issue were fixed a while ago.\n. thank you. merged\n. i dont think its an issue of a library, more looks like your code. seems thats the result you are getting from the database.\n. most likely thats what causing you a problem. your php-mysqli were compiled with way too old mysql-client. maybe thats related. \nalso please try the following patch:\n```\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 0fb936d..0e77ffc 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -969,7 +969,7 @@ class MysqliDb\n         // avoid out of memory bug in php 5.2 and 5.3. Mysqli allocates lot of memory for long\n         // and blob types. So to avoid out of memory issues store_result is used\n         // https://github.com/joshcam/PHP-MySQLi-Database-Class/pull/119\n-        if ($shouldStoreResult)\n+        //if ($shouldStoreResult)\n              $stmt->store_result();\n     call_user_func_array(array($stmt, 'bind_result'), $parameters);\n\n```\n. btw, im using library with php 5.3 on some servers and rawQuery works just fine there. \n. have you found a problem?\n. ill close this one as bug is more related to php configuration on a server side.\n. for example like \nphp\n$db->get (\"users\", null, \"*, group_concat(expr) as groupconcatValue\")\n. closing as not a library bug. as well you might try to workaround by defining precission in field type\nlike add fieldName double (10,2)\n. both bugfixes are commited. As for rawQuerySelect() i dont think we need to implement one more copy of rawQuery().\nIf fetch_all() is faster, then we need to consider reworking main functions to use. Have you made any benchmarks?\nthanks for a pull request. I will close it now, please feel free to open an issue for a performance optimization.\n. More then that, proposed fix as already available in master long time ago.\n. It's even in your patched version :)\n. thank you, fixed\n. $songs =$db->where ('songs', '%test%', 'like')->get();\n. You need to use rawQuery()\n. do the same with a lib :)\nphp\n$db->join(\"categories ca\",\"us.idCategory=ca.idCategory\",\"LEFT\");\n$users = $db->get(\"users us\", null, \"*, us.description as userDescription\");\n. whats that? :)\n. seems documentation needs to be updated.\n$updateColumns could be an array like a regular data array. \nphp\n$updateColumns = array ('revision' => $db->inc())\n. can you please test the following patch:\n``` php\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex e0a3926..f435634 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -1094,7 +1094,14 @@ class MysqliDb\n             if ($this->_lastInsertId)\n                 $this->_query .= $this->_lastInsertId . \"=LAST_INSERT_ID (\".$this->_lastInsertId.\"), \";\n\n$this->_buildDataPairs ($tableData, $this->_updateColumns, false);\nforeach ($this->_updateColumns as $key => $val) {\nif (is_numeric ($key)) {\n$this->_updateColumns[$val] = '';\nunset ($this->_updateColumns[$key]);\n} else\n$tableData[$key] = $val;\n}\n$this->_buildDataPairs ($tableData, array_keys ($this->_updateColumns), false);\n         }\n     }\n```\n. i have pushed a fix to master\n. thank you. merged\n. thank you. sounds good.  i needed such a review as my english is not that great :)\n. you can use $db->join(\"users u\", \"p.tenantID=u.tenantID\", \"LEFT\"); \n. Can you post code sample? I'm not sure what you are taking about\n. if you are talking about dbObject, then you can use $model->join('joinmodel', 'primary_Key')\n. closing as not a bug\n. If this is pull request please clean it up. If it's an issue please create an issue\n. all you need is to read the doc. Search for ObjectBuilder(), JsonBuilder(), map().\n\n$db->objectBuilder()->get('users');\n. i dont understand why its so important. that wont be implemented. \nI still cant understand why its so important. while and foreach works just perfert on arrays.\n. good bugreport. I have added a placeholder function for the pagination but never managed to test it :)\nI have commited fixed version and a readme update to master.\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/blob/master/dbObject.md#pagination\n. paginate() duplicates the get() behavoir. \nprototype is paginate($pageNum, $fieldsList)\nwhere pagenum  is a page number and fieldslist is an optional parament for the list of fields to select.\nlibrary wont generate you a pager, you will need to do it by youself. after paginate() execution product::$totalPages will contain a total amount of pages.\n. user::where('type','admin')->paginate(1) will return you the first page of 20 items. \nto conctrol rows amount per page use user::$pageLimit.\n. paginate is available for dbObject only :) Good catch, i need to move it to mysqlidb. give me couple days to do that. \n. commited to master. thanks\n. i were thinking about that, but not sure if we want to have this extra overhead as pdo is heavier then mysqli.\nfrom another hand, im looking a lot and php 5.5+ 'yeld' feature and more and more thinking to create separate 5.5+ branch. \n. Tommy , would you mind to merge our codebases and participate in the mysqlidb development?\n. thank you, merged. I were not thinking to change couple dies to exceptions as they will occur mostly during development process, but anyway, let it be like that. \n. good job :) Thank you\n. good catch. thank you. commited to master\n. its impossible as you cant build a query without a final get/update/insert(). And there is no 'dry run' in them.\n. In the prepare error you should see where the problem is. As well, in exception you should be able to run getlastquery() just fine.\n. try to update to latest stable/master. \n. i forgot about this one. Will add to a TODO for next release.\n. update will return true even if no rows were affected. You need to check $db->count after update() to check how many rows were affected by an update\n. nice catch but you patch will break an existing api\nwould you mind to work on the patch which will check if JoinCondition starts with 'using' and then do not insert 'on'? \n. thank you, merged\n. you had a typo in your fix. i have fixed and pushed into the master\n. please try the following patch and let me know. This will allow to use same limit array/variable as in get(). ex $db->update ('table', $data, array ($count, $offset))\n``` php\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 00e01f8..22776c3 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -663,7 +663,7 @@ class MysqliDb\n      \n      * @return bool\n      /\n-    public function update($tableName, $tableData)\n+    public function update($tableName, $tableData, $limit = null)\n     {\n         if ($this->isSubQuery) {\n             return;\n@@ -671,7 +671,7 @@ class MysqliDb\n     $this->_query = \"UPDATE \" . self::$prefix . $tableName;\n\n\n$stmt = $this->_buildQuery(null, $tableData);\n$stmt = $this->_buildQuery($limit, $tableData);\n         $status = $stmt->execute();\n         $this->reset();\n         $this->_stmtError = $stmt->error;\n```\n. save this to the file to the directory with Mysqlidb.php\nthen run in linux shell: patch -p1 < file\n\nOn Wed, Nov 25, 2015 at 12:43 AM, scoman81 notifications@github.com wrote:\n\nThanks for the quick reply. To be perfectly honest, I'm the ultimate Git\nnoob, and don't really know how to apply a git patch. I guess I could do it\nby hand but maybe someone else will jump in and try it the right way ...\nwhatever that is!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/367#issuecomment-159414064\n.\n\n\nAlex\n. I have commited a patch to my private repo for you to test. Get a file from\nhttps://github.com/avbdr/PHP-MySQLi-Database-Class/blob/master/MysqliDb.php.\nOn Wed, Nov 25, 2015 at 1:35 AM, Alexander Butenko a.butenka@gmail.com\nwrote:\n\nsave this to the file to the directory with Mysqlidb.php\nthen run in linux shell: patch -p1 < file\nOn Wed, Nov 25, 2015 at 12:43 AM, scoman81 notifications@github.com\nwrote:\n\nThanks for the quick reply. To be perfectly honest, I'm the ultimate Git\nnoob, and don't really know how to apply a git patch. I guess I could do it\nby hand but maybe someone else will jump in and try it the right way ...\nwhatever that is!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/367#issuecomment-159414064\n.\n\n\nAlex\n\n\nAlex\n. yes, update do not support offset. ill update readme. thanks for testing\n. the idea of the library is singleton. I think we just need to workout api with multiple databases.\nFor now, you can overwrite prefix in constructor when you initiating second connection.\n. huh, i think there is a way to make it just protected. :) give me couple days, ill try to work it out.\n. that is used only for a getInstance() function. So you still can create multiple instances if you wont be using getInstance()\n. as I told, you still can create multiple mysqlidb object if you wont be using getInstance().\ngetInstance() is not used inside the library at all.\n. closing as a dup of #373 \n. thank you, merged\n. mysql doesnt support joins over multiple mysql servers.its not an oracle :). sorry, i got confused with multiple servers. No, library doesnt support such type of joins. you would need to use rawquery.. confirmed. ill work on a fix asap\n. please test this patch\n``` php\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex aa099b0..7f89fd9 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -1034,12 +1034,17 @@ class MysqliDb\n     $this->_query = $operation . \" \" . implode(' ', $this->_queryOptions) . \" INTO \" . self::$prefix . $tableName;\n     $stmt = $this->_buildQuery(null, $insertData);\n\n\n$stmt->execute();\n$status = $stmt->execute();\n         $this->_stmtError = $stmt->error;\n$haveOnDuplicate = !empty ($this->_updateColumns);\n         $this->reset();\n         $this->count = $stmt->affected_rows; if ($stmt->affected_rows < 1) {\n\n\n// in case of onDuplicate() usage, if now rows were inserted\nif ($status && $haveOnDuplicate) {\nreturn true;\n}\n         return false;\n     }\n```\n. have you had a chance to try the patch?\n. thanks, ill commit that then\n. i think you are using very old version of mysqlidb. Please update to the latest release and try again.\n. can you submit a code sample with a sample data to reproduce the problem. its quite impossible to have such an issue. \nJust in case can you update to the latest master?\n. call the print_r () on the array you are trying to pass to update() i think your issue is somewhere before an update() \n\n\n\ngetLastQuery() do not return an exact sql which was executed. \n. that should work fine. what values you are getting in *_status fields in the database? \nmysqlidb uses prepared statements to submit query for executing. getLastQuery() fakes the sql output and can be used only for debugging purposes. Im quite sure all ints were submitted as ints.\n. $db->join('project_type pt','p.project_type = pt.id')\n      ->get(\"projects p\",null, \"$needed fields\")\n.  $db->join('t2','t2.id = t1.id','inner')->get(\"t1\",null, Array (\"t1.name as t1_name\", \"t2.name as t2_name\"));\n. confirmed. Thanks. \n. I have fixed this in master\n. Looks like you are using modified version of the library. Please update\nfrom trunk\nOn Dec 19, 2015 3:51 PM, \"Plum\" notifications@github.com wrote:\n\nParse error: syntax error, unexpected T_FUNCTION in\nD:\\www\\webroot\\phpclass\\MysqliDbphp on line 1835\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/381.\n. here on github. update to latest master version\n. oh, i see. Im not sure if library will be working fine on php 5.3. If you want to make sure, you can try to run tests/*php to see if they will pass.\nAs for array_walk, you can comment it out if you do not plan to use prefixes\n. :) if you are running queuries against mysqli() directory, i assume you would pick your results on your own as well.\n\nphp\n        if ($this->mysqli()->more_results()) {\n            $this->mysqli()->next_result();\n        }\n. you would need to do while() i think\n. thank you :+1: \n. it seems that you need to define a primary key in your object. if your\ntable doesnt have one, you need to create it.\nby default primary key name is set to 'id', but you can redefine it\nwith $primaryKey obj variable.\nOn Mon, Dec 21, 2015 at 5:49 PM, Robert \u0160ari\u0107 notifications@github.com\nwrote:\n\nModel:\nclass CustomerProjectModel extends dbObject {\nprotected $dbTable = \"customer_project\";\nprotected $dbFields = Array (\n    'customer_id' => Array ('int', 'required'),\n    'project_id' => Array ('int', 'required')\n    );\n}\nCall:\n$customerProject = CustomerProjectModel::\n  where('project_id', $project_id)->\n  where('customer_id', $customer_id)->\n  getOne();\n// a proper dbObject is shown here with correct data array (of one) and with no errors (see below)\n$id = $customerProject->delete();\n$id is empty and $db->getLastError() returns \"mysqli is null\"\nThis is the $customerProject object:\ncustomerProject=CustomerProjectModel Object\n(\n    [dbTable:protected] => customer_project\n    [dbFields:protected] => Array\n        (\n            [customer_id] => Array\n                (\n                    [0] => int\n                    [1] => required\n                )\n```\n        [project_id] => Array\n            (\n                [0] => int\n                [1] => required\n            )\n)\n\n[db:dbObject:private] => MysqliDb Object\n    (\n        [_mysqli:protected] => mysqli Object\n            (\n                [affected_rows] => -1\n                [client_info] => mysqlnd 5011-dev - 20120503 - $Id: 3c688b6bbc30d36af3ac34fdd4b7b5b787fe5555 $\n                [client_version] => 50011\n                [connect_errno] => 0\n                [connect_error] =>\n                [errno] => 0\n                [error] =>\n                [error_list] => Array\n                    (\n                    )\n            [field_count] => 2\n            [host_info] => localhost via TCP/IP\n            [info] =>\n            [insert_id] => 0\n            [server_info] => 555-1018-MariaDB\n            [server_version] => 50505\n            [stat] => Uptime: 186221  Threads: 3  Questions: 6534  Slow queries: 0  Opens: 8  Flush tables: 1  Open tables: 19  Queries per second avg: 0035\n            [sqlstate] => 00000\n            [protocol_version] => 10\n            [thread_id] => 304\n            [warning_count] => 0\n        )\n\n    [_query:protected] =>\n    [_lastQuery:protected] => SELECT  * FROM customer_project WHERE  project_id = '15'  AND customer_id = '1'  LIMIT 1\n    [_queryOptions:protected] => Array\n        (\n        )\n\n    [_join:protected] => Array\n        (\n        )\n\n    [_where:protected] => Array\n        (\n        )\n\n    [_having:protected] => Array\n        (\n        )\n\n    [_orderBy:protected] => Array\n        (\n        )\n\n    [_groupBy:protected] => Array\n        (\n        )\n\n    [_bindParams:protected] => Array\n        (\n            [0] =>\n        )\n\n    [count] => 1\n    [totalCount] => 0\n    [_stmtError:protected] =>\n    [host:protected] => localhost\n    [username:protected] => x\n    [password:protected] => y\n    [db:protected] => z\n    [port:protected] =>\n    [charset:protected] => utf8\n    [isSubQuery:protected] =>\n    [_lastInsertId:protected] =>\n    [_updateColumns:protected] =>\n    [returnType] => array\n    [_nestJoin:protected] =>\n    [_tableName:MysqliDb:private] =>\n    [_forUpdate:protected] =>\n    [_lockInShareMode:protected] =>\n    [_mapKey:protected] =>\n    [traceStartQ:protected] =>\n    [traceEnabled:protected] =>\n    [traceStripPrefix:protected] =>\n    [trace] => Array\n        (\n        )\n\n    [pageLimit] => 20\n    [totalPages] => 0\n)\n\n[data] => Array\n    (\n        [customer_id] => 1\n        [project_id] => 15\n    )\n[isNew] =>\n[returnType] => Object\n[_with:dbObject:private] => Array\n    (\n    )\n[errors] =>\n[primaryKey:protected] => id\n```\n)\n(possibly something to do with \"id\" being always set as implicity PK?)\nYet, when I execute this:\n$this->db->where('project_id', $project_id)->where('customer_id', $customer_id);\n$id = $this->db->delete('customer_project');\nit works as expected!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/387.\n\n\nAlex\n. alter table customer_project add customer_project_id INT(9) UNSIGNED PRIMARY KEY AUTO_INCREMENT\nand your primary key will be customer_project_id\n. from what i know there is no such thing as a 'several columns as PK' but yes, library do not support that. More then that its a bad practice to have tables without an unique id field. \nIn your case what you need to do is to overwrite delete() method in your CustomerProjectModel and call mysqli->delete with a custom where() conditions. \n. thats very strange. can you please make a simple testcase for me to reproduce the problem? \ni have pretty much the same testcase in tests/mysqliDbTests.php and its passsing just fine.\n. you are right. I can reproduce this one. Can you please try the following patch?\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex f64c00a..2b2d660 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -1731,7 +1731,7 @@ class MysqliDb\n     public function copy()\n     {\n         $copy = unserialize(serialize($this));\n-        $copy->_mysqli = $this->_mysqli;\n+        $copy->_mysqli = null;\n         return $copy;\n     }\n. fixed in master. thank you.\n. thank you for a bugreport. can you please fix style issue and file a pull request? \n. do you have __construct() in your myobject? \nas well, after save() isNew will be set to false. \n. and $myObject->errors is empty? \n. also check if you have error_reporting set to E_ALL to see if you are getting any errors. \n. yes, i were able to reproduce an error. Will come up with a fix shortly\n. ok, pushed a fix to master. thank you\n. thank you, merged\n. use escape() method from the library.\n. get and byId always will return null if nothing were found. \nif ($user)\n     // exists\nelse\n   // not exist\n. nice. have you tried to run test/dbObjectTests.php? \n. you understood everything correctly. Sounds like you hit a bug here.\n. merged with a typo fix :)\n. thanks for a patch. can you please add a test case for this issue? . I think its a php magic quotes. You can disable that in php.ini\n. null should work\n. \u044d\u0442\u043e \u0443\u0436\u0435 \u0434\u0430\u0432\u043d\u043e \u0438\u0437\u0432\u0435\u0441\u043d\u043e. \u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u0432 \u0442\u043e\u043c, \u0447\u0442\u043e \u043f\u043e\u0434\u0433\u043e\u0442\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c\u044b\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0441\u0430\u043c\u0438 \u043f\u043e \u0441\u0435\u0431\u0435 \u043e\u0442\u043b\u0438\u0447\u043d\u043e \u043f\u0440\u0435\u0434\u043e\u0442\u0432\u0440\u0430\u0449\u0430\u044e\u0442 sqli \u0438\u043d\u044c\u0435\u043a\u0446\u0438\u0438, \u043a\u043e\u0433\u0434\u0430 \u0432 \u0432\u0430\u0448\u0435\u043c \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0435 \u0431\u0443\u0434\u0435\u0442 \u043d\u0443\u0436\u043d\u043e \u0437\u0430\u0431\u043e\u0442\u0438\u0442\u0441\u044f \u043e\u0431 \u044d\u0442\u043e\u043c \u0441\u0430\u043c\u043e\u043c\u0443. \n. real_escape_string \u043d\u0435 \u0438\u0437\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u043e\u0442 sql injection \u043d\u0430 100% \u0431\u0435\u0437 \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438 \u0432\u0432\u043e\u0434\u0430 \u0434\u0430\u043d\u043d\u044b\u0445, \u0443\u0432\u044b.\n. $db->orderBy(\"RAND()\", \"ASC\");\n. \u0445\u043e\u0440\u043e\u0448\u0438\u0439 \u0432\u043e\u043f\u0440\u043e\u0441. \u043f\u043e-\u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0431\u0443\u0434\u0435\u0442 DESC. \u0434\u043b\u044f RAND() \u0445\u043e\u0440\u043e\u0448\u043e \u0431\u044b\u043b\u043e \u0431\u044b \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0431\u0435\u0437 \u043d\u0438\u0447\u0435\u0433\u043e.\n. \u044f \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u044e \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0443. \u041d\u043e\u0432\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f \u0434\u043e\u043b\u0436\u043d\u0430 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0442\u0430\u043a \u0436\u0435, \u043a\u0430\u043a \u0438 \u0441\u0442\u0430\u0440\u0430\u044f. \n. \u0435\u0441\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044f paginate() \u0434\u043b\u044f \u043f\u043e\u0441\u0442\u0440\u0430\u043d\u0438\u0447\u043d\u043e\u0433\u043e \u0432\u044b\u0431\u043e\u0440\u0430 \u0434\u0430\u043d\u043d\u044b\u0445. \u0430 \u0432 \u0433\u0443\u0438 \u043f\u0435\u0439\u0434\u0436\u0435\u0440 \u043d\u0443\u0436\u043d\u043e \u0431\u0443\u0434\u0435\u0442 \u0441\u0430\u043c\u043e\u043c\u0443 \u0440\u0438\u0441\u043e\u0432\u0430\u0442\u044c\n. with prepared statements such injections wont work.\n. i think you are missing $db = MysqliDb::getInstance() to get an initialized mysqlidb object inside your class\n. also i think you might want to take a look on a dbObject class as seems that what you are trying to do :)\n. thanks, fixed\n. you are right. I just pushed changes to the master. thank you for a bugreport\n. is it what you are looking for?\nphp\n$maxId = $db->getValue(\"users\", \"max(id)\")\n//select max(id) from users limit 1\nphp\n$maxIds = $db->orderBy(\"id\", 'desc')->getValue(\"users\", \"id\", 6) \n///select max(id) from users order by id desc limit 6\n. im sorry, i do not understand you at all. \n. $user = $db->ObjectBuilder()->where('id', 1)->getOne('users');\necho $user->username;\n. do you use utf8?\n. 1. mysqlidb sets db charset to utf8.\n2. you need to check what charset your tables are using\n3. you need to check what input charset is used in your HTML.\n   to avoid problems just set utf-8 everywhere.\nill close that as not a bug.\n. i think one of your bind params is an array. thats why you are getting this error\n. please post a testcase to reproduce it\n. do you have a mysqlidb from master?  that were fixed recently\n. you can use master as im about to release new version. \n. thank you\n. please try the latest master. I think this issue is fixed in one of the previous  releases\n. guys, how do you initialize mysqlidb?\nOn Wed, Jan 27, 2016 at 10:30 PM, pieczarkazsolt notifications@github.com\nwrote:\n\nI get same error, when I use copy() method (in ver2.5)\n$db->where('T.delete', null, '<=>');\n$dataQuery = $db->copy()\n$sum = $db->getValue('test T', 'count(T.test_id)');\n$testData = $dataQuery->withTotalCount()->where('T.date', null,\n'<=>')->get('test T', array($_POST['start'], $_POST['length']), 'T.test_id,\nT.test_desc);\nIn this case $testData is: PHP Warning: mysqli::close(): Couldn't fetch\nmysqli....\n(same code works fine in ver2.2)\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/422#issuecomment-175811763\n.\n\n\nAlex\n. should be working now. long overdue, but seems thats not a problem for a recent mysqlibd. hello,\nCurrently its impossible to do so. The only way is to extend mysqlidb class and wrap update and delete methods with if (count ($this->_where)) check. \nThats a nice observation, maybe it make sense to make some kind of an api to implement this check.\nIf you have any ideas, feel free to propose. Ill take couple days to come up with something. \nmaybe something like $db->unboundedUpdates(false)->delete() or a global mysqlidb property.\n. were you reading readme? \n```\norder by values example:\n$db->orderBy('userGroup', 'ASC', array('superuser', 'admin', 'users'));\n$db->get('users');\n// Gives: SELECT * FROM users ORDER BY FIELD (userGroup, 'superuser', 'admin', 'users') ASC;\n```\n. Try a version from master. I think you are using an old version\nOn Jan 21, 2016 20:33, \"Toyz\" notifications@github.com wrote:\n\nTried that, it uses a directory and with my query your losing the keep\norder with perserving the values\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/426#issuecomment-173646182\n.\n. We can fix an actual problem if you will report it precisely.\nCan you please show an actual code, what you are expecting to get and what\nyou are actually getting.\nOn Jan 21, 2016 20:53, \"Toyz\" notifications@github.com wrote:\nFixed by using rawQuery\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/426#issuecomment-173652861\n.\n. can you please file a pull request with this fix? ill merge that.\n\nOn Thu, Jan 21, 2016 at 10:16 PM, thingNumber1 notifications@github.com\nwrote:\n\nIf usefull for someone, that how to solve the problem:\nFIND (line 1096 in my file, in function _buildDataPairs):\nif (!$isInsert) {\n    $this->_query .= \"\" . $column . \" = \";\n}\nREPLACE IT FOR:\nif (!$isInsert) {\n    if(strpos($column,'.')===false){\n        $this->_query .= \"\" . $column . \" = \";\n    }else{\n        $this->_query .= str_replace('.','.',$column) . \" = \";\n    }\n}\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/427#issuecomment-173678566\n.\n\n\nAlex\n. pushed to master. thanks\n. this is not a helpdesk. please stop posting newbish questions. \nlook the sources of https://github.com/joshcam/PHP-MySQLi-Database-Class/blob/master/index.php\n. > I know it's good practise to close the connection but maybe it should be removed from the library\nIm not sure about the usecase you are having. \nmysql connection getting closed only on __destruct. Meaning when you destroying mysqlidb object. \nIf you are doing close() after every sql query, this is no a best practices + this is slowing down your code. \nIf you have a long running script, calling close() after sql query shouldnt cause any issues at least with latest mysqlidb version. Im using this for a long time and do not saw any problems\n. fixed. thanks, ill work this out\n. can you make sure that tests are passing and submit a pull request?\n. closing as a duplicate\n. why dont use use mysql data formatting capabilities? \n. too bad. seems we need to add some helper functions for that that will be using using query() instead of the prepared statements.. fixes in latest release\n. import feature was added in master. no export feature yet\n. added. fixed\n. hmm, what is the usecase of that? \n. sorry, took me long to reply. \nPatch is for rawQuery() but your example is using insert() :) Still cant get it.\n. ill close that as it doesnt looks like a bug \n. i dont think you need getLastQuery() \n$data = [\n        \"col1\" => $db->subQuery()->getOne(\"table1\", null, \"col1 as a\"),\n        \"col2\" => $db->subQuery()->getOne(\"table1\", null, \"col2 as b\"),\n    ];\n$id = $db->insert(\"table2\", $data);\n. what error you are actually getting?\n. thats fixed in a latest release 2.6. Thank you for your report. \n. can you please provide a code sample?\n. library is already in use by lot of peoples, so hard to change old defaults. sorry\n. thats not a paid support :)\n. thats in todo  for next version\n. we finally came to that. should be landed shortly. landed in master . $db->get('users',null,'distinct login');\n. seems your database data is not in utf8. check this, convert and then retry.\n. there is a readme secion for this\n. yes, that will work, no need to use rawquery\n. raw where condition would help\n$db->where('MATCH(detay,adi) AGAINST('tags' IN BOOLEAN MODE)');\n. closing as a dup\n. you need to call     $db->where('kat', $a, 'IN'); \n. I think the problem is somewhere in your code. library is not transforming an output in any ways\n. thank you very much\n. thank you for your contribution. Patch looks very hovewer there are bunch of problems:\n1. You have introduced new functionality but havent updated a readme examples on how to use them. \n2. Patch is incompatible with old php because of [] vs array() usage.\n3. Patch is incompatible with an ArrayBuilder/ObjectBuilder/JsonBuilder() modifiers\n4. Im not sure if you need callFunction() as you still can use get(\"function(args)\")\n5. you are missing new tests for a new functionality\nCan you please fix this issues and I will be glad to merge it.\n. can you provide a minimal piece of code which throws such an error? \n. use vanilla mysqlidb from the repo or fix your own changes by yourself :)\nOn Wed, Sep 5, 2018 at 7:32 PM JacsonRitzmann notifications@github.com\nwrote:\n\nI'm getting an error while trying to query a die.\nCatchable fatal error: Argument 1 passed to\nWMS\\Db\\MysqliDb::_dynamicBindResults() must be an instance of\nWMS\\Db\\mysqli_stmt, instance of mysqli_stmt given, called in\n.../mvc/vendor/WMS/Db/MysqliDb.php on line 677 and defined in\n.../mvc/vendor/WMS/Db/MysqliDb.php on line 1519\npublic function __construct(\\mysqli $db)\n{\n    $this->db = new MysqliDb ($db);\n    //$this->db = $db;\n}\npublic function listaTodos()\n{\n    /\n    $query = \"SELECT * FROM members \";\n    return $this->db->query($query);\n    /\n    $res = $this->db->get('members');\n    return $res;\n}\nThe commented code is ok.\nIf you can give me a hand, I thank you ...\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/ThingEngineer/PHP-MySQLi-Database-Class/issues/460#issuecomment-418914403,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ADIl8mQeHWnw8SiDkCltlESy-1i9J8qGks5uYF8QgaJpZM4H5e8J\n.\n\n\n-- \nAlex\n. $db->where(\"z\"...) -> where(\"(x = ? or x = ? or y = ?) ....\n. nop. I think you are using very old mysqlidb version. please try to update \n. you are not passing enought parameters.\n. can you please update readme as well? thank you\n. as well, I noticed you are not cleaning up errno variable in reset() function. Its getting called after each query execution to remove all the data\n. sorry, my bad, this variables shouldnt be reset :) as you are using them after execution\nfine. ill land this as is\n. everything what does library goes via prepared statements. \n. stored procedures support is already implemented. \nId say we could implement nonmysql connections via pdo but I would double that budget for this. \nOn unrelated to moneys question, i pretty much sure that mysql->mssql switch wont be seamless as ms sql have lot of differences. \n. please add me on skype smarttechdo\n. budget for this project would be 1000$\n. huh?\n. have you tried to lower your buffer value to a lower, say 100-200?\n. thank you, merged\n. Hello,\nI still cant decide how to do that right. https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/208\n. closing as dup\n. you don't need to get another connection. start the transaction, loop inserts via rawquery(), commit()\nthats all\n. fixed in master\n. i think float is already supported. \n. can I see a code which is causing such an error? thanks\n. Well, I can figure out what library code is generating a warning. What i were asking is a test case which I can use to reproduce this problem. \nThanks\n. not a bug\n. this code is pretty basic, i dont think it will cause any problems.\nI believe issue is related to a $db->where() calls somewhere outside of the shown examples.\n. i believe you, but I need a real testcase to fix a problem. In 99% of such bugs issue usually is on the upper level. \n. im sorry but im not a free troubleshooter. \n. do you subclass mysqlidb somehow? I think it's related to construct overload\n. do you have mysqli php extension installed?\n. can you post an exact code which is not working?\nOn Jun 28, 2016 13:46, \"und3rsc0re\" notifications@github.com wrote:\n\n@arieffikhrie https://github.com/arieffikhrie Now I'm getting this\nerror:\nNotice: Undefined property: MysqliDb::$error in\nF:\\xampp\\htdocs\\includes\\mysql\\MysqliDb.php on line 1599\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/493#issuecomment-229015251,\nor mute the thread\nhttps://github.com/notifications/unsubscribe/ADIl8jZju258lvgYFokcX8d8IFPmIKjuks5qQPudgaJpZM4I_mpw\n.\n. your code shouldnt produce anything. because it's just a mysqlidb object. \n$db = mysqlidb(...);\nprint_r($db->get('sometbl');\n. not a bug\n. very nice patch. Thank you. Ill send me code comments a  bit later for you to adjust and we are ready to land\n. Sorry, it took me longer :) Patch looks great except couple issues:\n1. default settings validation: You can create an array of default values and then do an array_merge with settings passed into the function.\n2. revert if(file_exists($importFile))  to an early return to streamline the code. \n\nif (!file_exists) {\n     throw exception\n     return\n}\n1. \nif($result) {\n                $success = true;\n            }\n            // Something went wrong\n            else {\n                $success = false; \n            }\nthis is the same as return (bool)$result;\n1. rename loadXML -> loadXml  for a naming consistency.\n. as well i think it doesnt make sense to add escapeQuery parameter as most of escaped sql queries will fail. You need to escape variables, not SQL query itself. \nSo you can remove that.\n. thank you, merged\n. all get_() functions returning a value, not a mysqlidb object. \nso you use it always like db->where->where...->orderBy->get_ \n. not a bug\n. you need to use preg_replace to remove end of lines\n. you dont need to escape the data as prepared statements do that for you. \nbut you for sure need to cleanup you data to a real view you want to get. \nSQL escaping has nothing to do with EOLs\n. read about what are prepared statements\n. i think its a problem with php float precission . What does regular mysqli/pdo call returns you?\n. have you sort it out?\n. interesting. have you tried latest stable version?\n. will try to fix this during next week. sorry for a delay\n. not a bg\n. I like an idea, but can you add numbers to the rest of exceptions?\n. nice, thank you\n. can you please update readme as well? :)\n. sure, go ahead. Ill glad to merge. We can call that method multiInsert or insertMulti(). We can optimize that later, but initial performance is not that bad when using transactions \n. fixed in master\n. if you are not doing all inserts in 1 transaction then most likely Richards work will be faster\n. getLastError() returns a string, while new getLastErrNo() returns mysqli error code \nOriginal version looks good to me \n. Looks good, but can you please remove all spacing related changes please? \n. as well, please make function smaller by remove double \\n\n. one more observation. insertMulti() will never return false. Seems after rollback you would need to return false. As well, Please check if getLastError and getLastErrId() are returning errors from an actual failed insert() and not from rollback()\n. you are correct, sorry\n. awesome. As for whitespaces, you could just do git checkout and paste back needed code :)\n. read about try() and catch() and header ()\nOn Jul 22, 2016 13:57, \"riples\" notifications@github.com wrote:\n\nHi Richard, where would I need to insert this code exactly in order to\ncontrol status codes?\nThe INSERT command is bombing the code before it has a chance to execute\nanything further.\nOn Fri, Jul 22, 2016 at 6:19 PM, Richard Weinhold \nnotifications@github.com\nwrote:\n\nthat is probably, because the MysqliDB Library doesn't overrides the\nhttp-headers. The http-status code can be set through:\n$returnCode = 500; // server-side-errorhttp_response_code($returnCode);\n...if you need to. It's completely up to you.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\n<\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/505#issuecomment-234489354\n,\nor mute the thread\n<\nhttps://github.com/notifications/unsubscribe-auth/AP_8OedTufZYc2gzBYCVp9pYrBDOU1N7ks5qYIQtgaJpZM4JSgma\n.\n\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/505#issuecomment-234515521,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ADIl8i9PPf-n89zOaLXQF9QqsEERYWlcks5qYKIGgaJpZM4JSgma\n.\n. you are not reading readme. Please read about getLastQuery()\n. this is not possible. thank you, merged.\n. this was already fixed yesterday. please try latest master\n. dup https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/447. what problem you are trying to solve?\n. can you please try latest stable release?\n. is this working?\n\n$db->where('lat is NULL');\n$results = $db->get('my_table');\n. you can also use:\n$db->where (\"lat\", NULL, '<=>');\nprevious sniplet works as a just raw where condition.\n. i think it is already in documentation :). read the readme file finally \n. you cant use now() in select(). its intended to be used in insert() or update(). \n$db->where (\"(date = ? or date = NOW())\", Array('2016-09-13'));\n$db->where (\"login\",\"mike\")\n$res = $db->get (\"users\");\n. why preg_replace will be a problem here?\n. mysqli treats as a placeholders for values. You need to pass this variables as a bind variable and you will be fine. I don't think you need utf8mb. pound sign should just work in basic utf8\nOn Sep 27, 2016 1:21 PM, \"satchboy\" notifications@github.com wrote:\n\nThanks for the comprehensive answer, it was a combination of all 3 :)\nSolution was ::\n1) Switch full database/tables/column names to utf8mb4\n2) Ensure meta charset is served properly\nThese two steps sorted out the \u00a3 sign being stored and retrieved correctly\nin the database, but then it broke the display of the \u00a3 sign in the html on\nthe page itself.\nThe final bit of the puzzle which you identified :\n3)check the encoding of the .php pages. I use Netbeans, and I couldnt see\nan encoding option. Opened in Notepad++ and the file was encoded in ANSI.\nSwitched to \"Encode in UTF8 without BOM\" and the \u00a3 sign that 'was' there\nchanged to a black square with \"xA3\" inside it. Deleted that, typed the \u00a3\nsign again, saved and uploaded and its perfect.\nMany thanks @ricwein https://github.com/ricwein and hope this helps\nsomebody in the future.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/529#issuecomment-249825607,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ADIl8mMGFgBMyYAqtT1rr2BGzbJroBW_ks5quO40gaJpZM4KGs0K\n.\n. $db->get('tableName',null, \"sum(IF(bill_type in ('sales','purchsasesReturns'),money,0)) as field1, sum(IF(bill_type in ('salesReturns','purchsases'),money,0)) as field2\")\n. fixed, thanks\n. i think one of you variable are empty as it this function should just work \n. what you are expecting to get there? Insert wont return you any data. Im not 100% sure, but i think rawQuery on insert will return you false in case insert will fail and empty array in case of success. \n\nas well looking at affected array you can see that 1 row were successfully processed. \n. in this case seems you would need to call one more call.\n$id = rawQueryValue('select LAST_INSERT_ID() limit 1');\n. you can use ping() to check that\n. rawQuery()  works on his own unfortunately, you cant use helper functions togeather with a rawquery.\nyou might try query().\n. prepared statements doesnt support multiple queries at the same time unfortunately.\n. rtfm\n. library throws an exception on any error.. read the doc\n. there is no such method because you cant read.\n. troubleshooting of someone else code is 250$/hour\n. $conn->rawQueryOne('select itemscount from payments where id=? limit 1', [$id]);. thanks, merged\n. can you please work out a pull request for that?. fixed. thanks. if you want id to autoincrement, you would need to declare it like that in the table and do not pass it in the $data array. VeNoMouS is right. thanks. $cities = cities::get();\nforeach ($cities as $city)\n       echo $city->name;. get() returns an array of objects. You do not need to create anything.. oh, sorry, I got it. i think you might try to use map() function, but i  think you will get an array in the end.. why dont you just create a Location dbobject and wont cal Location:get() ? :). this is how its designed to be. There is no plans to make get() to return arrayobject or spl or something like that. array work pretty good and self sufficient.. it's like we are spending on different languages.\n\nBut get() returns an array of data, not a list/array of location objects\n\nyou are wrong. get() returns an array of objects like getOne() returns. \neach object have $data element inside which is yes, is array, but you can get its properties as a variable without successing array.  as I showed you in foreach example. you can access locations{0}->id. do you have latest dbobject? I remember library had an issue with that in the past. \nYou code looks good. Try to make a test on a small test case. I think this exception is coming from somewhere else.. sorry, i just noticed\n$this->db = MysqliDb::getInstance();\nyou need to use parent::__construct.... can you provide a code to reproduce that? . yes, i see the problem __callStatic is not getting called for some reasons. Ill investigate that later . thats was landed in master awhile ago . have you checked if tests are passing?. its not a mess, you need to create database and then run mysqliDbTests.php and after dbObjectTests.php. both test scripts should return 'All done'. All done\nMemory usage: 879040\navb@ds:~/work/PHP-MySQLi-Database-Class/tests$ php mysqliDbTests.php ^C\navb@ds:~/work/PHP-MySQLi-Database-Class/tests$ php dbObjectTests.php \nAll done. i have applied you patch and executed tests. seems working :) Thanks. duplicate of #657 . what is that? . thanks. fixed. $db->rawQuery(\"SELECT id, start ,end ,title FROM ad_calendar_event where (date(start) >= ? AND date(start) <= ?)\", array($_GET[\"start\"], $_GET[\"end\"]));. this is correct. . are you using some function calls before this call?. or maybe stored procedures. i dont think this is possible. what are you trying to solve here?. fixed in master, thanks. thank you. can you please provide me a test case? \nyou can initialize mysqlidb from mysqli object and it should work just fine.\n$mysqli = new mysqli ('host', 'username', 'password', 'databaseName');\n$db = new MysqliDb ($mysqli);. duplicate https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/422. thats a good pull request. Can you please add new feature description in a readme? . i do not think this is a case. function should work in any case. can you please clarify which warnings you are fixing? \nI have executed tests/* files under 7.0.14 and do not see any warnings. i have E_ALL set :). it is already supported. this is a bugtrack not a stack overflow. . i think we can do that with a subqueries. \n$q1 = $db->subQuery();\n$q1->get (\"users\");\n$q2 = $db->subQuery();\n$q2->get (\"clients\");\n$res = $db->union([$q1, $2]') ->orderBy('common_field')->get();\n$res = $db->unionAll([$q1, $2]') ->orderBy('common_field')->get();. patch contains load of unrelated changes. can you please clean it up? . as well new methods missing tests and readme update. new patch just landed. thank you!. thank you!. this patch will break api for those who is using charset parameter.\nif (is_object($host)) {\n            $this->_mysqli = $host;\n        } else {\n            $this->host = $host;\n        }\nwhy dont you improve this code and handing of sockets here? \nif(mysqli) \n     handle_mysqli\nelse if (socket)\nelse\n    rest. merged. thank you!. install php-xml extension. duplicate of #526. :) i were working on this yesterday. Pushed to the master just right now. @Saim1, im using this disconnect() method on a project where script runs all the time and doing asyncronous tasks. Works as expected for quite a long time.  . im using $db->disconnect() that i just commited to master. see https://github.com/joshcam/PHP-MySQLi-Database-Class/commit/90f26fb2ef7ac9b894dff03b75d98ee30e069395. truncate is quite  basic function. why would you want to wrap it into some function? \nrawQuery () should work fine. what is the problem with calling rawQuery()? mysql have couple thousand\nfunctions, it doesnt make sense to wrap them all into separate functions.\nThe idea of the library is not to wrap everything into php functions, but\nto provider easier api for a complex sql queries.\nOn Sun, May 14, 2017 at 9:40 PM, VeNoMouS notifications@github.com wrote:\n\n@avbdr https://github.com/avbdr is that a question pos'd at me? there\nis no function for it, so you can only call it inside rawQuery()\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/609#issuecomment-301356645,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ADIl8gnmOgkRgjP2fwq_I43HOjAa_ppNks5r56z9gaJpZM4MxCy_\n.\n\n\n-- \nAlex\n. read readme about getLastQuery. After get() your where condition is getting automatically cleared out.\nYou need to set it again after get() before an update()\nOn Apr 15, 2017 7:57 AM, \"manhag\" notifications@github.com wrote:\n\nwhen i am trying to update specific record\nit updates all records\n$con = new mysqli('localhost', 'USER', 'PASSWORD', 'DB');\nmysqli_set_charset($con,\"utf8\");\n$db = new MysqliDb ($con);  \n $id = rand(0,100);\n $data = Array (\n  'access' => 'city'.$id,\n    'UserID'=>  $id ,\n  'data' => 'get'.$id);\n$db->where ('id', $id );\n$users = $db->withTotalCount()->get('BOT_Sessions');\n echo $db->getLastError();\nif ($db->totalCount > 0){       \n    $db->update ('BOT_Sessions', $data);\n}else{\n        $db->insert ('BOT_Sessions', $data);\n}\ntable design\nCREATE TABLE IF NOT EXISTS BOT_Sessions (\n  id int(10) NOT NULL AUTO_INCREMENT,\n  UserID varchar(150) CHARACTER SET utf8 NOT NULL,\n  access varchar(150) COLLATE utf8_unicode_ci NOT NULL,\n  data text COLLATE utf8_unicode_ci NOT NULL,\n  PRIMARY KEY (id),\n  UNIQUE KEY id (id)\n) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=78 ;\n[image: image]\nhttps://cloud.githubusercontent.com/assets/5571625/25063399/5e5d58f8-21e3-11e7-9a84-4529dd24429a.png\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/612, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ADIl8gbWt1Wo1ew2CPmjhOmL16oY_3ymks5rwLDGgaJpZM4M-VGc\n.\n. in my tests i never saw SQL_CALC_FOUND_ROWS performing worse then count(*). \nbut you can make your benchmarks for your case and decide which way works better for you. \n . yes, i think you did. As I remember the  big difference were happening with mysql earlier then 4.5 or something like that.. its a db wrapper only. can you please submit a pull request? . thank you\n. i agree. can you please submit a pull request? . pushed thanks. thanks for a finding. can you please submit a pull request with added testcase into tests/ file? . fixed thanks. this should work. I'm using same thing in tests/ files.\n\nOn May 27, 2017 11:15 AM, \"Bryan Lusica\" notifications@github.com wrote:\n\nI wanted to do query like this\n$query = \"CREATE TABLE IF NOT EXISTS \" . TABLE_PREFIX . \"settings (\nID bigint(20) NOT NULL AUTO_INCREMENT,\nmeta_key varchar(255) COLLATE utf8_unicode_ci NOT NULL,\nmeta_value varchar(255) COLLATE utf8_unicode_ci NULL,\nPRIMARY KEY (ID)\n) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;\";\n$db->rawQuery($query);\nI wonder if that's possible? Thanks.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/625#issuecomment-304458250,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ADIl8pMbw83rxwkqrKJSJ6kC3P67huFqks5r-D4EgaJpZM4NoYFW\n.\n. thanks for your finding. can you please submit a pull request with added testcase into tests/ file?. merged, thank you. thanks, merged. thanks, fixed. thank you!. disconnect() is not a static method. as well, seems you are using an old version of the library. this should work\n$data = Array(\n'column1' => $db->func('column2 * something')\n);. please remove unrelated changes from the patch and we can land it. please review 'git diff' before comiting. patch still have same problem . :) damn, now it is breaking api. before your update default was SELECT b JOIN a, while now we will have SELECT b NATURAL JOIN a\n. what is the problem? . it works just fine with a vew. do a simple test.php with print_r (get(\"myview\")); and then go back to your original code and search for a bug. what php and mysql version you are using?. pagination functionality is not possible with rawQuery.\nsee for a code how to do it https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/518. Thank you! Merged. are you using latest stable release? I think thats quite an old issue. thanks. fixed comments in master. yes, please create a pull request with updated readme and will merge that. after some further thoughts I really do not see any use of this wrappers. Usually this agregate functions are used in conjunction with some other values and its not that. \nPlus their usage is not very different from $this->getValue($tableName, \"MIN({$fieldName})\");. What is the question?. Lo dudo que tiene raz\u00f3n que subir versi\u00f3n m\u00ednima. Hay varios usuarios de la librer\u00eda con PHP viejo. \nYo utilizo la librer\u00eda con varios versi\u00f3n de PHP tambi\u00e9n.. i dont think that we want to add extra dependencies to this library. users love it for its small and monolitic nature . thanks for a bugreport.\nJSON_UNESCAPED_UNICODE (integer)\n  Encode multibyte Unicode characters literally (default is to escape as \\uXXXX). Available since PHP 5.4.0. \n\nCan you please check what type of unicode characters are causing you this problem? \nIm not sure what kinds of behavior change this will bring but im indeed interested in fixing this issue  . after some brainstorming and coversations with developers, I think the best way to approach that is to introduce object settings jsonOptions, so if needed, options could be easily passed to the json_encode()\nadding JSON_UNESCAPED_UNICODE as a default can break some usecases like json embedditing into html page.     . i doubt that we can do anything with this issue. you patch is not based on master.  . :) ok. ill do it myself. merged. thanks. can you please update readme?. thank you!. adm support is 200$ per hour. thank you!. db->where ('date(createdAt) = CURDATE()');\nis that what you want?. if (!$db->ping()). It is useless to implement such a feature because it is impossible to provide a proper SQL query as we are using mysqli bindings. And having that will allow us to construct 'more or less close' version of a query but not more than that.. thank you !. thank you. :) can you please rebase? . :) sorry, can you please rebase again? :). you have a problem with your require string. maybe case sensivity issue. thank you! I have fixed that by myself as I decided to remove a goto :) . thank you!. please pull latest master :). Yes, and the fix is in the next commit. should be fixed. thanks. Your particular example could be resolved using withTotalCount() method.\nTo run same queries on the same set of conditions it's also possible using copy() method. thank you. merged. there are no named placeholders unfortunately. I wanted to add them, but never managed to start. named placeholders is what I been missing for years but been too lazy to implement that.\nIf you will come up with a pull request, ill be happy to accept it. \nThanks. thank you! merged. this is  were fixed. It's in readme. Haha. Indeed Need to add :)\nDb->where('a', '%test%');. Db->where('a', '%test%', 'like');. added to readme. can you rephrase your question? . there is no if check, but there is an excetion you can catch\n```php\n<?php\nrequire_once (\"../MysqliDb.php\");\n$db = new Mysqlidb('localhost', 'i1root', '', 'testdb');\ntry {\n    $db->ping();\n} catch (Exception $e) {\n    echo $e->message;\n}\n?>\n```. as well note that contructor wont try to establish any connection. You will need use ping() or any get() operation to establish a connection. . i forgot about this one to be truth :) Recently im mostly using helpers for a simple queries and query/rawQuery() for something more complex. subquery() functionality appeared to be more complicated then original sql :). Try latest stable version. Should be fixedong time ago. thats not a fix getLastQuery() wont return you same query that it would actually insert. \nTest an actual insert() and read readme. Merged .Thank you!. thank you! Fixed and pushed 2.9.1 bugfix release for that. use $db->count . hav you tested with latest release?. huh. weird. ill try to take a look on that during the week. . those functions work only in insert() and update(). Thats a good point, maybe I can adjust that for where too. this library wont be migrated to PDO in the near future. There were a fork of this library based on PDO but it seems never been working properly. error doesnt seems to be related to mysqlidb. it works fine in 7.0.  think rawQuery is your friend :). thank you!. similar patch is already in master. thank you!. https://stackoverflow.com/questions/25981292/how-to-make-composer-not-create-a-git-directory-for-a-package. I think we can merge this one. After I looked at it one more time, there no\nbehavior change here.\nOn Wed, Jul 4, 2018, 10:32 AM shuriks83 notifications@github.com wrote:\n\nReopened #739\nhttps://github.com/ThingEngineer/PHP-MySQLi-Database-Class/issues/739.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/ThingEngineer/PHP-MySQLi-Database-Class/issues/739#event-1715653637,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ADIl8kVjGkAeLV4mA6nD4jfzEQhquGZ1ks5uDG-DgaJpZM4TJfJt\n.\n. merged thanks.. i like a patch but can you please rebase a patch based on latest master and remove all your comments changes. push only getInstance() changes. thank you. thank you. merged. you can use autoreconnect to bypass this error.. can you please minimize the patch to only change doc part without changing code? . thank you for the patch. i mean to remove all the changes from the patch which are not related to the phpdoc . thank you. merged. this should be resolved in master. thank you merged. Unfortunately I had no time to add subquery support to insert() \nSo it is not possible for now.. Ups, it's an answer to a different ticket. interesting, maybe you are right. Ill take a look on that . thanks for the patch. What is a problem this patch is solving?. oh, thank you! good catch. fixed in master. thank you. What is the use case of that?. We can add this solution to readme. I agree with Richard.\n\nOn Wed, Jul 4, 2018, 12:01 PM Richard Weinhold notifications@github.com\nwrote:\n\nYou can achieve the same result using the already built-in trace function.\n$db->setTrace(true);$queryCount = count($db->trace);\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/ThingEngineer/PHP-MySQLi-Database-Class/pull/767#issuecomment-402414155,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ADIl8rvZsGEyoXlIMUz3Z10JkoFN7uGRks5uDIRzgaJpZM4VAogK\n.\n. yes, but in your case $return->field->save() would lead to error. Isnt it?. good catch guys. should be pretty trivial to fix. yep. we would need to store those variables before insert cycle, and then redefine them before each insert() .                 $this->_nestJoin\n                $this->_forUpdate\n                $this->_lockInShareMode\n                $this->_queryOptions[]\n\nyou would need to store all of  those . seems i have checked cached page. Yes, your fix looks like a good one.\n@LunarDevelopment can you test that?. thanks. This is an expected behavior since multiInsert() does all data entry within a single transaction as you can see from the function. \n@VeNoMouS can you please fix a warning and submit a pull request with this change?. function returns false in case of failure and you can use getLastError() to get an error.. \n```\npublic function insertMulti($tableName, array $multiInsertData, array $dataKeys = null)\n    {\n        // only auto-commit our inserts, if no transaction is currently running\n        $autoCommit = (isset($this->_transaction_in_progress) ? !$this->_transaction_in_progress : true);\n        $ids = array();\n    $options = [\n        '_queryOptions' => $this->_queryOptions,\n        '_nestJoin' => $this->_nestJoin,\n        '_forUpdate' => $this->_forUpdate,\n        '_lockInShareMode' => $this->_lockInShareMode \n    ];\n\n    if($autoCommit) {\n        $this->startTransaction();\n    }\n\n    foreach ($multiInsertData as $insertData) {\n        if($dataKeys !== null) {\n            // apply column-names if given, else assume they're already given in the data\n            $insertData = array_combine($dataKeys, $insertData);\n        }\n\n        foreach ($options as $k => $v) {\n            $this->${k} = $v;\n        }\n\n        $id = $this->insert($tableName, $insertData);\n        if(!$id && !in_array('IGNORE', $this->_queryOptions)) {\n            if($autoCommit) {\n                $this->rollback();\n            }\n            return false;\n        }\n        $ids[] = $id;\n    }\n    if($autoCommit) {\n        $this->commit();\n    }\n    return $ids;\n}\n\n```. this should properly handle IGNORE case. you last changes are breaking return type on rollback. Please if you want to submit a patch -- make it less intrusive . mysql connection happens only on actual moment when sql query is executed. If thats what you mean. we can do that as long if there is no space to tabs :) . > fix minor bugs \nthose one i would prefer to see in the separate pull request. sure, go ahead. Except the part \"code that never gets called because there\nis a return or throw before\". I would like to see those in a separate pull\nrequest.\nOn Sun, Sep 2, 2018 at 5:22 PM Michael Bladowski notifications@github.com\nwrote:\n\n@avbdr https://github.com/avbdr so are you receptive to this ? \ud83d\ude0f\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/ThingEngineer/PHP-MySQLi-Database-Class/issues/774#issuecomment-417960784,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ADIl8jJ48pIU2gFOtFAhtKh6fyZgtyBeks5uXEwigaJpZM4VWG86\n.\n\n\n-- \nAlex\n. closing as not a bug. unfortunately mysqli prepared statements doesnt support create trigger command for some reason. \n. thanks. PR merged into master. sorry, this is a english speaking project. can you please reopen it on english. thank you. merged. Thank you Richard :)\nOn Fri, Oct 5, 2018 at 6:05 PM Richard Weinhold notifications@github.com\nwrote:\n\nHe uses the ReflectionClass approach to get a new class-object of type\nmysqli but from a variable number of parameters ($params).\nNormally you would use call_user_func_array() (see: php-doc\nhttps://secure.php.net/manual/en/function.call-user-func-array.php) to\nachieve this behavior with function/method calls, but this is not available\nfor object-initialization.\nIn modern PHP (>5.6) you can use the ...-operator (splat) (see: php-doc\nhttp://www.php.net/manual/en/migration56.new-features.php#migration56.new-features.splat)\nto solve this problem, resulting in something like this:\n$mysqli = new mysqli(...$params);\nFor backwards compatibility the only remaining solution is to use the\nimplemented approach, utilizing the ReflectionClass::newInstanceArgs()\nmethod.\nAlso see: Stackoverflow\nhttps://stackoverflow.com/questions/2409237/how-to-call-the-constructor-with-call-user-func-array-in-php\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/ThingEngineer/PHP-MySQLi-Database-Class/issues/790#issuecomment-427511253,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ADIl8vHOtBGpCmJPtuxaTVuCVxU0L6UYks5uh9eWgaJpZM4XKhEB\n.\n\n\n-- \nAlex\n. closing as not a bug. closing as not a bug.  We will release a new version shortly. thanks. just created a new new package o packagist. Thanks guys. Merged. Thank you. thank you. thank you. thank you :). thanks for your message.\n$db->where('ID', $_POST['id']);\nthis is looks like a missing cast to int. I'm not sure are you calling this a 'regular usage' while data sanitizing is a primary junior mistake.\nunfortunately, mysqlidb is a helper, but not a magic. it have no idea of data types . clothing as not a bug. so the problem that mysqlidb doesn't support parametrized queries, and not a security vulnerability.\nlibrary never been advertising parametrized queries. I would love to see that implemented, but I'm completely short on time to do that. \nif you can send a patch for that, I will be happy to review.\nthanks for your time. feel free to breakdown new features as 1 patch per feature, include test cases and documentation and feel free to send pull requests.\nas well, your naming conventions are not the same as library is using.\n. can we get rid of this?\n. Please use old Array() syntax since we still support old php version. please remove all whitespace changes. this still should be return false; plus previous comments are not addressed . ",
    "tcdewit": "The above does work for insert/update/delete/select, but still fails for other query-types (e.g. truncate, set, etc).\nThe following code works also in such cases:\n```\n    protected function _dynamicBindResults(mysqli_stmt $stmt)\n    {\n        $parameters = array();\n        $results = array();\n    $meta = $stmt->result_metadata();\n\n    // if $meta is false yet sqlstate is true, there's no sql error but the query is\n    // most likely an update/insert/delete which doesn't produce any results\n    if(!$meta && $stmt->sqlstate) { \n        return array();\n    }\n\n    $row = array();\n    while ($field = $meta->fetch_field()) {\n        $row[$field->name] = null;\n        $parameters[] = & $row[$field->name];\n    }\n\n    call_user_func_array(array($stmt, 'bind_result'), $parameters);\n\n    while ($stmt->fetch()) {\n        $x = array();\n        foreach ($row as $key => $val) {\n            $x[$key] = $val;\n        }\n        array_push($results, $x);\n    }\n    return $results;\n}\n\n```\n. ",
    "salfredogonzalez": "I am having a similar error with the same queries, INSERT and UPDATE, that is not constructing the bind params correctly or establishing different types.\nthe tableData is an array, the id is passing correctly, i forced the variables to the type, and still having the same error \"Number of elements in type definition string doesnt match number of bind variables\".\nThe code: \nfunction passingVariables($id_variables, $variable, $variable, etc) {\n    $array_variables = array( \"dbfield\" => $variable,  \"dbfield\" => $variable,  \"dbfield\" => $variable);\n$db->where(\"id\",$id_variable);\n   $db->update(\"tableName\", $array_variables);\n}\n is there something that im missing??\n. ",
    "littlebee88": "this is fixed in my fork https://github.com/littlebee88/PHP-MySQLi-Database-Class\n. ",
    "jacksbox": "I had the same problem - and no idea whats causing it (but it only appers when working with large Tables)- the fix michaeland posted helped\n. ",
    "rfi-chuj": "Hey\nGo into the Class and under the protected function \"_dynamicBindResults\" Add\n$stmt->store_result();\nbefore the rest of the logic.\n. ",
    "asithade": "Yup just came across this issue and the fix above solved it. \n. ",
    "inetAnt": "Hello,\nIt happens because the class uses FILTER_SANITIZE_STRING to filter queries, which results in deleting some characters such as '<'.\nTo solve this, you can replace each occurrence of \"FILTER_SANITIZE_STRING\" by \"FILTER_SANITIZE_MAGIC_QUOTES\" in the class file.\n. ",
    "PetengDedet": "I have tried to replace \"FILTER_SANITIZE_STRING\" with \"FILTER_SANITIZE_MAGIC_QUOTES\" in class file. that's occurs for 3 times, right?\nbut this code didn't shows anything in browser. i don't know why.\n``` php\n<?php\nini_set('display_errors',1);  error_reporting(E_ALL);\ninclude'class/MysqliDb.php';\n$crud = new MysqliDb();\n$result = $crud -> rawQuery('SELECT * FROM user WHERE iduser<5');\nforeach ($result as $key => $value) {\n    print_r($value);\n}\n?>\n```\n. Hi, checkuout my pagination function\nhttps://github.com/PetengDedet/PHP-MySQLi-Database-Class/blob/master/pagination.php\n. According to  this the 'rawQuery()' fails on this case is because of the class uses \"FILTER_SANITIZE_STRING\" to remove the unsafe characters such as '<'.\n. The get() method returns the multilevel array. The first array is the row affected by the query. The second array is the column for each row.\nSo if you want to access the object, try this:\n``` php\n$x = $db->get('tbl');\necho $x[0]['column'];  //the value of column only in first row\nforeach($x as $y){\n        echo $x[0]['column']; //value of column each affected row\n}\nforeach($x as $y){\n        print_r($y); //every value of every column in each affected row\n}\n``\n. I think the reason is people want to know newly inserted data rather than the old data first.\nThis is non technical, but it's up yo you. Feel free to use ASC order by$this->db->orderBy('filed','type');`\n. ",
    "nartamus": "I guess it's just Chrome. Tested in Firefox and IE and it's fine.\n. ",
    "MackieeE": "It wouldn't matter if it was chrome, FF or IE Surely! :)\n. Good addition :+1: although I hate to be pedantic - this is always likely to return more than one column.. Would be better to name it GetColumns :) \n. This would also depend on your server being on the right time zone too.. it's a balancing act :)\n. ",
    "DarylJG": "This could be down to a browser cache.. Multiple submits on refresh?\nTheres alot of factors  to be taken into account if you have a \"multi-insert\" problem occurring \n. Yan, are you sure your correctly using the raw query method & passing the right params?\n.  method MysqliDb::rawQuery() there is this line of code:\n$this->_query = filter_var($query, FILTER_SANITIZE_STRING);\nwhich will turn your query string\nUPDATE users_login SET LastLogin= CONCAT(CURDATE(), ' ', CURTIME()) WHERE Username=?\ninto this:\nUPDATE users_login SET LastLogin= CONCAT(CURDATE(), &#39; &#39;, CURTIME()) WHERE Username=?\n     //the single quotes now become &#39;                ^^^^^ ^^^^^\nAnd then this string is passed to mysqli::prepare(), causing a syntax error.\n. @wilsonf1 This is a method that will not work\n@maan The problem resicides within this class, as stated in my comment which is 4 above (5 after posting this), and the problem is resolved if you change to my recommended resolution\n. Can you show an example of what is going on? Because:\n$DB = new MysqliDb(\"localhost\",\"root\",\"hiddenpass\",\"hiddendb\");\n   echo \"<pre>\";\n   print_r(MysqliDb::getInstance());\n   echo \"</pre>\";\nReturns the following: \n```\nMysqliDb Object\n(\n    [_mysqli] => mysqli Object\n        (\n            [affected_rows] => 0\n            [client_info] => mysqlnd 5.0.11-dev - 20120503 - $Id: 40933630edef551dfaca71298a83fad8d03d62d4 $\n            [client_version] => 50011\n            [connect_errno] => 0\n            [connect_error] => \n            [errno] => 0\n            [error] => \n            [error_list] => Array\n                (\n                )\n        [field_count] => 0\n        [host_info] => localhost via TCP/IP\n        [info] => \n        [insert_id] => 0\n        [server_info] => 5.5.27\n        [server_version] => 50527\n        [stat] => Uptime: 651  Threads: 1  Questions: 8  Slow queries: 0  Opens: 33  Flush tables: 1  Open tables: 26  Queries per second avg: 0.012\n        [sqlstate] => 00000\n        [protocol_version] => 10\n        [thread_id] => 7\n        [warning_count] => 0\n    )\n\n[_query:protected] => \n[_where:protected] => Array\n    (\n    )\n\n[_whereTypeList:protected] => \n[_paramTypeList:protected] => \n[_bindParams:protected] => Array\n    (\n        [0] => \n    )\n\n)\n```\n. Unfortunately there is only the method to return the result set as an array, if you'd prefer to be using bind_result to get your results without an array.. Then i'd recommend switching to native MySQLi functions or use a better produced wrapper \n. In addition to aleknas response. It's more of a graceful method, as you can control how the script halts and such, but a method I prefer using would be: \n           mysqli_report(MYSQLI_REPORT_ALL);\nThis will report every error which is triggered ( taken from the manual) http://www.php.net/manual/en/mysqli-driver.report-mode.php\n. ",
    "kv4nt": "It's really chrome bug. In FF works fine!. ",
    "abunour22": "I think this may works correctly .. \n```\n    $dynamicBindings = $this->_dynamicBindResults($stmt);\n    $data['data'] = $dynamicBindings;     \n    if($nr === true)\n    {          \n        $data['count'] = count($dynamicBindings); \n    }\nreturn $data;\n```\nwith this updates , you can use it like this \n$params = array($username, $userid);\n            $result= $db->rawQuery(\"SELECT * FROM usersWHERE user_name = ? AND user_id = ?\", $params, true);\n            echo ' Count : '. $result['count'];\n            echo ' IP Address: '.$db->reValue($result['data'],'user_ip');\nfor reValue function : \nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/issues/42\n. my website for stores as market or somethings like that ,, any way \ni have multiple queries to such as to get items data ,stores data,customers data .. etc ,, \nthis is example of query i use .. ::\n\n$UFM  = $DB->rawQuery(\"SELECT `i`.`id`,`i`.`name`,`i`.`item_img`\n                            `rs`.`store_u`,`rs`.`store_name`,`rs`.`store_logo`,\n                            COALESCE(`sp`.`item_price`, 0) AS 'item_price',\n                            COALESCE(`rd`.`type`, 0) AS 'type',\n                            COALESCE(`rd`.`value`, 0) AS 'value'\n                        FROM `items` `i`\n                            LEFT JOIN `items_sales` `s` ON `i`.`id` = `s`.`item_id`\n                            LEFT JOIN `store_settings` `rs` ON `i`.`store_id` = `rs`.`id`\n                            LEFT JOIN (\n                                    SELECT `item_price`,`item_id`\n                                    FROM `items_size` \n                                    WHERE `size_base` = '1' \n                                    LIMIT 1\n                            ) `sp` ON `i`.`id` = `sp`.`item_id`\n                            LEFT JOIN (\n                                    SELECT `type`,`value`,`target_id` \n                                    FROM `items_discounts` \n                                    WHERE `start` <= CURDATE()\n                                        AND (\n                                                ( `end` >= CURDATE() )\n                                                OR\n                                                ( `never_expires` = '1' ) \n                                            )\n                                        AND `active` = '1'\n                                        AND `hide` = 'no'\n                            ) `rd` ON `i`.`id` = `rd`.`target_id`\n                    ORDER BY `i`.`id` \n                    limit 0,8\",null,false);\n\ni don't know whats the problem .. \nanyway i thought that the problem was from my Apache server .. but i tried another scripts on my Apache and works fine .. plus phpMyAdmin works fine !! \nbut when i make just single query in the page ,, it works fine ..\n. i know that , am asking for solution for this case in relation with this class !! \n. thanks for your answer,\nanyway i made changes for that and its work fine now .. \ni made this , may it will help someone : \n1- i've change php.ini date.timezone to \"UTC\"\n2- i made this code in my app config to make sure it will be available in all web pages: \n```\n    //=> Current User Device TIME\n        define('OriginalTimeZone','UTC');\n        $original_timezone = new DateTimeZone(OriginalTimeZone);\n    // Instantiate the DateTime object, setting it's date, time and time zone.\n    $CDateTime = new DateTime( date('Y-m-d H:i:s', time() ) , $original_timezone);\n\n    // Set the DateTime object's time zone to convert the time appropriately.\n    // $_SESSION['UserTimeZone'] is the timezone of each user as stored in database\n    $targetZone = new DateTimeZone($_SESSION['UserTimeZone']);\n    $CDateTime->setTimeZone($targetZone);\n\n    // Outputs a date/time string based on the time zone you've set on the object.\n    $CurrentUserDeviceTime = $CDateTime->format('Y-m-d H:i:s');\n\n    define('CurrentUserDeviceTime',$CurrentUserDeviceTime); // Current User Device Time\n\n//=> SERVER TIME TO Store In Database\n    $original_timezone = new DateTimeZone($_SESSION['UserTimeZone']);\n\n    // Instantiate the DateTime object, setting it's date, time and time zone.\n    $CDateTime = new DateTime( CurrentUserDeviceTime , $original_timezone);\n\n    // Set the DateTime object's time zone to convert the time appropriately.\n    $targetZone = new DateTimeZone(OriginalTimeZone);\n    $CDateTime->setTimeZone($targetZone);\n\n    // Outputs a date/time string based on the time zone you've set on the object.\n    $CurrentTime = $CDateTime->format('Y-m-d H:i:s');\n\n    define('CurrentTime',$CurrentTime); // Current Server Time To Store it on database\n\n```\n3- i replace all $DB->now() with CurrentTime\n4- then i made this function to call it when there is need to get time back from database .. \n```\nfunction CTimeZone($DatabaseDateTime)\n{\n        $original_timezone = new DateTimeZone(OriginalTimeZone);\n    // Instantiate the DateTime object, setting it's date, time and time zone.\n    $CDateTime = new DateTime( date('Y-m-d H:i:s', strtotime($DatabaseDateTime) ) , $original_timezone);\n\n    // Set the DateTime object's time zone to convert the time appropriately.\n    $targetZone = new DateTimeZone($_SESSION['UserTimeZone']);\n    $CDateTime->setTimeZone($targetZone);\n\n    // Outputs a date/time string based on the time zone you've set on the object.\n    return $CDateTime->format('Y-m-d H:i:s');\n\n}\n```\nexample : \n$userComments = $db->rawQuery('SELECT * from user_comments where userId=?', Array (10));\n          foreach ($userComments as $userCom) {\n                $data_created = CTimeZone($userCom['data_created']);\n          }\n. i don't now why you need that ,, \nanyway i made this for errors and its works fine to me ..\nmay it will help you !!\nAdd This function into your MysqliDb.php :\n```\n/\n * Allow the class to send admins a message alerting them to errors\n * on production sites\n \n * @access public\n * @param string $error\n * @param string $query\n * @return mixed\n /\npublic function log_db_errors( $error_in, $error, $query, $bindParams = array())\n{\n                $message = 'Error In: ' . $error_in.'';\n                $message .= 'Error Time: '. date('Y-m-d H:i:s').'';\n                $message .= 'bindParams: '. json_encode( $bindParams ).'';\n                $message .= 'Query: '. htmlentities( $query ).'';\n                $message .= 'Error: ' . $error.'';\n                $message .= 'Related File: ' . $_SERVER['PHP_SELF'].'';\n            if( defined( 'SEND_ERRORS_TO' ) && SEND_ERRORS_TO_EMAIL )\n            {\n                    $headers  = 'MIME-Version: 1.0' . \"\\r\\n\";\n                    $headers .= 'Content-type: text/html; charset=iso-8859-1' . \"\\r\\n\";\n                    $headers .= 'To: Admin <'.SEND_ERRORS_TO.'>' . \"\\r\\n\";\n                    $headers .= 'From: Database Department <db@'.$_SERVER['SERVER_NAME'].'.com>' . \"\\r\\n\";\n                    mail( SEND_ERRORS_TO, 'Database Error', $message, $headers );   \n            }\n            if(DISPLAY_DEBUG)\n            {\n                    echo $message;   \n            }\n\n}\n```\nmade change in rawQuery  as example for :\ncall_user_func_array(array($stmt, 'bind_param'), $this->refValues($params));\nto : \nif ( !call_user_func_array(array($stmt, 'bind_param'), $this->refValues($params)) ) {\n                // Send Errors To Email\n                $this->log_db_errors( 'bind_param',trim($stmt->error.\" \".$this->_mysqli->error), $this->_query, $bindParams );   \n        }\n. ",
    "anil3a": "thank you. I can close this issue then.\n. ",
    "nousename": "hows this work with multiple joins ?\n. ah ok thanks\n. ",
    "ahmedmanf": "good work :+1: \n. ",
    "lgt": "okay fixed\n. ",
    "yansentan": "yes, i have tried the rawQuery too, both using array and array implode.\nStill returning the empty query...\n. I think you can just use PHP date(\"Y-m-d h:i:s\") or whatever your format is.\n. ",
    "ahmedali5530": "Hi, how can i insert muliple values into db, like \"INSERT INTO table(id,title) VALUES(1,'abc'), VALUES(2,'bcd')\"\n. @ishr00m i think filter is also included in this class.\n. ",
    "webulent": "I have same problem. \nCALL sp_customer('5')\nhow can I use stored procedure?\n. ",
    "wilsonf1": "Try changing:\n$this->_query = filter_var($query, FILTER_SANITIZE_STRING);\nto\n$this->_query = $this->_mysqli->real_escape_string($query);\nDoes it work? Wondering if the issue is similar to this chap: http://stackoverflow.com/questions/14429929/ajillion-php-mysqli-database-class-update-command\n. Try removing the function around it to get it working:\n$this->_query = $query;\nHow secure this is I do not know. Anyone else? Does the $stmt = $this->_prepareQuery() take care of security?\n. Another thing to try (I have zero experience here...)\n$Update_Parameter = array(\"CONCAT(CURDATE(), ' ', CURTIME())\", \"Sophie\");\n$Database->rawQuery(\"UPDATE users_login SET LastLogin = ? WHERE Username=?\"\nPlease let me know how you get on. I'm considering whether to use this class for a lot of work in the future!\n. What happened when you changed to:\n$this->_query = $query;\nSo no more single quote removal. Did that work?\n. ",
    "sangatpedas": "I have the exact same problem with any insert or update using a rawquery statement. The update or insert works but it produces the following error:\nFatal error:  Call to a member function fetch_field() on a non-object in /path/to/library/Mysqlidb.php on line 418\n. ",
    "dxops": "php\n$db = MysqliDb::getInstance();\n$db->where('key', 'value')->get('table');\ncauses notice because of not existing fields, unset not just clears var but destroys it\nphp 5.5.3\n. ",
    "amityweb": "I also get a similar issue, I cant run the following, but executing the SQL in a MySQL Manager runs fine. \nFor me, removing the AND statement works, so using WHERE AND breaks it. \n$sql = \"\n    SELECT node.nid as id, \n         node.status as status, \n         revision.title as title, \n         revision.body as body \n    FROM css_node_revisions as revision \n    JOIN css_node as node ON node.nid = revision.nid \n    WHERE node.status = 1 \n    AND node.type = 'news_article'\n    ORDER BY node.nid DESC\n    \";\n. ",
    "MarioCares": "Hi !\nHad the same problem.\nJust make the default value to now() on the column definition (like CURRENT_TIMESTAMP).\nIt works for me :+1: \n. The procedure works fine. As you can see, it does call and return data.\nThe only problem it's that warning message.\nCant's really find a solution, so just use \n    ini_set('display_errors', 'Off');\n    error_reporting(0);\n. ",
    "ghost": "Hello mate, following line should display if any mysqli errors:\nif(mysqli_connect_errno()) { die(\"Database connection failed: \" . mysqli_connect_error() . \"(\" . mysqli_connect_errno() . \")\");\n            }\n. I've added the following which seems to work well\nUpdate of buildJoin function:\n```\n/*\n     * Abstraction method that will build an JOIN part of the query\n     /\n    protected function _buildJoin () {\n        if (empty ($this->_join))\n            return;\n    foreach ($this->_join as $data) {\n        list ($joinType,  $joinTable, $joinCondition) = $data;\n\n        if (is_object ($joinTable))\n            $joinStr = $this->_buildPair (\"\", $joinTable);\n        else\n            $joinStr = $joinTable;\n\n        $this->_query .= \" \" . $joinType. \" JOIN \" . $joinStr .\" on \" . $joinCondition;\n\n        // Add join and query\n        if (!empty($this->_joinAnd) && isset($this->_joinAnd[$joinStr])) {\n            foreach($this->_joinAnd[$joinStr] as $join_and_cond) {\n                list ($concat, $varName, $operator, $val) = $join_and_cond;\n                $this->_query .= \" \" . $concat .\" \" . $varName;\n\n                switch (strtolower ($operator)) {\n                    case 'not in':\n                    case 'in':\n                        $comparison = ' ' . $operator. ' (';\n                        if (is_object ($val)) {\n                            $comparison .= $this->_buildPair (\"\", $val);\n                        } else {\n                            foreach ($val as $v) {\n                                $comparison .= ' ?,';\n                                $this->_bindParam ($v);\n                            }\n                        }\n                        $this->_query .= rtrim($comparison, ',').' ) ';\n                        break;\n                    case 'not between':\n                    case 'between':\n                        $this->_query .= \" $operator ? AND ? \";\n                        $this->_bindParams ($val);\n                        break;\n                    case 'not exists':\n                    case 'exists':\n                        $this->_query.= $operator . $this->_buildPair (\"\", $val);\n                        break;\n                    default:\n                        if (is_array ($val))\n                            $this->_bindParams ($val);\n                        else if ($val === null)\n                            $this->_query .= $operator . \" NULL\";\n                        else if ($val != 'DBNULL' || $val == '0')\n                            $this->_query .= $this->_buildPair ($operator, $val);\n                }\n            }\n        }\n    }\n}\n\n```\nNew joinWhere function:\npublic function joinWhere($whereJoin, $whereProp, $whereValue = 'DBNULL', $operator = '=', $cond = 'AND')\n    {\n        $this->_joinAnd[$whereJoin][] = Array ($cond, $whereProp, $operator, $whereValue);\n        return $this;\n    }\nAnd the array to store the joins:\nprotected $_joinAnd = array();\n. Cheers. Will do this at the weekend\n. why not simply using array_merge($array1, $array2) right before calling insert?\n. i think the correct should be\n$this->db->where(\"id\", 2);\n$user = $this->db->get(\"users\");\nthe mysqlidb object is in $this->db variable, not the local $db;\n. ",
    "Stichoza": "I already tried it, but error is the same. Also I tried array('1', 'A5f8dd') and array(1, 'A5f8dd') (with and without quotes) but the same error occurs :< Tried on localhost and shared hosting servers.\n. ",
    "scazzy": "do you have an updated Class with more features like getOne(), getting counts of current executed query, etc etc.\nthere are lot of functionality missing in this.\n. Alright. good.\nCould you work on the addon - resetting\n\nSame query\nReset some options, remove if require (example where clauses)\nRerun the same query (eg. We get count of last exe query. We remove Limits, and re run old query to get total count)\n\nSuggest if any better idea\n. ",
    "vernondegoede": "Hi,\nAs stated in the documentation of the database class, the get method will return an array with results.\nExample:\nphp\n$db->where('id', int);\n$db->where('title', string);\n$results = $db->get('tableName');\nprint_r($results); // contains array of returned rows\nGood luck!\n. I'm not sure if @getvivekv meant count?\n. php\n$obj = json_decode(json_encode($query), true);\n. This should work fine after you inserted values..\nphp\n$db->getInsertId();\n. Use the raw query method:\nphp\n$threeHoursAgo = time() - ( 60 * 60 * 3 );\n$params = array($threeHoursAgo, '3');\n$results = $db->rawQuery('SELECT * FROM posts WHERE add_timestamp < ? AND category = ?', $params);\nprint_r($results);\n. I'm planning on upgrading this library with a lot of features really soon :-)\n. ",
    "lapega": "bump...\n. ",
    "hibbert-de": "bump...again....\n. ",
    "boxxa": "You will need to check if username or email is set first then do:\n$params = array($username,$password);\n$result = $db->rawQuery(\"SELECT COUNT(email) AS counter WHERE username=? AND password=?\",$params);\n$result[0]['counter'] will contain your MYSQL counted variable\n. ",
    "hriziya": "Hi, I am looking for the way to do OR query using method chaining ?\nLike.. \nfor AND operation we can use like this.. \n$db->$results = $db\n    ->where('id', 1)\n    ->where('title', 'MyTitle')\n    ->get('users');\nhow to do OR operation in same way ?\nThanks\n. ",
    "dele454": "I definitely prefer the wrapper functions to having raw sequel. :+1: \n. Nice!\n. I think it is better you keep this on your fork. You have introduced a lot of fundamental changes to the code and I doubt the original owner will merge it in. I also added a flag to ignore quotes but I am better of adding more to it with no intentions of making a PR back to here. Maybe you should do the same. If it works for your needs then you can simply keep it on your fork.\n. ",
    "cheko08": "Hi Try changing $stmt->insert_id for \"true\"\npublic function insert($tableName, $insertData)\n    {\n        if ($this->isSubQuery)\n            return;\n```\n    $this->_query = \"INSERT into \" .self::$_prefix . $tableName;\n    $stmt = $this->_buildQuery(null, $insertData);\n    $stmt->execute();\n    $this->_stmtError = $stmt->error;\n    $this->reset();\nreturn ($stmt->affected_rows > 0 ? true : false);\n\n}\n```\n. ",
    "byFd": "maybe you can even try to do if($db->insert('footer_menu', $db_data) === false) echo 'error!';\ni guess that insert_id will be 0 or null if there is no auto_increment thingy?\n. Well, what have you got so far?\nI would try something like this, not sure if it works ;)\nphp\n$db->join(\"tree n\", \"o.lft BETWEEN n.lft AND n.rgt\");\n$db->join(\"tree p\", \"o.lft BETWEEN p.lft AND p.rgt\");\n$db->where(\"n.id\", 2);\n$db->groupBy(\"o.lft\");\n$db->orderBy(\"o.lft\");\n$db->get(\"tree o\", NULL, \"o.name, COUNT(p.id) - 1 AS level\");\n. why aren't you using the IN selector?\n$db->where('site_id', Array(3,2,4,5), 'IN');\n. so what is not working?\n. I made small test case and it seems to work when i base the value on 2500 but not on 25000.\nProbably something about floating point precision?\ni also made a test with raw php mysqli stuff. which didn't work either so i don't think it's a bug for this library.\n\nHabe mal kurz was zum testen geschrieben und das scheint nicht mit der Klasse hier zu tun zu haben.\n$db->where(\"test >= $test\"); klappt bei mir auch nicht.\n``` PHP\n$test = 25000.000000000000;\n$mysqli = new mysqli(DB_HOST, DB_USER, DB_PWD, DB_DB);\n//This does not get results where the value is 2500.00000...\n$stmt = $mysqli->prepare(\"SELECT * FROM test WHERE test >= ?\");\n//This works\n$stmt = $mysqli->prepare(\"SELECT * FROM test WHERE test >= cast(? as DECIMAL(30,12))\");\n$stmt->bind_param('d', $test);\n. did you read readme.md?  \nhttps://github.com/joshcam/PHP-MySQLi-Database-Class#subqueries\n.\n$grupos = $dbAgil->get('sys_users su', null, 'sg.design as sg_design, sue.design as sue_design');\n```\n. it only gives you the ones you list. It is not bad to list all the ones you need. often times you don't need all the fields for every query, so you could save some query time with only selecting the fields you need.\n. ",
    "ewwink": "nevermind.\n. ",
    "dieselburner": "Totally agree.\n. ",
    "Swampy821": "This has to do with line 144 \nphp\n$this->_query = filter_var($query, FILTER_SANITIZE_STRING);\nIt will not allow apostrophes. Technically you can take that line out, it will still work and that will get you going again.\n. ",
    "narendrakothule": "if you are using any query like SELECT * FROM users....\ninstead of * use specific column name like \nSELECT ID, name FROM users....\nHope this will help\n. ",
    "ramjamx": "Same problem here on local host.\nFatal error: Allowed memory size of 134217728 bytes exhausted (tried to allocate 4294967296 bytes) \n4294967296 bytes = 4.000002 Gigabytes ?\nhttp://www.flightpedia.org/convert/4294967296-bytes-to-gigabytes.html\nIt seems to many data, I just tried to make a count of saved pages on a little system (just 6 pages)\nI may be doing something wrong?\nphp\n$count= $db->getOne (table_pages, null, \"sum(ID), count(*) as total\");\nTotal: <?= $count['total'] ?>\nUPDATED\nIt seems to be a problem with longtext mysql column type, changing it to medium text solves the problem for me, but I found some advice in order to get a cleaver code:\nhttps://bugs.php.net/bug.php?id=51386\nSo, usingmay mysql store result help on future releases.\nhttp://www.php.net/manual/en/mysqli.store-result.php \n. @avbdr  Updated version solve my problem even with longtext. thank you.\n. If I put an array like that, i just get a fatal error.\nlike this:\nFatal error: Problem preparing query (SELECT * FROM cms_images_data WHERE ID 0 ?) \nYou have an error in your SQL syntax; check the manual that corresponds to your MySQL \nserver version for the right syntax to use near '0 ?' at line 1\n in /path/to/site/html/bin/mysqli.db.class.php on line 615\n. Greeeat! that solve my problem . Thank you Alexander (avdbr). \nshame on me\n. ",
    "azizjassar": "what is the latest version ??\n. i made the changes with latest version of the myqlidb class but the same problem. but when i set the memory limit to 512M it's fine. and i hope that the problem is gonna be ending at this \n. i downloaded the latest version but the problem still the same. but when i change the memory limit from 256M to 512M it works\n. i don't know where is the problem exatly. so i can't find out how much result i'm pulling out\n. hello, i have the same issue \nFatal error: Allowed memory size of 268435456 bytes exhausted (tried to allocate 79 bytes) in /home/links/public_html/classes/db.php on line 628\nand i tried several solutions:\nlike this : https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/186\nbut nothing changed. please help\n. ",
    "danielcorrea": "Yep :-)\n. ",
    "aaditya1k": "I already added your 1. feature request here: https://github.com/ajillion/PHP-MySQLi-Database-Class/pull/81\nyou can count last executed query\n$db->num_rows;\n. ",
    "prabhakaran0225": "Everything is up to date but only in clause is not working as expected everything else works good.\n. ",
    "jamalniyaz": "Hi avbdr,\nI tried the code which you gave on main page for referal, but nothing works. And also i've updated the latest one of PHP-MySQLi-Database-Class.\nnothing works. if you give me some solution based example for update query with in clause, would be really helpful.\n. Hi bro,\nfor get the values, really working grt. but updating values it does not. I don know where exactly problem on this. \ncould you check.\n. thanks dude, itz working fine nw. great support.\nOn Mon, Mar 17, 2014 at 6:33 PM, Alexander Butenko <notifications@github.com\n\nwrote:\n$db->where(\"id\", Array(\"in\" => array(1,2,3,4,5,6)));\n$db->update (\"users\", Array(\"name\" => 'test'));\nworked just fine here. Please post the piece of your code.\nMost likely there is a typo there.\n\nReply to this email directly or view it on GitHubhttps://github.com/ajillion/PHP-MySQLi-Database-Class/issues/83#issuecomment-37812333\n.\n. \n",
    "Moatilliatta": "Most of them I guess... I think I put the ones you can prevent sql injection...\n. OK regarding first point I make use of an array that contains reserverd words that are not used in the real_escape_string, so, along the stri_replace function an the use of mysqli's real_escape_string we make a deep clean of reserverd words in order to avoid a SQL injection.\n. I have this option, may work for you!\nhttps://github.com/ajillion/PHP-MySQLi-Database-Class/pull/85\n. ",
    "fabiomsnunes": "Yes that I know, but imagine that you want to limit 10,10 to show the second page posts.\nHow can I do that?\nI can't use get('users', 20) because it will sow the first and second page posts\n. I know, the code is that way because on the first commit I accidentally reindented all code and I did not notice, (and Im new here and I don't know how to delete a commit :P).\nBut the changes are basicly on the __construct, only added $tableName and conn.php\n. You can do it that way:\n$db->where(\"column\", array(\"!=\" => \"NULL\"));\nthere is no need to change code\n. Like I posted I'm sure It works because I'm using it right now on a website im developing\n. Then try change =! for ==\n. Great, I also tried on my project and works for\n$db->where(\"column\", array(\"<=>\" => NULL));\n. ",
    "nenuadrian": "When I tested that on my end it didn't really worked, I remember trying it twice with \"\" and without around the null. When i googled people said stmt doesn't always render properly the nulls and <=> is kinda of the proper syntax.\nSo that's why I considered this change necessary, but if you say it work, sorry for the mess.\n. My update is not for where != it's for where is null.\nDoes that work as well?\nFor me $db->where(\"column\", \"NULL\") is empty because it obviously takes it as a string, so I made it work when passing a NULL value.\n. Error preparing query\nFor both\nprint_R($db->where(\"column\",array(\"==\"=>NULL))->get(\"table\"));\nprint_R($db->where(\"column\",array(\"==\"=>\"NULL\"))->get(\"table\"));\nAnd for just one = empty result.\n. It actually works for \nprint_R($db->where(\"column\",array(\"<=>\"=>NULL))->get(\"table\"));\n....... so nevermind anyway.\n. ",
    "boomware-zz": "Did you find the solution? I have the same problem.\n. add this line $stmt->close();\nafter \"return\" in method \"_dynamicBindResults\"\n. ",
    "screeper": "Thanks a lot =) The orWhere method is really useful.\n. ",
    "wingoo": "just use rawQuery\n. you can use getInsertId() to check if insert success\n. ",
    "wakirin": "When I use rawQuery, I don't get result when \"ON DUPLICATE KEY UPDATE \", and don't know work query or not. How I can get result ?\n. wingoo Thanks! Now it work.\n. ",
    "CalvinGrain": "You are right, thanks!\n. If you use chrome - go to Developer tools -> network -> look for ajax called url and then click it. You will see tabs like Headers, Preview, Response.\n. ",
    "sanderploegsma": "I'm actually not having any issues with the current version of the class when using reserved words like key as column names, except for when using $db->orderBy() since the regexp in that function filters backticks, so using $db->orderBy('key') will not work. \nNot sure why backticks aren't allowed in column names for this particular function, but adding them to the expression seems to fix my issue without causing any huge problems so far.\n. ",
    "shako92": "I used raw query to accomplish this issue now builtin where clauses.\n. ",
    "RPDeshaies": "A rawWhere operator would be nice !\n. ",
    "nnarbone": "Got new master. Thanks.\nSince I used the raw Query I forgot to put the variable into the params array. Instead I was trying to inject it right into the JOIN which is a no no I assume. It is working now.\nSorry to take up your time. By the way I like the CRUD stuff your working on. Great enhancement for this script.\nThanks,\nNick\n. Nevermind... table definition cache issue. weird as it worked via phpmyadmin so assumed something here was wrong. It also worked via regular mysqli query. In any case increasing mysql table cache fixed the issue.\n. what is $referencedata?\n. ",
    "NazgulTuga": "And you would need to save every single inserted ID, and return them in an array.\nThe best way is to create a function that handles all that multi-information in a foreach loop or a for.\n. I think i found a way.\nThis function will only work if its inside the \"MysqliDb\" or a class that extends from it, and that the line:\n\"$this->_lastQuery = $this->_query;\" is added to the \"reset();\" function (being called first).\nHow it works?\nIf you run a Query with the \"LIMIT\" set, but you also want to return the number of pages/total rows that the Query would really return, you first RUN your query, and then execute the function \"getPages\". Automatically will use your already constructed Query and manipulate it to return the total.\nExample:\nHow much rows can my Query find, and how much pages will I get if I want to show only 10 rows per page? I know my query returns 37 rows, so...\n```\n$rows = $tblUsers->get('users',array(0,10),array('id','name'));\nWill return only the first 10 rows.\n$totalPages = $tblUsers->getPages(10);\nWill return the Total rows divided by the limitPerPage\nFound: (37/10) == 3.7 => 4 pages\n```\nCode:\n```\npublic function getPages($limitPerPage=0)\n{\n    $Result = 0;\n    $sql = $this->_lastQuery;\n    $pos = stripos($sql,'FROM');\n    $sql = substr($sql,$pos);\n    $pos = stripos($sql,'LIMIT');\n    if ($pos)\n        $sql = substr($sql,0,$pos);\n    $sql = \"SELECT COUNT(*) AS 'total' $sql\";\n$rows = $this->rawQuery($sql);\nif (isset($rows[0]))\n{\n    $total = $rows[0]['total'];\n    if ($limitPerPage!=0)\n    {\n        #http://php.net/manual/en/function.round.php\n        $Result = ceil($total/$limitPerPage);\n    }\n    else\n        $Result = 1;\n}\nreturn $Result;\n\n}\n```\n. Please, re-use the code. If it doesn't work as it is, change it.\n. I think the problem is that you are passing a String ($keys) and not an Array of Integers.\n. I think the best way to achieve this is to create your own function, similar to the \"_where\".\nYou could pass an array as param, or various arrays into the function and use \"func_get_args\", then, using \"array_merge\", you could use that values in and FOR loop or FOR..EACH.\n. ",
    "oscaroxy": "yessssss, thanks a lot to everybody\n. excuse me, but why now the class is without commit and rollback method?\nthanks\n. clear, thanks\nbut ... will joshcam commit your patch?\n. I tried both master and patch (from avbdr) file and the result is always the same, error in apex character.\nFor the bind is ok, but I have the values empty, like \"select '' as column from table \" how do I resolve that? \nmaybe $db->rawQuery(\"select ? as column from table\",Array(\"\"));?... but so every constant in sql become a bind... about me is less maintainable. In code reading when I read:\n\"select * from table where column1 = 'pippo' and column2 = ? \" \nI understood soon and that is more simple than \n\"select * from table where column1 = ? and column2 = ? \"\nbecause column1 always is a constant.\nis there a solution at this?\nthanks\n. other example:\nselect \nCASE WHEN 0 < (SELECT COUNT(*) FROM table WHERE 0=0 ) THEN '1' ELSE '0' END as column\nfrom table;\nthanks\n. and this:\nSELECT CONCAT(name,' ',surname) FROM user\nthanks\n. thanks, your solution \"avbdr\" work fine\nso I can work with your class, yet thanks.\n. ",
    "Edig": "Sorry I close it, my mistake I was inserting a ID that has a Foreign key and I was inserting and ID that doesn't exists.\nNo error was displayed \n. Hi avbdr, \nThanks! It works the rawQuery, the other one (subquery) doesn't but i will double check if i didn't modify something.\nBut thanks!\nAlso I was getting the last query and paste it on Mysql workbench and works perfectly :sa: \nBest,\n. Hi,\nI'm opening over 50 connections and I get that error. I know that it's not a good practice to open that many connections, that why when my php file call another php file (I prefer to call php files than classes, so I can use shell commands and divide it in 4 CPUS the process, because this function execute once per day per user). \nBut because the php file call another php file with exec('php phpfile.php') and wait until the other 100 calls finish (I do this so I can calculate the execution time of the full process) the connection to the database remains open, how can I close that connection or pass it throw parameter?\nOr any other idea on how can I do this?\nNote: IF i do it with a function and a loop calling a functions 100 times, will work but I will execute it only in one thread, and I'm very interested to divide it in more threads\n. ",
    "ajayphp": "Hi, \ni tried with PHP version : 5.4.4\nstill that error : \nPHP Fatal error:  Allowed memory size of 134217728 bytes exhausted (tried to allocate 4294967296 bytes) in MysqliDb.php on line 629\nplease tell me how to resolve, as this break my app. \nRegards\n. ",
    "gregtampa": "PHP 5.5.9-1ubuntu4.5 (cli) (built: Oct 29 2014 11:59:10)\nCopyright (c) 1997-2014 The PHP Group\nZend Engine v2.5.0, Copyright (c) 1998-2014 Zend Technologies\n    with XCache v3.1.0, Copyright (c) 2005-2013, by mOo\n    with Zend OPcache v7.0.3, Copyright (c) 1999-2014, by Zend Technologies\n    with XCache Optimizer v3.1.0, Copyright (c) 2005-2013, by mOo\n    with XCache Cacher v3.1.0, Copyright (c) 2005-2013, by mOo\n    with XCache Coverager v3.1.0, Copyright (c) 2005-2013, by mOo\nPHP Fatal error:  Allowed memory size of 1077936128 bytes exhausted (tried to allocate 4294967296 bytes) in /data/dev/www/php/MysqliDb.php on line 628\nfunction getMerchantsofAgents($agent_id){\nglobal $db;\n    //$db->where(\"affiliate_id\",$agent_id);\n    $data = $db->rawQuery(\"SELECT * FROM merchants WHERE affiliate_id = 17\");\n    return $data;\n}\nvar_dump(getMerchantsofAgents('17'));\nsame error.. works for some statements but others no worky...\n. remove longtext type field and make sure your varchar are assigned lengths \n. Looks like if the table has a longtext type field this error will occur.\n. ",
    "varunsridharan": "Try using unique key or using select query and check for the result.\n. @abdul202 if possible can you share that function. ?\n. How ? can you help me\n. i add its now working\nthis can be available for all php version or selected\n. currently i am using 5.2 i am also use it in another version or another server which has different config.\n. @avbdr thanks for your fix ..\n. @bflydesign \nhave u checked the date format and the field names.. ?\n. i think there is no function to check.. but if the credentials in wrong i throws an error\nUpdate\npls try using this\n$db->getInstance();\n. ",
    "abdul202": "Thank you i have made a function to do that\n. i use the follwing code\n function checkStatus($link)\n{\n    global $db ;\n    $db->where('url', $link); // the column name\n    $results = $db->get('harvested_links');  //the table name\n    $num_rows = count($results); // get the number of array elements \n   if ($num_rows > 0) { // If it ran OK, the article is already in database.\n    // Print how many users there are:\n   echo \"we found $num_rows records in database.\\n\"; \n    return true;\n} else { // If no records were returned.\n    echo 'There are no links for this url in database.';\n    return false; \n }\n}\n. yeah i think this will work\ni'm just new to this class\n. Ok thank you\n. Thank you for reply \ni have tried this solution but unfortunately it didn't work\n\nini_set('memory_limit', '-1');\nbut it seems that my client is on shared hosting and he has limited memory 128MB and i think they disabled any  ini_set to be overridden\nThanks\n. they are 17 rows as the following\ni'll try to change the text type to varchar and see maybe that could fix the issue\nPHP Version 5.4.42\n\n| Column | Type | Null |\n| --- | --- | --- |\n| id (Primary) | int(255) | No |\n| sitename | varchar(255) | No |\n| siteurl | varchar(255) | No |\n| sitetitle | varchar(255) | No |\n| time | int(255) | No |\n| email | varchar(255) | No |\n| schema_version | varchar(10) | Yes |\n| template | varchar(255) | No |\n| keywords | text | No |\n| description | text | No |\n| vistis | int(255) | No  0 |\n| sitestate | int(255) | No   0 |\n| sitestatemsg | text | No |\n| analytics | text Yes | NULL |\n| resend_activation_threshold | varchar(150) | Yes |\n| activation | varchar(150) | Yes |\n| language | varchar(250) | Yes |\n. Thank you there was another filed with longtext and after optimizing the database to use less data types the error disappear for now\nthank you for help\n. unfortunately i can't the issue was to one of my customers and he changed the password of the cpanel\n. you are right i should use  update() instead of insert() here\nanyway sometimes i get this error with some queries and to fix it i used Generic Query Method\nnext time when i face the same error i will post all the code here\nThank you for your time and effort\n. ",
    "elvis2": "We are using PHP 5.5.x and got caught but the php version check logic. I read up on PHP.net's issue about this bug and it seems to have only been a problem for 5.2 and 5.3. Should we change the logic to focus on those two versions?\n. ",
    "rajbdilip": "Is there any documentation beside readme.md?\n. Yeah. It does.\nI see the class returns false when the update operation doesn't affect any rows. Shouldn't it be returning true when the operation succeeds?\n. That worked! Thanks! :+1:  :)\n. ",
    "Izopi4a": "because i like the functionality of SANITIZE_STRING and i belive it is php's folth what i do is\n$k = filter_var(str_replace('<', ':lthan', $query), FILTER_SANITIZE_STRING);\n$this->_query = str_replace(':lthan', '<', $k);\n. i am using cirilyc all day long and i dont have problems\nall charset to  your database has to be utf8_general_ci ( i think )\nmake sure you see those \"????\" in the pphmyadmin ( for example ) not in the page itself, cuz it can be two different problems.\nHave fun ;-)\n. +1 for this one, please :-)\n. Hi arieffikhrie,\nI could be wrong... but what I do is\nindex.php\n$db = new MysqliDb(server, user, pass, db);\nfile: /classes/koko.php :\nclass koko {\n  private $DB;\nfunction __construct(){\n    $this->DB = MysqliDb::getInstance();\n  }\n}\ngetIsntance is includeed in the MysqliDb class itself. But you can take the whole idea of static variable keeping isntance to your class and use it for other classes of yours. For example I use it for my smarty and user classes ;-)\n//you can check the class contruct function, basicly it is self::$instance = this; but i am sure you will be allright ;-)\nHopefully this was helpfull. Have a nice day\n. if you down want to create your functions, simply: \n`\n$results = $DB->where('user_id > 1 OR user_id < 10 )')\n```\n                   ->where(\" name = 'koko' OR name = 'toto' \")\n               ->get('users');`\n\n```\n. are u sure it removes it ? I have a lot of issues with getLastquery(), also try \ndb->where( '  (koko=? OR koko = ?  ) AND (toto = ? OR toto = ?) ) ', array(1,2,3,4)) \n. yea I dont know why it is happening, but it is because you have longtext type of column in the DB, i changed mine to med text / text in order to fix it.\nIf someone can dig into it and find out wtf is problem would be nice. \n. How many mysql connections do you actually have ?\nIn my case for my app I got 1.\nDo you use MysqliDb::getInstance() ?\nexecute this query : SHOW STATUS WHEREvariable_name= 'Threads_connected'\nto see how many open connections you got,\nTo see the maximum number of connetions\nshow variables like \"max_connections\";\nhope that helps\n//edit \nThat could also hoppen in some rare cases like .. ( let me try to explain )\nlets say you got 30 GB table, and you are IMPORTING it. So it will take a fair amount of time ( lets say 5 hrs). But meanwhile while you are importing it, you are running \"selects\" from this same table, what will happen in mysql is that it will que all the select queries and mark them as an connection and they all be status = \"waiting\", so if you select 150 times, you will get 150 connections stucked.\n. hmmm, this sintax is wrong.\nI think the real query should be in (INSERT INTO product_data (product_id, data, value) VALUES ('50', 'price', '400', '51', 'price', '401','52', 'price', '402','53', 'price', '403','54', 'price', '404');\nif this is supported by mysqli ( cuz i am not sure ) , there could be a nice implementation i think\n. ```\nprotected function _buildTableData ($tableData) {\n        if (!is_array ($tableData))\n            return;\n        $isInsert = strpos ($this->_query, 'INSERT');\n        $isUpdate = strpos ($this->_query, 'UPDATE');\n        if ($isInsert !== false) {\n        $columns = (isset($tableData['columns']) ? $tableData['columns'] : array_keys($tableData) );\n\n        $this->_query .= ' (`' . implode($columns, '`, `') . '`)';\n        $this->_query .= ' VALUES (';\n        if (isset($tableData['values']))\n               $tableData = $tableData['values'];\n\n```\nso after that we sohuld be able to call the insert method with a sintax like:\n$this->DB->insert('products_data', [\n            \"columns\" => [\"product_id\", \"data\", \"value\"],\n            \"values\" =>  ['50', 'price', '400', '51', 'price', '401','52', 'price', '402','53', 'price', '403','54', 'price', '404']\n        ]);\nor soemthing like that, I dont know :laughing: \n. +1 for the mem cache.\nI could implement it, but I am really busy for the next few months. \nAnyways, I hope i find some time to cook it.\n. ",
    "cybercussion": "Thanks I was running into this with a between dates statement and took me a bit to backtrace why it was an issue.\n. Just ran onto this too.\n. ",
    "ShaunShuk": "Thanks.. Issue solved.. I had old version, but not very old.. it's of last month!\n. ",
    "eGirlAsm": "i have same problem can you tell me how solved the problem?\n. ",
    "ovcharenkovv": "+1\n. ",
    "kevinkaske": "Yes. This would be wonderful!\n. That would be great! If nothing else a composer.json file could just be added to this repo to allow us to add it right from github.\n. ",
    "qaharmdz": "@avbdr \ndoes other feature like rename n drop table also available?\nwhat about the same feature for column?\n. No need to rush, it's just an optional features.\nIt's good enough to know that the lib is still maintained\n. thanks\n. +1 for the multi insert values\n. in __construct() when $host is object, all other variable inluding $this->db is null.\nThis happen to me thus I notice the different.\nFYI, I use v 2.7. ",
    "falahati": "Describe is slow and executing a query per each table when you want to test more than one is a bad idea. So I prefer the one that I usually use in my codes:\n```\npublic function tableExists()\n{\n    $numArgs = func_num_args();\n    if (!$numArgs)\n    {\n        return true;\n    }\n    $args = func_get_args();\n    $this->where('table_schema', $this->db);\n    if ($numArgs == 1)\n    {\n        $this->where('table_name', self::$_prefix . $args[0]);\n    }\n    else\n    {\n        array_walk($args, function(&$value, $key) { $value = self::$_prefix . $value; })\n        $this->where('table_name', $args, 'IN');\n    }\n$this->get('information_schema.tables', $numArgs);\nreturn $this->count == $numArgs;\n\n}\n```\n. ",
    "Proliner": "+1 yes please\n. I have the same problem\n. $this->db->orderBy($field, $direction);\n    if($results = $this->db->get($table, array($offset, $amount))) {\n        return $results;\n    } else {\n        return FALSE;\n    }\n. Thanks that worked!\n. ",
    "bflydesign": "@technofreaky \nI can close the issue...I was so focussing on the data-format I didn't see the where-conditions did not fit a record :( sorry\n. Thx @avbdr but why is this query giving an error? It seems that he doesn't add the subquery to my query... (see errormessage below code)\n```\n    $sub = $db->subQuery();\n        $sub->join('tblPayment p', 'p.ID = pm.PaymentID', 'INNER');\n        $sub->join('tblMember m', 'm.ID = pm.MemberID');\n        $sub->where('p.Year = YEAR(CURDATE())');\n        $sub->where('pm.MemberID = m.ID');\n        $sub->get('tblPaymentMember pm', null, 'pm.MemberID');\n    $db->where(null, $sub, 'EXISTS');\n$db->orderBy('m.Lastname', 'ASC');\n$db->orderBy('m.Firstname', 'ASC');\n$db->groupBy('m.ID');\n$result = $db->get('tblMember m');\n\n```\nERROR: Fatal error: Problem preparing query (SELECT * FROM tblMember m WHERE EXISTS ()) You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ')' at line 1\nPS really like working with the library so far!\n. that is what I should have yes...I copied latest commit (version 18 days ago) and added your patch for 'exisits'.\nThis is the exact query I want:\nSELECT * FROM tblMember m\nWHERE EXISTS (SELECT pm.MemberID \n          FROM tblPaymentMember pm \n          LEFT JOIN tblPayment p on p.ID = pm.PaymentID \n          WHERE p.Year = YEAR(CURDATE()) \n          AND pm.MemberID = m.ID) \nORDER BY m.Lastname ASC, m.Firstname ASC\nWhen using the library I can't access m.ID (last-but-one line) in the subquery without adding an extra join in the subquery cause it's seems the API completely separates head- and subquery (of am I wrong?)\nThat's why, in my previous post, I added:\n$sub->join('tblMember m', 'm.ID = pm.MemberID');\nBut nevertheless, my query is still not building as wanted...\n. I'm sorry, it's still not building...still an error preparing the query. I did a var_dump on this result:\n$result = $sub->get('tblPaymentMember pm', null, 'pm.MemberID');\nAnd I got this back:\narray (size=129)\n      0 => \n            array (size=1)\n            'MemberID' => int 129\n      1 => \n            array (size=1)\n            'MemberID' => int 132\n      2 => \n            array (size=1)\n            'MemberID' => int 253 ...\nSo the subquery is working fine seperately\n. 5.4.12 through WampServer\n. Result of the print_r($db)\n```\nMysqliDb Object\n(\n    [_mysqli:protected] => mysqli Object\n    (\n        [affected_rows] => 0\n        [client_info] => mysqlnd 5.0.10 - 20111026 - $Id: e707c415db32080b3752b232487a435ee0372157 $\n        [client_version] => 50010\n        [connect_errno] => 0\n        [connect_error] => \n        [errno] => 0\n        [error] => \n        [error_list] => Array\n            (\n            )\n    [field_count] => 0\n    [host_info] => bflydesign.no-ip.org via TCP/IP\n    [info] => \n    [insert_id] => 0\n    [server_info] => 5.1.36\n    [server_version] => 50136\n    [stat] => Uptime: 1103469  Threads: 2  Questions: 38543  Slow queries: 0  Opens: 9683  Flush tables: 1  Open tables: 45  Queries per second avg: 0.34\n    [sqlstate] => 00000\n    [protocol_version] => 10\n    [thread_id] => 7057\n    [warning_count] => 0\n)\n\n[_query:protected] => \n[_lastQuery:protected] => \n[_join:protected] => Array\n    (\n    )\n[_where:protected] => Array\n    (\n        [0] => Array\n            (\n                [0] => AND\n                [1] => Array\n                    (\n                        [EXISTS] => MysqliDb Object\n                            (\n                                [_mysqli:protected] => mysqli Object\n                                    (\n                                        [affected_rows] => -1\n                                        [client_info] => mysqlnd 5.0.10 - 20111026 - $Id: e707c415db32080b3752b232487a435ee0372157 $\n                                        [client_version] => 50010\n                                        [connect_errno] => 0\n                                        [connect_error] => \n                                        [errno] => 0\n                                        [error] => \n                                        [error_list] => Array\n                                            (\n                                            )\n                                    [field_count] => 1\n                                    [host_info] => bflydesign.no-ip.org via TCP/IP\n                                    [info] => \n                                    [insert_id] => 0\n                                    [server_info] => 5.1.36\n                                    [server_version] => 50136\n                                    [stat] => Uptime: 1103469  Threads: 2  Questions: 38543  Slow queries: 0  Opens: 9683  Flush tables: 1  Open tables: 45  Queries per second avg: 0.34\n                                    [sqlstate] => 00000\n                                    [protocol_version] => 10\n                                    [thread_id] => 7058\n                                    [warning_count] => 0\n                                )\n\n                            [_query:protected] => \n                            [_lastQuery:protected] => \n                            [_join:protected] => Array\n                                (\n                                )\n\n                            [_where:protected] => Array\n                                (\n                                )\n\n                            [_orderBy:protected] => Array\n                                (\n                                )\n\n                            [_groupBy:protected] => Array\n                                (\n                                )\n\n                            [_bindParams:protected] => Array\n                                (\n                                    [0] => \n                                )\n\n                            [count] => 129\n                            [_stmtError:protected] => \n                            [host:protected] => bflydesign.no-ip.org\n                            [username:protected] => bflydesign\n                            [password:protected] => Bfly81mysql\n                            [db:protected] => hijw_be\n                            [port:protected] => 3306\n                            [isSubQuery:protected] => \n                        )\n\n                )\n\n            [2] => \n        )\n\n)\n\n[_orderBy:protected] => Array\n    (\n        [m.Lastname] => ASC\n        [m.Firstname] => ASC\n    )\n[_groupBy:protected] => Array\n    (\n    )\n[_bindParams:protected] => Array\n    (\n        [0] => \n    )\n[count] => 0\n[_stmtError:protected] => \n[host:protected] => \n[username:protected] => \n[password:protected] => \n[db:protected] => \n[port:protected] => 3306\n[isSubQuery:protected] => \n```\n)\n. that returns nothing...\nThe WHERE ID IN (SELECT) is facing the same issues...\nWhen coming home I'm gonna sync the project onto my NAS-webserver and see if it works there.\n. After patch still the same issues: \nFatal error: Problem preparing query (SELECT * FROM tblMember WHERE EXISTS () ORDER BY m.Lastname ASC, m.Firstname ASC ) You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ') ORDER BY m.Lastname ASC, m.Firstname ASC' at line 1\n. I get this as return:\nmain query\nmain query\n. I get no return either. Only the same error with a query and an empty subquery\nFatal error: Problem preparing query (SELECT * FROM tblMember WHERE EXISTS () ORDER BY m.Lastname ASC, m.Firstname ASC )\nThis is the query I still use:\n```\n$sub = $db->subQuery();\n        $sub->join('tblPayment p', 'p.ID = pm.PaymentID', 'INNER');\n        $sub->join('tblMember m', 'm.ID = pm.MemberID');\n        $sub->where('p.Year = YEAR(CURDATE())');\n        $sub->where('pm.MemberID = m.ID');\n        $sub->get('tblPaymentMember pm', null, 'pm.MemberID');\n$db->where(null, $sub, 'EXISTS');\n$db->orderBy('m.Lastname', 'ASC');\n$db->orderBy('m.Firstname', 'ASC');\n$result = $db->get('tblMember');\n```\n. I suppose there is one } short after \"return;\"\nI get:\n```\nmain query 'bflydesign.xxx' 'bflydesign' 'hijw_be'\nmain query 'subquery' 'bflydesign' 'hijw_be'\nWarning: mysqli::mysqli(): php_network_getaddresses: getaddrinfo failed: No such host is known\n...and some other warnings\n```\nI also see this as error:\nFatal error: Problem preparing query (SELECT pm.MemberID FROM tblPaymentMember pm INNER JOIN tblPayment p on p.ID = pm.PaymentID INNER JOIN tblMember m on m.ID = pm.MemberID WHERE p.Year = YEAR(CURDATE()) AND pm.MemberID = m.ID)\nSo the subquery builds correctly\n. I get: \nmain query '' '' ''\nmain query '' '' ''\nAnd offcourse an error that he can't connect to the db\nIn this piece of code there is one closing-tag } short. Where do I put it? Before or after the echo \"main query\" ?\nif ($host == null && $username == null && $db == null) {\n    if ($dbHost == \"subquery\") {\n        $this->isSubQuery = true;\n        echo \"subquery\\n\";\n        return;\n    }\n    echo \"main query '{$dbHost}' '{$dbUsername}' '{$dbName}'\\n\";\n. I found the solution (with a little help from my collegue - in case he's reading this too :) )\npublic static function subQuery()\n   {\n       $temp = new MysqliDb();\n       $temp->isSubQuery = true; \n       return $temp;\n   }\nWhen we follow all steps, we see that in subQuery() you create a new instance of the class MysqliDb.\nThen you write this:\nif ($host == null && $username == null && $db == null) {\n    if ($dbHost == \"subquery\") {\n        $this->isSubQuery = true;\n        return;\n    }\n}\nBut in my opinion that can never be true cause a new instance always sets your $host, $username and $db as written in the constructor-parameters. So $this->isSubQuery always stays false and the subquery gets executed before it can be merged with the mainquery.\nThat's the reason why I couldn't access m.ID in my subquery and therefor needed to add an extra join on the tblMember m in my subquery although my mainquery is in tblMember. That didn't make sense.\n```\n$sub->where('m.ID = pm.MemberID); --> this will not work, I needed to add a separate join on tblMember\n$sub->get('tblPaymentMember');\n$db->get(null, $sub, 'EXISTS');\n$db->get('tblMember m');\n```\n. I think I know where my mistake is. I replaced the null-values in the constructor parameters.\npublic function __construct($host = \"bflydesign.xxx\", $username = \"bflydesign\", $password = \"xxxxxxx\", $db = \"hijw_be\", $port = NULL)\nI did this so I don't have to fill in those values everytime I want to establish a connection...\nI'm gonna make an extra function to set these parameters and leave the constructor as it was...\nSorry to let you search for this...I should have added this line so you could see my mistake:\n$db = new MysqliDb();\n. ",
    "fatihtoprak": "it doesnt work for me .\n. now total page numbers display correctly what about the paginate links ? thanks.\n. @PetengDedet thanks for the simple tip. ;)\n. sound awesome ;)\n. ",
    "afuno": "Thank U. Tried many classes today. You turned out to be the best.\n\u0412\u043a\u043b\u044e\u0447\u0435\u043d\u043e 16 \u044f\u043d\u0432\u0430\u0440\u044f 2015 \u0433. \u0432 21:49:59, Peteng Dedet (notifications@github.com) \u043d\u0430\u043f\u0438\u0441\u0430\u043b:\nHi, checkuout my pagination function\nhttps://github.com/PetengDedet/PHP-MySQLi-Database-Class/blob/master/pagination.php\n\u2014\nReply to this email directly or view it on GitHub.\n. It's cool.\u00a0Thank you again. I will try to use this class maximum.\n\u0412\u043a\u043b\u044e\u0447\u0435\u043d\u043e 16 \u044f\u043d\u0432\u0430\u0440\u044f 2015 \u0433. \u0432 23:11:00, Mystery-X (notifications@github.com) \u043d\u0430\u043f\u0438\u0441\u0430\u043b:\nLooks like function options like \"$db->func('SHA2(?,512)',Array ($password))\" are limited to insert and update.\nWould it be positble to use it in where function too? like $db->where ('user_pass', $db->func('SHA2(?,512)',Array ($password)));\n\u2014\nReply to this email directly or view it on GitHub.\n. Use foreach :)\n. ",
    "cb06055": "Hei Alex, I am basically a newbie in php. Would wait for your patch i guess :(\n. ",
    "arieffikhrie": "Hi, thx for the reply.\nbut what i want i to create mysqlidb using mysqli object itself..\n. Hi, \ni think you can use limit option when calling get function\n```\n$table= 'table_name';\n$limit = array(20, 200); \n$db->get($table, $limit);\n```\nit will produce query of\nSELECT * FROM table_name LIMIT 20,200\n. This one also work.\n$db->where($field, $something.'%', 'LIKE');\n. Thanks\n. Ok cool.. Will waiting for that\n. can you try this?\n$con = new mysqli('localhost', 'user', 'pass', 'demo');\n$db = new MysqliDb($con)\n. ",
    "wilpet": "No, I'm afraid that does\u00b4t work. I guess the second variable in get function is expected to be an int. I tried to send the string '10, 10', but I keep getting the first lines anyway.\nGuess I have to go with the raw query for now.\nThanks for you help. \n. Sorry, my wrong. Got an old version from my co-worker. Sorry to have troubled you.\n. ",
    "tenfourzero": "Same for me; mine was also missing ORDER BY text.\nI found that the replacePlaceHolders() function was not appending the SQL query with any left over SQL after binding the final variable (e.g. after the last WHERE field).\nAdd the text $newStr .= $str just before the return command at the end of the function:\nphp\n}\n$newStr .= $str;\nreturn $newStr;\nIncluded in my catch-all pull request.\n. The script uses prepared SQL statements & PHP's MySQLi API to help prevent injection.\nThere's no single measure you can take to prevent injection/XSS but if you strictly sanitise user input then this script should do what you ask.\n. magicmind; you should only select the fields you really need. But in answer to your question, just use byFd's suggestion but prepend with a wildcard:\nphp\n$grupos = $dbAgil->get('sys_users su', null, '*, sg.design as sg_design, sue.design as sue_design');\nYou will get duplicate fields twice (original field name and alias name). Alternatively, list all the fields individually :)\n. Your code looks and works fine for me when tested. \n. ",
    "PurpleSunnrise": "Good evening, \nI made the mistake of command Between getting extra access, integrate instead of him in the join command directly. \nBut it works. \nMany thanks to the quick response \nFrom: byFd \nSent: Friday, October 24, 2014 5:02 PM\nTo: joshcam/PHP-MySQLi-Database-Class \nCc: PurpleSunnrise \nSubject: Re: [PHP-MySQLi-Database-Class] How can I implement the following code to this class? (#157)\nWell, what have you got so far?\nI would try something like this, not sure if it works ;)\n$db->join(\"tree n\", \"o.lft BETWEEN n.lft AND n.rgt\");\n$db->join(\"tree p\", \"o.lft BETWEEN p.lft AND p.rgt\");\n$db->where(\"n.id\", 2);\n$db->groupBy(\"o.lft\");\n$db->orderBy(\"o.lft\");\n$db->get(\"tree o\", NULL, \"o.name, COUNT(p.id) - 1 AS level\");\n\u2014\nReply to this email directly or view it on GitHub.\n. Sorry my english is not very good.\nI get no result.\nA user in the database that has the exact 25000.000000000000 activepoints.\nWith this query, the user should be displayed.\nBut it appears no result\nIf I instead\n$db-> where (\"activepoints\", $rallyPointsMinRAP, \">=\");\nthis\n$db-> where (\"activepoints\" >= \"$rallyPointsMinRAP\"\");\nuse, a user of the activepoints has 25000.000000000000 is displayed\nEdit: Du kommst aus Deutschland?\nDann Detsche kurzform.\nDatenbank Spalte ist auf Decimal(30,12) gestellt.\nEs sollen nun User, die mindestens 25000 activepoints haben aus der Datenbank geholt werden.\nMit der obrigen abfrage holt er aber keine User aus der Datenbank.\n\u00c4ndere ich die Abfrage in \n$db-> where (\"activepoints\" >= \"$rallyPointsMinRAP\"\");\ngeht es. Ist aber nicht so der Sinn eigentlich?\n. I have the same Problem\n. ",
    "abusalam": "No\n. ",
    "KTP95": "ehm, I had not thought, are a beginner\nhorever problem persists... \ndb->where('( ... ? ...condition ..?.. )' ,array(x,y) );\nautoremove last )\n. confirm\nFatal error: Allowed memory size of 134217728 bytes exhausted (tried to allocate 4294967296 bytes) in /var/www/xxxxxxxx/public_html/wp/xxxxxx/MysqliDb.php on line 628\n. I see better,\nis the same error that here\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/pull/119\nsolution: (with fast test it work, but please try better).\nedit LINE 625 in MysqliDb.php:\n```\n    // avoid out of memory bug in php 5.2 and 5.3\n    // https://github.com/joshcam/PHP-MySQLi-Database-Class/pull/119\n    if (version_compare (phpversion(), '5.4', '<'))\n         $stmt->store_result();\ncall_user_func_array(array($stmt, 'bind_result'), $parameters);\n\n```\nin \n```\n    // avoid out of memory bug in php 5.2 and 5.3\n    // https://github.com/joshcam/PHP-MySQLi-Database-Class/pull/119\n    $stmt->store_result();\ncall_user_func_array(array($stmt, 'bind_result'), $parameters);\n\n```\n. I Think you can with rawQuery Method , i not sure about this.\n$db->rawQuery(\"select * from users where username = $user\");\n. horever please note that rawQuery without bind parameter can be a bad idea in login form, I invite you to read some article/documentation about SQL Injection https://it.wikipedia.org/wiki/SQL_injection\nitalian,\nCiao fratello, :-)\n. https://github.com/joshcam/PHP-MySQLi-Database-Class/pull/392\nDone\n. no...not have contructor\nThis is all...\n```\nclass MyObject extends dbObject {\nprotected $dbTable = 'table';\nprotected $primaryKey = 'ID';\nprotected $dbFields = array(\n'ID'                => array('int'),\n\n);\nprotected $relations = array(\n    --------\n);\n}\n```\n. I Don't need check $object->error because it produce a fatal error:\n$nfile = new file;\n$nid = $nfile->save();\nprint:\n```\n\nFatal error:  Uncaught exception 'mysqli_sql_exception' with message 'Column count     doesn't match value count at row 1' in ...MysqliDb.php:1472\nStack trace:\n0 ...MysqliDb.php(1472): mysqli->prepare('INSERT  INTO prefix_...')\n1 ...MysqliDb.php(1090): MysqliDb->_prepareQuery()\n2 ...MysqliDb.php(1037): MysqliDb->_buildQuery(NULL, Array)\n3 ...MysqliDb.php(628): MysqliDb->_buildInsert('files', Array, 'INSERT')\n4 ...dbObject.php(236): MysqliDb->insert('files', Array)\n5 ...dbObject.php(278): dbObject->insert()\n6 ...run-from-this-file.php(21): dbObject->save()\n7 {main}\nthrown in ...MysqliDb.php on line 1472\n```\n. Anyway, i really don't want insert blank object in database, but only I show This bug and want report It.\nMaybe Other people need this..\n. uhm, year...alright,\nBut...on object joined with method \"Join\" don't WITH() , not work...\nexample\n    $file = file::with('realFile')->ById($fileId);\n    print_r((int)(bool)$file->realFile);\nalso when $file->realFile not exists print 1,\nrelation File -> fileReal is HasOne type,\n.... you can fix this maybe by checking if PrimaryKey is set in $fileReal object and if no, set it to null\n. So, from what I understand you intention was return null object if not exists...\nso, i Write this fix.\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/pull/395\n. Sorry, i has writen this over 1 year ago, my memory is lost.... Yeah, i have the last build with composer,\n *  version   2.6-master. ",
    "vesper8": "Can you please push it to master... I too need this one.\n. I haven't tried this using this wrapper, but I've faced this problem before and I think just running this at the top of each page is one way to make sure the timezone is properly set. The other way is to set it to what you want in your mysql config file.\ndb->rawQuery('SET time_zone=?', Array (''+0:00'')); // This set the timezone to UTC\n. Have you checked what $db->getLastQuery(); contains after running the query, and comparing that sql to the raw query?\n. ",
    "septyaman": " $db->where ('rowname', 'condition_or_value'); \n. ",
    "SanMane": "Do this; One query :smiley: \nphp\n$db->where ('id', 1)->update ('users', $data);\n. Meanwhile, why dont you try this\nphp\n$array = array(\"FirstName\"=>\"abc\", \"LastName\"=>\"xyz\");\n$object = (object)$array;\necho $object->FirstName;\nthis works!!\n. Or you can update rawQuery method which is on line 212 \nto convert \"array\" to \"object\" as mentioned in comment above!!!\n. not quality coding!!\n. my pleasure @andreadompe \n. ",
    "thingNumber1": "Thanks. \n. Are you still planning to support that?\n. If usefull for someone, that how to solve the problem:\nFIND (line 1096 in my file, in function _buildDataPairs):\nif (!$isInsert) {\n    $this->_query .= \"`\" . $column . \"` = \";\n}\nREPLACE IT FOR:\nif (!$isInsert) {\n    if(strpos($column,'.')===false){\n        $this->_query .= \"`\" . $column . \"` = \";\n    }else{\n        $this->_query .= str_replace('.','.`',$column) . \"` = \";\n    }\n}\n. Well... It's my first time creating a Pull Request. I don't know how to upload my file or the right way to create it.\n. Using var_dump ($db_stats->getLastError()); exit; I see string(0) \"\".\nI know that's weird but this is exactly the reason I came here... If I exit the script before the redirection the UPDATE works well... =S\n. Man! This didn't solve directly the issue, but it was the prove that I was taking a wrong approach. The library has being successfully executing the UPDATE before the redirection. The problem was that after the redirection the data have been getting updates again in the new location with empty values; and this is why I thought there were no update.\nI am sorry for coming to the wrong place, but anyway I really apreciate you help. Thanks.\n. ",
    "magicmind": "Ok, thanks. I thought that would just give me those two fields, not all the\nfields with those two modified.\n2014-12-18 8:19 GMT+00:00 Chris notifications@github.com:\n\n$grupos = $dbAgil->get('sys_users su', null, 'sg.design as sg_design, sue.design as sue_design');\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/176#issuecomment-67454489\n.\n. NO it isn't It is actually a good practice to list every field required in\na query.\nBut there are some situations when that is not wanted.\nCan we use a * or a % for fields?\n\n2014-12-18 11:03 GMT+00:00 Chris notifications@github.com:\n\nit only gives you the ones you list. It is not bad to list all the ones\nyou need. often times you don't need all the fields for every query, so you\ncould save some query time with only selecting the fields you need.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/176#issuecomment-67471344\n.\n. t2mgroup, I don't have difficulties in reading thanks.. that's is why I asked \"HOW TO\"...\nThe problem is that, if you care to read the above replies from byFD and myself, I didn't want to list ALL fields by hand... I just wanted to get ALL fields normally and the ones I modified, modified.\n\nI know it can be hard to understand... ;)\nThanks for your answer.\n. Egg, that is a nice solution. Thanks.\nEm 18/12/2014 14:21, \"Egg\" notifications@github.com escreveu:\n\nmagicmind; you should only select the fields you really need. But in\nanswer to your question, just use byFd's suggestion\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/176#issuecomment-67454489\nbut prepend with a wildcard:\n$grupos = $dbAgil->get('sys_users su', null, '*, sg.design as sg_design, sue.design as sue_design');\nYou will get duplicate fields twice (original field name and alias name).\nAlternatively, list all the fields individually :)\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/176#issuecomment-67491543\n.\n. Yeap.\nMy bad on this.\nEm 18/12/2014 14:40, \"Egg\" notifications@github.com escreveu:\nYour cooks and works fine for me when tested.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/177#issuecomment-67494153\n.\n. \n",
    "t2mgroup": "seem you have hard time reading. https://github.com/joshcam/PHP-MySQLi-Database-Class/#select-query\nby default get() returns all fields. \nuse get(\"tableName\", null, \"field1, field2 as field3, count(*) as field4\") to retrieve the needed fields.\n. ",
    "ang3lx": "hello! i've solved problem :)\nit is very simple.\nyou should add \n$stmt->store_result();\nafter\n$stmt->execute();\nnow seems that action with long query works without problems \n. ",
    "Mystery-X": "When i try it like you sugested avbdr i get this error :\nFatal error: Problem preparing query (SELECT * FROM admin_users WHERE user_login = ? AND user_pass = SHA2 (?,512) LIMIT 1) Illegal mix of collations (latin1_swedish_ci,IMPLICIT) and (utf8_general_ci,COERCIBLE) for operation '=' in /var/www/domains/predb.homeip.net/public_shtml/libs/MysqliDb.php on line 863\n. Is there a way to tell the class to use charset latin1_swedish_ci because i think it's hardcoded to utf8 now?\n. i commented it out and it works now, thx\n. ",
    "leigh-ols": "Although the suggested method works it would be nice to be able to do something like:\nphp\n$pass = $db->func('SHA2(?,512)', array($password));\n$db->where('password', $pass);\nSomething like this would allow dynamic encoding of certain fields:\n```php\nclass DBTest\n{\n    /\n     * Array of field keys that should always be encoded\n     \n     * @var array\n     /\n    protected $encoded_fields = array('password');\n/**\n * Generic select method\n *\n * @param array $where_values Array('field_name', 'value');\n *\n * @return void\n * @access public\n */\npublic function selectWhere($where_values) {\n    $where_values = $this->encodeData($where_values);\n\n    foreach ($where_values as $k => $v) {\n        $this->db->where($k, $v);\n    }\n}\n\n/**\n * encodeData\n *\n * @param array $data Array('field_name', 'value')\n *\n * @return array\n * @access public\n */\npublic function encodeData($data)\n{\n    foreach ($data as $k => $v) {\n        if (in_array($k, $this->encoded_fields)) {\n            $data[$k] = $this->db->func('SHA2(?, 512)', array($v));\n        }\n    }\n\n    return $data;\n}\n\n}\n$db_test = new DBTest();\n$db_test->selectWhere(array('username' => $user, 'password' => $pass));\n```\nThis type of thing is already possible with inserts and updates, but not at present easily accomplished with clauses.. Ugh,... this is still an issue. It appears my solution only half fixed the problem.\nORDER BY fields that contain spaces need to be wrapped with backticks in order for mysql to correctly sort the results.\nCould we get this re-opened please?. This is more complex than it first appears. Simply wrapping backticks around the field will not work, because you can have multiple comma separated columns resulting in `date,name` when what you wanted was `date`,`name`.\nWe could explode this on the , and trim any whitespace to solve this, but we also have to consider a.date,b.name which would result in `a.date`,`b.name`, which is also wrong. \nTo fix this we could then explode the already exploded results on a . to get a.`date`,b.`name` Which is correct until we try something like: My.Field.Alias, or My,field,alias which would get incorrectly exploded and wrapped.\nTo keep things simple we could explode on , and then preg_match each field for certain characters like whitespace, and if they match then wrap in backticks. I'm testing this method now and it appears to work throughout the codebase i'm using. I'm not sure if this is a safe enough assumption to make in the public domain though?\nUltimately what we want is to end up with results like this:\nORDER BY `date`\nORDER BY `date`,`name`\nORDER BY a.`date`,b.`name`\nORDER BY `Start Date`, `End Date`\nORDER BY `Start,Date`,`End.Date`\nThe final approach almost achieves this (except for the final one) but makes the assumption that if a field contains a space it needs to be backticked, otherwise it doesn't.\nI'm curious to hear what others here think is the best approach.\n. ",
    "abelvieira": "works fine. I use it\n. ",
    "gomcodoctor": "thanks a lot :)\n. ",
    "FoxxMD": "I understand your point but I think I need to clarify what I mean by validate data type. \nTaken from the php manual\n$stmt = $mysqli->prepare(\"INSERT INTO CountryLanguage VALUES (?, ?, ?, ?)\");\n$stmt->bind_param('sssd', $code, $language, $official, $percent);\nThe types of data mysql expects for this statement are determined by the letters in the first argument passed. i is integer, d is double, and s is string. In the statement above sssd so string, string, string, double. \nIn the library _determineType already figures out what type of data is being passed in and builds up that string of types before calling bind_param. What I'm asking for is a way to pass sssd to rawQuery and then performing a simple equality check to see if the expected types (that I passed) match the string built by _determineType.\nWith a relatively simple check you can get data type enforcement in sql for your queries.\n. ",
    "MikeLund": "Any update or suggested use for this @avbdr? Most recent comment from last year seems really useful, and IMO is within the scope of this library... :)\n. ",
    "ishraaq21": "I am using prepared mysqli for the first time. I don't know much about it. I've tryed to edit the class to return objects with no luck.\nAlso I want to know,\nWhy its necessary to return multidimentional array? What would happen (or which data would I miss) if its a simple array? \nI want objects as I don't have to write much codes (e.g $x['z'] > $x->z in letters) So how its possible to get an object from the class?\n. The problem is, Im using phone as Im out of my home now. So every time I have to update script, then open in browser to check what has done. And this is painful process for debugging, it should be real time with an ease editing facility. Thats why I asked. But you are right, I didn't look deeper for sql things, as freely available libraries can do it easily.\nSo thats mean, there is no other ways to get an object with this method?\nThanks in advance.\n. ",
    "Ettemlevest": "Sorry for the duplicate. Then I will use your rawQuery() method that works well for me in this situation.\n. After I removed the ->where line from the subquery it worked as expected. Thanks for your great work!\n. I'm really sorry for the late response I did not have any internet access in the last couple of weeks.\nJust now I tested your patch it seems this solved this problem.\n. Thanks for the reminder. I added a small description to the readme.\n. I just added the errno parts after every $_stmtError lines but I did not check to reset the values. In this case we should also reset the $_stmtError string.\n. Added more error numbers to exceptions. There are 16 exception throws but not all can have mysql error number. Like the exceptions thrown in inc() or dec() methods.\nHope I didn't left out any important part.\n. ",
    "weha": "Looking good, thanks!\n. Thank you for your quick replies and fixes.\nWhile it is a nice addition to have the charset as a variable it does not really fix the issue.\nThis might however not be a bug in this class but a misunderstanding in how the charset works?\nIf I use your fork I again get garbled names unless I set your $charset variable to NULL, am I doing it wrong?\n. It is actually utf8 but utf8_swedish_ci, when I set it to this value instead of just utf8 it works like it's supposed to.\nMaybe it is best to default this to null instead of actual value so you can override it as setting it would be the exception instead of the other way around.\nJust my 2 cents, thank you for your assistance.\n. PHP:\n$dbi = new MysqliDb ($dbhost, $dbuser, $dbpass, $dbname,null,null);\n$dbi->where('ip.trans',NULL,'<=>');\n$trans_range = $dbi->get('table ip',null,'YEAR(date) AS year');\ngetLastquery: SELECT YEAR(date) AS year FROM table ip WHERE ip.trans <=>\nOther question: is it possible to use \"IS NOT\"? If I use \"IS NOT\" as operator I get WHERE ip.trans IS NOT ? (with or without quotes)\n. 2.4, downloaded 3 days ago\n. You are correct sir, I forgot the array part.\nMaybe a feature request then, when it's a string convert to array?\nAnyway, case closed.\nThank you\n. ok so I stripped down my php.\nWhat I think it might be is when copy() is used and some variables are not cleared in the class internally from the previously executed query.\nI've attached a zip with 3 scripts where 1 fails and 2 don't.\nFor it to fail you require a normal query and 2 queries which use copy()\nIf one is commented out, you get a close error at the end of the script (after echo done):\n Warning: mysqli::close(): Couldn't fetch mysqli in MysqliDb.php on line 1497\nI did leave a part out in my last post which I forgot, it says more than just problem preparing query:\nWarning: mysqli::prepare(): Couldn't fetch mysqli in MysqliDb.php on line 1472\nWarning: MysqliDb::_prepareQuery(): Couldn't fetch mysqli in MysqliDb.php on line 1473\nFatal error: Uncaught exception 'Exception' with message 'Problem preparing query (SELECT COUNT(members.id) AS retval FROM members LIMIT 1) ' in MysqliDb.php:1475 Stack trace: #0 MysqliDb.php(1090): MysqliDb->_prepareQuery() #1 MysqliDb.php(550): MysqliDb->_buildQuery(1) #2 MysqliDb.php(598): MysqliDb->get('members', 1, 'COUNT(members.i...') #3 test.php(16): MysqliDb->getValue('members', 'COUNT(members.i...') #4 {main} thrown in MysqliDb.php on line 1475\nI hope this helps, for the script you just need an empty table so you can change it to whatever test database you have or create a table called members with the column id.\nphp.zip\n. That works, thanks! \n. $dbi->func('DATE(NOW())') does not work either.\nEven when it would give a full datetime, it should show that in the resulting query, should it not?\nI'm making PHP do the date part now so I'm good. :)\n. ",
    "ojoven": "Hey Josh, not sure yet what the problem was.\nAs a workaround, I just overwrote the get() function's bind results call with this:\n```\nprotected function _bindResultsSelect(mysqli_stmt $stmt) {\n$results = array();\n$result = $stmt->get_result();\nwhile ($row = $result->fetch_assoc()) {\n    array_push($results,$row);\n}\nreturn $results;\n\n} \n```\nI think this issue will surely be caused by a particular feature on my side, so please don't worry at all.\nThanks man and good job!\n. ",
    "sopheak-ket": "Thank you very much for fixed this error\n. I tried to find solution but get nothing.\nI'm just do simple query data from view. it's not many sql queries in some loop.\nBut why I Select data without prepared statement it work fine.\n. ",
    "ishr00m": "Interested also. \n\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e \u0441 \u043c\u043e\u0435\u0433\u043e ASUS\n-------- \u0418\u0441\u0445\u043e\u0434\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 --------\n\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u044c:Eduardo Iglesias notifications@github.com\n\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0435:Thu, 05 Mar 2015 08:27:21 +0500\n\u041f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u044c:joshcam/PHP-MySQLi-Database-Class PHP-MySQLi-Database-Class@noreply.github.com\n\u0422\u0435\u043c\u0430:[PHP-MySQLi-Database-Class] To many connections (#206)\n\nHi, I'm trying to run a php file that runs another php file, this happens about 100 times.\neach time y open a new DB connection, but before calling the next php file I close the last one like this\n$db = null;\nand I'm getting this message\n'Too many connections in libs/MysqliDb.php on line 140'\nAny idea how to solve it?\n\u2014\nReply to this email directly or view it on GitHub.\ufffc\n. And my 2 question is how to make case sensetive query - only by raw query?\n. Sorry, it was just problem of max length. I just set bigint(20) and it's fine now.\n. It's quite nice to use bigint for now! Thanks, it's closed.\n. Thanks but this is errors. I need full query log.\n. The best case if i can show all queries in the bottom of the page.\n. @nikkyandrei Thank you very much! It works fine now!\n. \n",
    "alexa026": "Thank you, will give it a try.\n. Still getting \"PHP Fatal error:  Problem preparing query \", call looks like rawQuery($this->sql, false);\n. Tried that already, still the same.\n. That is not possible http://pastebin.com/F1fu9h8f\n. Right now I'm getting syntax error, even if every single one of queries is executed correctly separately. \n. Very well, thank you for your time.\n. ",
    "AlainD-": "+1\nI would like that too please.\nThanks.\n. ",
    "1banerjeesuman": "Hi @avbdr ,\nThank you for replying. :smile:\nYes, you are correct. probably I had some issues with the code.\nSo, I isolated the set of code to another page and tested it. The result it is showing now is correct. But the problem is when I echo $database->getLastQuery(), it echoes nothing.\nDoes this class support getLastQuery() object for rawQuery()?\nHere is the set of code I am testing with...\n$activeProjectsInformationDBParameters = array(10001,8);\n$activeProjectsInformation = $database->rawQuery(\"SELECT * FROM Projects WHERE memberID = ? AND statusCode = ?\", $activeProjectsInformationDBParameters);\necho 'The last query processed is: '.$database->getLastQuery();\nand here is the output:\n\n. ",
    "andreadompe": "In the end i did something like this:\nif ($result = $database->rawQuery(\"SELECT * FROM members WHERE username = ? LIMIT 1\",     $params)) { \n     $result = self::userobj_from_array(array_shift($result));\n}\nWhere userobj_from_array is\n```\npublic static function userobj_from_array($record) {\n    return self::instantiate($record);\n}\nprivate static function instantiate($record) {\n    $object = new self;\n    foreach ($record as $attribute => $value) {\n        if($object->has_attribute($attribute)) {\n            $object->$attribute = $value;\n        }\n    }\nreturn $object;\n\n}   \nprivate function has_attribute($attribute) {\n    $object_vars = $this->attributes();\n    return array_key_exists($attribute, $object_vars);\n}\n```\n. I see, you did in 3 rows what i did in 200 \nhe he he\nThanks a lot SanMane\n. ",
    "biswajitpaul01": "How can I change default returnType from array to object? I need to fetch all results as object not as array. I did not like to add ->objectBuilder() for each query.. Thanks. I got it.. ",
    "mbdmt": "In the connect () the last to join this:\nmysqli_query($this->_mysqli,\"set TIME_ZONE='+08:00'\");\n. Thank you!\n. The problem has been solved.\nuse setQueryOption()..... ",
    "ricwein": "Hey,\nit's probably not a problem with the MySQLi Class but with your database variable type for the 'uIP' row. As mentioned in your linked thread, the maximum size of a INT for MySQL is \"2147483647\".\nYou can simply try using BIGINT instead. Maybe also unsigned INT would do the trick, but you need to convert your ip first:\nphp\n$LongIp = ip2long ($_SERVER ['REMOTE_ADDR']);\n$uIP = sprintf('%u', $LongIp);\nedit:\ndamn, too slow :laughing: \n. or you can use something like this:\nphp\n$sql->where('name', '%' . $q . '%', 'LIKE');\n$sql->orderBy('id');\n$user = $sql->get('users', 5, ['id', 'name']);\nalso see issue #168\n. It should be enough, to add a single space in before the $operator at L1399.\nphp\n} elseif ($val === null) {\n    $this->_query .= ' ' . $operator . ' NULL';\n}\nPatch: is_null.patch\n. Sure, done: #457\n. I don't know about a present realtime (or befor execution) solution, but you can fetch the generated query after executing it with $db->getLastQuery();. Also see the readme section for helper methods\nphp\n$db->get('users');\necho \"Last executed query was \". $db->getLastQuery();\n. it also possible to pass an offset to the default get() method, without using rawQuery(). Just pass an array with offset and limit as the second parameter.\nphp\n$db->get('users', Array(2, 3));\n. Just use the rawQuery() method like mentioned in the Readme:\nphp\n$db->rawQuery('email1 IN ? OR email2 IN ?', Array($emailList1, $emailList2));\n. oh yes sorry, didn't recognize, that you just want to write the where statement as raw.\n. you can use the where method with the third argument, see: #478:\nphp\n$db->where('IP', '%' . $IP . '%', 'like');\n. It's currently not implemented, but you can use transactions to improve overall insert-performance for multiple statements. Also see Issue #483 and #208.\n. I guess, @premento means inserting several datasets at once into a database like:\nphp\n$data = [\n  ['username1', $id1, 'password_hash1'],\n  ['username2', $id2, 'password_hash2'],\n];\n$db->insert('users', $data);\nwhich is currently not supported. An array_merge() doesn't help with that at all.\n. You can use transaction like described in the Readme. It should work with something like:\n``` php\n$success = true;\n$db->startTransaction();\nforeach($data as $dataSet) {\n   if (!$db->insert ('tableName', $dataSet)) {\n // something went wrong\n\n  $db->rollback();\n  $success = false;\n  break;\n\n}\n}\nif ($success) {\n    $db->commit();\n}\n```\n. If I'll find the time, I'll take a look at implementing a multi-dataSet insertion feature later today, if @avbdr has no problem with that.\n. See merge request #504\n. Reverting the spacing changes might by a problem I look into tomorrow.\nI just removed some empty lines and unnecessary comments to make the actual method smaller.\nI'm not sure what you mean by \"insertMulti() will never return false. Seems after rollback you would need to return false\". The current behavior is to return an array in success, and false in error case, also after rollback.\nActual getLastError() isn't affected by a rollback(), so this should be no problem.\n. I've reverted all whitespace related changes with the last commit. Anything else to do?\n\nwasn't that simple to remove that damned whitespace-changes without messing up the repo, I hope the master-branch is alright now\n. Well, that would be to simple!\n- I soft-reseted to the last commit before my changes\n- created a diff with --ignore-all-space --ignore-blank-lines --ignore-space-change as a patch\n- actual checked out the old commit and applied the patch\n- reset the master HEAD to my new commit\n\nHave a nice weekend, and thanks for merging\n. that is probably, because the MysqliDB Library doesn't overrides the http-headers. The http-status code can be set through:\nphp\n$returnCode = 500; // server-side-error\nhttp_response_code($returnCode);\n...if you need to. It's completely up to you.\n. Since this MySQLiDB class uses php mysqli prepared statements, the resulting queries are protected against SQL injections - yes.\nRead more about prepared statements here:\n- mysql prepared Statements\n- php mysqli prepared statements\n. Fixed with MR #510, if merged.\nBut be aware, any php version earlier than 5.6 isn't supported any longer, meaning no security patches are applied. If anyone is still using a version this old, it might be a good idea to upgrade to a newer release soon.\n. This is most likely not a problem with this class, but with your used charset from input-sources, script-files and database. To avoid such encoding problems, you should choose and use only one charset for all of them.\nPay some attention to the default mysql utf8 charset, which might is not the solution you are looking for, instead try utf8mb4 (details).\nInit your MysqliDb-Instance accordingly.\nphp\n$db = new MysqliDb($host, $username, $password, $db, $port, 'utf8mb4');\nAnd check your file encoding settings in the php-editor of your choice , e.g. sublime text.\n. Please read the Readme. To be more precise: Readme: Pagination.\nFor your specific problem, you can do something like:\n``` php\n$page = 1;\n$db->pageLimit = 10;\n$db->where('town', '%' . $search . '%', 'LIKE');\n$content = $db->paginate('house', $page);\necho \"showing $page out of \" . $db->totalPages;\n```\n. To be more precise Readme: Where / Having Methods\nphp\n$db->where(\"lastName\", NULL, 'IS NOT');\n$results = $db->get(\"users\");\nFor your specific query you can use something like:\nphp\n$db->where('column', '%'.$foo.'%', 'NOT LIKE');\n$db->where('column', 'foo2', '!=');\n$db->get('table');\n. Hey. Please take a look at the Readme. To be more specific: Readme: Select Query. Each select-query stores a count of all effected rows as default in $db->count.\nphp\n$users = $db->get('users');\necho 'Users found: ' . $db->count;\n. Hey, first: the issues are not for general help.\nHowever: It's possible to pass an array with id's (or an subQuery() object) to a where() select. See Readme: Where / Having Methods.\nIf you have an array of ID's, you can use:\n``` php\n$ids = array(2, 3, 5, 7, 11, 13, 17);\n$db->where('id', $ids, 'IN');\n$db->get('tablename');\n```\n. Please read the Readme and dbObject Readme.\nThe MysqliDb.php class is the actual core of this project and probably what you are looking for. The dbObject.php is used as a basic ORM to access db tables like objects in php.\n. Readme: Select Query.\nphp\n$db = new MysqliDb ('host', 'username', 'password', 'databaseName');\n$list = $db->get($tablename);\nforeach($list as $entry) {\n  // do stuff with $entry here\n}\nReally everything necessary is written down into the readme for this simple case.\n. Last response from me. Please really take a deep look into the Readme.\nReadme: Where\nphp\n$db->where('catid', 10);\n. Short: This lib uses prepared statements and therefor injections wont work.\nPlease take a look at previous issues first before asking next time:\n- #508 Protected with SQL injection ?\n- #408 SQL Injection, question.\n- #400 Is it usefull for Prevent Sql injection?\n- #174 Is this class prevent common security vulnerabilities: SQL injection, XSS, CSRF etc\n. You really shouldn't inline user-input into your raw-queries or ANY other query method.\nBut if you use placeholders in your raw-queries, this class also applies your variables and executes the queries as a prepared statement, and therefor also is protected against sql injections.\nSee: Readme: rawQueries\nphp\n$user = $db->rawQueryOne ('select * from users where username = ? and password = ?', array(\n    $_POST['username'],\n    $_POST['password'],\n));\necho $user['username'];\n. Exactly.\nThe condition feature is documented in the Readme: Where / Having Methods in the 4th code-block.\n. It's not a problem with this Library, but your php installation. Your installed mysqli extension doesn't match your php. Try to update them both.\n. Please try the following syntax:\nphp\n$db->where('id', 10);\n$db->update('crontable', array(\n    'cronattemp' => $db->inc(),\n));\n. Obviously you haven't looked at the Readme: Insert Query.\nThe insert() method returns the last inserted id as the result (if the query succeeded).\n``` php\n$id = $db->insert ('users', array(\n    'username' => 'smith',\n    'password' => password_hash('password'),\n));\nif($id) {\n    echo 'user was created. Id=' . $id;\n} else {\n    echo 'user creation failed with error: ' . $db->getLastError();\n}\n``\n. ThegetOne()method only requires 2 Parameters instead of the 3 Parameters ofget().\nCallinggetOne('table', null);assumesnull` as the requested rows, which is why it returns unexpected results. Try:\n```php\n$product = $this->db->getOne('products p', '*, c.Name as CategoryName, m.Name as ManufacturerName');\n// or as array:\n$product = $this->db->getOne('products p', [\n    '*',\n    'c.Name as CategoryName',\n    'm.Name as ManufacturerName'\n]);\n``. I just took a look at the code. @Tom29 are you sure a object with the givenid` exists in the database?\nThe byId() Method is only a wrapper around  getOne(), see: dbObject.php Line: 304.\nTherefor, if no matching entry is found inside the database, null is returned in dbObject.php Line: 319, which than leads to this issue.\nI suggest a simple workaround calling the delete() method:\nphp\n$item = self::byId($id);\nif ($item === null) {\n    echo \"nothing to do\";\n} else {\n    $item->delete();\n}. Oh right, obviously you're correct, I just misread the error-message, sorry!. You can pass mysql function keywords inside the get(), getOne() or even getValue() methods like:\nphp\n$db->where('model_id', $model_id);\n$sum = $db->getOne('models', 'sum(price)');\necho 'total price: ' . $sum;\nSee Documentation: Select Query for more details.. Or just use where(), this should do the job:\nphp\n$db->where('mail_domain', '%'.$maildomain.'%', 'like');\n$bannedCount = $db->getValue('email_bans', 'count(*)');. Yes, the $db->save() method for existing entries returns an bool - true if the update succeeded, or false if not.\nInternal it utilizes the $db->update() method for updates and $db->insert() for new entries, both methods are documented in the Readme.\n. So what exactly isn't working?\nDoes the complete query fail - or does the resulting array-key just has the wrong column name, despite of the alias?\nI assume u. is a table alias from a previous join, so let's ignore this.\nphp\n$result = $db->get('orders o', null, [\n  'o.orderID as ID',\n  'o.firstname as Firstname',\n]);\nshould work, and return something like\njson\n[\n  {\n    \"ID\": 1,\n    \"Firstname\": \"test\"\n  },\n  {\n    \"ID\": 2,\n    \"Firstname\": \"someoneelse\"\n  }\n]\nMake sure you're using the current master branch.. Okay, thats pretty interesting. Can you please print the output of $db->getLastQuery()?\nIt should be something like this (as you already said in your first post above):\nsql\nSELECT  o.orderID, o.firstname as Firstname FROM orders o\nEven if this is not the fully actual executed query, maybe it helps.\nObviously something while building your query went wrong. And I'm currently unable to reproduce your Problem, everything works as expected. Are you sure you're running the latest master branch / or composer version (composer update)?. Actually this class doesn't has an own namespace. So if you like to access it from a namespace, just prefix the classname with \\ to enforce the root-namespace to be used.\n```php\nnamespace Some\\Name;\nclass SomeClass {\n    public function __construct() {\n        $db = new \\MysqliDb ('host', 'username', 'password', 'databaseName');\n    }\n}\n```\nOr you add the classname to your use cases.\n```php\nnamespace Some\\Name;\nuse \\MysqliDb;\nclass SomeClass {\n    public function __construct() {\n        $db = new MysqliDb ('host', 'username', 'password', 'databaseName');\n    }\n}\n. This class opens a mysqli connection when initializing a new object of itself (actually not until running your first query), and automatically closes it, when destructing the object again.\n```php\n$db = new MysqliDb(/.../);\n$result = $db->get('table'); // opens internal mysqli connection to database\n$db = null; // destructing the Class object also releases the mysqli database connection\n```\nAlternatively you can force close the connection manually:\nphp\n$db->mysqli()->close();\n\nBut be aware: this call will open a new connection if it's not currently opened, just to close it again.\n\nSince this classes should correctly handle it's own db connection, I guess you have a bug somewhere on your side. Maybe some never ending cronjobs or so.. @avbdr was faster \ud83d\udc4d  You'll get a better way of disconnecting manually soon. The second Parameter of rawQuery() is expected to be an array, containing all variables which should be bind to the query. So in your case it should work with:\nphp\n$result = $db->rawQuery('ALTER TABLE `rank` CHANGE `view_template` `view_template` SET( ? ) CHARACTER SET utf8 COLLATE utf8_unicode_ci NOT NULL;', array($aux));. This library uses the MySQLi extension which is not able to connect to other databases than MySQL. Therefor no plans to port this library to other extensions exists (as far as I know!).\nThere was an issue for adapting the core to use PDO instead (as paid contract) some time ago... #471.\nAlso according to #356 a PDO wrapper exists, but it's an old fork, with no maintenance since one year.. The getOne() method always returns only a single row (as the name suggests).\nIf you want to select multiple rows, use get() instead. You can use a simple count() to get the number of select rows:\n```php\n$db->where (\"username\", $this->username);\n$db->where (\"password\", $this->password);\n$users = $db->get(\"users\");\necho \"rows: \" . count($users);\n```. This is the correct behavior of mysqli prepared statements, which are utilized in this library. The returned field are interpreted as pure php-integers, which don't support zerofills.\nJust use phps str_pad(), if you want to zerofill your integers:\n```php\n$result = $db->get(...);\n$number = $result['number']; // int\n$zerofilledNumber = str_pad((string) $number, 6, '0', STR_PAD_LEFT); // string\n```. As long as you use the prepared statement API of this class and don't inline user-inputs, you are safe against SQL-Injection. Yes.\nSee Issues: #508 and #544. I guess the error is in your update-call. The given dataset should be an associative array, where the key explains which db-attribute should be set. Replacing the , with a => should do the trick.\nSo the correct call should be:\nphp\n$db->where('chat_id', $message->chat['id'])->update('groups', ['chat_id' => $message->migrate_to_chat_id]);. Not tested, but the following should work:\nphp\n$timeout = 30;\n$db->mysqli()->options(MYSQLI_OPT_CONNECT_TIMEOUT, $timeout);\nFor more options see: php.net - mysqli.options\n. You can write custom conditions for where-statements like this:\nphp\n$searchVar = 'ivan';\n$db->where('s.username', '%' . $searchVar . '%', 'LIKE')\n    ->where('s.status', 'activated')\n    ->where('s.gender', 'male')\n    ->where('s.branch', '1')\n    ->where('(s.firstName LIKE ? OR s.lastName LIKE ? OR s.email LIKE ? OR s.website LIKE ? OR s.mobile LIKE ?)', Array(\n        '%' . $searchVar . '%', '%' . $searchVar . '%', '%' . $searchVar . '%', '%' . $searchVar . '%', '%' . $searchVar . '%'\n    ));\nThis way you can preserve the brackets around your or-where conditions.. Hey.\nIn short terms: yes, this class uses prepared statements with placeholders for safe variable-bindings.\nPlease also take a look at previous issues before asking next time \ud83d\ude09:\n- #508 Protected with SQL injection ?\n- #408 SQL Injection, question.\n- #400 Is it usefull for Prevent Sql injection?\n- #174 Is this class prevent common security vulnerabilities: SQL injection, XSS, CSRF etc. You can achieve the same result using the already built-in trace function.\nphp\n$db->setTrace(true);\n$queryCount = count($db->trace);\n. Hey @amanjazari, you can check the connection at runtime using the ping() method.\nIn addition, the MysqliDb class throws an exception if it's unable to connect to the db in the first case.\nBut be aware, that the connection is established lazy only at execution of the first query, or interacting otherwise with the db-server. This includes running the ping() method itself.\n```php\n$db = new MysqliDb(...);\ntry {\n  if (!$db->ping()) {\n    echo 'not connected!';\n    exit(1);\n  }\n$db->get('users');\n} catch (\\Exception $e) {\n  echo 'unable to connect: ' . $e->getMessage();\n  exit(1);\n}\n``. He uses theReflectionClassapproach to get a new class-object of typemysqlibut from a variable number of parameters ($params`).\nNormally you would use call_user_func_array() (see: php-doc) to achieve this behavior with function/method calls, but this is not available for object-initialization.\nIn modern PHP (>=5.6) you can use the ...-operator (splat) (see: php-doc) to solve this problem, resulting in something like this:\nphp\n$mysqli = new mysqli(...$params);\nFor backwards compatibility the only remaining solution is to use the implemented approach, utilizing the ReflectionClass::newInstanceArgs() method.\nAlso see: Stackoverflow. As long as your array is hard-coded and not received from user-input, the proposed answer is okay. But please don't use this, if your array is passed from a external input, since it would allow sql-injection attacks.\nInstead I would propose the following answer(s):\n1.\n\n~~I'm not sure if the following works with a raw-where statement like this. Please test it ;) But it would be the most elegant solution.~~- it doesn't work!\n\nIf you really need to write the query as given (type is in array OR null):\n```php\n$validTypes = ['discount', 'guest'];\n$db->where('(type NOT IN(?) OR type IS NULL)', [$validTypes]);\n```\nPay attention to the 2-dimensional array for the second parameter: first dimension is an array which should be bound to the query (it could have more than one parameter (?-chars). The second dimension is the array which should be passed inside the IN(?) statement.\n1. edited\nEDIT: The above won't work, but the following should:\n```php\n$validTypes = ['discount', 'guest'];\n$db->where('(type NOT IN(' . rtrim(str_repeat('?,', count($validTypes)), ',') . ') OR type IS NULL)', $validTypes);\n```\n2.\nElse I would suggest something like this:\n```php\n$validTypes = ['discount', 'guest'];\n$db->where('type', $validTypes, 'NOT IN');\n$db->orWhere('type IS NULL');\n```. ",
    "kenzouno1": "one vote to change type to string :+1: \n. ",
    "nikkyandrei": "\n) & 2)  You have 2 defines.. SAVEQUERIES (i'm used with it from WP , and ideea is from WP core ,) and \"MysqliDb_path_to_remove\" = can be anything , I don't recomand to use something like ABSPATH(it is used a lot buy a lot of programers) but is exactly the value of ABSPATH = root directory, . if you want i can change it , come with a nice name what you want for both of them.  I recommand to use both of them on top with description to be more easy to use for developers that create custom frameworks or small aplications. \n   \"MysqliDb_path_to_remove\" I like to use it this option to clean the path : ex \n   path of file where is a query to execute : /home/user/public_html/core/inc/MyClassFolder/MyClassFile.php \n   In logs i like to see only \"core/inc/MyClassFolder/MyClassFile.php \"\n   so i make: define('MysqliDb_path_to_remove', \" /home/user/public_html/\")\n\n3) . I like more with \"_\" than CamelCase , but you can change it .\n4.) I don't like to make descriptions  :( I have some problems with writing in English but i can provide you any information you want . \nBase Info :\n1 to activate  track of all SQL queries you must define before loading the file of the class   define('SAVEQUERIES', true); this can be usualy added to a config file or some debug class that is loaded before the MysqliDb Class file \nafter you define SAVEQUERIES as \"true\" you can see all queries that was loadedt until a point using: \n$db= new MysqliDb(.........);\n$db->query($sql1);\n$db->insert($sql2);\n$db->update($sql3);\nprint_r($db->queries);\n2 about Query options , to add to INSERT , SELECT , UPDATE, DELETE  query options like LOW_PRIORITY , QUICK, IGNORE, HIGH_PRIORITY \nsimply you can do :\nfor INSERT LOW_PRIORITY  INTO table .......\n$db->setQueryOption('LOW_PRIORITY ');\n$db->insert($table,$param);\nOR \n$db->setQueryOption('LOW_PRIORITY ')->insert($table,$param);\nalso you can use array for :\nINSERT LOW_PRIORITY  IGNORE INTO table .......\n$db->setQueryOption(arrary('LOW_PRIORITY ','IGNORE'))->insert($table,$param);\nPS  You are free to adapt , change an do anything you want with those ideas .\nAlso you can contact me directly on skype: nikkyandrei if you want more information / ideas\n. use last update from few ours ago , and add to your script : \nafter you setup class  $mydb = new MysqliDb(.....)\n add next lines:\n\n$mydb->setTrace(true);\n// and for printing all queries at the end of script - this you can add where you want , recommend after line above \nif(!function_exists(\"get_shutdown\")){\n    function get_shutdown(){\n        global $mydb; /// the variabile name used on defined class EX: $mydb = new MysqliDb(.....)\n        echo \"<'pre> \" . print_r($mydb->trace,true) . \" <'/pre>\"; // remove \" ' \" from both \"pre\" tags and if u change the variable from global please change it here also \n    }\n    // make sure the function is loaded at the end of execution of script -  this is usefull in case you have other register_shutdown_function();\n    function prepare_get_shutdown(){\n        register_shutdown_function('get_shutdown');\n    }\n    register_shutdown_function('prepare_get_shutdown');\n}\n    register_shutdown_function('prepare_get_shutdown');\n}\n\n. the second param from print_r is to return the output not to print it you can make something like \n$output=print_r($array,true);\n. What i don't understand is why you must define $db = new ... and after that you use other objects... use extends and define the __consrtuct method an do \nfunction __construct($param){\n      parrent::__construct($param);\n      // also here you can add other things before or after parrent::__construct\n}\nWhen i implement the changes that i send to you  i create my  class to extends yours and overwrite what i wanted but also i overwrite the __construct.\n. are you sure  ? mysqlidb carry the credentials this is 1 of 2 reasons why at current project i couldn't use the class and create another to extends php mysqli class\nwhat you can do is to improve a bit dbObject in __construct is to read the configs and to auto construct the MysqliDB also i suggest in MysqliDB to compress __construct() and connect() and then you can remove from class : \n$this->username \n$this->password \n$this->db \n$this->port \n$this->charset\n. there was that code. \n. ",
    "truongyeuphuong": "Good \n. ",
    "mainman": "Ok, no problem. But objects are simplier to deal with, for me. I searched a bit and found nothing, I will search again.\nThanks\n. ",
    "looki": "Sure, I'll do that next week or so.\n. Sorry the delay on the patch, I haven't been working on this at all, but I'll get to it.\n. ",
    "tomitomas": "Nice feature !! :1:\n. Hello !\nThank you :)\n1. I use it to display headers columns names on my page in table without modifying/verifying the data as the query is already having the good name :\n$cols = Array (\"id as 'my user ID'\", \"name as 'LAST NAME'\", \"email as 'EMAIL'\");\n$users = $db->get (\"users\", null, $cols);\nif ($db->count > 0)\n    print_r ($db->getLastQueryHeaders());\n    foreach ($users as $user) { \n        print_r ($user);\n    }\nit will display \nmy user ID       |      LAST NAME        |      EMAIL\n1                |       toto            |      toto@toto.fr\n...\nI hope my explanation is understandable !?\n2 & 3 => OKAY, np i'll do. \nIf I find how :) cause it's the first time I use GIT here :)\n. sorry for the commit and revert, and commit and revert ... \njust trying to find out how git for windows works :)\nhope everything is fine for you like that  !?\n. Do it sound okay for you !?\n. https://github.com/joshcam/PHP-MySQLi-Database-Class#where-method\n. ",
    "davidwieler": "Sorry, I've figured it out.\n/* activate reporting */\n$driver = new mysqli_driver();\n$driver->report_mode = MYSQLI_REPORT_ALL;\nPutting that after initializing the class works great. Then wrapping everything in a try-catch provided the needed answer.\n. ",
    "LarryZhang": "$db->where('add_time',$db->now(),'<=')->select('user');\n. ",
    "ttyazilim": "i have same issue\n. When i add single quotes ' to the input value and  POST it,  it adds backslash  /' to the database value.. \nHow can i deny to adding backslashes to post value while i am using single quotes ?\n. $logins = $db->rawQuery('select manset.manset_baslik from manset limit 3,3');\n. any help?\n. Omg, thats all i must do, it spends my 12 hour..\n$db->where('kat', $_GET['bk'], 'IN');\n. ",
    "xZero707": "It's even difficult for me to investigate issue as it happened just once and I cannot reproduce it. Maybe it was problem with my server so database got corrupted, I can't know for sure.\nWhat I did: on my local computer I build PHP script for supplying hundred of requests and sending them using CURL (POST) to server script which uses your class for saving data to database.\nAfter local script finished, I checked wordpress website (same database) and found that is wiped out, like new installed wp. I checked database afterwards and found post and other tables wiped clean, and some tables got corrupted by loosing info about unique key.\n\nI use \"where\" from user submitted data, but by preg_replace only alphanumeric characters are allowed, everything else is filtered out, so I guess it's safe. I expected rawQuery to be unsafe.\nThank you for your reply! \n. Very possibly. I think there is no empty values, but, with that huge query many unexpected things may occur. \n. It's nice to see reply that fast. :1st_place_medal: \nI tested with dev-master. Some other recommendation?\nUpdate: It's not going to crash if connection was initialized using normal way, via array as parameter to __construct. lol\nI'm willing to contribute my self, but due to lack of time at this very time, the best I can do is to create issue + headache for you guys. \n. ",
    "shamseerpari": "big thanks to both of you\n. ",
    "imirko": "hey Alex!\nthanks for the answer and for the update! prefix works well now.\nregarding json serialisation, $obj->toJson() returns an error in case of multiple results cause they come back as an array. heres an example of what I do:\n$news = News::ArrayBuilder()->get();\n$newsJson = json_encode($news);\nusing it without ArrayBuilder() returns some other things from the object itself besides the results which ArrayBuilder() cleans up nicely. my idea was to have something that would return json results in one line like ex. return News::get()->toJson() or why not News::JsonBuilder()->get();\nusing these two lines is not a big deal at all, I just think it can still be cleaner :)\nthanks!\nMirko\n. ",
    "murderaven": "There 2 row available in table, also user_id column unique primary key. I've resolve it with \n$ID = ((!isset($_GET['ID']) || !is_numeric($_GET['ID'])) ? -1:intval($_GET['ID']));\nand rawQuery works too. But I must change all pages like that :/\n. user_id    username\n1             admin\n2             staff\nuser_id column unique and there no \"0\" id available in table. \nIf any member call \"0\" id via querystring, admin profile will appear. \n\nrawQuery works fine like that\n$ID = ((!isset($_GET['ID']) || !is_numeric($_GET['ID'])) ? 0:intval($_GET['ID']));\n$params = Array($ID);\n$q = \"SELECT * FROM \". db_table_pref .\"users WHERE user_id=? LIMIT 1\";\n$opUsrRs = $db->rawQuery($q,$params);\n\nbut where statement does not work\n$db->where('user_id',$ID);\n$opUsrRs = $db->getOne('users');\nis that where call usage wrong for me?\n. ",
    "VonHirsch": "Thanks, I'll test it!\n. Ah ok, sure no problem understand.  I think getColumn would be a nice convenience function, your call. \n. I may have found a work around by doing this:\n$this->db->where ('serverid', 0 . \"\");\n. is it safe to get from master?  I thought you would have a release?\n. Cool thanks!!\n. Boom!   Works!  Thanks!\nOn Sun, Sep 6, 2015 at 8:27 AM, Alexander Butenko notifications@github.com\nwrote:\n\nplease try this patch\ndiff --git a/MysqliDb.php b/MysqliDb.php\nindex 84011ad..f3cebd1 100644\n--- a/MysqliDb.php\n+++ b/MysqliDb.php\n@@ -713,7 +713,7 @@ class MysqliDb\n     {\n         $allowedDirection = Array (\"ASC\", \"DESC\");\n         $orderbyDirection = strtoupper (trim ($orderbyDirection));\n-        $orderByField = preg_replace (\"/[^-a-z0-9.(),_]+/i\",'', $orderByField);\n-        $orderByField = preg_replace (\"/[^-a-z0-9.(),_*]+/i\",'', $orderByField);\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/317#issuecomment-138078807\n.\n. Ah ok cool, thanks for the tip!\n. cool thanks! :+1: \n. ok thanks - I just re-tested this and we're good.  I had put logging in the project MysqliDb php file, but it was picking up from another project... long story :) but good now.\n. oh great!! how then?. Nevermind I see it - sorry I must have been staring right at it!! :P. Note that autoReconnectCount is reset in reset() so it will try to connect once for each database operation.\n\nI have created a fix for reconnect PR #793 \n. I agree with this modification, and IMO it shouldn't break anyone if their code is clean?  I mean they shouldn't trust a dirty $count anyway right?\nAnyway, however you want to do it I'd sure like to know how many records were deleted.  This is a showstopper for me right now, for now i'll just go with rawquery until a solution.  thanks again for a great lib!! <3 it. Created PR https://github.com/ThingEngineer/PHP-MySQLi-Database-Class/pull/750. @ThingEngineer Will this be merged into master?  Please consider it, thanks.. ",
    "jackbrown1993": "Can't seem to get this to work, am I doing something wrong?\nUsing:\n$data = Array(\n        'token' => $hash,\n        'username' => $username\n    );\n    $db->replace('asl_password_reset_tokens', $data);\nError:\nFatal error: Problem preparing query (REPLACE INTO asl_password_reset_tokens SET ?, ?) You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '?, ?' at line 1\n. Thank you.\n. Thanks for quick reply, will take a look now.\n. Still doesn't looks like it works\nSELECT project_manager AS retval FROM projects WHERE id = '1318'\nThe value in the database is NULL;\nResult:\nArray ( [0] => ) \nThis is the current getValue function:\npublic function getValue ($tableName, $column, $limit = 1)\n    {\n        $res = $this->ArrayBuilder()->get ($tableName, $limit, \"{$column} AS retval\");\n```\n    if ($this->count == 0)\n        return null;\nif (isset($res[0][\"retval\"]) && $limit == 1)\n    return $res[0][\"retval\"];\n\n$newRes = Array ();\nfor ($i = 0; $i < $this->count; $i++)\n    $newRes[] = $res[$i]['retval'];\nreturn $newRes;\n\n}\n```\n. Thank you!\n. ",
    "nic-d": "Since no one has replied yet, I'll suggest a temporary solution. If you can't change the PHP.ini (shared hosting?) then you can set this line at the top of the script:\nphp\nini_set('memory_limit', 'x');\nPlace this at the top of the script, where 'x' is the amount of memory you'd like to allocate. Otherwise you can change the memory limit in the PHP.ini file directly.\n. It can!. ",
    "jonnysmith1981": "Same result with the latest from master\n. No, nothing.\nI am not sure if it#s clear from my first post, but the insert and update are being done in the same PHP file. This is ok isnt it? I had problems in the past with mysqli and multiple prepared statements if i did not use the Store_result() function.\n. 5.4.16\n. $db = new MysqliDb ('localhost','lead',''passwordshhhhh,'leads');\n. ",
    "dev10calypso": "what is false? why false? can u explain?\n. ohh thank you very much.\n. ",
    "hiteshbalyan": "I have created this changes to get work\n    /*\n        $item = new static ($results);\n        $item->isNew = false;\n     /\n        $item = clone $this;\n        $item->isNew = false;\n this is where i extends dbObject class\n<?php\nclass Items extends dbObject{\nprotected $dbTable = 'items';\nprotected $primaryKey = 'ID';\n public function __construct($data=null){\nparent::__construct($data=null);\n}\n }\n?>\nAnd when i call it like this $items_obj have data Null\n $items_obj = new Items();\n$items_obj = $items_obj->get();\nand i will check your patch and give you reply thank you for view it\nOn Sat, Jul 4, 2015 at 12:48 PM, Alexander Butenko <notifications@github.com\n\nwrote:\ncan you please check following patch:\ndiff --git a/dbObject.php b/dbObject.phpindex d2a67f1..1a973d1 100644--- a/dbObject.php+++ b/dbObject.php@@ -109,7 +109,7 @@ class dbObject {         if (empty ($this->dbTable))             $this->dbTable = get_class ($this);-        if ($data)+        if (is_array ($data) && count ($data) > 0)             $this->data = $data;     }\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/254#issuecomment-118478648\n.\n. \n",
    "shahab74": "Thank you it now works great!\n. ",
    "vedmant": "About caching not exactly, I've removed get() from has many and has many through, so it will return model object with prepared where and join (for through) conditions, so it doesn't return result itself. This is how it's done in other frameworks, for example Kohana or Laravel. About has one, it can be cached as it's only one object possible. Also it can be added something like refresh function for reinitializing whole model class in case DB related records was altered. Making query each time when has one relation have to be accessed is not good idea, Kohana and Laravel cache this type of results.\nI'll add documentation little later. About usecase: for example you have tables users, roles, and user_role, in this case user can have many roles through user_role tables and backwards role has many users, in other words many to many relation, if to get user roles it will be following:\n'roles' => ['hasManyThrough', 'Model_Role', 'user_role', 'user_id', 'role_id'],\nTwo last parameters can be auto generated, but in camel case? Usually DB schemes use snake case... By the way the same with timestamps, it's better to be able to set timestamps columns. Also I would suggest auto serializable columns or columns casting, so when loaded value is casted to specific type (or decode from json) so on... And one more, it lacks of belongTo relation, when local key points to far table, I didn't add as I didn't need it for now in my project.\nAbout multisave feature, how it may break it, from what I see it just calls save() on attached to data array model, relations weren't saved into data array.\n. Yeah I see, didn't notice that it uses one instance of MysqliDb. Maybe it's good idea to make new instance of MysqliDb for each dbObject, I don't think it will increase RAM usage a lot as MysqliDb doesn't have too many dynamic properties, class instance itself doesn't take any extra RAM. It will need static mysqli property, and method to get it, then create new MysqliDb with the same mysqli.\nAbout multisave still didn't get how it interacts with relations...\nIf I have time I'll work on it, I like this library, I think Laravel eloquent is too heavy for really small projects.\n. Forget about multiple instances, but it worked fine with one instance, which is weird. There is now some bug with mysqliDbTests.php, can you check it?\n. Great! I can merge changes later.\n. It's only helpful for hasOne, and belongsTo (which is also have to be added). For hasMany and hasManyThrough it doesn't make difference, but it's simpler to keep all relations one way.\n. I see, I didn't notice it, just used this lib for few days. Yes I agree, it will be enough just to edit many relationships.\n. ",
    "navneil-naicker": "Sorry my bad, I downloaded it few weeks ago and the latest copy is 6 days ago. I downloaded the latest copy and it started to work. Thanks!\n. Thanks!\n. ",
    "danieleratti": "Thank you!\n. ",
    "scoman81": "Wow, thank you!\nMy original example has a flaw in it, as compared to typical real-world usage. That is, the \"id\" field is probably not something someone would insert! A more realistic case is where there is an auto-increment ID field, and the key violation might instead occur on another field, say \"name\" for example. It's quite common to want \"insert this row, but if it already exists, update these columns, AND give me back the ID of the existing row.\" MySQL has a very useful (but perhaps not well known) feature for this usage case.\nTheir example from https://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html:\nsql\nINSERT INTO table (a,b,c) VALUES (1,2,3)\nON DUPLICATE KEY UPDATE id=LAST_INSERT_ID(id), c=3;\nThis causes LAST_INSERT_ID to return the row's ID (auto-increment) column, which is brilliant. \nThis is really useful if you're using a fully normalized database. For example:\nphp\n$sales->insertSale($productName, $customerName, $amount);\nIf you have a products table, a customers table, and a sales table, you'd need to:\na) insert/update the product, and get its ID\nb) insert/update the customer, and get their ID\nc) insert $productID, $customerID, $amount into the sales table\nThe tricky part here would be how to express this LAST_INSERT_ID(id) concept in your library, but if there is a way, it would be incredibly useful.\nThinking out loud ...\nphp\n$data = array(\"name\"=>$customerName, \"lastseen\"=>$db->now());\n$id = $db\n  ->onDuplicate(1)\n  ->insert(\"customers\", $data);\nNow $id is only valid if the row was inserted. It's useless if it was updated. So here's a couple (possibly horrible) ideas:\nphp\n$id = $db\n  ->onDuplicate()\n  ->insertID(\"id\")\n  ->insert(\"customers\", $data);\nor\nphp\n$id = $db\n  ->onDuplicate()\n  ->idColumn(\"id\")\n  ->insert(\"customers\", $data);\nOr maybe something totally different?\n``` php\n$insertData = array(\n  \"name\"=>$customerName,\n  \"lastseen\"=>$db->now()\n);\n$updateData = array(\n  \"lastseen\"=>$db->now(),\n  \"id\" => $db->insertID(\"id\")\n);\n```\nIf it's possible, getting this \"id = LAST_INSERT_ID(id)\" concept in there would make this addition incredibly useful!\nAnyway, just more ideas :) Thanks again for your consideration and time. Your work is very much appreciated!\nDave\n. I actually tried exactly that, and it didn't work - I got an error in the query text. I think the word \"array\" actually showed up in the SQL. When I looked at the code it seemed to me that what it is expecting is an array of column names only (which does seem to work) but not an array of column=>data values ... but admittedly, I didn't dig too deeply to confirm that for sure.\n. Thanks for the quick reply. To be perfectly honest, I'm the ultimate Git noob, and don't really know how to apply a git patch. I guess I could do it by hand but maybe someone else will jump in and try it the right way ... whatever that is!\n. Thanks - I'm on Windows, but the GitShell has a patch command that I was able to use.\nI was unsure about the syntax, and tried $db->update('x', $data, array($pageSize,0)) but this fails - probably isn't correct syntax. However ... $db->update('x', $data, $pageSize); worked great!\nThanks again for all your work on this library!\n. ",
    "rongzhj1990": "Hello, I've implemented a simple version of the on duplicate function.\nusage:\nPHP\n$video_info = array();\n$video_info[\"ctime\"] = $video_info[\"utime\"] = time();\n$video_info[\"like_count\"] = 999;\n$video_info[\"code\"] = \"abcd\";\n$updateColumns = array(\"utime\", \"like_count\");\n/**\n* onDuplicate:\n* first argument is array of column names for updating\n* second argument is the auto increment column name\n*/\n$db->onDuplicate($updateColumns, \"id\"); \n$db->insert(\"video_info\", $video_info);\nMy Fork\nHope it helps.\n. Sure, it's my pleasure.\n. Cool, I am not sure if my modification would break something which works previously, please let me know if I am doing something wrong :)\n. Great ! I have little question for the test case of this method in tests/mysqlidbtests.php\nphp\nif ($nUser[0]['createdAt'] == $nUser[0]['updatedAt']) {\n    echo \"onDuplicate2 update failed. \";\n    exit;\n}\nI am afraid that this will be always true, because the interval between the previous insertion of user3  and this one should be too short to reflect changes, would it be better to choose another column, e.g. password?\nYou are really hard working, thanks for your appreciation\n. ",
    "joshbenhamou": "Thanks! Works perfectly\n. Thanks\n. ",
    "eldiddio": "Hi,\nI have applied that patch and run the code again, now i am getting \n[Mon Aug  3 21:31:00 2015] [hphp] [14150:7f87bb3ff700:53:000001] [] \\nFatal error: Invalid modifier on function refValues. in /var/www/nginx/somproject/MysqliDb.php on line 1120\nThanks for the swift response!\n. Confirmed this has been resolved.\nThanks!\n. ",
    "luke-j": "Sure thing! Changed to an error when an invalid argument is supplied, checked with is_number().\n. Thanks :)\n. ",
    "RealPolluX": "I think it's nice that you think about that, but logging is something for a new class.\nYou're still able to get errors/information with the following methods to log them outside of the database\nclass:\ngetLastErrno()\ngetLastError()\ngetLastQuery(). ",
    "ATouhou": "lool xD agreed @avbdr <3 \n. Try debug $rest_id  if you depend on user input.\nMaybe it is not set :-)\n. It is currently done like this:\n$db->setPrefix ('bs_');\n. Try this:\n// Update\n$db_stats->where('id', $var['id']);\n$data = array(\n    'param_1' => $var['param_1'],\n    'param_2' => $var['param_2'],\n    'param_3' => $var['param_3'],\n    'param_4' => $var['param_4'],\n    'param_5' => 1,\n);\n$stats = $db_stats->update('table', $data);\nif($stats){\n// 301 redirect\nheader($_SERVER[\"SERVER_PROTOCOL\"].' 301 Moved Permanently');\nheader('location: '.$url);\nexit;\n}else{\necho $db_stats->getLastQuery(); exit;\n}\nensures it does not activate redirection without query executed and response received\n. Also happens if you try to pass an object (wrong format) into a datetime field by update. $insertid = $db->insert('ia_customers', $data);\necho \"see-->\".$insertid;\n. Except for the rawQueries right? :-) \n. Agreed, actually just wanted you to clarify, so that somebody who reads this \"github issue\" assumes its' safe to do so :-) \nThanks for your great effort RicWein\n. Use rawquery. ",
    "darshanopenxcell": "Thanks for reply..\nHere is update query, which is store emojis Native value from IOS. But is store in DB like  \"????\"\nYou can take native value from this site http://apps.timwhitlock.info/emoji/tables/unicode\nrequire_once ('MysqliDb.php');\n$db = new MysqliDb ('xxxxx', 'xxxxx', 'xxxxx', 'xxxx');\n$data = array(\n    'content' => 'test \ud83d\ude0a'\n);\n$db->where ('id', 15);\nif ($db->update ('posts', $data))\n    echo $db->count . ' records were updated';\nelse\n    echo 'update failed: ' . $db->getLastError();\n. I already done.\nposts table Collation utf8mb4_unicode_ci and content column Collation utf8mb4_unicode_ci\n. Ok, Thanks.\n. ",
    "rajjanorkar": "Thank you very much @avbdr \n. Hi @avbdr, I can see there are so many changes since last release, If it is fully tested then please do next release.\nThank you in advance.\n. ok no worries.. thank you so much.. it's really great mysqli class.\n. Thank you @avbdr \nwill use raw for this.\nMay be it is future enhancement then.\n. I use stable release now, and all good.\nThank you @avbdr \n. Thank you @avbdr \nthe first rawquery is fine but second query does not work. (i corrected typo). I think db->func does not deal with temp variable.\nso i end up using another raw query.\n$db->rawQuery(\"SET @count = ?\", Array(0));\n    # Re-Sequence the uniq_id for current tab\n    $db->rawQuery(\"UPDATE IGNORE tab_module SET uniq_id = @count := @count + 1 WHERE tab_id = ? ORDER BY uniq_id ASC\", Array($tab_id));\n. Perfect... closing this now.\n. Thank you @avbdr ,\n312 is this issue.. do you want me to refer something else?\nYes i love to contribute, i would see when time permit i will try to do something about it.\n. Can i use something like this?\n$this->DB->insert ('products_data', [\n             ['50', 'price', '400'],\n             ['51', 'price', '401'],\n             ['52', 'price', '402']\n        ],\n        [\"product_id\", \"data\", \"value\"]\n   );\n. hi @avbdr \nPlease check your logic.\nelse if ($option == 'MYSQLI_FOR_UPDATE')\n            $this->_forUpdate = true;\n       else if ($option == 'MYSQLI_LOCK_IN_SHARE_MODE')\n            $this->_lockInShareMode = true;\n. Great...\n. Hi @avbdr ,\nIt gives error \"wrong query option: FOR UPDATE mysql\"\ni search lot on google but no luck.. so I am simply not using it.\nIf you have any idea please let me know.\nThank you\n. I am using latest Master.\nIt just dont work.\n. $sql['created']=$db->now();\n$sql['year'] = date('o',$moment);\n$sql['week'] = date('W',$moment);\n$sql['text'] = $db->escape($text);\n$update_col = array(\"text\");\n$db->onDuplicate($update_col);\n$db->insert('calendar_weekcomments', $sql);\n. ",
    "sp-kilobug": "you're right this code is totally wrong ! ;) \nI need to know if the record exist (key \"id\" = $id), and if the given $username match the record. \nCan we do that in only one request (UPDATE) and check the result ?\n. thank you :)\n. ",
    "rahul-spartan": "require(\"SRAdmin/MySqlDb.php\");\n$db=new MySqlDb();\n$text=\"This isn't joking\";\n$text=$db->escape($text);\n$q=$db->query(\"insert into dummy (Dum_text) values ('$text')\");\necho $db->getInsertId();\nThe above query doesn't put slashes. But the below one does put slashes. I have test these two queries in the same localhost server.\n$insertData=array(\"Dum_text\"=>\"$text\");\n$db->insert(\"dummy\", $insertData);\n. This is the server config\n\n. ya i disabled magic quotes and tried it without escaping the $_post variables. Now its working. Thanks Alexander.\n. update from trunk, where?\n. ya im testing it out now. please wait\n. hmm that was a version issue which i had. it seems that anonymous function are available from and after php version 5.3. :) .Got some reference http://stackoverflow.com/questions/3197853/php-anonymous-function-with-array-walk\n. Ya. Done Something like this, gets the answer\n\nfunction myfunction($value, $key){\n    $value = MysqliDb::$prefix.$value;\n}\n\narray_walk($tables, \"myfunction\");\n\nit clears the version problem.\n. ",
    "Menusito": "$db->join(\"config conf\", \"conf.idUser=u.idUser\", \"INNER\");\n$db->where(\"u.idUser\", $idUserToDelete);\n$db->where(\"conf.active\", 1);\n$db->delete(\"users u\");\nsomething like this\n. @avbdr works perfect!\n. $db->inc()\n. when i work with several joins sometimes i get malformed errors, but i don't know how to depurate the query, for this reason i want the query formed for the class before execute it.\n. if I use getOne() works well, but here Im trying to make a multiple rows select.\n. sorry, its my mistake, i need to add null before the fields that i want to select:\nget(\"table\",null,\"fields\");\n. ",
    "hosamalzagh": "how can used select DISTINCT\n. i see Field 'photo_id' doesn't have a default value\n. if set to null value  i see     Column 'photo_id' cannot be null\n. sir i applied this \nhttp://stackoverflow.com/questions/15438840/mysql-error-1364-field-doesnt-have-a-default-values  \n\"Open phpmyadmin and goto 'More' Tab and select 'Variables' submenu. Scroll down to find sql mode. Edit sql mode and remove 'STRICT_TRANS_TABLES' Save it.\"\nand now work thank you sir\n. i edit  function escape \nfrom\n  public function escape($str)\n    {\n        return $this->mysqli()->real_escape_string($str);\n    }\nto\npublic function escape($str){\n    if(is_array($str))\n    {\n       // return array_map(array(self,'escape'),$str);\n        return array_map(__METHOD__, $str);\n    }else\n    {\n        return $this->mysqli()->real_escape_string(trim(strip_tags($str)));\n    }\n}\n. ????\n.         $this->db->join(\"duet d\", \"d.$val = t.$val\", \"left\");\n        $this->db->where(\"d.singer_id\",$where);\n        $this->db->where(\"d.$val \",NULL, 'IS NOT');\n        $this->db->orderBy('t.reading',\"desc\");\n        return $this->db->get('top t', $limite, \"distinct t.$val\");\nthis code work on mysql 5.6 put not work on 5.7\nerror from mysqlidb\n. i fix it by add \nsql-mode=\"NO_ENGINE_SUBSTITUTION\"\nin my   my.cnf \nhttps://forum.newhob.com/showthread.php?t=254918\n. ",
    "madnutter56": "Hi, I'm working with Jack on this.\n$this->count = 1 when it returns Array ( [0] => )\n. Array ( [0] => Array ( [retval] => ) )\n. mysql> SELECT project_manager AS retval FROM projects WHERE id = '1318';\n+--------+\n| retval |\n+--------+\n| NULL   |\n+--------+\n1 row in set (0.00 sec)\n. Call is as follows:\nrequire_once ($_SERVER['DOCUMENT_ROOT'] . '/includes/database.class.php');\n$db->where('id', '1318');\nprint_r($db->getValue('projects', 'project_manager'));\necho $db->getLastQuery();\n. ",
    "oolso": "@avbdr when fetch data with nested join not using 'Object' return type, it just bind value of row.\nbut it have to be changed like line 953~960. so i changed it\n. my pleasure :)\n. ",
    "rrricci": "Great!\nI appreciate your help and fast response.\nThanks\nRenato Ricci\n. Ohh yes! I am aware of it.. Thanks for the advise!\nHave a good weekend.\nRenato Ricci\n. ",
    "Hirbod": "+1\n. ",
    "AbuJunayd": "Great! I'm glad I could contribute a little bit :)\n. ",
    "ashu7575": "thanks for the reply and help :),\n$rest_id was not passed by user from any input field, it was fetched and add to the url as parameter.\ni was using at least 9-10 months old MysqliDb.php.\ni'll upgrade it and try.\nThanks again :)\n. ",
    "lewis-almeyda": "I don't think it's the library or the code, since it works on my local. Is still connecting to the database because the correct number of records are returned, my guess is that when converting the result of the query into the array (_dynamicBindResults function), something silently breaks and I can't figure out what it is.\n. I should also mention that I tested the local apache calling the remote mySql and it worked, that's why I think is related to the php version. Do you have a minimum php version?\nThanks a lot, I really like the plugin.\n. \nhere is my code.\n. I'm also getting this warning on phpMyAdmin on the remote server:\nYour PHP MySQL library version 4.1.22 differs from your MySQL server version 5.1.34. This may cause unpredictable behavior.\n. I'm still working with the ISP on the issue, I just had a question, this library uses a native php mysql library right? What's the exact name? (Sorry, I'm a little bit new on php)\nThe problem is that he does not want to upgrade their php server now, but maybe upgrade that particular library fixes everything.\n. ",
    "tommyknocker": "You need mysqli php extension (or mysqlnd if php >= 5.4)\n. You may set your MysqliDb object to null or just unset() it and this will call __destruct() method before script ends its execution.\n. It's not the MysqliDb or mysqli object bug cause it's php core floating point bug based on floating point internal representation. See http://php.net/manual/en/language.types.float.php for details.\nYou may specify the desired precision of float value (using vsprintf, for example) or use BC Math functions: http://php.net/manual/en/ref.bc.php\n. Check the character set in your database for this field fieldname. It should be smth like utf8_general_ci. \n. You may check my PDODb wrapper. It almost compactible with MySQLiDb. You may find it here - https://github.com/tommyknocker/PDO-database-class\n. Yep, I would. I'll think about what can I do. \n. No, it's not, afaik. But you can get your last executed query by calling getLastQuery() method.\n. You may initialize two instances of MySQLiDb class and switch between them.\nExample:\n``` php\nclass MySQLFactory  {\nprivate static $instances = array();\n\n/**\n * Setup new sql connection\n * @param string $name\n * @param array $connectParams\n * @throws Exception\n */\npublic static function add($name, $connectParams) \n{\n    self::$instances[$name] = new MysqliDb($connectParams['host'], \n                                           $connectParams['username'], \n                                           $connectParams['password'], \n                                           $connectParams['database'], \n                                           isset($connectParams['port']) ? $connectParams['port'] : null, \n                                           isset($connectParams['charset']) ? $connectParams['charset'] : 'utf8');    \n}\n\n/**\n * Get MysqliDb instance\n * @param string $name\n * @return MysqliDb|null\n */\npublic static function get($name) \n{    \n    return isset(self::$instances[$name]) ? self::$instances[$name] : null;\n}\n\n}\n// init\nMysqlFactory::add('first', $params);\nMysqlFactory::add('second', $params2);\n// usage\n$usersFromFirst = MysqlFactory::get('first')->where('id', $id)->get('users');\n$usersFromSecond = MysqlFactory::get('second')->where('id', $id)->get('users');\n```\n. Short answer: yes :)\nLong answer: This class is based on mysqli::prepare() and mysqli_stmt::bind_param methods.\n. MysqliDb already has getOne() method, so rawQueryOne() is better than rawQueryFirst(), imho.\n. I think, you're trying to pass an array in one of your variables instead of scalar type. Execute:\nphp\nvar_dump($scheduletype, $data, $groupid, $groupname, $starthh, $startmm, $starthhmm, $endhh, \n$endmm, $endhhmm, $opwm, $pwm, $clientid);\nto check whether it's true or not.\n. ``` php\n// $db = new MysqliDb above\nforeach($a as &$value) {\n    $db->escape($value);\n}\n. php\n// assume, that we have $db variable that contains MysqlIDb object and we want to close connection\nunset($db); // will call __destruct() method in MysqlDb object and close the connection\n$db = null; // will also call __destruct() method.\n```\n. \u0418\u043c\u0435\u0435\u0442\u0441\u044f \u0432\u0432\u0438\u0434\u0443 \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u0430\u0433\u0438\u043d\u0430\u0446\u0438\u0438 \u0432\u043e \u0444\u0440\u043e\u043d\u0442\u0435\u043d\u0434\u0435. \u041a\u043b\u0430\u0441\u0441 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435. \u0410 \u0442\u043e, \u043a\u0430\u043a \u043e\u043d\u0430 \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0433\u043b\u044f\u0434\u0435\u0442\u044c \u043d\u0430 \u0444\u0440\u043e\u043d\u0442\u0435\u043d\u0434\u0435 \u043d\u0443\u0436\u043d\u043e \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u044b\u0432\u0430\u0442\u044c. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0442\u0430\u043a - http://esimakin.github.io/twbs-pagination/\n. If databases are located on the same server you can try something like this:\nphp\n// $db is MysqliDb instance\n// Example query: SELECT t1.*, t2.* FROM A.table1 t1 JOIN B.table2 t2 ON t2.column2 = t1.column1;\n$result = $db->join('B.table2 t2', 't2.column2 = t1.column1')->get('A.table1 t1', null, 't1.*, t2.*');\n. What do you mean by \"native\" mysql? The deprecated (and removed in php 7.0) mysql extension? No, there is no fallback for it.\n. You need to install php-mysqli extension.\n. I can do it (implement PDO support for MysqliDb class) for $500 and for one week. Feel free to contact me by mail me[dog]mysrv.ru or by skype - dr_manson.\n. No, it's not the same. On get(), getOne(), getValue(), update(), delete(), replace(), etc. object internal data is being deleted. So the  update('users') in second example will update all users.\n. ",
    "J2TEAM": "The class will auto close the database connection for you.\n\n. ",
    "abasnet": "Thanks for your help. It is collation: latin1_swedish_ci \n. ",
    "trayanstoyanov": "Thanks, it worked :)\n. ",
    "JustinEldracher": "I noticed... :wink: \n. ",
    "jjalvesneto": "There is no way to make the library does not modify the column names , eg always stay Unidades_id and not unidadeid \ud83d\ude10\n. ",
    "circuitmamu": "@avbdr \nChild is object but parent is still array. you can see it below link as you suggest code\nhttp://prntscr.com/8ywha3\nBut I need everything in object no signle array so is it any possibilities in this class without using custom function. this result I want.\nhttp://prntscr.com/8ywhxg\n. please view this link of codeignitor framework\nhttp://www.codeigniter.com/user_guide/database/query_builder.html\n$this->db->get_compiled_select()\ncan we make jus like that Compiles the selection query just like $this->db->get() but does not run the query. This method simply returns the SQL query as a string.\n. ",
    "jk-1001": "Thanks for that but I still don't fully understand how to utilise this code. Is it possible for you to give a more in-depth example? For example, how do I use it with the $db->get function in order to show the results of that particular page? Also, how to create the page numbers at the bottom of the table? Thanks for your help.\n. This is the code I'm using based on your readme. How can I paginate this?\n$db->join(\"location\", \"article.location_id=location.id\", \"LEFT\");\n$db->join(\"service\", \"article.service_id=service.id\", \"LEFT\");\n$db->join(\"user\", \"article.user_id=user.id\", \"LEFT\");\n$db->orderBy(\"created_date\", \"desc\");\n$articles=$db->get(\"article\", null, \"article.*, location.name as location, service.name as service, user.name as user\");\nI really do appreciate the help.\n. Thanks! I look forward to it. :)\n. Have you managed to make any progress on this? Thanks.\n. Thanks,\nI tried to adjust it by adding your line at the top:\n```\npublic function insert()\n    {\n        $db = MysqliDb::getInstance();\n    $data=array(\n        \"account_id\" => $this->account_id,\n        \"town_id\" => $this->town_id,\n        \"type_id\" => $this->type_id,\n        \"created_date\" => $this->created_date,\n        \"modified_date\" => $this->modified_date,\n        \"reference\" => $this->reference,\n        \"price\" => $this->price,\n        \"bedrooms\" => $this->bedrooms,\n        \"bathrooms\" => $this->bathrooms,\n        \"build\" => $this->build,\n        \"plot\" => $this->plot,\n        \"pool\" => $this->pool\n    );\n    $this->id=$db->insert(\"property\", $data);\n    return $this->id;\n}\n\n```\nHowever, now I get the following error:\nWarning: mysqli_stmt::bind_param(): Number of elements in type definition string doesn't match number of bind variables in on line 1094\nThanks for your help.\n. Nevermind, that last error was my own error. Many thanks for your help.\n. It works if I specify quotes around the 0 so i'll just use that. Is it intended to work that way?\n. ",
    "emman-ok": "I would really love to see the support for PDO and native MySQL\n. Yeah Of course careless me . Thanks very much.\n. ",
    "igestalten": "there it is! thankyou!\n. but $db->count returns number of rows? I\u00b4m trying to ge the number of fields.\nUsually i would do something like\n$result = mysqli_query($query);\n$numberOfFields = mysqli_num_fields($result);\nwith $numberOfFields returning the number of fields (cols). \n. ",
    "KpuTuK": "added\n. Thank you.\n. \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u0442\u0435 \u043f\u043e\u0432\u043d\u0438\u043c\u0430\u0442\u0435\u043b\u044c\u043d\u0435\u0439 \u043a\u043e\u0434 \nphp\narray_filter($params, function ($param){\n                return $this->_mysqli->real_escape_string($param);\n            }\n\u0441 \u044d\u0442\u043e\u0439 \u0446\u0435\u043b\u044c\u044e \u0438 \u043d\u0430\u043f\u0438\u0441\u0430\u043b \u0447\u0442\u043e \u043d\u0435 \u043d\u0443\u0436\u043d\u043e \u0437\u0430\u0431\u043e\u0442\u0438\u0442\u044c\u0441\u044f \u043e\u0431 \u044d\u043a\u0440\u0430\u043d\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0438 \u0442\u0430\u043d\u0446\u0435\u0432 \u0441 \u043f\u0435\u0440\u0435\u0431\u043e\u0440\u043e\u043c \u043c\u0430\u0441\u0441\u0438\u0432\u043e\u0432\n\u0431\u0443\u0434\u0435\u0442 \u0447\u0442\u043e \u0442\u043e \u0442\u0438\u043f\u043e\nphp\n$db->query('select * from users where id = %s', [1])->fetch_array();\nvsprintf \u043f\u043e\u0434\u0441\u0442\u0430\u0432\u0438\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0430 array_filter \u043e\u0431\u043e\u0439\u0434\u0435\u0442 \u043a\u0430\u0436\u0434\u043e\u0435 real_escape_string\n. \u0442\u0430\u043a\u0436\u0435 \u043a\u0430\u043a \u0438 bind_param \u0438\u0431\u043e bind_param \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u0430 \u043c\u043e\u0435\u043c\u0443 \u043c\u0435\u0442\u043e\u0434\u0443 \u0437\u0430 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435\u043c \u0442\u043e\u0433\u043e \u0447\u0442\u043e \u0438\u0434\u0435\u0442 \u0435\u0449\u0435 \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u043a \u0442\u0438\u043f\u0430\u043c\n. ",
    "warmwinter": "I think we can't init a new db connection, if the library is singleton. The variable self::$_instance is enough.:)\n. Uh, the static variable point the same address space.In the same php process, the getInstance() function can return the last instance when create multiple instances.\n. ",
    "leoliuxd": "@tommyknocker many thanks. \n. ",
    "AlexioVay": "@tommyknocker What if I want to join from database A to database B? Adding ->join didn't work for me.. I know that it is possible: http://stackoverflow.com/questions/5698378/mysql-join-between-tables-in-2-different-databases. Thank you! Good to know.\n. ",
    "iZume": "I succeeded\n$users = $sql->rawQuery(\"SELECT id,name FROM users WHERE name LIKE '%$q%' ORDER BY id LIMIT 5\");\nprint_r($users);\n. thanks! it work :smile: \n. I tried and $db->get() returns all decimals, i believe which the problem is with you php.ini.\nTry:\nini_set(\"precision\", 17);\n. __destruct is called when the script is stopped or $object = null\n. ",
    "JonnyNineToes": "I can try updating from master...\nIn the meantime, here's an example of what I'm doing. Here is a var_dump of my array:\n\narray(12) {\n  [\"product\"]=>string(9) \"client\"\n  [\"cfu_number\"]=>string(11) \"15192439898\"\n  [\"cfna_number\"]=>string(0) \"\"\n  [\"cfb_number\"]=>string(11) \"15192439899\"\n  [\"cfnr_number\"]=>string(11) \"15192439898\"\n  [\"cw_profile_status\"]=>int(0)\n  [\"sms_profile_status\"]=>int(0)\n  [\"clip_profile_status\"]=>int(0)\n  [\"cfu_profile_status\"]=>int(1)\n  [\"cfna_profile_status\"]=>int(0)\n  [\"cfb_profile_status\"]=>int(1)\n  [\"cfnr_profile_status\"]=>int(1)\n}\n\nWhich is output, right before I use it with ->update().\nHere's how I use the query...\nif ( $db->update('subscriber', $update) )  {...\nHere is the query that is output right after I run the query....\n\nUPDATE aspenta_subscriber \nSET product = 'client', cfu_number = '15192439898', cfna_number = '', cfb_number = '15192439899', cfnr_number = '15192439898', cw_profile_status = '0', sms_profile_status = '0', clip_profile_status = '0', cfu_profile_status = '1', cfna_profile_status = '0', cfb_profile_status = '1', cfnr_profile_status = '1' \nWHERE imsi = '302340000000303' \nAND msisdn = '15196027015'\n\nNotice that fields, such as \"cw_profile_status\" are being wrapped in single quotes; denoting that they  have been inserted as strings.\n. Wait... you said that \"getLastQuery\" doesn't return the exact SQL query that was used...?\n. I see... I'm still currently trying to get a legitimate \"last query\" from my database to see what really was submitted. I may have to continue this on Monday.\nAs for what value is in those fields, either they're blank, 0 (zero), or they're 1. As per DESCRIBE, that field is an unsigned tinyint(3).\n. Okay. I have to apologize for pulling the fire alarm on you, but thank  you for trying to help. The issue ended up being a user issue... was something wrong with the way they were inputting the data into the form. I'll close this and leave it be. Thanks again.\n. ",
    "Ynhockey": "I created the tag, but unfortunately it's because I had to ask a question there that wasn't answered here (about the non-Latin characters) :( if you know the answer (as the maintainer of this project), any help would be appreciated.\n. ",
    "VipSaran": "This is my table:\n\nCreated with:\nCREATE TABLE IF NOT EXISTS `customer_project` (\n  `customer_id` INT(12) NOT NULL,\n  `project_id` INT(12) NOT NULL,\n  PRIMARY KEY (`customer_id`, `project_id`),\n  INDEX `customer_project_ibfk_2_idx` (`project_id` ASC),\n  CONSTRAINT `customer_project_ibfk_1`\n    FOREIGN KEY (`customer_id`)\n    REFERENCES `customer` (`id`)\n    ON DELETE RESTRICT\n    ON UPDATE RESTRICT,\n  CONSTRAINT `customer_project_ibfk_2`\n    FOREIGN KEY (`project_id`)\n    REFERENCES `project` (`id`)\n    ON DELETE RESTRICT\n    ON UPDATE RESTRICT)\nENGINE = InnoDB;\nI've added the $primaryKey to model:\n```\nclass CustomerProjectModel extends dbObject {\nprotected $dbTable = \"customer_project\";\nprotected $primaryKey = \"PRIMARY\";\nprotected $dbFields = Array (\n    'customer_id' => Array ('int', 'required'),\n    'project_id' => Array ('int', 'required')\n    );\n}\n```\nbut, without effect.\nThis is the dbObject (before delete):\n```\ncustomerProject=CustomerProjectModel Object\n(\n    [dbTable:protected] => customer_project\n    [primaryKey:protected] => PRIMARY\n    [dbFields:protected] => Array\n        (\n            [customer_id] => Array\n                (\n                    [0] => int\n                    [1] => required\n                )\n        [project_id] => Array\n            (\n                [0] => int\n                [1] => required\n            )\n\n    )\n\n[db:dbObject:private] => MysqliDb Object\n    (\n        [_mysqli:protected] => mysqli Object\n            (\n                [affected_rows] => -1\n                [client_info] => mysqlnd 5.0.11-dev - 20120503 - $Id: 3c688b6bbc30d36af3ac34fdd4b7b5b787fe5555 $\n                [client_version] => 50011\n                [connect_errno] => 0\n                [connect_error] => \n                [errno] => 0\n                [error] => \n                [error_list] => Array\n                    (\n                    )\n\n                [field_count] => 2\n                [host_info] => localhost via TCP/IP\n                [info] => \n                [insert_id] => 0\n                [server_info] => 5.5.5-10.1.8-MariaDB\n                [server_version] => 50505\n                [stat] => Uptime: 190372  Threads: 3  Questions: 7277  Slow queries: 0  Opens: 8  Flush tables: 1  Open tables: 19  Queries per second avg: 0.038\n                [sqlstate] => 00000\n                [protocol_version] => 10\n                [thread_id] => 338\n                [warning_count] => 0\n            )\n\n        [_query:protected] => \n        [_lastQuery:protected] => SELECT  * FROM customer_project WHERE  project_id = '15'  AND customer_id = '1'  LIMIT 1\n        [_queryOptions:protected] => Array\n            (\n            )\n\n        [_join:protected] => Array\n            (\n            )\n\n        [_where:protected] => Array\n            (\n            )\n\n        [_having:protected] => Array\n            (\n            )\n\n        [_orderBy:protected] => Array\n            (\n            )\n\n        [_groupBy:protected] => Array\n            (\n            )\n\n        [_bindParams:protected] => Array\n            (\n                [0] => \n            )\n\n        [count] => 1\n        [totalCount] => 0\n        [_stmtError:protected] => \n        [host:protected] => localhost\n        [username:protected] => x\n        [password:protected] => y\n        [db:protected] => z\n        [port:protected] => \n        [charset:protected] => utf8\n        [isSubQuery:protected] => \n        [_lastInsertId:protected] => \n        [_updateColumns:protected] => \n        [returnType] => array\n        [_nestJoin:protected] => \n        [_tableName:MysqliDb:private] => \n        [_forUpdate:protected] => \n        [_lockInShareMode:protected] => \n        [_mapKey:protected] => \n        [traceStartQ:protected] => \n        [traceEnabled:protected] => \n        [traceStripPrefix:protected] => \n        [trace] => Array\n            (\n            )\n\n        [pageLimit] => 20\n        [totalPages] => 0\n    )\n\n[data] => Array\n    (\n        [customer_id] => 1\n        [project_id] => 15\n    )\n\n[isNew] => \n[returnType] => Object\n[_with:dbObject:private] => Array\n    (\n    )\n\n[errors] =>\n\n)\n```\n. How come this works correctly:\n$this->db->where('project_id', $project_id)->where('customer_id', $customer_id);\n$id = $this->db->delete('customer_project');\nSorry, but what you suggest seems (to me) to be just a workaround for dbObject currently not supporting definition of PK to be a combination of several columns.\n. Close the issue? This is definitely a shortcoming and dbObject implementation assuming each table should have 1 column defined as PK is absurd.\nI'm a SQL novice, but at least I know that having the dummy ID column defined PK is not mandatory and least of all \"a good practice\".\nA quick internet search seems to backs this up:\nhttp://stackoverflow.com/questions/1207983/in-general-should-every-table-in-a-database-have-an-identity-field-to-use-as-a\nSo, please, recognize that the library is missing support for composite PKs and then fix this shortcoming.\n. > Warning: mysqli_stmt::bind_param(): Number of variables doesn't match number of parameters in prepared statement in ...\\vendor\\joshcam\\mysqli-database-class\\MysqliDb.php on line 1099\nAnd I'm not using prepared statements...\nVersion 2.6\n. ",
    "premento": "Apache error log file says \"Wrong Operation\" which is a status coming from 'PHP-MySQLi-Database-Class'\n. Thanks. I tried similar way and it worked.:)\n. Any plans to implement? Highly useful :)\n. yes, I was looking into this. Is there a sample to see how transactions could be used for the same?\n. Just a doubt, instead of using 10 separate inserts, will there be any advantage in using this new multiInsert? Will the mysql write transactions reduce?\n. I have added protected $_transaction_in_progress = false; to mysqlidb.php and it worked fine. Not sure whether its correct or not.. ",
    "Xusanbek": "\u041a\u0430\u043a \u0431\u044b\u0441\u0442\u0440\u043e \u043e\u0442\u0432\u0435\u0442\u0438\u043b\u0438. :)\n\u0421\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0430 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 ASC \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0438\u043b\u0438 \u043c\u043e\u0436\u043d\u043e \u0442\u043e\u043b\u044c\u043a\u043e RAND()? \n. \u041a\u0430\u043a \u044f \u043f\u043e\u043d\u044f\u043b, \u044d\u0442\u043e \u0412\u044b \u0441\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u043a\u043b\u0430\u0441\u0441\u0430 MySQLi?\n\u041f\u0440\u043e\u0441\u0442\u043e \u044f \u0432\u043f\u0435\u0440\u0432\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0441\u044c Github'\u043e\u043c \u0438 \u044d\u0442\u0438\u043c \u043a\u043b\u0430\u0441\u0441\u043e\u043c.\n\u0412 \u043c\u043e\u0435\u043c \u0441\u043a\u0440\u0438\u043f\u0442\u0435 \u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0438\u043c\u0435\u0435\u0442\u0441\u044f MysqliDb.class.php, \u0432\u043e\u0442 \u0438 \u043e\u0442\u0442\u0443\u0434\u0430 \u043f\u043e\u043f\u0430\u043b \u0441\u044e\u0434\u0430.\n\u0411\u044b\u043b\u0430 \u0432\u0435\u0440\u0441\u0438\u044f 2.4, \u043e\u0442\u0441\u044e\u0434\u0430 \u0432\u0437\u044f\u043b \u0438 \u043f\u043e\u0441\u0442\u0430\u0432\u0438\u043b \u0441\u0430\u043c\u0443\u044e \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044e\u044e \u0432\u0435\u0440\u0441\u0438\u044e. \u0411\u0443\u0434\u0435\u0442 \u043b\u0438 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0432\u0441\u0435 \u043f\u043e\u043b\u043d\u043e\u0446\u0435\u043d\u043d\u043e \u043a\u0430\u043a \u0438 \u0440\u0430\u043d\u044c\u0448\u0435 \u043d\u0430 \u043d\u043e\u0432\u044b\u0445 \u0432\u0435\u0440\u0441\u0438\u044f\u0445? \u0422\u043e \u0435\u0441\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0434\u043e? \nP.S.: \u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0412\u0430\u043c \u0437\u0430 \u043f\u043e\u043c\u043e\u0449\u044c \u0441 Rand().\n. \u042f\u0441\u043d\u043e.\n\u0415\u0449\u0435 \u043e\u0434\u0438\u043d \u0432\u043e\u043f\u0440\u043e\u0441, \u0435\u0441\u0442\u044c \u043b\u0438 \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043a\u043b\u0430\u0441\u0441\u0430, \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u043a\u043b\u0430\u0441\u0441 \u043f\u043e\u0441\u0442\u0440\u0430\u043d\u0438\u0447\u043d\u043e\u0439 \u043d\u0430\u0432\u0438\u0433\u0430\u0446\u0438\u0438?\n\u0410 \u0442\u043e \u0441\u0432\u043e\u0439 \u043a\u0430\u043a-\u0442\u043e \u0441\u0442\u0440\u0430\u043d\u043d\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442. \u0418 \u0435\u0441\u043b\u0438 \u043d\u0435\u0441\u043b\u043e\u0436\u043d\u043e, \u043e\u0431\u044a\u044f\u0441\u043d\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043a\u0430\u043a \u0435\u0433\u043e \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c.\n. \"\u0430 \u0432 \u0433\u0443\u0438 \u043f\u0435\u0439\u0434\u0436\u0435\u0440 \u043d\u0443\u0436\u043d\u043e \u0431\u0443\u0434\u0435\u0442 \u0441\u0430\u043c\u043e\u043c\u0443 \u0440\u0438\u0441\u043e\u0432\u0430\u0442\u044c\"\n\u041d\u0435 \u043c\u043e\u0433\u043b\u0438 \u0431\u044b \u0431\u043e\u043b\u0435\u0435 \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u0435\u0439 \u0443\u0442\u043e\u0447\u043d\u0438\u0442\u044c \u0432\u0441\u0435 \u044d\u0442\u043e?\n. ",
    "AlbertMN": "Well, not really - the two questions doesn't have anything to do with eachother. I just want to 'echo' a table's value. Fx. echo a users' username.\n. Like this; echo escape($user->data()->username);\nGetting, outputting a MySQL value.\n. Thank you - will try that asap.\nEdit:\nWorked flawless.\n. Where would I clarify this?\n. All my phpmyadmin/MySQL tables are utf8, so is my php document & my . \n. ",
    "igor-silva": "I'm with a similar problem:\nWarning: mysqli_stmt::bind_param(): Number of variables doesn't match number of parameters in prepared statement in /home/XXXX/www/vendas/classes/conexao.class.php on line 128\n$params = Array(0, $data_venda_i, $data_venda_f, $var_vmin, $var_vmax);\n    $results = $db->rawQuery(\"SELECT\n    Dados_comprador.idDados_comprador,\n    Dados_comprador.nome,\n    Dados_comprador.dt_nasc,\n    Dados_comprador.tel,\n    Dados_comprador.cel,\n    Dados_comprador.email,\n    Dados_comprador.cpf,\n    Dados_comprador.rg,\n    Dados_comprador.rua,\n    Dados_comprador.num_resid,\n    Dados_comprador.bairro,\n    Dados_comprador.cidade,\n    Dados_comprador.uf,\n    Dados_comprador.porque_h,\n    Dados_imovel.idDados_imovel,\n    Dados_imovel.ref,\n    Dados_imovel.imovel,\n    Dados_imovel.edificio,\n    Dados_imovel.rua,\n    Dados_imovel.num,\n    Dados_imovel.cidade,\n    Dados_imovel.bairro,\n    Dados_imovel.uf,\n    Dados_imovel.apto,\n    Dados_venda.idDados_venda,\n    Dados_venda.valor_imovel,\n    Dados_venda.nf,\n    Dados_venda.pos_venda,\n    Dados_venda.total_despesas,\n    Dados_venda.dt_venda,\n    Dados_venda.dt_receb,\n    Dados_venda.exclusividade,\n    Dados_venda.comissao_corretor1,\n    Dados_venda.comissao_corretor2,\n    Dados_venda.nome_corretor1,\n    Dados_venda.nome_corretor2,\n    Dados_venda.comissao_agenc,\n    Dados_venda.nome_agenc,\n    Dados_venda.comissao_imob,\n    Dados_venda.comissao_bruta,\n    Dados_venda.comissao_liq,\n    Dados_venda.data_pag,\n    Dados_venda.form_pag,\n    Dados_venda.valor_pag,\n    Dados_venda.comissao_bruta,\n    Dados_venda.Dados_comprador_idDados_comprador,\n    Dados_venda.Dados_imovel_idDados_imovel,\n    Dados_venda.usuarios_idUser\n    FROM \n    Dados_venda \n    INNER JOIN Dados_comprador ON Dados_comprador.idDados_comprador = Dados_venda.Dados_imovel_idDados_imovel\n    INNER JOIN Dados_imovel ON Dados_imovel.idDados_imovel = Dados_venda.Dados_imovel_idDados_imovel \n    WHERE Dados_venda.idDados_venda > 0 \n    AND Dados_venda.dt_venda >= ?\n    AND Dados_venda.dt_venda <= ?\n    AND (Dados_venda.valor_imovel BETWEEN ? AND ?) \", $params);\nprint_r($results);\ndie();\n. ",
    "johnvanhulsen": "I get the same warning. My code:\n```\n<?php $mysqli = new mysqli('localhost', 'root', 'pass', 'db');\n$db = new MysqliDb ($mysqli);\nfunction getProducts($id) {\n    $db = MysqliDb::getInstance();\n    $product_ingredients = $db->rawQuery('SELECT * etc...', Array (10));\n    foreach ($product_ingredients as $pi) {\n        print_r($pi);\n    }\n}\ngetProducts(1);\n?>\n```\n. ",
    "jefvhal": "Hi, I was using the online readme.md as a reference while coding . I used 2.5 (latest release) and not master. When using 2.6 master, the problem is solved indeed.\nClearly I was too quick and have to wait for next release. Thanks for the prompt reply.\n. Thanks @duhow . ",
    "iHaMoo": "I've already update to lasted release. But still got same error.\n. ## My mysqlidb initialize\n$mysqli = new mysqli (DB_HOST, DB_USER, DB_PASS, DB_NAME);\n$mysqli->set_charset ( 'utf8' );\n$db = new MysqliDb ($mysqli);\n. ",
    "Toyz": "Tried that, it uses a direction and with my query your losing the keep order with perserving the values and when uing the \"in\" mysql uses filesort  which sorts the keys in correct order, but order by doesn't allow for pservsing the order which is called without no direction\n. I am using the version from Master there is force validation for direction in the orderBy\n. Fixed by using rawQuery\n. ",
    "DaGuich": "Do you run more than one instance of the class?\n. ",
    "tvdsluijs": "no. I dont\n. ",
    "joshghent": "@DaGuich I am also getting this error and have multiple instances of the class. Why would that affect things?. @tvdsluijs @DaGuich Coming back to this now that I figured out the issue. For me it turned out to be that I was running multiple queries on the same class instance but the connection was being closed and then attempting to run a query.\nThe solution was to remove all the ->close() calls. My application still seems to be running fine. I know it's good practise to close the connection but maybe it should be removed from the library? What do you think @avbdr? Is there any reason besides best practise for those ->close calls to be there?. @avbdr My use case was having multiple classes that use the MySqliDB class within them. The constructor for these classes take a mysqli object as an argument which is then passed to the mysqlidb. \nThe constructors do not error but after the 3rd query I run it just fails to fetch the mysqli instance within the mysqlidb class. I googled around and came up with the issue of a connection being closed and then running a query on that closed connection (which would fail), sure enough, after I removed the ->close calls it worked fine.\nMaybe there is more digging to be done here to solve this whether I'm at fault or there is something to fix in the library :). @siberfx The code I had wasn't closing the connection it was the mysqlidb library itself that was calling the close() method.. @ricwein Yes sorry I should clarify, it returns the column name literally as 'o.firstname as Firstname'! I am using the current copy of the master branch.. Yes it was the correct query. \nSELECT  o.orderID, o.userID, u.firstname as Firstname, u.surname FROM orders o  JOIN user u on u.userID=o.orderID\nI realise the issue though. I am building up a CSV with this information. Since fputcsv does not realise that these are SQL columns it is just inserting the string 'u.firstname as Firstname'. Doh!\nThanks for your help!. ",
    "siberfx": "instead of using close(); in the end of each query, \nuse this close on the footer part of the site, so when the page loads, it will close connection, each time you switch another page, in all the way you can set an init file to make the connection again. This is my advice, I am using it that way and no any problems and working fine.. what about pagination? I couldnt succeed with pagination code. \n. This i know the content listing according to pagination.. this is what i\nneed\nOn Oct 17, 2016 2:39 PM, \"Richard Weinhold\" notifications@github.com\nwrote:\n\nPlease read the Readme. To be more precise: Readme: Pagination\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class#pagination.\nFor your specific problem, you can do something like:\n$page = 1;$db->pageLimit = 10;$db->where('town', '%' . $search . '%', 'LIKE');$page = $db->paginate('house', $page);echo \"showing $page out of \" . $db->totalPages;\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/535#issuecomment-254183988,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AJyDWBeiNevmmmoKURhHqbqcFKBmrD_Bks5q015sgaJpZM4KUfNH\n.\n. you can do it this way:\n$searchVar = '%'. $value.'%';\n$db->where(\"name\",$searchVar, \"LIKE\")\n->orWhere('content', $searchVar, 'LIKE')\n->get(\"db_table\");\n. at least give some samples from your mysql, so we can advise you what to do.. thanks\n. $db->now() gives full date. even with the time. so you have to solve it with different method/ function.. or maybe you should try a variable like;\n<?php\n$varDate = date('d'-'m'-'Y');\n\nand put this variable into the query.. another solution is add in your MySQLiDb file before the last \"}\" this function code below;\n/**\n     * Method generates date with the prompt you choose by a function call.\n     * @return array\n     */\n    public function onlyDate($mod = \"d-m-Y\")\n    {\n        return array(\"[I]\" => date($mod));\n    }\nand replace your query with : \nQuery1: $dbi->where('id',$data['event'])->where('date',$dbi->onlyDate(),'<')->has('events')\n. use the whole query as in Chain system.\nand for the \"where\" queries try to use it as integer\n$employee = $db->where(\"status\",0)->where(\"delete\",0)->get(\"employee\");. can you try to share the query code which you think is not working?. in 7.2 also works . show more spesific code, and try to explain what exactly you want to do ? I may help you.. and I also would like to have a selfi with mikhail bashkatov from Kuhnya serial :). check sub queries.. can you please share the code that you have tried?. have you tried orderBy with an integer (int) value instead of a string?. ->where ('receiver', array($receiver, $sender), 'IN')\n->orWhere('sender', array($receiver, $sender), 'IN'). Use raw querying\nSelim GORMUS - Asus zenfone 2\nOn Sun, May 13, 2018, 4:07 PM r94ever notifications@github.com wrote:\n\nHi all,\nI have a query which is not very complex, and although I can solve it by\nusing RAW query, but I would like to know there are other solutions or not.\nMy raw query is:\nSELECT SQL_CALC_FOUND_ROWS * FROM b1h5p6_staffs s JOIN b1h5p6_positions p\non p.ID = s.position JOIN b1h5p6_branches b on b.ID = s.branch WHERE\ns.status = 'activated' AND s.gender = 'male' AND s.branch = '1' AND (\ns.username LIKE '%ivan%' OR s.firstName LIKE '%ivan%' OR s.lastName LIKE\n'%ivan%' OR s.email LIKE '%ivan%' OR s.website LIKE '%ivan%' OR s.mobile\nLIKE '%ivan%' ) ORDER BY s.ID ASC LIMIT 0, 10\nThe problem is the ( and ) characters. If I code like this:\n$db->where( 's.username, '%' . 'ivan' . '%', 'LIKE' )\n      ->where( 's.status , 'activated' )\n      ->where( 's.gender, . 'male'  )\n      ->where( 's.branch, '1' )\n      ->orWhere( 's.firstName, '%' . 'ivan' . '%', 'LIKE' )\n      ->orWhere( 's.lastName, '%' . 'ivan' . '%', 'LIKE' )\n      ->orWhere( 's.email, '%' . 'ivan' . '%', 'LIKE' )\n      ->orWhere( 's.website, '%' . 'ivan' . '%', 'LIKE' )\n      ->orWhere( 's.mobile, '%' . 'ivan' . '%', 'LIKE' )\nit will have no ( and ) characters in the real query, which are very\nstrong as the filters of my search box. Thank for any help!\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/ThingEngineer/PHP-MySQLi-Database-Class/issues/752,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AJyDWNZrK6PY2Y0b3e8j2OGbOxaZBpg4ks5tyDAdgaJpZM4T8yvl\n.\n. As i understand, you want queries with 'and' right?\n\nSelim GORMUS - Asus zenfone 2\nOn Sun, May 13, 2018, 4:37 PM r94ever notifications@github.com wrote:\n\nThanks but as I said. I would like to look for a solution without Raw query\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/ThingEngineer/PHP-MySQLi-Database-Class/issues/752#issuecomment-388627372,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AJyDWA0TqtM_v1Kr-hN9EXpFx_M5Lwvgks5tyDcjgaJpZM4T8yvl\n.\n. Also check about sub querying for the query you gaved i see it also needed\n\nSelim GORMUS - Asus zenfone 2\nOn Sun, May 13, 2018, 4:58 PM Selim G\u00d6RM\u00dc\u015e info@siberfx.com wrote:\n\nAs i understand, you want queries with 'and' right?\nSelim GORMUS - Asus zenfone 2\nOn Sun, May 13, 2018, 4:37 PM r94ever notifications@github.com wrote:\n\nThanks but as I said. I would like to look for a solution without Raw\nquery\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/ThingEngineer/PHP-MySQLi-Database-Class/issues/752#issuecomment-388627372,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AJyDWA0TqtM_v1Kr-hN9EXpFx_M5Lwvgks5tyDcjgaJpZM4T8yvl\n.\n\n\n. Use try catch to understand if the query properly working or not, i have not experienced such issue at all. Try to take a look for subqueries or if you find it complicated then use directly raw queries. \n",
    "TeamOTLS": "thanks @joshghent  i will solve my problem now... ",
    "Noneatme": "See https://github.com/Noneatme/PHP-MySQLi-Database-Class/commit/487c461832f5e9a55cb987a5224b33e11b6d4758 for importing CSV files\n. There seems to be some errors in your code. I tired to reproduce your problem, but I failed to do so.\n``` PHP\nrequire_once  \"MysqliDb.php\";\n$db = new MysqliDb ('localhost', 'noneatme', '12345', 'db_test');\n$db->where('user_id', 2);\nif($db->delete('log')) echo 'successfully deleted';\n```\n\nphp test.php\nsuccessfully deleted\n\nDo you have more info, e.G. more code lines?\n. Well, in that case it makes sense, because there is no data row with the user_id 1 in the table 'log'.\n. Can you post some examples about the requests you are sending to your sql server?\n. Alright! Thanks!\n. I fixed the issues you you mentioned. Thanks!\nBut now, the tests fail somehow (data doesn't get inserted). I have to take a deeper look. Don't merge right now, I will push a commit later when I found the issue.\n. It should work now. The .csv test file was not in dos mode so the \\r\\n selector failed.\n. Is that a fault within the wrapper? It seems to me that this problem is a hosting problem with your server hoster.. ",
    "TwinMist": "Did export get added as can not see any code for it?\nthanks. ",
    "jmanic": "I'm using it this way:\n$params = array(\n 'field1' => $subQuery_from_source,\n 'field2' => $subQuery_from_another_source\n);\n$id =  $db->insert('elaborate_insertion_table', $params);\nthe reason for this, is that I needed ACID compliance whithout explicit locks;\nof course, it could be done using one single custom query, but that aslo means loss of readability and maintainability!\n. ",
    "pieczarkazsolt": "sorry sorry sorry :(\nphp\n$db->where('user_id', 1);\nnot\nphp\n$db->where('user_id', 2);\n. ",
    "jcbelbey": "Sorry! only need include file. \n. ",
    "fryiee": "I recently had to do this as well, and this was the closest I got. I don't think it's possible to run multiple separate columns in the single subquery. Let me know if there's a particular reason this is bad! (It's worked in my test cases):\nphp\n$data = [\n        \"col1\" => $db->subQuery()->getOne(\"table1\", null, \"col1 as a\")->getLastQuery(),\n        \"col2\" => $db->subQuery()->getOne(\"table1\", null, \"col2 as b\")->getLastQuery(),\n    ];\n$id = $db->insert(\"table2\", $data);\nAttempting to use getValue in the subquery returned an error for using an array from L605.\n. ",
    "Stewe21": "Something like Query exectution time benchmarking ?\n. ",
    "somethingweird": "I also having that issue - \nPHP 7.0 from remi repo using php-fpm\nFatal error: Uncaught Exception: Problem preparing query (SELECT * FROM information_schema.tables WHERE table_schema = NULL AND table_name NULL LIMIT 1) \nYou have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'NULL LIMIT 1' at line 1\nits  coming from \"public function tableExists($tables)\"\nSide Note:\nNotice: Undefined index: in .../vendor/joshcam/mysqli-database-class/MysqliDb.php on line 732\nVersion I'm using..\n- Updating joshcam/mysqli-database-class dev-master (00824c1 => 95b27c5)\n  Checking out 95b27c5af0772bb6df3f93d7bcd11787daedd79a\n. ",
    "webmonkey100": "I also have the issue (uwamp/php 7.0.3/class 2.6)\nFatal error: Uncaught Exception: Problem preparing query (SELECT * FROM information_schema.tables WHERE table_schema = ? AND table_name NULL LIMIT 1) You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'NULL LIMIT 1' at line 1 in .....mysqlidb.php on line 1482\n. ",
    "chenmin201": "I have found the cause of this problem!\nProblem fixed after I did the following changes in MysqliDb.php:\n```\npublic function where($whereProp, $whereValue = 'DBNULL', $operator = '=', $cond = 'AND') {\n    // forkaround for an old operation api\n  // reset the internal pointer of the $whereValue array. This fix problems in PHP 7\n    if (is_array($whereValue)) {reset($whereValue);}\nif (is_array($whereValue) && ($key = key($whereValue)) != \"0\") {\n    $operator = $key;\n    $whereValue = $whereValue[$key];\n}\nif (count($this->_where) == 0) {\n    $cond = '';\n}\n\n$this->_where[] = Array($cond, $whereProp, $operator, $whereValue);\nreturn $this;\n\n}\n```\nIt seems like, somehow, in PHP 7, when $whereValue array is passed into function where(), the array's internal pointer has already been advanced to the end of the array. key($whereValue) would actually return NULL.\n. ",
    "raakesh": "https://github.com/joshcam/PHP-MySQLi-Database-Class#running-raw-sql-queries\ntake a look at advanced raw query example provided in the example.\n. I don't see any problem here. It works for me. The two echoed values will be side by side. Say, first value is 3 and second value is 5, the final echoed output will be 35. \n. Here is an example\n```\n$db->where('column_name', '%string%', 'like');\n$rows = $db->get('table_name');\n``\n. delete composer.lock and try.\n. I don't think there is any relationship between update query and redirection. \nUseecho $db->getLastError()` after update query and tell us what you see.\n. ",
    "iamtechplayer": "No way to get before ? Check this #442\n. ",
    "catalin87": "Great :+1:\nThanks and sorry :) \nThe result of the echo is: \nName <name@email.com>,\nbut Chrome get <name@email.com>as a html tag .. I can see it if I view source :)\n. ",
    "shervs336": "I've already fixed it. Thank you for your response.\n. ",
    "JacsonRitzmann": "I'm getting an error while trying to query a die.\nCatchable fatal error: Argument 1 passed to WMS\\Db\\MysqliDb::_dynamicBindResults() must be an instance of WMS\\Db\\mysqli_stmt, instance of mysqli_stmt given, called in .../mvc/vendor/WMS/Db/MysqliDb.php on line 677 and defined in .../mvc/vendor/WMS/Db/MysqliDb.php on line 1519\npublic function __construct(\\mysqli $db)\n{\n    $this->db = new MysqliDb ($db);  \n    //$this->db = $db;  \n}\n\npublic function listaTodos()\n{\n    /*\n    $query = \"SELECT * FROM members \";\n    return $this->db->query($query);\n    */\n    $res = $this->db->get('members');\n    return $res;\n\n}\n\nThe commented code is ok.\nIf you can give me a hand, I thank you .... ",
    "jakobdo": "Thanks.\n. ",
    "Gregor-Agnes": "But is this still injection free if I have to use external variables in the or clauses?. Ooops, found it: $db->where (\"(id = ? or id = ?)\", Array(6,2));\nBtw: Thank you for that great class \ud83d\udc4d . ",
    "carliblaz": "This works somehow:\n$db->where('date < NOW() - INTERVAL duration MINUTE');\n. ",
    "pratikghela": "Can you please let me know the budget for PDO support. I would like to implement PDO as PDO supports MSSQL. We want PDO support from the start as we do not want to change the entire application and want an ability to implement a plug & play system where we can just change the database quickly without major downtime and code restructuring. \n. ",
    "Coriou": "\nhave you tried to lower your buffer value to a lower, say 100-200?\n\nYes, I have tried that.\nActually, I believe it's a bug in my software now. Because what happens is the $result variable does not seem to be destroyed until my script has fully completed. In my opinion, it should be destroyed after every query, or after every batch of queries at least maybe.\nWhat's causing the out of memory exception is that the array is eventually too big.\nI haven't looked at back at this since I posted here. But I will eventually and update you if I find what's causing this array to never be destroyed.\n. ",
    "carlosfusion": "i just delete the joshcam folder and it works, ill try next time delete .lock file.\nThanks\n. ",
    "bwright611": "OK, thanks. I'll just do another connection and do a query myself. Is there a function to get your mysqli object so I can use it directly, instead of opening another connection?\n. ",
    "hitwill": "Thanks, I experienced the same problem, and the fix above seemed to work\n. This is the function that was causing the error:\n`protected function replacePlaceHolders($str, $vals)\n    {\n        $i = 1;\n        $newStr = \"\";\n        $vals = array_filter($vals);////This MOD seems to fix the error!!!!!\n        if (empty($vals)) {\n            return $str;\n        }\nwhile ($pos = strpos($str, \"?\")) {\n        $val = $vals[$i++];\n        if (is_object($val)) {\n            $val = '[object]';\n        }\n        if ($val === null) {\n            $val = 'NULL';\n        }\n        $newStr .= substr($str, 0, $pos) . \"'\" . $val . \"'\";\n        $str = substr($str, $pos + 1);\n    }\n    $newStr .= $str;\n    return $newStr;\n}`\n. ",
    "jtorvald": "I've maybe the same problem, when I have a column: is_success as tinyint the value for that is removed from the data array for some reason. This is the $str and $vals that went into the replacePlaceHolders function:\nINSERT INTO cms_user_login_attempt (type, username, ip_address, user_agent, is_success, login_at_timestamp) VALUES (?, ?, ?, ?, ?, ?) \nArray \n( \n[0] => ssssii \n[1] => cms \n[2] => 191060 \n[3] => 83.250.39.168 \n[4] => Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.95 Safari/537.36 \n[6] => 1483534067 \n) \nYou can see that the index 5 is removed somewhere. If I put the is_success as the last key you see the same only index 6 is then removed. While you see in the index 0 that it expects 4 strings and 2 ints. The fix above didn't do anything in my case.\nMaybe this info helps you to figure out what is going wrong. I don't have the time now to debug it further and find a fix.. ",
    "dunqi": "Use 2 $db->join commands (every table that joins - in 1 command)\n$db->join(\"users u\", \"p.tenantID=u.tenantID\", \"LEFT\");\n$db->join(\"arcitcles a\", \"a.tenantID=u.tenantID\", \"LEFT\");\n. I dont know what you mean. Cause in my world I dont call a join of two tables (A and B) as AB. So you cant say: join(\"usersarticles\", ...) if you join \"users\" with \"articles\". \nIn my example above - I just join A with B - and B with C. not AB with C.\n. That's just mean, that you select the Row with the exakt name \"content(json)\" from the table tabName.\nSELECT id, content(json) FROM tabName LIMIT 1;\nYou cant parse functions in Select-Statements. If you want content as JSON:\n$db->JsonBuilder()->getOne(\"tabname\", \"content\");\n. SELECT * FROM house WHERE town LIKE '%ndon%' - should print \"London\" for example.\nSo the solution is:\n$db->where('town', '%ndon%', 'like');\n$rows = $db->get('house');\nYou just have to replace the \"ndon\"-String with your variable\n. ",
    "VeRJiL": "thnx @dunqi  for the help.\ni have another question. if we join table A with B we will have table AB, right ? then if we use the second join command we join table AB with C which gives us table ABC. am i right ?\n. @dunqi thank you man, now i understand the logic of join method.\n. ",
    "wuchuguang": "yes, thanks\n. getOne(\"tabName\", [\"id, content(json), other(xml)\"]) like this.\ncan't select once do ok.\n. format return data. format one fields\ngetOne(\"tabName\", [\"id, content(myformat)\"]).\nfunction myformat_writer($data){\n      return format($data);\n}\nfunction myformat_reader($data){\n      return format($data);\n}\n. ",
    "subseven": "One example:\n```\n$db = new MysqliDb (MYSQL_HOST, MYSQL_USER, MYSQL_PASS,MYSQL_DB);\n$db->setPrefix (MYSQL_TABLE_PREFIX);\n$user = $db->getOne (\"users\", \"*,\ndate_format(`created`,'%d.%m.%Y  %H:%i') AS create_date,\ndate_format(`last_modified`,'%d.%m.%Y  %H:%i') AS lastmod_date,\ndate_format(`addon_activated`,'%d.%m.%Y') AS addon_activated_date,\ndate_format(`addon_expires`,'%d.%m.%Y') AS addon_expire_date,\ndate_format(`expires`,'%d.%m.%Y') AS expire_date,\nunix_timestamp(`last_modified`) AS lastmod_unix\");\n\nif ($db->count > 0) Print_r($user);\n\n```\nThis is one example. All other routines are equal or using raw queryies.\nWith the same result.\nI also let a profi coder, who also had experience with this class take a look on my code, and he didn\u00b4t found an error in Code.\nregards,\nMarquez\n. Well,\nyou can believe me or not. This is the only Code which is used int the PHP for my SQL Query, which causes the issue !\nThe Print is only added for controlling since the issue arrived.\nAfter that I only work with the data from $user ! Nothing more in this script !\nAnd you also should know, that it was working long time without any problems. But from one day to another it caused this descripted issue !\nYou also can trust me, when I say to you, when making the query directly with mysqli without using the class on low level all works fine.\nWhy do I say this ? Because in our live project I was forced to do so,otherwise we couldn\u00b4t continue our project.\nRegards\n. Ok,\nwe can do the following:\nCurrently I am really under pressure for other projects.\nBut when I find Time, I will create exactly this php script on one Domain for you for testing reasons, with some demo entries, and the used class, give you ftp access, where you can see the true used php code, and you can check by yourself to find out or fix the error.\nBecause normally I prefer to use existing classes except using own written code, because on other Scripts I also used the class where the calls were more complicated and needed to be more secured.\n. ",
    "und3rsc0re": "@avbdr How may I understand? I'm new to PHP, so please be a little more patient with me. :+1: Anyway, I have a folder called 'mysql' containing all the files of the mysql wrapper. I required it from index.php by 'require_once('mysql/MysqliDb.php')' and then started to work with it.\n. I'm using XAMPP but also tried WAMP. Both working fine for me with other mysqli classes or self-written stuff, so I assume mysqli is installed.\n. @arieffikhrie Now I'm getting this error:\nNotice: Undefined property: MysqliDb::$error in F:\\xampp\\htdocs\\includes\\mysql\\MysqliDb.php on line 1599\n. @avbdr $connection = new MysqliDb(Array(\n    'host' => $host,\n    'username' => $username,\n    'password' => $password,\n    'db' => $db,\n    'port' => $port,\n    'charset' => $charset\n));\n$database = new MysqliDb($connection);\n. When I want to check if there was an error, I'm using this code where it says undefined property (as stated above):\necho $database->getLastError();\n. @avbdr Could you please elaborate that?\n. ",
    "gamelaster": "Problem has been on my side, I not defined the $dbFields\n. check value in table structure.\nhttps://dev.mysql.com/doc/refman/5.7/en/precision-math-decimal-characteristics.html\nThe declaration syntax for a DECIMAL column is DECIMAL(M,D). The ranges of values for the arguments in MySQL 5.7 are as follows:\n- M is the maximum number of digits (the precision). It has a range of 1 to 65.\n- D is the number of digits to the right of the decimal point (the scale). It has a range of 0 to 30 and must be no larger than M.\n. Yeah, I use the latest version from composer.\n. Bump, any workaround? Actually, I understand why this doing, but can be integraded a function to create classes as \"Query\" where we can apply ->where etc... ? Because just I cannot run two queries at once.\nThanks\n. Bump again this. Well, I get why this happening.\nThe where, order etc. functions are executed to last \"created\" query. That mean I can't \"setup\" multiple queries at once, because the \"where\" conditions and other will be applied to latest \"created\" query.. ",
    "Alekusu": "Thanks, but you didn't reply to my initial question, do i really need to escape the data ?\nAnd the preg_replace solution is a little dirty when you use prepared statement. \n. So just to be clear (sorry i'm a noob) : there is no need to use $db->escape() for security purpose ? \nWithout, it's totally safe and no risk of SQL injection ? \nRight ? \n. ",
    "kani-rifluxyss": "thank you fro your response. Actually mysql table has the value, it's changing only when it's read from the data array fetched using \ndb-get();\nI manually checked in database table, it contains all letters so mysql is not rounding it.\n. [Edited] \nNO regular mysqli/php does NOT bring the entire data\n79.185419082642\nbut database contains 79.1854190826416\nHowever I can see the full data using phpmyadmin db browser, so I think it's not related to PHP/MySQL.\nThoughts?\n. I am checking few other combinations, will get back. thanks\n. Ok, now I am sure there is a difference!\n1. regular mysqli gives this:     [lng] => 79.1854190826416\n2. Phpmyadmin gives this:     [lng] => 79.1854190826416\n3. $db->get'    gives this 79.185419082642`\nPlease help\n. @iZume thanks its making a difference! Please see the difference results from PHp with 14, 17 precision and I tried the same query from mysql command line tool as well. Any idea?\n@avbdr For my requirement I was able to handle this different with LIKE in MySQL, however I would learn why we are seeing these differences. I will continue to work on this, so please comment on this when you get some time!\nThanks\n\n. ",
    "YamiOdymel": "__destruct always called, it's my biggest problem now.\n. Oh, my bad, I was using old MySQLi-Database-Class, and there's no such function called getLastErrno(),\nnow I see it in the MysqliDB.php, I thought that's a typo :D \n. ",
    "riples": "Hi Richard, where would I need to insert this code exactly in order to\ncontrol status codes?\nThe INSERT command is bombing the code before it has a chance to execute\nanything further.\nOn Fri, Jul 22, 2016 at 6:19 PM, Richard Weinhold notifications@github.com\nwrote:\n\nthat is probably, because the MysqliDB Library doesn't overrides the\nhttp-headers. The http-status code can be set through:\n$returnCode = 500; // server-side-errorhttp_response_code($returnCode);\n...if you need to. It's completely up to you.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/joshcam/PHP-MySQLi-Database-Class/issues/505#issuecomment-234489354,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AP_8OedTufZYc2gzBYCVp9pYrBDOU1N7ks5qYIQtgaJpZM4JSgma\n.\n. Thanks guys, seem to have this working now using the try/catch...\n\n```\n               foreach( $itemsArray as $item ) {\n                $insertArray = array(\n                    \"Code\"          => $item->Code, \n                    \"Description\"   => $item->Description, \n                    \"CategoryId\"    => $item->CategoryId, \n                    \"CategoryName\"  => $item->CategoryName, \n                    \"Delivery\"      => $item->Delivery, \n                    \"AddToPallet\"   => $item->AddToPallet, \n                    \"Hidden\"        => $item->Hidden\n                );\n\n                try {\n\n                    if( !$this->db->insert( 'Site_Checklists_Tpl', $insertArray ) ) {\n\n                        $this->db->rollback();\n                        $success = false;\n                        break;\n\n                    };\n\n                }\n\n                catch (Exception $e) {\n\n                    throw new RestException( 500, $this->db->getLastError() );\n\n                }\n\n            }\n\n            if( $success ) {\n\n                $this->db->commit();\n                ...\n\n```\n. Sorry to post after the ticket has been closed, but I still seem to be struggling with this.\nTake this example:\n```\n// Update the Checklist\n            $updateArray = array(\n                \"Description\"       => $checklist->Description, \n                \"DueDate\"           => $checklist->DueDate, \n                \"SiteId\"            => $checklist->SiteId, \n                \"SiteName\"          => ucwords( $checklist->SiteName ), \n                \"Address\"           => $checklist->Address, \n                \"Suburb\"            => $checklist->Suburb, \n                \"State\"             => strtoupper( $checklist->State ), \n                \"PostCode\"          => $checklist->Postcode, \n                \"Phone\"             => $checklist->Phone, \n                \"Fax\"               => $checklist->Fax, \n                \"Manager\"           => $checklist->Manager, \n                \"Mobile\"            => $checklist->Mobile, \n                \"Newsagency\"        => $checklist->Newsagency, \n                \"Lenards\"           => $checklist->Lenards, \n                \"RegistersNormal\"   => $checklist->RegistersNormal, \n                \"RegistersKiosk\"    => $checklist->RegistersKiosk, \n                \"RegistersSelfServe\"=> $checklist->RegistersSelfServe, \n                \"RegistersWalkup\"   => $checklist->RegistersWalkup, \n                \"RegistersMobile\"   => $checklist->RegistersMobile, \n                \"Progress\"          => $checklist->Progress, \n                \"LastModified\"      => $currDate\n            );\n        try {\n\n            $this->db->where( 'Id', $checklist->Id );\n            if( !$this->db->update( 'Site_Checklists', $updateArray ) ) {\n\n                $this->db->rollback();\n                $success = false;\n                break;\n\n            }\n\n        }\n\n        catch (Exception $e) {\n\n            throw new RestException( 500, $e->getMessage() );\n\n        }\n\n        if( $success ) {\n\n            $this->db->commit();\n\n```\nWhen I submit my $updateArray I receive a 200: Success message back.  However, when I capture the getLastQuery() and run it manually in SQL Workbench, I get the following error: 'Error Code: 1406. Data too long for column 'Newsagency' at row 1.\nI seem to be experiencing this a lot.  Do I have my code incorrect?\n. Just to elaborate further on this: After some testing it seems that this statement works (which is returning all products rather than just one):\n$this->db->join( 'product_categories c', 'p.CategoryId = c.Id', 'LEFT' );\n$this->db->join( 'manufacturers m', 'p.ManufacturerId = m.Id', 'LEFT' );\n$products = $this->db->get( 'products p', null, 'p.*, c.Name AS CategoryName, m.Name AS Manufacturer' );\nTherefore, I'm not sure if the problem stems around the db->getOne() command?. Thanks so much - that worked a treat!. Sorry, it was on my end.\nAdding TRUE to the json_decode command fixed my issue:\n$alertArray = json_decode( $_POST['alertData'], true );\nThis can be  closed.. Sorry for this trigger happy post.....\nIt seemed that I wasn't declaring $quantity in my request, however, still strange that I wasn't receiving an error.\nI guess this can be closed.. ",
    "Jbithell": "+1\n. ",
    "Hoax017": "thanks @ricwein\n. ",
    "burgoyn1": "Thanks. Yes, I know, in the process of upgrading it but in the meantime only works on 5.3\n. ",
    "pedroweb3": "Revising the class code realized that there was nothing wrong with it.\nAssessing my code I saw that the culprit was the .htaccess that was redirecting several times to separate the type of file index.php.\nThe following solution\nRewriteEngine On RewriteCond %{REQUEST_URI} !(\\.css|\\.map|\\.wow|\\.otf|\\.ttf|\\.jpeg|\\.hxd|\\.html|\\.ico|\\.woff|\\.woff2|\\.js|\\.png|\\.jpg|\\.gif|robots\\.txt)$ [NC] RewriteCond %{REQUEST_URI} !/(admin|upload|assets|imagens|css|fonts|ico|include|js)/$ [NC] RewriteCond %{REQUEST_FILENAME} !-f RewriteCond %{REQUEST_FILENAME} !-d RewriteRule ^(.*?)$ index.php [L,QSA]\n. ",
    "slash-zero": "I see there is a pull request that addresses this issue.  When can it be merged in?\nPR: https://github.com/joshcam/PHP-MySQLi-Database-Class/pull/510\n. Subqueries are the devil, if not used properly. \nSeriously though, just use a rawQuery instead. . ",
    "Faraz543": "Can I skip the \"$queryBindParams\" in the code and make that query run without it?\n. ",
    "michael-lynch": "I just updated it and I'm getting the same result. I checked other columns that weren't DECIMAL and it behaved the same way. I can get columns where a column is equal to a string or integer, but not yet NULL. Is this on my end or this inherent to the class? Any suggestions?\n. Yes, that did work!\nSo, what is the difference?\n. Yes, both work for me. Thanks for your help!\n. ",
    "OHCSupport": "I figured out one-to-one:\nX is the name we give to the table1 property that holds the table2 data.\nY is the model name of table2.\nZ is the column in table1 that matches the key in table2.\nThe code goes in the model for table1.\nI still have no clue about one-to-many however.\n. ",
    "omundy": "Update multiple with rawQuery and INSERT ... ON DUPLICATE KEY UPDATE. Here is an example that updates the same column with the same value. I believe you can modify if you need to use different vars in a prepared statement.\n$testArr = [1,2,3,4];\n$q = \"INSERT INTO table (id,col1) VALUES \";\nforeach ($testArr as $row) { \n    if (isset($del)) $q .= \",\"; // add delimiter between values\n    $q .= \"(\". $row .\",0)\"; // prepared query, gives us (1,0),(2,0),(3,0),(4,0)\n    $del = 1;\n}\n$q .= \" ON DUPLICATE KEY UPDATE col1=VALUES(col1);\";\nprint $q;\n$results = $db->rawQuery ($q);. ",
    "vmdude": "Same issue occurs with non-RAW query:\n$db->get(\"vms\", 5, array(\"id\", \"'VM' AS type\", \"CONCAT('showvm.php?vmid=', id) as urlid\", \"name\", \"lastseen\"));\nThis throw the same error:\nNotice:  Undefined offset: 2 in /var/www/admin/MysqliDb.php on line 1844\n. ",
    "satchboy": "Thanks for the comprehensive answer, it was a combination of all 3 :)\nSolution was ::\n1) Switch full database/tables/column names to utf8mb4\n2) Ensure meta charset is served properly\nThese two steps sorted out the \u00a3 sign being stored and retrieved correctly in the database, but then it broke the display of the \u00a3 sign in the html on the page itself.\nThe final bit of the puzzle which you identified :\n3)check the encoding of the .php pages. I use Netbeans, and I couldnt see an encoding option. Opened in Notepad++ and the file was encoded in ANSI. Switched to \"Encode in UTF8 without BOM\" and the \u00a3 sign that 'was' there changed to a black square with \"xA3\" inside it. Deleted that, typed the \u00a3 sign again, saved and uploaded and its perfect.\nMany thanks @ricwein and hope this helps somebody in the future.\n. ",
    "xXXIMMATTHEWXXx": "Pretty sure you can just use the raw query method :D\n. ",
    "Opekunov": "Its test code:\n```\n$key = 'testkey_3';\n$u = 'unique_key';\n$title = 'test';\n$res = $db->rawQuery(\"INSERT INTO items ($u, title)\nSELECT * FROM (SELECT '$key', '$title') AS tmp\nWHERE NOT EXISTS (\n    SELECT $u FROM items WHERE $u = '$key'\n) LIMIT 1;\n\"); \necho 'affected rows: ' . $db->count . ''; \necho 'lastQuery: ' .$db->getLastQuery() .'';\necho \"Result: \"; \nprint_r($res);\n```\nAnd result:\n```\naffected rows: 1\nlastQuery: INSERT INTO items (unique_key, title) SELECT * FROM (SELECT 'testkey_3', 'test') AS tmp WHERE NOT EXISTS ( SELECT unique_key FROM items WHERE unique_key = 'testkey_3' ) LIMIT 1; \nResult: Array ( )\n```\nItems add to database, i see this in phpMyAdmin.\nResult Array is empty, what i'm doing wrong?\n. Yeap, i know about 1 row, but i need get ID (auto_increment) of this added row; \n. Its work, thx!\n. ",
    "killua-eu": "And the problem is that the first line should have been\ndb->where(\"JSON_CONTAINS(tags, ?)\", array('[\"JavaScript\"]'));\n. ",
    "emmgfx": "Check this example in the readme:\n$db->where ('id', 50, \">=\");\n// or $db->where ('id', Array ('>=' => 50));\n$results = $db->get ('users');\n// Gives: SELECT * FROM users WHERE id >= 50;\nMaybe you can try to use something like\n$db->where ('id', 50, \"!=\");\n. ",
    "pinheadmz": "With the same grammar? ie...\n```\n$sq = $db->subQuery(\"e\");\n$sqraw = \"SELECT * from table1\";\n$sq->query($sqraw);\n$db->join($sq, 'e.id=u.id', 'INNER');   \n$result = $db->get('users u', null, array(  'u.id','e.field'));\n```\n. ",
    "Disane87": "If I execute a prepared statement within HeidiSQL it shows me both resultsets. So why should this not be possible, I guess HeidiSQL will get that data in the same way.\n. ",
    "myselfgaurav": "ok thanks bro one more help \ni am trying to make dropdown below is my code seems not working \n$allstate = MysqliDb::getInstance()->rawQuery(\"select * from $tablename $cond\");\n        $dropdownlist=\"<option value=''> --Select-- </option>\";\n        while($row = $allstate->get_result()){\n            $issel =\"\";\n            if($selected==$row[\"$key\"]){ $issel =\"selected\"; }\n            $dropdownlist .= '<option value=\"'.$row[\"$key\"].'\" '.$issel.' >'.$row[\"$val\"].'</option>';\n        }\n        echo $dropdownlist;\n. yea but there is no method to add get so i put this question anyways thanks\n. yeah i was saying about that how can i add some condition here like catid=10\n. thanks a lot\n. nice bro\n. ",
    "Momenoor": "$db->where ('id', 50, \">=\");\n$db->where ('id', 50, \"<\");\nand any condition as you want\n. ",
    "oohrah": "Awesome. It was right in front of me the whole time. I must have read that 100 times Thanks for the speedy response and for jogging my memory\n. ",
    "VeNoMouS": "examples..... UPDATE statement should return the number of affected bars\nFTFY\nUPDATE statement should return the number of updated rows\nalso as the doco states...\n$data = Array (\n    'firstName' => 'Bobby',\n    'lastName' => 'Tables',\n    'editCount' => $db->inc(2),\n    // editCount = editCount + 2;\n    'active' => $db->not()\n    // active = !active;\n);\n$db->where ('id', 1);\nif ($db->update ('users', $data))\n    echo $db->count . ' records were updated';\nelse\n    echo 'update failed: ' . $db->getLastError();\nIt returns bool, and you check count to see affeceted rows.. IMHO that's you being lazy , you wouldn't write a mysql query in the CLI that way, so why do you expect the class to accept your dirty input and clean it for you?\nalso... why not just ...\n$results = $db->where('id', array(1, 5, 27, -1, 'd'), 'IN')->get('users');\nOr in your case...\n$results = $db->where('id', array_values(array(34 => 504, 36 => 501)), 'IN')->get('users');\nNo need for multilines :P \njust my 2 cents.. I'm using it on 7, also its not a library, its a wrapper. Can we see your code for your query.... use rawQuery()? or sub select it..\n\n. @killua-eu use func() as part of your update array?\nSomething like... \n$db->where('c_uid', $uid)->update(\n    't_accounting_received',\n    [\n        'c_data' => $db->func('JSON_SET(c_data, ?, 5)', [$json_payload])\n    ]\n);. Have you tried running it as a transaction and committing after the fact?\nhttps://github.com/ThingEngineer/PHP-MySQLi-Database-Class#transaction-helpers. @xShadowz #448 . return ($stmt->affected_rows > -1); //  affected_rows returns 0 if nothing matched where statement, or required updating, -1 if error\nIt will return 1 if the affected rows is greater than -1 , so non-matching with where would still return 1\nUse  $db->count to check how many were deleted.. ah actually db->count wont work... that change for this logic is from #583 \nHowever, ticket #739 will populate count in delete function.. I dunno... the code logic seems sound..\nIt goes insertMulti -> insert -> _buildInsert which then puts the option into the query\n$this->_query = $operation . \" \" . implode(' ', $this->_queryOptions) . \" INTO \" . self::$prefix . $tableName;\nAnd _queryOptions is populated in the function setQueryOption\nDo you get the same issue if you \n$db->setQueryOption('IGNORE')->insert('table', ['name' =>'recordname', 'date' => '2018-07-05']);. This is due to _buildInsert  calling the function reset which redefines _queryOptions  $this->_queryOptions = array();\nWhat needs to happen, is in multiInsert in the foreach, before the insert function is called, you need to reissue the options..\n```\npublic function insertMulti($tableName, array $multiInsertData, array $dataKeys = null)\n    {\n        // only auto-commit our inserts, if no transaction is currently running\n        $autoCommit = (isset($this->_transaction_in_progress) ? !$this->_transaction_in_progress : true);\n        $ids = array();\n    $options = [\n        '_queryOptions' => $this->_queryOptions,\n        '_nestJoin' => $this->_nestJoin,\n        '_forUpdate' => $this->_forUpdate,\n        '_lockInShareMode' => $this->_lockInShareMode \n    ];\n\n    if($autoCommit) {\n        $this->startTransaction();\n    }\n\n    foreach ($multiInsertData as $insertData) {\n        if($dataKeys !== null) {\n            // apply column-names if given, else assume they're already given in the data\n            $insertData = array_combine($dataKeys, $insertData);\n        }\n\n        foreach ($options as $k => $v) {\n            $this->${k} = $v;\n        }\n\n        $id = $this->insert($tableName, $insertData);\n        if(!$id) {\n            if($autoCommit) {\n                $this->rollback();\n            }\n            return false;\n        }\n        $ids[] = $id;\n    }\n    if($autoCommit) {\n        $this->commit();\n    }\n    return $ids;\n}\n\n``. actually my above wont fully work, as @avbdr has some custom class variables in setQueryOption on certain ifs that arent populated over to_queryOptions`\nif ($option == 'MYSQLI_NESTJOIN') {\n                $this->_nestJoin = true;\n            } elseif ($option == 'FOR UPDATE') {\n                $this->_forUpdate = true;\n            } elseif ($option == 'LOCK IN SHARE MODE') {\n                $this->_lockInShareMode = true;\n            } else {\n                $this->_queryOptions[] = $option;\n            }. @avbdr i've updated my above fix... that should be enough?. @avbdr  I have, refer the above fix :) in my post earlier . Sorry was thinking of http://php.net/manual/en/migration70.incompatible.php\nforeach ($options as $k => $v) {\n    $this->${k} = $v;\n}\nShould be\nforeach ($options as $k => $v) {\n    $this->{$k} = $v;\n}\nI wrote that on the fly without thinking :P my bad. add the following to your options array... \n'loadDataLocal' => true\nOtherwise , you require FILE permissions on that user, and the file to be on the mysql server....\nThe LOCAL keyword affects where the file is expected to be found:\nIf LOCAL is specified, the file is read by the client program on the client host and sent to the server. The file can be given as a full path name to specify its exact location. If given as a relative path name, the name is interpreted relative to the directory in which the client program was started.\nWhen using LOCAL with LOAD DATA, a copy of the file is created in the server's temporary directory. This is not the directory determined by the value of tmpdir or slave_load_tmpdir, but rather the operating system's temporary directory, and is not configurable in the MySQL Server. (Typically the system temporary directory is /tmp on Linux systems and C:\\WINDOWS\\TEMP on Windows.) Lack of sufficient space for the copy in this directory can cause the LOAD DATA LOCAL statement to fail.\nIf LOCAL is not specified, the file must be located on the server host and is read directly by the server. The server uses the following rules to locate the file:\n\n\nIf the file name is an absolute path name, the server uses it as given.\n\n\nIf the file name is a relative path name with one or more leading components, the server searches for the file relative to the server's data directory.\n\n\nIf a file name with no leading components is given, the server looks for the file in the database directory of the default database.\n\n\nIn the non-LOCAL case, these rules mean that a file named as ./myfile.txt is read from the server's data directory, whereas the file named as myfile.txt is read from the database directory of the default database. For example, if db1 is the default database, the following LOAD DATA statement reads the file data.txt from the database directory for db1, even though the statement explicitly loads the file into a table in the db2 database:\n$db = new MysqliDb ($dblogin);\n$db->loadData(\n    'test', \n    'Book1.csv',\n    [\n        'fieldChar' => ';',\n        'lineChar' => '\\r\\n',\n        'linesToIgnore\" => 1,\n        'loadDataLocal' => true\n    ]\n);. What is the error you get? what does $this->db->getLastQuery() show?. @avbdr this might be why...\n```\nBecause local variables are in scope only during stored program execution, references to them \nare not permitted in prepared statements created within a stored program. Prepared \nstatement scope is the current session, not the stored program, so the statement could be \nexecuted after the program ends, at which point the variables would no longer be in scope. \nFor example, SELECT ... INTO local_var cannot be used as a prepared statement. \nThis restriction also applies to stored procedure and function parameters. \nSee Section 13.5.1, \u201cPREPARE Syntax\u201d.\n```\nhttps://dev.mysql.com/doc/refman/5.7/en/stored-program-restrictions.html. Looking at the orderBy function \nif (is_array($customFieldsOrRegExp)) {\n            foreach ($customFieldsOrRegExp as $key => $value) {\n                $customFieldsOrRegExp[$key] = preg_replace(\"/[^-a-z0-9\\.\\(\\),_` ]+/i\", '', $value);\n            }\n            $orderByField = 'FIELD (' . $orderByField . ', \"' . implode('\",\"', $customFieldsOrRegExp) . '\")';\nI would say.. \n$db->orderBy('Language', customFieldsOrRegExp=['ENU','JPN','DAN']);\nWill do it.. ahhh your doing rawSQL... well... write it into your $sql???. https://bugs.mysql.com/bug.php?id=68359\nhttps://stackoverflow.com/questions/32773694/2-prepared-statements-2-stored-procedures-1-mysqli-connection\nthe function _dynamicBindResults would need to be rewritten to fix this on its mysqli fetch() call..\n@avbdr reading that bug ticket, multiple result sets can be returned from a stored proc... might need to adapt your code.. @nemanjamil in the interim you could try the following in between your stored proc calls..\n$db->mysqli()->free_result();\nhowever.. mysqli() can define an array for connections the default is default so i dont know if it will change... just an idea.... @vmarci21 just going to leave this here for you mate :)\nhttps://www.php-fig.org/psr/psr-2/. god damn your code is nasty..\n$db->where(\n     'category',\n     $wherecatina[0]\n)->where(\n     'category', \n     [$wherecatin], \n     'IN'\n)->getValue('torrents', 'count(*)');\n$db->where(\n    'category', \n    $wherecatina[0]\n)->where(\n    'category', \n    [$wherecatin], \n    'IN'\n)->get(\n    'torrents', \n     [\n          $lim_in,\n          $lim_out\n     ],\n     [\n         'torrents.id',\n         'torrents.times_completed',\n         'torrents.owner'\n     ]\n);\nProblem is.. you can't as $db as a pointer to the object and after each query, specific variables get reset... also the variable \"_where\" is a protected member, so you can't access it outside of the class as its not public.\nYou could clone the db object with http://php.net/manual/en/language.oop5.cloning.php after just doing...\n$db->where('category', $wherecatina[0])->where('category', [$wherecatin], 'IN');\nHow ever I would NOT recommend it.. Tried something like.... \n$db->where(\n    'LogIn', \n    [\n        $db->now('-2M'),\n        $db->now()\n    ],\n    'BETWEEN'\n);. @huseyinaslim this is a bug with PHP mysqli not this PHP class.. As a workaround, cast the json as char.\n. If your going to raise a bug report with PHP i suggest you link https://bugs.php.net/bug.php?id=70384. Looks to me from commit history it was fixed 15 days ago .... ah your using the 2.1 branch... not master...  move to 2.9.... (master). ",
    "vikas5914": "i don't want id to be autoincrement . . i am sorry .. its working .. it was my fault . . ",
    "aaveidt": "@avbdr i know this way, but i have to create a foreach and create new single object based on data, add it to an new array of object like this:\n$locationGet = Location::get();\nforeach ($locationGet as $city)\n$cites[] = new Location($city->id, $city->name);\nAnyway to get directly the list of Location after the Location query ?. @avbdr get() return array of object but didn't map the data to the objects.\nIf i want to access to every single object, i have to do like this: $locations{0}->data['id']\ninstead of $locations{0}->id. @avbdr $data['id'] ~> is an array , $data->id is an object.\ngetOne() maps a single record (from db) to the object (location).\nSo the location object has all the properties like id, name. Can be access via location->id , location->name\nBut get() returns an array of data, not a list/array of location objects, this is why i'm asking for mapping.\nYes, i can query all the record i need and map every single record by myself, so what's the purpose of this class dbObject? It is useless.. If you designed this class for data mapping, so it will be useful if it can help to map db record to the objects. If your purpose is using array: so it wasted learning OOP.\nYes: get() return an array of objects but not the data it needed, while we have to access to $locations{0}->data['id'] to access to the id field of one record\nIts inconsistent because by using getOne() i can access to the id by $location->id\nDo you get me now?. Oh, well. You saved my life -.-. class Message extends dbObject\n{\n  static function deleteMessage($p_id)\n    {\n    self::byId($p_id)->delete();\n    MessageContent::byId($p_id)->delete();  \n    }\n}\nMessage::deleteMessage($p_id);. @avbdr Any comment here? I have to work around by creating new object or using where and getOne() to get the object.. @ricwein I pretty sure that requested id is exist in db. I've read the code, and it comes from static property. And the error is ( ! ) Fatal error: Using $this when not in object context in points to line 303 - the $this keyword can't be use because i'm requesting from static method?\nIt works if i create new instance of the object like this:\n$msg = new self;\n$msg->byId($p_id)->delete();\n. @avbdr __callStatic has never been called because byId exists in the dbObject.\n In my code, Message extends dbObject so it can access to the protected method:byId().\nI think it will work perfectly if you change line 302 from \nprotected function byId ($id, $fields = null) { \nto \nprivate function byId ($id, $fields = null) {\nNow it will call __callStatic first.\n. I've checked on your tests, and it's a mess.\nDB files in dataimport doesn't match with model, path, everything ...\nI've tested on my project and it works. I didn't change much, you can see in the code.. Then how do i know it passes?\nI've done all two files, mysqliDbTests.php return the list of queries. dbObjectTests.php return this line:\nMultisave problem {\"customerId\":2,\"userId\":{\"login\":\"testuser\",\"firstName\":\"john\",\"lastName\":\"Doe Jr\",\"createdAt\":\"2016-12-20 18:44:55\",\"id\":false},\"productName\":\"product6\",\"id\":6}\nSame result with master and mine. All done Memory usage: 973424 with mysqliDbTests.php\nAnd you should check your master, because dbObjectTests.php returns the result above. . ",
    "marcosfreitas": "I solved the problem using utf8_decode, a PHP's functions to fix these special characters into A\u00e7ail\u00e2ndia term that has been searched. This has the problem and hasn't a project issue, I guess.. ",
    "marcalle": "Would not work with MariaDB using a timestamp value for the database. I had to change it to DATETIME format.. ",
    "MazettePatacaisse": "It's working\nthank's for your help! . Hi , yeah i'am interesting too!  It will be usefull! Thank's.. ",
    "ddv88": "Duplicate https://github.com/joshcam/PHP-MySQLi-Database-Class/issues/571. $db = new \\stdClass?. So what the problem? \n. ?? Result transformation. ```\nnamespace App;\nuse \\mysqli,\n    \\mysqli_stmt,\n    \\Exception;\n```\nIt's not an issue. You should post questions like this on stackoverflow, for example.. ",
    "abhishekpunj": "i find my soltion. i think that is the way for calling. :)\n$res= $db->rawQuery(\"call registeration_form (?,?,?,?,?,?,?,?,?,?,?,?,@sta,@msg)\", array($adminid,$pass,$mobileno,$contactname,$email,$raddress,$rcity, $rstate, $cname,$pin,$pan,$ip));\n        $select=$db->rawQuery(\"select @sta,@msg\");\n        print_r ($select);. we modified this library now we can change mysqli to pdo just change on connection name.. ",
    "c0degeekPL": "Uhm, it is possible, because I am using it in admin dashboard where I am displaying many data from DB.. ",
    "he426100": "Why not provide a method, you can pass the array parameters as a query condition, I think so you can avoid the above problem. \n    class cls_mysql {\n        ...\n        function __construct($dbhost, $dbuser, $dbpw, $dbname = '', $charset = 'gbk', $pconnect = 0, $quiet = 0) {\n                $this->cls_mysql($dbhost, $dbuser, $dbpw, $dbname, $charset, $pconnect, $quiet);\n        }\n        ...\n        function connect($dbhost, $dbuser, $dbpw, $dbname = '', $charset = 'utf8', $pconnect = 0, $quiet = 0) {\n            if ($pconnect) {\n                $this->link_id = new mysqli('p:' . $dbhost, $dbuser, $dbpw);\n                if ($this->link_id->connect_error) {\n                    if (!$quiet) {\n                        $this->ErrorMsg(\"Can't pConnect MySQL Server($dbhost)!\");\n                    }\n                    return false;\n                }\n            } else {\n                $this->link_id = new mysqli($dbhost, $dbuser, $dbpw);\n            if ($this->link_id->connect_error) {\n                if (!$quiet) {\n                    $this->ErrorMsg(\"Can't Connect MySQL Server($dbhost)!\");\n                }\n\n                return false;\n            }\n        }\n    }\n}\n\n$db = new cls_mysql();. I already have a mysql connection class, I want MysqliDb to coexist with him\u3002\n\nFor historical reasons, I can not replace the mysql connection in the old code.     $where = array();\n    if ($filter ['to_user_id'] > 0) {\n        $where['up.to_user_id'] = $filter['to_user_id'];\n    }\n    if ($filter ['payment']) {\n        $where['up.payment'] = $filter['payment'];\n    }\n    if ($filter ['is_paid'] != - 1) {\n        $where['up.is_paid'] = $filter['is_paid'];\n    }\n    if ($filter ['keywords']) {\n        $where['receive.user_name'] = array('LIKE' => \"'%\" . mysql_like_quote ( $filter ['keywords'] ) . \"%'\");\n    }\n    if ($filter ['user_name']) {\n        $where['pay.user_name'] = array('LIKE' => \"'%\" . mysql_like_quote ( $filter ['user_name'] ) . \"%'\");\n    }\n    if (! empty ( $filter ['start_date'] ) && ! empty ( $filter ['end_date'] )) {\n        $where['up.paid_time'] = array('>=' => $filter ['start_date']);\n        $where['up.paid_time'] = array('<' => $filter ['end_date']);\n    }\n    $dbi->join('users pay', 'up.user_id = pay.user_id', 'LEFT');\n    $dbi->join('users receive', 'up.user_id = receive.user_id', 'LEFT');\n    foreach ($where as $key => $value) {\n        $dbi->where($key, $value);\n    }\n    $counter = $dbi->copy();\n    $filter ['record_count'] = $counter->getValue('user_pay up', 'COUNT()');\n    $dbi->pageLimit = $filter ['page_size'];\n    $list = $dbi->orderBy($filter ['sort_by'], $filter ['sort_order'])->paginate('user_pay up', $filter ['page'], 'up., pay.user_name user_name_pay, pay.true_name true_name_pay, receive.user_name user_name_receive, receive.true_name true_name_receive');\nWhen i use the copy method is MysqliDb wrong, because this sentence: $ copy -> _ mysqli = null;. ",
    "Skazzino": "@avbdr Done, check it out! :). ",
    "cord": "thanks for checking: in context of a store system warnings for failed connections (invalid credentials) where shown before the exception was triggered. Probably this is depending on the error reporting settings in the store system.. Actually I do not understand why the errors from new mysqli() where shown but they did and the changes fixed that issue ..?. ",
    "SuperMariosYoshi": "I want to know is there a way to map this same object with this class ?. ",
    "alexcoroza": "I really need an answer to this because using joins returns a flat result, and overwrites fields if the fieldname is the same on the the joined table. So its better to group all fields of a joined table in one array. I wonder how to do it using this awesome library. . ",
    "douglasg14b": "@avbdr TIL there is a union function, that's pretty handy.\nEdit: Nvm, can't seem to find it. ",
    "31337Ghost": "+1. ",
    "duhow": "Related to #665 , get the SQL query string instead of running it.. Careful with this, because the rawQuery does not use table prefixes. Fixing and doing PR.. Done at https://github.com/joshcam/PHP-MySQLi-Database-Class/pull/670 . Made a PR: https://github.com/joshcam/PHP-MySQLi-Database-Class/pull/669 .. Made a PR: https://github.com/joshcam/PHP-MySQLi-Database-Class/pull/669. insertMulti calls multiple times insert, and thus leads to reset, losing the setQueryOption or onDuplicate options.. Pending \ud83e\udd14. Done.. Your code currently outputs:\n\n\"SELECT  id FROM event WHERE  date BETWEEN 'NULL' AND 'NULL' \n\nIn order to make it work, you have to query using $subQ, not $this->db, otherwise it runs at the general query.\n```php\n$subQ = $this->db->subQuery();\n$subQ->where(\"date\", array($date1, $date2), \"BETWEEN\");\n$subQ->get(\"event\", null, \"id\");\n$data = array(\"var\" => 1);\n$this->db->where(\"id_event\", $subQ, \"IN\");\n$this->db->update(\"report\", $data);\n// \"UPDATE report SET var = '1' WHERE  id_event IN (  (SELECT  id FROM event WHERE  date BETWEEN 'NULL' AND 'NULL' )  )\n```\n. #665 #442 #454 #223. https://github.com/ThingEngineer/PHP-MySQLi-Database-Class/blob/43459aeaee2b98ef651da78f8a03ce22c23ebbeb/MysqliDb.php#L388-L391\nCurrently prefix is ignored when creating a new connection. Also can't be added directly to addConnection, as there isn't any prefix field on the mysqli class, so it might crash.\nhttps://github.com/ThingEngineer/PHP-MySQLi-Database-Class/blob/43459aeaee2b98ef651da78f8a03ce22c23ebbeb/MysqliDb.php#L305\nEditing both that function and the connect one to save the prefix field, skip it at the moment of creating the Mysql instance, and finally set the prefix might work.. That looks like Oracle. This project is meant for MySQL.\nOtherwise, you can create a raw query.. ",
    "Tux-box1": "Any possibility to get this supported?. ",
    "PHPonFire": "Thanks @avbdr and @ricwein \nyou both the champs :+1: . @ricwein Yes cron are on a continuous loop. But resetting the connection might not go ahead of connection limit set to 250. At the moment it goes beyond 1000+ and mysql crashes. So resting will help, even if it is a persisting job?\nIncreasing limit is not an option it may go beyond that too, if connections are persistent. So I think only option is to close an active connection after its done and reconnect for another query... @avbdr and in this you are using which of the following method? $db = null; or $db->mysqli()->close();. @avbdr Thanks again for your help. Have a good day.. ",
    "TheYakuza": "There's no notice about this function?? bc the only way now is using rawquery. Yes, I'm using it on \nbash\n$ php -v\nPHP 7.0.18 (cli) (built: Apr 11 2017 13:16:02) ( NTS )\nCopyright (c) 1997-2017 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2017 Zend Technologies\n$. ",
    "masterkamlesh": "thanks siberfx\n$param = array('id','asc',0,10)\nhow do i write \"select someting from data order by ? ? limit ?,?\" , $param\nits not taking both ? at a time like ? ?. // initilize all variable\n    $param = $params = $columns = $totalRecords  = $data = $posts = $response  =  array();\n$i=1;\n$params = $_REQUEST;\n\n//define index of column\n$columns = array( \n    0 => 'id', \n    1 => 'name',\n    2 => 'mobile',\n    3 => 'email',\n    4 => 'status'\n);\n\n$where = $sqlTot = $sqlRec = \"\";\n\n$where = $sqlTot = $sqlRec = \"\";\n// check search value exist\nif( !empty($params['search']['value']) ) {   \n    $where .= \" WHERE l.name like ? or l.mobile like ? or l.email like ?\";\n}\n\n// getting total number records without any search\n$sql = \"SELECT l.id,l.name,mobile,email,lr.role as role,l.active  FROM login as l inner join login_roles as lr on lr.id=l.role\";\n//echo $sql;\n$sqlTot .= $sql;\n$sqlRec .= $sql;\n//concatenate search sql if value exist\nif(isset($where) && $where != '') {\n\n    $sqlTot .= $where;\n    $sqlRec .= $where;\n    $searchVar = '%'. $params['search']['value'].'%';\n    array_push($param,$searchVar);\n    array_push($param,$searchVar);\n    array_push($param,$searchVar);\n\n}\n\n\n$sqlRec .=  \" ORDER BY ? ASC LIMIT ?,? \";\n  array_push($param,$columns[$params['order'][0]['column']]);\n  array_push($param,$params['start']);\n  array_push($param,$params['length']);\n\n//  $queryTot = mysqli_query($conn, $sqlTot) or die(\"database error:\". mysqli_error($conn));\n        $db->rawQuery($sqlTot,$param);\n//      echo \"Last executed query was \". $db->getLastQuery();\n//print_r($param);\n    $totalRecords = $db->count;\n    $users = $db->rawQuery($sqlRec,$param);\n echo \"Last executed query was \". $db->getLastQuery();\n//print_r($param);\n    //iterate on results row and create new index array of data\n    $i= $params['start']+1;\n    foreach($users as $user)\n    {\n        $posts = array(\"sno\" => $i, \"id\" => $user['id'],\"name\" => $user['name'],\"mobile\" => $user['mobile'],\"email\" => $user['email'],\"role\" => $user['role'],\"active\" => $user['active']=='1'?'active':'inactive');\n        $data[] = $posts;\n        $i++;\n    }\n    /while( $row = mysqli_fetch_assoc($queryRecords) ) {\n        $posts = array(\"sno\" => $i, \"id\" => $row['id'],\"name\" => $row['name'],\"mobile\" => $row['mobile'],\"email\" => $row['email'],\"role\" => $row['role'],\"active\" => $row['active']=='1'?'active':'inactive');\n        $data[] = $posts;\n        $i++;\n    }   /\n$json_data = array(\n        \"draw\"            => intval( $params['draw'] ),   \n        \"recordsTotal\"    => intval( $totalRecords ),  \n        \"recordsFiltered\" => intval($totalRecords),\n        \"data\"            => $data   // total data array\n\n        );\n\necho json_encode($json_data);  // send data as json format\n\nlast executed query\nSELECT l.id,l.name,mobile,email,lr.role as role,l.active  FROM login as l inner join login_roles as lr on lr.id=l.role WHERE l.name like '%a%' or l.mobile like '%a%' or l.email like '%a%' ORDER BY 'id' ASC LIMIT '0','10' \nwhy  'id' ASC LIMIT '0','10'   are showing in single quotes. ??\n. ",
    "manhag": "it must be option\nand logical not be cleared \ni will update  depends on selection query if exisits. ",
    "flaviolaino": "Just add where condition in update command:\nif ($db->totalCount > 0){           \n    $db->where('id', $id)->update ('BOT_Sessions', $data);\n}else{\n        $db->insert ('BOT_Sessions', $data);\n}. ",
    "temamagic": "@avbdr Perhaps I read the old information about it. Thx u !. @siberfx thats all code. I trying to update row where chat_id == -232509812 and set chat_id to new value. @ricwein Thank you so much!\nI did not notice this comma, and I thought everything was fine.\nThanks again!. ",
    "gsi-delmo": "Thanks to all. ",
    "iahnn": "I wanted to do query like this\n$query = \"CREATE TABLE IF NOT EXISTS \" . TABLE_PREFIX . \"settings (\n        ID bigint(20) NOT NULL AUTO_INCREMENT,\n        meta_key varchar(255) COLLATE utf8_unicode_ci NOT NULL,\n        meta_value varchar(255) COLLATE utf8_unicode_ci NULL,\n        PRIMARY KEY (ID)\n    ) ENGINE=MyISAM  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;\";\n    $db->rawQuery($query);\nI wonder if that's possible? Thanks.. ",
    "maan81": "Could I have an example, such as for https://stackoverflow.com/questions/9378613/how-to-define-a-custom-order-by-order-in-mysql#answer-9378709 ?. Could I have a way to handle the ORDER BY FIELD(Language,'ENU','JPN','DAN') in raw sql ?. ",
    "huseyinaslim": "@avbdr Yes, I using this version 2.7. Thanks for reply. I will update to 2.8.\nGood day.. @avbdr \nI have a table view as;\nselect p.id AS id,p.price AS price,p.coid AS coid,p.cid AS cid,(select co.name from project_db.country co where (co.id = p.coid)) AS coname,(select ci.name AS ciname from project_db.city ci where (ci.id = p.cid)) AS ciname,(select tr.name from project_db.transactions tr where (tr.id = p.tid)) AS tid,p.deleted_at AS deleted_at from project_db.prices p\nI execute query  on mysql with phpmyadmin;\nSELECT * FROM prices_view WHERE coid = '3'  AND cid = '1'\nreturn results as;\nid  price   coid    cid coname  ciname  tid deleted_at  \n1   370.00  3   1   Almanya Adana   Konsolosluk + Arac\u0131 Kurum \u00dccreti        \n2   15.00   3   1   Almanya Adana   Kargo \u00dccreti        \n3   140.00  3   1   Almanya Adana   Servis \u00dccreti\nBut execute some query with joshcam/MySQLi and trace;\n```\nArray\n(\n    [0] => Array\n        (\n            [0] => SELECT  * FROM prices_view WHERE  coid = '3'  AND cid = '1' \n            [1] => 0.0010271072387695\n            [2] => MysqliDb->get() >>  file \"x.php\" line #69 \n        )\n)\n```\nI get empty result. \n. @avbdr PHP 7.1 - MySQL 5.6.36 The problem continues.. ",
    "GovetaXV": "Thanks Alot!!. ",
    "Mrbrand": "I have the same problem. I get nothing from my view-table. . print_r (get(\"myview\")) returns:\n\narray(). php v5.3. \n",
    "phprad": "Am totally in support of this.. ",
    "mshs013": "@jeffstagedoor It works when I updated replacePlaceHolders function by bellow\n`\nprotected function replacePlaceHolders($str, $vals)\n    {\n        $i = 1;\n        $newStr = \"\";\n    if (empty($vals)) {\n        return $str;\n    }\n\n    while ($pos = strpos($str, \"?\")) {\n        $val = $vals[$i++];\n        if (is_object($val)) {\n            $val = '[object]';\n        }\n\n        if($val === null) {\n            $newStr .= substr($str, 0, $pos) . 'NULL';\n        } else {\n            $newStr .= substr($str, 0, $pos) . \"'\" . $val . \"'\";\n        }\n\n        $str = substr($str, $pos + 1);\n    }\n    $newStr .= $str;\n    return $newStr;\n}\n\n`. I've created bellow function for bulk data update. Please check and let me know about this function. Function example is:\n```\n$tableName = 'users';\n$multiUpdateData = [\n     [\n         'id' => 1,\n         'name' => 'Sazzad',\n         'updatedAt' => $db->now()\n     ] ,\n     [\n         'id' => 5,\n         'name' => 'Kanon',\n         'updatedAt' => $db->now()\n     ] ,\n];\n$index = 'id';\n$db->updateBatch($tableName, $multiUpdateData, $index);\n```\n/**\n * Update Multi fields.\n *\n * @param string $tableName The name of the database table to work with.\n * @param array $multiUpdateData Two-dimensinal Data-array containing information for updating data into the DB.\n * @param string $index The index column the database table.\n *\n * @return bool\n */\npublic function updateBatch($tableName, $multiUpdateData, $index = 'id')\n{\n    $final  = array();\n    $ids    = array();\n    if(!count($multiUpdateData))\n        return false;\n    foreach ($multiUpdateData as $k => $val)\n    {\n        $ids[] = $val[$index];\n        foreach (array_keys($val) as $field)\n        {\n            if ($field !== $index)\n            {\n                $value = $val[$field];\n                // Function value\n                if (is_array($value)) {\n                    $key = key($value);\n                    $v = $value[$key];\n                    switch ($key) {\n                        case '[I]':\n                            $value = $field . $v . \" \";\n                            break;\n                        case '[F]':\n                            $value = $v[0] . \" \";\n                            break;\n                        case '[N]':\n                            if ($v == null) {\n                            $value = \"!\" . $field . \" \";\n                            } else {\n                            $value = \"!\" . $v . \" \";\n                            }\n                            break;\n                        default:\n                            throw new Exception(\"Wrong operation\");\n                    }\n                } else {\n                    $value = '\"' . $value . '\" ';\n                }\n                $final[$field][] = 'WHEN `' . $index . '` = \"' . $val[$index] . '\" THEN ' . $value;\n            }\n        }\n    }\n\n    $cases = '';\n    foreach ($final as $k => $v)\n    {\n        $cases .= $k.' = (CASE '. implode(\"\\n\", $v) . \"\\n\"\n        . 'ELSE '.$k.' END), ';\n    }\n    $query = 'UPDATE ' . $tableName . ' SET '. substr($cases, 0, -2) . ' WHERE ' . $index . ' IN('.implode(',', $ids).')';\n\n    $this->_query = $query;\n    $stmt = $this->_prepareQuery();\n\n    $status = $stmt->execute();\n    $this->reset();\n    $this->_stmtError = $stmt->error;\n    $this->_stmtErrno = $stmt->errno;\n    $this->count = $stmt->affected_rows;\n\n    return $status;\n}   .\n",
    "tonny-sofijan": "I see. OK, noted. I'll use str_pad. Thanks for the info!. how to create a pull request? The button is not clickable (disabled)\nEDIT: OK, I've created the pull request.. OK. Didn't know there's getValue function.. I've been copy-paste from MysqliDb.php master, add my code, forking, upload to my fork code, and request pull. If there's still difference with the master, I give up.. @avbdr thanks.. ",
    "lifewcody": "Create a pull request please :). ",
    "Oxicode": "Que la versi\u00f3n m\u00ednima de uso sea PHP 5.5. Por ejemplo usamos array cortos [], mejoras en performance, entre muchas otras cosas.. El problema radica que si sigues dando soporte a versiones viejas de PHP, nunca se impulsar\u00e1 las nuevas.. ",
    "DragonflyNet67": "I have a table called languages where all languages are stored by their 2-Letter ISO Code in one column, the language code for which I want to get the language name (i.e. \nfr - fr - Fran\u00e7ais\nfr - de - Franz\u00f6sisch\nfr - en - French\nWithout the modification I get for the record fr - de the language name Franz\\u00f6sisch instead of Franz\u00f6sisch (only for the JSON Object - not in the array or object).\n\n\n. I don't think so. The Problem is, that LOAD DATA needs FILE permission for the DB User. And that's the main problem. On shared hosters FILE Permission is a global setting for all clients (as they told me on the phone) and they do not give the possibility for FILE Permission to none of the DB-Users (for every client). The wrapper itself does not more than a standart LOAD DATA Command. Which works fine on my local machine, but not for my website residing on a shared hoster. I added another routine to the wrapper where the CSV-Files are splitted and uses INSERT Commands for each line. This way I do not need the FILE Permission for LOAD DATA, since they would not give it to any client on their shared host.\nThank you. ",
    "TheRealZabih": "Thanks. Can u explain with example ? . ",
    "torunar": "676. Shouldn't it be $error, $query and $errno?.",
    "BjarneRest": "I removed composer.lock and cleared composers cache.\nAfter reinstalling, I get this state of master d87decd63f8695ff07c7843766a4690fd692f0d1\nThe error still exists. Ok, when do you think composer will fetch the next commit? Does composer directly fetch from master branch or is there another composer branch?\nEDIT: No, Packagist is just behind Git. Composer dev-master still is on d87decd63f8695ff07c7843766a4690fd692f0d1\nSee Packagist. ",
    "hoangnamitc": "Thanks @avbdr ! :)\nMy problem has been resolved with copy() method !. I know, but for some reason I want id to be the varchar type and I want to get that id when inserting  :(\nIf id is int type then it works fine !. ",
    "DanialOlsen": "I got things mixed up here. I'm using perl DBI for this.\nSorry...closing.. ",
    "michabbb": "@avbdr okay, thanks for the quick feedback ;). @avbdr i was going to build a new mysqli wrapper for mysqlf, but your project is nearly perfect i guess, the only thing that blocks me, is the missing feature of named-paramters. i used a super old class MDB2 which emulates the named paramters perfectly. the code is super old, but i guess the part of parsing the query, still works perfect. if i would provide a pull request in the future, are you open for that ? \ud83d\ude0f . @avbdr turned out, names placeholders are not that difficult as expected. PEAR::MDB2 did a great job, that\u00b4s where i got the code from, feel free to use it. because this framework here is way too heavy for me, i decided to start my own \ud83d\ude0f . because this looks like a regular mysql error, i would suggest, you show us your $array_of_arrays \ud83d\ude0f . maybe a trace shows more infos what\u00b4s going on here \ud83e\udd14 . @LunarDevelopment i am new to this project, so sorry if i can\u00b4t offer much help. i study some issues here to evaluate if this class works for me. after seeing your case i got interested in this so i ask myself, what would i do ? \ud83d\ude0f \ni saw this class offers a trace, which seems to be nice feature.\nso the IGNORE is only used in the first statment , do i see this correctly ?. okay, great, didn\u00b4t see that. thanks !. pardon, with bugs i mean:\n\nwrong return types\nwrong phpdoc\ncode that never gets called because there is a return or throw before\nfunction params that are only used as array but never defined as array\nand so on.. the list is very long\n\nplease understand this would take me hours to make PR for each of these issues.\nmaybe it\u00b4s an good idea if you take a look with PHP EA for yourself. you might get a shock\nwhat\u00b4s going on in the code \ud83d\ude0f please, don\u00b4t take this personally. i only want to help and you\ndid a great job writing this class! \ud83d\ude0e . to give you an overview:\nfor dbObject.php\n\nfor MysqliDb.php\n\n. @avbdr so are you receptive to this ? \ud83d\ude0f \n(i guess there\u00b4s a reason why there are so many forks of this project). i close this. this class is way to heavy for my needs, so i won\u00b4t invest time here, sorry. but you did a great job !. @ricwein thanks a lot !!!! \ud83d\udc4d . ",
    "abdulmanan7": "i searched the readme but not found any like statement . i was searching \"like\" LOL thanks dude for your quick support.\ni would suggest to implement it like $Db->like()\nit would be more readable .. ",
    "ejcms": "If the input information is wrong when connect to mysqli, is it OK to add a return error message?. alright, thank you very much!\nThere is aa query, the query field to give the value of 0, the query will not show the field.\nSuch as: $db->where(\"testii\", 0)->get(\"table\");\nPrint: SELECT  * FROM table\nCan this query: SELECT  * FROM table WHERE testii = '0'. ",
    "Ajtak": "Not working. I made a simple fix on line 1969:\n$query = substr($str, 0, $pos) . \"'\" . $val . \"'\";\n$newStr .= str_replace(\"'NULL'\", \"NULL\", $query) ;\nApostrophes are added on row 1969.\n. Yes , Im testing insert, but was error for duplicates key sn (it's NULL string)\n\n. ",
    "dungla2011": "thank you much!\nIt is also ok with insert !. oh, I found solution quickly after asking:\nSELECT * FROM abc WHERE id= 1 AND (field1 = 0 OR field2 = 0)\n<=> \n$db->where(\"id\", \"1\");\n$db->where(\"field1 = 0 OR field2 = 0\");\n$db->get(\"abc\");\nIt's simple, in document :)\nThank the author !\n. ",
    "erorre": "I can not get a affected row after delete.\n$db->delete returns \"bool(true)\". $db->count returns always \"int(1)\".\nPlease help to find the solution.. ",
    "im050": "use \"$db->count\" to get affected rows. ",
    "getchu": "file\uff1a MysqliDb.php\nmethod\uff1a _prepareQuery \n$stmt = $this->mysqli()->prepare($this->_query); //BUG\uff1atrigger ERROR here and print buffer\nif ($stmt !== false) {\n     if ($this->traceEnabled)\n           $this->traceStartQ = microtime(true);\n     return $stmt;\n}\nif ($this->mysqli()->errno === 2006 && $this->autoReconnect === true && $this->autoReconnectCount === 0) {\n//BUG: where is \"autoReconnectCount =0\" \uff0cso it will connect one time, and never reconnect again!\n\n  $this->connect($this->defConnectionName);\n  $this->autoReconnectCount++;\n  return $this->_prepareQuery();\n\n}\n$error = $this->mysqli()->error;\n$query = $this->_query;\n$errno = $this->mysqli()->errno;. just do it your self . Medoo project support bit column. \u4f7f\u7528 try catch \u6355\u83b7\u5f02\u5e38\nhttp://www.php.net/manual/en/class.mysqli-sql-exception.php\nmysqli_report(MYSQLI_REPORT_STRICT);\n$driver = new mysqli_driver();\n$driver->report_mode = MYSQLI_REPORT_ALL;\n$driver->report_mode = MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT;\nhttp://php.net/manual/en/mysqli-driver.report-mode.php\n. edit your mysql config file\nmy.cnf \nconnect_timeout=31536000\nwait_timeout=31536000\ninteractive_timeout=31536000. $this->db->addConnection( ?? )\n$this->db->connect('one');\n$this->db->connection('one')->where('id',$id)->update('table', $arr). ",
    "canarslan12": "you can't join tables from different databases with only SQL. You have to implement it in PHP and it won't be efficient as SQL.. you can use like these, for now but @ThingEngineer or any other contributer might implement it in proper way\n$db->orderBy(\"parentId\")->join(\"MyTable p\", \"m.catid = p.id\", \"LEFT\")->get(\"MyTable m\", null ,\"m.id,\nm.name,\nm.catid,\nm.ordering,\np.ordering,\ncase\nWHEN p.ordering IS NULL THEN m.ordering * 10\nELSE m.ordering + p.ordering * 10\nEND AS parentId\");. It might break older applications in same cases. But returning affected rows when deleting will be better imo. . what do you mean by changing code?\nboth unused ones and tab changes or just one of them?. ",
    "thiagoedson": "ok. ",
    "mg4z": "Problem is not the code, I think problem is mysqli but our server cannot help me to fix it.\nhttp://harajchi.com/webservice/code.php?do=client&client_id=1505 http://harajchi.com/webservice/code.php?do=client&client_id=1505\nif ($_REQUEST['do'] == 'client'):\n    foreach (array_keys($_REQUEST) as $key)\n        $val[$key] = $db->escape($_REQUEST[$key]);\n$db->where(\" client_id = \" . $val['client_id']);\n$db->orderBy(\"create_date\", \"desc\");\n$db->orderBy(\"status\", 'desc');\n$json['list'] = $db->get('codekey_list_user_info'); //contains an Array of all users\necho json_encode($json);\n\nendif;\n\nOn 1 Feb 2018, at 20:52, Martin Selim Videl notifications@github.com wrote:\ncan you try to share the query code which you think is not working?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub, or mute the thread.\n\n\n. ",
    "rugiguru": "thank you\nOn 12-Feb-2018 4:53 PM, \"Martin Selim Videl\" notifications@github.com\nwrote:\n\nin 7.2 also works\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/ThingEngineer/PHP-MySQLi-Database-Class/issues/720#issuecomment-364895176,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AecTwwaehMkmMZuK8uTp-Yz7shCys21dks5tUB8xgaJpZM4SBrrS\n.\n. \n",
    "jibranb": "@ThingEngineer Hi Josh, sorry to bug you on this, but any thoughts on this? Thx.. Roger that. Yes, I get good data if I swap them. Only the first select's data comes back.. Here are my findings:\nI created a new sproc for this test, setting your IN param to the OUT param. Additionally, I selected a user record so that there are two recordsets being returned.\n``\nDELIMITER  $$\nDROP PROCEDURE IF EXISTS db_name.myproc$$\nCREATE DEFINER=CURRENT_USER PROCEDURE db_name.myproc`(\n  IN ivalue INT(11),\n  OUT x INT\n)\nBEGIN\nSELECT ivalue INTO x;\nselect * from user where id = 100;\n\nEND $$\nDELIMITER  ;\n```\nResults:\nI added a var_dump($row); in the inner while loop. Both results are coming back, however, column names are not in the case of the user data.\nResult #1:\narray(31) { [0]=> string(3) \"100\" [1]=> string(2) \"24\" [2]=> string(6) \"Tom\" [3]=> string(0) \"\"... }\nResult #2:\narray(1) { [0]=> string(1) \"1\" } \nStrict Standards: mysqli::next_result(): There is no next result set. Please, call mysqli_more_results()/mysqli::more_results() to check whether to call this function/method in ...user.php on line 35\n. ",
    "vermeerpaul": "Having the same problem as Jibran. The MySQL or PHP test code works when called using the do while loop as per the sample. Not sure how to call it using your class though. I cannot see where the loop is implemented either? Is this an oversight or a missing feature?. ",
    "nilsgraustins": "I got the same errror calling Joomla project via php execution method. (safe from hacking Joomla) and got the same error. Seems, it is not related to this project/class. I mean, this is a php level error .. ",
    "m4xw": "You should post your Schema File. Sry for the late answer.\nYou don't define a table, nor a primary key, it won't work like that (unless you define everything to the dbobject docs, which tbh lacks this topic)\nYou should at least add\nprotected $dbTable    = \"table name\";\nprotected $primaryKey = \"primary key\";`\nYou might need to add $dbFields too, depending on what u need/want to do (it will only save fields defined in them, unless u change the source).\n. ",
    "momoelz": "Sorry for my Noobness, I dont know what you mean by Schema File, do you mean the dbObject file i created? \nclass account_verification extends dbObject {\n}\nor do you want to see the mysql structure?\naccount_verification_structure.pdf\n. thanks that worked out :). thx the working querry is\n->where ('receiver', array($receiver, $sender), 'IN')\n->Where('sender', array($receiver, $sender, 'IN'). ",
    "usafkirkland": "in short:\n$db->where('active', 1);\n$db->having('category_id', 3);\n$db->orderBy(\"name\",\"asc\");\n$db->pageLimit = 6;\n$db->arraybuilder()->paginate(\"tec_products\",1);. I just did to see if it would adjust.  Everything fires correctly, except for the orderBy part.  . I had an issue with my function passing a variable.  There is nothing wrong with the classes pagination function.  Thank you for the quick response! . ",
    "hemaantjd": "change id type to int and make it primary + auto increamented . ",
    "user745": "MySQL doesn\u2019t support auto-incrementation of types other than int (understandably) so it won\u2019t be generating an automatic id for that. If you must have a varchar id you\u2019ll have to generate one yourself (randomly?), then check to make sure it doesn\u2019t already exist in your table, and then insert it as a regular data column. ",
    "F-V": "Just picking up on this topic. In some cases one would have a non generated (AI) primary key e.g. when using UID's as ID. As stated before, that would give a 1 as returned int.\nIn said case you world override the return value with the id you used to generate the record.\n$db = MysqliDb::getInstance();\n$account['ID']=\"someGUID\";\n$account['Email']=\"test@example.com\";\n$result = $db->insert(\"table\",$account);\n//if the result is 1, then just replace the id with the one you chose\nif($result){\n   return $account['ID'];\n}\nreturn $result;. ",
    "jeffstagedoor": "wouldn't it be easier to do \n->where ('receiver', array($receiver, $sender), 'IN')\n->orWhere('sender', array($receiver, $sender, 'IN')\n\n. ",
    "ravibpatel": "Sure, Will do. . Hi, I opened new Pull Request #794 with this change. So I am closing this now.. ",
    "zhaoyangwu": "Error while sending STMT_PREPARE packet. PID=18622 in /data/wwwroot/warmlight_service/src/App/Vendor/Db/MysqliDb.php line 1908. ",
    "louisluu": "Hey @ricwein, thanks for the response. Sorry I did not make it clear enough.\nIn my case, I have multiple connection, so what I want is to try to reconnect to a secondary database if the primary one reaches a limit (e.g. 5s) of the connection timeout. ",
    "y500": "update php to 3.6+ resolve this problerm. ",
    "ZaronZ": "$count and $totalCount are integers. ",
    "nirmalgoswami": "thanks, anyway it was my mistake, update query was wrong :). ",
    "Gavolexl": "Same problem with float\n. ",
    "r94ever": "Thanks but as I said. I would like to look for a solution without Raw query. No. I mean \nSELECT * FROM table WHERE 1st condition AND 2nd condition AND ( 3rd condition OR 4th condition OR 5th condition )\nI would like to insert the ( and the ) symbol into WHERE. It worked like a charm. Thanks so much. ",
    "boionfire81": "[15-May-2018 00:04:27 UTC] PHP 2. printUsers() /home/public_html/index.php:100\nhas it's own $db initialization. I apologize.. ",
    "mattjis": "@avbdr wrong ticket? Do you know whether or not what I'm trying to do is possible?. ",
    "trayan16": "I have exactly the same problem, No errors with the query, but there's no row inserted.. ",
    "vstaikov": "The result of this:\n$mappedSnippets = Snippet::map('id')->get();\nmust be a mapped array. ",
    "mianaliasjad": "oh thanks <3 . ",
    "Woodehh": "When optimizing systems, you'd sometimes like to see the page rendering\nsped (microtime - microtime) but also the database queries. For example in\nthe footer:\nPage rendered in 0.2 seconds with 5 database calls. That's top-notch mate! Close this one, I can use this as a composer package again ;-). ",
    "LunarDevelopment": "$array_of_arrays is arbitrary - the issue is because the getLastQuery doesn't have \"Ignore\" in it - if it did then the script wouldn't bomb. \nFor illustration I've just tried with the following and had the same error: \n```php\n$array_of_arrays = array(\narray('name' =>'recordname', 'date' => '2018-07-05'),\narray('name' =>'recordname', 'date' => '2018-07-05')\n); \n```\n. @michabbb @VeNoMouS\n``sh \nArray\n(\n    [0] => Array\n        (\n            [0] => INSERT IGNORE INTO db.table (name,date`)  VALUES ('test',  '2018-07-18')\n            [1] => 0.61394000053406\n            [2] => MysqliDb->insertMulti() >>  file \"/dir/bulkInsertTest.php\" line #102 \n        )\n[1] => Array\n    (\n        [0] => INSERT  INTO db.table (`name`, `date`)  VALUES ('test',  '2018-07-18')\n        [1] => 0.54291319847107\n        [2] => MysqliDb->insertMulti() >>  file \"/dir/bulkInsertTest.php\" line #102 \n    )\n\n)\n```. @michabbb Ah sorry, because you were being so helpful I assumed you were a collaborator or something. \nYeah it looks like the library is forgetting that IGNORE is set as a query option after first query.. \nI'll play around and see if I can fix, but any external help is much appreciated - it seems like a fairly large oversight in the library considering there's a closed thread about this issue in 2017. \n. @avbdr \nThe below from @VeNoMouS kinda works.. but produces the following :\nStack trace shows that it's adding IGNORE into all insert queries! woo! \nIf there are no duplicates then the script completes and commits rows to DB. \nIf there are duplicates then the script doesn't commit any of the rows to the DB and returns insert failed:.\nMinor issue is:\nNotice: Use of undefined constant k - assumed 'k' in /dir/script.php \nComing from: \nphp\n            foreach ($options as $k => $v) {\n                $this->${k} = $v;\n            }\nFunction I've used from @VeNoMouS is ... \n```php\npublic function insertMulti($tableName, array $multiInsertData, array $dataKeys = null)\n    {\n        // only auto-commit our inserts, if no transaction is currently running\n        $autoCommit = (isset($this->_transaction_in_progress) ? !$this->_transaction_in_progress : true);\n        $ids = array();\n    $options = [\n        '_queryOptions' => $this->_queryOptions,\n        '_nestJoin' => $this->_nestJoin,\n        '_forUpdate' => $this->_forUpdate,\n        '_lockInShareMode' => $this->_lockInShareMode \n    ];\n\n    if($autoCommit) {\n        $this->startTransaction();\n    }\n\n    foreach ($multiInsertData as $insertData) {\n        if($dataKeys !== null) {\n            // apply column-names if given, else assume they're already given in the data\n            $insertData = array_combine($dataKeys, $insertData);\n        }\n\n        foreach ($options as $k => $v) {\n            $this->${k} = $v;\n        }\n\n        $id = $this->insert($tableName, $insertData);\n        if(!$id) {\n            if($autoCommit) {\n                $this->rollback();\n            }\n            return false;\n        }\n        $ids[] = $id;\n    }\n    if($autoCommit) {\n        $this->commit();\n    }\n    return $ids;\n}\n\n```. I've submitted a pull request with a fix for the k warning. \nWhen using multi insert with ignore though, is it desired to roll back?\nIf so, then the \"ignore\" option is redundant with insertMulti. \nIf roll back is desired then I'll just create an extension of the class. \n. @avbdr just tested and that doesn't work, can't see why not though. \nI tried moving a bit of logic around too: \n```php\n        $id = $this->insert($tableName, $insertData);\n        if(!$id ) {\n            if($autoCommit &&  !in_array('IGNORE', $this->_queryOptions)) {\n                $this->rollback();\n            }\n            return false;\n        }\n        $ids[] = $id;\n\n``` . Seems solid, returns array of ids/ true and false if IGNORE is set : \n```php \n    public function insertMulti($tableName, array $multiInsertData, array $dataKeys = null)\n    {\n        // only auto-commit our inserts, if no transaction is currently running\n        $autoCommit = (isset($this->_transaction_in_progress) ? !$this->_transaction_in_progress : true);\n        $ids = array();\n    $options = [\n        '_queryOptions' => $this->_queryOptions,\n        '_nestJoin' => $this->_nestJoin,\n        '_forUpdate' => $this->_forUpdate,\n        '_lockInShareMode' => $this->_lockInShareMode\n    ];\n\n    if($autoCommit) {\n        $this->startTransaction();\n    }\n\n    foreach ($multiInsertData as $insertData) {\n        if($dataKeys !== null) {\n            // apply column-names if given, else assume they're already given in the data\n            $insertData = array_combine($dataKeys, $insertData);\n        }\n\n        foreach ($options as $k => $v) {\n            $this->${'k'} = $v;\n        }\n\n        $id = $this->insert($tableName, $insertData);\n        if(!$id ) {\n            if($autoCommit &&  !in_array('IGNORE', $options['_queryOptions'])) {\n                $this->rollback();\n            }\n        }\n        $ids[] = $id;\n    }\n    if($autoCommit) {\n        $this->commit();\n    }\n    return $ids;\n}\n\n```. I know we're solving a bug in the above, but in thinking a bit more about it - there's no speed benefit to using insertMulti over using insert in a foreach in the calling script. \nSurely insertMulti should build a statement like: \nmysql\ninsert into db.table (`name`, `date`)\nVALUES \n('lewis', '01-02,2018'),\n('dave', '01-02,2018'),\n('charles', '01-02,2018') ;\nOr maybe there should be an insertBatch function which does the above..  ? . I've changed the return type back to suit - I can't tell whats wrong with spacing per previous comment ? . ",
    "AtlantisDe": "that ok\\  Database design problem. ",
    "xeon826": "It's resolved, the incoming table ProductId didn't match any of the id's from the products table.. Very well then. It is such that references to local variables are only permitted during stored program execution. . Class B\nShould've been\nprotected $primaryKey = 'user_id';\nnot\nprotected $primaryKey = ['user_id'];. So I guess to answer my own question, it's that OneToOne would use $primaryKey and OneToMany would use the method specified in the commit. . ",
    "webnetbt": "Oh,, I found problem in connection with mysql server, so when i tired $db-copy(); get error. Now all fine.. ",
    "benzon": "Not sure if you understand it correct composer require thingengineer/mysqli-database-class:dev-master wont work currently since the package is not added to https://packagist.org\nYou might need to do that manually to be honest.. ",
    "InkedCurtis": "myRawQuery was a function I added myself to a very old system of mine that you're still using the class from lol. ",
    "abdalmonem": "try \n$db->where(\"type NOT IN('\" . explode(\",\", ['discount','guest']) . \"') OR type IS NULL\");. great ! , please do not forget t close the issue\n . in \"logic\" if you say \"NOT TRUE\" its mean \"false\" , also \"NOT FALSE\" = \"true\"\nso you can try : \n<td><?php echo !$Check; ?></td>. ",
    "neubreed": "Thanks .. That produced Warning: explode() expects parameter 2 to be string, array given I swapped it with implode, added additional quotes and enclosing brackets and it worked .. thanks very much!\n$db->where(\"(type NOT IN('\" . implode(\"','\", ['discount','guest']) . \"') OR type IS NULL)\");\n. Thanks for the help guys!\n1a warned of and array to string conversion and failed\n1b. worked. So I can see we need an ? for each  but it would be nice if multidimensional arrays as place holders where considered\nThe orWhere in no.2  didn't work in my case at I have another filter in the query .. \nSELECT  * FROM ticket_type WHERE  type NOT IN ( 'discount', 'guest' )  OR type IS NULL AND event_id = '15'  ORDER BY weight ASC\nI need the IS NULL condition grouped with the IN in the above query\nchrs.\n. ",
    "Coinizy1": "no no i want a query by which i can update the opposite value in my table lol\nlike if it is true now i want to make it false. it is not a bool (column) it is a varchar field\nthanks. ",
    "satalways": "You can try something like this.\n$db->rawQuery('UPDATE table_name SET column_name = NOT column_name WHERE id=?', array(1))\nand if you want to check that query works fine then use these codes\nif ($db->getLastErrno()<>0) echo $db->getLastError();. > thanks for your message.\n\n$db->where('ID', $_POST['id']);\nthis is looks like a missing cast to int. I'm not sure are you calling this a 'regular usage' while data sanitizing is a primary junior mistake.\nunfortunately, mysqlidb is a helper, but not a magic. it have no idea of data types\n\nType casting doesn't matter in MySQLiDB (Class).\n$db->where('ID', $_POST['id']);\nand\n$db->where('ID', (int) $_POST['id']);\nboth generate same query.. You can check using\necho $db->getLastQuery();. That's why I've written an extended class to use MySQLiDB. Sorry for little delay. How can I share my extended class.. I've also other functions like drop_table, drop_column, is_mysql_table() etc.. I am sorry, But I don't know how to do it..\n. Anyway, here is my method in extended class.\nprotected function replacePlaceHolders( $str, $vals ) {\n        $i      = 1;\n        $newStr = \"\";\n    if ( empty( $vals ) ) {\n        return $str;\n    }\n\n    while ( $pos = strpos( $str, \"?\" ) ) {\n        $val = $vals[ $i ++ ];\n        if ( is_object( $val ) ) {\n            $val = '[object]';\n        }\n        if ( $val === null ) {\n            $val = 'NULL';\n        }\n\n        switch ( gettype( $val ) ) {\n            case 'integer':\n            case 'float':\n            case 'double':\n                $newStr .= substr( $str, 0, $pos ) . $val;\n                break;\n            default:\n                $newStr .= substr( $str, 0, $pos ) . \"'\" . $val . \"'\";\n\n        }\n\n        $str = substr( $str, $pos + 1 );\n    }\n    $newStr .= $str;\n\n    return $newStr;\n}.\n",
    "JarLob": "\ns looks like a missing cast to int. I'm not sure are you calling this a 'regular usage' while data sanitizing is a primary junior mistake.\nunfortunately, mysqlidb is a helper, but not a magic. it have no idea of data types\n\nI strongly disagree, user input validation and sanitization is an additional measure, but not a replacement for parameterized queries. MySQLiDB class doesn't concatenate query parameters, but uses ? placeholders after all. However in this case if an array is passed through its index value gets injected into query statement.\n. NP, the pleasure is mine. </EndOfSarcasm>\n\nlibrary never been advertising parametrized queries\n\nIt is written in the description of the project \"Wrapper for a PHP MySQL class, which utilizes MySQLi and prepared statements.\"\nIt might be naming misunderstanding, you do use bind parameters also known as \"prepared statements\" or \"parameterized statement\" and it is what I meant https://en.wikipedia.org/wiki/Prepared_statement\nIt is a security vulnerability and your resistance to admit it may make some people believe it was introduced on purpose after all because the patch is just to remove the four lines of special treatment of arrays.. No offence @satalways, but your suggestions have nothing to do with the injection. replacePlaceHolders is used only for tracing. Calling DB with prepared statements (that are also called parameterized statements in the official php documentation) is the safe technique.\nThe library does call bind_param and does advertise using it. The correct fix is to break some legacy compatibility and prevent untrusted user input getting into $operator. The function has a separate argument for passing operator and only if a programmer allows user input passed to the $operator, same as to $whereProp or $cond, it is his own fault.. "
}